<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>PDF Converter</title>
    <link
      rel="icon"
      sizes="16x16"
      type="image/png"
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACMUlEQVR4AYySy2sTURTGv7lJmsSmnZAIVgWRrGxEDQEf+GipG7FQteADfFHwH9BiIdigWAO2KNWNiypUKChSWnURqEJE1I1QXYhVBCkSom3slDRNmkkm87jemRqZISX2Mt/hnnPP+c2Zc4fAtARBCGey2d7/KZ5IBCplFoDN4dhNCIlVVBofjZUej/zzK3FF5l4+eRpv1iEWgB4wi+YWQUslc8jYa5S6nW732LOJ15trA8QCqCQZRWZzcP+ujW37dgZb9oS6agJchzugppLm2qp9TUB58j1UYQ6L13uxNHQPxYn46gBadgH5gRuQP38C39eP+jNdQFmClHgBLT1rgVR3wIZWGL4PcASuy1fw2+bEnMeL3IlzEHuuIQ07ZtIC8ksi9FUFkL99hforhbpD7chpgMNuW1GE08sB8iEQ4KcCGzbpKn+c9Nma1qOxOwLHuib4FQl+qsDv8y5nmy3HGR6pt5cvNewIJT3bticLfdGYePsm5k8eQT7SjeLdW8hcOGsk2lknZrGfyogT3Ta0d6Cx8zh4Jqgq1l7sgff0eTi3BPVjcNzy2wznr6mEDADhvZC+TEFjA5TZ94MQKPMCcuOjgKaBUgpFUS1SVTYgBjMAC8NDyD0fg/juDdbsPYAMu3Pdl2d+spTaDynK6sPi9HSrCq617uixQdLSBr5/EJ7IVfgejIAfuLMygXWlH5Dwj9lk8HvqrS5H56lHtlA4alHz1ihLjLKbsMjtdkVVSl/9AQAA///DLQCuAAAABklEQVQDABZd9jojnkFHAAAAAElFTkSuQmCC"
    >
    <style>
      *{font-family:Arial;font-size:16px;box-sizing:border-box}
      html,body{padding:0;margin:0;overscroll-behavior:none}
      body{max-width:600px;margin:0 auto;padding:40px 20px;background:#000}

      .container{display:none}
      .title{font-size:30px;font-weight:700;text-align:center;margin-bottom:20px;color:#000}
      .wrapper{background:#fff;padding:30px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,.1)}
      label{display:inline-block;margin-top:10px;margin-bottom:10px}
      input[type=file]{width:100%;padding:10px;border:2px dashed #ccc;border-radius:5px;cursor:pointer}
      button{width:100%;margin-top:15px;padding:15px;background:#3a76b1;color:#fff;border:0;border-radius:5px;cursor:pointer;font-size:16px}
      button:disabled{background:#ccc;cursor:default}
      #pdfPreview{display:none;margin-top:20px;width:100%;height:400px;border:1px solid #ccc;border-radius:5px}

      .pleasewait{position:fixed;width:64px;height:64px;left:0;right:0;top:0;bottom:0;margin:auto auto;border:0}
      .lds-spinner{color:#fff;display:inline-block;position:relative;width:64px;height:64px}
      .lds-spinner div{transform-origin:32px 32px;animation:lds-spinner 1.2s linear infinite}
      .lds-spinner div:after{content:" ";display:block;position:absolute;top:3px;left:29px;width:5px;height:14px;border-radius:20%;background:#fff}
      .lds-spinner div:nth-child(1){transform:rotate(0deg);animation-delay:-1.1s}
      .lds-spinner div:nth-child(2){transform:rotate(30deg);animation-delay:-1s}
      .lds-spinner div:nth-child(3){transform:rotate(60deg);animation-delay:-.9s}
      .lds-spinner div:nth-child(4){transform:rotate(90deg);animation-delay:-.8s}
      .lds-spinner div:nth-child(5){transform:rotate(120deg);animation-delay:-.7s}
      .lds-spinner div:nth-child(6){transform:rotate(150deg);animation-delay:-.6s}
      .lds-spinner div:nth-child(7){transform:rotate(180deg);animation-delay:-.5s}
      .lds-spinner div:nth-child(8){transform:rotate(210deg);animation-delay:-.4s}
      .lds-spinner div:nth-child(9){transform:rotate(240deg);animation-delay:-.3s}
      .lds-spinner div:nth-child(10){transform:rotate(270deg);animation-delay:-.2s}
      .lds-spinner div:nth-child(11){transform:rotate(300deg);animation-delay:-.1s}
      .lds-spinner div:nth-child(12){transform:rotate(330deg);animation-delay:0s}
      @keyframes lds-spinner{0%{opacity:1}to{opacity:0}}
    </style>
  </head>
  <body>
    <div class="pleasewait">
      <div class="lds-spinner">
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
      </div>
    </div>
    <div class="container">
      <div class="title"></div>
      <div class="wrapper">
        <label for="uploader"></label>
        <input type="file" id="uploader" accept=".pdf,application/pdf">
        <iframe id="pdfPreview"></iframe>
        <button id="generate" disabled></button>
      </div>
    </div>
    <script>
      // jszip.min.js
      // prettier-ignore
      // eslint-disable-next-line
      !function (e) {if ("object" == typeof exports && "undefined" != typeof module) module.exports = e();else if ("function" == typeof define && define.amd) define([], e);else {("undefined" != typeof window ? window : "undefined" != typeof global ? global : "undefined" != typeof self ? self : this).JSZip = e();}}(function () {return function s(a, o, u) {function h(r, e) {if (!o[r]) {if (!a[r]) {var t = "function" == typeof require && require;if (!e && t) return t(r, !0);if (f) return f(r, !0);var n = new Error("Cannot find module '" + r + "'");throw n.code = "MODULE_NOT_FOUND", n;}var i = o[r] = { exports: {} };a[r][0].call(i.exports, function (e) {var t = a[r][1][e];return h(t || e);}, i, i.exports, s, a, o, u);}return o[r].exports;}for (var f = "function" == typeof require && require, e = 0; e < u.length; e++) h(u[e]);return h;}({ 1: [function (l, t, n) {(function (r) {!function (e) {"object" == typeof n && void 0 !== t ? t.exports = e() : ("undefined" != typeof window ? window : void 0 !== r ? r : "undefined" != typeof self ? self : this).JSZip = e();}(function () {return function s(a, o, u) {function h(t, e) {if (!o[t]) {if (!a[t]) {var r = "function" == typeof l && l;if (!e && r) return r(t, !0);if (f) return f(t, !0);var n = new Error("Cannot find module '" + t + "'");throw n.code = "MODULE_NOT_FOUND", n;}var i = o[t] = { exports: {} };a[t][0].call(i.exports, function (e) {return h(a[t][1][e] || e);}, i, i.exports, s, a, o, u);}return o[t].exports;}for (var f = "function" == typeof l && l, e = 0; e < u.length; e++) h(u[e]);return h;}({ 1: [function (l, t, n) {(function (r) {!function (e) {"object" == typeof n && void 0 !== t ? t.exports = e() : ("undefined" != typeof window ? window : void 0 !== r ? r : "undefined" != typeof self ? self : this).JSZip = e();}(function () {return function s(a, o, u) {function h(t, e) {if (!o[t]) {if (!a[t]) {var r = "function" == typeof l && l;if (!e && r) return r(t, !0);if (f) return f(t, !0);var n = new Error("Cannot find module '" + t + "'");throw n.code = "MODULE_NOT_FOUND", n;}var i = o[t] = { exports: {} };a[t][0].call(i.exports, function (e) {return h(a[t][1][e] || e);}, i, i.exports, s, a, o, u);}return o[t].exports;}for (var f = "function" == typeof l && l, e = 0; e < u.length; e++) h(u[e]);return h;}({ 1: [function (l, t, n) {(function (r) {!function (e) {"object" == typeof n && void 0 !== t ? t.exports = e() : ("undefined" != typeof window ? window : void 0 !== r ? r : "undefined" != typeof self ? self : this).JSZip = e();}(function () {return function s(a, o, u) {function h(t, e) {if (!o[t]) {if (!a[t]) {var r = "function" == typeof l && l;if (!e && r) return r(t, !0);if (f) return f(t, !0);var n = new Error("Cannot find module '" + t + "'");throw n.code = "MODULE_NOT_FOUND", n;}var i = o[t] = { exports: {} };a[t][0].call(i.exports, function (e) {return h(a[t][1][e] || e);}, i, i.exports, s, a, o, u);}return o[t].exports;}for (var f = "function" == typeof l && l, e = 0; e < u.length; e++) h(u[e]);return h;}({ 1: [function (l, t, n) {(function (r) {!function (e) {"object" == typeof n && void 0 !== t ? t.exports = e() : ("undefined" != typeof window ? window : void 0 !== r ? r : "undefined" != typeof self ? self : this).JSZip = e();}(function () {return function s(a, o, u) {function h(t, e) {if (!o[t]) {if (!a[t]) {var r = "function" == typeof l && l;if (!e && r) return r(t, !0);if (f) return f(t, !0);var n = new Error("Cannot find module '" + t + "'");throw n.code = "MODULE_NOT_FOUND", n;}var i = o[t] = { exports: {} };a[t][0].call(i.exports, function (e) {return h(a[t][1][e] || e);}, i, i.exports, s, a, o, u);}return o[t].exports;}for (var f = "function" == typeof l && l, e = 0; e < u.length; e++) h(u[e]);return h;}({ 1: [function (l, t, n) {(function (r) {!function (e) {"object" == typeof n && void 0 !== t ? t.exports = e() : ("undefined" != typeof window ? window : void 0 !== r ? r : "undefined" != typeof self ? self : this).JSZip = e();}(function () {return function s(a, o, u) {function h(t, e) {if (!o[t]) {if (!a[t]) {var r = "function" == typeof l && l;if (!e && r) return r(t, !0);if (f) return f(t, !0);var n = new Error("Cannot find module '" + t + "'");throw n.code = "MODULE_NOT_FOUND", n;}var i = o[t] = { exports: {} };a[t][0].call(i.exports, function (e) {return h(a[t][1][e] || e);}, i, i.exports, s, a, o, u);}return o[t].exports;}for (var f = "function" == typeof l && l, e = 0; e < u.length; e++) h(u[e]);return h;}({ 1: [function (e, t, r) {"use strict";var c = e("./utils"),l = e("./support"),p = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode = function (e) {for (var t, r, n, i, s, a, o, u = [], h = 0, f = e.length, l = f, d = "string" !== c.getTypeOf(e); h < e.length;) l = f - h, n = d ? (t = e[h++], r = h < f ? e[h++] : 0, h < f ? e[h++] : 0) : (t = e.charCodeAt(h++), r = h < f ? e.charCodeAt(h++) : 0, h < f ? e.charCodeAt(h++) : 0), i = t >> 2, s = (3 & t) << 4 | r >> 4, a = 1 < l ? (15 & r) << 2 | n >> 6 : 64, o = 2 < l ? 63 & n : 64, u.push(p.charAt(i) + p.charAt(s) + p.charAt(a) + p.charAt(o));return u.join("");}, r.decode = function (e) {var t,r,n,i,s,a,o = 0,u = 0;if ("data:" === e.substr(0, "data:".length)) throw new Error("Invalid base64 input, it looks like a data url.");var h,f = 3 * (e = e.replace(/[^A-Za-z0-9\+\/\=]/g, "")).length / 4;if (e.charAt(e.length - 1) === p.charAt(64) && f--, e.charAt(e.length - 2) === p.charAt(64) && f--, f % 1 != 0) throw new Error("Invalid base64 input, bad content length.");for (h = l.uint8array ? new Uint8Array(0 | f) : new Array(0 | f); o < e.length;) t = p.indexOf(e.charAt(o++)) << 2 | (i = p.indexOf(e.charAt(o++))) >> 4, r = (15 & i) << 4 | (s = p.indexOf(e.charAt(o++))) >> 2, n = (3 & s) << 6 | (a = p.indexOf(e.charAt(o++))), h[u++] = t, 64 !== s && (h[u++] = r), 64 !== a && (h[u++] = n);return h;};}, { "./support": 30, "./utils": 32 }], 2: [function (e, t, r) {"use strict";var n = e("./external"),i = e("./stream/DataWorker"),s = e("./stream/Crc32Probe"),a = e("./stream/DataLengthProbe");function o(e, t, r, n, i) {this.compressedSize = e, this.uncompressedSize = t, this.crc32 = r, this.compression = n, this.compressedContent = i;}o.prototype = { getContentWorker: function getContentWorker() {var e = new i(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),t = this;return e.on("end", function () {if (this.streamInfo.data_length !== t.uncompressedSize) throw new Error("Bug : uncompressed data size mismatch");}), e;}, getCompressedWorker: function getCompressedWorker() {return new i(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize", this.compressedSize).withStreamInfo("uncompressedSize", this.uncompressedSize).withStreamInfo("crc32", this.crc32).withStreamInfo("compression", this.compression);} }, o.createWorkerFrom = function (e, t, r) {return e.pipe(new s()).pipe(new a("uncompressedSize")).pipe(t.compressWorker(r)).pipe(new a("compressedSize")).withStreamInfo("compression", t);}, t.exports = o;}, { "./external": 6, "./stream/Crc32Probe": 25, "./stream/DataLengthProbe": 26, "./stream/DataWorker": 27 }], 3: [function (e, t, r) {"use strict";var n = e("./stream/GenericWorker");r.STORE = { magic: "\0\0", compressWorker: function compressWorker(e) {return new n("STORE compression");}, uncompressWorker: function uncompressWorker() {return new n("STORE decompression");} }, r.DEFLATE = e("./flate");}, { "./flate": 7, "./stream/GenericWorker": 28 }], 4: [function (e, t, r) {"use strict";var n = e("./utils"),a = function () {for (var e, t = [], r = 0; r < 256; r++) {e = r;for (var n = 0; n < 8; n++) e = 1 & e ? 3988292384 ^ e >>> 1 : e >>> 1;t[r] = e;}return t;}();t.exports = function (e, t) {return void 0 !== e && e.length ? "string" !== n.getTypeOf(e) ? function (e, t, r) {var n = a,i = 0 + r;e ^= -1;for (var s = 0; s < i; s++) e = e >>> 8 ^ n[255 & (e ^ t[s])];return -1 ^ e;}(0 | t, e, e.length) : function (e, t, r) {var n = a,i = 0 + r;e ^= -1;for (var s = 0; s < i; s++) e = e >>> 8 ^ n[255 & (e ^ t.charCodeAt(s))];return -1 ^ e;}(0 | t, e, e.length) : 0;};}, { "./utils": 32 }], 5: [function (e, t, r) {"use strict";r.base64 = !1, r.binary = !1, r.dir = !1, r.createFolders = !0, r.date = null, r.compression = null, r.compressionOptions = null, r.comment = null, r.unixPermissions = null, r.dosPermissions = null;}, {}], 6: [function (e, t, r) {"use strict";var n;n = "undefined" != typeof Promise ? Promise : e("lie"), t.exports = { Promise: n };}, { lie: 37 }], 7: [function (e, t, r) {"use strict";var n = "undefined" != typeof Uint8Array && "undefined" != typeof Uint16Array && "undefined" != typeof Uint32Array,i = e("pako"),s = e("./utils"),a = e("./stream/GenericWorker"),o = n ? "uint8array" : "array";function u(e, t) {a.call(this, "FlateWorker/" + e), this._pako = null, this._pakoAction = e, this._pakoOptions = t, this.meta = {};}r.magic = "\b\0", s.inherits(u, a), u.prototype.processChunk = function (e) {this.meta = e.meta, null === this._pako && this._createPako(), this._pako.push(s.transformTo(o, e.data), !1);}, u.prototype.flush = function () {a.prototype.flush.call(this), null === this._pako && this._createPako(), this._pako.push([], !0);}, u.prototype.cleanUp = function () {a.prototype.cleanUp.call(this), this._pako = null;}, u.prototype._createPako = function () {this._pako = new i[this._pakoAction]({ raw: !0, level: this._pakoOptions.level || -1 });var t = this;this._pako.onData = function (e) {t.push({ data: e, meta: t.meta });};}, r.compressWorker = function (e) {return new u("Deflate", e);}, r.uncompressWorker = function () {return new u("Inflate", {});};}, { "./stream/GenericWorker": 28, "./utils": 32, pako: 38 }], 8: [function (e, t, r) {"use strict";function I(e, t) {var r,n = "";for (r = 0; r < t; r++) n += String.fromCharCode(255 & e), e >>>= 8;return n;}function i(e, t, r, n, i, s) {var a,o,u = e.file,h = e.compression,f = s !== B.utf8encode,l = O.transformTo("string", s(u.name)),d = O.transformTo("string", B.utf8encode(u.name)),c = u.comment,p = O.transformTo("string", s(c)),m = O.transformTo("string", B.utf8encode(c)),_ = d.length !== u.name.length,g = m.length !== c.length,v = "",b = "",w = "",y = u.dir,k = u.date,x = { crc32: 0, compressedSize: 0, uncompressedSize: 0 };t && !r || (x.crc32 = e.crc32, x.compressedSize = e.compressedSize, x.uncompressedSize = e.uncompressedSize);var S = 0;t && (S |= 8), f || !_ && !g || (S |= 2048);var z,E = 0,C = 0;y && (E |= 16), "UNIX" === i ? (C = 798, E |= ((z = u.unixPermissions) || (z = y ? 16893 : 33204), (65535 & z) << 16)) : (C = 20, E |= 63 & (u.dosPermissions || 0)), a = k.getUTCHours(), a <<= 6, a |= k.getUTCMinutes(), a <<= 5, a |= k.getUTCSeconds() / 2, o = k.getUTCFullYear() - 1980, o <<= 4, o |= k.getUTCMonth() + 1, o <<= 5, o |= k.getUTCDate(), _ && (v += "up" + I((b = I(1, 1) + I(T(l), 4) + d).length, 2) + b), g && (v += "uc" + I((w = I(1, 1) + I(T(p), 4) + m).length, 2) + w);var A = "";return A += "\n\0", A += I(S, 2), A += h.magic, A += I(a, 2), A += I(o, 2), A += I(x.crc32, 4), A += I(x.compressedSize, 4), A += I(x.uncompressedSize, 4), A += I(l.length, 2), A += I(v.length, 2), { fileRecord: R.LOCAL_FILE_HEADER + A + l + v, dirRecord: R.CENTRAL_FILE_HEADER + I(C, 2) + A + I(p.length, 2) + "\0\0\0\0" + I(E, 4) + I(n, 4) + l + v + p };}var O = e("../utils"),s = e("../stream/GenericWorker"),B = e("../utf8"),T = e("../crc32"),R = e("../signature");function n(e, t, r, n) {s.call(this, "ZipFileWorker"), this.bytesWritten = 0, this.zipComment = t, this.zipPlatform = r, this.encodeFileName = n, this.streamFiles = e, this.accumulate = !1, this.contentBuffer = [], this.dirRecords = [], this.currentSourceOffset = 0, this.entriesCount = 0, this.currentFile = null, this._sources = [];}O.inherits(n, s), n.prototype.push = function (e) {var t = e.meta.percent || 0,r = this.entriesCount,n = this._sources.length;this.accumulate ? this.contentBuffer.push(e) : (this.bytesWritten += e.data.length, s.prototype.push.call(this, { data: e.data, meta: { currentFile: this.currentFile, percent: r ? (t + 100 * (r - n - 1)) / r : 100 } }));}, n.prototype.openedSource = function (e) {this.currentSourceOffset = this.bytesWritten, this.currentFile = e.file.name;var t = this.streamFiles && !e.file.dir;if (t) {var r = i(e, t, !1, this.currentSourceOffset, this.zipPlatform, this.encodeFileName);this.push({ data: r.fileRecord, meta: { percent: 0 } });} else this.accumulate = !0;}, n.prototype.closedSource = function (e) {this.accumulate = !1;var t,r = this.streamFiles && !e.file.dir,n = i(e, r, !0, this.currentSourceOffset, this.zipPlatform, this.encodeFileName);if (this.dirRecords.push(n.dirRecord), r) this.push({ data: (t = e, R.DATA_DESCRIPTOR + I(t.crc32, 4) + I(t.compressedSize, 4) + I(t.uncompressedSize, 4)), meta: { percent: 100 } });else for (this.push({ data: n.fileRecord, meta: { percent: 0 } }); this.contentBuffer.length;) this.push(this.contentBuffer.shift());this.currentFile = null;}, n.prototype.flush = function () {for (var e = this.bytesWritten, t = 0; t < this.dirRecords.length; t++) this.push({ data: this.dirRecords[t], meta: { percent: 100 } });var r,n,i,s,a,o,u = this.bytesWritten - e,h = (r = this.dirRecords.length, n = u, i = e, s = this.zipComment, a = this.encodeFileName, o = O.transformTo("string", a(s)), R.CENTRAL_DIRECTORY_END + "\0\0\0\0" + I(r, 2) + I(r, 2) + I(n, 4) + I(i, 4) + I(o.length, 2) + o);this.push({ data: h, meta: { percent: 100 } });}, n.prototype.prepareNextSource = function () {this.previous = this._sources.shift(), this.openedSource(this.previous.streamInfo), this.isPaused ? this.previous.pause() : this.previous.resume();}, n.prototype.registerPrevious = function (e) {this._sources.push(e);var t = this;return e.on("data", function (e) {t.processChunk(e);}), e.on("end", function () {t.closedSource(t.previous.streamInfo), t._sources.length ? t.prepareNextSource() : t.end();}), e.on("error", function (e) {t.error(e);}), this;}, n.prototype.resume = function () {return !!s.prototype.resume.call(this) && (!this.previous && this._sources.length ? (this.prepareNextSource(), !0) : this.previous || this._sources.length || this.generatedError ? void 0 : (this.end(), !0));}, n.prototype.error = function (e) {var t = this._sources;if (!s.prototype.error.call(this, e)) return !1;for (var r = 0; r < t.length; r++) try {t[r].error(e);} catch (e) {}return !0;}, n.prototype.lock = function () {s.prototype.lock.call(this);for (var e = this._sources, t = 0; t < e.length; t++) e[t].lock();}, t.exports = n;}, { "../crc32": 4, "../signature": 23, "../stream/GenericWorker": 28, "../utf8": 31, "../utils": 32 }], 9: [function (e, t, r) {"use strict";var h = e("../compressions"),n = e("./ZipFileWorker");r.generateWorker = function (e, a, t) {var o = new n(a.streamFiles, t, a.platform, a.encodeFileName),u = 0;try {e.forEach(function (e, t) {u++;var r = function (e, t) {var r = e || t,n = h[r];if (!n) throw new Error(r + " is not a valid compression method !");return n;}(t.options.compression, a.compression),n = t.options.compressionOptions || a.compressionOptions || {},i = t.dir,s = t.date;t._compressWorker(r, n).withStreamInfo("file", { name: e, dir: i, date: s, comment: t.comment || "", unixPermissions: t.unixPermissions, dosPermissions: t.dosPermissions }).pipe(o);}), o.entriesCount = u;} catch (e) {o.error(e);}return o;};}, { "../compressions": 3, "./ZipFileWorker": 8 }], 10: [function (e, t, r) {"use strict";function n() {if (!(this instanceof n)) return new n();if (arguments.length) throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files = {}, this.comment = null, this.root = "", this.clone = function () {var e = new n();for (var t in this) "function" != typeof this[t] && (e[t] = this[t]);return e;};}(n.prototype = e("./object")).loadAsync = e("./load"), n.support = e("./support"), n.defaults = e("./defaults"), n.version = "3.5.0", n.loadAsync = function (e, t) {return new n().loadAsync(e, t);}, n.external = e("./external"), t.exports = n;}, { "./defaults": 5, "./external": 6, "./load": 11, "./object": 15, "./support": 30 }], 11: [function (e, t, r) {"use strict";var n = e("./utils"),i = e("./external"),o = e("./utf8"),u = e("./zipEntries"),s = e("./stream/Crc32Probe"),h = e("./nodejsUtils");function f(n) {return new i.Promise(function (e, t) {var r = n.decompressed.getContentWorker().pipe(new s());r.on("error", function (e) {t(e);}).on("end", function () {r.streamInfo.crc32 !== n.decompressed.crc32 ? t(new Error("Corrupted zip : CRC32 mismatch")) : e();}).resume();});}t.exports = function (e, s) {var a = this;return s = n.extend(s || {}, { base64: !1, checkCRC32: !1, optimizedBinaryString: !1, createFolders: !1, decodeFileName: o.utf8decode }), h.isNode && h.isStream(e) ? i.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")) : n.prepareContent("the loaded zip file", e, !0, s.optimizedBinaryString, s.base64).then(function (e) {var t = new u(s);return t.load(e), t;}).then(function (e) {var t = [i.Promise.resolve(e)],r = e.files;if (s.checkCRC32) for (var n = 0; n < r.length; n++) t.push(f(r[n]));return i.Promise.all(t);}).then(function (e) {for (var t = e.shift(), r = t.files, n = 0; n < r.length; n++) {var i = r[n];a.file(i.fileNameStr, i.decompressed, { binary: !0, optimizedBinaryString: !0, date: i.date, dir: i.dir, comment: i.fileCommentStr.length ? i.fileCommentStr : null, unixPermissions: i.unixPermissions, dosPermissions: i.dosPermissions, createFolders: s.createFolders });}return t.zipComment.length && (a.comment = t.zipComment), a;});};}, { "./external": 6, "./nodejsUtils": 14, "./stream/Crc32Probe": 25, "./utf8": 31, "./utils": 32, "./zipEntries": 33 }], 12: [function (e, t, r) {"use strict";var n = e("../utils"),i = e("../stream/GenericWorker");function s(e, t) {i.call(this, "Nodejs stream input adapter for " + e), this._upstreamEnded = !1, this._bindStream(t);}n.inherits(s, i), s.prototype._bindStream = function (e) {var t = this;(this._stream = e).pause(), e.on("data", function (e) {t.push({ data: e, meta: { percent: 0 } });}).on("error", function (e) {t.isPaused ? this.generatedError = e : t.error(e);}).on("end", function () {t.isPaused ? t._upstreamEnded = !0 : t.end();});}, s.prototype.pause = function () {return !!i.prototype.pause.call(this) && (this._stream.pause(), !0);}, s.prototype.resume = function () {return !!i.prototype.resume.call(this) && (this._upstreamEnded ? this.end() : this._stream.resume(), !0);}, t.exports = s;}, { "../stream/GenericWorker": 28, "../utils": 32 }], 13: [function (e, t, r) {"use strict";var i = e("readable-stream").Readable;function n(e, t, r) {i.call(this, t), this._helper = e;var n = this;e.on("data", function (e, t) {n.push(e) || n._helper.pause(), r && r(t);}).on("error", function (e) {n.emit("error", e);}).on("end", function () {n.push(null);});}e("../utils").inherits(n, i), n.prototype._read = function () {this._helper.resume();}, t.exports = n;}, { "../utils": 32, "readable-stream": 16 }], 14: [function (e, t, r) {"use strict";t.exports = { isNode: "undefined" != typeof Buffer, newBufferFrom: function newBufferFrom(e, t) {if (Buffer.from && Buffer.from !== Uint8Array.from) return Buffer.from(e, t);if ("number" == typeof e) throw new Error('The "data" argument must not be a number');return new Buffer(e, t);}, allocBuffer: function allocBuffer(e) {if (Buffer.alloc) return Buffer.alloc(e);var t = new Buffer(e);return t.fill(0), t;}, isBuffer: function isBuffer(e) {return Buffer.isBuffer(e);}, isStream: function isStream(e) {return e && "function" == typeof e.on && "function" == typeof e.pause && "function" == typeof e.resume;} };}, {}], 15: [function (e, t, r) {"use strict";function s(e, t, r) {var n,i = f.getTypeOf(t),s = f.extend(r || {}, d);s.date = s.date || new Date(), null !== s.compression && (s.compression = s.compression.toUpperCase()), "string" == typeof s.unixPermissions && (s.unixPermissions = parseInt(s.unixPermissions, 8)), s.unixPermissions && 16384 & s.unixPermissions && (s.dir = !0), s.dosPermissions && 16 & s.dosPermissions && (s.dir = !0), s.dir && (e = h(e)), s.createFolders && (n = function (e) {"/" === e.slice(-1) && (e = e.substring(0, e.length - 1));var t = e.lastIndexOf("/");return 0 < t ? e.substring(0, t) : "";}(e)) && g.call(this, n, !0);var a,o = "string" === i && !1 === s.binary && !1 === s.base64;r && void 0 !== r.binary || (s.binary = !o), (t instanceof c && 0 === t.uncompressedSize || s.dir || !t || 0 === t.length) && (s.base64 = !1, s.binary = !0, t = "", s.compression = "STORE", i = "string"), a = t instanceof c || t instanceof l ? t : m.isNode && m.isStream(t) ? new _(e, t) : f.prepareContent(e, t, s.binary, s.optimizedBinaryString, s.base64);var u = new p(e, a, s);this.files[e] = u;}function h(e) {return "/" !== e.slice(-1) && (e += "/"), e;}var i = e("./utf8"),f = e("./utils"),l = e("./stream/GenericWorker"),a = e("./stream/StreamHelper"),d = e("./defaults"),c = e("./compressedObject"),p = e("./zipObject"),o = e("./generate"),m = e("./nodejsUtils"),_ = e("./nodejs/NodejsStreamInputAdapter"),g = function g(e, t) {return t = void 0 !== t ? t : d.createFolders, e = h(e), this.files[e] || s.call(this, e, null, { dir: !0, createFolders: t }), this.files[e];};function u(e) {return "[object RegExp]" === Object.prototype.toString.call(e);}var n = { load: function load() {throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.");}, forEach: function forEach(e) {var t, r, n;for (t in this.files) this.files.hasOwnProperty(t) && (n = this.files[t], (r = t.slice(this.root.length, t.length)) && t.slice(0, this.root.length) === this.root && e(r, n));}, filter: function filter(r) {var n = [];return this.forEach(function (e, t) {r(e, t) && n.push(t);}), n;}, file: function file(e, t, r) {if (1 !== arguments.length) return e = this.root + e, s.call(this, e, t, r), this;if (u(e)) {var n = e;return this.filter(function (e, t) {return !t.dir && n.test(e);});}var i = this.files[this.root + e];return i && !i.dir ? i : null;}, folder: function folder(r) {if (!r) return this;if (u(r)) return this.filter(function (e, t) {return t.dir && r.test(e);});var e = this.root + r,t = g.call(this, e),n = this.clone();return n.root = t.name, n;}, remove: function remove(r) {r = this.root + r;var e = this.files[r];if (e || ("/" !== r.slice(-1) && (r += "/"), e = this.files[r]), e && !e.dir) delete this.files[r];else for (var t = this.filter(function (e, t) {return t.name.slice(0, r.length) === r;}), n = 0; n < t.length; n++) delete this.files[t[n].name];return this;}, generate: function generate(e) {throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.");}, generateInternalStream: function generateInternalStream(e) {var t,r = {};try {if ((r = f.extend(e || {}, { streamFiles: !1, compression: "STORE", compressionOptions: null, type: "", platform: "DOS", comment: null, mimeType: "application/zip", encodeFileName: i.utf8encode })).type = r.type.toLowerCase(), r.compression = r.compression.toUpperCase(), "binarystring" === r.type && (r.type = "string"), !r.type) throw new Error("No output type specified.");f.checkSupport(r.type), "darwin" !== r.platform && "freebsd" !== r.platform && "linux" !== r.platform && "sunos" !== r.platform || (r.platform = "UNIX"), "win32" === r.platform && (r.platform = "DOS");var n = r.comment || this.comment || "";t = o.generateWorker(this, r, n);} catch (e) {(t = new l("error")).error(e);}return new a(t, r.type || "string", r.mimeType);}, generateAsync: function generateAsync(e, t) {return this.generateInternalStream(e).accumulate(t);}, generateNodeStream: function generateNodeStream(e, t) {return (e = e || {}).type || (e.type = "nodebuffer"), this.generateInternalStream(e).toNodejsStream(t);} };t.exports = n;}, { "./compressedObject": 2, "./defaults": 5, "./generate": 9, "./nodejs/NodejsStreamInputAdapter": 12, "./nodejsUtils": 14, "./stream/GenericWorker": 28, "./stream/StreamHelper": 29, "./utf8": 31, "./utils": 32, "./zipObject": 35 }], 16: [function (e, t, r) {t.exports = e("stream");}, { stream: void 0 }], 17: [function (e, t, r) {"use strict";var n = e("./DataReader");function i(e) {n.call(this, e);for (var t = 0; t < this.data.length; t++) e[t] = 255 & e[t];}e("../utils").inherits(i, n), i.prototype.byteAt = function (e) {return this.data[this.zero + e];}, i.prototype.lastIndexOfSignature = function (e) {for (var t = e.charCodeAt(0), r = e.charCodeAt(1), n = e.charCodeAt(2), i = e.charCodeAt(3), s = this.length - 4; 0 <= s; --s) if (this.data[s] === t && this.data[s + 1] === r && this.data[s + 2] === n && this.data[s + 3] === i) return s - this.zero;return -1;}, i.prototype.readAndCheckSignature = function (e) {var t = e.charCodeAt(0),r = e.charCodeAt(1),n = e.charCodeAt(2),i = e.charCodeAt(3),s = this.readData(4);return t === s[0] && r === s[1] && n === s[2] && i === s[3];}, i.prototype.readData = function (e) {if (this.checkOffset(e), 0 === e) return [];var t = this.data.slice(this.zero + this.index, this.zero + this.index + e);return this.index += e, t;}, t.exports = i;}, { "../utils": 32, "./DataReader": 18 }], 18: [function (e, t, r) {"use strict";var n = e("../utils");function i(e) {this.data = e, this.length = e.length, this.index = 0, this.zero = 0;}i.prototype = { checkOffset: function checkOffset(e) {this.checkIndex(this.index + e);}, checkIndex: function checkIndex(e) {if (this.length < this.zero + e || e < 0) throw new Error("End of data reached (data length = " + this.length + ", asked index = " + e + "). Corrupted zip ?");}, setIndex: function setIndex(e) {this.checkIndex(e), this.index = e;}, skip: function skip(e) {this.setIndex(this.index + e);}, byteAt: function byteAt(e) {}, readInt: function readInt(e) {var t,r = 0;for (this.checkOffset(e), t = this.index + e - 1; t >= this.index; t--) r = (r << 8) + this.byteAt(t);return this.index += e, r;}, readString: function readString(e) {return n.transformTo("string", this.readData(e));}, readData: function readData(e) {}, lastIndexOfSignature: function lastIndexOfSignature(e) {}, readAndCheckSignature: function readAndCheckSignature(e) {}, readDate: function readDate() {var e = this.readInt(4);return new Date(Date.UTC(1980 + (e >> 25 & 127), (e >> 21 & 15) - 1, e >> 16 & 31, e >> 11 & 31, e >> 5 & 63, (31 & e) << 1));} }, t.exports = i;}, { "../utils": 32 }], 19: [function (e, t, r) {"use strict";var n = e("./Uint8ArrayReader");function i(e) {n.call(this, e);}e("../utils").inherits(i, n), i.prototype.readData = function (e) {this.checkOffset(e);var t = this.data.slice(this.zero + this.index, this.zero + this.index + e);return this.index += e, t;}, t.exports = i;}, { "../utils": 32, "./Uint8ArrayReader": 21 }], 20: [function (e, t, r) {"use strict";var n = e("./DataReader");function i(e) {n.call(this, e);}e("../utils").inherits(i, n), i.prototype.byteAt = function (e) {return this.data.charCodeAt(this.zero + e);}, i.prototype.lastIndexOfSignature = function (e) {return this.data.lastIndexOf(e) - this.zero;}, i.prototype.readAndCheckSignature = function (e) {return e === this.readData(4);}, i.prototype.readData = function (e) {this.checkOffset(e);var t = this.data.slice(this.zero + this.index, this.zero + this.index + e);return this.index += e, t;}, t.exports = i;}, { "../utils": 32, "./DataReader": 18 }], 21: [function (e, t, r) {"use strict";var n = e("./ArrayReader");function i(e) {n.call(this, e);}e("../utils").inherits(i, n), i.prototype.readData = function (e) {if (this.checkOffset(e), 0 === e) return new Uint8Array(0);var t = this.data.subarray(this.zero + this.index, this.zero + this.index + e);return this.index += e, t;}, t.exports = i;}, { "../utils": 32, "./ArrayReader": 17 }], 22: [function (e, t, r) {"use strict";var n = e("../utils"),i = e("../support"),s = e("./ArrayReader"),a = e("./StringReader"),o = e("./NodeBufferReader"),u = e("./Uint8ArrayReader");t.exports = function (e) {var t = n.getTypeOf(e);return n.checkSupport(t), "string" !== t || i.uint8array ? "nodebuffer" === t ? new o(e) : i.uint8array ? new u(n.transformTo("uint8array", e)) : new s(n.transformTo("array", e)) : new a(e);};}, { "../support": 30, "../utils": 32, "./ArrayReader": 17, "./NodeBufferReader": 19, "./StringReader": 20, "./Uint8ArrayReader": 21 }], 23: [function (e, t, r) {"use strict";r.LOCAL_FILE_HEADER = "PK\x03\x04", r.CENTRAL_FILE_HEADER = "PK\x01\x02", r.CENTRAL_DIRECTORY_END = "PK\x05\x06", r.ZIP64_CENTRAL_DIRECTORY_LOCATOR = "PK\x06\x07", r.ZIP64_CENTRAL_DIRECTORY_END = "PK\x06\x06", r.DATA_DESCRIPTOR = "PK\x07\b";}, {}], 24: [function (e, t, r) {"use strict";var n = e("./GenericWorker"),i = e("../utils");function s(e) {n.call(this, "ConvertWorker to " + e), this.destType = e;}i.inherits(s, n), s.prototype.processChunk = function (e) {this.push({ data: i.transformTo(this.destType, e.data), meta: e.meta });}, t.exports = s;}, { "../utils": 32, "./GenericWorker": 28 }], 25: [function (e, t, r) {"use strict";var n = e("./GenericWorker"),i = e("../crc32");function s() {n.call(this, "Crc32Probe"), this.withStreamInfo("crc32", 0);}e("../utils").inherits(s, n), s.prototype.processChunk = function (e) {this.streamInfo.crc32 = i(e.data, this.streamInfo.crc32 || 0), this.push(e);}, t.exports = s;}, { "../crc32": 4, "../utils": 32, "./GenericWorker": 28 }], 26: [function (e, t, r) {"use strict";var n = e("../utils"),i = e("./GenericWorker");function s(e) {i.call(this, "DataLengthProbe for " + e), this.propName = e, this.withStreamInfo(e, 0);}n.inherits(s, i), s.prototype.processChunk = function (e) {if (e) {var t = this.streamInfo[this.propName] || 0;this.streamInfo[this.propName] = t + e.data.length;}i.prototype.processChunk.call(this, e);}, t.exports = s;}, { "../utils": 32, "./GenericWorker": 28 }], 27: [function (e, t, r) {"use strict";var n = e("../utils"),i = e("./GenericWorker");function s(e) {i.call(this, "DataWorker");var t = this;this.dataIsReady = !1, this.index = 0, this.max = 0, this.data = null, this.type = "", this._tickScheduled = !1, e.then(function (e) {t.dataIsReady = !0, t.data = e, t.max = e && e.length || 0, t.type = n.getTypeOf(e), t.isPaused || t._tickAndRepeat();}, function (e) {t.error(e);});}n.inherits(s, i), s.prototype.cleanUp = function () {i.prototype.cleanUp.call(this), this.data = null;}, s.prototype.resume = function () {return !!i.prototype.resume.call(this) && (!this._tickScheduled && this.dataIsReady && (this._tickScheduled = !0, n.delay(this._tickAndRepeat, [], this)), !0);}, s.prototype._tickAndRepeat = function () {this._tickScheduled = !1, this.isPaused || this.isFinished || (this._tick(), this.isFinished || (n.delay(this._tickAndRepeat, [], this), this._tickScheduled = !0));}, s.prototype._tick = function () {if (this.isPaused || this.isFinished) return !1;var e = null,t = Math.min(this.max, this.index + 16384);if (this.index >= this.max) return this.end();switch (this.type) {case "string":e = this.data.substring(this.index, t);break;case "uint8array":e = this.data.subarray(this.index, t);break;case "array":case "nodebuffer":e = this.data.slice(this.index, t);}return this.index = t, this.push({ data: e, meta: { percent: this.max ? this.index / this.max * 100 : 0 } });}, t.exports = s;}, { "../utils": 32, "./GenericWorker": 28 }], 28: [function (e, t, r) {"use strict";function n(e) {this.name = e || "default", this.streamInfo = {}, this.generatedError = null, this.extraStreamInfo = {}, this.isPaused = !0, this.isFinished = !1, this.isLocked = !1, this._listeners = { data: [], end: [], error: [] }, this.previous = null;}n.prototype = { push: function push(e) {this.emit("data", e);}, end: function end() {if (this.isFinished) return !1;this.flush();try {this.emit("end"), this.cleanUp(), this.isFinished = !0;} catch (e) {this.emit("error", e);}return !0;}, error: function error(e) {return !this.isFinished && (this.isPaused ? this.generatedError = e : (this.isFinished = !0, this.emit("error", e), this.previous && this.previous.error(e), this.cleanUp()), !0);}, on: function on(e, t) {return this._listeners[e].push(t), this;}, cleanUp: function cleanUp() {this.streamInfo = this.generatedError = this.extraStreamInfo = null, this._listeners = [];}, emit: function emit(e, t) {if (this._listeners[e]) for (var r = 0; r < this._listeners[e].length; r++) this._listeners[e][r].call(this, t);}, pipe: function pipe(e) {return e.registerPrevious(this);}, registerPrevious: function registerPrevious(e) {if (this.isLocked) throw new Error("The stream '" + this + "' has already been used.");this.streamInfo = e.streamInfo, this.mergeStreamInfo(), this.previous = e;var t = this;return e.on("data", function (e) {t.processChunk(e);}), e.on("end", function () {t.end();}), e.on("error", function (e) {t.error(e);}), this;}, pause: function pause() {return !this.isPaused && !this.isFinished && (this.isPaused = !0, this.previous && this.previous.pause(), !0);}, resume: function resume() {if (!this.isPaused || this.isFinished) return !1;var e = this.isPaused = !1;return this.generatedError && (this.error(this.generatedError), e = !0), this.previous && this.previous.resume(), !e;}, flush: function flush() {}, processChunk: function processChunk(e) {this.push(e);}, withStreamInfo: function withStreamInfo(e, t) {return this.extraStreamInfo[e] = t, this.mergeStreamInfo(), this;}, mergeStreamInfo: function mergeStreamInfo() {for (var e in this.extraStreamInfo) this.extraStreamInfo.hasOwnProperty(e) && (this.streamInfo[e] = this.extraStreamInfo[e]);}, lock: function lock() {if (this.isLocked) throw new Error("The stream '" + this + "' has already been used.");this.isLocked = !0, this.previous && this.previous.lock();}, toString: function toString() {var e = "Worker " + this.name;return this.previous ? this.previous + " -> " + e : e;} }, t.exports = n;}, {}], 29: [function (e, t, r) {"use strict";var h = e("../utils"),i = e("./ConvertWorker"),s = e("./GenericWorker"),f = e("../base64"),n = e("../support"),a = e("../external"),o = null;if (n.nodestream) try {o = e("../nodejs/NodejsStreamOutputAdapter");} catch (e) {}function u(e, t, r) {var n = t;switch (t) {case "blob":case "arraybuffer":n = "uint8array";break;case "base64":n = "string";}try {this._internalType = n, this._outputType = t, this._mimeType = r, h.checkSupport(n), this._worker = e.pipe(new i(n)), e.lock();} catch (e) {this._worker = new s("error"), this._worker.error(e);}}u.prototype = { accumulate: function accumulate(e) {return o = this, u = e, new a.Promise(function (t, r) {var n = [],i = o._internalType,s = o._outputType,a = o._mimeType;o.on("data", function (e, t) {n.push(e), u && u(t);}).on("error", function (e) {n = [], r(e);}).on("end", function () {try {var e = function (e, t, r) {switch (e) {case "blob":return h.newBlob(h.transformTo("arraybuffer", t), r);case "base64":return f.encode(t);default:return h.transformTo(e, t);}}(s, function (e, t) {var r,n = 0,i = null,s = 0;for (r = 0; r < t.length; r++) s += t[r].length;switch (e) {case "string":return t.join("");case "array":return Array.prototype.concat.apply([], t);case "uint8array":for (i = new Uint8Array(s), r = 0; r < t.length; r++) i.set(t[r], n), n += t[r].length;return i;case "nodebuffer":return Buffer.concat(t);default:throw new Error("concat : unsupported type '" + e + "'");}}(i, n), a);t(e);} catch (e) {r(e);}n = [];}).resume();});var o, u;}, on: function on(e, t) {var r = this;return "data" === e ? this._worker.on(e, function (e) {t.call(r, e.data, e.meta);}) : this._worker.on(e, function () {h.delay(t, arguments, r);}), this;}, resume: function resume() {return h.delay(this._worker.resume, [], this._worker), this;}, pause: function pause() {return this._worker.pause(), this;}, toNodejsStream: function toNodejsStream(e) {if (h.checkSupport("nodestream"), "nodebuffer" !== this._outputType) throw new Error(this._outputType + " is not supported by this method");return new o(this, { objectMode: "nodebuffer" !== this._outputType }, e);} }, t.exports = u;}, { "../base64": 1, "../external": 6, "../nodejs/NodejsStreamOutputAdapter": 13, "../support": 30, "../utils": 32, "./ConvertWorker": 24, "./GenericWorker": 28 }], 30: [function (e, t, r) {"use strict";if (r.base64 = !0, r.array = !0, r.string = !0, r.arraybuffer = "undefined" != typeof ArrayBuffer && "undefined" != typeof Uint8Array, r.nodebuffer = "undefined" != typeof Buffer, r.uint8array = "undefined" != typeof Uint8Array, "undefined" == typeof ArrayBuffer) r.blob = !1;else {var n = new ArrayBuffer(0);try {r.blob = 0 === new Blob([n], { type: "application/zip" }).size;} catch (e) {try {var i = new (self.BlobBuilder || self.WebKitBlobBuilder || self.MozBlobBuilder || self.MSBlobBuilder)();i.append(n), r.blob = 0 === i.getBlob("application/zip").size;} catch (e) {r.blob = !1;}}}try {r.nodestream = !!e("readable-stream").Readable;} catch (e) {r.nodestream = !1;}}, { "readable-stream": 16 }], 31: [function (e, t, s) {"use strict";for (var o = e("./utils"), u = e("./support"), r = e("./nodejsUtils"), n = e("./stream/GenericWorker"), h = new Array(256), i = 0; i < 256; i++) h[i] = 252 <= i ? 6 : 248 <= i ? 5 : 240 <= i ? 4 : 224 <= i ? 3 : 192 <= i ? 2 : 1;function a() {n.call(this, "utf-8 decode"), this.leftOver = null;}function f() {n.call(this, "utf-8 encode");}h[254] = h[254] = 1, s.utf8encode = function (e) {return u.nodebuffer ? r.newBufferFrom(e, "utf-8") : function (e) {var t,r,n,i,s,a = e.length,o = 0;for (i = 0; i < a; i++) 55296 == (64512 & (r = e.charCodeAt(i))) && i + 1 < a && 56320 == (64512 & (n = e.charCodeAt(i + 1))) && (r = 65536 + (r - 55296 << 10) + (n - 56320), i++), o += r < 128 ? 1 : r < 2048 ? 2 : r < 65536 ? 3 : 4;for (t = u.uint8array ? new Uint8Array(o) : new Array(o), i = s = 0; s < o; i++) 55296 == (64512 & (r = e.charCodeAt(i))) && i + 1 < a && 56320 == (64512 & (n = e.charCodeAt(i + 1))) && (r = 65536 + (r - 55296 << 10) + (n - 56320), i++), r < 128 ? t[s++] = r : (r < 2048 ? t[s++] = 192 | r >>> 6 : (r < 65536 ? t[s++] = 224 | r >>> 12 : (t[s++] = 240 | r >>> 18, t[s++] = 128 | r >>> 12 & 63), t[s++] = 128 | r >>> 6 & 63), t[s++] = 128 | 63 & r);return t;}(e);}, s.utf8decode = function (e) {return u.nodebuffer ? o.transformTo("nodebuffer", e).toString("utf-8") : function (e) {var t,r,n,i,s = e.length,a = new Array(2 * s);for (t = r = 0; t < s;) if ((n = e[t++]) < 128) a[r++] = n;else if (4 < (i = h[n])) a[r++] = 65533, t += i - 1;else {for (n &= 2 === i ? 31 : 3 === i ? 15 : 7; 1 < i && t < s;) n = n << 6 | 63 & e[t++], i--;1 < i ? a[r++] = 65533 : n < 65536 ? a[r++] = n : (n -= 65536, a[r++] = 55296 | n >> 10 & 1023, a[r++] = 56320 | 1023 & n);}return a.length !== r && (a.subarray ? a = a.subarray(0, r) : a.length = r), o.applyFromCharCode(a);}(e = o.transformTo(u.uint8array ? "uint8array" : "array", e));}, o.inherits(a, n), a.prototype.processChunk = function (e) {var t = o.transformTo(u.uint8array ? "uint8array" : "array", e.data);if (this.leftOver && this.leftOver.length) {if (u.uint8array) {var r = t;(t = new Uint8Array(r.length + this.leftOver.length)).set(this.leftOver, 0), t.set(r, this.leftOver.length);} else t = this.leftOver.concat(t);this.leftOver = null;}var n = function (e, t) {var r;for ((t = t || e.length) > e.length && (t = e.length), r = t - 1; 0 <= r && 128 == (192 & e[r]);) r--;return r < 0 ? t : 0 === r ? t : r + h[e[r]] > t ? r : t;}(t),i = t;n !== t.length && (u.uint8array ? (i = t.subarray(0, n), this.leftOver = t.subarray(n, t.length)) : (i = t.slice(0, n), this.leftOver = t.slice(n, t.length))), this.push({ data: s.utf8decode(i), meta: e.meta });}, a.prototype.flush = function () {this.leftOver && this.leftOver.length && (this.push({ data: s.utf8decode(this.leftOver), meta: {} }), this.leftOver = null);}, s.Utf8DecodeWorker = a, o.inherits(f, n), f.prototype.processChunk = function (e) {this.push({ data: s.utf8encode(e.data), meta: e.meta });}, s.Utf8EncodeWorker = f;}, { "./nodejsUtils": 14, "./stream/GenericWorker": 28, "./support": 30, "./utils": 32 }], 32: [function (e, t, o) {"use strict";var u = e("./support"),h = e("./base64"),r = e("./nodejsUtils"),n = e("set-immediate-shim"),f = e("./external");function i(e) {return e;}function l(e, t) {for (var r = 0; r < e.length; ++r) t[r] = 255 & e.charCodeAt(r);return t;}o.newBlob = function (t, r) {o.checkSupport("blob");try {return new Blob([t], { type: r });} catch (e) {try {var n = new (self.BlobBuilder || self.WebKitBlobBuilder || self.MozBlobBuilder || self.MSBlobBuilder)();return n.append(t), n.getBlob(r);} catch (e) {throw new Error("Bug : can't construct the Blob.");}}};var s = { stringifyByChunk: function stringifyByChunk(e, t, r) {var n = [],i = 0,s = e.length;if (s <= r) return String.fromCharCode.apply(null, e);for (; i < s;) "array" === t || "nodebuffer" === t ? n.push(String.fromCharCode.apply(null, e.slice(i, Math.min(i + r, s)))) : n.push(String.fromCharCode.apply(null, e.subarray(i, Math.min(i + r, s)))), i += r;return n.join("");}, stringifyByChar: function stringifyByChar(e) {for (var t = "", r = 0; r < e.length; r++) t += String.fromCharCode(e[r]);return t;}, applyCanBeUsed: { uint8array: function () {try {return u.uint8array && 1 === String.fromCharCode.apply(null, new Uint8Array(1)).length;} catch (e) {return !1;}}(), nodebuffer: function () {try {return u.nodebuffer && 1 === String.fromCharCode.apply(null, r.allocBuffer(1)).length;} catch (e) {return !1;}}() } };function a(e) {var t = 65536,r = o.getTypeOf(e),n = !0;if ("uint8array" === r ? n = s.applyCanBeUsed.uint8array : "nodebuffer" === r && (n = s.applyCanBeUsed.nodebuffer), n) for (; 1 < t;) try {return s.stringifyByChunk(e, r, t);} catch (e) {t = Math.floor(t / 2);}return s.stringifyByChar(e);}function d(e, t) {for (var r = 0; r < e.length; r++) t[r] = e[r];return t;}o.applyFromCharCode = a;var c = {};c.string = { string: i, array: function array(e) {return l(e, new Array(e.length));}, arraybuffer: function arraybuffer(e) {return c.string.uint8array(e).buffer;}, uint8array: function uint8array(e) {return l(e, new Uint8Array(e.length));}, nodebuffer: function nodebuffer(e) {return l(e, r.allocBuffer(e.length));} }, c.array = { string: a, array: i, arraybuffer: function arraybuffer(e) {return new Uint8Array(e).buffer;}, uint8array: function uint8array(e) {return new Uint8Array(e);}, nodebuffer: function nodebuffer(e) {return r.newBufferFrom(e);} }, c.arraybuffer = { string: function string(e) {return a(new Uint8Array(e));}, array: function array(e) {return d(new Uint8Array(e), new Array(e.byteLength));}, arraybuffer: i, uint8array: function uint8array(e) {return new Uint8Array(e);}, nodebuffer: function nodebuffer(e) {return r.newBufferFrom(new Uint8Array(e));} }, c.uint8array = { string: a, array: function array(e) {return d(e, new Array(e.length));}, arraybuffer: function arraybuffer(e) {return e.buffer;}, uint8array: i, nodebuffer: function nodebuffer(e) {return r.newBufferFrom(e);} }, c.nodebuffer = { string: a, array: function array(e) {return d(e, new Array(e.length));}, arraybuffer: function arraybuffer(e) {return c.nodebuffer.uint8array(e).buffer;}, uint8array: function uint8array(e) {return d(e, new Uint8Array(e.length));}, nodebuffer: i }, o.transformTo = function (e, t) {if (t = t || "", !e) return t;o.checkSupport(e);var r = o.getTypeOf(t);return c[r][e](t);}, o.getTypeOf = function (e) {return "string" == typeof e ? "string" : "[object Array]" === Object.prototype.toString.call(e) ? "array" : u.nodebuffer && r.isBuffer(e) ? "nodebuffer" : u.uint8array && e instanceof Uint8Array ? "uint8array" : u.arraybuffer && e instanceof ArrayBuffer ? "arraybuffer" : void 0;}, o.checkSupport = function (e) {if (!u[e.toLowerCase()]) throw new Error(e + " is not supported by this platform");}, o.MAX_VALUE_16BITS = 65535, o.MAX_VALUE_32BITS = -1, o.pretty = function (e) {var t,r,n = "";for (r = 0; r < (e || "").length; r++) n += "\\x" + ((t = e.charCodeAt(r)) < 16 ? "0" : "") + t.toString(16).toUpperCase();return n;}, o.delay = function (e, t, r) {n(function () {e.apply(r || null, t || []);});}, o.inherits = function (e, t) {function r() {}r.prototype = t.prototype, e.prototype = new r();}, o.extend = function () {var e,t,r = {};for (e = 0; e < arguments.length; e++) for (t in arguments[e]) arguments[e].hasOwnProperty(t) && void 0 === r[t] && (r[t] = arguments[e][t]);return r;}, o.prepareContent = function (n, e, i, s, a) {return f.Promise.resolve(e).then(function (n) {return u.blob && (n instanceof Blob || -1 !== ["[object File]", "[object Blob]"].indexOf(Object.prototype.toString.call(n))) && "undefined" != typeof FileReader ? new f.Promise(function (t, r) {var e = new FileReader();e.onload = function (e) {t(e.target.result);}, e.onerror = function (e) {r(e.target.error);}, e.readAsArrayBuffer(n);}) : n;}).then(function (e) {var t,r = o.getTypeOf(e);return r ? ("arraybuffer" === r ? e = o.transformTo("uint8array", e) : "string" === r && (a ? e = h.decode(e) : i && !0 !== s && (e = l(t = e, u.uint8array ? new Uint8Array(t.length) : new Array(t.length)))), e) : f.Promise.reject(new Error("Can't read the data of '" + n + "'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"));});};}, { "./base64": 1, "./external": 6, "./nodejsUtils": 14, "./support": 30, "set-immediate-shim": 54 }], 33: [function (e, t, r) {"use strict";var n = e("./reader/readerFor"),i = e("./utils"),s = e("./signature"),a = e("./zipEntry"),o = (e("./utf8"), e("./support"));function u(e) {this.files = [], this.loadOptions = e;}u.prototype = { checkSignature: function checkSignature(e) {if (!this.reader.readAndCheckSignature(e)) {this.reader.index -= 4;var t = this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature (" + i.pretty(t) + ", expected " + i.pretty(e) + ")");}}, isSignature: function isSignature(e, t) {var r = this.reader.index;this.reader.setIndex(e);var n = this.reader.readString(4) === t;return this.reader.setIndex(r), n;}, readBlockEndOfCentral: function readBlockEndOfCentral() {this.diskNumber = this.reader.readInt(2), this.diskWithCentralDirStart = this.reader.readInt(2), this.centralDirRecordsOnThisDisk = this.reader.readInt(2), this.centralDirRecords = this.reader.readInt(2), this.centralDirSize = this.reader.readInt(4), this.centralDirOffset = this.reader.readInt(4), this.zipCommentLength = this.reader.readInt(2);var e = this.reader.readData(this.zipCommentLength),t = o.uint8array ? "uint8array" : "array",r = i.transformTo(t, e);this.zipComment = this.loadOptions.decodeFileName(r);}, readBlockZip64EndOfCentral: function readBlockZip64EndOfCentral() {this.zip64EndOfCentralSize = this.reader.readInt(8), this.reader.skip(4), this.diskNumber = this.reader.readInt(4), this.diskWithCentralDirStart = this.reader.readInt(4), this.centralDirRecordsOnThisDisk = this.reader.readInt(8), this.centralDirRecords = this.reader.readInt(8), this.centralDirSize = this.reader.readInt(8), this.centralDirOffset = this.reader.readInt(8), this.zip64ExtensibleData = {};for (var e, t, r, n = this.zip64EndOfCentralSize - 44; 0 < n;) e = this.reader.readInt(2), t = this.reader.readInt(4), r = this.reader.readData(t), this.zip64ExtensibleData[e] = { id: e, length: t, value: r };}, readBlockZip64EndOfCentralLocator: function readBlockZip64EndOfCentralLocator() {if (this.diskWithZip64CentralDirStart = this.reader.readInt(4), this.relativeOffsetEndOfZip64CentralDir = this.reader.readInt(8), this.disksCount = this.reader.readInt(4), 1 < this.disksCount) throw new Error("Multi-volumes zip are not supported");}, readLocalFiles: function readLocalFiles() {var e, t;for (e = 0; e < this.files.length; e++) t = this.files[e], this.reader.setIndex(t.localHeaderOffset), this.checkSignature(s.LOCAL_FILE_HEADER), t.readLocalPart(this.reader), t.handleUTF8(), t.processAttributes();}, readCentralDir: function readCentralDir() {var e;for (this.reader.setIndex(this.centralDirOffset); this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);) (e = new a({ zip64: this.zip64 }, this.loadOptions)).readCentralPart(this.reader), this.files.push(e);if (this.centralDirRecords !== this.files.length && 0 !== this.centralDirRecords && 0 === this.files.length) throw new Error("Corrupted zip or bug: expected " + this.centralDirRecords + " records in central dir, got " + this.files.length);}, readEndOfCentral: function readEndOfCentral() {var e = this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if (e < 0) throw this.isSignature(0, s.LOCAL_FILE_HEADER) ? new Error("Corrupted zip: can't find end of central directory") : new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(e);var t = e;if (this.checkSignature(s.CENTRAL_DIRECTORY_END), this.readBlockEndOfCentral(), this.diskNumber === i.MAX_VALUE_16BITS || this.diskWithCentralDirStart === i.MAX_VALUE_16BITS || this.centralDirRecordsOnThisDisk === i.MAX_VALUE_16BITS || this.centralDirRecords === i.MAX_VALUE_16BITS || this.centralDirSize === i.MAX_VALUE_32BITS || this.centralDirOffset === i.MAX_VALUE_32BITS) {if (this.zip64 = !0, (e = this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR)) < 0) throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if (this.reader.setIndex(e), this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR), this.readBlockZip64EndOfCentralLocator(), !this.isSignature(this.relativeOffsetEndOfZip64CentralDir, s.ZIP64_CENTRAL_DIRECTORY_END) && (this.relativeOffsetEndOfZip64CentralDir = this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END), this.relativeOffsetEndOfZip64CentralDir < 0)) throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir), this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END), this.readBlockZip64EndOfCentral();}var r = this.centralDirOffset + this.centralDirSize;this.zip64 && (r += 20, r += 12 + this.zip64EndOfCentralSize);var n = t - r;if (0 < n) this.isSignature(t, s.CENTRAL_FILE_HEADER) || (this.reader.zero = n);else if (n < 0) throw new Error("Corrupted zip: missing " + Math.abs(n) + " bytes.");}, prepareReader: function prepareReader(e) {this.reader = n(e);}, load: function load(e) {this.prepareReader(e), this.readEndOfCentral(), this.readCentralDir(), this.readLocalFiles();} }, t.exports = u;}, { "./reader/readerFor": 22, "./signature": 23, "./support": 30, "./utf8": 31, "./utils": 32, "./zipEntry": 34 }], 34: [function (e, t, r) {"use strict";var n = e("./reader/readerFor"),s = e("./utils"),i = e("./compressedObject"),a = e("./crc32"),o = e("./utf8"),u = e("./compressions"),h = e("./support");function f(e, t) {this.options = e, this.loadOptions = t;}f.prototype = { isEncrypted: function isEncrypted() {return 1 == (1 & this.bitFlag);}, useUTF8: function useUTF8() {return 2048 == (2048 & this.bitFlag);}, readLocalPart: function readLocalPart(e) {var t, r;if (e.skip(22), this.fileNameLength = e.readInt(2), r = e.readInt(2), this.fileName = e.readData(this.fileNameLength), e.skip(r), -1 === this.compressedSize || -1 === this.uncompressedSize) throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if (null === (t = function (e) {for (var t in u) if (u.hasOwnProperty(t) && u[t].magic === e) return u[t];return null;}(this.compressionMethod))) throw new Error("Corrupted zip : compression " + s.pretty(this.compressionMethod) + " unknown (inner file : " + s.transformTo("string", this.fileName) + ")");this.decompressed = new i(this.compressedSize, this.uncompressedSize, this.crc32, t, e.readData(this.compressedSize));}, readCentralPart: function readCentralPart(e) {this.versionMadeBy = e.readInt(2), e.skip(2), this.bitFlag = e.readInt(2), this.compressionMethod = e.readString(2), this.date = e.readDate(), this.crc32 = e.readInt(4), this.compressedSize = e.readInt(4), this.uncompressedSize = e.readInt(4);var t = e.readInt(2);if (this.extraFieldsLength = e.readInt(2), this.fileCommentLength = e.readInt(2), this.diskNumberStart = e.readInt(2), this.internalFileAttributes = e.readInt(2), this.externalFileAttributes = e.readInt(4), this.localHeaderOffset = e.readInt(4), this.isEncrypted()) throw new Error("Encrypted zip are not supported");e.skip(t), this.readExtraFields(e), this.parseZIP64ExtraField(e), this.fileComment = e.readData(this.fileCommentLength);}, processAttributes: function processAttributes() {this.unixPermissions = null, this.dosPermissions = null;var e = this.versionMadeBy >> 8;this.dir = !!(16 & this.externalFileAttributes), 0 == e && (this.dosPermissions = 63 & this.externalFileAttributes), 3 == e && (this.unixPermissions = this.externalFileAttributes >> 16 & 65535), this.dir || "/" !== this.fileNameStr.slice(-1) || (this.dir = !0);}, parseZIP64ExtraField: function parseZIP64ExtraField(e) {if (this.extraFields[1]) {var t = n(this.extraFields[1].value);this.uncompressedSize === s.MAX_VALUE_32BITS && (this.uncompressedSize = t.readInt(8)), this.compressedSize === s.MAX_VALUE_32BITS && (this.compressedSize = t.readInt(8)), this.localHeaderOffset === s.MAX_VALUE_32BITS && (this.localHeaderOffset = t.readInt(8)), this.diskNumberStart === s.MAX_VALUE_32BITS && (this.diskNumberStart = t.readInt(4));}}, readExtraFields: function readExtraFields(e) {var t,r,n,i = e.index + this.extraFieldsLength;for (this.extraFields || (this.extraFields = {}); e.index + 4 < i;) t = e.readInt(2), r = e.readInt(2), n = e.readData(r), this.extraFields[t] = { id: t, length: r, value: n };e.setIndex(i);}, handleUTF8: function handleUTF8() {var e = h.uint8array ? "uint8array" : "array";if (this.useUTF8()) this.fileNameStr = o.utf8decode(this.fileName), this.fileCommentStr = o.utf8decode(this.fileComment);else {var t = this.findExtraFieldUnicodePath();if (null !== t) this.fileNameStr = t;else {var r = s.transformTo(e, this.fileName);this.fileNameStr = this.loadOptions.decodeFileName(r);}var n = this.findExtraFieldUnicodeComment();if (null !== n) this.fileCommentStr = n;else {var i = s.transformTo(e, this.fileComment);this.fileCommentStr = this.loadOptions.decodeFileName(i);}}}, findExtraFieldUnicodePath: function findExtraFieldUnicodePath() {var e = this.extraFields[28789];if (e) {var t = n(e.value);return 1 !== t.readInt(1) ? null : a(this.fileName) !== t.readInt(4) ? null : o.utf8decode(t.readData(e.length - 5));}return null;}, findExtraFieldUnicodeComment: function findExtraFieldUnicodeComment() {var e = this.extraFields[25461];if (e) {var t = n(e.value);return 1 !== t.readInt(1) ? null : a(this.fileComment) !== t.readInt(4) ? null : o.utf8decode(t.readData(e.length - 5));}return null;} }, t.exports = f;}, { "./compressedObject": 2, "./compressions": 3, "./crc32": 4, "./reader/readerFor": 22, "./support": 30, "./utf8": 31, "./utils": 32 }], 35: [function (e, t, r) {"use strict";function n(e, t, r) {this.name = e, this.dir = r.dir, this.date = r.date, this.comment = r.comment, this.unixPermissions = r.unixPermissions, this.dosPermissions = r.dosPermissions, this._data = t, this._dataBinary = r.binary, this.options = { compression: r.compression, compressionOptions: r.compressionOptions };}var s = e("./stream/StreamHelper"),i = e("./stream/DataWorker"),a = e("./utf8"),o = e("./compressedObject"),u = e("./stream/GenericWorker");n.prototype = { internalStream: function internalStream(e) {var t = null,r = "string";try {if (!e) throw new Error("No output type specified.");var n = "string" === (r = e.toLowerCase()) || "text" === r;"binarystring" !== r && "text" !== r || (r = "string"), t = this._decompressWorker();var i = !this._dataBinary;i && !n && (t = t.pipe(new a.Utf8EncodeWorker())), !i && n && (t = t.pipe(new a.Utf8DecodeWorker()));} catch (e) {(t = new u("error")).error(e);}return new s(t, r, "");}, async: function async(e, t) {return this.internalStream(e).accumulate(t);}, nodeStream: function nodeStream(e, t) {return this.internalStream(e || "nodebuffer").toNodejsStream(t);}, _compressWorker: function _compressWorker(e, t) {if (this._data instanceof o && this._data.compression.magic === e.magic) return this._data.getCompressedWorker();var r = this._decompressWorker();return this._dataBinary || (r = r.pipe(new a.Utf8EncodeWorker())), o.createWorkerFrom(r, e, t);}, _decompressWorker: function _decompressWorker() {return this._data instanceof o ? this._data.getContentWorker() : this._data instanceof u ? this._data : new i(this._data);} };for (var h = ["asText", "asBinary", "asNodeBuffer", "asUint8Array", "asArrayBuffer"], f = function f() {throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.");}, l = 0; l < h.length; l++) n.prototype[h[l]] = f;t.exports = n;}, { "./compressedObject": 2, "./stream/DataWorker": 27, "./stream/GenericWorker": 28, "./stream/StreamHelper": 29, "./utf8": 31 }], 36: [function (e, f, t) {(function (t) {"use strict";var r,n,e = t.MutationObserver || t.WebKitMutationObserver;if (e) {var i = 0,s = new e(h),a = t.document.createTextNode("");s.observe(a, { characterData: !0 }), r = function r() {a.data = i = ++i % 2;};} else if (t.setImmediate || void 0 === t.MessageChannel) r = "document" in t && "onreadystatechange" in t.document.createElement("script") ? function () {var e = t.document.createElement("script");e.onreadystatechange = function () {h(), e.onreadystatechange = null, e.parentNode.removeChild(e), e = null;}, t.document.documentElement.appendChild(e);} : function () {setTimeout(h, 0);};else {var o = new t.MessageChannel();o.port1.onmessage = h, r = function r() {o.port2.postMessage(0);};}var u = [];function h() {var e, t;n = !0;for (var r = u.length; r;) {for (t = u, u = [], e = -1; ++e < r;) t[e]();r = u.length;}n = !1;}f.exports = function (e) {1 !== u.push(e) || n || r();};}).call(this, void 0 !== r ? r : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {});}, {}], 37: [function (e, t, r) {"use strict";var i = e("immediate");function h() {}var f = {},s = ["REJECTED"],a = ["FULFILLED"],n = ["PENDING"];function o(e) {if ("function" != typeof e) throw new TypeError("resolver must be a function");this.state = n, this.queue = [], this.outcome = void 0, e !== h && c(this, e);}function u(e, t, r) {this.promise = e, "function" == typeof t && (this.onFulfilled = t, this.callFulfilled = this.otherCallFulfilled), "function" == typeof r && (this.onRejected = r, this.callRejected = this.otherCallRejected);}function l(t, r, n) {i(function () {var e;try {e = r(n);} catch (e) {return f.reject(t, e);}e === t ? f.reject(t, new TypeError("Cannot resolve promise with itself")) : f.resolve(t, e);});}function d(e) {var t = e && e.then;if (e && ("object" == typeof e || "function" == typeof e) && "function" == typeof t) return function () {t.apply(e, arguments);};}function c(t, e) {var r = !1;function n(e) {r || (r = !0, f.reject(t, e));}function i(e) {r || (r = !0, f.resolve(t, e));}var s = p(function () {e(i, n);});"error" === s.status && n(s.value);}function p(e, t) {var r = {};try {r.value = e(t), r.status = "success";} catch (e) {r.status = "error", r.value = e;}return r;}(t.exports = o).prototype.finally = function (t) {if ("function" != typeof t) return this;var r = this.constructor;return this.then(function (e) {return r.resolve(t()).then(function () {return e;});}, function (e) {return r.resolve(t()).then(function () {throw e;});});}, o.prototype.catch = function (e) {return this.then(null, e);}, o.prototype.then = function (e, t) {if ("function" != typeof e && this.state === a || "function" != typeof t && this.state === s) return this;var r = new this.constructor(h);return this.state !== n ? l(r, this.state === a ? e : t, this.outcome) : this.queue.push(new u(r, e, t)), r;}, u.prototype.callFulfilled = function (e) {f.resolve(this.promise, e);}, u.prototype.otherCallFulfilled = function (e) {l(this.promise, this.onFulfilled, e);}, u.prototype.callRejected = function (e) {f.reject(this.promise, e);}, u.prototype.otherCallRejected = function (e) {l(this.promise, this.onRejected, e);}, f.resolve = function (e, t) {var r = p(d, t);if ("error" === r.status) return f.reject(e, r.value);var n = r.value;if (n) c(e, n);else {e.state = a, e.outcome = t;for (var i = -1, s = e.queue.length; ++i < s;) e.queue[i].callFulfilled(t);}return e;}, f.reject = function (e, t) {e.state = s, e.outcome = t;for (var r = -1, n = e.queue.length; ++r < n;) e.queue[r].callRejected(t);return e;}, o.resolve = function (e) {return e instanceof this ? e : f.resolve(new this(h), e);}, o.reject = function (e) {var t = new this(h);return f.reject(t, e);}, o.all = function (e) {var r = this;if ("[object Array]" !== Object.prototype.toString.call(e)) return this.reject(new TypeError("must be an array"));var n = e.length,i = !1;if (!n) return this.resolve([]);for (var s = new Array(n), a = 0, t = -1, o = new this(h); ++t < n;) u(e[t], t);return o;function u(e, t) {r.resolve(e).then(function (e) {s[t] = e, ++a !== n || i || (i = !0, f.resolve(o, s));}, function (e) {i || (i = !0, f.reject(o, e));});}}, o.race = function (e) {if ("[object Array]" !== Object.prototype.toString.call(e)) return this.reject(new TypeError("must be an array"));var t = e.length,r = !1;if (!t) return this.resolve([]);for (var n, i = -1, s = new this(h); ++i < t;) n = e[i], this.resolve(n).then(function (e) {r || (r = !0, f.resolve(s, e));}, function (e) {r || (r = !0, f.reject(s, e));});return s;};}, { immediate: 36 }], 38: [function (e, t, r) {"use strict";var n = {};(0, e("./lib/utils/common").assign)(n, e("./lib/deflate"), e("./lib/inflate"), e("./lib/zlib/constants")), t.exports = n;}, { "./lib/deflate": 39, "./lib/inflate": 40, "./lib/utils/common": 41, "./lib/zlib/constants": 44 }], 39: [function (e, t, r) {"use strict";var a = e("./zlib/deflate"),o = e("./utils/common"),u = e("./utils/strings"),i = e("./zlib/messages"),s = e("./zlib/zstream"),h = Object.prototype.toString,f = 0,l = -1,d = 0,c = 8;function p(e) {if (!(this instanceof p)) return new p(e);this.options = o.assign({ level: l, method: c, chunkSize: 16384, windowBits: 15, memLevel: 8, strategy: d, to: "" }, e || {});var t = this.options;t.raw && 0 < t.windowBits ? t.windowBits = -t.windowBits : t.gzip && 0 < t.windowBits && t.windowBits < 16 && (t.windowBits += 16), this.err = 0, this.msg = "", this.ended = !1, this.chunks = [], this.strm = new s(), this.strm.avail_out = 0;var r = a.deflateInit2(this.strm, t.level, t.method, t.windowBits, t.memLevel, t.strategy);if (r !== f) throw new Error(i[r]);if (t.header && a.deflateSetHeader(this.strm, t.header), t.dictionary) {var n;if (n = "string" == typeof t.dictionary ? u.string2buf(t.dictionary) : "[object ArrayBuffer]" === h.call(t.dictionary) ? new Uint8Array(t.dictionary) : t.dictionary, (r = a.deflateSetDictionary(this.strm, n)) !== f) throw new Error(i[r]);this._dict_set = !0;}}function n(e, t) {var r = new p(t);if (r.push(e, !0), r.err) throw r.msg || i[r.err];return r.result;}p.prototype.push = function (e, t) {var r,n,i = this.strm,s = this.options.chunkSize;if (this.ended) return !1;n = t === ~~t ? t : !0 === t ? 4 : 0, "string" == typeof e ? i.input = u.string2buf(e) : "[object ArrayBuffer]" === h.call(e) ? i.input = new Uint8Array(e) : i.input = e, i.next_in = 0, i.avail_in = i.input.length;do {if (0 === i.avail_out && (i.output = new o.Buf8(s), i.next_out = 0, i.avail_out = s), 1 !== (r = a.deflate(i, n)) && r !== f) return this.onEnd(r), !(this.ended = !0);0 !== i.avail_out && (0 !== i.avail_in || 4 !== n && 2 !== n) || ("string" === this.options.to ? this.onData(u.buf2binstring(o.shrinkBuf(i.output, i.next_out))) : this.onData(o.shrinkBuf(i.output, i.next_out)));} while ((0 < i.avail_in || 0 === i.avail_out) && 1 !== r);return 4 === n ? (r = a.deflateEnd(this.strm), this.onEnd(r), this.ended = !0, r === f) : 2 !== n || (this.onEnd(f), !(i.avail_out = 0));}, p.prototype.onData = function (e) {this.chunks.push(e);}, p.prototype.onEnd = function (e) {e === f && ("string" === this.options.to ? this.result = this.chunks.join("") : this.result = o.flattenChunks(this.chunks)), this.chunks = [], this.err = e, this.msg = this.strm.msg;}, r.Deflate = p, r.deflate = n, r.deflateRaw = function (e, t) {return (t = t || {}).raw = !0, n(e, t);}, r.gzip = function (e, t) {return (t = t || {}).gzip = !0, n(e, t);};}, { "./utils/common": 41, "./utils/strings": 42, "./zlib/deflate": 46, "./zlib/messages": 51, "./zlib/zstream": 53 }], 40: [function (e, t, r) {"use strict";var d = e("./zlib/inflate"),c = e("./utils/common"),p = e("./utils/strings"),m = e("./zlib/constants"),n = e("./zlib/messages"),i = e("./zlib/zstream"),s = e("./zlib/gzheader"),_ = Object.prototype.toString;function a(e) {if (!(this instanceof a)) return new a(e);this.options = c.assign({ chunkSize: 16384, windowBits: 0, to: "" }, e || {});var t = this.options;t.raw && 0 <= t.windowBits && t.windowBits < 16 && (t.windowBits = -t.windowBits, 0 === t.windowBits && (t.windowBits = -15)), !(0 <= t.windowBits && t.windowBits < 16) || e && e.windowBits || (t.windowBits += 32), 15 < t.windowBits && t.windowBits < 48 && 0 == (15 & t.windowBits) && (t.windowBits |= 15), this.err = 0, this.msg = "", this.ended = !1, this.chunks = [], this.strm = new i(), this.strm.avail_out = 0;var r = d.inflateInit2(this.strm, t.windowBits);if (r !== m.Z_OK) throw new Error(n[r]);this.header = new s(), d.inflateGetHeader(this.strm, this.header);}function o(e, t) {var r = new a(t);if (r.push(e, !0), r.err) throw r.msg || n[r.err];return r.result;}a.prototype.push = function (e, t) {var r,n,i,s,a,o,u = this.strm,h = this.options.chunkSize,f = this.options.dictionary,l = !1;if (this.ended) return !1;n = t === ~~t ? t : !0 === t ? m.Z_FINISH : m.Z_NO_FLUSH, "string" == typeof e ? u.input = p.binstring2buf(e) : "[object ArrayBuffer]" === _.call(e) ? u.input = new Uint8Array(e) : u.input = e, u.next_in = 0, u.avail_in = u.input.length;do {if (0 === u.avail_out && (u.output = new c.Buf8(h), u.next_out = 0, u.avail_out = h), (r = d.inflate(u, m.Z_NO_FLUSH)) === m.Z_NEED_DICT && f && (o = "string" == typeof f ? p.string2buf(f) : "[object ArrayBuffer]" === _.call(f) ? new Uint8Array(f) : f, r = d.inflateSetDictionary(this.strm, o)), r === m.Z_BUF_ERROR && !0 === l && (r = m.Z_OK, l = !1), r !== m.Z_STREAM_END && r !== m.Z_OK) return this.onEnd(r), !(this.ended = !0);u.next_out && (0 !== u.avail_out && r !== m.Z_STREAM_END && (0 !== u.avail_in || n !== m.Z_FINISH && n !== m.Z_SYNC_FLUSH) || ("string" === this.options.to ? (i = p.utf8border(u.output, u.next_out), s = u.next_out - i, a = p.buf2string(u.output, i), u.next_out = s, u.avail_out = h - s, s && c.arraySet(u.output, u.output, i, s, 0), this.onData(a)) : this.onData(c.shrinkBuf(u.output, u.next_out)))), 0 === u.avail_in && 0 === u.avail_out && (l = !0);} while ((0 < u.avail_in || 0 === u.avail_out) && r !== m.Z_STREAM_END);return r === m.Z_STREAM_END && (n = m.Z_FINISH), n === m.Z_FINISH ? (r = d.inflateEnd(this.strm), this.onEnd(r), this.ended = !0, r === m.Z_OK) : n !== m.Z_SYNC_FLUSH || (this.onEnd(m.Z_OK), !(u.avail_out = 0));}, a.prototype.onData = function (e) {this.chunks.push(e);}, a.prototype.onEnd = function (e) {e === m.Z_OK && ("string" === this.options.to ? this.result = this.chunks.join("") : this.result = c.flattenChunks(this.chunks)), this.chunks = [], this.err = e, this.msg = this.strm.msg;}, r.Inflate = a, r.inflate = o, r.inflateRaw = function (e, t) {return (t = t || {}).raw = !0, o(e, t);}, r.ungzip = o;}, { "./utils/common": 41, "./utils/strings": 42, "./zlib/constants": 44, "./zlib/gzheader": 47, "./zlib/inflate": 49, "./zlib/messages": 51, "./zlib/zstream": 53 }], 41: [function (e, t, r) {"use strict";var n = "undefined" != typeof Uint8Array && "undefined" != typeof Uint16Array && "undefined" != typeof Int32Array;r.assign = function (e) {for (var t = Array.prototype.slice.call(arguments, 1); t.length;) {var r = t.shift();if (r) {if ("object" != typeof r) throw new TypeError(r + "must be non-object");for (var n in r) r.hasOwnProperty(n) && (e[n] = r[n]);}}return e;}, r.shrinkBuf = function (e, t) {return e.length === t ? e : e.subarray ? e.subarray(0, t) : (e.length = t, e);};var i = { arraySet: function arraySet(e, t, r, n, i) {if (t.subarray && e.subarray) e.set(t.subarray(r, r + n), i);else for (var s = 0; s < n; s++) e[i + s] = t[r + s];}, flattenChunks: function flattenChunks(e) {var t, r, n, i, s, a;for (t = n = 0, r = e.length; t < r; t++) n += e[t].length;for (a = new Uint8Array(n), t = i = 0, r = e.length; t < r; t++) s = e[t], a.set(s, i), i += s.length;return a;} },s = { arraySet: function arraySet(e, t, r, n, i) {for (var s = 0; s < n; s++) e[i + s] = t[r + s];}, flattenChunks: function flattenChunks(e) {return [].concat.apply([], e);} };r.setTyped = function (e) {e ? (r.Buf8 = Uint8Array, r.Buf16 = Uint16Array, r.Buf32 = Int32Array, r.assign(r, i)) : (r.Buf8 = Array, r.Buf16 = Array, r.Buf32 = Array, r.assign(r, s));}, r.setTyped(n);}, {}], 42: [function (e, t, r) {"use strict";var u = e("./common"),i = !0,s = !0;try {String.fromCharCode.apply(null, [0]);} catch (e) {i = !1;}try {String.fromCharCode.apply(null, new Uint8Array(1));} catch (e) {s = !1;}for (var h = new u.Buf8(256), n = 0; n < 256; n++) h[n] = 252 <= n ? 6 : 248 <= n ? 5 : 240 <= n ? 4 : 224 <= n ? 3 : 192 <= n ? 2 : 1;function f(e, t) {if (t < 65537 && (e.subarray && s || !e.subarray && i)) return String.fromCharCode.apply(null, u.shrinkBuf(e, t));for (var r = "", n = 0; n < t; n++) r += String.fromCharCode(e[n]);return r;}h[254] = h[254] = 1, r.string2buf = function (e) {var t,r,n,i,s,a = e.length,o = 0;for (i = 0; i < a; i++) 55296 == (64512 & (r = e.charCodeAt(i))) && i + 1 < a && 56320 == (64512 & (n = e.charCodeAt(i + 1))) && (r = 65536 + (r - 55296 << 10) + (n - 56320), i++), o += r < 128 ? 1 : r < 2048 ? 2 : r < 65536 ? 3 : 4;for (t = new u.Buf8(o), i = s = 0; s < o; i++) 55296 == (64512 & (r = e.charCodeAt(i))) && i + 1 < a && 56320 == (64512 & (n = e.charCodeAt(i + 1))) && (r = 65536 + (r - 55296 << 10) + (n - 56320), i++), r < 128 ? t[s++] = r : (r < 2048 ? t[s++] = 192 | r >>> 6 : (r < 65536 ? t[s++] = 224 | r >>> 12 : (t[s++] = 240 | r >>> 18, t[s++] = 128 | r >>> 12 & 63), t[s++] = 128 | r >>> 6 & 63), t[s++] = 128 | 63 & r);return t;}, r.buf2binstring = function (e) {return f(e, e.length);}, r.binstring2buf = function (e) {for (var t = new u.Buf8(e.length), r = 0, n = t.length; r < n; r++) t[r] = e.charCodeAt(r);return t;}, r.buf2string = function (e, t) {var r,n,i,s,a = t || e.length,o = new Array(2 * a);for (r = n = 0; r < a;) if ((i = e[r++]) < 128) o[n++] = i;else if (4 < (s = h[i])) o[n++] = 65533, r += s - 1;else {for (i &= 2 === s ? 31 : 3 === s ? 15 : 7; 1 < s && r < a;) i = i << 6 | 63 & e[r++], s--;1 < s ? o[n++] = 65533 : i < 65536 ? o[n++] = i : (i -= 65536, o[n++] = 55296 | i >> 10 & 1023, o[n++] = 56320 | 1023 & i);}return f(o, n);}, r.utf8border = function (e, t) {var r;for ((t = t || e.length) > e.length && (t = e.length), r = t - 1; 0 <= r && 128 == (192 & e[r]);) r--;return r < 0 ? t : 0 === r ? t : r + h[e[r]] > t ? r : t;};}, { "./common": 41 }], 43: [function (e, t, r) {"use strict";t.exports = function (e, t, r, n) {for (var i = 65535 & e | 0, s = e >>> 16 & 65535 | 0, a = 0; 0 !== r;) {for (r -= a = 2e3 < r ? 2e3 : r; s = s + (i = i + t[n++] | 0) | 0, --a;);i %= 65521, s %= 65521;}return i | s << 16 | 0;};}, {}], 44: [function (e, t, r) {"use strict";t.exports = { Z_NO_FLUSH: 0, Z_PARTIAL_FLUSH: 1, Z_SYNC_FLUSH: 2, Z_FULL_FLUSH: 3, Z_FINISH: 4, Z_BLOCK: 5, Z_TREES: 6, Z_OK: 0, Z_STREAM_END: 1, Z_NEED_DICT: 2, Z_ERRNO: -1, Z_STREAM_ERROR: -2, Z_DATA_ERROR: -3, Z_BUF_ERROR: -5, Z_NO_COMPRESSION: 0, Z_BEST_SPEED: 1, Z_BEST_COMPRESSION: 9, Z_DEFAULT_COMPRESSION: -1, Z_FILTERED: 1, Z_HUFFMAN_ONLY: 2, Z_RLE: 3, Z_FIXED: 4, Z_DEFAULT_STRATEGY: 0, Z_BINARY: 0, Z_TEXT: 1, Z_UNKNOWN: 2, Z_DEFLATED: 8 };}, {}], 45: [function (e, t, r) {"use strict";var o = function () {for (var e, t = [], r = 0; r < 256; r++) {e = r;for (var n = 0; n < 8; n++) e = 1 & e ? 3988292384 ^ e >>> 1 : e >>> 1;t[r] = e;}return t;}();t.exports = function (e, t, r, n) {var i = o,s = n + r;e ^= -1;for (var a = n; a < s; a++) e = e >>> 8 ^ i[255 & (e ^ t[a])];return -1 ^ e;};}, {}], 46: [function (e, t, r) {"use strict";var u,d = e("../utils/common"),h = e("./trees"),c = e("./adler32"),p = e("./crc32"),n = e("./messages"),f = 0,l = 0,m = -2,i = 2,_ = 8,s = 286,a = 30,o = 19,g = 2 * s + 1,v = 15,b = 3,w = 258,y = w + b + 1,k = 42,x = 113;function S(e, t) {return e.msg = n[t], t;}function z(e) {return (e << 1) - (4 < e ? 9 : 0);}function E(e) {for (var t = e.length; 0 <= --t;) e[t] = 0;}function C(e) {var t = e.state,r = t.pending;r > e.avail_out && (r = e.avail_out), 0 !== r && (d.arraySet(e.output, t.pending_buf, t.pending_out, r, e.next_out), e.next_out += r, t.pending_out += r, e.total_out += r, e.avail_out -= r, t.pending -= r, 0 === t.pending && (t.pending_out = 0));}function A(e, t) {h._tr_flush_block(e, 0 <= e.block_start ? e.block_start : -1, e.strstart - e.block_start, t), e.block_start = e.strstart, C(e.strm);}function I(e, t) {e.pending_buf[e.pending++] = t;}function O(e, t) {e.pending_buf[e.pending++] = t >>> 8 & 255, e.pending_buf[e.pending++] = 255 & t;}function B(e, t) {var r,n,i = e.max_chain_length,s = e.strstart,a = e.prev_length,o = e.nice_match,u = e.strstart > e.w_size - y ? e.strstart - (e.w_size - y) : 0,h = e.window,f = e.w_mask,l = e.prev,d = e.strstart + w,c = h[s + a - 1],p = h[s + a];e.prev_length >= e.good_match && (i >>= 2), o > e.lookahead && (o = e.lookahead);do {if (h[(r = t) + a] === p && h[r + a - 1] === c && h[r] === h[s] && h[++r] === h[s + 1]) {s += 2, r++;do {} while (h[++s] === h[++r] && h[++s] === h[++r] && h[++s] === h[++r] && h[++s] === h[++r] && h[++s] === h[++r] && h[++s] === h[++r] && h[++s] === h[++r] && h[++s] === h[++r] && s < d);if (n = w - (d - s), s = d - w, a < n) {if (e.match_start = t, o <= (a = n)) break;c = h[s + a - 1], p = h[s + a];}}} while ((t = l[t & f]) > u && 0 != --i);return a <= e.lookahead ? a : e.lookahead;}function T(e) {var t,r,n,i,s,a,o,u,h,f,l = e.w_size;do {if (i = e.window_size - e.lookahead - e.strstart, e.strstart >= l + (l - y)) {for (d.arraySet(e.window, e.window, l, l, 0), e.match_start -= l, e.strstart -= l, e.block_start -= l, t = r = e.hash_size; n = e.head[--t], e.head[t] = l <= n ? n - l : 0, --r;);for (t = r = l; n = e.prev[--t], e.prev[t] = l <= n ? n - l : 0, --r;);i += l;}if (0 === e.strm.avail_in) break;if (a = e.strm, o = e.window, u = e.strstart + e.lookahead, f = void 0, (h = i) < (f = a.avail_in) && (f = h), r = 0 === f ? 0 : (a.avail_in -= f, d.arraySet(o, a.input, a.next_in, f, u), 1 === a.state.wrap ? a.adler = c(a.adler, o, f, u) : 2 === a.state.wrap && (a.adler = p(a.adler, o, f, u)), a.next_in += f, a.total_in += f, f), e.lookahead += r, e.lookahead + e.insert >= b) for (s = e.strstart - e.insert, e.ins_h = e.window[s], e.ins_h = (e.ins_h << e.hash_shift ^ e.window[s + 1]) & e.hash_mask; e.insert && (e.ins_h = (e.ins_h << e.hash_shift ^ e.window[s + b - 1]) & e.hash_mask, e.prev[s & e.w_mask] = e.head[e.ins_h], e.head[e.ins_h] = s, s++, e.insert--, !(e.lookahead + e.insert < b)););} while (e.lookahead < y && 0 !== e.strm.avail_in);}function R(e, t) {for (var r, n;;) {if (e.lookahead < y) {if (T(e), e.lookahead < y && t === f) return 1;if (0 === e.lookahead) break;}if (r = 0, e.lookahead >= b && (e.ins_h = (e.ins_h << e.hash_shift ^ e.window[e.strstart + b - 1]) & e.hash_mask, r = e.prev[e.strstart & e.w_mask] = e.head[e.ins_h], e.head[e.ins_h] = e.strstart), 0 !== r && e.strstart - r <= e.w_size - y && (e.match_length = B(e, r)), e.match_length >= b) {if (n = h._tr_tally(e, e.strstart - e.match_start, e.match_length - b), e.lookahead -= e.match_length, e.match_length <= e.max_lazy_match && e.lookahead >= b) {for (e.match_length--; e.strstart++, e.ins_h = (e.ins_h << e.hash_shift ^ e.window[e.strstart + b - 1]) & e.hash_mask, r = e.prev[e.strstart & e.w_mask] = e.head[e.ins_h], e.head[e.ins_h] = e.strstart, 0 != --e.match_length;);e.strstart++;} else e.strstart += e.match_length, e.match_length = 0, e.ins_h = e.window[e.strstart], e.ins_h = (e.ins_h << e.hash_shift ^ e.window[e.strstart + 1]) & e.hash_mask;} else n = h._tr_tally(e, 0, e.window[e.strstart]), e.lookahead--, e.strstart++;if (n && (A(e, !1), 0 === e.strm.avail_out)) return 1;}return e.insert = e.strstart < b - 1 ? e.strstart : b - 1, 4 === t ? (A(e, !0), 0 === e.strm.avail_out ? 3 : 4) : e.last_lit && (A(e, !1), 0 === e.strm.avail_out) ? 1 : 2;}function D(e, t) {for (var r, n, i;;) {if (e.lookahead < y) {if (T(e), e.lookahead < y && t === f) return 1;if (0 === e.lookahead) break;}if (r = 0, e.lookahead >= b && (e.ins_h = (e.ins_h << e.hash_shift ^ e.window[e.strstart + b - 1]) & e.hash_mask, r = e.prev[e.strstart & e.w_mask] = e.head[e.ins_h], e.head[e.ins_h] = e.strstart), e.prev_length = e.match_length, e.prev_match = e.match_start, e.match_length = b - 1, 0 !== r && e.prev_length < e.max_lazy_match && e.strstart - r <= e.w_size - y && (e.match_length = B(e, r), e.match_length <= 5 && (1 === e.strategy || e.match_length === b && 4096 < e.strstart - e.match_start) && (e.match_length = b - 1)), e.prev_length >= b && e.match_length <= e.prev_length) {for (i = e.strstart + e.lookahead - b, n = h._tr_tally(e, e.strstart - 1 - e.prev_match, e.prev_length - b), e.lookahead -= e.prev_length - 1, e.prev_length -= 2; ++e.strstart <= i && (e.ins_h = (e.ins_h << e.hash_shift ^ e.window[e.strstart + b - 1]) & e.hash_mask, r = e.prev[e.strstart & e.w_mask] = e.head[e.ins_h], e.head[e.ins_h] = e.strstart), 0 != --e.prev_length;);if (e.match_available = 0, e.match_length = b - 1, e.strstart++, n && (A(e, !1), 0 === e.strm.avail_out)) return 1;} else if (e.match_available) {if ((n = h._tr_tally(e, 0, e.window[e.strstart - 1])) && A(e, !1), e.strstart++, e.lookahead--, 0 === e.strm.avail_out) return 1;} else e.match_available = 1, e.strstart++, e.lookahead--;}return e.match_available && (n = h._tr_tally(e, 0, e.window[e.strstart - 1]), e.match_available = 0), e.insert = e.strstart < b - 1 ? e.strstart : b - 1, 4 === t ? (A(e, !0), 0 === e.strm.avail_out ? 3 : 4) : e.last_lit && (A(e, !1), 0 === e.strm.avail_out) ? 1 : 2;}function F(e, t, r, n, i) {this.good_length = e, this.max_lazy = t, this.nice_length = r, this.max_chain = n, this.func = i;}function N() {this.strm = null, this.status = 0, this.pending_buf = null, this.pending_buf_size = 0, this.pending_out = 0, this.pending = 0, this.wrap = 0, this.gzhead = null, this.gzindex = 0, this.method = _, this.last_flush = -1, this.w_size = 0, this.w_bits = 0, this.w_mask = 0, this.window = null, this.window_size = 0, this.prev = null, this.head = null, this.ins_h = 0, this.hash_size = 0, this.hash_bits = 0, this.hash_mask = 0, this.hash_shift = 0, this.block_start = 0, this.match_length = 0, this.prev_match = 0, this.match_available = 0, this.strstart = 0, this.match_start = 0, this.lookahead = 0, this.prev_length = 0, this.max_chain_length = 0, this.max_lazy_match = 0, this.level = 0, this.strategy = 0, this.good_match = 0, this.nice_match = 0, this.dyn_ltree = new d.Buf16(2 * g), this.dyn_dtree = new d.Buf16(2 * (2 * a + 1)), this.bl_tree = new d.Buf16(2 * (2 * o + 1)), E(this.dyn_ltree), E(this.dyn_dtree), E(this.bl_tree), this.l_desc = null, this.d_desc = null, this.bl_desc = null, this.bl_count = new d.Buf16(v + 1), this.heap = new d.Buf16(2 * s + 1), E(this.heap), this.heap_len = 0, this.heap_max = 0, this.depth = new d.Buf16(2 * s + 1), E(this.depth), this.l_buf = 0, this.lit_bufsize = 0, this.last_lit = 0, this.d_buf = 0, this.opt_len = 0, this.static_len = 0, this.matches = 0, this.insert = 0, this.bi_buf = 0, this.bi_valid = 0;}function U(e) {var t;return e && e.state ? (e.total_in = e.total_out = 0, e.data_type = i, (t = e.state).pending = 0, t.pending_out = 0, t.wrap < 0 && (t.wrap = -t.wrap), t.status = t.wrap ? k : x, e.adler = 2 === t.wrap ? 0 : 1, t.last_flush = f, h._tr_init(t), l) : S(e, m);}function P(e) {var t,r = U(e);return r === l && ((t = e.state).window_size = 2 * t.w_size, E(t.head), t.max_lazy_match = u[t.level].max_lazy, t.good_match = u[t.level].good_length, t.nice_match = u[t.level].nice_length, t.max_chain_length = u[t.level].max_chain, t.strstart = 0, t.block_start = 0, t.lookahead = 0, t.insert = 0, t.match_length = t.prev_length = b - 1, t.match_available = 0, t.ins_h = 0), r;}function L(e, t, r, n, i, s) {if (!e) return m;var a = 1;if (-1 === t && (t = 6), n < 0 ? (a = 0, n = -n) : 15 < n && (a = 2, n -= 16), i < 1 || 9 < i || r !== _ || n < 8 || 15 < n || t < 0 || 9 < t || s < 0 || 4 < s) return S(e, m);8 === n && (n = 9);var o = new N();return (e.state = o).strm = e, o.wrap = a, o.gzhead = null, o.w_bits = n, o.w_size = 1 << o.w_bits, o.w_mask = o.w_size - 1, o.hash_bits = i + 7, o.hash_size = 1 << o.hash_bits, o.hash_mask = o.hash_size - 1, o.hash_shift = ~~((o.hash_bits + b - 1) / b), o.window = new d.Buf8(2 * o.w_size), o.head = new d.Buf16(o.hash_size), o.prev = new d.Buf16(o.w_size), o.lit_bufsize = 1 << i + 6, o.pending_buf_size = 4 * o.lit_bufsize, o.pending_buf = new d.Buf8(o.pending_buf_size), o.d_buf = 1 * o.lit_bufsize, o.l_buf = 3 * o.lit_bufsize, o.level = t, o.strategy = s, o.method = r, P(e);}u = [new F(0, 0, 0, 0, function (e, t) {var r = 65535;for (r > e.pending_buf_size - 5 && (r = e.pending_buf_size - 5);;) {if (e.lookahead <= 1) {if (T(e), 0 === e.lookahead && t === f) return 1;if (0 === e.lookahead) break;}e.strstart += e.lookahead, e.lookahead = 0;var n = e.block_start + r;if ((0 === e.strstart || e.strstart >= n) && (e.lookahead = e.strstart - n, e.strstart = n, A(e, !1), 0 === e.strm.avail_out)) return 1;if (e.strstart - e.block_start >= e.w_size - y && (A(e, !1), 0 === e.strm.avail_out)) return 1;}return e.insert = 0, 4 === t ? (A(e, !0), 0 === e.strm.avail_out ? 3 : 4) : (e.strstart > e.block_start && (A(e, !1), e.strm.avail_out), 1);}), new F(4, 4, 8, 4, R), new F(4, 5, 16, 8, R), new F(4, 6, 32, 32, R), new F(4, 4, 16, 16, D), new F(8, 16, 32, 32, D), new F(8, 16, 128, 128, D), new F(8, 32, 128, 256, D), new F(32, 128, 258, 1024, D), new F(32, 258, 258, 4096, D)], r.deflateInit = function (e, t) {return L(e, t, _, 15, 8, 0);}, r.deflateInit2 = L, r.deflateReset = P, r.deflateResetKeep = U, r.deflateSetHeader = function (e, t) {return e && e.state ? 2 !== e.state.wrap ? m : (e.state.gzhead = t, l) : m;}, r.deflate = function (e, t) {var r, n, i, s;if (!e || !e.state || 5 < t || t < 0) return e ? S(e, m) : m;if (n = e.state, !e.output || !e.input && 0 !== e.avail_in || 666 === n.status && 4 !== t) return S(e, 0 === e.avail_out ? -5 : m);if (n.strm = e, r = n.last_flush, n.last_flush = t, n.status === k) if (2 === n.wrap) e.adler = 0, I(n, 31), I(n, 139), I(n, 8), n.gzhead ? (I(n, (n.gzhead.text ? 1 : 0) + (n.gzhead.hcrc ? 2 : 0) + (n.gzhead.extra ? 4 : 0) + (n.gzhead.name ? 8 : 0) + (n.gzhead.comment ? 16 : 0)), I(n, 255 & n.gzhead.time), I(n, n.gzhead.time >> 8 & 255), I(n, n.gzhead.time >> 16 & 255), I(n, n.gzhead.time >> 24 & 255), I(n, 9 === n.level ? 2 : 2 <= n.strategy || n.level < 2 ? 4 : 0), I(n, 255 & n.gzhead.os), n.gzhead.extra && n.gzhead.extra.length && (I(n, 255 & n.gzhead.extra.length), I(n, n.gzhead.extra.length >> 8 & 255)), n.gzhead.hcrc && (e.adler = p(e.adler, n.pending_buf, n.pending, 0)), n.gzindex = 0, n.status = 69) : (I(n, 0), I(n, 0), I(n, 0), I(n, 0), I(n, 0), I(n, 9 === n.level ? 2 : 2 <= n.strategy || n.level < 2 ? 4 : 0), I(n, 3), n.status = x);else {var a = _ + (n.w_bits - 8 << 4) << 8;a |= (2 <= n.strategy || n.level < 2 ? 0 : n.level < 6 ? 1 : 6 === n.level ? 2 : 3) << 6, 0 !== n.strstart && (a |= 32), a += 31 - a % 31, n.status = x, O(n, a), 0 !== n.strstart && (O(n, e.adler >>> 16), O(n, 65535 & e.adler)), e.adler = 1;}if (69 === n.status) if (n.gzhead.extra) {for (i = n.pending; n.gzindex < (65535 & n.gzhead.extra.length) && (n.pending !== n.pending_buf_size || (n.gzhead.hcrc && n.pending > i && (e.adler = p(e.adler, n.pending_buf, n.pending - i, i)), C(e), i = n.pending, n.pending !== n.pending_buf_size));) I(n, 255 & n.gzhead.extra[n.gzindex]), n.gzindex++;n.gzhead.hcrc && n.pending > i && (e.adler = p(e.adler, n.pending_buf, n.pending - i, i)), n.gzindex === n.gzhead.extra.length && (n.gzindex = 0, n.status = 73);} else n.status = 73;if (73 === n.status) if (n.gzhead.name) {i = n.pending;do {if (n.pending === n.pending_buf_size && (n.gzhead.hcrc && n.pending > i && (e.adler = p(e.adler, n.pending_buf, n.pending - i, i)), C(e), i = n.pending, n.pending === n.pending_buf_size)) {s = 1;break;}s = n.gzindex < n.gzhead.name.length ? 255 & n.gzhead.name.charCodeAt(n.gzindex++) : 0, I(n, s);} while (0 !== s);n.gzhead.hcrc && n.pending > i && (e.adler = p(e.adler, n.pending_buf, n.pending - i, i)), 0 === s && (n.gzindex = 0, n.status = 91);} else n.status = 91;if (91 === n.status) if (n.gzhead.comment) {i = n.pending;do {if (n.pending === n.pending_buf_size && (n.gzhead.hcrc && n.pending > i && (e.adler = p(e.adler, n.pending_buf, n.pending - i, i)), C(e), i = n.pending, n.pending === n.pending_buf_size)) {s = 1;break;}s = n.gzindex < n.gzhead.comment.length ? 255 & n.gzhead.comment.charCodeAt(n.gzindex++) : 0, I(n, s);} while (0 !== s);n.gzhead.hcrc && n.pending > i && (e.adler = p(e.adler, n.pending_buf, n.pending - i, i)), 0 === s && (n.status = 103);} else n.status = 103;if (103 === n.status && (n.gzhead.hcrc ? (n.pending + 2 > n.pending_buf_size && C(e), n.pending + 2 <= n.pending_buf_size && (I(n, 255 & e.adler), I(n, e.adler >> 8 & 255), e.adler = 0, n.status = x)) : n.status = x), 0 !== n.pending) {if (C(e), 0 === e.avail_out) return n.last_flush = -1, l;} else if (0 === e.avail_in && z(t) <= z(r) && 4 !== t) return S(e, -5);if (666 === n.status && 0 !== e.avail_in) return S(e, -5);if (0 !== e.avail_in || 0 !== n.lookahead || t !== f && 666 !== n.status) {var o = 2 === n.strategy ? function (e, t) {for (var r;;) {if (0 === e.lookahead && (T(e), 0 === e.lookahead)) {if (t === f) return 1;break;}if (e.match_length = 0, r = h._tr_tally(e, 0, e.window[e.strstart]), e.lookahead--, e.strstart++, r && (A(e, !1), 0 === e.strm.avail_out)) return 1;}return e.insert = 0, 4 === t ? (A(e, !0), 0 === e.strm.avail_out ? 3 : 4) : e.last_lit && (A(e, !1), 0 === e.strm.avail_out) ? 1 : 2;}(n, t) : 3 === n.strategy ? function (e, t) {for (var r, n, i, s, a = e.window;;) {if (e.lookahead <= w) {if (T(e), e.lookahead <= w && t === f) return 1;if (0 === e.lookahead) break;}if (e.match_length = 0, e.lookahead >= b && 0 < e.strstart && (n = a[i = e.strstart - 1]) === a[++i] && n === a[++i] && n === a[++i]) {s = e.strstart + w;do {} while (n === a[++i] && n === a[++i] && n === a[++i] && n === a[++i] && n === a[++i] && n === a[++i] && n === a[++i] && n === a[++i] && i < s);e.match_length = w - (s - i), e.match_length > e.lookahead && (e.match_length = e.lookahead);}if (e.match_length >= b ? (r = h._tr_tally(e, 1, e.match_length - b), e.lookahead -= e.match_length, e.strstart += e.match_length, e.match_length = 0) : (r = h._tr_tally(e, 0, e.window[e.strstart]), e.lookahead--, e.strstart++), r && (A(e, !1), 0 === e.strm.avail_out)) return 1;}return e.insert = 0, 4 === t ? (A(e, !0), 0 === e.strm.avail_out ? 3 : 4) : e.last_lit && (A(e, !1), 0 === e.strm.avail_out) ? 1 : 2;}(n, t) : u[n.level].func(n, t);if (3 !== o && 4 !== o || (n.status = 666), 1 === o || 3 === o) return 0 === e.avail_out && (n.last_flush = -1), l;if (2 === o && (1 === t ? h._tr_align(n) : 5 !== t && (h._tr_stored_block(n, 0, 0, !1), 3 === t && (E(n.head), 0 === n.lookahead && (n.strstart = 0, n.block_start = 0, n.insert = 0))), C(e), 0 === e.avail_out)) return n.last_flush = -1, l;}return 4 !== t ? l : n.wrap <= 0 ? 1 : (2 === n.wrap ? (I(n, 255 & e.adler), I(n, e.adler >> 8 & 255), I(n, e.adler >> 16 & 255), I(n, e.adler >> 24 & 255), I(n, 255 & e.total_in), I(n, e.total_in >> 8 & 255), I(n, e.total_in >> 16 & 255), I(n, e.total_in >> 24 & 255)) : (O(n, e.adler >>> 16), O(n, 65535 & e.adler)), C(e), 0 < n.wrap && (n.wrap = -n.wrap), 0 !== n.pending ? l : 1);}, r.deflateEnd = function (e) {var t;return e && e.state ? (t = e.state.status) !== k && 69 !== t && 73 !== t && 91 !== t && 103 !== t && t !== x && 666 !== t ? S(e, m) : (e.state = null, t === x ? S(e, -3) : l) : m;}, r.deflateSetDictionary = function (e, t) {var r,n,i,s,a,o,u,h,f = t.length;if (!e || !e.state) return m;if (2 === (s = (r = e.state).wrap) || 1 === s && r.status !== k || r.lookahead) return m;for (1 === s && (e.adler = c(e.adler, t, f, 0)), r.wrap = 0, f >= r.w_size && (0 === s && (E(r.head), r.strstart = 0, r.block_start = 0, r.insert = 0), h = new d.Buf8(r.w_size), d.arraySet(h, t, f - r.w_size, r.w_size, 0), t = h, f = r.w_size), a = e.avail_in, o = e.next_in, u = e.input, e.avail_in = f, e.next_in = 0, e.input = t, T(r); r.lookahead >= b;) {for (n = r.strstart, i = r.lookahead - (b - 1); r.ins_h = (r.ins_h << r.hash_shift ^ r.window[n + b - 1]) & r.hash_mask, r.prev[n & r.w_mask] = r.head[r.ins_h], r.head[r.ins_h] = n, n++, --i;);r.strstart = n, r.lookahead = b - 1, T(r);}return r.strstart += r.lookahead, r.block_start = r.strstart, r.insert = r.lookahead, r.lookahead = 0, r.match_length = r.prev_length = b - 1, r.match_available = 0, e.next_in = o, e.input = u, e.avail_in = a, r.wrap = s, l;}, r.deflateInfo = "pako deflate (from Nodeca project)";}, { "../utils/common": 41, "./adler32": 43, "./crc32": 45, "./messages": 51, "./trees": 52 }], 47: [function (e, t, r) {"use strict";t.exports = function () {this.text = 0, this.time = 0, this.xflags = 0, this.os = 0, this.extra = null, this.extra_len = 0, this.name = "", this.comment = "", this.hcrc = 0, this.done = !1;};}, {}], 48: [function (e, t, r) {"use strict";t.exports = function (e, t) {var r, n, i, s, a, o, u, h, f, l, d, c, p, m, _, g, v, b, w, y, k, x, S, z, E;r = e.state, n = e.next_in, z = e.input, i = n + (e.avail_in - 5), s = e.next_out, E = e.output, a = s - (t - e.avail_out), o = s + (e.avail_out - 257), u = r.dmax, h = r.wsize, f = r.whave, l = r.wnext, d = r.window, c = r.hold, p = r.bits, m = r.lencode, _ = r.distcode, g = (1 << r.lenbits) - 1, v = (1 << r.distbits) - 1;e: do {p < 15 && (c += z[n++] << p, p += 8, c += z[n++] << p, p += 8), b = m[c & g];t: for (;;) {if (c >>>= w = b >>> 24, p -= w, 0 == (w = b >>> 16 & 255)) E[s++] = 65535 & b;else {if (!(16 & w)) {if (0 == (64 & w)) {b = m[(65535 & b) + (c & (1 << w) - 1)];continue t;}if (32 & w) {r.mode = 12;break e;}e.msg = "invalid literal/length code", r.mode = 30;break e;}y = 65535 & b, (w &= 15) && (p < w && (c += z[n++] << p, p += 8), y += c & (1 << w) - 1, c >>>= w, p -= w), p < 15 && (c += z[n++] << p, p += 8, c += z[n++] << p, p += 8), b = _[c & v];r: for (;;) {if (c >>>= w = b >>> 24, p -= w, !(16 & (w = b >>> 16 & 255))) {if (0 == (64 & w)) {b = _[(65535 & b) + (c & (1 << w) - 1)];continue r;}e.msg = "invalid distance code", r.mode = 30;break e;}if (k = 65535 & b, p < (w &= 15) && (c += z[n++] << p, (p += 8) < w && (c += z[n++] << p, p += 8)), u < (k += c & (1 << w) - 1)) {e.msg = "invalid distance too far back", r.mode = 30;break e;}if (c >>>= w, p -= w, (w = s - a) < k) {if (f < (w = k - w) && r.sane) {e.msg = "invalid distance too far back", r.mode = 30;break e;}if (S = d, (x = 0) === l) {if (x += h - w, w < y) {for (y -= w; E[s++] = d[x++], --w;);x = s - k, S = E;}} else if (l < w) {if (x += h + l - w, (w -= l) < y) {for (y -= w; E[s++] = d[x++], --w;);if (x = 0, l < y) {for (y -= w = l; E[s++] = d[x++], --w;);x = s - k, S = E;}}} else if (x += l - w, w < y) {for (y -= w; E[s++] = d[x++], --w;);x = s - k, S = E;}for (; 2 < y;) E[s++] = S[x++], E[s++] = S[x++], E[s++] = S[x++], y -= 3;y && (E[s++] = S[x++], 1 < y && (E[s++] = S[x++]));} else {for (x = s - k; E[s++] = E[x++], E[s++] = E[x++], E[s++] = E[x++], 2 < (y -= 3););y && (E[s++] = E[x++], 1 < y && (E[s++] = E[x++]));}break;}}break;}} while (n < i && s < o);n -= y = p >> 3, c &= (1 << (p -= y << 3)) - 1, e.next_in = n, e.next_out = s, e.avail_in = n < i ? i - n + 5 : 5 - (n - i), e.avail_out = s < o ? o - s + 257 : 257 - (s - o), r.hold = c, r.bits = p;};}, {}], 49: [function (e, t, r) {"use strict";var I = e("../utils/common"),O = e("./adler32"),B = e("./crc32"),T = e("./inffast"),R = e("./inftrees"),D = 1,F = 2,N = 0,U = -2,P = 1,n = 852,i = 592;function L(e) {return (e >>> 24 & 255) + (e >>> 8 & 65280) + ((65280 & e) << 8) + ((255 & e) << 24);}function s() {this.mode = 0, this.last = !1, this.wrap = 0, this.havedict = !1, this.flags = 0, this.dmax = 0, this.check = 0, this.total = 0, this.head = null, this.wbits = 0, this.wsize = 0, this.whave = 0, this.wnext = 0, this.window = null, this.hold = 0, this.bits = 0, this.length = 0, this.offset = 0, this.extra = 0, this.lencode = null, this.distcode = null, this.lenbits = 0, this.distbits = 0, this.ncode = 0, this.nlen = 0, this.ndist = 0, this.have = 0, this.next = null, this.lens = new I.Buf16(320), this.work = new I.Buf16(288), this.lendyn = null, this.distdyn = null, this.sane = 0, this.back = 0, this.was = 0;}function a(e) {var t;return e && e.state ? (t = e.state, e.total_in = e.total_out = t.total = 0, e.msg = "", t.wrap && (e.adler = 1 & t.wrap), t.mode = P, t.last = 0, t.havedict = 0, t.dmax = 32768, t.head = null, t.hold = 0, t.bits = 0, t.lencode = t.lendyn = new I.Buf32(n), t.distcode = t.distdyn = new I.Buf32(i), t.sane = 1, t.back = -1, N) : U;}function o(e) {var t;return e && e.state ? ((t = e.state).wsize = 0, t.whave = 0, t.wnext = 0, a(e)) : U;}function u(e, t) {var r, n;return e && e.state ? (n = e.state, t < 0 ? (r = 0, t = -t) : (r = 1 + (t >> 4), t < 48 && (t &= 15)), t && (t < 8 || 15 < t) ? U : (null !== n.window && n.wbits !== t && (n.window = null), n.wrap = r, n.wbits = t, o(e))) : U;}function h(e, t) {var r, n;return e ? (n = new s(), (e.state = n).window = null, (r = u(e, t)) !== N && (e.state = null), r) : U;}var f,l,d = !0;function j(e) {if (d) {var t;for (f = new I.Buf32(512), l = new I.Buf32(32), t = 0; t < 144;) e.lens[t++] = 8;for (; t < 256;) e.lens[t++] = 9;for (; t < 280;) e.lens[t++] = 7;for (; t < 288;) e.lens[t++] = 8;for (R(D, e.lens, 0, 288, f, 0, e.work, { bits: 9 }), t = 0; t < 32;) e.lens[t++] = 5;R(F, e.lens, 0, 32, l, 0, e.work, { bits: 5 }), d = !1;}e.lencode = f, e.lenbits = 9, e.distcode = l, e.distbits = 5;}function Z(e, t, r, n) {var i,s = e.state;return null === s.window && (s.wsize = 1 << s.wbits, s.wnext = 0, s.whave = 0, s.window = new I.Buf8(s.wsize)), n >= s.wsize ? (I.arraySet(s.window, t, r - s.wsize, s.wsize, 0), s.wnext = 0, s.whave = s.wsize) : (n < (i = s.wsize - s.wnext) && (i = n), I.arraySet(s.window, t, r - n, i, s.wnext), (n -= i) ? (I.arraySet(s.window, t, r - n, n, 0), s.wnext = n, s.whave = s.wsize) : (s.wnext += i, s.wnext === s.wsize && (s.wnext = 0), s.whave < s.wsize && (s.whave += i))), 0;}r.inflateReset = o, r.inflateReset2 = u, r.inflateResetKeep = a, r.inflateInit = function (e) {return h(e, 15);}, r.inflateInit2 = h, r.inflate = function (e, t) {var r,n,i,s,a,o,u,h,f,l,d,c,p,m,_,g,v,b,w,y,k,x,S,z,E = 0,C = new I.Buf8(4),A = [16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15];if (!e || !e.state || !e.output || !e.input && 0 !== e.avail_in) return U;12 === (r = e.state).mode && (r.mode = 13), a = e.next_out, i = e.output, u = e.avail_out, s = e.next_in, n = e.input, o = e.avail_in, h = r.hold, f = r.bits, l = o, d = u, x = N;e: for (;;) switch (r.mode) {case P:if (0 === r.wrap) {r.mode = 13;break;}for (; f < 16;) {if (0 === o) break e;o--, h += n[s++] << f, f += 8;}if (2 & r.wrap && 35615 === h) {C[r.check = 0] = 255 & h, C[1] = h >>> 8 & 255, r.check = B(r.check, C, 2, 0), f = h = 0, r.mode = 2;break;}if (r.flags = 0, r.head && (r.head.done = !1), !(1 & r.wrap) || (((255 & h) << 8) + (h >> 8)) % 31) {e.msg = "incorrect header check", r.mode = 30;break;}if (8 != (15 & h)) {e.msg = "unknown compression method", r.mode = 30;break;}if (f -= 4, k = 8 + (15 & (h >>>= 4)), 0 === r.wbits) r.wbits = k;else if (k > r.wbits) {e.msg = "invalid window size", r.mode = 30;break;}r.dmax = 1 << k, e.adler = r.check = 1, r.mode = 512 & h ? 10 : 12, f = h = 0;break;case 2:for (; f < 16;) {if (0 === o) break e;o--, h += n[s++] << f, f += 8;}if (r.flags = h, 8 != (255 & r.flags)) {e.msg = "unknown compression method", r.mode = 30;break;}if (57344 & r.flags) {e.msg = "unknown header flags set", r.mode = 30;break;}r.head && (r.head.text = h >> 8 & 1), 512 & r.flags && (C[0] = 255 & h, C[1] = h >>> 8 & 255, r.check = B(r.check, C, 2, 0)), f = h = 0, r.mode = 3;case 3:for (; f < 32;) {if (0 === o) break e;o--, h += n[s++] << f, f += 8;}r.head && (r.head.time = h), 512 & r.flags && (C[0] = 255 & h, C[1] = h >>> 8 & 255, C[2] = h >>> 16 & 255, C[3] = h >>> 24 & 255, r.check = B(r.check, C, 4, 0)), f = h = 0, r.mode = 4;case 4:for (; f < 16;) {if (0 === o) break e;o--, h += n[s++] << f, f += 8;}r.head && (r.head.xflags = 255 & h, r.head.os = h >> 8), 512 & r.flags && (C[0] = 255 & h, C[1] = h >>> 8 & 255, r.check = B(r.check, C, 2, 0)), f = h = 0, r.mode = 5;case 5:if (1024 & r.flags) {for (; f < 16;) {if (0 === o) break e;o--, h += n[s++] << f, f += 8;}r.length = h, r.head && (r.head.extra_len = h), 512 & r.flags && (C[0] = 255 & h, C[1] = h >>> 8 & 255, r.check = B(r.check, C, 2, 0)), f = h = 0;} else r.head && (r.head.extra = null);r.mode = 6;case 6:if (1024 & r.flags && (o < (c = r.length) && (c = o), c && (r.head && (k = r.head.extra_len - r.length, r.head.extra || (r.head.extra = new Array(r.head.extra_len)), I.arraySet(r.head.extra, n, s, c, k)), 512 & r.flags && (r.check = B(r.check, n, c, s)), o -= c, s += c, r.length -= c), r.length)) break e;r.length = 0, r.mode = 7;case 7:if (2048 & r.flags) {if (0 === o) break e;for (c = 0; k = n[s + c++], r.head && k && r.length < 65536 && (r.head.name += String.fromCharCode(k)), k && c < o;);if (512 & r.flags && (r.check = B(r.check, n, c, s)), o -= c, s += c, k) break e;} else r.head && (r.head.name = null);r.length = 0, r.mode = 8;case 8:if (4096 & r.flags) {if (0 === o) break e;for (c = 0; k = n[s + c++], r.head && k && r.length < 65536 && (r.head.comment += String.fromCharCode(k)), k && c < o;);if (512 & r.flags && (r.check = B(r.check, n, c, s)), o -= c, s += c, k) break e;} else r.head && (r.head.comment = null);r.mode = 9;case 9:if (512 & r.flags) {for (; f < 16;) {if (0 === o) break e;o--, h += n[s++] << f, f += 8;}if (h !== (65535 & r.check)) {e.msg = "header crc mismatch", r.mode = 30;break;}f = h = 0;}r.head && (r.head.hcrc = r.flags >> 9 & 1, r.head.done = !0), e.adler = r.check = 0, r.mode = 12;break;case 10:for (; f < 32;) {if (0 === o) break e;o--, h += n[s++] << f, f += 8;}e.adler = r.check = L(h), f = h = 0, r.mode = 11;case 11:if (0 === r.havedict) return e.next_out = a, e.avail_out = u, e.next_in = s, e.avail_in = o, r.hold = h, r.bits = f, 2;e.adler = r.check = 1, r.mode = 12;case 12:if (5 === t || 6 === t) break e;case 13:if (r.last) {h >>>= 7 & f, f -= 7 & f, r.mode = 27;break;}for (; f < 3;) {if (0 === o) break e;o--, h += n[s++] << f, f += 8;}switch (r.last = 1 & h, f -= 1, 3 & (h >>>= 1)) {case 0:r.mode = 14;break;case 1:if (j(r), r.mode = 20, 6 !== t) break;h >>>= 2, f -= 2;break e;case 2:r.mode = 17;break;case 3:e.msg = "invalid block type", r.mode = 30;}h >>>= 2, f -= 2;break;case 14:for (h >>>= 7 & f, f -= 7 & f; f < 32;) {if (0 === o) break e;o--, h += n[s++] << f, f += 8;}if ((65535 & h) != (h >>> 16 ^ 65535)) {e.msg = "invalid stored block lengths", r.mode = 30;break;}if (r.length = 65535 & h, f = h = 0, r.mode = 15, 6 === t) break e;case 15:r.mode = 16;case 16:if (c = r.length) {if (o < c && (c = o), u < c && (c = u), 0 === c) break e;I.arraySet(i, n, s, c, a), o -= c, s += c, u -= c, a += c, r.length -= c;break;}r.mode = 12;break;case 17:for (; f < 14;) {if (0 === o) break e;o--, h += n[s++] << f, f += 8;}if (r.nlen = 257 + (31 & h), h >>>= 5, f -= 5, r.ndist = 1 + (31 & h), h >>>= 5, f -= 5, r.ncode = 4 + (15 & h), h >>>= 4, f -= 4, 286 < r.nlen || 30 < r.ndist) {e.msg = "too many length or distance symbols", r.mode = 30;break;}r.have = 0, r.mode = 18;case 18:for (; r.have < r.ncode;) {for (; f < 3;) {if (0 === o) break e;o--, h += n[s++] << f, f += 8;}r.lens[A[r.have++]] = 7 & h, h >>>= 3, f -= 3;}for (; r.have < 19;) r.lens[A[r.have++]] = 0;if (r.lencode = r.lendyn, r.lenbits = 7, S = { bits: r.lenbits }, x = R(0, r.lens, 0, 19, r.lencode, 0, r.work, S), r.lenbits = S.bits, x) {e.msg = "invalid code lengths set", r.mode = 30;break;}r.have = 0, r.mode = 19;case 19:for (; r.have < r.nlen + r.ndist;) {for (; g = (E = r.lencode[h & (1 << r.lenbits) - 1]) >>> 16 & 255, v = 65535 & E, !((_ = E >>> 24) <= f);) {if (0 === o) break e;o--, h += n[s++] << f, f += 8;}if (v < 16) h >>>= _, f -= _, r.lens[r.have++] = v;else {if (16 === v) {for (z = _ + 2; f < z;) {if (0 === o) break e;o--, h += n[s++] << f, f += 8;}if (h >>>= _, f -= _, 0 === r.have) {e.msg = "invalid bit length repeat", r.mode = 30;break;}k = r.lens[r.have - 1], c = 3 + (3 & h), h >>>= 2, f -= 2;} else if (17 === v) {for (z = _ + 3; f < z;) {if (0 === o) break e;o--, h += n[s++] << f, f += 8;}f -= _, k = 0, c = 3 + (7 & (h >>>= _)), h >>>= 3, f -= 3;} else {for (z = _ + 7; f < z;) {if (0 === o) break e;o--, h += n[s++] << f, f += 8;}f -= _, k = 0, c = 11 + (127 & (h >>>= _)), h >>>= 7, f -= 7;}if (r.have + c > r.nlen + r.ndist) {e.msg = "invalid bit length repeat", r.mode = 30;break;}for (; c--;) r.lens[r.have++] = k;}}if (30 === r.mode) break;if (0 === r.lens[256]) {e.msg = "invalid code -- missing end-of-block", r.mode = 30;break;}if (r.lenbits = 9, S = { bits: r.lenbits }, x = R(D, r.lens, 0, r.nlen, r.lencode, 0, r.work, S), r.lenbits = S.bits, x) {e.msg = "invalid literal/lengths set", r.mode = 30;break;}if (r.distbits = 6, r.distcode = r.distdyn, S = { bits: r.distbits }, x = R(F, r.lens, r.nlen, r.ndist, r.distcode, 0, r.work, S), r.distbits = S.bits, x) {e.msg = "invalid distances set", r.mode = 30;break;}if (r.mode = 20, 6 === t) break e;case 20:r.mode = 21;case 21:if (6 <= o && 258 <= u) {e.next_out = a, e.avail_out = u, e.next_in = s, e.avail_in = o, r.hold = h, r.bits = f, T(e, d), a = e.next_out, i = e.output, u = e.avail_out, s = e.next_in, n = e.input, o = e.avail_in, h = r.hold, f = r.bits, 12 === r.mode && (r.back = -1);break;}for (r.back = 0; g = (E = r.lencode[h & (1 << r.lenbits) - 1]) >>> 16 & 255, v = 65535 & E, !((_ = E >>> 24) <= f);) {if (0 === o) break e;o--, h += n[s++] << f, f += 8;}if (g && 0 == (240 & g)) {for (b = _, w = g, y = v; g = (E = r.lencode[y + ((h & (1 << b + w) - 1) >> b)]) >>> 16 & 255, v = 65535 & E, !(b + (_ = E >>> 24) <= f);) {if (0 === o) break e;o--, h += n[s++] << f, f += 8;}h >>>= b, f -= b, r.back += b;}if (h >>>= _, f -= _, r.back += _, r.length = v, 0 === g) {r.mode = 26;break;}if (32 & g) {r.back = -1, r.mode = 12;break;}if (64 & g) {e.msg = "invalid literal/length code", r.mode = 30;break;}r.extra = 15 & g, r.mode = 22;case 22:if (r.extra) {for (z = r.extra; f < z;) {if (0 === o) break e;o--, h += n[s++] << f, f += 8;}r.length += h & (1 << r.extra) - 1, h >>>= r.extra, f -= r.extra, r.back += r.extra;}r.was = r.length, r.mode = 23;case 23:for (; g = (E = r.distcode[h & (1 << r.distbits) - 1]) >>> 16 & 255, v = 65535 & E, !((_ = E >>> 24) <= f);) {if (0 === o) break e;o--, h += n[s++] << f, f += 8;}if (0 == (240 & g)) {for (b = _, w = g, y = v; g = (E = r.distcode[y + ((h & (1 << b + w) - 1) >> b)]) >>> 16 & 255, v = 65535 & E, !(b + (_ = E >>> 24) <= f);) {if (0 === o) break e;o--, h += n[s++] << f, f += 8;}h >>>= b, f -= b, r.back += b;}if (h >>>= _, f -= _, r.back += _, 64 & g) {e.msg = "invalid distance code", r.mode = 30;break;}r.offset = v, r.extra = 15 & g, r.mode = 24;case 24:if (r.extra) {for (z = r.extra; f < z;) {if (0 === o) break e;o--, h += n[s++] << f, f += 8;}r.offset += h & (1 << r.extra) - 1, h >>>= r.extra, f -= r.extra, r.back += r.extra;}if (r.offset > r.dmax) {e.msg = "invalid distance too far back", r.mode = 30;break;}r.mode = 25;case 25:if (0 === u) break e;if (c = d - u, r.offset > c) {if ((c = r.offset - c) > r.whave && r.sane) {e.msg = "invalid distance too far back", r.mode = 30;break;}p = c > r.wnext ? (c -= r.wnext, r.wsize - c) : r.wnext - c, c > r.length && (c = r.length), m = r.window;} else m = i, p = a - r.offset, c = r.length;for (u < c && (c = u), u -= c, r.length -= c; i[a++] = m[p++], --c;);0 === r.length && (r.mode = 21);break;case 26:if (0 === u) break e;i[a++] = r.length, u--, r.mode = 21;break;case 27:if (r.wrap) {for (; f < 32;) {if (0 === o) break e;o--, h |= n[s++] << f, f += 8;}if (d -= u, e.total_out += d, r.total += d, d && (e.adler = r.check = r.flags ? B(r.check, i, d, a - d) : O(r.check, i, d, a - d)), d = u, (r.flags ? h : L(h)) !== r.check) {e.msg = "incorrect data check", r.mode = 30;break;}f = h = 0;}r.mode = 28;case 28:if (r.wrap && r.flags) {for (; f < 32;) {if (0 === o) break e;o--, h += n[s++] << f, f += 8;}if (h !== (4294967295 & r.total)) {e.msg = "incorrect length check", r.mode = 30;break;}f = h = 0;}r.mode = 29;case 29:x = 1;break e;case 30:x = -3;break e;case 31:return -4;case 32:default:return U;}return e.next_out = a, e.avail_out = u, e.next_in = s, e.avail_in = o, r.hold = h, r.bits = f, (r.wsize || d !== e.avail_out && r.mode < 30 && (r.mode < 27 || 4 !== t)) && Z(e, e.output, e.next_out, d - e.avail_out) ? (r.mode = 31, -4) : (l -= e.avail_in, d -= e.avail_out, e.total_in += l, e.total_out += d, r.total += d, r.wrap && d && (e.adler = r.check = r.flags ? B(r.check, i, d, e.next_out - d) : O(r.check, i, d, e.next_out - d)), e.data_type = r.bits + (r.last ? 64 : 0) + (12 === r.mode ? 128 : 0) + (20 === r.mode || 15 === r.mode ? 256 : 0), (0 == l && 0 === d || 4 === t) && x === N && (x = -5), x);}, r.inflateEnd = function (e) {if (!e || !e.state) return U;var t = e.state;return t.window && (t.window = null), e.state = null, N;}, r.inflateGetHeader = function (e, t) {var r;return e && e.state ? 0 == (2 & (r = e.state).wrap) ? U : ((r.head = t).done = !1, N) : U;}, r.inflateSetDictionary = function (e, t) {var r,n = t.length;return e && e.state ? 0 !== (r = e.state).wrap && 11 !== r.mode ? U : 11 === r.mode && O(1, t, n, 0) !== r.check ? -3 : Z(e, t, n, n) ? (r.mode = 31, -4) : (r.havedict = 1, N) : U;}, r.inflateInfo = "pako inflate (from Nodeca project)";}, { "../utils/common": 41, "./adler32": 43, "./crc32": 45, "./inffast": 48, "./inftrees": 50 }], 50: [function (e, t, r) {"use strict";var D = e("../utils/common"),F = [3, 4, 5, 6, 7, 8, 9, 10, 11, 13, 15, 17, 19, 23, 27, 31, 35, 43, 51, 59, 67, 83, 99, 115, 131, 163, 195, 227, 258, 0, 0],N = [16, 16, 16, 16, 16, 16, 16, 16, 17, 17, 17, 17, 18, 18, 18, 18, 19, 19, 19, 19, 20, 20, 20, 20, 21, 21, 21, 21, 16, 72, 78],U = [1, 2, 3, 4, 5, 7, 9, 13, 17, 25, 33, 49, 65, 97, 129, 193, 257, 385, 513, 769, 1025, 1537, 2049, 3073, 4097, 6145, 8193, 12289, 16385, 24577, 0, 0],P = [16, 16, 16, 16, 17, 17, 18, 18, 19, 19, 20, 20, 21, 21, 22, 22, 23, 23, 24, 24, 25, 25, 26, 26, 27, 27, 28, 28, 29, 29, 64, 64];t.exports = function (e, t, r, n, i, s, a, o) {var u,h,f,l,d,c,p,m,_,g = o.bits,v = 0,b = 0,w = 0,y = 0,k = 0,x = 0,S = 0,z = 0,E = 0,C = 0,A = null,I = 0,O = new D.Buf16(16),B = new D.Buf16(16),T = null,R = 0;for (v = 0; v <= 15; v++) O[v] = 0;for (b = 0; b < n; b++) O[t[r + b]]++;for (k = g, y = 15; 1 <= y && 0 === O[y]; y--);if (y < k && (k = y), 0 === y) return i[s++] = 20971520, i[s++] = 20971520, o.bits = 1, 0;for (w = 1; w < y && 0 === O[w]; w++);for (k < w && (k = w), v = z = 1; v <= 15; v++) if (z <<= 1, (z -= O[v]) < 0) return -1;if (0 < z && (0 === e || 1 !== y)) return -1;for (B[1] = 0, v = 1; v < 15; v++) B[v + 1] = B[v] + O[v];for (b = 0; b < n; b++) 0 !== t[r + b] && (a[B[t[r + b]]++] = b);if (c = 0 === e ? (A = T = a, 19) : 1 === e ? (A = F, I -= 257, T = N, R -= 257, 256) : (A = U, T = P, -1), v = w, d = s, S = b = C = 0, f = -1, l = (E = 1 << (x = k)) - 1, 1 === e && 852 < E || 2 === e && 592 < E) return 1;for (;;) {for (p = v - S, _ = a[b] < c ? (m = 0, a[b]) : a[b] > c ? (m = T[R + a[b]], A[I + a[b]]) : (m = 96, 0), u = 1 << v - S, w = h = 1 << x; i[d + (C >> S) + (h -= u)] = p << 24 | m << 16 | _ | 0, 0 !== h;);for (u = 1 << v - 1; C & u;) u >>= 1;if (0 !== u ? (C &= u - 1, C += u) : C = 0, b++, 0 == --O[v]) {if (v === y) break;v = t[r + a[b]];}if (k < v && (C & l) !== f) {for (0 === S && (S = k), d += w, z = 1 << (x = v - S); x + S < y && !((z -= O[x + S]) <= 0);) x++, z <<= 1;if (E += 1 << x, 1 === e && 852 < E || 2 === e && 592 < E) return 1;i[f = C & l] = k << 24 | x << 16 | d - s | 0;}}return 0 !== C && (i[d + C] = v - S << 24 | 64 << 16 | 0), o.bits = k, 0;};}, { "../utils/common": 41 }], 51: [function (e, t, r) {"use strict";t.exports = { 2: "need dictionary", 1: "stream end", 0: "", "-1": "file error", "-2": "stream error", "-3": "data error", "-4": "insufficient memory", "-5": "buffer error", "-6": "incompatible version" };}, {}], 52: [function (e, t, r) {"use strict";var o = e("../utils/common");function n(e) {for (var t = e.length; 0 <= --t;) e[t] = 0;}var _ = 15,i = 16,u = [0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 0],h = [0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 13, 13],a = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 3, 7],f = [16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15],l = new Array(576);n(l);var d = new Array(60);n(d);var c = new Array(512);n(c);var p = new Array(256);n(p);var m = new Array(29);n(m);var g,v,b,w = new Array(30);function y(e, t, r, n, i) {this.static_tree = e, this.extra_bits = t, this.extra_base = r, this.elems = n, this.max_length = i, this.has_stree = e && e.length;}function s(e, t) {this.dyn_tree = e, this.max_code = 0, this.stat_desc = t;}function k(e) {return e < 256 ? c[e] : c[256 + (e >>> 7)];}function x(e, t) {e.pending_buf[e.pending++] = 255 & t, e.pending_buf[e.pending++] = t >>> 8 & 255;}function S(e, t, r) {e.bi_valid > i - r ? (e.bi_buf |= t << e.bi_valid & 65535, x(e, e.bi_buf), e.bi_buf = t >> i - e.bi_valid, e.bi_valid += r - i) : (e.bi_buf |= t << e.bi_valid & 65535, e.bi_valid += r);}function z(e, t, r) {S(e, r[2 * t], r[2 * t + 1]);}function E(e, t) {for (var r = 0; r |= 1 & e, e >>>= 1, r <<= 1, 0 < --t;);return r >>> 1;}function C(e, t, r) {var n,i,s = new Array(_ + 1),a = 0;for (n = 1; n <= _; n++) s[n] = a = a + r[n - 1] << 1;for (i = 0; i <= t; i++) {var o = e[2 * i + 1];0 !== o && (e[2 * i] = E(s[o]++, o));}}function A(e) {var t;for (t = 0; t < 286; t++) e.dyn_ltree[2 * t] = 0;for (t = 0; t < 30; t++) e.dyn_dtree[2 * t] = 0;for (t = 0; t < 19; t++) e.bl_tree[2 * t] = 0;e.dyn_ltree[512] = 1, e.opt_len = e.static_len = 0, e.last_lit = e.matches = 0;}function I(e) {8 < e.bi_valid ? x(e, e.bi_buf) : 0 < e.bi_valid && (e.pending_buf[e.pending++] = e.bi_buf), e.bi_buf = 0, e.bi_valid = 0;}function O(e, t, r, n) {var i = 2 * t,s = 2 * r;return e[i] < e[s] || e[i] === e[s] && n[t] <= n[r];}function B(e, t, r) {for (var n = e.heap[r], i = r << 1; i <= e.heap_len && (i < e.heap_len && O(t, e.heap[i + 1], e.heap[i], e.depth) && i++, !O(t, n, e.heap[i], e.depth));) e.heap[r] = e.heap[i], r = i, i <<= 1;e.heap[r] = n;}function T(e, t, r) {var n,i,s,a,o = 0;if (0 !== e.last_lit) for (; n = e.pending_buf[e.d_buf + 2 * o] << 8 | e.pending_buf[e.d_buf + 2 * o + 1], i = e.pending_buf[e.l_buf + o], o++, 0 === n ? z(e, i, t) : (z(e, (s = p[i]) + 256 + 1, t), 0 !== (a = u[s]) && S(e, i -= m[s], a), z(e, s = k(--n), r), 0 !== (a = h[s]) && S(e, n -= w[s], a)), o < e.last_lit;);z(e, 256, t);}function R(e, t) {var r,n,i,s = t.dyn_tree,a = t.stat_desc.static_tree,o = t.stat_desc.has_stree,u = t.stat_desc.elems,h = -1;for (e.heap_len = 0, e.heap_max = 573, r = 0; r < u; r++) 0 !== s[2 * r] ? (e.heap[++e.heap_len] = h = r, e.depth[r] = 0) : s[2 * r + 1] = 0;for (; e.heap_len < 2;) s[2 * (i = e.heap[++e.heap_len] = h < 2 ? ++h : 0)] = 1, e.depth[i] = 0, e.opt_len--, o && (e.static_len -= a[2 * i + 1]);for (t.max_code = h, r = e.heap_len >> 1; 1 <= r; r--) B(e, s, r);for (i = u; r = e.heap[1], e.heap[1] = e.heap[e.heap_len--], B(e, s, 1), n = e.heap[1], e.heap[--e.heap_max] = r, e.heap[--e.heap_max] = n, s[2 * i] = s[2 * r] + s[2 * n], e.depth[i] = (e.depth[r] >= e.depth[n] ? e.depth[r] : e.depth[n]) + 1, s[2 * r + 1] = s[2 * n + 1] = i, e.heap[1] = i++, B(e, s, 1), 2 <= e.heap_len;);e.heap[--e.heap_max] = e.heap[1], function (e, t) {var r,n,i,s,a,o,u = t.dyn_tree,h = t.max_code,f = t.stat_desc.static_tree,l = t.stat_desc.has_stree,d = t.stat_desc.extra_bits,c = t.stat_desc.extra_base,p = t.stat_desc.max_length,m = 0;for (s = 0; s <= _; s++) e.bl_count[s] = 0;for (u[2 * e.heap[e.heap_max] + 1] = 0, r = e.heap_max + 1; r < 573; r++) p < (s = u[2 * u[2 * (n = e.heap[r]) + 1] + 1] + 1) && (s = p, m++), u[2 * n + 1] = s, h < n || (e.bl_count[s]++, a = 0, c <= n && (a = d[n - c]), o = u[2 * n], e.opt_len += o * (s + a), l && (e.static_len += o * (f[2 * n + 1] + a)));if (0 !== m) {do {for (s = p - 1; 0 === e.bl_count[s];) s--;e.bl_count[s]--, e.bl_count[s + 1] += 2, e.bl_count[p]--, m -= 2;} while (0 < m);for (s = p; 0 !== s; s--) for (n = e.bl_count[s]; 0 !== n;) h < (i = e.heap[--r]) || (u[2 * i + 1] !== s && (e.opt_len += (s - u[2 * i + 1]) * u[2 * i], u[2 * i + 1] = s), n--);}}(e, t), C(s, h, e.bl_count);}function D(e, t, r) {var n,i,s = -1,a = t[1],o = 0,u = 7,h = 4;for (0 === a && (u = 138, h = 3), t[2 * (r + 1) + 1] = 65535, n = 0; n <= r; n++) i = a, a = t[2 * (n + 1) + 1], ++o < u && i === a || (o < h ? e.bl_tree[2 * i] += o : 0 !== i ? (i !== s && e.bl_tree[2 * i]++, e.bl_tree[32]++) : o <= 10 ? e.bl_tree[34]++ : e.bl_tree[36]++, s = i, h = (o = 0) === a ? (u = 138, 3) : i === a ? (u = 6, 3) : (u = 7, 4));}function F(e, t, r) {var n,i,s = -1,a = t[1],o = 0,u = 7,h = 4;for (0 === a && (u = 138, h = 3), n = 0; n <= r; n++) if (i = a, a = t[2 * (n + 1) + 1], !(++o < u && i === a)) {if (o < h) for (; z(e, i, e.bl_tree), 0 != --o;);else 0 !== i ? (i !== s && (z(e, i, e.bl_tree), o--), z(e, 16, e.bl_tree), S(e, o - 3, 2)) : o <= 10 ? (z(e, 17, e.bl_tree), S(e, o - 3, 3)) : (z(e, 18, e.bl_tree), S(e, o - 11, 7));s = i, h = (o = 0) === a ? (u = 138, 3) : i === a ? (u = 6, 3) : (u = 7, 4);}}n(w);var N = !1;function U(e, t, r, n) {var i, s, a;S(e, 0 + (n ? 1 : 0), 3), s = t, a = r, I(i = e), x(i, a), x(i, ~a), o.arraySet(i.pending_buf, i.window, s, a, i.pending), i.pending += a;}r._tr_init = function (e) {N || (function () {var e,t,r,n,i,s = new Array(_ + 1);for (n = r = 0; n < 28; n++) for (m[n] = r, e = 0; e < 1 << u[n]; e++) p[r++] = n;for (p[r - 1] = n, n = i = 0; n < 16; n++) for (w[n] = i, e = 0; e < 1 << h[n]; e++) c[i++] = n;for (i >>= 7; n < 30; n++) for (w[n] = i << 7, e = 0; e < 1 << h[n] - 7; e++) c[256 + i++] = n;for (t = 0; t <= _; t++) s[t] = 0;for (e = 0; e <= 143;) l[2 * e + 1] = 8, e++, s[8]++;for (; e <= 255;) l[2 * e + 1] = 9, e++, s[9]++;for (; e <= 279;) l[2 * e + 1] = 7, e++, s[7]++;for (; e <= 287;) l[2 * e + 1] = 8, e++, s[8]++;for (C(l, 287, s), e = 0; e < 30; e++) d[2 * e + 1] = 5, d[2 * e] = E(e, 5);g = new y(l, u, 257, 286, _), v = new y(d, h, 0, 30, _), b = new y(new Array(0), a, 0, 19, 7);}(), N = !0), e.l_desc = new s(e.dyn_ltree, g), e.d_desc = new s(e.dyn_dtree, v), e.bl_desc = new s(e.bl_tree, b), e.bi_buf = 0, e.bi_valid = 0, A(e);}, r._tr_stored_block = U, r._tr_flush_block = function (e, t, r, n) {var i,s,a = 0;0 < e.level ? (2 === e.strm.data_type && (e.strm.data_type = function (e) {var t,r = 4093624447;for (t = 0; t <= 31; t++, r >>>= 1) if (1 & r && 0 !== e.dyn_ltree[2 * t]) return 0;if (0 !== e.dyn_ltree[18] || 0 !== e.dyn_ltree[20] || 0 !== e.dyn_ltree[26]) return 1;for (t = 32; t < 256; t++) if (0 !== e.dyn_ltree[2 * t]) return 1;return 0;}(e)), R(e, e.l_desc), R(e, e.d_desc), a = function (e) {var t;for (D(e, e.dyn_ltree, e.l_desc.max_code), D(e, e.dyn_dtree, e.d_desc.max_code), R(e, e.bl_desc), t = 18; 3 <= t && 0 === e.bl_tree[2 * f[t] + 1]; t--);return e.opt_len += 3 * (t + 1) + 5 + 5 + 4, t;}(e), i = e.opt_len + 3 + 7 >>> 3, (s = e.static_len + 3 + 7 >>> 3) <= i && (i = s)) : i = s = r + 5, r + 4 <= i && -1 !== t ? U(e, t, r, n) : 4 === e.strategy || s === i ? (S(e, 2 + (n ? 1 : 0), 3), T(e, l, d)) : (S(e, 4 + (n ? 1 : 0), 3), function (e, t, r, n) {var i;for (S(e, t - 257, 5), S(e, r - 1, 5), S(e, n - 4, 4), i = 0; i < n; i++) S(e, e.bl_tree[2 * f[i] + 1], 3);F(e, e.dyn_ltree, t - 1), F(e, e.dyn_dtree, r - 1);}(e, e.l_desc.max_code + 1, e.d_desc.max_code + 1, a + 1), T(e, e.dyn_ltree, e.dyn_dtree)), A(e), n && I(e);}, r._tr_tally = function (e, t, r) {return e.pending_buf[e.d_buf + 2 * e.last_lit] = t >>> 8 & 255, e.pending_buf[e.d_buf + 2 * e.last_lit + 1] = 255 & t, e.pending_buf[e.l_buf + e.last_lit] = 255 & r, e.last_lit++, 0 === t ? e.dyn_ltree[2 * r]++ : (e.matches++, t--, e.dyn_ltree[2 * (p[r] + 256 + 1)]++, e.dyn_dtree[2 * k(t)]++), e.last_lit === e.lit_bufsize - 1;}, r._tr_align = function (e) {var t;S(e, 2, 3), z(e, 256, l), 16 === (t = e).bi_valid ? (x(t, t.bi_buf), t.bi_buf = 0, t.bi_valid = 0) : 8 <= t.bi_valid && (t.pending_buf[t.pending++] = 255 & t.bi_buf, t.bi_buf >>= 8, t.bi_valid -= 8);};}, { "../utils/common": 41 }], 53: [function (e, t, r) {"use strict";t.exports = function () {this.input = null, this.next_in = 0, this.avail_in = 0, this.total_in = 0, this.output = null, this.next_out = 0, this.avail_out = 0, this.total_out = 0, this.msg = "", this.state = null, this.data_type = 2, this.adler = 0;};}, {}], 54: [function (e, t, r) {"use strict";t.exports = "function" == typeof setImmediate ? setImmediate : function () {var e = [].slice.apply(arguments);e.splice(1, 0, 0), setTimeout.apply(null, e);};}, {}] }, {}, [10])(10);});}).call(this, void 0 !== r ? r : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {});}, {}] }, {}, [1])(1);});}).call(this, void 0 !== r ? r : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {});}, {}] }, {}, [1])(1);});}).call(this, void 0 !== r ? r : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {});}, {}] }, {}, [1])(1);});}).call(this, void 0 !== r ? r : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {});}, {}] }, {}, [1])(1);});}).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {});}, {}] }, {}, [1])(1);});

      var APP_STRINGS = {
        en: {
          title: "PDF to JPG Converter",
          input: "Select a PDF file:",
          generate: "Generate JPG",
          converting: "Converting...",
          page_of: "Page {0} of {1}",
        },
        es: {
          title: "Conversor de PDF a JPG",
          input: "Seleccione un archivo PDF:",
          generate: "Generar JPG",
          converting: "Convirtiendo...",
          page_of: "P\xe1gina {0} de {1}",
        },
      }

      var USER_LANG = window.navigator.language.substring(0, 2).toLowerCase()
      var GET_APP_STRING = APP_STRINGS[USER_LANG] || APP_STRINGS["en"]

      function t(stringName) {
        return GET_APP_STRING[stringName] || ""
      }

      window.addEventListener("load", function () {
        if (window.top === window.self) {
          // hiding the loading spinner
          document.querySelector(".pleasewait").style.display = "none"

          var container = document.querySelector(".container")
          var pdfPreview = document.getElementById("pdfPreview")
          var generateBtn = document.getElementById("generate")
          var uploader = document.getElementById("uploader")
          var pdfData = null
          var pdfFileName = null

          document.getElementsByTagName("body")[0].style.backgroundColor = "#f5f5f5"

          container.style.display = "block"

          document.querySelector(".title").innerText = t("title")
          document.querySelector("label").innerText = t("input")
          generateBtn.innerText = t("generate")

          var pdfjsScript = document.createElement("script")
          pdfjsScript.src =
            "data:text/javascript;base64,LyoqCiAqIEBsaWNzdGFydCBUaGUgZm9sbG93aW5nIGlzIHRoZSBlbnRpcmUgbGljZW5zZSBub3RpY2UgZm9yIHRoZQogKiBKYXZhc2NyaXB0IGNvZGUgaW4gdGhpcyBwYWdlCiAqCiAqIENvcHlyaWdodCAyMDIwIE1vemlsbGEgRm91bmRhdGlvbgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKgogKiBAbGljZW5kIFRoZSBhYm92ZSBpcyB0aGUgZW50aXJlIGxpY2Vuc2Ugbm90aWNlIGZvciB0aGUKICogSmF2YXNjcmlwdCBjb2RlIGluIHRoaXMgcGFnZQogKi8KCihmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7CiAgaWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0JykKICBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTtlbHNlCiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkKICBkZWZpbmUoInBkZmpzLWRpc3QvYnVpbGQvcGRmIiwgW10sIGZhY3RvcnkpO2Vsc2UKICBpZiAodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKQogIGV4cG9ydHNbInBkZmpzLWRpc3QvYnVpbGQvcGRmIl0gPSBmYWN0b3J5KCk7ZWxzZQoKICByb290WyJwZGZqcy1kaXN0L2J1aWxkL3BkZiJdID0gcm9vdC5wZGZqc0xpYiA9IGZhY3RvcnkoKTsKfSkodGhpcywgZnVuY3Rpb24gKCkgewogIHJldHVybiAvKioqKioqL2Z1bmN0aW9uIChtb2R1bGVzKSB7Ly8gd2VicGFja0Jvb3RzdHJhcAogICAgLyoqKioqKi8gLy8gVGhlIG1vZHVsZSBjYWNoZQogICAgLyoqKioqKi92YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9OwogICAgLyoqKioqKi8KICAgIC8qKioqKiovIC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uCiAgICAvKioqKioqL2Z1bmN0aW9uIF9fd19wZGZqc19yZXF1aXJlX18obW9kdWxlSWQpIHsKICAgICAgLyoqKioqKi8KICAgICAgLyoqKioqKi8gLy8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlCiAgICAgIC8qKioqKiovaWYgKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7CiAgICAgICAgLyoqKioqKi9yZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0czsKICAgICAgICAvKioqKioqL30KICAgICAgLyoqKioqKi8gLy8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSkKICAgICAgLyoqKioqKi92YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7CiAgICAgICAgLyoqKioqKi9pOiBtb2R1bGVJZCwKICAgICAgICAvKioqKioqL2w6IGZhbHNlLAogICAgICAgIC8qKioqKiovZXhwb3J0czoge30KICAgICAgICAvKioqKioqLyB9OwogICAgICAvKioqKioqLwogICAgICAvKioqKioqLyAvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb24KICAgICAgLyoqKioqKi9tb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKTsKICAgICAgLyoqKioqKi8KICAgICAgLyoqKioqKi8gLy8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZAogICAgICAvKioqKioqL21vZHVsZS5sID0gdHJ1ZTsKICAgICAgLyoqKioqKi8KICAgICAgLyoqKioqKi8gLy8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGUKICAgICAgLyoqKioqKi9yZXR1cm4gbW9kdWxlLmV4cG9ydHM7CiAgICAgIC8qKioqKiovfQogICAgLyoqKioqKi8KICAgIC8qKioqKiovCiAgICAvKioqKioqLyAvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKQogICAgLyoqKioqKi9fX3dfcGRmanNfcmVxdWlyZV9fLm0gPSBtb2R1bGVzOwogICAgLyoqKioqKi8KICAgIC8qKioqKiovIC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlCiAgICAvKioqKioqL19fd19wZGZqc19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7CiAgICAvKioqKioqLwogICAgLyoqKioqKi8gLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzCiAgICAvKioqKioqL19fd19wZGZqc19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uIChleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHsKICAgICAgLyoqKioqKi9pZiAoIV9fd19wZGZqc19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkgewogICAgICAgIC8qKioqKiovT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7CiAgICAgICAgLyoqKioqKi99CiAgICAgIC8qKioqKiovfTsKICAgIC8qKioqKiovCiAgICAvKioqKioqLyAvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzCiAgICAvKioqKioqL19fd19wZGZqc19yZXF1aXJlX18uciA9IGZ1bmN0aW9uIChleHBvcnRzKSB7CiAgICAgIC8qKioqKiovaWYgKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykgewogICAgICAgIC8qKioqKiovT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7CiAgICAgICAgLyoqKioqKi99CiAgICAgIC8qKioqKiovT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTsKICAgICAgLyoqKioqKi99OwogICAgLyoqKioqKi8KICAgIC8qKioqKiovIC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdAogICAgLyoqKioqKi8gLy8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0CiAgICAvKioqKioqLyAvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnMKICAgIC8qKioqKiovIC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdAogICAgLyoqKioqKi8gLy8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZQogICAgLyoqKioqKi9fX3dfcGRmanNfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbiAodmFsdWUsIG1vZGUpIHsKICAgICAgLyoqKioqKi9pZiAobW9kZSAmIDEpIHZhbHVlID0gX193X3BkZmpzX3JlcXVpcmVfXyh2YWx1ZSk7CiAgICAgIC8qKioqKiovaWYgKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7CiAgICAgIC8qKioqKiovaWYgKG1vZGUgJiA0ICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlOwogICAgICAvKioqKioqL3ZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIC8qKioqKiovX193X3BkZmpzX3JlcXVpcmVfXy5yKG5zKTsKICAgICAgLyoqKioqKi9PYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7CiAgICAgIC8qKioqKiovaWYgKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yICh2YXIga2V5IGluIHZhbHVlKSBfX3dfcGRmanNfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24gKGtleSkge3JldHVybiB2YWx1ZVtrZXldO30uYmluZChudWxsLCBrZXkpKTsKICAgICAgLyoqKioqKi9yZXR1cm4gbnM7CiAgICAgIC8qKioqKiovfTsKICAgIC8qKioqKiovCiAgICAvKioqKioqLyAvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlcwogICAgLyoqKioqKi9fX3dfcGRmanNfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbiAobW9kdWxlKSB7CiAgICAgIC8qKioqKiovdmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/CiAgICAgIC8qKioqKiovZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHtyZXR1cm4gbW9kdWxlWydkZWZhdWx0J107fSA6CiAgICAgIC8qKioqKiovZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHtyZXR1cm4gbW9kdWxlO307CiAgICAgIC8qKioqKiovX193X3BkZmpzX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpOwogICAgICAvKioqKioqL3JldHVybiBnZXR0ZXI7CiAgICAgIC8qKioqKiovfTsKICAgIC8qKioqKiovCiAgICAvKioqKioqLyAvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwKICAgIC8qKioqKiovX193X3BkZmpzX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24gKG9iamVjdCwgcHJvcGVydHkpIHtyZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpO307CiAgICAvKioqKioqLwogICAgLyoqKioqKi8gLy8gX193ZWJwYWNrX3B1YmxpY19wYXRoX18KICAgIC8qKioqKiovX193X3BkZmpzX3JlcXVpcmVfXy5wID0gIiI7CiAgICAvKioqKioqLwogICAgLyoqKioqKi8KICAgIC8qKioqKiovIC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0cwogICAgLyoqKioqKi9yZXR1cm4gX193X3BkZmpzX3JlcXVpcmVfXyhfX3dfcGRmanNfcmVxdWlyZV9fLnMgPSAwKTsKICAgIC8qKioqKiovfQogIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCiAgLyoqKioqKi8oWygKICAvKiAwICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKCiAgICB2YXIgcGRmanNWZXJzaW9uID0gJzIuNC40NTYnOwogICAgdmFyIHBkZmpzQnVpbGQgPSAnMjI4YTU5MWMnOwoKICAgIHZhciBwZGZqc1NoYXJlZFV0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEpOwoKICAgIHZhciBwZGZqc0Rpc3BsYXlBUEkgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE5MCk7CgogICAgdmFyIHBkZmpzRGlzcGxheVRleHRMYXllciA9IF9fd19wZGZqc19yZXF1aXJlX18oMjA1KTsKCiAgICB2YXIgcGRmanNEaXNwbGF5QW5ub3RhdGlvbkxheWVyID0gX193X3BkZmpzX3JlcXVpcmVfXygyMDYpOwoKICAgIHZhciBwZGZqc0Rpc3BsYXlEaXNwbGF5VXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE5NCk7CgogICAgdmFyIHBkZmpzRGlzcGxheVNWRyA9IF9fd19wZGZqc19yZXF1aXJlX18oMjA3KTsKCiAgICB2YXIgcGRmanNEaXNwbGF5V29ya2VyT3B0aW9ucyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTk5KTsKCiAgICB2YXIgcGRmanNEaXNwbGF5QVBJQ29tcGF0aWJpbGl0eSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTk2KTsKCiAgICB7CiAgICAgIHZhciBfcmVxdWlyZSA9IF9fd19wZGZqc19yZXF1aXJlX18oNDgpLAogICAgICAgIGlzTm9kZUpTID0gX3JlcXVpcmUuaXNOb2RlSlM7CgogICAgICBpZiAoaXNOb2RlSlMpIHsKICAgICAgICB2YXIgUERGTm9kZVN0cmVhbSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjA4KS5QREZOb2RlU3RyZWFtOwoKICAgICAgICBwZGZqc0Rpc3BsYXlBUEkuc2V0UERGTmV0d29ya1N0cmVhbUZhY3RvcnkoZnVuY3Rpb24gKHBhcmFtcykgewogICAgICAgICAgcmV0dXJuIG5ldyBQREZOb2RlU3RyZWFtKHBhcmFtcyk7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIFBERk5ldHdvcmtTdHJlYW0gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIxMSkuUERGTmV0d29ya1N0cmVhbTsKCiAgICAgICAgdmFyIFBERkZldGNoU3RyZWFtOwoKICAgICAgICBpZiAocGRmanNEaXNwbGF5RGlzcGxheVV0aWxzLmlzRmV0Y2hTdXBwb3J0ZWQoKSkgewogICAgICAgICAgUERGRmV0Y2hTdHJlYW0gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIxMikuUERGRmV0Y2hTdHJlYW07CiAgICAgICAgfQoKICAgICAgICBwZGZqc0Rpc3BsYXlBUEkuc2V0UERGTmV0d29ya1N0cmVhbUZhY3RvcnkoZnVuY3Rpb24gKHBhcmFtcykgewogICAgICAgICAgaWYgKFBERkZldGNoU3RyZWFtICYmIHBkZmpzRGlzcGxheURpc3BsYXlVdGlscy5pc1ZhbGlkRmV0Y2hVcmwocGFyYW1zLnVybCkpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQREZGZXRjaFN0cmVhbShwYXJhbXMpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBuZXcgUERGTmV0d29ya1N0cmVhbShwYXJhbXMpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgICBleHBvcnRzLmJ1aWxkID0gcGRmanNEaXNwbGF5QVBJLmJ1aWxkOwogICAgZXhwb3J0cy52ZXJzaW9uID0gcGRmanNEaXNwbGF5QVBJLnZlcnNpb247CiAgICBleHBvcnRzLmdldERvY3VtZW50ID0gcGRmanNEaXNwbGF5QVBJLmdldERvY3VtZW50OwogICAgZXhwb3J0cy5Mb29wYmFja1BvcnQgPSBwZGZqc0Rpc3BsYXlBUEkuTG9vcGJhY2tQb3J0OwogICAgZXhwb3J0cy5QREZEYXRhUmFuZ2VUcmFuc3BvcnQgPSBwZGZqc0Rpc3BsYXlBUEkuUERGRGF0YVJhbmdlVHJhbnNwb3J0OwogICAgZXhwb3J0cy5QREZXb3JrZXIgPSBwZGZqc0Rpc3BsYXlBUEkuUERGV29ya2VyOwogICAgZXhwb3J0cy5yZW5kZXJUZXh0TGF5ZXIgPSBwZGZqc0Rpc3BsYXlUZXh0TGF5ZXIucmVuZGVyVGV4dExheWVyOwogICAgZXhwb3J0cy5Bbm5vdGF0aW9uTGF5ZXIgPSBwZGZqc0Rpc3BsYXlBbm5vdGF0aW9uTGF5ZXIuQW5ub3RhdGlvbkxheWVyOwogICAgZXhwb3J0cy5jcmVhdGVQcm9taXNlQ2FwYWJpbGl0eSA9IHBkZmpzU2hhcmVkVXRpbC5jcmVhdGVQcm9taXNlQ2FwYWJpbGl0eTsKICAgIGV4cG9ydHMuUGFzc3dvcmRSZXNwb25zZXMgPSBwZGZqc1NoYXJlZFV0aWwuUGFzc3dvcmRSZXNwb25zZXM7CiAgICBleHBvcnRzLkludmFsaWRQREZFeGNlcHRpb24gPSBwZGZqc1NoYXJlZFV0aWwuSW52YWxpZFBERkV4Y2VwdGlvbjsKICAgIGV4cG9ydHMuTWlzc2luZ1BERkV4Y2VwdGlvbiA9IHBkZmpzU2hhcmVkVXRpbC5NaXNzaW5nUERGRXhjZXB0aW9uOwogICAgZXhwb3J0cy5TVkdHcmFwaGljcyA9IHBkZmpzRGlzcGxheVNWRy5TVkdHcmFwaGljczsKICAgIGV4cG9ydHMuTmF0aXZlSW1hZ2VEZWNvZGluZyA9IHBkZmpzU2hhcmVkVXRpbC5OYXRpdmVJbWFnZURlY29kaW5nOwogICAgZXhwb3J0cy5DTWFwQ29tcHJlc3Npb25UeXBlID0gcGRmanNTaGFyZWRVdGlsLkNNYXBDb21wcmVzc2lvblR5cGU7CiAgICBleHBvcnRzLlBlcm1pc3Npb25GbGFnID0gcGRmanNTaGFyZWRVdGlsLlBlcm1pc3Npb25GbGFnOwogICAgZXhwb3J0cy5VbmV4cGVjdGVkUmVzcG9uc2VFeGNlcHRpb24gPSBwZGZqc1NoYXJlZFV0aWwuVW5leHBlY3RlZFJlc3BvbnNlRXhjZXB0aW9uOwogICAgZXhwb3J0cy5PUFMgPSBwZGZqc1NoYXJlZFV0aWwuT1BTOwogICAgZXhwb3J0cy5WZXJib3NpdHlMZXZlbCA9IHBkZmpzU2hhcmVkVXRpbC5WZXJib3NpdHlMZXZlbDsKICAgIGV4cG9ydHMuVU5TVVBQT1JURURfRkVBVFVSRVMgPSBwZGZqc1NoYXJlZFV0aWwuVU5TVVBQT1JURURfRkVBVFVSRVM7CiAgICBleHBvcnRzLmNyZWF0ZVZhbGlkQWJzb2x1dGVVcmwgPSBwZGZqc1NoYXJlZFV0aWwuY3JlYXRlVmFsaWRBYnNvbHV0ZVVybDsKICAgIGV4cG9ydHMuY3JlYXRlT2JqZWN0VVJMID0gcGRmanNTaGFyZWRVdGlsLmNyZWF0ZU9iamVjdFVSTDsKICAgIGV4cG9ydHMucmVtb3ZlTnVsbENoYXJhY3RlcnMgPSBwZGZqc1NoYXJlZFV0aWwucmVtb3ZlTnVsbENoYXJhY3RlcnM7CiAgICBleHBvcnRzLnNoYWRvdyA9IHBkZmpzU2hhcmVkVXRpbC5zaGFkb3c7CiAgICBleHBvcnRzLlV0aWwgPSBwZGZqc1NoYXJlZFV0aWwuVXRpbDsKICAgIGV4cG9ydHMuUmVuZGVyaW5nQ2FuY2VsbGVkRXhjZXB0aW9uID0gcGRmanNEaXNwbGF5RGlzcGxheVV0aWxzLlJlbmRlcmluZ0NhbmNlbGxlZEV4Y2VwdGlvbjsKICAgIGV4cG9ydHMuZ2V0RmlsZW5hbWVGcm9tVXJsID0gcGRmanNEaXNwbGF5RGlzcGxheVV0aWxzLmdldEZpbGVuYW1lRnJvbVVybDsKICAgIGV4cG9ydHMuTGlua1RhcmdldCA9IHBkZmpzRGlzcGxheURpc3BsYXlVdGlscy5MaW5rVGFyZ2V0OwogICAgZXhwb3J0cy5hZGRMaW5rQXR0cmlidXRlcyA9IHBkZmpzRGlzcGxheURpc3BsYXlVdGlscy5hZGRMaW5rQXR0cmlidXRlczsKICAgIGV4cG9ydHMubG9hZFNjcmlwdCA9IHBkZmpzRGlzcGxheURpc3BsYXlVdGlscy5sb2FkU2NyaXB0OwogICAgZXhwb3J0cy5QREZEYXRlU3RyaW5nID0gcGRmanNEaXNwbGF5RGlzcGxheVV0aWxzLlBERkRhdGVTdHJpbmc7CiAgICBleHBvcnRzLkdsb2JhbFdvcmtlck9wdGlvbnMgPSBwZGZqc0Rpc3BsYXlXb3JrZXJPcHRpb25zLkdsb2JhbFdvcmtlck9wdGlvbnM7CiAgICBleHBvcnRzLmFwaUNvbXBhdGliaWxpdHlQYXJhbXMgPSBwZGZqc0Rpc3BsYXlBUElDb21wYXRpYmlsaXR5LmFwaUNvbXBhdGliaWxpdHlQYXJhbXM7CgogICAgLyoqKi99KSwgKAogIC8qIDEgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgoKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgICAgdmFsdWU6IHRydWUKICAgIH0pOwogICAgZXhwb3J0cy5hcnJheUJ5dGVMZW5ndGggPSBhcnJheUJ5dGVMZW5ndGg7CiAgICBleHBvcnRzLmFycmF5c1RvQnl0ZXMgPSBhcnJheXNUb0J5dGVzOwogICAgZXhwb3J0cy5hc3NlcnQgPSBhc3NlcnQ7CiAgICBleHBvcnRzLmJ5dGVzVG9TdHJpbmcgPSBieXRlc1RvU3RyaW5nOwogICAgZXhwb3J0cy5jcmVhdGVQcm9taXNlQ2FwYWJpbGl0eSA9IGNyZWF0ZVByb21pc2VDYXBhYmlsaXR5OwogICAgZXhwb3J0cy5nZXRWZXJib3NpdHlMZXZlbCA9IGdldFZlcmJvc2l0eUxldmVsOwogICAgZXhwb3J0cy5pbmZvID0gaW5mbzsKICAgIGV4cG9ydHMuaXNBcnJheUJ1ZmZlciA9IGlzQXJyYXlCdWZmZXI7CiAgICBleHBvcnRzLmlzQXJyYXlFcXVhbCA9IGlzQXJyYXlFcXVhbDsKICAgIGV4cG9ydHMuaXNCb29sID0gaXNCb29sOwogICAgZXhwb3J0cy5pc0VtcHR5T2JqID0gaXNFbXB0eU9iajsKICAgIGV4cG9ydHMuaXNOdW0gPSBpc051bTsKICAgIGV4cG9ydHMuaXNTdHJpbmcgPSBpc1N0cmluZzsKICAgIGV4cG9ydHMuaXNTYW1lT3JpZ2luID0gaXNTYW1lT3JpZ2luOwogICAgZXhwb3J0cy5jcmVhdGVWYWxpZEFic29sdXRlVXJsID0gY3JlYXRlVmFsaWRBYnNvbHV0ZVVybDsKICAgIGV4cG9ydHMucmVtb3ZlTnVsbENoYXJhY3RlcnMgPSByZW1vdmVOdWxsQ2hhcmFjdGVyczsKICAgIGV4cG9ydHMuc2V0VmVyYm9zaXR5TGV2ZWwgPSBzZXRWZXJib3NpdHlMZXZlbDsKICAgIGV4cG9ydHMuc2hhZG93ID0gc2hhZG93OwogICAgZXhwb3J0cy5zdHJpbmczMiA9IHN0cmluZzMyOwogICAgZXhwb3J0cy5zdHJpbmdUb0J5dGVzID0gc3RyaW5nVG9CeXRlczsKICAgIGV4cG9ydHMuc3RyaW5nVG9QREZTdHJpbmcgPSBzdHJpbmdUb1BERlN0cmluZzsKICAgIGV4cG9ydHMuc3RyaW5nVG9VVEY4U3RyaW5nID0gc3RyaW5nVG9VVEY4U3RyaW5nOwogICAgZXhwb3J0cy51dGY4U3RyaW5nVG9TdHJpbmcgPSB1dGY4U3RyaW5nVG9TdHJpbmc7CiAgICBleHBvcnRzLndhcm4gPSB3YXJuOwogICAgZXhwb3J0cy51bnJlYWNoYWJsZSA9IHVucmVhY2hhYmxlOwogICAgZXhwb3J0cy5Jc0V2YWxTdXBwb3J0ZWRDYWNoZWQgPSBleHBvcnRzLklzTGl0dGxlRW5kaWFuQ2FjaGVkID0gZXhwb3J0cy5jcmVhdGVPYmplY3RVUkwgPSBleHBvcnRzLkZvcm1hdEVycm9yID0gZXhwb3J0cy5VdGlsID0gZXhwb3J0cy5Vbmtub3duRXJyb3JFeGNlcHRpb24gPSBleHBvcnRzLlVuZXhwZWN0ZWRSZXNwb25zZUV4Y2VwdGlvbiA9IGV4cG9ydHMuVGV4dFJlbmRlcmluZ01vZGUgPSBleHBvcnRzLlN0cmVhbVR5cGUgPSBleHBvcnRzLlBlcm1pc3Npb25GbGFnID0gZXhwb3J0cy5QYXNzd29yZFJlc3BvbnNlcyA9IGV4cG9ydHMuUGFzc3dvcmRFeGNlcHRpb24gPSBleHBvcnRzLk5hdGl2ZUltYWdlRGVjb2RpbmcgPSBleHBvcnRzLk1pc3NpbmdQREZFeGNlcHRpb24gPSBleHBvcnRzLkludmFsaWRQREZFeGNlcHRpb24gPSBleHBvcnRzLkFib3J0RXhjZXB0aW9uID0gZXhwb3J0cy5DTWFwQ29tcHJlc3Npb25UeXBlID0gZXhwb3J0cy5JbWFnZUtpbmQgPSBleHBvcnRzLkZvbnRUeXBlID0gZXhwb3J0cy5Bbm5vdGF0aW9uVHlwZSA9IGV4cG9ydHMuQW5ub3RhdGlvblN0YXRlTW9kZWxUeXBlID0gZXhwb3J0cy5Bbm5vdGF0aW9uUmV2aWV3U3RhdGUgPSBleHBvcnRzLkFubm90YXRpb25SZXBseVR5cGUgPSBleHBvcnRzLkFubm90YXRpb25NYXJrZWRTdGF0ZSA9IGV4cG9ydHMuQW5ub3RhdGlvbkZsYWcgPSBleHBvcnRzLkFubm90YXRpb25GaWVsZEZsYWcgPSBleHBvcnRzLkFubm90YXRpb25Cb3JkZXJTdHlsZVR5cGUgPSBleHBvcnRzLlVOU1VQUE9SVEVEX0ZFQVRVUkVTID0gZXhwb3J0cy5WZXJib3NpdHlMZXZlbCA9IGV4cG9ydHMuT1BTID0gZXhwb3J0cy5JREVOVElUWV9NQVRSSVggPSBleHBvcnRzLkZPTlRfSURFTlRJVFlfTUFUUklYID0gZXhwb3J0cy5CYXNlRXhjZXB0aW9uID0gdm9pZCAwOwoKICAgIF9fd19wZGZqc19yZXF1aXJlX18oMik7CgogICAgZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykge2ZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHt2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldO2Rlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTtkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7aWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7T2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpO319CgogICAgZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykge2lmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpO2lmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTtyZXR1cm4gQ29uc3RydWN0b3I7fQoKICAgIGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mIjtpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAic3ltYm9sIikge190eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikge3JldHVybiB0eXBlb2Ygb2JqO307fSBlbHNlIHtfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHtyZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqO307fXJldHVybiBfdHlwZW9mKG9iaik7fQoKICAgIGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHtpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpO319CgogICAgZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkge2lmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHtyZXR1cm4gY2FsbDt9cmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7fQoKICAgIGZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikge2lmIChzZWxmID09PSB2b2lkIDApIHt0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpO31yZXR1cm4gc2VsZjt9CgogICAgZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHtfZ2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3QuZ2V0UHJvdG90eXBlT2YgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2Yobykge3JldHVybiBvLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2Yobyk7fTtyZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pO30KCiAgICBmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHtpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkge3Rocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7fXN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTtpZiAoc3VwZXJDbGFzcykgX3NldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKTt9CgogICAgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHtfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHtvLl9fcHJvdG9fXyA9IHA7cmV0dXJuIG87fTtyZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApO30KCiAgICB2YXIgSURFTlRJVFlfTUFUUklYID0gWzEsIDAsIDAsIDEsIDAsIDBdOwogICAgZXhwb3J0cy5JREVOVElUWV9NQVRSSVggPSBJREVOVElUWV9NQVRSSVg7CiAgICB2YXIgRk9OVF9JREVOVElUWV9NQVRSSVggPSBbMC4wMDEsIDAsIDAsIDAuMDAxLCAwLCAwXTsKICAgIGV4cG9ydHMuRk9OVF9JREVOVElUWV9NQVRSSVggPSBGT05UX0lERU5USVRZX01BVFJJWDsKICAgIHZhciBOYXRpdmVJbWFnZURlY29kaW5nID0gewogICAgICBOT05FOiAibm9uZSIsCiAgICAgIERFQ09ERTogImRlY29kZSIsCiAgICAgIERJU1BMQVk6ICJkaXNwbGF5IgogICAgfTsKICAgIGV4cG9ydHMuTmF0aXZlSW1hZ2VEZWNvZGluZyA9IE5hdGl2ZUltYWdlRGVjb2Rpbmc7CiAgICB2YXIgUGVybWlzc2lvbkZsYWcgPSB7CiAgICAgIFBSSU5UOiAweDA0LAogICAgICBNT0RJRllfQ09OVEVOVFM6IDB4MDgsCiAgICAgIENPUFk6IDB4MTAsCiAgICAgIE1PRElGWV9BTk5PVEFUSU9OUzogMHgyMCwKICAgICAgRklMTF9JTlRFUkFDVElWRV9GT1JNUzogMHgxMDAsCiAgICAgIENPUFlfRk9SX0FDQ0VTU0lCSUxJVFk6IDB4MjAwLAogICAgICBBU1NFTUJMRTogMHg0MDAsCiAgICAgIFBSSU5UX0hJR0hfUVVBTElUWTogMHg4MDAKICAgIH07CiAgICBleHBvcnRzLlBlcm1pc3Npb25GbGFnID0gUGVybWlzc2lvbkZsYWc7CiAgICB2YXIgVGV4dFJlbmRlcmluZ01vZGUgPSB7CiAgICAgIEZJTEw6IDAsCiAgICAgIFNUUk9LRTogMSwKICAgICAgRklMTF9TVFJPS0U6IDIsCiAgICAgIElOVklTSUJMRTogMywKICAgICAgRklMTF9BRERfVE9fUEFUSDogNCwKICAgICAgU1RST0tFX0FERF9UT19QQVRIOiA1LAogICAgICBGSUxMX1NUUk9LRV9BRERfVE9fUEFUSDogNiwKICAgICAgQUREX1RPX1BBVEg6IDcsCiAgICAgIEZJTExfU1RST0tFX01BU0s6IDMsCiAgICAgIEFERF9UT19QQVRIX0ZMQUc6IDQKICAgIH07CiAgICBleHBvcnRzLlRleHRSZW5kZXJpbmdNb2RlID0gVGV4dFJlbmRlcmluZ01vZGU7CiAgICB2YXIgSW1hZ2VLaW5kID0gewogICAgICBHUkFZU0NBTEVfMUJQUDogMSwKICAgICAgUkdCXzI0QlBQOiAyLAogICAgICBSR0JBXzMyQlBQOiAzCiAgICB9OwogICAgZXhwb3J0cy5JbWFnZUtpbmQgPSBJbWFnZUtpbmQ7CiAgICB2YXIgQW5ub3RhdGlvblR5cGUgPSB7CiAgICAgIFRFWFQ6IDEsCiAgICAgIExJTks6IDIsCiAgICAgIEZSRUVURVhUOiAzLAogICAgICBMSU5FOiA0LAogICAgICBTUVVBUkU6IDUsCiAgICAgIENJUkNMRTogNiwKICAgICAgUE9MWUdPTjogNywKICAgICAgUE9MWUxJTkU6IDgsCiAgICAgIEhJR0hMSUdIVDogOSwKICAgICAgVU5ERVJMSU5FOiAxMCwKICAgICAgU1FVSUdHTFk6IDExLAogICAgICBTVFJJS0VPVVQ6IDEyLAogICAgICBTVEFNUDogMTMsCiAgICAgIENBUkVUOiAxNCwKICAgICAgSU5LOiAxNSwKICAgICAgUE9QVVA6IDE2LAogICAgICBGSUxFQVRUQUNITUVOVDogMTcsCiAgICAgIFNPVU5EOiAxOCwKICAgICAgTU9WSUU6IDE5LAogICAgICBXSURHRVQ6IDIwLAogICAgICBTQ1JFRU46IDIxLAogICAgICBQUklOVEVSTUFSSzogMjIsCiAgICAgIFRSQVBORVQ6IDIzLAogICAgICBXQVRFUk1BUks6IDI0LAogICAgICBUSFJFRUQ6IDI1LAogICAgICBSRURBQ1Q6IDI2CiAgICB9OwogICAgZXhwb3J0cy5Bbm5vdGF0aW9uVHlwZSA9IEFubm90YXRpb25UeXBlOwogICAgdmFyIEFubm90YXRpb25TdGF0ZU1vZGVsVHlwZSA9IHsKICAgICAgTUFSS0VEOiAiTWFya2VkIiwKICAgICAgUkVWSUVXOiAiUmV2aWV3IgogICAgfTsKICAgIGV4cG9ydHMuQW5ub3RhdGlvblN0YXRlTW9kZWxUeXBlID0gQW5ub3RhdGlvblN0YXRlTW9kZWxUeXBlOwogICAgdmFyIEFubm90YXRpb25NYXJrZWRTdGF0ZSA9IHsKICAgICAgTUFSS0VEOiAiTWFya2VkIiwKICAgICAgVU5NQVJLRUQ6ICJVbm1hcmtlZCIKICAgIH07CiAgICBleHBvcnRzLkFubm90YXRpb25NYXJrZWRTdGF0ZSA9IEFubm90YXRpb25NYXJrZWRTdGF0ZTsKICAgIHZhciBBbm5vdGF0aW9uUmV2aWV3U3RhdGUgPSB7CiAgICAgIEFDQ0VQVEVEOiAiQWNjZXB0ZWQiLAogICAgICBSRUpFQ1RFRDogIlJlamVjdGVkIiwKICAgICAgQ0FOQ0VMTEVEOiAiQ2FuY2VsbGVkIiwKICAgICAgQ09NUExFVEVEOiAiQ29tcGxldGVkIiwKICAgICAgTk9ORTogIk5vbmUiCiAgICB9OwogICAgZXhwb3J0cy5Bbm5vdGF0aW9uUmV2aWV3U3RhdGUgPSBBbm5vdGF0aW9uUmV2aWV3U3RhdGU7CiAgICB2YXIgQW5ub3RhdGlvblJlcGx5VHlwZSA9IHsKICAgICAgR1JPVVA6ICJHcm91cCIsCiAgICAgIFJFUExZOiAiUiIKICAgIH07CiAgICBleHBvcnRzLkFubm90YXRpb25SZXBseVR5cGUgPSBBbm5vdGF0aW9uUmVwbHlUeXBlOwogICAgdmFyIEFubm90YXRpb25GbGFnID0gewogICAgICBJTlZJU0lCTEU6IDB4MDEsCiAgICAgIEhJRERFTjogMHgwMiwKICAgICAgUFJJTlQ6IDB4MDQsCiAgICAgIE5PWk9PTTogMHgwOCwKICAgICAgTk9ST1RBVEU6IDB4MTAsCiAgICAgIE5PVklFVzogMHgyMCwKICAgICAgUkVBRE9OTFk6IDB4NDAsCiAgICAgIExPQ0tFRDogMHg4MCwKICAgICAgVE9HR0xFTk9WSUVXOiAweDEwMCwKICAgICAgTE9DS0VEQ09OVEVOVFM6IDB4MjAwCiAgICB9OwogICAgZXhwb3J0cy5Bbm5vdGF0aW9uRmxhZyA9IEFubm90YXRpb25GbGFnOwogICAgdmFyIEFubm90YXRpb25GaWVsZEZsYWcgPSB7CiAgICAgIFJFQURPTkxZOiAweDAwMDAwMDEsCiAgICAgIFJFUVVJUkVEOiAweDAwMDAwMDIsCiAgICAgIE5PRVhQT1JUOiAweDAwMDAwMDQsCiAgICAgIE1VTFRJTElORTogMHgwMDAxMDAwLAogICAgICBQQVNTV09SRDogMHgwMDAyMDAwLAogICAgICBOT1RPR0dMRVRPT0ZGOiAweDAwMDQwMDAsCiAgICAgIFJBRElPOiAweDAwMDgwMDAsCiAgICAgIFBVU0hCVVRUT046IDB4MDAxMDAwMCwKICAgICAgQ09NQk86IDB4MDAyMDAwMCwKICAgICAgRURJVDogMHgwMDQwMDAwLAogICAgICBTT1JUOiAweDAwODAwMDAsCiAgICAgIEZJTEVTRUxFQ1Q6IDB4MDEwMDAwMCwKICAgICAgTVVMVElTRUxFQ1Q6IDB4MDIwMDAwMCwKICAgICAgRE9OT1RTUEVMTENIRUNLOiAweDA0MDAwMDAsCiAgICAgIERPTk9UU0NST0xMOiAweDA4MDAwMDAsCiAgICAgIENPTUI6IDB4MTAwMDAwMCwKICAgICAgUklDSFRFWFQ6IDB4MjAwMDAwMCwKICAgICAgUkFESU9TSU5VTklTT046IDB4MjAwMDAwMCwKICAgICAgQ09NTUlUT05TRUxDSEFOR0U6IDB4NDAwMDAwMAogICAgfTsKICAgIGV4cG9ydHMuQW5ub3RhdGlvbkZpZWxkRmxhZyA9IEFubm90YXRpb25GaWVsZEZsYWc7CiAgICB2YXIgQW5ub3RhdGlvbkJvcmRlclN0eWxlVHlwZSA9IHsKICAgICAgU09MSUQ6IDEsCiAgICAgIERBU0hFRDogMiwKICAgICAgQkVWRUxFRDogMywKICAgICAgSU5TRVQ6IDQsCiAgICAgIFVOREVSTElORTogNQogICAgfTsKICAgIGV4cG9ydHMuQW5ub3RhdGlvbkJvcmRlclN0eWxlVHlwZSA9IEFubm90YXRpb25Cb3JkZXJTdHlsZVR5cGU7CiAgICB2YXIgU3RyZWFtVHlwZSA9IHsKICAgICAgVU5LTk9XTjogIlVOS05PV04iLAogICAgICBGTEFURTogIkZMQVRFIiwKICAgICAgTFpXOiAiTFpXIiwKICAgICAgRENUOiAiRENUIiwKICAgICAgSlBYOiAiSlBYIiwKICAgICAgSkJJRzogIkpCSUciLAogICAgICBBODU6ICJBODUiLAogICAgICBBSFg6ICJBSFgiLAogICAgICBDQ0Y6ICJDQ0YiLAogICAgICBSTFg6ICJSTFgiCiAgICB9OwogICAgZXhwb3J0cy5TdHJlYW1UeXBlID0gU3RyZWFtVHlwZTsKICAgIHZhciBGb250VHlwZSA9IHsKICAgICAgVU5LTk9XTjogIlVOS05PV04iLAogICAgICBUWVBFMTogIlRZUEUxIiwKICAgICAgVFlQRTFDOiAiVFlQRTFDIiwKICAgICAgQ0lERk9OVFRZUEUwOiAiQ0lERk9OVFRZUEUwIiwKICAgICAgQ0lERk9OVFRZUEUwQzogIkNJREZPTlRUWVBFMEMiLAogICAgICBUUlVFVFlQRTogIlRSVUVUWVBFIiwKICAgICAgQ0lERk9OVFRZUEUyOiAiQ0lERk9OVFRZUEUyIiwKICAgICAgVFlQRTM6ICJUWVBFMyIsCiAgICAgIE9QRU5UWVBFOiAiT1BFTlRZUEUiLAogICAgICBUWVBFMDogIlRZUEUwIiwKICAgICAgTU1UWVBFMTogIk1NVFlQRTEiCiAgICB9OwogICAgZXhwb3J0cy5Gb250VHlwZSA9IEZvbnRUeXBlOwogICAgdmFyIFZlcmJvc2l0eUxldmVsID0gewogICAgICBFUlJPUlM6IDAsCiAgICAgIFdBUk5JTkdTOiAxLAogICAgICBJTkZPUzogNQogICAgfTsKICAgIGV4cG9ydHMuVmVyYm9zaXR5TGV2ZWwgPSBWZXJib3NpdHlMZXZlbDsKICAgIHZhciBDTWFwQ29tcHJlc3Npb25UeXBlID0gewogICAgICBOT05FOiAwLAogICAgICBCSU5BUlk6IDEsCiAgICAgIFNUUkVBTTogMgogICAgfTsKICAgIGV4cG9ydHMuQ01hcENvbXByZXNzaW9uVHlwZSA9IENNYXBDb21wcmVzc2lvblR5cGU7CiAgICB2YXIgT1BTID0gewogICAgICBkZXBlbmRlbmN5OiAxLAogICAgICBzZXRMaW5lV2lkdGg6IDIsCiAgICAgIHNldExpbmVDYXA6IDMsCiAgICAgIHNldExpbmVKb2luOiA0LAogICAgICBzZXRNaXRlckxpbWl0OiA1LAogICAgICBzZXREYXNoOiA2LAogICAgICBzZXRSZW5kZXJpbmdJbnRlbnQ6IDcsCiAgICAgIHNldEZsYXRuZXNzOiA4LAogICAgICBzZXRHU3RhdGU6IDksCiAgICAgIHNhdmU6IDEwLAogICAgICByZXN0b3JlOiAxMSwKICAgICAgdHJhbnNmb3JtOiAxMiwKICAgICAgbW92ZVRvOiAxMywKICAgICAgbGluZVRvOiAxNCwKICAgICAgY3VydmVUbzogMTUsCiAgICAgIGN1cnZlVG8yOiAxNiwKICAgICAgY3VydmVUbzM6IDE3LAogICAgICBjbG9zZVBhdGg6IDE4LAogICAgICByZWN0YW5nbGU6IDE5LAogICAgICBzdHJva2U6IDIwLAogICAgICBjbG9zZVN0cm9rZTogMjEsCiAgICAgIGZpbGw6IDIyLAogICAgICBlb0ZpbGw6IDIzLAogICAgICBmaWxsU3Ryb2tlOiAyNCwKICAgICAgZW9GaWxsU3Ryb2tlOiAyNSwKICAgICAgY2xvc2VGaWxsU3Ryb2tlOiAyNiwKICAgICAgY2xvc2VFT0ZpbGxTdHJva2U6IDI3LAogICAgICBlbmRQYXRoOiAyOCwKICAgICAgY2xpcDogMjksCiAgICAgIGVvQ2xpcDogMzAsCiAgICAgIGJlZ2luVGV4dDogMzEsCiAgICAgIGVuZFRleHQ6IDMyLAogICAgICBzZXRDaGFyU3BhY2luZzogMzMsCiAgICAgIHNldFdvcmRTcGFjaW5nOiAzNCwKICAgICAgc2V0SFNjYWxlOiAzNSwKICAgICAgc2V0TGVhZGluZzogMzYsCiAgICAgIHNldEZvbnQ6IDM3LAogICAgICBzZXRUZXh0UmVuZGVyaW5nTW9kZTogMzgsCiAgICAgIHNldFRleHRSaXNlOiAzOSwKICAgICAgbW92ZVRleHQ6IDQwLAogICAgICBzZXRMZWFkaW5nTW92ZVRleHQ6IDQxLAogICAgICBzZXRUZXh0TWF0cml4OiA0MiwKICAgICAgbmV4dExpbmU6IDQzLAogICAgICBzaG93VGV4dDogNDQsCiAgICAgIHNob3dTcGFjZWRUZXh0OiA0NSwKICAgICAgbmV4dExpbmVTaG93VGV4dDogNDYsCiAgICAgIG5leHRMaW5lU2V0U3BhY2luZ1Nob3dUZXh0OiA0NywKICAgICAgc2V0Q2hhcldpZHRoOiA0OCwKICAgICAgc2V0Q2hhcldpZHRoQW5kQm91bmRzOiA0OSwKICAgICAgc2V0U3Ryb2tlQ29sb3JTcGFjZTogNTAsCiAgICAgIHNldEZpbGxDb2xvclNwYWNlOiA1MSwKICAgICAgc2V0U3Ryb2tlQ29sb3I6IDUyLAogICAgICBzZXRTdHJva2VDb2xvck46IDUzLAogICAgICBzZXRGaWxsQ29sb3I6IDU0LAogICAgICBzZXRGaWxsQ29sb3JOOiA1NSwKICAgICAgc2V0U3Ryb2tlR3JheTogNTYsCiAgICAgIHNldEZpbGxHcmF5OiA1NywKICAgICAgc2V0U3Ryb2tlUkdCQ29sb3I6IDU4LAogICAgICBzZXRGaWxsUkdCQ29sb3I6IDU5LAogICAgICBzZXRTdHJva2VDTVlLQ29sb3I6IDYwLAogICAgICBzZXRGaWxsQ01ZS0NvbG9yOiA2MSwKICAgICAgc2hhZGluZ0ZpbGw6IDYyLAogICAgICBiZWdpbklubGluZUltYWdlOiA2MywKICAgICAgYmVnaW5JbWFnZURhdGE6IDY0LAogICAgICBlbmRJbmxpbmVJbWFnZTogNjUsCiAgICAgIHBhaW50WE9iamVjdDogNjYsCiAgICAgIG1hcmtQb2ludDogNjcsCiAgICAgIG1hcmtQb2ludFByb3BzOiA2OCwKICAgICAgYmVnaW5NYXJrZWRDb250ZW50OiA2OSwKICAgICAgYmVnaW5NYXJrZWRDb250ZW50UHJvcHM6IDcwLAogICAgICBlbmRNYXJrZWRDb250ZW50OiA3MSwKICAgICAgYmVnaW5Db21wYXQ6IDcyLAogICAgICBlbmRDb21wYXQ6IDczLAogICAgICBwYWludEZvcm1YT2JqZWN0QmVnaW46IDc0LAogICAgICBwYWludEZvcm1YT2JqZWN0RW5kOiA3NSwKICAgICAgYmVnaW5Hcm91cDogNzYsCiAgICAgIGVuZEdyb3VwOiA3NywKICAgICAgYmVnaW5Bbm5vdGF0aW9uczogNzgsCiAgICAgIGVuZEFubm90YXRpb25zOiA3OSwKICAgICAgYmVnaW5Bbm5vdGF0aW9uOiA4MCwKICAgICAgZW5kQW5ub3RhdGlvbjogODEsCiAgICAgIHBhaW50SnBlZ1hPYmplY3Q6IDgyLAogICAgICBwYWludEltYWdlTWFza1hPYmplY3Q6IDgzLAogICAgICBwYWludEltYWdlTWFza1hPYmplY3RHcm91cDogODQsCiAgICAgIHBhaW50SW1hZ2VYT2JqZWN0OiA4NSwKICAgICAgcGFpbnRJbmxpbmVJbWFnZVhPYmplY3Q6IDg2LAogICAgICBwYWludElubGluZUltYWdlWE9iamVjdEdyb3VwOiA4NywKICAgICAgcGFpbnRJbWFnZVhPYmplY3RSZXBlYXQ6IDg4LAogICAgICBwYWludEltYWdlTWFza1hPYmplY3RSZXBlYXQ6IDg5LAogICAgICBwYWludFNvbGlkQ29sb3JJbWFnZU1hc2s6IDkwLAogICAgICBjb25zdHJ1Y3RQYXRoOiA5MQogICAgfTsKICAgIGV4cG9ydHMuT1BTID0gT1BTOwogICAgdmFyIFVOU1VQUE9SVEVEX0ZFQVRVUkVTID0gewogICAgICB1bmtub3duOiAidW5rbm93biIsCiAgICAgIGZvcm1zOiAiZm9ybXMiLAogICAgICBqYXZhU2NyaXB0OiAiamF2YVNjcmlwdCIsCiAgICAgIHNtYXNrOiAic21hc2siLAogICAgICBzaGFkaW5nUGF0dGVybjogInNoYWRpbmdQYXR0ZXJuIiwKICAgICAgZm9udDogImZvbnQiCiAgICB9OwogICAgZXhwb3J0cy5VTlNVUFBPUlRFRF9GRUFUVVJFUyA9IFVOU1VQUE9SVEVEX0ZFQVRVUkVTOwogICAgdmFyIFBhc3N3b3JkUmVzcG9uc2VzID0gewogICAgICBORUVEX1BBU1NXT1JEOiAxLAogICAgICBJTkNPUlJFQ1RfUEFTU1dPUkQ6IDIKICAgIH07CiAgICBleHBvcnRzLlBhc3N3b3JkUmVzcG9uc2VzID0gUGFzc3dvcmRSZXNwb25zZXM7CiAgICB2YXIgdmVyYm9zaXR5ID0gVmVyYm9zaXR5TGV2ZWwuV0FSTklOR1M7CgogICAgZnVuY3Rpb24gc2V0VmVyYm9zaXR5TGV2ZWwobGV2ZWwpIHsKICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIobGV2ZWwpKSB7CiAgICAgICAgdmVyYm9zaXR5ID0gbGV2ZWw7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBnZXRWZXJib3NpdHlMZXZlbCgpIHsKICAgICAgcmV0dXJuIHZlcmJvc2l0eTsKICAgIH0KCiAgICBmdW5jdGlvbiBpbmZvKG1zZykgewogICAgICBpZiAodmVyYm9zaXR5ID49IFZlcmJvc2l0eUxldmVsLklORk9TKSB7CiAgICAgICAgY29uc29sZS5sb2coIkluZm86ICIuY29uY2F0KG1zZykpOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gd2Fybihtc2cpIHsKICAgICAgaWYgKHZlcmJvc2l0eSA+PSBWZXJib3NpdHlMZXZlbC5XQVJOSU5HUykgewogICAgICAgIGNvbnNvbGUubG9nKCJXYXJuaW5nOiAiLmNvbmNhdChtc2cpKTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHVucmVhY2hhYmxlKG1zZykgewogICAgICB0aHJvdyBuZXcgRXJyb3IobXNnKTsKICAgIH0KCiAgICBmdW5jdGlvbiBhc3NlcnQoY29uZCwgbXNnKSB7CiAgICAgIGlmICghY29uZCkgewogICAgICAgIHVucmVhY2hhYmxlKG1zZyk7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBpc1NhbWVPcmlnaW4oYmFzZVVybCwgb3RoZXJVcmwpIHsKICAgICAgdmFyIGJhc2U7CgogICAgICB0cnkgewogICAgICAgIGJhc2UgPSBuZXcgVVJMKGJhc2VVcmwpOwoKICAgICAgICBpZiAoIWJhc2Uub3JpZ2luIHx8IGJhc2Uub3JpZ2luID09PSAibnVsbCIpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHZhciBvdGhlciA9IG5ldyBVUkwob3RoZXJVcmwsIGJhc2UpOwogICAgICByZXR1cm4gYmFzZS5vcmlnaW4gPT09IG90aGVyLm9yaWdpbjsKICAgIH0KCiAgICBmdW5jdGlvbiBfaXNWYWxpZFByb3RvY29sKHVybCkgewogICAgICBpZiAoIXVybCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgc3dpdGNoICh1cmwucHJvdG9jb2wpIHsKICAgICAgICBjYXNlICJodHRwOiI6CiAgICAgICAgY2FzZSAiaHR0cHM6IjoKICAgICAgICBjYXNlICJmdHA6IjoKICAgICAgICBjYXNlICJtYWlsdG86IjoKICAgICAgICBjYXNlICJ0ZWw6IjoKICAgICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gY3JlYXRlVmFsaWRBYnNvbHV0ZVVybCh1cmwsIGJhc2VVcmwpIHsKICAgICAgaWYgKCF1cmwpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgdHJ5IHsKICAgICAgICB2YXIgYWJzb2x1dGVVcmwgPSBiYXNlVXJsID8gbmV3IFVSTCh1cmwsIGJhc2VVcmwpIDogbmV3IFVSTCh1cmwpOwoKICAgICAgICBpZiAoX2lzVmFsaWRQcm90b2NvbChhYnNvbHV0ZVVybCkpIHsKICAgICAgICAgIHJldHVybiBhYnNvbHV0ZVVybDsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGV4KSB7fQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgZnVuY3Rpb24gc2hhZG93KG9iaiwgcHJvcCwgdmFsdWUpIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwgcHJvcCwgewogICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgICB3cml0YWJsZTogZmFsc2UKICAgICAgfSk7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KCiAgICB2YXIgQmFzZUV4Y2VwdGlvbiA9IGZ1bmN0aW9uIEJhc2VFeGNlcHRpb25DbG9zdXJlKCkgewogICAgICBmdW5jdGlvbiBCYXNlRXhjZXB0aW9uKG1lc3NhZ2UpIHsKICAgICAgICBpZiAodGhpcy5jb25zdHJ1Y3RvciA9PT0gQmFzZUV4Y2VwdGlvbikgewogICAgICAgICAgdW5yZWFjaGFibGUoIkNhbm5vdCBpbml0aWFsaXplIEJhc2VFeGNlcHRpb24uIik7CiAgICAgICAgfQoKICAgICAgICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlOwogICAgICAgIHRoaXMubmFtZSA9IHRoaXMuY29uc3RydWN0b3IubmFtZTsKICAgICAgfQoKICAgICAgQmFzZUV4Y2VwdGlvbi5wcm90b3R5cGUgPSBuZXcgRXJyb3IoKTsKICAgICAgQmFzZUV4Y2VwdGlvbi5jb25zdHJ1Y3RvciA9IEJhc2VFeGNlcHRpb247CiAgICAgIHJldHVybiBCYXNlRXhjZXB0aW9uOwogICAgfSgpOwoKICAgIGV4cG9ydHMuQmFzZUV4Y2VwdGlvbiA9IEJhc2VFeGNlcHRpb247CgogICAgdmFyIFBhc3N3b3JkRXhjZXB0aW9uID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQmFzZUV4Y2VwdGlvbikgewogICAgICBfaW5oZXJpdHMoUGFzc3dvcmRFeGNlcHRpb24sIF9CYXNlRXhjZXB0aW9uKTsKCiAgICAgIGZ1bmN0aW9uIFBhc3N3b3JkRXhjZXB0aW9uKG1zZywgY29kZSkgewogICAgICAgIHZhciBfdGhpczsKCiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFBhc3N3b3JkRXhjZXB0aW9uKTsKCiAgICAgICAgX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoUGFzc3dvcmRFeGNlcHRpb24pLmNhbGwodGhpcywgbXNnKSk7CiAgICAgICAgX3RoaXMuY29kZSA9IGNvZGU7CiAgICAgICAgcmV0dXJuIF90aGlzOwogICAgICB9CgogICAgICByZXR1cm4gUGFzc3dvcmRFeGNlcHRpb247CiAgICB9KEJhc2VFeGNlcHRpb24pOwoKICAgIGV4cG9ydHMuUGFzc3dvcmRFeGNlcHRpb24gPSBQYXNzd29yZEV4Y2VwdGlvbjsKCiAgICB2YXIgVW5rbm93bkVycm9yRXhjZXB0aW9uID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQmFzZUV4Y2VwdGlvbjIpIHsKICAgICAgX2luaGVyaXRzKFVua25vd25FcnJvckV4Y2VwdGlvbiwgX0Jhc2VFeGNlcHRpb24yKTsKCiAgICAgIGZ1bmN0aW9uIFVua25vd25FcnJvckV4Y2VwdGlvbihtc2csIGRldGFpbHMpIHsKICAgICAgICB2YXIgX3RoaXMyOwoKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgVW5rbm93bkVycm9yRXhjZXB0aW9uKTsKCiAgICAgICAgX3RoaXMyID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKFVua25vd25FcnJvckV4Y2VwdGlvbikuY2FsbCh0aGlzLCBtc2cpKTsKICAgICAgICBfdGhpczIuZGV0YWlscyA9IGRldGFpbHM7CiAgICAgICAgcmV0dXJuIF90aGlzMjsKICAgICAgfQoKICAgICAgcmV0dXJuIFVua25vd25FcnJvckV4Y2VwdGlvbjsKICAgIH0oQmFzZUV4Y2VwdGlvbik7CgogICAgZXhwb3J0cy5Vbmtub3duRXJyb3JFeGNlcHRpb24gPSBVbmtub3duRXJyb3JFeGNlcHRpb247CgogICAgdmFyIEludmFsaWRQREZFeGNlcHRpb24gPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9CYXNlRXhjZXB0aW9uMykgewogICAgICBfaW5oZXJpdHMoSW52YWxpZFBERkV4Y2VwdGlvbiwgX0Jhc2VFeGNlcHRpb24zKTsKCiAgICAgIGZ1bmN0aW9uIEludmFsaWRQREZFeGNlcHRpb24oKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEludmFsaWRQREZFeGNlcHRpb24pOwoKICAgICAgICByZXR1cm4gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKEludmFsaWRQREZFeGNlcHRpb24pLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpOwogICAgICB9CgogICAgICByZXR1cm4gSW52YWxpZFBERkV4Y2VwdGlvbjsKICAgIH0oQmFzZUV4Y2VwdGlvbik7CgogICAgZXhwb3J0cy5JbnZhbGlkUERGRXhjZXB0aW9uID0gSW52YWxpZFBERkV4Y2VwdGlvbjsKCiAgICB2YXIgTWlzc2luZ1BERkV4Y2VwdGlvbiA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0Jhc2VFeGNlcHRpb240KSB7CiAgICAgIF9pbmhlcml0cyhNaXNzaW5nUERGRXhjZXB0aW9uLCBfQmFzZUV4Y2VwdGlvbjQpOwoKICAgICAgZnVuY3Rpb24gTWlzc2luZ1BERkV4Y2VwdGlvbigpIHsKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgTWlzc2luZ1BERkV4Y2VwdGlvbik7CgogICAgICAgIHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoTWlzc2luZ1BERkV4Y2VwdGlvbikuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBNaXNzaW5nUERGRXhjZXB0aW9uOwogICAgfShCYXNlRXhjZXB0aW9uKTsKCiAgICBleHBvcnRzLk1pc3NpbmdQREZFeGNlcHRpb24gPSBNaXNzaW5nUERGRXhjZXB0aW9uOwoKICAgIHZhciBVbmV4cGVjdGVkUmVzcG9uc2VFeGNlcHRpb24gPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9CYXNlRXhjZXB0aW9uNSkgewogICAgICBfaW5oZXJpdHMoVW5leHBlY3RlZFJlc3BvbnNlRXhjZXB0aW9uLCBfQmFzZUV4Y2VwdGlvbjUpOwoKICAgICAgZnVuY3Rpb24gVW5leHBlY3RlZFJlc3BvbnNlRXhjZXB0aW9uKG1zZywgc3RhdHVzKSB7CiAgICAgICAgdmFyIF90aGlzMzsKCiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFVuZXhwZWN0ZWRSZXNwb25zZUV4Y2VwdGlvbik7CgogICAgICAgIF90aGlzMyA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihVbmV4cGVjdGVkUmVzcG9uc2VFeGNlcHRpb24pLmNhbGwodGhpcywgbXNnKSk7CiAgICAgICAgX3RoaXMzLnN0YXR1cyA9IHN0YXR1czsKICAgICAgICByZXR1cm4gX3RoaXMzOwogICAgICB9CgogICAgICByZXR1cm4gVW5leHBlY3RlZFJlc3BvbnNlRXhjZXB0aW9uOwogICAgfShCYXNlRXhjZXB0aW9uKTsKCiAgICBleHBvcnRzLlVuZXhwZWN0ZWRSZXNwb25zZUV4Y2VwdGlvbiA9IFVuZXhwZWN0ZWRSZXNwb25zZUV4Y2VwdGlvbjsKCiAgICB2YXIgRm9ybWF0RXJyb3IgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9CYXNlRXhjZXB0aW9uNikgewogICAgICBfaW5oZXJpdHMoRm9ybWF0RXJyb3IsIF9CYXNlRXhjZXB0aW9uNik7CgogICAgICBmdW5jdGlvbiBGb3JtYXRFcnJvcigpIHsKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRm9ybWF0RXJyb3IpOwoKICAgICAgICByZXR1cm4gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKEZvcm1hdEVycm9yKS5hcHBseSh0aGlzLCBhcmd1bWVudHMpKTsKICAgICAgfQoKICAgICAgcmV0dXJuIEZvcm1hdEVycm9yOwogICAgfShCYXNlRXhjZXB0aW9uKTsKCiAgICBleHBvcnRzLkZvcm1hdEVycm9yID0gRm9ybWF0RXJyb3I7CgogICAgdmFyIEFib3J0RXhjZXB0aW9uID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQmFzZUV4Y2VwdGlvbjcpIHsKICAgICAgX2luaGVyaXRzKEFib3J0RXhjZXB0aW9uLCBfQmFzZUV4Y2VwdGlvbjcpOwoKICAgICAgZnVuY3Rpb24gQWJvcnRFeGNlcHRpb24oKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEFib3J0RXhjZXB0aW9uKTsKCiAgICAgICAgcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihBYm9ydEV4Y2VwdGlvbikuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBBYm9ydEV4Y2VwdGlvbjsKICAgIH0oQmFzZUV4Y2VwdGlvbik7CgogICAgZXhwb3J0cy5BYm9ydEV4Y2VwdGlvbiA9IEFib3J0RXhjZXB0aW9uOwogICAgdmFyIE51bGxDaGFyYWN0ZXJzUmVnRXhwID0gL1x4MDAvZzsKCiAgICBmdW5jdGlvbiByZW1vdmVOdWxsQ2hhcmFjdGVycyhzdHIpIHsKICAgICAgaWYgKHR5cGVvZiBzdHIgIT09ICJzdHJpbmciKSB7CiAgICAgICAgd2FybigiVGhlIGFyZ3VtZW50IGZvciByZW1vdmVOdWxsQ2hhcmFjdGVycyBtdXN0IGJlIGEgc3RyaW5nLiIpOwogICAgICAgIHJldHVybiBzdHI7CiAgICAgIH0KCiAgICAgIHJldHVybiBzdHIucmVwbGFjZShOdWxsQ2hhcmFjdGVyc1JlZ0V4cCwgIiIpOwogICAgfQoKICAgIGZ1bmN0aW9uIGJ5dGVzVG9TdHJpbmcoYnl0ZXMpIHsKICAgICAgYXNzZXJ0KGJ5dGVzICE9PSBudWxsICYmIF90eXBlb2YoYnl0ZXMpID09PSAib2JqZWN0IiAmJiBieXRlcy5sZW5ndGggIT09IHVuZGVmaW5lZCwgIkludmFsaWQgYXJndW1lbnQgZm9yIGJ5dGVzVG9TdHJpbmciKTsKICAgICAgdmFyIGxlbmd0aCA9IGJ5dGVzLmxlbmd0aDsKICAgICAgdmFyIE1BWF9BUkdVTUVOVF9DT1VOVCA9IDgxOTI7CgogICAgICBpZiAobGVuZ3RoIDwgTUFYX0FSR1VNRU5UX0NPVU5UKSB7CiAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgYnl0ZXMpOwogICAgICB9CgogICAgICB2YXIgc3RyQnVmID0gW107CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSArPSBNQVhfQVJHVU1FTlRfQ09VTlQpIHsKICAgICAgICB2YXIgY2h1bmtFbmQgPSBNYXRoLm1pbihpICsgTUFYX0FSR1VNRU5UX0NPVU5ULCBsZW5ndGgpOwogICAgICAgIHZhciBjaHVuayA9IGJ5dGVzLnN1YmFycmF5KGksIGNodW5rRW5kKTsKICAgICAgICBzdHJCdWYucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIGNodW5rKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBzdHJCdWYuam9pbigiIik7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyaW5nVG9CeXRlcyhzdHIpIHsKICAgICAgYXNzZXJ0KHR5cGVvZiBzdHIgPT09ICJzdHJpbmciLCAiSW52YWxpZCBhcmd1bWVudCBmb3Igc3RyaW5nVG9CeXRlcyIpOwogICAgICB2YXIgbGVuZ3RoID0gc3RyLmxlbmd0aDsKICAgICAgdmFyIGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkobGVuZ3RoKTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHsKICAgICAgICBieXRlc1tpXSA9IHN0ci5jaGFyQ29kZUF0KGkpICYgMHhmZjsKICAgICAgfQoKICAgICAgcmV0dXJuIGJ5dGVzOwogICAgfQoKICAgIGZ1bmN0aW9uIGFycmF5Qnl0ZUxlbmd0aChhcnIpIHsKICAgICAgaWYgKGFyci5sZW5ndGggIT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiBhcnIubGVuZ3RoOwogICAgICB9CgogICAgICBhc3NlcnQoYXJyLmJ5dGVMZW5ndGggIT09IHVuZGVmaW5lZCk7CiAgICAgIHJldHVybiBhcnIuYnl0ZUxlbmd0aDsKICAgIH0KCiAgICBmdW5jdGlvbiBhcnJheXNUb0J5dGVzKGFycikgewogICAgICB2YXIgbGVuZ3RoID0gYXJyLmxlbmd0aDsKCiAgICAgIGlmIChsZW5ndGggPT09IDEgJiYgYXJyWzBdIGluc3RhbmNlb2YgVWludDhBcnJheSkgewogICAgICAgIHJldHVybiBhcnJbMF07CiAgICAgIH0KCiAgICAgIHZhciByZXN1bHRMZW5ndGggPSAwOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgIHJlc3VsdExlbmd0aCArPSBhcnJheUJ5dGVMZW5ndGgoYXJyW2ldKTsKICAgICAgfQoKICAgICAgdmFyIHBvcyA9IDA7CiAgICAgIHZhciBkYXRhID0gbmV3IFVpbnQ4QXJyYXkocmVzdWx0TGVuZ3RoKTsKCiAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBsZW5ndGg7IF9pKyspIHsKICAgICAgICB2YXIgaXRlbSA9IGFycltfaV07CgogICAgICAgIGlmICghKGl0ZW0gaW5zdGFuY2VvZiBVaW50OEFycmF5KSkgewogICAgICAgICAgaWYgKHR5cGVvZiBpdGVtID09PSAic3RyaW5nIikgewogICAgICAgICAgICBpdGVtID0gc3RyaW5nVG9CeXRlcyhpdGVtKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGl0ZW0gPSBuZXcgVWludDhBcnJheShpdGVtKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHZhciBpdGVtTGVuZ3RoID0gaXRlbS5ieXRlTGVuZ3RoOwogICAgICAgIGRhdGEuc2V0KGl0ZW0sIHBvcyk7CiAgICAgICAgcG9zICs9IGl0ZW1MZW5ndGg7CiAgICAgIH0KCiAgICAgIHJldHVybiBkYXRhOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0cmluZzMyKHZhbHVlKSB7CiAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKHZhbHVlID4+IDI0ICYgMHhmZiwgdmFsdWUgPj4gMTYgJiAweGZmLCB2YWx1ZSA+PiA4ICYgMHhmZiwgdmFsdWUgJiAweGZmKTsKICAgIH0KCiAgICBmdW5jdGlvbiBpc0xpdHRsZUVuZGlhbigpIHsKICAgICAgdmFyIGJ1ZmZlcjggPSBuZXcgVWludDhBcnJheSg0KTsKICAgICAgYnVmZmVyOFswXSA9IDE7CiAgICAgIHZhciB2aWV3MzIgPSBuZXcgVWludDMyQXJyYXkoYnVmZmVyOC5idWZmZXIsIDAsIDEpOwogICAgICByZXR1cm4gdmlldzMyWzBdID09PSAxOwogICAgfQoKICAgIHZhciBJc0xpdHRsZUVuZGlhbkNhY2hlZCA9IHsKICAgICAgZ2V0IHZhbHVlKCkgewogICAgICAgIHJldHVybiBzaGFkb3codGhpcywgInZhbHVlIiwgaXNMaXR0bGVFbmRpYW4oKSk7CiAgICAgIH0KCiAgICB9OwogICAgZXhwb3J0cy5Jc0xpdHRsZUVuZGlhbkNhY2hlZCA9IElzTGl0dGxlRW5kaWFuQ2FjaGVkOwoKICAgIGZ1bmN0aW9uIGlzRXZhbFN1cHBvcnRlZCgpIHsKICAgICAgdHJ5IHsKICAgICAgICBuZXcgRnVuY3Rpb24oIiIpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CgogICAgdmFyIElzRXZhbFN1cHBvcnRlZENhY2hlZCA9IHsKICAgICAgZ2V0IHZhbHVlKCkgewogICAgICAgIHJldHVybiBzaGFkb3codGhpcywgInZhbHVlIiwgaXNFdmFsU3VwcG9ydGVkKCkpOwogICAgICB9CgogICAgfTsKICAgIGV4cG9ydHMuSXNFdmFsU3VwcG9ydGVkQ2FjaGVkID0gSXNFdmFsU3VwcG9ydGVkQ2FjaGVkOwogICAgdmFyIHJnYkJ1ZiA9IFsicmdiKCIsIDAsICIsIiwgMCwgIiwiLCAwLCAiKSJdOwoKICAgIHZhciBVdGlsID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gVXRpbCgpIHsKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgVXRpbCk7CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhVdGlsLCBudWxsLCBbewogICAgICAgIGtleTogIm1ha2VDc3NSZ2IiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBtYWtlQ3NzUmdiKHIsIGcsIGIpIHsKICAgICAgICAgIHJnYkJ1ZlsxXSA9IHI7CiAgICAgICAgICByZ2JCdWZbM10gPSBnOwogICAgICAgICAgcmdiQnVmWzVdID0gYjsKICAgICAgICAgIHJldHVybiByZ2JCdWYuam9pbigiIik7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAidHJhbnNmb3JtIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gdHJhbnNmb3JtKG0xLCBtMikgewogICAgICAgICAgcmV0dXJuIFttMVswXSAqIG0yWzBdICsgbTFbMl0gKiBtMlsxXSwgbTFbMV0gKiBtMlswXSArIG0xWzNdICogbTJbMV0sIG0xWzBdICogbTJbMl0gKyBtMVsyXSAqIG0yWzNdLCBtMVsxXSAqIG0yWzJdICsgbTFbM10gKiBtMlszXSwgbTFbMF0gKiBtMls0XSArIG0xWzJdICogbTJbNV0gKyBtMVs0XSwgbTFbMV0gKiBtMls0XSArIG0xWzNdICogbTJbNV0gKyBtMVs1XV07CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiYXBwbHlUcmFuc2Zvcm0iLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBhcHBseVRyYW5zZm9ybShwLCBtKSB7CiAgICAgICAgICB2YXIgeHQgPSBwWzBdICogbVswXSArIHBbMV0gKiBtWzJdICsgbVs0XTsKICAgICAgICAgIHZhciB5dCA9IHBbMF0gKiBtWzFdICsgcFsxXSAqIG1bM10gKyBtWzVdOwogICAgICAgICAgcmV0dXJuIFt4dCwgeXRdOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImFwcGx5SW52ZXJzZVRyYW5zZm9ybSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGFwcGx5SW52ZXJzZVRyYW5zZm9ybShwLCBtKSB7CiAgICAgICAgICB2YXIgZCA9IG1bMF0gKiBtWzNdIC0gbVsxXSAqIG1bMl07CiAgICAgICAgICB2YXIgeHQgPSAocFswXSAqIG1bM10gLSBwWzFdICogbVsyXSArIG1bMl0gKiBtWzVdIC0gbVs0XSAqIG1bM10pIC8gZDsKICAgICAgICAgIHZhciB5dCA9ICgtcFswXSAqIG1bMV0gKyBwWzFdICogbVswXSArIG1bNF0gKiBtWzFdIC0gbVs1XSAqIG1bMF0pIC8gZDsKICAgICAgICAgIHJldHVybiBbeHQsIHl0XTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJnZXRBeGlhbEFsaWduZWRCb3VuZGluZ0JveCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldEF4aWFsQWxpZ25lZEJvdW5kaW5nQm94KHIsIG0pIHsKICAgICAgICAgIHZhciBwMSA9IFV0aWwuYXBwbHlUcmFuc2Zvcm0ociwgbSk7CiAgICAgICAgICB2YXIgcDIgPSBVdGlsLmFwcGx5VHJhbnNmb3JtKHIuc2xpY2UoMiwgNCksIG0pOwogICAgICAgICAgdmFyIHAzID0gVXRpbC5hcHBseVRyYW5zZm9ybShbclswXSwgclszXV0sIG0pOwogICAgICAgICAgdmFyIHA0ID0gVXRpbC5hcHBseVRyYW5zZm9ybShbclsyXSwgclsxXV0sIG0pOwogICAgICAgICAgcmV0dXJuIFtNYXRoLm1pbihwMVswXSwgcDJbMF0sIHAzWzBdLCBwNFswXSksIE1hdGgubWluKHAxWzFdLCBwMlsxXSwgcDNbMV0sIHA0WzFdKSwgTWF0aC5tYXgocDFbMF0sIHAyWzBdLCBwM1swXSwgcDRbMF0pLCBNYXRoLm1heChwMVsxXSwgcDJbMV0sIHAzWzFdLCBwNFsxXSldOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImludmVyc2VUcmFuc2Zvcm0iLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBpbnZlcnNlVHJhbnNmb3JtKG0pIHsKICAgICAgICAgIHZhciBkID0gbVswXSAqIG1bM10gLSBtWzFdICogbVsyXTsKICAgICAgICAgIHJldHVybiBbbVszXSAvIGQsIC1tWzFdIC8gZCwgLW1bMl0gLyBkLCBtWzBdIC8gZCwgKG1bMl0gKiBtWzVdIC0gbVs0XSAqIG1bM10pIC8gZCwgKG1bNF0gKiBtWzFdIC0gbVs1XSAqIG1bMF0pIC8gZF07CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiYXBwbHkzZFRyYW5zZm9ybSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGFwcGx5M2RUcmFuc2Zvcm0obSwgdikgewogICAgICAgICAgcmV0dXJuIFttWzBdICogdlswXSArIG1bMV0gKiB2WzFdICsgbVsyXSAqIHZbMl0sIG1bM10gKiB2WzBdICsgbVs0XSAqIHZbMV0gKyBtWzVdICogdlsyXSwgbVs2XSAqIHZbMF0gKyBtWzddICogdlsxXSArIG1bOF0gKiB2WzJdXTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJzaW5ndWxhclZhbHVlRGVjb21wb3NlMmRTY2FsZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNpbmd1bGFyVmFsdWVEZWNvbXBvc2UyZFNjYWxlKG0pIHsKICAgICAgICAgIHZhciB0cmFuc3Bvc2UgPSBbbVswXSwgbVsyXSwgbVsxXSwgbVszXV07CiAgICAgICAgICB2YXIgYSA9IG1bMF0gKiB0cmFuc3Bvc2VbMF0gKyBtWzFdICogdHJhbnNwb3NlWzJdOwogICAgICAgICAgdmFyIGIgPSBtWzBdICogdHJhbnNwb3NlWzFdICsgbVsxXSAqIHRyYW5zcG9zZVszXTsKICAgICAgICAgIHZhciBjID0gbVsyXSAqIHRyYW5zcG9zZVswXSArIG1bM10gKiB0cmFuc3Bvc2VbMl07CiAgICAgICAgICB2YXIgZCA9IG1bMl0gKiB0cmFuc3Bvc2VbMV0gKyBtWzNdICogdHJhbnNwb3NlWzNdOwogICAgICAgICAgdmFyIGZpcnN0ID0gKGEgKyBkKSAvIDI7CiAgICAgICAgICB2YXIgc2Vjb25kID0gTWF0aC5zcXJ0KChhICsgZCkgKiAoYSArIGQpIC0gNCAqIChhICogZCAtIGMgKiBiKSkgLyAyOwogICAgICAgICAgdmFyIHN4ID0gZmlyc3QgKyBzZWNvbmQgfHwgMTsKICAgICAgICAgIHZhciBzeSA9IGZpcnN0IC0gc2Vjb25kIHx8IDE7CiAgICAgICAgICByZXR1cm4gW01hdGguc3FydChzeCksIE1hdGguc3FydChzeSldOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIm5vcm1hbGl6ZVJlY3QiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBub3JtYWxpemVSZWN0KHJlY3QpIHsKICAgICAgICAgIHZhciByID0gcmVjdC5zbGljZSgwKTsKCiAgICAgICAgICBpZiAocmVjdFswXSA+IHJlY3RbMl0pIHsKICAgICAgICAgICAgclswXSA9IHJlY3RbMl07CiAgICAgICAgICAgIHJbMl0gPSByZWN0WzBdOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChyZWN0WzFdID4gcmVjdFszXSkgewogICAgICAgICAgICByWzFdID0gcmVjdFszXTsKICAgICAgICAgICAgclszXSA9IHJlY3RbMV07CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHI7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiaW50ZXJzZWN0IiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaW50ZXJzZWN0KHJlY3QxLCByZWN0MikgewogICAgICAgICAgZnVuY3Rpb24gY29tcGFyZShhLCBiKSB7CiAgICAgICAgICAgIHJldHVybiBhIC0gYjsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgb3JkZXJlZFggPSBbcmVjdDFbMF0sIHJlY3QxWzJdLCByZWN0MlswXSwgcmVjdDJbMl1dLnNvcnQoY29tcGFyZSk7CiAgICAgICAgICB2YXIgb3JkZXJlZFkgPSBbcmVjdDFbMV0sIHJlY3QxWzNdLCByZWN0MlsxXSwgcmVjdDJbM11dLnNvcnQoY29tcGFyZSk7CiAgICAgICAgICB2YXIgcmVzdWx0ID0gW107CiAgICAgICAgICByZWN0MSA9IFV0aWwubm9ybWFsaXplUmVjdChyZWN0MSk7CiAgICAgICAgICByZWN0MiA9IFV0aWwubm9ybWFsaXplUmVjdChyZWN0Mik7CgogICAgICAgICAgaWYgKG9yZGVyZWRYWzBdID09PSByZWN0MVswXSAmJiBvcmRlcmVkWFsxXSA9PT0gcmVjdDJbMF0gfHwgb3JkZXJlZFhbMF0gPT09IHJlY3QyWzBdICYmIG9yZGVyZWRYWzFdID09PSByZWN0MVswXSkgewogICAgICAgICAgICByZXN1bHRbMF0gPSBvcmRlcmVkWFsxXTsKICAgICAgICAgICAgcmVzdWx0WzJdID0gb3JkZXJlZFhbMl07CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAob3JkZXJlZFlbMF0gPT09IHJlY3QxWzFdICYmIG9yZGVyZWRZWzFdID09PSByZWN0MlsxXSB8fCBvcmRlcmVkWVswXSA9PT0gcmVjdDJbMV0gJiYgb3JkZXJlZFlbMV0gPT09IHJlY3QxWzFdKSB7CiAgICAgICAgICAgIHJlc3VsdFsxXSA9IG9yZGVyZWRZWzFdOwogICAgICAgICAgICByZXN1bHRbM10gPSBvcmRlcmVkWVsyXTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICB9XSk7CgogICAgICByZXR1cm4gVXRpbDsKICAgIH0oKTsKCiAgICBleHBvcnRzLlV0aWwgPSBVdGlsOwogICAgdmFyIFBERlN0cmluZ1RyYW5zbGF0ZVRhYmxlID0gWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDB4MkQ4LCAweDJDNywgMHgyQzYsIDB4MkQ5LCAweDJERCwgMHgyREIsIDB4MkRBLCAweDJEQywgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMHgyMDIyLCAweDIwMjAsIDB4MjAyMSwgMHgyMDI2LCAweDIwMTQsIDB4MjAxMywgMHgxOTIsIDB4MjA0NCwgMHgyMDM5LCAweDIwM0EsIDB4MjIxMiwgMHgyMDMwLCAweDIwMUUsIDB4MjAxQywgMHgyMDFELCAweDIwMTgsIDB4MjAxOSwgMHgyMDFBLCAweDIxMjIsIDB4RkIwMSwgMHhGQjAyLCAweDE0MSwgMHgxNTIsIDB4MTYwLCAweDE3OCwgMHgxN0QsIDB4MTMxLCAweDE0MiwgMHgxNTMsIDB4MTYxLCAweDE3RSwgMCwgMHgyMEFDXTsKCiAgICBmdW5jdGlvbiBzdHJpbmdUb1BERlN0cmluZyhzdHIpIHsKICAgICAgdmFyIGxlbmd0aCA9IHN0ci5sZW5ndGgsCiAgICAgICAgc3RyQnVmID0gW107CgogICAgICBpZiAoc3RyWzBdID09PSAiXHhGRSIgJiYgc3RyWzFdID09PSAiXHhGRiIpIHsKICAgICAgICBmb3IgKHZhciBpID0gMjsgaSA8IGxlbmd0aDsgaSArPSAyKSB7CiAgICAgICAgICBzdHJCdWYucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKHN0ci5jaGFyQ29kZUF0KGkpIDw8IDggfCBzdHIuY2hhckNvZGVBdChpICsgMSkpKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoc3RyWzBdID09PSAiXHhGRiIgJiYgc3RyWzFdID09PSAiXHhGRSIpIHsKICAgICAgICBmb3IgKHZhciBfaTIgPSAyOyBfaTIgPCBsZW5ndGg7IF9pMiArPSAyKSB7CiAgICAgICAgICBzdHJCdWYucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKHN0ci5jaGFyQ29kZUF0KF9pMiArIDEpIDw8IDggfCBzdHIuY2hhckNvZGVBdChfaTIpKSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGZvciAodmFyIF9pMyA9IDA7IF9pMyA8IGxlbmd0aDsgKytfaTMpIHsKICAgICAgICAgIHZhciBjb2RlID0gUERGU3RyaW5nVHJhbnNsYXRlVGFibGVbc3RyLmNoYXJDb2RlQXQoX2kzKV07CiAgICAgICAgICBzdHJCdWYucHVzaChjb2RlID8gU3RyaW5nLmZyb21DaGFyQ29kZShjb2RlKSA6IHN0ci5jaGFyQXQoX2kzKSk7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gc3RyQnVmLmpvaW4oIiIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0cmluZ1RvVVRGOFN0cmluZyhzdHIpIHsKICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChlc2NhcGUoc3RyKSk7CiAgICB9CgogICAgZnVuY3Rpb24gdXRmOFN0cmluZ1RvU3RyaW5nKHN0cikgewogICAgICByZXR1cm4gdW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KHN0cikpOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzRW1wdHlPYmoob2JqKSB7CiAgICAgIGZvciAodmFyIGtleSBpbiBvYmopIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzQm9vbCh2KSB7CiAgICAgIHJldHVybiB0eXBlb2YgdiA9PT0gImJvb2xlYW4iOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzTnVtKHYpIHsKICAgICAgcmV0dXJuIHR5cGVvZiB2ID09PSAibnVtYmVyIjsKICAgIH0KCiAgICBmdW5jdGlvbiBpc1N0cmluZyh2KSB7CiAgICAgIHJldHVybiB0eXBlb2YgdiA9PT0gInN0cmluZyI7CiAgICB9CgogICAgZnVuY3Rpb24gaXNBcnJheUJ1ZmZlcih2KSB7CiAgICAgIHJldHVybiBfdHlwZW9mKHYpID09PSAib2JqZWN0IiAmJiB2ICE9PSBudWxsICYmIHYuYnl0ZUxlbmd0aCAhPT0gdW5kZWZpbmVkOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzQXJyYXlFcXVhbChhcnIxLCBhcnIyKSB7CiAgICAgIGlmIChhcnIxLmxlbmd0aCAhPT0gYXJyMi5sZW5ndGgpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiBhcnIxLmV2ZXJ5KGZ1bmN0aW9uIChlbGVtZW50LCBpbmRleCkgewogICAgICAgIHJldHVybiBlbGVtZW50ID09PSBhcnIyW2luZGV4XTsKICAgICAgfSk7CiAgICB9CgogICAgZnVuY3Rpb24gY3JlYXRlUHJvbWlzZUNhcGFiaWxpdHkoKSB7CiAgICAgIHZhciBjYXBhYmlsaXR5ID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgdmFyIGlzU2V0dGxlZCA9IGZhbHNlOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoY2FwYWJpbGl0eSwgInNldHRsZWQiLCB7CiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICByZXR1cm4gaXNTZXR0bGVkOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIGNhcGFiaWxpdHkucHJvbWlzZSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICBjYXBhYmlsaXR5LnJlc29sdmUgPSBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgaXNTZXR0bGVkID0gdHJ1ZTsKICAgICAgICAgIHJlc29sdmUoZGF0YSk7CiAgICAgICAgfTsKCiAgICAgICAgY2FwYWJpbGl0eS5yZWplY3QgPSBmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICBpc1NldHRsZWQgPSB0cnVlOwogICAgICAgICAgcmVqZWN0KHJlYXNvbik7CiAgICAgICAgfTsKICAgICAgfSk7CiAgICAgIHJldHVybiBjYXBhYmlsaXR5OwogICAgfQoKICAgIHZhciBjcmVhdGVPYmplY3RVUkwgPSBmdW5jdGlvbiBjcmVhdGVPYmplY3RVUkxDbG9zdXJlKCkgewogICAgICB2YXIgZGlnaXRzID0gIkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky89IjsKICAgICAgcmV0dXJuIGZ1bmN0aW9uIGNyZWF0ZU9iamVjdFVSTChkYXRhLCBjb250ZW50VHlwZSkgewogICAgICAgIHZhciBmb3JjZURhdGFTY2hlbWEgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IGZhbHNlOwoKICAgICAgICBpZiAoIWZvcmNlRGF0YVNjaGVtYSAmJiBVUkwuY3JlYXRlT2JqZWN0VVJMKSB7CiAgICAgICAgICB2YXIgYmxvYiA9IG5ldyBCbG9iKFtkYXRhXSwgewogICAgICAgICAgICB0eXBlOiBjb250ZW50VHlwZQogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTsKICAgICAgICB9CgogICAgICAgIHZhciBidWZmZXIgPSAiZGF0YToiLmNvbmNhdChjb250ZW50VHlwZSwgIjtiYXNlNjQsIik7CgogICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGRhdGEubGVuZ3RoOyBpIDwgaWk7IGkgKz0gMykgewogICAgICAgICAgdmFyIGIxID0gZGF0YVtpXSAmIDB4ZmY7CiAgICAgICAgICB2YXIgYjIgPSBkYXRhW2kgKyAxXSAmIDB4ZmY7CiAgICAgICAgICB2YXIgYjMgPSBkYXRhW2kgKyAyXSAmIDB4ZmY7CiAgICAgICAgICB2YXIgZDEgPSBiMSA+PiAyLAogICAgICAgICAgICBkMiA9IChiMSAmIDMpIDw8IDQgfCBiMiA+PiA0OwogICAgICAgICAgdmFyIGQzID0gaSArIDEgPCBpaSA/IChiMiAmIDB4ZikgPDwgMiB8IGIzID4+IDYgOiA2NDsKICAgICAgICAgIHZhciBkNCA9IGkgKyAyIDwgaWkgPyBiMyAmIDB4M2YgOiA2NDsKICAgICAgICAgIGJ1ZmZlciArPSBkaWdpdHNbZDFdICsgZGlnaXRzW2QyXSArIGRpZ2l0c1tkM10gKyBkaWdpdHNbZDRdOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGJ1ZmZlcjsKICAgICAgfTsKICAgIH0oKTsKCiAgICBleHBvcnRzLmNyZWF0ZU9iamVjdFVSTCA9IGNyZWF0ZU9iamVjdFVSTDsKCiAgICAvKioqL30pLCAoCiAgLyogMiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCgogICAgZnVuY3Rpb24gX3R5cGVvZihvYmopIHsiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2YiO2lmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7X3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7cmV0dXJuIHR5cGVvZiBvYmo7fTt9IGVsc2Uge190eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikge3JldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmo7fTt9cmV0dXJuIF90eXBlb2Yob2JqKTt9CgogICAgaWYgKHR5cGVvZiBnbG9iYWxUaGlzID09PSAidW5kZWZpbmVkIiB8fCAhZ2xvYmFsVGhpcy5fcGRmanNDb21wYXRpYmlsaXR5Q2hlY2tlZCkgewogICAgICBpZiAodHlwZW9mIGdsb2JhbFRoaXMgPT09ICJ1bmRlZmluZWQiIHx8IGdsb2JhbFRoaXMuTWF0aCAhPT0gTWF0aCkgewogICAgICAgIGdsb2JhbFRoaXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDMpOwogICAgICB9CgogICAgICBnbG9iYWxUaGlzLl9wZGZqc0NvbXBhdGliaWxpdHlDaGVja2VkID0gdHJ1ZTsKCiAgICAgIHZhciBfcmVxdWlyZSA9IF9fd19wZGZqc19yZXF1aXJlX18oNDgpLAogICAgICAgIGlzTm9kZUpTID0gX3JlcXVpcmUuaXNOb2RlSlM7CgogICAgICB2YXIgaGFzRE9NID0gKHR5cGVvZiB3aW5kb3cgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKHdpbmRvdykpID09PSAib2JqZWN0IiAmJiAodHlwZW9mIGRvY3VtZW50ID09PSAidW5kZWZpbmVkIiA/ICJ1bmRlZmluZWQiIDogX3R5cGVvZihkb2N1bWVudCkpID09PSAib2JqZWN0IjsKICAgICAgdmFyIHVzZXJBZ2VudCA9IHR5cGVvZiBuYXZpZ2F0b3IgIT09ICJ1bmRlZmluZWQiICYmIG5hdmlnYXRvci51c2VyQWdlbnQgfHwgIiI7CiAgICAgIHZhciBpc0lFID0gL1RyaWRlbnQvLnRlc3QodXNlckFnZW50KTsKCiAgICAgIChmdW5jdGlvbiBjaGVja05vZGVCdG9hKCkgewogICAgICAgIGlmIChnbG9iYWxUaGlzLmJ0b2EgfHwgIWlzTm9kZUpTKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBnbG9iYWxUaGlzLmJ0b2EgPSBmdW5jdGlvbiAoY2hhcnMpIHsKICAgICAgICAgIHJldHVybiBCdWZmZXIuZnJvbShjaGFycywgImJpbmFyeSIpLnRvU3RyaW5nKCJiYXNlNjQiKTsKICAgICAgICB9OwogICAgICB9KSgpOwoKICAgICAgKGZ1bmN0aW9uIGNoZWNrTm9kZUF0b2IoKSB7CiAgICAgICAgaWYgKGdsb2JhbFRoaXMuYXRvYiB8fCAhaXNOb2RlSlMpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGdsb2JhbFRoaXMuYXRvYiA9IGZ1bmN0aW9uIChpbnB1dCkgewogICAgICAgICAgcmV0dXJuIEJ1ZmZlci5mcm9tKGlucHV0LCAiYmFzZTY0IikudG9TdHJpbmcoImJpbmFyeSIpOwogICAgICAgIH07CiAgICAgIH0pKCk7CgogICAgICAoZnVuY3Rpb24gY2hlY2tDaGlsZE5vZGVSZW1vdmUoKSB7CiAgICAgICAgaWYgKCFoYXNET00pIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmICh0eXBlb2YgRWxlbWVudC5wcm90b3R5cGUucmVtb3ZlICE9PSAidW5kZWZpbmVkIikgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgRWxlbWVudC5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKHRoaXMucGFyZW50Tm9kZSkgewogICAgICAgICAgICB0aGlzLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcyk7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfSkoKTsKCiAgICAgIChmdW5jdGlvbiBjaGVja0RPTVRva2VuTGlzdEFkZFJlbW92ZSgpIHsKICAgICAgICBpZiAoIWhhc0RPTSB8fCBpc05vZGVKUykgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgIGRpdi5jbGFzc0xpc3QuYWRkKCJ0ZXN0T25lIiwgInRlc3RUd28iKTsKCiAgICAgICAgaWYgKGRpdi5jbGFzc0xpc3QuY29udGFpbnMoInRlc3RPbmUiKSA9PT0gdHJ1ZSAmJiBkaXYuY2xhc3NMaXN0LmNvbnRhaW5zKCJ0ZXN0VHdvIikgPT09IHRydWUpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBPcmlnaW5hbERPTVRva2VuTGlzdEFkZCA9IERPTVRva2VuTGlzdC5wcm90b3R5cGUuYWRkOwogICAgICAgIHZhciBPcmlnaW5hbERPTVRva2VuTGlzdFJlbW92ZSA9IERPTVRva2VuTGlzdC5wcm90b3R5cGUucmVtb3ZlOwoKICAgICAgICBET01Ub2tlbkxpc3QucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCB0b2tlbnMgPSBuZXcgQXJyYXkoX2xlbiksIF9rZXkgPSAwOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7CiAgICAgICAgICAgIHRva2Vuc1tfa2V5XSA9IGFyZ3VtZW50c1tfa2V5XTsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF90b2tlbnMgPSB0b2tlbnM7IF9pIDwgX3Rva2Vucy5sZW5ndGg7IF9pKyspIHsKICAgICAgICAgICAgdmFyIHRva2VuID0gX3Rva2Vuc1tfaV07CiAgICAgICAgICAgIE9yaWdpbmFsRE9NVG9rZW5MaXN0QWRkLmNhbGwodGhpcywgdG9rZW4pOwogICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIERPTVRva2VuTGlzdC5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgZm9yICh2YXIgX2xlbjIgPSBhcmd1bWVudHMubGVuZ3RoLCB0b2tlbnMgPSBuZXcgQXJyYXkoX2xlbjIpLCBfa2V5MiA9IDA7IF9rZXkyIDwgX2xlbjI7IF9rZXkyKyspIHsKICAgICAgICAgICAgdG9rZW5zW19rZXkyXSA9IGFyZ3VtZW50c1tfa2V5Ml07CiAgICAgICAgICB9CgogICAgICAgICAgZm9yICh2YXIgX2kyID0gMCwgX3Rva2VuczIgPSB0b2tlbnM7IF9pMiA8IF90b2tlbnMyLmxlbmd0aDsgX2kyKyspIHsKICAgICAgICAgICAgdmFyIHRva2VuID0gX3Rva2VuczJbX2kyXTsKICAgICAgICAgICAgT3JpZ2luYWxET01Ub2tlbkxpc3RSZW1vdmUuY2FsbCh0aGlzLCB0b2tlbik7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfSkoKTsKCiAgICAgIChmdW5jdGlvbiBjaGVja0RPTVRva2VuTGlzdFRvZ2dsZSgpIHsKICAgICAgICBpZiAoIWhhc0RPTSB8fCBpc05vZGVKUykgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwoKICAgICAgICBpZiAoZGl2LmNsYXNzTGlzdC50b2dnbGUoInRlc3QiLCAwKSA9PT0gZmFsc2UpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIERPTVRva2VuTGlzdC5wcm90b3R5cGUudG9nZ2xlID0gZnVuY3Rpb24gKHRva2VuKSB7CiAgICAgICAgICB2YXIgZm9yY2UgPSBhcmd1bWVudHMubGVuZ3RoID4gMSA/ICEhYXJndW1lbnRzWzFdIDogIXRoaXMuY29udGFpbnModG9rZW4pOwogICAgICAgICAgcmV0dXJuIHRoaXNbZm9yY2UgPyAiYWRkIiA6ICJyZW1vdmUiXSh0b2tlbiksIGZvcmNlOwogICAgICAgIH07CiAgICAgIH0pKCk7CgogICAgICAoZnVuY3Rpb24gY2hlY2tXaW5kb3dIaXN0b3J5UHVzaFN0YXRlUmVwbGFjZVN0YXRlKCkgewogICAgICAgIGlmICghaGFzRE9NIHx8ICFpc0lFKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgT3JpZ2luYWxQdXNoU3RhdGUgPSB3aW5kb3cuaGlzdG9yeS5wdXNoU3RhdGU7CiAgICAgICAgdmFyIE9yaWdpbmFsUmVwbGFjZVN0YXRlID0gd2luZG93Lmhpc3RvcnkucmVwbGFjZVN0YXRlOwoKICAgICAgICB3aW5kb3cuaGlzdG9yeS5wdXNoU3RhdGUgPSBmdW5jdGlvbiAoc3RhdGUsIHRpdGxlLCB1cmwpIHsKICAgICAgICAgIHZhciBhcmdzID0gdXJsID09PSB1bmRlZmluZWQgPyBbc3RhdGUsIHRpdGxlXSA6IFtzdGF0ZSwgdGl0bGUsIHVybF07CiAgICAgICAgICBPcmlnaW5hbFB1c2hTdGF0ZS5hcHBseSh0aGlzLCBhcmdzKTsKICAgICAgICB9OwoKICAgICAgICB3aW5kb3cuaGlzdG9yeS5yZXBsYWNlU3RhdGUgPSBmdW5jdGlvbiAoc3RhdGUsIHRpdGxlLCB1cmwpIHsKICAgICAgICAgIHZhciBhcmdzID0gdXJsID09PSB1bmRlZmluZWQgPyBbc3RhdGUsIHRpdGxlXSA6IFtzdGF0ZSwgdGl0bGUsIHVybF07CiAgICAgICAgICBPcmlnaW5hbFJlcGxhY2VTdGF0ZS5hcHBseSh0aGlzLCBhcmdzKTsKICAgICAgICB9OwogICAgICB9KSgpOwoKICAgICAgKGZ1bmN0aW9uIGNoZWNrU3RyaW5nU3RhcnRzV2l0aCgpIHsKICAgICAgICBpZiAoU3RyaW5nLnByb3RvdHlwZS5zdGFydHNXaXRoKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDQ5KTsKICAgICAgfSkoKTsKCiAgICAgIChmdW5jdGlvbiBjaGVja1N0cmluZ0VuZHNXaXRoKCkgewogICAgICAgIGlmIChTdHJpbmcucHJvdG90eXBlLmVuZHNXaXRoKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDYwKTsKICAgICAgfSkoKTsKCiAgICAgIChmdW5jdGlvbiBjaGVja1N0cmluZ0luY2x1ZGVzKCkgewogICAgICAgIGlmIChTdHJpbmcucHJvdG90eXBlLmluY2x1ZGVzKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDYyKTsKICAgICAgfSkoKTsKCiAgICAgIChmdW5jdGlvbiBjaGVja0FycmF5SW5jbHVkZXMoKSB7CiAgICAgICAgaWYgKEFycmF5LnByb3RvdHlwZS5pbmNsdWRlcykgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgX193X3BkZmpzX3JlcXVpcmVfXyg2NCk7CiAgICAgIH0pKCk7CgogICAgICAoZnVuY3Rpb24gY2hlY2tBcnJheUZyb20oKSB7CiAgICAgICAgaWYgKEFycmF5LmZyb20pIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIF9fd19wZGZqc19yZXF1aXJlX18oNzIpOwogICAgICB9KSgpOwoKICAgICAgKGZ1bmN0aW9uIGNoZWNrT2JqZWN0QXNzaWduKCkgewogICAgICAgIGlmIChPYmplY3QuYXNzaWduKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDk0KTsKICAgICAgfSkoKTsKCiAgICAgIChmdW5jdGlvbiBjaGVja01hdGhMb2cyKCkgewogICAgICAgIGlmIChNYXRoLmxvZzIpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIE1hdGgubG9nMiA9IF9fd19wZGZqc19yZXF1aXJlX18oOTcpOwogICAgICB9KSgpOwoKICAgICAgKGZ1bmN0aW9uIGNoZWNrTnVtYmVySXNOYU4oKSB7CiAgICAgICAgaWYgKE51bWJlci5pc05hTikgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgTnVtYmVyLmlzTmFOID0gX193X3BkZmpzX3JlcXVpcmVfXyg5OSk7CiAgICAgIH0pKCk7CgogICAgICAoZnVuY3Rpb24gY2hlY2tOdW1iZXJJc0ludGVnZXIoKSB7CiAgICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIE51bWJlci5pc0ludGVnZXIgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEwMSk7CiAgICAgIH0pKCk7CgogICAgICAoZnVuY3Rpb24gY2hlY2tQcm9taXNlKCkgewogICAgICAgIGlmIChnbG9iYWxUaGlzLlByb21pc2UgJiYgZ2xvYmFsVGhpcy5Qcm9taXNlLmFsbFNldHRsZWQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGdsb2JhbFRoaXMuUHJvbWlzZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTA0KTsKICAgICAgfSkoKTsKCiAgICAgIChmdW5jdGlvbiBjaGVja1VSTCgpIHsKICAgICAgICBnbG9iYWxUaGlzLlVSTCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTI4KTsKICAgICAgfSkoKTsKCiAgICAgIChmdW5jdGlvbiBjaGVja1JlYWRhYmxlU3RyZWFtKCkgewogICAgICAgIHZhciBpc1JlYWRhYmxlU3RyZWFtU3VwcG9ydGVkID0gZmFsc2U7CgogICAgICAgIGlmICh0eXBlb2YgUmVhZGFibGVTdHJlYW0gIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBuZXcgUmVhZGFibGVTdHJlYW0oewogICAgICAgICAgICAgIHN0YXJ0OiBmdW5jdGlvbiBzdGFydChjb250cm9sbGVyKSB7CiAgICAgICAgICAgICAgICBjb250cm9sbGVyLmNsb3NlKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaXNSZWFkYWJsZVN0cmVhbVN1cHBvcnRlZCA9IHRydWU7CiAgICAgICAgICB9IGNhdGNoIChlKSB7fQogICAgICAgIH0KCiAgICAgICAgaWYgKGlzUmVhZGFibGVTdHJlYW1TdXBwb3J0ZWQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGdsb2JhbFRoaXMuUmVhZGFibGVTdHJlYW0gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEzNSkuUmVhZGFibGVTdHJlYW07CiAgICAgIH0pKCk7CgogICAgICAoZnVuY3Rpb24gY2hlY2tNYXBFbnRyaWVzKCkgewogICAgICAgIGlmIChnbG9iYWxUaGlzLk1hcCAmJiBnbG9iYWxUaGlzLk1hcC5wcm90b3R5cGUuZW50cmllcykgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgZ2xvYmFsVGhpcy5NYXAgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEzNik7CiAgICAgIH0pKCk7CgogICAgICAoZnVuY3Rpb24gY2hlY2tTZXRFbnRyaWVzKCkgewogICAgICAgIGlmIChnbG9iYWxUaGlzLlNldCAmJiBnbG9iYWxUaGlzLlNldC5wcm90b3R5cGUuZW50cmllcykgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgZ2xvYmFsVGhpcy5TZXQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE0Myk7CiAgICAgIH0pKCk7CgogICAgICAoZnVuY3Rpb24gY2hlY2tXZWFrTWFwKCkgewogICAgICAgIGlmIChnbG9iYWxUaGlzLldlYWtNYXApIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGdsb2JhbFRoaXMuV2Vha01hcCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTQ1KTsKICAgICAgfSkoKTsKCiAgICAgIChmdW5jdGlvbiBjaGVja1dlYWtTZXQoKSB7CiAgICAgICAgaWYgKGdsb2JhbFRoaXMuV2Vha1NldCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgZ2xvYmFsVGhpcy5XZWFrU2V0ID0gX193X3BkZmpzX3JlcXVpcmVfXygxNTEpOwogICAgICB9KSgpOwoKICAgICAgKGZ1bmN0aW9uIGNoZWNrU3RyaW5nQ29kZVBvaW50QXQoKSB7CiAgICAgICAgaWYgKFN0cmluZy5wcm90b3R5cGUuY29kZVBvaW50QXQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIF9fd19wZGZqc19yZXF1aXJlX18oMTUzKTsKICAgICAgfSkoKTsKCiAgICAgIChmdW5jdGlvbiBjaGVja1N0cmluZ0Zyb21Db2RlUG9pbnQoKSB7CiAgICAgICAgaWYgKFN0cmluZy5mcm9tQ29kZVBvaW50KSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBTdHJpbmcuZnJvbUNvZGVQb2ludCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTU1KTsKICAgICAgfSkoKTsKCiAgICAgIChmdW5jdGlvbiBjaGVja1N5bWJvbCgpIHsKICAgICAgICBpZiAoZ2xvYmFsVGhpcy5TeW1ib2wpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIF9fd19wZGZqc19yZXF1aXJlX18oMTU3KTsKICAgICAgfSkoKTsKCiAgICAgIChmdW5jdGlvbiBjaGVja1N0cmluZ1BhZFN0YXJ0KCkgewogICAgICAgIGlmIChTdHJpbmcucHJvdG90eXBlLnBhZFN0YXJ0KSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDE4MCk7CiAgICAgIH0pKCk7CgogICAgICAoZnVuY3Rpb24gY2hlY2tTdHJpbmdQYWRFbmQoKSB7CiAgICAgICAgaWYgKFN0cmluZy5wcm90b3R5cGUucGFkRW5kKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDE4NSk7CiAgICAgIH0pKCk7CgogICAgICAoZnVuY3Rpb24gY2hlY2tPYmplY3RWYWx1ZXMoKSB7CiAgICAgICAgaWYgKE9iamVjdC52YWx1ZXMpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIE9iamVjdC52YWx1ZXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE4Nyk7CiAgICAgIH0pKCk7CiAgICB9CgogICAgLyoqKi99KSwgKAogIC8qIDMgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDQpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDYpOwoKICAgIC8qKiovfSksICgKICAvKiA0ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyICQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUpOwogICAgdmFyIGdsb2JhbCA9IF9fd19wZGZqc19yZXF1aXJlX18oNik7CiAgICAkKHsgZ2xvYmFsOiB0cnVlIH0sIHsgZ2xvYmFsVGhpczogZ2xvYmFsIH0pOwoKICAgIC8qKiovfSksICgKICAvKiA1ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGdsb2JhbCA9IF9fd19wZGZqc19yZXF1aXJlX18oNik7CiAgICB2YXIgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0gX193X3BkZmpzX3JlcXVpcmVfXyg3KS5mOwogICAgdmFyIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjEpOwogICAgdmFyIHJlZGVmaW5lID0gX193X3BkZmpzX3JlcXVpcmVfXygyNCk7CiAgICB2YXIgc2V0R2xvYmFsID0gX193X3BkZmpzX3JlcXVpcmVfXygyNSk7CiAgICB2YXIgY29weUNvbnN0cnVjdG9yUHJvcGVydGllcyA9IF9fd19wZGZqc19yZXF1aXJlX18oMzUpOwogICAgdmFyIGlzRm9yY2VkID0gX193X3BkZmpzX3JlcXVpcmVfXyg0Nyk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChvcHRpb25zLCBzb3VyY2UpIHsKICAgICAgdmFyIFRBUkdFVCA9IG9wdGlvbnMudGFyZ2V0OwogICAgICB2YXIgR0xPQkFMID0gb3B0aW9ucy5nbG9iYWw7CiAgICAgIHZhciBTVEFUSUMgPSBvcHRpb25zLnN0YXQ7CiAgICAgIHZhciBGT1JDRUQsIHRhcmdldCwga2V5LCB0YXJnZXRQcm9wZXJ0eSwgc291cmNlUHJvcGVydHksIGRlc2NyaXB0b3I7CiAgICAgIGlmIChHTE9CQUwpIHsKICAgICAgICB0YXJnZXQgPSBnbG9iYWw7CiAgICAgIH0gZWxzZSBpZiAoU1RBVElDKSB7CiAgICAgICAgdGFyZ2V0ID0gZ2xvYmFsW1RBUkdFVF0gfHwgc2V0R2xvYmFsKFRBUkdFVCwge30pOwogICAgICB9IGVsc2UgewogICAgICAgIHRhcmdldCA9IChnbG9iYWxbVEFSR0VUXSB8fCB7fSkucHJvdG90eXBlOwogICAgICB9CiAgICAgIGlmICh0YXJnZXQpCiAgICAgIGZvciAoa2V5IGluIHNvdXJjZSkgewogICAgICAgIHNvdXJjZVByb3BlcnR5ID0gc291cmNlW2tleV07CiAgICAgICAgaWYgKG9wdGlvbnMubm9UYXJnZXRHZXQpIHsKICAgICAgICAgIGRlc2NyaXB0b3IgPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpOwogICAgICAgICAgdGFyZ2V0UHJvcGVydHkgPSBkZXNjcmlwdG9yICYmIGRlc2NyaXB0b3IudmFsdWU7CiAgICAgICAgfSBlbHNlCiAgICAgICAgdGFyZ2V0UHJvcGVydHkgPSB0YXJnZXRba2V5XTsKICAgICAgICBGT1JDRUQgPSBpc0ZvcmNlZChHTE9CQUwgPyBrZXkgOiBUQVJHRVQgKyAoU1RBVElDID8gJy4nIDogJyMnKSArIGtleSwgb3B0aW9ucy5mb3JjZWQpOwogICAgICAgIGlmICghRk9SQ0VEICYmIHRhcmdldFByb3BlcnR5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGlmICh0eXBlb2Ygc291cmNlUHJvcGVydHkgPT09IHR5cGVvZiB0YXJnZXRQcm9wZXJ0eSkKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgY29weUNvbnN0cnVjdG9yUHJvcGVydGllcyhzb3VyY2VQcm9wZXJ0eSwgdGFyZ2V0UHJvcGVydHkpOwogICAgICAgIH0KICAgICAgICBpZiAob3B0aW9ucy5zaGFtIHx8IHRhcmdldFByb3BlcnR5ICYmIHRhcmdldFByb3BlcnR5LnNoYW0pIHsKICAgICAgICAgIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eShzb3VyY2VQcm9wZXJ0eSwgJ3NoYW0nLCB0cnVlKTsKICAgICAgICB9CiAgICAgICAgcmVkZWZpbmUodGFyZ2V0LCBrZXksIHNvdXJjZVByb3BlcnR5LCBvcHRpb25zKTsKICAgICAgfQogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogNiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewoKICAgIHZhciBjaGVjayA9IGZ1bmN0aW9uIGNoZWNrKGl0KSB7CiAgICAgIHJldHVybiBpdCAmJiBpdC5NYXRoID09IE1hdGggJiYgaXQ7CiAgICB9OwogICAgbW9kdWxlLmV4cG9ydHMgPSBjaGVjayh0eXBlb2YgZ2xvYmFsVGhpcyA9PSAnb2JqZWN0JyAmJiBnbG9iYWxUaGlzKSB8fCBjaGVjayh0eXBlb2Ygd2luZG93ID09ICdvYmplY3QnICYmIHdpbmRvdykgfHwgY2hlY2sodHlwZW9mIHNlbGYgPT0gJ29iamVjdCcgJiYgc2VsZikgfHwgY2hlY2sodHlwZW9mIGdsb2JhbCA9PSAnb2JqZWN0JyAmJiBnbG9iYWwpIHx8IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKCk7CgogICAgLyoqKi99KSwgKAogIC8qIDcgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgREVTQ1JJUFRPUlMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDgpOwogICAgdmFyIHByb3BlcnR5SXNFbnVtZXJhYmxlTW9kdWxlID0gX193X3BkZmpzX3JlcXVpcmVfXygxMCk7CiAgICB2YXIgY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yID0gX193X3BkZmpzX3JlcXVpcmVfXygxMSk7CiAgICB2YXIgdG9JbmRleGVkT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygxMik7CiAgICB2YXIgdG9QcmltaXRpdmUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE2KTsKICAgIHZhciBoYXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE4KTsKICAgIHZhciBJRThfRE9NX0RFRklORSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTkpOwogICAgdmFyIG5hdGl2ZUdldE93blByb3BlcnR5RGVzY3JpcHRvciA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7CiAgICBleHBvcnRzLmYgPSBERVNDUklQVE9SUyA/IG5hdGl2ZUdldE93blByb3BlcnR5RGVzY3JpcHRvciA6IGZ1bmN0aW9uIGdldE93blByb3BlcnR5RGVzY3JpcHRvcihPLCBQKSB7CiAgICAgIE8gPSB0b0luZGV4ZWRPYmplY3QoTyk7CiAgICAgIFAgPSB0b1ByaW1pdGl2ZShQLCB0cnVlKTsKICAgICAgaWYgKElFOF9ET01fREVGSU5FKQogICAgICB0cnkgewogICAgICAgIHJldHVybiBuYXRpdmVHZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTywgUCk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIH0KICAgICAgaWYgKGhhcyhPLCBQKSkKICAgICAgcmV0dXJuIGNyZWF0ZVByb3BlcnR5RGVzY3JpcHRvcighcHJvcGVydHlJc0VudW1lcmFibGVNb2R1bGUuZi5jYWxsKE8sIFApLCBPW1BdKTsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDggKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgZmFpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDkpOwogICAgbW9kdWxlLmV4cG9ydHMgPSAhZmFpbHMoZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KHt9LCAxLCB7CiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICByZXR1cm4gNzsKICAgICAgICB9CiAgICAgIH0pWzFdICE9IDc7CiAgICB9KTsKCiAgICAvKioqL30pLCAoCiAgLyogOSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewoKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGV4ZWMpIHsKICAgICAgdHJ5IHsKICAgICAgICByZXR1cm4gISFleGVjKCk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDEwICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBuYXRpdmVQcm9wZXJ0eUlzRW51bWVyYWJsZSA9IHt9LnByb3BlcnR5SXNFbnVtZXJhYmxlOwogICAgdmFyIGdldE93blByb3BlcnR5RGVzY3JpcHRvciA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7CiAgICB2YXIgTkFTSE9STl9CVUcgPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgJiYgIW5hdGl2ZVByb3BlcnR5SXNFbnVtZXJhYmxlLmNhbGwoeyAxOiAyIH0sIDEpOwogICAgZXhwb3J0cy5mID0gTkFTSE9STl9CVUcgPyBmdW5jdGlvbiBwcm9wZXJ0eUlzRW51bWVyYWJsZShWKSB7CiAgICAgIHZhciBkZXNjcmlwdG9yID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRoaXMsIFYpOwogICAgICByZXR1cm4gISFkZXNjcmlwdG9yICYmIGRlc2NyaXB0b3IuZW51bWVyYWJsZTsKICAgIH0gOiBuYXRpdmVQcm9wZXJ0eUlzRW51bWVyYWJsZTsKCiAgICAvKioqL30pLCAoCiAgLyogMTEgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKCiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChiaXRtYXAsIHZhbHVlKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgZW51bWVyYWJsZTogIShiaXRtYXAgJiAxKSwKICAgICAgICBjb25maWd1cmFibGU6ICEoYml0bWFwICYgMiksCiAgICAgICAgd3JpdGFibGU6ICEoYml0bWFwICYgNCksCiAgICAgICAgdmFsdWU6IHZhbHVlCiAgICAgIH07CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAxMiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBJbmRleGVkT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygxMyk7CiAgICB2YXIgcmVxdWlyZU9iamVjdENvZXJjaWJsZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTUpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsKICAgICAgcmV0dXJuIEluZGV4ZWRPYmplY3QocmVxdWlyZU9iamVjdENvZXJjaWJsZShpdCkpOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogMTMgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgZmFpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDkpOwogICAgdmFyIGNsYXNzb2YgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE0KTsKICAgIHZhciBzcGxpdCA9ICcnLnNwbGl0OwogICAgbW9kdWxlLmV4cG9ydHMgPSBmYWlscyhmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiAhT2JqZWN0KCd6JykucHJvcGVydHlJc0VudW1lcmFibGUoMCk7CiAgICB9KSA/IGZ1bmN0aW9uIChpdCkgewogICAgICByZXR1cm4gY2xhc3NvZihpdCkgPT0gJ1N0cmluZycgPyBzcGxpdC5jYWxsKGl0LCAnJykgOiBPYmplY3QoaXQpOwogICAgfSA6IE9iamVjdDsKCiAgICAvKioqL30pLCAoCiAgLyogMTQgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKCiAgICB2YXIgdG9TdHJpbmcgPSB7fS50b1N0cmluZzsKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7CiAgICAgIHJldHVybiB0b1N0cmluZy5jYWxsKGl0KS5zbGljZSg4LCAtMSk7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAxNSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewoKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7CiAgICAgIGlmIChpdCA9PSB1bmRlZmluZWQpCiAgICAgIHRocm93IFR5cGVFcnJvcigiQ2FuJ3QgY2FsbCBtZXRob2Qgb24gIiArIGl0KTsKICAgICAgcmV0dXJuIGl0OwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogMTYgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgaXNPYmplY3QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE3KTsKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGlucHV0LCBQUkVGRVJSRURfU1RSSU5HKSB7CiAgICAgIGlmICghaXNPYmplY3QoaW5wdXQpKQogICAgICByZXR1cm4gaW5wdXQ7CiAgICAgIHZhciBmbiwgdmFsOwogICAgICBpZiAoUFJFRkVSUkVEX1NUUklORyAmJiB0eXBlb2YgKGZuID0gaW5wdXQudG9TdHJpbmcpID09ICdmdW5jdGlvbicgJiYgIWlzT2JqZWN0KHZhbCA9IGZuLmNhbGwoaW5wdXQpKSkKICAgICAgcmV0dXJuIHZhbDsKICAgICAgaWYgKHR5cGVvZiAoZm4gPSBpbnB1dC52YWx1ZU9mKSA9PSAnZnVuY3Rpb24nICYmICFpc09iamVjdCh2YWwgPSBmbi5jYWxsKGlucHV0KSkpCiAgICAgIHJldHVybiB2YWw7CiAgICAgIGlmICghUFJFRkVSUkVEX1NUUklORyAmJiB0eXBlb2YgKGZuID0gaW5wdXQudG9TdHJpbmcpID09ICdmdW5jdGlvbicgJiYgIWlzT2JqZWN0KHZhbCA9IGZuLmNhbGwoaW5wdXQpKSkKICAgICAgcmV0dXJuIHZhbDsKICAgICAgdGhyb3cgVHlwZUVycm9yKCJDYW4ndCBjb252ZXJ0IG9iamVjdCB0byBwcmltaXRpdmUgdmFsdWUiKTsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDE3ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsKICAgICAgcmV0dXJuIHR5cGVvZiBpdCA9PT0gJ29iamVjdCcgPyBpdCAhPT0gbnVsbCA6IHR5cGVvZiBpdCA9PT0gJ2Z1bmN0aW9uJzsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDE4ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgogICAgdmFyIGhhc093blByb3BlcnR5ID0ge30uaGFzT3duUHJvcGVydHk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCwga2V5KSB7CiAgICAgIHJldHVybiBoYXNPd25Qcm9wZXJ0eS5jYWxsKGl0LCBrZXkpOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogMTkgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgREVTQ1JJUFRPUlMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDgpOwogICAgdmFyIGZhaWxzID0gX193X3BkZmpzX3JlcXVpcmVfXyg5KTsKICAgIHZhciBjcmVhdGVFbGVtZW50ID0gX193X3BkZmpzX3JlcXVpcmVfXygyMCk7CiAgICBtb2R1bGUuZXhwb3J0cyA9ICFERVNDUklQVE9SUyAmJiAhZmFpbHMoZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KGNyZWF0ZUVsZW1lbnQoJ2RpdicpLCAnYScsIHsKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiA3OwogICAgICAgIH0KICAgICAgfSkuYSAhPSA3OwogICAgfSk7CgogICAgLyoqKi99KSwgKAogIC8qIDIwICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGdsb2JhbCA9IF9fd19wZGZqc19yZXF1aXJlX18oNik7CiAgICB2YXIgaXNPYmplY3QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE3KTsKICAgIHZhciBkb2N1bWVudCA9IGdsb2JhbC5kb2N1bWVudDsKICAgIHZhciBFWElTVFMgPSBpc09iamVjdChkb2N1bWVudCkgJiYgaXNPYmplY3QoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkgewogICAgICByZXR1cm4gRVhJU1RTID8gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChpdCkgOiB7fTsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDIxICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIERFU0NSSVBUT1JTID0gX193X3BkZmpzX3JlcXVpcmVfXyg4KTsKICAgIHZhciBkZWZpbmVQcm9wZXJ0eU1vZHVsZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjIpOwogICAgdmFyIGNyZWF0ZVByb3BlcnR5RGVzY3JpcHRvciA9IF9fd19wZGZqc19yZXF1aXJlX18oMTEpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBERVNDUklQVE9SUyA/IGZ1bmN0aW9uIChvYmplY3QsIGtleSwgdmFsdWUpIHsKICAgICAgcmV0dXJuIGRlZmluZVByb3BlcnR5TW9kdWxlLmYob2JqZWN0LCBrZXksIGNyZWF0ZVByb3BlcnR5RGVzY3JpcHRvcigxLCB2YWx1ZSkpOwogICAgfSA6IGZ1bmN0aW9uIChvYmplY3QsIGtleSwgdmFsdWUpIHsKICAgICAgb2JqZWN0W2tleV0gPSB2YWx1ZTsKICAgICAgcmV0dXJuIG9iamVjdDsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDIyICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIERFU0NSSVBUT1JTID0gX193X3BkZmpzX3JlcXVpcmVfXyg4KTsKICAgIHZhciBJRThfRE9NX0RFRklORSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTkpOwogICAgdmFyIGFuT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygyMyk7CiAgICB2YXIgdG9QcmltaXRpdmUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE2KTsKICAgIHZhciBuYXRpdmVEZWZpbmVQcm9wZXJ0eSA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eTsKICAgIGV4cG9ydHMuZiA9IERFU0NSSVBUT1JTID8gbmF0aXZlRGVmaW5lUHJvcGVydHkgOiBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0eShPLCBQLCBBdHRyaWJ1dGVzKSB7CiAgICAgIGFuT2JqZWN0KE8pOwogICAgICBQID0gdG9QcmltaXRpdmUoUCwgdHJ1ZSk7CiAgICAgIGFuT2JqZWN0KEF0dHJpYnV0ZXMpOwogICAgICBpZiAoSUU4X0RPTV9ERUZJTkUpCiAgICAgIHRyeSB7CiAgICAgICAgcmV0dXJuIG5hdGl2ZURlZmluZVByb3BlcnR5KE8sIFAsIEF0dHJpYnV0ZXMpOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICB9CiAgICAgIGlmICgnZ2V0JyBpbiBBdHRyaWJ1dGVzIHx8ICdzZXQnIGluIEF0dHJpYnV0ZXMpCiAgICAgIHRocm93IFR5cGVFcnJvcignQWNjZXNzb3JzIG5vdCBzdXBwb3J0ZWQnKTsKICAgICAgaWYgKCd2YWx1ZScgaW4gQXR0cmlidXRlcykKICAgICAgT1tQXSA9IEF0dHJpYnV0ZXMudmFsdWU7CiAgICAgIHJldHVybiBPOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogMjMgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgaXNPYmplY3QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE3KTsKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7CiAgICAgIGlmICghaXNPYmplY3QoaXQpKSB7CiAgICAgICAgdGhyb3cgVHlwZUVycm9yKFN0cmluZyhpdCkgKyAnIGlzIG5vdCBhbiBvYmplY3QnKTsKICAgICAgfQogICAgICByZXR1cm4gaXQ7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAyNCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBnbG9iYWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDYpOwogICAgdmFyIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjEpOwogICAgdmFyIGhhcyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTgpOwogICAgdmFyIHNldEdsb2JhbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMjUpOwogICAgdmFyIGluc3BlY3RTb3VyY2UgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDI2KTsKICAgIHZhciBJbnRlcm5hbFN0YXRlTW9kdWxlID0gX193X3BkZmpzX3JlcXVpcmVfXygyOCk7CiAgICB2YXIgZ2V0SW50ZXJuYWxTdGF0ZSA9IEludGVybmFsU3RhdGVNb2R1bGUuZ2V0OwogICAgdmFyIGVuZm9yY2VJbnRlcm5hbFN0YXRlID0gSW50ZXJuYWxTdGF0ZU1vZHVsZS5lbmZvcmNlOwogICAgdmFyIFRFTVBMQVRFID0gU3RyaW5nKFN0cmluZykuc3BsaXQoJ1N0cmluZycpOwogICAgKG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKE8sIGtleSwgdmFsdWUsIG9wdGlvbnMpIHsKICAgICAgdmFyIHVuc2FmZSA9IG9wdGlvbnMgPyAhIW9wdGlvbnMudW5zYWZlIDogZmFsc2U7CiAgICAgIHZhciBzaW1wbGUgPSBvcHRpb25zID8gISFvcHRpb25zLmVudW1lcmFibGUgOiBmYWxzZTsKICAgICAgdmFyIG5vVGFyZ2V0R2V0ID0gb3B0aW9ucyA/ICEhb3B0aW9ucy5ub1RhcmdldEdldCA6IGZhbHNlOwogICAgICBpZiAodHlwZW9mIHZhbHVlID09ICdmdW5jdGlvbicpIHsKICAgICAgICBpZiAodHlwZW9mIGtleSA9PSAnc3RyaW5nJyAmJiAhaGFzKHZhbHVlLCAnbmFtZScpKQogICAgICAgIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSh2YWx1ZSwgJ25hbWUnLCBrZXkpOwogICAgICAgIGVuZm9yY2VJbnRlcm5hbFN0YXRlKHZhbHVlKS5zb3VyY2UgPSBURU1QTEFURS5qb2luKHR5cGVvZiBrZXkgPT0gJ3N0cmluZycgPyBrZXkgOiAnJyk7CiAgICAgIH0KICAgICAgaWYgKE8gPT09IGdsb2JhbCkgewogICAgICAgIGlmIChzaW1wbGUpCiAgICAgICAgT1trZXldID0gdmFsdWU7ZWxzZQoKICAgICAgICBzZXRHbG9iYWwoa2V5LCB2YWx1ZSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKCF1bnNhZmUpIHsKICAgICAgICBkZWxldGUgT1trZXldOwogICAgICB9IGVsc2UgaWYgKCFub1RhcmdldEdldCAmJiBPW2tleV0pIHsKICAgICAgICBzaW1wbGUgPSB0cnVlOwogICAgICB9CiAgICAgIGlmIChzaW1wbGUpCiAgICAgIE9ba2V5XSA9IHZhbHVlO2Vsc2UKCiAgICAgIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eShPLCBrZXksIHZhbHVlKTsKICAgIH0pKEZ1bmN0aW9uLnByb3RvdHlwZSwgJ3RvU3RyaW5nJywgZnVuY3Rpb24gdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiB0eXBlb2YgdGhpcyA9PSAnZnVuY3Rpb24nICYmIGdldEludGVybmFsU3RhdGUodGhpcykuc291cmNlIHx8IGluc3BlY3RTb3VyY2UodGhpcyk7CiAgICB9KTsKCiAgICAvKioqL30pLCAoCiAgLyogMjUgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgZ2xvYmFsID0gX193X3BkZmpzX3JlcXVpcmVfXyg2KTsKICAgIHZhciBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIxKTsKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsKICAgICAgdHJ5IHsKICAgICAgICBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkoZ2xvYmFsLCBrZXksIHZhbHVlKTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBnbG9iYWxba2V5XSA9IHZhbHVlOwogICAgICB9CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDI2ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIHN0b3JlID0gX193X3BkZmpzX3JlcXVpcmVfXygyNyk7CiAgICB2YXIgZnVuY3Rpb25Ub1N0cmluZyA9IEZ1bmN0aW9uLnRvU3RyaW5nOwogICAgaWYgKHR5cGVvZiBzdG9yZS5pbnNwZWN0U291cmNlICE9ICdmdW5jdGlvbicpIHsKICAgICAgc3RvcmUuaW5zcGVjdFNvdXJjZSA9IGZ1bmN0aW9uIChpdCkgewogICAgICAgIHJldHVybiBmdW5jdGlvblRvU3RyaW5nLmNhbGwoaXQpOwogICAgICB9OwogICAgfQogICAgbW9kdWxlLmV4cG9ydHMgPSBzdG9yZS5pbnNwZWN0U291cmNlOwoKICAgIC8qKiovfSksICgKICAvKiAyNyAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBnbG9iYWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDYpOwogICAgdmFyIHNldEdsb2JhbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMjUpOwogICAgdmFyIFNIQVJFRCA9ICdfX2NvcmUtanNfc2hhcmVkX18nOwogICAgdmFyIHN0b3JlID0gZ2xvYmFsW1NIQVJFRF0gfHwgc2V0R2xvYmFsKFNIQVJFRCwge30pOwogICAgbW9kdWxlLmV4cG9ydHMgPSBzdG9yZTsKCiAgICAvKioqL30pLCAoCiAgLyogMjggKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgTkFUSVZFX1dFQUtfTUFQID0gX193X3BkZmpzX3JlcXVpcmVfXygyOSk7CiAgICB2YXIgZ2xvYmFsID0gX193X3BkZmpzX3JlcXVpcmVfXyg2KTsKICAgIHZhciBpc09iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTcpOwogICAgdmFyIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjEpOwogICAgdmFyIG9iamVjdEhhcyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTgpOwogICAgdmFyIHNoYXJlZEtleSA9IF9fd19wZGZqc19yZXF1aXJlX18oMzApOwogICAgdmFyIGhpZGRlbktleXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDM0KTsKICAgIHZhciBXZWFrTWFwID0gZ2xvYmFsLldlYWtNYXA7CiAgICB2YXIgc2V0LCBnZXQsIGhhczsKICAgIHZhciBlbmZvcmNlID0gZnVuY3Rpb24gZW5mb3JjZShpdCkgewogICAgICByZXR1cm4gaGFzKGl0KSA/IGdldChpdCkgOiBzZXQoaXQsIHt9KTsKICAgIH07CiAgICB2YXIgZ2V0dGVyRm9yID0gZnVuY3Rpb24gZ2V0dGVyRm9yKFRZUEUpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uIChpdCkgewogICAgICAgIHZhciBzdGF0ZTsKICAgICAgICBpZiAoIWlzT2JqZWN0KGl0KSB8fCAoc3RhdGUgPSBnZXQoaXQpKS50eXBlICE9PSBUWVBFKSB7CiAgICAgICAgICB0aHJvdyBUeXBlRXJyb3IoJ0luY29tcGF0aWJsZSByZWNlaXZlciwgJyArIFRZUEUgKyAnIHJlcXVpcmVkJyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzdGF0ZTsKICAgICAgfTsKICAgIH07CiAgICBpZiAoTkFUSVZFX1dFQUtfTUFQKSB7CiAgICAgIHZhciBzdG9yZSA9IG5ldyBXZWFrTWFwKCk7CiAgICAgIHZhciB3bWdldCA9IHN0b3JlLmdldDsKICAgICAgdmFyIHdtaGFzID0gc3RvcmUuaGFzOwogICAgICB2YXIgd21zZXQgPSBzdG9yZS5zZXQ7CiAgICAgIHNldCA9IGZ1bmN0aW9uIHNldChpdCwgbWV0YWRhdGEpIHsKICAgICAgICB3bXNldC5jYWxsKHN0b3JlLCBpdCwgbWV0YWRhdGEpOwogICAgICAgIHJldHVybiBtZXRhZGF0YTsKICAgICAgfTsKICAgICAgZ2V0ID0gZnVuY3Rpb24gZ2V0KGl0KSB7CiAgICAgICAgcmV0dXJuIHdtZ2V0LmNhbGwoc3RvcmUsIGl0KSB8fCB7fTsKICAgICAgfTsKICAgICAgaGFzID0gZnVuY3Rpb24gaGFzKGl0KSB7CiAgICAgICAgcmV0dXJuIHdtaGFzLmNhbGwoc3RvcmUsIGl0KTsKICAgICAgfTsKICAgIH0gZWxzZSB7CiAgICAgIHZhciBTVEFURSA9IHNoYXJlZEtleSgnc3RhdGUnKTsKICAgICAgaGlkZGVuS2V5c1tTVEFURV0gPSB0cnVlOwogICAgICBzZXQgPSBmdW5jdGlvbiBzZXQoaXQsIG1ldGFkYXRhKSB7CiAgICAgICAgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5KGl0LCBTVEFURSwgbWV0YWRhdGEpOwogICAgICAgIHJldHVybiBtZXRhZGF0YTsKICAgICAgfTsKICAgICAgZ2V0ID0gZnVuY3Rpb24gZ2V0KGl0KSB7CiAgICAgICAgcmV0dXJuIG9iamVjdEhhcyhpdCwgU1RBVEUpID8gaXRbU1RBVEVdIDoge307CiAgICAgIH07CiAgICAgIGhhcyA9IGZ1bmN0aW9uIGhhcyhpdCkgewogICAgICAgIHJldHVybiBvYmplY3RIYXMoaXQsIFNUQVRFKTsKICAgICAgfTsKICAgIH0KICAgIG1vZHVsZS5leHBvcnRzID0gewogICAgICBzZXQ6IHNldCwKICAgICAgZ2V0OiBnZXQsCiAgICAgIGhhczogaGFzLAogICAgICBlbmZvcmNlOiBlbmZvcmNlLAogICAgICBnZXR0ZXJGb3I6IGdldHRlckZvcgogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogMjkgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgZ2xvYmFsID0gX193X3BkZmpzX3JlcXVpcmVfXyg2KTsKICAgIHZhciBpbnNwZWN0U291cmNlID0gX193X3BkZmpzX3JlcXVpcmVfXygyNik7CiAgICB2YXIgV2Vha01hcCA9IGdsb2JhbC5XZWFrTWFwOwogICAgbW9kdWxlLmV4cG9ydHMgPSB0eXBlb2YgV2Vha01hcCA9PT0gJ2Z1bmN0aW9uJyAmJiAvbmF0aXZlIGNvZGUvLnRlc3QoaW5zcGVjdFNvdXJjZShXZWFrTWFwKSk7CgogICAgLyoqKi99KSwgKAogIC8qIDMwICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIHNoYXJlZCA9IF9fd19wZGZqc19yZXF1aXJlX18oMzEpOwogICAgdmFyIHVpZCA9IF9fd19wZGZqc19yZXF1aXJlX18oMzMpOwogICAgdmFyIGtleXMgPSBzaGFyZWQoJ2tleXMnKTsKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGtleSkgewogICAgICByZXR1cm4ga2V5c1trZXldIHx8IChrZXlzW2tleV0gPSB1aWQoa2V5KSk7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAzMSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBJU19QVVJFID0gX193X3BkZmpzX3JlcXVpcmVfXygzMik7CiAgICB2YXIgc3RvcmUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDI3KTsKICAgIChtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CiAgICAgIHJldHVybiBzdG9yZVtrZXldIHx8IChzdG9yZVtrZXldID0gdmFsdWUgIT09IHVuZGVmaW5lZCA/IHZhbHVlIDoge30pOwogICAgfSkoJ3ZlcnNpb25zJywgW10pLnB1c2goewogICAgICB2ZXJzaW9uOiAnMy42LjQnLAogICAgICBtb2RlOiBJU19QVVJFID8gJ3B1cmUnIDogJ2dsb2JhbCcsCiAgICAgIGNvcHlyaWdodDogJ8KpIDIwMjAgRGVuaXMgUHVzaGthcmV2ICh6bG9pcm9jay5ydSknCiAgICB9KTsKCiAgICAvKioqL30pLCAoCiAgLyogMzIgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKCiAgICBtb2R1bGUuZXhwb3J0cyA9IGZhbHNlOwoKICAgIC8qKiovfSksICgKICAvKiAzMyAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewoKICAgIHZhciBpZCA9IDA7CiAgICB2YXIgcG9zdGZpeCA9IE1hdGgucmFuZG9tKCk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChrZXkpIHsKICAgICAgcmV0dXJuICdTeW1ib2woJyArIFN0cmluZyhrZXkgPT09IHVuZGVmaW5lZCA/ICcnIDoga2V5KSArICcpXycgKyAoKytpZCArIHBvc3RmaXgpLnRvU3RyaW5nKDM2KTsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDM0ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgogICAgbW9kdWxlLmV4cG9ydHMgPSB7fTsKCiAgICAvKioqL30pLCAoCiAgLyogMzUgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgaGFzID0gX193X3BkZmpzX3JlcXVpcmVfXygxOCk7CiAgICB2YXIgb3duS2V5cyA9IF9fd19wZGZqc19yZXF1aXJlX18oMzYpOwogICAgdmFyIGdldE93blByb3BlcnR5RGVzY3JpcHRvck1vZHVsZSA9IF9fd19wZGZqc19yZXF1aXJlX18oNyk7CiAgICB2YXIgZGVmaW5lUHJvcGVydHlNb2R1bGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIyKTsKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKHRhcmdldCwgc291cmNlKSB7CiAgICAgIHZhciBrZXlzID0gb3duS2V5cyhzb3VyY2UpOwogICAgICB2YXIgZGVmaW5lUHJvcGVydHkgPSBkZWZpbmVQcm9wZXJ0eU1vZHVsZS5mOwogICAgICB2YXIgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yTW9kdWxlLmY7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBrZXkgPSBrZXlzW2ldOwogICAgICAgIGlmICghaGFzKHRhcmdldCwga2V5KSkKICAgICAgICBkZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7CiAgICAgIH0KICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDM2ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGdldEJ1aWx0SW4gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDM3KTsKICAgIHZhciBnZXRPd25Qcm9wZXJ0eU5hbWVzTW9kdWxlID0gX193X3BkZmpzX3JlcXVpcmVfXygzOSk7CiAgICB2YXIgZ2V0T3duUHJvcGVydHlTeW1ib2xzTW9kdWxlID0gX193X3BkZmpzX3JlcXVpcmVfXyg0Nik7CiAgICB2YXIgYW5PYmplY3QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIzKTsKICAgIG1vZHVsZS5leHBvcnRzID0gZ2V0QnVpbHRJbignUmVmbGVjdCcsICdvd25LZXlzJykgfHwgZnVuY3Rpb24gb3duS2V5cyhpdCkgewogICAgICB2YXIga2V5cyA9IGdldE93blByb3BlcnR5TmFtZXNNb2R1bGUuZihhbk9iamVjdChpdCkpOwogICAgICB2YXIgZ2V0T3duUHJvcGVydHlTeW1ib2xzID0gZ2V0T3duUHJvcGVydHlTeW1ib2xzTW9kdWxlLmY7CiAgICAgIHJldHVybiBnZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPyBrZXlzLmNvbmNhdChnZXRPd25Qcm9wZXJ0eVN5bWJvbHMoaXQpKSA6IGtleXM7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAzNyAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBwYXRoID0gX193X3BkZmpzX3JlcXVpcmVfXygzOCk7CiAgICB2YXIgZ2xvYmFsID0gX193X3BkZmpzX3JlcXVpcmVfXyg2KTsKICAgIHZhciBhRnVuY3Rpb24gPSBmdW5jdGlvbiBhRnVuY3Rpb24odmFyaWFibGUpIHsKICAgICAgcmV0dXJuIHR5cGVvZiB2YXJpYWJsZSA9PSAnZnVuY3Rpb24nID8gdmFyaWFibGUgOiB1bmRlZmluZWQ7CiAgICB9OwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAobmFtZXNwYWNlLCBtZXRob2QpIHsKICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPCAyID8gYUZ1bmN0aW9uKHBhdGhbbmFtZXNwYWNlXSkgfHwgYUZ1bmN0aW9uKGdsb2JhbFtuYW1lc3BhY2VdKSA6IHBhdGhbbmFtZXNwYWNlXSAmJiBwYXRoW25hbWVzcGFjZV1bbWV0aG9kXSB8fCBnbG9iYWxbbmFtZXNwYWNlXSAmJiBnbG9iYWxbbmFtZXNwYWNlXVttZXRob2RdOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogMzggKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgZ2xvYmFsID0gX193X3BkZmpzX3JlcXVpcmVfXyg2KTsKICAgIG1vZHVsZS5leHBvcnRzID0gZ2xvYmFsOwoKICAgIC8qKiovfSksICgKICAvKiAzOSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBpbnRlcm5hbE9iamVjdEtleXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDQwKTsKICAgIHZhciBlbnVtQnVnS2V5cyA9IF9fd19wZGZqc19yZXF1aXJlX18oNDUpOwogICAgdmFyIGhpZGRlbktleXMgPSBlbnVtQnVnS2V5cy5jb25jYXQoJ2xlbmd0aCcsICdwcm90b3R5cGUnKTsKICAgIGV4cG9ydHMuZiA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzIHx8IGZ1bmN0aW9uIGdldE93blByb3BlcnR5TmFtZXMoTykgewogICAgICByZXR1cm4gaW50ZXJuYWxPYmplY3RLZXlzKE8sIGhpZGRlbktleXMpOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogNDAgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgaGFzID0gX193X3BkZmpzX3JlcXVpcmVfXygxOCk7CiAgICB2YXIgdG9JbmRleGVkT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygxMik7CiAgICB2YXIgaW5kZXhPZiA9IF9fd19wZGZqc19yZXF1aXJlX18oNDEpLmluZGV4T2Y7CiAgICB2YXIgaGlkZGVuS2V5cyA9IF9fd19wZGZqc19yZXF1aXJlX18oMzQpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAob2JqZWN0LCBuYW1lcykgewogICAgICB2YXIgTyA9IHRvSW5kZXhlZE9iamVjdChvYmplY3QpOwogICAgICB2YXIgaSA9IDA7CiAgICAgIHZhciByZXN1bHQgPSBbXTsKICAgICAgdmFyIGtleTsKICAgICAgZm9yIChrZXkgaW4gTykKICAgICAgIWhhcyhoaWRkZW5LZXlzLCBrZXkpICYmIGhhcyhPLCBrZXkpICYmIHJlc3VsdC5wdXNoKGtleSk7CiAgICAgIHdoaWxlIChuYW1lcy5sZW5ndGggPiBpKQogICAgICBpZiAoaGFzKE8sIGtleSA9IG5hbWVzW2krK10pKSB7CiAgICAgICAgfmluZGV4T2YocmVzdWx0LCBrZXkpIHx8IHJlc3VsdC5wdXNoKGtleSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDQxICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIHRvSW5kZXhlZE9iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTIpOwogICAgdmFyIHRvTGVuZ3RoID0gX193X3BkZmpzX3JlcXVpcmVfXyg0Mik7CiAgICB2YXIgdG9BYnNvbHV0ZUluZGV4ID0gX193X3BkZmpzX3JlcXVpcmVfXyg0NCk7CiAgICB2YXIgY3JlYXRlTWV0aG9kID0gZnVuY3Rpb24gY3JlYXRlTWV0aG9kKElTX0lOQ0xVREVTKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoJHRoaXMsIGVsLCBmcm9tSW5kZXgpIHsKICAgICAgICB2YXIgTyA9IHRvSW5kZXhlZE9iamVjdCgkdGhpcyk7CiAgICAgICAgdmFyIGxlbmd0aCA9IHRvTGVuZ3RoKE8ubGVuZ3RoKTsKICAgICAgICB2YXIgaW5kZXggPSB0b0Fic29sdXRlSW5kZXgoZnJvbUluZGV4LCBsZW5ndGgpOwogICAgICAgIHZhciB2YWx1ZTsKICAgICAgICBpZiAoSVNfSU5DTFVERVMgJiYgZWwgIT0gZWwpCiAgICAgICAgd2hpbGUgKGxlbmd0aCA+IGluZGV4KSB7CiAgICAgICAgICB2YWx1ZSA9IE9baW5kZXgrK107CiAgICAgICAgICBpZiAodmFsdWUgIT0gdmFsdWUpCiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UKCiAgICAgICAgZm9yICg7IGxlbmd0aCA+IGluZGV4OyBpbmRleCsrKSB7CiAgICAgICAgICBpZiAoKElTX0lOQ0xVREVTIHx8IGluZGV4IGluIE8pICYmIE9baW5kZXhdID09PSBlbCkKICAgICAgICAgIHJldHVybiBJU19JTkNMVURFUyB8fCBpbmRleCB8fCAwOwogICAgICAgIH0KICAgICAgICByZXR1cm4gIUlTX0lOQ0xVREVTICYmIC0xOwogICAgICB9OwogICAgfTsKICAgIG1vZHVsZS5leHBvcnRzID0gewogICAgICBpbmNsdWRlczogY3JlYXRlTWV0aG9kKHRydWUpLAogICAgICBpbmRleE9mOiBjcmVhdGVNZXRob2QoZmFsc2UpCiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiA0MiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciB0b0ludGVnZXIgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDQzKTsKICAgIHZhciBtaW4gPSBNYXRoLm1pbjsKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGFyZ3VtZW50KSB7CiAgICAgIHJldHVybiBhcmd1bWVudCA+IDAgPyBtaW4odG9JbnRlZ2VyKGFyZ3VtZW50KSwgMHgxRkZGRkZGRkZGRkZGRikgOiAwOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogNDMgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKCiAgICB2YXIgY2VpbCA9IE1hdGguY2VpbDsKICAgIHZhciBmbG9vciA9IE1hdGguZmxvb3I7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChhcmd1bWVudCkgewogICAgICByZXR1cm4gaXNOYU4oYXJndW1lbnQgPSArYXJndW1lbnQpID8gMCA6IChhcmd1bWVudCA+IDAgPyBmbG9vciA6IGNlaWwpKGFyZ3VtZW50KTsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDQ0ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIHRvSW50ZWdlciA9IF9fd19wZGZqc19yZXF1aXJlX18oNDMpOwogICAgdmFyIG1heCA9IE1hdGgubWF4OwogICAgdmFyIG1pbiA9IE1hdGgubWluOwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaW5kZXgsIGxlbmd0aCkgewogICAgICB2YXIgaW50ZWdlciA9IHRvSW50ZWdlcihpbmRleCk7CiAgICAgIHJldHVybiBpbnRlZ2VyIDwgMCA/IG1heChpbnRlZ2VyICsgbGVuZ3RoLCAwKSA6IG1pbihpbnRlZ2VyLCBsZW5ndGgpOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogNDUgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKCiAgICBtb2R1bGUuZXhwb3J0cyA9IFsKICAgICdjb25zdHJ1Y3RvcicsCiAgICAnaGFzT3duUHJvcGVydHknLAogICAgJ2lzUHJvdG90eXBlT2YnLAogICAgJ3Byb3BlcnR5SXNFbnVtZXJhYmxlJywKICAgICd0b0xvY2FsZVN0cmluZycsCiAgICAndG9TdHJpbmcnLAogICAgJ3ZhbHVlT2YnXTsKCgogICAgLyoqKi99KSwgKAogIC8qIDQ2ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgogICAgZXhwb3J0cy5mID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9sczsKCiAgICAvKioqL30pLCAoCiAgLyogNDcgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgZmFpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDkpOwogICAgdmFyIHJlcGxhY2VtZW50ID0gLyN8XC5wcm90b3R5cGVcLi87CiAgICB2YXIgaXNGb3JjZWQgPSBmdW5jdGlvbiBpc0ZvcmNlZChmZWF0dXJlLCBkZXRlY3Rpb24pIHsKICAgICAgdmFyIHZhbHVlID0gZGF0YVtub3JtYWxpemUoZmVhdHVyZSldOwogICAgICByZXR1cm4gdmFsdWUgPT0gUE9MWUZJTEwgPyB0cnVlIDogdmFsdWUgPT0gTkFUSVZFID8gZmFsc2UgOiB0eXBlb2YgZGV0ZWN0aW9uID09ICdmdW5jdGlvbicgPyBmYWlscyhkZXRlY3Rpb24pIDogISFkZXRlY3Rpb247CiAgICB9OwogICAgdmFyIG5vcm1hbGl6ZSA9IGlzRm9yY2VkLm5vcm1hbGl6ZSA9IGZ1bmN0aW9uIChzdHJpbmcpIHsKICAgICAgcmV0dXJuIFN0cmluZyhzdHJpbmcpLnJlcGxhY2UocmVwbGFjZW1lbnQsICcuJykudG9Mb3dlckNhc2UoKTsKICAgIH07CiAgICB2YXIgZGF0YSA9IGlzRm9yY2VkLmRhdGEgPSB7fTsKICAgIHZhciBOQVRJVkUgPSBpc0ZvcmNlZC5OQVRJVkUgPSAnTic7CiAgICB2YXIgUE9MWUZJTEwgPSBpc0ZvcmNlZC5QT0xZRklMTCA9ICdQJzsKICAgIG1vZHVsZS5leHBvcnRzID0gaXNGb3JjZWQ7CgogICAgLyoqKi99KSwgKAogIC8qIDQ4ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgIHZhbHVlOiB0cnVlCiAgICB9KTsKICAgIGV4cG9ydHMuaXNOb2RlSlMgPSB2b2lkIDA7CgogICAgZnVuY3Rpb24gX3R5cGVvZihvYmopIHsiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2YiO2lmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7X3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7cmV0dXJuIHR5cGVvZiBvYmo7fTt9IGVsc2Uge190eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikge3JldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmo7fTt9cmV0dXJuIF90eXBlb2Yob2JqKTt9CgogICAgdmFyIGlzTm9kZUpTID0gKHR5cGVvZiBwcm9jZXNzID09PSAidW5kZWZpbmVkIiA/ICJ1bmRlZmluZWQiIDogX3R5cGVvZihwcm9jZXNzKSkgPT09ICJvYmplY3QiICYmIHByb2Nlc3MgKyAiIiA9PT0gIltvYmplY3QgcHJvY2Vzc10iICYmICFwcm9jZXNzLnZlcnNpb25zWyJudyJdICYmICFwcm9jZXNzLnZlcnNpb25zWyJlbGVjdHJvbiJdOwogICAgZXhwb3J0cy5pc05vZGVKUyA9IGlzTm9kZUpTOwoKICAgIC8qKiovfSksICgKICAvKiA0OSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIF9fd19wZGZqc19yZXF1aXJlX18oNTApOwogICAgdmFyIGVudHJ5VW5iaW5kID0gX193X3BkZmpzX3JlcXVpcmVfXyg1Nyk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGVudHJ5VW5iaW5kKCdTdHJpbmcnLCAnc3RhcnRzV2l0aCcpOwoKICAgIC8qKiovfSksICgKICAvKiA1MCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgJCA9IF9fd19wZGZqc19yZXF1aXJlX18oNSk7CiAgICB2YXIgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0gX193X3BkZmpzX3JlcXVpcmVfXyg3KS5mOwogICAgdmFyIHRvTGVuZ3RoID0gX193X3BkZmpzX3JlcXVpcmVfXyg0Mik7CiAgICB2YXIgbm90QVJlZ0V4cCA9IF9fd19wZGZqc19yZXF1aXJlX18oNTEpOwogICAgdmFyIHJlcXVpcmVPYmplY3RDb2VyY2libGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE1KTsKICAgIHZhciBjb3JyZWN0SXNSZWdFeHBMb2dpYyA9IF9fd19wZGZqc19yZXF1aXJlX18oNTYpOwogICAgdmFyIElTX1BVUkUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDMyKTsKICAgIHZhciBuYXRpdmVTdGFydHNXaXRoID0gJycuc3RhcnRzV2l0aDsKICAgIHZhciBtaW4gPSBNYXRoLm1pbjsKICAgIHZhciBDT1JSRUNUX0lTX1JFR0VYUF9MT0dJQyA9IGNvcnJlY3RJc1JlZ0V4cExvZ2ljKCdzdGFydHNXaXRoJyk7CiAgICB2YXIgTUROX1BPTFlGSUxMX0JVRyA9ICFJU19QVVJFICYmICFDT1JSRUNUX0lTX1JFR0VYUF9MT0dJQyAmJiAhIWZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGRlc2NyaXB0b3IgPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoU3RyaW5nLnByb3RvdHlwZSwgJ3N0YXJ0c1dpdGgnKTsKICAgICAgcmV0dXJuIGRlc2NyaXB0b3IgJiYgIWRlc2NyaXB0b3Iud3JpdGFibGU7CiAgICB9KCk7CiAgICAkKHsKICAgICAgdGFyZ2V0OiAnU3RyaW5nJywKICAgICAgcHJvdG86IHRydWUsCiAgICAgIGZvcmNlZDogIU1ETl9QT0xZRklMTF9CVUcgJiYgIUNPUlJFQ1RfSVNfUkVHRVhQX0xPR0lDCiAgICB9LCB7CiAgICAgIHN0YXJ0c1dpdGg6IGZ1bmN0aW9uIHN0YXJ0c1dpdGgoc2VhcmNoU3RyaW5nKSB7CiAgICAgICAgdmFyIHRoYXQgPSBTdHJpbmcocmVxdWlyZU9iamVjdENvZXJjaWJsZSh0aGlzKSk7CiAgICAgICAgbm90QVJlZ0V4cChzZWFyY2hTdHJpbmcpOwogICAgICAgIHZhciBpbmRleCA9IHRvTGVuZ3RoKG1pbihhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZCwgdGhhdC5sZW5ndGgpKTsKICAgICAgICB2YXIgc2VhcmNoID0gU3RyaW5nKHNlYXJjaFN0cmluZyk7CiAgICAgICAgcmV0dXJuIG5hdGl2ZVN0YXJ0c1dpdGggPyBuYXRpdmVTdGFydHNXaXRoLmNhbGwodGhhdCwgc2VhcmNoLCBpbmRleCkgOiB0aGF0LnNsaWNlKGluZGV4LCBpbmRleCArIHNlYXJjaC5sZW5ndGgpID09PSBzZWFyY2g7CiAgICAgIH0KICAgIH0pOwoKICAgIC8qKiovfSksICgKICAvKiA1MSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBpc1JlZ0V4cCA9IF9fd19wZGZqc19yZXF1aXJlX18oNTIpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsKICAgICAgaWYgKGlzUmVnRXhwKGl0KSkgewogICAgICAgIHRocm93IFR5cGVFcnJvcigiVGhlIG1ldGhvZCBkb2Vzbid0IGFjY2VwdCByZWd1bGFyIGV4cHJlc3Npb25zIik7CiAgICAgIH0KICAgICAgcmV0dXJuIGl0OwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogNTIgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgaXNPYmplY3QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE3KTsKICAgIHZhciBjbGFzc29mID0gX193X3BkZmpzX3JlcXVpcmVfXygxNCk7CiAgICB2YXIgd2VsbEtub3duU3ltYm9sID0gX193X3BkZmpzX3JlcXVpcmVfXyg1Myk7CiAgICB2YXIgTUFUQ0ggPSB3ZWxsS25vd25TeW1ib2woJ21hdGNoJyk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkgewogICAgICB2YXIgaXNSZWdFeHA7CiAgICAgIHJldHVybiBpc09iamVjdChpdCkgJiYgKChpc1JlZ0V4cCA9IGl0W01BVENIXSkgIT09IHVuZGVmaW5lZCA/ICEhaXNSZWdFeHAgOiBjbGFzc29mKGl0KSA9PSAnUmVnRXhwJyk7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiA1MyAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBnbG9iYWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDYpOwogICAgdmFyIHNoYXJlZCA9IF9fd19wZGZqc19yZXF1aXJlX18oMzEpOwogICAgdmFyIGhhcyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTgpOwogICAgdmFyIHVpZCA9IF9fd19wZGZqc19yZXF1aXJlX18oMzMpOwogICAgdmFyIE5BVElWRV9TWU1CT0wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDU0KTsKICAgIHZhciBVU0VfU1lNQk9MX0FTX1VJRCA9IF9fd19wZGZqc19yZXF1aXJlX18oNTUpOwogICAgdmFyIFdlbGxLbm93blN5bWJvbHNTdG9yZSA9IHNoYXJlZCgnd2tzJyk7CiAgICB2YXIgU3ltYm9sID0gZ2xvYmFsLlN5bWJvbDsKICAgIHZhciBjcmVhdGVXZWxsS25vd25TeW1ib2wgPSBVU0VfU1lNQk9MX0FTX1VJRCA/IFN5bWJvbCA6IFN5bWJvbCAmJiBTeW1ib2wud2l0aG91dFNldHRlciB8fCB1aWQ7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChuYW1lKSB7CiAgICAgIGlmICghaGFzKFdlbGxLbm93blN5bWJvbHNTdG9yZSwgbmFtZSkpIHsKICAgICAgICBpZiAoTkFUSVZFX1NZTUJPTCAmJiBoYXMoU3ltYm9sLCBuYW1lKSkKICAgICAgICBXZWxsS25vd25TeW1ib2xzU3RvcmVbbmFtZV0gPSBTeW1ib2xbbmFtZV07ZWxzZQoKICAgICAgICBXZWxsS25vd25TeW1ib2xzU3RvcmVbbmFtZV0gPSBjcmVhdGVXZWxsS25vd25TeW1ib2woJ1N5bWJvbC4nICsgbmFtZSk7CiAgICAgIH0KICAgICAgcmV0dXJuIFdlbGxLbm93blN5bWJvbHNTdG9yZVtuYW1lXTsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDU0ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGZhaWxzID0gX193X3BkZmpzX3JlcXVpcmVfXyg5KTsKICAgIG1vZHVsZS5leHBvcnRzID0gISFPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzICYmICFmYWlscyhmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiAhU3RyaW5nKFN5bWJvbCgpKTsKICAgIH0pOwoKICAgIC8qKiovfSksICgKICAvKiA1NSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBOQVRJVkVfU1lNQk9MID0gX193X3BkZmpzX3JlcXVpcmVfXyg1NCk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IE5BVElWRV9TWU1CT0wgJiYgIVN5bWJvbC5zaGFtICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT0gJ3N5bWJvbCc7CgogICAgLyoqKi99KSwgKAogIC8qIDU2ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIHdlbGxLbm93blN5bWJvbCA9IF9fd19wZGZqc19yZXF1aXJlX18oNTMpOwogICAgdmFyIE1BVENIID0gd2VsbEtub3duU3ltYm9sKCdtYXRjaCcpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoTUVUSE9EX05BTUUpIHsKICAgICAgdmFyIHJlZ2V4cCA9IC8uLzsKICAgICAgdHJ5IHsKICAgICAgICAnLy4vJ1tNRVRIT0RfTkFNRV0ocmVnZXhwKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICByZWdleHBbTUFUQ0hdID0gZmFsc2U7CiAgICAgICAgICByZXR1cm4gJy8uLydbTUVUSE9EX05BTUVdKHJlZ2V4cCk7CiAgICAgICAgfSBjYXRjaCAoZikgewogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiA1NyAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBnbG9iYWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDYpOwogICAgdmFyIGJpbmQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDU4KTsKICAgIHZhciBjYWxsID0gRnVuY3Rpb24uY2FsbDsKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKENPTlNUUlVDVE9SLCBNRVRIT0QsIGxlbmd0aCkgewogICAgICByZXR1cm4gYmluZChjYWxsLCBnbG9iYWxbQ09OU1RSVUNUT1JdLnByb3RvdHlwZVtNRVRIT0RdLCBsZW5ndGgpOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogNTggKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgYUZ1bmN0aW9uID0gX193X3BkZmpzX3JlcXVpcmVfXyg1OSk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChmbiwgdGhhdCwgbGVuZ3RoKSB7CiAgICAgIGFGdW5jdGlvbihmbik7CiAgICAgIGlmICh0aGF0ID09PSB1bmRlZmluZWQpCiAgICAgIHJldHVybiBmbjsKICAgICAgc3dpdGNoIChsZW5ndGgpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gZm4uY2FsbCh0aGF0KTsKICAgICAgICAgIH07CiAgICAgICAgY2FzZSAxOgogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgIHJldHVybiBmbi5jYWxsKHRoYXQsIGEpOwogICAgICAgICAgfTsKICAgICAgICBjYXNlIDI6CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgICAgcmV0dXJuIGZuLmNhbGwodGhhdCwgYSwgYik7CiAgICAgICAgICB9OwogICAgICAgIGNhc2UgMzoKICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoYSwgYiwgYykgewogICAgICAgICAgICByZXR1cm4gZm4uY2FsbCh0aGF0LCBhLCBiLCBjKTsKICAgICAgICAgIH07CiAgICAgIH0KICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gZm4uYXBwbHkodGhhdCwgYXJndW1lbnRzKTsKICAgICAgfTsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDU5ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsKICAgICAgaWYgKHR5cGVvZiBpdCAhPSAnZnVuY3Rpb24nKSB7CiAgICAgICAgdGhyb3cgVHlwZUVycm9yKFN0cmluZyhpdCkgKyAnIGlzIG5vdCBhIGZ1bmN0aW9uJyk7CiAgICAgIH0KICAgICAgcmV0dXJuIGl0OwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogNjAgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDYxKTsKICAgIHZhciBlbnRyeVVuYmluZCA9IF9fd19wZGZqc19yZXF1aXJlX18oNTcpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBlbnRyeVVuYmluZCgnU3RyaW5nJywgJ2VuZHNXaXRoJyk7CgogICAgLyoqKi99KSwgKAogIC8qIDYxICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciAkID0gX193X3BkZmpzX3JlcXVpcmVfXyg1KTsKICAgIHZhciBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDcpLmY7CiAgICB2YXIgdG9MZW5ndGggPSBfX3dfcGRmanNfcmVxdWlyZV9fKDQyKTsKICAgIHZhciBub3RBUmVnRXhwID0gX193X3BkZmpzX3JlcXVpcmVfXyg1MSk7CiAgICB2YXIgcmVxdWlyZU9iamVjdENvZXJjaWJsZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTUpOwogICAgdmFyIGNvcnJlY3RJc1JlZ0V4cExvZ2ljID0gX193X3BkZmpzX3JlcXVpcmVfXyg1Nik7CiAgICB2YXIgSVNfUFVSRSA9IF9fd19wZGZqc19yZXF1aXJlX18oMzIpOwogICAgdmFyIG5hdGl2ZUVuZHNXaXRoID0gJycuZW5kc1dpdGg7CiAgICB2YXIgbWluID0gTWF0aC5taW47CiAgICB2YXIgQ09SUkVDVF9JU19SRUdFWFBfTE9HSUMgPSBjb3JyZWN0SXNSZWdFeHBMb2dpYygnZW5kc1dpdGgnKTsKICAgIHZhciBNRE5fUE9MWUZJTExfQlVHID0gIUlTX1BVUkUgJiYgIUNPUlJFQ1RfSVNfUkVHRVhQX0xPR0lDICYmICEhZnVuY3Rpb24gKCkgewogICAgICB2YXIgZGVzY3JpcHRvciA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvcihTdHJpbmcucHJvdG90eXBlLCAnZW5kc1dpdGgnKTsKICAgICAgcmV0dXJuIGRlc2NyaXB0b3IgJiYgIWRlc2NyaXB0b3Iud3JpdGFibGU7CiAgICB9KCk7CiAgICAkKHsKICAgICAgdGFyZ2V0OiAnU3RyaW5nJywKICAgICAgcHJvdG86IHRydWUsCiAgICAgIGZvcmNlZDogIU1ETl9QT0xZRklMTF9CVUcgJiYgIUNPUlJFQ1RfSVNfUkVHRVhQX0xPR0lDCiAgICB9LCB7CiAgICAgIGVuZHNXaXRoOiBmdW5jdGlvbiBlbmRzV2l0aChzZWFyY2hTdHJpbmcpIHsKICAgICAgICB2YXIgdGhhdCA9IFN0cmluZyhyZXF1aXJlT2JqZWN0Q29lcmNpYmxlKHRoaXMpKTsKICAgICAgICBub3RBUmVnRXhwKHNlYXJjaFN0cmluZyk7CiAgICAgICAgdmFyIGVuZFBvc2l0aW9uID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQ7CiAgICAgICAgdmFyIGxlbiA9IHRvTGVuZ3RoKHRoYXQubGVuZ3RoKTsKICAgICAgICB2YXIgZW5kID0gZW5kUG9zaXRpb24gPT09IHVuZGVmaW5lZCA/IGxlbiA6IG1pbih0b0xlbmd0aChlbmRQb3NpdGlvbiksIGxlbik7CiAgICAgICAgdmFyIHNlYXJjaCA9IFN0cmluZyhzZWFyY2hTdHJpbmcpOwogICAgICAgIHJldHVybiBuYXRpdmVFbmRzV2l0aCA/IG5hdGl2ZUVuZHNXaXRoLmNhbGwodGhhdCwgc2VhcmNoLCBlbmQpIDogdGhhdC5zbGljZShlbmQgLSBzZWFyY2gubGVuZ3RoLCBlbmQpID09PSBzZWFyY2g7CiAgICAgIH0KICAgIH0pOwoKICAgIC8qKiovfSksICgKICAvKiA2MiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIF9fd19wZGZqc19yZXF1aXJlX18oNjMpOwogICAgdmFyIGVudHJ5VW5iaW5kID0gX193X3BkZmpzX3JlcXVpcmVfXyg1Nyk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGVudHJ5VW5iaW5kKCdTdHJpbmcnLCAnaW5jbHVkZXMnKTsKCiAgICAvKioqL30pLCAoCiAgLyogNjMgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyICQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUpOwogICAgdmFyIG5vdEFSZWdFeHAgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUxKTsKICAgIHZhciByZXF1aXJlT2JqZWN0Q29lcmNpYmxlID0gX193X3BkZmpzX3JlcXVpcmVfXygxNSk7CiAgICB2YXIgY29ycmVjdElzUmVnRXhwTG9naWMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDU2KTsKICAgICQoewogICAgICB0YXJnZXQ6ICdTdHJpbmcnLAogICAgICBwcm90bzogdHJ1ZSwKICAgICAgZm9yY2VkOiAhY29ycmVjdElzUmVnRXhwTG9naWMoJ2luY2x1ZGVzJykKICAgIH0sIHsKICAgICAgaW5jbHVkZXM6IGZ1bmN0aW9uIGluY2x1ZGVzKHNlYXJjaFN0cmluZykgewogICAgICAgIHJldHVybiAhIX5TdHJpbmcocmVxdWlyZU9iamVjdENvZXJjaWJsZSh0aGlzKSkuaW5kZXhPZihub3RBUmVnRXhwKHNlYXJjaFN0cmluZyksIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkKTsKICAgICAgfQogICAgfSk7CgogICAgLyoqKi99KSwgKAogIC8qIDY0ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgX193X3BkZmpzX3JlcXVpcmVfXyg2NSk7CiAgICB2YXIgZW50cnlVbmJpbmQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDU3KTsKICAgIG1vZHVsZS5leHBvcnRzID0gZW50cnlVbmJpbmQoJ0FycmF5JywgJ2luY2x1ZGVzJyk7CgogICAgLyoqKi99KSwgKAogIC8qIDY1ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciAkID0gX193X3BkZmpzX3JlcXVpcmVfXyg1KTsKICAgIHZhciAkaW5jbHVkZXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDQxKS5pbmNsdWRlczsKICAgIHZhciBhZGRUb1Vuc2NvcGFibGVzID0gX193X3BkZmpzX3JlcXVpcmVfXyg2Nik7CiAgICB2YXIgYXJyYXlNZXRob2RVc2VzVG9MZW5ndGggPSBfX3dfcGRmanNfcmVxdWlyZV9fKDcxKTsKICAgIHZhciBVU0VTX1RPX0xFTkdUSCA9IGFycmF5TWV0aG9kVXNlc1RvTGVuZ3RoKCdpbmRleE9mJywgewogICAgICBBQ0NFU1NPUlM6IHRydWUsCiAgICAgIDE6IDAKICAgIH0pOwogICAgJCh7CiAgICAgIHRhcmdldDogJ0FycmF5JywKICAgICAgcHJvdG86IHRydWUsCiAgICAgIGZvcmNlZDogIVVTRVNfVE9fTEVOR1RICiAgICB9LCB7CiAgICAgIGluY2x1ZGVzOiBmdW5jdGlvbiBpbmNsdWRlcyhlbCkgewogICAgICAgIHJldHVybiAkaW5jbHVkZXModGhpcywgZWwsIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkKTsKICAgICAgfQogICAgfSk7CiAgICBhZGRUb1Vuc2NvcGFibGVzKCdpbmNsdWRlcycpOwoKICAgIC8qKiovfSksICgKICAvKiA2NiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciB3ZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUzKTsKICAgIHZhciBjcmVhdGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDY3KTsKICAgIHZhciBkZWZpbmVQcm9wZXJ0eU1vZHVsZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjIpOwogICAgdmFyIFVOU0NPUEFCTEVTID0gd2VsbEtub3duU3ltYm9sKCd1bnNjb3BhYmxlcycpOwogICAgdmFyIEFycmF5UHJvdG90eXBlID0gQXJyYXkucHJvdG90eXBlOwogICAgaWYgKEFycmF5UHJvdG90eXBlW1VOU0NPUEFCTEVTXSA9PSB1bmRlZmluZWQpIHsKICAgICAgZGVmaW5lUHJvcGVydHlNb2R1bGUuZihBcnJheVByb3RvdHlwZSwgVU5TQ09QQUJMRVMsIHsKICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgdmFsdWU6IGNyZWF0ZShudWxsKQogICAgICB9KTsKICAgIH0KICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGtleSkgewogICAgICBBcnJheVByb3RvdHlwZVtVTlNDT1BBQkxFU11ba2V5XSA9IHRydWU7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiA2NyAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBhbk9iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oMjMpOwogICAgdmFyIGRlZmluZVByb3BlcnRpZXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDY4KTsKICAgIHZhciBlbnVtQnVnS2V5cyA9IF9fd19wZGZqc19yZXF1aXJlX18oNDUpOwogICAgdmFyIGhpZGRlbktleXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDM0KTsKICAgIHZhciBodG1sID0gX193X3BkZmpzX3JlcXVpcmVfXyg3MCk7CiAgICB2YXIgZG9jdW1lbnRDcmVhdGVFbGVtZW50ID0gX193X3BkZmpzX3JlcXVpcmVfXygyMCk7CiAgICB2YXIgc2hhcmVkS2V5ID0gX193X3BkZmpzX3JlcXVpcmVfXygzMCk7CiAgICB2YXIgR1QgPSAnPic7CiAgICB2YXIgTFQgPSAnPCc7CiAgICB2YXIgUFJPVE9UWVBFID0gJ3Byb3RvdHlwZSc7CiAgICB2YXIgU0NSSVBUID0gJ3NjcmlwdCc7CiAgICB2YXIgSUVfUFJPVE8gPSBzaGFyZWRLZXkoJ0lFX1BST1RPJyk7CiAgICB2YXIgRW1wdHlDb25zdHJ1Y3RvciA9IGZ1bmN0aW9uIEVtcHR5Q29uc3RydWN0b3IoKSB7CiAgICB9OwogICAgdmFyIHNjcmlwdFRhZyA9IGZ1bmN0aW9uIHNjcmlwdFRhZyhjb250ZW50KSB7CiAgICAgIHJldHVybiBMVCArIFNDUklQVCArIEdUICsgY29udGVudCArIExUICsgJy8nICsgU0NSSVBUICsgR1Q7CiAgICB9OwogICAgdmFyIE51bGxQcm90b09iamVjdFZpYUFjdGl2ZVggPSBmdW5jdGlvbiBOdWxsUHJvdG9PYmplY3RWaWFBY3RpdmVYKGFjdGl2ZVhEb2N1bWVudCkgewogICAgICBhY3RpdmVYRG9jdW1lbnQud3JpdGUoc2NyaXB0VGFnKCcnKSk7CiAgICAgIGFjdGl2ZVhEb2N1bWVudC5jbG9zZSgpOwogICAgICB2YXIgdGVtcCA9IGFjdGl2ZVhEb2N1bWVudC5wYXJlbnRXaW5kb3cuT2JqZWN0OwogICAgICBhY3RpdmVYRG9jdW1lbnQgPSBudWxsOwogICAgICByZXR1cm4gdGVtcDsKICAgIH07CiAgICB2YXIgTnVsbFByb3RvT2JqZWN0VmlhSUZyYW1lID0gZnVuY3Rpb24gTnVsbFByb3RvT2JqZWN0VmlhSUZyYW1lKCkgewogICAgICB2YXIgaWZyYW1lID0gZG9jdW1lbnRDcmVhdGVFbGVtZW50KCdpZnJhbWUnKTsKICAgICAgdmFyIEpTID0gJ2phdmEnICsgU0NSSVBUICsgJzonOwogICAgICB2YXIgaWZyYW1lRG9jdW1lbnQ7CiAgICAgIGlmcmFtZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICBodG1sLmFwcGVuZENoaWxkKGlmcmFtZSk7CiAgICAgIGlmcmFtZS5zcmMgPSBTdHJpbmcoSlMpOwogICAgICBpZnJhbWVEb2N1bWVudCA9IGlmcmFtZS5jb250ZW50V2luZG93LmRvY3VtZW50OwogICAgICBpZnJhbWVEb2N1bWVudC5vcGVuKCk7CiAgICAgIGlmcmFtZURvY3VtZW50LndyaXRlKHNjcmlwdFRhZygnZG9jdW1lbnQuRj1PYmplY3QnKSk7CiAgICAgIGlmcmFtZURvY3VtZW50LmNsb3NlKCk7CiAgICAgIHJldHVybiBpZnJhbWVEb2N1bWVudC5GOwogICAgfTsKICAgIHZhciBhY3RpdmVYRG9jdW1lbnQ7CiAgICB2YXIgX051bGxQcm90b09iamVjdCA9IGZ1bmN0aW9uIE51bGxQcm90b09iamVjdCgpIHsKICAgICAgdHJ5IHsKICAgICAgICBhY3RpdmVYRG9jdW1lbnQgPSBkb2N1bWVudC5kb21haW4gJiYgbmV3IEFjdGl2ZVhPYmplY3QoJ2h0bWxmaWxlJyk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIH0KICAgICAgX051bGxQcm90b09iamVjdCA9IGFjdGl2ZVhEb2N1bWVudCA/IE51bGxQcm90b09iamVjdFZpYUFjdGl2ZVgoYWN0aXZlWERvY3VtZW50KSA6IE51bGxQcm90b09iamVjdFZpYUlGcmFtZSgpOwogICAgICB2YXIgbGVuZ3RoID0gZW51bUJ1Z0tleXMubGVuZ3RoOwogICAgICB3aGlsZSAobGVuZ3RoLS0pCiAgICAgIGRlbGV0ZSBfTnVsbFByb3RvT2JqZWN0W1BST1RPVFlQRV1bZW51bUJ1Z0tleXNbbGVuZ3RoXV07CiAgICAgIHJldHVybiBfTnVsbFByb3RvT2JqZWN0KCk7CiAgICB9OwogICAgaGlkZGVuS2V5c1tJRV9QUk9UT10gPSB0cnVlOwogICAgbW9kdWxlLmV4cG9ydHMgPSBPYmplY3QuY3JlYXRlIHx8IGZ1bmN0aW9uIGNyZWF0ZShPLCBQcm9wZXJ0aWVzKSB7CiAgICAgIHZhciByZXN1bHQ7CiAgICAgIGlmIChPICE9PSBudWxsKSB7CiAgICAgICAgRW1wdHlDb25zdHJ1Y3RvcltQUk9UT1RZUEVdID0gYW5PYmplY3QoTyk7CiAgICAgICAgcmVzdWx0ID0gbmV3IEVtcHR5Q29uc3RydWN0b3IoKTsKICAgICAgICBFbXB0eUNvbnN0cnVjdG9yW1BST1RPVFlQRV0gPSBudWxsOwogICAgICAgIHJlc3VsdFtJRV9QUk9UT10gPSBPOwogICAgICB9IGVsc2UKICAgICAgcmVzdWx0ID0gX051bGxQcm90b09iamVjdCgpOwogICAgICByZXR1cm4gUHJvcGVydGllcyA9PT0gdW5kZWZpbmVkID8gcmVzdWx0IDogZGVmaW5lUHJvcGVydGllcyhyZXN1bHQsIFByb3BlcnRpZXMpOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogNjggKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgREVTQ1JJUFRPUlMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDgpOwogICAgdmFyIGRlZmluZVByb3BlcnR5TW9kdWxlID0gX193X3BkZmpzX3JlcXVpcmVfXygyMik7CiAgICB2YXIgYW5PYmplY3QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIzKTsKICAgIHZhciBvYmplY3RLZXlzID0gX193X3BkZmpzX3JlcXVpcmVfXyg2OSk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IERFU0NSSVBUT1JTID8gT2JqZWN0LmRlZmluZVByb3BlcnRpZXMgOiBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKE8sIFByb3BlcnRpZXMpIHsKICAgICAgYW5PYmplY3QoTyk7CiAgICAgIHZhciBrZXlzID0gb2JqZWN0S2V5cyhQcm9wZXJ0aWVzKTsKICAgICAgdmFyIGxlbmd0aCA9IGtleXMubGVuZ3RoOwogICAgICB2YXIgaW5kZXggPSAwOwogICAgICB2YXIga2V5OwogICAgICB3aGlsZSAobGVuZ3RoID4gaW5kZXgpCiAgICAgIGRlZmluZVByb3BlcnR5TW9kdWxlLmYoTywga2V5ID0ga2V5c1tpbmRleCsrXSwgUHJvcGVydGllc1trZXldKTsKICAgICAgcmV0dXJuIE87CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiA2OSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBpbnRlcm5hbE9iamVjdEtleXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDQwKTsKICAgIHZhciBlbnVtQnVnS2V5cyA9IF9fd19wZGZqc19yZXF1aXJlX18oNDUpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBPYmplY3Qua2V5cyB8fCBmdW5jdGlvbiBrZXlzKE8pIHsKICAgICAgcmV0dXJuIGludGVybmFsT2JqZWN0S2V5cyhPLCBlbnVtQnVnS2V5cyk7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiA3MCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBnZXRCdWlsdEluID0gX193X3BkZmpzX3JlcXVpcmVfXygzNyk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGdldEJ1aWx0SW4oJ2RvY3VtZW50JywgJ2RvY3VtZW50RWxlbWVudCcpOwoKICAgIC8qKiovfSksICgKICAvKiA3MSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBERVNDUklQVE9SUyA9IF9fd19wZGZqc19yZXF1aXJlX18oOCk7CiAgICB2YXIgZmFpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDkpOwogICAgdmFyIGhhcyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTgpOwogICAgdmFyIGRlZmluZVByb3BlcnR5ID0gT2JqZWN0LmRlZmluZVByb3BlcnR5OwogICAgdmFyIGNhY2hlID0ge307CiAgICB2YXIgdGhyb3dlciA9IGZ1bmN0aW9uIHRocm93ZXIoaXQpIHsKICAgICAgdGhyb3cgaXQ7CiAgICB9OwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoTUVUSE9EX05BTUUsIG9wdGlvbnMpIHsKICAgICAgaWYgKGhhcyhjYWNoZSwgTUVUSE9EX05BTUUpKQogICAgICByZXR1cm4gY2FjaGVbTUVUSE9EX05BTUVdOwogICAgICBpZiAoIW9wdGlvbnMpCiAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgdmFyIG1ldGhvZCA9IFtdW01FVEhPRF9OQU1FXTsKICAgICAgdmFyIEFDQ0VTU09SUyA9IGhhcyhvcHRpb25zLCAnQUNDRVNTT1JTJykgPyBvcHRpb25zLkFDQ0VTU09SUyA6IGZhbHNlOwogICAgICB2YXIgYXJndW1lbnQwID0gaGFzKG9wdGlvbnMsIDApID8gb3B0aW9uc1swXSA6IHRocm93ZXI7CiAgICAgIHZhciBhcmd1bWVudDEgPSBoYXMob3B0aW9ucywgMSkgPyBvcHRpb25zWzFdIDogdW5kZWZpbmVkOwogICAgICByZXR1cm4gY2FjaGVbTUVUSE9EX05BTUVdID0gISFtZXRob2QgJiYgIWZhaWxzKGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoQUNDRVNTT1JTICYmICFERVNDUklQVE9SUykKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB2YXIgTyA9IHsgbGVuZ3RoOiAtMSB9OwogICAgICAgIGlmIChBQ0NFU1NPUlMpCiAgICAgICAgZGVmaW5lUHJvcGVydHkoTywgMSwgewogICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgIGdldDogdGhyb3dlcgogICAgICAgIH0pO2Vsc2UKCiAgICAgICAgT1sxXSA9IDE7CiAgICAgICAgbWV0aG9kLmNhbGwoTywgYXJndW1lbnQwLCBhcmd1bWVudDEpOwogICAgICB9KTsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDcyICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgX193X3BkZmpzX3JlcXVpcmVfXyg3Myk7CiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDg1KTsKICAgIHZhciBwYXRoID0gX193X3BkZmpzX3JlcXVpcmVfXygzOCk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IHBhdGguQXJyYXkuZnJvbTsKCiAgICAvKioqL30pLCAoCiAgLyogNzMgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGNoYXJBdCA9IF9fd19wZGZqc19yZXF1aXJlX18oNzQpLmNoYXJBdDsKICAgIHZhciBJbnRlcm5hbFN0YXRlTW9kdWxlID0gX193X3BkZmpzX3JlcXVpcmVfXygyOCk7CiAgICB2YXIgZGVmaW5lSXRlcmF0b3IgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDc1KTsKICAgIHZhciBTVFJJTkdfSVRFUkFUT1IgPSAnU3RyaW5nIEl0ZXJhdG9yJzsKICAgIHZhciBzZXRJbnRlcm5hbFN0YXRlID0gSW50ZXJuYWxTdGF0ZU1vZHVsZS5zZXQ7CiAgICB2YXIgZ2V0SW50ZXJuYWxTdGF0ZSA9IEludGVybmFsU3RhdGVNb2R1bGUuZ2V0dGVyRm9yKFNUUklOR19JVEVSQVRPUik7CiAgICBkZWZpbmVJdGVyYXRvcihTdHJpbmcsICdTdHJpbmcnLCBmdW5jdGlvbiAoaXRlcmF0ZWQpIHsKICAgICAgc2V0SW50ZXJuYWxTdGF0ZSh0aGlzLCB7CiAgICAgICAgdHlwZTogU1RSSU5HX0lURVJBVE9SLAogICAgICAgIHN0cmluZzogU3RyaW5nKGl0ZXJhdGVkKSwKICAgICAgICBpbmRleDogMAogICAgICB9KTsKICAgIH0sIGZ1bmN0aW9uIG5leHQoKSB7CiAgICAgIHZhciBzdGF0ZSA9IGdldEludGVybmFsU3RhdGUodGhpcyk7CiAgICAgIHZhciBzdHJpbmcgPSBzdGF0ZS5zdHJpbmc7CiAgICAgIHZhciBpbmRleCA9IHN0YXRlLmluZGV4OwogICAgICB2YXIgcG9pbnQ7CiAgICAgIGlmIChpbmRleCA+PSBzdHJpbmcubGVuZ3RoKQogICAgICByZXR1cm4gewogICAgICAgIHZhbHVlOiB1bmRlZmluZWQsCiAgICAgICAgZG9uZTogdHJ1ZQogICAgICB9OwogICAgICBwb2ludCA9IGNoYXJBdChzdHJpbmcsIGluZGV4KTsKICAgICAgc3RhdGUuaW5kZXggKz0gcG9pbnQubGVuZ3RoOwogICAgICByZXR1cm4gewogICAgICAgIHZhbHVlOiBwb2ludCwKICAgICAgICBkb25lOiBmYWxzZQogICAgICB9OwogICAgfSk7CgogICAgLyoqKi99KSwgKAogIC8qIDc0ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIHRvSW50ZWdlciA9IF9fd19wZGZqc19yZXF1aXJlX18oNDMpOwogICAgdmFyIHJlcXVpcmVPYmplY3RDb2VyY2libGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE1KTsKICAgIHZhciBjcmVhdGVNZXRob2QgPSBmdW5jdGlvbiBjcmVhdGVNZXRob2QoQ09OVkVSVF9UT19TVFJJTkcpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uICgkdGhpcywgcG9zKSB7CiAgICAgICAgdmFyIFMgPSBTdHJpbmcocmVxdWlyZU9iamVjdENvZXJjaWJsZSgkdGhpcykpOwogICAgICAgIHZhciBwb3NpdGlvbiA9IHRvSW50ZWdlcihwb3MpOwogICAgICAgIHZhciBzaXplID0gUy5sZW5ndGg7CiAgICAgICAgdmFyIGZpcnN0LCBzZWNvbmQ7CiAgICAgICAgaWYgKHBvc2l0aW9uIDwgMCB8fCBwb3NpdGlvbiA+PSBzaXplKQogICAgICAgIHJldHVybiBDT05WRVJUX1RPX1NUUklORyA/ICcnIDogdW5kZWZpbmVkOwogICAgICAgIGZpcnN0ID0gUy5jaGFyQ29kZUF0KHBvc2l0aW9uKTsKICAgICAgICByZXR1cm4gZmlyc3QgPCAweEQ4MDAgfHwgZmlyc3QgPiAweERCRkYgfHwgcG9zaXRpb24gKyAxID09PSBzaXplIHx8IChzZWNvbmQgPSBTLmNoYXJDb2RlQXQocG9zaXRpb24gKyAxKSkgPCAweERDMDAgfHwgc2Vjb25kID4gMHhERkZGID8gQ09OVkVSVF9UT19TVFJJTkcgPyBTLmNoYXJBdChwb3NpdGlvbikgOiBmaXJzdCA6IENPTlZFUlRfVE9fU1RSSU5HID8gUy5zbGljZShwb3NpdGlvbiwgcG9zaXRpb24gKyAyKSA6IChmaXJzdCAtIDB4RDgwMCA8PCAxMCkgKyAoc2Vjb25kIC0gMHhEQzAwKSArIDB4MTAwMDA7CiAgICAgIH07CiAgICB9OwogICAgbW9kdWxlLmV4cG9ydHMgPSB7CiAgICAgIGNvZGVBdDogY3JlYXRlTWV0aG9kKGZhbHNlKSwKICAgICAgY2hhckF0OiBjcmVhdGVNZXRob2QodHJ1ZSkKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDc1ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciAkID0gX193X3BkZmpzX3JlcXVpcmVfXyg1KTsKICAgIHZhciBjcmVhdGVJdGVyYXRvckNvbnN0cnVjdG9yID0gX193X3BkZmpzX3JlcXVpcmVfXyg3Nik7CiAgICB2YXIgZ2V0UHJvdG90eXBlT2YgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDc4KTsKICAgIHZhciBzZXRQcm90b3R5cGVPZiA9IF9fd19wZGZqc19yZXF1aXJlX18oODMpOwogICAgdmFyIHNldFRvU3RyaW5nVGFnID0gX193X3BkZmpzX3JlcXVpcmVfXyg4MSk7CiAgICB2YXIgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5ID0gX193X3BkZmpzX3JlcXVpcmVfXygyMSk7CiAgICB2YXIgcmVkZWZpbmUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDI0KTsKICAgIHZhciB3ZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUzKTsKICAgIHZhciBJU19QVVJFID0gX193X3BkZmpzX3JlcXVpcmVfXygzMik7CiAgICB2YXIgSXRlcmF0b3JzID0gX193X3BkZmpzX3JlcXVpcmVfXyg4Mik7CiAgICB2YXIgSXRlcmF0b3JzQ29yZSA9IF9fd19wZGZqc19yZXF1aXJlX18oNzcpOwogICAgdmFyIEl0ZXJhdG9yUHJvdG90eXBlID0gSXRlcmF0b3JzQ29yZS5JdGVyYXRvclByb3RvdHlwZTsKICAgIHZhciBCVUdHWV9TQUZBUklfSVRFUkFUT1JTID0gSXRlcmF0b3JzQ29yZS5CVUdHWV9TQUZBUklfSVRFUkFUT1JTOwogICAgdmFyIElURVJBVE9SID0gd2VsbEtub3duU3ltYm9sKCdpdGVyYXRvcicpOwogICAgdmFyIEtFWVMgPSAna2V5cyc7CiAgICB2YXIgVkFMVUVTID0gJ3ZhbHVlcyc7CiAgICB2YXIgRU5UUklFUyA9ICdlbnRyaWVzJzsKICAgIHZhciByZXR1cm5UaGlzID0gZnVuY3Rpb24gcmV0dXJuVGhpcygpIHsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoSXRlcmFibGUsIE5BTUUsIEl0ZXJhdG9yQ29uc3RydWN0b3IsIG5leHQsIERFRkFVTFQsIElTX1NFVCwgRk9SQ0VEKSB7CiAgICAgIGNyZWF0ZUl0ZXJhdG9yQ29uc3RydWN0b3IoSXRlcmF0b3JDb25zdHJ1Y3RvciwgTkFNRSwgbmV4dCk7CiAgICAgIHZhciBnZXRJdGVyYXRpb25NZXRob2QgPSBmdW5jdGlvbiBnZXRJdGVyYXRpb25NZXRob2QoS0lORCkgewogICAgICAgIGlmIChLSU5EID09PSBERUZBVUxUICYmIGRlZmF1bHRJdGVyYXRvcikKICAgICAgICByZXR1cm4gZGVmYXVsdEl0ZXJhdG9yOwogICAgICAgIGlmICghQlVHR1lfU0FGQVJJX0lURVJBVE9SUyAmJiBLSU5EIGluIEl0ZXJhYmxlUHJvdG90eXBlKQogICAgICAgIHJldHVybiBJdGVyYWJsZVByb3RvdHlwZVtLSU5EXTsKICAgICAgICBzd2l0Y2ggKEtJTkQpIHsKICAgICAgICAgIGNhc2UgS0VZUzoKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGtleXMoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBJdGVyYXRvckNvbnN0cnVjdG9yKHRoaXMsIEtJTkQpOwogICAgICAgICAgICB9OwogICAgICAgICAgY2FzZSBWQUxVRVM6CiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiB2YWx1ZXMoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBJdGVyYXRvckNvbnN0cnVjdG9yKHRoaXMsIEtJTkQpOwogICAgICAgICAgICB9OwogICAgICAgICAgY2FzZSBFTlRSSUVTOgogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gZW50cmllcygpIHsKICAgICAgICAgICAgICByZXR1cm4gbmV3IEl0ZXJhdG9yQ29uc3RydWN0b3IodGhpcywgS0lORCk7CiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gbmV3IEl0ZXJhdG9yQ29uc3RydWN0b3IodGhpcyk7CiAgICAgICAgfTsKICAgICAgfTsKICAgICAgdmFyIFRPX1NUUklOR19UQUcgPSBOQU1FICsgJyBJdGVyYXRvcic7CiAgICAgIHZhciBJTkNPUlJFQ1RfVkFMVUVTX05BTUUgPSBmYWxzZTsKICAgICAgdmFyIEl0ZXJhYmxlUHJvdG90eXBlID0gSXRlcmFibGUucHJvdG90eXBlOwogICAgICB2YXIgbmF0aXZlSXRlcmF0b3IgPSBJdGVyYWJsZVByb3RvdHlwZVtJVEVSQVRPUl0gfHwgSXRlcmFibGVQcm90b3R5cGVbJ0BAaXRlcmF0b3InXSB8fCBERUZBVUxUICYmIEl0ZXJhYmxlUHJvdG90eXBlW0RFRkFVTFRdOwogICAgICB2YXIgZGVmYXVsdEl0ZXJhdG9yID0gIUJVR0dZX1NBRkFSSV9JVEVSQVRPUlMgJiYgbmF0aXZlSXRlcmF0b3IgfHwgZ2V0SXRlcmF0aW9uTWV0aG9kKERFRkFVTFQpOwogICAgICB2YXIgYW55TmF0aXZlSXRlcmF0b3IgPSBOQU1FID09ICdBcnJheScgPyBJdGVyYWJsZVByb3RvdHlwZS5lbnRyaWVzIHx8IG5hdGl2ZUl0ZXJhdG9yIDogbmF0aXZlSXRlcmF0b3I7CiAgICAgIHZhciBDdXJyZW50SXRlcmF0b3JQcm90b3R5cGUsIG1ldGhvZHMsIEtFWTsKICAgICAgaWYgKGFueU5hdGl2ZUl0ZXJhdG9yKSB7CiAgICAgICAgQ3VycmVudEl0ZXJhdG9yUHJvdG90eXBlID0gZ2V0UHJvdG90eXBlT2YoYW55TmF0aXZlSXRlcmF0b3IuY2FsbChuZXcgSXRlcmFibGUoKSkpOwogICAgICAgIGlmIChJdGVyYXRvclByb3RvdHlwZSAhPT0gT2JqZWN0LnByb3RvdHlwZSAmJiBDdXJyZW50SXRlcmF0b3JQcm90b3R5cGUubmV4dCkgewogICAgICAgICAgaWYgKCFJU19QVVJFICYmIGdldFByb3RvdHlwZU9mKEN1cnJlbnRJdGVyYXRvclByb3RvdHlwZSkgIT09IEl0ZXJhdG9yUHJvdG90eXBlKSB7CiAgICAgICAgICAgIGlmIChzZXRQcm90b3R5cGVPZikgewogICAgICAgICAgICAgIHNldFByb3RvdHlwZU9mKEN1cnJlbnRJdGVyYXRvclByb3RvdHlwZSwgSXRlcmF0b3JQcm90b3R5cGUpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBDdXJyZW50SXRlcmF0b3JQcm90b3R5cGVbSVRFUkFUT1JdICE9ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkoQ3VycmVudEl0ZXJhdG9yUHJvdG90eXBlLCBJVEVSQVRPUiwgcmV0dXJuVGhpcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHNldFRvU3RyaW5nVGFnKEN1cnJlbnRJdGVyYXRvclByb3RvdHlwZSwgVE9fU1RSSU5HX1RBRywgdHJ1ZSwgdHJ1ZSk7CiAgICAgICAgICBpZiAoSVNfUFVSRSkKICAgICAgICAgIEl0ZXJhdG9yc1tUT19TVFJJTkdfVEFHXSA9IHJldHVyblRoaXM7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChERUZBVUxUID09IFZBTFVFUyAmJiBuYXRpdmVJdGVyYXRvciAmJiBuYXRpdmVJdGVyYXRvci5uYW1lICE9PSBWQUxVRVMpIHsKICAgICAgICBJTkNPUlJFQ1RfVkFMVUVTX05BTUUgPSB0cnVlOwogICAgICAgIGRlZmF1bHRJdGVyYXRvciA9IGZ1bmN0aW9uIHZhbHVlcygpIHsKICAgICAgICAgIHJldHVybiBuYXRpdmVJdGVyYXRvci5jYWxsKHRoaXMpOwogICAgICAgIH07CiAgICAgIH0KICAgICAgaWYgKCghSVNfUFVSRSB8fCBGT1JDRUQpICYmIEl0ZXJhYmxlUHJvdG90eXBlW0lURVJBVE9SXSAhPT0gZGVmYXVsdEl0ZXJhdG9yKSB7CiAgICAgICAgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5KEl0ZXJhYmxlUHJvdG90eXBlLCBJVEVSQVRPUiwgZGVmYXVsdEl0ZXJhdG9yKTsKICAgICAgfQogICAgICBJdGVyYXRvcnNbTkFNRV0gPSBkZWZhdWx0SXRlcmF0b3I7CiAgICAgIGlmIChERUZBVUxUKSB7CiAgICAgICAgbWV0aG9kcyA9IHsKICAgICAgICAgIHZhbHVlczogZ2V0SXRlcmF0aW9uTWV0aG9kKFZBTFVFUyksCiAgICAgICAgICBrZXlzOiBJU19TRVQgPyBkZWZhdWx0SXRlcmF0b3IgOiBnZXRJdGVyYXRpb25NZXRob2QoS0VZUyksCiAgICAgICAgICBlbnRyaWVzOiBnZXRJdGVyYXRpb25NZXRob2QoRU5UUklFUykKICAgICAgICB9OwogICAgICAgIGlmIChGT1JDRUQpCiAgICAgICAgZm9yIChLRVkgaW4gbWV0aG9kcykgewogICAgICAgICAgaWYgKEJVR0dZX1NBRkFSSV9JVEVSQVRPUlMgfHwgSU5DT1JSRUNUX1ZBTFVFU19OQU1FIHx8ICEoS0VZIGluIEl0ZXJhYmxlUHJvdG90eXBlKSkgewogICAgICAgICAgICByZWRlZmluZShJdGVyYWJsZVByb3RvdHlwZSwgS0VZLCBtZXRob2RzW0tFWV0pOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZQoKICAgICAgICAkKHsKICAgICAgICAgIHRhcmdldDogTkFNRSwKICAgICAgICAgIHByb3RvOiB0cnVlLAogICAgICAgICAgZm9yY2VkOiBCVUdHWV9TQUZBUklfSVRFUkFUT1JTIHx8IElOQ09SUkVDVF9WQUxVRVNfTkFNRQogICAgICAgIH0sIG1ldGhvZHMpOwogICAgICB9CiAgICAgIHJldHVybiBtZXRob2RzOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogNzYgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIEl0ZXJhdG9yUHJvdG90eXBlID0gX193X3BkZmpzX3JlcXVpcmVfXyg3NykuSXRlcmF0b3JQcm90b3R5cGU7CiAgICB2YXIgY3JlYXRlID0gX193X3BkZmpzX3JlcXVpcmVfXyg2Nyk7CiAgICB2YXIgY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yID0gX193X3BkZmpzX3JlcXVpcmVfXygxMSk7CiAgICB2YXIgc2V0VG9TdHJpbmdUYWcgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDgxKTsKICAgIHZhciBJdGVyYXRvcnMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDgyKTsKICAgIHZhciByZXR1cm5UaGlzID0gZnVuY3Rpb24gcmV0dXJuVGhpcygpIHsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoSXRlcmF0b3JDb25zdHJ1Y3RvciwgTkFNRSwgbmV4dCkgewogICAgICB2YXIgVE9fU1RSSU5HX1RBRyA9IE5BTUUgKyAnIEl0ZXJhdG9yJzsKICAgICAgSXRlcmF0b3JDb25zdHJ1Y3Rvci5wcm90b3R5cGUgPSBjcmVhdGUoSXRlcmF0b3JQcm90b3R5cGUsIHsgbmV4dDogY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yKDEsIG5leHQpIH0pOwogICAgICBzZXRUb1N0cmluZ1RhZyhJdGVyYXRvckNvbnN0cnVjdG9yLCBUT19TVFJJTkdfVEFHLCBmYWxzZSwgdHJ1ZSk7CiAgICAgIEl0ZXJhdG9yc1tUT19TVFJJTkdfVEFHXSA9IHJldHVyblRoaXM7CiAgICAgIHJldHVybiBJdGVyYXRvckNvbnN0cnVjdG9yOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogNzcgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGdldFByb3RvdHlwZU9mID0gX193X3BkZmpzX3JlcXVpcmVfXyg3OCk7CiAgICB2YXIgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5ID0gX193X3BkZmpzX3JlcXVpcmVfXygyMSk7CiAgICB2YXIgaGFzID0gX193X3BkZmpzX3JlcXVpcmVfXygxOCk7CiAgICB2YXIgd2VsbEtub3duU3ltYm9sID0gX193X3BkZmpzX3JlcXVpcmVfXyg1Myk7CiAgICB2YXIgSVNfUFVSRSA9IF9fd19wZGZqc19yZXF1aXJlX18oMzIpOwogICAgdmFyIElURVJBVE9SID0gd2VsbEtub3duU3ltYm9sKCdpdGVyYXRvcicpOwogICAgdmFyIEJVR0dZX1NBRkFSSV9JVEVSQVRPUlMgPSBmYWxzZTsKICAgIHZhciByZXR1cm5UaGlzID0gZnVuY3Rpb24gcmV0dXJuVGhpcygpIHsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwogICAgdmFyIEl0ZXJhdG9yUHJvdG90eXBlLCBQcm90b3R5cGVPZkFycmF5SXRlcmF0b3JQcm90b3R5cGUsIGFycmF5SXRlcmF0b3I7CiAgICBpZiAoW10ua2V5cykgewogICAgICBhcnJheUl0ZXJhdG9yID0gW10ua2V5cygpOwogICAgICBpZiAoISgnbmV4dCcgaW4gYXJyYXlJdGVyYXRvcikpCiAgICAgIEJVR0dZX1NBRkFSSV9JVEVSQVRPUlMgPSB0cnVlO2Vsc2UKICAgICAgewogICAgICAgIFByb3RvdHlwZU9mQXJyYXlJdGVyYXRvclByb3RvdHlwZSA9IGdldFByb3RvdHlwZU9mKGdldFByb3RvdHlwZU9mKGFycmF5SXRlcmF0b3IpKTsKICAgICAgICBpZiAoUHJvdG90eXBlT2ZBcnJheUl0ZXJhdG9yUHJvdG90eXBlICE9PSBPYmplY3QucHJvdG90eXBlKQogICAgICAgIEl0ZXJhdG9yUHJvdG90eXBlID0gUHJvdG90eXBlT2ZBcnJheUl0ZXJhdG9yUHJvdG90eXBlOwogICAgICB9CiAgICB9CiAgICBpZiAoSXRlcmF0b3JQcm90b3R5cGUgPT0gdW5kZWZpbmVkKQogICAgSXRlcmF0b3JQcm90b3R5cGUgPSB7fTsKICAgIGlmICghSVNfUFVSRSAmJiAhaGFzKEl0ZXJhdG9yUHJvdG90eXBlLCBJVEVSQVRPUikpIHsKICAgICAgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5KEl0ZXJhdG9yUHJvdG90eXBlLCBJVEVSQVRPUiwgcmV0dXJuVGhpcyk7CiAgICB9CiAgICBtb2R1bGUuZXhwb3J0cyA9IHsKICAgICAgSXRlcmF0b3JQcm90b3R5cGU6IEl0ZXJhdG9yUHJvdG90eXBlLAogICAgICBCVUdHWV9TQUZBUklfSVRFUkFUT1JTOiBCVUdHWV9TQUZBUklfSVRFUkFUT1JTCiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiA3OCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBoYXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE4KTsKICAgIHZhciB0b09iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oNzkpOwogICAgdmFyIHNoYXJlZEtleSA9IF9fd19wZGZqc19yZXF1aXJlX18oMzApOwogICAgdmFyIENPUlJFQ1RfUFJPVE9UWVBFX0dFVFRFUiA9IF9fd19wZGZqc19yZXF1aXJlX18oODApOwogICAgdmFyIElFX1BST1RPID0gc2hhcmVkS2V5KCdJRV9QUk9UTycpOwogICAgdmFyIE9iamVjdFByb3RvdHlwZSA9IE9iamVjdC5wcm90b3R5cGU7CiAgICBtb2R1bGUuZXhwb3J0cyA9IENPUlJFQ1RfUFJPVE9UWVBFX0dFVFRFUiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZiA6IGZ1bmN0aW9uIChPKSB7CiAgICAgIE8gPSB0b09iamVjdChPKTsKICAgICAgaWYgKGhhcyhPLCBJRV9QUk9UTykpCiAgICAgIHJldHVybiBPW0lFX1BST1RPXTsKICAgICAgaWYgKHR5cGVvZiBPLmNvbnN0cnVjdG9yID09ICdmdW5jdGlvbicgJiYgTyBpbnN0YW5jZW9mIE8uY29uc3RydWN0b3IpIHsKICAgICAgICByZXR1cm4gTy5jb25zdHJ1Y3Rvci5wcm90b3R5cGU7CiAgICAgIH0KICAgICAgcmV0dXJuIE8gaW5zdGFuY2VvZiBPYmplY3QgPyBPYmplY3RQcm90b3R5cGUgOiBudWxsOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogNzkgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgcmVxdWlyZU9iamVjdENvZXJjaWJsZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTUpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoYXJndW1lbnQpIHsKICAgICAgcmV0dXJuIE9iamVjdChyZXF1aXJlT2JqZWN0Q29lcmNpYmxlKGFyZ3VtZW50KSk7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiA4MCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBmYWlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oOSk7CiAgICBtb2R1bGUuZXhwb3J0cyA9ICFmYWlscyhmdW5jdGlvbiAoKSB7CiAgICAgIGZ1bmN0aW9uIEYoKSB7CiAgICAgIH0KICAgICAgRi5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBudWxsOwogICAgICByZXR1cm4gT2JqZWN0LmdldFByb3RvdHlwZU9mKG5ldyBGKCkpICE9PSBGLnByb3RvdHlwZTsKICAgIH0pOwoKICAgIC8qKiovfSksICgKICAvKiA4MSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBkZWZpbmVQcm9wZXJ0eSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjIpLmY7CiAgICB2YXIgaGFzID0gX193X3BkZmpzX3JlcXVpcmVfXygxOCk7CiAgICB2YXIgd2VsbEtub3duU3ltYm9sID0gX193X3BkZmpzX3JlcXVpcmVfXyg1Myk7CiAgICB2YXIgVE9fU1RSSU5HX1RBRyA9IHdlbGxLbm93blN5bWJvbCgndG9TdHJpbmdUYWcnKTsKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0LCBUQUcsIFNUQVRJQykgewogICAgICBpZiAoaXQgJiYgIWhhcyhpdCA9IFNUQVRJQyA/IGl0IDogaXQucHJvdG90eXBlLCBUT19TVFJJTkdfVEFHKSkgewogICAgICAgIGRlZmluZVByb3BlcnR5KGl0LCBUT19TVFJJTkdfVEFHLCB7CiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgICB2YWx1ZTogVEFHCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDgyICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgogICAgbW9kdWxlLmV4cG9ydHMgPSB7fTsKCiAgICAvKioqL30pLCAoCiAgLyogODMgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgYW5PYmplY3QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIzKTsKICAgIHZhciBhUG9zc2libGVQcm90b3R5cGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDg0KTsKICAgIG1vZHVsZS5leHBvcnRzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8ICgnX19wcm90b19fJyBpbiB7fSA/IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIENPUlJFQ1RfU0VUVEVSID0gZmFsc2U7CiAgICAgIHZhciB0ZXN0ID0ge307CiAgICAgIHZhciBzZXR0ZXI7CiAgICAgIHRyeSB7CiAgICAgICAgc2V0dGVyID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihPYmplY3QucHJvdG90eXBlLCAnX19wcm90b19fJykuc2V0OwogICAgICAgIHNldHRlci5jYWxsKHRlc3QsIFtdKTsKICAgICAgICBDT1JSRUNUX1NFVFRFUiA9IHRlc3QgaW5zdGFuY2VvZiBBcnJheTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgfQogICAgICByZXR1cm4gZnVuY3Rpb24gc2V0UHJvdG90eXBlT2YoTywgcHJvdG8pIHsKICAgICAgICBhbk9iamVjdChPKTsKICAgICAgICBhUG9zc2libGVQcm90b3R5cGUocHJvdG8pOwogICAgICAgIGlmIChDT1JSRUNUX1NFVFRFUikKICAgICAgICBzZXR0ZXIuY2FsbChPLCBwcm90byk7ZWxzZQoKICAgICAgICBPLl9fcHJvdG9fXyA9IHByb3RvOwogICAgICAgIHJldHVybiBPOwogICAgICB9OwogICAgfSgpIDogdW5kZWZpbmVkKTsKCiAgICAvKioqL30pLCAoCiAgLyogODQgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgaXNPYmplY3QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE3KTsKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7CiAgICAgIGlmICghaXNPYmplY3QoaXQpICYmIGl0ICE9PSBudWxsKSB7CiAgICAgICAgdGhyb3cgVHlwZUVycm9yKCJDYW4ndCBzZXQgIiArIFN0cmluZyhpdCkgKyAnIGFzIGEgcHJvdG90eXBlJyk7CiAgICAgIH0KICAgICAgcmV0dXJuIGl0OwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogODUgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgJCA9IF9fd19wZGZqc19yZXF1aXJlX18oNSk7CiAgICB2YXIgZnJvbSA9IF9fd19wZGZqc19yZXF1aXJlX18oODYpOwogICAgdmFyIGNoZWNrQ29ycmVjdG5lc3NPZkl0ZXJhdGlvbiA9IF9fd19wZGZqc19yZXF1aXJlX18oOTMpOwogICAgdmFyIElOQ09SUkVDVF9JVEVSQVRJT04gPSAhY2hlY2tDb3JyZWN0bmVzc09mSXRlcmF0aW9uKGZ1bmN0aW9uIChpdGVyYWJsZSkgewogICAgICBBcnJheS5mcm9tKGl0ZXJhYmxlKTsKICAgIH0pOwogICAgJCh7CiAgICAgIHRhcmdldDogJ0FycmF5JywKICAgICAgc3RhdDogdHJ1ZSwKICAgICAgZm9yY2VkOiBJTkNPUlJFQ1RfSVRFUkFUSU9OCiAgICB9LCB7IGZyb206IGZyb20gfSk7CgogICAgLyoqKi99KSwgKAogIC8qIDg2ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBiaW5kID0gX193X3BkZmpzX3JlcXVpcmVfXyg1OCk7CiAgICB2YXIgdG9PYmplY3QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDc5KTsKICAgIHZhciBjYWxsV2l0aFNhZmVJdGVyYXRpb25DbG9zaW5nID0gX193X3BkZmpzX3JlcXVpcmVfXyg4Nyk7CiAgICB2YXIgaXNBcnJheUl0ZXJhdG9yTWV0aG9kID0gX193X3BkZmpzX3JlcXVpcmVfXyg4OCk7CiAgICB2YXIgdG9MZW5ndGggPSBfX3dfcGRmanNfcmVxdWlyZV9fKDQyKTsKICAgIHZhciBjcmVhdGVQcm9wZXJ0eSA9IF9fd19wZGZqc19yZXF1aXJlX18oODkpOwogICAgdmFyIGdldEl0ZXJhdG9yTWV0aG9kID0gX193X3BkZmpzX3JlcXVpcmVfXyg5MCk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGZyb20oYXJyYXlMaWtlKSB7CiAgICAgIHZhciBPID0gdG9PYmplY3QoYXJyYXlMaWtlKTsKICAgICAgdmFyIEMgPSB0eXBlb2YgdGhpcyA9PSAnZnVuY3Rpb24nID8gdGhpcyA6IEFycmF5OwogICAgICB2YXIgYXJndW1lbnRzTGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aDsKICAgICAgdmFyIG1hcGZuID0gYXJndW1lbnRzTGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZDsKICAgICAgdmFyIG1hcHBpbmcgPSBtYXBmbiAhPT0gdW5kZWZpbmVkOwogICAgICB2YXIgaXRlcmF0b3JNZXRob2QgPSBnZXRJdGVyYXRvck1ldGhvZChPKTsKICAgICAgdmFyIGluZGV4ID0gMDsKICAgICAgdmFyIGxlbmd0aCwgcmVzdWx0LCBzdGVwLCBpdGVyYXRvciwgbmV4dCwgdmFsdWU7CiAgICAgIGlmIChtYXBwaW5nKQogICAgICBtYXBmbiA9IGJpbmQobWFwZm4sIGFyZ3VtZW50c0xlbmd0aCA+IDIgPyBhcmd1bWVudHNbMl0gOiB1bmRlZmluZWQsIDIpOwogICAgICBpZiAoaXRlcmF0b3JNZXRob2QgIT0gdW5kZWZpbmVkICYmICEoQyA9PSBBcnJheSAmJiBpc0FycmF5SXRlcmF0b3JNZXRob2QoaXRlcmF0b3JNZXRob2QpKSkgewogICAgICAgIGl0ZXJhdG9yID0gaXRlcmF0b3JNZXRob2QuY2FsbChPKTsKICAgICAgICBuZXh0ID0gaXRlcmF0b3IubmV4dDsKICAgICAgICByZXN1bHQgPSBuZXcgQygpOwogICAgICAgIGZvciAoOyAhKHN0ZXAgPSBuZXh0LmNhbGwoaXRlcmF0b3IpKS5kb25lOyBpbmRleCsrKSB7CiAgICAgICAgICB2YWx1ZSA9IG1hcHBpbmcgPyBjYWxsV2l0aFNhZmVJdGVyYXRpb25DbG9zaW5nKGl0ZXJhdG9yLCBtYXBmbiwgWwogICAgICAgICAgc3RlcC52YWx1ZSwKICAgICAgICAgIGluZGV4XSwKICAgICAgICAgIHRydWUpIDogc3RlcC52YWx1ZTsKICAgICAgICAgIGNyZWF0ZVByb3BlcnR5KHJlc3VsdCwgaW5kZXgsIHZhbHVlKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbGVuZ3RoID0gdG9MZW5ndGgoTy5sZW5ndGgpOwogICAgICAgIHJlc3VsdCA9IG5ldyBDKGxlbmd0aCk7CiAgICAgICAgZm9yICg7IGxlbmd0aCA+IGluZGV4OyBpbmRleCsrKSB7CiAgICAgICAgICB2YWx1ZSA9IG1hcHBpbmcgPyBtYXBmbihPW2luZGV4XSwgaW5kZXgpIDogT1tpbmRleF07CiAgICAgICAgICBjcmVhdGVQcm9wZXJ0eShyZXN1bHQsIGluZGV4LCB2YWx1ZSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJlc3VsdC5sZW5ndGggPSBpbmRleDsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDg3ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGFuT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygyMyk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdGVyYXRvciwgZm4sIHZhbHVlLCBFTlRSSUVTKSB7CiAgICAgIHRyeSB7CiAgICAgICAgcmV0dXJuIEVOVFJJRVMgPyBmbihhbk9iamVjdCh2YWx1ZSlbMF0sIHZhbHVlWzFdKSA6IGZuKHZhbHVlKTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICB2YXIgcmV0dXJuTWV0aG9kID0gaXRlcmF0b3JbJ3JldHVybiddOwogICAgICAgIGlmIChyZXR1cm5NZXRob2QgIT09IHVuZGVmaW5lZCkKICAgICAgICBhbk9iamVjdChyZXR1cm5NZXRob2QuY2FsbChpdGVyYXRvcikpOwogICAgICAgIHRocm93IGVycm9yOwogICAgICB9CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiA4OCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciB3ZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUzKTsKICAgIHZhciBJdGVyYXRvcnMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDgyKTsKICAgIHZhciBJVEVSQVRPUiA9IHdlbGxLbm93blN5bWJvbCgnaXRlcmF0b3InKTsKICAgIHZhciBBcnJheVByb3RvdHlwZSA9IEFycmF5LnByb3RvdHlwZTsKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7CiAgICAgIHJldHVybiBpdCAhPT0gdW5kZWZpbmVkICYmIChJdGVyYXRvcnMuQXJyYXkgPT09IGl0IHx8IEFycmF5UHJvdG90eXBlW0lURVJBVE9SXSA9PT0gaXQpOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogODkgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIHRvUHJpbWl0aXZlID0gX193X3BkZmpzX3JlcXVpcmVfXygxNik7CiAgICB2YXIgZGVmaW5lUHJvcGVydHlNb2R1bGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIyKTsKICAgIHZhciBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDExKTsKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKG9iamVjdCwga2V5LCB2YWx1ZSkgewogICAgICB2YXIgcHJvcGVydHlLZXkgPSB0b1ByaW1pdGl2ZShrZXkpOwogICAgICBpZiAocHJvcGVydHlLZXkgaW4gb2JqZWN0KQogICAgICBkZWZpbmVQcm9wZXJ0eU1vZHVsZS5mKG9iamVjdCwgcHJvcGVydHlLZXksIGNyZWF0ZVByb3BlcnR5RGVzY3JpcHRvcigwLCB2YWx1ZSkpO2Vsc2UKCiAgICAgIG9iamVjdFtwcm9wZXJ0eUtleV0gPSB2YWx1ZTsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDkwICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGNsYXNzb2YgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDkxKTsKICAgIHZhciBJdGVyYXRvcnMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDgyKTsKICAgIHZhciB3ZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUzKTsKICAgIHZhciBJVEVSQVRPUiA9IHdlbGxLbm93blN5bWJvbCgnaXRlcmF0b3InKTsKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7CiAgICAgIGlmIChpdCAhPSB1bmRlZmluZWQpCiAgICAgIHJldHVybiBpdFtJVEVSQVRPUl0gfHwgaXRbJ0BAaXRlcmF0b3InXSB8fCBJdGVyYXRvcnNbY2xhc3NvZihpdCldOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogOTEgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgVE9fU1RSSU5HX1RBR19TVVBQT1JUID0gX193X3BkZmpzX3JlcXVpcmVfXyg5Mik7CiAgICB2YXIgY2xhc3NvZlJhdyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTQpOwogICAgdmFyIHdlbGxLbm93blN5bWJvbCA9IF9fd19wZGZqc19yZXF1aXJlX18oNTMpOwogICAgdmFyIFRPX1NUUklOR19UQUcgPSB3ZWxsS25vd25TeW1ib2woJ3RvU3RyaW5nVGFnJyk7CiAgICB2YXIgQ09SUkVDVF9BUkdVTUVOVFMgPSBjbGFzc29mUmF3KGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIGFyZ3VtZW50czsKICAgIH0oKSkgPT0gJ0FyZ3VtZW50cyc7CiAgICB2YXIgdHJ5R2V0ID0gZnVuY3Rpb24gdHJ5R2V0KGl0LCBrZXkpIHsKICAgICAgdHJ5IHsKICAgICAgICByZXR1cm4gaXRba2V5XTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgfQogICAgfTsKICAgIG1vZHVsZS5leHBvcnRzID0gVE9fU1RSSU5HX1RBR19TVVBQT1JUID8gY2xhc3NvZlJhdyA6IGZ1bmN0aW9uIChpdCkgewogICAgICB2YXIgTywgdGFnLCByZXN1bHQ7CiAgICAgIHJldHVybiBpdCA9PT0gdW5kZWZpbmVkID8gJ1VuZGVmaW5lZCcgOiBpdCA9PT0gbnVsbCA/ICdOdWxsJyA6IHR5cGVvZiAodGFnID0gdHJ5R2V0KE8gPSBPYmplY3QoaXQpLCBUT19TVFJJTkdfVEFHKSkgPT0gJ3N0cmluZycgPyB0YWcgOiBDT1JSRUNUX0FSR1VNRU5UUyA/IGNsYXNzb2ZSYXcoTykgOiAocmVzdWx0ID0gY2xhc3NvZlJhdyhPKSkgPT0gJ09iamVjdCcgJiYgdHlwZW9mIE8uY2FsbGVlID09ICdmdW5jdGlvbicgPyAnQXJndW1lbnRzJyA6IHJlc3VsdDsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDkyICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIHdlbGxLbm93blN5bWJvbCA9IF9fd19wZGZqc19yZXF1aXJlX18oNTMpOwogICAgdmFyIFRPX1NUUklOR19UQUcgPSB3ZWxsS25vd25TeW1ib2woJ3RvU3RyaW5nVGFnJyk7CiAgICB2YXIgdGVzdCA9IHt9OwogICAgdGVzdFtUT19TVFJJTkdfVEFHXSA9ICd6JzsKICAgIG1vZHVsZS5leHBvcnRzID0gU3RyaW5nKHRlc3QpID09PSAnW29iamVjdCB6XSc7CgogICAgLyoqKi99KSwgKAogIC8qIDkzICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIHdlbGxLbm93blN5bWJvbCA9IF9fd19wZGZqc19yZXF1aXJlX18oNTMpOwogICAgdmFyIElURVJBVE9SID0gd2VsbEtub3duU3ltYm9sKCdpdGVyYXRvcicpOwogICAgdmFyIFNBRkVfQ0xPU0lORyA9IGZhbHNlOwogICAgdHJ5IHsKICAgICAgdmFyIGNhbGxlZCA9IDA7CiAgICAgIHZhciBpdGVyYXRvcldpdGhSZXR1cm4gPSB7CiAgICAgICAgbmV4dDogZnVuY3Rpb24gbmV4dCgpIHsKICAgICAgICAgIHJldHVybiB7IGRvbmU6ICEhY2FsbGVkKysgfTsKICAgICAgICB9LAogICAgICAgICdyZXR1cm4nOiBmdW5jdGlvbiBfcmV0dXJuKCkgewogICAgICAgICAgU0FGRV9DTE9TSU5HID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIGl0ZXJhdG9yV2l0aFJldHVybltJVEVSQVRPUl0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH07CiAgICAgIEFycmF5LmZyb20oaXRlcmF0b3JXaXRoUmV0dXJuLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhyb3cgMjsKICAgICAgfSk7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgfQogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoZXhlYywgU0tJUF9DTE9TSU5HKSB7CiAgICAgIGlmICghU0tJUF9DTE9TSU5HICYmICFTQUZFX0NMT1NJTkcpCiAgICAgIHJldHVybiBmYWxzZTsKICAgICAgdmFyIElURVJBVElPTl9TVVBQT1JUID0gZmFsc2U7CiAgICAgIHRyeSB7CiAgICAgICAgdmFyIG9iamVjdCA9IHt9OwogICAgICAgIG9iamVjdFtJVEVSQVRPUl0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBuZXh0OiBmdW5jdGlvbiBuZXh0KCkgewogICAgICAgICAgICAgIHJldHVybiB7IGRvbmU6IElURVJBVElPTl9TVVBQT1JUID0gdHJ1ZSB9OwogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgIH07CiAgICAgICAgZXhlYyhvYmplY3QpOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICB9CiAgICAgIHJldHVybiBJVEVSQVRJT05fU1VQUE9SVDsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDk0ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgX193X3BkZmpzX3JlcXVpcmVfXyg5NSk7CiAgICB2YXIgcGF0aCA9IF9fd19wZGZqc19yZXF1aXJlX18oMzgpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBwYXRoLk9iamVjdC5hc3NpZ247CgogICAgLyoqKi99KSwgKAogIC8qIDk1ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyICQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUpOwogICAgdmFyIGFzc2lnbiA9IF9fd19wZGZqc19yZXF1aXJlX18oOTYpOwogICAgJCh7CiAgICAgIHRhcmdldDogJ09iamVjdCcsCiAgICAgIHN0YXQ6IHRydWUsCiAgICAgIGZvcmNlZDogT2JqZWN0LmFzc2lnbiAhPT0gYXNzaWduCiAgICB9LCB7IGFzc2lnbjogYXNzaWduIH0pOwoKICAgIC8qKiovfSksICgKICAvKiA5NiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgREVTQ1JJUFRPUlMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDgpOwogICAgdmFyIGZhaWxzID0gX193X3BkZmpzX3JlcXVpcmVfXyg5KTsKICAgIHZhciBvYmplY3RLZXlzID0gX193X3BkZmpzX3JlcXVpcmVfXyg2OSk7CiAgICB2YXIgZ2V0T3duUHJvcGVydHlTeW1ib2xzTW9kdWxlID0gX193X3BkZmpzX3JlcXVpcmVfXyg0Nik7CiAgICB2YXIgcHJvcGVydHlJc0VudW1lcmFibGVNb2R1bGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEwKTsKICAgIHZhciB0b09iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oNzkpOwogICAgdmFyIEluZGV4ZWRPYmplY3QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEzKTsKICAgIHZhciBuYXRpdmVBc3NpZ24gPSBPYmplY3QuYXNzaWduOwogICAgdmFyIGRlZmluZVByb3BlcnR5ID0gT2JqZWN0LmRlZmluZVByb3BlcnR5OwogICAgbW9kdWxlLmV4cG9ydHMgPSAhbmF0aXZlQXNzaWduIHx8IGZhaWxzKGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKERFU0NSSVBUT1JTICYmIG5hdGl2ZUFzc2lnbih7IGI6IDEgfSwgbmF0aXZlQXNzaWduKGRlZmluZVByb3BlcnR5KHt9LCAnYScsIHsKICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgZGVmaW5lUHJvcGVydHkodGhpcywgJ2InLCB7CiAgICAgICAgICAgIHZhbHVlOiAzLAogICAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KSwgeyBiOiAyIH0pKS5iICE9PSAxKQogICAgICByZXR1cm4gdHJ1ZTsKICAgICAgdmFyIEEgPSB7fTsKICAgICAgdmFyIEIgPSB7fTsKICAgICAgdmFyIHN5bWJvbCA9IFN5bWJvbCgpOwogICAgICB2YXIgYWxwaGFiZXQgPSAnYWJjZGVmZ2hpamtsbW5vcHFyc3QnOwogICAgICBBW3N5bWJvbF0gPSA3OwogICAgICBhbHBoYWJldC5zcGxpdCgnJykuZm9yRWFjaChmdW5jdGlvbiAoY2hyKSB7CiAgICAgICAgQltjaHJdID0gY2hyOwogICAgICB9KTsKICAgICAgcmV0dXJuIG5hdGl2ZUFzc2lnbih7fSwgQSlbc3ltYm9sXSAhPSA3IHx8IG9iamVjdEtleXMobmF0aXZlQXNzaWduKHt9LCBCKSkuam9pbignJykgIT0gYWxwaGFiZXQ7CiAgICB9KSA/IGZ1bmN0aW9uIGFzc2lnbih0YXJnZXQsIHNvdXJjZSkgewogICAgICB2YXIgVCA9IHRvT2JqZWN0KHRhcmdldCk7CiAgICAgIHZhciBhcmd1bWVudHNMZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoOwogICAgICB2YXIgaW5kZXggPSAxOwogICAgICB2YXIgZ2V0T3duUHJvcGVydHlTeW1ib2xzID0gZ2V0T3duUHJvcGVydHlTeW1ib2xzTW9kdWxlLmY7CiAgICAgIHZhciBwcm9wZXJ0eUlzRW51bWVyYWJsZSA9IHByb3BlcnR5SXNFbnVtZXJhYmxlTW9kdWxlLmY7CiAgICAgIHdoaWxlIChhcmd1bWVudHNMZW5ndGggPiBpbmRleCkgewogICAgICAgIHZhciBTID0gSW5kZXhlZE9iamVjdChhcmd1bWVudHNbaW5kZXgrK10pOwogICAgICAgIHZhciBrZXlzID0gZ2V0T3duUHJvcGVydHlTeW1ib2xzID8gb2JqZWN0S2V5cyhTKS5jb25jYXQoZ2V0T3duUHJvcGVydHlTeW1ib2xzKFMpKSA6IG9iamVjdEtleXMoUyk7CiAgICAgICAgdmFyIGxlbmd0aCA9IGtleXMubGVuZ3RoOwogICAgICAgIHZhciBqID0gMDsKICAgICAgICB2YXIga2V5OwogICAgICAgIHdoaWxlIChsZW5ndGggPiBqKSB7CiAgICAgICAgICBrZXkgPSBrZXlzW2orK107CiAgICAgICAgICBpZiAoIURFU0NSSVBUT1JTIHx8IHByb3BlcnR5SXNFbnVtZXJhYmxlLmNhbGwoUywga2V5KSkKICAgICAgICAgIFRba2V5XSA9IFNba2V5XTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIFQ7CiAgICB9IDogbmF0aXZlQXNzaWduOwoKICAgIC8qKiovfSksICgKICAvKiA5NyAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIF9fd19wZGZqc19yZXF1aXJlX18oOTgpOwogICAgdmFyIHBhdGggPSBfX3dfcGRmanNfcmVxdWlyZV9fKDM4KTsKICAgIG1vZHVsZS5leHBvcnRzID0gcGF0aC5NYXRoLmxvZzI7CgogICAgLyoqKi99KSwgKAogIC8qIDk4ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyICQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUpOwogICAgdmFyIGxvZyA9IE1hdGgubG9nOwogICAgdmFyIExOMiA9IE1hdGguTE4yOwogICAgJCh7CiAgICAgIHRhcmdldDogJ01hdGgnLAogICAgICBzdGF0OiB0cnVlCiAgICB9LCB7CiAgICAgIGxvZzI6IGZ1bmN0aW9uIGxvZzIoeCkgewogICAgICAgIHJldHVybiBsb2coeCkgLyBMTjI7CiAgICAgIH0KICAgIH0pOwoKICAgIC8qKiovfSksICgKICAvKiA5OSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIF9fd19wZGZqc19yZXF1aXJlX18oMTAwKTsKICAgIHZhciBwYXRoID0gX193X3BkZmpzX3JlcXVpcmVfXygzOCk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IHBhdGguTnVtYmVyLmlzTmFOOwoKICAgIC8qKiovfSksICgKICAvKiAxMDAgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgJCA9IF9fd19wZGZqc19yZXF1aXJlX18oNSk7CiAgICAkKHsKICAgICAgdGFyZ2V0OiAnTnVtYmVyJywKICAgICAgc3RhdDogdHJ1ZQogICAgfSwgewogICAgICBpc05hTjogZnVuY3Rpb24gaXNOYU4obnVtYmVyKSB7CiAgICAgICAgcmV0dXJuIG51bWJlciAhPSBudW1iZXI7CiAgICAgIH0KICAgIH0pOwoKICAgIC8qKiovfSksICgKICAvKiAxMDEgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDEwMik7CiAgICB2YXIgcGF0aCA9IF9fd19wZGZqc19yZXF1aXJlX18oMzgpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBwYXRoLk51bWJlci5pc0ludGVnZXI7CgogICAgLyoqKi99KSwgKAogIC8qIDEwMiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciAkID0gX193X3BkZmpzX3JlcXVpcmVfXyg1KTsKICAgIHZhciBpc0ludGVnZXIgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEwMyk7CiAgICAkKHsKICAgICAgdGFyZ2V0OiAnTnVtYmVyJywKICAgICAgc3RhdDogdHJ1ZQogICAgfSwgeyBpc0ludGVnZXI6IGlzSW50ZWdlciB9KTsKCiAgICAvKioqL30pLCAoCiAgLyogMTAzICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGlzT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygxNyk7CiAgICB2YXIgZmxvb3IgPSBNYXRoLmZsb29yOwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBpc0ludGVnZXIoaXQpIHsKICAgICAgcmV0dXJuICFpc09iamVjdChpdCkgJiYgaXNGaW5pdGUoaXQpICYmIGZsb29yKGl0KSA9PT0gaXQ7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAxMDQgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDEwNSk7CiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDczKTsKICAgIF9fd19wZGZqc19yZXF1aXJlX18oMTA3KTsKICAgIF9fd19wZGZqc19yZXF1aXJlX18oMTEwKTsKICAgIF9fd19wZGZqc19yZXF1aXJlX18oMTI2KTsKICAgIF9fd19wZGZqc19yZXF1aXJlX18oMTI3KTsKICAgIHZhciBwYXRoID0gX193X3BkZmpzX3JlcXVpcmVfXygzOCk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IHBhdGguUHJvbWlzZTsKCiAgICAvKioqL30pLCAoCiAgLyogMTA1ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIFRPX1NUUklOR19UQUdfU1VQUE9SVCA9IF9fd19wZGZqc19yZXF1aXJlX18oOTIpOwogICAgdmFyIHJlZGVmaW5lID0gX193X3BkZmpzX3JlcXVpcmVfXygyNCk7CiAgICB2YXIgdG9TdHJpbmcgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEwNik7CiAgICBpZiAoIVRPX1NUUklOR19UQUdfU1VQUE9SVCkgewogICAgICByZWRlZmluZShPYmplY3QucHJvdG90eXBlLCAndG9TdHJpbmcnLCB0b1N0cmluZywgeyB1bnNhZmU6IHRydWUgfSk7CiAgICB9CgogICAgLyoqKi99KSwgKAogIC8qIDEwNiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgVE9fU1RSSU5HX1RBR19TVVBQT1JUID0gX193X3BkZmpzX3JlcXVpcmVfXyg5Mik7CiAgICB2YXIgY2xhc3NvZiA9IF9fd19wZGZqc19yZXF1aXJlX18oOTEpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBUT19TVFJJTkdfVEFHX1NVUFBPUlQgPyB7fS50b1N0cmluZyA6IGZ1bmN0aW9uIHRvU3RyaW5nKCkgewogICAgICByZXR1cm4gJ1tvYmplY3QgJyArIGNsYXNzb2YodGhpcykgKyAnXSc7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAxMDcgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgZ2xvYmFsID0gX193X3BkZmpzX3JlcXVpcmVfXyg2KTsKICAgIHZhciBET01JdGVyYWJsZXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEwOCk7CiAgICB2YXIgQXJyYXlJdGVyYXRvck1ldGhvZHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEwOSk7CiAgICB2YXIgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5ID0gX193X3BkZmpzX3JlcXVpcmVfXygyMSk7CiAgICB2YXIgd2VsbEtub3duU3ltYm9sID0gX193X3BkZmpzX3JlcXVpcmVfXyg1Myk7CiAgICB2YXIgSVRFUkFUT1IgPSB3ZWxsS25vd25TeW1ib2woJ2l0ZXJhdG9yJyk7CiAgICB2YXIgVE9fU1RSSU5HX1RBRyA9IHdlbGxLbm93blN5bWJvbCgndG9TdHJpbmdUYWcnKTsKICAgIHZhciBBcnJheVZhbHVlcyA9IEFycmF5SXRlcmF0b3JNZXRob2RzLnZhbHVlczsKICAgIGZvciAodmFyIENPTExFQ1RJT05fTkFNRSBpbiBET01JdGVyYWJsZXMpIHsKICAgICAgdmFyIENvbGxlY3Rpb24gPSBnbG9iYWxbQ09MTEVDVElPTl9OQU1FXTsKICAgICAgdmFyIENvbGxlY3Rpb25Qcm90b3R5cGUgPSBDb2xsZWN0aW9uICYmIENvbGxlY3Rpb24ucHJvdG90eXBlOwogICAgICBpZiAoQ29sbGVjdGlvblByb3RvdHlwZSkgewogICAgICAgIGlmIChDb2xsZWN0aW9uUHJvdG90eXBlW0lURVJBVE9SXSAhPT0gQXJyYXlWYWx1ZXMpCiAgICAgICAgdHJ5IHsKICAgICAgICAgIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eShDb2xsZWN0aW9uUHJvdG90eXBlLCBJVEVSQVRPUiwgQXJyYXlWYWx1ZXMpOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICBDb2xsZWN0aW9uUHJvdG90eXBlW0lURVJBVE9SXSA9IEFycmF5VmFsdWVzOwogICAgICAgIH0KICAgICAgICBpZiAoIUNvbGxlY3Rpb25Qcm90b3R5cGVbVE9fU1RSSU5HX1RBR10pIHsKICAgICAgICAgIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eShDb2xsZWN0aW9uUHJvdG90eXBlLCBUT19TVFJJTkdfVEFHLCBDT0xMRUNUSU9OX05BTUUpOwogICAgICAgIH0KICAgICAgICBpZiAoRE9NSXRlcmFibGVzW0NPTExFQ1RJT05fTkFNRV0pCiAgICAgICAgZm9yICh2YXIgTUVUSE9EX05BTUUgaW4gQXJyYXlJdGVyYXRvck1ldGhvZHMpIHsKICAgICAgICAgIGlmIChDb2xsZWN0aW9uUHJvdG90eXBlW01FVEhPRF9OQU1FXSAhPT0gQXJyYXlJdGVyYXRvck1ldGhvZHNbTUVUSE9EX05BTUVdKQogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5KENvbGxlY3Rpb25Qcm90b3R5cGUsIE1FVEhPRF9OQU1FLCBBcnJheUl0ZXJhdG9yTWV0aG9kc1tNRVRIT0RfTkFNRV0pOwogICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgQ29sbGVjdGlvblByb3RvdHlwZVtNRVRIT0RfTkFNRV0gPSBBcnJheUl0ZXJhdG9yTWV0aG9kc1tNRVRIT0RfTkFNRV07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgLyoqKi99KSwgKAogIC8qIDEwOCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewoKICAgIG1vZHVsZS5leHBvcnRzID0gewogICAgICBDU1NSdWxlTGlzdDogMCwKICAgICAgQ1NTU3R5bGVEZWNsYXJhdGlvbjogMCwKICAgICAgQ1NTVmFsdWVMaXN0OiAwLAogICAgICBDbGllbnRSZWN0TGlzdDogMCwKICAgICAgRE9NUmVjdExpc3Q6IDAsCiAgICAgIERPTVN0cmluZ0xpc3Q6IDAsCiAgICAgIERPTVRva2VuTGlzdDogMSwKICAgICAgRGF0YVRyYW5zZmVySXRlbUxpc3Q6IDAsCiAgICAgIEZpbGVMaXN0OiAwLAogICAgICBIVE1MQWxsQ29sbGVjdGlvbjogMCwKICAgICAgSFRNTENvbGxlY3Rpb246IDAsCiAgICAgIEhUTUxGb3JtRWxlbWVudDogMCwKICAgICAgSFRNTFNlbGVjdEVsZW1lbnQ6IDAsCiAgICAgIE1lZGlhTGlzdDogMCwKICAgICAgTWltZVR5cGVBcnJheTogMCwKICAgICAgTmFtZWROb2RlTWFwOiAwLAogICAgICBOb2RlTGlzdDogMSwKICAgICAgUGFpbnRSZXF1ZXN0TGlzdDogMCwKICAgICAgUGx1Z2luOiAwLAogICAgICBQbHVnaW5BcnJheTogMCwKICAgICAgU1ZHTGVuZ3RoTGlzdDogMCwKICAgICAgU1ZHTnVtYmVyTGlzdDogMCwKICAgICAgU1ZHUGF0aFNlZ0xpc3Q6IDAsCiAgICAgIFNWR1BvaW50TGlzdDogMCwKICAgICAgU1ZHU3RyaW5nTGlzdDogMCwKICAgICAgU1ZHVHJhbnNmb3JtTGlzdDogMCwKICAgICAgU291cmNlQnVmZmVyTGlzdDogMCwKICAgICAgU3R5bGVTaGVldExpc3Q6IDAsCiAgICAgIFRleHRUcmFja0N1ZUxpc3Q6IDAsCiAgICAgIFRleHRUcmFja0xpc3Q6IDAsCiAgICAgIFRvdWNoTGlzdDogMAogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogMTA5ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciB0b0luZGV4ZWRPYmplY3QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEyKTsKICAgIHZhciBhZGRUb1Vuc2NvcGFibGVzID0gX193X3BkZmpzX3JlcXVpcmVfXyg2Nik7CiAgICB2YXIgSXRlcmF0b3JzID0gX193X3BkZmpzX3JlcXVpcmVfXyg4Mik7CiAgICB2YXIgSW50ZXJuYWxTdGF0ZU1vZHVsZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjgpOwogICAgdmFyIGRlZmluZUl0ZXJhdG9yID0gX193X3BkZmpzX3JlcXVpcmVfXyg3NSk7CiAgICB2YXIgQVJSQVlfSVRFUkFUT1IgPSAnQXJyYXkgSXRlcmF0b3InOwogICAgdmFyIHNldEludGVybmFsU3RhdGUgPSBJbnRlcm5hbFN0YXRlTW9kdWxlLnNldDsKICAgIHZhciBnZXRJbnRlcm5hbFN0YXRlID0gSW50ZXJuYWxTdGF0ZU1vZHVsZS5nZXR0ZXJGb3IoQVJSQVlfSVRFUkFUT1IpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBkZWZpbmVJdGVyYXRvcihBcnJheSwgJ0FycmF5JywgZnVuY3Rpb24gKGl0ZXJhdGVkLCBraW5kKSB7CiAgICAgIHNldEludGVybmFsU3RhdGUodGhpcywgewogICAgICAgIHR5cGU6IEFSUkFZX0lURVJBVE9SLAogICAgICAgIHRhcmdldDogdG9JbmRleGVkT2JqZWN0KGl0ZXJhdGVkKSwKICAgICAgICBpbmRleDogMCwKICAgICAgICBraW5kOiBraW5kCiAgICAgIH0pOwogICAgfSwgZnVuY3Rpb24gKCkgewogICAgICB2YXIgc3RhdGUgPSBnZXRJbnRlcm5hbFN0YXRlKHRoaXMpOwogICAgICB2YXIgdGFyZ2V0ID0gc3RhdGUudGFyZ2V0OwogICAgICB2YXIga2luZCA9IHN0YXRlLmtpbmQ7CiAgICAgIHZhciBpbmRleCA9IHN0YXRlLmluZGV4Kys7CiAgICAgIGlmICghdGFyZ2V0IHx8IGluZGV4ID49IHRhcmdldC5sZW5ndGgpIHsKICAgICAgICBzdGF0ZS50YXJnZXQgPSB1bmRlZmluZWQ7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHZhbHVlOiB1bmRlZmluZWQsCiAgICAgICAgICBkb25lOiB0cnVlCiAgICAgICAgfTsKICAgICAgfQogICAgICBpZiAoa2luZCA9PSAna2V5cycpCiAgICAgIHJldHVybiB7CiAgICAgICAgdmFsdWU6IGluZGV4LAogICAgICAgIGRvbmU6IGZhbHNlCiAgICAgIH07CiAgICAgIGlmIChraW5kID09ICd2YWx1ZXMnKQogICAgICByZXR1cm4gewogICAgICAgIHZhbHVlOiB0YXJnZXRbaW5kZXhdLAogICAgICAgIGRvbmU6IGZhbHNlCiAgICAgIH07CiAgICAgIHJldHVybiB7CiAgICAgICAgdmFsdWU6IFsKICAgICAgICBpbmRleCwKICAgICAgICB0YXJnZXRbaW5kZXhdXSwKCiAgICAgICAgZG9uZTogZmFsc2UKICAgICAgfTsKICAgIH0sICd2YWx1ZXMnKTsKICAgIEl0ZXJhdG9ycy5Bcmd1bWVudHMgPSBJdGVyYXRvcnMuQXJyYXk7CiAgICBhZGRUb1Vuc2NvcGFibGVzKCdrZXlzJyk7CiAgICBhZGRUb1Vuc2NvcGFibGVzKCd2YWx1ZXMnKTsKICAgIGFkZFRvVW5zY29wYWJsZXMoJ2VudHJpZXMnKTsKCiAgICAvKioqL30pLCAoCiAgLyogMTEwICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciAkID0gX193X3BkZmpzX3JlcXVpcmVfXyg1KTsKICAgIHZhciBJU19QVVJFID0gX193X3BkZmpzX3JlcXVpcmVfXygzMik7CiAgICB2YXIgZ2xvYmFsID0gX193X3BkZmpzX3JlcXVpcmVfXyg2KTsKICAgIHZhciBnZXRCdWlsdEluID0gX193X3BkZmpzX3JlcXVpcmVfXygzNyk7CiAgICB2YXIgTmF0aXZlUHJvbWlzZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTExKTsKICAgIHZhciByZWRlZmluZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjQpOwogICAgdmFyIHJlZGVmaW5lQWxsID0gX193X3BkZmpzX3JlcXVpcmVfXygxMTIpOwogICAgdmFyIHNldFRvU3RyaW5nVGFnID0gX193X3BkZmpzX3JlcXVpcmVfXyg4MSk7CiAgICB2YXIgc2V0U3BlY2llcyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTEzKTsKICAgIHZhciBpc09iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTcpOwogICAgdmFyIGFGdW5jdGlvbiA9IF9fd19wZGZqc19yZXF1aXJlX18oNTkpOwogICAgdmFyIGFuSW5zdGFuY2UgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDExNCk7CiAgICB2YXIgY2xhc3NvZiA9IF9fd19wZGZqc19yZXF1aXJlX18oMTQpOwogICAgdmFyIGluc3BlY3RTb3VyY2UgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDI2KTsKICAgIHZhciBpdGVyYXRlID0gX193X3BkZmpzX3JlcXVpcmVfXygxMTUpOwogICAgdmFyIGNoZWNrQ29ycmVjdG5lc3NPZkl0ZXJhdGlvbiA9IF9fd19wZGZqc19yZXF1aXJlX18oOTMpOwogICAgdmFyIHNwZWNpZXNDb25zdHJ1Y3RvciA9IF9fd19wZGZqc19yZXF1aXJlX18oMTE2KTsKICAgIHZhciB0YXNrID0gX193X3BkZmpzX3JlcXVpcmVfXygxMTcpLnNldDsKICAgIHZhciBtaWNyb3Rhc2sgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEyMCk7CiAgICB2YXIgcHJvbWlzZVJlc29sdmUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEyMSk7CiAgICB2YXIgaG9zdFJlcG9ydEVycm9ycyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTIzKTsKICAgIHZhciBuZXdQcm9taXNlQ2FwYWJpbGl0eU1vZHVsZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTIyKTsKICAgIHZhciBwZXJmb3JtID0gX193X3BkZmpzX3JlcXVpcmVfXygxMjQpOwogICAgdmFyIEludGVybmFsU3RhdGVNb2R1bGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDI4KTsKICAgIHZhciBpc0ZvcmNlZCA9IF9fd19wZGZqc19yZXF1aXJlX18oNDcpOwogICAgdmFyIHdlbGxLbm93blN5bWJvbCA9IF9fd19wZGZqc19yZXF1aXJlX18oNTMpOwogICAgdmFyIFY4X1ZFUlNJT04gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEyNSk7CiAgICB2YXIgU1BFQ0lFUyA9IHdlbGxLbm93blN5bWJvbCgnc3BlY2llcycpOwogICAgdmFyIFBST01JU0UgPSAnUHJvbWlzZSc7CiAgICB2YXIgZ2V0SW50ZXJuYWxTdGF0ZSA9IEludGVybmFsU3RhdGVNb2R1bGUuZ2V0OwogICAgdmFyIHNldEludGVybmFsU3RhdGUgPSBJbnRlcm5hbFN0YXRlTW9kdWxlLnNldDsKICAgIHZhciBnZXRJbnRlcm5hbFByb21pc2VTdGF0ZSA9IEludGVybmFsU3RhdGVNb2R1bGUuZ2V0dGVyRm9yKFBST01JU0UpOwogICAgdmFyIFByb21pc2VDb25zdHJ1Y3RvciA9IE5hdGl2ZVByb21pc2U7CiAgICB2YXIgVHlwZUVycm9yID0gZ2xvYmFsLlR5cGVFcnJvcjsKICAgIHZhciBkb2N1bWVudCA9IGdsb2JhbC5kb2N1bWVudDsKICAgIHZhciBwcm9jZXNzID0gZ2xvYmFsLnByb2Nlc3M7CiAgICB2YXIgJGZldGNoID0gZ2V0QnVpbHRJbignZmV0Y2gnKTsKICAgIHZhciBuZXdQcm9taXNlQ2FwYWJpbGl0eSA9IG5ld1Byb21pc2VDYXBhYmlsaXR5TW9kdWxlLmY7CiAgICB2YXIgbmV3R2VuZXJpY1Byb21pc2VDYXBhYmlsaXR5ID0gbmV3UHJvbWlzZUNhcGFiaWxpdHk7CiAgICB2YXIgSVNfTk9ERSA9IGNsYXNzb2YocHJvY2VzcykgPT0gJ3Byb2Nlc3MnOwogICAgdmFyIERJU1BBVENIX0VWRU5UID0gISEoZG9jdW1lbnQgJiYgZG9jdW1lbnQuY3JlYXRlRXZlbnQgJiYgZ2xvYmFsLmRpc3BhdGNoRXZlbnQpOwogICAgdmFyIFVOSEFORExFRF9SRUpFQ1RJT04gPSAndW5oYW5kbGVkcmVqZWN0aW9uJzsKICAgIHZhciBSRUpFQ1RJT05fSEFORExFRCA9ICdyZWplY3Rpb25oYW5kbGVkJzsKICAgIHZhciBQRU5ESU5HID0gMDsKICAgIHZhciBGVUxGSUxMRUQgPSAxOwogICAgdmFyIFJFSkVDVEVEID0gMjsKICAgIHZhciBIQU5ETEVEID0gMTsKICAgIHZhciBVTkhBTkRMRUQgPSAyOwogICAgdmFyIEludGVybmFsLCBPd25Qcm9taXNlQ2FwYWJpbGl0eSwgUHJvbWlzZVdyYXBwZXIsIG5hdGl2ZVRoZW47CiAgICB2YXIgRk9SQ0VEID0gaXNGb3JjZWQoUFJPTUlTRSwgZnVuY3Rpb24gKCkgewogICAgICB2YXIgR0xPQkFMX0NPUkVfSlNfUFJPTUlTRSA9IGluc3BlY3RTb3VyY2UoUHJvbWlzZUNvbnN0cnVjdG9yKSAhPT0gU3RyaW5nKFByb21pc2VDb25zdHJ1Y3Rvcik7CiAgICAgIGlmICghR0xPQkFMX0NPUkVfSlNfUFJPTUlTRSkgewogICAgICAgIGlmIChWOF9WRVJTSU9OID09PSA2NikKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoIUlTX05PREUgJiYgdHlwZW9mIFByb21pc2VSZWplY3Rpb25FdmVudCAhPSAnZnVuY3Rpb24nKQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGlmIChJU19QVVJFICYmICFQcm9taXNlQ29uc3RydWN0b3IucHJvdG90eXBlWydmaW5hbGx5J10pCiAgICAgIHJldHVybiB0cnVlOwogICAgICBpZiAoVjhfVkVSU0lPTiA+PSA1MSAmJiAvbmF0aXZlIGNvZGUvLnRlc3QoUHJvbWlzZUNvbnN0cnVjdG9yKSkKICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB2YXIgcHJvbWlzZSA9IFByb21pc2VDb25zdHJ1Y3Rvci5yZXNvbHZlKDEpOwogICAgICB2YXIgRmFrZVByb21pc2UgPSBmdW5jdGlvbiBGYWtlUHJvbWlzZShleGVjKSB7CiAgICAgICAgZXhlYyhmdW5jdGlvbiAoKSB7CiAgICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICAgIH0pOwogICAgICB9OwogICAgICB2YXIgY29uc3RydWN0b3IgPSBwcm9taXNlLmNvbnN0cnVjdG9yID0ge307CiAgICAgIGNvbnN0cnVjdG9yW1NQRUNJRVNdID0gRmFrZVByb21pc2U7CiAgICAgIHJldHVybiAhKHByb21pc2UudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgIH0pIGluc3RhbmNlb2YgRmFrZVByb21pc2UpOwogICAgfSk7CiAgICB2YXIgSU5DT1JSRUNUX0lURVJBVElPTiA9IEZPUkNFRCB8fCAhY2hlY2tDb3JyZWN0bmVzc09mSXRlcmF0aW9uKGZ1bmN0aW9uIChpdGVyYWJsZSkgewogICAgICBQcm9taXNlQ29uc3RydWN0b3IuYWxsKGl0ZXJhYmxlKVsnY2F0Y2gnXShmdW5jdGlvbiAoKSB7CiAgICAgIH0pOwogICAgfSk7CiAgICB2YXIgaXNUaGVuYWJsZSA9IGZ1bmN0aW9uIGlzVGhlbmFibGUoaXQpIHsKICAgICAgdmFyIHRoZW47CiAgICAgIHJldHVybiBpc09iamVjdChpdCkgJiYgdHlwZW9mICh0aGVuID0gaXQudGhlbikgPT0gJ2Z1bmN0aW9uJyA/IHRoZW4gOiBmYWxzZTsKICAgIH07CiAgICB2YXIgbm90aWZ5ID0gZnVuY3Rpb24gbm90aWZ5KHByb21pc2UsIHN0YXRlLCBpc1JlamVjdCkgewogICAgICBpZiAoc3RhdGUubm90aWZpZWQpCiAgICAgIHJldHVybjsKICAgICAgc3RhdGUubm90aWZpZWQgPSB0cnVlOwogICAgICB2YXIgY2hhaW4gPSBzdGF0ZS5yZWFjdGlvbnM7CiAgICAgIG1pY3JvdGFzayhmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHZhbHVlID0gc3RhdGUudmFsdWU7CiAgICAgICAgdmFyIG9rID0gc3RhdGUuc3RhdGUgPT0gRlVMRklMTEVEOwogICAgICAgIHZhciBpbmRleCA9IDA7CiAgICAgICAgd2hpbGUgKGNoYWluLmxlbmd0aCA+IGluZGV4KSB7CiAgICAgICAgICB2YXIgcmVhY3Rpb24gPSBjaGFpbltpbmRleCsrXTsKICAgICAgICAgIHZhciBoYW5kbGVyID0gb2sgPyByZWFjdGlvbi5vayA6IHJlYWN0aW9uLmZhaWw7CiAgICAgICAgICB2YXIgcmVzb2x2ZSA9IHJlYWN0aW9uLnJlc29sdmU7CiAgICAgICAgICB2YXIgcmVqZWN0ID0gcmVhY3Rpb24ucmVqZWN0OwogICAgICAgICAgdmFyIGRvbWFpbiA9IHJlYWN0aW9uLmRvbWFpbjsKICAgICAgICAgIHZhciByZXN1bHQsIHRoZW4sIGV4aXRlZDsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChoYW5kbGVyKSB7CiAgICAgICAgICAgICAgaWYgKCFvaykgewogICAgICAgICAgICAgICAgaWYgKHN0YXRlLnJlamVjdGlvbiA9PT0gVU5IQU5ETEVEKQogICAgICAgICAgICAgICAgb25IYW5kbGVVbmhhbmRsZWQocHJvbWlzZSwgc3RhdGUpOwogICAgICAgICAgICAgICAgc3RhdGUucmVqZWN0aW9uID0gSEFORExFRDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGhhbmRsZXIgPT09IHRydWUpCiAgICAgICAgICAgICAgcmVzdWx0ID0gdmFsdWU7ZWxzZQogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlmIChkb21haW4pCiAgICAgICAgICAgICAgICBkb21haW4uZW50ZXIoKTsKICAgICAgICAgICAgICAgIHJlc3VsdCA9IGhhbmRsZXIodmFsdWUpOwogICAgICAgICAgICAgICAgaWYgKGRvbWFpbikgewogICAgICAgICAgICAgICAgICBkb21haW4uZXhpdCgpOwogICAgICAgICAgICAgICAgICBleGl0ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAocmVzdWx0ID09PSByZWFjdGlvbi5wcm9taXNlKSB7CiAgICAgICAgICAgICAgICByZWplY3QoVHlwZUVycm9yKCdQcm9taXNlLWNoYWluIGN5Y2xlJykpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhlbiA9IGlzVGhlbmFibGUocmVzdWx0KSkgewogICAgICAgICAgICAgICAgdGhlbi5jYWxsKHJlc3VsdCwgcmVzb2x2ZSwgcmVqZWN0KTsKICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICByZWplY3QodmFsdWUpOwogICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgaWYgKGRvbWFpbiAmJiAhZXhpdGVkKQogICAgICAgICAgICBkb21haW4uZXhpdCgpOwogICAgICAgICAgICByZWplY3QoZXJyb3IpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBzdGF0ZS5yZWFjdGlvbnMgPSBbXTsKICAgICAgICBzdGF0ZS5ub3RpZmllZCA9IGZhbHNlOwogICAgICAgIGlmIChpc1JlamVjdCAmJiAhc3RhdGUucmVqZWN0aW9uKQogICAgICAgIG9uVW5oYW5kbGVkKHByb21pc2UsIHN0YXRlKTsKICAgICAgfSk7CiAgICB9OwogICAgdmFyIGRpc3BhdGNoRXZlbnQgPSBmdW5jdGlvbiBkaXNwYXRjaEV2ZW50KG5hbWUsIHByb21pc2UsIHJlYXNvbikgewogICAgICB2YXIgZXZlbnQsIGhhbmRsZXI7CiAgICAgIGlmIChESVNQQVRDSF9FVkVOVCkgewogICAgICAgIGV2ZW50ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoJ0V2ZW50Jyk7CiAgICAgICAgZXZlbnQucHJvbWlzZSA9IHByb21pc2U7CiAgICAgICAgZXZlbnQucmVhc29uID0gcmVhc29uOwogICAgICAgIGV2ZW50LmluaXRFdmVudChuYW1lLCBmYWxzZSwgdHJ1ZSk7CiAgICAgICAgZ2xvYmFsLmRpc3BhdGNoRXZlbnQoZXZlbnQpOwogICAgICB9IGVsc2UKICAgICAgZXZlbnQgPSB7CiAgICAgICAgcHJvbWlzZTogcHJvbWlzZSwKICAgICAgICByZWFzb246IHJlYXNvbgogICAgICB9OwogICAgICBpZiAoaGFuZGxlciA9IGdsb2JhbFsnb24nICsgbmFtZV0pCiAgICAgIGhhbmRsZXIoZXZlbnQpO2Vsc2UKICAgICAgaWYgKG5hbWUgPT09IFVOSEFORExFRF9SRUpFQ1RJT04pCiAgICAgIGhvc3RSZXBvcnRFcnJvcnMoJ1VuaGFuZGxlZCBwcm9taXNlIHJlamVjdGlvbicsIHJlYXNvbik7CiAgICB9OwogICAgdmFyIG9uVW5oYW5kbGVkID0gZnVuY3Rpb24gb25VbmhhbmRsZWQocHJvbWlzZSwgc3RhdGUpIHsKICAgICAgdGFzay5jYWxsKGdsb2JhbCwgZnVuY3Rpb24gKCkgewogICAgICAgIHZhciB2YWx1ZSA9IHN0YXRlLnZhbHVlOwogICAgICAgIHZhciBJU19VTkhBTkRMRUQgPSBpc1VuaGFuZGxlZChzdGF0ZSk7CiAgICAgICAgdmFyIHJlc3VsdDsKICAgICAgICBpZiAoSVNfVU5IQU5ETEVEKSB7CiAgICAgICAgICByZXN1bHQgPSBwZXJmb3JtKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKElTX05PREUpIHsKICAgICAgICAgICAgICBwcm9jZXNzLmVtaXQoJ3VuaGFuZGxlZFJlamVjdGlvbicsIHZhbHVlLCBwcm9taXNlKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIGRpc3BhdGNoRXZlbnQoVU5IQU5ETEVEX1JFSkVDVElPTiwgcHJvbWlzZSwgdmFsdWUpOwogICAgICAgICAgfSk7CiAgICAgICAgICBzdGF0ZS5yZWplY3Rpb24gPSBJU19OT0RFIHx8IGlzVW5oYW5kbGVkKHN0YXRlKSA/IFVOSEFORExFRCA6IEhBTkRMRUQ7CiAgICAgICAgICBpZiAocmVzdWx0LmVycm9yKQogICAgICAgICAgdGhyb3cgcmVzdWx0LnZhbHVlOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9OwogICAgdmFyIGlzVW5oYW5kbGVkID0gZnVuY3Rpb24gaXNVbmhhbmRsZWQoc3RhdGUpIHsKICAgICAgcmV0dXJuIHN0YXRlLnJlamVjdGlvbiAhPT0gSEFORExFRCAmJiAhc3RhdGUucGFyZW50OwogICAgfTsKICAgIHZhciBvbkhhbmRsZVVuaGFuZGxlZCA9IGZ1bmN0aW9uIG9uSGFuZGxlVW5oYW5kbGVkKHByb21pc2UsIHN0YXRlKSB7CiAgICAgIHRhc2suY2FsbChnbG9iYWwsIGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoSVNfTk9ERSkgewogICAgICAgICAgcHJvY2Vzcy5lbWl0KCdyZWplY3Rpb25IYW5kbGVkJywgcHJvbWlzZSk7CiAgICAgICAgfSBlbHNlCiAgICAgICAgZGlzcGF0Y2hFdmVudChSRUpFQ1RJT05fSEFORExFRCwgcHJvbWlzZSwgc3RhdGUudmFsdWUpOwogICAgICB9KTsKICAgIH07CiAgICB2YXIgYmluZCA9IGZ1bmN0aW9uIGJpbmQoZm4sIHByb21pc2UsIHN0YXRlLCB1bndyYXApIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgIGZuKHByb21pc2UsIHN0YXRlLCB2YWx1ZSwgdW53cmFwKTsKICAgICAgfTsKICAgIH07CiAgICB2YXIgaW50ZXJuYWxSZWplY3QgPSBmdW5jdGlvbiBpbnRlcm5hbFJlamVjdChwcm9taXNlLCBzdGF0ZSwgdmFsdWUsIHVud3JhcCkgewogICAgICBpZiAoc3RhdGUuZG9uZSkKICAgICAgcmV0dXJuOwogICAgICBzdGF0ZS5kb25lID0gdHJ1ZTsKICAgICAgaWYgKHVud3JhcCkKICAgICAgc3RhdGUgPSB1bndyYXA7CiAgICAgIHN0YXRlLnZhbHVlID0gdmFsdWU7CiAgICAgIHN0YXRlLnN0YXRlID0gUkVKRUNURUQ7CiAgICAgIG5vdGlmeShwcm9taXNlLCBzdGF0ZSwgdHJ1ZSk7CiAgICB9OwogICAgdmFyIF9pbnRlcm5hbFJlc29sdmUgPSBmdW5jdGlvbiBpbnRlcm5hbFJlc29sdmUocHJvbWlzZSwgc3RhdGUsIHZhbHVlLCB1bndyYXApIHsKICAgICAgaWYgKHN0YXRlLmRvbmUpCiAgICAgIHJldHVybjsKICAgICAgc3RhdGUuZG9uZSA9IHRydWU7CiAgICAgIGlmICh1bndyYXApCiAgICAgIHN0YXRlID0gdW53cmFwOwogICAgICB0cnkgewogICAgICAgIGlmIChwcm9taXNlID09PSB2YWx1ZSkKICAgICAgICB0aHJvdyBUeXBlRXJyb3IoIlByb21pc2UgY2FuJ3QgYmUgcmVzb2x2ZWQgaXRzZWxmIik7CiAgICAgICAgdmFyIHRoZW4gPSBpc1RoZW5hYmxlKHZhbHVlKTsKICAgICAgICBpZiAodGhlbikgewogICAgICAgICAgbWljcm90YXNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHdyYXBwZXIgPSB7IGRvbmU6IGZhbHNlIH07CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgdGhlbi5jYWxsKHZhbHVlLCBiaW5kKF9pbnRlcm5hbFJlc29sdmUsIHByb21pc2UsIHdyYXBwZXIsIHN0YXRlKSwgYmluZChpbnRlcm5hbFJlamVjdCwgcHJvbWlzZSwgd3JhcHBlciwgc3RhdGUpKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICBpbnRlcm5hbFJlamVjdChwcm9taXNlLCB3cmFwcGVyLCBlcnJvciwgc3RhdGUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3RhdGUudmFsdWUgPSB2YWx1ZTsKICAgICAgICAgIHN0YXRlLnN0YXRlID0gRlVMRklMTEVEOwogICAgICAgICAgbm90aWZ5KHByb21pc2UsIHN0YXRlLCBmYWxzZSk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGludGVybmFsUmVqZWN0KHByb21pc2UsIHsgZG9uZTogZmFsc2UgfSwgZXJyb3IsIHN0YXRlKTsKICAgICAgfQogICAgfTsKICAgIGlmIChGT1JDRUQpIHsKICAgICAgUHJvbWlzZUNvbnN0cnVjdG9yID0gZnVuY3Rpb24gUHJvbWlzZShleGVjdXRvcikgewogICAgICAgIGFuSW5zdGFuY2UodGhpcywgUHJvbWlzZUNvbnN0cnVjdG9yLCBQUk9NSVNFKTsKICAgICAgICBhRnVuY3Rpb24oZXhlY3V0b3IpOwogICAgICAgIEludGVybmFsLmNhbGwodGhpcyk7CiAgICAgICAgdmFyIHN0YXRlID0gZ2V0SW50ZXJuYWxTdGF0ZSh0aGlzKTsKICAgICAgICB0cnkgewogICAgICAgICAgZXhlY3V0b3IoYmluZChfaW50ZXJuYWxSZXNvbHZlLCB0aGlzLCBzdGF0ZSksIGJpbmQoaW50ZXJuYWxSZWplY3QsIHRoaXMsIHN0YXRlKSk7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIGludGVybmFsUmVqZWN0KHRoaXMsIHN0YXRlLCBlcnJvcik7CiAgICAgICAgfQogICAgICB9OwogICAgICBJbnRlcm5hbCA9IGZ1bmN0aW9uIFByb21pc2UoZXhlY3V0b3IpIHsKICAgICAgICBzZXRJbnRlcm5hbFN0YXRlKHRoaXMsIHsKICAgICAgICAgIHR5cGU6IFBST01JU0UsCiAgICAgICAgICBkb25lOiBmYWxzZSwKICAgICAgICAgIG5vdGlmaWVkOiBmYWxzZSwKICAgICAgICAgIHBhcmVudDogZmFsc2UsCiAgICAgICAgICByZWFjdGlvbnM6IFtdLAogICAgICAgICAgcmVqZWN0aW9uOiBmYWxzZSwKICAgICAgICAgIHN0YXRlOiBQRU5ESU5HLAogICAgICAgICAgdmFsdWU6IHVuZGVmaW5lZAogICAgICAgIH0pOwogICAgICB9OwogICAgICBJbnRlcm5hbC5wcm90b3R5cGUgPSByZWRlZmluZUFsbChQcm9taXNlQ29uc3RydWN0b3IucHJvdG90eXBlLCB7CiAgICAgICAgdGhlbjogZnVuY3Rpb24gdGhlbihvbkZ1bGZpbGxlZCwgb25SZWplY3RlZCkgewogICAgICAgICAgdmFyIHN0YXRlID0gZ2V0SW50ZXJuYWxQcm9taXNlU3RhdGUodGhpcyk7CiAgICAgICAgICB2YXIgcmVhY3Rpb24gPSBuZXdQcm9taXNlQ2FwYWJpbGl0eShzcGVjaWVzQ29uc3RydWN0b3IodGhpcywgUHJvbWlzZUNvbnN0cnVjdG9yKSk7CiAgICAgICAgICByZWFjdGlvbi5vayA9IHR5cGVvZiBvbkZ1bGZpbGxlZCA9PSAnZnVuY3Rpb24nID8gb25GdWxmaWxsZWQgOiB0cnVlOwogICAgICAgICAgcmVhY3Rpb24uZmFpbCA9IHR5cGVvZiBvblJlamVjdGVkID09ICdmdW5jdGlvbicgJiYgb25SZWplY3RlZDsKICAgICAgICAgIHJlYWN0aW9uLmRvbWFpbiA9IElTX05PREUgPyBwcm9jZXNzLmRvbWFpbiA6IHVuZGVmaW5lZDsKICAgICAgICAgIHN0YXRlLnBhcmVudCA9IHRydWU7CiAgICAgICAgICBzdGF0ZS5yZWFjdGlvbnMucHVzaChyZWFjdGlvbik7CiAgICAgICAgICBpZiAoc3RhdGUuc3RhdGUgIT0gUEVORElORykKICAgICAgICAgIG5vdGlmeSh0aGlzLCBzdGF0ZSwgZmFsc2UpOwogICAgICAgICAgcmV0dXJuIHJlYWN0aW9uLnByb21pc2U7CiAgICAgICAgfSwKICAgICAgICAnY2F0Y2gnOiBmdW5jdGlvbiBfY2F0Y2gob25SZWplY3RlZCkgewogICAgICAgICAgcmV0dXJuIHRoaXMudGhlbih1bmRlZmluZWQsIG9uUmVqZWN0ZWQpOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIE93blByb21pc2VDYXBhYmlsaXR5ID0gZnVuY3Rpb24gT3duUHJvbWlzZUNhcGFiaWxpdHkoKSB7CiAgICAgICAgdmFyIHByb21pc2UgPSBuZXcgSW50ZXJuYWwoKTsKICAgICAgICB2YXIgc3RhdGUgPSBnZXRJbnRlcm5hbFN0YXRlKHByb21pc2UpOwogICAgICAgIHRoaXMucHJvbWlzZSA9IHByb21pc2U7CiAgICAgICAgdGhpcy5yZXNvbHZlID0gYmluZChfaW50ZXJuYWxSZXNvbHZlLCBwcm9taXNlLCBzdGF0ZSk7CiAgICAgICAgdGhpcy5yZWplY3QgPSBiaW5kKGludGVybmFsUmVqZWN0LCBwcm9taXNlLCBzdGF0ZSk7CiAgICAgIH07CiAgICAgIG5ld1Byb21pc2VDYXBhYmlsaXR5TW9kdWxlLmYgPSBuZXdQcm9taXNlQ2FwYWJpbGl0eSA9IGZ1bmN0aW9uIG5ld1Byb21pc2VDYXBhYmlsaXR5KEMpIHsKICAgICAgICByZXR1cm4gQyA9PT0gUHJvbWlzZUNvbnN0cnVjdG9yIHx8IEMgPT09IFByb21pc2VXcmFwcGVyID8gbmV3IE93blByb21pc2VDYXBhYmlsaXR5KEMpIDogbmV3R2VuZXJpY1Byb21pc2VDYXBhYmlsaXR5KEMpOwogICAgICB9OwogICAgICBpZiAoIUlTX1BVUkUgJiYgdHlwZW9mIE5hdGl2ZVByb21pc2UgPT0gJ2Z1bmN0aW9uJykgewogICAgICAgIG5hdGl2ZVRoZW4gPSBOYXRpdmVQcm9taXNlLnByb3RvdHlwZS50aGVuOwogICAgICAgIHJlZGVmaW5lKE5hdGl2ZVByb21pc2UucHJvdG90eXBlLCAndGhlbicsIGZ1bmN0aW9uIHRoZW4ob25GdWxmaWxsZWQsIG9uUmVqZWN0ZWQpIHsKICAgICAgICAgIHZhciB0aGF0ID0gdGhpczsKICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZUNvbnN0cnVjdG9yKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgICAgbmF0aXZlVGhlbi5jYWxsKHRoYXQsIHJlc29sdmUsIHJlamVjdCk7CiAgICAgICAgICB9KS50aGVuKG9uRnVsZmlsbGVkLCBvblJlamVjdGVkKTsKICAgICAgICB9LCB7IHVuc2FmZTogdHJ1ZSB9KTsKICAgICAgICBpZiAodHlwZW9mICRmZXRjaCA9PSAnZnVuY3Rpb24nKQogICAgICAgICQoewogICAgICAgICAgZ2xvYmFsOiB0cnVlLAogICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgIGZvcmNlZDogdHJ1ZQogICAgICAgIH0sIHsKICAgICAgICAgIGZldGNoOiBmdW5jdGlvbiBmZXRjaChpbnB1dCkgewogICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlc29sdmUoUHJvbWlzZUNvbnN0cnVjdG9yLCAkZmV0Y2guYXBwbHkoZ2xvYmFsLCBhcmd1bWVudHMpKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfQogICAgJCh7CiAgICAgIGdsb2JhbDogdHJ1ZSwKICAgICAgd3JhcDogdHJ1ZSwKICAgICAgZm9yY2VkOiBGT1JDRUQKICAgIH0sIHsgUHJvbWlzZTogUHJvbWlzZUNvbnN0cnVjdG9yIH0pOwogICAgc2V0VG9TdHJpbmdUYWcoUHJvbWlzZUNvbnN0cnVjdG9yLCBQUk9NSVNFLCBmYWxzZSwgdHJ1ZSk7CiAgICBzZXRTcGVjaWVzKFBST01JU0UpOwogICAgUHJvbWlzZVdyYXBwZXIgPSBnZXRCdWlsdEluKFBST01JU0UpOwogICAgJCh7CiAgICAgIHRhcmdldDogUFJPTUlTRSwKICAgICAgc3RhdDogdHJ1ZSwKICAgICAgZm9yY2VkOiBGT1JDRUQKICAgIH0sIHsKICAgICAgcmVqZWN0OiBmdW5jdGlvbiByZWplY3QocikgewogICAgICAgIHZhciBjYXBhYmlsaXR5ID0gbmV3UHJvbWlzZUNhcGFiaWxpdHkodGhpcyk7CiAgICAgICAgY2FwYWJpbGl0eS5yZWplY3QuY2FsbCh1bmRlZmluZWQsIHIpOwogICAgICAgIHJldHVybiBjYXBhYmlsaXR5LnByb21pc2U7CiAgICAgIH0KICAgIH0pOwogICAgJCh7CiAgICAgIHRhcmdldDogUFJPTUlTRSwKICAgICAgc3RhdDogdHJ1ZSwKICAgICAgZm9yY2VkOiBJU19QVVJFIHx8IEZPUkNFRAogICAgfSwgewogICAgICByZXNvbHZlOiBmdW5jdGlvbiByZXNvbHZlKHgpIHsKICAgICAgICByZXR1cm4gcHJvbWlzZVJlc29sdmUoSVNfUFVSRSAmJiB0aGlzID09PSBQcm9taXNlV3JhcHBlciA/IFByb21pc2VDb25zdHJ1Y3RvciA6IHRoaXMsIHgpOwogICAgICB9CiAgICB9KTsKICAgICQoewogICAgICB0YXJnZXQ6IFBST01JU0UsCiAgICAgIHN0YXQ6IHRydWUsCiAgICAgIGZvcmNlZDogSU5DT1JSRUNUX0lURVJBVElPTgogICAgfSwgewogICAgICBhbGw6IGZ1bmN0aW9uIGFsbChpdGVyYWJsZSkgewogICAgICAgIHZhciBDID0gdGhpczsKICAgICAgICB2YXIgY2FwYWJpbGl0eSA9IG5ld1Byb21pc2VDYXBhYmlsaXR5KEMpOwogICAgICAgIHZhciByZXNvbHZlID0gY2FwYWJpbGl0eS5yZXNvbHZlOwogICAgICAgIHZhciByZWplY3QgPSBjYXBhYmlsaXR5LnJlamVjdDsKICAgICAgICB2YXIgcmVzdWx0ID0gcGVyZm9ybShmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgJHByb21pc2VSZXNvbHZlID0gYUZ1bmN0aW9uKEMucmVzb2x2ZSk7CiAgICAgICAgICB2YXIgdmFsdWVzID0gW107CiAgICAgICAgICB2YXIgY291bnRlciA9IDA7CiAgICAgICAgICB2YXIgcmVtYWluaW5nID0gMTsKICAgICAgICAgIGl0ZXJhdGUoaXRlcmFibGUsIGZ1bmN0aW9uIChwcm9taXNlKSB7CiAgICAgICAgICAgIHZhciBpbmRleCA9IGNvdW50ZXIrKzsKICAgICAgICAgICAgdmFyIGFscmVhZHlDYWxsZWQgPSBmYWxzZTsKICAgICAgICAgICAgdmFsdWVzLnB1c2godW5kZWZpbmVkKTsKICAgICAgICAgICAgcmVtYWluaW5nKys7CiAgICAgICAgICAgICRwcm9taXNlUmVzb2x2ZS5jYWxsKEMsIHByb21pc2UpLnRoZW4oZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgICAgICAgaWYgKGFscmVhZHlDYWxsZWQpCiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIGFscmVhZHlDYWxsZWQgPSB0cnVlOwogICAgICAgICAgICAgIHZhbHVlc1tpbmRleF0gPSB2YWx1ZTsKICAgICAgICAgICAgICAtLXJlbWFpbmluZyB8fCByZXNvbHZlKHZhbHVlcyk7CiAgICAgICAgICAgIH0sIHJlamVjdCk7CiAgICAgICAgICB9KTsKICAgICAgICAgIC0tcmVtYWluaW5nIHx8IHJlc29sdmUodmFsdWVzKTsKICAgICAgICB9KTsKICAgICAgICBpZiAocmVzdWx0LmVycm9yKQogICAgICAgIHJlamVjdChyZXN1bHQudmFsdWUpOwogICAgICAgIHJldHVybiBjYXBhYmlsaXR5LnByb21pc2U7CiAgICAgIH0sCiAgICAgIHJhY2U6IGZ1bmN0aW9uIHJhY2UoaXRlcmFibGUpIHsKICAgICAgICB2YXIgQyA9IHRoaXM7CiAgICAgICAgdmFyIGNhcGFiaWxpdHkgPSBuZXdQcm9taXNlQ2FwYWJpbGl0eShDKTsKICAgICAgICB2YXIgcmVqZWN0ID0gY2FwYWJpbGl0eS5yZWplY3Q7CiAgICAgICAgdmFyIHJlc3VsdCA9IHBlcmZvcm0oZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyICRwcm9taXNlUmVzb2x2ZSA9IGFGdW5jdGlvbihDLnJlc29sdmUpOwogICAgICAgICAgaXRlcmF0ZShpdGVyYWJsZSwgZnVuY3Rpb24gKHByb21pc2UpIHsKICAgICAgICAgICAgJHByb21pc2VSZXNvbHZlLmNhbGwoQywgcHJvbWlzZSkudGhlbihjYXBhYmlsaXR5LnJlc29sdmUsIHJlamVjdCk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgICBpZiAocmVzdWx0LmVycm9yKQogICAgICAgIHJlamVjdChyZXN1bHQudmFsdWUpOwogICAgICAgIHJldHVybiBjYXBhYmlsaXR5LnByb21pc2U7CiAgICAgIH0KICAgIH0pOwoKICAgIC8qKiovfSksICgKICAvKiAxMTEgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgZ2xvYmFsID0gX193X3BkZmpzX3JlcXVpcmVfXyg2KTsKICAgIG1vZHVsZS5leHBvcnRzID0gZ2xvYmFsLlByb21pc2U7CgogICAgLyoqKi99KSwgKAogIC8qIDExMiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciByZWRlZmluZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjQpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAodGFyZ2V0LCBzcmMsIG9wdGlvbnMpIHsKICAgICAgZm9yICh2YXIga2V5IGluIHNyYykKICAgICAgcmVkZWZpbmUodGFyZ2V0LCBrZXksIHNyY1trZXldLCBvcHRpb25zKTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDExMyAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgZ2V0QnVpbHRJbiA9IF9fd19wZGZqc19yZXF1aXJlX18oMzcpOwogICAgdmFyIGRlZmluZVByb3BlcnR5TW9kdWxlID0gX193X3BkZmpzX3JlcXVpcmVfXygyMik7CiAgICB2YXIgd2VsbEtub3duU3ltYm9sID0gX193X3BkZmpzX3JlcXVpcmVfXyg1Myk7CiAgICB2YXIgREVTQ1JJUFRPUlMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDgpOwogICAgdmFyIFNQRUNJRVMgPSB3ZWxsS25vd25TeW1ib2woJ3NwZWNpZXMnKTsKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKENPTlNUUlVDVE9SX05BTUUpIHsKICAgICAgdmFyIENvbnN0cnVjdG9yID0gZ2V0QnVpbHRJbihDT05TVFJVQ1RPUl9OQU1FKTsKICAgICAgdmFyIGRlZmluZVByb3BlcnR5ID0gZGVmaW5lUHJvcGVydHlNb2R1bGUuZjsKICAgICAgaWYgKERFU0NSSVBUT1JTICYmIENvbnN0cnVjdG9yICYmICFDb25zdHJ1Y3RvcltTUEVDSUVTXSkgewogICAgICAgIGRlZmluZVByb3BlcnR5KENvbnN0cnVjdG9yLCBTUEVDSUVTLCB7CiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDExNCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewoKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0LCBDb25zdHJ1Y3RvciwgbmFtZSkgewogICAgICBpZiAoIShpdCBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgewogICAgICAgIHRocm93IFR5cGVFcnJvcignSW5jb3JyZWN0ICcgKyAobmFtZSA/IG5hbWUgKyAnICcgOiAnJykgKyAnaW52b2NhdGlvbicpOwogICAgICB9CiAgICAgIHJldHVybiBpdDsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDExNSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBhbk9iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oMjMpOwogICAgdmFyIGlzQXJyYXlJdGVyYXRvck1ldGhvZCA9IF9fd19wZGZqc19yZXF1aXJlX18oODgpOwogICAgdmFyIHRvTGVuZ3RoID0gX193X3BkZmpzX3JlcXVpcmVfXyg0Mik7CiAgICB2YXIgYmluZCA9IF9fd19wZGZqc19yZXF1aXJlX18oNTgpOwogICAgdmFyIGdldEl0ZXJhdG9yTWV0aG9kID0gX193X3BkZmpzX3JlcXVpcmVfXyg5MCk7CiAgICB2YXIgY2FsbFdpdGhTYWZlSXRlcmF0aW9uQ2xvc2luZyA9IF9fd19wZGZqc19yZXF1aXJlX18oODcpOwogICAgdmFyIFJlc3VsdCA9IGZ1bmN0aW9uIFJlc3VsdChzdG9wcGVkLCByZXN1bHQpIHsKICAgICAgdGhpcy5zdG9wcGVkID0gc3RvcHBlZDsKICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICB9OwogICAgdmFyIGl0ZXJhdGUgPSBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdGVyYWJsZSwgZm4sIHRoYXQsIEFTX0VOVFJJRVMsIElTX0lURVJBVE9SKSB7CiAgICAgIHZhciBib3VuZEZ1bmN0aW9uID0gYmluZChmbiwgdGhhdCwgQVNfRU5UUklFUyA/IDIgOiAxKTsKICAgICAgdmFyIGl0ZXJhdG9yLCBpdGVyRm4sIGluZGV4LCBsZW5ndGgsIHJlc3VsdCwgbmV4dCwgc3RlcDsKICAgICAgaWYgKElTX0lURVJBVE9SKSB7CiAgICAgICAgaXRlcmF0b3IgPSBpdGVyYWJsZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpdGVyRm4gPSBnZXRJdGVyYXRvck1ldGhvZChpdGVyYWJsZSk7CiAgICAgICAgaWYgKHR5cGVvZiBpdGVyRm4gIT0gJ2Z1bmN0aW9uJykKICAgICAgICB0aHJvdyBUeXBlRXJyb3IoJ1RhcmdldCBpcyBub3QgaXRlcmFibGUnKTsKICAgICAgICBpZiAoaXNBcnJheUl0ZXJhdG9yTWV0aG9kKGl0ZXJGbikpIHsKICAgICAgICAgIGZvciAoaW5kZXggPSAwLCBsZW5ndGggPSB0b0xlbmd0aChpdGVyYWJsZS5sZW5ndGgpOyBsZW5ndGggPiBpbmRleDsgaW5kZXgrKykgewogICAgICAgICAgICByZXN1bHQgPSBBU19FTlRSSUVTID8gYm91bmRGdW5jdGlvbihhbk9iamVjdChzdGVwID0gaXRlcmFibGVbaW5kZXhdKVswXSwgc3RlcFsxXSkgOiBib3VuZEZ1bmN0aW9uKGl0ZXJhYmxlW2luZGV4XSk7CiAgICAgICAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0IGluc3RhbmNlb2YgUmVzdWx0KQogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG5ldyBSZXN1bHQoZmFsc2UpOwogICAgICAgIH0KICAgICAgICBpdGVyYXRvciA9IGl0ZXJGbi5jYWxsKGl0ZXJhYmxlKTsKICAgICAgfQogICAgICBuZXh0ID0gaXRlcmF0b3IubmV4dDsKICAgICAgd2hpbGUgKCEoc3RlcCA9IG5leHQuY2FsbChpdGVyYXRvcikpLmRvbmUpIHsKICAgICAgICByZXN1bHQgPSBjYWxsV2l0aFNhZmVJdGVyYXRpb25DbG9zaW5nKGl0ZXJhdG9yLCBib3VuZEZ1bmN0aW9uLCBzdGVwLnZhbHVlLCBBU19FTlRSSUVTKTsKICAgICAgICBpZiAodHlwZW9mIHJlc3VsdCA9PSAnb2JqZWN0JyAmJiByZXN1bHQgJiYgcmVzdWx0IGluc3RhbmNlb2YgUmVzdWx0KQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0KICAgICAgcmV0dXJuIG5ldyBSZXN1bHQoZmFsc2UpOwogICAgfTsKICAgIGl0ZXJhdGUuc3RvcCA9IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgcmV0dXJuIG5ldyBSZXN1bHQodHJ1ZSwgcmVzdWx0KTsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDExNiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBhbk9iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oMjMpOwogICAgdmFyIGFGdW5jdGlvbiA9IF9fd19wZGZqc19yZXF1aXJlX18oNTkpOwogICAgdmFyIHdlbGxLbm93blN5bWJvbCA9IF9fd19wZGZqc19yZXF1aXJlX18oNTMpOwogICAgdmFyIFNQRUNJRVMgPSB3ZWxsS25vd25TeW1ib2woJ3NwZWNpZXMnKTsKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKE8sIGRlZmF1bHRDb25zdHJ1Y3RvcikgewogICAgICB2YXIgQyA9IGFuT2JqZWN0KE8pLmNvbnN0cnVjdG9yOwogICAgICB2YXIgUzsKICAgICAgcmV0dXJuIEMgPT09IHVuZGVmaW5lZCB8fCAoUyA9IGFuT2JqZWN0KEMpW1NQRUNJRVNdKSA9PSB1bmRlZmluZWQgPyBkZWZhdWx0Q29uc3RydWN0b3IgOiBhRnVuY3Rpb24oUyk7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAxMTcgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgZ2xvYmFsID0gX193X3BkZmpzX3JlcXVpcmVfXyg2KTsKICAgIHZhciBmYWlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oOSk7CiAgICB2YXIgY2xhc3NvZiA9IF9fd19wZGZqc19yZXF1aXJlX18oMTQpOwogICAgdmFyIGJpbmQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDU4KTsKICAgIHZhciBodG1sID0gX193X3BkZmpzX3JlcXVpcmVfXyg3MCk7CiAgICB2YXIgY3JlYXRlRWxlbWVudCA9IF9fd19wZGZqc19yZXF1aXJlX18oMjApOwogICAgdmFyIElTX0lPUyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTE4KTsKICAgIHZhciBsb2NhdGlvbiA9IGdsb2JhbC5sb2NhdGlvbjsKICAgIHZhciBzZXQgPSBnbG9iYWwuc2V0SW1tZWRpYXRlOwogICAgdmFyIGNsZWFyID0gZ2xvYmFsLmNsZWFySW1tZWRpYXRlOwogICAgdmFyIHByb2Nlc3MgPSBnbG9iYWwucHJvY2VzczsKICAgIHZhciBNZXNzYWdlQ2hhbm5lbCA9IGdsb2JhbC5NZXNzYWdlQ2hhbm5lbDsKICAgIHZhciBEaXNwYXRjaCA9IGdsb2JhbC5EaXNwYXRjaDsKICAgIHZhciBjb3VudGVyID0gMDsKICAgIHZhciBxdWV1ZSA9IHt9OwogICAgdmFyIE9OUkVBRFlTVEFURUNIQU5HRSA9ICdvbnJlYWR5c3RhdGVjaGFuZ2UnOwogICAgdmFyIGRlZmVyLCBjaGFubmVsLCBwb3J0OwogICAgdmFyIHJ1biA9IGZ1bmN0aW9uIHJ1bihpZCkgewogICAgICBpZiAocXVldWUuaGFzT3duUHJvcGVydHkoaWQpKSB7CiAgICAgICAgdmFyIGZuID0gcXVldWVbaWRdOwogICAgICAgIGRlbGV0ZSBxdWV1ZVtpZF07CiAgICAgICAgZm4oKTsKICAgICAgfQogICAgfTsKICAgIHZhciBydW5uZXIgPSBmdW5jdGlvbiBydW5uZXIoaWQpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICBydW4oaWQpOwogICAgICB9OwogICAgfTsKICAgIHZhciBsaXN0ZW5lciA9IGZ1bmN0aW9uIGxpc3RlbmVyKGV2ZW50KSB7CiAgICAgIHJ1bihldmVudC5kYXRhKTsKICAgIH07CiAgICB2YXIgcG9zdCA9IGZ1bmN0aW9uIHBvc3QoaWQpIHsKICAgICAgZ2xvYmFsLnBvc3RNZXNzYWdlKGlkICsgJycsIGxvY2F0aW9uLnByb3RvY29sICsgJy8vJyArIGxvY2F0aW9uLmhvc3QpOwogICAgfTsKICAgIGlmICghc2V0IHx8ICFjbGVhcikgewogICAgICBzZXQgPSBmdW5jdGlvbiBzZXRJbW1lZGlhdGUoZm4pIHsKICAgICAgICB2YXIgYXJncyA9IFtdOwogICAgICAgIHZhciBpID0gMTsKICAgICAgICB3aGlsZSAoYXJndW1lbnRzLmxlbmd0aCA+IGkpCiAgICAgICAgYXJncy5wdXNoKGFyZ3VtZW50c1tpKytdKTsKICAgICAgICBxdWV1ZVsrK2NvdW50ZXJdID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgKHR5cGVvZiBmbiA9PSAnZnVuY3Rpb24nID8gZm4gOiBGdW5jdGlvbihmbikpLmFwcGx5KHVuZGVmaW5lZCwgYXJncyk7CiAgICAgICAgfTsKICAgICAgICBkZWZlcihjb3VudGVyKTsKICAgICAgICByZXR1cm4gY291bnRlcjsKICAgICAgfTsKICAgICAgY2xlYXIgPSBmdW5jdGlvbiBjbGVhckltbWVkaWF0ZShpZCkgewogICAgICAgIGRlbGV0ZSBxdWV1ZVtpZF07CiAgICAgIH07CiAgICAgIGlmIChjbGFzc29mKHByb2Nlc3MpID09ICdwcm9jZXNzJykgewogICAgICAgIGRlZmVyID0gZnVuY3Rpb24gZGVmZXIoaWQpIHsKICAgICAgICAgIHByb2Nlc3MubmV4dFRpY2socnVubmVyKGlkKSk7CiAgICAgICAgfTsKICAgICAgfSBlbHNlIGlmIChEaXNwYXRjaCAmJiBEaXNwYXRjaC5ub3cpIHsKICAgICAgICBkZWZlciA9IGZ1bmN0aW9uIGRlZmVyKGlkKSB7CiAgICAgICAgICBEaXNwYXRjaC5ub3cocnVubmVyKGlkKSk7CiAgICAgICAgfTsKICAgICAgfSBlbHNlIGlmIChNZXNzYWdlQ2hhbm5lbCAmJiAhSVNfSU9TKSB7CiAgICAgICAgY2hhbm5lbCA9IG5ldyBNZXNzYWdlQ2hhbm5lbCgpOwogICAgICAgIHBvcnQgPSBjaGFubmVsLnBvcnQyOwogICAgICAgIGNoYW5uZWwucG9ydDEub25tZXNzYWdlID0gbGlzdGVuZXI7CiAgICAgICAgZGVmZXIgPSBiaW5kKHBvcnQucG9zdE1lc3NhZ2UsIHBvcnQsIDEpOwogICAgICB9IGVsc2UgaWYgKGdsb2JhbC5hZGRFdmVudExpc3RlbmVyICYmIHR5cGVvZiBwb3N0TWVzc2FnZSA9PSAnZnVuY3Rpb24nICYmICFnbG9iYWwuaW1wb3J0U2NyaXB0cyAmJiAhZmFpbHMocG9zdCkpIHsKICAgICAgICBkZWZlciA9IHBvc3Q7CiAgICAgICAgZ2xvYmFsLmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBsaXN0ZW5lciwgZmFsc2UpOwogICAgICB9IGVsc2UgaWYgKE9OUkVBRFlTVEFURUNIQU5HRSBpbiBjcmVhdGVFbGVtZW50KCdzY3JpcHQnKSkgewogICAgICAgIGRlZmVyID0gZnVuY3Rpb24gZGVmZXIoaWQpIHsKICAgICAgICAgIGh0bWwuYXBwZW5kQ2hpbGQoY3JlYXRlRWxlbWVudCgnc2NyaXB0JykpW09OUkVBRFlTVEFURUNIQU5HRV0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGh0bWwucmVtb3ZlQ2hpbGQodGhpcyk7CiAgICAgICAgICAgIHJ1bihpZCk7CiAgICAgICAgICB9OwogICAgICAgIH07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGVmZXIgPSBmdW5jdGlvbiBkZWZlcihpZCkgewogICAgICAgICAgc2V0VGltZW91dChydW5uZXIoaWQpLCAwKTsKICAgICAgICB9OwogICAgICB9CiAgICB9CiAgICBtb2R1bGUuZXhwb3J0cyA9IHsKICAgICAgc2V0OiBzZXQsCiAgICAgIGNsZWFyOiBjbGVhcgogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogMTE4ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIHVzZXJBZ2VudCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTE5KTsKICAgIG1vZHVsZS5leHBvcnRzID0gLyhpcGhvbmV8aXBvZHxpcGFkKS4qYXBwbGV3ZWJraXQvaS50ZXN0KHVzZXJBZ2VudCk7CgogICAgLyoqKi99KSwgKAogIC8qIDExOSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBnZXRCdWlsdEluID0gX193X3BkZmpzX3JlcXVpcmVfXygzNyk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGdldEJ1aWx0SW4oJ25hdmlnYXRvcicsICd1c2VyQWdlbnQnKSB8fCAnJzsKCiAgICAvKioqL30pLCAoCiAgLyogMTIwICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGdsb2JhbCA9IF9fd19wZGZqc19yZXF1aXJlX18oNik7CiAgICB2YXIgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0gX193X3BkZmpzX3JlcXVpcmVfXyg3KS5mOwogICAgdmFyIGNsYXNzb2YgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE0KTsKICAgIHZhciBtYWNyb3Rhc2sgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDExNykuc2V0OwogICAgdmFyIElTX0lPUyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTE4KTsKICAgIHZhciBNdXRhdGlvbk9ic2VydmVyID0gZ2xvYmFsLk11dGF0aW9uT2JzZXJ2ZXIgfHwgZ2xvYmFsLldlYktpdE11dGF0aW9uT2JzZXJ2ZXI7CiAgICB2YXIgcHJvY2VzcyA9IGdsb2JhbC5wcm9jZXNzOwogICAgdmFyIFByb21pc2UgPSBnbG9iYWwuUHJvbWlzZTsKICAgIHZhciBJU19OT0RFID0gY2xhc3NvZihwcm9jZXNzKSA9PSAncHJvY2Vzcyc7CiAgICB2YXIgcXVldWVNaWNyb3Rhc2tEZXNjcmlwdG9yID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGdsb2JhbCwgJ3F1ZXVlTWljcm90YXNrJyk7CiAgICB2YXIgcXVldWVNaWNyb3Rhc2sgPSBxdWV1ZU1pY3JvdGFza0Rlc2NyaXB0b3IgJiYgcXVldWVNaWNyb3Rhc2tEZXNjcmlwdG9yLnZhbHVlOwogICAgdmFyIGZsdXNoLCBoZWFkLCBsYXN0LCBub3RpZnksIHRvZ2dsZSwgbm9kZSwgcHJvbWlzZSwgdGhlbjsKICAgIGlmICghcXVldWVNaWNyb3Rhc2spIHsKICAgICAgZmx1c2ggPSBmdW5jdGlvbiBmbHVzaCgpIHsKICAgICAgICB2YXIgcGFyZW50LCBmbjsKICAgICAgICBpZiAoSVNfTk9ERSAmJiAocGFyZW50ID0gcHJvY2Vzcy5kb21haW4pKQogICAgICAgIHBhcmVudC5leGl0KCk7CiAgICAgICAgd2hpbGUgKGhlYWQpIHsKICAgICAgICAgIGZuID0gaGVhZC5mbjsKICAgICAgICAgIGhlYWQgPSBoZWFkLm5leHQ7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBmbigpOwogICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgaWYgKGhlYWQpCiAgICAgICAgICAgIG5vdGlmeSgpO2Vsc2UKCiAgICAgICAgICAgIGxhc3QgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgIHRocm93IGVycm9yOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBsYXN0ID0gdW5kZWZpbmVkOwogICAgICAgIGlmIChwYXJlbnQpCiAgICAgICAgcGFyZW50LmVudGVyKCk7CiAgICAgIH07CiAgICAgIGlmIChJU19OT0RFKSB7CiAgICAgICAgbm90aWZ5ID0gZnVuY3Rpb24gbm90aWZ5KCkgewogICAgICAgICAgcHJvY2Vzcy5uZXh0VGljayhmbHVzaCk7CiAgICAgICAgfTsKICAgICAgfSBlbHNlIGlmIChNdXRhdGlvbk9ic2VydmVyICYmICFJU19JT1MpIHsKICAgICAgICB0b2dnbGUgPSB0cnVlOwogICAgICAgIG5vZGUgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyk7CiAgICAgICAgbmV3IE11dGF0aW9uT2JzZXJ2ZXIoZmx1c2gpLm9ic2VydmUobm9kZSwgeyBjaGFyYWN0ZXJEYXRhOiB0cnVlIH0pOwogICAgICAgIG5vdGlmeSA9IGZ1bmN0aW9uIG5vdGlmeSgpIHsKICAgICAgICAgIG5vZGUuZGF0YSA9IHRvZ2dsZSA9ICF0b2dnbGU7CiAgICAgICAgfTsKICAgICAgfSBlbHNlIGlmIChQcm9taXNlICYmIFByb21pc2UucmVzb2x2ZSkgewogICAgICAgIHByb21pc2UgPSBQcm9taXNlLnJlc29sdmUodW5kZWZpbmVkKTsKICAgICAgICB0aGVuID0gcHJvbWlzZS50aGVuOwogICAgICAgIG5vdGlmeSA9IGZ1bmN0aW9uIG5vdGlmeSgpIHsKICAgICAgICAgIHRoZW4uY2FsbChwcm9taXNlLCBmbHVzaCk7CiAgICAgICAgfTsKICAgICAgfSBlbHNlIHsKICAgICAgICBub3RpZnkgPSBmdW5jdGlvbiBub3RpZnkoKSB7CiAgICAgICAgICBtYWNyb3Rhc2suY2FsbChnbG9iYWwsIGZsdXNoKTsKICAgICAgICB9OwogICAgICB9CiAgICB9CiAgICBtb2R1bGUuZXhwb3J0cyA9IHF1ZXVlTWljcm90YXNrIHx8IGZ1bmN0aW9uIChmbikgewogICAgICB2YXIgdGFzayA9IHsKICAgICAgICBmbjogZm4sCiAgICAgICAgbmV4dDogdW5kZWZpbmVkCiAgICAgIH07CiAgICAgIGlmIChsYXN0KQogICAgICBsYXN0Lm5leHQgPSB0YXNrOwogICAgICBpZiAoIWhlYWQpIHsKICAgICAgICBoZWFkID0gdGFzazsKICAgICAgICBub3RpZnkoKTsKICAgICAgfQogICAgICBsYXN0ID0gdGFzazsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDEyMSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBhbk9iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oMjMpOwogICAgdmFyIGlzT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygxNyk7CiAgICB2YXIgbmV3UHJvbWlzZUNhcGFiaWxpdHkgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEyMik7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChDLCB4KSB7CiAgICAgIGFuT2JqZWN0KEMpOwogICAgICBpZiAoaXNPYmplY3QoeCkgJiYgeC5jb25zdHJ1Y3RvciA9PT0gQykKICAgICAgcmV0dXJuIHg7CiAgICAgIHZhciBwcm9taXNlQ2FwYWJpbGl0eSA9IG5ld1Byb21pc2VDYXBhYmlsaXR5LmYoQyk7CiAgICAgIHZhciByZXNvbHZlID0gcHJvbWlzZUNhcGFiaWxpdHkucmVzb2x2ZTsKICAgICAgcmVzb2x2ZSh4KTsKICAgICAgcmV0dXJuIHByb21pc2VDYXBhYmlsaXR5LnByb21pc2U7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAxMjIgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGFGdW5jdGlvbiA9IF9fd19wZGZqc19yZXF1aXJlX18oNTkpOwogICAgdmFyIFByb21pc2VDYXBhYmlsaXR5ID0gZnVuY3Rpb24gUHJvbWlzZUNhcGFiaWxpdHkoQykgewogICAgICB2YXIgcmVzb2x2ZSwgcmVqZWN0OwogICAgICB0aGlzLnByb21pc2UgPSBuZXcgQyhmdW5jdGlvbiAoJCRyZXNvbHZlLCAkJHJlamVjdCkgewogICAgICAgIGlmIChyZXNvbHZlICE9PSB1bmRlZmluZWQgfHwgcmVqZWN0ICE9PSB1bmRlZmluZWQpCiAgICAgICAgdGhyb3cgVHlwZUVycm9yKCdCYWQgUHJvbWlzZSBjb25zdHJ1Y3RvcicpOwogICAgICAgIHJlc29sdmUgPSAkJHJlc29sdmU7CiAgICAgICAgcmVqZWN0ID0gJCRyZWplY3Q7CiAgICAgIH0pOwogICAgICB0aGlzLnJlc29sdmUgPSBhRnVuY3Rpb24ocmVzb2x2ZSk7CiAgICAgIHRoaXMucmVqZWN0ID0gYUZ1bmN0aW9uKHJlamVjdCk7CiAgICB9OwogICAgbW9kdWxlLmV4cG9ydHMuZiA9IGZ1bmN0aW9uIChDKSB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZUNhcGFiaWxpdHkoQyk7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAxMjMgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgZ2xvYmFsID0gX193X3BkZmpzX3JlcXVpcmVfXyg2KTsKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgdmFyIGNvbnNvbGUgPSBnbG9iYWwuY29uc29sZTsKICAgICAgaWYgKGNvbnNvbGUgJiYgY29uc29sZS5lcnJvcikgewogICAgICAgIGFyZ3VtZW50cy5sZW5ndGggPT09IDEgPyBjb25zb2xlLmVycm9yKGEpIDogY29uc29sZS5lcnJvcihhLCBiKTsKICAgICAgfQogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogMTI0ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoZXhlYykgewogICAgICB0cnkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBlcnJvcjogZmFsc2UsCiAgICAgICAgICB2YWx1ZTogZXhlYygpCiAgICAgICAgfTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgZXJyb3I6IHRydWUsCiAgICAgICAgICB2YWx1ZTogZXJyb3IKICAgICAgICB9OwogICAgICB9CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAxMjUgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgZ2xvYmFsID0gX193X3BkZmpzX3JlcXVpcmVfXyg2KTsKICAgIHZhciB1c2VyQWdlbnQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDExOSk7CiAgICB2YXIgcHJvY2VzcyA9IGdsb2JhbC5wcm9jZXNzOwogICAgdmFyIHZlcnNpb25zID0gcHJvY2VzcyAmJiBwcm9jZXNzLnZlcnNpb25zOwogICAgdmFyIHY4ID0gdmVyc2lvbnMgJiYgdmVyc2lvbnMudjg7CiAgICB2YXIgbWF0Y2gsIHZlcnNpb247CiAgICBpZiAodjgpIHsKICAgICAgbWF0Y2ggPSB2OC5zcGxpdCgnLicpOwogICAgICB2ZXJzaW9uID0gbWF0Y2hbMF0gKyBtYXRjaFsxXTsKICAgIH0gZWxzZSBpZiAodXNlckFnZW50KSB7CiAgICAgIG1hdGNoID0gdXNlckFnZW50Lm1hdGNoKC9FZGdlXC8oXGQrKS8pOwogICAgICBpZiAoIW1hdGNoIHx8IG1hdGNoWzFdID49IDc0KSB7CiAgICAgICAgbWF0Y2ggPSB1c2VyQWdlbnQubWF0Y2goL0Nocm9tZVwvKFxkKykvKTsKICAgICAgICBpZiAobWF0Y2gpCiAgICAgICAgdmVyc2lvbiA9IG1hdGNoWzFdOwogICAgICB9CiAgICB9CiAgICBtb2R1bGUuZXhwb3J0cyA9IHZlcnNpb24gJiYgK3ZlcnNpb247CgogICAgLyoqKi99KSwgKAogIC8qIDEyNiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgJCA9IF9fd19wZGZqc19yZXF1aXJlX18oNSk7CiAgICB2YXIgYUZ1bmN0aW9uID0gX193X3BkZmpzX3JlcXVpcmVfXyg1OSk7CiAgICB2YXIgbmV3UHJvbWlzZUNhcGFiaWxpdHlNb2R1bGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEyMik7CiAgICB2YXIgcGVyZm9ybSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTI0KTsKICAgIHZhciBpdGVyYXRlID0gX193X3BkZmpzX3JlcXVpcmVfXygxMTUpOwogICAgJCh7CiAgICAgIHRhcmdldDogJ1Byb21pc2UnLAogICAgICBzdGF0OiB0cnVlCiAgICB9LCB7CiAgICAgIGFsbFNldHRsZWQ6IGZ1bmN0aW9uIGFsbFNldHRsZWQoaXRlcmFibGUpIHsKICAgICAgICB2YXIgQyA9IHRoaXM7CiAgICAgICAgdmFyIGNhcGFiaWxpdHkgPSBuZXdQcm9taXNlQ2FwYWJpbGl0eU1vZHVsZS5mKEMpOwogICAgICAgIHZhciByZXNvbHZlID0gY2FwYWJpbGl0eS5yZXNvbHZlOwogICAgICAgIHZhciByZWplY3QgPSBjYXBhYmlsaXR5LnJlamVjdDsKICAgICAgICB2YXIgcmVzdWx0ID0gcGVyZm9ybShmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgcHJvbWlzZVJlc29sdmUgPSBhRnVuY3Rpb24oQy5yZXNvbHZlKTsKICAgICAgICAgIHZhciB2YWx1ZXMgPSBbXTsKICAgICAgICAgIHZhciBjb3VudGVyID0gMDsKICAgICAgICAgIHZhciByZW1haW5pbmcgPSAxOwogICAgICAgICAgaXRlcmF0ZShpdGVyYWJsZSwgZnVuY3Rpb24gKHByb21pc2UpIHsKICAgICAgICAgICAgdmFyIGluZGV4ID0gY291bnRlcisrOwogICAgICAgICAgICB2YXIgYWxyZWFkeUNhbGxlZCA9IGZhbHNlOwogICAgICAgICAgICB2YWx1ZXMucHVzaCh1bmRlZmluZWQpOwogICAgICAgICAgICByZW1haW5pbmcrKzsKICAgICAgICAgICAgcHJvbWlzZVJlc29sdmUuY2FsbChDLCBwcm9taXNlKS50aGVuKGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgICAgICAgIGlmIChhbHJlYWR5Q2FsbGVkKQogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICBhbHJlYWR5Q2FsbGVkID0gdHJ1ZTsKICAgICAgICAgICAgICB2YWx1ZXNbaW5kZXhdID0gewogICAgICAgICAgICAgICAgc3RhdHVzOiAnZnVsZmlsbGVkJywKICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgLS1yZW1haW5pbmcgfHwgcmVzb2x2ZSh2YWx1ZXMpOwogICAgICAgICAgICB9LCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIGlmIChhbHJlYWR5Q2FsbGVkKQogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICBhbHJlYWR5Q2FsbGVkID0gdHJ1ZTsKICAgICAgICAgICAgICB2YWx1ZXNbaW5kZXhdID0gewogICAgICAgICAgICAgICAgc3RhdHVzOiAncmVqZWN0ZWQnLAogICAgICAgICAgICAgICAgcmVhc29uOiBlCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAtLXJlbWFpbmluZyB8fCByZXNvbHZlKHZhbHVlcyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgICAtLXJlbWFpbmluZyB8fCByZXNvbHZlKHZhbHVlcyk7CiAgICAgICAgfSk7CiAgICAgICAgaWYgKHJlc3VsdC5lcnJvcikKICAgICAgICByZWplY3QocmVzdWx0LnZhbHVlKTsKICAgICAgICByZXR1cm4gY2FwYWJpbGl0eS5wcm9taXNlOwogICAgICB9CiAgICB9KTsKCiAgICAvKioqL30pLCAoCiAgLyogMTI3ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciAkID0gX193X3BkZmpzX3JlcXVpcmVfXyg1KTsKICAgIHZhciBJU19QVVJFID0gX193X3BkZmpzX3JlcXVpcmVfXygzMik7CiAgICB2YXIgTmF0aXZlUHJvbWlzZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTExKTsKICAgIHZhciBmYWlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oOSk7CiAgICB2YXIgZ2V0QnVpbHRJbiA9IF9fd19wZGZqc19yZXF1aXJlX18oMzcpOwogICAgdmFyIHNwZWNpZXNDb25zdHJ1Y3RvciA9IF9fd19wZGZqc19yZXF1aXJlX18oMTE2KTsKICAgIHZhciBwcm9taXNlUmVzb2x2ZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTIxKTsKICAgIHZhciByZWRlZmluZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjQpOwogICAgdmFyIE5PTl9HRU5FUklDID0gISFOYXRpdmVQcm9taXNlICYmIGZhaWxzKGZ1bmN0aW9uICgpIHsKICAgICAgTmF0aXZlUHJvbWlzZS5wcm90b3R5cGVbJ2ZpbmFsbHknXS5jYWxsKHsKICAgICAgICB0aGVuOiBmdW5jdGlvbiB0aGVuKCkgewogICAgICAgIH0KICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICB9KTsKICAgIH0pOwogICAgJCh7CiAgICAgIHRhcmdldDogJ1Byb21pc2UnLAogICAgICBwcm90bzogdHJ1ZSwKICAgICAgcmVhbDogdHJ1ZSwKICAgICAgZm9yY2VkOiBOT05fR0VORVJJQwogICAgfSwgewogICAgICAnZmluYWxseSc6IGZ1bmN0aW9uIF9maW5hbGx5KG9uRmluYWxseSkgewogICAgICAgIHZhciBDID0gc3BlY2llc0NvbnN0cnVjdG9yKHRoaXMsIGdldEJ1aWx0SW4oJ1Byb21pc2UnKSk7CiAgICAgICAgdmFyIGlzRnVuY3Rpb24gPSB0eXBlb2Ygb25GaW5hbGx5ID09ICdmdW5jdGlvbic7CiAgICAgICAgcmV0dXJuIHRoaXMudGhlbihpc0Z1bmN0aW9uID8gZnVuY3Rpb24gKHgpIHsKICAgICAgICAgIHJldHVybiBwcm9taXNlUmVzb2x2ZShDLCBvbkZpbmFsbHkoKSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiB4OwogICAgICAgICAgfSk7CiAgICAgICAgfSA6IG9uRmluYWxseSwgaXNGdW5jdGlvbiA/IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlc29sdmUoQywgb25GaW5hbGx5KCkpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICB0aHJvdyBlOwogICAgICAgICAgfSk7CiAgICAgICAgfSA6IG9uRmluYWxseSk7CiAgICAgIH0KICAgIH0pOwogICAgaWYgKCFJU19QVVJFICYmIHR5cGVvZiBOYXRpdmVQcm9taXNlID09ICdmdW5jdGlvbicgJiYgIU5hdGl2ZVByb21pc2UucHJvdG90eXBlWydmaW5hbGx5J10pIHsKICAgICAgcmVkZWZpbmUoTmF0aXZlUHJvbWlzZS5wcm90b3R5cGUsICdmaW5hbGx5JywgZ2V0QnVpbHRJbignUHJvbWlzZScpLnByb3RvdHlwZVsnZmluYWxseSddKTsKICAgIH0KCiAgICAvKioqL30pLCAoCiAgLyogMTI4ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgX193X3BkZmpzX3JlcXVpcmVfXygxMjkpOwogICAgX193X3BkZmpzX3JlcXVpcmVfXygxMzQpOwogICAgX193X3BkZmpzX3JlcXVpcmVfXygxMzIpOwogICAgdmFyIHBhdGggPSBfX3dfcGRmanNfcmVxdWlyZV9fKDM4KTsKICAgIG1vZHVsZS5leHBvcnRzID0gcGF0aC5VUkw7CgogICAgLyoqKi99KSwgKAogIC8qIDEyOSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDczKTsKICAgIHZhciAkID0gX193X3BkZmpzX3JlcXVpcmVfXyg1KTsKICAgIHZhciBERVNDUklQVE9SUyA9IF9fd19wZGZqc19yZXF1aXJlX18oOCk7CiAgICB2YXIgVVNFX05BVElWRV9VUkwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEzMCk7CiAgICB2YXIgZ2xvYmFsID0gX193X3BkZmpzX3JlcXVpcmVfXyg2KTsKICAgIHZhciBkZWZpbmVQcm9wZXJ0aWVzID0gX193X3BkZmpzX3JlcXVpcmVfXyg2OCk7CiAgICB2YXIgcmVkZWZpbmUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDI0KTsKICAgIHZhciBhbkluc3RhbmNlID0gX193X3BkZmpzX3JlcXVpcmVfXygxMTQpOwogICAgdmFyIGhhcyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTgpOwogICAgdmFyIGFzc2lnbiA9IF9fd19wZGZqc19yZXF1aXJlX18oOTYpOwogICAgdmFyIGFycmF5RnJvbSA9IF9fd19wZGZqc19yZXF1aXJlX18oODYpOwogICAgdmFyIGNvZGVBdCA9IF9fd19wZGZqc19yZXF1aXJlX18oNzQpLmNvZGVBdDsKICAgIHZhciB0b0FTQ0lJID0gX193X3BkZmpzX3JlcXVpcmVfXygxMzEpOwogICAgdmFyIHNldFRvU3RyaW5nVGFnID0gX193X3BkZmpzX3JlcXVpcmVfXyg4MSk7CiAgICB2YXIgVVJMU2VhcmNoUGFyYW1zTW9kdWxlID0gX193X3BkZmpzX3JlcXVpcmVfXygxMzIpOwogICAgdmFyIEludGVybmFsU3RhdGVNb2R1bGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDI4KTsKICAgIHZhciBOYXRpdmVVUkwgPSBnbG9iYWwuVVJMOwogICAgdmFyIFVSTFNlYXJjaFBhcmFtcyA9IFVSTFNlYXJjaFBhcmFtc01vZHVsZS5VUkxTZWFyY2hQYXJhbXM7CiAgICB2YXIgZ2V0SW50ZXJuYWxTZWFyY2hQYXJhbXNTdGF0ZSA9IFVSTFNlYXJjaFBhcmFtc01vZHVsZS5nZXRTdGF0ZTsKICAgIHZhciBzZXRJbnRlcm5hbFN0YXRlID0gSW50ZXJuYWxTdGF0ZU1vZHVsZS5zZXQ7CiAgICB2YXIgZ2V0SW50ZXJuYWxVUkxTdGF0ZSA9IEludGVybmFsU3RhdGVNb2R1bGUuZ2V0dGVyRm9yKCdVUkwnKTsKICAgIHZhciBmbG9vciA9IE1hdGguZmxvb3I7CiAgICB2YXIgcG93ID0gTWF0aC5wb3c7CiAgICB2YXIgSU5WQUxJRF9BVVRIT1JJVFkgPSAnSW52YWxpZCBhdXRob3JpdHknOwogICAgdmFyIElOVkFMSURfU0NIRU1FID0gJ0ludmFsaWQgc2NoZW1lJzsKICAgIHZhciBJTlZBTElEX0hPU1QgPSAnSW52YWxpZCBob3N0JzsKICAgIHZhciBJTlZBTElEX1BPUlQgPSAnSW52YWxpZCBwb3J0JzsKICAgIHZhciBBTFBIQSA9IC9bQS1aYS16XS87CiAgICB2YXIgQUxQSEFOVU1FUklDID0gL1tcZCtcLS5BLVphLXpdLzsKICAgIHZhciBESUdJVCA9IC9cZC87CiAgICB2YXIgSEVYX1NUQVJUID0gL14oMHh8MFgpLzsKICAgIHZhciBPQ1QgPSAvXlswLTddKyQvOwogICAgdmFyIERFQyA9IC9eXGQrJC87CiAgICB2YXIgSEVYID0gL15bXGRBLUZhLWZdKyQvOwogICAgdmFyIEZPUkJJRERFTl9IT1NUX0NPREVfUE9JTlQgPSAvW1x1MDAwMFx1MDAwOVx1MDAwQVx1MDAwRCAjJS86P0BbXFxdXS87CiAgICB2YXIgRk9SQklEREVOX0hPU1RfQ09ERV9QT0lOVF9FWENMVURJTkdfUEVSQ0VOVCA9IC9bXHUwMDAwXHUwMDA5XHUwMDBBXHUwMDBEICMvOj9AW1xcXV0vOwogICAgdmFyIExFQURJTkdfQU5EX1RSQUlMSU5HX0MwX0NPTlRST0xfT1JfU1BBQ0UgPSAvXltcdTAwMDAtXHUwMDFGIF0rfFtcdTAwMDAtXHUwMDFGIF0rJC9nOwogICAgdmFyIFRBQl9BTkRfTkVXX0xJTkUgPSAvW1x1MDAwOVx1MDAwQVx1MDAwRF0vZzsKICAgIHZhciBFT0Y7CiAgICB2YXIgcGFyc2VIb3N0ID0gZnVuY3Rpb24gcGFyc2VIb3N0KHVybCwgaW5wdXQpIHsKICAgICAgdmFyIHJlc3VsdCwgY29kZVBvaW50cywgaW5kZXg7CiAgICAgIGlmIChpbnB1dC5jaGFyQXQoMCkgPT0gJ1snKSB7CiAgICAgICAgaWYgKGlucHV0LmNoYXJBdChpbnB1dC5sZW5ndGggLSAxKSAhPSAnXScpCiAgICAgICAgcmV0dXJuIElOVkFMSURfSE9TVDsKICAgICAgICByZXN1bHQgPSBwYXJzZUlQdjYoaW5wdXQuc2xpY2UoMSwgLTEpKTsKICAgICAgICBpZiAoIXJlc3VsdCkKICAgICAgICByZXR1cm4gSU5WQUxJRF9IT1NUOwogICAgICAgIHVybC5ob3N0ID0gcmVzdWx0OwogICAgICB9IGVsc2UgaWYgKCFpc1NwZWNpYWwodXJsKSkgewogICAgICAgIGlmIChGT1JCSURERU5fSE9TVF9DT0RFX1BPSU5UX0VYQ0xVRElOR19QRVJDRU5ULnRlc3QoaW5wdXQpKQogICAgICAgIHJldHVybiBJTlZBTElEX0hPU1Q7CiAgICAgICAgcmVzdWx0ID0gJyc7CiAgICAgICAgY29kZVBvaW50cyA9IGFycmF5RnJvbShpbnB1dCk7CiAgICAgICAgZm9yIChpbmRleCA9IDA7IGluZGV4IDwgY29kZVBvaW50cy5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgIHJlc3VsdCArPSBwZXJjZW50RW5jb2RlKGNvZGVQb2ludHNbaW5kZXhdLCBDMENvbnRyb2xQZXJjZW50RW5jb2RlU2V0KTsKICAgICAgICB9CiAgICAgICAgdXJsLmhvc3QgPSByZXN1bHQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaW5wdXQgPSB0b0FTQ0lJKGlucHV0KTsKICAgICAgICBpZiAoRk9SQklEREVOX0hPU1RfQ09ERV9QT0lOVC50ZXN0KGlucHV0KSkKICAgICAgICByZXR1cm4gSU5WQUxJRF9IT1NUOwogICAgICAgIHJlc3VsdCA9IHBhcnNlSVB2NChpbnB1dCk7CiAgICAgICAgaWYgKHJlc3VsdCA9PT0gbnVsbCkKICAgICAgICByZXR1cm4gSU5WQUxJRF9IT1NUOwogICAgICAgIHVybC5ob3N0ID0gcmVzdWx0OwogICAgICB9CiAgICB9OwogICAgdmFyIHBhcnNlSVB2NCA9IGZ1bmN0aW9uIHBhcnNlSVB2NChpbnB1dCkgewogICAgICB2YXIgcGFydHMgPSBpbnB1dC5zcGxpdCgnLicpOwogICAgICB2YXIgcGFydHNMZW5ndGgsIG51bWJlcnMsIGluZGV4LCBwYXJ0LCByYWRpeCwgbnVtYmVyLCBpcHY0OwogICAgICBpZiAocGFydHMubGVuZ3RoICYmIHBhcnRzW3BhcnRzLmxlbmd0aCAtIDFdID09ICcnKSB7CiAgICAgICAgcGFydHMucG9wKCk7CiAgICAgIH0KICAgICAgcGFydHNMZW5ndGggPSBwYXJ0cy5sZW5ndGg7CiAgICAgIGlmIChwYXJ0c0xlbmd0aCA+IDQpCiAgICAgIHJldHVybiBpbnB1dDsKICAgICAgbnVtYmVycyA9IFtdOwogICAgICBmb3IgKGluZGV4ID0gMDsgaW5kZXggPCBwYXJ0c0xlbmd0aDsgaW5kZXgrKykgewogICAgICAgIHBhcnQgPSBwYXJ0c1tpbmRleF07CiAgICAgICAgaWYgKHBhcnQgPT0gJycpCiAgICAgICAgcmV0dXJuIGlucHV0OwogICAgICAgIHJhZGl4ID0gMTA7CiAgICAgICAgaWYgKHBhcnQubGVuZ3RoID4gMSAmJiBwYXJ0LmNoYXJBdCgwKSA9PSAnMCcpIHsKICAgICAgICAgIHJhZGl4ID0gSEVYX1NUQVJULnRlc3QocGFydCkgPyAxNiA6IDg7CiAgICAgICAgICBwYXJ0ID0gcGFydC5zbGljZShyYWRpeCA9PSA4ID8gMSA6IDIpOwogICAgICAgIH0KICAgICAgICBpZiAocGFydCA9PT0gJycpIHsKICAgICAgICAgIG51bWJlciA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmICghKHJhZGl4ID09IDEwID8gREVDIDogcmFkaXggPT0gOCA/IE9DVCA6IEhFWCkudGVzdChwYXJ0KSkKICAgICAgICAgIHJldHVybiBpbnB1dDsKICAgICAgICAgIG51bWJlciA9IHBhcnNlSW50KHBhcnQsIHJhZGl4KTsKICAgICAgICB9CiAgICAgICAgbnVtYmVycy5wdXNoKG51bWJlcik7CiAgICAgIH0KICAgICAgZm9yIChpbmRleCA9IDA7IGluZGV4IDwgcGFydHNMZW5ndGg7IGluZGV4KyspIHsKICAgICAgICBudW1iZXIgPSBudW1iZXJzW2luZGV4XTsKICAgICAgICBpZiAoaW5kZXggPT0gcGFydHNMZW5ndGggLSAxKSB7CiAgICAgICAgICBpZiAobnVtYmVyID49IHBvdygyNTYsIDUgLSBwYXJ0c0xlbmd0aCkpCiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9IGVsc2UgaWYgKG51bWJlciA+IDI1NSkKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBpcHY0ID0gbnVtYmVycy5wb3AoKTsKICAgICAgZm9yIChpbmRleCA9IDA7IGluZGV4IDwgbnVtYmVycy5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICBpcHY0ICs9IG51bWJlcnNbaW5kZXhdICogcG93KDI1NiwgMyAtIGluZGV4KTsKICAgICAgfQogICAgICByZXR1cm4gaXB2NDsKICAgIH07CiAgICB2YXIgcGFyc2VJUHY2ID0gZnVuY3Rpb24gcGFyc2VJUHY2KGlucHV0KSB7CiAgICAgIHZhciBhZGRyZXNzID0gWwogICAgICAwLAogICAgICAwLAogICAgICAwLAogICAgICAwLAogICAgICAwLAogICAgICAwLAogICAgICAwLAogICAgICAwXTsKCiAgICAgIHZhciBwaWVjZUluZGV4ID0gMDsKICAgICAgdmFyIGNvbXByZXNzID0gbnVsbDsKICAgICAgdmFyIHBvaW50ZXIgPSAwOwogICAgICB2YXIgdmFsdWUsIGxlbmd0aCwgbnVtYmVyc1NlZW4sIGlwdjRQaWVjZSwgbnVtYmVyLCBzd2Fwcywgc3dhcDsKICAgICAgdmFyIGNoYXIgPSBmdW5jdGlvbiBjaGFyKCkgewogICAgICAgIHJldHVybiBpbnB1dC5jaGFyQXQocG9pbnRlcik7CiAgICAgIH07CiAgICAgIGlmIChjaGFyKCkgPT0gJzonKSB7CiAgICAgICAgaWYgKGlucHV0LmNoYXJBdCgxKSAhPSAnOicpCiAgICAgICAgcmV0dXJuOwogICAgICAgIHBvaW50ZXIgKz0gMjsKICAgICAgICBwaWVjZUluZGV4Kys7CiAgICAgICAgY29tcHJlc3MgPSBwaWVjZUluZGV4OwogICAgICB9CiAgICAgIHdoaWxlIChjaGFyKCkpIHsKICAgICAgICBpZiAocGllY2VJbmRleCA9PSA4KQogICAgICAgIHJldHVybjsKICAgICAgICBpZiAoY2hhcigpID09ICc6JykgewogICAgICAgICAgaWYgKGNvbXByZXNzICE9PSBudWxsKQogICAgICAgICAgcmV0dXJuOwogICAgICAgICAgcG9pbnRlcisrOwogICAgICAgICAgcGllY2VJbmRleCsrOwogICAgICAgICAgY29tcHJlc3MgPSBwaWVjZUluZGV4OwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIHZhbHVlID0gbGVuZ3RoID0gMDsKICAgICAgICB3aGlsZSAobGVuZ3RoIDwgNCAmJiBIRVgudGVzdChjaGFyKCkpKSB7CiAgICAgICAgICB2YWx1ZSA9IHZhbHVlICogMTYgKyBwYXJzZUludChjaGFyKCksIDE2KTsKICAgICAgICAgIHBvaW50ZXIrKzsKICAgICAgICAgIGxlbmd0aCsrOwogICAgICAgIH0KICAgICAgICBpZiAoY2hhcigpID09ICcuJykgewogICAgICAgICAgaWYgKGxlbmd0aCA9PSAwKQogICAgICAgICAgcmV0dXJuOwogICAgICAgICAgcG9pbnRlciAtPSBsZW5ndGg7CiAgICAgICAgICBpZiAocGllY2VJbmRleCA+IDYpCiAgICAgICAgICByZXR1cm47CiAgICAgICAgICBudW1iZXJzU2VlbiA9IDA7CiAgICAgICAgICB3aGlsZSAoY2hhcigpKSB7CiAgICAgICAgICAgIGlwdjRQaWVjZSA9IG51bGw7CiAgICAgICAgICAgIGlmIChudW1iZXJzU2VlbiA+IDApIHsKICAgICAgICAgICAgICBpZiAoY2hhcigpID09ICcuJyAmJiBudW1iZXJzU2VlbiA8IDQpCiAgICAgICAgICAgICAgcG9pbnRlcisrO2Vsc2UKCiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghRElHSVQudGVzdChjaGFyKCkpKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIHdoaWxlIChESUdJVC50ZXN0KGNoYXIoKSkpIHsKICAgICAgICAgICAgICBudW1iZXIgPSBwYXJzZUludChjaGFyKCksIDEwKTsKICAgICAgICAgICAgICBpZiAoaXB2NFBpZWNlID09PSBudWxsKQogICAgICAgICAgICAgIGlwdjRQaWVjZSA9IG51bWJlcjtlbHNlCiAgICAgICAgICAgICAgaWYgKGlwdjRQaWVjZSA9PSAwKQogICAgICAgICAgICAgIHJldHVybjtlbHNlCgogICAgICAgICAgICAgIGlwdjRQaWVjZSA9IGlwdjRQaWVjZSAqIDEwICsgbnVtYmVyOwogICAgICAgICAgICAgIGlmIChpcHY0UGllY2UgPiAyNTUpCiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIHBvaW50ZXIrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICBhZGRyZXNzW3BpZWNlSW5kZXhdID0gYWRkcmVzc1twaWVjZUluZGV4XSAqIDI1NiArIGlwdjRQaWVjZTsKICAgICAgICAgICAgbnVtYmVyc1NlZW4rKzsKICAgICAgICAgICAgaWYgKG51bWJlcnNTZWVuID09IDIgfHwgbnVtYmVyc1NlZW4gPT0gNCkKICAgICAgICAgICAgcGllY2VJbmRleCsrOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG51bWJlcnNTZWVuICE9IDQpCiAgICAgICAgICByZXR1cm47CiAgICAgICAgICBicmVhazsKICAgICAgICB9IGVsc2UgaWYgKGNoYXIoKSA9PSAnOicpIHsKICAgICAgICAgIHBvaW50ZXIrKzsKICAgICAgICAgIGlmICghY2hhcigpKQogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gZWxzZSBpZiAoY2hhcigpKQogICAgICAgIHJldHVybjsKICAgICAgICBhZGRyZXNzW3BpZWNlSW5kZXgrK10gPSB2YWx1ZTsKICAgICAgfQogICAgICBpZiAoY29tcHJlc3MgIT09IG51bGwpIHsKICAgICAgICBzd2FwcyA9IHBpZWNlSW5kZXggLSBjb21wcmVzczsKICAgICAgICBwaWVjZUluZGV4ID0gNzsKICAgICAgICB3aGlsZSAocGllY2VJbmRleCAhPSAwICYmIHN3YXBzID4gMCkgewogICAgICAgICAgc3dhcCA9IGFkZHJlc3NbcGllY2VJbmRleF07CiAgICAgICAgICBhZGRyZXNzW3BpZWNlSW5kZXgtLV0gPSBhZGRyZXNzW2NvbXByZXNzICsgc3dhcHMgLSAxXTsKICAgICAgICAgIGFkZHJlc3NbY29tcHJlc3MgKyAtLXN3YXBzXSA9IHN3YXA7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHBpZWNlSW5kZXggIT0gOCkKICAgICAgcmV0dXJuOwogICAgICByZXR1cm4gYWRkcmVzczsKICAgIH07CiAgICB2YXIgZmluZExvbmdlc3RaZXJvU2VxdWVuY2UgPSBmdW5jdGlvbiBmaW5kTG9uZ2VzdFplcm9TZXF1ZW5jZShpcHY2KSB7CiAgICAgIHZhciBtYXhJbmRleCA9IG51bGw7CiAgICAgIHZhciBtYXhMZW5ndGggPSAxOwogICAgICB2YXIgY3VyclN0YXJ0ID0gbnVsbDsKICAgICAgdmFyIGN1cnJMZW5ndGggPSAwOwogICAgICB2YXIgaW5kZXggPSAwOwogICAgICBmb3IgKDsgaW5kZXggPCA4OyBpbmRleCsrKSB7CiAgICAgICAgaWYgKGlwdjZbaW5kZXhdICE9PSAwKSB7CiAgICAgICAgICBpZiAoY3Vyckxlbmd0aCA+IG1heExlbmd0aCkgewogICAgICAgICAgICBtYXhJbmRleCA9IGN1cnJTdGFydDsKICAgICAgICAgICAgbWF4TGVuZ3RoID0gY3Vyckxlbmd0aDsKICAgICAgICAgIH0KICAgICAgICAgIGN1cnJTdGFydCA9IG51bGw7CiAgICAgICAgICBjdXJyTGVuZ3RoID0gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKGN1cnJTdGFydCA9PT0gbnVsbCkKICAgICAgICAgIGN1cnJTdGFydCA9IGluZGV4OwogICAgICAgICAgKytjdXJyTGVuZ3RoOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoY3Vyckxlbmd0aCA+IG1heExlbmd0aCkgewogICAgICAgIG1heEluZGV4ID0gY3VyclN0YXJ0OwogICAgICAgIG1heExlbmd0aCA9IGN1cnJMZW5ndGg7CiAgICAgIH0KICAgICAgcmV0dXJuIG1heEluZGV4OwogICAgfTsKICAgIHZhciBzZXJpYWxpemVIb3N0ID0gZnVuY3Rpb24gc2VyaWFsaXplSG9zdChob3N0KSB7CiAgICAgIHZhciByZXN1bHQsIGluZGV4LCBjb21wcmVzcywgaWdub3JlMDsKICAgICAgaWYgKHR5cGVvZiBob3N0ID09ICdudW1iZXInKSB7CiAgICAgICAgcmVzdWx0ID0gW107CiAgICAgICAgZm9yIChpbmRleCA9IDA7IGluZGV4IDwgNDsgaW5kZXgrKykgewogICAgICAgICAgcmVzdWx0LnVuc2hpZnQoaG9zdCAlIDI1Nik7CiAgICAgICAgICBob3N0ID0gZmxvb3IoaG9zdCAvIDI1Nik7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQuam9pbignLicpOwogICAgICB9IGVsc2UgaWYgKHR5cGVvZiBob3N0ID09ICdvYmplY3QnKSB7CiAgICAgICAgcmVzdWx0ID0gJyc7CiAgICAgICAgY29tcHJlc3MgPSBmaW5kTG9uZ2VzdFplcm9TZXF1ZW5jZShob3N0KTsKICAgICAgICBmb3IgKGluZGV4ID0gMDsgaW5kZXggPCA4OyBpbmRleCsrKSB7CiAgICAgICAgICBpZiAoaWdub3JlMCAmJiBob3N0W2luZGV4XSA9PT0gMCkKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgaWYgKGlnbm9yZTApCiAgICAgICAgICBpZ25vcmUwID0gZmFsc2U7CiAgICAgICAgICBpZiAoY29tcHJlc3MgPT09IGluZGV4KSB7CiAgICAgICAgICAgIHJlc3VsdCArPSBpbmRleCA/ICc6JyA6ICc6Oic7CiAgICAgICAgICAgIGlnbm9yZTAgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVzdWx0ICs9IGhvc3RbaW5kZXhdLnRvU3RyaW5nKDE2KTsKICAgICAgICAgICAgaWYgKGluZGV4IDwgNykKICAgICAgICAgICAgcmVzdWx0ICs9ICc6JzsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuICdbJyArIHJlc3VsdCArICddJzsKICAgICAgfQogICAgICByZXR1cm4gaG9zdDsKICAgIH07CiAgICB2YXIgQzBDb250cm9sUGVyY2VudEVuY29kZVNldCA9IHt9OwogICAgdmFyIGZyYWdtZW50UGVyY2VudEVuY29kZVNldCA9IGFzc2lnbih7fSwgQzBDb250cm9sUGVyY2VudEVuY29kZVNldCwgewogICAgICAnICc6IDEsCiAgICAgICciJzogMSwKICAgICAgJzwnOiAxLAogICAgICAnPic6IDEsCiAgICAgICdgJzogMQogICAgfSk7CiAgICB2YXIgcGF0aFBlcmNlbnRFbmNvZGVTZXQgPSBhc3NpZ24oe30sIGZyYWdtZW50UGVyY2VudEVuY29kZVNldCwgewogICAgICAnIyc6IDEsCiAgICAgICc/JzogMSwKICAgICAgJ3snOiAxLAogICAgICAnfSc6IDEKICAgIH0pOwogICAgdmFyIHVzZXJpbmZvUGVyY2VudEVuY29kZVNldCA9IGFzc2lnbih7fSwgcGF0aFBlcmNlbnRFbmNvZGVTZXQsIHsKICAgICAgJy8nOiAxLAogICAgICAnOic6IDEsCiAgICAgICc7JzogMSwKICAgICAgJz0nOiAxLAogICAgICAnQCc6IDEsCiAgICAgICdbJzogMSwKICAgICAgJ1xcJzogMSwKICAgICAgJ10nOiAxLAogICAgICAnXic6IDEsCiAgICAgICd8JzogMQogICAgfSk7CiAgICB2YXIgcGVyY2VudEVuY29kZSA9IGZ1bmN0aW9uIHBlcmNlbnRFbmNvZGUoY2hhciwgc2V0KSB7CiAgICAgIHZhciBjb2RlID0gY29kZUF0KGNoYXIsIDApOwogICAgICByZXR1cm4gY29kZSA+IDB4MjAgJiYgY29kZSA8IDB4N0YgJiYgIWhhcyhzZXQsIGNoYXIpID8gY2hhciA6IGVuY29kZVVSSUNvbXBvbmVudChjaGFyKTsKICAgIH07CiAgICB2YXIgc3BlY2lhbFNjaGVtZXMgPSB7CiAgICAgIGZ0cDogMjEsCiAgICAgIGZpbGU6IG51bGwsCiAgICAgIGh0dHA6IDgwLAogICAgICBodHRwczogNDQzLAogICAgICB3czogODAsCiAgICAgIHdzczogNDQzCiAgICB9OwogICAgdmFyIGlzU3BlY2lhbCA9IGZ1bmN0aW9uIGlzU3BlY2lhbCh1cmwpIHsKICAgICAgcmV0dXJuIGhhcyhzcGVjaWFsU2NoZW1lcywgdXJsLnNjaGVtZSk7CiAgICB9OwogICAgdmFyIGluY2x1ZGVzQ3JlZGVudGlhbHMgPSBmdW5jdGlvbiBpbmNsdWRlc0NyZWRlbnRpYWxzKHVybCkgewogICAgICByZXR1cm4gdXJsLnVzZXJuYW1lICE9ICcnIHx8IHVybC5wYXNzd29yZCAhPSAnJzsKICAgIH07CiAgICB2YXIgY2Fubm90SGF2ZVVzZXJuYW1lUGFzc3dvcmRQb3J0ID0gZnVuY3Rpb24gY2Fubm90SGF2ZVVzZXJuYW1lUGFzc3dvcmRQb3J0KHVybCkgewogICAgICByZXR1cm4gIXVybC5ob3N0IHx8IHVybC5jYW5ub3RCZUFCYXNlVVJMIHx8IHVybC5zY2hlbWUgPT0gJ2ZpbGUnOwogICAgfTsKICAgIHZhciBpc1dpbmRvd3NEcml2ZUxldHRlciA9IGZ1bmN0aW9uIGlzV2luZG93c0RyaXZlTGV0dGVyKHN0cmluZywgbm9ybWFsaXplZCkgewogICAgICB2YXIgc2Vjb25kOwogICAgICByZXR1cm4gc3RyaW5nLmxlbmd0aCA9PSAyICYmIEFMUEhBLnRlc3Qoc3RyaW5nLmNoYXJBdCgwKSkgJiYgKChzZWNvbmQgPSBzdHJpbmcuY2hhckF0KDEpKSA9PSAnOicgfHwgIW5vcm1hbGl6ZWQgJiYgc2Vjb25kID09ICd8Jyk7CiAgICB9OwogICAgdmFyIHN0YXJ0c1dpdGhXaW5kb3dzRHJpdmVMZXR0ZXIgPSBmdW5jdGlvbiBzdGFydHNXaXRoV2luZG93c0RyaXZlTGV0dGVyKHN0cmluZykgewogICAgICB2YXIgdGhpcmQ7CiAgICAgIHJldHVybiBzdHJpbmcubGVuZ3RoID4gMSAmJiBpc1dpbmRvd3NEcml2ZUxldHRlcihzdHJpbmcuc2xpY2UoMCwgMikpICYmIChzdHJpbmcubGVuZ3RoID09IDIgfHwgKHRoaXJkID0gc3RyaW5nLmNoYXJBdCgyKSkgPT09ICcvJyB8fCB0aGlyZCA9PT0gJ1xcJyB8fCB0aGlyZCA9PT0gJz8nIHx8IHRoaXJkID09PSAnIycpOwogICAgfTsKICAgIHZhciBzaG9ydGVuVVJMc1BhdGggPSBmdW5jdGlvbiBzaG9ydGVuVVJMc1BhdGgodXJsKSB7CiAgICAgIHZhciBwYXRoID0gdXJsLnBhdGg7CiAgICAgIHZhciBwYXRoU2l6ZSA9IHBhdGgubGVuZ3RoOwogICAgICBpZiAocGF0aFNpemUgJiYgKHVybC5zY2hlbWUgIT0gJ2ZpbGUnIHx8IHBhdGhTaXplICE9IDEgfHwgIWlzV2luZG93c0RyaXZlTGV0dGVyKHBhdGhbMF0sIHRydWUpKSkgewogICAgICAgIHBhdGgucG9wKCk7CiAgICAgIH0KICAgIH07CiAgICB2YXIgaXNTaW5nbGVEb3QgPSBmdW5jdGlvbiBpc1NpbmdsZURvdChzZWdtZW50KSB7CiAgICAgIHJldHVybiBzZWdtZW50ID09PSAnLicgfHwgc2VnbWVudC50b0xvd2VyQ2FzZSgpID09PSAnJTJlJzsKICAgIH07CiAgICB2YXIgaXNEb3VibGVEb3QgPSBmdW5jdGlvbiBpc0RvdWJsZURvdChzZWdtZW50KSB7CiAgICAgIHNlZ21lbnQgPSBzZWdtZW50LnRvTG93ZXJDYXNlKCk7CiAgICAgIHJldHVybiBzZWdtZW50ID09PSAnLi4nIHx8IHNlZ21lbnQgPT09ICclMmUuJyB8fCBzZWdtZW50ID09PSAnLiUyZScgfHwgc2VnbWVudCA9PT0gJyUyZSUyZSc7CiAgICB9OwogICAgdmFyIFNDSEVNRV9TVEFSVCA9IHt9OwogICAgdmFyIFNDSEVNRSA9IHt9OwogICAgdmFyIE5PX1NDSEVNRSA9IHt9OwogICAgdmFyIFNQRUNJQUxfUkVMQVRJVkVfT1JfQVVUSE9SSVRZID0ge307CiAgICB2YXIgUEFUSF9PUl9BVVRIT1JJVFkgPSB7fTsKICAgIHZhciBSRUxBVElWRSA9IHt9OwogICAgdmFyIFJFTEFUSVZFX1NMQVNIID0ge307CiAgICB2YXIgU1BFQ0lBTF9BVVRIT1JJVFlfU0xBU0hFUyA9IHt9OwogICAgdmFyIFNQRUNJQUxfQVVUSE9SSVRZX0lHTk9SRV9TTEFTSEVTID0ge307CiAgICB2YXIgQVVUSE9SSVRZID0ge307CiAgICB2YXIgSE9TVCA9IHt9OwogICAgdmFyIEhPU1ROQU1FID0ge307CiAgICB2YXIgUE9SVCA9IHt9OwogICAgdmFyIEZJTEUgPSB7fTsKICAgIHZhciBGSUxFX1NMQVNIID0ge307CiAgICB2YXIgRklMRV9IT1NUID0ge307CiAgICB2YXIgUEFUSF9TVEFSVCA9IHt9OwogICAgdmFyIFBBVEggPSB7fTsKICAgIHZhciBDQU5OT1RfQkVfQV9CQVNFX1VSTF9QQVRIID0ge307CiAgICB2YXIgUVVFUlkgPSB7fTsKICAgIHZhciBGUkFHTUVOVCA9IHt9OwogICAgdmFyIHBhcnNlVVJMID0gZnVuY3Rpb24gcGFyc2VVUkwodXJsLCBpbnB1dCwgc3RhdGVPdmVycmlkZSwgYmFzZSkgewogICAgICB2YXIgc3RhdGUgPSBzdGF0ZU92ZXJyaWRlIHx8IFNDSEVNRV9TVEFSVDsKICAgICAgdmFyIHBvaW50ZXIgPSAwOwogICAgICB2YXIgYnVmZmVyID0gJyc7CiAgICAgIHZhciBzZWVuQXQgPSBmYWxzZTsKICAgICAgdmFyIHNlZW5CcmFja2V0ID0gZmFsc2U7CiAgICAgIHZhciBzZWVuUGFzc3dvcmRUb2tlbiA9IGZhbHNlOwogICAgICB2YXIgY29kZVBvaW50cywgY2hhciwgYnVmZmVyQ29kZVBvaW50cywgZmFpbHVyZTsKICAgICAgaWYgKCFzdGF0ZU92ZXJyaWRlKSB7CiAgICAgICAgdXJsLnNjaGVtZSA9ICcnOwogICAgICAgIHVybC51c2VybmFtZSA9ICcnOwogICAgICAgIHVybC5wYXNzd29yZCA9ICcnOwogICAgICAgIHVybC5ob3N0ID0gbnVsbDsKICAgICAgICB1cmwucG9ydCA9IG51bGw7CiAgICAgICAgdXJsLnBhdGggPSBbXTsKICAgICAgICB1cmwucXVlcnkgPSBudWxsOwogICAgICAgIHVybC5mcmFnbWVudCA9IG51bGw7CiAgICAgICAgdXJsLmNhbm5vdEJlQUJhc2VVUkwgPSBmYWxzZTsKICAgICAgICBpbnB1dCA9IGlucHV0LnJlcGxhY2UoTEVBRElOR19BTkRfVFJBSUxJTkdfQzBfQ09OVFJPTF9PUl9TUEFDRSwgJycpOwogICAgICB9CiAgICAgIGlucHV0ID0gaW5wdXQucmVwbGFjZShUQUJfQU5EX05FV19MSU5FLCAnJyk7CiAgICAgIGNvZGVQb2ludHMgPSBhcnJheUZyb20oaW5wdXQpOwogICAgICB3aGlsZSAocG9pbnRlciA8PSBjb2RlUG9pbnRzLmxlbmd0aCkgewogICAgICAgIGNoYXIgPSBjb2RlUG9pbnRzW3BvaW50ZXJdOwogICAgICAgIHN3aXRjaCAoc3RhdGUpIHsKICAgICAgICAgIGNhc2UgU0NIRU1FX1NUQVJUOgogICAgICAgICAgICBpZiAoY2hhciAmJiBBTFBIQS50ZXN0KGNoYXIpKSB7CiAgICAgICAgICAgICAgYnVmZmVyICs9IGNoYXIudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICBzdGF0ZSA9IFNDSEVNRTsKICAgICAgICAgICAgfSBlbHNlIGlmICghc3RhdGVPdmVycmlkZSkgewogICAgICAgICAgICAgIHN0YXRlID0gTk9fU0NIRU1FOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgcmV0dXJuIElOVkFMSURfU0NIRU1FOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgU0NIRU1FOgogICAgICAgICAgICBpZiAoY2hhciAmJiAoQUxQSEFOVU1FUklDLnRlc3QoY2hhcikgfHwgY2hhciA9PSAnKycgfHwgY2hhciA9PSAnLScgfHwgY2hhciA9PSAnLicpKSB7CiAgICAgICAgICAgICAgYnVmZmVyICs9IGNoYXIudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChjaGFyID09ICc6JykgewogICAgICAgICAgICAgIGlmIChzdGF0ZU92ZXJyaWRlICYmIChpc1NwZWNpYWwodXJsKSAhPSBoYXMoc3BlY2lhbFNjaGVtZXMsIGJ1ZmZlcikgfHwgYnVmZmVyID09ICdmaWxlJyAmJiAoaW5jbHVkZXNDcmVkZW50aWFscyh1cmwpIHx8IHVybC5wb3J0ICE9PSBudWxsKSB8fCB1cmwuc2NoZW1lID09ICdmaWxlJyAmJiAhdXJsLmhvc3QpKQogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB1cmwuc2NoZW1lID0gYnVmZmVyOwogICAgICAgICAgICAgIGlmIChzdGF0ZU92ZXJyaWRlKSB7CiAgICAgICAgICAgICAgICBpZiAoaXNTcGVjaWFsKHVybCkgJiYgc3BlY2lhbFNjaGVtZXNbdXJsLnNjaGVtZV0gPT0gdXJsLnBvcnQpCiAgICAgICAgICAgICAgICB1cmwucG9ydCA9IG51bGw7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJ1ZmZlciA9ICcnOwogICAgICAgICAgICAgIGlmICh1cmwuc2NoZW1lID09ICdmaWxlJykgewogICAgICAgICAgICAgICAgc3RhdGUgPSBGSUxFOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNTcGVjaWFsKHVybCkgJiYgYmFzZSAmJiBiYXNlLnNjaGVtZSA9PSB1cmwuc2NoZW1lKSB7CiAgICAgICAgICAgICAgICBzdGF0ZSA9IFNQRUNJQUxfUkVMQVRJVkVfT1JfQVVUSE9SSVRZOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNTcGVjaWFsKHVybCkpIHsKICAgICAgICAgICAgICAgIHN0YXRlID0gU1BFQ0lBTF9BVVRIT1JJVFlfU0xBU0hFUzsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvZGVQb2ludHNbcG9pbnRlciArIDFdID09ICcvJykgewogICAgICAgICAgICAgICAgc3RhdGUgPSBQQVRIX09SX0FVVEhPUklUWTsKICAgICAgICAgICAgICAgIHBvaW50ZXIrKzsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdXJsLmNhbm5vdEJlQUJhc2VVUkwgPSB0cnVlOwogICAgICAgICAgICAgICAgdXJsLnBhdGgucHVzaCgnJyk7CiAgICAgICAgICAgICAgICBzdGF0ZSA9IENBTk5PVF9CRV9BX0JBU0VfVVJMX1BBVEg7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKCFzdGF0ZU92ZXJyaWRlKSB7CiAgICAgICAgICAgICAgYnVmZmVyID0gJyc7CiAgICAgICAgICAgICAgc3RhdGUgPSBOT19TQ0hFTUU7CiAgICAgICAgICAgICAgcG9pbnRlciA9IDA7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICByZXR1cm4gSU5WQUxJRF9TQ0hFTUU7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBOT19TQ0hFTUU6CiAgICAgICAgICAgIGlmICghYmFzZSB8fCBiYXNlLmNhbm5vdEJlQUJhc2VVUkwgJiYgY2hhciAhPSAnIycpCiAgICAgICAgICAgIHJldHVybiBJTlZBTElEX1NDSEVNRTsKICAgICAgICAgICAgaWYgKGJhc2UuY2Fubm90QmVBQmFzZVVSTCAmJiBjaGFyID09ICcjJykgewogICAgICAgICAgICAgIHVybC5zY2hlbWUgPSBiYXNlLnNjaGVtZTsKICAgICAgICAgICAgICB1cmwucGF0aCA9IGJhc2UucGF0aC5zbGljZSgpOwogICAgICAgICAgICAgIHVybC5xdWVyeSA9IGJhc2UucXVlcnk7CiAgICAgICAgICAgICAgdXJsLmZyYWdtZW50ID0gJyc7CiAgICAgICAgICAgICAgdXJsLmNhbm5vdEJlQUJhc2VVUkwgPSB0cnVlOwogICAgICAgICAgICAgIHN0YXRlID0gRlJBR01FTlQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RhdGUgPSBiYXNlLnNjaGVtZSA9PSAnZmlsZScgPyBGSUxFIDogUkVMQVRJVkU7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgY2FzZSBTUEVDSUFMX1JFTEFUSVZFX09SX0FVVEhPUklUWToKICAgICAgICAgICAgaWYgKGNoYXIgPT0gJy8nICYmIGNvZGVQb2ludHNbcG9pbnRlciArIDFdID09ICcvJykgewogICAgICAgICAgICAgIHN0YXRlID0gU1BFQ0lBTF9BVVRIT1JJVFlfSUdOT1JFX1NMQVNIRVM7CiAgICAgICAgICAgICAgcG9pbnRlcisrOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHN0YXRlID0gUkVMQVRJVkU7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIFBBVEhfT1JfQVVUSE9SSVRZOgogICAgICAgICAgICBpZiAoY2hhciA9PSAnLycpIHsKICAgICAgICAgICAgICBzdGF0ZSA9IEFVVEhPUklUWTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBzdGF0ZSA9IFBBVEg7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIGNhc2UgUkVMQVRJVkU6CiAgICAgICAgICAgIHVybC5zY2hlbWUgPSBiYXNlLnNjaGVtZTsKICAgICAgICAgICAgaWYgKGNoYXIgPT0gRU9GKSB7CiAgICAgICAgICAgICAgdXJsLnVzZXJuYW1lID0gYmFzZS51c2VybmFtZTsKICAgICAgICAgICAgICB1cmwucGFzc3dvcmQgPSBiYXNlLnBhc3N3b3JkOwogICAgICAgICAgICAgIHVybC5ob3N0ID0gYmFzZS5ob3N0OwogICAgICAgICAgICAgIHVybC5wb3J0ID0gYmFzZS5wb3J0OwogICAgICAgICAgICAgIHVybC5wYXRoID0gYmFzZS5wYXRoLnNsaWNlKCk7CiAgICAgICAgICAgICAgdXJsLnF1ZXJ5ID0gYmFzZS5xdWVyeTsKICAgICAgICAgICAgfSBlbHNlIGlmIChjaGFyID09ICcvJyB8fCBjaGFyID09ICdcXCcgJiYgaXNTcGVjaWFsKHVybCkpIHsKICAgICAgICAgICAgICBzdGF0ZSA9IFJFTEFUSVZFX1NMQVNIOwogICAgICAgICAgICB9IGVsc2UgaWYgKGNoYXIgPT0gJz8nKSB7CiAgICAgICAgICAgICAgdXJsLnVzZXJuYW1lID0gYmFzZS51c2VybmFtZTsKICAgICAgICAgICAgICB1cmwucGFzc3dvcmQgPSBiYXNlLnBhc3N3b3JkOwogICAgICAgICAgICAgIHVybC5ob3N0ID0gYmFzZS5ob3N0OwogICAgICAgICAgICAgIHVybC5wb3J0ID0gYmFzZS5wb3J0OwogICAgICAgICAgICAgIHVybC5wYXRoID0gYmFzZS5wYXRoLnNsaWNlKCk7CiAgICAgICAgICAgICAgdXJsLnF1ZXJ5ID0gJyc7CiAgICAgICAgICAgICAgc3RhdGUgPSBRVUVSWTsKICAgICAgICAgICAgfSBlbHNlIGlmIChjaGFyID09ICcjJykgewogICAgICAgICAgICAgIHVybC51c2VybmFtZSA9IGJhc2UudXNlcm5hbWU7CiAgICAgICAgICAgICAgdXJsLnBhc3N3b3JkID0gYmFzZS5wYXNzd29yZDsKICAgICAgICAgICAgICB1cmwuaG9zdCA9IGJhc2UuaG9zdDsKICAgICAgICAgICAgICB1cmwucG9ydCA9IGJhc2UucG9ydDsKICAgICAgICAgICAgICB1cmwucGF0aCA9IGJhc2UucGF0aC5zbGljZSgpOwogICAgICAgICAgICAgIHVybC5xdWVyeSA9IGJhc2UucXVlcnk7CiAgICAgICAgICAgICAgdXJsLmZyYWdtZW50ID0gJyc7CiAgICAgICAgICAgICAgc3RhdGUgPSBGUkFHTUVOVDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB1cmwudXNlcm5hbWUgPSBiYXNlLnVzZXJuYW1lOwogICAgICAgICAgICAgIHVybC5wYXNzd29yZCA9IGJhc2UucGFzc3dvcmQ7CiAgICAgICAgICAgICAgdXJsLmhvc3QgPSBiYXNlLmhvc3Q7CiAgICAgICAgICAgICAgdXJsLnBvcnQgPSBiYXNlLnBvcnQ7CiAgICAgICAgICAgICAgdXJsLnBhdGggPSBiYXNlLnBhdGguc2xpY2UoKTsKICAgICAgICAgICAgICB1cmwucGF0aC5wb3AoKTsKICAgICAgICAgICAgICBzdGF0ZSA9IFBBVEg7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIFJFTEFUSVZFX1NMQVNIOgogICAgICAgICAgICBpZiAoaXNTcGVjaWFsKHVybCkgJiYgKGNoYXIgPT0gJy8nIHx8IGNoYXIgPT0gJ1xcJykpIHsKICAgICAgICAgICAgICBzdGF0ZSA9IFNQRUNJQUxfQVVUSE9SSVRZX0lHTk9SRV9TTEFTSEVTOwogICAgICAgICAgICB9IGVsc2UgaWYgKGNoYXIgPT0gJy8nKSB7CiAgICAgICAgICAgICAgc3RhdGUgPSBBVVRIT1JJVFk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdXJsLnVzZXJuYW1lID0gYmFzZS51c2VybmFtZTsKICAgICAgICAgICAgICB1cmwucGFzc3dvcmQgPSBiYXNlLnBhc3N3b3JkOwogICAgICAgICAgICAgIHVybC5ob3N0ID0gYmFzZS5ob3N0OwogICAgICAgICAgICAgIHVybC5wb3J0ID0gYmFzZS5wb3J0OwogICAgICAgICAgICAgIHN0YXRlID0gUEFUSDsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgU1BFQ0lBTF9BVVRIT1JJVFlfU0xBU0hFUzoKICAgICAgICAgICAgc3RhdGUgPSBTUEVDSUFMX0FVVEhPUklUWV9JR05PUkVfU0xBU0hFUzsKICAgICAgICAgICAgaWYgKGNoYXIgIT0gJy8nIHx8IGJ1ZmZlci5jaGFyQXQocG9pbnRlciArIDEpICE9ICcvJykKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIHBvaW50ZXIrKzsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIFNQRUNJQUxfQVVUSE9SSVRZX0lHTk9SRV9TTEFTSEVTOgogICAgICAgICAgICBpZiAoY2hhciAhPSAnLycgJiYgY2hhciAhPSAnXFwnKSB7CiAgICAgICAgICAgICAgc3RhdGUgPSBBVVRIT1JJVFk7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIEFVVEhPUklUWToKICAgICAgICAgICAgaWYgKGNoYXIgPT0gJ0AnKSB7CiAgICAgICAgICAgICAgaWYgKHNlZW5BdCkKICAgICAgICAgICAgICBidWZmZXIgPSAnJTQwJyArIGJ1ZmZlcjsKICAgICAgICAgICAgICBzZWVuQXQgPSB0cnVlOwogICAgICAgICAgICAgIGJ1ZmZlckNvZGVQb2ludHMgPSBhcnJheUZyb20oYnVmZmVyKTsKICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJ1ZmZlckNvZGVQb2ludHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHZhciBjb2RlUG9pbnQgPSBidWZmZXJDb2RlUG9pbnRzW2ldOwogICAgICAgICAgICAgICAgaWYgKGNvZGVQb2ludCA9PSAnOicgJiYgIXNlZW5QYXNzd29yZFRva2VuKSB7CiAgICAgICAgICAgICAgICAgIHNlZW5QYXNzd29yZFRva2VuID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2YXIgZW5jb2RlZENvZGVQb2ludHMgPSBwZXJjZW50RW5jb2RlKGNvZGVQb2ludCwgdXNlcmluZm9QZXJjZW50RW5jb2RlU2V0KTsKICAgICAgICAgICAgICAgIGlmIChzZWVuUGFzc3dvcmRUb2tlbikKICAgICAgICAgICAgICAgIHVybC5wYXNzd29yZCArPSBlbmNvZGVkQ29kZVBvaW50cztlbHNlCgogICAgICAgICAgICAgICAgdXJsLnVzZXJuYW1lICs9IGVuY29kZWRDb2RlUG9pbnRzOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBidWZmZXIgPSAnJzsKICAgICAgICAgICAgfSBlbHNlIGlmIChjaGFyID09IEVPRiB8fCBjaGFyID09ICcvJyB8fCBjaGFyID09ICc/JyB8fCBjaGFyID09ICcjJyB8fCBjaGFyID09ICdcXCcgJiYgaXNTcGVjaWFsKHVybCkpIHsKICAgICAgICAgICAgICBpZiAoc2VlbkF0ICYmIGJ1ZmZlciA9PSAnJykKICAgICAgICAgICAgICByZXR1cm4gSU5WQUxJRF9BVVRIT1JJVFk7CiAgICAgICAgICAgICAgcG9pbnRlciAtPSBhcnJheUZyb20oYnVmZmVyKS5sZW5ndGggKyAxOwogICAgICAgICAgICAgIGJ1ZmZlciA9ICcnOwogICAgICAgICAgICAgIHN0YXRlID0gSE9TVDsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIGJ1ZmZlciArPSBjaGFyOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgSE9TVDoKICAgICAgICAgIGNhc2UgSE9TVE5BTUU6CiAgICAgICAgICAgIGlmIChzdGF0ZU92ZXJyaWRlICYmIHVybC5zY2hlbWUgPT0gJ2ZpbGUnKSB7CiAgICAgICAgICAgICAgc3RhdGUgPSBGSUxFX0hPU1Q7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoY2hhciA9PSAnOicgJiYgIXNlZW5CcmFja2V0KSB7CiAgICAgICAgICAgICAgaWYgKGJ1ZmZlciA9PSAnJykKICAgICAgICAgICAgICByZXR1cm4gSU5WQUxJRF9IT1NUOwogICAgICAgICAgICAgIGZhaWx1cmUgPSBwYXJzZUhvc3QodXJsLCBidWZmZXIpOwogICAgICAgICAgICAgIGlmIChmYWlsdXJlKQogICAgICAgICAgICAgIHJldHVybiBmYWlsdXJlOwogICAgICAgICAgICAgIGJ1ZmZlciA9ICcnOwogICAgICAgICAgICAgIHN0YXRlID0gUE9SVDsKICAgICAgICAgICAgICBpZiAoc3RhdGVPdmVycmlkZSA9PSBIT1NUTkFNRSkKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0gZWxzZSBpZiAoY2hhciA9PSBFT0YgfHwgY2hhciA9PSAnLycgfHwgY2hhciA9PSAnPycgfHwgY2hhciA9PSAnIycgfHwgY2hhciA9PSAnXFwnICYmIGlzU3BlY2lhbCh1cmwpKSB7CiAgICAgICAgICAgICAgaWYgKGlzU3BlY2lhbCh1cmwpICYmIGJ1ZmZlciA9PSAnJykKICAgICAgICAgICAgICByZXR1cm4gSU5WQUxJRF9IT1NUOwogICAgICAgICAgICAgIGlmIChzdGF0ZU92ZXJyaWRlICYmIGJ1ZmZlciA9PSAnJyAmJiAoaW5jbHVkZXNDcmVkZW50aWFscyh1cmwpIHx8IHVybC5wb3J0ICE9PSBudWxsKSkKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgZmFpbHVyZSA9IHBhcnNlSG9zdCh1cmwsIGJ1ZmZlcik7CiAgICAgICAgICAgICAgaWYgKGZhaWx1cmUpCiAgICAgICAgICAgICAgcmV0dXJuIGZhaWx1cmU7CiAgICAgICAgICAgICAgYnVmZmVyID0gJyc7CiAgICAgICAgICAgICAgc3RhdGUgPSBQQVRIX1NUQVJUOwogICAgICAgICAgICAgIGlmIChzdGF0ZU92ZXJyaWRlKQogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBpZiAoY2hhciA9PSAnWycpCiAgICAgICAgICAgICAgc2VlbkJyYWNrZXQgPSB0cnVlO2Vsc2UKICAgICAgICAgICAgICBpZiAoY2hhciA9PSAnXScpCiAgICAgICAgICAgICAgc2VlbkJyYWNrZXQgPSBmYWxzZTsKICAgICAgICAgICAgICBidWZmZXIgKz0gY2hhcjsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgUE9SVDoKICAgICAgICAgICAgaWYgKERJR0lULnRlc3QoY2hhcikpIHsKICAgICAgICAgICAgICBidWZmZXIgKz0gY2hhcjsKICAgICAgICAgICAgfSBlbHNlIGlmIChjaGFyID09IEVPRiB8fCBjaGFyID09ICcvJyB8fCBjaGFyID09ICc/JyB8fCBjaGFyID09ICcjJyB8fCBjaGFyID09ICdcXCcgJiYgaXNTcGVjaWFsKHVybCkgfHwgc3RhdGVPdmVycmlkZSkgewogICAgICAgICAgICAgIGlmIChidWZmZXIgIT0gJycpIHsKICAgICAgICAgICAgICAgIHZhciBwb3J0ID0gcGFyc2VJbnQoYnVmZmVyLCAxMCk7CiAgICAgICAgICAgICAgICBpZiAocG9ydCA+IDB4RkZGRikKICAgICAgICAgICAgICAgIHJldHVybiBJTlZBTElEX1BPUlQ7CiAgICAgICAgICAgICAgICB1cmwucG9ydCA9IGlzU3BlY2lhbCh1cmwpICYmIHBvcnQgPT09IHNwZWNpYWxTY2hlbWVzW3VybC5zY2hlbWVdID8gbnVsbCA6IHBvcnQ7CiAgICAgICAgICAgICAgICBidWZmZXIgPSAnJzsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKHN0YXRlT3ZlcnJpZGUpCiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIHN0YXRlID0gUEFUSF9TVEFSVDsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIHJldHVybiBJTlZBTElEX1BPUlQ7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBGSUxFOgogICAgICAgICAgICB1cmwuc2NoZW1lID0gJ2ZpbGUnOwogICAgICAgICAgICBpZiAoY2hhciA9PSAnLycgfHwgY2hhciA9PSAnXFwnKQogICAgICAgICAgICBzdGF0ZSA9IEZJTEVfU0xBU0g7ZWxzZQogICAgICAgICAgICBpZiAoYmFzZSAmJiBiYXNlLnNjaGVtZSA9PSAnZmlsZScpIHsKICAgICAgICAgICAgICBpZiAoY2hhciA9PSBFT0YpIHsKICAgICAgICAgICAgICAgIHVybC5ob3N0ID0gYmFzZS5ob3N0OwogICAgICAgICAgICAgICAgdXJsLnBhdGggPSBiYXNlLnBhdGguc2xpY2UoKTsKICAgICAgICAgICAgICAgIHVybC5xdWVyeSA9IGJhc2UucXVlcnk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChjaGFyID09ICc/JykgewogICAgICAgICAgICAgICAgdXJsLmhvc3QgPSBiYXNlLmhvc3Q7CiAgICAgICAgICAgICAgICB1cmwucGF0aCA9IGJhc2UucGF0aC5zbGljZSgpOwogICAgICAgICAgICAgICAgdXJsLnF1ZXJ5ID0gJyc7CiAgICAgICAgICAgICAgICBzdGF0ZSA9IFFVRVJZOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoY2hhciA9PSAnIycpIHsKICAgICAgICAgICAgICAgIHVybC5ob3N0ID0gYmFzZS5ob3N0OwogICAgICAgICAgICAgICAgdXJsLnBhdGggPSBiYXNlLnBhdGguc2xpY2UoKTsKICAgICAgICAgICAgICAgIHVybC5xdWVyeSA9IGJhc2UucXVlcnk7CiAgICAgICAgICAgICAgICB1cmwuZnJhZ21lbnQgPSAnJzsKICAgICAgICAgICAgICAgIHN0YXRlID0gRlJBR01FTlQ7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmICghc3RhcnRzV2l0aFdpbmRvd3NEcml2ZUxldHRlcihjb2RlUG9pbnRzLnNsaWNlKHBvaW50ZXIpLmpvaW4oJycpKSkgewogICAgICAgICAgICAgICAgICB1cmwuaG9zdCA9IGJhc2UuaG9zdDsKICAgICAgICAgICAgICAgICAgdXJsLnBhdGggPSBiYXNlLnBhdGguc2xpY2UoKTsKICAgICAgICAgICAgICAgICAgc2hvcnRlblVSTHNQYXRoKHVybCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzdGF0ZSA9IFBBVEg7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgc3RhdGUgPSBQQVRIOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBGSUxFX1NMQVNIOgogICAgICAgICAgICBpZiAoY2hhciA9PSAnLycgfHwgY2hhciA9PSAnXFwnKSB7CiAgICAgICAgICAgICAgc3RhdGUgPSBGSUxFX0hPU1Q7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGJhc2UgJiYgYmFzZS5zY2hlbWUgPT0gJ2ZpbGUnICYmICFzdGFydHNXaXRoV2luZG93c0RyaXZlTGV0dGVyKGNvZGVQb2ludHMuc2xpY2UocG9pbnRlcikuam9pbignJykpKSB7CiAgICAgICAgICAgICAgaWYgKGlzV2luZG93c0RyaXZlTGV0dGVyKGJhc2UucGF0aFswXSwgdHJ1ZSkpCiAgICAgICAgICAgICAgdXJsLnBhdGgucHVzaChiYXNlLnBhdGhbMF0pO2Vsc2UKCiAgICAgICAgICAgICAgdXJsLmhvc3QgPSBiYXNlLmhvc3Q7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RhdGUgPSBQQVRIOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIGNhc2UgRklMRV9IT1NUOgogICAgICAgICAgICBpZiAoY2hhciA9PSBFT0YgfHwgY2hhciA9PSAnLycgfHwgY2hhciA9PSAnXFwnIHx8IGNoYXIgPT0gJz8nIHx8IGNoYXIgPT0gJyMnKSB7CiAgICAgICAgICAgICAgaWYgKCFzdGF0ZU92ZXJyaWRlICYmIGlzV2luZG93c0RyaXZlTGV0dGVyKGJ1ZmZlcikpIHsKICAgICAgICAgICAgICAgIHN0YXRlID0gUEFUSDsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGJ1ZmZlciA9PSAnJykgewogICAgICAgICAgICAgICAgdXJsLmhvc3QgPSAnJzsKICAgICAgICAgICAgICAgIGlmIChzdGF0ZU92ZXJyaWRlKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgc3RhdGUgPSBQQVRIX1NUQVJUOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBmYWlsdXJlID0gcGFyc2VIb3N0KHVybCwgYnVmZmVyKTsKICAgICAgICAgICAgICAgIGlmIChmYWlsdXJlKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhaWx1cmU7CiAgICAgICAgICAgICAgICBpZiAodXJsLmhvc3QgPT0gJ2xvY2FsaG9zdCcpCiAgICAgICAgICAgICAgICB1cmwuaG9zdCA9ICcnOwogICAgICAgICAgICAgICAgaWYgKHN0YXRlT3ZlcnJpZGUpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICBidWZmZXIgPSAnJzsKICAgICAgICAgICAgICAgIHN0YXRlID0gUEFUSF9TVEFSVDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICBidWZmZXIgKz0gY2hhcjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIFBBVEhfU1RBUlQ6CiAgICAgICAgICAgIGlmIChpc1NwZWNpYWwodXJsKSkgewogICAgICAgICAgICAgIHN0YXRlID0gUEFUSDsKICAgICAgICAgICAgICBpZiAoY2hhciAhPSAnLycgJiYgY2hhciAhPSAnXFwnKQogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9IGVsc2UgaWYgKCFzdGF0ZU92ZXJyaWRlICYmIGNoYXIgPT0gJz8nKSB7CiAgICAgICAgICAgICAgdXJsLnF1ZXJ5ID0gJyc7CiAgICAgICAgICAgICAgc3RhdGUgPSBRVUVSWTsKICAgICAgICAgICAgfSBlbHNlIGlmICghc3RhdGVPdmVycmlkZSAmJiBjaGFyID09ICcjJykgewogICAgICAgICAgICAgIHVybC5mcmFnbWVudCA9ICcnOwogICAgICAgICAgICAgIHN0YXRlID0gRlJBR01FTlQ7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoY2hhciAhPSBFT0YpIHsKICAgICAgICAgICAgICBzdGF0ZSA9IFBBVEg7CiAgICAgICAgICAgICAgaWYgKGNoYXIgIT0gJy8nKQogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBQQVRIOgogICAgICAgICAgICBpZiAoY2hhciA9PSBFT0YgfHwgY2hhciA9PSAnLycgfHwgY2hhciA9PSAnXFwnICYmIGlzU3BlY2lhbCh1cmwpIHx8ICFzdGF0ZU92ZXJyaWRlICYmIChjaGFyID09ICc/JyB8fCBjaGFyID09ICcjJykpIHsKICAgICAgICAgICAgICBpZiAoaXNEb3VibGVEb3QoYnVmZmVyKSkgewogICAgICAgICAgICAgICAgc2hvcnRlblVSTHNQYXRoKHVybCk7CiAgICAgICAgICAgICAgICBpZiAoY2hhciAhPSAnLycgJiYgIShjaGFyID09ICdcXCcgJiYgaXNTcGVjaWFsKHVybCkpKSB7CiAgICAgICAgICAgICAgICAgIHVybC5wYXRoLnB1c2goJycpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNTaW5nbGVEb3QoYnVmZmVyKSkgewogICAgICAgICAgICAgICAgaWYgKGNoYXIgIT0gJy8nICYmICEoY2hhciA9PSAnXFwnICYmIGlzU3BlY2lhbCh1cmwpKSkgewogICAgICAgICAgICAgICAgICB1cmwucGF0aC5wdXNoKCcnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKHVybC5zY2hlbWUgPT0gJ2ZpbGUnICYmICF1cmwucGF0aC5sZW5ndGggJiYgaXNXaW5kb3dzRHJpdmVMZXR0ZXIoYnVmZmVyKSkgewogICAgICAgICAgICAgICAgICBpZiAodXJsLmhvc3QpCiAgICAgICAgICAgICAgICAgIHVybC5ob3N0ID0gJyc7CiAgICAgICAgICAgICAgICAgIGJ1ZmZlciA9IGJ1ZmZlci5jaGFyQXQoMCkgKyAnOic7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB1cmwucGF0aC5wdXNoKGJ1ZmZlcik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJ1ZmZlciA9ICcnOwogICAgICAgICAgICAgIGlmICh1cmwuc2NoZW1lID09ICdmaWxlJyAmJiAoY2hhciA9PSBFT0YgfHwgY2hhciA9PSAnPycgfHwgY2hhciA9PSAnIycpKSB7CiAgICAgICAgICAgICAgICB3aGlsZSAodXJsLnBhdGgubGVuZ3RoID4gMSAmJiB1cmwucGF0aFswXSA9PT0gJycpIHsKICAgICAgICAgICAgICAgICAgdXJsLnBhdGguc2hpZnQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGNoYXIgPT0gJz8nKSB7CiAgICAgICAgICAgICAgICB1cmwucXVlcnkgPSAnJzsKICAgICAgICAgICAgICAgIHN0YXRlID0gUVVFUlk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChjaGFyID09ICcjJykgewogICAgICAgICAgICAgICAgdXJsLmZyYWdtZW50ID0gJyc7CiAgICAgICAgICAgICAgICBzdGF0ZSA9IEZSQUdNRU5UOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBidWZmZXIgKz0gcGVyY2VudEVuY29kZShjaGFyLCBwYXRoUGVyY2VudEVuY29kZVNldCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIENBTk5PVF9CRV9BX0JBU0VfVVJMX1BBVEg6CiAgICAgICAgICAgIGlmIChjaGFyID09ICc/JykgewogICAgICAgICAgICAgIHVybC5xdWVyeSA9ICcnOwogICAgICAgICAgICAgIHN0YXRlID0gUVVFUlk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoY2hhciA9PSAnIycpIHsKICAgICAgICAgICAgICB1cmwuZnJhZ21lbnQgPSAnJzsKICAgICAgICAgICAgICBzdGF0ZSA9IEZSQUdNRU5UOwogICAgICAgICAgICB9IGVsc2UgaWYgKGNoYXIgIT0gRU9GKSB7CiAgICAgICAgICAgICAgdXJsLnBhdGhbMF0gKz0gcGVyY2VudEVuY29kZShjaGFyLCBDMENvbnRyb2xQZXJjZW50RW5jb2RlU2V0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgUVVFUlk6CiAgICAgICAgICAgIGlmICghc3RhdGVPdmVycmlkZSAmJiBjaGFyID09ICcjJykgewogICAgICAgICAgICAgIHVybC5mcmFnbWVudCA9ICcnOwogICAgICAgICAgICAgIHN0YXRlID0gRlJBR01FTlQ7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoY2hhciAhPSBFT0YpIHsKICAgICAgICAgICAgICBpZiAoY2hhciA9PSAiJyIgJiYgaXNTcGVjaWFsKHVybCkpCiAgICAgICAgICAgICAgdXJsLnF1ZXJ5ICs9ICclMjcnO2Vsc2UKICAgICAgICAgICAgICBpZiAoY2hhciA9PSAnIycpCiAgICAgICAgICAgICAgdXJsLnF1ZXJ5ICs9ICclMjMnO2Vsc2UKCiAgICAgICAgICAgICAgdXJsLnF1ZXJ5ICs9IHBlcmNlbnRFbmNvZGUoY2hhciwgQzBDb250cm9sUGVyY2VudEVuY29kZVNldCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIEZSQUdNRU5UOgogICAgICAgICAgICBpZiAoY2hhciAhPSBFT0YpCiAgICAgICAgICAgIHVybC5mcmFnbWVudCArPSBwZXJjZW50RW5jb2RlKGNoYXIsIGZyYWdtZW50UGVyY2VudEVuY29kZVNldCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBwb2ludGVyKys7CiAgICAgIH0KICAgIH07CiAgICB2YXIgVVJMQ29uc3RydWN0b3IgPSBmdW5jdGlvbiBVUkwodXJsKSB7CiAgICAgIHZhciB0aGF0ID0gYW5JbnN0YW5jZSh0aGlzLCBVUkxDb25zdHJ1Y3RvciwgJ1VSTCcpOwogICAgICB2YXIgYmFzZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkOwogICAgICB2YXIgdXJsU3RyaW5nID0gU3RyaW5nKHVybCk7CiAgICAgIHZhciBzdGF0ZSA9IHNldEludGVybmFsU3RhdGUodGhhdCwgeyB0eXBlOiAnVVJMJyB9KTsKICAgICAgdmFyIGJhc2VTdGF0ZSwgZmFpbHVyZTsKICAgICAgaWYgKGJhc2UgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGlmIChiYXNlIGluc3RhbmNlb2YgVVJMQ29uc3RydWN0b3IpCiAgICAgICAgYmFzZVN0YXRlID0gZ2V0SW50ZXJuYWxVUkxTdGF0ZShiYXNlKTtlbHNlCiAgICAgICAgewogICAgICAgICAgZmFpbHVyZSA9IHBhcnNlVVJMKGJhc2VTdGF0ZSA9IHt9LCBTdHJpbmcoYmFzZSkpOwogICAgICAgICAgaWYgKGZhaWx1cmUpCiAgICAgICAgICB0aHJvdyBUeXBlRXJyb3IoZmFpbHVyZSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZhaWx1cmUgPSBwYXJzZVVSTChzdGF0ZSwgdXJsU3RyaW5nLCBudWxsLCBiYXNlU3RhdGUpOwogICAgICBpZiAoZmFpbHVyZSkKICAgICAgdGhyb3cgVHlwZUVycm9yKGZhaWx1cmUpOwogICAgICB2YXIgc2VhcmNoUGFyYW1zID0gc3RhdGUuc2VhcmNoUGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcygpOwogICAgICB2YXIgc2VhcmNoUGFyYW1zU3RhdGUgPSBnZXRJbnRlcm5hbFNlYXJjaFBhcmFtc1N0YXRlKHNlYXJjaFBhcmFtcyk7CiAgICAgIHNlYXJjaFBhcmFtc1N0YXRlLnVwZGF0ZVNlYXJjaFBhcmFtcyhzdGF0ZS5xdWVyeSk7CiAgICAgIHNlYXJjaFBhcmFtc1N0YXRlLnVwZGF0ZVVSTCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBzdGF0ZS5xdWVyeSA9IFN0cmluZyhzZWFyY2hQYXJhbXMpIHx8IG51bGw7CiAgICAgIH07CiAgICAgIGlmICghREVTQ1JJUFRPUlMpIHsKICAgICAgICB0aGF0LmhyZWYgPSBzZXJpYWxpemVVUkwuY2FsbCh0aGF0KTsKICAgICAgICB0aGF0Lm9yaWdpbiA9IGdldE9yaWdpbi5jYWxsKHRoYXQpOwogICAgICAgIHRoYXQucHJvdG9jb2wgPSBnZXRQcm90b2NvbC5jYWxsKHRoYXQpOwogICAgICAgIHRoYXQudXNlcm5hbWUgPSBnZXRVc2VybmFtZS5jYWxsKHRoYXQpOwogICAgICAgIHRoYXQucGFzc3dvcmQgPSBnZXRQYXNzd29yZC5jYWxsKHRoYXQpOwogICAgICAgIHRoYXQuaG9zdCA9IGdldEhvc3QuY2FsbCh0aGF0KTsKICAgICAgICB0aGF0Lmhvc3RuYW1lID0gZ2V0SG9zdG5hbWUuY2FsbCh0aGF0KTsKICAgICAgICB0aGF0LnBvcnQgPSBnZXRQb3J0LmNhbGwodGhhdCk7CiAgICAgICAgdGhhdC5wYXRobmFtZSA9IGdldFBhdGhuYW1lLmNhbGwodGhhdCk7CiAgICAgICAgdGhhdC5zZWFyY2ggPSBnZXRTZWFyY2guY2FsbCh0aGF0KTsKICAgICAgICB0aGF0LnNlYXJjaFBhcmFtcyA9IGdldFNlYXJjaFBhcmFtcy5jYWxsKHRoYXQpOwogICAgICAgIHRoYXQuaGFzaCA9IGdldEhhc2guY2FsbCh0aGF0KTsKICAgICAgfQogICAgfTsKICAgIHZhciBVUkxQcm90b3R5cGUgPSBVUkxDb25zdHJ1Y3Rvci5wcm90b3R5cGU7CiAgICB2YXIgc2VyaWFsaXplVVJMID0gZnVuY3Rpb24gc2VyaWFsaXplVVJMKCkgewogICAgICB2YXIgdXJsID0gZ2V0SW50ZXJuYWxVUkxTdGF0ZSh0aGlzKTsKICAgICAgdmFyIHNjaGVtZSA9IHVybC5zY2hlbWU7CiAgICAgIHZhciB1c2VybmFtZSA9IHVybC51c2VybmFtZTsKICAgICAgdmFyIHBhc3N3b3JkID0gdXJsLnBhc3N3b3JkOwogICAgICB2YXIgaG9zdCA9IHVybC5ob3N0OwogICAgICB2YXIgcG9ydCA9IHVybC5wb3J0OwogICAgICB2YXIgcGF0aCA9IHVybC5wYXRoOwogICAgICB2YXIgcXVlcnkgPSB1cmwucXVlcnk7CiAgICAgIHZhciBmcmFnbWVudCA9IHVybC5mcmFnbWVudDsKICAgICAgdmFyIG91dHB1dCA9IHNjaGVtZSArICc6JzsKICAgICAgaWYgKGhvc3QgIT09IG51bGwpIHsKICAgICAgICBvdXRwdXQgKz0gJy8vJzsKICAgICAgICBpZiAoaW5jbHVkZXNDcmVkZW50aWFscyh1cmwpKSB7CiAgICAgICAgICBvdXRwdXQgKz0gdXNlcm5hbWUgKyAocGFzc3dvcmQgPyAnOicgKyBwYXNzd29yZCA6ICcnKSArICdAJzsKICAgICAgICB9CiAgICAgICAgb3V0cHV0ICs9IHNlcmlhbGl6ZUhvc3QoaG9zdCk7CiAgICAgICAgaWYgKHBvcnQgIT09IG51bGwpCiAgICAgICAgb3V0cHV0ICs9ICc6JyArIHBvcnQ7CiAgICAgIH0gZWxzZSBpZiAoc2NoZW1lID09ICdmaWxlJykKICAgICAgb3V0cHV0ICs9ICcvLyc7CiAgICAgIG91dHB1dCArPSB1cmwuY2Fubm90QmVBQmFzZVVSTCA/IHBhdGhbMF0gOiBwYXRoLmxlbmd0aCA/ICcvJyArIHBhdGguam9pbignLycpIDogJyc7CiAgICAgIGlmIChxdWVyeSAhPT0gbnVsbCkKICAgICAgb3V0cHV0ICs9ICc/JyArIHF1ZXJ5OwogICAgICBpZiAoZnJhZ21lbnQgIT09IG51bGwpCiAgICAgIG91dHB1dCArPSAnIycgKyBmcmFnbWVudDsKICAgICAgcmV0dXJuIG91dHB1dDsKICAgIH07CiAgICB2YXIgZ2V0T3JpZ2luID0gZnVuY3Rpb24gZ2V0T3JpZ2luKCkgewogICAgICB2YXIgdXJsID0gZ2V0SW50ZXJuYWxVUkxTdGF0ZSh0aGlzKTsKICAgICAgdmFyIHNjaGVtZSA9IHVybC5zY2hlbWU7CiAgICAgIHZhciBwb3J0ID0gdXJsLnBvcnQ7CiAgICAgIGlmIChzY2hlbWUgPT0gJ2Jsb2InKQogICAgICB0cnkgewogICAgICAgIHJldHVybiBuZXcgVVJMKHNjaGVtZS5wYXRoWzBdKS5vcmlnaW47CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgcmV0dXJuICdudWxsJzsKICAgICAgfQogICAgICBpZiAoc2NoZW1lID09ICdmaWxlJyB8fCAhaXNTcGVjaWFsKHVybCkpCiAgICAgIHJldHVybiAnbnVsbCc7CiAgICAgIHJldHVybiBzY2hlbWUgKyAnOi8vJyArIHNlcmlhbGl6ZUhvc3QodXJsLmhvc3QpICsgKHBvcnQgIT09IG51bGwgPyAnOicgKyBwb3J0IDogJycpOwogICAgfTsKICAgIHZhciBnZXRQcm90b2NvbCA9IGZ1bmN0aW9uIGdldFByb3RvY29sKCkgewogICAgICByZXR1cm4gZ2V0SW50ZXJuYWxVUkxTdGF0ZSh0aGlzKS5zY2hlbWUgKyAnOic7CiAgICB9OwogICAgdmFyIGdldFVzZXJuYW1lID0gZnVuY3Rpb24gZ2V0VXNlcm5hbWUoKSB7CiAgICAgIHJldHVybiBnZXRJbnRlcm5hbFVSTFN0YXRlKHRoaXMpLnVzZXJuYW1lOwogICAgfTsKICAgIHZhciBnZXRQYXNzd29yZCA9IGZ1bmN0aW9uIGdldFBhc3N3b3JkKCkgewogICAgICByZXR1cm4gZ2V0SW50ZXJuYWxVUkxTdGF0ZSh0aGlzKS5wYXNzd29yZDsKICAgIH07CiAgICB2YXIgZ2V0SG9zdCA9IGZ1bmN0aW9uIGdldEhvc3QoKSB7CiAgICAgIHZhciB1cmwgPSBnZXRJbnRlcm5hbFVSTFN0YXRlKHRoaXMpOwogICAgICB2YXIgaG9zdCA9IHVybC5ob3N0OwogICAgICB2YXIgcG9ydCA9IHVybC5wb3J0OwogICAgICByZXR1cm4gaG9zdCA9PT0gbnVsbCA/ICcnIDogcG9ydCA9PT0gbnVsbCA/IHNlcmlhbGl6ZUhvc3QoaG9zdCkgOiBzZXJpYWxpemVIb3N0KGhvc3QpICsgJzonICsgcG9ydDsKICAgIH07CiAgICB2YXIgZ2V0SG9zdG5hbWUgPSBmdW5jdGlvbiBnZXRIb3N0bmFtZSgpIHsKICAgICAgdmFyIGhvc3QgPSBnZXRJbnRlcm5hbFVSTFN0YXRlKHRoaXMpLmhvc3Q7CiAgICAgIHJldHVybiBob3N0ID09PSBudWxsID8gJycgOiBzZXJpYWxpemVIb3N0KGhvc3QpOwogICAgfTsKICAgIHZhciBnZXRQb3J0ID0gZnVuY3Rpb24gZ2V0UG9ydCgpIHsKICAgICAgdmFyIHBvcnQgPSBnZXRJbnRlcm5hbFVSTFN0YXRlKHRoaXMpLnBvcnQ7CiAgICAgIHJldHVybiBwb3J0ID09PSBudWxsID8gJycgOiBTdHJpbmcocG9ydCk7CiAgICB9OwogICAgdmFyIGdldFBhdGhuYW1lID0gZnVuY3Rpb24gZ2V0UGF0aG5hbWUoKSB7CiAgICAgIHZhciB1cmwgPSBnZXRJbnRlcm5hbFVSTFN0YXRlKHRoaXMpOwogICAgICB2YXIgcGF0aCA9IHVybC5wYXRoOwogICAgICByZXR1cm4gdXJsLmNhbm5vdEJlQUJhc2VVUkwgPyBwYXRoWzBdIDogcGF0aC5sZW5ndGggPyAnLycgKyBwYXRoLmpvaW4oJy8nKSA6ICcnOwogICAgfTsKICAgIHZhciBnZXRTZWFyY2ggPSBmdW5jdGlvbiBnZXRTZWFyY2goKSB7CiAgICAgIHZhciBxdWVyeSA9IGdldEludGVybmFsVVJMU3RhdGUodGhpcykucXVlcnk7CiAgICAgIHJldHVybiBxdWVyeSA/ICc/JyArIHF1ZXJ5IDogJyc7CiAgICB9OwogICAgdmFyIGdldFNlYXJjaFBhcmFtcyA9IGZ1bmN0aW9uIGdldFNlYXJjaFBhcmFtcygpIHsKICAgICAgcmV0dXJuIGdldEludGVybmFsVVJMU3RhdGUodGhpcykuc2VhcmNoUGFyYW1zOwogICAgfTsKICAgIHZhciBnZXRIYXNoID0gZnVuY3Rpb24gZ2V0SGFzaCgpIHsKICAgICAgdmFyIGZyYWdtZW50ID0gZ2V0SW50ZXJuYWxVUkxTdGF0ZSh0aGlzKS5mcmFnbWVudDsKICAgICAgcmV0dXJuIGZyYWdtZW50ID8gJyMnICsgZnJhZ21lbnQgOiAnJzsKICAgIH07CiAgICB2YXIgYWNjZXNzb3JEZXNjcmlwdG9yID0gZnVuY3Rpb24gYWNjZXNzb3JEZXNjcmlwdG9yKGdldHRlciwgc2V0dGVyKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgZ2V0OiBnZXR0ZXIsCiAgICAgICAgc2V0OiBzZXR0ZXIsCiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICAgIGVudW1lcmFibGU6IHRydWUKICAgICAgfTsKICAgIH07CiAgICBpZiAoREVTQ1JJUFRPUlMpIHsKICAgICAgZGVmaW5lUHJvcGVydGllcyhVUkxQcm90b3R5cGUsIHsKICAgICAgICBocmVmOiBhY2Nlc3NvckRlc2NyaXB0b3Ioc2VyaWFsaXplVVJMLCBmdW5jdGlvbiAoaHJlZikgewogICAgICAgICAgdmFyIHVybCA9IGdldEludGVybmFsVVJMU3RhdGUodGhpcyk7CiAgICAgICAgICB2YXIgdXJsU3RyaW5nID0gU3RyaW5nKGhyZWYpOwogICAgICAgICAgdmFyIGZhaWx1cmUgPSBwYXJzZVVSTCh1cmwsIHVybFN0cmluZyk7CiAgICAgICAgICBpZiAoZmFpbHVyZSkKICAgICAgICAgIHRocm93IFR5cGVFcnJvcihmYWlsdXJlKTsKICAgICAgICAgIGdldEludGVybmFsU2VhcmNoUGFyYW1zU3RhdGUodXJsLnNlYXJjaFBhcmFtcykudXBkYXRlU2VhcmNoUGFyYW1zKHVybC5xdWVyeSk7CiAgICAgICAgfSksCiAgICAgICAgb3JpZ2luOiBhY2Nlc3NvckRlc2NyaXB0b3IoZ2V0T3JpZ2luKSwKICAgICAgICBwcm90b2NvbDogYWNjZXNzb3JEZXNjcmlwdG9yKGdldFByb3RvY29sLCBmdW5jdGlvbiAocHJvdG9jb2wpIHsKICAgICAgICAgIHZhciB1cmwgPSBnZXRJbnRlcm5hbFVSTFN0YXRlKHRoaXMpOwogICAgICAgICAgcGFyc2VVUkwodXJsLCBTdHJpbmcocHJvdG9jb2wpICsgJzonLCBTQ0hFTUVfU1RBUlQpOwogICAgICAgIH0pLAogICAgICAgIHVzZXJuYW1lOiBhY2Nlc3NvckRlc2NyaXB0b3IoZ2V0VXNlcm5hbWUsIGZ1bmN0aW9uICh1c2VybmFtZSkgewogICAgICAgICAgdmFyIHVybCA9IGdldEludGVybmFsVVJMU3RhdGUodGhpcyk7CiAgICAgICAgICB2YXIgY29kZVBvaW50cyA9IGFycmF5RnJvbShTdHJpbmcodXNlcm5hbWUpKTsKICAgICAgICAgIGlmIChjYW5ub3RIYXZlVXNlcm5hbWVQYXNzd29yZFBvcnQodXJsKSkKICAgICAgICAgIHJldHVybjsKICAgICAgICAgIHVybC51c2VybmFtZSA9ICcnOwogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb2RlUG9pbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHVybC51c2VybmFtZSArPSBwZXJjZW50RW5jb2RlKGNvZGVQb2ludHNbaV0sIHVzZXJpbmZvUGVyY2VudEVuY29kZVNldCk7CiAgICAgICAgICB9CiAgICAgICAgfSksCiAgICAgICAgcGFzc3dvcmQ6IGFjY2Vzc29yRGVzY3JpcHRvcihnZXRQYXNzd29yZCwgZnVuY3Rpb24gKHBhc3N3b3JkKSB7CiAgICAgICAgICB2YXIgdXJsID0gZ2V0SW50ZXJuYWxVUkxTdGF0ZSh0aGlzKTsKICAgICAgICAgIHZhciBjb2RlUG9pbnRzID0gYXJyYXlGcm9tKFN0cmluZyhwYXNzd29yZCkpOwogICAgICAgICAgaWYgKGNhbm5vdEhhdmVVc2VybmFtZVBhc3N3b3JkUG9ydCh1cmwpKQogICAgICAgICAgcmV0dXJuOwogICAgICAgICAgdXJsLnBhc3N3b3JkID0gJyc7CiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvZGVQb2ludHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdXJsLnBhc3N3b3JkICs9IHBlcmNlbnRFbmNvZGUoY29kZVBvaW50c1tpXSwgdXNlcmluZm9QZXJjZW50RW5jb2RlU2V0KTsKICAgICAgICAgIH0KICAgICAgICB9KSwKICAgICAgICBob3N0OiBhY2Nlc3NvckRlc2NyaXB0b3IoZ2V0SG9zdCwgZnVuY3Rpb24gKGhvc3QpIHsKICAgICAgICAgIHZhciB1cmwgPSBnZXRJbnRlcm5hbFVSTFN0YXRlKHRoaXMpOwogICAgICAgICAgaWYgKHVybC5jYW5ub3RCZUFCYXNlVVJMKQogICAgICAgICAgcmV0dXJuOwogICAgICAgICAgcGFyc2VVUkwodXJsLCBTdHJpbmcoaG9zdCksIEhPU1QpOwogICAgICAgIH0pLAogICAgICAgIGhvc3RuYW1lOiBhY2Nlc3NvckRlc2NyaXB0b3IoZ2V0SG9zdG5hbWUsIGZ1bmN0aW9uIChob3N0bmFtZSkgewogICAgICAgICAgdmFyIHVybCA9IGdldEludGVybmFsVVJMU3RhdGUodGhpcyk7CiAgICAgICAgICBpZiAodXJsLmNhbm5vdEJlQUJhc2VVUkwpCiAgICAgICAgICByZXR1cm47CiAgICAgICAgICBwYXJzZVVSTCh1cmwsIFN0cmluZyhob3N0bmFtZSksIEhPU1ROQU1FKTsKICAgICAgICB9KSwKICAgICAgICBwb3J0OiBhY2Nlc3NvckRlc2NyaXB0b3IoZ2V0UG9ydCwgZnVuY3Rpb24gKHBvcnQpIHsKICAgICAgICAgIHZhciB1cmwgPSBnZXRJbnRlcm5hbFVSTFN0YXRlKHRoaXMpOwogICAgICAgICAgaWYgKGNhbm5vdEhhdmVVc2VybmFtZVBhc3N3b3JkUG9ydCh1cmwpKQogICAgICAgICAgcmV0dXJuOwogICAgICAgICAgcG9ydCA9IFN0cmluZyhwb3J0KTsKICAgICAgICAgIGlmIChwb3J0ID09ICcnKQogICAgICAgICAgdXJsLnBvcnQgPSBudWxsO2Vsc2UKCiAgICAgICAgICBwYXJzZVVSTCh1cmwsIHBvcnQsIFBPUlQpOwogICAgICAgIH0pLAogICAgICAgIHBhdGhuYW1lOiBhY2Nlc3NvckRlc2NyaXB0b3IoZ2V0UGF0aG5hbWUsIGZ1bmN0aW9uIChwYXRobmFtZSkgewogICAgICAgICAgdmFyIHVybCA9IGdldEludGVybmFsVVJMU3RhdGUodGhpcyk7CiAgICAgICAgICBpZiAodXJsLmNhbm5vdEJlQUJhc2VVUkwpCiAgICAgICAgICByZXR1cm47CiAgICAgICAgICB1cmwucGF0aCA9IFtdOwogICAgICAgICAgcGFyc2VVUkwodXJsLCBwYXRobmFtZSArICcnLCBQQVRIX1NUQVJUKTsKICAgICAgICB9KSwKICAgICAgICBzZWFyY2g6IGFjY2Vzc29yRGVzY3JpcHRvcihnZXRTZWFyY2gsIGZ1bmN0aW9uIChzZWFyY2gpIHsKICAgICAgICAgIHZhciB1cmwgPSBnZXRJbnRlcm5hbFVSTFN0YXRlKHRoaXMpOwogICAgICAgICAgc2VhcmNoID0gU3RyaW5nKHNlYXJjaCk7CiAgICAgICAgICBpZiAoc2VhcmNoID09ICcnKSB7CiAgICAgICAgICAgIHVybC5xdWVyeSA9IG51bGw7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoJz8nID09IHNlYXJjaC5jaGFyQXQoMCkpCiAgICAgICAgICAgIHNlYXJjaCA9IHNlYXJjaC5zbGljZSgxKTsKICAgICAgICAgICAgdXJsLnF1ZXJ5ID0gJyc7CiAgICAgICAgICAgIHBhcnNlVVJMKHVybCwgc2VhcmNoLCBRVUVSWSk7CiAgICAgICAgICB9CiAgICAgICAgICBnZXRJbnRlcm5hbFNlYXJjaFBhcmFtc1N0YXRlKHVybC5zZWFyY2hQYXJhbXMpLnVwZGF0ZVNlYXJjaFBhcmFtcyh1cmwucXVlcnkpOwogICAgICAgIH0pLAogICAgICAgIHNlYXJjaFBhcmFtczogYWNjZXNzb3JEZXNjcmlwdG9yKGdldFNlYXJjaFBhcmFtcyksCiAgICAgICAgaGFzaDogYWNjZXNzb3JEZXNjcmlwdG9yKGdldEhhc2gsIGZ1bmN0aW9uIChoYXNoKSB7CiAgICAgICAgICB2YXIgdXJsID0gZ2V0SW50ZXJuYWxVUkxTdGF0ZSh0aGlzKTsKICAgICAgICAgIGhhc2ggPSBTdHJpbmcoaGFzaCk7CiAgICAgICAgICBpZiAoaGFzaCA9PSAnJykgewogICAgICAgICAgICB1cmwuZnJhZ21lbnQgPSBudWxsOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoJyMnID09IGhhc2guY2hhckF0KDApKQogICAgICAgICAgaGFzaCA9IGhhc2guc2xpY2UoMSk7CiAgICAgICAgICB1cmwuZnJhZ21lbnQgPSAnJzsKICAgICAgICAgIHBhcnNlVVJMKHVybCwgaGFzaCwgRlJBR01FTlQpOwogICAgICAgIH0pCiAgICAgIH0pOwogICAgfQogICAgcmVkZWZpbmUoVVJMUHJvdG90eXBlLCAndG9KU09OJywgZnVuY3Rpb24gdG9KU09OKCkgewogICAgICByZXR1cm4gc2VyaWFsaXplVVJMLmNhbGwodGhpcyk7CiAgICB9LCB7IGVudW1lcmFibGU6IHRydWUgfSk7CiAgICByZWRlZmluZShVUkxQcm90b3R5cGUsICd0b1N0cmluZycsIGZ1bmN0aW9uIHRvU3RyaW5nKCkgewogICAgICByZXR1cm4gc2VyaWFsaXplVVJMLmNhbGwodGhpcyk7CiAgICB9LCB7IGVudW1lcmFibGU6IHRydWUgfSk7CiAgICBpZiAoTmF0aXZlVVJMKSB7CiAgICAgIHZhciBuYXRpdmVDcmVhdGVPYmplY3RVUkwgPSBOYXRpdmVVUkwuY3JlYXRlT2JqZWN0VVJMOwogICAgICB2YXIgbmF0aXZlUmV2b2tlT2JqZWN0VVJMID0gTmF0aXZlVVJMLnJldm9rZU9iamVjdFVSTDsKICAgICAgaWYgKG5hdGl2ZUNyZWF0ZU9iamVjdFVSTCkKICAgICAgcmVkZWZpbmUoVVJMQ29uc3RydWN0b3IsICdjcmVhdGVPYmplY3RVUkwnLCBmdW5jdGlvbiBjcmVhdGVPYmplY3RVUkwoYmxvYikgewogICAgICAgIHJldHVybiBuYXRpdmVDcmVhdGVPYmplY3RVUkwuYXBwbHkoTmF0aXZlVVJMLCBhcmd1bWVudHMpOwogICAgICB9KTsKICAgICAgaWYgKG5hdGl2ZVJldm9rZU9iamVjdFVSTCkKICAgICAgcmVkZWZpbmUoVVJMQ29uc3RydWN0b3IsICdyZXZva2VPYmplY3RVUkwnLCBmdW5jdGlvbiByZXZva2VPYmplY3RVUkwodXJsKSB7CiAgICAgICAgcmV0dXJuIG5hdGl2ZVJldm9rZU9iamVjdFVSTC5hcHBseShOYXRpdmVVUkwsIGFyZ3VtZW50cyk7CiAgICAgIH0pOwogICAgfQogICAgc2V0VG9TdHJpbmdUYWcoVVJMQ29uc3RydWN0b3IsICdVUkwnKTsKICAgICQoewogICAgICBnbG9iYWw6IHRydWUsCiAgICAgIGZvcmNlZDogIVVTRV9OQVRJVkVfVVJMLAogICAgICBzaGFtOiAhREVTQ1JJUFRPUlMKICAgIH0sIHsgVVJMOiBVUkxDb25zdHJ1Y3RvciB9KTsKCiAgICAvKioqL30pLCAoCiAgLyogMTMwICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGZhaWxzID0gX193X3BkZmpzX3JlcXVpcmVfXyg5KTsKICAgIHZhciB3ZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUzKTsKICAgIHZhciBJU19QVVJFID0gX193X3BkZmpzX3JlcXVpcmVfXygzMik7CiAgICB2YXIgSVRFUkFUT1IgPSB3ZWxsS25vd25TeW1ib2woJ2l0ZXJhdG9yJyk7CiAgICBtb2R1bGUuZXhwb3J0cyA9ICFmYWlscyhmdW5jdGlvbiAoKSB7CiAgICAgIHZhciB1cmwgPSBuZXcgVVJMKCdiP2E9MSZiPTImYz0zJywgJ2h0dHA6Ly9hJyk7CiAgICAgIHZhciBzZWFyY2hQYXJhbXMgPSB1cmwuc2VhcmNoUGFyYW1zOwogICAgICB2YXIgcmVzdWx0ID0gJyc7CiAgICAgIHVybC5wYXRobmFtZSA9ICdjJTIwZCc7CiAgICAgIHNlYXJjaFBhcmFtcy5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7CiAgICAgICAgc2VhcmNoUGFyYW1zWydkZWxldGUnXSgnYicpOwogICAgICAgIHJlc3VsdCArPSBrZXkgKyB2YWx1ZTsKICAgICAgfSk7CiAgICAgIHJldHVybiBJU19QVVJFICYmICF1cmwudG9KU09OIHx8ICFzZWFyY2hQYXJhbXMuc29ydCB8fCB1cmwuaHJlZiAhPT0gJ2h0dHA6Ly9hL2MlMjBkP2E9MSZjPTMnIHx8IHNlYXJjaFBhcmFtcy5nZXQoJ2MnKSAhPT0gJzMnIHx8IFN0cmluZyhuZXcgVVJMU2VhcmNoUGFyYW1zKCc/YT0xJykpICE9PSAnYT0xJyB8fCAhc2VhcmNoUGFyYW1zW0lURVJBVE9SXSB8fCBuZXcgVVJMKCdodHRwczovL2FAYicpLnVzZXJuYW1lICE9PSAnYScgfHwgbmV3IFVSTFNlYXJjaFBhcmFtcyhuZXcgVVJMU2VhcmNoUGFyYW1zKCdhPWInKSkuZ2V0KCdhJykgIT09ICdiJyB8fCBuZXcgVVJMKCdodHRwOi8v0YLQtdGB0YInKS5ob3N0ICE9PSAneG4tLWUxYXliYycgfHwgbmV3IFVSTCgnaHR0cDovL2Ej0LEnKS5oYXNoICE9PSAnIyVEMCVCMScgfHwgcmVzdWx0ICE9PSAnYTFjMycgfHwgbmV3IFVSTCgnaHR0cDovL3gnLCB1bmRlZmluZWQpLmhvc3QgIT09ICd4JzsKICAgIH0pOwoKICAgIC8qKiovfSksICgKICAvKiAxMzEgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIG1heEludCA9IDIxNDc0ODM2NDc7CiAgICB2YXIgYmFzZSA9IDM2OwogICAgdmFyIHRNaW4gPSAxOwogICAgdmFyIHRNYXggPSAyNjsKICAgIHZhciBza2V3ID0gMzg7CiAgICB2YXIgZGFtcCA9IDcwMDsKICAgIHZhciBpbml0aWFsQmlhcyA9IDcyOwogICAgdmFyIGluaXRpYWxOID0gMTI4OwogICAgdmFyIGRlbGltaXRlciA9ICctJzsKICAgIHZhciByZWdleE5vbkFTQ0lJID0gL1teXDAtXHUwMDdFXS87CiAgICB2YXIgcmVnZXhTZXBhcmF0b3JzID0gL1suXHUzMDAyXHVGRjBFXHVGRjYxXS9nOwogICAgdmFyIE9WRVJGTE9XX0VSUk9SID0gJ092ZXJmbG93OiBpbnB1dCBuZWVkcyB3aWRlciBpbnRlZ2VycyB0byBwcm9jZXNzJzsKICAgIHZhciBiYXNlTWludXNUTWluID0gYmFzZSAtIHRNaW47CiAgICB2YXIgZmxvb3IgPSBNYXRoLmZsb29yOwogICAgdmFyIHN0cmluZ0Zyb21DaGFyQ29kZSA9IFN0cmluZy5mcm9tQ2hhckNvZGU7CiAgICB2YXIgdWNzMmRlY29kZSA9IGZ1bmN0aW9uIHVjczJkZWNvZGUoc3RyaW5nKSB7CiAgICAgIHZhciBvdXRwdXQgPSBbXTsKICAgICAgdmFyIGNvdW50ZXIgPSAwOwogICAgICB2YXIgbGVuZ3RoID0gc3RyaW5nLmxlbmd0aDsKICAgICAgd2hpbGUgKGNvdW50ZXIgPCBsZW5ndGgpIHsKICAgICAgICB2YXIgdmFsdWUgPSBzdHJpbmcuY2hhckNvZGVBdChjb3VudGVyKyspOwogICAgICAgIGlmICh2YWx1ZSA+PSAweEQ4MDAgJiYgdmFsdWUgPD0gMHhEQkZGICYmIGNvdW50ZXIgPCBsZW5ndGgpIHsKICAgICAgICAgIHZhciBleHRyYSA9IHN0cmluZy5jaGFyQ29kZUF0KGNvdW50ZXIrKyk7CiAgICAgICAgICBpZiAoKGV4dHJhICYgMHhGQzAwKSA9PSAweERDMDApIHsKICAgICAgICAgICAgb3V0cHV0LnB1c2goKCh2YWx1ZSAmIDB4M0ZGKSA8PCAxMCkgKyAoZXh0cmEgJiAweDNGRikgKyAweDEwMDAwKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG91dHB1dC5wdXNoKHZhbHVlKTsKICAgICAgICAgICAgY291bnRlci0tOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBvdXRwdXQucHVzaCh2YWx1ZSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBvdXRwdXQ7CiAgICB9OwogICAgdmFyIGRpZ2l0VG9CYXNpYyA9IGZ1bmN0aW9uIGRpZ2l0VG9CYXNpYyhkaWdpdCkgewogICAgICByZXR1cm4gZGlnaXQgKyAyMiArIDc1ICogKGRpZ2l0IDwgMjYpOwogICAgfTsKICAgIHZhciBhZGFwdCA9IGZ1bmN0aW9uIGFkYXB0KGRlbHRhLCBudW1Qb2ludHMsIGZpcnN0VGltZSkgewogICAgICB2YXIgayA9IDA7CiAgICAgIGRlbHRhID0gZmlyc3RUaW1lID8gZmxvb3IoZGVsdGEgLyBkYW1wKSA6IGRlbHRhID4+IDE7CiAgICAgIGRlbHRhICs9IGZsb29yKGRlbHRhIC8gbnVtUG9pbnRzKTsKICAgICAgZm9yICg7IGRlbHRhID4gYmFzZU1pbnVzVE1pbiAqIHRNYXggPj4gMTsgayArPSBiYXNlKSB7CiAgICAgICAgZGVsdGEgPSBmbG9vcihkZWx0YSAvIGJhc2VNaW51c1RNaW4pOwogICAgICB9CiAgICAgIHJldHVybiBmbG9vcihrICsgKGJhc2VNaW51c1RNaW4gKyAxKSAqIGRlbHRhIC8gKGRlbHRhICsgc2tldykpOwogICAgfTsKICAgIHZhciBlbmNvZGUgPSBmdW5jdGlvbiBlbmNvZGUoaW5wdXQpIHsKICAgICAgdmFyIG91dHB1dCA9IFtdOwogICAgICBpbnB1dCA9IHVjczJkZWNvZGUoaW5wdXQpOwogICAgICB2YXIgaW5wdXRMZW5ndGggPSBpbnB1dC5sZW5ndGg7CiAgICAgIHZhciBuID0gaW5pdGlhbE47CiAgICAgIHZhciBkZWx0YSA9IDA7CiAgICAgIHZhciBiaWFzID0gaW5pdGlhbEJpYXM7CiAgICAgIHZhciBpLCBjdXJyZW50VmFsdWU7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBpbnB1dC5sZW5ndGg7IGkrKykgewogICAgICAgIGN1cnJlbnRWYWx1ZSA9IGlucHV0W2ldOwogICAgICAgIGlmIChjdXJyZW50VmFsdWUgPCAweDgwKSB7CiAgICAgICAgICBvdXRwdXQucHVzaChzdHJpbmdGcm9tQ2hhckNvZGUoY3VycmVudFZhbHVlKSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHZhciBiYXNpY0xlbmd0aCA9IG91dHB1dC5sZW5ndGg7CiAgICAgIHZhciBoYW5kbGVkQ1BDb3VudCA9IGJhc2ljTGVuZ3RoOwogICAgICBpZiAoYmFzaWNMZW5ndGgpIHsKICAgICAgICBvdXRwdXQucHVzaChkZWxpbWl0ZXIpOwogICAgICB9CiAgICAgIHdoaWxlIChoYW5kbGVkQ1BDb3VudCA8IGlucHV0TGVuZ3RoKSB7CiAgICAgICAgdmFyIG0gPSBtYXhJbnQ7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGlucHV0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBjdXJyZW50VmFsdWUgPSBpbnB1dFtpXTsKICAgICAgICAgIGlmIChjdXJyZW50VmFsdWUgPj0gbiAmJiBjdXJyZW50VmFsdWUgPCBtKSB7CiAgICAgICAgICAgIG0gPSBjdXJyZW50VmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHZhciBoYW5kbGVkQ1BDb3VudFBsdXNPbmUgPSBoYW5kbGVkQ1BDb3VudCArIDE7CiAgICAgICAgaWYgKG0gLSBuID4gZmxvb3IoKG1heEludCAtIGRlbHRhKSAvIGhhbmRsZWRDUENvdW50UGx1c09uZSkpIHsKICAgICAgICAgIHRocm93IFJhbmdlRXJyb3IoT1ZFUkZMT1dfRVJST1IpOwogICAgICAgIH0KICAgICAgICBkZWx0YSArPSAobSAtIG4pICogaGFuZGxlZENQQ291bnRQbHVzT25lOwogICAgICAgIG4gPSBtOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBpbnB1dC5sZW5ndGg7IGkrKykgewogICAgICAgICAgY3VycmVudFZhbHVlID0gaW5wdXRbaV07CiAgICAgICAgICBpZiAoY3VycmVudFZhbHVlIDwgbiAmJiArK2RlbHRhID4gbWF4SW50KSB7CiAgICAgICAgICAgIHRocm93IFJhbmdlRXJyb3IoT1ZFUkZMT1dfRVJST1IpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGN1cnJlbnRWYWx1ZSA9PSBuKSB7CiAgICAgICAgICAgIHZhciBxID0gZGVsdGE7CiAgICAgICAgICAgIGZvciAodmFyIGsgPSBiYXNlOzsgayArPSBiYXNlKSB7CiAgICAgICAgICAgICAgdmFyIHQgPSBrIDw9IGJpYXMgPyB0TWluIDogayA+PSBiaWFzICsgdE1heCA/IHRNYXggOiBrIC0gYmlhczsKICAgICAgICAgICAgICBpZiAocSA8IHQpCiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgdmFyIHFNaW51c1QgPSBxIC0gdDsKICAgICAgICAgICAgICB2YXIgYmFzZU1pbnVzVCA9IGJhc2UgLSB0OwogICAgICAgICAgICAgIG91dHB1dC5wdXNoKHN0cmluZ0Zyb21DaGFyQ29kZShkaWdpdFRvQmFzaWModCArIHFNaW51c1QgJSBiYXNlTWludXNUKSkpOwogICAgICAgICAgICAgIHEgPSBmbG9vcihxTWludXNUIC8gYmFzZU1pbnVzVCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgb3V0cHV0LnB1c2goc3RyaW5nRnJvbUNoYXJDb2RlKGRpZ2l0VG9CYXNpYyhxKSkpOwogICAgICAgICAgICBiaWFzID0gYWRhcHQoZGVsdGEsIGhhbmRsZWRDUENvdW50UGx1c09uZSwgaGFuZGxlZENQQ291bnQgPT0gYmFzaWNMZW5ndGgpOwogICAgICAgICAgICBkZWx0YSA9IDA7CiAgICAgICAgICAgICsraGFuZGxlZENQQ291bnQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICsrZGVsdGE7CiAgICAgICAgKytuOwogICAgICB9CiAgICAgIHJldHVybiBvdXRwdXQuam9pbignJyk7CiAgICB9OwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaW5wdXQpIHsKICAgICAgdmFyIGVuY29kZWQgPSBbXTsKICAgICAgdmFyIGxhYmVscyA9IGlucHV0LnRvTG93ZXJDYXNlKCkucmVwbGFjZShyZWdleFNlcGFyYXRvcnMsICIuIikuc3BsaXQoJy4nKTsKICAgICAgdmFyIGksIGxhYmVsOwogICAgICBmb3IgKGkgPSAwOyBpIDwgbGFiZWxzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGFiZWwgPSBsYWJlbHNbaV07CiAgICAgICAgZW5jb2RlZC5wdXNoKHJlZ2V4Tm9uQVNDSUkudGVzdChsYWJlbCkgPyAneG4tLScgKyBlbmNvZGUobGFiZWwpIDogbGFiZWwpOwogICAgICB9CiAgICAgIHJldHVybiBlbmNvZGVkLmpvaW4oJy4nKTsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDEzMiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDEwOSk7CiAgICB2YXIgJCA9IF9fd19wZGZqc19yZXF1aXJlX18oNSk7CiAgICB2YXIgZ2V0QnVpbHRJbiA9IF9fd19wZGZqc19yZXF1aXJlX18oMzcpOwogICAgdmFyIFVTRV9OQVRJVkVfVVJMID0gX193X3BkZmpzX3JlcXVpcmVfXygxMzApOwogICAgdmFyIHJlZGVmaW5lID0gX193X3BkZmpzX3JlcXVpcmVfXygyNCk7CiAgICB2YXIgcmVkZWZpbmVBbGwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDExMik7CiAgICB2YXIgc2V0VG9TdHJpbmdUYWcgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDgxKTsKICAgIHZhciBjcmVhdGVJdGVyYXRvckNvbnN0cnVjdG9yID0gX193X3BkZmpzX3JlcXVpcmVfXyg3Nik7CiAgICB2YXIgSW50ZXJuYWxTdGF0ZU1vZHVsZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjgpOwogICAgdmFyIGFuSW5zdGFuY2UgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDExNCk7CiAgICB2YXIgaGFzT3duID0gX193X3BkZmpzX3JlcXVpcmVfXygxOCk7CiAgICB2YXIgYmluZCA9IF9fd19wZGZqc19yZXF1aXJlX18oNTgpOwogICAgdmFyIGNsYXNzb2YgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDkxKTsKICAgIHZhciBhbk9iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oMjMpOwogICAgdmFyIGlzT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygxNyk7CiAgICB2YXIgY3JlYXRlID0gX193X3BkZmpzX3JlcXVpcmVfXyg2Nyk7CiAgICB2YXIgY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yID0gX193X3BkZmpzX3JlcXVpcmVfXygxMSk7CiAgICB2YXIgZ2V0SXRlcmF0b3IgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEzMyk7CiAgICB2YXIgZ2V0SXRlcmF0b3JNZXRob2QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDkwKTsKICAgIHZhciB3ZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUzKTsKICAgIHZhciAkZmV0Y2ggPSBnZXRCdWlsdEluKCdmZXRjaCcpOwogICAgdmFyIEhlYWRlcnMgPSBnZXRCdWlsdEluKCdIZWFkZXJzJyk7CiAgICB2YXIgSVRFUkFUT1IgPSB3ZWxsS25vd25TeW1ib2woJ2l0ZXJhdG9yJyk7CiAgICB2YXIgVVJMX1NFQVJDSF9QQVJBTVMgPSAnVVJMU2VhcmNoUGFyYW1zJzsKICAgIHZhciBVUkxfU0VBUkNIX1BBUkFNU19JVEVSQVRPUiA9IFVSTF9TRUFSQ0hfUEFSQU1TICsgJ0l0ZXJhdG9yJzsKICAgIHZhciBzZXRJbnRlcm5hbFN0YXRlID0gSW50ZXJuYWxTdGF0ZU1vZHVsZS5zZXQ7CiAgICB2YXIgZ2V0SW50ZXJuYWxQYXJhbXNTdGF0ZSA9IEludGVybmFsU3RhdGVNb2R1bGUuZ2V0dGVyRm9yKFVSTF9TRUFSQ0hfUEFSQU1TKTsKICAgIHZhciBnZXRJbnRlcm5hbEl0ZXJhdG9yU3RhdGUgPSBJbnRlcm5hbFN0YXRlTW9kdWxlLmdldHRlckZvcihVUkxfU0VBUkNIX1BBUkFNU19JVEVSQVRPUik7CiAgICB2YXIgcGx1cyA9IC9cKy9nOwogICAgdmFyIHNlcXVlbmNlcyA9IEFycmF5KDQpOwogICAgdmFyIHBlcmNlbnRTZXF1ZW5jZSA9IGZ1bmN0aW9uIHBlcmNlbnRTZXF1ZW5jZShieXRlcykgewogICAgICByZXR1cm4gc2VxdWVuY2VzW2J5dGVzIC0gMV0gfHwgKHNlcXVlbmNlc1tieXRlcyAtIDFdID0gUmVnRXhwKCcoKD86JVtcXGRhLWZdezJ9KXsnICsgYnl0ZXMgKyAnfSknLCAnZ2knKSk7CiAgICB9OwogICAgdmFyIHBlcmNlbnREZWNvZGUgPSBmdW5jdGlvbiBwZXJjZW50RGVjb2RlKHNlcXVlbmNlKSB7CiAgICAgIHRyeSB7CiAgICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChzZXF1ZW5jZSk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgcmV0dXJuIHNlcXVlbmNlOwogICAgICB9CiAgICB9OwogICAgdmFyIGRlc2VyaWFsaXplID0gZnVuY3Rpb24gZGVzZXJpYWxpemUoaXQpIHsKICAgICAgdmFyIHJlc3VsdCA9IGl0LnJlcGxhY2UocGx1cywgJyAnKTsKICAgICAgdmFyIGJ5dGVzID0gNDsKICAgICAgdHJ5IHsKICAgICAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHJlc3VsdCk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgd2hpbGUgKGJ5dGVzKSB7CiAgICAgICAgICByZXN1bHQgPSByZXN1bHQucmVwbGFjZShwZXJjZW50U2VxdWVuY2UoYnl0ZXMtLSksIHBlcmNlbnREZWNvZGUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9CiAgICB9OwogICAgdmFyIGZpbmQgPSAvWyEnKCl+XXwlMjAvZzsKICAgIHZhciByZXBsYWNlID0gewogICAgICAnISc6ICclMjEnLAogICAgICAiJyI6ICclMjcnLAogICAgICAnKCc6ICclMjgnLAogICAgICAnKSc6ICclMjknLAogICAgICAnfic6ICclN0UnLAogICAgICAnJTIwJzogJysnCiAgICB9OwogICAgdmFyIHJlcGxhY2VyID0gZnVuY3Rpb24gcmVwbGFjZXIobWF0Y2gpIHsKICAgICAgcmV0dXJuIHJlcGxhY2VbbWF0Y2hdOwogICAgfTsKICAgIHZhciBzZXJpYWxpemUgPSBmdW5jdGlvbiBzZXJpYWxpemUoaXQpIHsKICAgICAgcmV0dXJuIGVuY29kZVVSSUNvbXBvbmVudChpdCkucmVwbGFjZShmaW5kLCByZXBsYWNlcik7CiAgICB9OwogICAgdmFyIHBhcnNlU2VhcmNoUGFyYW1zID0gZnVuY3Rpb24gcGFyc2VTZWFyY2hQYXJhbXMocmVzdWx0LCBxdWVyeSkgewogICAgICBpZiAocXVlcnkpIHsKICAgICAgICB2YXIgYXR0cmlidXRlcyA9IHF1ZXJ5LnNwbGl0KCcmJyk7CiAgICAgICAgdmFyIGluZGV4ID0gMDsKICAgICAgICB2YXIgYXR0cmlidXRlLCBlbnRyeTsKICAgICAgICB3aGlsZSAoaW5kZXggPCBhdHRyaWJ1dGVzLmxlbmd0aCkgewogICAgICAgICAgYXR0cmlidXRlID0gYXR0cmlidXRlc1tpbmRleCsrXTsKICAgICAgICAgIGlmIChhdHRyaWJ1dGUubGVuZ3RoKSB7CiAgICAgICAgICAgIGVudHJ5ID0gYXR0cmlidXRlLnNwbGl0KCc9Jyk7CiAgICAgICAgICAgIHJlc3VsdC5wdXNoKHsKICAgICAgICAgICAgICBrZXk6IGRlc2VyaWFsaXplKGVudHJ5LnNoaWZ0KCkpLAogICAgICAgICAgICAgIHZhbHVlOiBkZXNlcmlhbGl6ZShlbnRyeS5qb2luKCc9JykpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfTsKICAgIHZhciB1cGRhdGVTZWFyY2hQYXJhbXMgPSBmdW5jdGlvbiB1cGRhdGVTZWFyY2hQYXJhbXMocXVlcnkpIHsKICAgICAgdGhpcy5lbnRyaWVzLmxlbmd0aCA9IDA7CiAgICAgIHBhcnNlU2VhcmNoUGFyYW1zKHRoaXMuZW50cmllcywgcXVlcnkpOwogICAgfTsKICAgIHZhciB2YWxpZGF0ZUFyZ3VtZW50c0xlbmd0aCA9IGZ1bmN0aW9uIHZhbGlkYXRlQXJndW1lbnRzTGVuZ3RoKHBhc3NlZCwgcmVxdWlyZWQpIHsKICAgICAgaWYgKHBhc3NlZCA8IHJlcXVpcmVkKQogICAgICB0aHJvdyBUeXBlRXJyb3IoJ05vdCBlbm91Z2ggYXJndW1lbnRzJyk7CiAgICB9OwogICAgdmFyIFVSTFNlYXJjaFBhcmFtc0l0ZXJhdG9yID0gY3JlYXRlSXRlcmF0b3JDb25zdHJ1Y3RvcihmdW5jdGlvbiBJdGVyYXRvcihwYXJhbXMsIGtpbmQpIHsKICAgICAgc2V0SW50ZXJuYWxTdGF0ZSh0aGlzLCB7CiAgICAgICAgdHlwZTogVVJMX1NFQVJDSF9QQVJBTVNfSVRFUkFUT1IsCiAgICAgICAgaXRlcmF0b3I6IGdldEl0ZXJhdG9yKGdldEludGVybmFsUGFyYW1zU3RhdGUocGFyYW1zKS5lbnRyaWVzKSwKICAgICAgICBraW5kOiBraW5kCiAgICAgIH0pOwogICAgfSwgJ0l0ZXJhdG9yJywgZnVuY3Rpb24gbmV4dCgpIHsKICAgICAgdmFyIHN0YXRlID0gZ2V0SW50ZXJuYWxJdGVyYXRvclN0YXRlKHRoaXMpOwogICAgICB2YXIga2luZCA9IHN0YXRlLmtpbmQ7CiAgICAgIHZhciBzdGVwID0gc3RhdGUuaXRlcmF0b3IubmV4dCgpOwogICAgICB2YXIgZW50cnkgPSBzdGVwLnZhbHVlOwogICAgICBpZiAoIXN0ZXAuZG9uZSkgewogICAgICAgIHN0ZXAudmFsdWUgPSBraW5kID09PSAna2V5cycgPyBlbnRyeS5rZXkgOiBraW5kID09PSAndmFsdWVzJyA/IGVudHJ5LnZhbHVlIDogWwogICAgICAgIGVudHJ5LmtleSwKICAgICAgICBlbnRyeS52YWx1ZV07CgogICAgICB9CiAgICAgIHJldHVybiBzdGVwOwogICAgfSk7CiAgICB2YXIgVVJMU2VhcmNoUGFyYW1zQ29uc3RydWN0b3IgPSBmdW5jdGlvbiBVUkxTZWFyY2hQYXJhbXMoKSB7CiAgICAgIGFuSW5zdGFuY2UodGhpcywgVVJMU2VhcmNoUGFyYW1zQ29uc3RydWN0b3IsIFVSTF9TRUFSQ0hfUEFSQU1TKTsKICAgICAgdmFyIGluaXQgPSBhcmd1bWVudHMubGVuZ3RoID4gMCA/IGFyZ3VtZW50c1swXSA6IHVuZGVmaW5lZDsKICAgICAgdmFyIHRoYXQgPSB0aGlzOwogICAgICB2YXIgZW50cmllcyA9IFtdOwogICAgICB2YXIgaXRlcmF0b3JNZXRob2QsIGl0ZXJhdG9yLCBuZXh0LCBzdGVwLCBlbnRyeUl0ZXJhdG9yLCBlbnRyeU5leHQsIGZpcnN0LCBzZWNvbmQsIGtleTsKICAgICAgc2V0SW50ZXJuYWxTdGF0ZSh0aGF0LCB7CiAgICAgICAgdHlwZTogVVJMX1NFQVJDSF9QQVJBTVMsCiAgICAgICAgZW50cmllczogZW50cmllcywKICAgICAgICB1cGRhdGVVUkw6IGZ1bmN0aW9uIHVwZGF0ZVVSTCgpIHsKICAgICAgICB9LAogICAgICAgIHVwZGF0ZVNlYXJjaFBhcmFtczogdXBkYXRlU2VhcmNoUGFyYW1zCiAgICAgIH0pOwogICAgICBpZiAoaW5pdCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgaWYgKGlzT2JqZWN0KGluaXQpKSB7CiAgICAgICAgICBpdGVyYXRvck1ldGhvZCA9IGdldEl0ZXJhdG9yTWV0aG9kKGluaXQpOwogICAgICAgICAgaWYgKHR5cGVvZiBpdGVyYXRvck1ldGhvZCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICBpdGVyYXRvciA9IGl0ZXJhdG9yTWV0aG9kLmNhbGwoaW5pdCk7CiAgICAgICAgICAgIG5leHQgPSBpdGVyYXRvci5uZXh0OwogICAgICAgICAgICB3aGlsZSAoIShzdGVwID0gbmV4dC5jYWxsKGl0ZXJhdG9yKSkuZG9uZSkgewogICAgICAgICAgICAgIGVudHJ5SXRlcmF0b3IgPSBnZXRJdGVyYXRvcihhbk9iamVjdChzdGVwLnZhbHVlKSk7CiAgICAgICAgICAgICAgZW50cnlOZXh0ID0gZW50cnlJdGVyYXRvci5uZXh0OwogICAgICAgICAgICAgIGlmICgoZmlyc3QgPSBlbnRyeU5leHQuY2FsbChlbnRyeUl0ZXJhdG9yKSkuZG9uZSB8fCAoc2Vjb25kID0gZW50cnlOZXh0LmNhbGwoZW50cnlJdGVyYXRvcikpLmRvbmUgfHwgIWVudHJ5TmV4dC5jYWxsKGVudHJ5SXRlcmF0b3IpLmRvbmUpCiAgICAgICAgICAgICAgdGhyb3cgVHlwZUVycm9yKCdFeHBlY3RlZCBzZXF1ZW5jZSB3aXRoIGxlbmd0aCAyJyk7CiAgICAgICAgICAgICAgZW50cmllcy5wdXNoKHsKICAgICAgICAgICAgICAgIGtleTogZmlyc3QudmFsdWUgKyAnJywKICAgICAgICAgICAgICAgIHZhbHVlOiBzZWNvbmQudmFsdWUgKyAnJwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UKICAgICAgICAgIGZvciAoa2V5IGluIGluaXQpCiAgICAgICAgICBpZiAoaGFzT3duKGluaXQsIGtleSkpCiAgICAgICAgICBlbnRyaWVzLnB1c2goewogICAgICAgICAgICBrZXk6IGtleSwKICAgICAgICAgICAgdmFsdWU6IGluaXRba2V5XSArICcnCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcGFyc2VTZWFyY2hQYXJhbXMoZW50cmllcywgdHlwZW9mIGluaXQgPT09ICdzdHJpbmcnID8gaW5pdC5jaGFyQXQoMCkgPT09ICc/JyA/IGluaXQuc2xpY2UoMSkgOiBpbml0IDogaW5pdCArICcnKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgICB2YXIgVVJMU2VhcmNoUGFyYW1zUHJvdG90eXBlID0gVVJMU2VhcmNoUGFyYW1zQ29uc3RydWN0b3IucHJvdG90eXBlOwogICAgcmVkZWZpbmVBbGwoVVJMU2VhcmNoUGFyYW1zUHJvdG90eXBlLCB7CiAgICAgIGFwcGVuZDogZnVuY3Rpb24gYXBwZW5kKG5hbWUsIHZhbHVlKSB7CiAgICAgICAgdmFsaWRhdGVBcmd1bWVudHNMZW5ndGgoYXJndW1lbnRzLmxlbmd0aCwgMik7CiAgICAgICAgdmFyIHN0YXRlID0gZ2V0SW50ZXJuYWxQYXJhbXNTdGF0ZSh0aGlzKTsKICAgICAgICBzdGF0ZS5lbnRyaWVzLnB1c2goewogICAgICAgICAga2V5OiBuYW1lICsgJycsCiAgICAgICAgICB2YWx1ZTogdmFsdWUgKyAnJwogICAgICAgIH0pOwogICAgICAgIHN0YXRlLnVwZGF0ZVVSTCgpOwogICAgICB9LAogICAgICAnZGVsZXRlJzogZnVuY3Rpb24gX2RlbGV0ZShuYW1lKSB7CiAgICAgICAgdmFsaWRhdGVBcmd1bWVudHNMZW5ndGgoYXJndW1lbnRzLmxlbmd0aCwgMSk7CiAgICAgICAgdmFyIHN0YXRlID0gZ2V0SW50ZXJuYWxQYXJhbXNTdGF0ZSh0aGlzKTsKICAgICAgICB2YXIgZW50cmllcyA9IHN0YXRlLmVudHJpZXM7CiAgICAgICAgdmFyIGtleSA9IG5hbWUgKyAnJzsKICAgICAgICB2YXIgaW5kZXggPSAwOwogICAgICAgIHdoaWxlIChpbmRleCA8IGVudHJpZXMubGVuZ3RoKSB7CiAgICAgICAgICBpZiAoZW50cmllc1tpbmRleF0ua2V5ID09PSBrZXkpCiAgICAgICAgICBlbnRyaWVzLnNwbGljZShpbmRleCwgMSk7ZWxzZQoKICAgICAgICAgIGluZGV4Kys7CiAgICAgICAgfQogICAgICAgIHN0YXRlLnVwZGF0ZVVSTCgpOwogICAgICB9LAogICAgICBnZXQ6IGZ1bmN0aW9uIGdldChuYW1lKSB7CiAgICAgICAgdmFsaWRhdGVBcmd1bWVudHNMZW5ndGgoYXJndW1lbnRzLmxlbmd0aCwgMSk7CiAgICAgICAgdmFyIGVudHJpZXMgPSBnZXRJbnRlcm5hbFBhcmFtc1N0YXRlKHRoaXMpLmVudHJpZXM7CiAgICAgICAgdmFyIGtleSA9IG5hbWUgKyAnJzsKICAgICAgICB2YXIgaW5kZXggPSAwOwogICAgICAgIGZvciAoOyBpbmRleCA8IGVudHJpZXMubGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICBpZiAoZW50cmllc1tpbmRleF0ua2V5ID09PSBrZXkpCiAgICAgICAgICByZXR1cm4gZW50cmllc1tpbmRleF0udmFsdWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgICB9LAogICAgICBnZXRBbGw6IGZ1bmN0aW9uIGdldEFsbChuYW1lKSB7CiAgICAgICAgdmFsaWRhdGVBcmd1bWVudHNMZW5ndGgoYXJndW1lbnRzLmxlbmd0aCwgMSk7CiAgICAgICAgdmFyIGVudHJpZXMgPSBnZXRJbnRlcm5hbFBhcmFtc1N0YXRlKHRoaXMpLmVudHJpZXM7CiAgICAgICAgdmFyIGtleSA9IG5hbWUgKyAnJzsKICAgICAgICB2YXIgcmVzdWx0ID0gW107CiAgICAgICAgdmFyIGluZGV4ID0gMDsKICAgICAgICBmb3IgKDsgaW5kZXggPCBlbnRyaWVzLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgaWYgKGVudHJpZXNbaW5kZXhdLmtleSA9PT0ga2V5KQogICAgICAgICAgcmVzdWx0LnB1c2goZW50cmllc1tpbmRleF0udmFsdWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9LAogICAgICBoYXM6IGZ1bmN0aW9uIGhhcyhuYW1lKSB7CiAgICAgICAgdmFsaWRhdGVBcmd1bWVudHNMZW5ndGgoYXJndW1lbnRzLmxlbmd0aCwgMSk7CiAgICAgICAgdmFyIGVudHJpZXMgPSBnZXRJbnRlcm5hbFBhcmFtc1N0YXRlKHRoaXMpLmVudHJpZXM7CiAgICAgICAgdmFyIGtleSA9IG5hbWUgKyAnJzsKICAgICAgICB2YXIgaW5kZXggPSAwOwogICAgICAgIHdoaWxlIChpbmRleCA8IGVudHJpZXMubGVuZ3RoKSB7CiAgICAgICAgICBpZiAoZW50cmllc1tpbmRleCsrXS5rZXkgPT09IGtleSkKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0sCiAgICAgIHNldDogZnVuY3Rpb24gc2V0KG5hbWUsIHZhbHVlKSB7CiAgICAgICAgdmFsaWRhdGVBcmd1bWVudHNMZW5ndGgoYXJndW1lbnRzLmxlbmd0aCwgMSk7CiAgICAgICAgdmFyIHN0YXRlID0gZ2V0SW50ZXJuYWxQYXJhbXNTdGF0ZSh0aGlzKTsKICAgICAgICB2YXIgZW50cmllcyA9IHN0YXRlLmVudHJpZXM7CiAgICAgICAgdmFyIGZvdW5kID0gZmFsc2U7CiAgICAgICAgdmFyIGtleSA9IG5hbWUgKyAnJzsKICAgICAgICB2YXIgdmFsID0gdmFsdWUgKyAnJzsKICAgICAgICB2YXIgaW5kZXggPSAwOwogICAgICAgIHZhciBlbnRyeTsKICAgICAgICBmb3IgKDsgaW5kZXggPCBlbnRyaWVzLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgZW50cnkgPSBlbnRyaWVzW2luZGV4XTsKICAgICAgICAgIGlmIChlbnRyeS5rZXkgPT09IGtleSkgewogICAgICAgICAgICBpZiAoZm91bmQpCiAgICAgICAgICAgIGVudHJpZXMuc3BsaWNlKGluZGV4LS0sIDEpO2Vsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICBlbnRyeS52YWx1ZSA9IHZhbDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIWZvdW5kKQogICAgICAgIGVudHJpZXMucHVzaCh7CiAgICAgICAgICBrZXk6IGtleSwKICAgICAgICAgIHZhbHVlOiB2YWwKICAgICAgICB9KTsKICAgICAgICBzdGF0ZS51cGRhdGVVUkwoKTsKICAgICAgfSwKICAgICAgc29ydDogZnVuY3Rpb24gc29ydCgpIHsKICAgICAgICB2YXIgc3RhdGUgPSBnZXRJbnRlcm5hbFBhcmFtc1N0YXRlKHRoaXMpOwogICAgICAgIHZhciBlbnRyaWVzID0gc3RhdGUuZW50cmllczsKICAgICAgICB2YXIgc2xpY2UgPSBlbnRyaWVzLnNsaWNlKCk7CiAgICAgICAgdmFyIGVudHJ5LCBlbnRyaWVzSW5kZXgsIHNsaWNlSW5kZXg7CiAgICAgICAgZW50cmllcy5sZW5ndGggPSAwOwogICAgICAgIGZvciAoc2xpY2VJbmRleCA9IDA7IHNsaWNlSW5kZXggPCBzbGljZS5sZW5ndGg7IHNsaWNlSW5kZXgrKykgewogICAgICAgICAgZW50cnkgPSBzbGljZVtzbGljZUluZGV4XTsKICAgICAgICAgIGZvciAoZW50cmllc0luZGV4ID0gMDsgZW50cmllc0luZGV4IDwgc2xpY2VJbmRleDsgZW50cmllc0luZGV4KyspIHsKICAgICAgICAgICAgaWYgKGVudHJpZXNbZW50cmllc0luZGV4XS5rZXkgPiBlbnRyeS5rZXkpIHsKICAgICAgICAgICAgICBlbnRyaWVzLnNwbGljZShlbnRyaWVzSW5kZXgsIDAsIGVudHJ5KTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKGVudHJpZXNJbmRleCA9PT0gc2xpY2VJbmRleCkKICAgICAgICAgIGVudHJpZXMucHVzaChlbnRyeSk7CiAgICAgICAgfQogICAgICAgIHN0YXRlLnVwZGF0ZVVSTCgpOwogICAgICB9LAogICAgICBmb3JFYWNoOiBmdW5jdGlvbiBmb3JFYWNoKGNhbGxiYWNrKSB7CiAgICAgICAgdmFyIGVudHJpZXMgPSBnZXRJbnRlcm5hbFBhcmFtc1N0YXRlKHRoaXMpLmVudHJpZXM7CiAgICAgICAgdmFyIGJvdW5kRnVuY3Rpb24gPSBiaW5kKGNhbGxiYWNrLCBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZCwgMyk7CiAgICAgICAgdmFyIGluZGV4ID0gMDsKICAgICAgICB2YXIgZW50cnk7CiAgICAgICAgd2hpbGUgKGluZGV4IDwgZW50cmllcy5sZW5ndGgpIHsKICAgICAgICAgIGVudHJ5ID0gZW50cmllc1tpbmRleCsrXTsKICAgICAgICAgIGJvdW5kRnVuY3Rpb24oZW50cnkudmFsdWUsIGVudHJ5LmtleSwgdGhpcyk7CiAgICAgICAgfQogICAgICB9LAogICAgICBrZXlzOiBmdW5jdGlvbiBrZXlzKCkgewogICAgICAgIHJldHVybiBuZXcgVVJMU2VhcmNoUGFyYW1zSXRlcmF0b3IodGhpcywgJ2tleXMnKTsKICAgICAgfSwKICAgICAgdmFsdWVzOiBmdW5jdGlvbiB2YWx1ZXMoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBVUkxTZWFyY2hQYXJhbXNJdGVyYXRvcih0aGlzLCAndmFsdWVzJyk7CiAgICAgIH0sCiAgICAgIGVudHJpZXM6IGZ1bmN0aW9uIGVudHJpZXMoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBVUkxTZWFyY2hQYXJhbXNJdGVyYXRvcih0aGlzLCAnZW50cmllcycpOwogICAgICB9CiAgICB9LCB7IGVudW1lcmFibGU6IHRydWUgfSk7CiAgICByZWRlZmluZShVUkxTZWFyY2hQYXJhbXNQcm90b3R5cGUsIElURVJBVE9SLCBVUkxTZWFyY2hQYXJhbXNQcm90b3R5cGUuZW50cmllcyk7CiAgICByZWRlZmluZShVUkxTZWFyY2hQYXJhbXNQcm90b3R5cGUsICd0b1N0cmluZycsIGZ1bmN0aW9uIHRvU3RyaW5nKCkgewogICAgICB2YXIgZW50cmllcyA9IGdldEludGVybmFsUGFyYW1zU3RhdGUodGhpcykuZW50cmllczsKICAgICAgdmFyIHJlc3VsdCA9IFtdOwogICAgICB2YXIgaW5kZXggPSAwOwogICAgICB2YXIgZW50cnk7CiAgICAgIHdoaWxlIChpbmRleCA8IGVudHJpZXMubGVuZ3RoKSB7CiAgICAgICAgZW50cnkgPSBlbnRyaWVzW2luZGV4KytdOwogICAgICAgIHJlc3VsdC5wdXNoKHNlcmlhbGl6ZShlbnRyeS5rZXkpICsgJz0nICsgc2VyaWFsaXplKGVudHJ5LnZhbHVlKSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHJlc3VsdC5qb2luKCcmJyk7CiAgICB9LCB7IGVudW1lcmFibGU6IHRydWUgfSk7CiAgICBzZXRUb1N0cmluZ1RhZyhVUkxTZWFyY2hQYXJhbXNDb25zdHJ1Y3RvciwgVVJMX1NFQVJDSF9QQVJBTVMpOwogICAgJCh7CiAgICAgIGdsb2JhbDogdHJ1ZSwKICAgICAgZm9yY2VkOiAhVVNFX05BVElWRV9VUkwKICAgIH0sIHsgVVJMU2VhcmNoUGFyYW1zOiBVUkxTZWFyY2hQYXJhbXNDb25zdHJ1Y3RvciB9KTsKICAgIGlmICghVVNFX05BVElWRV9VUkwgJiYgdHlwZW9mICRmZXRjaCA9PSAnZnVuY3Rpb24nICYmIHR5cGVvZiBIZWFkZXJzID09ICdmdW5jdGlvbicpIHsKICAgICAgJCh7CiAgICAgICAgZ2xvYmFsOiB0cnVlLAogICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgZm9yY2VkOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBmZXRjaDogZnVuY3Rpb24gZmV0Y2goaW5wdXQpIHsKICAgICAgICAgIHZhciBhcmdzID0gW2lucHV0XTsKICAgICAgICAgIHZhciBpbml0LCBib2R5LCBoZWFkZXJzOwogICAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgIGluaXQgPSBhcmd1bWVudHNbMV07CiAgICAgICAgICAgIGlmIChpc09iamVjdChpbml0KSkgewogICAgICAgICAgICAgIGJvZHkgPSBpbml0LmJvZHk7CiAgICAgICAgICAgICAgaWYgKGNsYXNzb2YoYm9keSkgPT09IFVSTF9TRUFSQ0hfUEFSQU1TKSB7CiAgICAgICAgICAgICAgICBoZWFkZXJzID0gaW5pdC5oZWFkZXJzID8gbmV3IEhlYWRlcnMoaW5pdC5oZWFkZXJzKSA6IG5ldyBIZWFkZXJzKCk7CiAgICAgICAgICAgICAgICBpZiAoIWhlYWRlcnMuaGFzKCdjb250ZW50LXR5cGUnKSkgewogICAgICAgICAgICAgICAgICBoZWFkZXJzLnNldCgnY29udGVudC10eXBlJywgJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZDtjaGFyc2V0PVVURi04Jyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpbml0ID0gY3JlYXRlKGluaXQsIHsKICAgICAgICAgICAgICAgICAgYm9keTogY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yKDAsIFN0cmluZyhib2R5KSksCiAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IGNyZWF0ZVByb3BlcnR5RGVzY3JpcHRvcigwLCBoZWFkZXJzKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGFyZ3MucHVzaChpbml0KTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiAkZmV0Y2guYXBwbHkodGhpcywgYXJncyk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIG1vZHVsZS5leHBvcnRzID0gewogICAgICBVUkxTZWFyY2hQYXJhbXM6IFVSTFNlYXJjaFBhcmFtc0NvbnN0cnVjdG9yLAogICAgICBnZXRTdGF0ZTogZ2V0SW50ZXJuYWxQYXJhbXNTdGF0ZQogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogMTMzICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGFuT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygyMyk7CiAgICB2YXIgZ2V0SXRlcmF0b3JNZXRob2QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDkwKTsKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7CiAgICAgIHZhciBpdGVyYXRvck1ldGhvZCA9IGdldEl0ZXJhdG9yTWV0aG9kKGl0KTsKICAgICAgaWYgKHR5cGVvZiBpdGVyYXRvck1ldGhvZCAhPSAnZnVuY3Rpb24nKSB7CiAgICAgICAgdGhyb3cgVHlwZUVycm9yKFN0cmluZyhpdCkgKyAnIGlzIG5vdCBpdGVyYWJsZScpOwogICAgICB9CiAgICAgIHJldHVybiBhbk9iamVjdChpdGVyYXRvck1ldGhvZC5jYWxsKGl0KSk7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAxMzQgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyICQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUpOwogICAgJCh7CiAgICAgIHRhcmdldDogJ1VSTCcsCiAgICAgIHByb3RvOiB0cnVlLAogICAgICBlbnVtZXJhYmxlOiB0cnVlCiAgICB9LCB7CiAgICAgIHRvSlNPTjogZnVuY3Rpb24gdG9KU09OKCkgewogICAgICAgIHJldHVybiBVUkwucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodGhpcyk7CiAgICAgIH0KICAgIH0pOwoKICAgIC8qKiovfSksICgKICAvKiAxMzUgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAoZnVuY3Rpb24gKGdsb2JhbCwgZmFjdG9yeSkgewogICAgICB0cnVlID8gZmFjdG9yeShleHBvcnRzKSA6IHVuZGVmaW5lZDsKICAgIH0pKHRoaXMsIGZ1bmN0aW9uIChleHBvcnRzKSB7CiAgICAgICd1c2Ugc3RyaWN0JzsKICAgICAgdmFyIFN5bWJvbFBvbHlmaWxsID0gdHlwZW9mIFN5bWJvbCA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAnc3ltYm9sJyA/IFN5bWJvbCA6IGZ1bmN0aW9uIChkZXNjcmlwdGlvbikgewogICAgICAgIHJldHVybiAiU3ltYm9sKCIgKyBkZXNjcmlwdGlvbiArICIpIjsKICAgICAgfTsKICAgICAgZnVuY3Rpb24gbm9vcCgpIHsKICAgICAgfQogICAgICB2YXIgTnVtYmVySXNOYU4gPSBOdW1iZXIuaXNOYU4gfHwgZnVuY3Rpb24gKHgpIHsKICAgICAgICByZXR1cm4geCAhPT0geDsKICAgICAgfTsKICAgICAgdmFyIHJldGhyb3dBc3NlcnRpb25FcnJvclJlamVjdGlvbiA9IG5vb3A7CiAgICAgIGZ1bmN0aW9uIHR5cGVJc09iamVjdCh4KSB7CiAgICAgICAgcmV0dXJuIHR5cGVvZiB4ID09PSAnb2JqZWN0JyAmJiB4ICE9PSBudWxsIHx8IHR5cGVvZiB4ID09PSAnZnVuY3Rpb24nOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGNyZWF0ZUFycmF5RnJvbUxpc3QoZWxlbWVudHMpIHsKICAgICAgICByZXR1cm4gZWxlbWVudHMuc2xpY2UoKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBBcnJheUJ1ZmZlckNvcHkoZGVzdCwgZGVzdE9mZnNldCwgc3JjLCBzcmNPZmZzZXQsIG4pIHsKICAgICAgICBuZXcgVWludDhBcnJheShkZXN0KS5zZXQobmV3IFVpbnQ4QXJyYXkoc3JjLCBzcmNPZmZzZXQsIG4pLCBkZXN0T2Zmc2V0KTsKICAgICAgfQogICAgICBmdW5jdGlvbiBJc0Zpbml0ZU5vbk5lZ2F0aXZlTnVtYmVyKHYpIHsKICAgICAgICBpZiAoSXNOb25OZWdhdGl2ZU51bWJlcih2KSA9PT0gZmFsc2UpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKHYgPT09IEluZmluaXR5KSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIElzTm9uTmVnYXRpdmVOdW1iZXIodikgewogICAgICAgIGlmICh0eXBlb2YgdiAhPT0gJ251bWJlcicpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKE51bWJlcklzTmFOKHYpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmICh2IDwgMCkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBmdW5jdGlvbiBDYWxsKEYsIFYsIGFyZ3MpIHsKICAgICAgICBpZiAodHlwZW9mIEYgIT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0FyZ3VtZW50IGlzIG5vdCBhIGZ1bmN0aW9uJyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBGdW5jdGlvbi5wcm90b3R5cGUuYXBwbHkuY2FsbChGLCBWLCBhcmdzKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBDcmVhdGVBbGdvcml0aG1Gcm9tVW5kZXJseWluZ01ldGhvZCh1bmRlcmx5aW5nT2JqZWN0LCBtZXRob2ROYW1lLCBhbGdvQXJnQ291bnQsIGV4dHJhQXJncykgewogICAgICAgIHZhciBtZXRob2QgPSB1bmRlcmx5aW5nT2JqZWN0W21ldGhvZE5hbWVdOwogICAgICAgIGlmIChtZXRob2QgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgaWYgKHR5cGVvZiBtZXRob2QgIT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihtZXRob2QgKyAiIGlzIG5vdCBhIG1ldGhvZCIpOwogICAgICAgICAgfQogICAgICAgICAgc3dpdGNoIChhbGdvQXJnQ291bnQpIHsKICAgICAgICAgICAgY2FzZSAwOnsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlQ2FsbChtZXRob2QsIHVuZGVybHlpbmdPYmplY3QsIGV4dHJhQXJncyk7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAxOnsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoYXJnKSB7CiAgICAgICAgICAgICAgICAgIHZhciBmdWxsQXJncyA9IFthcmddLmNvbmNhdChleHRyYUFyZ3MpOwogICAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZUNhbGwobWV0aG9kLCB1bmRlcmx5aW5nT2JqZWN0LCBmdWxsQXJncyk7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBwcm9taXNlUmVzb2x2ZWRXaXRoKHVuZGVmaW5lZCk7CiAgICAgICAgfTsKICAgICAgfQogICAgICBmdW5jdGlvbiBJbnZva2VPck5vb3AoTywgUCwgYXJncykgewogICAgICAgIHZhciBtZXRob2QgPSBPW1BdOwogICAgICAgIGlmIChtZXRob2QgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIENhbGwobWV0aG9kLCBPLCBhcmdzKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBQcm9taXNlQ2FsbChGLCBWLCBhcmdzKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJldHVybiBwcm9taXNlUmVzb2x2ZWRXaXRoKENhbGwoRiwgViwgYXJncykpOwogICAgICAgIH0gY2F0Y2ggKHZhbHVlKSB7CiAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aCh2YWx1ZSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIFRyYW5zZmVyQXJyYXlCdWZmZXIoTykgewogICAgICAgIHJldHVybiBPOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIElzRGV0YWNoZWRCdWZmZXIoTykgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBmdW5jdGlvbiBWYWxpZGF0ZUFuZE5vcm1hbGl6ZUhpZ2hXYXRlck1hcmsoaGlnaFdhdGVyTWFyaykgewogICAgICAgIGhpZ2hXYXRlck1hcmsgPSBOdW1iZXIoaGlnaFdhdGVyTWFyayk7CiAgICAgICAgaWYgKE51bWJlcklzTmFOKGhpZ2hXYXRlck1hcmspIHx8IGhpZ2hXYXRlck1hcmsgPCAwKSB7CiAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignaGlnaFdhdGVyTWFyayBwcm9wZXJ0eSBvZiBhIHF1ZXVpbmcgc3RyYXRlZ3kgbXVzdCBiZSBub24tbmVnYXRpdmUgYW5kIG5vbi1OYU4nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGhpZ2hXYXRlck1hcms7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gTWFrZVNpemVBbGdvcml0aG1Gcm9tU2l6ZUZ1bmN0aW9uKHNpemUpIHsKICAgICAgICBpZiAoc2l6ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGlmICh0eXBlb2Ygc2l6ZSAhPT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignc2l6ZSBwcm9wZXJ0eSBvZiBhIHF1ZXVpbmcgc3RyYXRlZ3kgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmdW5jdGlvbiAoY2h1bmspIHsKICAgICAgICAgIHJldHVybiBzaXplKGNodW5rKTsKICAgICAgICB9OwogICAgICB9CiAgICAgIHZhciBvcmlnaW5hbFByb21pc2UgPSBQcm9taXNlOwogICAgICB2YXIgb3JpZ2luYWxQcm9taXNlVGhlbiA9IFByb21pc2UucHJvdG90eXBlLnRoZW47CiAgICAgIHZhciBvcmlnaW5hbFByb21pc2VSZXNvbHZlID0gUHJvbWlzZS5yZXNvbHZlLmJpbmQob3JpZ2luYWxQcm9taXNlKTsKICAgICAgdmFyIG9yaWdpbmFsUHJvbWlzZVJlamVjdCA9IFByb21pc2UucmVqZWN0LmJpbmQob3JpZ2luYWxQcm9taXNlKTsKICAgICAgZnVuY3Rpb24gbmV3UHJvbWlzZShleGVjdXRvcikgewogICAgICAgIHJldHVybiBuZXcgb3JpZ2luYWxQcm9taXNlKGV4ZWN1dG9yKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBwcm9taXNlUmVzb2x2ZWRXaXRoKHZhbHVlKSB7CiAgICAgICAgcmV0dXJuIG9yaWdpbmFsUHJvbWlzZVJlc29sdmUodmFsdWUpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHByb21pc2VSZWplY3RlZFdpdGgocmVhc29uKSB7CiAgICAgICAgcmV0dXJuIG9yaWdpbmFsUHJvbWlzZVJlamVjdChyZWFzb24pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFBlcmZvcm1Qcm9taXNlVGhlbihwcm9taXNlLCBvbkZ1bGZpbGxlZCwgb25SZWplY3RlZCkgewogICAgICAgIHJldHVybiBvcmlnaW5hbFByb21pc2VUaGVuLmNhbGwocHJvbWlzZSwgb25GdWxmaWxsZWQsIG9uUmVqZWN0ZWQpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHVwb25Qcm9taXNlKHByb21pc2UsIG9uRnVsZmlsbGVkLCBvblJlamVjdGVkKSB7CiAgICAgICAgUGVyZm9ybVByb21pc2VUaGVuKFBlcmZvcm1Qcm9taXNlVGhlbihwcm9taXNlLCBvbkZ1bGZpbGxlZCwgb25SZWplY3RlZCksIHVuZGVmaW5lZCwgcmV0aHJvd0Fzc2VydGlvbkVycm9yUmVqZWN0aW9uKTsKICAgICAgfQogICAgICBmdW5jdGlvbiB1cG9uRnVsZmlsbG1lbnQocHJvbWlzZSwgb25GdWxmaWxsZWQpIHsKICAgICAgICB1cG9uUHJvbWlzZShwcm9taXNlLCBvbkZ1bGZpbGxlZCk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gdXBvblJlamVjdGlvbihwcm9taXNlLCBvblJlamVjdGVkKSB7CiAgICAgICAgdXBvblByb21pc2UocHJvbWlzZSwgdW5kZWZpbmVkLCBvblJlamVjdGVkKTsKICAgICAgfQogICAgICBmdW5jdGlvbiB0cmFuc2Zvcm1Qcm9taXNlV2l0aChwcm9taXNlLCBmdWxmaWxsbWVudEhhbmRsZXIsIHJlamVjdGlvbkhhbmRsZXIpIHsKICAgICAgICByZXR1cm4gUGVyZm9ybVByb21pc2VUaGVuKHByb21pc2UsIGZ1bGZpbGxtZW50SGFuZGxlciwgcmVqZWN0aW9uSGFuZGxlcik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gc2V0UHJvbWlzZUlzSGFuZGxlZFRvVHJ1ZShwcm9taXNlKSB7CiAgICAgICAgUGVyZm9ybVByb21pc2VUaGVuKHByb21pc2UsIHVuZGVmaW5lZCwgcmV0aHJvd0Fzc2VydGlvbkVycm9yUmVqZWN0aW9uKTsKICAgICAgfQogICAgICB2YXIgUVVFVUVfTUFYX0FSUkFZX1NJWkUgPSAxNjM4NDsKICAgICAgdmFyIFNpbXBsZVF1ZXVlID0gZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIFNpbXBsZVF1ZXVlKCkgewogICAgICAgICAgdGhpcy5fY3Vyc29yID0gMDsKICAgICAgICAgIHRoaXMuX3NpemUgPSAwOwogICAgICAgICAgdGhpcy5fZnJvbnQgPSB7CiAgICAgICAgICAgIF9lbGVtZW50czogW10sCiAgICAgICAgICAgIF9uZXh0OiB1bmRlZmluZWQKICAgICAgICAgIH07CiAgICAgICAgICB0aGlzLl9iYWNrID0gdGhpcy5fZnJvbnQ7CiAgICAgICAgICB0aGlzLl9jdXJzb3IgPSAwOwogICAgICAgICAgdGhpcy5fc2l6ZSA9IDA7CiAgICAgICAgfQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTaW1wbGVRdWV1ZS5wcm90b3R5cGUsICJsZW5ndGgiLCB7CiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NpemU7CiAgICAgICAgICB9LAogICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIFNpbXBsZVF1ZXVlLnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24gKGVsZW1lbnQpIHsKICAgICAgICAgIHZhciBvbGRCYWNrID0gdGhpcy5fYmFjazsKICAgICAgICAgIHZhciBuZXdCYWNrID0gb2xkQmFjazsKICAgICAgICAgIGlmIChvbGRCYWNrLl9lbGVtZW50cy5sZW5ndGggPT09IFFVRVVFX01BWF9BUlJBWV9TSVpFIC0gMSkgewogICAgICAgICAgICBuZXdCYWNrID0gewogICAgICAgICAgICAgIF9lbGVtZW50czogW10sCiAgICAgICAgICAgICAgX25leHQ6IHVuZGVmaW5lZAogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgICAgb2xkQmFjay5fZWxlbWVudHMucHVzaChlbGVtZW50KTsKICAgICAgICAgIGlmIChuZXdCYWNrICE9PSBvbGRCYWNrKSB7CiAgICAgICAgICAgIHRoaXMuX2JhY2sgPSBuZXdCYWNrOwogICAgICAgICAgICBvbGRCYWNrLl9uZXh0ID0gbmV3QmFjazsKICAgICAgICAgIH0KICAgICAgICAgICsrdGhpcy5fc2l6ZTsKICAgICAgICB9OwogICAgICAgIFNpbXBsZVF1ZXVlLnByb3RvdHlwZS5zaGlmdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBvbGRGcm9udCA9IHRoaXMuX2Zyb250OwogICAgICAgICAgdmFyIG5ld0Zyb250ID0gb2xkRnJvbnQ7CiAgICAgICAgICB2YXIgb2xkQ3Vyc29yID0gdGhpcy5fY3Vyc29yOwogICAgICAgICAgdmFyIG5ld0N1cnNvciA9IG9sZEN1cnNvciArIDE7CiAgICAgICAgICB2YXIgZWxlbWVudHMgPSBvbGRGcm9udC5fZWxlbWVudHM7CiAgICAgICAgICB2YXIgZWxlbWVudCA9IGVsZW1lbnRzW29sZEN1cnNvcl07CiAgICAgICAgICBpZiAobmV3Q3Vyc29yID09PSBRVUVVRV9NQVhfQVJSQVlfU0laRSkgewogICAgICAgICAgICBuZXdGcm9udCA9IG9sZEZyb250Ll9uZXh0OwogICAgICAgICAgICBuZXdDdXJzb3IgPSAwOwogICAgICAgICAgfQogICAgICAgICAgLS10aGlzLl9zaXplOwogICAgICAgICAgdGhpcy5fY3Vyc29yID0gbmV3Q3Vyc29yOwogICAgICAgICAgaWYgKG9sZEZyb250ICE9PSBuZXdGcm9udCkgewogICAgICAgICAgICB0aGlzLl9mcm9udCA9IG5ld0Zyb250OwogICAgICAgICAgfQogICAgICAgICAgZWxlbWVudHNbb2xkQ3Vyc29yXSA9IHVuZGVmaW5lZDsKICAgICAgICAgIHJldHVybiBlbGVtZW50OwogICAgICAgIH07CiAgICAgICAgU2ltcGxlUXVldWUucHJvdG90eXBlLmZvckVhY2ggPSBmdW5jdGlvbiAoY2FsbGJhY2spIHsKICAgICAgICAgIHZhciBpID0gdGhpcy5fY3Vyc29yOwogICAgICAgICAgdmFyIG5vZGUgPSB0aGlzLl9mcm9udDsKICAgICAgICAgIHZhciBlbGVtZW50cyA9IG5vZGUuX2VsZW1lbnRzOwogICAgICAgICAgd2hpbGUgKGkgIT09IGVsZW1lbnRzLmxlbmd0aCB8fCBub2RlLl9uZXh0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgaWYgKGkgPT09IGVsZW1lbnRzLmxlbmd0aCkgewogICAgICAgICAgICAgIG5vZGUgPSBub2RlLl9uZXh0OwogICAgICAgICAgICAgIGVsZW1lbnRzID0gbm9kZS5fZWxlbWVudHM7CiAgICAgICAgICAgICAgaSA9IDA7CiAgICAgICAgICAgICAgaWYgKGVsZW1lbnRzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhbGxiYWNrKGVsZW1lbnRzW2ldKTsKICAgICAgICAgICAgKytpOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgU2ltcGxlUXVldWUucHJvdG90eXBlLnBlZWsgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgZnJvbnQgPSB0aGlzLl9mcm9udDsKICAgICAgICAgIHZhciBjdXJzb3IgPSB0aGlzLl9jdXJzb3I7CiAgICAgICAgICByZXR1cm4gZnJvbnQuX2VsZW1lbnRzW2N1cnNvcl07CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gU2ltcGxlUXVldWU7CiAgICAgIH0oKTsKICAgICAgZnVuY3Rpb24gUmVhZGFibGVTdHJlYW1DcmVhdGVSZWFkUmVzdWx0KHZhbHVlLCBkb25lLCBmb3JBdXRob3JDb2RlKSB7CiAgICAgICAgdmFyIHByb3RvdHlwZSA9IG51bGw7CiAgICAgICAgaWYgKGZvckF1dGhvckNvZGUgPT09IHRydWUpIHsKICAgICAgICAgIHByb3RvdHlwZSA9IE9iamVjdC5wcm90b3R5cGU7CiAgICAgICAgfQogICAgICAgIHZhciBvYmogPSBPYmplY3QuY3JlYXRlKHByb3RvdHlwZSk7CiAgICAgICAgb2JqLnZhbHVlID0gdmFsdWU7CiAgICAgICAgb2JqLmRvbmUgPSBkb25lOwogICAgICAgIHJldHVybiBvYmo7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmVhZGFibGVTdHJlYW1SZWFkZXJHZW5lcmljSW5pdGlhbGl6ZShyZWFkZXIsIHN0cmVhbSkgewogICAgICAgIHJlYWRlci5fZm9yQXV0aG9yQ29kZSA9IHRydWU7CiAgICAgICAgcmVhZGVyLl9vd25lclJlYWRhYmxlU3RyZWFtID0gc3RyZWFtOwogICAgICAgIHN0cmVhbS5fcmVhZGVyID0gcmVhZGVyOwogICAgICAgIGlmIChzdHJlYW0uX3N0YXRlID09PSAncmVhZGFibGUnKSB7CiAgICAgICAgICBkZWZhdWx0UmVhZGVyQ2xvc2VkUHJvbWlzZUluaXRpYWxpemUocmVhZGVyKTsKICAgICAgICB9IGVsc2UgaWYgKHN0cmVhbS5fc3RhdGUgPT09ICdjbG9zZWQnKSB7CiAgICAgICAgICBkZWZhdWx0UmVhZGVyQ2xvc2VkUHJvbWlzZUluaXRpYWxpemVBc1Jlc29sdmVkKHJlYWRlcik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRlZmF1bHRSZWFkZXJDbG9zZWRQcm9taXNlSW5pdGlhbGl6ZUFzUmVqZWN0ZWQocmVhZGVyLCBzdHJlYW0uX3N0b3JlZEVycm9yKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmVhZGFibGVTdHJlYW1SZWFkZXJHZW5lcmljQ2FuY2VsKHJlYWRlciwgcmVhc29uKSB7CiAgICAgICAgdmFyIHN0cmVhbSA9IHJlYWRlci5fb3duZXJSZWFkYWJsZVN0cmVhbTsKICAgICAgICByZXR1cm4gUmVhZGFibGVTdHJlYW1DYW5jZWwoc3RyZWFtLCByZWFzb24pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlU3RyZWFtUmVhZGVyR2VuZXJpY1JlbGVhc2UocmVhZGVyKSB7CiAgICAgICAgaWYgKHJlYWRlci5fb3duZXJSZWFkYWJsZVN0cmVhbS5fc3RhdGUgPT09ICdyZWFkYWJsZScpIHsKICAgICAgICAgIGRlZmF1bHRSZWFkZXJDbG9zZWRQcm9taXNlUmVqZWN0KHJlYWRlciwgbmV3IFR5cGVFcnJvcignUmVhZGVyIHdhcyByZWxlYXNlZCBhbmQgY2FuIG5vIGxvbmdlciBiZSB1c2VkIHRvIG1vbml0b3IgdGhlIHN0cmVhbVwncyBjbG9zZWRuZXNzJykpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBkZWZhdWx0UmVhZGVyQ2xvc2VkUHJvbWlzZVJlc2V0VG9SZWplY3RlZChyZWFkZXIsIG5ldyBUeXBlRXJyb3IoJ1JlYWRlciB3YXMgcmVsZWFzZWQgYW5kIGNhbiBubyBsb25nZXIgYmUgdXNlZCB0byBtb25pdG9yIHRoZSBzdHJlYW1cJ3MgY2xvc2VkbmVzcycpKTsKICAgICAgICB9CiAgICAgICAgcmVhZGVyLl9vd25lclJlYWRhYmxlU3RyZWFtLl9yZWFkZXIgPSB1bmRlZmluZWQ7CiAgICAgICAgcmVhZGVyLl9vd25lclJlYWRhYmxlU3RyZWFtID0gdW5kZWZpbmVkOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHJlYWRlckxvY2tFeGNlcHRpb24obmFtZSkgewogICAgICAgIHJldHVybiBuZXcgVHlwZUVycm9yKCdDYW5ub3QgJyArIG5hbWUgKyAnIGEgc3RyZWFtIHVzaW5nIGEgcmVsZWFzZWQgcmVhZGVyJyk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZGVmYXVsdFJlYWRlckNsb3NlZFByb21pc2VJbml0aWFsaXplKHJlYWRlcikgewogICAgICAgIHJlYWRlci5fY2xvc2VkUHJvbWlzZSA9IG5ld1Byb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgcmVhZGVyLl9jbG9zZWRQcm9taXNlX3Jlc29sdmUgPSByZXNvbHZlOwogICAgICAgICAgcmVhZGVyLl9jbG9zZWRQcm9taXNlX3JlamVjdCA9IHJlamVjdDsKICAgICAgICB9KTsKICAgICAgfQogICAgICBmdW5jdGlvbiBkZWZhdWx0UmVhZGVyQ2xvc2VkUHJvbWlzZUluaXRpYWxpemVBc1JlamVjdGVkKHJlYWRlciwgcmVhc29uKSB7CiAgICAgICAgZGVmYXVsdFJlYWRlckNsb3NlZFByb21pc2VJbml0aWFsaXplKHJlYWRlcik7CiAgICAgICAgZGVmYXVsdFJlYWRlckNsb3NlZFByb21pc2VSZWplY3QocmVhZGVyLCByZWFzb24pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGRlZmF1bHRSZWFkZXJDbG9zZWRQcm9taXNlSW5pdGlhbGl6ZUFzUmVzb2x2ZWQocmVhZGVyKSB7CiAgICAgICAgZGVmYXVsdFJlYWRlckNsb3NlZFByb21pc2VJbml0aWFsaXplKHJlYWRlcik7CiAgICAgICAgZGVmYXVsdFJlYWRlckNsb3NlZFByb21pc2VSZXNvbHZlKHJlYWRlcik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZGVmYXVsdFJlYWRlckNsb3NlZFByb21pc2VSZWplY3QocmVhZGVyLCByZWFzb24pIHsKICAgICAgICBzZXRQcm9taXNlSXNIYW5kbGVkVG9UcnVlKHJlYWRlci5fY2xvc2VkUHJvbWlzZSk7CiAgICAgICAgcmVhZGVyLl9jbG9zZWRQcm9taXNlX3JlamVjdChyZWFzb24pOwogICAgICAgIHJlYWRlci5fY2xvc2VkUHJvbWlzZV9yZXNvbHZlID0gdW5kZWZpbmVkOwogICAgICAgIHJlYWRlci5fY2xvc2VkUHJvbWlzZV9yZWplY3QgPSB1bmRlZmluZWQ7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZGVmYXVsdFJlYWRlckNsb3NlZFByb21pc2VSZXNldFRvUmVqZWN0ZWQocmVhZGVyLCByZWFzb24pIHsKICAgICAgICBkZWZhdWx0UmVhZGVyQ2xvc2VkUHJvbWlzZUluaXRpYWxpemVBc1JlamVjdGVkKHJlYWRlciwgcmVhc29uKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBkZWZhdWx0UmVhZGVyQ2xvc2VkUHJvbWlzZVJlc29sdmUocmVhZGVyKSB7CiAgICAgICAgcmVhZGVyLl9jbG9zZWRQcm9taXNlX3Jlc29sdmUodW5kZWZpbmVkKTsKICAgICAgICByZWFkZXIuX2Nsb3NlZFByb21pc2VfcmVzb2x2ZSA9IHVuZGVmaW5lZDsKICAgICAgICByZWFkZXIuX2Nsb3NlZFByb21pc2VfcmVqZWN0ID0gdW5kZWZpbmVkOwogICAgICB9CiAgICAgIHZhciBDYW5jZWxTdGVwcyA9IFN5bWJvbFBvbHlmaWxsKCdbW0NhbmNlbFN0ZXBzXV0nKTsKICAgICAgdmFyIFB1bGxTdGVwcyA9IFN5bWJvbFBvbHlmaWxsKCdbW1B1bGxTdGVwc11dJyk7CiAgICAgIGZ1bmN0aW9uIEFjcXVpcmVSZWFkYWJsZVN0cmVhbURlZmF1bHRSZWFkZXIoc3RyZWFtLCBmb3JBdXRob3JDb2RlKSB7CiAgICAgICAgaWYgKGZvckF1dGhvckNvZGUgPT09IHZvaWQgMCkgewogICAgICAgICAgZm9yQXV0aG9yQ29kZSA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICB2YXIgcmVhZGVyID0gbmV3IFJlYWRhYmxlU3RyZWFtRGVmYXVsdFJlYWRlcihzdHJlYW0pOwogICAgICAgIHJlYWRlci5fZm9yQXV0aG9yQ29kZSA9IGZvckF1dGhvckNvZGU7CiAgICAgICAgcmV0dXJuIHJlYWRlcjsKICAgICAgfQogICAgICBmdW5jdGlvbiBSZWFkYWJsZVN0cmVhbUFkZFJlYWRSZXF1ZXN0KHN0cmVhbSkgewogICAgICAgIHZhciBwcm9taXNlID0gbmV3UHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICB2YXIgcmVhZFJlcXVlc3QgPSB7CiAgICAgICAgICAgIF9yZXNvbHZlOiByZXNvbHZlLAogICAgICAgICAgICBfcmVqZWN0OiByZWplY3QKICAgICAgICAgIH07CiAgICAgICAgICBzdHJlYW0uX3JlYWRlci5fcmVhZFJlcXVlc3RzLnB1c2gocmVhZFJlcXVlc3QpOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBwcm9taXNlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlU3RyZWFtRnVsZmlsbFJlYWRSZXF1ZXN0KHN0cmVhbSwgY2h1bmssIGRvbmUpIHsKICAgICAgICB2YXIgcmVhZGVyID0gc3RyZWFtLl9yZWFkZXI7CiAgICAgICAgdmFyIHJlYWRSZXF1ZXN0ID0gcmVhZGVyLl9yZWFkUmVxdWVzdHMuc2hpZnQoKTsKICAgICAgICByZWFkUmVxdWVzdC5fcmVzb2x2ZShSZWFkYWJsZVN0cmVhbUNyZWF0ZVJlYWRSZXN1bHQoY2h1bmssIGRvbmUsIHJlYWRlci5fZm9yQXV0aG9yQ29kZSkpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlU3RyZWFtR2V0TnVtUmVhZFJlcXVlc3RzKHN0cmVhbSkgewogICAgICAgIHJldHVybiBzdHJlYW0uX3JlYWRlci5fcmVhZFJlcXVlc3RzLmxlbmd0aDsKICAgICAgfQogICAgICBmdW5jdGlvbiBSZWFkYWJsZVN0cmVhbUhhc0RlZmF1bHRSZWFkZXIoc3RyZWFtKSB7CiAgICAgICAgdmFyIHJlYWRlciA9IHN0cmVhbS5fcmVhZGVyOwogICAgICAgIGlmIChyZWFkZXIgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoIUlzUmVhZGFibGVTdHJlYW1EZWZhdWx0UmVhZGVyKHJlYWRlcikpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgdmFyIFJlYWRhYmxlU3RyZWFtRGVmYXVsdFJlYWRlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBSZWFkYWJsZVN0cmVhbURlZmF1bHRSZWFkZXIoc3RyZWFtKSB7CiAgICAgICAgICBpZiAoSXNSZWFkYWJsZVN0cmVhbShzdHJlYW0pID09PSBmYWxzZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdSZWFkYWJsZVN0cmVhbURlZmF1bHRSZWFkZXIgY2FuIG9ubHkgYmUgY29uc3RydWN0ZWQgd2l0aCBhIFJlYWRhYmxlU3RyZWFtIGluc3RhbmNlJyk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoSXNSZWFkYWJsZVN0cmVhbUxvY2tlZChzdHJlYW0pID09PSB0cnVlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1RoaXMgc3RyZWFtIGhhcyBhbHJlYWR5IGJlZW4gbG9ja2VkIGZvciBleGNsdXNpdmUgcmVhZGluZyBieSBhbm90aGVyIHJlYWRlcicpOwogICAgICAgICAgfQogICAgICAgICAgUmVhZGFibGVTdHJlYW1SZWFkZXJHZW5lcmljSW5pdGlhbGl6ZSh0aGlzLCBzdHJlYW0pOwogICAgICAgICAgdGhpcy5fcmVhZFJlcXVlc3RzID0gbmV3IFNpbXBsZVF1ZXVlKCk7CiAgICAgICAgfQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZWFkYWJsZVN0cmVhbURlZmF1bHRSZWFkZXIucHJvdG90eXBlLCAiY2xvc2VkIiwgewogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIGlmICghSXNSZWFkYWJsZVN0cmVhbURlZmF1bHRSZWFkZXIodGhpcykpIHsKICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChkZWZhdWx0UmVhZGVyQnJhbmRDaGVja0V4Y2VwdGlvbignY2xvc2VkJykpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jbG9zZWRQcm9taXNlOwogICAgICAgICAgfSwKICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICB9KTsKICAgICAgICBSZWFkYWJsZVN0cmVhbURlZmF1bHRSZWFkZXIucHJvdG90eXBlLmNhbmNlbCA9IGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgIGlmICghSXNSZWFkYWJsZVN0cmVhbURlZmF1bHRSZWFkZXIodGhpcykpIHsKICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZWplY3RlZFdpdGgoZGVmYXVsdFJlYWRlckJyYW5kQ2hlY2tFeGNlcHRpb24oJ2NhbmNlbCcpKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLl9vd25lclJlYWRhYmxlU3RyZWFtID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZWplY3RlZFdpdGgocmVhZGVyTG9ja0V4Y2VwdGlvbignY2FuY2VsJykpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIFJlYWRhYmxlU3RyZWFtUmVhZGVyR2VuZXJpY0NhbmNlbCh0aGlzLCByZWFzb24pOwogICAgICAgIH07CiAgICAgICAgUmVhZGFibGVTdHJlYW1EZWZhdWx0UmVhZGVyLnByb3RvdHlwZS5yZWFkID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKCFJc1JlYWRhYmxlU3RyZWFtRGVmYXVsdFJlYWRlcih0aGlzKSkgewogICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChkZWZhdWx0UmVhZGVyQnJhbmRDaGVja0V4Y2VwdGlvbigncmVhZCcpKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLl9vd25lclJlYWRhYmxlU3RyZWFtID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZWplY3RlZFdpdGgocmVhZGVyTG9ja0V4Y2VwdGlvbigncmVhZCBmcm9tJykpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIFJlYWRhYmxlU3RyZWFtRGVmYXVsdFJlYWRlclJlYWQodGhpcyk7CiAgICAgICAgfTsKICAgICAgICBSZWFkYWJsZVN0cmVhbURlZmF1bHRSZWFkZXIucHJvdG90eXBlLnJlbGVhc2VMb2NrID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKCFJc1JlYWRhYmxlU3RyZWFtRGVmYXVsdFJlYWRlcih0aGlzKSkgewogICAgICAgICAgICB0aHJvdyBkZWZhdWx0UmVhZGVyQnJhbmRDaGVja0V4Y2VwdGlvbigncmVsZWFzZUxvY2snKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLl9vd25lclJlYWRhYmxlU3RyZWFtID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHRoaXMuX3JlYWRSZXF1ZXN0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1RyaWVkIHRvIHJlbGVhc2UgYSByZWFkZXIgbG9jayB3aGVuIHRoYXQgcmVhZGVyIGhhcyBwZW5kaW5nIHJlYWQoKSBjYWxscyB1bi1zZXR0bGVkJyk7CiAgICAgICAgICB9CiAgICAgICAgICBSZWFkYWJsZVN0cmVhbVJlYWRlckdlbmVyaWNSZWxlYXNlKHRoaXMpOwogICAgICAgIH07CiAgICAgICAgcmV0dXJuIFJlYWRhYmxlU3RyZWFtRGVmYXVsdFJlYWRlcjsKICAgICAgfSgpOwogICAgICBmdW5jdGlvbiBJc1JlYWRhYmxlU3RyZWFtRGVmYXVsdFJlYWRlcih4KSB7CiAgICAgICAgaWYgKCF0eXBlSXNPYmplY3QoeCkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoeCwgJ19yZWFkUmVxdWVzdHMnKSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBmdW5jdGlvbiBSZWFkYWJsZVN0cmVhbURlZmF1bHRSZWFkZXJSZWFkKHJlYWRlcikgewogICAgICAgIHZhciBzdHJlYW0gPSByZWFkZXIuX293bmVyUmVhZGFibGVTdHJlYW07CiAgICAgICAgc3RyZWFtLl9kaXN0dXJiZWQgPSB0cnVlOwogICAgICAgIGlmIChzdHJlYW0uX3N0YXRlID09PSAnY2xvc2VkJykgewogICAgICAgICAgcmV0dXJuIHByb21pc2VSZXNvbHZlZFdpdGgoUmVhZGFibGVTdHJlYW1DcmVhdGVSZWFkUmVzdWx0KHVuZGVmaW5lZCwgdHJ1ZSwgcmVhZGVyLl9mb3JBdXRob3JDb2RlKSk7CiAgICAgICAgfQogICAgICAgIGlmIChzdHJlYW0uX3N0YXRlID09PSAnZXJyb3JlZCcpIHsKICAgICAgICAgIHJldHVybiBwcm9taXNlUmVqZWN0ZWRXaXRoKHN0cmVhbS5fc3RvcmVkRXJyb3IpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3RyZWFtLl9yZWFkYWJsZVN0cmVhbUNvbnRyb2xsZXJbUHVsbFN0ZXBzXSgpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGRlZmF1bHRSZWFkZXJCcmFuZENoZWNrRXhjZXB0aW9uKG5hbWUpIHsKICAgICAgICByZXR1cm4gbmV3IFR5cGVFcnJvcigiUmVhZGFibGVTdHJlYW1EZWZhdWx0UmVhZGVyLnByb3RvdHlwZS4iICsgbmFtZSArICIgY2FuIG9ubHkgYmUgdXNlZCBvbiBhIFJlYWRhYmxlU3RyZWFtRGVmYXVsdFJlYWRlciIpOwogICAgICB9CiAgICAgIHZhciBfYTsKICAgICAgdmFyIEFzeW5jSXRlcmF0b3JQcm90b3R5cGU7CiAgICAgIGlmICh0eXBlb2YgU3ltYm9sUG9seWZpbGwuYXN5bmNJdGVyYXRvciA9PT0gJ3N5bWJvbCcpIHsKICAgICAgICBBc3luY0l0ZXJhdG9yUHJvdG90eXBlID0gKF9hID0ge30sIF9hW1N5bWJvbFBvbHlmaWxsLmFzeW5jSXRlcmF0b3JdID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfSwgX2EpOwogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShBc3luY0l0ZXJhdG9yUHJvdG90eXBlLCBTeW1ib2xQb2x5ZmlsbC5hc3luY0l0ZXJhdG9yLCB7IGVudW1lcmFibGU6IGZhbHNlIH0pOwogICAgICB9CiAgICAgIHZhciBSZWFkYWJsZVN0cmVhbUFzeW5jSXRlcmF0b3JQcm90b3R5cGUgPSB7CiAgICAgICAgbmV4dDogZnVuY3Rpb24gbmV4dCgpIHsKICAgICAgICAgIGlmIChJc1JlYWRhYmxlU3RyZWFtQXN5bmNJdGVyYXRvcih0aGlzKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZWplY3RlZFdpdGgoc3RyZWFtQXN5bmNJdGVyYXRvckJyYW5kQ2hlY2tFeGNlcHRpb24oJ25leHQnKSk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgcmVhZGVyID0gdGhpcy5fYXN5bmNJdGVyYXRvclJlYWRlcjsKICAgICAgICAgIGlmIChyZWFkZXIuX293bmVyUmVhZGFibGVTdHJlYW0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChyZWFkZXJMb2NrRXhjZXB0aW9uKCdpdGVyYXRlJykpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHRyYW5zZm9ybVByb21pc2VXaXRoKFJlYWRhYmxlU3RyZWFtRGVmYXVsdFJlYWRlclJlYWQocmVhZGVyKSwgZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICB2YXIgZG9uZSA9IHJlc3VsdC5kb25lOwogICAgICAgICAgICBpZiAoZG9uZSkgewogICAgICAgICAgICAgIFJlYWRhYmxlU3RyZWFtUmVhZGVyR2VuZXJpY1JlbGVhc2UocmVhZGVyKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgdmFsdWUgPSByZXN1bHQudmFsdWU7CiAgICAgICAgICAgIHJldHVybiBSZWFkYWJsZVN0cmVhbUNyZWF0ZVJlYWRSZXN1bHQodmFsdWUsIGRvbmUsIHRydWUpOwogICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICByZXR1cm46IGZ1bmN0aW9uIF9yZXR1cm4odmFsdWUpIHsKICAgICAgICAgIGlmIChJc1JlYWRhYmxlU3RyZWFtQXN5bmNJdGVyYXRvcih0aGlzKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZWplY3RlZFdpdGgoc3RyZWFtQXN5bmNJdGVyYXRvckJyYW5kQ2hlY2tFeGNlcHRpb24oJ25leHQnKSk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgcmVhZGVyID0gdGhpcy5fYXN5bmNJdGVyYXRvclJlYWRlcjsKICAgICAgICAgIGlmIChyZWFkZXIuX293bmVyUmVhZGFibGVTdHJlYW0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChyZWFkZXJMb2NrRXhjZXB0aW9uKCdmaW5pc2ggaXRlcmF0aW5nJykpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHJlYWRlci5fcmVhZFJlcXVlc3RzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZWplY3RlZFdpdGgobmV3IFR5cGVFcnJvcignVHJpZWQgdG8gcmVsZWFzZSBhIHJlYWRlciBsb2NrIHdoZW4gdGhhdCByZWFkZXIgaGFzIHBlbmRpbmcgcmVhZCgpIGNhbGxzIHVuLXNldHRsZWQnKSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodGhpcy5fcHJldmVudENhbmNlbCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9IFJlYWRhYmxlU3RyZWFtUmVhZGVyR2VuZXJpY0NhbmNlbChyZWFkZXIsIHZhbHVlKTsKICAgICAgICAgICAgUmVhZGFibGVTdHJlYW1SZWFkZXJHZW5lcmljUmVsZWFzZShyZWFkZXIpOwogICAgICAgICAgICByZXR1cm4gdHJhbnNmb3JtUHJvbWlzZVdpdGgocmVzdWx0LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIFJlYWRhYmxlU3RyZWFtQ3JlYXRlUmVhZFJlc3VsdCh2YWx1ZSwgdHJ1ZSwgdHJ1ZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgUmVhZGFibGVTdHJlYW1SZWFkZXJHZW5lcmljUmVsZWFzZShyZWFkZXIpOwogICAgICAgICAgcmV0dXJuIHByb21pc2VSZXNvbHZlZFdpdGgoUmVhZGFibGVTdHJlYW1DcmVhdGVSZWFkUmVzdWx0KHZhbHVlLCB0cnVlLCB0cnVlKSk7CiAgICAgICAgfQogICAgICB9OwogICAgICBpZiAoQXN5bmNJdGVyYXRvclByb3RvdHlwZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKFJlYWRhYmxlU3RyZWFtQXN5bmNJdGVyYXRvclByb3RvdHlwZSwgQXN5bmNJdGVyYXRvclByb3RvdHlwZSk7CiAgICAgIH0KICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFJlYWRhYmxlU3RyZWFtQXN5bmNJdGVyYXRvclByb3RvdHlwZSwgJ25leHQnLCB7IGVudW1lcmFibGU6IGZhbHNlIH0pOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUmVhZGFibGVTdHJlYW1Bc3luY0l0ZXJhdG9yUHJvdG90eXBlLCAncmV0dXJuJywgeyBlbnVtZXJhYmxlOiBmYWxzZSB9KTsKICAgICAgZnVuY3Rpb24gQWNxdWlyZVJlYWRhYmxlU3RyZWFtQXN5bmNJdGVyYXRvcihzdHJlYW0sIHByZXZlbnRDYW5jZWwpIHsKICAgICAgICBpZiAocHJldmVudENhbmNlbCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICBwcmV2ZW50Q2FuY2VsID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHZhciByZWFkZXIgPSBBY3F1aXJlUmVhZGFibGVTdHJlYW1EZWZhdWx0UmVhZGVyKHN0cmVhbSk7CiAgICAgICAgdmFyIGl0ZXJhdG9yID0gT2JqZWN0LmNyZWF0ZShSZWFkYWJsZVN0cmVhbUFzeW5jSXRlcmF0b3JQcm90b3R5cGUpOwogICAgICAgIGl0ZXJhdG9yLl9hc3luY0l0ZXJhdG9yUmVhZGVyID0gcmVhZGVyOwogICAgICAgIGl0ZXJhdG9yLl9wcmV2ZW50Q2FuY2VsID0gQm9vbGVhbihwcmV2ZW50Q2FuY2VsKTsKICAgICAgICByZXR1cm4gaXRlcmF0b3I7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gSXNSZWFkYWJsZVN0cmVhbUFzeW5jSXRlcmF0b3IoeCkgewogICAgICAgIGlmICghdHlwZUlzT2JqZWN0KHgpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmICghT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHgsICdfYXN5bmNJdGVyYXRvclJlYWRlcicpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHN0cmVhbUFzeW5jSXRlcmF0b3JCcmFuZENoZWNrRXhjZXB0aW9uKG5hbWUpIHsKICAgICAgICByZXR1cm4gbmV3IFR5cGVFcnJvcigiUmVhZGFibGVTdHJlYW1Bc3luY0l0ZXJhdG9yLiIgKyBuYW1lICsgIiBjYW4gb25seSBiZSB1c2VkIG9uIGEgUmVhZGFibGVTdGVhbUFzeW5jSXRlcmF0b3IiKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBEZXF1ZXVlVmFsdWUoY29udGFpbmVyKSB7CiAgICAgICAgdmFyIHBhaXIgPSBjb250YWluZXIuX3F1ZXVlLnNoaWZ0KCk7CiAgICAgICAgY29udGFpbmVyLl9xdWV1ZVRvdGFsU2l6ZSAtPSBwYWlyLnNpemU7CiAgICAgICAgaWYgKGNvbnRhaW5lci5fcXVldWVUb3RhbFNpemUgPCAwKSB7CiAgICAgICAgICBjb250YWluZXIuX3F1ZXVlVG90YWxTaXplID0gMDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHBhaXIudmFsdWU7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gRW5xdWV1ZVZhbHVlV2l0aFNpemUoY29udGFpbmVyLCB2YWx1ZSwgc2l6ZSkgewogICAgICAgIHNpemUgPSBOdW1iZXIoc2l6ZSk7CiAgICAgICAgaWYgKCFJc0Zpbml0ZU5vbk5lZ2F0aXZlTnVtYmVyKHNpemUpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignU2l6ZSBtdXN0IGJlIGEgZmluaXRlLCBub24tTmFOLCBub24tbmVnYXRpdmUgbnVtYmVyLicpOwogICAgICAgIH0KICAgICAgICBjb250YWluZXIuX3F1ZXVlLnB1c2goewogICAgICAgICAgdmFsdWU6IHZhbHVlLAogICAgICAgICAgc2l6ZTogc2l6ZQogICAgICAgIH0pOwogICAgICAgIGNvbnRhaW5lci5fcXVldWVUb3RhbFNpemUgKz0gc2l6ZTsKICAgICAgfQogICAgICBmdW5jdGlvbiBQZWVrUXVldWVWYWx1ZShjb250YWluZXIpIHsKICAgICAgICB2YXIgcGFpciA9IGNvbnRhaW5lci5fcXVldWUucGVlaygpOwogICAgICAgIHJldHVybiBwYWlyLnZhbHVlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlc2V0UXVldWUoY29udGFpbmVyKSB7CiAgICAgICAgY29udGFpbmVyLl9xdWV1ZSA9IG5ldyBTaW1wbGVRdWV1ZSgpOwogICAgICAgIGNvbnRhaW5lci5fcXVldWVUb3RhbFNpemUgPSAwOwogICAgICB9CiAgICAgIHZhciBBYm9ydFN0ZXBzID0gU3ltYm9sUG9seWZpbGwoJ1tbQWJvcnRTdGVwc11dJyk7CiAgICAgIHZhciBFcnJvclN0ZXBzID0gU3ltYm9sUG9seWZpbGwoJ1tbRXJyb3JTdGVwc11dJyk7CiAgICAgIHZhciBXcml0YWJsZVN0cmVhbSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBXcml0YWJsZVN0cmVhbSh1bmRlcmx5aW5nU2luaywgc3RyYXRlZ3kpIHsKICAgICAgICAgIGlmICh1bmRlcmx5aW5nU2luayA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgIHVuZGVybHlpbmdTaW5rID0ge307CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoc3RyYXRlZ3kgPT09IHZvaWQgMCkgewogICAgICAgICAgICBzdHJhdGVneSA9IHt9OwogICAgICAgICAgfQogICAgICAgICAgSW5pdGlhbGl6ZVdyaXRhYmxlU3RyZWFtKHRoaXMpOwogICAgICAgICAgdmFyIHNpemUgPSBzdHJhdGVneS5zaXplOwogICAgICAgICAgdmFyIGhpZ2hXYXRlck1hcmsgPSBzdHJhdGVneS5oaWdoV2F0ZXJNYXJrOwogICAgICAgICAgdmFyIHR5cGUgPSB1bmRlcmx5aW5nU2luay50eXBlOwogICAgICAgICAgaWYgKHR5cGUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignSW52YWxpZCB0eXBlIGlzIHNwZWNpZmllZCcpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHNpemVBbGdvcml0aG0gPSBNYWtlU2l6ZUFsZ29yaXRobUZyb21TaXplRnVuY3Rpb24oc2l6ZSk7CiAgICAgICAgICBpZiAoaGlnaFdhdGVyTWFyayA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGhpZ2hXYXRlck1hcmsgPSAxOwogICAgICAgICAgfQogICAgICAgICAgaGlnaFdhdGVyTWFyayA9IFZhbGlkYXRlQW5kTm9ybWFsaXplSGlnaFdhdGVyTWFyayhoaWdoV2F0ZXJNYXJrKTsKICAgICAgICAgIFNldFVwV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckZyb21VbmRlcmx5aW5nU2luayh0aGlzLCB1bmRlcmx5aW5nU2luaywgaGlnaFdhdGVyTWFyaywgc2l6ZUFsZ29yaXRobSk7CiAgICAgICAgfQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShXcml0YWJsZVN0cmVhbS5wcm90b3R5cGUsICJsb2NrZWQiLCB7CiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgaWYgKElzV3JpdGFibGVTdHJlYW0odGhpcykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgdGhyb3cgc3RyZWFtQnJhbmRDaGVja0V4Y2VwdGlvbignbG9ja2VkJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIElzV3JpdGFibGVTdHJlYW1Mb2NrZWQodGhpcyk7CiAgICAgICAgICB9LAogICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIFdyaXRhYmxlU3RyZWFtLnByb3RvdHlwZS5hYm9ydCA9IGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgIGlmIChJc1dyaXRhYmxlU3RyZWFtKHRoaXMpID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChzdHJlYW1CcmFuZENoZWNrRXhjZXB0aW9uKCdhYm9ydCcpKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChJc1dyaXRhYmxlU3RyZWFtTG9ja2VkKHRoaXMpID09PSB0cnVlKSB7CiAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVqZWN0ZWRXaXRoKG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBhYm9ydCBhIHN0cmVhbSB0aGF0IGFscmVhZHkgaGFzIGEgd3JpdGVyJykpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIFdyaXRhYmxlU3RyZWFtQWJvcnQodGhpcywgcmVhc29uKTsKICAgICAgICB9OwogICAgICAgIFdyaXRhYmxlU3RyZWFtLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmIChJc1dyaXRhYmxlU3RyZWFtKHRoaXMpID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChzdHJlYW1CcmFuZENoZWNrRXhjZXB0aW9uKCdjbG9zZScpKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChJc1dyaXRhYmxlU3RyZWFtTG9ja2VkKHRoaXMpID09PSB0cnVlKSB7CiAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVqZWN0ZWRXaXRoKG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjbG9zZSBhIHN0cmVhbSB0aGF0IGFscmVhZHkgaGFzIGEgd3JpdGVyJykpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKFdyaXRhYmxlU3RyZWFtQ2xvc2VRdWV1ZWRPckluRmxpZ2h0KHRoaXMpID09PSB0cnVlKSB7CiAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVqZWN0ZWRXaXRoKG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjbG9zZSBhbiBhbHJlYWR5LWNsb3Npbmcgc3RyZWFtJykpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIFdyaXRhYmxlU3RyZWFtQ2xvc2UodGhpcyk7CiAgICAgICAgfTsKICAgICAgICBXcml0YWJsZVN0cmVhbS5wcm90b3R5cGUuZ2V0V3JpdGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKElzV3JpdGFibGVTdHJlYW0odGhpcykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRocm93IHN0cmVhbUJyYW5kQ2hlY2tFeGNlcHRpb24oJ2dldFdyaXRlcicpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIEFjcXVpcmVXcml0YWJsZVN0cmVhbURlZmF1bHRXcml0ZXIodGhpcyk7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gV3JpdGFibGVTdHJlYW07CiAgICAgIH0oKTsKICAgICAgZnVuY3Rpb24gQWNxdWlyZVdyaXRhYmxlU3RyZWFtRGVmYXVsdFdyaXRlcihzdHJlYW0pIHsKICAgICAgICByZXR1cm4gbmV3IFdyaXRhYmxlU3RyZWFtRGVmYXVsdFdyaXRlcihzdHJlYW0pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIENyZWF0ZVdyaXRhYmxlU3RyZWFtKHN0YXJ0QWxnb3JpdGhtLCB3cml0ZUFsZ29yaXRobSwgY2xvc2VBbGdvcml0aG0sIGFib3J0QWxnb3JpdGhtLCBoaWdoV2F0ZXJNYXJrLCBzaXplQWxnb3JpdGhtKSB7CiAgICAgICAgaWYgKGhpZ2hXYXRlck1hcmsgPT09IHZvaWQgMCkgewogICAgICAgICAgaGlnaFdhdGVyTWFyayA9IDE7CiAgICAgICAgfQogICAgICAgIGlmIChzaXplQWxnb3JpdGhtID09PSB2b2lkIDApIHsKICAgICAgICAgIHNpemVBbGdvcml0aG0gPSBmdW5jdGlvbiBzaXplQWxnb3JpdGhtKCkgewogICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIHZhciBzdHJlYW0gPSBPYmplY3QuY3JlYXRlKFdyaXRhYmxlU3RyZWFtLnByb3RvdHlwZSk7CiAgICAgICAgSW5pdGlhbGl6ZVdyaXRhYmxlU3RyZWFtKHN0cmVhbSk7CiAgICAgICAgdmFyIGNvbnRyb2xsZXIgPSBPYmplY3QuY3JlYXRlKFdyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXIucHJvdG90eXBlKTsKICAgICAgICBTZXRVcFdyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXIoc3RyZWFtLCBjb250cm9sbGVyLCBzdGFydEFsZ29yaXRobSwgd3JpdGVBbGdvcml0aG0sIGNsb3NlQWxnb3JpdGhtLCBhYm9ydEFsZ29yaXRobSwgaGlnaFdhdGVyTWFyaywgc2l6ZUFsZ29yaXRobSk7CiAgICAgICAgcmV0dXJuIHN0cmVhbTsKICAgICAgfQogICAgICBmdW5jdGlvbiBJbml0aWFsaXplV3JpdGFibGVTdHJlYW0oc3RyZWFtKSB7CiAgICAgICAgc3RyZWFtLl9zdGF0ZSA9ICd3cml0YWJsZSc7CiAgICAgICAgc3RyZWFtLl9zdG9yZWRFcnJvciA9IHVuZGVmaW5lZDsKICAgICAgICBzdHJlYW0uX3dyaXRlciA9IHVuZGVmaW5lZDsKICAgICAgICBzdHJlYW0uX3dyaXRhYmxlU3RyZWFtQ29udHJvbGxlciA9IHVuZGVmaW5lZDsKICAgICAgICBzdHJlYW0uX3dyaXRlUmVxdWVzdHMgPSBuZXcgU2ltcGxlUXVldWUoKTsKICAgICAgICBzdHJlYW0uX2luRmxpZ2h0V3JpdGVSZXF1ZXN0ID0gdW5kZWZpbmVkOwogICAgICAgIHN0cmVhbS5fY2xvc2VSZXF1ZXN0ID0gdW5kZWZpbmVkOwogICAgICAgIHN0cmVhbS5faW5GbGlnaHRDbG9zZVJlcXVlc3QgPSB1bmRlZmluZWQ7CiAgICAgICAgc3RyZWFtLl9wZW5kaW5nQWJvcnRSZXF1ZXN0ID0gdW5kZWZpbmVkOwogICAgICAgIHN0cmVhbS5fYmFja3ByZXNzdXJlID0gZmFsc2U7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gSXNXcml0YWJsZVN0cmVhbSh4KSB7CiAgICAgICAgaWYgKCF0eXBlSXNPYmplY3QoeCkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoeCwgJ193cml0YWJsZVN0cmVhbUNvbnRyb2xsZXInKSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBmdW5jdGlvbiBJc1dyaXRhYmxlU3RyZWFtTG9ja2VkKHN0cmVhbSkgewogICAgICAgIGlmIChzdHJlYW0uX3dyaXRlciA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFdyaXRhYmxlU3RyZWFtQWJvcnQoc3RyZWFtLCByZWFzb24pIHsKICAgICAgICB2YXIgc3RhdGUgPSBzdHJlYW0uX3N0YXRlOwogICAgICAgIGlmIChzdGF0ZSA9PT0gJ2Nsb3NlZCcgfHwgc3RhdGUgPT09ICdlcnJvcmVkJykgewogICAgICAgICAgcmV0dXJuIHByb21pc2VSZXNvbHZlZFdpdGgodW5kZWZpbmVkKTsKICAgICAgICB9CiAgICAgICAgaWYgKHN0cmVhbS5fcGVuZGluZ0Fib3J0UmVxdWVzdCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICByZXR1cm4gc3RyZWFtLl9wZW5kaW5nQWJvcnRSZXF1ZXN0Ll9wcm9taXNlOwogICAgICAgIH0KICAgICAgICB2YXIgd2FzQWxyZWFkeUVycm9yaW5nID0gZmFsc2U7CiAgICAgICAgaWYgKHN0YXRlID09PSAnZXJyb3JpbmcnKSB7CiAgICAgICAgICB3YXNBbHJlYWR5RXJyb3JpbmcgPSB0cnVlOwogICAgICAgICAgcmVhc29uID0gdW5kZWZpbmVkOwogICAgICAgIH0KICAgICAgICB2YXIgcHJvbWlzZSA9IG5ld1Byb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgc3RyZWFtLl9wZW5kaW5nQWJvcnRSZXF1ZXN0ID0gewogICAgICAgICAgICBfcHJvbWlzZTogdW5kZWZpbmVkLAogICAgICAgICAgICBfcmVzb2x2ZTogcmVzb2x2ZSwKICAgICAgICAgICAgX3JlamVjdDogcmVqZWN0LAogICAgICAgICAgICBfcmVhc29uOiByZWFzb24sCiAgICAgICAgICAgIF93YXNBbHJlYWR5RXJyb3Jpbmc6IHdhc0FscmVhZHlFcnJvcmluZwogICAgICAgICAgfTsKICAgICAgICB9KTsKICAgICAgICBzdHJlYW0uX3BlbmRpbmdBYm9ydFJlcXVlc3QuX3Byb21pc2UgPSBwcm9taXNlOwogICAgICAgIGlmICh3YXNBbHJlYWR5RXJyb3JpbmcgPT09IGZhbHNlKSB7CiAgICAgICAgICBXcml0YWJsZVN0cmVhbVN0YXJ0RXJyb3Jpbmcoc3RyZWFtLCByZWFzb24pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcHJvbWlzZTsKICAgICAgfQogICAgICBmdW5jdGlvbiBXcml0YWJsZVN0cmVhbUNsb3NlKHN0cmVhbSkgewogICAgICAgIHZhciBzdGF0ZSA9IHN0cmVhbS5fc3RhdGU7CiAgICAgICAgaWYgKHN0YXRlID09PSAnY2xvc2VkJyB8fCBzdGF0ZSA9PT0gJ2Vycm9yZWQnKSB7CiAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChuZXcgVHlwZUVycm9yKCJUaGUgc3RyZWFtIChpbiAiICsgc3RhdGUgKyAiIHN0YXRlKSBpcyBub3QgaW4gdGhlIHdyaXRhYmxlIHN0YXRlIGFuZCBjYW5ub3QgYmUgY2xvc2VkIikpOwogICAgICAgIH0KICAgICAgICB2YXIgcHJvbWlzZSA9IG5ld1Byb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgdmFyIGNsb3NlUmVxdWVzdCA9IHsKICAgICAgICAgICAgX3Jlc29sdmU6IHJlc29sdmUsCiAgICAgICAgICAgIF9yZWplY3Q6IHJlamVjdAogICAgICAgICAgfTsKICAgICAgICAgIHN0cmVhbS5fY2xvc2VSZXF1ZXN0ID0gY2xvc2VSZXF1ZXN0OwogICAgICAgIH0pOwogICAgICAgIHZhciB3cml0ZXIgPSBzdHJlYW0uX3dyaXRlcjsKICAgICAgICBpZiAod3JpdGVyICE9PSB1bmRlZmluZWQgJiYgc3RyZWFtLl9iYWNrcHJlc3N1cmUgPT09IHRydWUgJiYgc3RhdGUgPT09ICd3cml0YWJsZScpIHsKICAgICAgICAgIGRlZmF1bHRXcml0ZXJSZWFkeVByb21pc2VSZXNvbHZlKHdyaXRlcik7CiAgICAgICAgfQogICAgICAgIFdyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJDbG9zZShzdHJlYW0uX3dyaXRhYmxlU3RyZWFtQ29udHJvbGxlcik7CiAgICAgICAgcmV0dXJuIHByb21pc2U7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gV3JpdGFibGVTdHJlYW1BZGRXcml0ZVJlcXVlc3Qoc3RyZWFtKSB7CiAgICAgICAgdmFyIHByb21pc2UgPSBuZXdQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgIHZhciB3cml0ZVJlcXVlc3QgPSB7CiAgICAgICAgICAgIF9yZXNvbHZlOiByZXNvbHZlLAogICAgICAgICAgICBfcmVqZWN0OiByZWplY3QKICAgICAgICAgIH07CiAgICAgICAgICBzdHJlYW0uX3dyaXRlUmVxdWVzdHMucHVzaCh3cml0ZVJlcXVlc3QpOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBwcm9taXNlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFdyaXRhYmxlU3RyZWFtRGVhbFdpdGhSZWplY3Rpb24oc3RyZWFtLCBlcnJvcikgewogICAgICAgIHZhciBzdGF0ZSA9IHN0cmVhbS5fc3RhdGU7CiAgICAgICAgaWYgKHN0YXRlID09PSAnd3JpdGFibGUnKSB7CiAgICAgICAgICBXcml0YWJsZVN0cmVhbVN0YXJ0RXJyb3Jpbmcoc3RyZWFtLCBlcnJvcik7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIFdyaXRhYmxlU3RyZWFtRmluaXNoRXJyb3Jpbmcoc3RyZWFtKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBXcml0YWJsZVN0cmVhbVN0YXJ0RXJyb3Jpbmcoc3RyZWFtLCByZWFzb24pIHsKICAgICAgICB2YXIgY29udHJvbGxlciA9IHN0cmVhbS5fd3JpdGFibGVTdHJlYW1Db250cm9sbGVyOwogICAgICAgIHN0cmVhbS5fc3RhdGUgPSAnZXJyb3JpbmcnOwogICAgICAgIHN0cmVhbS5fc3RvcmVkRXJyb3IgPSByZWFzb247CiAgICAgICAgdmFyIHdyaXRlciA9IHN0cmVhbS5fd3JpdGVyOwogICAgICAgIGlmICh3cml0ZXIgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyRW5zdXJlUmVhZHlQcm9taXNlUmVqZWN0ZWQod3JpdGVyLCByZWFzb24pOwogICAgICAgIH0KICAgICAgICBpZiAoV3JpdGFibGVTdHJlYW1IYXNPcGVyYXRpb25NYXJrZWRJbkZsaWdodChzdHJlYW0pID09PSBmYWxzZSAmJiBjb250cm9sbGVyLl9zdGFydGVkID09PSB0cnVlKSB7CiAgICAgICAgICBXcml0YWJsZVN0cmVhbUZpbmlzaEVycm9yaW5nKHN0cmVhbSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIFdyaXRhYmxlU3RyZWFtRmluaXNoRXJyb3Jpbmcoc3RyZWFtKSB7CiAgICAgICAgc3RyZWFtLl9zdGF0ZSA9ICdlcnJvcmVkJzsKICAgICAgICBzdHJlYW0uX3dyaXRhYmxlU3RyZWFtQ29udHJvbGxlcltFcnJvclN0ZXBzXSgpOwogICAgICAgIHZhciBzdG9yZWRFcnJvciA9IHN0cmVhbS5fc3RvcmVkRXJyb3I7CiAgICAgICAgc3RyZWFtLl93cml0ZVJlcXVlc3RzLmZvckVhY2goZnVuY3Rpb24gKHdyaXRlUmVxdWVzdCkgewogICAgICAgICAgd3JpdGVSZXF1ZXN0Ll9yZWplY3Qoc3RvcmVkRXJyb3IpOwogICAgICAgIH0pOwogICAgICAgIHN0cmVhbS5fd3JpdGVSZXF1ZXN0cyA9IG5ldyBTaW1wbGVRdWV1ZSgpOwogICAgICAgIGlmIChzdHJlYW0uX3BlbmRpbmdBYm9ydFJlcXVlc3QgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgV3JpdGFibGVTdHJlYW1SZWplY3RDbG9zZUFuZENsb3NlZFByb21pc2VJZk5lZWRlZChzdHJlYW0pOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB2YXIgYWJvcnRSZXF1ZXN0ID0gc3RyZWFtLl9wZW5kaW5nQWJvcnRSZXF1ZXN0OwogICAgICAgIHN0cmVhbS5fcGVuZGluZ0Fib3J0UmVxdWVzdCA9IHVuZGVmaW5lZDsKICAgICAgICBpZiAoYWJvcnRSZXF1ZXN0Ll93YXNBbHJlYWR5RXJyb3JpbmcgPT09IHRydWUpIHsKICAgICAgICAgIGFib3J0UmVxdWVzdC5fcmVqZWN0KHN0b3JlZEVycm9yKTsKICAgICAgICAgIFdyaXRhYmxlU3RyZWFtUmVqZWN0Q2xvc2VBbmRDbG9zZWRQcm9taXNlSWZOZWVkZWQoc3RyZWFtKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdmFyIHByb21pc2UgPSBzdHJlYW0uX3dyaXRhYmxlU3RyZWFtQ29udHJvbGxlcltBYm9ydFN0ZXBzXShhYm9ydFJlcXVlc3QuX3JlYXNvbik7CiAgICAgICAgdXBvblByb21pc2UocHJvbWlzZSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgYWJvcnRSZXF1ZXN0Ll9yZXNvbHZlKCk7CiAgICAgICAgICBXcml0YWJsZVN0cmVhbVJlamVjdENsb3NlQW5kQ2xvc2VkUHJvbWlzZUlmTmVlZGVkKHN0cmVhbSk7CiAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgYWJvcnRSZXF1ZXN0Ll9yZWplY3QocmVhc29uKTsKICAgICAgICAgIFdyaXRhYmxlU3RyZWFtUmVqZWN0Q2xvc2VBbmRDbG9zZWRQcm9taXNlSWZOZWVkZWQoc3RyZWFtKTsKICAgICAgICB9KTsKICAgICAgfQogICAgICBmdW5jdGlvbiBXcml0YWJsZVN0cmVhbUZpbmlzaEluRmxpZ2h0V3JpdGUoc3RyZWFtKSB7CiAgICAgICAgc3RyZWFtLl9pbkZsaWdodFdyaXRlUmVxdWVzdC5fcmVzb2x2ZSh1bmRlZmluZWQpOwogICAgICAgIHN0cmVhbS5faW5GbGlnaHRXcml0ZVJlcXVlc3QgPSB1bmRlZmluZWQ7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gV3JpdGFibGVTdHJlYW1GaW5pc2hJbkZsaWdodFdyaXRlV2l0aEVycm9yKHN0cmVhbSwgZXJyb3IpIHsKICAgICAgICBzdHJlYW0uX2luRmxpZ2h0V3JpdGVSZXF1ZXN0Ll9yZWplY3QoZXJyb3IpOwogICAgICAgIHN0cmVhbS5faW5GbGlnaHRXcml0ZVJlcXVlc3QgPSB1bmRlZmluZWQ7CiAgICAgICAgV3JpdGFibGVTdHJlYW1EZWFsV2l0aFJlamVjdGlvbihzdHJlYW0sIGVycm9yKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBXcml0YWJsZVN0cmVhbUZpbmlzaEluRmxpZ2h0Q2xvc2Uoc3RyZWFtKSB7CiAgICAgICAgc3RyZWFtLl9pbkZsaWdodENsb3NlUmVxdWVzdC5fcmVzb2x2ZSh1bmRlZmluZWQpOwogICAgICAgIHN0cmVhbS5faW5GbGlnaHRDbG9zZVJlcXVlc3QgPSB1bmRlZmluZWQ7CiAgICAgICAgdmFyIHN0YXRlID0gc3RyZWFtLl9zdGF0ZTsKICAgICAgICBpZiAoc3RhdGUgPT09ICdlcnJvcmluZycpIHsKICAgICAgICAgIHN0cmVhbS5fc3RvcmVkRXJyb3IgPSB1bmRlZmluZWQ7CiAgICAgICAgICBpZiAoc3RyZWFtLl9wZW5kaW5nQWJvcnRSZXF1ZXN0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgc3RyZWFtLl9wZW5kaW5nQWJvcnRSZXF1ZXN0Ll9yZXNvbHZlKCk7CiAgICAgICAgICAgIHN0cmVhbS5fcGVuZGluZ0Fib3J0UmVxdWVzdCA9IHVuZGVmaW5lZDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgc3RyZWFtLl9zdGF0ZSA9ICdjbG9zZWQnOwogICAgICAgIHZhciB3cml0ZXIgPSBzdHJlYW0uX3dyaXRlcjsKICAgICAgICBpZiAod3JpdGVyICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGRlZmF1bHRXcml0ZXJDbG9zZWRQcm9taXNlUmVzb2x2ZSh3cml0ZXIpOwogICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiBXcml0YWJsZVN0cmVhbUZpbmlzaEluRmxpZ2h0Q2xvc2VXaXRoRXJyb3Ioc3RyZWFtLCBlcnJvcikgewogICAgICAgIHN0cmVhbS5faW5GbGlnaHRDbG9zZVJlcXVlc3QuX3JlamVjdChlcnJvcik7CiAgICAgICAgc3RyZWFtLl9pbkZsaWdodENsb3NlUmVxdWVzdCA9IHVuZGVmaW5lZDsKICAgICAgICBpZiAoc3RyZWFtLl9wZW5kaW5nQWJvcnRSZXF1ZXN0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHN0cmVhbS5fcGVuZGluZ0Fib3J0UmVxdWVzdC5fcmVqZWN0KGVycm9yKTsKICAgICAgICAgIHN0cmVhbS5fcGVuZGluZ0Fib3J0UmVxdWVzdCA9IHVuZGVmaW5lZDsKICAgICAgICB9CiAgICAgICAgV3JpdGFibGVTdHJlYW1EZWFsV2l0aFJlamVjdGlvbihzdHJlYW0sIGVycm9yKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBXcml0YWJsZVN0cmVhbUNsb3NlUXVldWVkT3JJbkZsaWdodChzdHJlYW0pIHsKICAgICAgICBpZiAoc3RyZWFtLl9jbG9zZVJlcXVlc3QgPT09IHVuZGVmaW5lZCAmJiBzdHJlYW0uX2luRmxpZ2h0Q2xvc2VSZXF1ZXN0ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gV3JpdGFibGVTdHJlYW1IYXNPcGVyYXRpb25NYXJrZWRJbkZsaWdodChzdHJlYW0pIHsKICAgICAgICBpZiAoc3RyZWFtLl9pbkZsaWdodFdyaXRlUmVxdWVzdCA9PT0gdW5kZWZpbmVkICYmIHN0cmVhbS5faW5GbGlnaHRDbG9zZVJlcXVlc3QgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBmdW5jdGlvbiBXcml0YWJsZVN0cmVhbU1hcmtDbG9zZVJlcXVlc3RJbkZsaWdodChzdHJlYW0pIHsKICAgICAgICBzdHJlYW0uX2luRmxpZ2h0Q2xvc2VSZXF1ZXN0ID0gc3RyZWFtLl9jbG9zZVJlcXVlc3Q7CiAgICAgICAgc3RyZWFtLl9jbG9zZVJlcXVlc3QgPSB1bmRlZmluZWQ7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gV3JpdGFibGVTdHJlYW1NYXJrRmlyc3RXcml0ZVJlcXVlc3RJbkZsaWdodChzdHJlYW0pIHsKICAgICAgICBzdHJlYW0uX2luRmxpZ2h0V3JpdGVSZXF1ZXN0ID0gc3RyZWFtLl93cml0ZVJlcXVlc3RzLnNoaWZ0KCk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gV3JpdGFibGVTdHJlYW1SZWplY3RDbG9zZUFuZENsb3NlZFByb21pc2VJZk5lZWRlZChzdHJlYW0pIHsKICAgICAgICBpZiAoc3RyZWFtLl9jbG9zZVJlcXVlc3QgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgc3RyZWFtLl9jbG9zZVJlcXVlc3QuX3JlamVjdChzdHJlYW0uX3N0b3JlZEVycm9yKTsKICAgICAgICAgIHN0cmVhbS5fY2xvc2VSZXF1ZXN0ID0gdW5kZWZpbmVkOwogICAgICAgIH0KICAgICAgICB2YXIgd3JpdGVyID0gc3RyZWFtLl93cml0ZXI7CiAgICAgICAgaWYgKHdyaXRlciAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBkZWZhdWx0V3JpdGVyQ2xvc2VkUHJvbWlzZVJlamVjdCh3cml0ZXIsIHN0cmVhbS5fc3RvcmVkRXJyb3IpOwogICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiBXcml0YWJsZVN0cmVhbVVwZGF0ZUJhY2twcmVzc3VyZShzdHJlYW0sIGJhY2twcmVzc3VyZSkgewogICAgICAgIHZhciB3cml0ZXIgPSBzdHJlYW0uX3dyaXRlcjsKICAgICAgICBpZiAod3JpdGVyICE9PSB1bmRlZmluZWQgJiYgYmFja3ByZXNzdXJlICE9PSBzdHJlYW0uX2JhY2twcmVzc3VyZSkgewogICAgICAgICAgaWYgKGJhY2twcmVzc3VyZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICBkZWZhdWx0V3JpdGVyUmVhZHlQcm9taXNlUmVzZXQod3JpdGVyKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRlZmF1bHRXcml0ZXJSZWFkeVByb21pc2VSZXNvbHZlKHdyaXRlcik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHN0cmVhbS5fYmFja3ByZXNzdXJlID0gYmFja3ByZXNzdXJlOwogICAgICB9CiAgICAgIHZhciBXcml0YWJsZVN0cmVhbURlZmF1bHRXcml0ZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyKHN0cmVhbSkgewogICAgICAgICAgaWYgKElzV3JpdGFibGVTdHJlYW0oc3RyZWFtKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyIGNhbiBvbmx5IGJlIGNvbnN0cnVjdGVkIHdpdGggYSBXcml0YWJsZVN0cmVhbSBpbnN0YW5jZScpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKElzV3JpdGFibGVTdHJlYW1Mb2NrZWQoc3RyZWFtKSA9PT0gdHJ1ZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdUaGlzIHN0cmVhbSBoYXMgYWxyZWFkeSBiZWVuIGxvY2tlZCBmb3IgZXhjbHVzaXZlIHdyaXRpbmcgYnkgYW5vdGhlciB3cml0ZXInKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuX293bmVyV3JpdGFibGVTdHJlYW0gPSBzdHJlYW07CiAgICAgICAgICBzdHJlYW0uX3dyaXRlciA9IHRoaXM7CiAgICAgICAgICB2YXIgc3RhdGUgPSBzdHJlYW0uX3N0YXRlOwogICAgICAgICAgaWYgKHN0YXRlID09PSAnd3JpdGFibGUnKSB7CiAgICAgICAgICAgIGlmIChXcml0YWJsZVN0cmVhbUNsb3NlUXVldWVkT3JJbkZsaWdodChzdHJlYW0pID09PSBmYWxzZSAmJiBzdHJlYW0uX2JhY2twcmVzc3VyZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgIGRlZmF1bHRXcml0ZXJSZWFkeVByb21pc2VJbml0aWFsaXplKHRoaXMpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGRlZmF1bHRXcml0ZXJSZWFkeVByb21pc2VJbml0aWFsaXplQXNSZXNvbHZlZCh0aGlzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBkZWZhdWx0V3JpdGVyQ2xvc2VkUHJvbWlzZUluaXRpYWxpemUodGhpcyk7CiAgICAgICAgICB9IGVsc2UgaWYgKHN0YXRlID09PSAnZXJyb3JpbmcnKSB7CiAgICAgICAgICAgIGRlZmF1bHRXcml0ZXJSZWFkeVByb21pc2VJbml0aWFsaXplQXNSZWplY3RlZCh0aGlzLCBzdHJlYW0uX3N0b3JlZEVycm9yKTsKICAgICAgICAgICAgZGVmYXVsdFdyaXRlckNsb3NlZFByb21pc2VJbml0aWFsaXplKHRoaXMpOwogICAgICAgICAgfSBlbHNlIGlmIChzdGF0ZSA9PT0gJ2Nsb3NlZCcpIHsKICAgICAgICAgICAgZGVmYXVsdFdyaXRlclJlYWR5UHJvbWlzZUluaXRpYWxpemVBc1Jlc29sdmVkKHRoaXMpOwogICAgICAgICAgICBkZWZhdWx0V3JpdGVyQ2xvc2VkUHJvbWlzZUluaXRpYWxpemVBc1Jlc29sdmVkKHRoaXMpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIHN0b3JlZEVycm9yID0gc3RyZWFtLl9zdG9yZWRFcnJvcjsKICAgICAgICAgICAgZGVmYXVsdFdyaXRlclJlYWR5UHJvbWlzZUluaXRpYWxpemVBc1JlamVjdGVkKHRoaXMsIHN0b3JlZEVycm9yKTsKICAgICAgICAgICAgZGVmYXVsdFdyaXRlckNsb3NlZFByb21pc2VJbml0aWFsaXplQXNSZWplY3RlZCh0aGlzLCBzdG9yZWRFcnJvcik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShXcml0YWJsZVN0cmVhbURlZmF1bHRXcml0ZXIucHJvdG90eXBlLCAiY2xvc2VkIiwgewogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIGlmIChJc1dyaXRhYmxlU3RyZWFtRGVmYXVsdFdyaXRlcih0aGlzKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChkZWZhdWx0V3JpdGVyQnJhbmRDaGVja0V4Y2VwdGlvbignY2xvc2VkJykpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jbG9zZWRQcm9taXNlOwogICAgICAgICAgfSwKICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICB9KTsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyLnByb3RvdHlwZSwgImRlc2lyZWRTaXplIiwgewogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIGlmIChJc1dyaXRhYmxlU3RyZWFtRGVmYXVsdFdyaXRlcih0aGlzKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICB0aHJvdyBkZWZhdWx0V3JpdGVyQnJhbmRDaGVja0V4Y2VwdGlvbignZGVzaXJlZFNpemUnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5fb3duZXJXcml0YWJsZVN0cmVhbSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgdGhyb3cgZGVmYXVsdFdyaXRlckxvY2tFeGNlcHRpb24oJ2Rlc2lyZWRTaXplJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIFdyaXRhYmxlU3RyZWFtRGVmYXVsdFdyaXRlckdldERlc2lyZWRTaXplKHRoaXMpOwogICAgICAgICAgfSwKICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICB9KTsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyLnByb3RvdHlwZSwgInJlYWR5IiwgewogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIGlmIChJc1dyaXRhYmxlU3RyZWFtRGVmYXVsdFdyaXRlcih0aGlzKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChkZWZhdWx0V3JpdGVyQnJhbmRDaGVja0V4Y2VwdGlvbigncmVhZHknKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlYWR5UHJvbWlzZTsKICAgICAgICAgIH0sCiAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgICAgfSk7CiAgICAgICAgV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyLnByb3RvdHlwZS5hYm9ydCA9IGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgIGlmIChJc1dyaXRhYmxlU3RyZWFtRGVmYXVsdFdyaXRlcih0aGlzKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZWplY3RlZFdpdGgoZGVmYXVsdFdyaXRlckJyYW5kQ2hlY2tFeGNlcHRpb24oJ2Fib3J0JykpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHRoaXMuX293bmVyV3JpdGFibGVTdHJlYW0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChkZWZhdWx0V3JpdGVyTG9ja0V4Y2VwdGlvbignYWJvcnQnKSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyQWJvcnQodGhpcywgcmVhc29uKTsKICAgICAgICB9OwogICAgICAgIFdyaXRhYmxlU3RyZWFtRGVmYXVsdFdyaXRlci5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAoSXNXcml0YWJsZVN0cmVhbURlZmF1bHRXcml0ZXIodGhpcykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVqZWN0ZWRXaXRoKGRlZmF1bHRXcml0ZXJCcmFuZENoZWNrRXhjZXB0aW9uKCdjbG9zZScpKTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBzdHJlYW0gPSB0aGlzLl9vd25lcldyaXRhYmxlU3RyZWFtOwogICAgICAgICAgaWYgKHN0cmVhbSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVqZWN0ZWRXaXRoKGRlZmF1bHRXcml0ZXJMb2NrRXhjZXB0aW9uKCdjbG9zZScpKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChXcml0YWJsZVN0cmVhbUNsb3NlUXVldWVkT3JJbkZsaWdodChzdHJlYW0pID09PSB0cnVlKSB7CiAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVqZWN0ZWRXaXRoKG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjbG9zZSBhbiBhbHJlYWR5LWNsb3Npbmcgc3RyZWFtJykpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIFdyaXRhYmxlU3RyZWFtRGVmYXVsdFdyaXRlckNsb3NlKHRoaXMpOwogICAgICAgIH07CiAgICAgICAgV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyLnByb3RvdHlwZS5yZWxlYXNlTG9jayA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmIChJc1dyaXRhYmxlU3RyZWFtRGVmYXVsdFdyaXRlcih0aGlzKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgdGhyb3cgZGVmYXVsdFdyaXRlckJyYW5kQ2hlY2tFeGNlcHRpb24oJ3JlbGVhc2VMb2NrJyk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgc3RyZWFtID0gdGhpcy5fb3duZXJXcml0YWJsZVN0cmVhbTsKICAgICAgICAgIGlmIChzdHJlYW0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBXcml0YWJsZVN0cmVhbURlZmF1bHRXcml0ZXJSZWxlYXNlKHRoaXMpOwogICAgICAgIH07CiAgICAgICAgV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyLnByb3RvdHlwZS53cml0ZSA9IGZ1bmN0aW9uIChjaHVuaykgewogICAgICAgICAgaWYgKElzV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyKHRoaXMpID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChkZWZhdWx0V3JpdGVyQnJhbmRDaGVja0V4Y2VwdGlvbignd3JpdGUnKSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodGhpcy5fb3duZXJXcml0YWJsZVN0cmVhbSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVqZWN0ZWRXaXRoKGRlZmF1bHRXcml0ZXJMb2NrRXhjZXB0aW9uKCd3cml0ZSB0bycpKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBXcml0YWJsZVN0cmVhbURlZmF1bHRXcml0ZXJXcml0ZSh0aGlzLCBjaHVuayk7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyOwogICAgICB9KCk7CiAgICAgIGZ1bmN0aW9uIElzV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyKHgpIHsKICAgICAgICBpZiAoIXR5cGVJc09iamVjdCh4KSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh4LCAnX293bmVyV3JpdGFibGVTdHJlYW0nKSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBmdW5jdGlvbiBXcml0YWJsZVN0cmVhbURlZmF1bHRXcml0ZXJBYm9ydCh3cml0ZXIsIHJlYXNvbikgewogICAgICAgIHZhciBzdHJlYW0gPSB3cml0ZXIuX293bmVyV3JpdGFibGVTdHJlYW07CiAgICAgICAgcmV0dXJuIFdyaXRhYmxlU3RyZWFtQWJvcnQoc3RyZWFtLCByZWFzb24pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFdyaXRhYmxlU3RyZWFtRGVmYXVsdFdyaXRlckNsb3NlKHdyaXRlcikgewogICAgICAgIHZhciBzdHJlYW0gPSB3cml0ZXIuX293bmVyV3JpdGFibGVTdHJlYW07CiAgICAgICAgcmV0dXJuIFdyaXRhYmxlU3RyZWFtQ2xvc2Uoc3RyZWFtKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBXcml0YWJsZVN0cmVhbURlZmF1bHRXcml0ZXJDbG9zZVdpdGhFcnJvclByb3BhZ2F0aW9uKHdyaXRlcikgewogICAgICAgIHZhciBzdHJlYW0gPSB3cml0ZXIuX293bmVyV3JpdGFibGVTdHJlYW07CiAgICAgICAgdmFyIHN0YXRlID0gc3RyZWFtLl9zdGF0ZTsKICAgICAgICBpZiAoV3JpdGFibGVTdHJlYW1DbG9zZVF1ZXVlZE9ySW5GbGlnaHQoc3RyZWFtKSA9PT0gdHJ1ZSB8fCBzdGF0ZSA9PT0gJ2Nsb3NlZCcpIHsKICAgICAgICAgIHJldHVybiBwcm9taXNlUmVzb2x2ZWRXaXRoKHVuZGVmaW5lZCk7CiAgICAgICAgfQogICAgICAgIGlmIChzdGF0ZSA9PT0gJ2Vycm9yZWQnKSB7CiAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChzdHJlYW0uX3N0b3JlZEVycm9yKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFdyaXRhYmxlU3RyZWFtRGVmYXVsdFdyaXRlckNsb3NlKHdyaXRlcik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyRW5zdXJlQ2xvc2VkUHJvbWlzZVJlamVjdGVkKHdyaXRlciwgZXJyb3IpIHsKICAgICAgICBpZiAod3JpdGVyLl9jbG9zZWRQcm9taXNlU3RhdGUgPT09ICdwZW5kaW5nJykgewogICAgICAgICAgZGVmYXVsdFdyaXRlckNsb3NlZFByb21pc2VSZWplY3Qod3JpdGVyLCBlcnJvcik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRlZmF1bHRXcml0ZXJDbG9zZWRQcm9taXNlUmVzZXRUb1JlamVjdGVkKHdyaXRlciwgZXJyb3IpOwogICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiBXcml0YWJsZVN0cmVhbURlZmF1bHRXcml0ZXJFbnN1cmVSZWFkeVByb21pc2VSZWplY3RlZCh3cml0ZXIsIGVycm9yKSB7CiAgICAgICAgaWYgKHdyaXRlci5fcmVhZHlQcm9taXNlU3RhdGUgPT09ICdwZW5kaW5nJykgewogICAgICAgICAgZGVmYXVsdFdyaXRlclJlYWR5UHJvbWlzZVJlamVjdCh3cml0ZXIsIGVycm9yKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGVmYXVsdFdyaXRlclJlYWR5UHJvbWlzZVJlc2V0VG9SZWplY3RlZCh3cml0ZXIsIGVycm9yKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyR2V0RGVzaXJlZFNpemUod3JpdGVyKSB7CiAgICAgICAgdmFyIHN0cmVhbSA9IHdyaXRlci5fb3duZXJXcml0YWJsZVN0cmVhbTsKICAgICAgICB2YXIgc3RhdGUgPSBzdHJlYW0uX3N0YXRlOwogICAgICAgIGlmIChzdGF0ZSA9PT0gJ2Vycm9yZWQnIHx8IHN0YXRlID09PSAnZXJyb3JpbmcnKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgaWYgKHN0YXRlID09PSAnY2xvc2VkJykgewogICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHJldHVybiBXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyR2V0RGVzaXJlZFNpemUoc3RyZWFtLl93cml0YWJsZVN0cmVhbUNvbnRyb2xsZXIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFdyaXRhYmxlU3RyZWFtRGVmYXVsdFdyaXRlclJlbGVhc2Uod3JpdGVyKSB7CiAgICAgICAgdmFyIHN0cmVhbSA9IHdyaXRlci5fb3duZXJXcml0YWJsZVN0cmVhbTsKICAgICAgICB2YXIgcmVsZWFzZWRFcnJvciA9IG5ldyBUeXBlRXJyb3IoJ1dyaXRlciB3YXMgcmVsZWFzZWQgYW5kIGNhbiBubyBsb25nZXIgYmUgdXNlZCB0byBtb25pdG9yIHRoZSBzdHJlYW1cJ3MgY2xvc2VkbmVzcycpOwogICAgICAgIFdyaXRhYmxlU3RyZWFtRGVmYXVsdFdyaXRlckVuc3VyZVJlYWR5UHJvbWlzZVJlamVjdGVkKHdyaXRlciwgcmVsZWFzZWRFcnJvcik7CiAgICAgICAgV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyRW5zdXJlQ2xvc2VkUHJvbWlzZVJlamVjdGVkKHdyaXRlciwgcmVsZWFzZWRFcnJvcik7CiAgICAgICAgc3RyZWFtLl93cml0ZXIgPSB1bmRlZmluZWQ7CiAgICAgICAgd3JpdGVyLl9vd25lcldyaXRhYmxlU3RyZWFtID0gdW5kZWZpbmVkOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFdyaXRhYmxlU3RyZWFtRGVmYXVsdFdyaXRlcldyaXRlKHdyaXRlciwgY2h1bmspIHsKICAgICAgICB2YXIgc3RyZWFtID0gd3JpdGVyLl9vd25lcldyaXRhYmxlU3RyZWFtOwogICAgICAgIHZhciBjb250cm9sbGVyID0gc3RyZWFtLl93cml0YWJsZVN0cmVhbUNvbnRyb2xsZXI7CiAgICAgICAgdmFyIGNodW5rU2l6ZSA9IFdyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJHZXRDaHVua1NpemUoY29udHJvbGxlciwgY2h1bmspOwogICAgICAgIGlmIChzdHJlYW0gIT09IHdyaXRlci5fb3duZXJXcml0YWJsZVN0cmVhbSkgewogICAgICAgICAgcmV0dXJuIHByb21pc2VSZWplY3RlZFdpdGgoZGVmYXVsdFdyaXRlckxvY2tFeGNlcHRpb24oJ3dyaXRlIHRvJykpOwogICAgICAgIH0KICAgICAgICB2YXIgc3RhdGUgPSBzdHJlYW0uX3N0YXRlOwogICAgICAgIGlmIChzdGF0ZSA9PT0gJ2Vycm9yZWQnKSB7CiAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChzdHJlYW0uX3N0b3JlZEVycm9yKTsKICAgICAgICB9CiAgICAgICAgaWYgKFdyaXRhYmxlU3RyZWFtQ2xvc2VRdWV1ZWRPckluRmxpZ2h0KHN0cmVhbSkgPT09IHRydWUgfHwgc3RhdGUgPT09ICdjbG9zZWQnKSB7CiAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChuZXcgVHlwZUVycm9yKCdUaGUgc3RyZWFtIGlzIGNsb3Npbmcgb3IgY2xvc2VkIGFuZCBjYW5ub3QgYmUgd3JpdHRlbiB0bycpKTsKICAgICAgICB9CiAgICAgICAgaWYgKHN0YXRlID09PSAnZXJyb3JpbmcnKSB7CiAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChzdHJlYW0uX3N0b3JlZEVycm9yKTsKICAgICAgICB9CiAgICAgICAgdmFyIHByb21pc2UgPSBXcml0YWJsZVN0cmVhbUFkZFdyaXRlUmVxdWVzdChzdHJlYW0pOwogICAgICAgIFdyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJXcml0ZShjb250cm9sbGVyLCBjaHVuaywgY2h1bmtTaXplKTsKICAgICAgICByZXR1cm4gcHJvbWlzZTsKICAgICAgfQogICAgICB2YXIgV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyKCkgewogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlciBjYW5ub3QgYmUgY29uc3RydWN0ZWQgZXhwbGljaXRseScpOwogICAgICAgIH0KICAgICAgICBXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBpZiAoSXNXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyKHRoaXMpID09PSBmYWxzZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyLnByb3RvdHlwZS5lcnJvciBjYW4gb25seSBiZSB1c2VkIG9uIGEgV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlcicpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHN0YXRlID0gdGhpcy5fY29udHJvbGxlZFdyaXRhYmxlU3RyZWFtLl9zdGF0ZTsKICAgICAgICAgIGlmIChzdGF0ZSAhPT0gJ3dyaXRhYmxlJykgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyRXJyb3IodGhpcywgZSk7CiAgICAgICAgfTsKICAgICAgICBXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyLnByb3RvdHlwZVtBYm9ydFN0ZXBzXSA9IGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgIHZhciByZXN1bHQgPSB0aGlzLl9hYm9ydEFsZ29yaXRobShyZWFzb24pOwogICAgICAgICAgV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckNsZWFyQWxnb3JpdGhtcyh0aGlzKTsKICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfTsKICAgICAgICBXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyLnByb3RvdHlwZVtFcnJvclN0ZXBzXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIFJlc2V0UXVldWUodGhpcyk7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlcjsKICAgICAgfSgpOwogICAgICBmdW5jdGlvbiBJc1dyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXIoeCkgewogICAgICAgIGlmICghdHlwZUlzT2JqZWN0KHgpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmICghT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHgsICdfY29udHJvbGxlZFdyaXRhYmxlU3RyZWFtJykpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gU2V0VXBXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyKHN0cmVhbSwgY29udHJvbGxlciwgc3RhcnRBbGdvcml0aG0sIHdyaXRlQWxnb3JpdGhtLCBjbG9zZUFsZ29yaXRobSwgYWJvcnRBbGdvcml0aG0sIGhpZ2hXYXRlck1hcmssIHNpemVBbGdvcml0aG0pIHsKICAgICAgICBjb250cm9sbGVyLl9jb250cm9sbGVkV3JpdGFibGVTdHJlYW0gPSBzdHJlYW07CiAgICAgICAgc3RyZWFtLl93cml0YWJsZVN0cmVhbUNvbnRyb2xsZXIgPSBjb250cm9sbGVyOwogICAgICAgIGNvbnRyb2xsZXIuX3F1ZXVlID0gdW5kZWZpbmVkOwogICAgICAgIGNvbnRyb2xsZXIuX3F1ZXVlVG90YWxTaXplID0gdW5kZWZpbmVkOwogICAgICAgIFJlc2V0UXVldWUoY29udHJvbGxlcik7CiAgICAgICAgY29udHJvbGxlci5fc3RhcnRlZCA9IGZhbHNlOwogICAgICAgIGNvbnRyb2xsZXIuX3N0cmF0ZWd5U2l6ZUFsZ29yaXRobSA9IHNpemVBbGdvcml0aG07CiAgICAgICAgY29udHJvbGxlci5fc3RyYXRlZ3lIV00gPSBoaWdoV2F0ZXJNYXJrOwogICAgICAgIGNvbnRyb2xsZXIuX3dyaXRlQWxnb3JpdGhtID0gd3JpdGVBbGdvcml0aG07CiAgICAgICAgY29udHJvbGxlci5fY2xvc2VBbGdvcml0aG0gPSBjbG9zZUFsZ29yaXRobTsKICAgICAgICBjb250cm9sbGVyLl9hYm9ydEFsZ29yaXRobSA9IGFib3J0QWxnb3JpdGhtOwogICAgICAgIHZhciBiYWNrcHJlc3N1cmUgPSBXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyR2V0QmFja3ByZXNzdXJlKGNvbnRyb2xsZXIpOwogICAgICAgIFdyaXRhYmxlU3RyZWFtVXBkYXRlQmFja3ByZXNzdXJlKHN0cmVhbSwgYmFja3ByZXNzdXJlKTsKICAgICAgICB2YXIgc3RhcnRSZXN1bHQgPSBzdGFydEFsZ29yaXRobSgpOwogICAgICAgIHZhciBzdGFydFByb21pc2UgPSBwcm9taXNlUmVzb2x2ZWRXaXRoKHN0YXJ0UmVzdWx0KTsKICAgICAgICB1cG9uUHJvbWlzZShzdGFydFByb21pc2UsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGNvbnRyb2xsZXIuX3N0YXJ0ZWQgPSB0cnVlOwogICAgICAgICAgV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckFkdmFuY2VRdWV1ZUlmTmVlZGVkKGNvbnRyb2xsZXIpOwogICAgICAgIH0sIGZ1bmN0aW9uIChyKSB7CiAgICAgICAgICBjb250cm9sbGVyLl9zdGFydGVkID0gdHJ1ZTsKICAgICAgICAgIFdyaXRhYmxlU3RyZWFtRGVhbFdpdGhSZWplY3Rpb24oc3RyZWFtLCByKTsKICAgICAgICB9KTsKICAgICAgfQogICAgICBmdW5jdGlvbiBTZXRVcFdyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJGcm9tVW5kZXJseWluZ1Npbmsoc3RyZWFtLCB1bmRlcmx5aW5nU2luaywgaGlnaFdhdGVyTWFyaywgc2l6ZUFsZ29yaXRobSkgewogICAgICAgIHZhciBjb250cm9sbGVyID0gT2JqZWN0LmNyZWF0ZShXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyLnByb3RvdHlwZSk7CiAgICAgICAgZnVuY3Rpb24gc3RhcnRBbGdvcml0aG0oKSB7CiAgICAgICAgICByZXR1cm4gSW52b2tlT3JOb29wKHVuZGVybHlpbmdTaW5rLCAnc3RhcnQnLCBbY29udHJvbGxlcl0pOwogICAgICAgIH0KICAgICAgICB2YXIgd3JpdGVBbGdvcml0aG0gPSBDcmVhdGVBbGdvcml0aG1Gcm9tVW5kZXJseWluZ01ldGhvZCh1bmRlcmx5aW5nU2luaywgJ3dyaXRlJywgMSwgW2NvbnRyb2xsZXJdKTsKICAgICAgICB2YXIgY2xvc2VBbGdvcml0aG0gPSBDcmVhdGVBbGdvcml0aG1Gcm9tVW5kZXJseWluZ01ldGhvZCh1bmRlcmx5aW5nU2luaywgJ2Nsb3NlJywgMCwgW10pOwogICAgICAgIHZhciBhYm9ydEFsZ29yaXRobSA9IENyZWF0ZUFsZ29yaXRobUZyb21VbmRlcmx5aW5nTWV0aG9kKHVuZGVybHlpbmdTaW5rLCAnYWJvcnQnLCAxLCBbXSk7CiAgICAgICAgU2V0VXBXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyKHN0cmVhbSwgY29udHJvbGxlciwgc3RhcnRBbGdvcml0aG0sIHdyaXRlQWxnb3JpdGhtLCBjbG9zZUFsZ29yaXRobSwgYWJvcnRBbGdvcml0aG0sIGhpZ2hXYXRlck1hcmssIHNpemVBbGdvcml0aG0pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFdyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJDbGVhckFsZ29yaXRobXMoY29udHJvbGxlcikgewogICAgICAgIGNvbnRyb2xsZXIuX3dyaXRlQWxnb3JpdGhtID0gdW5kZWZpbmVkOwogICAgICAgIGNvbnRyb2xsZXIuX2Nsb3NlQWxnb3JpdGhtID0gdW5kZWZpbmVkOwogICAgICAgIGNvbnRyb2xsZXIuX2Fib3J0QWxnb3JpdGhtID0gdW5kZWZpbmVkOwogICAgICAgIGNvbnRyb2xsZXIuX3N0cmF0ZWd5U2l6ZUFsZ29yaXRobSA9IHVuZGVmaW5lZDsKICAgICAgfQogICAgICBmdW5jdGlvbiBXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyQ2xvc2UoY29udHJvbGxlcikgewogICAgICAgIEVucXVldWVWYWx1ZVdpdGhTaXplKGNvbnRyb2xsZXIsICdjbG9zZScsIDApOwogICAgICAgIFdyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJBZHZhbmNlUXVldWVJZk5lZWRlZChjb250cm9sbGVyKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyR2V0Q2h1bmtTaXplKGNvbnRyb2xsZXIsIGNodW5rKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJldHVybiBjb250cm9sbGVyLl9zdHJhdGVneVNpemVBbGdvcml0aG0oY2h1bmspOwogICAgICAgIH0gY2F0Y2ggKGNodW5rU2l6ZUUpIHsKICAgICAgICAgIFdyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJFcnJvcklmTmVlZGVkKGNvbnRyb2xsZXIsIGNodW5rU2l6ZUUpOwogICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIFdyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJHZXREZXNpcmVkU2l6ZShjb250cm9sbGVyKSB7CiAgICAgICAgcmV0dXJuIGNvbnRyb2xsZXIuX3N0cmF0ZWd5SFdNIC0gY29udHJvbGxlci5fcXVldWVUb3RhbFNpemU7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlcldyaXRlKGNvbnRyb2xsZXIsIGNodW5rLCBjaHVua1NpemUpIHsKICAgICAgICB2YXIgd3JpdGVSZWNvcmQgPSB7IGNodW5rOiBjaHVuayB9OwogICAgICAgIHRyeSB7CiAgICAgICAgICBFbnF1ZXVlVmFsdWVXaXRoU2l6ZShjb250cm9sbGVyLCB3cml0ZVJlY29yZCwgY2h1bmtTaXplKTsKICAgICAgICB9IGNhdGNoIChlbnF1ZXVlRSkgewogICAgICAgICAgV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckVycm9ySWZOZWVkZWQoY29udHJvbGxlciwgZW5xdWV1ZUUpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB2YXIgc3RyZWFtID0gY29udHJvbGxlci5fY29udHJvbGxlZFdyaXRhYmxlU3RyZWFtOwogICAgICAgIGlmIChXcml0YWJsZVN0cmVhbUNsb3NlUXVldWVkT3JJbkZsaWdodChzdHJlYW0pID09PSBmYWxzZSAmJiBzdHJlYW0uX3N0YXRlID09PSAnd3JpdGFibGUnKSB7CiAgICAgICAgICB2YXIgYmFja3ByZXNzdXJlID0gV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckdldEJhY2twcmVzc3VyZShjb250cm9sbGVyKTsKICAgICAgICAgIFdyaXRhYmxlU3RyZWFtVXBkYXRlQmFja3ByZXNzdXJlKHN0cmVhbSwgYmFja3ByZXNzdXJlKTsKICAgICAgICB9CiAgICAgICAgV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckFkdmFuY2VRdWV1ZUlmTmVlZGVkKGNvbnRyb2xsZXIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFdyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJBZHZhbmNlUXVldWVJZk5lZWRlZChjb250cm9sbGVyKSB7CiAgICAgICAgdmFyIHN0cmVhbSA9IGNvbnRyb2xsZXIuX2NvbnRyb2xsZWRXcml0YWJsZVN0cmVhbTsKICAgICAgICBpZiAoY29udHJvbGxlci5fc3RhcnRlZCA9PT0gZmFsc2UpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKHN0cmVhbS5faW5GbGlnaHRXcml0ZVJlcXVlc3QgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB2YXIgc3RhdGUgPSBzdHJlYW0uX3N0YXRlOwogICAgICAgIGlmIChzdGF0ZSA9PT0gJ2Vycm9yaW5nJykgewogICAgICAgICAgV3JpdGFibGVTdHJlYW1GaW5pc2hFcnJvcmluZyhzdHJlYW0pOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoY29udHJvbGxlci5fcXVldWUubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHZhciB3cml0ZVJlY29yZCA9IFBlZWtRdWV1ZVZhbHVlKGNvbnRyb2xsZXIpOwogICAgICAgIGlmICh3cml0ZVJlY29yZCA9PT0gJ2Nsb3NlJykgewogICAgICAgICAgV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlclByb2Nlc3NDbG9zZShjb250cm9sbGVyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlclByb2Nlc3NXcml0ZShjb250cm9sbGVyLCB3cml0ZVJlY29yZC5jaHVuayk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIFdyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJFcnJvcklmTmVlZGVkKGNvbnRyb2xsZXIsIGVycm9yKSB7CiAgICAgICAgaWYgKGNvbnRyb2xsZXIuX2NvbnRyb2xsZWRXcml0YWJsZVN0cmVhbS5fc3RhdGUgPT09ICd3cml0YWJsZScpIHsKICAgICAgICAgIFdyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJFcnJvcihjb250cm9sbGVyLCBlcnJvcik7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIFdyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJQcm9jZXNzQ2xvc2UoY29udHJvbGxlcikgewogICAgICAgIHZhciBzdHJlYW0gPSBjb250cm9sbGVyLl9jb250cm9sbGVkV3JpdGFibGVTdHJlYW07CiAgICAgICAgV3JpdGFibGVTdHJlYW1NYXJrQ2xvc2VSZXF1ZXN0SW5GbGlnaHQoc3RyZWFtKTsKICAgICAgICBEZXF1ZXVlVmFsdWUoY29udHJvbGxlcik7CiAgICAgICAgdmFyIHNpbmtDbG9zZVByb21pc2UgPSBjb250cm9sbGVyLl9jbG9zZUFsZ29yaXRobSgpOwogICAgICAgIFdyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJDbGVhckFsZ29yaXRobXMoY29udHJvbGxlcik7CiAgICAgICAgdXBvblByb21pc2Uoc2lua0Nsb3NlUHJvbWlzZSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgV3JpdGFibGVTdHJlYW1GaW5pc2hJbkZsaWdodENsb3NlKHN0cmVhbSk7CiAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgV3JpdGFibGVTdHJlYW1GaW5pc2hJbkZsaWdodENsb3NlV2l0aEVycm9yKHN0cmVhbSwgcmVhc29uKTsKICAgICAgICB9KTsKICAgICAgfQogICAgICBmdW5jdGlvbiBXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyUHJvY2Vzc1dyaXRlKGNvbnRyb2xsZXIsIGNodW5rKSB7CiAgICAgICAgdmFyIHN0cmVhbSA9IGNvbnRyb2xsZXIuX2NvbnRyb2xsZWRXcml0YWJsZVN0cmVhbTsKICAgICAgICBXcml0YWJsZVN0cmVhbU1hcmtGaXJzdFdyaXRlUmVxdWVzdEluRmxpZ2h0KHN0cmVhbSk7CiAgICAgICAgdmFyIHNpbmtXcml0ZVByb21pc2UgPSBjb250cm9sbGVyLl93cml0ZUFsZ29yaXRobShjaHVuayk7CiAgICAgICAgdXBvblByb21pc2Uoc2lua1dyaXRlUHJvbWlzZSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgV3JpdGFibGVTdHJlYW1GaW5pc2hJbkZsaWdodFdyaXRlKHN0cmVhbSk7CiAgICAgICAgICB2YXIgc3RhdGUgPSBzdHJlYW0uX3N0YXRlOwogICAgICAgICAgRGVxdWV1ZVZhbHVlKGNvbnRyb2xsZXIpOwogICAgICAgICAgaWYgKFdyaXRhYmxlU3RyZWFtQ2xvc2VRdWV1ZWRPckluRmxpZ2h0KHN0cmVhbSkgPT09IGZhbHNlICYmIHN0YXRlID09PSAnd3JpdGFibGUnKSB7CiAgICAgICAgICAgIHZhciBiYWNrcHJlc3N1cmUgPSBXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyR2V0QmFja3ByZXNzdXJlKGNvbnRyb2xsZXIpOwogICAgICAgICAgICBXcml0YWJsZVN0cmVhbVVwZGF0ZUJhY2twcmVzc3VyZShzdHJlYW0sIGJhY2twcmVzc3VyZSk7CiAgICAgICAgICB9CiAgICAgICAgICBXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyQWR2YW5jZVF1ZXVlSWZOZWVkZWQoY29udHJvbGxlcik7CiAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgaWYgKHN0cmVhbS5fc3RhdGUgPT09ICd3cml0YWJsZScpIHsKICAgICAgICAgICAgV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckNsZWFyQWxnb3JpdGhtcyhjb250cm9sbGVyKTsKICAgICAgICAgIH0KICAgICAgICAgIFdyaXRhYmxlU3RyZWFtRmluaXNoSW5GbGlnaHRXcml0ZVdpdGhFcnJvcihzdHJlYW0sIHJlYXNvbik7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckdldEJhY2twcmVzc3VyZShjb250cm9sbGVyKSB7CiAgICAgICAgdmFyIGRlc2lyZWRTaXplID0gV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckdldERlc2lyZWRTaXplKGNvbnRyb2xsZXIpOwogICAgICAgIHJldHVybiBkZXNpcmVkU2l6ZSA8PSAwOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFdyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJFcnJvcihjb250cm9sbGVyLCBlcnJvcikgewogICAgICAgIHZhciBzdHJlYW0gPSBjb250cm9sbGVyLl9jb250cm9sbGVkV3JpdGFibGVTdHJlYW07CiAgICAgICAgV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckNsZWFyQWxnb3JpdGhtcyhjb250cm9sbGVyKTsKICAgICAgICBXcml0YWJsZVN0cmVhbVN0YXJ0RXJyb3Jpbmcoc3RyZWFtLCBlcnJvcik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gc3RyZWFtQnJhbmRDaGVja0V4Y2VwdGlvbihuYW1lKSB7CiAgICAgICAgcmV0dXJuIG5ldyBUeXBlRXJyb3IoIldyaXRhYmxlU3RyZWFtLnByb3RvdHlwZS4iICsgbmFtZSArICIgY2FuIG9ubHkgYmUgdXNlZCBvbiBhIFdyaXRhYmxlU3RyZWFtIik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZGVmYXVsdFdyaXRlckJyYW5kQ2hlY2tFeGNlcHRpb24obmFtZSkgewogICAgICAgIHJldHVybiBuZXcgVHlwZUVycm9yKCJXcml0YWJsZVN0cmVhbURlZmF1bHRXcml0ZXIucHJvdG90eXBlLiIgKyBuYW1lICsgIiBjYW4gb25seSBiZSB1c2VkIG9uIGEgV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyIik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZGVmYXVsdFdyaXRlckxvY2tFeGNlcHRpb24obmFtZSkgewogICAgICAgIHJldHVybiBuZXcgVHlwZUVycm9yKCdDYW5ub3QgJyArIG5hbWUgKyAnIGEgc3RyZWFtIHVzaW5nIGEgcmVsZWFzZWQgd3JpdGVyJyk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZGVmYXVsdFdyaXRlckNsb3NlZFByb21pc2VJbml0aWFsaXplKHdyaXRlcikgewogICAgICAgIHdyaXRlci5fY2xvc2VkUHJvbWlzZSA9IG5ld1Byb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgd3JpdGVyLl9jbG9zZWRQcm9taXNlX3Jlc29sdmUgPSByZXNvbHZlOwogICAgICAgICAgd3JpdGVyLl9jbG9zZWRQcm9taXNlX3JlamVjdCA9IHJlamVjdDsKICAgICAgICAgIHdyaXRlci5fY2xvc2VkUHJvbWlzZVN0YXRlID0gJ3BlbmRpbmcnOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGRlZmF1bHRXcml0ZXJDbG9zZWRQcm9taXNlSW5pdGlhbGl6ZUFzUmVqZWN0ZWQod3JpdGVyLCByZWFzb24pIHsKICAgICAgICBkZWZhdWx0V3JpdGVyQ2xvc2VkUHJvbWlzZUluaXRpYWxpemUod3JpdGVyKTsKICAgICAgICBkZWZhdWx0V3JpdGVyQ2xvc2VkUHJvbWlzZVJlamVjdCh3cml0ZXIsIHJlYXNvbik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZGVmYXVsdFdyaXRlckNsb3NlZFByb21pc2VJbml0aWFsaXplQXNSZXNvbHZlZCh3cml0ZXIpIHsKICAgICAgICBkZWZhdWx0V3JpdGVyQ2xvc2VkUHJvbWlzZUluaXRpYWxpemUod3JpdGVyKTsKICAgICAgICBkZWZhdWx0V3JpdGVyQ2xvc2VkUHJvbWlzZVJlc29sdmUod3JpdGVyKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBkZWZhdWx0V3JpdGVyQ2xvc2VkUHJvbWlzZVJlamVjdCh3cml0ZXIsIHJlYXNvbikgewogICAgICAgIHNldFByb21pc2VJc0hhbmRsZWRUb1RydWUod3JpdGVyLl9jbG9zZWRQcm9taXNlKTsKICAgICAgICB3cml0ZXIuX2Nsb3NlZFByb21pc2VfcmVqZWN0KHJlYXNvbik7CiAgICAgICAgd3JpdGVyLl9jbG9zZWRQcm9taXNlX3Jlc29sdmUgPSB1bmRlZmluZWQ7CiAgICAgICAgd3JpdGVyLl9jbG9zZWRQcm9taXNlX3JlamVjdCA9IHVuZGVmaW5lZDsKICAgICAgICB3cml0ZXIuX2Nsb3NlZFByb21pc2VTdGF0ZSA9ICdyZWplY3RlZCc7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZGVmYXVsdFdyaXRlckNsb3NlZFByb21pc2VSZXNldFRvUmVqZWN0ZWQod3JpdGVyLCByZWFzb24pIHsKICAgICAgICBkZWZhdWx0V3JpdGVyQ2xvc2VkUHJvbWlzZUluaXRpYWxpemVBc1JlamVjdGVkKHdyaXRlciwgcmVhc29uKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBkZWZhdWx0V3JpdGVyQ2xvc2VkUHJvbWlzZVJlc29sdmUod3JpdGVyKSB7CiAgICAgICAgd3JpdGVyLl9jbG9zZWRQcm9taXNlX3Jlc29sdmUodW5kZWZpbmVkKTsKICAgICAgICB3cml0ZXIuX2Nsb3NlZFByb21pc2VfcmVzb2x2ZSA9IHVuZGVmaW5lZDsKICAgICAgICB3cml0ZXIuX2Nsb3NlZFByb21pc2VfcmVqZWN0ID0gdW5kZWZpbmVkOwogICAgICAgIHdyaXRlci5fY2xvc2VkUHJvbWlzZVN0YXRlID0gJ3Jlc29sdmVkJzsKICAgICAgfQogICAgICBmdW5jdGlvbiBkZWZhdWx0V3JpdGVyUmVhZHlQcm9taXNlSW5pdGlhbGl6ZSh3cml0ZXIpIHsKICAgICAgICB3cml0ZXIuX3JlYWR5UHJvbWlzZSA9IG5ld1Byb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgd3JpdGVyLl9yZWFkeVByb21pc2VfcmVzb2x2ZSA9IHJlc29sdmU7CiAgICAgICAgICB3cml0ZXIuX3JlYWR5UHJvbWlzZV9yZWplY3QgPSByZWplY3Q7CiAgICAgICAgfSk7CiAgICAgICAgd3JpdGVyLl9yZWFkeVByb21pc2VTdGF0ZSA9ICdwZW5kaW5nJzsKICAgICAgfQogICAgICBmdW5jdGlvbiBkZWZhdWx0V3JpdGVyUmVhZHlQcm9taXNlSW5pdGlhbGl6ZUFzUmVqZWN0ZWQod3JpdGVyLCByZWFzb24pIHsKICAgICAgICBkZWZhdWx0V3JpdGVyUmVhZHlQcm9taXNlSW5pdGlhbGl6ZSh3cml0ZXIpOwogICAgICAgIGRlZmF1bHRXcml0ZXJSZWFkeVByb21pc2VSZWplY3Qod3JpdGVyLCByZWFzb24pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGRlZmF1bHRXcml0ZXJSZWFkeVByb21pc2VJbml0aWFsaXplQXNSZXNvbHZlZCh3cml0ZXIpIHsKICAgICAgICBkZWZhdWx0V3JpdGVyUmVhZHlQcm9taXNlSW5pdGlhbGl6ZSh3cml0ZXIpOwogICAgICAgIGRlZmF1bHRXcml0ZXJSZWFkeVByb21pc2VSZXNvbHZlKHdyaXRlcik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZGVmYXVsdFdyaXRlclJlYWR5UHJvbWlzZVJlamVjdCh3cml0ZXIsIHJlYXNvbikgewogICAgICAgIHNldFByb21pc2VJc0hhbmRsZWRUb1RydWUod3JpdGVyLl9yZWFkeVByb21pc2UpOwogICAgICAgIHdyaXRlci5fcmVhZHlQcm9taXNlX3JlamVjdChyZWFzb24pOwogICAgICAgIHdyaXRlci5fcmVhZHlQcm9taXNlX3Jlc29sdmUgPSB1bmRlZmluZWQ7CiAgICAgICAgd3JpdGVyLl9yZWFkeVByb21pc2VfcmVqZWN0ID0gdW5kZWZpbmVkOwogICAgICAgIHdyaXRlci5fcmVhZHlQcm9taXNlU3RhdGUgPSAncmVqZWN0ZWQnOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGRlZmF1bHRXcml0ZXJSZWFkeVByb21pc2VSZXNldCh3cml0ZXIpIHsKICAgICAgICBkZWZhdWx0V3JpdGVyUmVhZHlQcm9taXNlSW5pdGlhbGl6ZSh3cml0ZXIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGRlZmF1bHRXcml0ZXJSZWFkeVByb21pc2VSZXNldFRvUmVqZWN0ZWQod3JpdGVyLCByZWFzb24pIHsKICAgICAgICBkZWZhdWx0V3JpdGVyUmVhZHlQcm9taXNlSW5pdGlhbGl6ZUFzUmVqZWN0ZWQod3JpdGVyLCByZWFzb24pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGRlZmF1bHRXcml0ZXJSZWFkeVByb21pc2VSZXNvbHZlKHdyaXRlcikgewogICAgICAgIHdyaXRlci5fcmVhZHlQcm9taXNlX3Jlc29sdmUodW5kZWZpbmVkKTsKICAgICAgICB3cml0ZXIuX3JlYWR5UHJvbWlzZV9yZXNvbHZlID0gdW5kZWZpbmVkOwogICAgICAgIHdyaXRlci5fcmVhZHlQcm9taXNlX3JlamVjdCA9IHVuZGVmaW5lZDsKICAgICAgICB3cml0ZXIuX3JlYWR5UHJvbWlzZVN0YXRlID0gJ2Z1bGZpbGxlZCc7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gaXNBYm9ydFNpZ25hbCh2YWx1ZSkgewogICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdvYmplY3QnIHx8IHZhbHVlID09PSBudWxsKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHRyeSB7CiAgICAgICAgICByZXR1cm4gdHlwZW9mIHZhbHVlLmFib3J0ZWQgPT09ICdib29sZWFuJzsKICAgICAgICB9IGNhdGNoIChfYSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgICB2YXIgTmF0aXZlRE9NRXhjZXB0aW9uID0gdHlwZW9mIERPTUV4Y2VwdGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyBET01FeGNlcHRpb24gOiB1bmRlZmluZWQ7CiAgICAgIGZ1bmN0aW9uIGlzRE9NRXhjZXB0aW9uQ29uc3RydWN0b3IoY3RvcikgewogICAgICAgIGlmICghKHR5cGVvZiBjdG9yID09PSAnZnVuY3Rpb24nIHx8IHR5cGVvZiBjdG9yID09PSAnb2JqZWN0JykpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgdHJ5IHsKICAgICAgICAgIG5ldyBjdG9yKCk7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGNhdGNoIChfYSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiBjcmVhdGVET01FeGNlcHRpb25Qb2x5ZmlsbCgpIHsKICAgICAgICB2YXIgY3RvciA9IGZ1bmN0aW9uIERPTUV4Y2VwdGlvbihtZXNzYWdlLCBuYW1lKSB7CiAgICAgICAgICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlIHx8ICcnOwogICAgICAgICAgdGhpcy5uYW1lID0gbmFtZSB8fCAnRXJyb3InOwogICAgICAgICAgaWYgKEVycm9yLmNhcHR1cmVTdGFja1RyYWNlKSB7CiAgICAgICAgICAgIEVycm9yLmNhcHR1cmVTdGFja1RyYWNlKHRoaXMsIHRoaXMuY29uc3RydWN0b3IpOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgY3Rvci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEVycm9yLnByb3RvdHlwZSk7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGN0b3IucHJvdG90eXBlLCAnY29uc3RydWN0b3InLCB7CiAgICAgICAgICB2YWx1ZTogY3RvciwKICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGN0b3I7CiAgICAgIH0KICAgICAgdmFyIERPTUV4Y2VwdGlvbiQxID0gaXNET01FeGNlcHRpb25Db25zdHJ1Y3RvcihOYXRpdmVET01FeGNlcHRpb24pID8gTmF0aXZlRE9NRXhjZXB0aW9uIDogY3JlYXRlRE9NRXhjZXB0aW9uUG9seWZpbGwoKTsKICAgICAgZnVuY3Rpb24gUmVhZGFibGVTdHJlYW1QaXBlVG8oc291cmNlLCBkZXN0LCBwcmV2ZW50Q2xvc2UsIHByZXZlbnRBYm9ydCwgcHJldmVudENhbmNlbCwgc2lnbmFsKSB7CiAgICAgICAgdmFyIHJlYWRlciA9IEFjcXVpcmVSZWFkYWJsZVN0cmVhbURlZmF1bHRSZWFkZXIoc291cmNlKTsKICAgICAgICB2YXIgd3JpdGVyID0gQWNxdWlyZVdyaXRhYmxlU3RyZWFtRGVmYXVsdFdyaXRlcihkZXN0KTsKICAgICAgICBzb3VyY2UuX2Rpc3R1cmJlZCA9IHRydWU7CiAgICAgICAgdmFyIHNodXR0aW5nRG93biA9IGZhbHNlOwogICAgICAgIHZhciBjdXJyZW50V3JpdGUgPSBwcm9taXNlUmVzb2x2ZWRXaXRoKHVuZGVmaW5lZCk7CiAgICAgICAgcmV0dXJuIG5ld1Byb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgdmFyIGFib3J0QWxnb3JpdGhtOwogICAgICAgICAgaWYgKHNpZ25hbCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGFib3J0QWxnb3JpdGhtID0gZnVuY3Rpb24gYWJvcnRBbGdvcml0aG0oKSB7CiAgICAgICAgICAgICAgdmFyIGVycm9yID0gbmV3IERPTUV4Y2VwdGlvbiQxKCdBYm9ydGVkJywgJ0Fib3J0RXJyb3InKTsKICAgICAgICAgICAgICB2YXIgYWN0aW9ucyA9IFtdOwogICAgICAgICAgICAgIGlmIChwcmV2ZW50QWJvcnQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICBhY3Rpb25zLnB1c2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICBpZiAoZGVzdC5fc3RhdGUgPT09ICd3cml0YWJsZScpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gV3JpdGFibGVTdHJlYW1BYm9ydChkZXN0LCBlcnJvcik7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZXNvbHZlZFdpdGgodW5kZWZpbmVkKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAocHJldmVudENhbmNlbCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIGFjdGlvbnMucHVzaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIGlmIChzb3VyY2UuX3N0YXRlID09PSAncmVhZGFibGUnKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFJlYWRhYmxlU3RyZWFtQ2FuY2VsKHNvdXJjZSwgZXJyb3IpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVzb2x2ZWRXaXRoKHVuZGVmaW5lZCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgc2h1dGRvd25XaXRoQWN0aW9uKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLmFsbChhY3Rpb25zLm1hcChmdW5jdGlvbiAoYWN0aW9uKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBhY3Rpb24oKTsKICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICB9LCB0cnVlLCBlcnJvcik7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmIChzaWduYWwuYWJvcnRlZCA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgIGFib3J0QWxnb3JpdGhtKCk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNpZ25hbC5hZGRFdmVudExpc3RlbmVyKCdhYm9ydCcsIGFib3J0QWxnb3JpdGhtKTsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIHBpcGVMb29wKCkgewogICAgICAgICAgICByZXR1cm4gbmV3UHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZUxvb3AsIHJlamVjdExvb3ApIHsKICAgICAgICAgICAgICBmdW5jdGlvbiBuZXh0KGRvbmUpIHsKICAgICAgICAgICAgICAgIGlmIChkb25lKSB7CiAgICAgICAgICAgICAgICAgIHJlc29sdmVMb29wKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBQZXJmb3JtUHJvbWlzZVRoZW4ocGlwZVN0ZXAoKSwgbmV4dCwgcmVqZWN0TG9vcCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIG5leHQoZmFsc2UpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIHBpcGVTdGVwKCkgewogICAgICAgICAgICBpZiAoc2h1dHRpbmdEb3duID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZXNvbHZlZFdpdGgodHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIFBlcmZvcm1Qcm9taXNlVGhlbih3cml0ZXIuX3JlYWR5UHJvbWlzZSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiBQZXJmb3JtUHJvbWlzZVRoZW4oUmVhZGFibGVTdHJlYW1EZWZhdWx0UmVhZGVyUmVhZChyZWFkZXIpLCBmdW5jdGlvbiAoX2EpIHsKICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IF9hLnZhbHVlLGRvbmUgPSBfYS5kb25lOwogICAgICAgICAgICAgICAgaWYgKGRvbmUgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjdXJyZW50V3JpdGUgPSBQZXJmb3JtUHJvbWlzZVRoZW4oV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyV3JpdGUod3JpdGVyLCB2YWx1ZSksIHVuZGVmaW5lZCwgbm9vcCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgaXNPckJlY29tZXNFcnJvcmVkKHNvdXJjZSwgcmVhZGVyLl9jbG9zZWRQcm9taXNlLCBmdW5jdGlvbiAoc3RvcmVkRXJyb3IpIHsKICAgICAgICAgICAgaWYgKHByZXZlbnRBYm9ydCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICBzaHV0ZG93bldpdGhBY3Rpb24oZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIFdyaXRhYmxlU3RyZWFtQWJvcnQoZGVzdCwgc3RvcmVkRXJyb3IpOwogICAgICAgICAgICAgIH0sIHRydWUsIHN0b3JlZEVycm9yKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBzaHV0ZG93bih0cnVlLCBzdG9yZWRFcnJvcik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgaXNPckJlY29tZXNFcnJvcmVkKGRlc3QsIHdyaXRlci5fY2xvc2VkUHJvbWlzZSwgZnVuY3Rpb24gKHN0b3JlZEVycm9yKSB7CiAgICAgICAgICAgIGlmIChwcmV2ZW50Q2FuY2VsID09PSBmYWxzZSkgewogICAgICAgICAgICAgIHNodXRkb3duV2l0aEFjdGlvbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gUmVhZGFibGVTdHJlYW1DYW5jZWwoc291cmNlLCBzdG9yZWRFcnJvcik7CiAgICAgICAgICAgICAgfSwgdHJ1ZSwgc3RvcmVkRXJyb3IpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHNodXRkb3duKHRydWUsIHN0b3JlZEVycm9yKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICBpc09yQmVjb21lc0Nsb3NlZChzb3VyY2UsIHJlYWRlci5fY2xvc2VkUHJvbWlzZSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAocHJldmVudENsb3NlID09PSBmYWxzZSkgewogICAgICAgICAgICAgIHNodXRkb3duV2l0aEFjdGlvbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyQ2xvc2VXaXRoRXJyb3JQcm9wYWdhdGlvbih3cml0ZXIpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHNodXRkb3duKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgaWYgKFdyaXRhYmxlU3RyZWFtQ2xvc2VRdWV1ZWRPckluRmxpZ2h0KGRlc3QpID09PSB0cnVlIHx8IGRlc3QuX3N0YXRlID09PSAnY2xvc2VkJykgewogICAgICAgICAgICB2YXIgZGVzdENsb3NlZF8xID0gbmV3IFR5cGVFcnJvcigndGhlIGRlc3RpbmF0aW9uIHdyaXRhYmxlIHN0cmVhbSBjbG9zZWQgYmVmb3JlIGFsbCBkYXRhIGNvdWxkIGJlIHBpcGVkIHRvIGl0Jyk7CiAgICAgICAgICAgIGlmIChwcmV2ZW50Q2FuY2VsID09PSBmYWxzZSkgewogICAgICAgICAgICAgIHNodXRkb3duV2l0aEFjdGlvbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gUmVhZGFibGVTdHJlYW1DYW5jZWwoc291cmNlLCBkZXN0Q2xvc2VkXzEpOwogICAgICAgICAgICAgIH0sIHRydWUsIGRlc3RDbG9zZWRfMSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgc2h1dGRvd24odHJ1ZSwgZGVzdENsb3NlZF8xKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgc2V0UHJvbWlzZUlzSGFuZGxlZFRvVHJ1ZShwaXBlTG9vcCgpKTsKICAgICAgICAgIGZ1bmN0aW9uIHdhaXRGb3JXcml0ZXNUb0ZpbmlzaCgpIHsKICAgICAgICAgICAgdmFyIG9sZEN1cnJlbnRXcml0ZSA9IGN1cnJlbnRXcml0ZTsKICAgICAgICAgICAgcmV0dXJuIFBlcmZvcm1Qcm9taXNlVGhlbihjdXJyZW50V3JpdGUsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4gb2xkQ3VycmVudFdyaXRlICE9PSBjdXJyZW50V3JpdGUgPyB3YWl0Rm9yV3JpdGVzVG9GaW5pc2goKSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBpc09yQmVjb21lc0Vycm9yZWQoc3RyZWFtLCBwcm9taXNlLCBhY3Rpb24pIHsKICAgICAgICAgICAgaWYgKHN0cmVhbS5fc3RhdGUgPT09ICdlcnJvcmVkJykgewogICAgICAgICAgICAgIGFjdGlvbihzdHJlYW0uX3N0b3JlZEVycm9yKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB1cG9uUmVqZWN0aW9uKHByb21pc2UsIGFjdGlvbik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGlzT3JCZWNvbWVzQ2xvc2VkKHN0cmVhbSwgcHJvbWlzZSwgYWN0aW9uKSB7CiAgICAgICAgICAgIGlmIChzdHJlYW0uX3N0YXRlID09PSAnY2xvc2VkJykgewogICAgICAgICAgICAgIGFjdGlvbigpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHVwb25GdWxmaWxsbWVudChwcm9taXNlLCBhY3Rpb24pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBzaHV0ZG93bldpdGhBY3Rpb24oYWN0aW9uLCBvcmlnaW5hbElzRXJyb3IsIG9yaWdpbmFsRXJyb3IpIHsKICAgICAgICAgICAgaWYgKHNodXR0aW5nRG93biA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBzaHV0dGluZ0Rvd24gPSB0cnVlOwogICAgICAgICAgICBpZiAoZGVzdC5fc3RhdGUgPT09ICd3cml0YWJsZScgJiYgV3JpdGFibGVTdHJlYW1DbG9zZVF1ZXVlZE9ySW5GbGlnaHQoZGVzdCkgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgdXBvbkZ1bGZpbGxtZW50KHdhaXRGb3JXcml0ZXNUb0ZpbmlzaCgpLCBkb1RoZVJlc3QpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGRvVGhlUmVzdCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGRvVGhlUmVzdCgpIHsKICAgICAgICAgICAgICB1cG9uUHJvbWlzZShhY3Rpb24oKSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZpbmFsaXplKG9yaWdpbmFsSXNFcnJvciwgb3JpZ2luYWxFcnJvcik7CiAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKG5ld0Vycm9yKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmluYWxpemUodHJ1ZSwgbmV3RXJyb3IpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBzaHV0ZG93bihpc0Vycm9yLCBlcnJvcikgewogICAgICAgICAgICBpZiAoc2h1dHRpbmdEb3duID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNodXR0aW5nRG93biA9IHRydWU7CiAgICAgICAgICAgIGlmIChkZXN0Ll9zdGF0ZSA9PT0gJ3dyaXRhYmxlJyAmJiBXcml0YWJsZVN0cmVhbUNsb3NlUXVldWVkT3JJbkZsaWdodChkZXN0KSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICB1cG9uRnVsZmlsbG1lbnQod2FpdEZvcldyaXRlc1RvRmluaXNoKCksIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmaW5hbGl6ZShpc0Vycm9yLCBlcnJvcik7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZmluYWxpemUoaXNFcnJvciwgZXJyb3IpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBmaW5hbGl6ZShpc0Vycm9yLCBlcnJvcikgewogICAgICAgICAgICBXcml0YWJsZVN0cmVhbURlZmF1bHRXcml0ZXJSZWxlYXNlKHdyaXRlcik7CiAgICAgICAgICAgIFJlYWRhYmxlU3RyZWFtUmVhZGVyR2VuZXJpY1JlbGVhc2UocmVhZGVyKTsKICAgICAgICAgICAgaWYgKHNpZ25hbCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgc2lnbmFsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Fib3J0JywgYWJvcnRBbGdvcml0aG0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChpc0Vycm9yKSB7CiAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByZXNvbHZlKHVuZGVmaW5lZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgICB2YXIgUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyKCkgewogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigpOwogICAgICAgIH0KICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlci5wcm90b3R5cGUsICJkZXNpcmVkU2l6ZSIsIHsKICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICBpZiAoSXNSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyKHRoaXMpID09PSBmYWxzZSkgewogICAgICAgICAgICAgIHRocm93IGRlZmF1bHRDb250cm9sbGVyQnJhbmRDaGVja0V4Y2VwdGlvbignZGVzaXJlZFNpemUnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckdldERlc2lyZWRTaXplKHRoaXMpOwogICAgICAgICAgfSwKICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICB9KTsKICAgICAgICBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmIChJc1JlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXIodGhpcykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRocm93IGRlZmF1bHRDb250cm9sbGVyQnJhbmRDaGVja0V4Y2VwdGlvbignY2xvc2UnKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyQ2FuQ2xvc2VPckVucXVldWUodGhpcykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1RoZSBzdHJlYW0gaXMgbm90IGluIGEgc3RhdGUgdGhhdCBwZXJtaXRzIGNsb3NlJyk7CiAgICAgICAgICB9CiAgICAgICAgICBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyQ2xvc2UodGhpcyk7CiAgICAgICAgfTsKICAgICAgICBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyLnByb3RvdHlwZS5lbnF1ZXVlID0gZnVuY3Rpb24gKGNodW5rKSB7CiAgICAgICAgICBpZiAoSXNSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyKHRoaXMpID09PSBmYWxzZSkgewogICAgICAgICAgICB0aHJvdyBkZWZhdWx0Q29udHJvbGxlckJyYW5kQ2hlY2tFeGNlcHRpb24oJ2VucXVldWUnKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyQ2FuQ2xvc2VPckVucXVldWUodGhpcykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1RoZSBzdHJlYW0gaXMgbm90IGluIGEgc3RhdGUgdGhhdCBwZXJtaXRzIGVucXVldWUnKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyRW5xdWV1ZSh0aGlzLCBjaHVuayk7CiAgICAgICAgfTsKICAgICAgICBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBpZiAoSXNSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyKHRoaXMpID09PSBmYWxzZSkgewogICAgICAgICAgICB0aHJvdyBkZWZhdWx0Q29udHJvbGxlckJyYW5kQ2hlY2tFeGNlcHRpb24oJ2Vycm9yJyk7CiAgICAgICAgICB9CiAgICAgICAgICBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyRXJyb3IodGhpcywgZSk7CiAgICAgICAgfTsKICAgICAgICBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyLnByb3RvdHlwZVtDYW5jZWxTdGVwc10gPSBmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICBSZXNldFF1ZXVlKHRoaXMpOwogICAgICAgICAgdmFyIHJlc3VsdCA9IHRoaXMuX2NhbmNlbEFsZ29yaXRobShyZWFzb24pOwogICAgICAgICAgUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckNsZWFyQWxnb3JpdGhtcyh0aGlzKTsKICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfTsKICAgICAgICBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyLnByb3RvdHlwZVtQdWxsU3RlcHNdID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIHN0cmVhbSA9IHRoaXMuX2NvbnRyb2xsZWRSZWFkYWJsZVN0cmVhbTsKICAgICAgICAgIGlmICh0aGlzLl9xdWV1ZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHZhciBjaHVuayA9IERlcXVldWVWYWx1ZSh0aGlzKTsKICAgICAgICAgICAgaWYgKHRoaXMuX2Nsb3NlUmVxdWVzdGVkID09PSB0cnVlICYmIHRoaXMuX3F1ZXVlLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgIFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJDbGVhckFsZ29yaXRobXModGhpcyk7CiAgICAgICAgICAgICAgUmVhZGFibGVTdHJlYW1DbG9zZShzdHJlYW0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJDYWxsUHVsbElmTmVlZGVkKHRoaXMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVzb2x2ZWRXaXRoKFJlYWRhYmxlU3RyZWFtQ3JlYXRlUmVhZFJlc3VsdChjaHVuaywgZmFsc2UsIHN0cmVhbS5fcmVhZGVyLl9mb3JBdXRob3JDb2RlKSk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgcGVuZGluZ1Byb21pc2UgPSBSZWFkYWJsZVN0cmVhbUFkZFJlYWRSZXF1ZXN0KHN0cmVhbSk7CiAgICAgICAgICBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyQ2FsbFB1bGxJZk5lZWRlZCh0aGlzKTsKICAgICAgICAgIHJldHVybiBwZW5kaW5nUHJvbWlzZTsKICAgICAgICB9OwogICAgICAgIHJldHVybiBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyOwogICAgICB9KCk7CiAgICAgIGZ1bmN0aW9uIElzUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlcih4KSB7CiAgICAgICAgaWYgKCF0eXBlSXNPYmplY3QoeCkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoeCwgJ19jb250cm9sbGVkUmVhZGFibGVTdHJlYW0nKSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBmdW5jdGlvbiBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyQ2FsbFB1bGxJZk5lZWRlZChjb250cm9sbGVyKSB7CiAgICAgICAgdmFyIHNob3VsZFB1bGwgPSBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyU2hvdWxkQ2FsbFB1bGwoY29udHJvbGxlcik7CiAgICAgICAgaWYgKHNob3VsZFB1bGwgPT09IGZhbHNlKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmIChjb250cm9sbGVyLl9wdWxsaW5nID09PSB0cnVlKSB7CiAgICAgICAgICBjb250cm9sbGVyLl9wdWxsQWdhaW4gPSB0cnVlOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb250cm9sbGVyLl9wdWxsaW5nID0gdHJ1ZTsKICAgICAgICB2YXIgcHVsbFByb21pc2UgPSBjb250cm9sbGVyLl9wdWxsQWxnb3JpdGhtKCk7CiAgICAgICAgdXBvblByb21pc2UocHVsbFByb21pc2UsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGNvbnRyb2xsZXIuX3B1bGxpbmcgPSBmYWxzZTsKICAgICAgICAgIGlmIChjb250cm9sbGVyLl9wdWxsQWdhaW4gPT09IHRydWUpIHsKICAgICAgICAgICAgY29udHJvbGxlci5fcHVsbEFnYWluID0gZmFsc2U7CiAgICAgICAgICAgIFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJDYWxsUHVsbElmTmVlZGVkKGNvbnRyb2xsZXIpOwogICAgICAgICAgfQogICAgICAgIH0sIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyRXJyb3IoY29udHJvbGxlciwgZSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlclNob3VsZENhbGxQdWxsKGNvbnRyb2xsZXIpIHsKICAgICAgICB2YXIgc3RyZWFtID0gY29udHJvbGxlci5fY29udHJvbGxlZFJlYWRhYmxlU3RyZWFtOwogICAgICAgIGlmIChSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyQ2FuQ2xvc2VPckVucXVldWUoY29udHJvbGxlcikgPT09IGZhbHNlKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmIChjb250cm9sbGVyLl9zdGFydGVkID09PSBmYWxzZSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoSXNSZWFkYWJsZVN0cmVhbUxvY2tlZChzdHJlYW0pID09PSB0cnVlICYmIFJlYWRhYmxlU3RyZWFtR2V0TnVtUmVhZFJlcXVlc3RzKHN0cmVhbSkgPiAwKSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgdmFyIGRlc2lyZWRTaXplID0gUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckdldERlc2lyZWRTaXplKGNvbnRyb2xsZXIpOwogICAgICAgIGlmIChkZXNpcmVkU2l6ZSA+IDApIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckNsZWFyQWxnb3JpdGhtcyhjb250cm9sbGVyKSB7CiAgICAgICAgY29udHJvbGxlci5fcHVsbEFsZ29yaXRobSA9IHVuZGVmaW5lZDsKICAgICAgICBjb250cm9sbGVyLl9jYW5jZWxBbGdvcml0aG0gPSB1bmRlZmluZWQ7CiAgICAgICAgY29udHJvbGxlci5fc3RyYXRlZ3lTaXplQWxnb3JpdGhtID0gdW5kZWZpbmVkOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJDbG9zZShjb250cm9sbGVyKSB7CiAgICAgICAgdmFyIHN0cmVhbSA9IGNvbnRyb2xsZXIuX2NvbnRyb2xsZWRSZWFkYWJsZVN0cmVhbTsKICAgICAgICBjb250cm9sbGVyLl9jbG9zZVJlcXVlc3RlZCA9IHRydWU7CiAgICAgICAgaWYgKGNvbnRyb2xsZXIuX3F1ZXVlLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckNsZWFyQWxnb3JpdGhtcyhjb250cm9sbGVyKTsKICAgICAgICAgIFJlYWRhYmxlU3RyZWFtQ2xvc2Uoc3RyZWFtKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckVucXVldWUoY29udHJvbGxlciwgY2h1bmspIHsKICAgICAgICB2YXIgc3RyZWFtID0gY29udHJvbGxlci5fY29udHJvbGxlZFJlYWRhYmxlU3RyZWFtOwogICAgICAgIGlmIChJc1JlYWRhYmxlU3RyZWFtTG9ja2VkKHN0cmVhbSkgPT09IHRydWUgJiYgUmVhZGFibGVTdHJlYW1HZXROdW1SZWFkUmVxdWVzdHMoc3RyZWFtKSA+IDApIHsKICAgICAgICAgIFJlYWRhYmxlU3RyZWFtRnVsZmlsbFJlYWRSZXF1ZXN0KHN0cmVhbSwgY2h1bmssIGZhbHNlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIGNodW5rU2l6ZSA9IHZvaWQgMDsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNodW5rU2l6ZSA9IGNvbnRyb2xsZXIuX3N0cmF0ZWd5U2l6ZUFsZ29yaXRobShjaHVuayk7CiAgICAgICAgICB9IGNhdGNoIChjaHVua1NpemVFKSB7CiAgICAgICAgICAgIFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJFcnJvcihjb250cm9sbGVyLCBjaHVua1NpemVFKTsKICAgICAgICAgICAgdGhyb3cgY2h1bmtTaXplRTsKICAgICAgICAgIH0KICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIEVucXVldWVWYWx1ZVdpdGhTaXplKGNvbnRyb2xsZXIsIGNodW5rLCBjaHVua1NpemUpOwogICAgICAgICAgfSBjYXRjaCAoZW5xdWV1ZUUpIHsKICAgICAgICAgICAgUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckVycm9yKGNvbnRyb2xsZXIsIGVucXVldWVFKTsKICAgICAgICAgICAgdGhyb3cgZW5xdWV1ZUU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJDYWxsUHVsbElmTmVlZGVkKGNvbnRyb2xsZXIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJFcnJvcihjb250cm9sbGVyLCBlKSB7CiAgICAgICAgdmFyIHN0cmVhbSA9IGNvbnRyb2xsZXIuX2NvbnRyb2xsZWRSZWFkYWJsZVN0cmVhbTsKICAgICAgICBpZiAoc3RyZWFtLl9zdGF0ZSAhPT0gJ3JlYWRhYmxlJykgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBSZXNldFF1ZXVlKGNvbnRyb2xsZXIpOwogICAgICAgIFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJDbGVhckFsZ29yaXRobXMoY29udHJvbGxlcik7CiAgICAgICAgUmVhZGFibGVTdHJlYW1FcnJvcihzdHJlYW0sIGUpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJHZXREZXNpcmVkU2l6ZShjb250cm9sbGVyKSB7CiAgICAgICAgdmFyIHN0cmVhbSA9IGNvbnRyb2xsZXIuX2NvbnRyb2xsZWRSZWFkYWJsZVN0cmVhbTsKICAgICAgICB2YXIgc3RhdGUgPSBzdHJlYW0uX3N0YXRlOwogICAgICAgIGlmIChzdGF0ZSA9PT0gJ2Vycm9yZWQnKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgaWYgKHN0YXRlID09PSAnY2xvc2VkJykgewogICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHJldHVybiBjb250cm9sbGVyLl9zdHJhdGVneUhXTSAtIGNvbnRyb2xsZXIuX3F1ZXVlVG90YWxTaXplOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJIYXNCYWNrcHJlc3N1cmUoY29udHJvbGxlcikgewogICAgICAgIGlmIChSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyU2hvdWxkQ2FsbFB1bGwoY29udHJvbGxlcikgPT09IHRydWUpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckNhbkNsb3NlT3JFbnF1ZXVlKGNvbnRyb2xsZXIpIHsKICAgICAgICB2YXIgc3RhdGUgPSBjb250cm9sbGVyLl9jb250cm9sbGVkUmVhZGFibGVTdHJlYW0uX3N0YXRlOwogICAgICAgIGlmIChjb250cm9sbGVyLl9jbG9zZVJlcXVlc3RlZCA9PT0gZmFsc2UgJiYgc3RhdGUgPT09ICdyZWFkYWJsZScpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gU2V0VXBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyKHN0cmVhbSwgY29udHJvbGxlciwgc3RhcnRBbGdvcml0aG0sIHB1bGxBbGdvcml0aG0sIGNhbmNlbEFsZ29yaXRobSwgaGlnaFdhdGVyTWFyaywgc2l6ZUFsZ29yaXRobSkgewogICAgICAgIGNvbnRyb2xsZXIuX2NvbnRyb2xsZWRSZWFkYWJsZVN0cmVhbSA9IHN0cmVhbTsKICAgICAgICBjb250cm9sbGVyLl9xdWV1ZSA9IHVuZGVmaW5lZDsKICAgICAgICBjb250cm9sbGVyLl9xdWV1ZVRvdGFsU2l6ZSA9IHVuZGVmaW5lZDsKICAgICAgICBSZXNldFF1ZXVlKGNvbnRyb2xsZXIpOwogICAgICAgIGNvbnRyb2xsZXIuX3N0YXJ0ZWQgPSBmYWxzZTsKICAgICAgICBjb250cm9sbGVyLl9jbG9zZVJlcXVlc3RlZCA9IGZhbHNlOwogICAgICAgIGNvbnRyb2xsZXIuX3B1bGxBZ2FpbiA9IGZhbHNlOwogICAgICAgIGNvbnRyb2xsZXIuX3B1bGxpbmcgPSBmYWxzZTsKICAgICAgICBjb250cm9sbGVyLl9zdHJhdGVneVNpemVBbGdvcml0aG0gPSBzaXplQWxnb3JpdGhtOwogICAgICAgIGNvbnRyb2xsZXIuX3N0cmF0ZWd5SFdNID0gaGlnaFdhdGVyTWFyazsKICAgICAgICBjb250cm9sbGVyLl9wdWxsQWxnb3JpdGhtID0gcHVsbEFsZ29yaXRobTsKICAgICAgICBjb250cm9sbGVyLl9jYW5jZWxBbGdvcml0aG0gPSBjYW5jZWxBbGdvcml0aG07CiAgICAgICAgc3RyZWFtLl9yZWFkYWJsZVN0cmVhbUNvbnRyb2xsZXIgPSBjb250cm9sbGVyOwogICAgICAgIHZhciBzdGFydFJlc3VsdCA9IHN0YXJ0QWxnb3JpdGhtKCk7CiAgICAgICAgdXBvblByb21pc2UocHJvbWlzZVJlc29sdmVkV2l0aChzdGFydFJlc3VsdCksIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGNvbnRyb2xsZXIuX3N0YXJ0ZWQgPSB0cnVlOwogICAgICAgICAgUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckNhbGxQdWxsSWZOZWVkZWQoY29udHJvbGxlcik7CiAgICAgICAgfSwgZnVuY3Rpb24gKHIpIHsKICAgICAgICAgIFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJFcnJvcihjb250cm9sbGVyLCByKTsKICAgICAgICB9KTsKICAgICAgfQogICAgICBmdW5jdGlvbiBTZXRVcFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJGcm9tVW5kZXJseWluZ1NvdXJjZShzdHJlYW0sIHVuZGVybHlpbmdTb3VyY2UsIGhpZ2hXYXRlck1hcmssIHNpemVBbGdvcml0aG0pIHsKICAgICAgICB2YXIgY29udHJvbGxlciA9IE9iamVjdC5jcmVhdGUoUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlci5wcm90b3R5cGUpOwogICAgICAgIGZ1bmN0aW9uIHN0YXJ0QWxnb3JpdGhtKCkgewogICAgICAgICAgcmV0dXJuIEludm9rZU9yTm9vcCh1bmRlcmx5aW5nU291cmNlLCAnc3RhcnQnLCBbY29udHJvbGxlcl0pOwogICAgICAgIH0KICAgICAgICB2YXIgcHVsbEFsZ29yaXRobSA9IENyZWF0ZUFsZ29yaXRobUZyb21VbmRlcmx5aW5nTWV0aG9kKHVuZGVybHlpbmdTb3VyY2UsICdwdWxsJywgMCwgW2NvbnRyb2xsZXJdKTsKICAgICAgICB2YXIgY2FuY2VsQWxnb3JpdGhtID0gQ3JlYXRlQWxnb3JpdGhtRnJvbVVuZGVybHlpbmdNZXRob2QodW5kZXJseWluZ1NvdXJjZSwgJ2NhbmNlbCcsIDEsIFtdKTsKICAgICAgICBTZXRVcFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXIoc3RyZWFtLCBjb250cm9sbGVyLCBzdGFydEFsZ29yaXRobSwgcHVsbEFsZ29yaXRobSwgY2FuY2VsQWxnb3JpdGhtLCBoaWdoV2F0ZXJNYXJrLCBzaXplQWxnb3JpdGhtKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBkZWZhdWx0Q29udHJvbGxlckJyYW5kQ2hlY2tFeGNlcHRpb24obmFtZSkgewogICAgICAgIHJldHVybiBuZXcgVHlwZUVycm9yKCJSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyLnByb3RvdHlwZS4iICsgbmFtZSArICIgY2FuIG9ubHkgYmUgdXNlZCBvbiBhIFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXIiKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBSZWFkYWJsZVN0cmVhbVRlZShzdHJlYW0sIGNsb25lRm9yQnJhbmNoMikgewogICAgICAgIHZhciByZWFkZXIgPSBBY3F1aXJlUmVhZGFibGVTdHJlYW1EZWZhdWx0UmVhZGVyKHN0cmVhbSk7CiAgICAgICAgdmFyIHJlYWRpbmcgPSBmYWxzZTsKICAgICAgICB2YXIgY2FuY2VsZWQxID0gZmFsc2U7CiAgICAgICAgdmFyIGNhbmNlbGVkMiA9IGZhbHNlOwogICAgICAgIHZhciByZWFzb24xOwogICAgICAgIHZhciByZWFzb24yOwogICAgICAgIHZhciBicmFuY2gxOwogICAgICAgIHZhciBicmFuY2gyOwogICAgICAgIHZhciByZXNvbHZlQ2FuY2VsUHJvbWlzZTsKICAgICAgICB2YXIgY2FuY2VsUHJvbWlzZSA9IG5ld1Byb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICAgIHJlc29sdmVDYW5jZWxQcm9taXNlID0gcmVzb2x2ZTsKICAgICAgICB9KTsKICAgICAgICBmdW5jdGlvbiBwdWxsQWxnb3JpdGhtKCkgewogICAgICAgICAgaWYgKHJlYWRpbmcgPT09IHRydWUpIHsKICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZXNvbHZlZFdpdGgodW5kZWZpbmVkKTsKICAgICAgICAgIH0KICAgICAgICAgIHJlYWRpbmcgPSB0cnVlOwogICAgICAgICAgdmFyIHJlYWRQcm9taXNlID0gdHJhbnNmb3JtUHJvbWlzZVdpdGgoUmVhZGFibGVTdHJlYW1EZWZhdWx0UmVhZGVyUmVhZChyZWFkZXIpLCBmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgIHJlYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgdmFyIGRvbmUgPSByZXN1bHQuZG9uZTsKICAgICAgICAgICAgaWYgKGRvbmUgPT09IHRydWUpIHsKICAgICAgICAgICAgICBpZiAoY2FuY2VsZWQxID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckNsb3NlKGJyYW5jaDEuX3JlYWRhYmxlU3RyZWFtQ29udHJvbGxlcik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChjYW5jZWxlZDIgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyQ2xvc2UoYnJhbmNoMi5fcmVhZGFibGVTdHJlYW1Db250cm9sbGVyKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciB2YWx1ZSA9IHJlc3VsdC52YWx1ZTsKICAgICAgICAgICAgdmFyIHZhbHVlMSA9IHZhbHVlOwogICAgICAgICAgICB2YXIgdmFsdWUyID0gdmFsdWU7CiAgICAgICAgICAgIGlmIChjYW5jZWxlZDEgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckVucXVldWUoYnJhbmNoMS5fcmVhZGFibGVTdHJlYW1Db250cm9sbGVyLCB2YWx1ZTEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChjYW5jZWxlZDIgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckVucXVldWUoYnJhbmNoMi5fcmVhZGFibGVTdHJlYW1Db250cm9sbGVyLCB2YWx1ZTIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIHNldFByb21pc2VJc0hhbmRsZWRUb1RydWUocmVhZFByb21pc2UpOwogICAgICAgICAgcmV0dXJuIHByb21pc2VSZXNvbHZlZFdpdGgodW5kZWZpbmVkKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gY2FuY2VsMUFsZ29yaXRobShyZWFzb24pIHsKICAgICAgICAgIGNhbmNlbGVkMSA9IHRydWU7CiAgICAgICAgICByZWFzb24xID0gcmVhc29uOwogICAgICAgICAgaWYgKGNhbmNlbGVkMiA9PT0gdHJ1ZSkgewogICAgICAgICAgICB2YXIgY29tcG9zaXRlUmVhc29uID0gY3JlYXRlQXJyYXlGcm9tTGlzdChbCiAgICAgICAgICAgIHJlYXNvbjEsCiAgICAgICAgICAgIHJlYXNvbjJdCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHZhciBjYW5jZWxSZXN1bHQgPSBSZWFkYWJsZVN0cmVhbUNhbmNlbChzdHJlYW0sIGNvbXBvc2l0ZVJlYXNvbik7CiAgICAgICAgICAgIHJlc29sdmVDYW5jZWxQcm9taXNlKGNhbmNlbFJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gY2FuY2VsUHJvbWlzZTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gY2FuY2VsMkFsZ29yaXRobShyZWFzb24pIHsKICAgICAgICAgIGNhbmNlbGVkMiA9IHRydWU7CiAgICAgICAgICByZWFzb24yID0gcmVhc29uOwogICAgICAgICAgaWYgKGNhbmNlbGVkMSA9PT0gdHJ1ZSkgewogICAgICAgICAgICB2YXIgY29tcG9zaXRlUmVhc29uID0gY3JlYXRlQXJyYXlGcm9tTGlzdChbCiAgICAgICAgICAgIHJlYXNvbjEsCiAgICAgICAgICAgIHJlYXNvbjJdCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHZhciBjYW5jZWxSZXN1bHQgPSBSZWFkYWJsZVN0cmVhbUNhbmNlbChzdHJlYW0sIGNvbXBvc2l0ZVJlYXNvbik7CiAgICAgICAgICAgIHJlc29sdmVDYW5jZWxQcm9taXNlKGNhbmNlbFJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gY2FuY2VsUHJvbWlzZTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gc3RhcnRBbGdvcml0aG0oKSB7CiAgICAgICAgfQogICAgICAgIGJyYW5jaDEgPSBDcmVhdGVSZWFkYWJsZVN0cmVhbShzdGFydEFsZ29yaXRobSwgcHVsbEFsZ29yaXRobSwgY2FuY2VsMUFsZ29yaXRobSk7CiAgICAgICAgYnJhbmNoMiA9IENyZWF0ZVJlYWRhYmxlU3RyZWFtKHN0YXJ0QWxnb3JpdGhtLCBwdWxsQWxnb3JpdGhtLCBjYW5jZWwyQWxnb3JpdGhtKTsKICAgICAgICB1cG9uUmVqZWN0aW9uKHJlYWRlci5fY2xvc2VkUHJvbWlzZSwgZnVuY3Rpb24gKHIpIHsKICAgICAgICAgIFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJFcnJvcihicmFuY2gxLl9yZWFkYWJsZVN0cmVhbUNvbnRyb2xsZXIsIHIpOwogICAgICAgICAgUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckVycm9yKGJyYW5jaDIuX3JlYWRhYmxlU3RyZWFtQ29udHJvbGxlciwgcik7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIFsKICAgICAgICBicmFuY2gxLAogICAgICAgIGJyYW5jaDJdOwoKICAgICAgfQogICAgICB2YXIgTnVtYmVySXNJbnRlZ2VyID0gTnVtYmVyLmlzSW50ZWdlciB8fCBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyAmJiBpc0Zpbml0ZSh2YWx1ZSkgJiYgTWF0aC5mbG9vcih2YWx1ZSkgPT09IHZhbHVlOwogICAgICB9OwogICAgICB2YXIgUmVhZGFibGVTdHJlYW1CWU9CUmVxdWVzdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBSZWFkYWJsZVN0cmVhbUJZT0JSZXF1ZXN0KCkgewogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignUmVhZGFibGVTdHJlYW1CWU9CUmVxdWVzdCBjYW5ub3QgYmUgdXNlZCBkaXJlY3RseScpOwogICAgICAgIH0KICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUmVhZGFibGVTdHJlYW1CWU9CUmVxdWVzdC5wcm90b3R5cGUsICJ2aWV3IiwgewogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIGlmIChJc1JlYWRhYmxlU3RyZWFtQllPQlJlcXVlc3QodGhpcykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgdGhyb3cgYnlvYlJlcXVlc3RCcmFuZENoZWNrRXhjZXB0aW9uKCd2aWV3Jyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ZpZXc7CiAgICAgICAgICB9LAogICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIFJlYWRhYmxlU3RyZWFtQllPQlJlcXVlc3QucHJvdG90eXBlLnJlc3BvbmQgPSBmdW5jdGlvbiAoYnl0ZXNXcml0dGVuKSB7CiAgICAgICAgICBpZiAoSXNSZWFkYWJsZVN0cmVhbUJZT0JSZXF1ZXN0KHRoaXMpID09PSBmYWxzZSkgewogICAgICAgICAgICB0aHJvdyBieW9iUmVxdWVzdEJyYW5kQ2hlY2tFeGNlcHRpb24oJ3Jlc3BvbmQnKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLl9hc3NvY2lhdGVkUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlciA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1RoaXMgQllPQiByZXF1ZXN0IGhhcyBiZWVuIGludmFsaWRhdGVkJyk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoSXNEZXRhY2hlZEJ1ZmZlcih0aGlzLl92aWV3LmJ1ZmZlcikgPT09IHRydWUpIDsKICAgICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJSZXNwb25kKHRoaXMuX2Fzc29jaWF0ZWRSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyLCBieXRlc1dyaXR0ZW4pOwogICAgICAgIH07CiAgICAgICAgUmVhZGFibGVTdHJlYW1CWU9CUmVxdWVzdC5wcm90b3R5cGUucmVzcG9uZFdpdGhOZXdWaWV3ID0gZnVuY3Rpb24gKHZpZXcpIHsKICAgICAgICAgIGlmIChJc1JlYWRhYmxlU3RyZWFtQllPQlJlcXVlc3QodGhpcykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRocm93IGJ5b2JSZXF1ZXN0QnJhbmRDaGVja0V4Y2VwdGlvbigncmVzcG9uZCcpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHRoaXMuX2Fzc29jaWF0ZWRSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVGhpcyBCWU9CIHJlcXVlc3QgaGFzIGJlZW4gaW52YWxpZGF0ZWQnKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICghQXJyYXlCdWZmZXIuaXNWaWV3KHZpZXcpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1lvdSBjYW4gb25seSByZXNwb25kIHdpdGggYXJyYXkgYnVmZmVyIHZpZXdzJyk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoSXNEZXRhY2hlZEJ1ZmZlcih2aWV3LmJ1ZmZlcikgPT09IHRydWUpIDsKICAgICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJSZXNwb25kV2l0aE5ld1ZpZXcodGhpcy5fYXNzb2NpYXRlZFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXIsIHZpZXcpOwogICAgICAgIH07CiAgICAgICAgcmV0dXJuIFJlYWRhYmxlU3RyZWFtQllPQlJlcXVlc3Q7CiAgICAgIH0oKTsKICAgICAgdmFyIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlcigpIHsKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1JlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXIgY29uc3RydWN0b3IgY2Fubm90IGJlIHVzZWQgZGlyZWN0bHknKTsKICAgICAgICB9CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXIucHJvdG90eXBlLCAiYnlvYlJlcXVlc3QiLCB7CiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgaWYgKElzUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlcih0aGlzKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICB0aHJvdyBieXRlU3RyZWFtQ29udHJvbGxlckJyYW5kQ2hlY2tFeGNlcHRpb24oJ2J5b2JSZXF1ZXN0Jyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMuX2J5b2JSZXF1ZXN0ID09PSB1bmRlZmluZWQgJiYgdGhpcy5fcGVuZGluZ1B1bGxJbnRvcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgdmFyIGZpcnN0RGVzY3JpcHRvciA9IHRoaXMuX3BlbmRpbmdQdWxsSW50b3MucGVlaygpOwogICAgICAgICAgICAgIHZhciB2aWV3ID0gbmV3IFVpbnQ4QXJyYXkoZmlyc3REZXNjcmlwdG9yLmJ1ZmZlciwgZmlyc3REZXNjcmlwdG9yLmJ5dGVPZmZzZXQgKyBmaXJzdERlc2NyaXB0b3IuYnl0ZXNGaWxsZWQsIGZpcnN0RGVzY3JpcHRvci5ieXRlTGVuZ3RoIC0gZmlyc3REZXNjcmlwdG9yLmJ5dGVzRmlsbGVkKTsKICAgICAgICAgICAgICB2YXIgYnlvYlJlcXVlc3QgPSBPYmplY3QuY3JlYXRlKFJlYWRhYmxlU3RyZWFtQllPQlJlcXVlc3QucHJvdG90eXBlKTsKICAgICAgICAgICAgICBTZXRVcFJlYWRhYmxlU3RyZWFtQllPQlJlcXVlc3QoYnlvYlJlcXVlc3QsIHRoaXMsIHZpZXcpOwogICAgICAgICAgICAgIHRoaXMuX2J5b2JSZXF1ZXN0ID0gYnlvYlJlcXVlc3Q7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2J5b2JSZXF1ZXN0OwogICAgICAgICAgfSwKICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICB9KTsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlci5wcm90b3R5cGUsICJkZXNpcmVkU2l6ZSIsIHsKICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICBpZiAoSXNSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyKHRoaXMpID09PSBmYWxzZSkgewogICAgICAgICAgICAgIHRocm93IGJ5dGVTdHJlYW1Db250cm9sbGVyQnJhbmRDaGVja0V4Y2VwdGlvbignZGVzaXJlZFNpemUnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlckdldERlc2lyZWRTaXplKHRoaXMpOwogICAgICAgICAgfSwKICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICB9KTsKICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmIChJc1JlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXIodGhpcykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRocm93IGJ5dGVTdHJlYW1Db250cm9sbGVyQnJhbmRDaGVja0V4Y2VwdGlvbignY2xvc2UnKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLl9jbG9zZVJlcXVlc3RlZCA9PT0gdHJ1ZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdUaGUgc3RyZWFtIGhhcyBhbHJlYWR5IGJlZW4gY2xvc2VkOyBkbyBub3QgY2xvc2UgaXQgYWdhaW4hJyk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgc3RhdGUgPSB0aGlzLl9jb250cm9sbGVkUmVhZGFibGVCeXRlU3RyZWFtLl9zdGF0ZTsKICAgICAgICAgIGlmIChzdGF0ZSAhPT0gJ3JlYWRhYmxlJykgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJUaGUgc3RyZWFtIChpbiAiICsgc3RhdGUgKyAiIHN0YXRlKSBpcyBub3QgaW4gdGhlIHJlYWRhYmxlIHN0YXRlIGFuZCBjYW5ub3QgYmUgY2xvc2VkIik7CiAgICAgICAgICB9CiAgICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyQ2xvc2UodGhpcyk7CiAgICAgICAgfTsKICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyLnByb3RvdHlwZS5lbnF1ZXVlID0gZnVuY3Rpb24gKGNodW5rKSB7CiAgICAgICAgICBpZiAoSXNSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyKHRoaXMpID09PSBmYWxzZSkgewogICAgICAgICAgICB0aHJvdyBieXRlU3RyZWFtQ29udHJvbGxlckJyYW5kQ2hlY2tFeGNlcHRpb24oJ2VucXVldWUnKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLl9jbG9zZVJlcXVlc3RlZCA9PT0gdHJ1ZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdzdHJlYW0gaXMgY2xvc2VkIG9yIGRyYWluaW5nJyk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgc3RhdGUgPSB0aGlzLl9jb250cm9sbGVkUmVhZGFibGVCeXRlU3RyZWFtLl9zdGF0ZTsKICAgICAgICAgIGlmIChzdGF0ZSAhPT0gJ3JlYWRhYmxlJykgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJUaGUgc3RyZWFtIChpbiAiICsgc3RhdGUgKyAiIHN0YXRlKSBpcyBub3QgaW4gdGhlIHJlYWRhYmxlIHN0YXRlIGFuZCBjYW5ub3QgYmUgZW5xdWV1ZWQgdG8iKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICghQXJyYXlCdWZmZXIuaXNWaWV3KGNodW5rKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdZb3UgY2FuIG9ubHkgZW5xdWV1ZSBhcnJheSBidWZmZXIgdmlld3Mgd2hlbiB1c2luZyBhIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXInKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChJc0RldGFjaGVkQnVmZmVyKGNodW5rLmJ1ZmZlcikgPT09IHRydWUpIDsKICAgICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJFbnF1ZXVlKHRoaXMsIGNodW5rKTsKICAgICAgICB9OwogICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGlmIChJc1JlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXIodGhpcykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRocm93IGJ5dGVTdHJlYW1Db250cm9sbGVyQnJhbmRDaGVja0V4Y2VwdGlvbignZXJyb3InKTsKICAgICAgICAgIH0KICAgICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJFcnJvcih0aGlzLCBlKTsKICAgICAgICB9OwogICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXIucHJvdG90eXBlW0NhbmNlbFN0ZXBzXSA9IGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgIGlmICh0aGlzLl9wZW5kaW5nUHVsbEludG9zLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgdmFyIGZpcnN0RGVzY3JpcHRvciA9IHRoaXMuX3BlbmRpbmdQdWxsSW50b3MucGVlaygpOwogICAgICAgICAgICBmaXJzdERlc2NyaXB0b3IuYnl0ZXNGaWxsZWQgPSAwOwogICAgICAgICAgfQogICAgICAgICAgUmVzZXRRdWV1ZSh0aGlzKTsKICAgICAgICAgIHZhciByZXN1bHQgPSB0aGlzLl9jYW5jZWxBbGdvcml0aG0ocmVhc29uKTsKICAgICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJDbGVhckFsZ29yaXRobXModGhpcyk7CiAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH07CiAgICAgICAgUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlci5wcm90b3R5cGVbUHVsbFN0ZXBzXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBzdHJlYW0gPSB0aGlzLl9jb250cm9sbGVkUmVhZGFibGVCeXRlU3RyZWFtOwogICAgICAgICAgaWYgKHRoaXMuX3F1ZXVlVG90YWxTaXplID4gMCkgewogICAgICAgICAgICB2YXIgZW50cnkgPSB0aGlzLl9xdWV1ZS5zaGlmdCgpOwogICAgICAgICAgICB0aGlzLl9xdWV1ZVRvdGFsU2l6ZSAtPSBlbnRyeS5ieXRlTGVuZ3RoOwogICAgICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVySGFuZGxlUXVldWVEcmFpbih0aGlzKTsKICAgICAgICAgICAgdmFyIHZpZXcgPSB2b2lkIDA7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgdmlldyA9IG5ldyBVaW50OEFycmF5KGVudHJ5LmJ1ZmZlciwgZW50cnkuYnl0ZU9mZnNldCwgZW50cnkuYnl0ZUxlbmd0aCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKHZpZXdFKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZWplY3RlZFdpdGgodmlld0UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVzb2x2ZWRXaXRoKFJlYWRhYmxlU3RyZWFtQ3JlYXRlUmVhZFJlc3VsdCh2aWV3LCBmYWxzZSwgc3RyZWFtLl9yZWFkZXIuX2ZvckF1dGhvckNvZGUpKTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBhdXRvQWxsb2NhdGVDaHVua1NpemUgPSB0aGlzLl9hdXRvQWxsb2NhdGVDaHVua1NpemU7CiAgICAgICAgICBpZiAoYXV0b0FsbG9jYXRlQ2h1bmtTaXplICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgdmFyIGJ1ZmZlciA9IHZvaWQgMDsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBidWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIoYXV0b0FsbG9jYXRlQ2h1bmtTaXplKTsKICAgICAgICAgICAgfSBjYXRjaCAoYnVmZmVyRSkgewogICAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVqZWN0ZWRXaXRoKGJ1ZmZlckUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBwdWxsSW50b0Rlc2NyaXB0b3IgPSB7CiAgICAgICAgICAgICAgYnVmZmVyOiBidWZmZXIsCiAgICAgICAgICAgICAgYnl0ZU9mZnNldDogMCwKICAgICAgICAgICAgICBieXRlTGVuZ3RoOiBhdXRvQWxsb2NhdGVDaHVua1NpemUsCiAgICAgICAgICAgICAgYnl0ZXNGaWxsZWQ6IDAsCiAgICAgICAgICAgICAgZWxlbWVudFNpemU6IDEsCiAgICAgICAgICAgICAgY3RvcjogVWludDhBcnJheSwKICAgICAgICAgICAgICByZWFkZXJUeXBlOiAnZGVmYXVsdCcKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdGhpcy5fcGVuZGluZ1B1bGxJbnRvcy5wdXNoKHB1bGxJbnRvRGVzY3JpcHRvcik7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgcHJvbWlzZSA9IFJlYWRhYmxlU3RyZWFtQWRkUmVhZFJlcXVlc3Qoc3RyZWFtKTsKICAgICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJDYWxsUHVsbElmTmVlZGVkKHRoaXMpOwogICAgICAgICAgcmV0dXJuIHByb21pc2U7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlcjsKICAgICAgfSgpOwogICAgICBmdW5jdGlvbiBJc1JlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXIoeCkgewogICAgICAgIGlmICghdHlwZUlzT2JqZWN0KHgpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmICghT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHgsICdfY29udHJvbGxlZFJlYWRhYmxlQnl0ZVN0cmVhbScpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIElzUmVhZGFibGVTdHJlYW1CWU9CUmVxdWVzdCh4KSB7CiAgICAgICAgaWYgKCF0eXBlSXNPYmplY3QoeCkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoeCwgJ19hc3NvY2lhdGVkUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlcicpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJDYWxsUHVsbElmTmVlZGVkKGNvbnRyb2xsZXIpIHsKICAgICAgICB2YXIgc2hvdWxkUHVsbCA9IFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJTaG91bGRDYWxsUHVsbChjb250cm9sbGVyKTsKICAgICAgICBpZiAoc2hvdWxkUHVsbCA9PT0gZmFsc2UpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKGNvbnRyb2xsZXIuX3B1bGxpbmcgPT09IHRydWUpIHsKICAgICAgICAgIGNvbnRyb2xsZXIuX3B1bGxBZ2FpbiA9IHRydWU7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnRyb2xsZXIuX3B1bGxpbmcgPSB0cnVlOwogICAgICAgIHZhciBwdWxsUHJvbWlzZSA9IGNvbnRyb2xsZXIuX3B1bGxBbGdvcml0aG0oKTsKICAgICAgICB1cG9uUHJvbWlzZShwdWxsUHJvbWlzZSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgY29udHJvbGxlci5fcHVsbGluZyA9IGZhbHNlOwogICAgICAgICAgaWYgKGNvbnRyb2xsZXIuX3B1bGxBZ2FpbiA9PT0gdHJ1ZSkgewogICAgICAgICAgICBjb250cm9sbGVyLl9wdWxsQWdhaW4gPSBmYWxzZTsKICAgICAgICAgICAgUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlckNhbGxQdWxsSWZOZWVkZWQoY29udHJvbGxlcik7CiAgICAgICAgICB9CiAgICAgICAgfSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJFcnJvcihjb250cm9sbGVyLCBlKTsKICAgICAgICB9KTsKICAgICAgfQogICAgICBmdW5jdGlvbiBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyQ2xlYXJQZW5kaW5nUHVsbEludG9zKGNvbnRyb2xsZXIpIHsKICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVySW52YWxpZGF0ZUJZT0JSZXF1ZXN0KGNvbnRyb2xsZXIpOwogICAgICAgIGNvbnRyb2xsZXIuX3BlbmRpbmdQdWxsSW50b3MgPSBuZXcgU2ltcGxlUXVldWUoKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyQ29tbWl0UHVsbEludG9EZXNjcmlwdG9yKHN0cmVhbSwgcHVsbEludG9EZXNjcmlwdG9yKSB7CiAgICAgICAgdmFyIGRvbmUgPSBmYWxzZTsKICAgICAgICBpZiAoc3RyZWFtLl9zdGF0ZSA9PT0gJ2Nsb3NlZCcpIHsKICAgICAgICAgIGRvbmUgPSB0cnVlOwogICAgICAgIH0KICAgICAgICB2YXIgZmlsbGVkVmlldyA9IFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJDb252ZXJ0UHVsbEludG9EZXNjcmlwdG9yKHB1bGxJbnRvRGVzY3JpcHRvcik7CiAgICAgICAgaWYgKHB1bGxJbnRvRGVzY3JpcHRvci5yZWFkZXJUeXBlID09PSAnZGVmYXVsdCcpIHsKICAgICAgICAgIFJlYWRhYmxlU3RyZWFtRnVsZmlsbFJlYWRSZXF1ZXN0KHN0cmVhbSwgZmlsbGVkVmlldywgZG9uZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFJlYWRhYmxlU3RyZWFtRnVsZmlsbFJlYWRJbnRvUmVxdWVzdChzdHJlYW0sIGZpbGxlZFZpZXcsIGRvbmUpOwogICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyQ29udmVydFB1bGxJbnRvRGVzY3JpcHRvcihwdWxsSW50b0Rlc2NyaXB0b3IpIHsKICAgICAgICB2YXIgYnl0ZXNGaWxsZWQgPSBwdWxsSW50b0Rlc2NyaXB0b3IuYnl0ZXNGaWxsZWQ7CiAgICAgICAgdmFyIGVsZW1lbnRTaXplID0gcHVsbEludG9EZXNjcmlwdG9yLmVsZW1lbnRTaXplOwogICAgICAgIHJldHVybiBuZXcgcHVsbEludG9EZXNjcmlwdG9yLmN0b3IocHVsbEludG9EZXNjcmlwdG9yLmJ1ZmZlciwgcHVsbEludG9EZXNjcmlwdG9yLmJ5dGVPZmZzZXQsIGJ5dGVzRmlsbGVkIC8gZWxlbWVudFNpemUpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJFbnF1ZXVlQ2h1bmtUb1F1ZXVlKGNvbnRyb2xsZXIsIGJ1ZmZlciwgYnl0ZU9mZnNldCwgYnl0ZUxlbmd0aCkgewogICAgICAgIGNvbnRyb2xsZXIuX3F1ZXVlLnB1c2goewogICAgICAgICAgYnVmZmVyOiBidWZmZXIsCiAgICAgICAgICBieXRlT2Zmc2V0OiBieXRlT2Zmc2V0LAogICAgICAgICAgYnl0ZUxlbmd0aDogYnl0ZUxlbmd0aAogICAgICAgIH0pOwogICAgICAgIGNvbnRyb2xsZXIuX3F1ZXVlVG90YWxTaXplICs9IGJ5dGVMZW5ndGg7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlckZpbGxQdWxsSW50b0Rlc2NyaXB0b3JGcm9tUXVldWUoY29udHJvbGxlciwgcHVsbEludG9EZXNjcmlwdG9yKSB7CiAgICAgICAgdmFyIGVsZW1lbnRTaXplID0gcHVsbEludG9EZXNjcmlwdG9yLmVsZW1lbnRTaXplOwogICAgICAgIHZhciBjdXJyZW50QWxpZ25lZEJ5dGVzID0gcHVsbEludG9EZXNjcmlwdG9yLmJ5dGVzRmlsbGVkIC0gcHVsbEludG9EZXNjcmlwdG9yLmJ5dGVzRmlsbGVkICUgZWxlbWVudFNpemU7CiAgICAgICAgdmFyIG1heEJ5dGVzVG9Db3B5ID0gTWF0aC5taW4oY29udHJvbGxlci5fcXVldWVUb3RhbFNpemUsIHB1bGxJbnRvRGVzY3JpcHRvci5ieXRlTGVuZ3RoIC0gcHVsbEludG9EZXNjcmlwdG9yLmJ5dGVzRmlsbGVkKTsKICAgICAgICB2YXIgbWF4Qnl0ZXNGaWxsZWQgPSBwdWxsSW50b0Rlc2NyaXB0b3IuYnl0ZXNGaWxsZWQgKyBtYXhCeXRlc1RvQ29weTsKICAgICAgICB2YXIgbWF4QWxpZ25lZEJ5dGVzID0gbWF4Qnl0ZXNGaWxsZWQgLSBtYXhCeXRlc0ZpbGxlZCAlIGVsZW1lbnRTaXplOwogICAgICAgIHZhciB0b3RhbEJ5dGVzVG9Db3B5UmVtYWluaW5nID0gbWF4Qnl0ZXNUb0NvcHk7CiAgICAgICAgdmFyIHJlYWR5ID0gZmFsc2U7CiAgICAgICAgaWYgKG1heEFsaWduZWRCeXRlcyA+IGN1cnJlbnRBbGlnbmVkQnl0ZXMpIHsKICAgICAgICAgIHRvdGFsQnl0ZXNUb0NvcHlSZW1haW5pbmcgPSBtYXhBbGlnbmVkQnl0ZXMgLSBwdWxsSW50b0Rlc2NyaXB0b3IuYnl0ZXNGaWxsZWQ7CiAgICAgICAgICByZWFkeSA9IHRydWU7CiAgICAgICAgfQogICAgICAgIHZhciBxdWV1ZSA9IGNvbnRyb2xsZXIuX3F1ZXVlOwogICAgICAgIHdoaWxlICh0b3RhbEJ5dGVzVG9Db3B5UmVtYWluaW5nID4gMCkgewogICAgICAgICAgdmFyIGhlYWRPZlF1ZXVlID0gcXVldWUucGVlaygpOwogICAgICAgICAgdmFyIGJ5dGVzVG9Db3B5ID0gTWF0aC5taW4odG90YWxCeXRlc1RvQ29weVJlbWFpbmluZywgaGVhZE9mUXVldWUuYnl0ZUxlbmd0aCk7CiAgICAgICAgICB2YXIgZGVzdFN0YXJ0ID0gcHVsbEludG9EZXNjcmlwdG9yLmJ5dGVPZmZzZXQgKyBwdWxsSW50b0Rlc2NyaXB0b3IuYnl0ZXNGaWxsZWQ7CiAgICAgICAgICBBcnJheUJ1ZmZlckNvcHkocHVsbEludG9EZXNjcmlwdG9yLmJ1ZmZlciwgZGVzdFN0YXJ0LCBoZWFkT2ZRdWV1ZS5idWZmZXIsIGhlYWRPZlF1ZXVlLmJ5dGVPZmZzZXQsIGJ5dGVzVG9Db3B5KTsKICAgICAgICAgIGlmIChoZWFkT2ZRdWV1ZS5ieXRlTGVuZ3RoID09PSBieXRlc1RvQ29weSkgewogICAgICAgICAgICBxdWV1ZS5zaGlmdCgpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaGVhZE9mUXVldWUuYnl0ZU9mZnNldCArPSBieXRlc1RvQ29weTsKICAgICAgICAgICAgaGVhZE9mUXVldWUuYnl0ZUxlbmd0aCAtPSBieXRlc1RvQ29weTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnRyb2xsZXIuX3F1ZXVlVG90YWxTaXplIC09IGJ5dGVzVG9Db3B5OwogICAgICAgICAgUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlckZpbGxIZWFkUHVsbEludG9EZXNjcmlwdG9yKGNvbnRyb2xsZXIsIGJ5dGVzVG9Db3B5LCBwdWxsSW50b0Rlc2NyaXB0b3IpOwogICAgICAgICAgdG90YWxCeXRlc1RvQ29weVJlbWFpbmluZyAtPSBieXRlc1RvQ29weTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlYWR5OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJGaWxsSGVhZFB1bGxJbnRvRGVzY3JpcHRvcihjb250cm9sbGVyLCBzaXplLCBwdWxsSW50b0Rlc2NyaXB0b3IpIHsKICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVySW52YWxpZGF0ZUJZT0JSZXF1ZXN0KGNvbnRyb2xsZXIpOwogICAgICAgIHB1bGxJbnRvRGVzY3JpcHRvci5ieXRlc0ZpbGxlZCArPSBzaXplOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJIYW5kbGVRdWV1ZURyYWluKGNvbnRyb2xsZXIpIHsKICAgICAgICBpZiAoY29udHJvbGxlci5fcXVldWVUb3RhbFNpemUgPT09IDAgJiYgY29udHJvbGxlci5fY2xvc2VSZXF1ZXN0ZWQgPT09IHRydWUpIHsKICAgICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJDbGVhckFsZ29yaXRobXMoY29udHJvbGxlcik7CiAgICAgICAgICBSZWFkYWJsZVN0cmVhbUNsb3NlKGNvbnRyb2xsZXIuX2NvbnRyb2xsZWRSZWFkYWJsZUJ5dGVTdHJlYW0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyQ2FsbFB1bGxJZk5lZWRlZChjb250cm9sbGVyKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlckludmFsaWRhdGVCWU9CUmVxdWVzdChjb250cm9sbGVyKSB7CiAgICAgICAgaWYgKGNvbnRyb2xsZXIuX2J5b2JSZXF1ZXN0ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY29udHJvbGxlci5fYnlvYlJlcXVlc3QuX2Fzc29jaWF0ZWRSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyID0gdW5kZWZpbmVkOwogICAgICAgIGNvbnRyb2xsZXIuX2J5b2JSZXF1ZXN0Ll92aWV3ID0gdW5kZWZpbmVkOwogICAgICAgIGNvbnRyb2xsZXIuX2J5b2JSZXF1ZXN0ID0gdW5kZWZpbmVkOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJQcm9jZXNzUHVsbEludG9EZXNjcmlwdG9yc1VzaW5nUXVldWUoY29udHJvbGxlcikgewogICAgICAgIHdoaWxlIChjb250cm9sbGVyLl9wZW5kaW5nUHVsbEludG9zLmxlbmd0aCA+IDApIHsKICAgICAgICAgIGlmIChjb250cm9sbGVyLl9xdWV1ZVRvdGFsU2l6ZSA9PT0gMCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgcHVsbEludG9EZXNjcmlwdG9yID0gY29udHJvbGxlci5fcGVuZGluZ1B1bGxJbnRvcy5wZWVrKCk7CiAgICAgICAgICBpZiAoUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlckZpbGxQdWxsSW50b0Rlc2NyaXB0b3JGcm9tUXVldWUoY29udHJvbGxlciwgcHVsbEludG9EZXNjcmlwdG9yKSA9PT0gdHJ1ZSkgewogICAgICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyU2hpZnRQZW5kaW5nUHVsbEludG8oY29udHJvbGxlcik7CiAgICAgICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJDb21taXRQdWxsSW50b0Rlc2NyaXB0b3IoY29udHJvbGxlci5fY29udHJvbGxlZFJlYWRhYmxlQnl0ZVN0cmVhbSwgcHVsbEludG9EZXNjcmlwdG9yKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlclB1bGxJbnRvKGNvbnRyb2xsZXIsIHZpZXcpIHsKICAgICAgICB2YXIgc3RyZWFtID0gY29udHJvbGxlci5fY29udHJvbGxlZFJlYWRhYmxlQnl0ZVN0cmVhbTsKICAgICAgICB2YXIgZWxlbWVudFNpemUgPSAxOwogICAgICAgIGlmICh2aWV3LmNvbnN0cnVjdG9yICE9PSBEYXRhVmlldykgewogICAgICAgICAgZWxlbWVudFNpemUgPSB2aWV3LmNvbnN0cnVjdG9yLkJZVEVTX1BFUl9FTEVNRU5UOwogICAgICAgIH0KICAgICAgICB2YXIgY3RvciA9IHZpZXcuY29uc3RydWN0b3I7CiAgICAgICAgdmFyIGJ1ZmZlciA9IFRyYW5zZmVyQXJyYXlCdWZmZXIodmlldy5idWZmZXIpOwogICAgICAgIHZhciBwdWxsSW50b0Rlc2NyaXB0b3IgPSB7CiAgICAgICAgICBidWZmZXI6IGJ1ZmZlciwKICAgICAgICAgIGJ5dGVPZmZzZXQ6IHZpZXcuYnl0ZU9mZnNldCwKICAgICAgICAgIGJ5dGVMZW5ndGg6IHZpZXcuYnl0ZUxlbmd0aCwKICAgICAgICAgIGJ5dGVzRmlsbGVkOiAwLAogICAgICAgICAgZWxlbWVudFNpemU6IGVsZW1lbnRTaXplLAogICAgICAgICAgY3RvcjogY3RvciwKICAgICAgICAgIHJlYWRlclR5cGU6ICdieW9iJwogICAgICAgIH07CiAgICAgICAgaWYgKGNvbnRyb2xsZXIuX3BlbmRpbmdQdWxsSW50b3MubGVuZ3RoID4gMCkgewogICAgICAgICAgY29udHJvbGxlci5fcGVuZGluZ1B1bGxJbnRvcy5wdXNoKHB1bGxJbnRvRGVzY3JpcHRvcik7CiAgICAgICAgICByZXR1cm4gUmVhZGFibGVTdHJlYW1BZGRSZWFkSW50b1JlcXVlc3Qoc3RyZWFtKTsKICAgICAgICB9CiAgICAgICAgaWYgKHN0cmVhbS5fc3RhdGUgPT09ICdjbG9zZWQnKSB7CiAgICAgICAgICB2YXIgZW1wdHlWaWV3ID0gbmV3IGN0b3IocHVsbEludG9EZXNjcmlwdG9yLmJ1ZmZlciwgcHVsbEludG9EZXNjcmlwdG9yLmJ5dGVPZmZzZXQsIDApOwogICAgICAgICAgcmV0dXJuIHByb21pc2VSZXNvbHZlZFdpdGgoUmVhZGFibGVTdHJlYW1DcmVhdGVSZWFkUmVzdWx0KGVtcHR5VmlldywgdHJ1ZSwgc3RyZWFtLl9yZWFkZXIuX2ZvckF1dGhvckNvZGUpKTsKICAgICAgICB9CiAgICAgICAgaWYgKGNvbnRyb2xsZXIuX3F1ZXVlVG90YWxTaXplID4gMCkgewogICAgICAgICAgaWYgKFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJGaWxsUHVsbEludG9EZXNjcmlwdG9yRnJvbVF1ZXVlKGNvbnRyb2xsZXIsIHB1bGxJbnRvRGVzY3JpcHRvcikgPT09IHRydWUpIHsKICAgICAgICAgICAgdmFyIGZpbGxlZFZpZXcgPSBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyQ29udmVydFB1bGxJbnRvRGVzY3JpcHRvcihwdWxsSW50b0Rlc2NyaXB0b3IpOwogICAgICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVySGFuZGxlUXVldWVEcmFpbihjb250cm9sbGVyKTsKICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZXNvbHZlZFdpdGgoUmVhZGFibGVTdHJlYW1DcmVhdGVSZWFkUmVzdWx0KGZpbGxlZFZpZXcsIGZhbHNlLCBzdHJlYW0uX3JlYWRlci5fZm9yQXV0aG9yQ29kZSkpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGNvbnRyb2xsZXIuX2Nsb3NlUmVxdWVzdGVkID09PSB0cnVlKSB7CiAgICAgICAgICAgIHZhciBlID0gbmV3IFR5cGVFcnJvcignSW5zdWZmaWNpZW50IGJ5dGVzIHRvIGZpbGwgZWxlbWVudHMgaW4gdGhlIGdpdmVuIGJ1ZmZlcicpOwogICAgICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyRXJyb3IoY29udHJvbGxlciwgZSk7CiAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVqZWN0ZWRXaXRoKGUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb250cm9sbGVyLl9wZW5kaW5nUHVsbEludG9zLnB1c2gocHVsbEludG9EZXNjcmlwdG9yKTsKICAgICAgICB2YXIgcHJvbWlzZSA9IFJlYWRhYmxlU3RyZWFtQWRkUmVhZEludG9SZXF1ZXN0KHN0cmVhbSk7CiAgICAgICAgUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlckNhbGxQdWxsSWZOZWVkZWQoY29udHJvbGxlcik7CiAgICAgICAgcmV0dXJuIHByb21pc2U7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlclJlc3BvbmRJbkNsb3NlZFN0YXRlKGNvbnRyb2xsZXIsIGZpcnN0RGVzY3JpcHRvcikgewogICAgICAgIGZpcnN0RGVzY3JpcHRvci5idWZmZXIgPSBUcmFuc2ZlckFycmF5QnVmZmVyKGZpcnN0RGVzY3JpcHRvci5idWZmZXIpOwogICAgICAgIHZhciBzdHJlYW0gPSBjb250cm9sbGVyLl9jb250cm9sbGVkUmVhZGFibGVCeXRlU3RyZWFtOwogICAgICAgIGlmIChSZWFkYWJsZVN0cmVhbUhhc0JZT0JSZWFkZXIoc3RyZWFtKSA9PT0gdHJ1ZSkgewogICAgICAgICAgd2hpbGUgKFJlYWRhYmxlU3RyZWFtR2V0TnVtUmVhZEludG9SZXF1ZXN0cyhzdHJlYW0pID4gMCkgewogICAgICAgICAgICB2YXIgcHVsbEludG9EZXNjcmlwdG9yID0gUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlclNoaWZ0UGVuZGluZ1B1bGxJbnRvKGNvbnRyb2xsZXIpOwogICAgICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyQ29tbWl0UHVsbEludG9EZXNjcmlwdG9yKHN0cmVhbSwgcHVsbEludG9EZXNjcmlwdG9yKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlclJlc3BvbmRJblJlYWRhYmxlU3RhdGUoY29udHJvbGxlciwgYnl0ZXNXcml0dGVuLCBwdWxsSW50b0Rlc2NyaXB0b3IpIHsKICAgICAgICBpZiAocHVsbEludG9EZXNjcmlwdG9yLmJ5dGVzRmlsbGVkICsgYnl0ZXNXcml0dGVuID4gcHVsbEludG9EZXNjcmlwdG9yLmJ5dGVMZW5ndGgpIHsKICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdieXRlc1dyaXR0ZW4gb3V0IG9mIHJhbmdlJyk7CiAgICAgICAgfQogICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJGaWxsSGVhZFB1bGxJbnRvRGVzY3JpcHRvcihjb250cm9sbGVyLCBieXRlc1dyaXR0ZW4sIHB1bGxJbnRvRGVzY3JpcHRvcik7CiAgICAgICAgaWYgKHB1bGxJbnRvRGVzY3JpcHRvci5ieXRlc0ZpbGxlZCA8IHB1bGxJbnRvRGVzY3JpcHRvci5lbGVtZW50U2l6ZSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyU2hpZnRQZW5kaW5nUHVsbEludG8oY29udHJvbGxlcik7CiAgICAgICAgdmFyIHJlbWFpbmRlclNpemUgPSBwdWxsSW50b0Rlc2NyaXB0b3IuYnl0ZXNGaWxsZWQgJSBwdWxsSW50b0Rlc2NyaXB0b3IuZWxlbWVudFNpemU7CiAgICAgICAgaWYgKHJlbWFpbmRlclNpemUgPiAwKSB7CiAgICAgICAgICB2YXIgZW5kID0gcHVsbEludG9EZXNjcmlwdG9yLmJ5dGVPZmZzZXQgKyBwdWxsSW50b0Rlc2NyaXB0b3IuYnl0ZXNGaWxsZWQ7CiAgICAgICAgICB2YXIgcmVtYWluZGVyID0gcHVsbEludG9EZXNjcmlwdG9yLmJ1ZmZlci5zbGljZShlbmQgLSByZW1haW5kZXJTaXplLCBlbmQpOwogICAgICAgICAgUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlckVucXVldWVDaHVua1RvUXVldWUoY29udHJvbGxlciwgcmVtYWluZGVyLCAwLCByZW1haW5kZXIuYnl0ZUxlbmd0aCk7CiAgICAgICAgfQogICAgICAgIHB1bGxJbnRvRGVzY3JpcHRvci5idWZmZXIgPSBUcmFuc2ZlckFycmF5QnVmZmVyKHB1bGxJbnRvRGVzY3JpcHRvci5idWZmZXIpOwogICAgICAgIHB1bGxJbnRvRGVzY3JpcHRvci5ieXRlc0ZpbGxlZCAtPSByZW1haW5kZXJTaXplOwogICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJDb21taXRQdWxsSW50b0Rlc2NyaXB0b3IoY29udHJvbGxlci5fY29udHJvbGxlZFJlYWRhYmxlQnl0ZVN0cmVhbSwgcHVsbEludG9EZXNjcmlwdG9yKTsKICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyUHJvY2Vzc1B1bGxJbnRvRGVzY3JpcHRvcnNVc2luZ1F1ZXVlKGNvbnRyb2xsZXIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJSZXNwb25kSW50ZXJuYWwoY29udHJvbGxlciwgYnl0ZXNXcml0dGVuKSB7CiAgICAgICAgdmFyIGZpcnN0RGVzY3JpcHRvciA9IGNvbnRyb2xsZXIuX3BlbmRpbmdQdWxsSW50b3MucGVlaygpOwogICAgICAgIHZhciBzdHJlYW0gPSBjb250cm9sbGVyLl9jb250cm9sbGVkUmVhZGFibGVCeXRlU3RyZWFtOwogICAgICAgIGlmIChzdHJlYW0uX3N0YXRlID09PSAnY2xvc2VkJykgewogICAgICAgICAgaWYgKGJ5dGVzV3JpdHRlbiAhPT0gMCkgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdieXRlc1dyaXR0ZW4gbXVzdCBiZSAwIHdoZW4gY2FsbGluZyByZXNwb25kKCkgb24gYSBjbG9zZWQgc3RyZWFtJyk7CiAgICAgICAgICB9CiAgICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyUmVzcG9uZEluQ2xvc2VkU3RhdGUoY29udHJvbGxlciwgZmlyc3REZXNjcmlwdG9yKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlclJlc3BvbmRJblJlYWRhYmxlU3RhdGUoY29udHJvbGxlciwgYnl0ZXNXcml0dGVuLCBmaXJzdERlc2NyaXB0b3IpOwogICAgICAgIH0KICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyQ2FsbFB1bGxJZk5lZWRlZChjb250cm9sbGVyKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyU2hpZnRQZW5kaW5nUHVsbEludG8oY29udHJvbGxlcikgewogICAgICAgIHZhciBkZXNjcmlwdG9yID0gY29udHJvbGxlci5fcGVuZGluZ1B1bGxJbnRvcy5zaGlmdCgpOwogICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJJbnZhbGlkYXRlQllPQlJlcXVlc3QoY29udHJvbGxlcik7CiAgICAgICAgcmV0dXJuIGRlc2NyaXB0b3I7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlclNob3VsZENhbGxQdWxsKGNvbnRyb2xsZXIpIHsKICAgICAgICB2YXIgc3RyZWFtID0gY29udHJvbGxlci5fY29udHJvbGxlZFJlYWRhYmxlQnl0ZVN0cmVhbTsKICAgICAgICBpZiAoc3RyZWFtLl9zdGF0ZSAhPT0gJ3JlYWRhYmxlJykgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoY29udHJvbGxlci5fY2xvc2VSZXF1ZXN0ZWQgPT09IHRydWUpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKGNvbnRyb2xsZXIuX3N0YXJ0ZWQgPT09IGZhbHNlKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmIChSZWFkYWJsZVN0cmVhbUhhc0RlZmF1bHRSZWFkZXIoc3RyZWFtKSA9PT0gdHJ1ZSAmJiBSZWFkYWJsZVN0cmVhbUdldE51bVJlYWRSZXF1ZXN0cyhzdHJlYW0pID4gMCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChSZWFkYWJsZVN0cmVhbUhhc0JZT0JSZWFkZXIoc3RyZWFtKSA9PT0gdHJ1ZSAmJiBSZWFkYWJsZVN0cmVhbUdldE51bVJlYWRJbnRvUmVxdWVzdHMoc3RyZWFtKSA+IDApIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICB2YXIgZGVzaXJlZFNpemUgPSBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyR2V0RGVzaXJlZFNpemUoY29udHJvbGxlcik7CiAgICAgICAgaWYgKGRlc2lyZWRTaXplID4gMCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBmdW5jdGlvbiBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyQ2xlYXJBbGdvcml0aG1zKGNvbnRyb2xsZXIpIHsKICAgICAgICBjb250cm9sbGVyLl9wdWxsQWxnb3JpdGhtID0gdW5kZWZpbmVkOwogICAgICAgIGNvbnRyb2xsZXIuX2NhbmNlbEFsZ29yaXRobSA9IHVuZGVmaW5lZDsKICAgICAgfQogICAgICBmdW5jdGlvbiBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyQ2xvc2UoY29udHJvbGxlcikgewogICAgICAgIHZhciBzdHJlYW0gPSBjb250cm9sbGVyLl9jb250cm9sbGVkUmVhZGFibGVCeXRlU3RyZWFtOwogICAgICAgIGlmIChjb250cm9sbGVyLl9xdWV1ZVRvdGFsU2l6ZSA+IDApIHsKICAgICAgICAgIGNvbnRyb2xsZXIuX2Nsb3NlUmVxdWVzdGVkID0gdHJ1ZTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKGNvbnRyb2xsZXIuX3BlbmRpbmdQdWxsSW50b3MubGVuZ3RoID4gMCkgewogICAgICAgICAgdmFyIGZpcnN0UGVuZGluZ1B1bGxJbnRvID0gY29udHJvbGxlci5fcGVuZGluZ1B1bGxJbnRvcy5wZWVrKCk7CiAgICAgICAgICBpZiAoZmlyc3RQZW5kaW5nUHVsbEludG8uYnl0ZXNGaWxsZWQgPiAwKSB7CiAgICAgICAgICAgIHZhciBlID0gbmV3IFR5cGVFcnJvcignSW5zdWZmaWNpZW50IGJ5dGVzIHRvIGZpbGwgZWxlbWVudHMgaW4gdGhlIGdpdmVuIGJ1ZmZlcicpOwogICAgICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyRXJyb3IoY29udHJvbGxlciwgZSk7CiAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJDbGVhckFsZ29yaXRobXMoY29udHJvbGxlcik7CiAgICAgICAgUmVhZGFibGVTdHJlYW1DbG9zZShzdHJlYW0pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJFbnF1ZXVlKGNvbnRyb2xsZXIsIGNodW5rKSB7CiAgICAgICAgdmFyIHN0cmVhbSA9IGNvbnRyb2xsZXIuX2NvbnRyb2xsZWRSZWFkYWJsZUJ5dGVTdHJlYW07CiAgICAgICAgdmFyIGJ1ZmZlciA9IGNodW5rLmJ1ZmZlcjsKICAgICAgICB2YXIgYnl0ZU9mZnNldCA9IGNodW5rLmJ5dGVPZmZzZXQ7CiAgICAgICAgdmFyIGJ5dGVMZW5ndGggPSBjaHVuay5ieXRlTGVuZ3RoOwogICAgICAgIHZhciB0cmFuc2ZlcnJlZEJ1ZmZlciA9IFRyYW5zZmVyQXJyYXlCdWZmZXIoYnVmZmVyKTsKICAgICAgICBpZiAoUmVhZGFibGVTdHJlYW1IYXNEZWZhdWx0UmVhZGVyKHN0cmVhbSkgPT09IHRydWUpIHsKICAgICAgICAgIGlmIChSZWFkYWJsZVN0cmVhbUdldE51bVJlYWRSZXF1ZXN0cyhzdHJlYW0pID09PSAwKSB7CiAgICAgICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJFbnF1ZXVlQ2h1bmtUb1F1ZXVlKGNvbnRyb2xsZXIsIHRyYW5zZmVycmVkQnVmZmVyLCBieXRlT2Zmc2V0LCBieXRlTGVuZ3RoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciB0cmFuc2ZlcnJlZFZpZXcgPSBuZXcgVWludDhBcnJheSh0cmFuc2ZlcnJlZEJ1ZmZlciwgYnl0ZU9mZnNldCwgYnl0ZUxlbmd0aCk7CiAgICAgICAgICAgIFJlYWRhYmxlU3RyZWFtRnVsZmlsbFJlYWRSZXF1ZXN0KHN0cmVhbSwgdHJhbnNmZXJyZWRWaWV3LCBmYWxzZSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChSZWFkYWJsZVN0cmVhbUhhc0JZT0JSZWFkZXIoc3RyZWFtKSA9PT0gdHJ1ZSkgewogICAgICAgICAgUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlckVucXVldWVDaHVua1RvUXVldWUoY29udHJvbGxlciwgdHJhbnNmZXJyZWRCdWZmZXIsIGJ5dGVPZmZzZXQsIGJ5dGVMZW5ndGgpOwogICAgICAgICAgUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlclByb2Nlc3NQdWxsSW50b0Rlc2NyaXB0b3JzVXNpbmdRdWV1ZShjb250cm9sbGVyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlckVucXVldWVDaHVua1RvUXVldWUoY29udHJvbGxlciwgdHJhbnNmZXJyZWRCdWZmZXIsIGJ5dGVPZmZzZXQsIGJ5dGVMZW5ndGgpOwogICAgICAgIH0KICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyQ2FsbFB1bGxJZk5lZWRlZChjb250cm9sbGVyKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyRXJyb3IoY29udHJvbGxlciwgZSkgewogICAgICAgIHZhciBzdHJlYW0gPSBjb250cm9sbGVyLl9jb250cm9sbGVkUmVhZGFibGVCeXRlU3RyZWFtOwogICAgICAgIGlmIChzdHJlYW0uX3N0YXRlICE9PSAncmVhZGFibGUnKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJDbGVhclBlbmRpbmdQdWxsSW50b3MoY29udHJvbGxlcik7CiAgICAgICAgUmVzZXRRdWV1ZShjb250cm9sbGVyKTsKICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyQ2xlYXJBbGdvcml0aG1zKGNvbnRyb2xsZXIpOwogICAgICAgIFJlYWRhYmxlU3RyZWFtRXJyb3Ioc3RyZWFtLCBlKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyR2V0RGVzaXJlZFNpemUoY29udHJvbGxlcikgewogICAgICAgIHZhciBzdHJlYW0gPSBjb250cm9sbGVyLl9jb250cm9sbGVkUmVhZGFibGVCeXRlU3RyZWFtOwogICAgICAgIHZhciBzdGF0ZSA9IHN0cmVhbS5fc3RhdGU7CiAgICAgICAgaWYgKHN0YXRlID09PSAnZXJyb3JlZCcpIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBpZiAoc3RhdGUgPT09ICdjbG9zZWQnKSB7CiAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNvbnRyb2xsZXIuX3N0cmF0ZWd5SFdNIC0gY29udHJvbGxlci5fcXVldWVUb3RhbFNpemU7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlclJlc3BvbmQoY29udHJvbGxlciwgYnl0ZXNXcml0dGVuKSB7CiAgICAgICAgYnl0ZXNXcml0dGVuID0gTnVtYmVyKGJ5dGVzV3JpdHRlbik7CiAgICAgICAgaWYgKElzRmluaXRlTm9uTmVnYXRpdmVOdW1iZXIoYnl0ZXNXcml0dGVuKSA9PT0gZmFsc2UpIHsKICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdieXRlc1dyaXR0ZW4gbXVzdCBiZSBhIGZpbml0ZScpOwogICAgICAgIH0KICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyUmVzcG9uZEludGVybmFsKGNvbnRyb2xsZXIsIGJ5dGVzV3JpdHRlbik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlclJlc3BvbmRXaXRoTmV3Vmlldyhjb250cm9sbGVyLCB2aWV3KSB7CiAgICAgICAgdmFyIGZpcnN0RGVzY3JpcHRvciA9IGNvbnRyb2xsZXIuX3BlbmRpbmdQdWxsSW50b3MucGVlaygpOwogICAgICAgIGlmIChmaXJzdERlc2NyaXB0b3IuYnl0ZU9mZnNldCArIGZpcnN0RGVzY3JpcHRvci5ieXRlc0ZpbGxlZCAhPT0gdmlldy5ieXRlT2Zmc2V0KSB7CiAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignVGhlIHJlZ2lvbiBzcGVjaWZpZWQgYnkgdmlldyBkb2VzIG5vdCBtYXRjaCBieW9iUmVxdWVzdCcpOwogICAgICAgIH0KICAgICAgICBpZiAoZmlyc3REZXNjcmlwdG9yLmJ5dGVMZW5ndGggIT09IHZpZXcuYnl0ZUxlbmd0aCkgewogICAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ1RoZSBidWZmZXIgb2YgdmlldyBoYXMgZGlmZmVyZW50IGNhcGFjaXR5IHRoYW4gYnlvYlJlcXVlc3QnKTsKICAgICAgICB9CiAgICAgICAgZmlyc3REZXNjcmlwdG9yLmJ1ZmZlciA9IHZpZXcuYnVmZmVyOwogICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJSZXNwb25kSW50ZXJuYWwoY29udHJvbGxlciwgdmlldy5ieXRlTGVuZ3RoKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBTZXRVcFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXIoc3RyZWFtLCBjb250cm9sbGVyLCBzdGFydEFsZ29yaXRobSwgcHVsbEFsZ29yaXRobSwgY2FuY2VsQWxnb3JpdGhtLCBoaWdoV2F0ZXJNYXJrLCBhdXRvQWxsb2NhdGVDaHVua1NpemUpIHsKICAgICAgICBjb250cm9sbGVyLl9jb250cm9sbGVkUmVhZGFibGVCeXRlU3RyZWFtID0gc3RyZWFtOwogICAgICAgIGNvbnRyb2xsZXIuX3B1bGxBZ2FpbiA9IGZhbHNlOwogICAgICAgIGNvbnRyb2xsZXIuX3B1bGxpbmcgPSBmYWxzZTsKICAgICAgICBjb250cm9sbGVyLl9ieW9iUmVxdWVzdCA9IHVuZGVmaW5lZDsKICAgICAgICBjb250cm9sbGVyLl9xdWV1ZSA9IGNvbnRyb2xsZXIuX3F1ZXVlVG90YWxTaXplID0gdW5kZWZpbmVkOwogICAgICAgIFJlc2V0UXVldWUoY29udHJvbGxlcik7CiAgICAgICAgY29udHJvbGxlci5fY2xvc2VSZXF1ZXN0ZWQgPSBmYWxzZTsKICAgICAgICBjb250cm9sbGVyLl9zdGFydGVkID0gZmFsc2U7CiAgICAgICAgY29udHJvbGxlci5fc3RyYXRlZ3lIV00gPSBWYWxpZGF0ZUFuZE5vcm1hbGl6ZUhpZ2hXYXRlck1hcmsoaGlnaFdhdGVyTWFyayk7CiAgICAgICAgY29udHJvbGxlci5fcHVsbEFsZ29yaXRobSA9IHB1bGxBbGdvcml0aG07CiAgICAgICAgY29udHJvbGxlci5fY2FuY2VsQWxnb3JpdGhtID0gY2FuY2VsQWxnb3JpdGhtOwogICAgICAgIGNvbnRyb2xsZXIuX2F1dG9BbGxvY2F0ZUNodW5rU2l6ZSA9IGF1dG9BbGxvY2F0ZUNodW5rU2l6ZTsKICAgICAgICBjb250cm9sbGVyLl9wZW5kaW5nUHVsbEludG9zID0gbmV3IFNpbXBsZVF1ZXVlKCk7CiAgICAgICAgc3RyZWFtLl9yZWFkYWJsZVN0cmVhbUNvbnRyb2xsZXIgPSBjb250cm9sbGVyOwogICAgICAgIHZhciBzdGFydFJlc3VsdCA9IHN0YXJ0QWxnb3JpdGhtKCk7CiAgICAgICAgdXBvblByb21pc2UocHJvbWlzZVJlc29sdmVkV2l0aChzdGFydFJlc3VsdCksIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGNvbnRyb2xsZXIuX3N0YXJ0ZWQgPSB0cnVlOwogICAgICAgICAgUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlckNhbGxQdWxsSWZOZWVkZWQoY29udHJvbGxlcik7CiAgICAgICAgfSwgZnVuY3Rpb24gKHIpIHsKICAgICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJFcnJvcihjb250cm9sbGVyLCByKTsKICAgICAgICB9KTsKICAgICAgfQogICAgICBmdW5jdGlvbiBTZXRVcFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJGcm9tVW5kZXJseWluZ1NvdXJjZShzdHJlYW0sIHVuZGVybHlpbmdCeXRlU291cmNlLCBoaWdoV2F0ZXJNYXJrKSB7CiAgICAgICAgdmFyIGNvbnRyb2xsZXIgPSBPYmplY3QuY3JlYXRlKFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXIucHJvdG90eXBlKTsKICAgICAgICBmdW5jdGlvbiBzdGFydEFsZ29yaXRobSgpIHsKICAgICAgICAgIHJldHVybiBJbnZva2VPck5vb3AodW5kZXJseWluZ0J5dGVTb3VyY2UsICdzdGFydCcsIFtjb250cm9sbGVyXSk7CiAgICAgICAgfQogICAgICAgIHZhciBwdWxsQWxnb3JpdGhtID0gQ3JlYXRlQWxnb3JpdGhtRnJvbVVuZGVybHlpbmdNZXRob2QodW5kZXJseWluZ0J5dGVTb3VyY2UsICdwdWxsJywgMCwgW2NvbnRyb2xsZXJdKTsKICAgICAgICB2YXIgY2FuY2VsQWxnb3JpdGhtID0gQ3JlYXRlQWxnb3JpdGhtRnJvbVVuZGVybHlpbmdNZXRob2QodW5kZXJseWluZ0J5dGVTb3VyY2UsICdjYW5jZWwnLCAxLCBbXSk7CiAgICAgICAgdmFyIGF1dG9BbGxvY2F0ZUNodW5rU2l6ZSA9IHVuZGVybHlpbmdCeXRlU291cmNlLmF1dG9BbGxvY2F0ZUNodW5rU2l6ZTsKICAgICAgICBpZiAoYXV0b0FsbG9jYXRlQ2h1bmtTaXplICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGF1dG9BbGxvY2F0ZUNodW5rU2l6ZSA9IE51bWJlcihhdXRvQWxsb2NhdGVDaHVua1NpemUpOwogICAgICAgICAgaWYgKE51bWJlcklzSW50ZWdlcihhdXRvQWxsb2NhdGVDaHVua1NpemUpID09PSBmYWxzZSB8fCBhdXRvQWxsb2NhdGVDaHVua1NpemUgPD0gMCkgewogICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignYXV0b0FsbG9jYXRlQ2h1bmtTaXplIG11c3QgYmUgYSBwb3NpdGl2ZSBpbnRlZ2VyJyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIFNldFVwUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlcihzdHJlYW0sIGNvbnRyb2xsZXIsIHN0YXJ0QWxnb3JpdGhtLCBwdWxsQWxnb3JpdGhtLCBjYW5jZWxBbGdvcml0aG0sIGhpZ2hXYXRlck1hcmssIGF1dG9BbGxvY2F0ZUNodW5rU2l6ZSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gU2V0VXBSZWFkYWJsZVN0cmVhbUJZT0JSZXF1ZXN0KHJlcXVlc3QsIGNvbnRyb2xsZXIsIHZpZXcpIHsKICAgICAgICByZXF1ZXN0Ll9hc3NvY2lhdGVkUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlciA9IGNvbnRyb2xsZXI7CiAgICAgICAgcmVxdWVzdC5fdmlldyA9IHZpZXc7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gYnlvYlJlcXVlc3RCcmFuZENoZWNrRXhjZXB0aW9uKG5hbWUpIHsKICAgICAgICByZXR1cm4gbmV3IFR5cGVFcnJvcigiUmVhZGFibGVTdHJlYW1CWU9CUmVxdWVzdC5wcm90b3R5cGUuIiArIG5hbWUgKyAiIGNhbiBvbmx5IGJlIHVzZWQgb24gYSBSZWFkYWJsZVN0cmVhbUJZT0JSZXF1ZXN0Iik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gYnl0ZVN0cmVhbUNvbnRyb2xsZXJCcmFuZENoZWNrRXhjZXB0aW9uKG5hbWUpIHsKICAgICAgICByZXR1cm4gbmV3IFR5cGVFcnJvcigiUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlci5wcm90b3R5cGUuIiArIG5hbWUgKyAiIGNhbiBvbmx5IGJlIHVzZWQgb24gYSBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyIik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gQWNxdWlyZVJlYWRhYmxlU3RyZWFtQllPQlJlYWRlcihzdHJlYW0sIGZvckF1dGhvckNvZGUpIHsKICAgICAgICBpZiAoZm9yQXV0aG9yQ29kZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICBmb3JBdXRob3JDb2RlID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHZhciByZWFkZXIgPSBuZXcgUmVhZGFibGVTdHJlYW1CWU9CUmVhZGVyKHN0cmVhbSk7CiAgICAgICAgcmVhZGVyLl9mb3JBdXRob3JDb2RlID0gZm9yQXV0aG9yQ29kZTsKICAgICAgICByZXR1cm4gcmVhZGVyOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlU3RyZWFtQWRkUmVhZEludG9SZXF1ZXN0KHN0cmVhbSkgewogICAgICAgIHZhciBwcm9taXNlID0gbmV3UHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICB2YXIgcmVhZEludG9SZXF1ZXN0ID0gewogICAgICAgICAgICBfcmVzb2x2ZTogcmVzb2x2ZSwKICAgICAgICAgICAgX3JlamVjdDogcmVqZWN0CiAgICAgICAgICB9OwogICAgICAgICAgc3RyZWFtLl9yZWFkZXIuX3JlYWRJbnRvUmVxdWVzdHMucHVzaChyZWFkSW50b1JlcXVlc3QpOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBwcm9taXNlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlU3RyZWFtRnVsZmlsbFJlYWRJbnRvUmVxdWVzdChzdHJlYW0sIGNodW5rLCBkb25lKSB7CiAgICAgICAgdmFyIHJlYWRlciA9IHN0cmVhbS5fcmVhZGVyOwogICAgICAgIHZhciByZWFkSW50b1JlcXVlc3QgPSByZWFkZXIuX3JlYWRJbnRvUmVxdWVzdHMuc2hpZnQoKTsKICAgICAgICByZWFkSW50b1JlcXVlc3QuX3Jlc29sdmUoUmVhZGFibGVTdHJlYW1DcmVhdGVSZWFkUmVzdWx0KGNodW5rLCBkb25lLCByZWFkZXIuX2ZvckF1dGhvckNvZGUpKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBSZWFkYWJsZVN0cmVhbUdldE51bVJlYWRJbnRvUmVxdWVzdHMoc3RyZWFtKSB7CiAgICAgICAgcmV0dXJuIHN0cmVhbS5fcmVhZGVyLl9yZWFkSW50b1JlcXVlc3RzLmxlbmd0aDsKICAgICAgfQogICAgICBmdW5jdGlvbiBSZWFkYWJsZVN0cmVhbUhhc0JZT0JSZWFkZXIoc3RyZWFtKSB7CiAgICAgICAgdmFyIHJlYWRlciA9IHN0cmVhbS5fcmVhZGVyOwogICAgICAgIGlmIChyZWFkZXIgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoIUlzUmVhZGFibGVTdHJlYW1CWU9CUmVhZGVyKHJlYWRlcikpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgdmFyIFJlYWRhYmxlU3RyZWFtQllPQlJlYWRlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBSZWFkYWJsZVN0cmVhbUJZT0JSZWFkZXIoc3RyZWFtKSB7CiAgICAgICAgICBpZiAoIUlzUmVhZGFibGVTdHJlYW0oc3RyZWFtKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdSZWFkYWJsZVN0cmVhbUJZT0JSZWFkZXIgY2FuIG9ubHkgYmUgY29uc3RydWN0ZWQgd2l0aCBhIFJlYWRhYmxlU3RyZWFtIGluc3RhbmNlIGdpdmVuIGEgJyArICdieXRlIHNvdXJjZScpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKElzUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlcihzdHJlYW0uX3JlYWRhYmxlU3RyZWFtQ29udHJvbGxlcikgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjb25zdHJ1Y3QgYSBSZWFkYWJsZVN0cmVhbUJZT0JSZWFkZXIgZm9yIGEgc3RyZWFtIG5vdCBjb25zdHJ1Y3RlZCB3aXRoIGEgYnl0ZSAnICsgJ3NvdXJjZScpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKElzUmVhZGFibGVTdHJlYW1Mb2NrZWQoc3RyZWFtKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdUaGlzIHN0cmVhbSBoYXMgYWxyZWFkeSBiZWVuIGxvY2tlZCBmb3IgZXhjbHVzaXZlIHJlYWRpbmcgYnkgYW5vdGhlciByZWFkZXInKTsKICAgICAgICAgIH0KICAgICAgICAgIFJlYWRhYmxlU3RyZWFtUmVhZGVyR2VuZXJpY0luaXRpYWxpemUodGhpcywgc3RyZWFtKTsKICAgICAgICAgIHRoaXMuX3JlYWRJbnRvUmVxdWVzdHMgPSBuZXcgU2ltcGxlUXVldWUoKTsKICAgICAgICB9CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFJlYWRhYmxlU3RyZWFtQllPQlJlYWRlci5wcm90b3R5cGUsICJjbG9zZWQiLCB7CiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgaWYgKCFJc1JlYWRhYmxlU3RyZWFtQllPQlJlYWRlcih0aGlzKSkgewogICAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVqZWN0ZWRXaXRoKGJ5b2JSZWFkZXJCcmFuZENoZWNrRXhjZXB0aW9uKCdjbG9zZWQnKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Nsb3NlZFByb21pc2U7CiAgICAgICAgICB9LAogICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIFJlYWRhYmxlU3RyZWFtQllPQlJlYWRlci5wcm90b3R5cGUuY2FuY2VsID0gZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgaWYgKCFJc1JlYWRhYmxlU3RyZWFtQllPQlJlYWRlcih0aGlzKSkgewogICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChieW9iUmVhZGVyQnJhbmRDaGVja0V4Y2VwdGlvbignY2FuY2VsJykpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHRoaXMuX293bmVyUmVhZGFibGVTdHJlYW0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChyZWFkZXJMb2NrRXhjZXB0aW9uKCdjYW5jZWwnKSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gUmVhZGFibGVTdHJlYW1SZWFkZXJHZW5lcmljQ2FuY2VsKHRoaXMsIHJlYXNvbik7CiAgICAgICAgfTsKICAgICAgICBSZWFkYWJsZVN0cmVhbUJZT0JSZWFkZXIucHJvdG90eXBlLnJlYWQgPSBmdW5jdGlvbiAodmlldykgewogICAgICAgICAgaWYgKCFJc1JlYWRhYmxlU3RyZWFtQllPQlJlYWRlcih0aGlzKSkgewogICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChieW9iUmVhZGVyQnJhbmRDaGVja0V4Y2VwdGlvbigncmVhZCcpKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLl9vd25lclJlYWRhYmxlU3RyZWFtID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZWplY3RlZFdpdGgocmVhZGVyTG9ja0V4Y2VwdGlvbigncmVhZCBmcm9tJykpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCFBcnJheUJ1ZmZlci5pc1ZpZXcodmlldykpIHsKICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZWplY3RlZFdpdGgobmV3IFR5cGVFcnJvcigndmlldyBtdXN0IGJlIGFuIGFycmF5IGJ1ZmZlciB2aWV3JykpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKElzRGV0YWNoZWRCdWZmZXIodmlldy5idWZmZXIpID09PSB0cnVlKSA7CiAgICAgICAgICBpZiAodmlldy5ieXRlTGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVqZWN0ZWRXaXRoKG5ldyBUeXBlRXJyb3IoJ3ZpZXcgbXVzdCBoYXZlIG5vbi16ZXJvIGJ5dGVMZW5ndGgnKSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gUmVhZGFibGVTdHJlYW1CWU9CUmVhZGVyUmVhZCh0aGlzLCB2aWV3KTsKICAgICAgICB9OwogICAgICAgIFJlYWRhYmxlU3RyZWFtQllPQlJlYWRlci5wcm90b3R5cGUucmVsZWFzZUxvY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAoIUlzUmVhZGFibGVTdHJlYW1CWU9CUmVhZGVyKHRoaXMpKSB7CiAgICAgICAgICAgIHRocm93IGJ5b2JSZWFkZXJCcmFuZENoZWNrRXhjZXB0aW9uKCdyZWxlYXNlTG9jaycpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHRoaXMuX293bmVyUmVhZGFibGVTdHJlYW0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodGhpcy5fcmVhZEludG9SZXF1ZXN0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1RyaWVkIHRvIHJlbGVhc2UgYSByZWFkZXIgbG9jayB3aGVuIHRoYXQgcmVhZGVyIGhhcyBwZW5kaW5nIHJlYWQoKSBjYWxscyB1bi1zZXR0bGVkJyk7CiAgICAgICAgICB9CiAgICAgICAgICBSZWFkYWJsZVN0cmVhbVJlYWRlckdlbmVyaWNSZWxlYXNlKHRoaXMpOwogICAgICAgIH07CiAgICAgICAgcmV0dXJuIFJlYWRhYmxlU3RyZWFtQllPQlJlYWRlcjsKICAgICAgfSgpOwogICAgICBmdW5jdGlvbiBJc1JlYWRhYmxlU3RyZWFtQllPQlJlYWRlcih4KSB7CiAgICAgICAgaWYgKCF0eXBlSXNPYmplY3QoeCkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoeCwgJ19yZWFkSW50b1JlcXVlc3RzJykpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmVhZGFibGVTdHJlYW1CWU9CUmVhZGVyUmVhZChyZWFkZXIsIHZpZXcpIHsKICAgICAgICB2YXIgc3RyZWFtID0gcmVhZGVyLl9vd25lclJlYWRhYmxlU3RyZWFtOwogICAgICAgIHN0cmVhbS5fZGlzdHVyYmVkID0gdHJ1ZTsKICAgICAgICBpZiAoc3RyZWFtLl9zdGF0ZSA9PT0gJ2Vycm9yZWQnKSB7CiAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChzdHJlYW0uX3N0b3JlZEVycm9yKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJQdWxsSW50byhzdHJlYW0uX3JlYWRhYmxlU3RyZWFtQ29udHJvbGxlciwgdmlldyk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gYnlvYlJlYWRlckJyYW5kQ2hlY2tFeGNlcHRpb24obmFtZSkgewogICAgICAgIHJldHVybiBuZXcgVHlwZUVycm9yKCJSZWFkYWJsZVN0cmVhbUJZT0JSZWFkZXIucHJvdG90eXBlLiIgKyBuYW1lICsgIiBjYW4gb25seSBiZSB1c2VkIG9uIGEgUmVhZGFibGVTdHJlYW1CWU9CUmVhZGVyIik7CiAgICAgIH0KICAgICAgdmFyIFJlYWRhYmxlU3RyZWFtID0gZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlU3RyZWFtKHVuZGVybHlpbmdTb3VyY2UsIHN0cmF0ZWd5KSB7CiAgICAgICAgICBpZiAodW5kZXJseWluZ1NvdXJjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgIHVuZGVybHlpbmdTb3VyY2UgPSB7fTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChzdHJhdGVneSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgIHN0cmF0ZWd5ID0ge307CiAgICAgICAgICB9CiAgICAgICAgICBJbml0aWFsaXplUmVhZGFibGVTdHJlYW0odGhpcyk7CiAgICAgICAgICB2YXIgc2l6ZSA9IHN0cmF0ZWd5LnNpemU7CiAgICAgICAgICB2YXIgaGlnaFdhdGVyTWFyayA9IHN0cmF0ZWd5LmhpZ2hXYXRlck1hcms7CiAgICAgICAgICB2YXIgdHlwZSA9IHVuZGVybHlpbmdTb3VyY2UudHlwZTsKICAgICAgICAgIHZhciB0eXBlU3RyaW5nID0gU3RyaW5nKHR5cGUpOwogICAgICAgICAgaWYgKHR5cGVTdHJpbmcgPT09ICdieXRlcycpIHsKICAgICAgICAgICAgaWYgKHNpemUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdUaGUgc3RyYXRlZ3kgZm9yIGEgYnl0ZSBzdHJlYW0gY2Fubm90IGhhdmUgYSBzaXplIGZ1bmN0aW9uJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGhpZ2hXYXRlck1hcmsgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIGhpZ2hXYXRlck1hcmsgPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGhpZ2hXYXRlck1hcmsgPSBWYWxpZGF0ZUFuZE5vcm1hbGl6ZUhpZ2hXYXRlck1hcmsoaGlnaFdhdGVyTWFyayk7CiAgICAgICAgICAgIFNldFVwUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlckZyb21VbmRlcmx5aW5nU291cmNlKHRoaXMsIHVuZGVybHlpbmdTb3VyY2UsIGhpZ2hXYXRlck1hcmspOwogICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgdmFyIHNpemVBbGdvcml0aG0gPSBNYWtlU2l6ZUFsZ29yaXRobUZyb21TaXplRnVuY3Rpb24oc2l6ZSk7CiAgICAgICAgICAgIGlmIChoaWdoV2F0ZXJNYXJrID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICBoaWdoV2F0ZXJNYXJrID0gMTsKICAgICAgICAgICAgfQogICAgICAgICAgICBoaWdoV2F0ZXJNYXJrID0gVmFsaWRhdGVBbmROb3JtYWxpemVIaWdoV2F0ZXJNYXJrKGhpZ2hXYXRlck1hcmspOwogICAgICAgICAgICBTZXRVcFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJGcm9tVW5kZXJseWluZ1NvdXJjZSh0aGlzLCB1bmRlcmx5aW5nU291cmNlLCBoaWdoV2F0ZXJNYXJrLCBzaXplQWxnb3JpdGhtKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdJbnZhbGlkIHR5cGUgaXMgc3BlY2lmaWVkJyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZWFkYWJsZVN0cmVhbS5wcm90b3R5cGUsICJsb2NrZWQiLCB7CiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgaWYgKElzUmVhZGFibGVTdHJlYW0odGhpcykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgdGhyb3cgc3RyZWFtQnJhbmRDaGVja0V4Y2VwdGlvbiQxKCdsb2NrZWQnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gSXNSZWFkYWJsZVN0cmVhbUxvY2tlZCh0aGlzKTsKICAgICAgICAgIH0sCiAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgICAgfSk7CiAgICAgICAgUmVhZGFibGVTdHJlYW0ucHJvdG90eXBlLmNhbmNlbCA9IGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgIGlmIChJc1JlYWRhYmxlU3RyZWFtKHRoaXMpID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChzdHJlYW1CcmFuZENoZWNrRXhjZXB0aW9uJDEoJ2NhbmNlbCcpKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChJc1JlYWRhYmxlU3RyZWFtTG9ja2VkKHRoaXMpID09PSB0cnVlKSB7CiAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVqZWN0ZWRXaXRoKG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjYW5jZWwgYSBzdHJlYW0gdGhhdCBhbHJlYWR5IGhhcyBhIHJlYWRlcicpKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBSZWFkYWJsZVN0cmVhbUNhbmNlbCh0aGlzLCByZWFzb24pOwogICAgICAgIH07CiAgICAgICAgUmVhZGFibGVTdHJlYW0ucHJvdG90eXBlLmdldFJlYWRlciA9IGZ1bmN0aW9uIChfYSkgewogICAgICAgICAgdmFyIG1vZGUgPSAoX2EgPT09IHZvaWQgMCA/IHt9IDogX2EpLm1vZGU7CiAgICAgICAgICBpZiAoSXNSZWFkYWJsZVN0cmVhbSh0aGlzKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgdGhyb3cgc3RyZWFtQnJhbmRDaGVja0V4Y2VwdGlvbiQxKCdnZXRSZWFkZXInKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChtb2RlID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgcmV0dXJuIEFjcXVpcmVSZWFkYWJsZVN0cmVhbURlZmF1bHRSZWFkZXIodGhpcywgdHJ1ZSk7CiAgICAgICAgICB9CiAgICAgICAgICBtb2RlID0gU3RyaW5nKG1vZGUpOwogICAgICAgICAgaWYgKG1vZGUgPT09ICdieW9iJykgewogICAgICAgICAgICByZXR1cm4gQWNxdWlyZVJlYWRhYmxlU3RyZWFtQllPQlJlYWRlcih0aGlzLCB0cnVlKTsKICAgICAgICAgIH0KICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdJbnZhbGlkIG1vZGUgaXMgc3BlY2lmaWVkJyk7CiAgICAgICAgfTsKICAgICAgICBSZWFkYWJsZVN0cmVhbS5wcm90b3R5cGUucGlwZVRocm91Z2ggPSBmdW5jdGlvbiAoX2EsIF9iKSB7CiAgICAgICAgICB2YXIgd3JpdGFibGUgPSBfYS53cml0YWJsZSxyZWFkYWJsZSA9IF9hLnJlYWRhYmxlOwogICAgICAgICAgdmFyIF9jID0gX2IgPT09IHZvaWQgMCA/IHt9IDogX2IscHJldmVudENsb3NlID0gX2MucHJldmVudENsb3NlLHByZXZlbnRBYm9ydCA9IF9jLnByZXZlbnRBYm9ydCxwcmV2ZW50Q2FuY2VsID0gX2MucHJldmVudENhbmNlbCxzaWduYWwgPSBfYy5zaWduYWw7CiAgICAgICAgICBpZiAoSXNSZWFkYWJsZVN0cmVhbSh0aGlzKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgdGhyb3cgc3RyZWFtQnJhbmRDaGVja0V4Y2VwdGlvbiQxKCdwaXBlVGhyb3VnaCcpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKElzV3JpdGFibGVTdHJlYW0od3JpdGFibGUpID09PSBmYWxzZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCd3cml0YWJsZSBhcmd1bWVudCB0byBwaXBlVGhyb3VnaCBtdXN0IGJlIGEgV3JpdGFibGVTdHJlYW0nKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChJc1JlYWRhYmxlU3RyZWFtKHJlYWRhYmxlKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigncmVhZGFibGUgYXJndW1lbnQgdG8gcGlwZVRocm91Z2ggbXVzdCBiZSBhIFJlYWRhYmxlU3RyZWFtJyk7CiAgICAgICAgICB9CiAgICAgICAgICBwcmV2ZW50Q2xvc2UgPSBCb29sZWFuKHByZXZlbnRDbG9zZSk7CiAgICAgICAgICBwcmV2ZW50QWJvcnQgPSBCb29sZWFuKHByZXZlbnRBYm9ydCk7CiAgICAgICAgICBwcmV2ZW50Q2FuY2VsID0gQm9vbGVhbihwcmV2ZW50Q2FuY2VsKTsKICAgICAgICAgIGlmIChzaWduYWwgIT09IHVuZGVmaW5lZCAmJiAhaXNBYm9ydFNpZ25hbChzaWduYWwpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1JlYWRhYmxlU3RyZWFtLnByb3RvdHlwZS5waXBlVGhyb3VnaFwncyBzaWduYWwgb3B0aW9uIG11c3QgYmUgYW4gQWJvcnRTaWduYWwnKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChJc1JlYWRhYmxlU3RyZWFtTG9ja2VkKHRoaXMpID09PSB0cnVlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1JlYWRhYmxlU3RyZWFtLnByb3RvdHlwZS5waXBlVGhyb3VnaCBjYW5ub3QgYmUgdXNlZCBvbiBhIGxvY2tlZCBSZWFkYWJsZVN0cmVhbScpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKElzV3JpdGFibGVTdHJlYW1Mb2NrZWQod3JpdGFibGUpID09PSB0cnVlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1JlYWRhYmxlU3RyZWFtLnByb3RvdHlwZS5waXBlVGhyb3VnaCBjYW5ub3QgYmUgdXNlZCBvbiBhIGxvY2tlZCBXcml0YWJsZVN0cmVhbScpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHByb21pc2UgPSBSZWFkYWJsZVN0cmVhbVBpcGVUbyh0aGlzLCB3cml0YWJsZSwgcHJldmVudENsb3NlLCBwcmV2ZW50QWJvcnQsIHByZXZlbnRDYW5jZWwsIHNpZ25hbCk7CiAgICAgICAgICBzZXRQcm9taXNlSXNIYW5kbGVkVG9UcnVlKHByb21pc2UpOwogICAgICAgICAgcmV0dXJuIHJlYWRhYmxlOwogICAgICAgIH07CiAgICAgICAgUmVhZGFibGVTdHJlYW0ucHJvdG90eXBlLnBpcGVUbyA9IGZ1bmN0aW9uIChkZXN0LCBfYSkgewogICAgICAgICAgdmFyIF9iID0gX2EgPT09IHZvaWQgMCA/IHt9IDogX2EscHJldmVudENsb3NlID0gX2IucHJldmVudENsb3NlLHByZXZlbnRBYm9ydCA9IF9iLnByZXZlbnRBYm9ydCxwcmV2ZW50Q2FuY2VsID0gX2IucHJldmVudENhbmNlbCxzaWduYWwgPSBfYi5zaWduYWw7CiAgICAgICAgICBpZiAoSXNSZWFkYWJsZVN0cmVhbSh0aGlzKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZWplY3RlZFdpdGgoc3RyZWFtQnJhbmRDaGVja0V4Y2VwdGlvbiQxKCdwaXBlVG8nKSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoSXNXcml0YWJsZVN0cmVhbShkZXN0KSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZWplY3RlZFdpdGgobmV3IFR5cGVFcnJvcignUmVhZGFibGVTdHJlYW0ucHJvdG90eXBlLnBpcGVUb1wncyBmaXJzdCBhcmd1bWVudCBtdXN0IGJlIGEgV3JpdGFibGVTdHJlYW0nKSk7CiAgICAgICAgICB9CiAgICAgICAgICBwcmV2ZW50Q2xvc2UgPSBCb29sZWFuKHByZXZlbnRDbG9zZSk7CiAgICAgICAgICBwcmV2ZW50QWJvcnQgPSBCb29sZWFuKHByZXZlbnRBYm9ydCk7CiAgICAgICAgICBwcmV2ZW50Q2FuY2VsID0gQm9vbGVhbihwcmV2ZW50Q2FuY2VsKTsKICAgICAgICAgIGlmIChzaWduYWwgIT09IHVuZGVmaW5lZCAmJiAhaXNBYm9ydFNpZ25hbChzaWduYWwpKSB7CiAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVqZWN0ZWRXaXRoKG5ldyBUeXBlRXJyb3IoJ1JlYWRhYmxlU3RyZWFtLnByb3RvdHlwZS5waXBlVG9cJ3Mgc2lnbmFsIG9wdGlvbiBtdXN0IGJlIGFuIEFib3J0U2lnbmFsJykpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKElzUmVhZGFibGVTdHJlYW1Mb2NrZWQodGhpcykgPT09IHRydWUpIHsKICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZWplY3RlZFdpdGgobmV3IFR5cGVFcnJvcignUmVhZGFibGVTdHJlYW0ucHJvdG90eXBlLnBpcGVUbyBjYW5ub3QgYmUgdXNlZCBvbiBhIGxvY2tlZCBSZWFkYWJsZVN0cmVhbScpKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChJc1dyaXRhYmxlU3RyZWFtTG9ja2VkKGRlc3QpID09PSB0cnVlKSB7CiAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVqZWN0ZWRXaXRoKG5ldyBUeXBlRXJyb3IoJ1JlYWRhYmxlU3RyZWFtLnByb3RvdHlwZS5waXBlVG8gY2Fubm90IGJlIHVzZWQgb24gYSBsb2NrZWQgV3JpdGFibGVTdHJlYW0nKSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gUmVhZGFibGVTdHJlYW1QaXBlVG8odGhpcywgZGVzdCwgcHJldmVudENsb3NlLCBwcmV2ZW50QWJvcnQsIHByZXZlbnRDYW5jZWwsIHNpZ25hbCk7CiAgICAgICAgfTsKICAgICAgICBSZWFkYWJsZVN0cmVhbS5wcm90b3R5cGUudGVlID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKElzUmVhZGFibGVTdHJlYW0odGhpcykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRocm93IHN0cmVhbUJyYW5kQ2hlY2tFeGNlcHRpb24kMSgndGVlJyk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgYnJhbmNoZXMgPSBSZWFkYWJsZVN0cmVhbVRlZSh0aGlzKTsKICAgICAgICAgIHJldHVybiBjcmVhdGVBcnJheUZyb21MaXN0KGJyYW5jaGVzKTsKICAgICAgICB9OwogICAgICAgIFJlYWRhYmxlU3RyZWFtLnByb3RvdHlwZS5nZXRJdGVyYXRvciA9IGZ1bmN0aW9uIChfYSkgewogICAgICAgICAgdmFyIF9iID0gKF9hID09PSB2b2lkIDAgPyB7fSA6IF9hKS5wcmV2ZW50Q2FuY2VsLHByZXZlbnRDYW5jZWwgPSBfYiA9PT0gdm9pZCAwID8gZmFsc2UgOiBfYjsKICAgICAgICAgIGlmIChJc1JlYWRhYmxlU3RyZWFtKHRoaXMpID09PSBmYWxzZSkgewogICAgICAgICAgICB0aHJvdyBzdHJlYW1CcmFuZENoZWNrRXhjZXB0aW9uJDEoJ2dldEl0ZXJhdG9yJyk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gQWNxdWlyZVJlYWRhYmxlU3RyZWFtQXN5bmNJdGVyYXRvcih0aGlzLCBwcmV2ZW50Q2FuY2VsKTsKICAgICAgICB9OwogICAgICAgIHJldHVybiBSZWFkYWJsZVN0cmVhbTsKICAgICAgfSgpOwogICAgICBpZiAodHlwZW9mIFN5bWJvbFBvbHlmaWxsLmFzeW5jSXRlcmF0b3IgPT09ICdzeW1ib2wnKSB7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFJlYWRhYmxlU3RyZWFtLnByb3RvdHlwZSwgU3ltYm9sUG9seWZpbGwuYXN5bmNJdGVyYXRvciwgewogICAgICAgICAgdmFsdWU6IFJlYWRhYmxlU3RyZWFtLnByb3RvdHlwZS5nZXRJdGVyYXRvciwKICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlLAogICAgICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICB9KTsKICAgICAgfQogICAgICBmdW5jdGlvbiBDcmVhdGVSZWFkYWJsZVN0cmVhbShzdGFydEFsZ29yaXRobSwgcHVsbEFsZ29yaXRobSwgY2FuY2VsQWxnb3JpdGhtLCBoaWdoV2F0ZXJNYXJrLCBzaXplQWxnb3JpdGhtKSB7CiAgICAgICAgaWYgKGhpZ2hXYXRlck1hcmsgPT09IHZvaWQgMCkgewogICAgICAgICAgaGlnaFdhdGVyTWFyayA9IDE7CiAgICAgICAgfQogICAgICAgIGlmIChzaXplQWxnb3JpdGhtID09PSB2b2lkIDApIHsKICAgICAgICAgIHNpemVBbGdvcml0aG0gPSBmdW5jdGlvbiBzaXplQWxnb3JpdGhtKCkgewogICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIHZhciBzdHJlYW0gPSBPYmplY3QuY3JlYXRlKFJlYWRhYmxlU3RyZWFtLnByb3RvdHlwZSk7CiAgICAgICAgSW5pdGlhbGl6ZVJlYWRhYmxlU3RyZWFtKHN0cmVhbSk7CiAgICAgICAgdmFyIGNvbnRyb2xsZXIgPSBPYmplY3QuY3JlYXRlKFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXIucHJvdG90eXBlKTsKICAgICAgICBTZXRVcFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXIoc3RyZWFtLCBjb250cm9sbGVyLCBzdGFydEFsZ29yaXRobSwgcHVsbEFsZ29yaXRobSwgY2FuY2VsQWxnb3JpdGhtLCBoaWdoV2F0ZXJNYXJrLCBzaXplQWxnb3JpdGhtKTsKICAgICAgICByZXR1cm4gc3RyZWFtOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEluaXRpYWxpemVSZWFkYWJsZVN0cmVhbShzdHJlYW0pIHsKICAgICAgICBzdHJlYW0uX3N0YXRlID0gJ3JlYWRhYmxlJzsKICAgICAgICBzdHJlYW0uX3JlYWRlciA9IHVuZGVmaW5lZDsKICAgICAgICBzdHJlYW0uX3N0b3JlZEVycm9yID0gdW5kZWZpbmVkOwogICAgICAgIHN0cmVhbS5fZGlzdHVyYmVkID0gZmFsc2U7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gSXNSZWFkYWJsZVN0cmVhbSh4KSB7CiAgICAgICAgaWYgKCF0eXBlSXNPYmplY3QoeCkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoeCwgJ19yZWFkYWJsZVN0cmVhbUNvbnRyb2xsZXInKSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBmdW5jdGlvbiBJc1JlYWRhYmxlU3RyZWFtTG9ja2VkKHN0cmVhbSkgewogICAgICAgIGlmIChzdHJlYW0uX3JlYWRlciA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlU3RyZWFtQ2FuY2VsKHN0cmVhbSwgcmVhc29uKSB7CiAgICAgICAgc3RyZWFtLl9kaXN0dXJiZWQgPSB0cnVlOwogICAgICAgIGlmIChzdHJlYW0uX3N0YXRlID09PSAnY2xvc2VkJykgewogICAgICAgICAgcmV0dXJuIHByb21pc2VSZXNvbHZlZFdpdGgodW5kZWZpbmVkKTsKICAgICAgICB9CiAgICAgICAgaWYgKHN0cmVhbS5fc3RhdGUgPT09ICdlcnJvcmVkJykgewogICAgICAgICAgcmV0dXJuIHByb21pc2VSZWplY3RlZFdpdGgoc3RyZWFtLl9zdG9yZWRFcnJvcik7CiAgICAgICAgfQogICAgICAgIFJlYWRhYmxlU3RyZWFtQ2xvc2Uoc3RyZWFtKTsKICAgICAgICB2YXIgc291cmNlQ2FuY2VsUHJvbWlzZSA9IHN0cmVhbS5fcmVhZGFibGVTdHJlYW1Db250cm9sbGVyW0NhbmNlbFN0ZXBzXShyZWFzb24pOwogICAgICAgIHJldHVybiB0cmFuc2Zvcm1Qcm9taXNlV2l0aChzb3VyY2VDYW5jZWxQcm9taXNlLCBub29wKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBSZWFkYWJsZVN0cmVhbUNsb3NlKHN0cmVhbSkgewogICAgICAgIHN0cmVhbS5fc3RhdGUgPSAnY2xvc2VkJzsKICAgICAgICB2YXIgcmVhZGVyID0gc3RyZWFtLl9yZWFkZXI7CiAgICAgICAgaWYgKHJlYWRlciA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmIChJc1JlYWRhYmxlU3RyZWFtRGVmYXVsdFJlYWRlcihyZWFkZXIpKSB7CiAgICAgICAgICByZWFkZXIuX3JlYWRSZXF1ZXN0cy5mb3JFYWNoKGZ1bmN0aW9uIChyZWFkUmVxdWVzdCkgewogICAgICAgICAgICByZWFkUmVxdWVzdC5fcmVzb2x2ZShSZWFkYWJsZVN0cmVhbUNyZWF0ZVJlYWRSZXN1bHQodW5kZWZpbmVkLCB0cnVlLCByZWFkZXIuX2ZvckF1dGhvckNvZGUpKTsKICAgICAgICAgIH0pOwogICAgICAgICAgcmVhZGVyLl9yZWFkUmVxdWVzdHMgPSBuZXcgU2ltcGxlUXVldWUoKTsKICAgICAgICB9CiAgICAgICAgZGVmYXVsdFJlYWRlckNsb3NlZFByb21pc2VSZXNvbHZlKHJlYWRlcik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmVhZGFibGVTdHJlYW1FcnJvcihzdHJlYW0sIGUpIHsKICAgICAgICBzdHJlYW0uX3N0YXRlID0gJ2Vycm9yZWQnOwogICAgICAgIHN0cmVhbS5fc3RvcmVkRXJyb3IgPSBlOwogICAgICAgIHZhciByZWFkZXIgPSBzdHJlYW0uX3JlYWRlcjsKICAgICAgICBpZiAocmVhZGVyID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKElzUmVhZGFibGVTdHJlYW1EZWZhdWx0UmVhZGVyKHJlYWRlcikpIHsKICAgICAgICAgIHJlYWRlci5fcmVhZFJlcXVlc3RzLmZvckVhY2goZnVuY3Rpb24gKHJlYWRSZXF1ZXN0KSB7CiAgICAgICAgICAgIHJlYWRSZXF1ZXN0Ll9yZWplY3QoZSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHJlYWRlci5fcmVhZFJlcXVlc3RzID0gbmV3IFNpbXBsZVF1ZXVlKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJlYWRlci5fcmVhZEludG9SZXF1ZXN0cy5mb3JFYWNoKGZ1bmN0aW9uIChyZWFkSW50b1JlcXVlc3QpIHsKICAgICAgICAgICAgcmVhZEludG9SZXF1ZXN0Ll9yZWplY3QoZSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHJlYWRlci5fcmVhZEludG9SZXF1ZXN0cyA9IG5ldyBTaW1wbGVRdWV1ZSgpOwogICAgICAgIH0KICAgICAgICBkZWZhdWx0UmVhZGVyQ2xvc2VkUHJvbWlzZVJlamVjdChyZWFkZXIsIGUpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHN0cmVhbUJyYW5kQ2hlY2tFeGNlcHRpb24kMShuYW1lKSB7CiAgICAgICAgcmV0dXJuIG5ldyBUeXBlRXJyb3IoIlJlYWRhYmxlU3RyZWFtLnByb3RvdHlwZS4iICsgbmFtZSArICIgY2FuIG9ubHkgYmUgdXNlZCBvbiBhIFJlYWRhYmxlU3RyZWFtIik7CiAgICAgIH0KICAgICAgdmFyIEJ5dGVMZW5ndGhRdWV1aW5nU3RyYXRlZ3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gQnl0ZUxlbmd0aFF1ZXVpbmdTdHJhdGVneShfYSkgewogICAgICAgICAgdmFyIGhpZ2hXYXRlck1hcmsgPSBfYS5oaWdoV2F0ZXJNYXJrOwogICAgICAgICAgdGhpcy5oaWdoV2F0ZXJNYXJrID0gaGlnaFdhdGVyTWFyazsKICAgICAgICB9CiAgICAgICAgQnl0ZUxlbmd0aFF1ZXVpbmdTdHJhdGVneS5wcm90b3R5cGUuc2l6ZSA9IGZ1bmN0aW9uIChjaHVuaykgewogICAgICAgICAgcmV0dXJuIGNodW5rLmJ5dGVMZW5ndGg7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gQnl0ZUxlbmd0aFF1ZXVpbmdTdHJhdGVneTsKICAgICAgfSgpOwogICAgICB2YXIgQ291bnRRdWV1aW5nU3RyYXRlZ3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gQ291bnRRdWV1aW5nU3RyYXRlZ3koX2EpIHsKICAgICAgICAgIHZhciBoaWdoV2F0ZXJNYXJrID0gX2EuaGlnaFdhdGVyTWFyazsKICAgICAgICAgIHRoaXMuaGlnaFdhdGVyTWFyayA9IGhpZ2hXYXRlck1hcms7CiAgICAgICAgfQogICAgICAgIENvdW50UXVldWluZ1N0cmF0ZWd5LnByb3RvdHlwZS5zaXplID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gQ291bnRRdWV1aW5nU3RyYXRlZ3k7CiAgICAgIH0oKTsKICAgICAgdmFyIFRyYW5zZm9ybVN0cmVhbSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBUcmFuc2Zvcm1TdHJlYW0odHJhbnNmb3JtZXIsIHdyaXRhYmxlU3RyYXRlZ3ksIHJlYWRhYmxlU3RyYXRlZ3kpIHsKICAgICAgICAgIGlmICh0cmFuc2Zvcm1lciA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgIHRyYW5zZm9ybWVyID0ge307CiAgICAgICAgICB9CiAgICAgICAgICBpZiAod3JpdGFibGVTdHJhdGVneSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgIHdyaXRhYmxlU3RyYXRlZ3kgPSB7fTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChyZWFkYWJsZVN0cmF0ZWd5ID09PSB2b2lkIDApIHsKICAgICAgICAgICAgcmVhZGFibGVTdHJhdGVneSA9IHt9OwogICAgICAgICAgfQogICAgICAgICAgdmFyIHdyaXRhYmxlU2l6ZUZ1bmN0aW9uID0gd3JpdGFibGVTdHJhdGVneS5zaXplOwogICAgICAgICAgdmFyIHdyaXRhYmxlSGlnaFdhdGVyTWFyayA9IHdyaXRhYmxlU3RyYXRlZ3kuaGlnaFdhdGVyTWFyazsKICAgICAgICAgIHZhciByZWFkYWJsZVNpemVGdW5jdGlvbiA9IHJlYWRhYmxlU3RyYXRlZ3kuc2l6ZTsKICAgICAgICAgIHZhciByZWFkYWJsZUhpZ2hXYXRlck1hcmsgPSByZWFkYWJsZVN0cmF0ZWd5LmhpZ2hXYXRlck1hcms7CiAgICAgICAgICB2YXIgd3JpdGFibGVUeXBlID0gdHJhbnNmb3JtZXIud3JpdGFibGVUeXBlOwogICAgICAgICAgaWYgKHdyaXRhYmxlVHlwZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdJbnZhbGlkIHdyaXRhYmxlIHR5cGUgc3BlY2lmaWVkJyk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgd3JpdGFibGVTaXplQWxnb3JpdGhtID0gTWFrZVNpemVBbGdvcml0aG1Gcm9tU2l6ZUZ1bmN0aW9uKHdyaXRhYmxlU2l6ZUZ1bmN0aW9uKTsKICAgICAgICAgIGlmICh3cml0YWJsZUhpZ2hXYXRlck1hcmsgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICB3cml0YWJsZUhpZ2hXYXRlck1hcmsgPSAxOwogICAgICAgICAgfQogICAgICAgICAgd3JpdGFibGVIaWdoV2F0ZXJNYXJrID0gVmFsaWRhdGVBbmROb3JtYWxpemVIaWdoV2F0ZXJNYXJrKHdyaXRhYmxlSGlnaFdhdGVyTWFyayk7CiAgICAgICAgICB2YXIgcmVhZGFibGVUeXBlID0gdHJhbnNmb3JtZXIucmVhZGFibGVUeXBlOwogICAgICAgICAgaWYgKHJlYWRhYmxlVHlwZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdJbnZhbGlkIHJlYWRhYmxlIHR5cGUgc3BlY2lmaWVkJyk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgcmVhZGFibGVTaXplQWxnb3JpdGhtID0gTWFrZVNpemVBbGdvcml0aG1Gcm9tU2l6ZUZ1bmN0aW9uKHJlYWRhYmxlU2l6ZUZ1bmN0aW9uKTsKICAgICAgICAgIGlmIChyZWFkYWJsZUhpZ2hXYXRlck1hcmsgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICByZWFkYWJsZUhpZ2hXYXRlck1hcmsgPSAwOwogICAgICAgICAgfQogICAgICAgICAgcmVhZGFibGVIaWdoV2F0ZXJNYXJrID0gVmFsaWRhdGVBbmROb3JtYWxpemVIaWdoV2F0ZXJNYXJrKHJlYWRhYmxlSGlnaFdhdGVyTWFyayk7CiAgICAgICAgICB2YXIgc3RhcnRQcm9taXNlX3Jlc29sdmU7CiAgICAgICAgICB2YXIgc3RhcnRQcm9taXNlID0gbmV3UHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgICAgICBzdGFydFByb21pc2VfcmVzb2x2ZSA9IHJlc29sdmU7CiAgICAgICAgICB9KTsKICAgICAgICAgIEluaXRpYWxpemVUcmFuc2Zvcm1TdHJlYW0odGhpcywgc3RhcnRQcm9taXNlLCB3cml0YWJsZUhpZ2hXYXRlck1hcmssIHdyaXRhYmxlU2l6ZUFsZ29yaXRobSwgcmVhZGFibGVIaWdoV2F0ZXJNYXJrLCByZWFkYWJsZVNpemVBbGdvcml0aG0pOwogICAgICAgICAgU2V0VXBUcmFuc2Zvcm1TdHJlYW1EZWZhdWx0Q29udHJvbGxlckZyb21UcmFuc2Zvcm1lcih0aGlzLCB0cmFuc2Zvcm1lcik7CiAgICAgICAgICB2YXIgc3RhcnRSZXN1bHQgPSBJbnZva2VPck5vb3AodHJhbnNmb3JtZXIsICdzdGFydCcsIFt0aGlzLl90cmFuc2Zvcm1TdHJlYW1Db250cm9sbGVyXSk7CiAgICAgICAgICBzdGFydFByb21pc2VfcmVzb2x2ZShzdGFydFJlc3VsdCk7CiAgICAgICAgfQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShUcmFuc2Zvcm1TdHJlYW0ucHJvdG90eXBlLCAicmVhZGFibGUiLCB7CiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgaWYgKElzVHJhbnNmb3JtU3RyZWFtKHRoaXMpID09PSBmYWxzZSkgewogICAgICAgICAgICAgIHRocm93IHN0cmVhbUJyYW5kQ2hlY2tFeGNlcHRpb24kMigncmVhZGFibGUnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVhZGFibGU7CiAgICAgICAgICB9LAogICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShUcmFuc2Zvcm1TdHJlYW0ucHJvdG90eXBlLCAid3JpdGFibGUiLCB7CiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgaWYgKElzVHJhbnNmb3JtU3RyZWFtKHRoaXMpID09PSBmYWxzZSkgewogICAgICAgICAgICAgIHRocm93IHN0cmVhbUJyYW5kQ2hlY2tFeGNlcHRpb24kMignd3JpdGFibGUnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpcy5fd3JpdGFibGU7CiAgICAgICAgICB9LAogICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBUcmFuc2Zvcm1TdHJlYW07CiAgICAgIH0oKTsKICAgICAgZnVuY3Rpb24gSW5pdGlhbGl6ZVRyYW5zZm9ybVN0cmVhbShzdHJlYW0sIHN0YXJ0UHJvbWlzZSwgd3JpdGFibGVIaWdoV2F0ZXJNYXJrLCB3cml0YWJsZVNpemVBbGdvcml0aG0sIHJlYWRhYmxlSGlnaFdhdGVyTWFyaywgcmVhZGFibGVTaXplQWxnb3JpdGhtKSB7CiAgICAgICAgZnVuY3Rpb24gc3RhcnRBbGdvcml0aG0oKSB7CiAgICAgICAgICByZXR1cm4gc3RhcnRQcm9taXNlOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB3cml0ZUFsZ29yaXRobShjaHVuaykgewogICAgICAgICAgcmV0dXJuIFRyYW5zZm9ybVN0cmVhbURlZmF1bHRTaW5rV3JpdGVBbGdvcml0aG0oc3RyZWFtLCBjaHVuayk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGFib3J0QWxnb3JpdGhtKHJlYXNvbikgewogICAgICAgICAgcmV0dXJuIFRyYW5zZm9ybVN0cmVhbURlZmF1bHRTaW5rQWJvcnRBbGdvcml0aG0oc3RyZWFtLCByZWFzb24pOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBjbG9zZUFsZ29yaXRobSgpIHsKICAgICAgICAgIHJldHVybiBUcmFuc2Zvcm1TdHJlYW1EZWZhdWx0U2lua0Nsb3NlQWxnb3JpdGhtKHN0cmVhbSk7CiAgICAgICAgfQogICAgICAgIHN0cmVhbS5fd3JpdGFibGUgPSBDcmVhdGVXcml0YWJsZVN0cmVhbShzdGFydEFsZ29yaXRobSwgd3JpdGVBbGdvcml0aG0sIGNsb3NlQWxnb3JpdGhtLCBhYm9ydEFsZ29yaXRobSwgd3JpdGFibGVIaWdoV2F0ZXJNYXJrLCB3cml0YWJsZVNpemVBbGdvcml0aG0pOwogICAgICAgIGZ1bmN0aW9uIHB1bGxBbGdvcml0aG0oKSB7CiAgICAgICAgICByZXR1cm4gVHJhbnNmb3JtU3RyZWFtRGVmYXVsdFNvdXJjZVB1bGxBbGdvcml0aG0oc3RyZWFtKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gY2FuY2VsQWxnb3JpdGhtKHJlYXNvbikgewogICAgICAgICAgVHJhbnNmb3JtU3RyZWFtRXJyb3JXcml0YWJsZUFuZFVuYmxvY2tXcml0ZShzdHJlYW0sIHJlYXNvbik7CiAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlc29sdmVkV2l0aCh1bmRlZmluZWQpOwogICAgICAgIH0KICAgICAgICBzdHJlYW0uX3JlYWRhYmxlID0gQ3JlYXRlUmVhZGFibGVTdHJlYW0oc3RhcnRBbGdvcml0aG0sIHB1bGxBbGdvcml0aG0sIGNhbmNlbEFsZ29yaXRobSwgcmVhZGFibGVIaWdoV2F0ZXJNYXJrLCByZWFkYWJsZVNpemVBbGdvcml0aG0pOwogICAgICAgIHN0cmVhbS5fYmFja3ByZXNzdXJlID0gdW5kZWZpbmVkOwogICAgICAgIHN0cmVhbS5fYmFja3ByZXNzdXJlQ2hhbmdlUHJvbWlzZSA9IHVuZGVmaW5lZDsKICAgICAgICBzdHJlYW0uX2JhY2twcmVzc3VyZUNoYW5nZVByb21pc2VfcmVzb2x2ZSA9IHVuZGVmaW5lZDsKICAgICAgICBUcmFuc2Zvcm1TdHJlYW1TZXRCYWNrcHJlc3N1cmUoc3RyZWFtLCB0cnVlKTsKICAgICAgICBzdHJlYW0uX3RyYW5zZm9ybVN0cmVhbUNvbnRyb2xsZXIgPSB1bmRlZmluZWQ7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gSXNUcmFuc2Zvcm1TdHJlYW0oeCkgewogICAgICAgIGlmICghdHlwZUlzT2JqZWN0KHgpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmICghT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHgsICdfdHJhbnNmb3JtU3RyZWFtQ29udHJvbGxlcicpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFRyYW5zZm9ybVN0cmVhbUVycm9yKHN0cmVhbSwgZSkgewogICAgICAgIFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJFcnJvcihzdHJlYW0uX3JlYWRhYmxlLl9yZWFkYWJsZVN0cmVhbUNvbnRyb2xsZXIsIGUpOwogICAgICAgIFRyYW5zZm9ybVN0cmVhbUVycm9yV3JpdGFibGVBbmRVbmJsb2NrV3JpdGUoc3RyZWFtLCBlKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBUcmFuc2Zvcm1TdHJlYW1FcnJvcldyaXRhYmxlQW5kVW5ibG9ja1dyaXRlKHN0cmVhbSwgZSkgewogICAgICAgIFRyYW5zZm9ybVN0cmVhbURlZmF1bHRDb250cm9sbGVyQ2xlYXJBbGdvcml0aG1zKHN0cmVhbS5fdHJhbnNmb3JtU3RyZWFtQ29udHJvbGxlcik7CiAgICAgICAgV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckVycm9ySWZOZWVkZWQoc3RyZWFtLl93cml0YWJsZS5fd3JpdGFibGVTdHJlYW1Db250cm9sbGVyLCBlKTsKICAgICAgICBpZiAoc3RyZWFtLl9iYWNrcHJlc3N1cmUgPT09IHRydWUpIHsKICAgICAgICAgIFRyYW5zZm9ybVN0cmVhbVNldEJhY2twcmVzc3VyZShzdHJlYW0sIGZhbHNlKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gVHJhbnNmb3JtU3RyZWFtU2V0QmFja3ByZXNzdXJlKHN0cmVhbSwgYmFja3ByZXNzdXJlKSB7CiAgICAgICAgaWYgKHN0cmVhbS5fYmFja3ByZXNzdXJlQ2hhbmdlUHJvbWlzZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBzdHJlYW0uX2JhY2twcmVzc3VyZUNoYW5nZVByb21pc2VfcmVzb2x2ZSgpOwogICAgICAgIH0KICAgICAgICBzdHJlYW0uX2JhY2twcmVzc3VyZUNoYW5nZVByb21pc2UgPSBuZXdQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgICBzdHJlYW0uX2JhY2twcmVzc3VyZUNoYW5nZVByb21pc2VfcmVzb2x2ZSA9IHJlc29sdmU7CiAgICAgICAgfSk7CiAgICAgICAgc3RyZWFtLl9iYWNrcHJlc3N1cmUgPSBiYWNrcHJlc3N1cmU7CiAgICAgIH0KICAgICAgdmFyIFRyYW5zZm9ybVN0cmVhbURlZmF1bHRDb250cm9sbGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIFRyYW5zZm9ybVN0cmVhbURlZmF1bHRDb250cm9sbGVyKCkgewogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVHJhbnNmb3JtU3RyZWFtRGVmYXVsdENvbnRyb2xsZXIgaW5zdGFuY2VzIGNhbm5vdCBiZSBjcmVhdGVkIGRpcmVjdGx5Jyk7CiAgICAgICAgfQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShUcmFuc2Zvcm1TdHJlYW1EZWZhdWx0Q29udHJvbGxlci5wcm90b3R5cGUsICJkZXNpcmVkU2l6ZSIsIHsKICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICBpZiAoSXNUcmFuc2Zvcm1TdHJlYW1EZWZhdWx0Q29udHJvbGxlcih0aGlzKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICB0aHJvdyBkZWZhdWx0Q29udHJvbGxlckJyYW5kQ2hlY2tFeGNlcHRpb24kMSgnZGVzaXJlZFNpemUnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgcmVhZGFibGVDb250cm9sbGVyID0gdGhpcy5fY29udHJvbGxlZFRyYW5zZm9ybVN0cmVhbS5fcmVhZGFibGUuX3JlYWRhYmxlU3RyZWFtQ29udHJvbGxlcjsKICAgICAgICAgICAgcmV0dXJuIFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJHZXREZXNpcmVkU2l6ZShyZWFkYWJsZUNvbnRyb2xsZXIpOwogICAgICAgICAgfSwKICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICB9KTsKICAgICAgICBUcmFuc2Zvcm1TdHJlYW1EZWZhdWx0Q29udHJvbGxlci5wcm90b3R5cGUuZW5xdWV1ZSA9IGZ1bmN0aW9uIChjaHVuaykgewogICAgICAgICAgaWYgKElzVHJhbnNmb3JtU3RyZWFtRGVmYXVsdENvbnRyb2xsZXIodGhpcykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRocm93IGRlZmF1bHRDb250cm9sbGVyQnJhbmRDaGVja0V4Y2VwdGlvbiQxKCdlbnF1ZXVlJyk7CiAgICAgICAgICB9CiAgICAgICAgICBUcmFuc2Zvcm1TdHJlYW1EZWZhdWx0Q29udHJvbGxlckVucXVldWUodGhpcywgY2h1bmspOwogICAgICAgIH07CiAgICAgICAgVHJhbnNmb3JtU3RyZWFtRGVmYXVsdENvbnRyb2xsZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgaWYgKElzVHJhbnNmb3JtU3RyZWFtRGVmYXVsdENvbnRyb2xsZXIodGhpcykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRocm93IGRlZmF1bHRDb250cm9sbGVyQnJhbmRDaGVja0V4Y2VwdGlvbiQxKCdlcnJvcicpOwogICAgICAgICAgfQogICAgICAgICAgVHJhbnNmb3JtU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJFcnJvcih0aGlzLCByZWFzb24pOwogICAgICAgIH07CiAgICAgICAgVHJhbnNmb3JtU3RyZWFtRGVmYXVsdENvbnRyb2xsZXIucHJvdG90eXBlLnRlcm1pbmF0ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmIChJc1RyYW5zZm9ybVN0cmVhbURlZmF1bHRDb250cm9sbGVyKHRoaXMpID09PSBmYWxzZSkgewogICAgICAgICAgICB0aHJvdyBkZWZhdWx0Q29udHJvbGxlckJyYW5kQ2hlY2tFeGNlcHRpb24kMSgndGVybWluYXRlJyk7CiAgICAgICAgICB9CiAgICAgICAgICBUcmFuc2Zvcm1TdHJlYW1EZWZhdWx0Q29udHJvbGxlclRlcm1pbmF0ZSh0aGlzKTsKICAgICAgICB9OwogICAgICAgIHJldHVybiBUcmFuc2Zvcm1TdHJlYW1EZWZhdWx0Q29udHJvbGxlcjsKICAgICAgfSgpOwogICAgICBmdW5jdGlvbiBJc1RyYW5zZm9ybVN0cmVhbURlZmF1bHRDb250cm9sbGVyKHgpIHsKICAgICAgICBpZiAoIXR5cGVJc09iamVjdCh4KSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh4LCAnX2NvbnRyb2xsZWRUcmFuc2Zvcm1TdHJlYW0nKSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBmdW5jdGlvbiBTZXRVcFRyYW5zZm9ybVN0cmVhbURlZmF1bHRDb250cm9sbGVyKHN0cmVhbSwgY29udHJvbGxlciwgdHJhbnNmb3JtQWxnb3JpdGhtLCBmbHVzaEFsZ29yaXRobSkgewogICAgICAgIGNvbnRyb2xsZXIuX2NvbnRyb2xsZWRUcmFuc2Zvcm1TdHJlYW0gPSBzdHJlYW07CiAgICAgICAgc3RyZWFtLl90cmFuc2Zvcm1TdHJlYW1Db250cm9sbGVyID0gY29udHJvbGxlcjsKICAgICAgICBjb250cm9sbGVyLl90cmFuc2Zvcm1BbGdvcml0aG0gPSB0cmFuc2Zvcm1BbGdvcml0aG07CiAgICAgICAgY29udHJvbGxlci5fZmx1c2hBbGdvcml0aG0gPSBmbHVzaEFsZ29yaXRobTsKICAgICAgfQogICAgICBmdW5jdGlvbiBTZXRVcFRyYW5zZm9ybVN0cmVhbURlZmF1bHRDb250cm9sbGVyRnJvbVRyYW5zZm9ybWVyKHN0cmVhbSwgdHJhbnNmb3JtZXIpIHsKICAgICAgICB2YXIgY29udHJvbGxlciA9IE9iamVjdC5jcmVhdGUoVHJhbnNmb3JtU3RyZWFtRGVmYXVsdENvbnRyb2xsZXIucHJvdG90eXBlKTsKICAgICAgICB2YXIgdHJhbnNmb3JtQWxnb3JpdGhtID0gZnVuY3Rpb24gdHJhbnNmb3JtQWxnb3JpdGhtKGNodW5rKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBUcmFuc2Zvcm1TdHJlYW1EZWZhdWx0Q29udHJvbGxlckVucXVldWUoY29udHJvbGxlciwgY2h1bmspOwogICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlc29sdmVkV2l0aCh1bmRlZmluZWQpOwogICAgICAgICAgfSBjYXRjaCAodHJhbnNmb3JtUmVzdWx0RSkgewogICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aCh0cmFuc2Zvcm1SZXN1bHRFKTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIHZhciB0cmFuc2Zvcm1NZXRob2QgPSB0cmFuc2Zvcm1lci50cmFuc2Zvcm07CiAgICAgICAgaWYgKHRyYW5zZm9ybU1ldGhvZCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBpZiAodHlwZW9mIHRyYW5zZm9ybU1ldGhvZCAhPT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCd0cmFuc2Zvcm0gaXMgbm90IGEgbWV0aG9kJyk7CiAgICAgICAgICB9CiAgICAgICAgICB0cmFuc2Zvcm1BbGdvcml0aG0gPSBmdW5jdGlvbiB0cmFuc2Zvcm1BbGdvcml0aG0oY2h1bmspIHsKICAgICAgICAgICAgcmV0dXJuIFByb21pc2VDYWxsKHRyYW5zZm9ybU1ldGhvZCwgdHJhbnNmb3JtZXIsIFsKICAgICAgICAgICAgY2h1bmssCiAgICAgICAgICAgIGNvbnRyb2xsZXJdCiAgICAgICAgICAgICk7CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICB2YXIgZmx1c2hBbGdvcml0aG0gPSBDcmVhdGVBbGdvcml0aG1Gcm9tVW5kZXJseWluZ01ldGhvZCh0cmFuc2Zvcm1lciwgJ2ZsdXNoJywgMCwgW2NvbnRyb2xsZXJdKTsKICAgICAgICBTZXRVcFRyYW5zZm9ybVN0cmVhbURlZmF1bHRDb250cm9sbGVyKHN0cmVhbSwgY29udHJvbGxlciwgdHJhbnNmb3JtQWxnb3JpdGhtLCBmbHVzaEFsZ29yaXRobSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gVHJhbnNmb3JtU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJDbGVhckFsZ29yaXRobXMoY29udHJvbGxlcikgewogICAgICAgIGNvbnRyb2xsZXIuX3RyYW5zZm9ybUFsZ29yaXRobSA9IHVuZGVmaW5lZDsKICAgICAgICBjb250cm9sbGVyLl9mbHVzaEFsZ29yaXRobSA9IHVuZGVmaW5lZDsKICAgICAgfQogICAgICBmdW5jdGlvbiBUcmFuc2Zvcm1TdHJlYW1EZWZhdWx0Q29udHJvbGxlckVucXVldWUoY29udHJvbGxlciwgY2h1bmspIHsKICAgICAgICB2YXIgc3RyZWFtID0gY29udHJvbGxlci5fY29udHJvbGxlZFRyYW5zZm9ybVN0cmVhbTsKICAgICAgICB2YXIgcmVhZGFibGVDb250cm9sbGVyID0gc3RyZWFtLl9yZWFkYWJsZS5fcmVhZGFibGVTdHJlYW1Db250cm9sbGVyOwogICAgICAgIGlmIChSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyQ2FuQ2xvc2VPckVucXVldWUocmVhZGFibGVDb250cm9sbGVyKSA9PT0gZmFsc2UpIHsKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1JlYWRhYmxlIHNpZGUgaXMgbm90IGluIGEgc3RhdGUgdGhhdCBwZXJtaXRzIGVucXVldWUnKTsKICAgICAgICB9CiAgICAgICAgdHJ5IHsKICAgICAgICAgIFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJFbnF1ZXVlKHJlYWRhYmxlQ29udHJvbGxlciwgY2h1bmspOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIFRyYW5zZm9ybVN0cmVhbUVycm9yV3JpdGFibGVBbmRVbmJsb2NrV3JpdGUoc3RyZWFtLCBlKTsKICAgICAgICAgIHRocm93IHN0cmVhbS5fcmVhZGFibGUuX3N0b3JlZEVycm9yOwogICAgICAgIH0KICAgICAgICB2YXIgYmFja3ByZXNzdXJlID0gUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckhhc0JhY2twcmVzc3VyZShyZWFkYWJsZUNvbnRyb2xsZXIpOwogICAgICAgIGlmIChiYWNrcHJlc3N1cmUgIT09IHN0cmVhbS5fYmFja3ByZXNzdXJlKSB7CiAgICAgICAgICBUcmFuc2Zvcm1TdHJlYW1TZXRCYWNrcHJlc3N1cmUoc3RyZWFtLCB0cnVlKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gVHJhbnNmb3JtU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJFcnJvcihjb250cm9sbGVyLCBlKSB7CiAgICAgICAgVHJhbnNmb3JtU3RyZWFtRXJyb3IoY29udHJvbGxlci5fY29udHJvbGxlZFRyYW5zZm9ybVN0cmVhbSwgZSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gVHJhbnNmb3JtU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJQZXJmb3JtVHJhbnNmb3JtKGNvbnRyb2xsZXIsIGNodW5rKSB7CiAgICAgICAgdmFyIHRyYW5zZm9ybVByb21pc2UgPSBjb250cm9sbGVyLl90cmFuc2Zvcm1BbGdvcml0aG0oY2h1bmspOwogICAgICAgIHJldHVybiB0cmFuc2Zvcm1Qcm9taXNlV2l0aCh0cmFuc2Zvcm1Qcm9taXNlLCB1bmRlZmluZWQsIGZ1bmN0aW9uIChyKSB7CiAgICAgICAgICBUcmFuc2Zvcm1TdHJlYW1FcnJvcihjb250cm9sbGVyLl9jb250cm9sbGVkVHJhbnNmb3JtU3RyZWFtLCByKTsKICAgICAgICAgIHRocm93IHI7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gVHJhbnNmb3JtU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJUZXJtaW5hdGUoY29udHJvbGxlcikgewogICAgICAgIHZhciBzdHJlYW0gPSBjb250cm9sbGVyLl9jb250cm9sbGVkVHJhbnNmb3JtU3RyZWFtOwogICAgICAgIHZhciByZWFkYWJsZUNvbnRyb2xsZXIgPSBzdHJlYW0uX3JlYWRhYmxlLl9yZWFkYWJsZVN0cmVhbUNvbnRyb2xsZXI7CiAgICAgICAgaWYgKFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJDYW5DbG9zZU9yRW5xdWV1ZShyZWFkYWJsZUNvbnRyb2xsZXIpID09PSB0cnVlKSB7CiAgICAgICAgICBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyQ2xvc2UocmVhZGFibGVDb250cm9sbGVyKTsKICAgICAgICB9CiAgICAgICAgdmFyIGVycm9yID0gbmV3IFR5cGVFcnJvcignVHJhbnNmb3JtU3RyZWFtIHRlcm1pbmF0ZWQnKTsKICAgICAgICBUcmFuc2Zvcm1TdHJlYW1FcnJvcldyaXRhYmxlQW5kVW5ibG9ja1dyaXRlKHN0cmVhbSwgZXJyb3IpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFRyYW5zZm9ybVN0cmVhbURlZmF1bHRTaW5rV3JpdGVBbGdvcml0aG0oc3RyZWFtLCBjaHVuaykgewogICAgICAgIHZhciBjb250cm9sbGVyID0gc3RyZWFtLl90cmFuc2Zvcm1TdHJlYW1Db250cm9sbGVyOwogICAgICAgIGlmIChzdHJlYW0uX2JhY2twcmVzc3VyZSA9PT0gdHJ1ZSkgewogICAgICAgICAgdmFyIGJhY2twcmVzc3VyZUNoYW5nZVByb21pc2UgPSBzdHJlYW0uX2JhY2twcmVzc3VyZUNoYW5nZVByb21pc2U7CiAgICAgICAgICByZXR1cm4gdHJhbnNmb3JtUHJvbWlzZVdpdGgoYmFja3ByZXNzdXJlQ2hhbmdlUHJvbWlzZSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgd3JpdGFibGUgPSBzdHJlYW0uX3dyaXRhYmxlOwogICAgICAgICAgICB2YXIgc3RhdGUgPSB3cml0YWJsZS5fc3RhdGU7CiAgICAgICAgICAgIGlmIChzdGF0ZSA9PT0gJ2Vycm9yaW5nJykgewogICAgICAgICAgICAgIHRocm93IHdyaXRhYmxlLl9zdG9yZWRFcnJvcjsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gVHJhbnNmb3JtU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJQZXJmb3JtVHJhbnNmb3JtKGNvbnRyb2xsZXIsIGNodW5rKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gVHJhbnNmb3JtU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJQZXJmb3JtVHJhbnNmb3JtKGNvbnRyb2xsZXIsIGNodW5rKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBUcmFuc2Zvcm1TdHJlYW1EZWZhdWx0U2lua0Fib3J0QWxnb3JpdGhtKHN0cmVhbSwgcmVhc29uKSB7CiAgICAgICAgVHJhbnNmb3JtU3RyZWFtRXJyb3Ioc3RyZWFtLCByZWFzb24pOwogICAgICAgIHJldHVybiBwcm9taXNlUmVzb2x2ZWRXaXRoKHVuZGVmaW5lZCk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gVHJhbnNmb3JtU3RyZWFtRGVmYXVsdFNpbmtDbG9zZUFsZ29yaXRobShzdHJlYW0pIHsKICAgICAgICB2YXIgcmVhZGFibGUgPSBzdHJlYW0uX3JlYWRhYmxlOwogICAgICAgIHZhciBjb250cm9sbGVyID0gc3RyZWFtLl90cmFuc2Zvcm1TdHJlYW1Db250cm9sbGVyOwogICAgICAgIHZhciBmbHVzaFByb21pc2UgPSBjb250cm9sbGVyLl9mbHVzaEFsZ29yaXRobSgpOwogICAgICAgIFRyYW5zZm9ybVN0cmVhbURlZmF1bHRDb250cm9sbGVyQ2xlYXJBbGdvcml0aG1zKGNvbnRyb2xsZXIpOwogICAgICAgIHJldHVybiB0cmFuc2Zvcm1Qcm9taXNlV2l0aChmbHVzaFByb21pc2UsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmIChyZWFkYWJsZS5fc3RhdGUgPT09ICdlcnJvcmVkJykgewogICAgICAgICAgICB0aHJvdyByZWFkYWJsZS5fc3RvcmVkRXJyb3I7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgcmVhZGFibGVDb250cm9sbGVyID0gcmVhZGFibGUuX3JlYWRhYmxlU3RyZWFtQ29udHJvbGxlcjsKICAgICAgICAgIGlmIChSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyQ2FuQ2xvc2VPckVucXVldWUocmVhZGFibGVDb250cm9sbGVyKSA9PT0gdHJ1ZSkgewogICAgICAgICAgICBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyQ2xvc2UocmVhZGFibGVDb250cm9sbGVyKTsKICAgICAgICAgIH0KICAgICAgICB9LCBmdW5jdGlvbiAocikgewogICAgICAgICAgVHJhbnNmb3JtU3RyZWFtRXJyb3Ioc3RyZWFtLCByKTsKICAgICAgICAgIHRocm93IHJlYWRhYmxlLl9zdG9yZWRFcnJvcjsKICAgICAgICB9KTsKICAgICAgfQogICAgICBmdW5jdGlvbiBUcmFuc2Zvcm1TdHJlYW1EZWZhdWx0U291cmNlUHVsbEFsZ29yaXRobShzdHJlYW0pIHsKICAgICAgICBUcmFuc2Zvcm1TdHJlYW1TZXRCYWNrcHJlc3N1cmUoc3RyZWFtLCBmYWxzZSk7CiAgICAgICAgcmV0dXJuIHN0cmVhbS5fYmFja3ByZXNzdXJlQ2hhbmdlUHJvbWlzZTsKICAgICAgfQogICAgICBmdW5jdGlvbiBkZWZhdWx0Q29udHJvbGxlckJyYW5kQ2hlY2tFeGNlcHRpb24kMShuYW1lKSB7CiAgICAgICAgcmV0dXJuIG5ldyBUeXBlRXJyb3IoIlRyYW5zZm9ybVN0cmVhbURlZmF1bHRDb250cm9sbGVyLnByb3RvdHlwZS4iICsgbmFtZSArICIgY2FuIG9ubHkgYmUgdXNlZCBvbiBhIFRyYW5zZm9ybVN0cmVhbURlZmF1bHRDb250cm9sbGVyIik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gc3RyZWFtQnJhbmRDaGVja0V4Y2VwdGlvbiQyKG5hbWUpIHsKICAgICAgICByZXR1cm4gbmV3IFR5cGVFcnJvcigiVHJhbnNmb3JtU3RyZWFtLnByb3RvdHlwZS4iICsgbmFtZSArICIgY2FuIG9ubHkgYmUgdXNlZCBvbiBhIFRyYW5zZm9ybVN0cmVhbSIpOwogICAgICB9CiAgICAgIGV4cG9ydHMuQnl0ZUxlbmd0aFF1ZXVpbmdTdHJhdGVneSA9IEJ5dGVMZW5ndGhRdWV1aW5nU3RyYXRlZ3k7CiAgICAgIGV4cG9ydHMuQ291bnRRdWV1aW5nU3RyYXRlZ3kgPSBDb3VudFF1ZXVpbmdTdHJhdGVneTsKICAgICAgZXhwb3J0cy5SZWFkYWJsZVN0cmVhbSA9IFJlYWRhYmxlU3RyZWFtOwogICAgICBleHBvcnRzLlRyYW5zZm9ybVN0cmVhbSA9IFRyYW5zZm9ybVN0cmVhbTsKICAgICAgZXhwb3J0cy5Xcml0YWJsZVN0cmVhbSA9IFdyaXRhYmxlU3RyZWFtOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pOwogICAgfSk7CgogICAgLyoqKi99KSwgKAogIC8qIDEzNiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIF9fd19wZGZqc19yZXF1aXJlX18oMTM3KTsKICAgIF9fd19wZGZqc19yZXF1aXJlX18oMTA1KTsKICAgIF9fd19wZGZqc19yZXF1aXJlX18oNzMpOwogICAgX193X3BkZmpzX3JlcXVpcmVfXygxMDcpOwogICAgdmFyIHBhdGggPSBfX3dfcGRmanNfcmVxdWlyZV9fKDM4KTsKICAgIG1vZHVsZS5leHBvcnRzID0gcGF0aC5NYXA7CgogICAgLyoqKi99KSwgKAogIC8qIDEzNyAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgY29sbGVjdGlvbiA9IF9fd19wZGZqc19yZXF1aXJlX18oMTM4KTsKICAgIHZhciBjb2xsZWN0aW9uU3Ryb25nID0gX193X3BkZmpzX3JlcXVpcmVfXygxNDIpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBjb2xsZWN0aW9uKCdNYXAnLCBmdW5jdGlvbiAoaW5pdCkgewogICAgICByZXR1cm4gZnVuY3Rpb24gTWFwKCkgewogICAgICAgIHJldHVybiBpbml0KHRoaXMsIGFyZ3VtZW50cy5sZW5ndGggPyBhcmd1bWVudHNbMF0gOiB1bmRlZmluZWQpOwogICAgICB9OwogICAgfSwgY29sbGVjdGlvblN0cm9uZyk7CgogICAgLyoqKi99KSwgKAogIC8qIDEzOCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgJCA9IF9fd19wZGZqc19yZXF1aXJlX18oNSk7CiAgICB2YXIgZ2xvYmFsID0gX193X3BkZmpzX3JlcXVpcmVfXyg2KTsKICAgIHZhciBpc0ZvcmNlZCA9IF9fd19wZGZqc19yZXF1aXJlX18oNDcpOwogICAgdmFyIHJlZGVmaW5lID0gX193X3BkZmpzX3JlcXVpcmVfXygyNCk7CiAgICB2YXIgSW50ZXJuYWxNZXRhZGF0YU1vZHVsZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTM5KTsKICAgIHZhciBpdGVyYXRlID0gX193X3BkZmpzX3JlcXVpcmVfXygxMTUpOwogICAgdmFyIGFuSW5zdGFuY2UgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDExNCk7CiAgICB2YXIgaXNPYmplY3QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE3KTsKICAgIHZhciBmYWlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oOSk7CiAgICB2YXIgY2hlY2tDb3JyZWN0bmVzc09mSXRlcmF0aW9uID0gX193X3BkZmpzX3JlcXVpcmVfXyg5Myk7CiAgICB2YXIgc2V0VG9TdHJpbmdUYWcgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDgxKTsKICAgIHZhciBpbmhlcml0SWZSZXF1aXJlZCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTQxKTsKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKENPTlNUUlVDVE9SX05BTUUsIHdyYXBwZXIsIGNvbW1vbikgewogICAgICB2YXIgSVNfTUFQID0gQ09OU1RSVUNUT1JfTkFNRS5pbmRleE9mKCdNYXAnKSAhPT0gLTE7CiAgICAgIHZhciBJU19XRUFLID0gQ09OU1RSVUNUT1JfTkFNRS5pbmRleE9mKCdXZWFrJykgIT09IC0xOwogICAgICB2YXIgQURERVIgPSBJU19NQVAgPyAnc2V0JyA6ICdhZGQnOwogICAgICB2YXIgTmF0aXZlQ29uc3RydWN0b3IgPSBnbG9iYWxbQ09OU1RSVUNUT1JfTkFNRV07CiAgICAgIHZhciBOYXRpdmVQcm90b3R5cGUgPSBOYXRpdmVDb25zdHJ1Y3RvciAmJiBOYXRpdmVDb25zdHJ1Y3Rvci5wcm90b3R5cGU7CiAgICAgIHZhciBDb25zdHJ1Y3RvciA9IE5hdGl2ZUNvbnN0cnVjdG9yOwogICAgICB2YXIgZXhwb3J0ZWQgPSB7fTsKICAgICAgdmFyIGZpeE1ldGhvZCA9IGZ1bmN0aW9uIGZpeE1ldGhvZChLRVkpIHsKICAgICAgICB2YXIgbmF0aXZlTWV0aG9kID0gTmF0aXZlUHJvdG90eXBlW0tFWV07CiAgICAgICAgcmVkZWZpbmUoTmF0aXZlUHJvdG90eXBlLCBLRVksIEtFWSA9PSAnYWRkJyA/IGZ1bmN0aW9uIGFkZCh2YWx1ZSkgewogICAgICAgICAgbmF0aXZlTWV0aG9kLmNhbGwodGhpcywgdmFsdWUgPT09IDAgPyAwIDogdmFsdWUpOwogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfSA6IEtFWSA9PSAnZGVsZXRlJyA/IGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgIHJldHVybiBJU19XRUFLICYmICFpc09iamVjdChrZXkpID8gZmFsc2UgOiBuYXRpdmVNZXRob2QuY2FsbCh0aGlzLCBrZXkgPT09IDAgPyAwIDoga2V5KTsKICAgICAgICB9IDogS0VZID09ICdnZXQnID8gZnVuY3Rpb24gZ2V0KGtleSkgewogICAgICAgICAgcmV0dXJuIElTX1dFQUsgJiYgIWlzT2JqZWN0KGtleSkgPyB1bmRlZmluZWQgOiBuYXRpdmVNZXRob2QuY2FsbCh0aGlzLCBrZXkgPT09IDAgPyAwIDoga2V5KTsKICAgICAgICB9IDogS0VZID09ICdoYXMnID8gZnVuY3Rpb24gaGFzKGtleSkgewogICAgICAgICAgcmV0dXJuIElTX1dFQUsgJiYgIWlzT2JqZWN0KGtleSkgPyBmYWxzZSA6IG5hdGl2ZU1ldGhvZC5jYWxsKHRoaXMsIGtleSA9PT0gMCA/IDAgOiBrZXkpOwogICAgICAgIH0gOiBmdW5jdGlvbiBzZXQoa2V5LCB2YWx1ZSkgewogICAgICAgICAgbmF0aXZlTWV0aG9kLmNhbGwodGhpcywga2V5ID09PSAwID8gMCA6IGtleSwgdmFsdWUpOwogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfSk7CiAgICAgIH07CiAgICAgIGlmIChpc0ZvcmNlZChDT05TVFJVQ1RPUl9OQU1FLCB0eXBlb2YgTmF0aXZlQ29uc3RydWN0b3IgIT0gJ2Z1bmN0aW9uJyB8fCAhKElTX1dFQUsgfHwgTmF0aXZlUHJvdG90eXBlLmZvckVhY2ggJiYgIWZhaWxzKGZ1bmN0aW9uICgpIHsKICAgICAgICBuZXcgTmF0aXZlQ29uc3RydWN0b3IoKS5lbnRyaWVzKCkubmV4dCgpOwogICAgICB9KSkpKSB7CiAgICAgICAgQ29uc3RydWN0b3IgPSBjb21tb24uZ2V0Q29uc3RydWN0b3Iod3JhcHBlciwgQ09OU1RSVUNUT1JfTkFNRSwgSVNfTUFQLCBBRERFUik7CiAgICAgICAgSW50ZXJuYWxNZXRhZGF0YU1vZHVsZS5SRVFVSVJFRCA9IHRydWU7CiAgICAgIH0gZWxzZSBpZiAoaXNGb3JjZWQoQ09OU1RSVUNUT1JfTkFNRSwgdHJ1ZSkpIHsKICAgICAgICB2YXIgaW5zdGFuY2UgPSBuZXcgQ29uc3RydWN0b3IoKTsKICAgICAgICB2YXIgSEFTTlRfQ0hBSU5JTkcgPSBpbnN0YW5jZVtBRERFUl0oSVNfV0VBSyA/IHt9IDogLTAsIDEpICE9IGluc3RhbmNlOwogICAgICAgIHZhciBUSFJPV1NfT05fUFJJTUlUSVZFUyA9IGZhaWxzKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGluc3RhbmNlLmhhcygxKTsKICAgICAgICB9KTsKICAgICAgICB2YXIgQUNDRVBUX0lURVJBQkxFUyA9IGNoZWNrQ29ycmVjdG5lc3NPZkl0ZXJhdGlvbihmdW5jdGlvbiAoaXRlcmFibGUpIHsKICAgICAgICAgIG5ldyBOYXRpdmVDb25zdHJ1Y3RvcihpdGVyYWJsZSk7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIEJVR0dZX1pFUk8gPSAhSVNfV0VBSyAmJiBmYWlscyhmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgJGluc3RhbmNlID0gbmV3IE5hdGl2ZUNvbnN0cnVjdG9yKCk7CiAgICAgICAgICB2YXIgaW5kZXggPSA1OwogICAgICAgICAgd2hpbGUgKGluZGV4LS0pCiAgICAgICAgICAkaW5zdGFuY2VbQURERVJdKGluZGV4LCBpbmRleCk7CiAgICAgICAgICByZXR1cm4gISRpbnN0YW5jZS5oYXMoLTApOwogICAgICAgIH0pOwogICAgICAgIGlmICghQUNDRVBUX0lURVJBQkxFUykgewogICAgICAgICAgQ29uc3RydWN0b3IgPSB3cmFwcGVyKGZ1bmN0aW9uIChkdW1teSwgaXRlcmFibGUpIHsKICAgICAgICAgICAgYW5JbnN0YW5jZShkdW1teSwgQ29uc3RydWN0b3IsIENPTlNUUlVDVE9SX05BTUUpOwogICAgICAgICAgICB2YXIgdGhhdCA9IGluaGVyaXRJZlJlcXVpcmVkKG5ldyBOYXRpdmVDb25zdHJ1Y3RvcigpLCBkdW1teSwgQ29uc3RydWN0b3IpOwogICAgICAgICAgICBpZiAoaXRlcmFibGUgIT0gdW5kZWZpbmVkKQogICAgICAgICAgICBpdGVyYXRlKGl0ZXJhYmxlLCB0aGF0W0FEREVSXSwgdGhhdCwgSVNfTUFQKTsKICAgICAgICAgICAgcmV0dXJuIHRoYXQ7CiAgICAgICAgICB9KTsKICAgICAgICAgIENvbnN0cnVjdG9yLnByb3RvdHlwZSA9IE5hdGl2ZVByb3RvdHlwZTsKICAgICAgICAgIE5hdGl2ZVByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IENvbnN0cnVjdG9yOwogICAgICAgIH0KICAgICAgICBpZiAoVEhST1dTX09OX1BSSU1JVElWRVMgfHwgQlVHR1lfWkVSTykgewogICAgICAgICAgZml4TWV0aG9kKCdkZWxldGUnKTsKICAgICAgICAgIGZpeE1ldGhvZCgnaGFzJyk7CiAgICAgICAgICBJU19NQVAgJiYgZml4TWV0aG9kKCdnZXQnKTsKICAgICAgICB9CiAgICAgICAgaWYgKEJVR0dZX1pFUk8gfHwgSEFTTlRfQ0hBSU5JTkcpCiAgICAgICAgZml4TWV0aG9kKEFEREVSKTsKICAgICAgICBpZiAoSVNfV0VBSyAmJiBOYXRpdmVQcm90b3R5cGUuY2xlYXIpCiAgICAgICAgZGVsZXRlIE5hdGl2ZVByb3RvdHlwZS5jbGVhcjsKICAgICAgfQogICAgICBleHBvcnRlZFtDT05TVFJVQ1RPUl9OQU1FXSA9IENvbnN0cnVjdG9yOwogICAgICAkKHsKICAgICAgICBnbG9iYWw6IHRydWUsCiAgICAgICAgZm9yY2VkOiBDb25zdHJ1Y3RvciAhPSBOYXRpdmVDb25zdHJ1Y3RvcgogICAgICB9LCBleHBvcnRlZCk7CiAgICAgIHNldFRvU3RyaW5nVGFnKENvbnN0cnVjdG9yLCBDT05TVFJVQ1RPUl9OQU1FKTsKICAgICAgaWYgKCFJU19XRUFLKQogICAgICBjb21tb24uc2V0U3Ryb25nKENvbnN0cnVjdG9yLCBDT05TVFJVQ1RPUl9OQU1FLCBJU19NQVApOwogICAgICByZXR1cm4gQ29uc3RydWN0b3I7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAxMzkgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgaGlkZGVuS2V5cyA9IF9fd19wZGZqc19yZXF1aXJlX18oMzQpOwogICAgdmFyIGlzT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygxNyk7CiAgICB2YXIgaGFzID0gX193X3BkZmpzX3JlcXVpcmVfXygxOCk7CiAgICB2YXIgZGVmaW5lUHJvcGVydHkgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIyKS5mOwogICAgdmFyIHVpZCA9IF9fd19wZGZqc19yZXF1aXJlX18oMzMpOwogICAgdmFyIEZSRUVaSU5HID0gX193X3BkZmpzX3JlcXVpcmVfXygxNDApOwogICAgdmFyIE1FVEFEQVRBID0gdWlkKCdtZXRhJyk7CiAgICB2YXIgaWQgPSAwOwogICAgdmFyIGlzRXh0ZW5zaWJsZSA9IE9iamVjdC5pc0V4dGVuc2libGUgfHwgZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH07CiAgICB2YXIgc2V0TWV0YWRhdGEgPSBmdW5jdGlvbiBzZXRNZXRhZGF0YShpdCkgewogICAgICBkZWZpbmVQcm9wZXJ0eShpdCwgTUVUQURBVEEsIHsKICAgICAgICB2YWx1ZTogewogICAgICAgICAgb2JqZWN0SUQ6ICdPJyArICsraWQsCiAgICAgICAgICB3ZWFrRGF0YToge30KICAgICAgICB9CiAgICAgIH0pOwogICAgfTsKICAgIHZhciBmYXN0S2V5ID0gZnVuY3Rpb24gZmFzdEtleShpdCwgY3JlYXRlKSB7CiAgICAgIGlmICghaXNPYmplY3QoaXQpKQogICAgICByZXR1cm4gdHlwZW9mIGl0ID09ICdzeW1ib2wnID8gaXQgOiAodHlwZW9mIGl0ID09ICdzdHJpbmcnID8gJ1MnIDogJ1AnKSArIGl0OwogICAgICBpZiAoIWhhcyhpdCwgTUVUQURBVEEpKSB7CiAgICAgICAgaWYgKCFpc0V4dGVuc2libGUoaXQpKQogICAgICAgIHJldHVybiAnRic7CiAgICAgICAgaWYgKCFjcmVhdGUpCiAgICAgICAgcmV0dXJuICdFJzsKICAgICAgICBzZXRNZXRhZGF0YShpdCk7CiAgICAgIH0KICAgICAgcmV0dXJuIGl0W01FVEFEQVRBXS5vYmplY3RJRDsKICAgIH07CiAgICB2YXIgZ2V0V2Vha0RhdGEgPSBmdW5jdGlvbiBnZXRXZWFrRGF0YShpdCwgY3JlYXRlKSB7CiAgICAgIGlmICghaGFzKGl0LCBNRVRBREFUQSkpIHsKICAgICAgICBpZiAoIWlzRXh0ZW5zaWJsZShpdCkpCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKCFjcmVhdGUpCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHNldE1ldGFkYXRhKGl0KTsKICAgICAgfQogICAgICByZXR1cm4gaXRbTUVUQURBVEFdLndlYWtEYXRhOwogICAgfTsKICAgIHZhciBvbkZyZWV6ZSA9IGZ1bmN0aW9uIG9uRnJlZXplKGl0KSB7CiAgICAgIGlmIChGUkVFWklORyAmJiBtZXRhLlJFUVVJUkVEICYmIGlzRXh0ZW5zaWJsZShpdCkgJiYgIWhhcyhpdCwgTUVUQURBVEEpKQogICAgICBzZXRNZXRhZGF0YShpdCk7CiAgICAgIHJldHVybiBpdDsKICAgIH07CiAgICB2YXIgbWV0YSA9IG1vZHVsZS5leHBvcnRzID0gewogICAgICBSRVFVSVJFRDogZmFsc2UsCiAgICAgIGZhc3RLZXk6IGZhc3RLZXksCiAgICAgIGdldFdlYWtEYXRhOiBnZXRXZWFrRGF0YSwKICAgICAgb25GcmVlemU6IG9uRnJlZXplCiAgICB9OwogICAgaGlkZGVuS2V5c1tNRVRBREFUQV0gPSB0cnVlOwoKICAgIC8qKiovfSksICgKICAvKiAxNDAgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgZmFpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDkpOwogICAgbW9kdWxlLmV4cG9ydHMgPSAhZmFpbHMoZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gT2JqZWN0LmlzRXh0ZW5zaWJsZShPYmplY3QucHJldmVudEV4dGVuc2lvbnMoe30pKTsKICAgIH0pOwoKICAgIC8qKiovfSksICgKICAvKiAxNDEgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgaXNPYmplY3QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE3KTsKICAgIHZhciBzZXRQcm90b3R5cGVPZiA9IF9fd19wZGZqc19yZXF1aXJlX18oODMpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoJHRoaXMsIGR1bW15LCBXcmFwcGVyKSB7CiAgICAgIHZhciBOZXdUYXJnZXQsIE5ld1RhcmdldFByb3RvdHlwZTsKICAgICAgaWYgKHNldFByb3RvdHlwZU9mICYmIHR5cGVvZiAoTmV3VGFyZ2V0ID0gZHVtbXkuY29uc3RydWN0b3IpID09ICdmdW5jdGlvbicgJiYgTmV3VGFyZ2V0ICE9PSBXcmFwcGVyICYmIGlzT2JqZWN0KE5ld1RhcmdldFByb3RvdHlwZSA9IE5ld1RhcmdldC5wcm90b3R5cGUpICYmIE5ld1RhcmdldFByb3RvdHlwZSAhPT0gV3JhcHBlci5wcm90b3R5cGUpCiAgICAgIHNldFByb3RvdHlwZU9mKCR0aGlzLCBOZXdUYXJnZXRQcm90b3R5cGUpOwogICAgICByZXR1cm4gJHRoaXM7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAxNDIgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGRlZmluZVByb3BlcnR5ID0gX193X3BkZmpzX3JlcXVpcmVfXygyMikuZjsKICAgIHZhciBjcmVhdGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDY3KTsKICAgIHZhciByZWRlZmluZUFsbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTEyKTsKICAgIHZhciBiaW5kID0gX193X3BkZmpzX3JlcXVpcmVfXyg1OCk7CiAgICB2YXIgYW5JbnN0YW5jZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTE0KTsKICAgIHZhciBpdGVyYXRlID0gX193X3BkZmpzX3JlcXVpcmVfXygxMTUpOwogICAgdmFyIGRlZmluZUl0ZXJhdG9yID0gX193X3BkZmpzX3JlcXVpcmVfXyg3NSk7CiAgICB2YXIgc2V0U3BlY2llcyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTEzKTsKICAgIHZhciBERVNDUklQVE9SUyA9IF9fd19wZGZqc19yZXF1aXJlX18oOCk7CiAgICB2YXIgZmFzdEtleSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTM5KS5mYXN0S2V5OwogICAgdmFyIEludGVybmFsU3RhdGVNb2R1bGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDI4KTsKICAgIHZhciBzZXRJbnRlcm5hbFN0YXRlID0gSW50ZXJuYWxTdGF0ZU1vZHVsZS5zZXQ7CiAgICB2YXIgaW50ZXJuYWxTdGF0ZUdldHRlckZvciA9IEludGVybmFsU3RhdGVNb2R1bGUuZ2V0dGVyRm9yOwogICAgbW9kdWxlLmV4cG9ydHMgPSB7CiAgICAgIGdldENvbnN0cnVjdG9yOiBmdW5jdGlvbiBnZXRDb25zdHJ1Y3Rvcih3cmFwcGVyLCBDT05TVFJVQ1RPUl9OQU1FLCBJU19NQVAsIEFEREVSKSB7CiAgICAgICAgdmFyIEMgPSB3cmFwcGVyKGZ1bmN0aW9uICh0aGF0LCBpdGVyYWJsZSkgewogICAgICAgICAgYW5JbnN0YW5jZSh0aGF0LCBDLCBDT05TVFJVQ1RPUl9OQU1FKTsKICAgICAgICAgIHNldEludGVybmFsU3RhdGUodGhhdCwgewogICAgICAgICAgICB0eXBlOiBDT05TVFJVQ1RPUl9OQU1FLAogICAgICAgICAgICBpbmRleDogY3JlYXRlKG51bGwpLAogICAgICAgICAgICBmaXJzdDogdW5kZWZpbmVkLAogICAgICAgICAgICBsYXN0OiB1bmRlZmluZWQsCiAgICAgICAgICAgIHNpemU6IDAKICAgICAgICAgIH0pOwogICAgICAgICAgaWYgKCFERVNDUklQVE9SUykKICAgICAgICAgIHRoYXQuc2l6ZSA9IDA7CiAgICAgICAgICBpZiAoaXRlcmFibGUgIT0gdW5kZWZpbmVkKQogICAgICAgICAgaXRlcmF0ZShpdGVyYWJsZSwgdGhhdFtBRERFUl0sIHRoYXQsIElTX01BUCk7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIGdldEludGVybmFsU3RhdGUgPSBpbnRlcm5hbFN0YXRlR2V0dGVyRm9yKENPTlNUUlVDVE9SX05BTUUpOwogICAgICAgIHZhciBkZWZpbmUgPSBmdW5jdGlvbiBkZWZpbmUodGhhdCwga2V5LCB2YWx1ZSkgewogICAgICAgICAgdmFyIHN0YXRlID0gZ2V0SW50ZXJuYWxTdGF0ZSh0aGF0KTsKICAgICAgICAgIHZhciBlbnRyeSA9IGdldEVudHJ5KHRoYXQsIGtleSk7CiAgICAgICAgICB2YXIgcHJldmlvdXMsIGluZGV4OwogICAgICAgICAgaWYgKGVudHJ5KSB7CiAgICAgICAgICAgIGVudHJ5LnZhbHVlID0gdmFsdWU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdGF0ZS5sYXN0ID0gZW50cnkgPSB7CiAgICAgICAgICAgICAgaW5kZXg6IGluZGV4ID0gZmFzdEtleShrZXksIHRydWUpLAogICAgICAgICAgICAgIGtleToga2V5LAogICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICAgICAgICBwcmV2aW91czogcHJldmlvdXMgPSBzdGF0ZS5sYXN0LAogICAgICAgICAgICAgIG5leHQ6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICByZW1vdmVkOiBmYWxzZQogICAgICAgICAgICB9OwogICAgICAgICAgICBpZiAoIXN0YXRlLmZpcnN0KQogICAgICAgICAgICBzdGF0ZS5maXJzdCA9IGVudHJ5OwogICAgICAgICAgICBpZiAocHJldmlvdXMpCiAgICAgICAgICAgIHByZXZpb3VzLm5leHQgPSBlbnRyeTsKICAgICAgICAgICAgaWYgKERFU0NSSVBUT1JTKQogICAgICAgICAgICBzdGF0ZS5zaXplKys7ZWxzZQoKICAgICAgICAgICAgdGhhdC5zaXplKys7CiAgICAgICAgICAgIGlmIChpbmRleCAhPT0gJ0YnKQogICAgICAgICAgICBzdGF0ZS5pbmRleFtpbmRleF0gPSBlbnRyeTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0aGF0OwogICAgICAgIH07CiAgICAgICAgdmFyIGdldEVudHJ5ID0gZnVuY3Rpb24gZ2V0RW50cnkodGhhdCwga2V5KSB7CiAgICAgICAgICB2YXIgc3RhdGUgPSBnZXRJbnRlcm5hbFN0YXRlKHRoYXQpOwogICAgICAgICAgdmFyIGluZGV4ID0gZmFzdEtleShrZXkpOwogICAgICAgICAgdmFyIGVudHJ5OwogICAgICAgICAgaWYgKGluZGV4ICE9PSAnRicpCiAgICAgICAgICByZXR1cm4gc3RhdGUuaW5kZXhbaW5kZXhdOwogICAgICAgICAgZm9yIChlbnRyeSA9IHN0YXRlLmZpcnN0OyBlbnRyeTsgZW50cnkgPSBlbnRyeS5uZXh0KSB7CiAgICAgICAgICAgIGlmIChlbnRyeS5rZXkgPT0ga2V5KQogICAgICAgICAgICByZXR1cm4gZW50cnk7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICByZWRlZmluZUFsbChDLnByb3RvdHlwZSwgewogICAgICAgICAgY2xlYXI6IGZ1bmN0aW9uIGNsZWFyKCkgewogICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IGdldEludGVybmFsU3RhdGUodGhhdCk7CiAgICAgICAgICAgIHZhciBkYXRhID0gc3RhdGUuaW5kZXg7CiAgICAgICAgICAgIHZhciBlbnRyeSA9IHN0YXRlLmZpcnN0OwogICAgICAgICAgICB3aGlsZSAoZW50cnkpIHsKICAgICAgICAgICAgICBlbnRyeS5yZW1vdmVkID0gdHJ1ZTsKICAgICAgICAgICAgICBpZiAoZW50cnkucHJldmlvdXMpCiAgICAgICAgICAgICAgZW50cnkucHJldmlvdXMgPSBlbnRyeS5wcmV2aW91cy5uZXh0ID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgIGRlbGV0ZSBkYXRhW2VudHJ5LmluZGV4XTsKICAgICAgICAgICAgICBlbnRyeSA9IGVudHJ5Lm5leHQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RhdGUuZmlyc3QgPSBzdGF0ZS5sYXN0ID0gdW5kZWZpbmVkOwogICAgICAgICAgICBpZiAoREVTQ1JJUFRPUlMpCiAgICAgICAgICAgIHN0YXRlLnNpemUgPSAwO2Vsc2UKCiAgICAgICAgICAgIHRoYXQuc2l6ZSA9IDA7CiAgICAgICAgICB9LAogICAgICAgICAgJ2RlbGV0ZSc6IGZ1bmN0aW9uIF9kZWxldGUoa2V5KSB7CiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpczsKICAgICAgICAgICAgdmFyIHN0YXRlID0gZ2V0SW50ZXJuYWxTdGF0ZSh0aGF0KTsKICAgICAgICAgICAgdmFyIGVudHJ5ID0gZ2V0RW50cnkodGhhdCwga2V5KTsKICAgICAgICAgICAgaWYgKGVudHJ5KSB7CiAgICAgICAgICAgICAgdmFyIG5leHQgPSBlbnRyeS5uZXh0OwogICAgICAgICAgICAgIHZhciBwcmV2ID0gZW50cnkucHJldmlvdXM7CiAgICAgICAgICAgICAgZGVsZXRlIHN0YXRlLmluZGV4W2VudHJ5LmluZGV4XTsKICAgICAgICAgICAgICBlbnRyeS5yZW1vdmVkID0gdHJ1ZTsKICAgICAgICAgICAgICBpZiAocHJldikKICAgICAgICAgICAgICBwcmV2Lm5leHQgPSBuZXh0OwogICAgICAgICAgICAgIGlmIChuZXh0KQogICAgICAgICAgICAgIG5leHQucHJldmlvdXMgPSBwcmV2OwogICAgICAgICAgICAgIGlmIChzdGF0ZS5maXJzdCA9PSBlbnRyeSkKICAgICAgICAgICAgICBzdGF0ZS5maXJzdCA9IG5leHQ7CiAgICAgICAgICAgICAgaWYgKHN0YXRlLmxhc3QgPT0gZW50cnkpCiAgICAgICAgICAgICAgc3RhdGUubGFzdCA9IHByZXY7CiAgICAgICAgICAgICAgaWYgKERFU0NSSVBUT1JTKQogICAgICAgICAgICAgIHN0YXRlLnNpemUtLTtlbHNlCgogICAgICAgICAgICAgIHRoYXQuc2l6ZS0tOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAhIWVudHJ5OwogICAgICAgICAgfSwKICAgICAgICAgIGZvckVhY2g6IGZ1bmN0aW9uIGZvckVhY2goY2FsbGJhY2tmbikgewogICAgICAgICAgICB2YXIgc3RhdGUgPSBnZXRJbnRlcm5hbFN0YXRlKHRoaXMpOwogICAgICAgICAgICB2YXIgYm91bmRGdW5jdGlvbiA9IGJpbmQoY2FsbGJhY2tmbiwgYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQsIDMpOwogICAgICAgICAgICB2YXIgZW50cnk7CiAgICAgICAgICAgIHdoaWxlIChlbnRyeSA9IGVudHJ5ID8gZW50cnkubmV4dCA6IHN0YXRlLmZpcnN0KSB7CiAgICAgICAgICAgICAgYm91bmRGdW5jdGlvbihlbnRyeS52YWx1ZSwgZW50cnkua2V5LCB0aGlzKTsKICAgICAgICAgICAgICB3aGlsZSAoZW50cnkgJiYgZW50cnkucmVtb3ZlZCkKICAgICAgICAgICAgICBlbnRyeSA9IGVudHJ5LnByZXZpb3VzOwogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgaGFzOiBmdW5jdGlvbiBoYXMoa2V5KSB7CiAgICAgICAgICAgIHJldHVybiAhIWdldEVudHJ5KHRoaXMsIGtleSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmVkZWZpbmVBbGwoQy5wcm90b3R5cGUsIElTX01BUCA/IHsKICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KGtleSkgewogICAgICAgICAgICB2YXIgZW50cnkgPSBnZXRFbnRyeSh0aGlzLCBrZXkpOwogICAgICAgICAgICByZXR1cm4gZW50cnkgJiYgZW50cnkudmFsdWU7CiAgICAgICAgICB9LAogICAgICAgICAgc2V0OiBmdW5jdGlvbiBzZXQoa2V5LCB2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gZGVmaW5lKHRoaXMsIGtleSA9PT0gMCA/IDAgOiBrZXksIHZhbHVlKTsKICAgICAgICAgIH0KICAgICAgICB9IDogewogICAgICAgICAgYWRkOiBmdW5jdGlvbiBhZGQodmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuIGRlZmluZSh0aGlzLCB2YWx1ZSA9IHZhbHVlID09PSAwID8gMCA6IHZhbHVlLCB2YWx1ZSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgaWYgKERFU0NSSVBUT1JTKQogICAgICAgIGRlZmluZVByb3BlcnR5KEMucHJvdG90eXBlLCAnc2l6ZScsIHsKICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gZ2V0SW50ZXJuYWxTdGF0ZSh0aGlzKS5zaXplOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBDOwogICAgICB9LAogICAgICBzZXRTdHJvbmc6IGZ1bmN0aW9uIHNldFN0cm9uZyhDLCBDT05TVFJVQ1RPUl9OQU1FLCBJU19NQVApIHsKICAgICAgICB2YXIgSVRFUkFUT1JfTkFNRSA9IENPTlNUUlVDVE9SX05BTUUgKyAnIEl0ZXJhdG9yJzsKICAgICAgICB2YXIgZ2V0SW50ZXJuYWxDb2xsZWN0aW9uU3RhdGUgPSBpbnRlcm5hbFN0YXRlR2V0dGVyRm9yKENPTlNUUlVDVE9SX05BTUUpOwogICAgICAgIHZhciBnZXRJbnRlcm5hbEl0ZXJhdG9yU3RhdGUgPSBpbnRlcm5hbFN0YXRlR2V0dGVyRm9yKElURVJBVE9SX05BTUUpOwogICAgICAgIGRlZmluZUl0ZXJhdG9yKEMsIENPTlNUUlVDVE9SX05BTUUsIGZ1bmN0aW9uIChpdGVyYXRlZCwga2luZCkgewogICAgICAgICAgc2V0SW50ZXJuYWxTdGF0ZSh0aGlzLCB7CiAgICAgICAgICAgIHR5cGU6IElURVJBVE9SX05BTUUsCiAgICAgICAgICAgIHRhcmdldDogaXRlcmF0ZWQsCiAgICAgICAgICAgIHN0YXRlOiBnZXRJbnRlcm5hbENvbGxlY3Rpb25TdGF0ZShpdGVyYXRlZCksCiAgICAgICAgICAgIGtpbmQ6IGtpbmQsCiAgICAgICAgICAgIGxhc3Q6IHVuZGVmaW5lZAogICAgICAgICAgfSk7CiAgICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIHN0YXRlID0gZ2V0SW50ZXJuYWxJdGVyYXRvclN0YXRlKHRoaXMpOwogICAgICAgICAgdmFyIGtpbmQgPSBzdGF0ZS5raW5kOwogICAgICAgICAgdmFyIGVudHJ5ID0gc3RhdGUubGFzdDsKICAgICAgICAgIHdoaWxlIChlbnRyeSAmJiBlbnRyeS5yZW1vdmVkKQogICAgICAgICAgZW50cnkgPSBlbnRyeS5wcmV2aW91czsKICAgICAgICAgIGlmICghc3RhdGUudGFyZ2V0IHx8ICEoc3RhdGUubGFzdCA9IGVudHJ5ID0gZW50cnkgPyBlbnRyeS5uZXh0IDogc3RhdGUuc3RhdGUuZmlyc3QpKSB7CiAgICAgICAgICAgIHN0YXRlLnRhcmdldCA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICB2YWx1ZTogdW5kZWZpbmVkLAogICAgICAgICAgICAgIGRvbmU6IHRydWUKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChraW5kID09ICdrZXlzJykKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHZhbHVlOiBlbnRyeS5rZXksCiAgICAgICAgICAgIGRvbmU6IGZhbHNlCiAgICAgICAgICB9OwogICAgICAgICAgaWYgKGtpbmQgPT0gJ3ZhbHVlcycpCiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICB2YWx1ZTogZW50cnkudmFsdWUsCiAgICAgICAgICAgIGRvbmU6IGZhbHNlCiAgICAgICAgICB9OwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdmFsdWU6IFsKICAgICAgICAgICAgZW50cnkua2V5LAogICAgICAgICAgICBlbnRyeS52YWx1ZV0sCgogICAgICAgICAgICBkb25lOiBmYWxzZQogICAgICAgICAgfTsKICAgICAgICB9LCBJU19NQVAgPyAnZW50cmllcycgOiAndmFsdWVzJywgIUlTX01BUCwgdHJ1ZSk7CiAgICAgICAgc2V0U3BlY2llcyhDT05TVFJVQ1RPUl9OQU1FKTsKICAgICAgfQogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogMTQzICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgX193X3BkZmpzX3JlcXVpcmVfXygxNDQpOwogICAgX193X3BkZmpzX3JlcXVpcmVfXygxMDUpOwogICAgX193X3BkZmpzX3JlcXVpcmVfXyg3Myk7CiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDEwNyk7CiAgICB2YXIgcGF0aCA9IF9fd19wZGZqc19yZXF1aXJlX18oMzgpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBwYXRoLlNldDsKCiAgICAvKioqL30pLCAoCiAgLyogMTQ0ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBjb2xsZWN0aW9uID0gX193X3BkZmpzX3JlcXVpcmVfXygxMzgpOwogICAgdmFyIGNvbGxlY3Rpb25TdHJvbmcgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE0Mik7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGNvbGxlY3Rpb24oJ1NldCcsIGZ1bmN0aW9uIChpbml0KSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiBTZXQoKSB7CiAgICAgICAgcmV0dXJuIGluaXQodGhpcywgYXJndW1lbnRzLmxlbmd0aCA/IGFyZ3VtZW50c1swXSA6IHVuZGVmaW5lZCk7CiAgICAgIH07CiAgICB9LCBjb2xsZWN0aW9uU3Ryb25nKTsKCiAgICAvKioqL30pLCAoCiAgLyogMTQ1ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgX193X3BkZmpzX3JlcXVpcmVfXygxMDUpOwogICAgX193X3BkZmpzX3JlcXVpcmVfXygxNDYpOwogICAgX193X3BkZmpzX3JlcXVpcmVfXygxMDcpOwogICAgdmFyIHBhdGggPSBfX3dfcGRmanNfcmVxdWlyZV9fKDM4KTsKICAgIG1vZHVsZS5leHBvcnRzID0gcGF0aC5XZWFrTWFwOwoKICAgIC8qKiovfSksICgKICAvKiAxNDYgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGdsb2JhbCA9IF9fd19wZGZqc19yZXF1aXJlX18oNik7CiAgICB2YXIgcmVkZWZpbmVBbGwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDExMik7CiAgICB2YXIgSW50ZXJuYWxNZXRhZGF0YU1vZHVsZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTM5KTsKICAgIHZhciBjb2xsZWN0aW9uID0gX193X3BkZmpzX3JlcXVpcmVfXygxMzgpOwogICAgdmFyIGNvbGxlY3Rpb25XZWFrID0gX193X3BkZmpzX3JlcXVpcmVfXygxNDcpOwogICAgdmFyIGlzT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygxNyk7CiAgICB2YXIgZW5mb3JjZUl0ZXJuYWxTdGF0ZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjgpLmVuZm9yY2U7CiAgICB2YXIgTkFUSVZFX1dFQUtfTUFQID0gX193X3BkZmpzX3JlcXVpcmVfXygyOSk7CiAgICB2YXIgSVNfSUUxMSA9ICFnbG9iYWwuQWN0aXZlWE9iamVjdCAmJiAnQWN0aXZlWE9iamVjdCcgaW4gZ2xvYmFsOwogICAgdmFyIGlzRXh0ZW5zaWJsZSA9IE9iamVjdC5pc0V4dGVuc2libGU7CiAgICB2YXIgSW50ZXJuYWxXZWFrTWFwOwogICAgdmFyIHdyYXBwZXIgPSBmdW5jdGlvbiB3cmFwcGVyKGluaXQpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uIFdlYWtNYXAoKSB7CiAgICAgICAgcmV0dXJuIGluaXQodGhpcywgYXJndW1lbnRzLmxlbmd0aCA/IGFyZ3VtZW50c1swXSA6IHVuZGVmaW5lZCk7CiAgICAgIH07CiAgICB9OwogICAgdmFyICRXZWFrTWFwID0gbW9kdWxlLmV4cG9ydHMgPSBjb2xsZWN0aW9uKCdXZWFrTWFwJywgd3JhcHBlciwgY29sbGVjdGlvbldlYWspOwogICAgaWYgKE5BVElWRV9XRUFLX01BUCAmJiBJU19JRTExKSB7CiAgICAgIEludGVybmFsV2Vha01hcCA9IGNvbGxlY3Rpb25XZWFrLmdldENvbnN0cnVjdG9yKHdyYXBwZXIsICdXZWFrTWFwJywgdHJ1ZSk7CiAgICAgIEludGVybmFsTWV0YWRhdGFNb2R1bGUuUkVRVUlSRUQgPSB0cnVlOwogICAgICB2YXIgV2Vha01hcFByb3RvdHlwZSA9ICRXZWFrTWFwLnByb3RvdHlwZTsKICAgICAgdmFyIG5hdGl2ZURlbGV0ZSA9IFdlYWtNYXBQcm90b3R5cGVbJ2RlbGV0ZSddOwogICAgICB2YXIgbmF0aXZlSGFzID0gV2Vha01hcFByb3RvdHlwZS5oYXM7CiAgICAgIHZhciBuYXRpdmVHZXQgPSBXZWFrTWFwUHJvdG90eXBlLmdldDsKICAgICAgdmFyIG5hdGl2ZVNldCA9IFdlYWtNYXBQcm90b3R5cGUuc2V0OwogICAgICByZWRlZmluZUFsbChXZWFrTWFwUHJvdG90eXBlLCB7CiAgICAgICAgJ2RlbGV0ZSc6IGZ1bmN0aW9uIF9kZWxldGUoa2V5KSB7CiAgICAgICAgICBpZiAoaXNPYmplY3Qoa2V5KSAmJiAhaXNFeHRlbnNpYmxlKGtleSkpIHsKICAgICAgICAgICAgdmFyIHN0YXRlID0gZW5mb3JjZUl0ZXJuYWxTdGF0ZSh0aGlzKTsKICAgICAgICAgICAgaWYgKCFzdGF0ZS5mcm96ZW4pCiAgICAgICAgICAgIHN0YXRlLmZyb3plbiA9IG5ldyBJbnRlcm5hbFdlYWtNYXAoKTsKICAgICAgICAgICAgcmV0dXJuIG5hdGl2ZURlbGV0ZS5jYWxsKHRoaXMsIGtleSkgfHwgc3RhdGUuZnJvemVuWydkZWxldGUnXShrZXkpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG5hdGl2ZURlbGV0ZS5jYWxsKHRoaXMsIGtleSk7CiAgICAgICAgfSwKICAgICAgICBoYXM6IGZ1bmN0aW9uIGhhcyhrZXkpIHsKICAgICAgICAgIGlmIChpc09iamVjdChrZXkpICYmICFpc0V4dGVuc2libGUoa2V5KSkgewogICAgICAgICAgICB2YXIgc3RhdGUgPSBlbmZvcmNlSXRlcm5hbFN0YXRlKHRoaXMpOwogICAgICAgICAgICBpZiAoIXN0YXRlLmZyb3plbikKICAgICAgICAgICAgc3RhdGUuZnJvemVuID0gbmV3IEludGVybmFsV2Vha01hcCgpOwogICAgICAgICAgICByZXR1cm4gbmF0aXZlSGFzLmNhbGwodGhpcywga2V5KSB8fCBzdGF0ZS5mcm96ZW4uaGFzKGtleSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbmF0aXZlSGFzLmNhbGwodGhpcywga2V5KTsKICAgICAgICB9LAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KGtleSkgewogICAgICAgICAgaWYgKGlzT2JqZWN0KGtleSkgJiYgIWlzRXh0ZW5zaWJsZShrZXkpKSB7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IGVuZm9yY2VJdGVybmFsU3RhdGUodGhpcyk7CiAgICAgICAgICAgIGlmICghc3RhdGUuZnJvemVuKQogICAgICAgICAgICBzdGF0ZS5mcm96ZW4gPSBuZXcgSW50ZXJuYWxXZWFrTWFwKCk7CiAgICAgICAgICAgIHJldHVybiBuYXRpdmVIYXMuY2FsbCh0aGlzLCBrZXkpID8gbmF0aXZlR2V0LmNhbGwodGhpcywga2V5KSA6IHN0YXRlLmZyb3plbi5nZXQoa2V5KTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBuYXRpdmVHZXQuY2FsbCh0aGlzLCBrZXkpOwogICAgICAgIH0sCiAgICAgICAgc2V0OiBmdW5jdGlvbiBzZXQoa2V5LCB2YWx1ZSkgewogICAgICAgICAgaWYgKGlzT2JqZWN0KGtleSkgJiYgIWlzRXh0ZW5zaWJsZShrZXkpKSB7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IGVuZm9yY2VJdGVybmFsU3RhdGUodGhpcyk7CiAgICAgICAgICAgIGlmICghc3RhdGUuZnJvemVuKQogICAgICAgICAgICBzdGF0ZS5mcm96ZW4gPSBuZXcgSW50ZXJuYWxXZWFrTWFwKCk7CiAgICAgICAgICAgIG5hdGl2ZUhhcy5jYWxsKHRoaXMsIGtleSkgPyBuYXRpdmVTZXQuY2FsbCh0aGlzLCBrZXksIHZhbHVlKSA6IHN0YXRlLmZyb3plbi5zZXQoa2V5LCB2YWx1ZSk7CiAgICAgICAgICB9IGVsc2UKICAgICAgICAgIG5hdGl2ZVNldC5jYWxsKHRoaXMsIGtleSwgdmFsdWUpOwogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KCiAgICAvKioqL30pLCAoCiAgLyogMTQ3ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciByZWRlZmluZUFsbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTEyKTsKICAgIHZhciBnZXRXZWFrRGF0YSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTM5KS5nZXRXZWFrRGF0YTsKICAgIHZhciBhbk9iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oMjMpOwogICAgdmFyIGlzT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygxNyk7CiAgICB2YXIgYW5JbnN0YW5jZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTE0KTsKICAgIHZhciBpdGVyYXRlID0gX193X3BkZmpzX3JlcXVpcmVfXygxMTUpOwogICAgdmFyIEFycmF5SXRlcmF0aW9uTW9kdWxlID0gX193X3BkZmpzX3JlcXVpcmVfXygxNDgpOwogICAgdmFyICRoYXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE4KTsKICAgIHZhciBJbnRlcm5hbFN0YXRlTW9kdWxlID0gX193X3BkZmpzX3JlcXVpcmVfXygyOCk7CiAgICB2YXIgc2V0SW50ZXJuYWxTdGF0ZSA9IEludGVybmFsU3RhdGVNb2R1bGUuc2V0OwogICAgdmFyIGludGVybmFsU3RhdGVHZXR0ZXJGb3IgPSBJbnRlcm5hbFN0YXRlTW9kdWxlLmdldHRlckZvcjsKICAgIHZhciBmaW5kID0gQXJyYXlJdGVyYXRpb25Nb2R1bGUuZmluZDsKICAgIHZhciBmaW5kSW5kZXggPSBBcnJheUl0ZXJhdGlvbk1vZHVsZS5maW5kSW5kZXg7CiAgICB2YXIgaWQgPSAwOwogICAgdmFyIHVuY2F1Z2h0RnJvemVuU3RvcmUgPSBmdW5jdGlvbiB1bmNhdWdodEZyb3plblN0b3JlKHN0b3JlKSB7CiAgICAgIHJldHVybiBzdG9yZS5mcm96ZW4gfHwgKHN0b3JlLmZyb3plbiA9IG5ldyBVbmNhdWdodEZyb3plblN0b3JlKCkpOwogICAgfTsKICAgIHZhciBVbmNhdWdodEZyb3plblN0b3JlID0gZnVuY3Rpb24gVW5jYXVnaHRGcm96ZW5TdG9yZSgpIHsKICAgICAgdGhpcy5lbnRyaWVzID0gW107CiAgICB9OwogICAgdmFyIGZpbmRVbmNhdWdodEZyb3plbiA9IGZ1bmN0aW9uIGZpbmRVbmNhdWdodEZyb3plbihzdG9yZSwga2V5KSB7CiAgICAgIHJldHVybiBmaW5kKHN0b3JlLmVudHJpZXMsIGZ1bmN0aW9uIChpdCkgewogICAgICAgIHJldHVybiBpdFswXSA9PT0ga2V5OwogICAgICB9KTsKICAgIH07CiAgICBVbmNhdWdodEZyb3plblN0b3JlLnByb3RvdHlwZSA9IHsKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoa2V5KSB7CiAgICAgICAgdmFyIGVudHJ5ID0gZmluZFVuY2F1Z2h0RnJvemVuKHRoaXMsIGtleSk7CiAgICAgICAgaWYgKGVudHJ5KQogICAgICAgIHJldHVybiBlbnRyeVsxXTsKICAgICAgfSwKICAgICAgaGFzOiBmdW5jdGlvbiBoYXMoa2V5KSB7CiAgICAgICAgcmV0dXJuICEhZmluZFVuY2F1Z2h0RnJvemVuKHRoaXMsIGtleSk7CiAgICAgIH0sCiAgICAgIHNldDogZnVuY3Rpb24gc2V0KGtleSwgdmFsdWUpIHsKICAgICAgICB2YXIgZW50cnkgPSBmaW5kVW5jYXVnaHRGcm96ZW4odGhpcywga2V5KTsKICAgICAgICBpZiAoZW50cnkpCiAgICAgICAgZW50cnlbMV0gPSB2YWx1ZTtlbHNlCgogICAgICAgIHRoaXMuZW50cmllcy5wdXNoKFsKICAgICAgICBrZXksCiAgICAgICAgdmFsdWVdCiAgICAgICAgKTsKICAgICAgfSwKICAgICAgJ2RlbGV0ZSc6IGZ1bmN0aW9uIF9kZWxldGUoa2V5KSB7CiAgICAgICAgdmFyIGluZGV4ID0gZmluZEluZGV4KHRoaXMuZW50cmllcywgZnVuY3Rpb24gKGl0KSB7CiAgICAgICAgICByZXR1cm4gaXRbMF0gPT09IGtleTsKICAgICAgICB9KTsKICAgICAgICBpZiAofmluZGV4KQogICAgICAgIHRoaXMuZW50cmllcy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgIHJldHVybiAhIX5pbmRleDsKICAgICAgfQogICAgfTsKICAgIG1vZHVsZS5leHBvcnRzID0gewogICAgICBnZXRDb25zdHJ1Y3RvcjogZnVuY3Rpb24gZ2V0Q29uc3RydWN0b3Iod3JhcHBlciwgQ09OU1RSVUNUT1JfTkFNRSwgSVNfTUFQLCBBRERFUikgewogICAgICAgIHZhciBDID0gd3JhcHBlcihmdW5jdGlvbiAodGhhdCwgaXRlcmFibGUpIHsKICAgICAgICAgIGFuSW5zdGFuY2UodGhhdCwgQywgQ09OU1RSVUNUT1JfTkFNRSk7CiAgICAgICAgICBzZXRJbnRlcm5hbFN0YXRlKHRoYXQsIHsKICAgICAgICAgICAgdHlwZTogQ09OU1RSVUNUT1JfTkFNRSwKICAgICAgICAgICAgaWQ6IGlkKyssCiAgICAgICAgICAgIGZyb3plbjogdW5kZWZpbmVkCiAgICAgICAgICB9KTsKICAgICAgICAgIGlmIChpdGVyYWJsZSAhPSB1bmRlZmluZWQpCiAgICAgICAgICBpdGVyYXRlKGl0ZXJhYmxlLCB0aGF0W0FEREVSXSwgdGhhdCwgSVNfTUFQKTsKICAgICAgICB9KTsKICAgICAgICB2YXIgZ2V0SW50ZXJuYWxTdGF0ZSA9IGludGVybmFsU3RhdGVHZXR0ZXJGb3IoQ09OU1RSVUNUT1JfTkFNRSk7CiAgICAgICAgdmFyIGRlZmluZSA9IGZ1bmN0aW9uIGRlZmluZSh0aGF0LCBrZXksIHZhbHVlKSB7CiAgICAgICAgICB2YXIgc3RhdGUgPSBnZXRJbnRlcm5hbFN0YXRlKHRoYXQpOwogICAgICAgICAgdmFyIGRhdGEgPSBnZXRXZWFrRGF0YShhbk9iamVjdChrZXkpLCB0cnVlKTsKICAgICAgICAgIGlmIChkYXRhID09PSB0cnVlKQogICAgICAgICAgdW5jYXVnaHRGcm96ZW5TdG9yZShzdGF0ZSkuc2V0KGtleSwgdmFsdWUpO2Vsc2UKCiAgICAgICAgICBkYXRhW3N0YXRlLmlkXSA9IHZhbHVlOwogICAgICAgICAgcmV0dXJuIHRoYXQ7CiAgICAgICAgfTsKICAgICAgICByZWRlZmluZUFsbChDLnByb3RvdHlwZSwgewogICAgICAgICAgJ2RlbGV0ZSc6IGZ1bmN0aW9uIF9kZWxldGUoa2V5KSB7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IGdldEludGVybmFsU3RhdGUodGhpcyk7CiAgICAgICAgICAgIGlmICghaXNPYmplY3Qoa2V5KSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB2YXIgZGF0YSA9IGdldFdlYWtEYXRhKGtleSk7CiAgICAgICAgICAgIGlmIChkYXRhID09PSB0cnVlKQogICAgICAgICAgICByZXR1cm4gdW5jYXVnaHRGcm96ZW5TdG9yZShzdGF0ZSlbJ2RlbGV0ZSddKGtleSk7CiAgICAgICAgICAgIHJldHVybiBkYXRhICYmICRoYXMoZGF0YSwgc3RhdGUuaWQpICYmIGRlbGV0ZSBkYXRhW3N0YXRlLmlkXTsKICAgICAgICAgIH0sCiAgICAgICAgICBoYXM6IGZ1bmN0aW9uIGhhcyhrZXkpIHsKICAgICAgICAgICAgdmFyIHN0YXRlID0gZ2V0SW50ZXJuYWxTdGF0ZSh0aGlzKTsKICAgICAgICAgICAgaWYgKCFpc09iamVjdChrZXkpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHZhciBkYXRhID0gZ2V0V2Vha0RhdGEoa2V5KTsKICAgICAgICAgICAgaWYgKGRhdGEgPT09IHRydWUpCiAgICAgICAgICAgIHJldHVybiB1bmNhdWdodEZyb3plblN0b3JlKHN0YXRlKS5oYXMoa2V5KTsKICAgICAgICAgICAgcmV0dXJuIGRhdGEgJiYgJGhhcyhkYXRhLCBzdGF0ZS5pZCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmVkZWZpbmVBbGwoQy5wcm90b3R5cGUsIElTX01BUCA/IHsKICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KGtleSkgewogICAgICAgICAgICB2YXIgc3RhdGUgPSBnZXRJbnRlcm5hbFN0YXRlKHRoaXMpOwogICAgICAgICAgICBpZiAoaXNPYmplY3Qoa2V5KSkgewogICAgICAgICAgICAgIHZhciBkYXRhID0gZ2V0V2Vha0RhdGEoa2V5KTsKICAgICAgICAgICAgICBpZiAoZGF0YSA9PT0gdHJ1ZSkKICAgICAgICAgICAgICByZXR1cm4gdW5jYXVnaHRGcm96ZW5TdG9yZShzdGF0ZSkuZ2V0KGtleSk7CiAgICAgICAgICAgICAgcmV0dXJuIGRhdGEgPyBkYXRhW3N0YXRlLmlkXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgIHNldDogZnVuY3Rpb24gc2V0KGtleSwgdmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuIGRlZmluZSh0aGlzLCBrZXksIHZhbHVlKTsKICAgICAgICAgIH0KICAgICAgICB9IDogewogICAgICAgICAgYWRkOiBmdW5jdGlvbiBhZGQodmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuIGRlZmluZSh0aGlzLCB2YWx1ZSwgdHJ1ZSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIEM7CiAgICAgIH0KICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDE0OCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBiaW5kID0gX193X3BkZmpzX3JlcXVpcmVfXyg1OCk7CiAgICB2YXIgSW5kZXhlZE9iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTMpOwogICAgdmFyIHRvT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXyg3OSk7CiAgICB2YXIgdG9MZW5ndGggPSBfX3dfcGRmanNfcmVxdWlyZV9fKDQyKTsKICAgIHZhciBhcnJheVNwZWNpZXNDcmVhdGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE0OSk7CiAgICB2YXIgcHVzaCA9IFtdLnB1c2g7CiAgICB2YXIgY3JlYXRlTWV0aG9kID0gZnVuY3Rpb24gY3JlYXRlTWV0aG9kKFRZUEUpIHsKICAgICAgdmFyIElTX01BUCA9IFRZUEUgPT0gMTsKICAgICAgdmFyIElTX0ZJTFRFUiA9IFRZUEUgPT0gMjsKICAgICAgdmFyIElTX1NPTUUgPSBUWVBFID09IDM7CiAgICAgIHZhciBJU19FVkVSWSA9IFRZUEUgPT0gNDsKICAgICAgdmFyIElTX0ZJTkRfSU5ERVggPSBUWVBFID09IDY7CiAgICAgIHZhciBOT19IT0xFUyA9IFRZUEUgPT0gNSB8fCBJU19GSU5EX0lOREVYOwogICAgICByZXR1cm4gZnVuY3Rpb24gKCR0aGlzLCBjYWxsYmFja2ZuLCB0aGF0LCBzcGVjaWZpY0NyZWF0ZSkgewogICAgICAgIHZhciBPID0gdG9PYmplY3QoJHRoaXMpOwogICAgICAgIHZhciBzZWxmID0gSW5kZXhlZE9iamVjdChPKTsKICAgICAgICB2YXIgYm91bmRGdW5jdGlvbiA9IGJpbmQoY2FsbGJhY2tmbiwgdGhhdCwgMyk7CiAgICAgICAgdmFyIGxlbmd0aCA9IHRvTGVuZ3RoKHNlbGYubGVuZ3RoKTsKICAgICAgICB2YXIgaW5kZXggPSAwOwogICAgICAgIHZhciBjcmVhdGUgPSBzcGVjaWZpY0NyZWF0ZSB8fCBhcnJheVNwZWNpZXNDcmVhdGU7CiAgICAgICAgdmFyIHRhcmdldCA9IElTX01BUCA/IGNyZWF0ZSgkdGhpcywgbGVuZ3RoKSA6IElTX0ZJTFRFUiA/IGNyZWF0ZSgkdGhpcywgMCkgOiB1bmRlZmluZWQ7CiAgICAgICAgdmFyIHZhbHVlLCByZXN1bHQ7CiAgICAgICAgZm9yICg7IGxlbmd0aCA+IGluZGV4OyBpbmRleCsrKQogICAgICAgIGlmIChOT19IT0xFUyB8fCBpbmRleCBpbiBzZWxmKSB7CiAgICAgICAgICB2YWx1ZSA9IHNlbGZbaW5kZXhdOwogICAgICAgICAgcmVzdWx0ID0gYm91bmRGdW5jdGlvbih2YWx1ZSwgaW5kZXgsIE8pOwogICAgICAgICAgaWYgKFRZUEUpIHsKICAgICAgICAgICAgaWYgKElTX01BUCkKICAgICAgICAgICAgdGFyZ2V0W2luZGV4XSA9IHJlc3VsdDtlbHNlCiAgICAgICAgICAgIGlmIChyZXN1bHQpCiAgICAgICAgICAgIHN3aXRjaCAoVFlQRSkgewogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICByZXR1cm4gaW5kZXg7CiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgcHVzaC5jYWxsKHRhcmdldCwgdmFsdWUpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgaWYgKElTX0VWRVJZKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBJU19GSU5EX0lOREVYID8gLTEgOiBJU19TT01FIHx8IElTX0VWRVJZID8gSVNfRVZFUlkgOiB0YXJnZXQ7CiAgICAgIH07CiAgICB9OwogICAgbW9kdWxlLmV4cG9ydHMgPSB7CiAgICAgIGZvckVhY2g6IGNyZWF0ZU1ldGhvZCgwKSwKICAgICAgbWFwOiBjcmVhdGVNZXRob2QoMSksCiAgICAgIGZpbHRlcjogY3JlYXRlTWV0aG9kKDIpLAogICAgICBzb21lOiBjcmVhdGVNZXRob2QoMyksCiAgICAgIGV2ZXJ5OiBjcmVhdGVNZXRob2QoNCksCiAgICAgIGZpbmQ6IGNyZWF0ZU1ldGhvZCg1KSwKICAgICAgZmluZEluZGV4OiBjcmVhdGVNZXRob2QoNikKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDE0OSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBpc09iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTcpOwogICAgdmFyIGlzQXJyYXkgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE1MCk7CiAgICB2YXIgd2VsbEtub3duU3ltYm9sID0gX193X3BkZmpzX3JlcXVpcmVfXyg1Myk7CiAgICB2YXIgU1BFQ0lFUyA9IHdlbGxLbm93blN5bWJvbCgnc3BlY2llcycpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAob3JpZ2luYWxBcnJheSwgbGVuZ3RoKSB7CiAgICAgIHZhciBDOwogICAgICBpZiAoaXNBcnJheShvcmlnaW5hbEFycmF5KSkgewogICAgICAgIEMgPSBvcmlnaW5hbEFycmF5LmNvbnN0cnVjdG9yOwogICAgICAgIGlmICh0eXBlb2YgQyA9PSAnZnVuY3Rpb24nICYmIChDID09PSBBcnJheSB8fCBpc0FycmF5KEMucHJvdG90eXBlKSkpCiAgICAgICAgQyA9IHVuZGVmaW5lZDtlbHNlCiAgICAgICAgaWYgKGlzT2JqZWN0KEMpKSB7CiAgICAgICAgICBDID0gQ1tTUEVDSUVTXTsKICAgICAgICAgIGlmIChDID09PSBudWxsKQogICAgICAgICAgQyA9IHVuZGVmaW5lZDsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIG5ldyAoQyA9PT0gdW5kZWZpbmVkID8gQXJyYXkgOiBDKShsZW5ndGggPT09IDAgPyAwIDogbGVuZ3RoKTsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDE1MCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBjbGFzc29mID0gX193X3BkZmpzX3JlcXVpcmVfXygxNCk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IEFycmF5LmlzQXJyYXkgfHwgZnVuY3Rpb24gaXNBcnJheShhcmcpIHsKICAgICAgcmV0dXJuIGNsYXNzb2YoYXJnKSA9PSAnQXJyYXknOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogMTUxICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgX193X3BkZmpzX3JlcXVpcmVfXygxMDUpOwogICAgX193X3BkZmpzX3JlcXVpcmVfXygxNTIpOwogICAgX193X3BkZmpzX3JlcXVpcmVfXygxMDcpOwogICAgdmFyIHBhdGggPSBfX3dfcGRmanNfcmVxdWlyZV9fKDM4KTsKICAgIG1vZHVsZS5leHBvcnRzID0gcGF0aC5XZWFrU2V0OwoKICAgIC8qKiovfSksICgKICAvKiAxNTIgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGNvbGxlY3Rpb24gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEzOCk7CiAgICB2YXIgY29sbGVjdGlvbldlYWsgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE0Nyk7CiAgICBjb2xsZWN0aW9uKCdXZWFrU2V0JywgZnVuY3Rpb24gKGluaXQpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uIFdlYWtTZXQoKSB7CiAgICAgICAgcmV0dXJuIGluaXQodGhpcywgYXJndW1lbnRzLmxlbmd0aCA/IGFyZ3VtZW50c1swXSA6IHVuZGVmaW5lZCk7CiAgICAgIH07CiAgICB9LCBjb2xsZWN0aW9uV2Vhayk7CgogICAgLyoqKi99KSwgKAogIC8qIDE1MyAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIF9fd19wZGZqc19yZXF1aXJlX18oMTU0KTsKICAgIHZhciBlbnRyeVVuYmluZCA9IF9fd19wZGZqc19yZXF1aXJlX18oNTcpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBlbnRyeVVuYmluZCgnU3RyaW5nJywgJ2NvZGVQb2ludEF0Jyk7CgogICAgLyoqKi99KSwgKAogIC8qIDE1NCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgJCA9IF9fd19wZGZqc19yZXF1aXJlX18oNSk7CiAgICB2YXIgY29kZUF0ID0gX193X3BkZmpzX3JlcXVpcmVfXyg3NCkuY29kZUF0OwogICAgJCh7CiAgICAgIHRhcmdldDogJ1N0cmluZycsCiAgICAgIHByb3RvOiB0cnVlCiAgICB9LCB7CiAgICAgIGNvZGVQb2ludEF0OiBmdW5jdGlvbiBjb2RlUG9pbnRBdChwb3MpIHsKICAgICAgICByZXR1cm4gY29kZUF0KHRoaXMsIHBvcyk7CiAgICAgIH0KICAgIH0pOwoKICAgIC8qKiovfSksICgKICAvKiAxNTUgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDE1Nik7CiAgICB2YXIgcGF0aCA9IF9fd19wZGZqc19yZXF1aXJlX18oMzgpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBwYXRoLlN0cmluZy5mcm9tQ29kZVBvaW50OwoKICAgIC8qKiovfSksICgKICAvKiAxNTYgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgJCA9IF9fd19wZGZqc19yZXF1aXJlX18oNSk7CiAgICB2YXIgdG9BYnNvbHV0ZUluZGV4ID0gX193X3BkZmpzX3JlcXVpcmVfXyg0NCk7CiAgICB2YXIgZnJvbUNoYXJDb2RlID0gU3RyaW5nLmZyb21DaGFyQ29kZTsKICAgIHZhciBuYXRpdmVGcm9tQ29kZVBvaW50ID0gU3RyaW5nLmZyb21Db2RlUG9pbnQ7CiAgICB2YXIgSU5DT1JSRUNUX0xFTkdUSCA9ICEhbmF0aXZlRnJvbUNvZGVQb2ludCAmJiBuYXRpdmVGcm9tQ29kZVBvaW50Lmxlbmd0aCAhPSAxOwogICAgJCh7CiAgICAgIHRhcmdldDogJ1N0cmluZycsCiAgICAgIHN0YXQ6IHRydWUsCiAgICAgIGZvcmNlZDogSU5DT1JSRUNUX0xFTkdUSAogICAgfSwgewogICAgICBmcm9tQ29kZVBvaW50OiBmdW5jdGlvbiBmcm9tQ29kZVBvaW50KHgpIHsKICAgICAgICB2YXIgZWxlbWVudHMgPSBbXTsKICAgICAgICB2YXIgbGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aDsKICAgICAgICB2YXIgaSA9IDA7CiAgICAgICAgdmFyIGNvZGU7CiAgICAgICAgd2hpbGUgKGxlbmd0aCA+IGkpIHsKICAgICAgICAgIGNvZGUgPSArYXJndW1lbnRzW2krK107CiAgICAgICAgICBpZiAodG9BYnNvbHV0ZUluZGV4KGNvZGUsIDB4MTBGRkZGKSAhPT0gY29kZSkKICAgICAgICAgIHRocm93IFJhbmdlRXJyb3IoY29kZSArICcgaXMgbm90IGEgdmFsaWQgY29kZSBwb2ludCcpOwogICAgICAgICAgZWxlbWVudHMucHVzaChjb2RlIDwgMHgxMDAwMCA/IGZyb21DaGFyQ29kZShjb2RlKSA6IGZyb21DaGFyQ29kZSgoKGNvZGUgLT0gMHgxMDAwMCkgPj4gMTApICsgMHhEODAwLCBjb2RlICUgMHg0MDAgKyAweERDMDApKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGVsZW1lbnRzLmpvaW4oJycpOwogICAgICB9CiAgICB9KTsKCiAgICAvKioqL30pLCAoCiAgLyogMTU3ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgX193X3BkZmpzX3JlcXVpcmVfXygxNTgpOwogICAgX193X3BkZmpzX3JlcXVpcmVfXygxMDUpOwogICAgX193X3BkZmpzX3JlcXVpcmVfXygxNjApOwogICAgX193X3BkZmpzX3JlcXVpcmVfXygxNjQpOwogICAgX193X3BkZmpzX3JlcXVpcmVfXygxNjUpOwogICAgX193X3BkZmpzX3JlcXVpcmVfXygxNjYpOwogICAgX193X3BkZmpzX3JlcXVpcmVfXygxNjcpOwogICAgX193X3BkZmpzX3JlcXVpcmVfXygxNjgpOwogICAgX193X3BkZmpzX3JlcXVpcmVfXygxNjkpOwogICAgX193X3BkZmpzX3JlcXVpcmVfXygxNzApOwogICAgX193X3BkZmpzX3JlcXVpcmVfXygxNzEpOwogICAgX193X3BkZmpzX3JlcXVpcmVfXygxNzIpOwogICAgX193X3BkZmpzX3JlcXVpcmVfXygxNzMpOwogICAgX193X3BkZmpzX3JlcXVpcmVfXygxNzQpOwogICAgX193X3BkZmpzX3JlcXVpcmVfXygxNzUpOwogICAgX193X3BkZmpzX3JlcXVpcmVfXygxNzYpOwogICAgX193X3BkZmpzX3JlcXVpcmVfXygxNzcpOwogICAgX193X3BkZmpzX3JlcXVpcmVfXygxNzgpOwogICAgX193X3BkZmpzX3JlcXVpcmVfXygxNzkpOwogICAgdmFyIHBhdGggPSBfX3dfcGRmanNfcmVxdWlyZV9fKDM4KTsKICAgIG1vZHVsZS5leHBvcnRzID0gcGF0aC5TeW1ib2w7CgogICAgLyoqKi99KSwgKAogIC8qIDE1OCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgJCA9IF9fd19wZGZqc19yZXF1aXJlX18oNSk7CiAgICB2YXIgZmFpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDkpOwogICAgdmFyIGlzQXJyYXkgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE1MCk7CiAgICB2YXIgaXNPYmplY3QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE3KTsKICAgIHZhciB0b09iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oNzkpOwogICAgdmFyIHRvTGVuZ3RoID0gX193X3BkZmpzX3JlcXVpcmVfXyg0Mik7CiAgICB2YXIgY3JlYXRlUHJvcGVydHkgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDg5KTsKICAgIHZhciBhcnJheVNwZWNpZXNDcmVhdGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE0OSk7CiAgICB2YXIgYXJyYXlNZXRob2RIYXNTcGVjaWVzU3VwcG9ydCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTU5KTsKICAgIHZhciB3ZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUzKTsKICAgIHZhciBWOF9WRVJTSU9OID0gX193X3BkZmpzX3JlcXVpcmVfXygxMjUpOwogICAgdmFyIElTX0NPTkNBVF9TUFJFQURBQkxFID0gd2VsbEtub3duU3ltYm9sKCdpc0NvbmNhdFNwcmVhZGFibGUnKTsKICAgIHZhciBNQVhfU0FGRV9JTlRFR0VSID0gMHgxRkZGRkZGRkZGRkZGRjsKICAgIHZhciBNQVhJTVVNX0FMTE9XRURfSU5ERVhfRVhDRUVERUQgPSAnTWF4aW11bSBhbGxvd2VkIGluZGV4IGV4Y2VlZGVkJzsKICAgIHZhciBJU19DT05DQVRfU1BSRUFEQUJMRV9TVVBQT1JUID0gVjhfVkVSU0lPTiA+PSA1MSB8fCAhZmFpbHMoZnVuY3Rpb24gKCkgewogICAgICB2YXIgYXJyYXkgPSBbXTsKICAgICAgYXJyYXlbSVNfQ09OQ0FUX1NQUkVBREFCTEVdID0gZmFsc2U7CiAgICAgIHJldHVybiBhcnJheS5jb25jYXQoKVswXSAhPT0gYXJyYXk7CiAgICB9KTsKICAgIHZhciBTUEVDSUVTX1NVUFBPUlQgPSBhcnJheU1ldGhvZEhhc1NwZWNpZXNTdXBwb3J0KCdjb25jYXQnKTsKICAgIHZhciBpc0NvbmNhdFNwcmVhZGFibGUgPSBmdW5jdGlvbiBpc0NvbmNhdFNwcmVhZGFibGUoTykgewogICAgICBpZiAoIWlzT2JqZWN0KE8pKQogICAgICByZXR1cm4gZmFsc2U7CiAgICAgIHZhciBzcHJlYWRhYmxlID0gT1tJU19DT05DQVRfU1BSRUFEQUJMRV07CiAgICAgIHJldHVybiBzcHJlYWRhYmxlICE9PSB1bmRlZmluZWQgPyAhIXNwcmVhZGFibGUgOiBpc0FycmF5KE8pOwogICAgfTsKICAgIHZhciBGT1JDRUQgPSAhSVNfQ09OQ0FUX1NQUkVBREFCTEVfU1VQUE9SVCB8fCAhU1BFQ0lFU19TVVBQT1JUOwogICAgJCh7CiAgICAgIHRhcmdldDogJ0FycmF5JywKICAgICAgcHJvdG86IHRydWUsCiAgICAgIGZvcmNlZDogRk9SQ0VECiAgICB9LCB7CiAgICAgIGNvbmNhdDogZnVuY3Rpb24gY29uY2F0KGFyZykgewogICAgICAgIHZhciBPID0gdG9PYmplY3QodGhpcyk7CiAgICAgICAgdmFyIEEgPSBhcnJheVNwZWNpZXNDcmVhdGUoTywgMCk7CiAgICAgICAgdmFyIG4gPSAwOwogICAgICAgIHZhciBpLCBrLCBsZW5ndGgsIGxlbiwgRTsKICAgICAgICBmb3IgKGkgPSAtMSwgbGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBFID0gaSA9PT0gLTEgPyBPIDogYXJndW1lbnRzW2ldOwogICAgICAgICAgaWYgKGlzQ29uY2F0U3ByZWFkYWJsZShFKSkgewogICAgICAgICAgICBsZW4gPSB0b0xlbmd0aChFLmxlbmd0aCk7CiAgICAgICAgICAgIGlmIChuICsgbGVuID4gTUFYX1NBRkVfSU5URUdFUikKICAgICAgICAgICAgdGhyb3cgVHlwZUVycm9yKE1BWElNVU1fQUxMT1dFRF9JTkRFWF9FWENFRURFRCk7CiAgICAgICAgICAgIGZvciAoayA9IDA7IGsgPCBsZW47IGsrKywgbisrKQogICAgICAgICAgICBpZiAoayBpbiBFKQogICAgICAgICAgICBjcmVhdGVQcm9wZXJ0eShBLCBuLCBFW2tdKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChuID49IE1BWF9TQUZFX0lOVEVHRVIpCiAgICAgICAgICAgIHRocm93IFR5cGVFcnJvcihNQVhJTVVNX0FMTE9XRURfSU5ERVhfRVhDRUVERUQpOwogICAgICAgICAgICBjcmVhdGVQcm9wZXJ0eShBLCBuKyssIEUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBBLmxlbmd0aCA9IG47CiAgICAgICAgcmV0dXJuIEE7CiAgICAgIH0KICAgIH0pOwoKICAgIC8qKiovfSksICgKICAvKiAxNTkgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgZmFpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDkpOwogICAgdmFyIHdlbGxLbm93blN5bWJvbCA9IF9fd19wZGZqc19yZXF1aXJlX18oNTMpOwogICAgdmFyIFY4X1ZFUlNJT04gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEyNSk7CiAgICB2YXIgU1BFQ0lFUyA9IHdlbGxLbm93blN5bWJvbCgnc3BlY2llcycpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoTUVUSE9EX05BTUUpIHsKICAgICAgcmV0dXJuIFY4X1ZFUlNJT04gPj0gNTEgfHwgIWZhaWxzKGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgYXJyYXkgPSBbXTsKICAgICAgICB2YXIgY29uc3RydWN0b3IgPSBhcnJheS5jb25zdHJ1Y3RvciA9IHt9OwogICAgICAgIGNvbnN0cnVjdG9yW1NQRUNJRVNdID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIHsgZm9vOiAxIH07CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gYXJyYXlbTUVUSE9EX05BTUVdKEJvb2xlYW4pLmZvbyAhPT0gMTsKICAgICAgfSk7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAxNjAgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyICQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUpOwogICAgdmFyIGdsb2JhbCA9IF9fd19wZGZqc19yZXF1aXJlX18oNik7CiAgICB2YXIgZ2V0QnVpbHRJbiA9IF9fd19wZGZqc19yZXF1aXJlX18oMzcpOwogICAgdmFyIElTX1BVUkUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDMyKTsKICAgIHZhciBERVNDUklQVE9SUyA9IF9fd19wZGZqc19yZXF1aXJlX18oOCk7CiAgICB2YXIgTkFUSVZFX1NZTUJPTCA9IF9fd19wZGZqc19yZXF1aXJlX18oNTQpOwogICAgdmFyIFVTRV9TWU1CT0xfQVNfVUlEID0gX193X3BkZmpzX3JlcXVpcmVfXyg1NSk7CiAgICB2YXIgZmFpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDkpOwogICAgdmFyIGhhcyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTgpOwogICAgdmFyIGlzQXJyYXkgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE1MCk7CiAgICB2YXIgaXNPYmplY3QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE3KTsKICAgIHZhciBhbk9iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oMjMpOwogICAgdmFyIHRvT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXyg3OSk7CiAgICB2YXIgdG9JbmRleGVkT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygxMik7CiAgICB2YXIgdG9QcmltaXRpdmUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE2KTsKICAgIHZhciBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDExKTsKICAgIHZhciBuYXRpdmVPYmplY3RDcmVhdGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDY3KTsKICAgIHZhciBvYmplY3RLZXlzID0gX193X3BkZmpzX3JlcXVpcmVfXyg2OSk7CiAgICB2YXIgZ2V0T3duUHJvcGVydHlOYW1lc01vZHVsZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMzkpOwogICAgdmFyIGdldE93blByb3BlcnR5TmFtZXNFeHRlcm5hbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTYxKTsKICAgIHZhciBnZXRPd25Qcm9wZXJ0eVN5bWJvbHNNb2R1bGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDQ2KTsKICAgIHZhciBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JNb2R1bGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDcpOwogICAgdmFyIGRlZmluZVByb3BlcnR5TW9kdWxlID0gX193X3BkZmpzX3JlcXVpcmVfXygyMik7CiAgICB2YXIgcHJvcGVydHlJc0VudW1lcmFibGVNb2R1bGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEwKTsKICAgIHZhciBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIxKTsKICAgIHZhciByZWRlZmluZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjQpOwogICAgdmFyIHNoYXJlZCA9IF9fd19wZGZqc19yZXF1aXJlX18oMzEpOwogICAgdmFyIHNoYXJlZEtleSA9IF9fd19wZGZqc19yZXF1aXJlX18oMzApOwogICAgdmFyIGhpZGRlbktleXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDM0KTsKICAgIHZhciB1aWQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDMzKTsKICAgIHZhciB3ZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUzKTsKICAgIHZhciB3cmFwcGVkV2VsbEtub3duU3ltYm9sTW9kdWxlID0gX193X3BkZmpzX3JlcXVpcmVfXygxNjIpOwogICAgdmFyIGRlZmluZVdlbGxLbm93blN5bWJvbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTYzKTsKICAgIHZhciBzZXRUb1N0cmluZ1RhZyA9IF9fd19wZGZqc19yZXF1aXJlX18oODEpOwogICAgdmFyIEludGVybmFsU3RhdGVNb2R1bGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDI4KTsKICAgIHZhciAkZm9yRWFjaCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTQ4KS5mb3JFYWNoOwogICAgdmFyIEhJRERFTiA9IHNoYXJlZEtleSgnaGlkZGVuJyk7CiAgICB2YXIgU1lNQk9MID0gJ1N5bWJvbCc7CiAgICB2YXIgUFJPVE9UWVBFID0gJ3Byb3RvdHlwZSc7CiAgICB2YXIgVE9fUFJJTUlUSVZFID0gd2VsbEtub3duU3ltYm9sKCd0b1ByaW1pdGl2ZScpOwogICAgdmFyIHNldEludGVybmFsU3RhdGUgPSBJbnRlcm5hbFN0YXRlTW9kdWxlLnNldDsKICAgIHZhciBnZXRJbnRlcm5hbFN0YXRlID0gSW50ZXJuYWxTdGF0ZU1vZHVsZS5nZXR0ZXJGb3IoU1lNQk9MKTsKICAgIHZhciBPYmplY3RQcm90b3R5cGUgPSBPYmplY3RbUFJPVE9UWVBFXTsKICAgIHZhciAkU3ltYm9sID0gZ2xvYmFsLlN5bWJvbDsKICAgIHZhciAkc3RyaW5naWZ5ID0gZ2V0QnVpbHRJbignSlNPTicsICdzdHJpbmdpZnknKTsKICAgIHZhciBuYXRpdmVHZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JNb2R1bGUuZjsKICAgIHZhciBuYXRpdmVEZWZpbmVQcm9wZXJ0eSA9IGRlZmluZVByb3BlcnR5TW9kdWxlLmY7CiAgICB2YXIgbmF0aXZlR2V0T3duUHJvcGVydHlOYW1lcyA9IGdldE93blByb3BlcnR5TmFtZXNFeHRlcm5hbC5mOwogICAgdmFyIG5hdGl2ZVByb3BlcnR5SXNFbnVtZXJhYmxlID0gcHJvcGVydHlJc0VudW1lcmFibGVNb2R1bGUuZjsKICAgIHZhciBBbGxTeW1ib2xzID0gc2hhcmVkKCdzeW1ib2xzJyk7CiAgICB2YXIgT2JqZWN0UHJvdG90eXBlU3ltYm9scyA9IHNoYXJlZCgnb3Atc3ltYm9scycpOwogICAgdmFyIFN0cmluZ1RvU3ltYm9sUmVnaXN0cnkgPSBzaGFyZWQoJ3N0cmluZy10by1zeW1ib2wtcmVnaXN0cnknKTsKICAgIHZhciBTeW1ib2xUb1N0cmluZ1JlZ2lzdHJ5ID0gc2hhcmVkKCdzeW1ib2wtdG8tc3RyaW5nLXJlZ2lzdHJ5Jyk7CiAgICB2YXIgV2VsbEtub3duU3ltYm9sc1N0b3JlID0gc2hhcmVkKCd3a3MnKTsKICAgIHZhciBRT2JqZWN0ID0gZ2xvYmFsLlFPYmplY3Q7CiAgICB2YXIgVVNFX1NFVFRFUiA9ICFRT2JqZWN0IHx8ICFRT2JqZWN0W1BST1RPVFlQRV0gfHwgIVFPYmplY3RbUFJPVE9UWVBFXS5maW5kQ2hpbGQ7CiAgICB2YXIgc2V0U3ltYm9sRGVzY3JpcHRvciA9IERFU0NSSVBUT1JTICYmIGZhaWxzKGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIG5hdGl2ZU9iamVjdENyZWF0ZShuYXRpdmVEZWZpbmVQcm9wZXJ0eSh7fSwgJ2EnLCB7CiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICByZXR1cm4gbmF0aXZlRGVmaW5lUHJvcGVydHkodGhpcywgJ2EnLCB7IHZhbHVlOiA3IH0pLmE7CiAgICAgICAgfQogICAgICB9KSkuYSAhPSA3OwogICAgfSkgPyBmdW5jdGlvbiAoTywgUCwgQXR0cmlidXRlcykgewogICAgICB2YXIgT2JqZWN0UHJvdG90eXBlRGVzY3JpcHRvciA9IG5hdGl2ZUdldE93blByb3BlcnR5RGVzY3JpcHRvcihPYmplY3RQcm90b3R5cGUsIFApOwogICAgICBpZiAoT2JqZWN0UHJvdG90eXBlRGVzY3JpcHRvcikKICAgICAgZGVsZXRlIE9iamVjdFByb3RvdHlwZVtQXTsKICAgICAgbmF0aXZlRGVmaW5lUHJvcGVydHkoTywgUCwgQXR0cmlidXRlcyk7CiAgICAgIGlmIChPYmplY3RQcm90b3R5cGVEZXNjcmlwdG9yICYmIE8gIT09IE9iamVjdFByb3RvdHlwZSkgewogICAgICAgIG5hdGl2ZURlZmluZVByb3BlcnR5KE9iamVjdFByb3RvdHlwZSwgUCwgT2JqZWN0UHJvdG90eXBlRGVzY3JpcHRvcik7CiAgICAgIH0KICAgIH0gOiBuYXRpdmVEZWZpbmVQcm9wZXJ0eTsKICAgIHZhciB3cmFwID0gZnVuY3Rpb24gd3JhcCh0YWcsIGRlc2NyaXB0aW9uKSB7CiAgICAgIHZhciBzeW1ib2wgPSBBbGxTeW1ib2xzW3RhZ10gPSBuYXRpdmVPYmplY3RDcmVhdGUoJFN5bWJvbFtQUk9UT1RZUEVdKTsKICAgICAgc2V0SW50ZXJuYWxTdGF0ZShzeW1ib2wsIHsKICAgICAgICB0eXBlOiBTWU1CT0wsCiAgICAgICAgdGFnOiB0YWcsCiAgICAgICAgZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uCiAgICAgIH0pOwogICAgICBpZiAoIURFU0NSSVBUT1JTKQogICAgICBzeW1ib2wuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjsKICAgICAgcmV0dXJuIHN5bWJvbDsKICAgIH07CiAgICB2YXIgaXNTeW1ib2wgPSBVU0VfU1lNQk9MX0FTX1VJRCA/IGZ1bmN0aW9uIChpdCkgewogICAgICByZXR1cm4gdHlwZW9mIGl0ID09ICdzeW1ib2wnOwogICAgfSA6IGZ1bmN0aW9uIChpdCkgewogICAgICByZXR1cm4gT2JqZWN0KGl0KSBpbnN0YW5jZW9mICRTeW1ib2w7CiAgICB9OwogICAgdmFyICRkZWZpbmVQcm9wZXJ0eSA9IGZ1bmN0aW9uIGRlZmluZVByb3BlcnR5KE8sIFAsIEF0dHJpYnV0ZXMpIHsKICAgICAgaWYgKE8gPT09IE9iamVjdFByb3RvdHlwZSkKICAgICAgJGRlZmluZVByb3BlcnR5KE9iamVjdFByb3RvdHlwZVN5bWJvbHMsIFAsIEF0dHJpYnV0ZXMpOwogICAgICBhbk9iamVjdChPKTsKICAgICAgdmFyIGtleSA9IHRvUHJpbWl0aXZlKFAsIHRydWUpOwogICAgICBhbk9iamVjdChBdHRyaWJ1dGVzKTsKICAgICAgaWYgKGhhcyhBbGxTeW1ib2xzLCBrZXkpKSB7CiAgICAgICAgaWYgKCFBdHRyaWJ1dGVzLmVudW1lcmFibGUpIHsKICAgICAgICAgIGlmICghaGFzKE8sIEhJRERFTikpCiAgICAgICAgICBuYXRpdmVEZWZpbmVQcm9wZXJ0eShPLCBISURERU4sIGNyZWF0ZVByb3BlcnR5RGVzY3JpcHRvcigxLCB7fSkpOwogICAgICAgICAgT1tISURERU5dW2tleV0gPSB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoaGFzKE8sIEhJRERFTikgJiYgT1tISURERU5dW2tleV0pCiAgICAgICAgICBPW0hJRERFTl1ba2V5XSA9IGZhbHNlOwogICAgICAgICAgQXR0cmlidXRlcyA9IG5hdGl2ZU9iamVjdENyZWF0ZShBdHRyaWJ1dGVzLCB7IGVudW1lcmFibGU6IGNyZWF0ZVByb3BlcnR5RGVzY3JpcHRvcigwLCBmYWxzZSkgfSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzZXRTeW1ib2xEZXNjcmlwdG9yKE8sIGtleSwgQXR0cmlidXRlcyk7CiAgICAgIH0KICAgICAgcmV0dXJuIG5hdGl2ZURlZmluZVByb3BlcnR5KE8sIGtleSwgQXR0cmlidXRlcyk7CiAgICB9OwogICAgdmFyICRkZWZpbmVQcm9wZXJ0aWVzID0gZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyhPLCBQcm9wZXJ0aWVzKSB7CiAgICAgIGFuT2JqZWN0KE8pOwogICAgICB2YXIgcHJvcGVydGllcyA9IHRvSW5kZXhlZE9iamVjdChQcm9wZXJ0aWVzKTsKICAgICAgdmFyIGtleXMgPSBvYmplY3RLZXlzKHByb3BlcnRpZXMpLmNvbmNhdCgkZ2V0T3duUHJvcGVydHlTeW1ib2xzKHByb3BlcnRpZXMpKTsKICAgICAgJGZvckVhY2goa2V5cywgZnVuY3Rpb24gKGtleSkgewogICAgICAgIGlmICghREVTQ1JJUFRPUlMgfHwgJHByb3BlcnR5SXNFbnVtZXJhYmxlLmNhbGwocHJvcGVydGllcywga2V5KSkKICAgICAgICAkZGVmaW5lUHJvcGVydHkoTywga2V5LCBwcm9wZXJ0aWVzW2tleV0pOwogICAgICB9KTsKICAgICAgcmV0dXJuIE87CiAgICB9OwogICAgdmFyICRjcmVhdGUgPSBmdW5jdGlvbiBjcmVhdGUoTywgUHJvcGVydGllcykgewogICAgICByZXR1cm4gUHJvcGVydGllcyA9PT0gdW5kZWZpbmVkID8gbmF0aXZlT2JqZWN0Q3JlYXRlKE8pIDogJGRlZmluZVByb3BlcnRpZXMobmF0aXZlT2JqZWN0Q3JlYXRlKE8pLCBQcm9wZXJ0aWVzKTsKICAgIH07CiAgICB2YXIgJHByb3BlcnR5SXNFbnVtZXJhYmxlID0gZnVuY3Rpb24gcHJvcGVydHlJc0VudW1lcmFibGUoVikgewogICAgICB2YXIgUCA9IHRvUHJpbWl0aXZlKFYsIHRydWUpOwogICAgICB2YXIgZW51bWVyYWJsZSA9IG5hdGl2ZVByb3BlcnR5SXNFbnVtZXJhYmxlLmNhbGwodGhpcywgUCk7CiAgICAgIGlmICh0aGlzID09PSBPYmplY3RQcm90b3R5cGUgJiYgaGFzKEFsbFN5bWJvbHMsIFApICYmICFoYXMoT2JqZWN0UHJvdG90eXBlU3ltYm9scywgUCkpCiAgICAgIHJldHVybiBmYWxzZTsKICAgICAgcmV0dXJuIGVudW1lcmFibGUgfHwgIWhhcyh0aGlzLCBQKSB8fCAhaGFzKEFsbFN5bWJvbHMsIFApIHx8IGhhcyh0aGlzLCBISURERU4pICYmIHRoaXNbSElEREVOXVtQXSA/IGVudW1lcmFibGUgOiB0cnVlOwogICAgfTsKICAgIHZhciAkZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0gZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE8sIFApIHsKICAgICAgdmFyIGl0ID0gdG9JbmRleGVkT2JqZWN0KE8pOwogICAgICB2YXIga2V5ID0gdG9QcmltaXRpdmUoUCwgdHJ1ZSk7CiAgICAgIGlmIChpdCA9PT0gT2JqZWN0UHJvdG90eXBlICYmIGhhcyhBbGxTeW1ib2xzLCBrZXkpICYmICFoYXMoT2JqZWN0UHJvdG90eXBlU3ltYm9scywga2V5KSkKICAgICAgcmV0dXJuOwogICAgICB2YXIgZGVzY3JpcHRvciA9IG5hdGl2ZUdldE93blByb3BlcnR5RGVzY3JpcHRvcihpdCwga2V5KTsKICAgICAgaWYgKGRlc2NyaXB0b3IgJiYgaGFzKEFsbFN5bWJvbHMsIGtleSkgJiYgIShoYXMoaXQsIEhJRERFTikgJiYgaXRbSElEREVOXVtrZXldKSkgewogICAgICAgIGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IHRydWU7CiAgICAgIH0KICAgICAgcmV0dXJuIGRlc2NyaXB0b3I7CiAgICB9OwogICAgdmFyICRnZXRPd25Qcm9wZXJ0eU5hbWVzID0gZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlOYW1lcyhPKSB7CiAgICAgIHZhciBuYW1lcyA9IG5hdGl2ZUdldE93blByb3BlcnR5TmFtZXModG9JbmRleGVkT2JqZWN0KE8pKTsKICAgICAgdmFyIHJlc3VsdCA9IFtdOwogICAgICAkZm9yRWFjaChuYW1lcywgZnVuY3Rpb24gKGtleSkgewogICAgICAgIGlmICghaGFzKEFsbFN5bWJvbHMsIGtleSkgJiYgIWhhcyhoaWRkZW5LZXlzLCBrZXkpKQogICAgICAgIHJlc3VsdC5wdXNoKGtleSk7CiAgICAgIH0pOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfTsKICAgIHZhciAkZ2V0T3duUHJvcGVydHlTeW1ib2xzID0gZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlTeW1ib2xzKE8pIHsKICAgICAgdmFyIElTX09CSkVDVF9QUk9UT1RZUEUgPSBPID09PSBPYmplY3RQcm90b3R5cGU7CiAgICAgIHZhciBuYW1lcyA9IG5hdGl2ZUdldE93blByb3BlcnR5TmFtZXMoSVNfT0JKRUNUX1BST1RPVFlQRSA/IE9iamVjdFByb3RvdHlwZVN5bWJvbHMgOiB0b0luZGV4ZWRPYmplY3QoTykpOwogICAgICB2YXIgcmVzdWx0ID0gW107CiAgICAgICRmb3JFYWNoKG5hbWVzLCBmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgaWYgKGhhcyhBbGxTeW1ib2xzLCBrZXkpICYmICghSVNfT0JKRUNUX1BST1RPVFlQRSB8fCBoYXMoT2JqZWN0UHJvdG90eXBlLCBrZXkpKSkgewogICAgICAgICAgcmVzdWx0LnB1c2goQWxsU3ltYm9sc1trZXldKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfTsKICAgIGlmICghTkFUSVZFX1NZTUJPTCkgewogICAgICAkU3ltYm9sID0gZnVuY3Rpb24gU3ltYm9sKCkgewogICAgICAgIGlmICh0aGlzIGluc3RhbmNlb2YgJFN5bWJvbCkKICAgICAgICB0aHJvdyBUeXBlRXJyb3IoJ1N5bWJvbCBpcyBub3QgYSBjb25zdHJ1Y3RvcicpOwogICAgICAgIHZhciBkZXNjcmlwdGlvbiA9ICFhcmd1bWVudHMubGVuZ3RoIHx8IGFyZ3VtZW50c1swXSA9PT0gdW5kZWZpbmVkID8gdW5kZWZpbmVkIDogU3RyaW5nKGFyZ3VtZW50c1swXSk7CiAgICAgICAgdmFyIHRhZyA9IHVpZChkZXNjcmlwdGlvbik7CiAgICAgICAgdmFyIF9zZXR0ZXIgPSBmdW5jdGlvbiBzZXR0ZXIodmFsdWUpIHsKICAgICAgICAgIGlmICh0aGlzID09PSBPYmplY3RQcm90b3R5cGUpCiAgICAgICAgICBfc2V0dGVyLmNhbGwoT2JqZWN0UHJvdG90eXBlU3ltYm9scywgdmFsdWUpOwogICAgICAgICAgaWYgKGhhcyh0aGlzLCBISURERU4pICYmIGhhcyh0aGlzW0hJRERFTl0sIHRhZykpCiAgICAgICAgICB0aGlzW0hJRERFTl1bdGFnXSA9IGZhbHNlOwogICAgICAgICAgc2V0U3ltYm9sRGVzY3JpcHRvcih0aGlzLCB0YWcsIGNyZWF0ZVByb3BlcnR5RGVzY3JpcHRvcigxLCB2YWx1ZSkpOwogICAgICAgIH07CiAgICAgICAgaWYgKERFU0NSSVBUT1JTICYmIFVTRV9TRVRURVIpCiAgICAgICAgc2V0U3ltYm9sRGVzY3JpcHRvcihPYmplY3RQcm90b3R5cGUsIHRhZywgewogICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICAgICAgc2V0OiBfc2V0dGVyCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHdyYXAodGFnLCBkZXNjcmlwdGlvbik7CiAgICAgIH07CiAgICAgIHJlZGVmaW5lKCRTeW1ib2xbUFJPVE9UWVBFXSwgJ3RvU3RyaW5nJywgZnVuY3Rpb24gdG9TdHJpbmcoKSB7CiAgICAgICAgcmV0dXJuIGdldEludGVybmFsU3RhdGUodGhpcykudGFnOwogICAgICB9KTsKICAgICAgcmVkZWZpbmUoJFN5bWJvbCwgJ3dpdGhvdXRTZXR0ZXInLCBmdW5jdGlvbiAoZGVzY3JpcHRpb24pIHsKICAgICAgICByZXR1cm4gd3JhcCh1aWQoZGVzY3JpcHRpb24pLCBkZXNjcmlwdGlvbik7CiAgICAgIH0pOwogICAgICBwcm9wZXJ0eUlzRW51bWVyYWJsZU1vZHVsZS5mID0gJHByb3BlcnR5SXNFbnVtZXJhYmxlOwogICAgICBkZWZpbmVQcm9wZXJ0eU1vZHVsZS5mID0gJGRlZmluZVByb3BlcnR5OwogICAgICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JNb2R1bGUuZiA9ICRnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7CiAgICAgIGdldE93blByb3BlcnR5TmFtZXNNb2R1bGUuZiA9IGdldE93blByb3BlcnR5TmFtZXNFeHRlcm5hbC5mID0gJGdldE93blByb3BlcnR5TmFtZXM7CiAgICAgIGdldE93blByb3BlcnR5U3ltYm9sc01vZHVsZS5mID0gJGdldE93blByb3BlcnR5U3ltYm9sczsKICAgICAgd3JhcHBlZFdlbGxLbm93blN5bWJvbE1vZHVsZS5mID0gZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICByZXR1cm4gd3JhcCh3ZWxsS25vd25TeW1ib2wobmFtZSksIG5hbWUpOwogICAgICB9OwogICAgICBpZiAoREVTQ1JJUFRPUlMpIHsKICAgICAgICBuYXRpdmVEZWZpbmVQcm9wZXJ0eSgkU3ltYm9sW1BST1RPVFlQRV0sICdkZXNjcmlwdGlvbicsIHsKICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgICAgIGdldDogZnVuY3Rpb24gZGVzY3JpcHRpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBnZXRJbnRlcm5hbFN0YXRlKHRoaXMpLmRlc2NyaXB0aW9uOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGlmICghSVNfUFVSRSkgewogICAgICAgICAgcmVkZWZpbmUoT2JqZWN0UHJvdG90eXBlLCAncHJvcGVydHlJc0VudW1lcmFibGUnLCAkcHJvcGVydHlJc0VudW1lcmFibGUsIHsgdW5zYWZlOiB0cnVlIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgJCh7CiAgICAgIGdsb2JhbDogdHJ1ZSwKICAgICAgd3JhcDogdHJ1ZSwKICAgICAgZm9yY2VkOiAhTkFUSVZFX1NZTUJPTCwKICAgICAgc2hhbTogIU5BVElWRV9TWU1CT0wKICAgIH0sIHsgU3ltYm9sOiAkU3ltYm9sIH0pOwogICAgJGZvckVhY2gob2JqZWN0S2V5cyhXZWxsS25vd25TeW1ib2xzU3RvcmUpLCBmdW5jdGlvbiAobmFtZSkgewogICAgICBkZWZpbmVXZWxsS25vd25TeW1ib2wobmFtZSk7CiAgICB9KTsKICAgICQoewogICAgICB0YXJnZXQ6IFNZTUJPTCwKICAgICAgc3RhdDogdHJ1ZSwKICAgICAgZm9yY2VkOiAhTkFUSVZFX1NZTUJPTAogICAgfSwgewogICAgICAnZm9yJzogZnVuY3Rpb24gX2ZvcihrZXkpIHsKICAgICAgICB2YXIgc3RyaW5nID0gU3RyaW5nKGtleSk7CiAgICAgICAgaWYgKGhhcyhTdHJpbmdUb1N5bWJvbFJlZ2lzdHJ5LCBzdHJpbmcpKQogICAgICAgIHJldHVybiBTdHJpbmdUb1N5bWJvbFJlZ2lzdHJ5W3N0cmluZ107CiAgICAgICAgdmFyIHN5bWJvbCA9ICRTeW1ib2woc3RyaW5nKTsKICAgICAgICBTdHJpbmdUb1N5bWJvbFJlZ2lzdHJ5W3N0cmluZ10gPSBzeW1ib2w7CiAgICAgICAgU3ltYm9sVG9TdHJpbmdSZWdpc3RyeVtzeW1ib2xdID0gc3RyaW5nOwogICAgICAgIHJldHVybiBzeW1ib2w7CiAgICAgIH0sCiAgICAgIGtleUZvcjogZnVuY3Rpb24ga2V5Rm9yKHN5bSkgewogICAgICAgIGlmICghaXNTeW1ib2woc3ltKSkKICAgICAgICB0aHJvdyBUeXBlRXJyb3Ioc3ltICsgJyBpcyBub3QgYSBzeW1ib2wnKTsKICAgICAgICBpZiAoaGFzKFN5bWJvbFRvU3RyaW5nUmVnaXN0cnksIHN5bSkpCiAgICAgICAgcmV0dXJuIFN5bWJvbFRvU3RyaW5nUmVnaXN0cnlbc3ltXTsKICAgICAgfSwKICAgICAgdXNlU2V0dGVyOiBmdW5jdGlvbiB1c2VTZXR0ZXIoKSB7CiAgICAgICAgVVNFX1NFVFRFUiA9IHRydWU7CiAgICAgIH0sCiAgICAgIHVzZVNpbXBsZTogZnVuY3Rpb24gdXNlU2ltcGxlKCkgewogICAgICAgIFVTRV9TRVRURVIgPSBmYWxzZTsKICAgICAgfQogICAgfSk7CiAgICAkKHsKICAgICAgdGFyZ2V0OiAnT2JqZWN0JywKICAgICAgc3RhdDogdHJ1ZSwKICAgICAgZm9yY2VkOiAhTkFUSVZFX1NZTUJPTCwKICAgICAgc2hhbTogIURFU0NSSVBUT1JTCiAgICB9LCB7CiAgICAgIGNyZWF0ZTogJGNyZWF0ZSwKICAgICAgZGVmaW5lUHJvcGVydHk6ICRkZWZpbmVQcm9wZXJ0eSwKICAgICAgZGVmaW5lUHJvcGVydGllczogJGRlZmluZVByb3BlcnRpZXMsCiAgICAgIGdldE93blByb3BlcnR5RGVzY3JpcHRvcjogJGdldE93blByb3BlcnR5RGVzY3JpcHRvcgogICAgfSk7CiAgICAkKHsKICAgICAgdGFyZ2V0OiAnT2JqZWN0JywKICAgICAgc3RhdDogdHJ1ZSwKICAgICAgZm9yY2VkOiAhTkFUSVZFX1NZTUJPTAogICAgfSwgewogICAgICBnZXRPd25Qcm9wZXJ0eU5hbWVzOiAkZ2V0T3duUHJvcGVydHlOYW1lcywKICAgICAgZ2V0T3duUHJvcGVydHlTeW1ib2xzOiAkZ2V0T3duUHJvcGVydHlTeW1ib2xzCiAgICB9KTsKICAgICQoewogICAgICB0YXJnZXQ6ICdPYmplY3QnLAogICAgICBzdGF0OiB0cnVlLAogICAgICBmb3JjZWQ6IGZhaWxzKGZ1bmN0aW9uICgpIHsKICAgICAgICBnZXRPd25Qcm9wZXJ0eVN5bWJvbHNNb2R1bGUuZigxKTsKICAgICAgfSkKICAgIH0sIHsKICAgICAgZ2V0T3duUHJvcGVydHlTeW1ib2xzOiBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eVN5bWJvbHMoaXQpIHsKICAgICAgICByZXR1cm4gZ2V0T3duUHJvcGVydHlTeW1ib2xzTW9kdWxlLmYodG9PYmplY3QoaXQpKTsKICAgICAgfQogICAgfSk7CiAgICBpZiAoJHN0cmluZ2lmeSkgewogICAgICB2YXIgRk9SQ0VEX0pTT05fU1RSSU5HSUZZID0gIU5BVElWRV9TWU1CT0wgfHwgZmFpbHMoZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBzeW1ib2wgPSAkU3ltYm9sKCk7CiAgICAgICAgcmV0dXJuICRzdHJpbmdpZnkoW3N5bWJvbF0pICE9ICdbbnVsbF0nIHx8ICRzdHJpbmdpZnkoeyBhOiBzeW1ib2wgfSkgIT0gJ3t9JyB8fCAkc3RyaW5naWZ5KE9iamVjdChzeW1ib2wpKSAhPSAne30nOwogICAgICB9KTsKICAgICAgJCh7CiAgICAgICAgdGFyZ2V0OiAnSlNPTicsCiAgICAgICAgc3RhdDogdHJ1ZSwKICAgICAgICBmb3JjZWQ6IEZPUkNFRF9KU09OX1NUUklOR0lGWQogICAgICB9LCB7CiAgICAgICAgc3RyaW5naWZ5OiBmdW5jdGlvbiBzdHJpbmdpZnkoaXQsIHJlcGxhY2VyLCBzcGFjZSkgewogICAgICAgICAgdmFyIGFyZ3MgPSBbaXRdOwogICAgICAgICAgdmFyIGluZGV4ID0gMTsKICAgICAgICAgIHZhciAkcmVwbGFjZXI7CiAgICAgICAgICB3aGlsZSAoYXJndW1lbnRzLmxlbmd0aCA+IGluZGV4KQogICAgICAgICAgYXJncy5wdXNoKGFyZ3VtZW50c1tpbmRleCsrXSk7CiAgICAgICAgICAkcmVwbGFjZXIgPSByZXBsYWNlcjsKICAgICAgICAgIGlmICghaXNPYmplY3QocmVwbGFjZXIpICYmIGl0ID09PSB1bmRlZmluZWQgfHwgaXNTeW1ib2woaXQpKQogICAgICAgICAgcmV0dXJuOwogICAgICAgICAgaWYgKCFpc0FycmF5KHJlcGxhY2VyKSkKICAgICAgICAgIHJlcGxhY2VyID0gZnVuY3Rpb24gcmVwbGFjZXIoa2V5LCB2YWx1ZSkgewogICAgICAgICAgICBpZiAodHlwZW9mICRyZXBsYWNlciA9PSAnZnVuY3Rpb24nKQogICAgICAgICAgICB2YWx1ZSA9ICRyZXBsYWNlci5jYWxsKHRoaXMsIGtleSwgdmFsdWUpOwogICAgICAgICAgICBpZiAoIWlzU3ltYm9sKHZhbHVlKSkKICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgfTsKICAgICAgICAgIGFyZ3NbMV0gPSByZXBsYWNlcjsKICAgICAgICAgIHJldHVybiAkc3RyaW5naWZ5LmFwcGx5KG51bGwsIGFyZ3MpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICBpZiAoISRTeW1ib2xbUFJPVE9UWVBFXVtUT19QUklNSVRJVkVdKSB7CiAgICAgIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSgkU3ltYm9sW1BST1RPVFlQRV0sIFRPX1BSSU1JVElWRSwgJFN5bWJvbFtQUk9UT1RZUEVdLnZhbHVlT2YpOwogICAgfQogICAgc2V0VG9TdHJpbmdUYWcoJFN5bWJvbCwgU1lNQk9MKTsKICAgIGhpZGRlbktleXNbSElEREVOXSA9IHRydWU7CgogICAgLyoqKi99KSwgKAogIC8qIDE2MSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciB0b0luZGV4ZWRPYmplY3QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEyKTsKICAgIHZhciBuYXRpdmVHZXRPd25Qcm9wZXJ0eU5hbWVzID0gX193X3BkZmpzX3JlcXVpcmVfXygzOSkuZjsKICAgIHZhciB0b1N0cmluZyA9IHt9LnRvU3RyaW5nOwogICAgdmFyIHdpbmRvd05hbWVzID0gdHlwZW9mIHdpbmRvdyA9PSAnb2JqZWN0JyAmJiB3aW5kb3cgJiYgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh3aW5kb3cpIDogW107CiAgICB2YXIgZ2V0V2luZG93TmFtZXMgPSBmdW5jdGlvbiBnZXRXaW5kb3dOYW1lcyhpdCkgewogICAgICB0cnkgewogICAgICAgIHJldHVybiBuYXRpdmVHZXRPd25Qcm9wZXJ0eU5hbWVzKGl0KTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICByZXR1cm4gd2luZG93TmFtZXMuc2xpY2UoKTsKICAgICAgfQogICAgfTsKICAgIG1vZHVsZS5leHBvcnRzLmYgPSBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eU5hbWVzKGl0KSB7CiAgICAgIHJldHVybiB3aW5kb3dOYW1lcyAmJiB0b1N0cmluZy5jYWxsKGl0KSA9PSAnW29iamVjdCBXaW5kb3ddJyA/IGdldFdpbmRvd05hbWVzKGl0KSA6IG5hdGl2ZUdldE93blByb3BlcnR5TmFtZXModG9JbmRleGVkT2JqZWN0KGl0KSk7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAxNjIgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgd2VsbEtub3duU3ltYm9sID0gX193X3BkZmpzX3JlcXVpcmVfXyg1Myk7CiAgICBleHBvcnRzLmYgPSB3ZWxsS25vd25TeW1ib2w7CgogICAgLyoqKi99KSwgKAogIC8qIDE2MyAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBwYXRoID0gX193X3BkZmpzX3JlcXVpcmVfXygzOCk7CiAgICB2YXIgaGFzID0gX193X3BkZmpzX3JlcXVpcmVfXygxOCk7CiAgICB2YXIgd3JhcHBlZFdlbGxLbm93blN5bWJvbE1vZHVsZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTYyKTsKICAgIHZhciBkZWZpbmVQcm9wZXJ0eSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjIpLmY7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChOQU1FKSB7CiAgICAgIHZhciBTeW1ib2wgPSBwYXRoLlN5bWJvbCB8fCAocGF0aC5TeW1ib2wgPSB7fSk7CiAgICAgIGlmICghaGFzKFN5bWJvbCwgTkFNRSkpCiAgICAgIGRlZmluZVByb3BlcnR5KFN5bWJvbCwgTkFNRSwgeyB2YWx1ZTogd3JhcHBlZFdlbGxLbm93blN5bWJvbE1vZHVsZS5mKE5BTUUpIH0pOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogMTY0ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGRlZmluZVdlbGxLbm93blN5bWJvbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTYzKTsKICAgIGRlZmluZVdlbGxLbm93blN5bWJvbCgnYXN5bmNJdGVyYXRvcicpOwoKICAgIC8qKiovfSksICgKICAvKiAxNjUgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyICQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUpOwogICAgdmFyIERFU0NSSVBUT1JTID0gX193X3BkZmpzX3JlcXVpcmVfXyg4KTsKICAgIHZhciBnbG9iYWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDYpOwogICAgdmFyIGhhcyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTgpOwogICAgdmFyIGlzT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygxNyk7CiAgICB2YXIgZGVmaW5lUHJvcGVydHkgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIyKS5mOwogICAgdmFyIGNvcHlDb25zdHJ1Y3RvclByb3BlcnRpZXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDM1KTsKICAgIHZhciBOYXRpdmVTeW1ib2wgPSBnbG9iYWwuU3ltYm9sOwogICAgaWYgKERFU0NSSVBUT1JTICYmIHR5cGVvZiBOYXRpdmVTeW1ib2wgPT0gJ2Z1bmN0aW9uJyAmJiAoISgnZGVzY3JpcHRpb24nIGluIE5hdGl2ZVN5bWJvbC5wcm90b3R5cGUpIHx8IE5hdGl2ZVN5bWJvbCgpLmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQpKSB7CiAgICAgIHZhciBFbXB0eVN0cmluZ0Rlc2NyaXB0aW9uU3RvcmUgPSB7fTsKICAgICAgdmFyIFN5bWJvbFdyYXBwZXIgPSBmdW5jdGlvbiBTeW1ib2woKSB7CiAgICAgICAgdmFyIGRlc2NyaXB0aW9uID0gYXJndW1lbnRzLmxlbmd0aCA8IDEgfHwgYXJndW1lbnRzWzBdID09PSB1bmRlZmluZWQgPyB1bmRlZmluZWQgOiBTdHJpbmcoYXJndW1lbnRzWzBdKTsKICAgICAgICB2YXIgcmVzdWx0ID0gdGhpcyBpbnN0YW5jZW9mIFN5bWJvbFdyYXBwZXIgPyBuZXcgTmF0aXZlU3ltYm9sKGRlc2NyaXB0aW9uKSA6IGRlc2NyaXB0aW9uID09PSB1bmRlZmluZWQgPyBOYXRpdmVTeW1ib2woKSA6IE5hdGl2ZVN5bWJvbChkZXNjcmlwdGlvbik7CiAgICAgICAgaWYgKGRlc2NyaXB0aW9uID09PSAnJykKICAgICAgICBFbXB0eVN0cmluZ0Rlc2NyaXB0aW9uU3RvcmVbcmVzdWx0XSA9IHRydWU7CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfTsKICAgICAgY29weUNvbnN0cnVjdG9yUHJvcGVydGllcyhTeW1ib2xXcmFwcGVyLCBOYXRpdmVTeW1ib2wpOwogICAgICB2YXIgc3ltYm9sUHJvdG90eXBlID0gU3ltYm9sV3JhcHBlci5wcm90b3R5cGUgPSBOYXRpdmVTeW1ib2wucHJvdG90eXBlOwogICAgICBzeW1ib2xQcm90b3R5cGUuY29uc3RydWN0b3IgPSBTeW1ib2xXcmFwcGVyOwogICAgICB2YXIgc3ltYm9sVG9TdHJpbmcgPSBzeW1ib2xQcm90b3R5cGUudG9TdHJpbmc7CiAgICAgIHZhciBuYXRpdmUgPSBTdHJpbmcoTmF0aXZlU3ltYm9sKCd0ZXN0JykpID09ICdTeW1ib2wodGVzdCknOwogICAgICB2YXIgcmVnZXhwID0gL15TeW1ib2xcKCguKilcKVteKV0rJC87CiAgICAgIGRlZmluZVByb3BlcnR5KHN5bWJvbFByb3RvdHlwZSwgJ2Rlc2NyaXB0aW9uJywgewogICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGRlc2NyaXB0aW9uKCkgewogICAgICAgICAgdmFyIHN5bWJvbCA9IGlzT2JqZWN0KHRoaXMpID8gdGhpcy52YWx1ZU9mKCkgOiB0aGlzOwogICAgICAgICAgdmFyIHN0cmluZyA9IHN5bWJvbFRvU3RyaW5nLmNhbGwoc3ltYm9sKTsKICAgICAgICAgIGlmIChoYXMoRW1wdHlTdHJpbmdEZXNjcmlwdGlvblN0b3JlLCBzeW1ib2wpKQogICAgICAgICAgcmV0dXJuICcnOwogICAgICAgICAgdmFyIGRlc2MgPSBuYXRpdmUgPyBzdHJpbmcuc2xpY2UoNywgLTEpIDogc3RyaW5nLnJlcGxhY2UocmVnZXhwLCAnJDEnKTsKICAgICAgICAgIHJldHVybiBkZXNjID09PSAnJyA/IHVuZGVmaW5lZCA6IGRlc2M7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgJCh7CiAgICAgICAgZ2xvYmFsOiB0cnVlLAogICAgICAgIGZvcmNlZDogdHJ1ZQogICAgICB9LCB7IFN5bWJvbDogU3ltYm9sV3JhcHBlciB9KTsKICAgIH0KCiAgICAvKioqL30pLCAoCiAgLyogMTY2ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGRlZmluZVdlbGxLbm93blN5bWJvbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTYzKTsKICAgIGRlZmluZVdlbGxLbm93blN5bWJvbCgnaGFzSW5zdGFuY2UnKTsKCiAgICAvKioqL30pLCAoCiAgLyogMTY3ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGRlZmluZVdlbGxLbm93blN5bWJvbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTYzKTsKICAgIGRlZmluZVdlbGxLbm93blN5bWJvbCgnaXNDb25jYXRTcHJlYWRhYmxlJyk7CgogICAgLyoqKi99KSwgKAogIC8qIDE2OCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBkZWZpbmVXZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE2Myk7CiAgICBkZWZpbmVXZWxsS25vd25TeW1ib2woJ2l0ZXJhdG9yJyk7CgogICAgLyoqKi99KSwgKAogIC8qIDE2OSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBkZWZpbmVXZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE2Myk7CiAgICBkZWZpbmVXZWxsS25vd25TeW1ib2woJ21hdGNoJyk7CgogICAgLyoqKi99KSwgKAogIC8qIDE3MCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBkZWZpbmVXZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE2Myk7CiAgICBkZWZpbmVXZWxsS25vd25TeW1ib2woJ21hdGNoQWxsJyk7CgogICAgLyoqKi99KSwgKAogIC8qIDE3MSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBkZWZpbmVXZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE2Myk7CiAgICBkZWZpbmVXZWxsS25vd25TeW1ib2woJ3JlcGxhY2UnKTsKCiAgICAvKioqL30pLCAoCiAgLyogMTcyICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGRlZmluZVdlbGxLbm93blN5bWJvbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTYzKTsKICAgIGRlZmluZVdlbGxLbm93blN5bWJvbCgnc2VhcmNoJyk7CgogICAgLyoqKi99KSwgKAogIC8qIDE3MyAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBkZWZpbmVXZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE2Myk7CiAgICBkZWZpbmVXZWxsS25vd25TeW1ib2woJ3NwZWNpZXMnKTsKCiAgICAvKioqL30pLCAoCiAgLyogMTc0ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGRlZmluZVdlbGxLbm93blN5bWJvbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTYzKTsKICAgIGRlZmluZVdlbGxLbm93blN5bWJvbCgnc3BsaXQnKTsKCiAgICAvKioqL30pLCAoCiAgLyogMTc1ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGRlZmluZVdlbGxLbm93blN5bWJvbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTYzKTsKICAgIGRlZmluZVdlbGxLbm93blN5bWJvbCgndG9QcmltaXRpdmUnKTsKCiAgICAvKioqL30pLCAoCiAgLyogMTc2ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGRlZmluZVdlbGxLbm93blN5bWJvbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTYzKTsKICAgIGRlZmluZVdlbGxLbm93blN5bWJvbCgndG9TdHJpbmdUYWcnKTsKCiAgICAvKioqL30pLCAoCiAgLyogMTc3ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGRlZmluZVdlbGxLbm93blN5bWJvbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTYzKTsKICAgIGRlZmluZVdlbGxLbm93blN5bWJvbCgndW5zY29wYWJsZXMnKTsKCiAgICAvKioqL30pLCAoCiAgLyogMTc4ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIHNldFRvU3RyaW5nVGFnID0gX193X3BkZmpzX3JlcXVpcmVfXyg4MSk7CiAgICBzZXRUb1N0cmluZ1RhZyhNYXRoLCAnTWF0aCcsIHRydWUpOwoKICAgIC8qKiovfSksICgKICAvKiAxNzkgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgZ2xvYmFsID0gX193X3BkZmpzX3JlcXVpcmVfXyg2KTsKICAgIHZhciBzZXRUb1N0cmluZ1RhZyA9IF9fd19wZGZqc19yZXF1aXJlX18oODEpOwogICAgc2V0VG9TdHJpbmdUYWcoZ2xvYmFsLkpTT04sICdKU09OJywgdHJ1ZSk7CgogICAgLyoqKi99KSwgKAogIC8qIDE4MCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIF9fd19wZGZqc19yZXF1aXJlX18oMTgxKTsKICAgIHZhciBlbnRyeVVuYmluZCA9IF9fd19wZGZqc19yZXF1aXJlX18oNTcpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBlbnRyeVVuYmluZCgnU3RyaW5nJywgJ3BhZFN0YXJ0Jyk7CgogICAgLyoqKi99KSwgKAogIC8qIDE4MSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgJCA9IF9fd19wZGZqc19yZXF1aXJlX18oNSk7CiAgICB2YXIgJHBhZFN0YXJ0ID0gX193X3BkZmpzX3JlcXVpcmVfXygxODIpLnN0YXJ0OwogICAgdmFyIFdFQktJVF9CVUcgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE4NCk7CiAgICAkKHsKICAgICAgdGFyZ2V0OiAnU3RyaW5nJywKICAgICAgcHJvdG86IHRydWUsCiAgICAgIGZvcmNlZDogV0VCS0lUX0JVRwogICAgfSwgewogICAgICBwYWRTdGFydDogZnVuY3Rpb24gcGFkU3RhcnQobWF4TGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuICRwYWRTdGFydCh0aGlzLCBtYXhMZW5ndGgsIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkKTsKICAgICAgfQogICAgfSk7CgogICAgLyoqKi99KSwgKAogIC8qIDE4MiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciB0b0xlbmd0aCA9IF9fd19wZGZqc19yZXF1aXJlX18oNDIpOwogICAgdmFyIHJlcGVhdCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTgzKTsKICAgIHZhciByZXF1aXJlT2JqZWN0Q29lcmNpYmxlID0gX193X3BkZmpzX3JlcXVpcmVfXygxNSk7CiAgICB2YXIgY2VpbCA9IE1hdGguY2VpbDsKICAgIHZhciBjcmVhdGVNZXRob2QgPSBmdW5jdGlvbiBjcmVhdGVNZXRob2QoSVNfRU5EKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoJHRoaXMsIG1heExlbmd0aCwgZmlsbFN0cmluZykgewogICAgICAgIHZhciBTID0gU3RyaW5nKHJlcXVpcmVPYmplY3RDb2VyY2libGUoJHRoaXMpKTsKICAgICAgICB2YXIgc3RyaW5nTGVuZ3RoID0gUy5sZW5ndGg7CiAgICAgICAgdmFyIGZpbGxTdHIgPSBmaWxsU3RyaW5nID09PSB1bmRlZmluZWQgPyAnICcgOiBTdHJpbmcoZmlsbFN0cmluZyk7CiAgICAgICAgdmFyIGludE1heExlbmd0aCA9IHRvTGVuZ3RoKG1heExlbmd0aCk7CiAgICAgICAgdmFyIGZpbGxMZW4sIHN0cmluZ0ZpbGxlcjsKICAgICAgICBpZiAoaW50TWF4TGVuZ3RoIDw9IHN0cmluZ0xlbmd0aCB8fCBmaWxsU3RyID09ICcnKQogICAgICAgIHJldHVybiBTOwogICAgICAgIGZpbGxMZW4gPSBpbnRNYXhMZW5ndGggLSBzdHJpbmdMZW5ndGg7CiAgICAgICAgc3RyaW5nRmlsbGVyID0gcmVwZWF0LmNhbGwoZmlsbFN0ciwgY2VpbChmaWxsTGVuIC8gZmlsbFN0ci5sZW5ndGgpKTsKICAgICAgICBpZiAoc3RyaW5nRmlsbGVyLmxlbmd0aCA+IGZpbGxMZW4pCiAgICAgICAgc3RyaW5nRmlsbGVyID0gc3RyaW5nRmlsbGVyLnNsaWNlKDAsIGZpbGxMZW4pOwogICAgICAgIHJldHVybiBJU19FTkQgPyBTICsgc3RyaW5nRmlsbGVyIDogc3RyaW5nRmlsbGVyICsgUzsKICAgICAgfTsKICAgIH07CiAgICBtb2R1bGUuZXhwb3J0cyA9IHsKICAgICAgc3RhcnQ6IGNyZWF0ZU1ldGhvZChmYWxzZSksCiAgICAgIGVuZDogY3JlYXRlTWV0aG9kKHRydWUpCiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAxODMgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIHRvSW50ZWdlciA9IF9fd19wZGZqc19yZXF1aXJlX18oNDMpOwogICAgdmFyIHJlcXVpcmVPYmplY3RDb2VyY2libGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE1KTsKICAgIG1vZHVsZS5leHBvcnRzID0gJycucmVwZWF0IHx8IGZ1bmN0aW9uIHJlcGVhdChjb3VudCkgewogICAgICB2YXIgc3RyID0gU3RyaW5nKHJlcXVpcmVPYmplY3RDb2VyY2libGUodGhpcykpOwogICAgICB2YXIgcmVzdWx0ID0gJyc7CiAgICAgIHZhciBuID0gdG9JbnRlZ2VyKGNvdW50KTsKICAgICAgaWYgKG4gPCAwIHx8IG4gPT0gSW5maW5pdHkpCiAgICAgIHRocm93IFJhbmdlRXJyb3IoJ1dyb25nIG51bWJlciBvZiByZXBldGl0aW9ucycpOwogICAgICBmb3IgKDsgbiA+IDA7IChuID4+Pj0gMSkgJiYgKHN0ciArPSBzdHIpKQogICAgICBpZiAobiAmIDEpCiAgICAgIHJlc3VsdCArPSBzdHI7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAxODQgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgdXNlckFnZW50ID0gX193X3BkZmpzX3JlcXVpcmVfXygxMTkpOwogICAgbW9kdWxlLmV4cG9ydHMgPSAvVmVyc2lvblwvMTBcLlxkKyhcLlxkKyk/KCBNb2JpbGVcL1x3Kyk/IFNhZmFyaVwvLy50ZXN0KHVzZXJBZ2VudCk7CgogICAgLyoqKi99KSwgKAogIC8qIDE4NSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIF9fd19wZGZqc19yZXF1aXJlX18oMTg2KTsKICAgIHZhciBlbnRyeVVuYmluZCA9IF9fd19wZGZqc19yZXF1aXJlX18oNTcpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBlbnRyeVVuYmluZCgnU3RyaW5nJywgJ3BhZEVuZCcpOwoKICAgIC8qKiovfSksICgKICAvKiAxODYgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyICQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUpOwogICAgdmFyICRwYWRFbmQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE4MikuZW5kOwogICAgdmFyIFdFQktJVF9CVUcgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE4NCk7CiAgICAkKHsKICAgICAgdGFyZ2V0OiAnU3RyaW5nJywKICAgICAgcHJvdG86IHRydWUsCiAgICAgIGZvcmNlZDogV0VCS0lUX0JVRwogICAgfSwgewogICAgICBwYWRFbmQ6IGZ1bmN0aW9uIHBhZEVuZChtYXhMZW5ndGgpIHsKICAgICAgICByZXR1cm4gJHBhZEVuZCh0aGlzLCBtYXhMZW5ndGgsIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkKTsKICAgICAgfQogICAgfSk7CgogICAgLyoqKi99KSwgKAogIC8qIDE4NyAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIF9fd19wZGZqc19yZXF1aXJlX18oMTg4KTsKICAgIHZhciBwYXRoID0gX193X3BkZmpzX3JlcXVpcmVfXygzOCk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IHBhdGguT2JqZWN0LnZhbHVlczsKCiAgICAvKioqL30pLCAoCiAgLyogMTg4ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyICQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUpOwogICAgdmFyICR2YWx1ZXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE4OSkudmFsdWVzOwogICAgJCh7CiAgICAgIHRhcmdldDogJ09iamVjdCcsCiAgICAgIHN0YXQ6IHRydWUKICAgIH0sIHsKICAgICAgdmFsdWVzOiBmdW5jdGlvbiB2YWx1ZXMoTykgewogICAgICAgIHJldHVybiAkdmFsdWVzKE8pOwogICAgICB9CiAgICB9KTsKCiAgICAvKioqL30pLCAoCiAgLyogMTg5ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIERFU0NSSVBUT1JTID0gX193X3BkZmpzX3JlcXVpcmVfXyg4KTsKICAgIHZhciBvYmplY3RLZXlzID0gX193X3BkZmpzX3JlcXVpcmVfXyg2OSk7CiAgICB2YXIgdG9JbmRleGVkT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygxMik7CiAgICB2YXIgcHJvcGVydHlJc0VudW1lcmFibGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEwKS5mOwogICAgdmFyIGNyZWF0ZU1ldGhvZCA9IGZ1bmN0aW9uIGNyZWF0ZU1ldGhvZChUT19FTlRSSUVTKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoaXQpIHsKICAgICAgICB2YXIgTyA9IHRvSW5kZXhlZE9iamVjdChpdCk7CiAgICAgICAgdmFyIGtleXMgPSBvYmplY3RLZXlzKE8pOwogICAgICAgIHZhciBsZW5ndGggPSBrZXlzLmxlbmd0aDsKICAgICAgICB2YXIgaSA9IDA7CiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOwogICAgICAgIHZhciBrZXk7CiAgICAgICAgd2hpbGUgKGxlbmd0aCA+IGkpIHsKICAgICAgICAgIGtleSA9IGtleXNbaSsrXTsKICAgICAgICAgIGlmICghREVTQ1JJUFRPUlMgfHwgcHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChPLCBrZXkpKSB7CiAgICAgICAgICAgIHJlc3VsdC5wdXNoKFRPX0VOVFJJRVMgPyBbCiAgICAgICAgICAgIGtleSwKICAgICAgICAgICAgT1trZXldXSA6CiAgICAgICAgICAgIE9ba2V5XSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH07CiAgICB9OwogICAgbW9kdWxlLmV4cG9ydHMgPSB7CiAgICAgIGVudHJpZXM6IGNyZWF0ZU1ldGhvZCh0cnVlKSwKICAgICAgdmFsdWVzOiBjcmVhdGVNZXRob2QoZmFsc2UpCiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAxOTAgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgoKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgICAgdmFsdWU6IHRydWUKICAgIH0pOwogICAgZXhwb3J0cy5nZXREb2N1bWVudCA9IGdldERvY3VtZW50OwogICAgZXhwb3J0cy5zZXRQREZOZXR3b3JrU3RyZWFtRmFjdG9yeSA9IHNldFBERk5ldHdvcmtTdHJlYW1GYWN0b3J5OwogICAgZXhwb3J0cy5idWlsZCA9IGV4cG9ydHMudmVyc2lvbiA9IGV4cG9ydHMuUERGUGFnZVByb3h5ID0gZXhwb3J0cy5QREZEb2N1bWVudFByb3h5ID0gZXhwb3J0cy5QREZXb3JrZXIgPSBleHBvcnRzLlBERkRhdGFSYW5nZVRyYW5zcG9ydCA9IGV4cG9ydHMuTG9vcGJhY2tQb3J0ID0gdm9pZCAwOwoKICAgIHZhciBfcmVnZW5lcmF0b3IgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9fd19wZGZqc19yZXF1aXJlX18oMTkxKSk7CgogICAgdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygxKTsKCiAgICB2YXIgX2Rpc3BsYXlfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE5NCk7CgogICAgdmFyIF9mb250X2xvYWRlciA9IF9fd19wZGZqc19yZXF1aXJlX18oMTk1KTsKCiAgICB2YXIgX2FwaV9jb21wYXRpYmlsaXR5ID0gX193X3BkZmpzX3JlcXVpcmVfXygxOTYpOwoKICAgIHZhciBfY2FudmFzID0gX193X3BkZmpzX3JlcXVpcmVfXygxOTcpOwoKICAgIHZhciBfd29ya2VyX29wdGlvbnMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE5OSk7CgogICAgdmFyIF9pc19ub2RlID0gX193X3BkZmpzX3JlcXVpcmVfXyg0OCk7CgogICAgdmFyIF9tZXNzYWdlX2hhbmRsZXIgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIwMCk7CgogICAgdmFyIF9tZXRhZGF0YSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjAxKTsKCiAgICB2YXIgX3RyYW5zcG9ydF9zdHJlYW0gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIwMyk7CgogICAgdmFyIF93ZWJnbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMjA0KTsKCiAgICBmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikge3JldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICJkZWZhdWx0Ijogb2JqIH07fQoKICAgIGZ1bmN0aW9uIF9zbGljZWRUb0FycmF5KGFyciwgaSkge3JldHVybiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB8fCBfbm9uSXRlcmFibGVSZXN0KCk7fQoKICAgIGZ1bmN0aW9uIF9ub25JdGVyYWJsZVJlc3QoKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZSIpO30KCiAgICBmdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB7aWYgKCEoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChhcnIpIHx8IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChhcnIpID09PSAiW29iamVjdCBBcmd1bWVudHNdIikpIHtyZXR1cm47fXZhciBfYXJyID0gW107dmFyIF9uID0gdHJ1ZTt2YXIgX2QgPSBmYWxzZTt2YXIgX2UgPSB1bmRlZmluZWQ7dHJ5IHtmb3IgKHZhciBfaSA9IGFycltTeW1ib2wuaXRlcmF0b3JdKCksIF9zOyAhKF9uID0gKF9zID0gX2kubmV4dCgpKS5kb25lKTsgX24gPSB0cnVlKSB7X2Fyci5wdXNoKF9zLnZhbHVlKTtpZiAoaSAmJiBfYXJyLmxlbmd0aCA9PT0gaSkgYnJlYWs7fX0gY2F0Y2ggKGVycikge19kID0gdHJ1ZTtfZSA9IGVycjt9IGZpbmFsbHkge3RyeSB7aWYgKCFfbiAmJiBfaVsicmV0dXJuIl0gIT0gbnVsbCkgX2lbInJldHVybiJdKCk7fSBmaW5hbGx5IHtpZiAoX2QpIHRocm93IF9lO319cmV0dXJuIF9hcnI7fQoKICAgIGZ1bmN0aW9uIF9hcnJheVdpdGhIb2xlcyhhcnIpIHtpZiAoQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm4gYXJyO30KCiAgICBmdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7dHJ5IHt2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7dmFyIHZhbHVlID0gaW5mby52YWx1ZTt9IGNhdGNoIChlcnJvcikge3JlamVjdChlcnJvcik7cmV0dXJuO31pZiAoaW5mby5kb25lKSB7cmVzb2x2ZSh2YWx1ZSk7fSBlbHNlIHtQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oX25leHQsIF90aHJvdyk7fX0KCiAgICBmdW5jdGlvbiBfYXN5bmNUb0dlbmVyYXRvcihmbikge3JldHVybiBmdW5jdGlvbiAoKSB7dmFyIHNlbGYgPSB0aGlzLGFyZ3MgPSBhcmd1bWVudHM7cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHt2YXIgZ2VuID0gZm4uYXBwbHkoc2VsZiwgYXJncyk7ZnVuY3Rpb24gX25leHQodmFsdWUpIHthc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJuZXh0IiwgdmFsdWUpO31mdW5jdGlvbiBfdGhyb3coZXJyKSB7YXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAidGhyb3ciLCBlcnIpO31fbmV4dCh1bmRlZmluZWQpO30pO307fQoKICAgIGZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheShhcnIpIHtyZXR1cm4gX2FycmF5V2l0aG91dEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheShhcnIpIHx8IF9ub25JdGVyYWJsZVNwcmVhZCgpO30KCiAgICBmdW5jdGlvbiBfbm9uSXRlcmFibGVTcHJlYWQoKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIHNwcmVhZCBub24taXRlcmFibGUgaW5zdGFuY2UiKTt9CgogICAgZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7aWYgKFN5bWJvbC5pdGVyYXRvciBpbiBPYmplY3QoaXRlcikgfHwgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGl0ZXIpID09PSAiW29iamVjdCBBcmd1bWVudHNdIikgcmV0dXJuIEFycmF5LmZyb20oaXRlcik7fQoKICAgIGZ1bmN0aW9uIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHtpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7Zm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkoYXJyLmxlbmd0aCk7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHthcnIyW2ldID0gYXJyW2ldO31yZXR1cm4gYXJyMjt9fQoKICAgIGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHtpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpO319CgogICAgZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykge2ZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHt2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldO2Rlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTtkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7aWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7T2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpO319CgogICAgZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykge2lmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpO2lmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTtyZXR1cm4gQ29uc3RydWN0b3I7fQoKICAgIGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mIjtpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAic3ltYm9sIikge190eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikge3JldHVybiB0eXBlb2Ygb2JqO307fSBlbHNlIHtfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHtyZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqO307fXJldHVybiBfdHlwZW9mKG9iaik7fQoKICAgIHZhciBERUZBVUxUX1JBTkdFX0NIVU5LX1NJWkUgPSA2NTUzNjsKICAgIHZhciBSRU5ERVJJTkdfQ0FOQ0VMTEVEX1RJTUVPVVQgPSAxMDA7CiAgICB2YXIgY3JlYXRlUERGTmV0d29ya1N0cmVhbTsKCiAgICBmdW5jdGlvbiBzZXRQREZOZXR3b3JrU3RyZWFtRmFjdG9yeShwZGZOZXR3b3JrU3RyZWFtRmFjdG9yeSkgewogICAgICBjcmVhdGVQREZOZXR3b3JrU3RyZWFtID0gcGRmTmV0d29ya1N0cmVhbUZhY3Rvcnk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0RG9jdW1lbnQoc3JjKSB7CiAgICAgIHZhciB0YXNrID0gbmV3IFBERkRvY3VtZW50TG9hZGluZ1Rhc2soKTsKICAgICAgdmFyIHNvdXJjZTsKCiAgICAgIGlmICh0eXBlb2Ygc3JjID09PSAic3RyaW5nIikgewogICAgICAgIHNvdXJjZSA9IHsKICAgICAgICAgIHVybDogc3JjCiAgICAgICAgfTsKICAgICAgfSBlbHNlIGlmICgoMCwgX3V0aWwuaXNBcnJheUJ1ZmZlcikoc3JjKSkgewogICAgICAgIHNvdXJjZSA9IHsKICAgICAgICAgIGRhdGE6IHNyYwogICAgICAgIH07CiAgICAgIH0gZWxzZSBpZiAoc3JjIGluc3RhbmNlb2YgUERGRGF0YVJhbmdlVHJhbnNwb3J0KSB7CiAgICAgICAgc291cmNlID0gewogICAgICAgICAgcmFuZ2U6IHNyYwogICAgICAgIH07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKF90eXBlb2Yoc3JjKSAhPT0gIm9iamVjdCIpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBwYXJhbWV0ZXIgaW4gZ2V0RG9jdW1lbnQsICIgKyAibmVlZCBlaXRoZXIgVWludDhBcnJheSwgc3RyaW5nIG9yIGEgcGFyYW1ldGVyIG9iamVjdCIpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFzcmMudXJsICYmICFzcmMuZGF0YSAmJiAhc3JjLnJhbmdlKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgcGFyYW1ldGVyIG9iamVjdDogbmVlZCBlaXRoZXIgLmRhdGEsIC5yYW5nZSBvciAudXJsIik7CiAgICAgICAgfQoKICAgICAgICBzb3VyY2UgPSBzcmM7CiAgICAgIH0KCiAgICAgIHZhciBwYXJhbXMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICB2YXIgcmFuZ2VUcmFuc3BvcnQgPSBudWxsLAogICAgICAgIHdvcmtlciA9IG51bGw7CgogICAgICBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7CiAgICAgICAgaWYgKGtleSA9PT0gInVybCIgJiYgdHlwZW9mIHdpbmRvdyAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgIHBhcmFtc1trZXldID0gbmV3IFVSTChzb3VyY2Vba2V5XSwgd2luZG93LmxvY2F0aW9uKS5ocmVmOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfSBlbHNlIGlmIChrZXkgPT09ICJyYW5nZSIpIHsKICAgICAgICAgIHJhbmdlVHJhbnNwb3J0ID0gc291cmNlW2tleV07CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IGVsc2UgaWYgKGtleSA9PT0gIndvcmtlciIpIHsKICAgICAgICAgIHdvcmtlciA9IHNvdXJjZVtrZXldOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfSBlbHNlIGlmIChrZXkgPT09ICJkYXRhIiAmJiAhKHNvdXJjZVtrZXldIGluc3RhbmNlb2YgVWludDhBcnJheSkpIHsKICAgICAgICAgIHZhciBwZGZCeXRlcyA9IHNvdXJjZVtrZXldOwoKICAgICAgICAgIGlmICh0eXBlb2YgcGRmQnl0ZXMgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgIHBhcmFtc1trZXldID0gKDAsIF91dGlsLnN0cmluZ1RvQnl0ZXMpKHBkZkJ5dGVzKTsKICAgICAgICAgIH0gZWxzZSBpZiAoX3R5cGVvZihwZGZCeXRlcykgPT09ICJvYmplY3QiICYmIHBkZkJ5dGVzICE9PSBudWxsICYmICFpc05hTihwZGZCeXRlcy5sZW5ndGgpKSB7CiAgICAgICAgICAgIHBhcmFtc1trZXldID0gbmV3IFVpbnQ4QXJyYXkocGRmQnl0ZXMpOwogICAgICAgICAgfSBlbHNlIGlmICgoMCwgX3V0aWwuaXNBcnJheUJ1ZmZlcikocGRmQnl0ZXMpKSB7CiAgICAgICAgICAgIHBhcmFtc1trZXldID0gbmV3IFVpbnQ4QXJyYXkocGRmQnl0ZXMpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIFBERiBiaW5hcnkgZGF0YTogZWl0aGVyIHR5cGVkIGFycmF5LCAiICsgInN0cmluZyBvciBhcnJheS1saWtlIG9iamVjdCBpcyBleHBlY3RlZCBpbiB0aGUgIiArICJkYXRhIHByb3BlcnR5LiIpOwogICAgICAgICAgfQoKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KCiAgICAgICAgcGFyYW1zW2tleV0gPSBzb3VyY2Vba2V5XTsKICAgICAgfQoKICAgICAgcGFyYW1zLnJhbmdlQ2h1bmtTaXplID0gcGFyYW1zLnJhbmdlQ2h1bmtTaXplIHx8IERFRkFVTFRfUkFOR0VfQ0hVTktfU0laRTsKICAgICAgcGFyYW1zLkNNYXBSZWFkZXJGYWN0b3J5ID0gcGFyYW1zLkNNYXBSZWFkZXJGYWN0b3J5IHx8IF9kaXNwbGF5X3V0aWxzLkRPTUNNYXBSZWFkZXJGYWN0b3J5OwogICAgICBwYXJhbXMuaWdub3JlRXJyb3JzID0gcGFyYW1zLnN0b3BBdEVycm9ycyAhPT0gdHJ1ZTsKICAgICAgcGFyYW1zLnBkZkJ1ZyA9IHBhcmFtcy5wZGZCdWcgPT09IHRydWU7CiAgICAgIHZhciBOYXRpdmVJbWFnZURlY29kZXJWYWx1ZXMgPSBPYmplY3QudmFsdWVzKF91dGlsLk5hdGl2ZUltYWdlRGVjb2RpbmcpOwoKICAgICAgaWYgKHBhcmFtcy5uYXRpdmVJbWFnZURlY29kZXJTdXBwb3J0ID09PSB1bmRlZmluZWQgfHwgIU5hdGl2ZUltYWdlRGVjb2RlclZhbHVlcy5pbmNsdWRlcyhwYXJhbXMubmF0aXZlSW1hZ2VEZWNvZGVyU3VwcG9ydCkpIHsKICAgICAgICBwYXJhbXMubmF0aXZlSW1hZ2VEZWNvZGVyU3VwcG9ydCA9IF9hcGlfY29tcGF0aWJpbGl0eS5hcGlDb21wYXRpYmlsaXR5UGFyYW1zLm5hdGl2ZUltYWdlRGVjb2RlclN1cHBvcnQgfHwgX3V0aWwuTmF0aXZlSW1hZ2VEZWNvZGluZy5ERUNPREU7CiAgICAgIH0KCiAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihwYXJhbXMubWF4SW1hZ2VTaXplKSkgewogICAgICAgIHBhcmFtcy5tYXhJbWFnZVNpemUgPSAtMTsKICAgICAgfQoKICAgICAgaWYgKHR5cGVvZiBwYXJhbXMuaXNFdmFsU3VwcG9ydGVkICE9PSAiYm9vbGVhbiIpIHsKICAgICAgICBwYXJhbXMuaXNFdmFsU3VwcG9ydGVkID0gdHJ1ZTsKICAgICAgfQoKICAgICAgaWYgKHR5cGVvZiBwYXJhbXMuZGlzYWJsZUZvbnRGYWNlICE9PSAiYm9vbGVhbiIpIHsKICAgICAgICBwYXJhbXMuZGlzYWJsZUZvbnRGYWNlID0gX2FwaV9jb21wYXRpYmlsaXR5LmFwaUNvbXBhdGliaWxpdHlQYXJhbXMuZGlzYWJsZUZvbnRGYWNlIHx8IGZhbHNlOwogICAgICB9CgogICAgICBpZiAodHlwZW9mIHBhcmFtcy5kaXNhYmxlUmFuZ2UgIT09ICJib29sZWFuIikgewogICAgICAgIHBhcmFtcy5kaXNhYmxlUmFuZ2UgPSBmYWxzZTsKICAgICAgfQoKICAgICAgaWYgKHR5cGVvZiBwYXJhbXMuZGlzYWJsZVN0cmVhbSAhPT0gImJvb2xlYW4iKSB7CiAgICAgICAgcGFyYW1zLmRpc2FibGVTdHJlYW0gPSBmYWxzZTsKICAgICAgfQoKICAgICAgaWYgKHR5cGVvZiBwYXJhbXMuZGlzYWJsZUF1dG9GZXRjaCAhPT0gImJvb2xlYW4iKSB7CiAgICAgICAgcGFyYW1zLmRpc2FibGVBdXRvRmV0Y2ggPSBmYWxzZTsKICAgICAgfQoKICAgICAgaWYgKHR5cGVvZiBwYXJhbXMuZGlzYWJsZUNyZWF0ZU9iamVjdFVSTCAhPT0gImJvb2xlYW4iKSB7CiAgICAgICAgcGFyYW1zLmRpc2FibGVDcmVhdGVPYmplY3RVUkwgPSBfYXBpX2NvbXBhdGliaWxpdHkuYXBpQ29tcGF0aWJpbGl0eVBhcmFtcy5kaXNhYmxlQ3JlYXRlT2JqZWN0VVJMIHx8IGZhbHNlOwogICAgICB9CgogICAgICAoMCwgX3V0aWwuc2V0VmVyYm9zaXR5TGV2ZWwpKHBhcmFtcy52ZXJib3NpdHkpOwoKICAgICAgaWYgKCF3b3JrZXIpIHsKICAgICAgICB2YXIgd29ya2VyUGFyYW1zID0gewogICAgICAgICAgdmVyYm9zaXR5OiBwYXJhbXMudmVyYm9zaXR5LAogICAgICAgICAgcG9ydDogX3dvcmtlcl9vcHRpb25zLkdsb2JhbFdvcmtlck9wdGlvbnMud29ya2VyUG9ydAogICAgICAgIH07CiAgICAgICAgd29ya2VyID0gd29ya2VyUGFyYW1zLnBvcnQgPyBQREZXb3JrZXIuZnJvbVBvcnQod29ya2VyUGFyYW1zKSA6IG5ldyBQREZXb3JrZXIod29ya2VyUGFyYW1zKTsKICAgICAgICB0YXNrLl93b3JrZXIgPSB3b3JrZXI7CiAgICAgIH0KCiAgICAgIHZhciBkb2NJZCA9IHRhc2suZG9jSWQ7CiAgICAgIHdvcmtlci5wcm9taXNlLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIGlmICh0YXNrLmRlc3Ryb3llZCkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJMb2FkaW5nIGFib3J0ZWQiKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBfZmV0Y2hEb2N1bWVudCh3b3JrZXIsIHBhcmFtcywgcmFuZ2VUcmFuc3BvcnQsIGRvY0lkKS50aGVuKGZ1bmN0aW9uICh3b3JrZXJJZCkgewogICAgICAgICAgaWYgKHRhc2suZGVzdHJveWVkKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiTG9hZGluZyBhYm9ydGVkIik7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIG5ldHdvcmtTdHJlYW07CgogICAgICAgICAgaWYgKHJhbmdlVHJhbnNwb3J0KSB7CiAgICAgICAgICAgIG5ldHdvcmtTdHJlYW0gPSBuZXcgX3RyYW5zcG9ydF9zdHJlYW0uUERGRGF0YVRyYW5zcG9ydFN0cmVhbSh7CiAgICAgICAgICAgICAgbGVuZ3RoOiBwYXJhbXMubGVuZ3RoLAogICAgICAgICAgICAgIGluaXRpYWxEYXRhOiBwYXJhbXMuaW5pdGlhbERhdGEsCiAgICAgICAgICAgICAgcHJvZ3Jlc3NpdmVEb25lOiBwYXJhbXMucHJvZ3Jlc3NpdmVEb25lLAogICAgICAgICAgICAgIGRpc2FibGVSYW5nZTogcGFyYW1zLmRpc2FibGVSYW5nZSwKICAgICAgICAgICAgICBkaXNhYmxlU3RyZWFtOiBwYXJhbXMuZGlzYWJsZVN0cmVhbQogICAgICAgICAgICB9LCByYW5nZVRyYW5zcG9ydCk7CiAgICAgICAgICB9IGVsc2UgaWYgKCFwYXJhbXMuZGF0YSkgewogICAgICAgICAgICBuZXR3b3JrU3RyZWFtID0gY3JlYXRlUERGTmV0d29ya1N0cmVhbSh7CiAgICAgICAgICAgICAgdXJsOiBwYXJhbXMudXJsLAogICAgICAgICAgICAgIGxlbmd0aDogcGFyYW1zLmxlbmd0aCwKICAgICAgICAgICAgICBodHRwSGVhZGVyczogcGFyYW1zLmh0dHBIZWFkZXJzLAogICAgICAgICAgICAgIHdpdGhDcmVkZW50aWFsczogcGFyYW1zLndpdGhDcmVkZW50aWFscywKICAgICAgICAgICAgICByYW5nZUNodW5rU2l6ZTogcGFyYW1zLnJhbmdlQ2h1bmtTaXplLAogICAgICAgICAgICAgIGRpc2FibGVSYW5nZTogcGFyYW1zLmRpc2FibGVSYW5nZSwKICAgICAgICAgICAgICBkaXNhYmxlU3RyZWFtOiBwYXJhbXMuZGlzYWJsZVN0cmVhbQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgbWVzc2FnZUhhbmRsZXIgPSBuZXcgX21lc3NhZ2VfaGFuZGxlci5NZXNzYWdlSGFuZGxlcihkb2NJZCwgd29ya2VySWQsIHdvcmtlci5wb3J0KTsKICAgICAgICAgIG1lc3NhZ2VIYW5kbGVyLnBvc3RNZXNzYWdlVHJhbnNmZXJzID0gd29ya2VyLnBvc3RNZXNzYWdlVHJhbnNmZXJzOwogICAgICAgICAgdmFyIHRyYW5zcG9ydCA9IG5ldyBXb3JrZXJUcmFuc3BvcnQobWVzc2FnZUhhbmRsZXIsIHRhc2ssIG5ldHdvcmtTdHJlYW0sIHBhcmFtcyk7CiAgICAgICAgICB0YXNrLl90cmFuc3BvcnQgPSB0cmFuc3BvcnQ7CiAgICAgICAgICBtZXNzYWdlSGFuZGxlci5zZW5kKCJSZWFkeSIsIG51bGwpOwogICAgICAgIH0pOwogICAgICB9KVsiY2F0Y2giXSh0YXNrLl9jYXBhYmlsaXR5LnJlamVjdCk7CiAgICAgIHJldHVybiB0YXNrOwogICAgfQoKICAgIGZ1bmN0aW9uIF9mZXRjaERvY3VtZW50KHdvcmtlciwgc291cmNlLCBwZGZEYXRhUmFuZ2VUcmFuc3BvcnQsIGRvY0lkKSB7CiAgICAgIGlmICh3b3JrZXIuZGVzdHJveWVkKSB7CiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcigiV29ya2VyIHdhcyBkZXN0cm95ZWQiKSk7CiAgICAgIH0KCiAgICAgIGlmIChwZGZEYXRhUmFuZ2VUcmFuc3BvcnQpIHsKICAgICAgICBzb3VyY2UubGVuZ3RoID0gcGRmRGF0YVJhbmdlVHJhbnNwb3J0Lmxlbmd0aDsKICAgICAgICBzb3VyY2UuaW5pdGlhbERhdGEgPSBwZGZEYXRhUmFuZ2VUcmFuc3BvcnQuaW5pdGlhbERhdGE7CiAgICAgICAgc291cmNlLnByb2dyZXNzaXZlRG9uZSA9IHBkZkRhdGFSYW5nZVRyYW5zcG9ydC5wcm9ncmVzc2l2ZURvbmU7CiAgICAgIH0KCiAgICAgIHJldHVybiB3b3JrZXIubWVzc2FnZUhhbmRsZXIuc2VuZFdpdGhQcm9taXNlKCJHZXREb2NSZXF1ZXN0IiwgewogICAgICAgIGRvY0lkOiBkb2NJZCwKICAgICAgICBhcGlWZXJzaW9uOiAnMi40LjQ1NicsCiAgICAgICAgc291cmNlOiB7CiAgICAgICAgICBkYXRhOiBzb3VyY2UuZGF0YSwKICAgICAgICAgIHVybDogc291cmNlLnVybCwKICAgICAgICAgIHBhc3N3b3JkOiBzb3VyY2UucGFzc3dvcmQsCiAgICAgICAgICBkaXNhYmxlQXV0b0ZldGNoOiBzb3VyY2UuZGlzYWJsZUF1dG9GZXRjaCwKICAgICAgICAgIHJhbmdlQ2h1bmtTaXplOiBzb3VyY2UucmFuZ2VDaHVua1NpemUsCiAgICAgICAgICBsZW5ndGg6IHNvdXJjZS5sZW5ndGgKICAgICAgICB9LAogICAgICAgIG1heEltYWdlU2l6ZTogc291cmNlLm1heEltYWdlU2l6ZSwKICAgICAgICBkaXNhYmxlRm9udEZhY2U6IHNvdXJjZS5kaXNhYmxlRm9udEZhY2UsCiAgICAgICAgZGlzYWJsZUNyZWF0ZU9iamVjdFVSTDogc291cmNlLmRpc2FibGVDcmVhdGVPYmplY3RVUkwsCiAgICAgICAgcG9zdE1lc3NhZ2VUcmFuc2ZlcnM6IHdvcmtlci5wb3N0TWVzc2FnZVRyYW5zZmVycywKICAgICAgICBkb2NCYXNlVXJsOiBzb3VyY2UuZG9jQmFzZVVybCwKICAgICAgICBuYXRpdmVJbWFnZURlY29kZXJTdXBwb3J0OiBzb3VyY2UubmF0aXZlSW1hZ2VEZWNvZGVyU3VwcG9ydCwKICAgICAgICBpZ25vcmVFcnJvcnM6IHNvdXJjZS5pZ25vcmVFcnJvcnMsCiAgICAgICAgaXNFdmFsU3VwcG9ydGVkOiBzb3VyY2UuaXNFdmFsU3VwcG9ydGVkCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHdvcmtlcklkKSB7CiAgICAgICAgaWYgKHdvcmtlci5kZXN0cm95ZWQpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiV29ya2VyIHdhcyBkZXN0cm95ZWQiKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB3b3JrZXJJZDsKICAgICAgfSk7CiAgICB9CgogICAgdmFyIFBERkRvY3VtZW50TG9hZGluZ1Rhc2sgPSBmdW5jdGlvbiBQREZEb2N1bWVudExvYWRpbmdUYXNrQ2xvc3VyZSgpIHsKICAgICAgdmFyIG5leHREb2N1bWVudElkID0gMDsKCiAgICAgIHZhciBQREZEb2N1bWVudExvYWRpbmdUYXNrID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBQREZEb2N1bWVudExvYWRpbmdUYXNrKCkgewogICAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFBERkRvY3VtZW50TG9hZGluZ1Rhc2spOwoKICAgICAgICAgIHRoaXMuX2NhcGFiaWxpdHkgPSAoMCwgX3V0aWwuY3JlYXRlUHJvbWlzZUNhcGFiaWxpdHkpKCk7CiAgICAgICAgICB0aGlzLl90cmFuc3BvcnQgPSBudWxsOwogICAgICAgICAgdGhpcy5fd29ya2VyID0gbnVsbDsKICAgICAgICAgIHRoaXMuZG9jSWQgPSAiZCIgKyBuZXh0RG9jdW1lbnRJZCsrOwogICAgICAgICAgdGhpcy5kZXN0cm95ZWQgPSBmYWxzZTsKICAgICAgICAgIHRoaXMub25QYXNzd29yZCA9IG51bGw7CiAgICAgICAgICB0aGlzLm9uUHJvZ3Jlc3MgPSBudWxsOwogICAgICAgICAgdGhpcy5vblVuc3VwcG9ydGVkRmVhdHVyZSA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICBfY3JlYXRlQ2xhc3MoUERGRG9jdW1lbnRMb2FkaW5nVGFzaywgW3sKICAgICAgICAgIGtleTogImRlc3Ryb3kiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7CiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAgICAgICB0aGlzLmRlc3Ryb3llZCA9IHRydWU7CiAgICAgICAgICAgIHZhciB0cmFuc3BvcnREZXN0cm95ZWQgPSAhdGhpcy5fdHJhbnNwb3J0ID8gUHJvbWlzZS5yZXNvbHZlKCkgOiB0aGlzLl90cmFuc3BvcnQuZGVzdHJveSgpOwogICAgICAgICAgICByZXR1cm4gdHJhbnNwb3J0RGVzdHJveWVkLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIF90aGlzLl90cmFuc3BvcnQgPSBudWxsOwoKICAgICAgICAgICAgICBpZiAoX3RoaXMuX3dvcmtlcikgewogICAgICAgICAgICAgICAgX3RoaXMuX3dvcmtlci5kZXN0cm95KCk7CgogICAgICAgICAgICAgICAgX3RoaXMuX3dvcmtlciA9IG51bGw7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJ0aGVuIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiB0aGVuKG9uRnVsZmlsbGVkLCBvblJlamVjdGVkKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiUmVtb3ZlZCBBUEkgbWV0aG9kOiAiICsgIlBERkRvY3VtZW50TG9hZGluZ1Rhc2sudGhlbiwgdXNlIHRoZSBgcHJvbWlzZWAgZ2V0dGVyIGluc3RlYWQuIik7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAicHJvbWlzZSIsCiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NhcGFiaWxpdHkucHJvbWlzZTsKICAgICAgICAgIH0KICAgICAgICB9XSk7CgogICAgICAgIHJldHVybiBQREZEb2N1bWVudExvYWRpbmdUYXNrOwogICAgICB9KCk7CgogICAgICByZXR1cm4gUERGRG9jdW1lbnRMb2FkaW5nVGFzazsKICAgIH0oKTsKCiAgICB2YXIgUERGRGF0YVJhbmdlVHJhbnNwb3J0ID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gUERGRGF0YVJhbmdlVHJhbnNwb3J0KGxlbmd0aCwgaW5pdGlhbERhdGEpIHsKICAgICAgICB2YXIgcHJvZ3Jlc3NpdmVEb25lID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiBmYWxzZTsKCiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFBERkRhdGFSYW5nZVRyYW5zcG9ydCk7CgogICAgICAgIHRoaXMubGVuZ3RoID0gbGVuZ3RoOwogICAgICAgIHRoaXMuaW5pdGlhbERhdGEgPSBpbml0aWFsRGF0YTsKICAgICAgICB0aGlzLnByb2dyZXNzaXZlRG9uZSA9IHByb2dyZXNzaXZlRG9uZTsKICAgICAgICB0aGlzLl9yYW5nZUxpc3RlbmVycyA9IFtdOwogICAgICAgIHRoaXMuX3Byb2dyZXNzTGlzdGVuZXJzID0gW107CiAgICAgICAgdGhpcy5fcHJvZ3Jlc3NpdmVSZWFkTGlzdGVuZXJzID0gW107CiAgICAgICAgdGhpcy5fcHJvZ3Jlc3NpdmVEb25lTGlzdGVuZXJzID0gW107CiAgICAgICAgdGhpcy5fcmVhZHlDYXBhYmlsaXR5ID0gKDAsIF91dGlsLmNyZWF0ZVByb21pc2VDYXBhYmlsaXR5KSgpOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoUERGRGF0YVJhbmdlVHJhbnNwb3J0LCBbewogICAgICAgIGtleTogImFkZFJhbmdlTGlzdGVuZXIiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRSYW5nZUxpc3RlbmVyKGxpc3RlbmVyKSB7CiAgICAgICAgICB0aGlzLl9yYW5nZUxpc3RlbmVycy5wdXNoKGxpc3RlbmVyKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJhZGRQcm9ncmVzc0xpc3RlbmVyIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gYWRkUHJvZ3Jlc3NMaXN0ZW5lcihsaXN0ZW5lcikgewogICAgICAgICAgdGhpcy5fcHJvZ3Jlc3NMaXN0ZW5lcnMucHVzaChsaXN0ZW5lcik7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiYWRkUHJvZ3Jlc3NpdmVSZWFkTGlzdGVuZXIiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRQcm9ncmVzc2l2ZVJlYWRMaXN0ZW5lcihsaXN0ZW5lcikgewogICAgICAgICAgdGhpcy5fcHJvZ3Jlc3NpdmVSZWFkTGlzdGVuZXJzLnB1c2gobGlzdGVuZXIpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImFkZFByb2dyZXNzaXZlRG9uZUxpc3RlbmVyIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gYWRkUHJvZ3Jlc3NpdmVEb25lTGlzdGVuZXIobGlzdGVuZXIpIHsKICAgICAgICAgIHRoaXMuX3Byb2dyZXNzaXZlRG9uZUxpc3RlbmVycy5wdXNoKGxpc3RlbmVyKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJvbkRhdGFSYW5nZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIG9uRGF0YVJhbmdlKGJlZ2luLCBjaHVuaykgewogICAgICAgICAgdmFyIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSB0cnVlOwogICAgICAgICAgdmFyIF9kaWRJdGVyYXRvckVycm9yID0gZmFsc2U7CiAgICAgICAgICB2YXIgX2l0ZXJhdG9yRXJyb3IgPSB1bmRlZmluZWQ7CgogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZm9yICh2YXIgX2l0ZXJhdG9yID0gdGhpcy5fcmFuZ2VMaXN0ZW5lcnNbU3ltYm9sLml0ZXJhdG9yXSgpLCBfc3RlcDsgIShfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gKF9zdGVwID0gX2l0ZXJhdG9yLm5leHQoKSkuZG9uZSk7IF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSB0cnVlKSB7CiAgICAgICAgICAgICAgdmFyIGxpc3RlbmVyID0gX3N0ZXAudmFsdWU7CiAgICAgICAgICAgICAgbGlzdGVuZXIoYmVnaW4sIGNodW5rKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgIF9kaWRJdGVyYXRvckVycm9yID0gdHJ1ZTsKICAgICAgICAgICAgX2l0ZXJhdG9yRXJyb3IgPSBlcnI7CiAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGlmICghX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiAmJiBfaXRlcmF0b3JbInJldHVybiJdICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIF9pdGVyYXRvclsicmV0dXJuIl0oKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgaWYgKF9kaWRJdGVyYXRvckVycm9yKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBfaXRlcmF0b3JFcnJvcjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJvbkRhdGFQcm9ncmVzcyIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIG9uRGF0YVByb2dyZXNzKGxvYWRlZCwgdG90YWwpIHsKICAgICAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgICAgIHRoaXMuX3JlYWR5Q2FwYWJpbGl0eS5wcm9taXNlLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIgPSB0cnVlOwogICAgICAgICAgICB2YXIgX2RpZEl0ZXJhdG9yRXJyb3IyID0gZmFsc2U7CiAgICAgICAgICAgIHZhciBfaXRlcmF0b3JFcnJvcjIgPSB1bmRlZmluZWQ7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGZvciAodmFyIF9pdGVyYXRvcjIgPSBfdGhpczIuX3Byb2dyZXNzTGlzdGVuZXJzW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3N0ZXAyOyAhKF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yID0gKF9zdGVwMiA9IF9pdGVyYXRvcjIubmV4dCgpKS5kb25lKTsgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIgPSB0cnVlKSB7CiAgICAgICAgICAgICAgICB2YXIgbGlzdGVuZXIgPSBfc3RlcDIudmFsdWU7CiAgICAgICAgICAgICAgICBsaXN0ZW5lcihsb2FkZWQsIHRvdGFsKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgIF9kaWRJdGVyYXRvckVycm9yMiA9IHRydWU7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yRXJyb3IyID0gZXJyOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yICYmIF9pdGVyYXRvcjJbInJldHVybiJdICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yMlsicmV0dXJuIl0oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgaWYgKF9kaWRJdGVyYXRvckVycm9yMikgewogICAgICAgICAgICAgICAgICB0aHJvdyBfaXRlcmF0b3JFcnJvcjI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJvbkRhdGFQcm9ncmVzc2l2ZVJlYWQiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBvbkRhdGFQcm9ncmVzc2l2ZVJlYWQoY2h1bmspIHsKICAgICAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgICAgIHRoaXMuX3JlYWR5Q2FwYWJpbGl0eS5wcm9taXNlLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjMgPSB0cnVlOwogICAgICAgICAgICB2YXIgX2RpZEl0ZXJhdG9yRXJyb3IzID0gZmFsc2U7CiAgICAgICAgICAgIHZhciBfaXRlcmF0b3JFcnJvcjMgPSB1bmRlZmluZWQ7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGZvciAodmFyIF9pdGVyYXRvcjMgPSBfdGhpczMuX3Byb2dyZXNzaXZlUmVhZExpc3RlbmVyc1tTeW1ib2wuaXRlcmF0b3JdKCksIF9zdGVwMzsgIShfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMyA9IChfc3RlcDMgPSBfaXRlcmF0b3IzLm5leHQoKSkuZG9uZSk7IF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24zID0gdHJ1ZSkgewogICAgICAgICAgICAgICAgdmFyIGxpc3RlbmVyID0gX3N0ZXAzLnZhbHVlOwogICAgICAgICAgICAgICAgbGlzdGVuZXIoY2h1bmspOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgX2RpZEl0ZXJhdG9yRXJyb3IzID0gdHJ1ZTsKICAgICAgICAgICAgICBfaXRlcmF0b3JFcnJvcjMgPSBlcnI7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICghX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjMgJiYgX2l0ZXJhdG9yM1sicmV0dXJuIl0gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICBfaXRlcmF0b3IzWyJyZXR1cm4iXSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBpZiAoX2RpZEl0ZXJhdG9yRXJyb3IzKSB7CiAgICAgICAgICAgICAgICAgIHRocm93IF9pdGVyYXRvckVycm9yMzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIm9uRGF0YVByb2dyZXNzaXZlRG9uZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIG9uRGF0YVByb2dyZXNzaXZlRG9uZSgpIHsKICAgICAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgICAgIHRoaXMuX3JlYWR5Q2FwYWJpbGl0eS5wcm9taXNlLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjQgPSB0cnVlOwogICAgICAgICAgICB2YXIgX2RpZEl0ZXJhdG9yRXJyb3I0ID0gZmFsc2U7CiAgICAgICAgICAgIHZhciBfaXRlcmF0b3JFcnJvcjQgPSB1bmRlZmluZWQ7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGZvciAodmFyIF9pdGVyYXRvcjQgPSBfdGhpczQuX3Byb2dyZXNzaXZlRG9uZUxpc3RlbmVyc1tTeW1ib2wuaXRlcmF0b3JdKCksIF9zdGVwNDsgIShfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uNCA9IChfc3RlcDQgPSBfaXRlcmF0b3I0Lm5leHQoKSkuZG9uZSk7IF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb240ID0gdHJ1ZSkgewogICAgICAgICAgICAgICAgdmFyIGxpc3RlbmVyID0gX3N0ZXA0LnZhbHVlOwogICAgICAgICAgICAgICAgbGlzdGVuZXIoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgIF9kaWRJdGVyYXRvckVycm9yNCA9IHRydWU7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yRXJyb3I0ID0gZXJyOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb240ICYmIF9pdGVyYXRvcjRbInJldHVybiJdICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yNFsicmV0dXJuIl0oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgaWYgKF9kaWRJdGVyYXRvckVycm9yNCkgewogICAgICAgICAgICAgICAgICB0aHJvdyBfaXRlcmF0b3JFcnJvcjQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJ0cmFuc3BvcnRSZWFkeSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHRyYW5zcG9ydFJlYWR5KCkgewogICAgICAgICAgdGhpcy5fcmVhZHlDYXBhYmlsaXR5LnJlc29sdmUoKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJyZXF1ZXN0RGF0YVJhbmdlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcmVxdWVzdERhdGFSYW5nZShiZWdpbiwgZW5kKSB7CiAgICAgICAgICAoMCwgX3V0aWwudW5yZWFjaGFibGUpKCJBYnN0cmFjdCBtZXRob2QgUERGRGF0YVJhbmdlVHJhbnNwb3J0LnJlcXVlc3REYXRhUmFuZ2UiKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJhYm9ydCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGFib3J0KCkge30KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIFBERkRhdGFSYW5nZVRyYW5zcG9ydDsKICAgIH0oKTsKCiAgICBleHBvcnRzLlBERkRhdGFSYW5nZVRyYW5zcG9ydCA9IFBERkRhdGFSYW5nZVRyYW5zcG9ydDsKCiAgICB2YXIgUERGRG9jdW1lbnRQcm94eSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgIGZ1bmN0aW9uIFBERkRvY3VtZW50UHJveHkocGRmSW5mbywgdHJhbnNwb3J0KSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFBERkRvY3VtZW50UHJveHkpOwoKICAgICAgICB0aGlzLl9wZGZJbmZvID0gcGRmSW5mbzsKICAgICAgICB0aGlzLl90cmFuc3BvcnQgPSB0cmFuc3BvcnQ7CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhQREZEb2N1bWVudFByb3h5LCBbewogICAgICAgIGtleTogImdldFBhZ2UiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRQYWdlKHBhZ2VOdW1iZXIpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl90cmFuc3BvcnQuZ2V0UGFnZShwYWdlTnVtYmVyKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJnZXRQYWdlSW5kZXgiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRQYWdlSW5kZXgocmVmKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fdHJhbnNwb3J0LmdldFBhZ2VJbmRleChyZWYpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImdldERlc3RpbmF0aW9ucyIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldERlc3RpbmF0aW9ucygpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl90cmFuc3BvcnQuZ2V0RGVzdGluYXRpb25zKCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0RGVzdGluYXRpb24iLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXREZXN0aW5hdGlvbihpZCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX3RyYW5zcG9ydC5nZXREZXN0aW5hdGlvbihpZCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0UGFnZUxhYmVscyIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldFBhZ2VMYWJlbHMoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fdHJhbnNwb3J0LmdldFBhZ2VMYWJlbHMoKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJnZXRQYWdlTGF5b3V0IiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UGFnZUxheW91dCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl90cmFuc3BvcnQuZ2V0UGFnZUxheW91dCgpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImdldFBhZ2VNb2RlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UGFnZU1vZGUoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fdHJhbnNwb3J0LmdldFBhZ2VNb2RlKCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0Vmlld2VyUHJlZmVyZW5jZXMiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRWaWV3ZXJQcmVmZXJlbmNlcygpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl90cmFuc3BvcnQuZ2V0Vmlld2VyUHJlZmVyZW5jZXMoKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJnZXRPcGVuQWN0aW9uIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0T3BlbkFjdGlvbigpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl90cmFuc3BvcnQuZ2V0T3BlbkFjdGlvbigpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImdldE9wZW5BY3Rpb25EZXN0aW5hdGlvbiIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldE9wZW5BY3Rpb25EZXN0aW5hdGlvbigpIHsKICAgICAgICAgICgwLCBfZGlzcGxheV91dGlscy5kZXByZWNhdGVkKSgiZ2V0T3BlbkFjdGlvbkRlc3RpbmF0aW9uLCB1c2UgZ2V0T3BlbkFjdGlvbiBpbnN0ZWFkLiIpOwogICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0T3BlbkFjdGlvbigpLnRoZW4oZnVuY3Rpb24gKG9wZW5BY3Rpb24pIHsKICAgICAgICAgICAgcmV0dXJuIG9wZW5BY3Rpb24gJiYgb3BlbkFjdGlvbi5kZXN0ID8gb3BlbkFjdGlvbi5kZXN0IDogbnVsbDsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImdldEF0dGFjaG1lbnRzIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0QXR0YWNobWVudHMoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fdHJhbnNwb3J0LmdldEF0dGFjaG1lbnRzKCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0SmF2YVNjcmlwdCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldEphdmFTY3JpcHQoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fdHJhbnNwb3J0LmdldEphdmFTY3JpcHQoKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJnZXRPdXRsaW5lIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0T3V0bGluZSgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl90cmFuc3BvcnQuZ2V0T3V0bGluZSgpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImdldFBlcm1pc3Npb25zIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UGVybWlzc2lvbnMoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fdHJhbnNwb3J0LmdldFBlcm1pc3Npb25zKCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0TWV0YWRhdGEiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRNZXRhZGF0YSgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl90cmFuc3BvcnQuZ2V0TWV0YWRhdGEoKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJnZXREYXRhIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0RGF0YSgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl90cmFuc3BvcnQuZ2V0RGF0YSgpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImdldERvd25sb2FkSW5mbyIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldERvd25sb2FkSW5mbygpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl90cmFuc3BvcnQuZG93bmxvYWRJbmZvQ2FwYWJpbGl0eS5wcm9taXNlOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImdldFN0YXRzIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0U3RhdHMoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fdHJhbnNwb3J0LmdldFN0YXRzKCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiY2xlYW51cCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNsZWFudXAoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fdHJhbnNwb3J0LnN0YXJ0Q2xlYW51cCgpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImRlc3Ryb3kiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICAgICAgcmV0dXJuIHRoaXMubG9hZGluZ1Rhc2suZGVzdHJveSgpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIm51bVBhZ2VzIiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9wZGZJbmZvLm51bVBhZ2VzOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImZpbmdlcnByaW50IiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9wZGZJbmZvLmZpbmdlcnByaW50OwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImxvYWRpbmdQYXJhbXMiLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX3RyYW5zcG9ydC5sb2FkaW5nUGFyYW1zOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImxvYWRpbmdUYXNrIiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl90cmFuc3BvcnQubG9hZGluZ1Rhc2s7CiAgICAgICAgfQogICAgICB9XSk7CgogICAgICByZXR1cm4gUERGRG9jdW1lbnRQcm94eTsKICAgIH0oKTsKCiAgICBleHBvcnRzLlBERkRvY3VtZW50UHJveHkgPSBQREZEb2N1bWVudFByb3h5OwoKICAgIHZhciBQREZQYWdlUHJveHkgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBQREZQYWdlUHJveHkocGFnZUluZGV4LCBwYWdlSW5mbywgdHJhbnNwb3J0KSB7CiAgICAgICAgdmFyIHBkZkJ1ZyA9IGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzNdIDogZmFsc2U7CgogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBQREZQYWdlUHJveHkpOwoKICAgICAgICB0aGlzLl9wYWdlSW5kZXggPSBwYWdlSW5kZXg7CiAgICAgICAgdGhpcy5fcGFnZUluZm8gPSBwYWdlSW5mbzsKICAgICAgICB0aGlzLl90cmFuc3BvcnQgPSB0cmFuc3BvcnQ7CiAgICAgICAgdGhpcy5fc3RhdHMgPSBwZGZCdWcgPyBuZXcgX2Rpc3BsYXlfdXRpbHMuU3RhdFRpbWVyKCkgOiBudWxsOwogICAgICAgIHRoaXMuX3BkZkJ1ZyA9IHBkZkJ1ZzsKICAgICAgICB0aGlzLmNvbW1vbk9ianMgPSB0cmFuc3BvcnQuY29tbW9uT2JqczsKICAgICAgICB0aGlzLm9ianMgPSBuZXcgUERGT2JqZWN0cygpOwogICAgICAgIHRoaXMuY2xlYW51cEFmdGVyUmVuZGVyID0gZmFsc2U7CiAgICAgICAgdGhpcy5wZW5kaW5nQ2xlYW51cCA9IGZhbHNlOwogICAgICAgIHRoaXMuaW50ZW50U3RhdGVzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICB0aGlzLmRlc3Ryb3llZCA9IGZhbHNlOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoUERGUGFnZVByb3h5LCBbewogICAgICAgIGtleTogImdldFZpZXdwb3J0IiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Vmlld3BvcnQoKSB7CiAgICAgICAgICB2YXIgX3JlZiA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge30sCiAgICAgICAgICAgIHNjYWxlID0gX3JlZi5zY2FsZSwKICAgICAgICAgICAgX3JlZiRyb3RhdGlvbiA9IF9yZWYucm90YXRpb24sCiAgICAgICAgICAgIHJvdGF0aW9uID0gX3JlZiRyb3RhdGlvbiA9PT0gdm9pZCAwID8gdGhpcy5yb3RhdGUgOiBfcmVmJHJvdGF0aW9uLAogICAgICAgICAgICBfcmVmJG9mZnNldFggPSBfcmVmLm9mZnNldFgsCiAgICAgICAgICAgIG9mZnNldFggPSBfcmVmJG9mZnNldFggPT09IHZvaWQgMCA/IDAgOiBfcmVmJG9mZnNldFgsCiAgICAgICAgICAgIF9yZWYkb2Zmc2V0WSA9IF9yZWYub2Zmc2V0WSwKICAgICAgICAgICAgb2Zmc2V0WSA9IF9yZWYkb2Zmc2V0WSA9PT0gdm9pZCAwID8gMCA6IF9yZWYkb2Zmc2V0WSwKICAgICAgICAgICAgX3JlZiRkb250RmxpcCA9IF9yZWYuZG9udEZsaXAsCiAgICAgICAgICAgIGRvbnRGbGlwID0gX3JlZiRkb250RmxpcCA9PT0gdm9pZCAwID8gZmFsc2UgOiBfcmVmJGRvbnRGbGlwOwoKICAgICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMSB8fCB0eXBlb2YgYXJndW1lbnRzWzBdID09PSAibnVtYmVyIikgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlBERlBhZ2VQcm94eS5nZXRWaWV3cG9ydCBpcyBjYWxsZWQgd2l0aCBvYnNvbGV0ZSBhcmd1bWVudHMuIik7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIG5ldyBfZGlzcGxheV91dGlscy5QYWdlVmlld3BvcnQoewogICAgICAgICAgICB2aWV3Qm94OiB0aGlzLnZpZXcsCiAgICAgICAgICAgIHNjYWxlOiBzY2FsZSwKICAgICAgICAgICAgcm90YXRpb246IHJvdGF0aW9uLAogICAgICAgICAgICBvZmZzZXRYOiBvZmZzZXRYLAogICAgICAgICAgICBvZmZzZXRZOiBvZmZzZXRZLAogICAgICAgICAgICBkb250RmxpcDogZG9udEZsaXAKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImdldEFubm90YXRpb25zIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0QW5ub3RhdGlvbnMoKSB7CiAgICAgICAgICB2YXIgX3JlZjIgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9LAogICAgICAgICAgICBfcmVmMiRpbnRlbnQgPSBfcmVmMi5pbnRlbnQsCiAgICAgICAgICAgIGludGVudCA9IF9yZWYyJGludGVudCA9PT0gdm9pZCAwID8gbnVsbCA6IF9yZWYyJGludGVudDsKCiAgICAgICAgICBpZiAoIXRoaXMuYW5ub3RhdGlvbnNQcm9taXNlIHx8IHRoaXMuYW5ub3RhdGlvbnNJbnRlbnQgIT09IGludGVudCkgewogICAgICAgICAgICB0aGlzLmFubm90YXRpb25zUHJvbWlzZSA9IHRoaXMuX3RyYW5zcG9ydC5nZXRBbm5vdGF0aW9ucyh0aGlzLl9wYWdlSW5kZXgsIGludGVudCk7CiAgICAgICAgICAgIHRoaXMuYW5ub3RhdGlvbnNJbnRlbnQgPSBpbnRlbnQ7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHRoaXMuYW5ub3RhdGlvbnNQcm9taXNlOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInJlbmRlciIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcihfcmVmMykgewogICAgICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CgogICAgICAgICAgdmFyIGNhbnZhc0NvbnRleHQgPSBfcmVmMy5jYW52YXNDb250ZXh0LAogICAgICAgICAgICB2aWV3cG9ydCA9IF9yZWYzLnZpZXdwb3J0LAogICAgICAgICAgICBfcmVmMyRpbnRlbnQgPSBfcmVmMy5pbnRlbnQsCiAgICAgICAgICAgIGludGVudCA9IF9yZWYzJGludGVudCA9PT0gdm9pZCAwID8gImRpc3BsYXkiIDogX3JlZjMkaW50ZW50LAogICAgICAgICAgICBfcmVmMyRlbmFibGVXZWJHTCA9IF9yZWYzLmVuYWJsZVdlYkdMLAogICAgICAgICAgICBlbmFibGVXZWJHTCA9IF9yZWYzJGVuYWJsZVdlYkdMID09PSB2b2lkIDAgPyBmYWxzZSA6IF9yZWYzJGVuYWJsZVdlYkdMLAogICAgICAgICAgICBfcmVmMyRyZW5kZXJJbnRlcmFjdGkgPSBfcmVmMy5yZW5kZXJJbnRlcmFjdGl2ZUZvcm1zLAogICAgICAgICAgICByZW5kZXJJbnRlcmFjdGl2ZUZvcm1zID0gX3JlZjMkcmVuZGVySW50ZXJhY3RpID09PSB2b2lkIDAgPyBmYWxzZSA6IF9yZWYzJHJlbmRlckludGVyYWN0aSwKICAgICAgICAgICAgX3JlZjMkdHJhbnNmb3JtID0gX3JlZjMudHJhbnNmb3JtLAogICAgICAgICAgICB0cmFuc2Zvcm0gPSBfcmVmMyR0cmFuc2Zvcm0gPT09IHZvaWQgMCA/IG51bGwgOiBfcmVmMyR0cmFuc2Zvcm0sCiAgICAgICAgICAgIF9yZWYzJGltYWdlTGF5ZXIgPSBfcmVmMy5pbWFnZUxheWVyLAogICAgICAgICAgICBpbWFnZUxheWVyID0gX3JlZjMkaW1hZ2VMYXllciA9PT0gdm9pZCAwID8gbnVsbCA6IF9yZWYzJGltYWdlTGF5ZXIsCiAgICAgICAgICAgIF9yZWYzJGNhbnZhc0ZhY3RvcnkgPSBfcmVmMy5jYW52YXNGYWN0b3J5LAogICAgICAgICAgICBjYW52YXNGYWN0b3J5ID0gX3JlZjMkY2FudmFzRmFjdG9yeSA9PT0gdm9pZCAwID8gbnVsbCA6IF9yZWYzJGNhbnZhc0ZhY3RvcnksCiAgICAgICAgICAgIF9yZWYzJGJhY2tncm91bmQgPSBfcmVmMy5iYWNrZ3JvdW5kLAogICAgICAgICAgICBiYWNrZ3JvdW5kID0gX3JlZjMkYmFja2dyb3VuZCA9PT0gdm9pZCAwID8gbnVsbCA6IF9yZWYzJGJhY2tncm91bmQ7CgogICAgICAgICAgaWYgKHRoaXMuX3N0YXRzKSB7CiAgICAgICAgICAgIHRoaXMuX3N0YXRzLnRpbWUoIk92ZXJhbGwiKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcmVuZGVyaW5nSW50ZW50ID0gaW50ZW50ID09PSAicHJpbnQiID8gInByaW50IiA6ICJkaXNwbGF5IjsKICAgICAgICAgIHRoaXMucGVuZGluZ0NsZWFudXAgPSBmYWxzZTsKCiAgICAgICAgICBpZiAoIXRoaXMuaW50ZW50U3RhdGVzW3JlbmRlcmluZ0ludGVudF0pIHsKICAgICAgICAgICAgdGhpcy5pbnRlbnRTdGF0ZXNbcmVuZGVyaW5nSW50ZW50XSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGludGVudFN0YXRlID0gdGhpcy5pbnRlbnRTdGF0ZXNbcmVuZGVyaW5nSW50ZW50XTsKCiAgICAgICAgICBpZiAoaW50ZW50U3RhdGUuc3RyZWFtUmVhZGVyQ2FuY2VsVGltZW91dCkgewogICAgICAgICAgICBjbGVhclRpbWVvdXQoaW50ZW50U3RhdGUuc3RyZWFtUmVhZGVyQ2FuY2VsVGltZW91dCk7CiAgICAgICAgICAgIGludGVudFN0YXRlLnN0cmVhbVJlYWRlckNhbmNlbFRpbWVvdXQgPSBudWxsOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBjYW52YXNGYWN0b3J5SW5zdGFuY2UgPSBjYW52YXNGYWN0b3J5IHx8IG5ldyBfZGlzcGxheV91dGlscy5ET01DYW52YXNGYWN0b3J5KCk7CiAgICAgICAgICB2YXIgd2ViR0xDb250ZXh0ID0gbmV3IF93ZWJnbC5XZWJHTENvbnRleHQoewogICAgICAgICAgICBlbmFibGU6IGVuYWJsZVdlYkdMCiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAoIWludGVudFN0YXRlLmRpc3BsYXlSZWFkeUNhcGFiaWxpdHkpIHsKICAgICAgICAgICAgaW50ZW50U3RhdGUuZGlzcGxheVJlYWR5Q2FwYWJpbGl0eSA9ICgwLCBfdXRpbC5jcmVhdGVQcm9taXNlQ2FwYWJpbGl0eSkoKTsKICAgICAgICAgICAgaW50ZW50U3RhdGUub3BlcmF0b3JMaXN0ID0gewogICAgICAgICAgICAgIGZuQXJyYXk6IFtdLAogICAgICAgICAgICAgIGFyZ3NBcnJheTogW10sCiAgICAgICAgICAgICAgbGFzdENodW5rOiBmYWxzZQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgaWYgKHRoaXMuX3N0YXRzKSB7CiAgICAgICAgICAgICAgdGhpcy5fc3RhdHMudGltZSgiUGFnZSBSZXF1ZXN0Iik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuX3B1bXBPcGVyYXRvckxpc3QoewogICAgICAgICAgICAgIHBhZ2VJbmRleDogdGhpcy5fcGFnZUluZGV4LAogICAgICAgICAgICAgIGludGVudDogcmVuZGVyaW5nSW50ZW50LAogICAgICAgICAgICAgIHJlbmRlckludGVyYWN0aXZlRm9ybXM6IHJlbmRlckludGVyYWN0aXZlRm9ybXMgPT09IHRydWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGNvbXBsZXRlID0gZnVuY3Rpb24gY29tcGxldGUoZXJyb3IpIHsKICAgICAgICAgICAgdmFyIGkgPSBpbnRlbnRTdGF0ZS5yZW5kZXJUYXNrcy5pbmRleE9mKGludGVybmFsUmVuZGVyVGFzayk7CgogICAgICAgICAgICBpZiAoaSA+PSAwKSB7CiAgICAgICAgICAgICAgaW50ZW50U3RhdGUucmVuZGVyVGFza3Muc3BsaWNlKGksIDEpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoX3RoaXM1LmNsZWFudXBBZnRlclJlbmRlciB8fCByZW5kZXJpbmdJbnRlbnQgPT09ICJwcmludCIpIHsKICAgICAgICAgICAgICBfdGhpczUucGVuZGluZ0NsZWFudXAgPSB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfdGhpczUuX3RyeUNsZWFudXAoKTsKCiAgICAgICAgICAgIGlmIChlcnJvcikgewogICAgICAgICAgICAgIGludGVybmFsUmVuZGVyVGFzay5jYXBhYmlsaXR5LnJlamVjdChlcnJvcik7CgogICAgICAgICAgICAgIF90aGlzNS5fYWJvcnRPcGVyYXRvckxpc3QoewogICAgICAgICAgICAgICAgaW50ZW50U3RhdGU6IGludGVudFN0YXRlLAogICAgICAgICAgICAgICAgcmVhc29uOiBlcnJvcgogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGludGVybmFsUmVuZGVyVGFzay5jYXBhYmlsaXR5LnJlc29sdmUoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKF90aGlzNS5fc3RhdHMpIHsKICAgICAgICAgICAgICBfdGhpczUuX3N0YXRzLnRpbWVFbmQoIlJlbmRlcmluZyIpOwoKICAgICAgICAgICAgICBfdGhpczUuX3N0YXRzLnRpbWVFbmQoIk92ZXJhbGwiKTsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKCiAgICAgICAgICB2YXIgaW50ZXJuYWxSZW5kZXJUYXNrID0gbmV3IEludGVybmFsUmVuZGVyVGFzayh7CiAgICAgICAgICAgIGNhbGxiYWNrOiBjb21wbGV0ZSwKICAgICAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgICAgY2FudmFzQ29udGV4dDogY2FudmFzQ29udGV4dCwKICAgICAgICAgICAgICB2aWV3cG9ydDogdmlld3BvcnQsCiAgICAgICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2Zvcm0sCiAgICAgICAgICAgICAgaW1hZ2VMYXllcjogaW1hZ2VMYXllciwKICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiBiYWNrZ3JvdW5kCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9ianM6IHRoaXMub2JqcywKICAgICAgICAgICAgY29tbW9uT2JqczogdGhpcy5jb21tb25PYmpzLAogICAgICAgICAgICBvcGVyYXRvckxpc3Q6IGludGVudFN0YXRlLm9wZXJhdG9yTGlzdCwKICAgICAgICAgICAgcGFnZUluZGV4OiB0aGlzLl9wYWdlSW5kZXgsCiAgICAgICAgICAgIGNhbnZhc0ZhY3Rvcnk6IGNhbnZhc0ZhY3RvcnlJbnN0YW5jZSwKICAgICAgICAgICAgd2ViR0xDb250ZXh0OiB3ZWJHTENvbnRleHQsCiAgICAgICAgICAgIHVzZVJlcXVlc3RBbmltYXRpb25GcmFtZTogcmVuZGVyaW5nSW50ZW50ICE9PSAicHJpbnQiLAogICAgICAgICAgICBwZGZCdWc6IHRoaXMuX3BkZkJ1ZwogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKCFpbnRlbnRTdGF0ZS5yZW5kZXJUYXNrcykgewogICAgICAgICAgICBpbnRlbnRTdGF0ZS5yZW5kZXJUYXNrcyA9IFtdOwogICAgICAgICAgfQoKICAgICAgICAgIGludGVudFN0YXRlLnJlbmRlclRhc2tzLnB1c2goaW50ZXJuYWxSZW5kZXJUYXNrKTsKICAgICAgICAgIHZhciByZW5kZXJUYXNrID0gaW50ZXJuYWxSZW5kZXJUYXNrLnRhc2s7CiAgICAgICAgICBpbnRlbnRTdGF0ZS5kaXNwbGF5UmVhZHlDYXBhYmlsaXR5LnByb21pc2UudGhlbihmdW5jdGlvbiAodHJhbnNwYXJlbmN5KSB7CiAgICAgICAgICAgIGlmIChfdGhpczUucGVuZGluZ0NsZWFudXApIHsKICAgICAgICAgICAgICBjb21wbGV0ZSgpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKF90aGlzNS5fc3RhdHMpIHsKICAgICAgICAgICAgICBfdGhpczUuX3N0YXRzLnRpbWUoIlJlbmRlcmluZyIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpbnRlcm5hbFJlbmRlclRhc2suaW5pdGlhbGl6ZUdyYXBoaWNzKHRyYW5zcGFyZW5jeSk7CiAgICAgICAgICAgIGludGVybmFsUmVuZGVyVGFzay5vcGVyYXRvckxpc3RDaGFuZ2VkKCk7CiAgICAgICAgICB9KVsiY2F0Y2giXShjb21wbGV0ZSk7CiAgICAgICAgICByZXR1cm4gcmVuZGVyVGFzazsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJnZXRPcGVyYXRvckxpc3QiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRPcGVyYXRvckxpc3QoKSB7CiAgICAgICAgICBmdW5jdGlvbiBvcGVyYXRvckxpc3RDaGFuZ2VkKCkgewogICAgICAgICAgICBpZiAoaW50ZW50U3RhdGUub3BlcmF0b3JMaXN0Lmxhc3RDaHVuaykgewogICAgICAgICAgICAgIGludGVudFN0YXRlLm9wTGlzdFJlYWRDYXBhYmlsaXR5LnJlc29sdmUoaW50ZW50U3RhdGUub3BlcmF0b3JMaXN0KTsKICAgICAgICAgICAgICB2YXIgaSA9IGludGVudFN0YXRlLnJlbmRlclRhc2tzLmluZGV4T2Yob3BMaXN0VGFzayk7CgogICAgICAgICAgICAgIGlmIChpID49IDApIHsKICAgICAgICAgICAgICAgIGludGVudFN0YXRlLnJlbmRlclRhc2tzLnNwbGljZShpLCAxKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcmVuZGVyaW5nSW50ZW50ID0gIm9wbGlzdCI7CgogICAgICAgICAgaWYgKCF0aGlzLmludGVudFN0YXRlc1tyZW5kZXJpbmdJbnRlbnRdKSB7CiAgICAgICAgICAgIHRoaXMuaW50ZW50U3RhdGVzW3JlbmRlcmluZ0ludGVudF0gPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBpbnRlbnRTdGF0ZSA9IHRoaXMuaW50ZW50U3RhdGVzW3JlbmRlcmluZ0ludGVudF07CiAgICAgICAgICB2YXIgb3BMaXN0VGFzazsKCiAgICAgICAgICBpZiAoIWludGVudFN0YXRlLm9wTGlzdFJlYWRDYXBhYmlsaXR5KSB7CiAgICAgICAgICAgIG9wTGlzdFRhc2sgPSB7fTsKICAgICAgICAgICAgb3BMaXN0VGFzay5vcGVyYXRvckxpc3RDaGFuZ2VkID0gb3BlcmF0b3JMaXN0Q2hhbmdlZDsKICAgICAgICAgICAgaW50ZW50U3RhdGUub3BMaXN0UmVhZENhcGFiaWxpdHkgPSAoMCwgX3V0aWwuY3JlYXRlUHJvbWlzZUNhcGFiaWxpdHkpKCk7CiAgICAgICAgICAgIGludGVudFN0YXRlLnJlbmRlclRhc2tzID0gW107CiAgICAgICAgICAgIGludGVudFN0YXRlLnJlbmRlclRhc2tzLnB1c2gob3BMaXN0VGFzayk7CiAgICAgICAgICAgIGludGVudFN0YXRlLm9wZXJhdG9yTGlzdCA9IHsKICAgICAgICAgICAgICBmbkFycmF5OiBbXSwKICAgICAgICAgICAgICBhcmdzQXJyYXk6IFtdLAogICAgICAgICAgICAgIGxhc3RDaHVuazogZmFsc2UKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGlmICh0aGlzLl9zdGF0cykgewogICAgICAgICAgICAgIHRoaXMuX3N0YXRzLnRpbWUoIlBhZ2UgUmVxdWVzdCIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLl9wdW1wT3BlcmF0b3JMaXN0KHsKICAgICAgICAgICAgICBwYWdlSW5kZXg6IHRoaXMuX3BhZ2VJbmRleCwKICAgICAgICAgICAgICBpbnRlbnQ6IHJlbmRlcmluZ0ludGVudAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gaW50ZW50U3RhdGUub3BMaXN0UmVhZENhcGFiaWxpdHkucHJvbWlzZTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJzdHJlYW1UZXh0Q29udGVudCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHN0cmVhbVRleHRDb250ZW50KCkgewogICAgICAgICAgdmFyIF9yZWY0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fSwKICAgICAgICAgICAgX3JlZjQkbm9ybWFsaXplV2hpdGVzID0gX3JlZjQubm9ybWFsaXplV2hpdGVzcGFjZSwKICAgICAgICAgICAgbm9ybWFsaXplV2hpdGVzcGFjZSA9IF9yZWY0JG5vcm1hbGl6ZVdoaXRlcyA9PT0gdm9pZCAwID8gZmFsc2UgOiBfcmVmNCRub3JtYWxpemVXaGl0ZXMsCiAgICAgICAgICAgIF9yZWY0JGRpc2FibGVDb21iaW5lVCA9IF9yZWY0LmRpc2FibGVDb21iaW5lVGV4dEl0ZW1zLAogICAgICAgICAgICBkaXNhYmxlQ29tYmluZVRleHRJdGVtcyA9IF9yZWY0JGRpc2FibGVDb21iaW5lVCA9PT0gdm9pZCAwID8gZmFsc2UgOiBfcmVmNCRkaXNhYmxlQ29tYmluZVQ7CgogICAgICAgICAgdmFyIFRFWFRfQ09OVEVOVF9DSFVOS19TSVpFID0gMTAwOwogICAgICAgICAgcmV0dXJuIHRoaXMuX3RyYW5zcG9ydC5tZXNzYWdlSGFuZGxlci5zZW5kV2l0aFN0cmVhbSgiR2V0VGV4dENvbnRlbnQiLCB7CiAgICAgICAgICAgIHBhZ2VJbmRleDogdGhpcy5fcGFnZUluZGV4LAogICAgICAgICAgICBub3JtYWxpemVXaGl0ZXNwYWNlOiBub3JtYWxpemVXaGl0ZXNwYWNlID09PSB0cnVlLAogICAgICAgICAgICBjb21iaW5lVGV4dEl0ZW1zOiBkaXNhYmxlQ29tYmluZVRleHRJdGVtcyAhPT0gdHJ1ZQogICAgICAgICAgfSwgewogICAgICAgICAgICBoaWdoV2F0ZXJNYXJrOiBURVhUX0NPTlRFTlRfQ0hVTktfU0laRSwKICAgICAgICAgICAgc2l6ZTogZnVuY3Rpb24gc2l6ZSh0ZXh0Q29udGVudCkgewogICAgICAgICAgICAgIHJldHVybiB0ZXh0Q29udGVudC5pdGVtcy5sZW5ndGg7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImdldFRleHRDb250ZW50IiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0VGV4dENvbnRlbnQoKSB7CiAgICAgICAgICB2YXIgcGFyYW1zID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTsKICAgICAgICAgIHZhciByZWFkYWJsZVN0cmVhbSA9IHRoaXMuc3RyZWFtVGV4dENvbnRlbnQocGFyYW1zKTsKICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIHB1bXAoKSB7CiAgICAgICAgICAgICAgcmVhZGVyLnJlYWQoKS50aGVuKGZ1bmN0aW9uIChfcmVmNSkgewogICAgICAgICAgICAgICAgdmFyIF90ZXh0Q29udGVudCRpdGVtczsKCiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBfcmVmNS52YWx1ZSwKICAgICAgICAgICAgICAgICAgZG9uZSA9IF9yZWY1LmRvbmU7CgogICAgICAgICAgICAgICAgaWYgKGRvbmUpIHsKICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh0ZXh0Q29udGVudCk7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRleHRDb250ZW50LnN0eWxlcywgdmFsdWUuc3R5bGVzKTsKCiAgICAgICAgICAgICAgICAoX3RleHRDb250ZW50JGl0ZW1zID0gdGV4dENvbnRlbnQuaXRlbXMpLnB1c2guYXBwbHkoX3RleHRDb250ZW50JGl0ZW1zLCBfdG9Db25zdW1hYmxlQXJyYXkodmFsdWUuaXRlbXMpKTsKCiAgICAgICAgICAgICAgICBwdW1wKCk7CiAgICAgICAgICAgICAgfSwgcmVqZWN0KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHJlYWRlciA9IHJlYWRhYmxlU3RyZWFtLmdldFJlYWRlcigpOwogICAgICAgICAgICB2YXIgdGV4dENvbnRlbnQgPSB7CiAgICAgICAgICAgICAgaXRlbXM6IFtdLAogICAgICAgICAgICAgIHN0eWxlczogT2JqZWN0LmNyZWF0ZShudWxsKQogICAgICAgICAgICB9OwogICAgICAgICAgICBwdW1wKCk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJfZGVzdHJveSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9kZXN0cm95KCkgewogICAgICAgICAgdmFyIF90aGlzNiA9IHRoaXM7CgogICAgICAgICAgdGhpcy5kZXN0cm95ZWQgPSB0cnVlOwogICAgICAgICAgdGhpcy5fdHJhbnNwb3J0LnBhZ2VDYWNoZVt0aGlzLl9wYWdlSW5kZXhdID0gbnVsbDsKICAgICAgICAgIHZhciB3YWl0T24gPSBbXTsKICAgICAgICAgIE9iamVjdC5rZXlzKHRoaXMuaW50ZW50U3RhdGVzKS5mb3JFYWNoKGZ1bmN0aW9uIChpbnRlbnQpIHsKICAgICAgICAgICAgdmFyIGludGVudFN0YXRlID0gX3RoaXM2LmludGVudFN0YXRlc1tpbnRlbnRdOwoKICAgICAgICAgICAgX3RoaXM2Ll9hYm9ydE9wZXJhdG9yTGlzdCh7CiAgICAgICAgICAgICAgaW50ZW50U3RhdGU6IGludGVudFN0YXRlLAogICAgICAgICAgICAgIHJlYXNvbjogbmV3IEVycm9yKCJQYWdlIHdhcyBkZXN0cm95ZWQuIiksCiAgICAgICAgICAgICAgZm9yY2U6IHRydWUKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAoaW50ZW50ID09PSAib3BsaXN0IikgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaW50ZW50U3RhdGUucmVuZGVyVGFza3MuZm9yRWFjaChmdW5jdGlvbiAocmVuZGVyVGFzaykgewogICAgICAgICAgICAgIHZhciByZW5kZXJDb21wbGV0ZWQgPSByZW5kZXJUYXNrLmNhcGFiaWxpdHkucHJvbWlzZVsiY2F0Y2giXShmdW5jdGlvbiAoKSB7fSk7CiAgICAgICAgICAgICAgd2FpdE9uLnB1c2gocmVuZGVyQ29tcGxldGVkKTsKICAgICAgICAgICAgICByZW5kZXJUYXNrLmNhbmNlbCgpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5vYmpzLmNsZWFyKCk7CiAgICAgICAgICB0aGlzLmFubm90YXRpb25zUHJvbWlzZSA9IG51bGw7CiAgICAgICAgICB0aGlzLnBlbmRpbmdDbGVhbnVwID0gZmFsc2U7CiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwod2FpdE9uKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJjbGVhbnVwIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY2xlYW51cCgpIHsKICAgICAgICAgIHZhciByZXNldFN0YXRzID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBmYWxzZTsKICAgICAgICAgIHRoaXMucGVuZGluZ0NsZWFudXAgPSB0cnVlOwogICAgICAgICAgcmV0dXJuIHRoaXMuX3RyeUNsZWFudXAocmVzZXRTdGF0cyk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiX3RyeUNsZWFudXAiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfdHJ5Q2xlYW51cCgpIHsKICAgICAgICAgIHZhciBfdGhpczcgPSB0aGlzOwoKICAgICAgICAgIHZhciByZXNldFN0YXRzID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBmYWxzZTsKCiAgICAgICAgICBpZiAoIXRoaXMucGVuZGluZ0NsZWFudXAgfHwgT2JqZWN0LmtleXModGhpcy5pbnRlbnRTdGF0ZXMpLnNvbWUoZnVuY3Rpb24gKGludGVudCkgewogICAgICAgICAgICB2YXIgaW50ZW50U3RhdGUgPSBfdGhpczcuaW50ZW50U3RhdGVzW2ludGVudF07CiAgICAgICAgICAgIHJldHVybiBpbnRlbnRTdGF0ZS5yZW5kZXJUYXNrcy5sZW5ndGggIT09IDAgfHwgIWludGVudFN0YXRlLm9wZXJhdG9yTGlzdC5sYXN0Q2h1bms7CiAgICAgICAgICB9KSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgT2JqZWN0LmtleXModGhpcy5pbnRlbnRTdGF0ZXMpLmZvckVhY2goZnVuY3Rpb24gKGludGVudCkgewogICAgICAgICAgICBkZWxldGUgX3RoaXM3LmludGVudFN0YXRlc1tpbnRlbnRdOwogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLm9ianMuY2xlYXIoKTsKICAgICAgICAgIHRoaXMuYW5ub3RhdGlvbnNQcm9taXNlID0gbnVsbDsKCiAgICAgICAgICBpZiAocmVzZXRTdGF0cyAmJiB0aGlzLl9zdGF0cykgewogICAgICAgICAgICB0aGlzLl9zdGF0cyA9IG5ldyBfZGlzcGxheV91dGlscy5TdGF0VGltZXIoKTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnBlbmRpbmdDbGVhbnVwID0gZmFsc2U7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJfc3RhcnRSZW5kZXJQYWdlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX3N0YXJ0UmVuZGVyUGFnZSh0cmFuc3BhcmVuY3ksIGludGVudCkgewogICAgICAgICAgdmFyIGludGVudFN0YXRlID0gdGhpcy5pbnRlbnRTdGF0ZXNbaW50ZW50XTsKCiAgICAgICAgICBpZiAoIWludGVudFN0YXRlKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodGhpcy5fc3RhdHMpIHsKICAgICAgICAgICAgdGhpcy5fc3RhdHMudGltZUVuZCgiUGFnZSBSZXF1ZXN0Iik7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGludGVudFN0YXRlLmRpc3BsYXlSZWFkeUNhcGFiaWxpdHkpIHsKICAgICAgICAgICAgaW50ZW50U3RhdGUuZGlzcGxheVJlYWR5Q2FwYWJpbGl0eS5yZXNvbHZlKHRyYW5zcGFyZW5jeSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiX3JlbmRlclBhZ2VDaHVuayIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9yZW5kZXJQYWdlQ2h1bmsob3BlcmF0b3JMaXN0Q2h1bmssIGludGVudFN0YXRlKSB7CiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBvcGVyYXRvckxpc3RDaHVuay5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgIGludGVudFN0YXRlLm9wZXJhdG9yTGlzdC5mbkFycmF5LnB1c2gob3BlcmF0b3JMaXN0Q2h1bmsuZm5BcnJheVtpXSk7CiAgICAgICAgICAgIGludGVudFN0YXRlLm9wZXJhdG9yTGlzdC5hcmdzQXJyYXkucHVzaChvcGVyYXRvckxpc3RDaHVuay5hcmdzQXJyYXlbaV0pOwogICAgICAgICAgfQoKICAgICAgICAgIGludGVudFN0YXRlLm9wZXJhdG9yTGlzdC5sYXN0Q2h1bmsgPSBvcGVyYXRvckxpc3RDaHVuay5sYXN0Q2h1bms7CgogICAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGludGVudFN0YXRlLnJlbmRlclRhc2tzLmxlbmd0aDsgX2krKykgewogICAgICAgICAgICBpbnRlbnRTdGF0ZS5yZW5kZXJUYXNrc1tfaV0ub3BlcmF0b3JMaXN0Q2hhbmdlZCgpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChvcGVyYXRvckxpc3RDaHVuay5sYXN0Q2h1bmspIHsKICAgICAgICAgICAgdGhpcy5fdHJ5Q2xlYW51cCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIl9wdW1wT3BlcmF0b3JMaXN0IiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX3B1bXBPcGVyYXRvckxpc3QoYXJncykgewogICAgICAgICAgdmFyIF90aGlzOCA9IHRoaXM7CgogICAgICAgICAgKDAsIF91dGlsLmFzc2VydCkoYXJncy5pbnRlbnQsICdQREZQYWdlUHJveHkuX3B1bXBPcGVyYXRvckxpc3Q6IEV4cGVjdGVkICJpbnRlbnQiIGFyZ3VtZW50LicpOwoKICAgICAgICAgIHZhciByZWFkYWJsZVN0cmVhbSA9IHRoaXMuX3RyYW5zcG9ydC5tZXNzYWdlSGFuZGxlci5zZW5kV2l0aFN0cmVhbSgiR2V0T3BlcmF0b3JMaXN0IiwgYXJncyk7CgogICAgICAgICAgdmFyIHJlYWRlciA9IHJlYWRhYmxlU3RyZWFtLmdldFJlYWRlcigpOwogICAgICAgICAgdmFyIGludGVudFN0YXRlID0gdGhpcy5pbnRlbnRTdGF0ZXNbYXJncy5pbnRlbnRdOwogICAgICAgICAgaW50ZW50U3RhdGUuc3RyZWFtUmVhZGVyID0gcmVhZGVyOwoKICAgICAgICAgIHZhciBwdW1wID0gZnVuY3Rpb24gcHVtcCgpIHsKICAgICAgICAgICAgcmVhZGVyLnJlYWQoKS50aGVuKGZ1bmN0aW9uIChfcmVmNikgewogICAgICAgICAgICAgIHZhciB2YWx1ZSA9IF9yZWY2LnZhbHVlLAogICAgICAgICAgICAgICAgZG9uZSA9IF9yZWY2LmRvbmU7CgogICAgICAgICAgICAgIGlmIChkb25lKSB7CiAgICAgICAgICAgICAgICBpbnRlbnRTdGF0ZS5zdHJlYW1SZWFkZXIgPSBudWxsOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKF90aGlzOC5fdHJhbnNwb3J0LmRlc3Ryb3llZCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX3RoaXM4Ll9yZW5kZXJQYWdlQ2h1bmsodmFsdWUsIGludGVudFN0YXRlKTsKCiAgICAgICAgICAgICAgcHVtcCgpOwogICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICAgICAgaW50ZW50U3RhdGUuc3RyZWFtUmVhZGVyID0gbnVsbDsKCiAgICAgICAgICAgICAgaWYgKF90aGlzOC5fdHJhbnNwb3J0LmRlc3Ryb3llZCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGludGVudFN0YXRlLm9wZXJhdG9yTGlzdCkgewogICAgICAgICAgICAgICAgaW50ZW50U3RhdGUub3BlcmF0b3JMaXN0Lmxhc3RDaHVuayA9IHRydWU7CgogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbnRlbnRTdGF0ZS5yZW5kZXJUYXNrcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICBpbnRlbnRTdGF0ZS5yZW5kZXJUYXNrc1tpXS5vcGVyYXRvckxpc3RDaGFuZ2VkKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX3RoaXM4Ll90cnlDbGVhbnVwKCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoaW50ZW50U3RhdGUuZGlzcGxheVJlYWR5Q2FwYWJpbGl0eSkgewogICAgICAgICAgICAgICAgaW50ZW50U3RhdGUuZGlzcGxheVJlYWR5Q2FwYWJpbGl0eS5yZWplY3QocmVhc29uKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGludGVudFN0YXRlLm9wTGlzdFJlYWRDYXBhYmlsaXR5KSB7CiAgICAgICAgICAgICAgICBpbnRlbnRTdGF0ZS5vcExpc3RSZWFkQ2FwYWJpbGl0eS5yZWplY3QocmVhc29uKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhyb3cgcmVhc29uOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9OwoKICAgICAgICAgIHB1bXAoKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJfYWJvcnRPcGVyYXRvckxpc3QiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfYWJvcnRPcGVyYXRvckxpc3QoX3JlZjcpIHsKICAgICAgICAgIHZhciBfdGhpczkgPSB0aGlzOwoKICAgICAgICAgIHZhciBpbnRlbnRTdGF0ZSA9IF9yZWY3LmludGVudFN0YXRlLAogICAgICAgICAgICByZWFzb24gPSBfcmVmNy5yZWFzb24sCiAgICAgICAgICAgIF9yZWY3JGZvcmNlID0gX3JlZjcuZm9yY2UsCiAgICAgICAgICAgIGZvcmNlID0gX3JlZjckZm9yY2UgPT09IHZvaWQgMCA/IGZhbHNlIDogX3JlZjckZm9yY2U7CiAgICAgICAgICAoMCwgX3V0aWwuYXNzZXJ0KShyZWFzb24gaW5zdGFuY2VvZiBFcnJvciB8fCBfdHlwZW9mKHJlYXNvbikgPT09ICJvYmplY3QiICYmIHJlYXNvbiAhPT0gbnVsbCwgJ1BERlBhZ2VQcm94eS5fYWJvcnRPcGVyYXRvckxpc3Q6IEV4cGVjdGVkICJyZWFzb24iIGFyZ3VtZW50LicpOwoKICAgICAgICAgIGlmICghaW50ZW50U3RhdGUuc3RyZWFtUmVhZGVyKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWZvcmNlKSB7CiAgICAgICAgICAgIGlmIChpbnRlbnRTdGF0ZS5yZW5kZXJUYXNrcy5sZW5ndGggIT09IDApIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChyZWFzb24gaW5zdGFuY2VvZiBfZGlzcGxheV91dGlscy5SZW5kZXJpbmdDYW5jZWxsZWRFeGNlcHRpb24pIHsKICAgICAgICAgICAgICBpbnRlbnRTdGF0ZS5zdHJlYW1SZWFkZXJDYW5jZWxUaW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBfdGhpczkuX2Fib3J0T3BlcmF0b3JMaXN0KHsKICAgICAgICAgICAgICAgICAgaW50ZW50U3RhdGU6IGludGVudFN0YXRlLAogICAgICAgICAgICAgICAgICByZWFzb246IHJlYXNvbiwKICAgICAgICAgICAgICAgICAgZm9yY2U6IHRydWUKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGludGVudFN0YXRlLnN0cmVhbVJlYWRlckNhbmNlbFRpbWVvdXQgPSBudWxsOwogICAgICAgICAgICAgIH0sIFJFTkRFUklOR19DQU5DRUxMRURfVElNRU9VVCk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaW50ZW50U3RhdGUuc3RyZWFtUmVhZGVyLmNhbmNlbChuZXcgX3V0aWwuQWJvcnRFeGNlcHRpb24ocmVhc29uICYmIHJlYXNvbi5tZXNzYWdlKSk7CiAgICAgICAgICBpbnRlbnRTdGF0ZS5zdHJlYW1SZWFkZXIgPSBudWxsOwoKICAgICAgICAgIGlmICh0aGlzLl90cmFuc3BvcnQuZGVzdHJveWVkKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBPYmplY3Qua2V5cyh0aGlzLmludGVudFN0YXRlcykuc29tZShmdW5jdGlvbiAoaW50ZW50KSB7CiAgICAgICAgICAgIGlmIChfdGhpczkuaW50ZW50U3RhdGVzW2ludGVudF0gPT09IGludGVudFN0YXRlKSB7CiAgICAgICAgICAgICAgZGVsZXRlIF90aGlzOS5pbnRlbnRTdGF0ZXNbaW50ZW50XTsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLmNsZWFudXAoKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJwYWdlTnVtYmVyIiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9wYWdlSW5kZXggKyAxOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInJvdGF0ZSIsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fcGFnZUluZm8ucm90YXRlOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInJlZiIsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fcGFnZUluZm8ucmVmOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInVzZXJVbml0IiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9wYWdlSW5mby51c2VyVW5pdDsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJ2aWV3IiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9wYWdlSW5mby52aWV3OwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInN0YXRzIiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9zdGF0czsKICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBQREZQYWdlUHJveHk7CiAgICB9KCk7CgogICAgZXhwb3J0cy5QREZQYWdlUHJveHkgPSBQREZQYWdlUHJveHk7CgogICAgdmFyIExvb3BiYWNrUG9ydCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgIGZ1bmN0aW9uIExvb3BiYWNrUG9ydCgpIHsKICAgICAgICB2YXIgZGVmZXIgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHRydWU7CgogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBMb29wYmFja1BvcnQpOwoKICAgICAgICB0aGlzLl9saXN0ZW5lcnMgPSBbXTsKICAgICAgICB0aGlzLl9kZWZlciA9IGRlZmVyOwogICAgICAgIHRoaXMuX2RlZmVycmVkID0gUHJvbWlzZS5yZXNvbHZlKHVuZGVmaW5lZCk7CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhMb29wYmFja1BvcnQsIFt7CiAgICAgICAga2V5OiAicG9zdE1lc3NhZ2UiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBwb3N0TWVzc2FnZShvYmosIHRyYW5zZmVycykgewogICAgICAgICAgdmFyIF90aGlzMTAgPSB0aGlzOwoKICAgICAgICAgIGZ1bmN0aW9uIGNsb25lVmFsdWUodmFsdWUpIHsKICAgICAgICAgICAgaWYgKF90eXBlb2YodmFsdWUpICE9PSAib2JqZWN0IiB8fCB2YWx1ZSA9PT0gbnVsbCkgewogICAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGNsb25lZC5oYXModmFsdWUpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGNsb25lZC5nZXQodmFsdWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgYnVmZmVyLCByZXN1bHQ7CgogICAgICAgICAgICBpZiAoKGJ1ZmZlciA9IHZhbHVlLmJ1ZmZlcikgJiYgKDAsIF91dGlsLmlzQXJyYXlCdWZmZXIpKGJ1ZmZlcikpIHsKICAgICAgICAgICAgICB2YXIgdHJhbnNmZXJhYmxlID0gdHJhbnNmZXJzICYmIHRyYW5zZmVycy5pbmNsdWRlcyhidWZmZXIpOwoKICAgICAgICAgICAgICBpZiAodHJhbnNmZXJhYmxlKSB7CiAgICAgICAgICAgICAgICByZXN1bHQgPSBuZXcgdmFsdWUuY29uc3RydWN0b3IoYnVmZmVyLCB2YWx1ZS5ieXRlT2Zmc2V0LCB2YWx1ZS5ieXRlTGVuZ3RoKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmVzdWx0ID0gbmV3IHZhbHVlLmNvbnN0cnVjdG9yKHZhbHVlKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNsb25lZC5zZXQodmFsdWUsIHJlc3VsdCk7CiAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmVzdWx0ID0gQXJyYXkuaXNBcnJheSh2YWx1ZSkgPyBbXSA6IHt9OwogICAgICAgICAgICBjbG9uZWQuc2V0KHZhbHVlLCByZXN1bHQpOwoKICAgICAgICAgICAgZm9yICh2YXIgaSBpbiB2YWx1ZSkgewogICAgICAgICAgICAgIHZhciBkZXNjID0gdm9pZCAwLAogICAgICAgICAgICAgICAgcCA9IHZhbHVlOwoKICAgICAgICAgICAgICB3aGlsZSAoIShkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihwLCBpKSkpIHsKICAgICAgICAgICAgICAgIHAgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YocCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAodHlwZW9mIGRlc2MudmFsdWUgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICh0eXBlb2YgZGVzYy52YWx1ZSA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgaWYgKHZhbHVlLmhhc093blByb3BlcnR5ICYmIHZhbHVlLmhhc093blByb3BlcnR5KGkpKSB7CiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiTG9vcGJhY2tQb3J0LnBvc3RNZXNzYWdlIC0gY2Fubm90IGNsb25lOiAiLmNvbmNhdCh2YWx1ZVtpXSkpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmVzdWx0W2ldID0gY2xvbmVWYWx1ZShkZXNjLnZhbHVlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIXRoaXMuX2RlZmVyKSB7CiAgICAgICAgICAgIHRoaXMuX2xpc3RlbmVycy5mb3JFYWNoKGZ1bmN0aW9uIChsaXN0ZW5lcikgewogICAgICAgICAgICAgIGxpc3RlbmVyLmNhbGwoX3RoaXMxMCwgewogICAgICAgICAgICAgICAgZGF0YTogb2JqCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBjbG9uZWQgPSBuZXcgV2Vha01hcCgpOwogICAgICAgICAgdmFyIGUgPSB7CiAgICAgICAgICAgIGRhdGE6IGNsb25lVmFsdWUob2JqKQogICAgICAgICAgfTsKCiAgICAgICAgICB0aGlzLl9kZWZlcnJlZC50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3RoaXMxMC5fbGlzdGVuZXJzLmZvckVhY2goZnVuY3Rpb24gKGxpc3RlbmVyKSB7CiAgICAgICAgICAgICAgbGlzdGVuZXIuY2FsbChfdGhpczEwLCBlKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJhZGRFdmVudExpc3RlbmVyIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gYWRkRXZlbnRMaXN0ZW5lcihuYW1lLCBsaXN0ZW5lcikgewogICAgICAgICAgdGhpcy5fbGlzdGVuZXJzLnB1c2gobGlzdGVuZXIpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInJlbW92ZUV2ZW50TGlzdGVuZXIiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVFdmVudExpc3RlbmVyKG5hbWUsIGxpc3RlbmVyKSB7CiAgICAgICAgICB2YXIgaSA9IHRoaXMuX2xpc3RlbmVycy5pbmRleE9mKGxpc3RlbmVyKTsKCiAgICAgICAgICB0aGlzLl9saXN0ZW5lcnMuc3BsaWNlKGksIDEpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInRlcm1pbmF0ZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHRlcm1pbmF0ZSgpIHsKICAgICAgICAgIHRoaXMuX2xpc3RlbmVycy5sZW5ndGggPSAwOwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIExvb3BiYWNrUG9ydDsKICAgIH0oKTsKCiAgICBleHBvcnRzLkxvb3BiYWNrUG9ydCA9IExvb3BiYWNrUG9ydDsKCiAgICB2YXIgUERGV29ya2VyID0gZnVuY3Rpb24gUERGV29ya2VyQ2xvc3VyZSgpIHsKICAgICAgdmFyIHBkZldvcmtlclBvcnRzID0gbmV3IFdlYWtNYXAoKTsKICAgICAgdmFyIGlzV29ya2VyRGlzYWJsZWQgPSBmYWxzZTsKICAgICAgdmFyIGZhbGxiYWNrV29ya2VyU3JjOwogICAgICB2YXIgbmV4dEZha2VXb3JrZXJJZCA9IDA7CiAgICAgIHZhciBmYWtlV29ya2VyQ2FwYWJpbGl0eTsKCiAgICAgIGlmIChfaXNfbm9kZS5pc05vZGVKUyAmJiB0eXBlb2YgcmVxdWlyZSA9PT0gImZ1bmN0aW9uIikgewogICAgICAgIGlzV29ya2VyRGlzYWJsZWQgPSB0cnVlOwogICAgICAgIGZhbGxiYWNrV29ya2VyU3JjID0gIi4vcGRmLndvcmtlci5qcyI7CiAgICAgIH0gZWxzZSBpZiAoKHR5cGVvZiBkb2N1bWVudCA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YoZG9jdW1lbnQpKSA9PT0gIm9iamVjdCIgJiYgImN1cnJlbnRTY3JpcHQiIGluIGRvY3VtZW50KSB7CiAgICAgICAgdmFyIHBkZmpzRmlsZVBhdGggPSBkb2N1bWVudC5jdXJyZW50U2NyaXB0ICYmIGRvY3VtZW50LmN1cnJlbnRTY3JpcHQuc3JjOwoKICAgICAgICBpZiAocGRmanNGaWxlUGF0aCkgewogICAgICAgICAgZmFsbGJhY2tXb3JrZXJTcmMgPSBwZGZqc0ZpbGVQYXRoLnJlcGxhY2UoLyhcLig/Om1pblwuKT9qcykoXD8uKik/JC9pLCAiLndvcmtlciQxJDIiKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIF9nZXRXb3JrZXJTcmMoKSB7CiAgICAgICAgaWYgKF93b3JrZXJfb3B0aW9ucy5HbG9iYWxXb3JrZXJPcHRpb25zLndvcmtlclNyYykgewogICAgICAgICAgcmV0dXJuIF93b3JrZXJfb3B0aW9ucy5HbG9iYWxXb3JrZXJPcHRpb25zLndvcmtlclNyYzsKICAgICAgICB9CgogICAgICAgIGlmICh0eXBlb2YgZmFsbGJhY2tXb3JrZXJTcmMgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICBpZiAoIV9pc19ub2RlLmlzTm9kZUpTKSB7CiAgICAgICAgICAgICgwLCBfZGlzcGxheV91dGlscy5kZXByZWNhdGVkKSgnTm8gIkdsb2JhbFdvcmtlck9wdGlvbnMud29ya2VyU3JjIiBzcGVjaWZpZWQuJyk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGZhbGxiYWNrV29ya2VyU3JjOwogICAgICAgIH0KCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyAiR2xvYmFsV29ya2VyT3B0aW9ucy53b3JrZXJTcmMiIHNwZWNpZmllZC4nKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZ2V0TWFpblRocmVhZFdvcmtlck1lc3NhZ2VIYW5kbGVyKCkgewogICAgICAgIHZhciBtYWluV29ya2VyTWVzc2FnZUhhbmRsZXI7CgogICAgICAgIHRyeSB7CiAgICAgICAgICBtYWluV29ya2VyTWVzc2FnZUhhbmRsZXIgPSBnbG9iYWxUaGlzLnBkZmpzV29ya2VyICYmIGdsb2JhbFRoaXMucGRmanNXb3JrZXIuV29ya2VyTWVzc2FnZUhhbmRsZXI7CiAgICAgICAgfSBjYXRjaCAoZXgpIHt9CgogICAgICAgIHJldHVybiBtYWluV29ya2VyTWVzc2FnZUhhbmRsZXIgfHwgbnVsbDsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gc2V0dXBGYWtlV29ya2VyR2xvYmFsKCkgewogICAgICAgIGlmIChmYWtlV29ya2VyQ2FwYWJpbGl0eSkgewogICAgICAgICAgcmV0dXJuIGZha2VXb3JrZXJDYXBhYmlsaXR5LnByb21pc2U7CiAgICAgICAgfQoKICAgICAgICBmYWtlV29ya2VyQ2FwYWJpbGl0eSA9ICgwLCBfdXRpbC5jcmVhdGVQcm9taXNlQ2FwYWJpbGl0eSkoKTsKCiAgICAgICAgdmFyIGxvYWRlciA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgX3JlZjggPSBfYXN5bmNUb0dlbmVyYXRvcigvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yWyJkZWZhdWx0Il0ubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICAgICAgICB2YXIgbWFpbldvcmtlck1lc3NhZ2VIYW5kbGVyLCB3b3JrZXI7CiAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JbImRlZmF1bHQiXS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIG1haW5Xb3JrZXJNZXNzYWdlSGFuZGxlciA9IGdldE1haW5UaHJlYWRXb3JrZXJNZXNzYWdlSGFuZGxlcigpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoIW1haW5Xb3JrZXJNZXNzYWdlSGFuZGxlcikgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDM7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIG1haW5Xb3JrZXJNZXNzYWdlSGFuZGxlcik7CgogICAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgaWYgKCEoX2lzX25vZGUuaXNOb2RlSlMgJiYgdHlwZW9mIHJlcXVpcmUgPT09ICJmdW5jdGlvbiIpKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNjsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgd29ya2VyID0gZXZhbCgicmVxdWlyZSIpKF9nZXRXb3JrZXJTcmMoKSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgd29ya2VyLldvcmtlck1lc3NhZ2VIYW5kbGVyKTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gODsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKDAsIF9kaXNwbGF5X3V0aWxzLmxvYWRTY3JpcHQpKF9nZXRXb3JrZXJTcmMoKSk7CgogICAgICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgd2luZG93LnBkZmpzV29ya2VyLldvcmtlck1lc3NhZ2VIYW5kbGVyKTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgX2NhbGxlZSk7CiAgICAgICAgICB9KSk7CgogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGxvYWRlcigpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZWY4LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICB9OwogICAgICAgIH0oKTsKCiAgICAgICAgbG9hZGVyKCkudGhlbihmYWtlV29ya2VyQ2FwYWJpbGl0eS5yZXNvbHZlLCBmYWtlV29ya2VyQ2FwYWJpbGl0eS5yZWplY3QpOwogICAgICAgIHJldHVybiBmYWtlV29ya2VyQ2FwYWJpbGl0eS5wcm9taXNlOwogICAgICB9CgogICAgICBmdW5jdGlvbiBjcmVhdGVDRE5XcmFwcGVyKHVybCkgewogICAgICAgIHZhciB3cmFwcGVyID0gImltcG9ydFNjcmlwdHMoJyIgKyB1cmwgKyAiJyk7IjsKICAgICAgICByZXR1cm4gVVJMLmNyZWF0ZU9iamVjdFVSTChuZXcgQmxvYihbd3JhcHBlcl0pKTsKICAgICAgfQoKICAgICAgdmFyIFBERldvcmtlciA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gUERGV29ya2VyKCkgewogICAgICAgICAgdmFyIF9yZWY5ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fSwKICAgICAgICAgICAgX3JlZjkkbmFtZSA9IF9yZWY5Lm5hbWUsCiAgICAgICAgICAgIG5hbWUgPSBfcmVmOSRuYW1lID09PSB2b2lkIDAgPyBudWxsIDogX3JlZjkkbmFtZSwKICAgICAgICAgICAgX3JlZjkkcG9ydCA9IF9yZWY5LnBvcnQsCiAgICAgICAgICAgIHBvcnQgPSBfcmVmOSRwb3J0ID09PSB2b2lkIDAgPyBudWxsIDogX3JlZjkkcG9ydCwKICAgICAgICAgICAgX3JlZjkkdmVyYm9zaXR5ID0gX3JlZjkudmVyYm9zaXR5LAogICAgICAgICAgICB2ZXJib3NpdHkgPSBfcmVmOSR2ZXJib3NpdHkgPT09IHZvaWQgMCA/ICgwLCBfdXRpbC5nZXRWZXJib3NpdHlMZXZlbCkoKSA6IF9yZWY5JHZlcmJvc2l0eTsKCiAgICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUERGV29ya2VyKTsKCiAgICAgICAgICBpZiAocG9ydCAmJiBwZGZXb3JrZXJQb3J0cy5oYXMocG9ydCkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJDYW5ub3QgdXNlIG1vcmUgdGhhbiBvbmUgUERGV29ya2VyIHBlciBwb3J0Iik7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5uYW1lID0gbmFtZTsKICAgICAgICAgIHRoaXMuZGVzdHJveWVkID0gZmFsc2U7CiAgICAgICAgICB0aGlzLnBvc3RNZXNzYWdlVHJhbnNmZXJzID0gdHJ1ZTsKICAgICAgICAgIHRoaXMudmVyYm9zaXR5ID0gdmVyYm9zaXR5OwogICAgICAgICAgdGhpcy5fcmVhZHlDYXBhYmlsaXR5ID0gKDAsIF91dGlsLmNyZWF0ZVByb21pc2VDYXBhYmlsaXR5KSgpOwogICAgICAgICAgdGhpcy5fcG9ydCA9IG51bGw7CiAgICAgICAgICB0aGlzLl93ZWJXb3JrZXIgPSBudWxsOwogICAgICAgICAgdGhpcy5fbWVzc2FnZUhhbmRsZXIgPSBudWxsOwoKICAgICAgICAgIGlmIChwb3J0KSB7CiAgICAgICAgICAgIHBkZldvcmtlclBvcnRzLnNldChwb3J0LCB0aGlzKTsKCiAgICAgICAgICAgIHRoaXMuX2luaXRpYWxpemVGcm9tUG9ydChwb3J0KTsKCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLl9pbml0aWFsaXplKCk7CiAgICAgICAgfQoKICAgICAgICBfY3JlYXRlQ2xhc3MoUERGV29ya2VyLCBbewogICAgICAgICAga2V5OiAiX2luaXRpYWxpemVGcm9tUG9ydCIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX2luaXRpYWxpemVGcm9tUG9ydChwb3J0KSB7CiAgICAgICAgICAgIHRoaXMuX3BvcnQgPSBwb3J0OwogICAgICAgICAgICB0aGlzLl9tZXNzYWdlSGFuZGxlciA9IG5ldyBfbWVzc2FnZV9oYW5kbGVyLk1lc3NhZ2VIYW5kbGVyKCJtYWluIiwgIndvcmtlciIsIHBvcnQpOwoKICAgICAgICAgICAgdGhpcy5fbWVzc2FnZUhhbmRsZXIub24oInJlYWR5IiwgZnVuY3Rpb24gKCkge30pOwoKICAgICAgICAgICAgdGhpcy5fcmVhZHlDYXBhYmlsaXR5LnJlc29sdmUoKTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJfaW5pdGlhbGl6ZSIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX2luaXRpYWxpemUoKSB7CiAgICAgICAgICAgIHZhciBfdGhpczExID0gdGhpczsKCiAgICAgICAgICAgIGlmICh0eXBlb2YgV29ya2VyICE9PSAidW5kZWZpbmVkIiAmJiAhaXNXb3JrZXJEaXNhYmxlZCAmJiAhZ2V0TWFpblRocmVhZFdvcmtlck1lc3NhZ2VIYW5kbGVyKCkpIHsKICAgICAgICAgICAgICB2YXIgd29ya2VyU3JjID0gX2dldFdvcmtlclNyYygpOwoKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYgKCEoMCwgX3V0aWwuaXNTYW1lT3JpZ2luKSh3aW5kb3cubG9jYXRpb24uaHJlZiwgd29ya2VyU3JjKSkgewogICAgICAgICAgICAgICAgICB3b3JrZXJTcmMgPSBjcmVhdGVDRE5XcmFwcGVyKG5ldyBVUkwod29ya2VyU3JjLCB3aW5kb3cubG9jYXRpb24pLmhyZWYpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHZhciB3b3JrZXIgPSBuZXcgV29ya2VyKHdvcmtlclNyYyk7CiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZUhhbmRsZXIgPSBuZXcgX21lc3NhZ2VfaGFuZGxlci5NZXNzYWdlSGFuZGxlcigibWFpbiIsICJ3b3JrZXIiLCB3b3JrZXIpOwoKICAgICAgICAgICAgICAgIHZhciB0ZXJtaW5hdGVFYXJseSA9IGZ1bmN0aW9uIHRlcm1pbmF0ZUVhcmx5KCkgewogICAgICAgICAgICAgICAgICB3b3JrZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcigiZXJyb3IiLCBvbldvcmtlckVycm9yKTsKICAgICAgICAgICAgICAgICAgbWVzc2FnZUhhbmRsZXIuZGVzdHJveSgpOwogICAgICAgICAgICAgICAgICB3b3JrZXIudGVybWluYXRlKCk7CgogICAgICAgICAgICAgICAgICBpZiAoX3RoaXMxMS5kZXN0cm95ZWQpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpczExLl9yZWFkeUNhcGFiaWxpdHkucmVqZWN0KG5ldyBFcnJvcigiV29ya2VyIHdhcyBkZXN0cm95ZWQiKSk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgX3RoaXMxMS5fc2V0dXBGYWtlV29ya2VyKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgdmFyIG9uV29ya2VyRXJyb3IgPSBmdW5jdGlvbiBvbldvcmtlckVycm9yKCkgewogICAgICAgICAgICAgICAgICBpZiAoIV90aGlzMTEuX3dlYldvcmtlcikgewogICAgICAgICAgICAgICAgICAgIHRlcm1pbmF0ZUVhcmx5KCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgd29ya2VyLmFkZEV2ZW50TGlzdGVuZXIoImVycm9yIiwgb25Xb3JrZXJFcnJvcik7CiAgICAgICAgICAgICAgICBtZXNzYWdlSGFuZGxlci5vbigidGVzdCIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgIHdvcmtlci5yZW1vdmVFdmVudExpc3RlbmVyKCJlcnJvciIsIG9uV29ya2VyRXJyb3IpOwoKICAgICAgICAgICAgICAgICAgaWYgKF90aGlzMTEuZGVzdHJveWVkKSB7CiAgICAgICAgICAgICAgICAgICAgdGVybWluYXRlRWFybHkoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgX3RoaXMxMS5fbWVzc2FnZUhhbmRsZXIgPSBtZXNzYWdlSGFuZGxlcjsKICAgICAgICAgICAgICAgICAgICBfdGhpczExLl9wb3J0ID0gd29ya2VyOwogICAgICAgICAgICAgICAgICAgIF90aGlzMTEuX3dlYldvcmtlciA9IHdvcmtlcjsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCFkYXRhLnN1cHBvcnRUcmFuc2ZlcnMpIHsKICAgICAgICAgICAgICAgICAgICAgIF90aGlzMTEucG9zdE1lc3NhZ2VUcmFuc2ZlcnMgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIF90aGlzMTEuX3JlYWR5Q2FwYWJpbGl0eS5yZXNvbHZlKCk7CgogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VIYW5kbGVyLnNlbmQoImNvbmZpZ3VyZSIsIHsKICAgICAgICAgICAgICAgICAgICAgIHZlcmJvc2l0eTogX3RoaXMxMS52ZXJib3NpdHkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBfdGhpczExLl9zZXR1cEZha2VXb3JrZXIoKTsKCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZUhhbmRsZXIuZGVzdHJveSgpOwogICAgICAgICAgICAgICAgICAgIHdvcmtlci50ZXJtaW5hdGUoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBtZXNzYWdlSGFuZGxlci5vbigicmVhZHkiLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgICB3b3JrZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcigiZXJyb3IiLCBvbldvcmtlckVycm9yKTsKCiAgICAgICAgICAgICAgICAgIGlmIChfdGhpczExLmRlc3Ryb3llZCkgewogICAgICAgICAgICAgICAgICAgIHRlcm1pbmF0ZUVhcmx5KCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHNlbmRUZXN0KCk7CiAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpczExLl9zZXR1cEZha2VXb3JrZXIoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgdmFyIHNlbmRUZXN0ID0gZnVuY3Rpb24gc2VuZFRlc3QoKSB7CiAgICAgICAgICAgICAgICAgIHZhciB0ZXN0T2JqID0gbmV3IFVpbnQ4QXJyYXkoW190aGlzMTEucG9zdE1lc3NhZ2VUcmFuc2ZlcnMgPyAyNTUgOiAwXSk7CgogICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VIYW5kbGVyLnNlbmQoInRlc3QiLCB0ZXN0T2JqLCBbdGVzdE9iai5idWZmZXJdKTsKICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIkNhbm5vdCB1c2UgcG9zdE1lc3NhZ2UgdHJhbnNmZXJzLiIpOwogICAgICAgICAgICAgICAgICAgIHRlc3RPYmpbMF0gPSAwOwogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VIYW5kbGVyLnNlbmQoInRlc3QiLCB0ZXN0T2JqKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICBzZW5kVGVzdCgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICgwLCBfdXRpbC5pbmZvKSgiVGhlIHdvcmtlciBoYXMgYmVlbiBkaXNhYmxlZC4iKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuX3NldHVwRmFrZVdvcmtlcigpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogIl9zZXR1cEZha2VXb3JrZXIiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9zZXR1cEZha2VXb3JrZXIoKSB7CiAgICAgICAgICAgIHZhciBfdGhpczEyID0gdGhpczsKCiAgICAgICAgICAgIGlmICghaXNXb3JrZXJEaXNhYmxlZCkgewogICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiU2V0dGluZyB1cCBmYWtlIHdvcmtlci4iKTsKICAgICAgICAgICAgICBpc1dvcmtlckRpc2FibGVkID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc2V0dXBGYWtlV29ya2VyR2xvYmFsKCkudGhlbihmdW5jdGlvbiAoV29ya2VyTWVzc2FnZUhhbmRsZXIpIHsKICAgICAgICAgICAgICBpZiAoX3RoaXMxMi5kZXN0cm95ZWQpIHsKICAgICAgICAgICAgICAgIF90aGlzMTIuX3JlYWR5Q2FwYWJpbGl0eS5yZWplY3QobmV3IEVycm9yKCJXb3JrZXIgd2FzIGRlc3Ryb3llZCIpKTsKCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgcG9ydCA9IG5ldyBMb29wYmFja1BvcnQoKTsKICAgICAgICAgICAgICBfdGhpczEyLl9wb3J0ID0gcG9ydDsKICAgICAgICAgICAgICB2YXIgaWQgPSAiZmFrZSIgKyBuZXh0RmFrZVdvcmtlcklkKys7CiAgICAgICAgICAgICAgdmFyIHdvcmtlckhhbmRsZXIgPSBuZXcgX21lc3NhZ2VfaGFuZGxlci5NZXNzYWdlSGFuZGxlcihpZCArICJfd29ya2VyIiwgaWQsIHBvcnQpOwogICAgICAgICAgICAgIFdvcmtlck1lc3NhZ2VIYW5kbGVyLnNldHVwKHdvcmtlckhhbmRsZXIsIHBvcnQpOwogICAgICAgICAgICAgIHZhciBtZXNzYWdlSGFuZGxlciA9IG5ldyBfbWVzc2FnZV9oYW5kbGVyLk1lc3NhZ2VIYW5kbGVyKGlkLCBpZCArICJfd29ya2VyIiwgcG9ydCk7CiAgICAgICAgICAgICAgX3RoaXMxMi5fbWVzc2FnZUhhbmRsZXIgPSBtZXNzYWdlSGFuZGxlcjsKCiAgICAgICAgICAgICAgX3RoaXMxMi5fcmVhZHlDYXBhYmlsaXR5LnJlc29sdmUoKTsKCiAgICAgICAgICAgICAgbWVzc2FnZUhhbmRsZXIuc2VuZCgiY29uZmlndXJlIiwgewogICAgICAgICAgICAgICAgdmVyYm9zaXR5OiBfdGhpczEyLnZlcmJvc2l0eQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICAgICAgX3RoaXMxMi5fcmVhZHlDYXBhYmlsaXR5LnJlamVjdChuZXcgRXJyb3IoIlNldHRpbmcgdXAgZmFrZSB3b3JrZXIgZmFpbGVkOiBcIiIuY29uY2F0KHJlYXNvbi5tZXNzYWdlLCAiXCIuIikpKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAiZGVzdHJveSIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgICAgICAgdGhpcy5kZXN0cm95ZWQgPSB0cnVlOwoKICAgICAgICAgICAgaWYgKHRoaXMuX3dlYldvcmtlcikgewogICAgICAgICAgICAgIHRoaXMuX3dlYldvcmtlci50ZXJtaW5hdGUoKTsKCiAgICAgICAgICAgICAgdGhpcy5fd2ViV29ya2VyID0gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcGRmV29ya2VyUG9ydHNbImRlbGV0ZSJdKHRoaXMuX3BvcnQpOwogICAgICAgICAgICB0aGlzLl9wb3J0ID0gbnVsbDsKCiAgICAgICAgICAgIGlmICh0aGlzLl9tZXNzYWdlSGFuZGxlcikgewogICAgICAgICAgICAgIHRoaXMuX21lc3NhZ2VIYW5kbGVyLmRlc3Ryb3koKTsKCiAgICAgICAgICAgICAgdGhpcy5fbWVzc2FnZUhhbmRsZXIgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAicHJvbWlzZSIsCiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlYWR5Q2FwYWJpbGl0eS5wcm9taXNlOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogInBvcnQiLAogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wb3J0OwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogIm1lc3NhZ2VIYW5kbGVyIiwKICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbWVzc2FnZUhhbmRsZXI7CiAgICAgICAgICB9CiAgICAgICAgfV0sIFt7CiAgICAgICAgICBrZXk6ICJmcm9tUG9ydCIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZnJvbVBvcnQocGFyYW1zKSB7CiAgICAgICAgICAgIGlmICghcGFyYW1zIHx8ICFwYXJhbXMucG9ydCkgewogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiUERGV29ya2VyLmZyb21Qb3J0IC0gaW52YWxpZCBtZXRob2Qgc2lnbmF0dXJlLiIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocGRmV29ya2VyUG9ydHMuaGFzKHBhcmFtcy5wb3J0KSkgewogICAgICAgICAgICAgIHJldHVybiBwZGZXb3JrZXJQb3J0cy5nZXQocGFyYW1zLnBvcnQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gbmV3IFBERldvcmtlcihwYXJhbXMpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogImdldFdvcmtlclNyYyIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0V29ya2VyU3JjKCkgewogICAgICAgICAgICByZXR1cm4gX2dldFdvcmtlclNyYygpOwogICAgICAgICAgfQogICAgICAgIH1dKTsKCiAgICAgICAgcmV0dXJuIFBERldvcmtlcjsKICAgICAgfSgpOwoKICAgICAgcmV0dXJuIFBERldvcmtlcjsKICAgIH0oKTsKCiAgICBleHBvcnRzLlBERldvcmtlciA9IFBERldvcmtlcjsKCiAgICB2YXIgV29ya2VyVHJhbnNwb3J0ID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gV29ya2VyVHJhbnNwb3J0KG1lc3NhZ2VIYW5kbGVyLCBsb2FkaW5nVGFzaywgbmV0d29ya1N0cmVhbSwgcGFyYW1zKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFdvcmtlclRyYW5zcG9ydCk7CgogICAgICAgIHRoaXMubWVzc2FnZUhhbmRsZXIgPSBtZXNzYWdlSGFuZGxlcjsKICAgICAgICB0aGlzLmxvYWRpbmdUYXNrID0gbG9hZGluZ1Rhc2s7CiAgICAgICAgdGhpcy5jb21tb25PYmpzID0gbmV3IFBERk9iamVjdHMoKTsKICAgICAgICB0aGlzLmZvbnRMb2FkZXIgPSBuZXcgX2ZvbnRfbG9hZGVyLkZvbnRMb2FkZXIoewogICAgICAgICAgZG9jSWQ6IGxvYWRpbmdUYXNrLmRvY0lkLAogICAgICAgICAgb25VbnN1cHBvcnRlZEZlYXR1cmU6IHRoaXMuX29uVW5zdXBwb3J0ZWRGZWF0dXJlLmJpbmQodGhpcykKICAgICAgICB9KTsKICAgICAgICB0aGlzLl9wYXJhbXMgPSBwYXJhbXM7CiAgICAgICAgdGhpcy5DTWFwUmVhZGVyRmFjdG9yeSA9IG5ldyBwYXJhbXMuQ01hcFJlYWRlckZhY3RvcnkoewogICAgICAgICAgYmFzZVVybDogcGFyYW1zLmNNYXBVcmwsCiAgICAgICAgICBpc0NvbXByZXNzZWQ6IHBhcmFtcy5jTWFwUGFja2VkCiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5kZXN0cm95ZWQgPSBmYWxzZTsKICAgICAgICB0aGlzLmRlc3Ryb3lDYXBhYmlsaXR5ID0gbnVsbDsKICAgICAgICB0aGlzLl9wYXNzd29yZENhcGFiaWxpdHkgPSBudWxsOwogICAgICAgIHRoaXMuX25ldHdvcmtTdHJlYW0gPSBuZXR3b3JrU3RyZWFtOwogICAgICAgIHRoaXMuX2Z1bGxSZWFkZXIgPSBudWxsOwogICAgICAgIHRoaXMuX2xhc3RQcm9ncmVzcyA9IG51bGw7CiAgICAgICAgdGhpcy5wYWdlQ2FjaGUgPSBbXTsKICAgICAgICB0aGlzLnBhZ2VQcm9taXNlcyA9IFtdOwogICAgICAgIHRoaXMuZG93bmxvYWRJbmZvQ2FwYWJpbGl0eSA9ICgwLCBfdXRpbC5jcmVhdGVQcm9taXNlQ2FwYWJpbGl0eSkoKTsKICAgICAgICB0aGlzLnNldHVwTWVzc2FnZUhhbmRsZXIoKTsKICAgICAgfQoKICAgICAgX2NyZWF0ZUNsYXNzKFdvcmtlclRyYW5zcG9ydCwgW3sKICAgICAgICBrZXk6ICJkZXN0cm95IiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgICAgIHZhciBfdGhpczEzID0gdGhpczsKCiAgICAgICAgICBpZiAodGhpcy5kZXN0cm95Q2FwYWJpbGl0eSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5kZXN0cm95Q2FwYWJpbGl0eS5wcm9taXNlOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuZGVzdHJveWVkID0gdHJ1ZTsKICAgICAgICAgIHRoaXMuZGVzdHJveUNhcGFiaWxpdHkgPSAoMCwgX3V0aWwuY3JlYXRlUHJvbWlzZUNhcGFiaWxpdHkpKCk7CgogICAgICAgICAgaWYgKHRoaXMuX3Bhc3N3b3JkQ2FwYWJpbGl0eSkgewogICAgICAgICAgICB0aGlzLl9wYXNzd29yZENhcGFiaWxpdHkucmVqZWN0KG5ldyBFcnJvcigiV29ya2VyIHdhcyBkZXN0cm95ZWQgZHVyaW5nIG9uUGFzc3dvcmQgY2FsbGJhY2siKSk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHdhaXRPbiA9IFtdOwogICAgICAgICAgdGhpcy5wYWdlQ2FjaGUuZm9yRWFjaChmdW5jdGlvbiAocGFnZSkgewogICAgICAgICAgICBpZiAocGFnZSkgewogICAgICAgICAgICAgIHdhaXRPbi5wdXNoKHBhZ2UuX2Rlc3Ryb3koKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5wYWdlQ2FjaGUubGVuZ3RoID0gMDsKICAgICAgICAgIHRoaXMucGFnZVByb21pc2VzLmxlbmd0aCA9IDA7CiAgICAgICAgICB2YXIgdGVybWluYXRlZCA9IHRoaXMubWVzc2FnZUhhbmRsZXIuc2VuZFdpdGhQcm9taXNlKCJUZXJtaW5hdGUiLCBudWxsKTsKICAgICAgICAgIHdhaXRPbi5wdXNoKHRlcm1pbmF0ZWQpOwogICAgICAgICAgUHJvbWlzZS5hbGwod2FpdE9uKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3RoaXMxMy5mb250TG9hZGVyLmNsZWFyKCk7CgogICAgICAgICAgICBpZiAoX3RoaXMxMy5fbmV0d29ya1N0cmVhbSkgewogICAgICAgICAgICAgIF90aGlzMTMuX25ldHdvcmtTdHJlYW0uY2FuY2VsQWxsUmVxdWVzdHMobmV3IF91dGlsLkFib3J0RXhjZXB0aW9uKCJXb3JrZXIgd2FzIHRlcm1pbmF0ZWQuIikpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoX3RoaXMxMy5tZXNzYWdlSGFuZGxlcikgewogICAgICAgICAgICAgIF90aGlzMTMubWVzc2FnZUhhbmRsZXIuZGVzdHJveSgpOwoKICAgICAgICAgICAgICBfdGhpczEzLm1lc3NhZ2VIYW5kbGVyID0gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgX3RoaXMxMy5kZXN0cm95Q2FwYWJpbGl0eS5yZXNvbHZlKCk7CiAgICAgICAgICB9LCB0aGlzLmRlc3Ryb3lDYXBhYmlsaXR5LnJlamVjdCk7CiAgICAgICAgICByZXR1cm4gdGhpcy5kZXN0cm95Q2FwYWJpbGl0eS5wcm9taXNlOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInNldHVwTWVzc2FnZUhhbmRsZXIiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXR1cE1lc3NhZ2VIYW5kbGVyKCkgewogICAgICAgICAgdmFyIF90aGlzMTQgPSB0aGlzOwoKICAgICAgICAgIHZhciBtZXNzYWdlSGFuZGxlciA9IHRoaXMubWVzc2FnZUhhbmRsZXIsCiAgICAgICAgICAgIGxvYWRpbmdUYXNrID0gdGhpcy5sb2FkaW5nVGFzazsKICAgICAgICAgIG1lc3NhZ2VIYW5kbGVyLm9uKCJHZXRSZWFkZXIiLCBmdW5jdGlvbiAoZGF0YSwgc2luaykgewogICAgICAgICAgICAoMCwgX3V0aWwuYXNzZXJ0KShfdGhpczE0Ll9uZXR3b3JrU3RyZWFtKTsKICAgICAgICAgICAgX3RoaXMxNC5fZnVsbFJlYWRlciA9IF90aGlzMTQuX25ldHdvcmtTdHJlYW0uZ2V0RnVsbFJlYWRlcigpOwoKICAgICAgICAgICAgX3RoaXMxNC5fZnVsbFJlYWRlci5vblByb2dyZXNzID0gZnVuY3Rpb24gKGV2dCkgewogICAgICAgICAgICAgIF90aGlzMTQuX2xhc3RQcm9ncmVzcyA9IHsKICAgICAgICAgICAgICAgIGxvYWRlZDogZXZ0LmxvYWRlZCwKICAgICAgICAgICAgICAgIHRvdGFsOiBldnQudG90YWwKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgc2luay5vblB1bGwgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgX3RoaXMxNC5fZnVsbFJlYWRlci5yZWFkKCkudGhlbihmdW5jdGlvbiAoX3JlZjEwKSB7CiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBfcmVmMTAudmFsdWUsCiAgICAgICAgICAgICAgICAgIGRvbmUgPSBfcmVmMTAuZG9uZTsKCiAgICAgICAgICAgICAgICBpZiAoZG9uZSkgewogICAgICAgICAgICAgICAgICBzaW5rLmNsb3NlKCk7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAoMCwgX3V0aWwuYXNzZXJ0KSgoMCwgX3V0aWwuaXNBcnJheUJ1ZmZlcikodmFsdWUpKTsKICAgICAgICAgICAgICAgIHNpbmsuZW5xdWV1ZShuZXcgVWludDhBcnJheSh2YWx1ZSksIDEsIFt2YWx1ZV0pOwogICAgICAgICAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgICAgICAgIHNpbmsuZXJyb3IocmVhc29uKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHNpbmsub25DYW5jZWwgPSBmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICAgICAgX3RoaXMxNC5fZnVsbFJlYWRlci5jYW5jZWwocmVhc29uKTsKICAgICAgICAgICAgfTsKICAgICAgICAgIH0pOwogICAgICAgICAgbWVzc2FnZUhhbmRsZXIub24oIlJlYWRlckhlYWRlcnNSZWFkeSIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgIHZhciBoZWFkZXJzQ2FwYWJpbGl0eSA9ICgwLCBfdXRpbC5jcmVhdGVQcm9taXNlQ2FwYWJpbGl0eSkoKTsKICAgICAgICAgICAgdmFyIGZ1bGxSZWFkZXIgPSBfdGhpczE0Ll9mdWxsUmVhZGVyOwogICAgICAgICAgICBmdWxsUmVhZGVyLmhlYWRlcnNSZWFkeS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBpZiAoIWZ1bGxSZWFkZXIuaXNTdHJlYW1pbmdTdXBwb3J0ZWQgfHwgIWZ1bGxSZWFkZXIuaXNSYW5nZVN1cHBvcnRlZCkgewogICAgICAgICAgICAgICAgaWYgKF90aGlzMTQuX2xhc3RQcm9ncmVzcyAmJiBsb2FkaW5nVGFzay5vblByb2dyZXNzKSB7CiAgICAgICAgICAgICAgICAgIGxvYWRpbmdUYXNrLm9uUHJvZ3Jlc3MoX3RoaXMxNC5fbGFzdFByb2dyZXNzKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdWxsUmVhZGVyLm9uUHJvZ3Jlc3MgPSBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgICAgICAgICAgIGlmIChsb2FkaW5nVGFzay5vblByb2dyZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgbG9hZGluZ1Rhc2sub25Qcm9ncmVzcyh7CiAgICAgICAgICAgICAgICAgICAgICBsb2FkZWQ6IGV2dC5sb2FkZWQsCiAgICAgICAgICAgICAgICAgICAgICB0b3RhbDogZXZ0LnRvdGFsCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBoZWFkZXJzQ2FwYWJpbGl0eS5yZXNvbHZlKHsKICAgICAgICAgICAgICAgIGlzU3RyZWFtaW5nU3VwcG9ydGVkOiBmdWxsUmVhZGVyLmlzU3RyZWFtaW5nU3VwcG9ydGVkLAogICAgICAgICAgICAgICAgaXNSYW5nZVN1cHBvcnRlZDogZnVsbFJlYWRlci5pc1JhbmdlU3VwcG9ydGVkLAogICAgICAgICAgICAgICAgY29udGVudExlbmd0aDogZnVsbFJlYWRlci5jb250ZW50TGVuZ3RoCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0sIGhlYWRlcnNDYXBhYmlsaXR5LnJlamVjdCk7CiAgICAgICAgICAgIHJldHVybiBoZWFkZXJzQ2FwYWJpbGl0eS5wcm9taXNlOwogICAgICAgICAgfSk7CiAgICAgICAgICBtZXNzYWdlSGFuZGxlci5vbigiR2V0UmFuZ2VSZWFkZXIiLCBmdW5jdGlvbiAoZGF0YSwgc2luaykgewogICAgICAgICAgICAoMCwgX3V0aWwuYXNzZXJ0KShfdGhpczE0Ll9uZXR3b3JrU3RyZWFtKTsKCiAgICAgICAgICAgIHZhciByYW5nZVJlYWRlciA9IF90aGlzMTQuX25ldHdvcmtTdHJlYW0uZ2V0UmFuZ2VSZWFkZXIoZGF0YS5iZWdpbiwgZGF0YS5lbmQpOwoKICAgICAgICAgICAgaWYgKCFyYW5nZVJlYWRlcikgewogICAgICAgICAgICAgIHNpbmsuY2xvc2UoKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHNpbmsub25QdWxsID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJhbmdlUmVhZGVyLnJlYWQoKS50aGVuKGZ1bmN0aW9uIChfcmVmMTEpIHsKICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IF9yZWYxMS52YWx1ZSwKICAgICAgICAgICAgICAgICAgZG9uZSA9IF9yZWYxMS5kb25lOwoKICAgICAgICAgICAgICAgIGlmIChkb25lKSB7CiAgICAgICAgICAgICAgICAgIHNpbmsuY2xvc2UoKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICgwLCBfdXRpbC5hc3NlcnQpKCgwLCBfdXRpbC5pc0FycmF5QnVmZmVyKSh2YWx1ZSkpOwogICAgICAgICAgICAgICAgc2luay5lbnF1ZXVlKG5ldyBVaW50OEFycmF5KHZhbHVlKSwgMSwgW3ZhbHVlXSk7CiAgICAgICAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgICAgICAgc2luay5lcnJvcihyZWFzb24pOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgc2luay5vbkNhbmNlbCA9IGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgICAgICByYW5nZVJlYWRlci5jYW5jZWwocmVhc29uKTsKICAgICAgICAgICAgfTsKICAgICAgICAgIH0pOwogICAgICAgICAgbWVzc2FnZUhhbmRsZXIub24oIkdldERvYyIsIGZ1bmN0aW9uIChfcmVmMTIpIHsKICAgICAgICAgICAgdmFyIHBkZkluZm8gPSBfcmVmMTIucGRmSW5mbzsKICAgICAgICAgICAgX3RoaXMxNC5fbnVtUGFnZXMgPSBwZGZJbmZvLm51bVBhZ2VzOwoKICAgICAgICAgICAgbG9hZGluZ1Rhc2suX2NhcGFiaWxpdHkucmVzb2x2ZShuZXcgUERGRG9jdW1lbnRQcm94eShwZGZJbmZvLCBfdGhpczE0KSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIG1lc3NhZ2VIYW5kbGVyLm9uKCJEb2NFeGNlcHRpb24iLCBmdW5jdGlvbiAoZXgpIHsKICAgICAgICAgICAgdmFyIHJlYXNvbjsKCiAgICAgICAgICAgIHN3aXRjaCAoZXgubmFtZSkgewogICAgICAgICAgICAgIGNhc2UgIlBhc3N3b3JkRXhjZXB0aW9uIjoKICAgICAgICAgICAgICAgIHJlYXNvbiA9IG5ldyBfdXRpbC5QYXNzd29yZEV4Y2VwdGlvbihleC5tZXNzYWdlLCBleC5jb2RlKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICJJbnZhbGlkUERGRXhjZXB0aW9uIjoKICAgICAgICAgICAgICAgIHJlYXNvbiA9IG5ldyBfdXRpbC5JbnZhbGlkUERGRXhjZXB0aW9uKGV4Lm1lc3NhZ2UpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgIk1pc3NpbmdQREZFeGNlcHRpb24iOgogICAgICAgICAgICAgICAgcmVhc29uID0gbmV3IF91dGlsLk1pc3NpbmdQREZFeGNlcHRpb24oZXgubWVzc2FnZSk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAiVW5leHBlY3RlZFJlc3BvbnNlRXhjZXB0aW9uIjoKICAgICAgICAgICAgICAgIHJlYXNvbiA9IG5ldyBfdXRpbC5VbmV4cGVjdGVkUmVzcG9uc2VFeGNlcHRpb24oZXgubWVzc2FnZSwgZXguc3RhdHVzKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICJVbmtub3duRXJyb3JFeGNlcHRpb24iOgogICAgICAgICAgICAgICAgcmVhc29uID0gbmV3IF91dGlsLlVua25vd25FcnJvckV4Y2VwdGlvbihleC5tZXNzYWdlLCBleC5kZXRhaWxzKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsb2FkaW5nVGFzay5fY2FwYWJpbGl0eS5yZWplY3QocmVhc29uKTsKICAgICAgICAgIH0pOwogICAgICAgICAgbWVzc2FnZUhhbmRsZXIub24oIlBhc3N3b3JkUmVxdWVzdCIsIGZ1bmN0aW9uIChleGNlcHRpb24pIHsKICAgICAgICAgICAgX3RoaXMxNC5fcGFzc3dvcmRDYXBhYmlsaXR5ID0gKDAsIF91dGlsLmNyZWF0ZVByb21pc2VDYXBhYmlsaXR5KSgpOwoKICAgICAgICAgICAgaWYgKGxvYWRpbmdUYXNrLm9uUGFzc3dvcmQpIHsKICAgICAgICAgICAgICB2YXIgdXBkYXRlUGFzc3dvcmQgPSBmdW5jdGlvbiB1cGRhdGVQYXNzd29yZChwYXNzd29yZCkgewogICAgICAgICAgICAgICAgX3RoaXMxNC5fcGFzc3dvcmRDYXBhYmlsaXR5LnJlc29sdmUoewogICAgICAgICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBsb2FkaW5nVGFzay5vblBhc3N3b3JkKHVwZGF0ZVBhc3N3b3JkLCBleGNlcHRpb24uY29kZSk7CiAgICAgICAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgICAgICAgIF90aGlzMTQuX3Bhc3N3b3JkQ2FwYWJpbGl0eS5yZWplY3QoZXgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBfdGhpczE0Ll9wYXNzd29yZENhcGFiaWxpdHkucmVqZWN0KG5ldyBfdXRpbC5QYXNzd29yZEV4Y2VwdGlvbihleGNlcHRpb24ubWVzc2FnZSwgZXhjZXB0aW9uLmNvZGUpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIF90aGlzMTQuX3Bhc3N3b3JkQ2FwYWJpbGl0eS5wcm9taXNlOwogICAgICAgICAgfSk7CiAgICAgICAgICBtZXNzYWdlSGFuZGxlci5vbigiRGF0YUxvYWRlZCIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgIGlmIChsb2FkaW5nVGFzay5vblByb2dyZXNzKSB7CiAgICAgICAgICAgICAgbG9hZGluZ1Rhc2sub25Qcm9ncmVzcyh7CiAgICAgICAgICAgICAgICBsb2FkZWQ6IGRhdGEubGVuZ3RoLAogICAgICAgICAgICAgICAgdG90YWw6IGRhdGEubGVuZ3RoCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF90aGlzMTQuZG93bmxvYWRJbmZvQ2FwYWJpbGl0eS5yZXNvbHZlKGRhdGEpOwogICAgICAgICAgfSk7CiAgICAgICAgICBtZXNzYWdlSGFuZGxlci5vbigiU3RhcnRSZW5kZXJQYWdlIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgaWYgKF90aGlzMTQuZGVzdHJveWVkKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcGFnZSA9IF90aGlzMTQucGFnZUNhY2hlW2RhdGEucGFnZUluZGV4XTsKCiAgICAgICAgICAgIHBhZ2UuX3N0YXJ0UmVuZGVyUGFnZShkYXRhLnRyYW5zcGFyZW5jeSwgZGF0YS5pbnRlbnQpOwogICAgICAgICAgfSk7CiAgICAgICAgICBtZXNzYWdlSGFuZGxlci5vbigiY29tbW9ub2JqIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgaWYgKF90aGlzMTQuZGVzdHJveWVkKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgX2RhdGEgPSBfc2xpY2VkVG9BcnJheShkYXRhLCAzKSwKICAgICAgICAgICAgICBpZCA9IF9kYXRhWzBdLAogICAgICAgICAgICAgIHR5cGUgPSBfZGF0YVsxXSwKICAgICAgICAgICAgICBleHBvcnRlZERhdGEgPSBfZGF0YVsyXTsKCiAgICAgICAgICAgIGlmIChfdGhpczE0LmNvbW1vbk9ianMuaGFzKGlkKSkgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgICAgICAgY2FzZSAiRm9udCI6CiAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0gX3RoaXMxNC5fcGFyYW1zOwoKICAgICAgICAgICAgICAgIGlmICgiZXJyb3IiIGluIGV4cG9ydGVkRGF0YSkgewogICAgICAgICAgICAgICAgICB2YXIgZXhwb3J0ZWRFcnJvciA9IGV4cG9ydGVkRGF0YS5lcnJvcjsKICAgICAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJFcnJvciBkdXJpbmcgZm9udCBsb2FkaW5nOiAiLmNvbmNhdChleHBvcnRlZEVycm9yKSk7CgogICAgICAgICAgICAgICAgICBfdGhpczE0LmNvbW1vbk9ianMucmVzb2x2ZShpZCwgZXhwb3J0ZWRFcnJvcik7CgogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgZm9udFJlZ2lzdHJ5ID0gbnVsbDsKCiAgICAgICAgICAgICAgICBpZiAocGFyYW1zLnBkZkJ1ZyAmJiBnbG9iYWxUaGlzLkZvbnRJbnNwZWN0b3IgJiYgZ2xvYmFsVGhpcy5Gb250SW5zcGVjdG9yLmVuYWJsZWQpIHsKICAgICAgICAgICAgICAgICAgZm9udFJlZ2lzdHJ5ID0gewogICAgICAgICAgICAgICAgICAgIHJlZ2lzdGVyRm9udDogZnVuY3Rpb24gcmVnaXN0ZXJGb250KGZvbnQsIHVybCkgewogICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsVGhpcy5Gb250SW5zcGVjdG9yLmZvbnRBZGRlZChmb250LCB1cmwpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgZm9udCA9IG5ldyBfZm9udF9sb2FkZXIuRm9udEZhY2VPYmplY3QoZXhwb3J0ZWREYXRhLCB7CiAgICAgICAgICAgICAgICAgIGlzRXZhbFN1cHBvcnRlZDogcGFyYW1zLmlzRXZhbFN1cHBvcnRlZCwKICAgICAgICAgICAgICAgICAgZGlzYWJsZUZvbnRGYWNlOiBwYXJhbXMuZGlzYWJsZUZvbnRGYWNlLAogICAgICAgICAgICAgICAgICBpZ25vcmVFcnJvcnM6IHBhcmFtcy5pZ25vcmVFcnJvcnMsCiAgICAgICAgICAgICAgICAgIG9uVW5zdXBwb3J0ZWRGZWF0dXJlOiBfdGhpczE0Ll9vblVuc3VwcG9ydGVkRmVhdHVyZS5iaW5kKF90aGlzMTQpLAogICAgICAgICAgICAgICAgICBmb250UmVnaXN0cnk6IGZvbnRSZWdpc3RyeQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgX3RoaXMxNC5mb250TG9hZGVyLmJpbmQoZm9udCkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzMTQuY29tbW9uT2Jqcy5yZXNvbHZlKGlkLCBmb250KTsKICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgICAgICAgICAgbWVzc2FnZUhhbmRsZXIuc2VuZFdpdGhQcm9taXNlKCJGb250RmFsbGJhY2siLCB7CiAgICAgICAgICAgICAgICAgICAgaWQ6IGlkCiAgICAgICAgICAgICAgICAgIH0pWyJmaW5hbGx5Il0oZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIF90aGlzMTQuY29tbW9uT2Jqcy5yZXNvbHZlKGlkLCBmb250KTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAiRm9udFBhdGgiOgogICAgICAgICAgICAgIGNhc2UgIkZvbnRUeXBlM1JlcyI6CiAgICAgICAgICAgICAgICBfdGhpczE0LmNvbW1vbk9ianMucmVzb2x2ZShpZCwgZXhwb3J0ZWREYXRhKTsKCiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiR290IHVua25vd24gY29tbW9uIG9iamVjdCB0eXBlICIuY29uY2F0KHR5cGUpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICBtZXNzYWdlSGFuZGxlci5vbigib2JqIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgaWYgKF90aGlzMTQuZGVzdHJveWVkKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIF9kYXRhMiA9IF9zbGljZWRUb0FycmF5KGRhdGEsIDQpLAogICAgICAgICAgICAgIGlkID0gX2RhdGEyWzBdLAogICAgICAgICAgICAgIHBhZ2VJbmRleCA9IF9kYXRhMlsxXSwKICAgICAgICAgICAgICB0eXBlID0gX2RhdGEyWzJdLAogICAgICAgICAgICAgIGltYWdlRGF0YSA9IF9kYXRhMlszXTsKCiAgICAgICAgICAgIHZhciBwYWdlUHJveHkgPSBfdGhpczE0LnBhZ2VDYWNoZVtwYWdlSW5kZXhdOwoKICAgICAgICAgICAgaWYgKHBhZ2VQcm94eS5vYmpzLmhhcyhpZCkpIHsKICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgICAgICBjYXNlICJKcGVnU3RyZWFtIjoKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICAgICAgICAgIHZhciBpbWcgPSBuZXcgSW1hZ2UoKTsKCiAgICAgICAgICAgICAgICAgIGltZy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShpbWcpOwogICAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgICAgaW1nLm9uZXJyb3IgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcigiRXJyb3IgZHVyaW5nIEpQRUcgaW1hZ2UgbG9hZGluZyIpKTsKICAgICAgICAgICAgICAgICAgICAoMCwgX2Rpc3BsYXlfdXRpbHMucmVsZWFzZUltYWdlUmVzb3VyY2VzKShpbWcpOwogICAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgICAgaW1nLnNyYyA9IGltYWdlRGF0YTsKICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKGltZykgewogICAgICAgICAgICAgICAgICBwYWdlUHJveHkub2Jqcy5yZXNvbHZlKGlkLCBpbWcpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgIkltYWdlIjoKICAgICAgICAgICAgICAgIHBhZ2VQcm94eS5vYmpzLnJlc29sdmUoaWQsIGltYWdlRGF0YSk7CiAgICAgICAgICAgICAgICB2YXIgTUFYX0lNQUdFX1NJWkVfVE9fU1RPUkUgPSA4MDAwMDAwOwoKICAgICAgICAgICAgICAgIGlmIChpbWFnZURhdGEgJiYgImRhdGEiIGluIGltYWdlRGF0YSAmJiBpbWFnZURhdGEuZGF0YS5sZW5ndGggPiBNQVhfSU1BR0VfU0laRV9UT19TVE9SRSkgewogICAgICAgICAgICAgICAgICBwYWdlUHJveHkuY2xlYW51cEFmdGVyUmVuZGVyID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiR290IHVua25vd24gb2JqZWN0IHR5cGUgIi5jb25jYXQodHlwZSkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgICAgfSk7CiAgICAgICAgICBtZXNzYWdlSGFuZGxlci5vbigiRG9jUHJvZ3Jlc3MiLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICBpZiAoX3RoaXMxNC5kZXN0cm95ZWQpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChsb2FkaW5nVGFzay5vblByb2dyZXNzKSB7CiAgICAgICAgICAgICAgbG9hZGluZ1Rhc2sub25Qcm9ncmVzcyh7CiAgICAgICAgICAgICAgICBsb2FkZWQ6IGRhdGEubG9hZGVkLAogICAgICAgICAgICAgICAgdG90YWw6IGRhdGEudG90YWwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICBtZXNzYWdlSGFuZGxlci5vbigiVW5zdXBwb3J0ZWRGZWF0dXJlIiwgdGhpcy5fb25VbnN1cHBvcnRlZEZlYXR1cmUuYmluZCh0aGlzKSk7CiAgICAgICAgICBtZXNzYWdlSGFuZGxlci5vbigiSnBlZ0RlY29kZSIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgIGlmIChfdGhpczE0LmRlc3Ryb3llZCkgewogICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoIldvcmtlciB3YXMgZGVzdHJveWVkIikpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodHlwZW9mIGRvY3VtZW50ID09PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoJyJkb2N1bWVudCIgaXMgbm90IGRlZmluZWQuJykpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgX2RhdGEzID0gX3NsaWNlZFRvQXJyYXkoZGF0YSwgMiksCiAgICAgICAgICAgICAgaW1hZ2VVcmwgPSBfZGF0YTNbMF0sCiAgICAgICAgICAgICAgY29tcG9uZW50cyA9IF9kYXRhM1sxXTsKCiAgICAgICAgICAgIGlmIChjb21wb25lbnRzICE9PSAzICYmIGNvbXBvbmVudHMgIT09IDEpIHsKICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKCJPbmx5IDMgY29tcG9uZW50cyBvciAxIGNvbXBvbmVudCBjYW4gYmUgcmV0dXJuZWQiKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICAgICAgdmFyIGltZyA9IG5ldyBJbWFnZSgpOwoKICAgICAgICAgICAgICBpbWcub25sb2FkID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIHdpZHRoID0gaW1nLndpZHRoLAogICAgICAgICAgICAgICAgICBoZWlnaHQgPSBpbWcuaGVpZ2h0OwogICAgICAgICAgICAgICAgdmFyIHNpemUgPSB3aWR0aCAqIGhlaWdodDsKICAgICAgICAgICAgICAgIHZhciByZ2JhTGVuZ3RoID0gc2l6ZSAqIDQ7CiAgICAgICAgICAgICAgICB2YXIgYnVmID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHNpemUgKiBjb21wb25lbnRzKTsKICAgICAgICAgICAgICAgIHZhciB0bXBDYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJjYW52YXMiKTsKICAgICAgICAgICAgICAgIHRtcENhbnZhcy53aWR0aCA9IHdpZHRoOwogICAgICAgICAgICAgICAgdG1wQ2FudmFzLmhlaWdodCA9IGhlaWdodDsKICAgICAgICAgICAgICAgIHZhciB0bXBDdHggPSB0bXBDYW52YXMuZ2V0Q29udGV4dCgiMmQiKTsKICAgICAgICAgICAgICAgIHRtcEN0eC5kcmF3SW1hZ2UoaW1nLCAwLCAwKTsKICAgICAgICAgICAgICAgIHZhciBkYXRhID0gdG1wQ3R4LmdldEltYWdlRGF0YSgwLCAwLCB3aWR0aCwgaGVpZ2h0KS5kYXRhOwoKICAgICAgICAgICAgICAgIGlmIChjb21wb25lbnRzID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBqID0gMDsgaSA8IHJnYmFMZW5ndGg7IGkgKz0gNCwgaiArPSAzKSB7CiAgICAgICAgICAgICAgICAgICAgYnVmW2pdID0gZGF0YVtpXTsKICAgICAgICAgICAgICAgICAgICBidWZbaiArIDFdID0gZGF0YVtpICsgMV07CiAgICAgICAgICAgICAgICAgICAgYnVmW2ogKyAyXSA9IGRhdGFbaSArIDJdOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvbXBvbmVudHMgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgZm9yICh2YXIgX2kyID0gMCwgX2ogPSAwOyBfaTIgPCByZ2JhTGVuZ3RoOyBfaTIgKz0gNCwgX2orKykgewogICAgICAgICAgICAgICAgICAgIGJ1Zltfal0gPSBkYXRhW19pMl07CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXNvbHZlKHsKICAgICAgICAgICAgICAgICAgZGF0YTogYnVmLAogICAgICAgICAgICAgICAgICB3aWR0aDogd2lkdGgsCiAgICAgICAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICgwLCBfZGlzcGxheV91dGlscy5yZWxlYXNlSW1hZ2VSZXNvdXJjZXMpKGltZyk7CiAgICAgICAgICAgICAgICB0bXBDYW52YXMud2lkdGggPSAwOwogICAgICAgICAgICAgICAgdG1wQ2FudmFzLmhlaWdodCA9IDA7CiAgICAgICAgICAgICAgICB0bXBDYW52YXMgPSBudWxsOwogICAgICAgICAgICAgICAgdG1wQ3R4ID0gbnVsbDsKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICBpbWcub25lcnJvciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoIkpwZWdEZWNvZGUgZmFpbGVkIHRvIGxvYWQgaW1hZ2UiKSk7CiAgICAgICAgICAgICAgICAoMCwgX2Rpc3BsYXlfdXRpbHMucmVsZWFzZUltYWdlUmVzb3VyY2VzKShpbWcpOwogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIGltZy5zcmMgPSBpbWFnZVVybDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIG1lc3NhZ2VIYW5kbGVyLm9uKCJGZXRjaEJ1aWx0SW5DTWFwIiwgZnVuY3Rpb24gKGRhdGEsIHNpbmspIHsKICAgICAgICAgICAgaWYgKF90aGlzMTQuZGVzdHJveWVkKSB7CiAgICAgICAgICAgICAgc2luay5lcnJvcihuZXcgRXJyb3IoIldvcmtlciB3YXMgZGVzdHJveWVkIikpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGZldGNoZWQgPSBmYWxzZTsKCiAgICAgICAgICAgIHNpbmsub25QdWxsID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIGlmIChmZXRjaGVkKSB7CiAgICAgICAgICAgICAgICBzaW5rLmNsb3NlKCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBmZXRjaGVkID0gdHJ1ZTsKCiAgICAgICAgICAgICAgX3RoaXMxNC5DTWFwUmVhZGVyRmFjdG9yeS5mZXRjaChkYXRhKS50aGVuKGZ1bmN0aW9uIChidWlsdEluQ01hcCkgewogICAgICAgICAgICAgICAgc2luay5lbnF1ZXVlKGJ1aWx0SW5DTWFwLCAxLCBbYnVpbHRJbkNNYXAuY01hcERhdGEuYnVmZmVyXSk7CiAgICAgICAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgICAgICAgc2luay5lcnJvcihyZWFzb24pOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9OwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiX29uVW5zdXBwb3J0ZWRGZWF0dXJlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX29uVW5zdXBwb3J0ZWRGZWF0dXJlKF9yZWYxMykgewogICAgICAgICAgdmFyIGZlYXR1cmVJZCA9IF9yZWYxMy5mZWF0dXJlSWQ7CgogICAgICAgICAgaWYgKHRoaXMuZGVzdHJveWVkKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodGhpcy5sb2FkaW5nVGFzay5vblVuc3VwcG9ydGVkRmVhdHVyZSkgewogICAgICAgICAgICB0aGlzLmxvYWRpbmdUYXNrLm9uVW5zdXBwb3J0ZWRGZWF0dXJlKGZlYXR1cmVJZCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0RGF0YSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldERhdGEoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5tZXNzYWdlSGFuZGxlci5zZW5kV2l0aFByb21pc2UoIkdldERhdGEiLCBudWxsKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJnZXRQYWdlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UGFnZShwYWdlTnVtYmVyKSB7CiAgICAgICAgICB2YXIgX3RoaXMxNSA9IHRoaXM7CgogICAgICAgICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKHBhZ2VOdW1iZXIpIHx8IHBhZ2VOdW1iZXIgPD0gMCB8fCBwYWdlTnVtYmVyID4gdGhpcy5fbnVtUGFnZXMpIHsKICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcigiSW52YWxpZCBwYWdlIHJlcXVlc3QiKSk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHBhZ2VJbmRleCA9IHBhZ2VOdW1iZXIgLSAxOwoKICAgICAgICAgIGlmIChwYWdlSW5kZXggaW4gdGhpcy5wYWdlUHJvbWlzZXMpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFnZVByb21pc2VzW3BhZ2VJbmRleF07CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHByb21pc2UgPSB0aGlzLm1lc3NhZ2VIYW5kbGVyLnNlbmRXaXRoUHJvbWlzZSgiR2V0UGFnZSIsIHsKICAgICAgICAgICAgcGFnZUluZGV4OiBwYWdlSW5kZXgKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHBhZ2VJbmZvKSB7CiAgICAgICAgICAgIGlmIChfdGhpczE1LmRlc3Ryb3llZCkgewogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVHJhbnNwb3J0IGRlc3Ryb3llZCIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcGFnZSA9IG5ldyBQREZQYWdlUHJveHkocGFnZUluZGV4LCBwYWdlSW5mbywgX3RoaXMxNSwgX3RoaXMxNS5fcGFyYW1zLnBkZkJ1Zyk7CiAgICAgICAgICAgIF90aGlzMTUucGFnZUNhY2hlW3BhZ2VJbmRleF0gPSBwYWdlOwogICAgICAgICAgICByZXR1cm4gcGFnZTsKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5wYWdlUHJvbWlzZXNbcGFnZUluZGV4XSA9IHByb21pc2U7CiAgICAgICAgICByZXR1cm4gcHJvbWlzZTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJnZXRQYWdlSW5kZXgiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRQYWdlSW5kZXgocmVmKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5tZXNzYWdlSGFuZGxlci5zZW5kV2l0aFByb21pc2UoIkdldFBhZ2VJbmRleCIsIHsKICAgICAgICAgICAgcmVmOiByZWYKICAgICAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihyZWFzb24pKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImdldEFubm90YXRpb25zIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0QW5ub3RhdGlvbnMocGFnZUluZGV4LCBpbnRlbnQpIHsKICAgICAgICAgIHJldHVybiB0aGlzLm1lc3NhZ2VIYW5kbGVyLnNlbmRXaXRoUHJvbWlzZSgiR2V0QW5ub3RhdGlvbnMiLCB7CiAgICAgICAgICAgIHBhZ2VJbmRleDogcGFnZUluZGV4LAogICAgICAgICAgICBpbnRlbnQ6IGludGVudAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0RGVzdGluYXRpb25zIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0RGVzdGluYXRpb25zKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMubWVzc2FnZUhhbmRsZXIuc2VuZFdpdGhQcm9taXNlKCJHZXREZXN0aW5hdGlvbnMiLCBudWxsKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJnZXREZXN0aW5hdGlvbiIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldERlc3RpbmF0aW9uKGlkKSB7CiAgICAgICAgICBpZiAodHlwZW9mIGlkICE9PSAic3RyaW5nIikgewogICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKCJJbnZhbGlkIGRlc3RpbmF0aW9uIHJlcXVlc3QuIikpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB0aGlzLm1lc3NhZ2VIYW5kbGVyLnNlbmRXaXRoUHJvbWlzZSgiR2V0RGVzdGluYXRpb24iLCB7CiAgICAgICAgICAgIGlkOiBpZAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0UGFnZUxhYmVscyIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldFBhZ2VMYWJlbHMoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5tZXNzYWdlSGFuZGxlci5zZW5kV2l0aFByb21pc2UoIkdldFBhZ2VMYWJlbHMiLCBudWxsKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJnZXRQYWdlTGF5b3V0IiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UGFnZUxheW91dCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLm1lc3NhZ2VIYW5kbGVyLnNlbmRXaXRoUHJvbWlzZSgiR2V0UGFnZUxheW91dCIsIG51bGwpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImdldFBhZ2VNb2RlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UGFnZU1vZGUoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5tZXNzYWdlSGFuZGxlci5zZW5kV2l0aFByb21pc2UoIkdldFBhZ2VNb2RlIiwgbnVsbCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0Vmlld2VyUHJlZmVyZW5jZXMiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRWaWV3ZXJQcmVmZXJlbmNlcygpIHsKICAgICAgICAgIHJldHVybiB0aGlzLm1lc3NhZ2VIYW5kbGVyLnNlbmRXaXRoUHJvbWlzZSgiR2V0Vmlld2VyUHJlZmVyZW5jZXMiLCBudWxsKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJnZXRPcGVuQWN0aW9uIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0T3BlbkFjdGlvbigpIHsKICAgICAgICAgIHJldHVybiB0aGlzLm1lc3NhZ2VIYW5kbGVyLnNlbmRXaXRoUHJvbWlzZSgiR2V0T3BlbkFjdGlvbiIsIG51bGwpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImdldEF0dGFjaG1lbnRzIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0QXR0YWNobWVudHMoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5tZXNzYWdlSGFuZGxlci5zZW5kV2l0aFByb21pc2UoIkdldEF0dGFjaG1lbnRzIiwgbnVsbCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0SmF2YVNjcmlwdCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldEphdmFTY3JpcHQoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5tZXNzYWdlSGFuZGxlci5zZW5kV2l0aFByb21pc2UoIkdldEphdmFTY3JpcHQiLCBudWxsKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJnZXRPdXRsaW5lIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0T3V0bGluZSgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLm1lc3NhZ2VIYW5kbGVyLnNlbmRXaXRoUHJvbWlzZSgiR2V0T3V0bGluZSIsIG51bGwpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImdldFBlcm1pc3Npb25zIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UGVybWlzc2lvbnMoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5tZXNzYWdlSGFuZGxlci5zZW5kV2l0aFByb21pc2UoIkdldFBlcm1pc3Npb25zIiwgbnVsbCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0TWV0YWRhdGEiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRNZXRhZGF0YSgpIHsKICAgICAgICAgIHZhciBfdGhpczE2ID0gdGhpczsKCiAgICAgICAgICByZXR1cm4gdGhpcy5tZXNzYWdlSGFuZGxlci5zZW5kV2l0aFByb21pc2UoIkdldE1ldGFkYXRhIiwgbnVsbCkudGhlbihmdW5jdGlvbiAocmVzdWx0cykgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIGluZm86IHJlc3VsdHNbMF0sCiAgICAgICAgICAgICAgbWV0YWRhdGE6IHJlc3VsdHNbMV0gPyBuZXcgX21ldGFkYXRhLk1ldGFkYXRhKHJlc3VsdHNbMV0pIDogbnVsbCwKICAgICAgICAgICAgICBjb250ZW50RGlzcG9zaXRpb25GaWxlbmFtZTogX3RoaXMxNi5fZnVsbFJlYWRlciA/IF90aGlzMTYuX2Z1bGxSZWFkZXIuZmlsZW5hbWUgOiBudWxsCiAgICAgICAgICAgIH07CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJnZXRTdGF0cyIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldFN0YXRzKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMubWVzc2FnZUhhbmRsZXIuc2VuZFdpdGhQcm9taXNlKCJHZXRTdGF0cyIsIG51bGwpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInN0YXJ0Q2xlYW51cCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHN0YXJ0Q2xlYW51cCgpIHsKICAgICAgICAgIHZhciBfdGhpczE3ID0gdGhpczsKCiAgICAgICAgICByZXR1cm4gdGhpcy5tZXNzYWdlSGFuZGxlci5zZW5kV2l0aFByb21pc2UoIkNsZWFudXAiLCBudWxsKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gX3RoaXMxNy5wYWdlQ2FjaGUubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICAgIHZhciBwYWdlID0gX3RoaXMxNy5wYWdlQ2FjaGVbaV07CgogICAgICAgICAgICAgIGlmIChwYWdlKSB7CiAgICAgICAgICAgICAgICB2YXIgY2xlYW51cFN1Y2Nlc3NmdWwgPSBwYWdlLmNsZWFudXAoKTsKCiAgICAgICAgICAgICAgICBpZiAoIWNsZWFudXBTdWNjZXNzZnVsKSB7CiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigic3RhcnRDbGVhbnVwOiBQYWdlICIuY29uY2F0KGkgKyAxLCAiIGlzIGN1cnJlbnRseSByZW5kZXJpbmcuIikpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgX3RoaXMxNy5jb21tb25PYmpzLmNsZWFyKCk7CgogICAgICAgICAgICBfdGhpczE3LmZvbnRMb2FkZXIuY2xlYXIoKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImxvYWRpbmdQYXJhbXMiLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgdmFyIHBhcmFtcyA9IHRoaXMuX3BhcmFtczsKICAgICAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAibG9hZGluZ1BhcmFtcyIsIHsKICAgICAgICAgICAgZGlzYWJsZUF1dG9GZXRjaDogcGFyYW1zLmRpc2FibGVBdXRvRmV0Y2gsCiAgICAgICAgICAgIGRpc2FibGVDcmVhdGVPYmplY3RVUkw6IHBhcmFtcy5kaXNhYmxlQ3JlYXRlT2JqZWN0VVJMLAogICAgICAgICAgICBkaXNhYmxlRm9udEZhY2U6IHBhcmFtcy5kaXNhYmxlRm9udEZhY2UsCiAgICAgICAgICAgIG5hdGl2ZUltYWdlRGVjb2RlclN1cHBvcnQ6IHBhcmFtcy5uYXRpdmVJbWFnZURlY29kZXJTdXBwb3J0CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBXb3JrZXJUcmFuc3BvcnQ7CiAgICB9KCk7CgogICAgdmFyIFBERk9iamVjdHMgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBQREZPYmplY3RzKCkgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBQREZPYmplY3RzKTsKCiAgICAgICAgdGhpcy5fb2JqcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhQREZPYmplY3RzLCBbewogICAgICAgIGtleTogIl9lbnN1cmVPYmoiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZW5zdXJlT2JqKG9iaklkKSB7CiAgICAgICAgICBpZiAodGhpcy5fb2Jqc1tvYmpJZF0pIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29ianNbb2JqSWRdOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB0aGlzLl9vYmpzW29iaklkXSA9IHsKICAgICAgICAgICAgY2FwYWJpbGl0eTogKDAsIF91dGlsLmNyZWF0ZVByb21pc2VDYXBhYmlsaXR5KSgpLAogICAgICAgICAgICBkYXRhOiBudWxsLAogICAgICAgICAgICByZXNvbHZlZDogZmFsc2UKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0IiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0KG9iaklkKSB7CiAgICAgICAgICB2YXIgY2FsbGJhY2sgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IG51bGw7CgogICAgICAgICAgaWYgKGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHRoaXMuX2Vuc3VyZU9iaihvYmpJZCkuY2FwYWJpbGl0eS5wcm9taXNlLnRoZW4oY2FsbGJhY2spOwoKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIG9iaiA9IHRoaXMuX29ianNbb2JqSWRdOwoKICAgICAgICAgIGlmICghb2JqIHx8ICFvYmoucmVzb2x2ZWQpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJSZXF1ZXN0aW5nIG9iamVjdCB0aGF0IGlzbid0IHJlc29sdmVkIHlldCAiLmNvbmNhdChvYmpJZCwgIi4iKSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIG9iai5kYXRhOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImhhcyIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGhhcyhvYmpJZCkgewogICAgICAgICAgdmFyIG9iaiA9IHRoaXMuX29ianNbb2JqSWRdOwogICAgICAgICAgcmV0dXJuIG9iaiA/IG9iai5yZXNvbHZlZCA6IGZhbHNlOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInJlc29sdmUiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiByZXNvbHZlKG9iaklkLCBkYXRhKSB7CiAgICAgICAgICB2YXIgb2JqID0gdGhpcy5fZW5zdXJlT2JqKG9iaklkKTsKCiAgICAgICAgICBvYmoucmVzb2x2ZWQgPSB0cnVlOwogICAgICAgICAgb2JqLmRhdGEgPSBkYXRhOwogICAgICAgICAgb2JqLmNhcGFiaWxpdHkucmVzb2x2ZShkYXRhKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJjbGVhciIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNsZWFyKCkgewogICAgICAgICAgZm9yICh2YXIgb2JqSWQgaW4gdGhpcy5fb2JqcykgewogICAgICAgICAgICB2YXIgZGF0YSA9IHRoaXMuX29ianNbb2JqSWRdLmRhdGE7CgogICAgICAgICAgICBpZiAodHlwZW9mIEltYWdlICE9PSAidW5kZWZpbmVkIiAmJiBkYXRhIGluc3RhbmNlb2YgSW1hZ2UpIHsKICAgICAgICAgICAgICAoMCwgX2Rpc3BsYXlfdXRpbHMucmVsZWFzZUltYWdlUmVzb3VyY2VzKShkYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuX29ianMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIFBERk9iamVjdHM7CiAgICB9KCk7CgogICAgdmFyIFJlbmRlclRhc2sgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBSZW5kZXJUYXNrKGludGVybmFsUmVuZGVyVGFzaykgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBSZW5kZXJUYXNrKTsKCiAgICAgICAgdGhpcy5faW50ZXJuYWxSZW5kZXJUYXNrID0gaW50ZXJuYWxSZW5kZXJUYXNrOwogICAgICAgIHRoaXMub25Db250aW51ZSA9IG51bGw7CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhSZW5kZXJUYXNrLCBbewogICAgICAgIGtleTogImNhbmNlbCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNhbmNlbCgpIHsKICAgICAgICAgIHRoaXMuX2ludGVybmFsUmVuZGVyVGFzay5jYW5jZWwoKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJ0aGVuIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gdGhlbihvbkZ1bGZpbGxlZCwgb25SZWplY3RlZCkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJSZW1vdmVkIEFQSSBtZXRob2Q6ICIgKyAiUmVuZGVyVGFzay50aGVuLCB1c2UgdGhlIGBwcm9taXNlYCBnZXR0ZXIgaW5zdGVhZC4iKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJwcm9taXNlIiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9pbnRlcm5hbFJlbmRlclRhc2suY2FwYWJpbGl0eS5wcm9taXNlOwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIFJlbmRlclRhc2s7CiAgICB9KCk7CgogICAgdmFyIEludGVybmFsUmVuZGVyVGFzayA9IGZ1bmN0aW9uIEludGVybmFsUmVuZGVyVGFza0Nsb3N1cmUoKSB7CiAgICAgIHZhciBjYW52YXNJblJlbmRlcmluZyA9IG5ldyBXZWFrU2V0KCk7CgogICAgICB2YXIgSW50ZXJuYWxSZW5kZXJUYXNrID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBJbnRlcm5hbFJlbmRlclRhc2soX3JlZjE0KSB7CiAgICAgICAgICB2YXIgY2FsbGJhY2sgPSBfcmVmMTQuY2FsbGJhY2ssCiAgICAgICAgICAgIHBhcmFtcyA9IF9yZWYxNC5wYXJhbXMsCiAgICAgICAgICAgIG9ianMgPSBfcmVmMTQub2JqcywKICAgICAgICAgICAgY29tbW9uT2JqcyA9IF9yZWYxNC5jb21tb25PYmpzLAogICAgICAgICAgICBvcGVyYXRvckxpc3QgPSBfcmVmMTQub3BlcmF0b3JMaXN0LAogICAgICAgICAgICBwYWdlSW5kZXggPSBfcmVmMTQucGFnZUluZGV4LAogICAgICAgICAgICBjYW52YXNGYWN0b3J5ID0gX3JlZjE0LmNhbnZhc0ZhY3RvcnksCiAgICAgICAgICAgIHdlYkdMQ29udGV4dCA9IF9yZWYxNC53ZWJHTENvbnRleHQsCiAgICAgICAgICAgIF9yZWYxNCR1c2VSZXF1ZXN0QW5pbSA9IF9yZWYxNC51c2VSZXF1ZXN0QW5pbWF0aW9uRnJhbWUsCiAgICAgICAgICAgIHVzZVJlcXVlc3RBbmltYXRpb25GcmFtZSA9IF9yZWYxNCR1c2VSZXF1ZXN0QW5pbSA9PT0gdm9pZCAwID8gZmFsc2UgOiBfcmVmMTQkdXNlUmVxdWVzdEFuaW0sCiAgICAgICAgICAgIF9yZWYxNCRwZGZCdWcgPSBfcmVmMTQucGRmQnVnLAogICAgICAgICAgICBwZGZCdWcgPSBfcmVmMTQkcGRmQnVnID09PSB2b2lkIDAgPyBmYWxzZSA6IF9yZWYxNCRwZGZCdWc7CgogICAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEludGVybmFsUmVuZGVyVGFzayk7CgogICAgICAgICAgdGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrOwogICAgICAgICAgdGhpcy5wYXJhbXMgPSBwYXJhbXM7CiAgICAgICAgICB0aGlzLm9ianMgPSBvYmpzOwogICAgICAgICAgdGhpcy5jb21tb25PYmpzID0gY29tbW9uT2JqczsKICAgICAgICAgIHRoaXMub3BlcmF0b3JMaXN0SWR4ID0gbnVsbDsKICAgICAgICAgIHRoaXMub3BlcmF0b3JMaXN0ID0gb3BlcmF0b3JMaXN0OwogICAgICAgICAgdGhpcy5fcGFnZUluZGV4ID0gcGFnZUluZGV4OwogICAgICAgICAgdGhpcy5jYW52YXNGYWN0b3J5ID0gY2FudmFzRmFjdG9yeTsKICAgICAgICAgIHRoaXMud2ViR0xDb250ZXh0ID0gd2ViR0xDb250ZXh0OwogICAgICAgICAgdGhpcy5fcGRmQnVnID0gcGRmQnVnOwogICAgICAgICAgdGhpcy5ydW5uaW5nID0gZmFsc2U7CiAgICAgICAgICB0aGlzLmdyYXBoaWNzUmVhZHlDYWxsYmFjayA9IG51bGw7CiAgICAgICAgICB0aGlzLmdyYXBoaWNzUmVhZHkgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuX3VzZVJlcXVlc3RBbmltYXRpb25GcmFtZSA9IHVzZVJlcXVlc3RBbmltYXRpb25GcmFtZSA9PT0gdHJ1ZSAmJiB0eXBlb2Ygd2luZG93ICE9PSAidW5kZWZpbmVkIjsKICAgICAgICAgIHRoaXMuY2FuY2VsbGVkID0gZmFsc2U7CiAgICAgICAgICB0aGlzLmNhcGFiaWxpdHkgPSAoMCwgX3V0aWwuY3JlYXRlUHJvbWlzZUNhcGFiaWxpdHkpKCk7CiAgICAgICAgICB0aGlzLnRhc2sgPSBuZXcgUmVuZGVyVGFzayh0aGlzKTsKICAgICAgICAgIHRoaXMuX2NvbnRpbnVlQm91bmQgPSB0aGlzLl9jb250aW51ZS5iaW5kKHRoaXMpOwogICAgICAgICAgdGhpcy5fc2NoZWR1bGVOZXh0Qm91bmQgPSB0aGlzLl9zY2hlZHVsZU5leHQuYmluZCh0aGlzKTsKICAgICAgICAgIHRoaXMuX25leHRCb3VuZCA9IHRoaXMuX25leHQuYmluZCh0aGlzKTsKICAgICAgICAgIHRoaXMuX2NhbnZhcyA9IHBhcmFtcy5jYW52YXNDb250ZXh0LmNhbnZhczsKICAgICAgICB9CgogICAgICAgIF9jcmVhdGVDbGFzcyhJbnRlcm5hbFJlbmRlclRhc2ssIFt7CiAgICAgICAgICBrZXk6ICJpbml0aWFsaXplR3JhcGhpY3MiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGluaXRpYWxpemVHcmFwaGljcygpIHsKICAgICAgICAgICAgdmFyIHRyYW5zcGFyZW5jeSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogZmFsc2U7CgogICAgICAgICAgICBpZiAodGhpcy5jYW5jZWxsZWQpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0aGlzLl9jYW52YXMpIHsKICAgICAgICAgICAgICBpZiAoY2FudmFzSW5SZW5kZXJpbmcuaGFzKHRoaXMuX2NhbnZhcykpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ2Fubm90IHVzZSB0aGUgc2FtZSBjYW52YXMgZHVyaW5nIG11bHRpcGxlIHJlbmRlcigpIG9wZXJhdGlvbnMuICIgKyAiVXNlIGRpZmZlcmVudCBjYW52YXMgb3IgZW5zdXJlIHByZXZpb3VzIG9wZXJhdGlvbnMgd2VyZSAiICsgImNhbmNlbGxlZCBvciBjb21wbGV0ZWQuIik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjYW52YXNJblJlbmRlcmluZy5hZGQodGhpcy5fY2FudmFzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMuX3BkZkJ1ZyAmJiBnbG9iYWxUaGlzLlN0ZXBwZXJNYW5hZ2VyICYmIGdsb2JhbFRoaXMuU3RlcHBlck1hbmFnZXIuZW5hYmxlZCkgewogICAgICAgICAgICAgIHRoaXMuc3RlcHBlciA9IGdsb2JhbFRoaXMuU3RlcHBlck1hbmFnZXIuY3JlYXRlKHRoaXMuX3BhZ2VJbmRleCk7CiAgICAgICAgICAgICAgdGhpcy5zdGVwcGVyLmluaXQodGhpcy5vcGVyYXRvckxpc3QpOwogICAgICAgICAgICAgIHRoaXMuc3RlcHBlci5uZXh0QnJlYWtQb2ludCA9IHRoaXMuc3RlcHBlci5nZXROZXh0QnJlYWtQb2ludCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgX3RoaXMkcGFyYW1zID0gdGhpcy5wYXJhbXMsCiAgICAgICAgICAgICAgY2FudmFzQ29udGV4dCA9IF90aGlzJHBhcmFtcy5jYW52YXNDb250ZXh0LAogICAgICAgICAgICAgIHZpZXdwb3J0ID0gX3RoaXMkcGFyYW1zLnZpZXdwb3J0LAogICAgICAgICAgICAgIHRyYW5zZm9ybSA9IF90aGlzJHBhcmFtcy50cmFuc2Zvcm0sCiAgICAgICAgICAgICAgaW1hZ2VMYXllciA9IF90aGlzJHBhcmFtcy5pbWFnZUxheWVyLAogICAgICAgICAgICAgIGJhY2tncm91bmQgPSBfdGhpcyRwYXJhbXMuYmFja2dyb3VuZDsKICAgICAgICAgICAgdGhpcy5nZnggPSBuZXcgX2NhbnZhcy5DYW52YXNHcmFwaGljcyhjYW52YXNDb250ZXh0LCB0aGlzLmNvbW1vbk9ianMsIHRoaXMub2JqcywgdGhpcy5jYW52YXNGYWN0b3J5LCB0aGlzLndlYkdMQ29udGV4dCwgaW1hZ2VMYXllcik7CiAgICAgICAgICAgIHRoaXMuZ2Z4LmJlZ2luRHJhd2luZyh7CiAgICAgICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2Zvcm0sCiAgICAgICAgICAgICAgdmlld3BvcnQ6IHZpZXdwb3J0LAogICAgICAgICAgICAgIHRyYW5zcGFyZW5jeTogdHJhbnNwYXJlbmN5LAogICAgICAgICAgICAgIGJhY2tncm91bmQ6IGJhY2tncm91bmQKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMub3BlcmF0b3JMaXN0SWR4ID0gMDsKICAgICAgICAgICAgdGhpcy5ncmFwaGljc1JlYWR5ID0gdHJ1ZTsKCiAgICAgICAgICAgIGlmICh0aGlzLmdyYXBoaWNzUmVhZHlDYWxsYmFjaykgewogICAgICAgICAgICAgIHRoaXMuZ3JhcGhpY3NSZWFkeUNhbGxiYWNrKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJjYW5jZWwiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNhbmNlbCgpIHsKICAgICAgICAgICAgdmFyIGVycm9yID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBudWxsOwogICAgICAgICAgICB0aGlzLnJ1bm5pbmcgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5jYW5jZWxsZWQgPSB0cnVlOwoKICAgICAgICAgICAgaWYgKHRoaXMuZ2Z4KSB7CiAgICAgICAgICAgICAgdGhpcy5nZnguZW5kRHJhd2luZygpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpcy5fY2FudmFzKSB7CiAgICAgICAgICAgICAgY2FudmFzSW5SZW5kZXJpbmdbImRlbGV0ZSJdKHRoaXMuX2NhbnZhcyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuY2FsbGJhY2soZXJyb3IgfHwgbmV3IF9kaXNwbGF5X3V0aWxzLlJlbmRlcmluZ0NhbmNlbGxlZEV4Y2VwdGlvbigiUmVuZGVyaW5nIGNhbmNlbGxlZCwgcGFnZSAiLmNvbmNhdCh0aGlzLl9wYWdlSW5kZXggKyAxKSwgImNhbnZhcyIpKTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJvcGVyYXRvckxpc3RDaGFuZ2VkIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBvcGVyYXRvckxpc3RDaGFuZ2VkKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuZ3JhcGhpY3NSZWFkeSkgewogICAgICAgICAgICAgIGlmICghdGhpcy5ncmFwaGljc1JlYWR5Q2FsbGJhY2spIHsKICAgICAgICAgICAgICAgIHRoaXMuZ3JhcGhpY3NSZWFkeUNhbGxiYWNrID0gdGhpcy5fY29udGludWVCb3VuZDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMuc3RlcHBlcikgewogICAgICAgICAgICAgIHRoaXMuc3RlcHBlci51cGRhdGVPcGVyYXRvckxpc3QodGhpcy5vcGVyYXRvckxpc3QpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpcy5ydW5uaW5nKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLl9jb250aW51ZSgpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogIl9jb250aW51ZSIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX2NvbnRpbnVlKCkgewogICAgICAgICAgICB0aGlzLnJ1bm5pbmcgPSB0cnVlOwoKICAgICAgICAgICAgaWYgKHRoaXMuY2FuY2VsbGVkKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpcy50YXNrLm9uQ29udGludWUpIHsKICAgICAgICAgICAgICB0aGlzLnRhc2sub25Db250aW51ZSh0aGlzLl9zY2hlZHVsZU5leHRCb3VuZCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy5fc2NoZWR1bGVOZXh0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJfc2NoZWR1bGVOZXh0IiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfc2NoZWR1bGVOZXh0KCkgewogICAgICAgICAgICB2YXIgX3RoaXMxOCA9IHRoaXM7CgogICAgICAgICAgICBpZiAodGhpcy5fdXNlUmVxdWVzdEFuaW1hdGlvbkZyYW1lKSB7CiAgICAgICAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBfdGhpczE4Ll9uZXh0Qm91bmQoKVsiY2F0Y2giXShfdGhpczE4LmNhbmNlbC5iaW5kKF90aGlzMTgpKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBQcm9taXNlLnJlc29sdmUoKS50aGVuKHRoaXMuX25leHRCb3VuZClbImNhdGNoIl0odGhpcy5jYW5jZWwuYmluZCh0aGlzKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJfbmV4dCIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgX25leHQyID0gX2FzeW5jVG9HZW5lcmF0b3IoLyojX19QVVJFX18qL19yZWdlbmVyYXRvclsiZGVmYXVsdCJdLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclsiZGVmYXVsdCJdLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmNhbmNlbGxlZCkgewogICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDI7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgICAgdGhpcy5vcGVyYXRvckxpc3RJZHggPSB0aGlzLmdmeC5leGVjdXRlT3BlcmF0b3JMaXN0KHRoaXMub3BlcmF0b3JMaXN0LCB0aGlzLm9wZXJhdG9yTGlzdElkeCwgdGhpcy5fY29udGludWVCb3VuZCwgdGhpcy5zdGVwcGVyKTsKCiAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vcGVyYXRvckxpc3RJZHggPT09IHRoaXMub3BlcmF0b3JMaXN0LmFyZ3NBcnJheS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ydW5uaW5nID0gZmFsc2U7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vcGVyYXRvckxpc3QubGFzdENodW5rKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZnguZW5kRHJhd2luZygpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fY2FudmFzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW52YXNJblJlbmRlcmluZ1siZGVsZXRlIl0odGhpcy5fY2FudmFzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FsbGJhY2soKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwgX2NhbGxlZTIsIHRoaXMpOwogICAgICAgICAgICB9KSk7CgogICAgICAgICAgICBmdW5jdGlvbiBfbmV4dCgpIHsKICAgICAgICAgICAgICByZXR1cm4gX25leHQyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBfbmV4dDsKICAgICAgICAgIH0oKQogICAgICAgIH1dKTsKCiAgICAgICAgcmV0dXJuIEludGVybmFsUmVuZGVyVGFzazsKICAgICAgfSgpOwoKICAgICAgcmV0dXJuIEludGVybmFsUmVuZGVyVGFzazsKICAgIH0oKTsKCiAgICB2YXIgdmVyc2lvbiA9ICcyLjQuNDU2JzsKICAgIGV4cG9ydHMudmVyc2lvbiA9IHZlcnNpb247CiAgICB2YXIgYnVpbGQgPSAnMjI4YTU5MWMnOwogICAgZXhwb3J0cy5idWlsZCA9IGJ1aWxkOwoKICAgIC8qKiovfSksICgKICAvKiAxOTEgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgoKICAgIG1vZHVsZS5leHBvcnRzID0gX193X3BkZmpzX3JlcXVpcmVfXygxOTIpOwoKICAgIC8qKiovfSksICgKICAvKiAxOTIgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CiAgICAvKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi8oZnVuY3Rpb24gKG1vZHVsZSkgewoKICAgICAgZnVuY3Rpb24gX3R5cGVvZihvYmopIHsiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2YiO2lmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7X3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7cmV0dXJuIHR5cGVvZiBvYmo7fTt9IGVsc2Uge190eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikge3JldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmo7fTt9cmV0dXJuIF90eXBlb2Yob2JqKTt9CgogICAgICB2YXIgcnVudGltZSA9IGZ1bmN0aW9uIChleHBvcnRzKSB7CiAgICAgICAgInVzZSBzdHJpY3QiOwoKICAgICAgICB2YXIgT3AgPSBPYmplY3QucHJvdG90eXBlOwogICAgICAgIHZhciBoYXNPd24gPSBPcC5oYXNPd25Qcm9wZXJ0eTsKICAgICAgICB2YXIgdW5kZWZpbmVkOwogICAgICAgIHZhciAkU3ltYm9sID0gdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiA/IFN5bWJvbCA6IHt9OwogICAgICAgIHZhciBpdGVyYXRvclN5bWJvbCA9ICRTeW1ib2wuaXRlcmF0b3IgfHwgIkBAaXRlcmF0b3IiOwogICAgICAgIHZhciBhc3luY0l0ZXJhdG9yU3ltYm9sID0gJFN5bWJvbC5hc3luY0l0ZXJhdG9yIHx8ICJAQGFzeW5jSXRlcmF0b3IiOwogICAgICAgIHZhciB0b1N0cmluZ1RhZ1N5bWJvbCA9ICRTeW1ib2wudG9TdHJpbmdUYWcgfHwgIkBAdG9TdHJpbmdUYWciOwoKICAgICAgICBmdW5jdGlvbiB3cmFwKGlubmVyRm4sIG91dGVyRm4sIHNlbGYsIHRyeUxvY3NMaXN0KSB7CiAgICAgICAgICB2YXIgcHJvdG9HZW5lcmF0b3IgPSBvdXRlckZuICYmIG91dGVyRm4ucHJvdG90eXBlIGluc3RhbmNlb2YgR2VuZXJhdG9yID8gb3V0ZXJGbiA6IEdlbmVyYXRvcjsKICAgICAgICAgIHZhciBnZW5lcmF0b3IgPSBPYmplY3QuY3JlYXRlKHByb3RvR2VuZXJhdG9yLnByb3RvdHlwZSk7CiAgICAgICAgICB2YXIgY29udGV4dCA9IG5ldyBDb250ZXh0KHRyeUxvY3NMaXN0IHx8IFtdKTsKICAgICAgICAgIGdlbmVyYXRvci5faW52b2tlID0gbWFrZUludm9rZU1ldGhvZChpbm5lckZuLCBzZWxmLCBjb250ZXh0KTsKICAgICAgICAgIHJldHVybiBnZW5lcmF0b3I7CiAgICAgICAgfQoKICAgICAgICBleHBvcnRzLndyYXAgPSB3cmFwOwoKICAgICAgICBmdW5jdGlvbiB0cnlDYXRjaChmbiwgb2JqLCBhcmcpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgdHlwZTogIm5vcm1hbCIsCiAgICAgICAgICAgICAgYXJnOiBmbi5jYWxsKG9iaiwgYXJnKQogICAgICAgICAgICB9OwogICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgdHlwZTogInRocm93IiwKICAgICAgICAgICAgICBhcmc6IGVycgogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFyIEdlblN0YXRlU3VzcGVuZGVkU3RhcnQgPSAic3VzcGVuZGVkU3RhcnQiOwogICAgICAgIHZhciBHZW5TdGF0ZVN1c3BlbmRlZFlpZWxkID0gInN1c3BlbmRlZFlpZWxkIjsKICAgICAgICB2YXIgR2VuU3RhdGVFeGVjdXRpbmcgPSAiZXhlY3V0aW5nIjsKICAgICAgICB2YXIgR2VuU3RhdGVDb21wbGV0ZWQgPSAiY29tcGxldGVkIjsKICAgICAgICB2YXIgQ29udGludWVTZW50aW5lbCA9IHt9OwoKICAgICAgICBmdW5jdGlvbiBHZW5lcmF0b3IoKSB7fQoKICAgICAgICBmdW5jdGlvbiBHZW5lcmF0b3JGdW5jdGlvbigpIHt9CgogICAgICAgIGZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKCkge30KCiAgICAgICAgdmFyIEl0ZXJhdG9yUHJvdG90eXBlID0ge307CgogICAgICAgIEl0ZXJhdG9yUHJvdG90eXBlW2l0ZXJhdG9yU3ltYm9sXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH07CgogICAgICAgIHZhciBnZXRQcm90byA9IE9iamVjdC5nZXRQcm90b3R5cGVPZjsKICAgICAgICB2YXIgTmF0aXZlSXRlcmF0b3JQcm90b3R5cGUgPSBnZXRQcm90byAmJiBnZXRQcm90byhnZXRQcm90byh2YWx1ZXMoW10pKSk7CgogICAgICAgIGlmIChOYXRpdmVJdGVyYXRvclByb3RvdHlwZSAmJiBOYXRpdmVJdGVyYXRvclByb3RvdHlwZSAhPT0gT3AgJiYgaGFzT3duLmNhbGwoTmF0aXZlSXRlcmF0b3JQcm90b3R5cGUsIGl0ZXJhdG9yU3ltYm9sKSkgewogICAgICAgICAgSXRlcmF0b3JQcm90b3R5cGUgPSBOYXRpdmVJdGVyYXRvclByb3RvdHlwZTsKICAgICAgICB9CgogICAgICAgIHZhciBHcCA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLnByb3RvdHlwZSA9IEdlbmVyYXRvci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEl0ZXJhdG9yUHJvdG90eXBlKTsKICAgICAgICBHZW5lcmF0b3JGdW5jdGlvbi5wcm90b3R5cGUgPSBHcC5jb25zdHJ1Y3RvciA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlOwogICAgICAgIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLmNvbnN0cnVjdG9yID0gR2VuZXJhdG9yRnVuY3Rpb247CiAgICAgICAgR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGVbdG9TdHJpbmdUYWdTeW1ib2xdID0gR2VuZXJhdG9yRnVuY3Rpb24uZGlzcGxheU5hbWUgPSAiR2VuZXJhdG9yRnVuY3Rpb24iOwoKICAgICAgICBmdW5jdGlvbiBkZWZpbmVJdGVyYXRvck1ldGhvZHMocHJvdG90eXBlKSB7CiAgICAgICAgICBbIm5leHQiLCAidGhyb3ciLCAicmV0dXJuIl0uZm9yRWFjaChmdW5jdGlvbiAobWV0aG9kKSB7CiAgICAgICAgICAgIHByb3RvdHlwZVttZXRob2RdID0gZnVuY3Rpb24gKGFyZykgewogICAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBhcmcpOwogICAgICAgICAgICB9OwogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBleHBvcnRzLmlzR2VuZXJhdG9yRnVuY3Rpb24gPSBmdW5jdGlvbiAoZ2VuRnVuKSB7CiAgICAgICAgICB2YXIgY3RvciA9IHR5cGVvZiBnZW5GdW4gPT09ICJmdW5jdGlvbiIgJiYgZ2VuRnVuLmNvbnN0cnVjdG9yOwogICAgICAgICAgcmV0dXJuIGN0b3IgPyBjdG9yID09PSBHZW5lcmF0b3JGdW5jdGlvbiB8fCAoY3Rvci5kaXNwbGF5TmFtZSB8fCBjdG9yLm5hbWUpID09PSAiR2VuZXJhdG9yRnVuY3Rpb24iIDogZmFsc2U7CiAgICAgICAgfTsKCiAgICAgICAgZXhwb3J0cy5tYXJrID0gZnVuY3Rpb24gKGdlbkZ1bikgewogICAgICAgICAgaWYgKE9iamVjdC5zZXRQcm90b3R5cGVPZikgewogICAgICAgICAgICBPYmplY3Quc2V0UHJvdG90eXBlT2YoZ2VuRnVuLCBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBnZW5GdW4uX19wcm90b19fID0gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGU7CgogICAgICAgICAgICBpZiAoISh0b1N0cmluZ1RhZ1N5bWJvbCBpbiBnZW5GdW4pKSB7CiAgICAgICAgICAgICAgZ2VuRnVuW3RvU3RyaW5nVGFnU3ltYm9sXSA9ICJHZW5lcmF0b3JGdW5jdGlvbiI7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBnZW5GdW4ucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShHcCk7CiAgICAgICAgICByZXR1cm4gZ2VuRnVuOwogICAgICAgIH07CgogICAgICAgIGV4cG9ydHMuYXdyYXAgPSBmdW5jdGlvbiAoYXJnKSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBfX2F3YWl0OiBhcmcKICAgICAgICAgIH07CiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gQXN5bmNJdGVyYXRvcihnZW5lcmF0b3IsIFByb21pc2VJbXBsKSB7CiAgICAgICAgICBmdW5jdGlvbiBpbnZva2UobWV0aG9kLCBhcmcsIHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgICB2YXIgcmVjb3JkID0gdHJ5Q2F0Y2goZ2VuZXJhdG9yW21ldGhvZF0sIGdlbmVyYXRvciwgYXJnKTsKCiAgICAgICAgICAgIGlmIChyZWNvcmQudHlwZSA9PT0gInRocm93IikgewogICAgICAgICAgICAgIHJlamVjdChyZWNvcmQuYXJnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gcmVjb3JkLmFyZzsKICAgICAgICAgICAgICB2YXIgdmFsdWUgPSByZXN1bHQudmFsdWU7CgogICAgICAgICAgICAgIGlmICh2YWx1ZSAmJiBfdHlwZW9mKHZhbHVlKSA9PT0gIm9iamVjdCIgJiYgaGFzT3duLmNhbGwodmFsdWUsICJfX2F3YWl0IikpIHsKICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlSW1wbC5yZXNvbHZlKHZhbHVlLl9fYXdhaXQpLnRoZW4oZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgIGludm9rZSgibmV4dCIsIHZhbHVlLCByZXNvbHZlLCByZWplY3QpOwogICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikgewogICAgICAgICAgICAgICAgICBpbnZva2UoInRocm93IiwgZXJyLCByZXNvbHZlLCByZWplY3QpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZUltcGwucmVzb2x2ZSh2YWx1ZSkudGhlbihmdW5jdGlvbiAodW53cmFwcGVkKSB7CiAgICAgICAgICAgICAgICByZXN1bHQudmFsdWUgPSB1bndyYXBwZWQ7CiAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7CiAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaW52b2tlKCJ0aHJvdyIsIGVycm9yLCByZXNvbHZlLCByZWplY3QpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHByZXZpb3VzUHJvbWlzZTsKCiAgICAgICAgICBmdW5jdGlvbiBlbnF1ZXVlKG1ldGhvZCwgYXJnKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnKCkgewogICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZUltcGwoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgICAgICAgaW52b2tlKG1ldGhvZCwgYXJnLCByZXNvbHZlLCByZWplY3QpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcHJldmlvdXNQcm9taXNlID0gcHJldmlvdXNQcm9taXNlID8gcHJldmlvdXNQcm9taXNlLnRoZW4oY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcsIGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnKSA6IGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnKCk7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5faW52b2tlID0gZW5xdWV1ZTsKICAgICAgICB9CgogICAgICAgIGRlZmluZUl0ZXJhdG9yTWV0aG9kcyhBc3luY0l0ZXJhdG9yLnByb3RvdHlwZSk7CgogICAgICAgIEFzeW5jSXRlcmF0b3IucHJvdG90eXBlW2FzeW5jSXRlcmF0b3JTeW1ib2xdID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfTsKCiAgICAgICAgZXhwb3J0cy5Bc3luY0l0ZXJhdG9yID0gQXN5bmNJdGVyYXRvcjsKCiAgICAgICAgZXhwb3J0cy5hc3luYyA9IGZ1bmN0aW9uIChpbm5lckZuLCBvdXRlckZuLCBzZWxmLCB0cnlMb2NzTGlzdCwgUHJvbWlzZUltcGwpIHsKICAgICAgICAgIGlmIChQcm9taXNlSW1wbCA9PT0gdm9pZCAwKSBQcm9taXNlSW1wbCA9IFByb21pc2U7CiAgICAgICAgICB2YXIgaXRlciA9IG5ldyBBc3luY0l0ZXJhdG9yKHdyYXAoaW5uZXJGbiwgb3V0ZXJGbiwgc2VsZiwgdHJ5TG9jc0xpc3QpLCBQcm9taXNlSW1wbCk7CiAgICAgICAgICByZXR1cm4gZXhwb3J0cy5pc0dlbmVyYXRvckZ1bmN0aW9uKG91dGVyRm4pID8gaXRlciA6IGl0ZXIubmV4dCgpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICByZXR1cm4gcmVzdWx0LmRvbmUgPyByZXN1bHQudmFsdWUgOiBpdGVyLm5leHQoKTsKICAgICAgICAgIH0pOwogICAgICAgIH07CgogICAgICAgIGZ1bmN0aW9uIG1ha2VJbnZva2VNZXRob2QoaW5uZXJGbiwgc2VsZiwgY29udGV4dCkgewogICAgICAgICAgdmFyIHN0YXRlID0gR2VuU3RhdGVTdXNwZW5kZWRTdGFydDsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbiBpbnZva2UobWV0aG9kLCBhcmcpIHsKICAgICAgICAgICAgaWYgKHN0YXRlID09PSBHZW5TdGF0ZUV4ZWN1dGluZykgewogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiR2VuZXJhdG9yIGlzIGFscmVhZHkgcnVubmluZyIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoc3RhdGUgPT09IEdlblN0YXRlQ29tcGxldGVkKSB7CiAgICAgICAgICAgICAgaWYgKG1ldGhvZCA9PT0gInRocm93IikgewogICAgICAgICAgICAgICAgdGhyb3cgYXJnOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIGRvbmVSZXN1bHQoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29udGV4dC5tZXRob2QgPSBtZXRob2Q7CiAgICAgICAgICAgIGNvbnRleHQuYXJnID0gYXJnOwoKICAgICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgICB2YXIgZGVsZWdhdGUgPSBjb250ZXh0LmRlbGVnYXRlOwoKICAgICAgICAgICAgICBpZiAoZGVsZWdhdGUpIHsKICAgICAgICAgICAgICAgIHZhciBkZWxlZ2F0ZVJlc3VsdCA9IG1heWJlSW52b2tlRGVsZWdhdGUoZGVsZWdhdGUsIGNvbnRleHQpOwoKICAgICAgICAgICAgICAgIGlmIChkZWxlZ2F0ZVJlc3VsdCkgewogICAgICAgICAgICAgICAgICBpZiAoZGVsZWdhdGVSZXN1bHQgPT09IENvbnRpbnVlU2VudGluZWwpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICByZXR1cm4gZGVsZWdhdGVSZXN1bHQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoY29udGV4dC5tZXRob2QgPT09ICJuZXh0IikgewogICAgICAgICAgICAgICAgY29udGV4dC5zZW50ID0gY29udGV4dC5fc2VudCA9IGNvbnRleHQuYXJnOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoY29udGV4dC5tZXRob2QgPT09ICJ0aHJvdyIpIHsKICAgICAgICAgICAgICAgIGlmIChzdGF0ZSA9PT0gR2VuU3RhdGVTdXNwZW5kZWRTdGFydCkgewogICAgICAgICAgICAgICAgICBzdGF0ZSA9IEdlblN0YXRlQ29tcGxldGVkOwogICAgICAgICAgICAgICAgICB0aHJvdyBjb250ZXh0LmFyZzsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb250ZXh0LmRpc3BhdGNoRXhjZXB0aW9uKGNvbnRleHQuYXJnKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvbnRleHQubWV0aG9kID09PSAicmV0dXJuIikgewogICAgICAgICAgICAgICAgY29udGV4dC5hYnJ1cHQoInJldHVybiIsIGNvbnRleHQuYXJnKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHN0YXRlID0gR2VuU3RhdGVFeGVjdXRpbmc7CiAgICAgICAgICAgICAgdmFyIHJlY29yZCA9IHRyeUNhdGNoKGlubmVyRm4sIHNlbGYsIGNvbnRleHQpOwoKICAgICAgICAgICAgICBpZiAocmVjb3JkLnR5cGUgPT09ICJub3JtYWwiKSB7CiAgICAgICAgICAgICAgICBzdGF0ZSA9IGNvbnRleHQuZG9uZSA/IEdlblN0YXRlQ29tcGxldGVkIDogR2VuU3RhdGVTdXNwZW5kZWRZaWVsZDsKCiAgICAgICAgICAgICAgICBpZiAocmVjb3JkLmFyZyA9PT0gQ29udGludWVTZW50aW5lbCkgewogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICB2YWx1ZTogcmVjb3JkLmFyZywKICAgICAgICAgICAgICAgICAgZG9uZTogY29udGV4dC5kb25lCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVjb3JkLnR5cGUgPT09ICJ0aHJvdyIpIHsKICAgICAgICAgICAgICAgIHN0YXRlID0gR2VuU3RhdGVDb21wbGV0ZWQ7CiAgICAgICAgICAgICAgICBjb250ZXh0Lm1ldGhvZCA9ICJ0aHJvdyI7CiAgICAgICAgICAgICAgICBjb250ZXh0LmFyZyA9IHJlY29yZC5hcmc7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gbWF5YmVJbnZva2VEZWxlZ2F0ZShkZWxlZ2F0ZSwgY29udGV4dCkgewogICAgICAgICAgdmFyIG1ldGhvZCA9IGRlbGVnYXRlLml0ZXJhdG9yW2NvbnRleHQubWV0aG9kXTsKCiAgICAgICAgICBpZiAobWV0aG9kID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgY29udGV4dC5kZWxlZ2F0ZSA9IG51bGw7CgogICAgICAgICAgICBpZiAoY29udGV4dC5tZXRob2QgPT09ICJ0aHJvdyIpIHsKICAgICAgICAgICAgICBpZiAoZGVsZWdhdGUuaXRlcmF0b3JbInJldHVybiJdKSB7CiAgICAgICAgICAgICAgICBjb250ZXh0Lm1ldGhvZCA9ICJyZXR1cm4iOwogICAgICAgICAgICAgICAgY29udGV4dC5hcmcgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICBtYXliZUludm9rZURlbGVnYXRlKGRlbGVnYXRlLCBjb250ZXh0KTsKCiAgICAgICAgICAgICAgICBpZiAoY29udGV4dC5tZXRob2QgPT09ICJ0aHJvdyIpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjb250ZXh0Lm1ldGhvZCA9ICJ0aHJvdyI7CiAgICAgICAgICAgICAgY29udGV4dC5hcmcgPSBuZXcgVHlwZUVycm9yKCJUaGUgaXRlcmF0b3IgZG9lcyBub3QgcHJvdmlkZSBhICd0aHJvdycgbWV0aG9kIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBDb250aW51ZVNlbnRpbmVsOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciByZWNvcmQgPSB0cnlDYXRjaChtZXRob2QsIGRlbGVnYXRlLml0ZXJhdG9yLCBjb250ZXh0LmFyZyk7CgogICAgICAgICAgaWYgKHJlY29yZC50eXBlID09PSAidGhyb3ciKSB7CiAgICAgICAgICAgIGNvbnRleHQubWV0aG9kID0gInRocm93IjsKICAgICAgICAgICAgY29udGV4dC5hcmcgPSByZWNvcmQuYXJnOwogICAgICAgICAgICBjb250ZXh0LmRlbGVnYXRlID0gbnVsbDsKICAgICAgICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGluZm8gPSByZWNvcmQuYXJnOwoKICAgICAgICAgIGlmICghaW5mbykgewogICAgICAgICAgICBjb250ZXh0Lm1ldGhvZCA9ICJ0aHJvdyI7CiAgICAgICAgICAgIGNvbnRleHQuYXJnID0gbmV3IFR5cGVFcnJvcigiaXRlcmF0b3IgcmVzdWx0IGlzIG5vdCBhbiBvYmplY3QiKTsKICAgICAgICAgICAgY29udGV4dC5kZWxlZ2F0ZSA9IG51bGw7CiAgICAgICAgICAgIHJldHVybiBDb250aW51ZVNlbnRpbmVsOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChpbmZvLmRvbmUpIHsKICAgICAgICAgICAgY29udGV4dFtkZWxlZ2F0ZS5yZXN1bHROYW1lXSA9IGluZm8udmFsdWU7CiAgICAgICAgICAgIGNvbnRleHQubmV4dCA9IGRlbGVnYXRlLm5leHRMb2M7CgogICAgICAgICAgICBpZiAoY29udGV4dC5tZXRob2QgIT09ICJyZXR1cm4iKSB7CiAgICAgICAgICAgICAgY29udGV4dC5tZXRob2QgPSAibmV4dCI7CiAgICAgICAgICAgICAgY29udGV4dC5hcmcgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBpbmZvOwogICAgICAgICAgfQoKICAgICAgICAgIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsOwogICAgICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7CiAgICAgICAgfQoKICAgICAgICBkZWZpbmVJdGVyYXRvck1ldGhvZHMoR3ApOwogICAgICAgIEdwW3RvU3RyaW5nVGFnU3ltYm9sXSA9ICJHZW5lcmF0b3IiOwoKICAgICAgICBHcFtpdGVyYXRvclN5bWJvbF0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9OwoKICAgICAgICBHcC50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiAiW29iamVjdCBHZW5lcmF0b3JdIjsKICAgICAgICB9OwoKICAgICAgICBmdW5jdGlvbiBwdXNoVHJ5RW50cnkobG9jcykgewogICAgICAgICAgdmFyIGVudHJ5ID0gewogICAgICAgICAgICB0cnlMb2M6IGxvY3NbMF0KICAgICAgICAgIH07CgogICAgICAgICAgaWYgKDEgaW4gbG9jcykgewogICAgICAgICAgICBlbnRyeS5jYXRjaExvYyA9IGxvY3NbMV07CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKDIgaW4gbG9jcykgewogICAgICAgICAgICBlbnRyeS5maW5hbGx5TG9jID0gbG9jc1syXTsKICAgICAgICAgICAgZW50cnkuYWZ0ZXJMb2MgPSBsb2NzWzNdOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMudHJ5RW50cmllcy5wdXNoKGVudHJ5KTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHJlc2V0VHJ5RW50cnkoZW50cnkpIHsKICAgICAgICAgIHZhciByZWNvcmQgPSBlbnRyeS5jb21wbGV0aW9uIHx8IHt9OwogICAgICAgICAgcmVjb3JkLnR5cGUgPSAibm9ybWFsIjsKICAgICAgICAgIGRlbGV0ZSByZWNvcmQuYXJnOwogICAgICAgICAgZW50cnkuY29tcGxldGlvbiA9IHJlY29yZDsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIENvbnRleHQodHJ5TG9jc0xpc3QpIHsKICAgICAgICAgIHRoaXMudHJ5RW50cmllcyA9IFt7CiAgICAgICAgICAgIHRyeUxvYzogInJvb3QiCiAgICAgICAgICB9XTsKICAgICAgICAgIHRyeUxvY3NMaXN0LmZvckVhY2gocHVzaFRyeUVudHJ5LCB0aGlzKTsKICAgICAgICAgIHRoaXMucmVzZXQodHJ1ZSk7CiAgICAgICAgfQoKICAgICAgICBleHBvcnRzLmtleXMgPSBmdW5jdGlvbiAob2JqZWN0KSB7CiAgICAgICAgICB2YXIga2V5cyA9IFtdOwoKICAgICAgICAgIGZvciAodmFyIGtleSBpbiBvYmplY3QpIHsKICAgICAgICAgICAga2V5cy5wdXNoKGtleSk7CiAgICAgICAgICB9CgogICAgICAgICAga2V5cy5yZXZlcnNlKCk7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gbmV4dCgpIHsKICAgICAgICAgICAgd2hpbGUgKGtleXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgdmFyIGtleSA9IGtleXMucG9wKCk7CgogICAgICAgICAgICAgIGlmIChrZXkgaW4gb2JqZWN0KSB7CiAgICAgICAgICAgICAgICBuZXh0LnZhbHVlID0ga2V5OwogICAgICAgICAgICAgICAgbmV4dC5kb25lID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV4dDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG5leHQuZG9uZSA9IHRydWU7CiAgICAgICAgICAgIHJldHVybiBuZXh0OwogICAgICAgICAgfTsKICAgICAgICB9OwoKICAgICAgICBmdW5jdGlvbiB2YWx1ZXMoaXRlcmFibGUpIHsKICAgICAgICAgIGlmIChpdGVyYWJsZSkgewogICAgICAgICAgICB2YXIgaXRlcmF0b3JNZXRob2QgPSBpdGVyYWJsZVtpdGVyYXRvclN5bWJvbF07CgogICAgICAgICAgICBpZiAoaXRlcmF0b3JNZXRob2QpIHsKICAgICAgICAgICAgICByZXR1cm4gaXRlcmF0b3JNZXRob2QuY2FsbChpdGVyYWJsZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0eXBlb2YgaXRlcmFibGUubmV4dCA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgIHJldHVybiBpdGVyYWJsZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCFpc05hTihpdGVyYWJsZS5sZW5ndGgpKSB7CiAgICAgICAgICAgICAgdmFyIGkgPSAtMSwKICAgICAgICAgICAgICAgIG5leHQgPSBmdW5jdGlvbiBuZXh0KCkgewogICAgICAgICAgICAgICAgICB3aGlsZSAoKytpIDwgaXRlcmFibGUubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc093bi5jYWxsKGl0ZXJhYmxlLCBpKSkgewogICAgICAgICAgICAgICAgICAgICAgbmV4dC52YWx1ZSA9IGl0ZXJhYmxlW2ldOwogICAgICAgICAgICAgICAgICAgICAgbmV4dC5kb25lID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV4dDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIG5leHQudmFsdWUgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICAgIG5leHQuZG9uZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHJldHVybiBuZXh0OwogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgcmV0dXJuIG5leHQubmV4dCA9IG5leHQ7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBuZXh0OiBkb25lUmVzdWx0CiAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgZXhwb3J0cy52YWx1ZXMgPSB2YWx1ZXM7CgogICAgICAgIGZ1bmN0aW9uIGRvbmVSZXN1bHQoKSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICB2YWx1ZTogdW5kZWZpbmVkLAogICAgICAgICAgICBkb25lOiB0cnVlCiAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgQ29udGV4dC5wcm90b3R5cGUgPSB7CiAgICAgICAgICBjb25zdHJ1Y3RvcjogQ29udGV4dCwKICAgICAgICAgIHJlc2V0OiBmdW5jdGlvbiByZXNldChza2lwVGVtcFJlc2V0KSB7CiAgICAgICAgICAgIHRoaXMucHJldiA9IDA7CiAgICAgICAgICAgIHRoaXMubmV4dCA9IDA7CiAgICAgICAgICAgIHRoaXMuc2VudCA9IHRoaXMuX3NlbnQgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgIHRoaXMuZG9uZSA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmRlbGVnYXRlID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5tZXRob2QgPSAibmV4dCI7CiAgICAgICAgICAgIHRoaXMuYXJnID0gdW5kZWZpbmVkOwogICAgICAgICAgICB0aGlzLnRyeUVudHJpZXMuZm9yRWFjaChyZXNldFRyeUVudHJ5KTsKCiAgICAgICAgICAgIGlmICghc2tpcFRlbXBSZXNldCkgewogICAgICAgICAgICAgIGZvciAodmFyIG5hbWUgaW4gdGhpcykgewogICAgICAgICAgICAgICAgaWYgKG5hbWUuY2hhckF0KDApID09PSAidCIgJiYgaGFzT3duLmNhbGwodGhpcywgbmFtZSkgJiYgIWlzTmFOKCtuYW1lLnNsaWNlKDEpKSkgewogICAgICAgICAgICAgICAgICB0aGlzW25hbWVdID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgIHN0b3A6IGZ1bmN0aW9uIHN0b3AoKSB7CiAgICAgICAgICAgIHRoaXMuZG9uZSA9IHRydWU7CiAgICAgICAgICAgIHZhciByb290RW50cnkgPSB0aGlzLnRyeUVudHJpZXNbMF07CiAgICAgICAgICAgIHZhciByb290UmVjb3JkID0gcm9vdEVudHJ5LmNvbXBsZXRpb247CgogICAgICAgICAgICBpZiAocm9vdFJlY29yZC50eXBlID09PSAidGhyb3ciKSB7CiAgICAgICAgICAgICAgdGhyb3cgcm9vdFJlY29yZC5hcmc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB0aGlzLnJ2YWw7CiAgICAgICAgICB9LAogICAgICAgICAgZGlzcGF0Y2hFeGNlcHRpb246IGZ1bmN0aW9uIGRpc3BhdGNoRXhjZXB0aW9uKGV4Y2VwdGlvbikgewogICAgICAgICAgICBpZiAodGhpcy5kb25lKSB7CiAgICAgICAgICAgICAgdGhyb3cgZXhjZXB0aW9uOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgY29udGV4dCA9IHRoaXM7CgogICAgICAgICAgICBmdW5jdGlvbiBoYW5kbGUobG9jLCBjYXVnaHQpIHsKICAgICAgICAgICAgICByZWNvcmQudHlwZSA9ICJ0aHJvdyI7CiAgICAgICAgICAgICAgcmVjb3JkLmFyZyA9IGV4Y2VwdGlvbjsKICAgICAgICAgICAgICBjb250ZXh0Lm5leHQgPSBsb2M7CgogICAgICAgICAgICAgIGlmIChjYXVnaHQpIHsKICAgICAgICAgICAgICAgIGNvbnRleHQubWV0aG9kID0gIm5leHQiOwogICAgICAgICAgICAgICAgY29udGV4dC5hcmcgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gISFjYXVnaHQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHsKICAgICAgICAgICAgICB2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV07CiAgICAgICAgICAgICAgdmFyIHJlY29yZCA9IGVudHJ5LmNvbXBsZXRpb247CgogICAgICAgICAgICAgIGlmIChlbnRyeS50cnlMb2MgPT09ICJyb290IikgewogICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZSgiZW5kIik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoZW50cnkudHJ5TG9jIDw9IHRoaXMucHJldikgewogICAgICAgICAgICAgICAgdmFyIGhhc0NhdGNoID0gaGFzT3duLmNhbGwoZW50cnksICJjYXRjaExvYyIpOwogICAgICAgICAgICAgICAgdmFyIGhhc0ZpbmFsbHkgPSBoYXNPd24uY2FsbChlbnRyeSwgImZpbmFsbHlMb2MiKTsKCiAgICAgICAgICAgICAgICBpZiAoaGFzQ2F0Y2ggJiYgaGFzRmluYWxseSkgewogICAgICAgICAgICAgICAgICBpZiAodGhpcy5wcmV2IDwgZW50cnkuY2F0Y2hMb2MpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlKGVudHJ5LmNhdGNoTG9jLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnByZXYgPCBlbnRyeS5maW5hbGx5TG9jKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZShlbnRyeS5maW5hbGx5TG9jKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChoYXNDYXRjaCkgewogICAgICAgICAgICAgICAgICBpZiAodGhpcy5wcmV2IDwgZW50cnkuY2F0Y2hMb2MpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlKGVudHJ5LmNhdGNoTG9jLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChoYXNGaW5hbGx5KSB7CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnByZXYgPCBlbnRyeS5maW5hbGx5TG9jKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZShlbnRyeS5maW5hbGx5TG9jKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJ0cnkgc3RhdGVtZW50IHdpdGhvdXQgY2F0Y2ggb3IgZmluYWxseSIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgIGFicnVwdDogZnVuY3Rpb24gYWJydXB0KHR5cGUsIGFyZykgewogICAgICAgICAgICBmb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7CiAgICAgICAgICAgICAgdmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldOwoKICAgICAgICAgICAgICBpZiAoZW50cnkudHJ5TG9jIDw9IHRoaXMucHJldiAmJiBoYXNPd24uY2FsbChlbnRyeSwgImZpbmFsbHlMb2MiKSAmJiB0aGlzLnByZXYgPCBlbnRyeS5maW5hbGx5TG9jKSB7CiAgICAgICAgICAgICAgICB2YXIgZmluYWxseUVudHJ5ID0gZW50cnk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmaW5hbGx5RW50cnkgJiYgKHR5cGUgPT09ICJicmVhayIgfHwgdHlwZSA9PT0gImNvbnRpbnVlIikgJiYgZmluYWxseUVudHJ5LnRyeUxvYyA8PSBhcmcgJiYgYXJnIDw9IGZpbmFsbHlFbnRyeS5maW5hbGx5TG9jKSB7CiAgICAgICAgICAgICAgZmluYWxseUVudHJ5ID0gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHJlY29yZCA9IGZpbmFsbHlFbnRyeSA/IGZpbmFsbHlFbnRyeS5jb21wbGV0aW9uIDoge307CiAgICAgICAgICAgIHJlY29yZC50eXBlID0gdHlwZTsKICAgICAgICAgICAgcmVjb3JkLmFyZyA9IGFyZzsKCiAgICAgICAgICAgIGlmIChmaW5hbGx5RW50cnkpIHsKICAgICAgICAgICAgICB0aGlzLm1ldGhvZCA9ICJuZXh0IjsKICAgICAgICAgICAgICB0aGlzLm5leHQgPSBmaW5hbGx5RW50cnkuZmluYWxseUxvYzsKICAgICAgICAgICAgICByZXR1cm4gQ29udGludWVTZW50aW5lbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29tcGxldGUocmVjb3JkKTsKICAgICAgICAgIH0sCiAgICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24gY29tcGxldGUocmVjb3JkLCBhZnRlckxvYykgewogICAgICAgICAgICBpZiAocmVjb3JkLnR5cGUgPT09ICJ0aHJvdyIpIHsKICAgICAgICAgICAgICB0aHJvdyByZWNvcmQuYXJnOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocmVjb3JkLnR5cGUgPT09ICJicmVhayIgfHwgcmVjb3JkLnR5cGUgPT09ICJjb250aW51ZSIpIHsKICAgICAgICAgICAgICB0aGlzLm5leHQgPSByZWNvcmQuYXJnOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlY29yZC50eXBlID09PSAicmV0dXJuIikgewogICAgICAgICAgICAgIHRoaXMucnZhbCA9IHRoaXMuYXJnID0gcmVjb3JkLmFyZzsKICAgICAgICAgICAgICB0aGlzLm1ldGhvZCA9ICJyZXR1cm4iOwogICAgICAgICAgICAgIHRoaXMubmV4dCA9ICJlbmQiOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlY29yZC50eXBlID09PSAibm9ybWFsIiAmJiBhZnRlckxvYykgewogICAgICAgICAgICAgIHRoaXMubmV4dCA9IGFmdGVyTG9jOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gQ29udGludWVTZW50aW5lbDsKICAgICAgICAgIH0sCiAgICAgICAgICBmaW5pc2g6IGZ1bmN0aW9uIGZpbmlzaChmaW5hbGx5TG9jKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHsKICAgICAgICAgICAgICB2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV07CgogICAgICAgICAgICAgIGlmIChlbnRyeS5maW5hbGx5TG9jID09PSBmaW5hbGx5TG9jKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNvbXBsZXRlKGVudHJ5LmNvbXBsZXRpb24sIGVudHJ5LmFmdGVyTG9jKTsKICAgICAgICAgICAgICAgIHJlc2V0VHJ5RW50cnkoZW50cnkpOwogICAgICAgICAgICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgImNhdGNoIjogZnVuY3Rpb24gX2NhdGNoKHRyeUxvYykgewogICAgICAgICAgICBmb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7CiAgICAgICAgICAgICAgdmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldOwoKICAgICAgICAgICAgICBpZiAoZW50cnkudHJ5TG9jID09PSB0cnlMb2MpIHsKICAgICAgICAgICAgICAgIHZhciByZWNvcmQgPSBlbnRyeS5jb21wbGV0aW9uOwoKICAgICAgICAgICAgICAgIGlmIChyZWNvcmQudHlwZSA9PT0gInRocm93IikgewogICAgICAgICAgICAgICAgICB2YXIgdGhyb3duID0gcmVjb3JkLmFyZzsKICAgICAgICAgICAgICAgICAgcmVzZXRUcnlFbnRyeShlbnRyeSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIHRocm93bjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiaWxsZWdhbCBjYXRjaCBhdHRlbXB0Iik7CiAgICAgICAgICB9LAogICAgICAgICAgZGVsZWdhdGVZaWVsZDogZnVuY3Rpb24gZGVsZWdhdGVZaWVsZChpdGVyYWJsZSwgcmVzdWx0TmFtZSwgbmV4dExvYykgewogICAgICAgICAgICB0aGlzLmRlbGVnYXRlID0gewogICAgICAgICAgICAgIGl0ZXJhdG9yOiB2YWx1ZXMoaXRlcmFibGUpLAogICAgICAgICAgICAgIHJlc3VsdE5hbWU6IHJlc3VsdE5hbWUsCiAgICAgICAgICAgICAgbmV4dExvYzogbmV4dExvYwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgaWYgKHRoaXMubWV0aG9kID09PSAibmV4dCIpIHsKICAgICAgICAgICAgICB0aGlzLmFyZyA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gZXhwb3J0czsKICAgICAgfSgoZmFsc2UgPyB1bmRlZmluZWQgOiBfdHlwZW9mKG1vZHVsZSkpID09PSAib2JqZWN0IiA/IG1vZHVsZS5leHBvcnRzIDoge30pOwoKICAgICAgdHJ5IHsKICAgICAgICByZWdlbmVyYXRvclJ1bnRpbWUgPSBydW50aW1lOwogICAgICB9IGNhdGNoIChhY2NpZGVudGFsU3RyaWN0TW9kZSkgewogICAgICAgIEZ1bmN0aW9uKCJyIiwgInJlZ2VuZXJhdG9yUnVudGltZSA9IHIiKShydW50aW1lKTsKICAgICAgfQogICAgICAvKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi99KS5jYWxsKHRoaXMsIF9fd19wZGZqc19yZXF1aXJlX18oMTkzKShtb2R1bGUpKTsKCiAgICAvKioqL30pLCAoCiAgLyogMTkzICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKCiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChtb2R1bGUpIHsKICAgICAgaWYgKCFtb2R1bGUud2VicGFja1BvbHlmaWxsKSB7CiAgICAgICAgbW9kdWxlLmRlcHJlY2F0ZSA9IGZ1bmN0aW9uICgpIHt9OwoKICAgICAgICBtb2R1bGUucGF0aHMgPSBbXTsKICAgICAgICBpZiAoIW1vZHVsZS5jaGlsZHJlbikgbW9kdWxlLmNoaWxkcmVuID0gW107CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG1vZHVsZSwgImxvYWRlZCIsIHsKICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIG1vZHVsZS5sOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShtb2R1bGUsICJpZCIsIHsKICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIG1vZHVsZS5pOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIG1vZHVsZS53ZWJwYWNrUG9seWZpbGwgPSAxOwogICAgICB9CgogICAgICByZXR1cm4gbW9kdWxlOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogMTk0ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgIHZhbHVlOiB0cnVlCiAgICB9KTsKICAgIGV4cG9ydHMuYWRkTGlua0F0dHJpYnV0ZXMgPSBhZGRMaW5rQXR0cmlidXRlczsKICAgIGV4cG9ydHMuZ2V0RmlsZW5hbWVGcm9tVXJsID0gZ2V0RmlsZW5hbWVGcm9tVXJsOwogICAgZXhwb3J0cy5pc0ZldGNoU3VwcG9ydGVkID0gaXNGZXRjaFN1cHBvcnRlZDsKICAgIGV4cG9ydHMuaXNWYWxpZEZldGNoVXJsID0gaXNWYWxpZEZldGNoVXJsOwogICAgZXhwb3J0cy5sb2FkU2NyaXB0ID0gbG9hZFNjcmlwdDsKICAgIGV4cG9ydHMuZGVwcmVjYXRlZCA9IGRlcHJlY2F0ZWQ7CiAgICBleHBvcnRzLnJlbGVhc2VJbWFnZVJlc291cmNlcyA9IHJlbGVhc2VJbWFnZVJlc291cmNlczsKICAgIGV4cG9ydHMuUERGRGF0ZVN0cmluZyA9IGV4cG9ydHMuU3RhdFRpbWVyID0gZXhwb3J0cy5ET01TVkdGYWN0b3J5ID0gZXhwb3J0cy5ET01DTWFwUmVhZGVyRmFjdG9yeSA9IGV4cG9ydHMuRE9NQ2FudmFzRmFjdG9yeSA9IGV4cG9ydHMuREVGQVVMVF9MSU5LX1JFTCA9IGV4cG9ydHMuTGlua1RhcmdldCA9IGV4cG9ydHMuUmVuZGVyaW5nQ2FuY2VsbGVkRXhjZXB0aW9uID0gZXhwb3J0cy5QYWdlVmlld3BvcnQgPSB2b2lkIDA7CgogICAgdmFyIF9yZWdlbmVyYXRvciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX193X3BkZmpzX3JlcXVpcmVfXygxOTEpKTsKCiAgICB2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEpOwoKICAgIGZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7cmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgImRlZmF1bHQiOiBvYmogfTt9CgogICAgZnVuY3Rpb24gX3R5cGVvZihvYmopIHsiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2YiO2lmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7X3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7cmV0dXJuIHR5cGVvZiBvYmo7fTt9IGVsc2Uge190eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikge3JldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmo7fTt9cmV0dXJuIF90eXBlb2Yob2JqKTt9CgogICAgZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkge2lmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHtyZXR1cm4gY2FsbDt9cmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7fQoKICAgIGZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikge2lmIChzZWxmID09PSB2b2lkIDApIHt0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpO31yZXR1cm4gc2VsZjt9CgogICAgZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHtfZ2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3QuZ2V0UHJvdG90eXBlT2YgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2Yobykge3JldHVybiBvLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2Yobyk7fTtyZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pO30KCiAgICBmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHtpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkge3Rocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7fXN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTtpZiAoc3VwZXJDbGFzcykgX3NldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKTt9CgogICAgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHtfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHtvLl9fcHJvdG9fXyA9IHA7cmV0dXJuIG87fTtyZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApO30KCiAgICBmdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7dHJ5IHt2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7dmFyIHZhbHVlID0gaW5mby52YWx1ZTt9IGNhdGNoIChlcnJvcikge3JlamVjdChlcnJvcik7cmV0dXJuO31pZiAoaW5mby5kb25lKSB7cmVzb2x2ZSh2YWx1ZSk7fSBlbHNlIHtQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oX25leHQsIF90aHJvdyk7fX0KCiAgICBmdW5jdGlvbiBfYXN5bmNUb0dlbmVyYXRvcihmbikge3JldHVybiBmdW5jdGlvbiAoKSB7dmFyIHNlbGYgPSB0aGlzLGFyZ3MgPSBhcmd1bWVudHM7cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHt2YXIgZ2VuID0gZm4uYXBwbHkoc2VsZiwgYXJncyk7ZnVuY3Rpb24gX25leHQodmFsdWUpIHthc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJuZXh0IiwgdmFsdWUpO31mdW5jdGlvbiBfdGhyb3coZXJyKSB7YXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAidGhyb3ciLCBlcnIpO31fbmV4dCh1bmRlZmluZWQpO30pO307fQoKICAgIGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHtpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpO319CgogICAgZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykge2ZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHt2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldO2Rlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTtkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7aWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7T2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpO319CgogICAgZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykge2lmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpO2lmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTtyZXR1cm4gQ29uc3RydWN0b3I7fQoKICAgIHZhciBERUZBVUxUX0xJTktfUkVMID0gIm5vb3BlbmVyIG5vcmVmZXJyZXIgbm9mb2xsb3ciOwogICAgZXhwb3J0cy5ERUZBVUxUX0xJTktfUkVMID0gREVGQVVMVF9MSU5LX1JFTDsKICAgIHZhciBTVkdfTlMgPSAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciOwoKICAgIHZhciBET01DYW52YXNGYWN0b3J5ID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gRE9NQ2FudmFzRmFjdG9yeSgpIHsKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRE9NQ2FudmFzRmFjdG9yeSk7CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhET01DYW52YXNGYWN0b3J5LCBbewogICAgICAgIGtleTogImNyZWF0ZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZSh3aWR0aCwgaGVpZ2h0KSB7CiAgICAgICAgICBpZiAod2lkdGggPD0gMCB8fCBoZWlnaHQgPD0gMCkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgY2FudmFzIHNpemUiKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiY2FudmFzIik7CiAgICAgICAgICB2YXIgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCIyZCIpOwogICAgICAgICAgY2FudmFzLndpZHRoID0gd2lkdGg7CiAgICAgICAgICBjYW52YXMuaGVpZ2h0ID0gaGVpZ2h0OwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgY2FudmFzOiBjYW52YXMsCiAgICAgICAgICAgIGNvbnRleHQ6IGNvbnRleHQKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAicmVzZXQiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiByZXNldChjYW52YXNBbmRDb250ZXh0LCB3aWR0aCwgaGVpZ2h0KSB7CiAgICAgICAgICBpZiAoIWNhbnZhc0FuZENvbnRleHQuY2FudmFzKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ2FudmFzIGlzIG5vdCBzcGVjaWZpZWQiKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAod2lkdGggPD0gMCB8fCBoZWlnaHQgPD0gMCkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgY2FudmFzIHNpemUiKTsKICAgICAgICAgIH0KCiAgICAgICAgICBjYW52YXNBbmRDb250ZXh0LmNhbnZhcy53aWR0aCA9IHdpZHRoOwogICAgICAgICAgY2FudmFzQW5kQ29udGV4dC5jYW52YXMuaGVpZ2h0ID0gaGVpZ2h0OwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImRlc3Ryb3kiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBkZXN0cm95KGNhbnZhc0FuZENvbnRleHQpIHsKICAgICAgICAgIGlmICghY2FudmFzQW5kQ29udGV4dC5jYW52YXMpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJDYW52YXMgaXMgbm90IHNwZWNpZmllZCIpOwogICAgICAgICAgfQoKICAgICAgICAgIGNhbnZhc0FuZENvbnRleHQuY2FudmFzLndpZHRoID0gMDsKICAgICAgICAgIGNhbnZhc0FuZENvbnRleHQuY2FudmFzLmhlaWdodCA9IDA7CiAgICAgICAgICBjYW52YXNBbmRDb250ZXh0LmNhbnZhcyA9IG51bGw7CiAgICAgICAgICBjYW52YXNBbmRDb250ZXh0LmNvbnRleHQgPSBudWxsOwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIERPTUNhbnZhc0ZhY3Rvcnk7CiAgICB9KCk7CgogICAgZXhwb3J0cy5ET01DYW52YXNGYWN0b3J5ID0gRE9NQ2FudmFzRmFjdG9yeTsKCiAgICB2YXIgRE9NQ01hcFJlYWRlckZhY3RvcnkgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBET01DTWFwUmVhZGVyRmFjdG9yeShfcmVmKSB7CiAgICAgICAgdmFyIF9yZWYkYmFzZVVybCA9IF9yZWYuYmFzZVVybCwKICAgICAgICAgIGJhc2VVcmwgPSBfcmVmJGJhc2VVcmwgPT09IHZvaWQgMCA/IG51bGwgOiBfcmVmJGJhc2VVcmwsCiAgICAgICAgICBfcmVmJGlzQ29tcHJlc3NlZCA9IF9yZWYuaXNDb21wcmVzc2VkLAogICAgICAgICAgaXNDb21wcmVzc2VkID0gX3JlZiRpc0NvbXByZXNzZWQgPT09IHZvaWQgMCA/IGZhbHNlIDogX3JlZiRpc0NvbXByZXNzZWQ7CgogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBET01DTWFwUmVhZGVyRmFjdG9yeSk7CgogICAgICAgIHRoaXMuYmFzZVVybCA9IGJhc2VVcmw7CiAgICAgICAgdGhpcy5pc0NvbXByZXNzZWQgPSBpc0NvbXByZXNzZWQ7CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhET01DTWFwUmVhZGVyRmFjdG9yeSwgW3sKICAgICAgICBrZXk6ICJmZXRjaCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIChfZmV0Y2gpIHsKICAgICAgICAgIGZ1bmN0aW9uIGZldGNoKF94KSB7CiAgICAgICAgICAgIHJldHVybiBfZmV0Y2guYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmZXRjaC50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIF9mZXRjaC50b1N0cmluZygpOwogICAgICAgICAgfTsKCiAgICAgICAgICByZXR1cm4gZmV0Y2g7CiAgICAgICAgfSgvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIF9yZWYyID0gX2FzeW5jVG9HZW5lcmF0b3IoLyojX19QVVJFX18qL19yZWdlbmVyYXRvclsiZGVmYXVsdCJdLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoX3JlZjMpIHsKICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgICAgICAgIHZhciBuYW1lLCB1cmwsIGNvbXByZXNzaW9uVHlwZTsKICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclsiZGVmYXVsdCJdLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIG5hbWUgPSBfcmVmMy5uYW1lOwoKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5iYXNlVXJsKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDM7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIENNYXAgImJhc2VVcmwiIHBhcmFtZXRlciBtdXN0IGJlIHNwZWNpZmllZCwgZW5zdXJlIHRoYXQgJyArICd0aGUgImNNYXBVcmwiIGFuZCAiY01hcFBhY2tlZCIgQVBJIHBhcmFtZXRlcnMgYXJlIHByb3ZpZGVkLicpOwoKICAgICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgIGlmIChuYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDU7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ01hcCBuYW1lIG11c3QgYmUgc3BlY2lmaWVkLiIpOwoKICAgICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICAgIHVybCA9IHRoaXMuYmFzZVVybCArIG5hbWUgKyAodGhpcy5pc0NvbXByZXNzZWQgPyAiLmJjbWFwIiA6ICIiKTsKICAgICAgICAgICAgICAgICAgICBjb21wcmVzc2lvblR5cGUgPSB0aGlzLmlzQ29tcHJlc3NlZCA/IF91dGlsLkNNYXBDb21wcmVzc2lvblR5cGUuQklOQVJZIDogX3V0aWwuQ01hcENvbXByZXNzaW9uVHlwZS5OT05FOwoKICAgICAgICAgICAgICAgICAgICBpZiAoIShpc0ZldGNoU3VwcG9ydGVkKCkgJiYgaXNWYWxpZEZldGNoVXJsKHVybCwgZG9jdW1lbnQuYmFzZVVSSSkpKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDk7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCBmZXRjaCh1cmwpLnRoZW4oLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgIHZhciBfcmVmNCA9IF9hc3luY1RvR2VuZXJhdG9yKC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JbImRlZmF1bHQiXS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNNYXBEYXRhOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yWyJkZWZhdWx0Il0ud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uub2spIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IocmVzcG9uc2Uuc3RhdHVzVGV4dCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFfdGhpcy5pc0NvbXByZXNzZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQudDAgPSBVaW50OEFycmF5OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA2OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5hcnJheUJ1ZmZlcigpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0LnQxID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjTWFwRGF0YSA9IG5ldyBfY29udGV4dC50MChfY29udGV4dC50MSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE1OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC50MiA9IF91dGlsLnN0cmluZ1RvQnl0ZXM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDEzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS50ZXh0KCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0LnQzID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjTWFwRGF0YSA9ICgwLCBfY29udGV4dC50MikoX2NvbnRleHQudDMpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjTWFwRGF0YTogY01hcERhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wcmVzc2lvblR5cGU6IGNvbXByZXNzaW9uVHlwZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSwgX2NhbGxlZSk7CiAgICAgICAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChfeDMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9yZWY0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIH0oKSlbImNhdGNoIl0oZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmFibGUgdG8gbG9hZCAiLmNvbmNhdChfdGhpcy5pc0NvbXByZXNzZWQgPyAiYmluYXJ5ICIgOiAiIikgKyAiQ01hcCBhdDogIi5jb25jYXQodXJsKSk7CiAgICAgICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5vcGVuKCJHRVQiLCB1cmwsIHRydWUpOwoKICAgICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5pc0NvbXByZXNzZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5yZXNwb25zZVR5cGUgPSAiYXJyYXlidWZmZXIiOwogICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3Qub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVxdWVzdC5yZWFkeVN0YXRlICE9PSBYTUxIdHRwUmVxdWVzdC5ET05FKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVxdWVzdC5zdGF0dXMgPT09IDIwMCB8fCByZXF1ZXN0LnN0YXR1cyA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjTWFwRGF0YTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF90aGlzLmlzQ29tcHJlc3NlZCAmJiByZXF1ZXN0LnJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjTWFwRGF0YSA9IG5ldyBVaW50OEFycmF5KHJlcXVlc3QucmVzcG9uc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIV90aGlzLmlzQ29tcHJlc3NlZCAmJiByZXF1ZXN0LnJlc3BvbnNlVGV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY01hcERhdGEgPSAoMCwgX3V0aWwuc3RyaW5nVG9CeXRlcykocmVxdWVzdC5yZXNwb25zZVRleHQpOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNNYXBEYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY01hcERhdGE6IGNNYXBEYXRhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wcmVzc2lvblR5cGU6IGNvbXByZXNzaW9uVHlwZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICByZWplY3QobmV3IEVycm9yKHJlcXVlc3Quc3RhdHVzVGV4dCkpOwogICAgICAgICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnNlbmQobnVsbCk7CiAgICAgICAgICAgICAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmFibGUgdG8gbG9hZCAiLmNvbmNhdChfdGhpcy5pc0NvbXByZXNzZWQgPyAiYmluYXJ5ICIgOiAiIikgKyAiQ01hcCBhdDogIi5jb25jYXQodXJsKSk7CiAgICAgICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIF9jYWxsZWUyLCB0aGlzKTsKICAgICAgICAgIH0pKTsKCiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKF94MikgewogICAgICAgICAgICByZXR1cm4gX3JlZjIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgIH07CiAgICAgICAgfSgpKQogICAgICB9XSk7CgogICAgICByZXR1cm4gRE9NQ01hcFJlYWRlckZhY3Rvcnk7CiAgICB9KCk7CgogICAgZXhwb3J0cy5ET01DTWFwUmVhZGVyRmFjdG9yeSA9IERPTUNNYXBSZWFkZXJGYWN0b3J5OwoKICAgIHZhciBET01TVkdGYWN0b3J5ID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gRE9NU1ZHRmFjdG9yeSgpIHsKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRE9NU1ZHRmFjdG9yeSk7CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhET01TVkdGYWN0b3J5LCBbewogICAgICAgIGtleTogImNyZWF0ZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZSh3aWR0aCwgaGVpZ2h0KSB7CiAgICAgICAgICAoMCwgX3V0aWwuYXNzZXJ0KSh3aWR0aCA+IDAgJiYgaGVpZ2h0ID4gMCwgIkludmFsaWQgU1ZHIGRpbWVuc2lvbnMiKTsKICAgICAgICAgIHZhciBzdmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoU1ZHX05TLCAic3ZnOnN2ZyIpOwogICAgICAgICAgc3ZnLnNldEF0dHJpYnV0ZSgidmVyc2lvbiIsICIxLjEiKTsKICAgICAgICAgIHN2Zy5zZXRBdHRyaWJ1dGUoIndpZHRoIiwgd2lkdGggKyAicHgiKTsKICAgICAgICAgIHN2Zy5zZXRBdHRyaWJ1dGUoImhlaWdodCIsIGhlaWdodCArICJweCIpOwogICAgICAgICAgc3ZnLnNldEF0dHJpYnV0ZSgicHJlc2VydmVBc3BlY3RSYXRpbyIsICJub25lIik7CiAgICAgICAgICBzdmcuc2V0QXR0cmlidXRlKCJ2aWV3Qm94IiwgIjAgMCAiICsgd2lkdGggKyAiICIgKyBoZWlnaHQpOwogICAgICAgICAgcmV0dXJuIHN2ZzsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJjcmVhdGVFbGVtZW50IiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlRWxlbWVudCh0eXBlKSB7CiAgICAgICAgICAoMCwgX3V0aWwuYXNzZXJ0KSh0eXBlb2YgdHlwZSA9PT0gInN0cmluZyIsICJJbnZhbGlkIFNWRyBlbGVtZW50IHR5cGUiKTsKICAgICAgICAgIHJldHVybiBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoU1ZHX05TLCB0eXBlKTsKICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBET01TVkdGYWN0b3J5OwogICAgfSgpOwoKICAgIGV4cG9ydHMuRE9NU1ZHRmFjdG9yeSA9IERPTVNWR0ZhY3Rvcnk7CgogICAgdmFyIFBhZ2VWaWV3cG9ydCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgIGZ1bmN0aW9uIFBhZ2VWaWV3cG9ydChfcmVmNSkgewogICAgICAgIHZhciB2aWV3Qm94ID0gX3JlZjUudmlld0JveCwKICAgICAgICAgIHNjYWxlID0gX3JlZjUuc2NhbGUsCiAgICAgICAgICByb3RhdGlvbiA9IF9yZWY1LnJvdGF0aW9uLAogICAgICAgICAgX3JlZjUkb2Zmc2V0WCA9IF9yZWY1Lm9mZnNldFgsCiAgICAgICAgICBvZmZzZXRYID0gX3JlZjUkb2Zmc2V0WCA9PT0gdm9pZCAwID8gMCA6IF9yZWY1JG9mZnNldFgsCiAgICAgICAgICBfcmVmNSRvZmZzZXRZID0gX3JlZjUub2Zmc2V0WSwKICAgICAgICAgIG9mZnNldFkgPSBfcmVmNSRvZmZzZXRZID09PSB2b2lkIDAgPyAwIDogX3JlZjUkb2Zmc2V0WSwKICAgICAgICAgIF9yZWY1JGRvbnRGbGlwID0gX3JlZjUuZG9udEZsaXAsCiAgICAgICAgICBkb250RmxpcCA9IF9yZWY1JGRvbnRGbGlwID09PSB2b2lkIDAgPyBmYWxzZSA6IF9yZWY1JGRvbnRGbGlwOwoKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUGFnZVZpZXdwb3J0KTsKCiAgICAgICAgdGhpcy52aWV3Qm94ID0gdmlld0JveDsKICAgICAgICB0aGlzLnNjYWxlID0gc2NhbGU7CiAgICAgICAgdGhpcy5yb3RhdGlvbiA9IHJvdGF0aW9uOwogICAgICAgIHRoaXMub2Zmc2V0WCA9IG9mZnNldFg7CiAgICAgICAgdGhpcy5vZmZzZXRZID0gb2Zmc2V0WTsKICAgICAgICB2YXIgY2VudGVyWCA9ICh2aWV3Qm94WzJdICsgdmlld0JveFswXSkgLyAyOwogICAgICAgIHZhciBjZW50ZXJZID0gKHZpZXdCb3hbM10gKyB2aWV3Qm94WzFdKSAvIDI7CiAgICAgICAgdmFyIHJvdGF0ZUEsIHJvdGF0ZUIsIHJvdGF0ZUMsIHJvdGF0ZUQ7CiAgICAgICAgcm90YXRpb24gPSByb3RhdGlvbiAlIDM2MDsKICAgICAgICByb3RhdGlvbiA9IHJvdGF0aW9uIDwgMCA/IHJvdGF0aW9uICsgMzYwIDogcm90YXRpb247CgogICAgICAgIHN3aXRjaCAocm90YXRpb24pIHsKICAgICAgICAgIGNhc2UgMTgwOgogICAgICAgICAgICByb3RhdGVBID0gLTE7CiAgICAgICAgICAgIHJvdGF0ZUIgPSAwOwogICAgICAgICAgICByb3RhdGVDID0gMDsKICAgICAgICAgICAgcm90YXRlRCA9IDE7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgOTA6CiAgICAgICAgICAgIHJvdGF0ZUEgPSAwOwogICAgICAgICAgICByb3RhdGVCID0gMTsKICAgICAgICAgICAgcm90YXRlQyA9IDE7CiAgICAgICAgICAgIHJvdGF0ZUQgPSAwOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDI3MDoKICAgICAgICAgICAgcm90YXRlQSA9IDA7CiAgICAgICAgICAgIHJvdGF0ZUIgPSAtMTsKICAgICAgICAgICAgcm90YXRlQyA9IC0xOwogICAgICAgICAgICByb3RhdGVEID0gMDsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgcm90YXRlQSA9IDE7CiAgICAgICAgICAgIHJvdGF0ZUIgPSAwOwogICAgICAgICAgICByb3RhdGVDID0gMDsKICAgICAgICAgICAgcm90YXRlRCA9IC0xOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICAgIGlmIChkb250RmxpcCkgewogICAgICAgICAgcm90YXRlQyA9IC1yb3RhdGVDOwogICAgICAgICAgcm90YXRlRCA9IC1yb3RhdGVEOwogICAgICAgIH0KCiAgICAgICAgdmFyIG9mZnNldENhbnZhc1gsIG9mZnNldENhbnZhc1k7CiAgICAgICAgdmFyIHdpZHRoLCBoZWlnaHQ7CgogICAgICAgIGlmIChyb3RhdGVBID09PSAwKSB7CiAgICAgICAgICBvZmZzZXRDYW52YXNYID0gTWF0aC5hYnMoY2VudGVyWSAtIHZpZXdCb3hbMV0pICogc2NhbGUgKyBvZmZzZXRYOwogICAgICAgICAgb2Zmc2V0Q2FudmFzWSA9IE1hdGguYWJzKGNlbnRlclggLSB2aWV3Qm94WzBdKSAqIHNjYWxlICsgb2Zmc2V0WTsKICAgICAgICAgIHdpZHRoID0gTWF0aC5hYnModmlld0JveFszXSAtIHZpZXdCb3hbMV0pICogc2NhbGU7CiAgICAgICAgICBoZWlnaHQgPSBNYXRoLmFicyh2aWV3Qm94WzJdIC0gdmlld0JveFswXSkgKiBzY2FsZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgb2Zmc2V0Q2FudmFzWCA9IE1hdGguYWJzKGNlbnRlclggLSB2aWV3Qm94WzBdKSAqIHNjYWxlICsgb2Zmc2V0WDsKICAgICAgICAgIG9mZnNldENhbnZhc1kgPSBNYXRoLmFicyhjZW50ZXJZIC0gdmlld0JveFsxXSkgKiBzY2FsZSArIG9mZnNldFk7CiAgICAgICAgICB3aWR0aCA9IE1hdGguYWJzKHZpZXdCb3hbMl0gLSB2aWV3Qm94WzBdKSAqIHNjYWxlOwogICAgICAgICAgaGVpZ2h0ID0gTWF0aC5hYnModmlld0JveFszXSAtIHZpZXdCb3hbMV0pICogc2NhbGU7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnRyYW5zZm9ybSA9IFtyb3RhdGVBICogc2NhbGUsIHJvdGF0ZUIgKiBzY2FsZSwgcm90YXRlQyAqIHNjYWxlLCByb3RhdGVEICogc2NhbGUsIG9mZnNldENhbnZhc1ggLSByb3RhdGVBICogc2NhbGUgKiBjZW50ZXJYIC0gcm90YXRlQyAqIHNjYWxlICogY2VudGVyWSwgb2Zmc2V0Q2FudmFzWSAtIHJvdGF0ZUIgKiBzY2FsZSAqIGNlbnRlclggLSByb3RhdGVEICogc2NhbGUgKiBjZW50ZXJZXTsKICAgICAgICB0aGlzLndpZHRoID0gd2lkdGg7CiAgICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhQYWdlVmlld3BvcnQsIFt7CiAgICAgICAga2V5OiAiY2xvbmUiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjbG9uZSgpIHsKICAgICAgICAgIHZhciBfcmVmNiA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge30sCiAgICAgICAgICAgIF9yZWY2JHNjYWxlID0gX3JlZjYuc2NhbGUsCiAgICAgICAgICAgIHNjYWxlID0gX3JlZjYkc2NhbGUgPT09IHZvaWQgMCA/IHRoaXMuc2NhbGUgOiBfcmVmNiRzY2FsZSwKICAgICAgICAgICAgX3JlZjYkcm90YXRpb24gPSBfcmVmNi5yb3RhdGlvbiwKICAgICAgICAgICAgcm90YXRpb24gPSBfcmVmNiRyb3RhdGlvbiA9PT0gdm9pZCAwID8gdGhpcy5yb3RhdGlvbiA6IF9yZWY2JHJvdGF0aW9uLAogICAgICAgICAgICBfcmVmNiRvZmZzZXRYID0gX3JlZjYub2Zmc2V0WCwKICAgICAgICAgICAgb2Zmc2V0WCA9IF9yZWY2JG9mZnNldFggPT09IHZvaWQgMCA/IHRoaXMub2Zmc2V0WCA6IF9yZWY2JG9mZnNldFgsCiAgICAgICAgICAgIF9yZWY2JG9mZnNldFkgPSBfcmVmNi5vZmZzZXRZLAogICAgICAgICAgICBvZmZzZXRZID0gX3JlZjYkb2Zmc2V0WSA9PT0gdm9pZCAwID8gdGhpcy5vZmZzZXRZIDogX3JlZjYkb2Zmc2V0WSwKICAgICAgICAgICAgX3JlZjYkZG9udEZsaXAgPSBfcmVmNi5kb250RmxpcCwKICAgICAgICAgICAgZG9udEZsaXAgPSBfcmVmNiRkb250RmxpcCA9PT0gdm9pZCAwID8gZmFsc2UgOiBfcmVmNiRkb250RmxpcDsKCiAgICAgICAgICByZXR1cm4gbmV3IFBhZ2VWaWV3cG9ydCh7CiAgICAgICAgICAgIHZpZXdCb3g6IHRoaXMudmlld0JveC5zbGljZSgpLAogICAgICAgICAgICBzY2FsZTogc2NhbGUsCiAgICAgICAgICAgIHJvdGF0aW9uOiByb3RhdGlvbiwKICAgICAgICAgICAgb2Zmc2V0WDogb2Zmc2V0WCwKICAgICAgICAgICAgb2Zmc2V0WTogb2Zmc2V0WSwKICAgICAgICAgICAgZG9udEZsaXA6IGRvbnRGbGlwCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJjb252ZXJ0VG9WaWV3cG9ydFBvaW50IiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY29udmVydFRvVmlld3BvcnRQb2ludCh4LCB5KSB7CiAgICAgICAgICByZXR1cm4gX3V0aWwuVXRpbC5hcHBseVRyYW5zZm9ybShbeCwgeV0sIHRoaXMudHJhbnNmb3JtKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJjb252ZXJ0VG9WaWV3cG9ydFJlY3RhbmdsZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNvbnZlcnRUb1ZpZXdwb3J0UmVjdGFuZ2xlKHJlY3QpIHsKICAgICAgICAgIHZhciB0b3BMZWZ0ID0gX3V0aWwuVXRpbC5hcHBseVRyYW5zZm9ybShbcmVjdFswXSwgcmVjdFsxXV0sIHRoaXMudHJhbnNmb3JtKTsKCiAgICAgICAgICB2YXIgYm90dG9tUmlnaHQgPSBfdXRpbC5VdGlsLmFwcGx5VHJhbnNmb3JtKFtyZWN0WzJdLCByZWN0WzNdXSwgdGhpcy50cmFuc2Zvcm0pOwoKICAgICAgICAgIHJldHVybiBbdG9wTGVmdFswXSwgdG9wTGVmdFsxXSwgYm90dG9tUmlnaHRbMF0sIGJvdHRvbVJpZ2h0WzFdXTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJjb252ZXJ0VG9QZGZQb2ludCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNvbnZlcnRUb1BkZlBvaW50KHgsIHkpIHsKICAgICAgICAgIHJldHVybiBfdXRpbC5VdGlsLmFwcGx5SW52ZXJzZVRyYW5zZm9ybShbeCwgeV0sIHRoaXMudHJhbnNmb3JtKTsKICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBQYWdlVmlld3BvcnQ7CiAgICB9KCk7CgogICAgZXhwb3J0cy5QYWdlVmlld3BvcnQgPSBQYWdlVmlld3BvcnQ7CgogICAgdmFyIFJlbmRlcmluZ0NhbmNlbGxlZEV4Y2VwdGlvbiA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0Jhc2VFeGNlcHRpb24pIHsKICAgICAgX2luaGVyaXRzKFJlbmRlcmluZ0NhbmNlbGxlZEV4Y2VwdGlvbiwgX0Jhc2VFeGNlcHRpb24pOwoKICAgICAgZnVuY3Rpb24gUmVuZGVyaW5nQ2FuY2VsbGVkRXhjZXB0aW9uKG1zZywgdHlwZSkgewogICAgICAgIHZhciBfdGhpczI7CgogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBSZW5kZXJpbmdDYW5jZWxsZWRFeGNlcHRpb24pOwoKICAgICAgICBfdGhpczIgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoUmVuZGVyaW5nQ2FuY2VsbGVkRXhjZXB0aW9uKS5jYWxsKHRoaXMsIG1zZykpOwogICAgICAgIF90aGlzMi50eXBlID0gdHlwZTsKICAgICAgICByZXR1cm4gX3RoaXMyOwogICAgICB9CgogICAgICByZXR1cm4gUmVuZGVyaW5nQ2FuY2VsbGVkRXhjZXB0aW9uOwogICAgfShfdXRpbC5CYXNlRXhjZXB0aW9uKTsKCiAgICBleHBvcnRzLlJlbmRlcmluZ0NhbmNlbGxlZEV4Y2VwdGlvbiA9IFJlbmRlcmluZ0NhbmNlbGxlZEV4Y2VwdGlvbjsKICAgIHZhciBMaW5rVGFyZ2V0ID0gewogICAgICBOT05FOiAwLAogICAgICBTRUxGOiAxLAogICAgICBCTEFOSzogMiwKICAgICAgUEFSRU5UOiAzLAogICAgICBUT1A6IDQKICAgIH07CiAgICBleHBvcnRzLkxpbmtUYXJnZXQgPSBMaW5rVGFyZ2V0OwoKICAgIGZ1bmN0aW9uIGFkZExpbmtBdHRyaWJ1dGVzKGxpbmspIHsKICAgICAgdmFyIF9yZWY3ID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fSwKICAgICAgICB1cmwgPSBfcmVmNy51cmwsCiAgICAgICAgdGFyZ2V0ID0gX3JlZjcudGFyZ2V0LAogICAgICAgIHJlbCA9IF9yZWY3LnJlbCwKICAgICAgICBfcmVmNyRlbmFibGVkID0gX3JlZjcuZW5hYmxlZCwKICAgICAgICBlbmFibGVkID0gX3JlZjckZW5hYmxlZCA9PT0gdm9pZCAwID8gdHJ1ZSA6IF9yZWY3JGVuYWJsZWQ7CgogICAgICAoMCwgX3V0aWwuYXNzZXJ0KSh1cmwgJiYgdHlwZW9mIHVybCA9PT0gInN0cmluZyIsICdhZGRMaW5rQXR0cmlidXRlczogQSB2YWxpZCAidXJsIiBwYXJhbWV0ZXIgbXVzdCBwcm92aWRlZC4nKTsKICAgICAgdmFyIHVybE51bGxSZW1vdmVkID0gKDAsIF91dGlsLnJlbW92ZU51bGxDaGFyYWN0ZXJzKSh1cmwpOwoKICAgICAgaWYgKGVuYWJsZWQpIHsKICAgICAgICBsaW5rLmhyZWYgPSBsaW5rLnRpdGxlID0gdXJsTnVsbFJlbW92ZWQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbGluay5ocmVmID0gIiI7CiAgICAgICAgbGluay50aXRsZSA9ICJEaXNhYmxlZDogIi5jb25jYXQodXJsTnVsbFJlbW92ZWQpOwoKICAgICAgICBsaW5rLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfTsKICAgICAgfQoKICAgICAgdmFyIHRhcmdldFN0ciA9ICIiOwoKICAgICAgc3dpdGNoICh0YXJnZXQpIHsKICAgICAgICBjYXNlIExpbmtUYXJnZXQuTk9ORToKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIExpbmtUYXJnZXQuU0VMRjoKICAgICAgICAgIHRhcmdldFN0ciA9ICJfc2VsZiI7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBMaW5rVGFyZ2V0LkJMQU5LOgogICAgICAgICAgdGFyZ2V0U3RyID0gIl9ibGFuayI7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBMaW5rVGFyZ2V0LlBBUkVOVDoKICAgICAgICAgIHRhcmdldFN0ciA9ICJfcGFyZW50IjsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIExpbmtUYXJnZXQuVE9QOgogICAgICAgICAgdGFyZ2V0U3RyID0gIl90b3AiOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KCiAgICAgIGxpbmsudGFyZ2V0ID0gdGFyZ2V0U3RyOwogICAgICBsaW5rLnJlbCA9IHR5cGVvZiByZWwgPT09ICJzdHJpbmciID8gcmVsIDogREVGQVVMVF9MSU5LX1JFTDsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRGaWxlbmFtZUZyb21VcmwodXJsKSB7CiAgICAgIHZhciBhbmNob3IgPSB1cmwuaW5kZXhPZigiIyIpOwogICAgICB2YXIgcXVlcnkgPSB1cmwuaW5kZXhPZigiPyIpOwogICAgICB2YXIgZW5kID0gTWF0aC5taW4oYW5jaG9yID4gMCA/IGFuY2hvciA6IHVybC5sZW5ndGgsIHF1ZXJ5ID4gMCA/IHF1ZXJ5IDogdXJsLmxlbmd0aCk7CiAgICAgIHJldHVybiB1cmwuc3Vic3RyaW5nKHVybC5sYXN0SW5kZXhPZigiLyIsIGVuZCkgKyAxLCBlbmQpOwogICAgfQoKICAgIHZhciBTdGF0VGltZXIgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBTdGF0VGltZXIoKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFN0YXRUaW1lcik7CgogICAgICAgIHRoaXMuc3RhcnRlZCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgdGhpcy50aW1lcyA9IFtdOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoU3RhdFRpbWVyLCBbewogICAgICAgIGtleTogInRpbWUiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiB0aW1lKG5hbWUpIHsKICAgICAgICAgIGlmIChuYW1lIGluIHRoaXMuc3RhcnRlZCkgewogICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIlRpbWVyIGlzIGFscmVhZHkgcnVubmluZyBmb3IgIi5jb25jYXQobmFtZSkpOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuc3RhcnRlZFtuYW1lXSA9IERhdGUubm93KCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAidGltZUVuZCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHRpbWVFbmQobmFtZSkgewogICAgICAgICAgaWYgKCEobmFtZSBpbiB0aGlzLnN0YXJ0ZWQpKSB7CiAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiVGltZXIgaGFzIG5vdCBiZWVuIHN0YXJ0ZWQgZm9yICIuY29uY2F0KG5hbWUpKTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnRpbWVzLnB1c2goewogICAgICAgICAgICBuYW1lOiBuYW1lLAogICAgICAgICAgICBzdGFydDogdGhpcy5zdGFydGVkW25hbWVdLAogICAgICAgICAgICBlbmQ6IERhdGUubm93KCkKICAgICAgICAgIH0pOwogICAgICAgICAgZGVsZXRlIHRoaXMuc3RhcnRlZFtuYW1lXTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJ0b1N0cmluZyIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHRvU3RyaW5nKCkgewogICAgICAgICAgdmFyIG91dEJ1ZiA9IFtdOwogICAgICAgICAgdmFyIGxvbmdlc3QgPSAwOwogICAgICAgICAgdmFyIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSB0cnVlOwogICAgICAgICAgdmFyIF9kaWRJdGVyYXRvckVycm9yID0gZmFsc2U7CiAgICAgICAgICB2YXIgX2l0ZXJhdG9yRXJyb3IgPSB1bmRlZmluZWQ7CgogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZm9yICh2YXIgX2l0ZXJhdG9yID0gdGhpcy50aW1lc1tTeW1ib2wuaXRlcmF0b3JdKCksIF9zdGVwOyAhKF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSAoX3N0ZXAgPSBfaXRlcmF0b3IubmV4dCgpKS5kb25lKTsgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IHRydWUpIHsKICAgICAgICAgICAgICB2YXIgdGltZSA9IF9zdGVwLnZhbHVlOwogICAgICAgICAgICAgIHZhciBuYW1lID0gdGltZS5uYW1lOwoKICAgICAgICAgICAgICBpZiAobmFtZS5sZW5ndGggPiBsb25nZXN0KSB7CiAgICAgICAgICAgICAgICBsb25nZXN0ID0gbmFtZS5sZW5ndGg7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgX2RpZEl0ZXJhdG9yRXJyb3IgPSB0cnVlOwogICAgICAgICAgICBfaXRlcmF0b3JFcnJvciA9IGVycjsKICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgaWYgKCFfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uICYmIF9pdGVyYXRvclsicmV0dXJuIl0gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgX2l0ZXJhdG9yWyJyZXR1cm4iXSgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICBpZiAoX2RpZEl0ZXJhdG9yRXJyb3IpIHsKICAgICAgICAgICAgICAgIHRocm93IF9pdGVyYXRvckVycm9yOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHZhciBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiA9IHRydWU7CiAgICAgICAgICB2YXIgX2RpZEl0ZXJhdG9yRXJyb3IyID0gZmFsc2U7CiAgICAgICAgICB2YXIgX2l0ZXJhdG9yRXJyb3IyID0gdW5kZWZpbmVkOwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZvciAodmFyIF9pdGVyYXRvcjIgPSB0aGlzLnRpbWVzW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3N0ZXAyOyAhKF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yID0gKF9zdGVwMiA9IF9pdGVyYXRvcjIubmV4dCgpKS5kb25lKTsgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIgPSB0cnVlKSB7CiAgICAgICAgICAgICAgdmFyIF90aW1lID0gX3N0ZXAyLnZhbHVlOwogICAgICAgICAgICAgIHZhciBkdXJhdGlvbiA9IF90aW1lLmVuZCAtIF90aW1lLnN0YXJ0OwogICAgICAgICAgICAgIG91dEJ1Zi5wdXNoKCIiLmNvbmNhdChfdGltZS5uYW1lLnBhZEVuZChsb25nZXN0KSwgIiAiKS5jb25jYXQoZHVyYXRpb24sICJtc1xuIikpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgX2RpZEl0ZXJhdG9yRXJyb3IyID0gdHJ1ZTsKICAgICAgICAgICAgX2l0ZXJhdG9yRXJyb3IyID0gZXJyOwogICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yICYmIF9pdGVyYXRvcjJbInJldHVybiJdICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIF9pdGVyYXRvcjJbInJldHVybiJdKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgIGlmIChfZGlkSXRlcmF0b3JFcnJvcjIpIHsKICAgICAgICAgICAgICAgIHRocm93IF9pdGVyYXRvckVycm9yMjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gb3V0QnVmLmpvaW4oIiIpOwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIFN0YXRUaW1lcjsKICAgIH0oKTsKCiAgICBleHBvcnRzLlN0YXRUaW1lciA9IFN0YXRUaW1lcjsKCiAgICBmdW5jdGlvbiBpc0ZldGNoU3VwcG9ydGVkKCkgewogICAgICByZXR1cm4gdHlwZW9mIGZldGNoICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2YgUmVzcG9uc2UgIT09ICJ1bmRlZmluZWQiICYmICJib2R5IiBpbiBSZXNwb25zZS5wcm90b3R5cGUgJiYgdHlwZW9mIFJlYWRhYmxlU3RyZWFtICE9PSAidW5kZWZpbmVkIjsKICAgIH0KCiAgICBmdW5jdGlvbiBpc1ZhbGlkRmV0Y2hVcmwodXJsLCBiYXNlVXJsKSB7CiAgICAgIHRyeSB7CiAgICAgICAgdmFyIF9yZWY4ID0gYmFzZVVybCA/IG5ldyBVUkwodXJsLCBiYXNlVXJsKSA6IG5ldyBVUkwodXJsKSwKICAgICAgICAgIHByb3RvY29sID0gX3JlZjgucHJvdG9jb2w7CgogICAgICAgIHJldHVybiBwcm90b2NvbCA9PT0gImh0dHA6IiB8fCBwcm90b2NvbCA9PT0gImh0dHBzOiI7CiAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gbG9hZFNjcmlwdChzcmMpIHsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICB2YXIgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7CiAgICAgICAgc2NyaXB0LnNyYyA9IHNyYzsKICAgICAgICBzY3JpcHQub25sb2FkID0gcmVzb2x2ZTsKCiAgICAgICAgc2NyaXB0Lm9uZXJyb3IgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZWplY3QobmV3IEVycm9yKCJDYW5ub3QgbG9hZCBzY3JpcHQgYXQ6ICIuY29uY2F0KHNjcmlwdC5zcmMpKSk7CiAgICAgICAgfTsKCiAgICAgICAgKGRvY3VtZW50LmhlYWQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KS5hcHBlbmRDaGlsZChzY3JpcHQpOwogICAgICB9KTsKICAgIH0KCiAgICBmdW5jdGlvbiBkZXByZWNhdGVkKGRldGFpbHMpIHsKICAgICAgY29uc29sZS5sb2coIkRlcHJlY2F0ZWQgQVBJIHVzYWdlOiAiICsgZGV0YWlscyk7CiAgICB9CgogICAgZnVuY3Rpb24gcmVsZWFzZUltYWdlUmVzb3VyY2VzKGltZykgewogICAgICAoMCwgX3V0aWwuYXNzZXJ0KShpbWcgaW5zdGFuY2VvZiBJbWFnZSwgIkludmFsaWQgYGltZ2AgcGFyYW1ldGVyLiIpOwogICAgICB2YXIgdXJsID0gaW1nLnNyYzsKCiAgICAgIGlmICh0eXBlb2YgdXJsID09PSAic3RyaW5nIiAmJiB1cmwuc3RhcnRzV2l0aCgiYmxvYjoiKSAmJiBVUkwucmV2b2tlT2JqZWN0VVJMKSB7CiAgICAgICAgVVJMLnJldm9rZU9iamVjdFVSTCh1cmwpOwogICAgICB9CgogICAgICBpbWcucmVtb3ZlQXR0cmlidXRlKCJzcmMiKTsKICAgIH0KCiAgICB2YXIgcGRmRGF0ZVN0cmluZ1JlZ2V4OwoKICAgIHZhciBQREZEYXRlU3RyaW5nID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gUERGRGF0ZVN0cmluZygpIHsKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUERGRGF0ZVN0cmluZyk7CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhQREZEYXRlU3RyaW5nLCBudWxsLCBbewogICAgICAgIGtleTogInRvRGF0ZU9iamVjdCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHRvRGF0ZU9iamVjdChpbnB1dCkgewogICAgICAgICAgaWYgKCFpbnB1dCB8fCAhKDAsIF91dGlsLmlzU3RyaW5nKShpbnB1dCkpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCFwZGZEYXRlU3RyaW5nUmVnZXgpIHsKICAgICAgICAgICAgcGRmRGF0ZVN0cmluZ1JlZ2V4ID0gbmV3IFJlZ0V4cCgiXkQ6IiArICIoXFxkezR9KSIgKyAiKFxcZHsyfSk/IiArICIoXFxkezJ9KT8iICsgIihcXGR7Mn0pPyIgKyAiKFxcZHsyfSk/IiArICIoXFxkezJ9KT8iICsgIihbWnwrfC1dKT8iICsgIihcXGR7Mn0pPyIgKyAiJz8iICsgIihcXGR7Mn0pPyIgKyAiJz8iKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgbWF0Y2hlcyA9IHBkZkRhdGVTdHJpbmdSZWdleC5leGVjKGlucHV0KTsKCiAgICAgICAgICBpZiAoIW1hdGNoZXMpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHllYXIgPSBwYXJzZUludChtYXRjaGVzWzFdLCAxMCk7CiAgICAgICAgICB2YXIgbW9udGggPSBwYXJzZUludChtYXRjaGVzWzJdLCAxMCk7CiAgICAgICAgICBtb250aCA9IG1vbnRoID49IDEgJiYgbW9udGggPD0gMTIgPyBtb250aCAtIDEgOiAwOwogICAgICAgICAgdmFyIGRheSA9IHBhcnNlSW50KG1hdGNoZXNbM10sIDEwKTsKICAgICAgICAgIGRheSA9IGRheSA+PSAxICYmIGRheSA8PSAzMSA/IGRheSA6IDE7CiAgICAgICAgICB2YXIgaG91ciA9IHBhcnNlSW50KG1hdGNoZXNbNF0sIDEwKTsKICAgICAgICAgIGhvdXIgPSBob3VyID49IDAgJiYgaG91ciA8PSAyMyA/IGhvdXIgOiAwOwogICAgICAgICAgdmFyIG1pbnV0ZSA9IHBhcnNlSW50KG1hdGNoZXNbNV0sIDEwKTsKICAgICAgICAgIG1pbnV0ZSA9IG1pbnV0ZSA+PSAwICYmIG1pbnV0ZSA8PSA1OSA/IG1pbnV0ZSA6IDA7CiAgICAgICAgICB2YXIgc2Vjb25kID0gcGFyc2VJbnQobWF0Y2hlc1s2XSwgMTApOwogICAgICAgICAgc2Vjb25kID0gc2Vjb25kID49IDAgJiYgc2Vjb25kIDw9IDU5ID8gc2Vjb25kIDogMDsKICAgICAgICAgIHZhciB1bml2ZXJzYWxUaW1lUmVsYXRpb24gPSBtYXRjaGVzWzddIHx8ICJaIjsKICAgICAgICAgIHZhciBvZmZzZXRIb3VyID0gcGFyc2VJbnQobWF0Y2hlc1s4XSwgMTApOwogICAgICAgICAgb2Zmc2V0SG91ciA9IG9mZnNldEhvdXIgPj0gMCAmJiBvZmZzZXRIb3VyIDw9IDIzID8gb2Zmc2V0SG91ciA6IDA7CiAgICAgICAgICB2YXIgb2Zmc2V0TWludXRlID0gcGFyc2VJbnQobWF0Y2hlc1s5XSwgMTApIHx8IDA7CiAgICAgICAgICBvZmZzZXRNaW51dGUgPSBvZmZzZXRNaW51dGUgPj0gMCAmJiBvZmZzZXRNaW51dGUgPD0gNTkgPyBvZmZzZXRNaW51dGUgOiAwOwoKICAgICAgICAgIGlmICh1bml2ZXJzYWxUaW1lUmVsYXRpb24gPT09ICItIikgewogICAgICAgICAgICBob3VyICs9IG9mZnNldEhvdXI7CiAgICAgICAgICAgIG1pbnV0ZSArPSBvZmZzZXRNaW51dGU7CiAgICAgICAgICB9IGVsc2UgaWYgKHVuaXZlcnNhbFRpbWVSZWxhdGlvbiA9PT0gIisiKSB7CiAgICAgICAgICAgIGhvdXIgLT0gb2Zmc2V0SG91cjsKICAgICAgICAgICAgbWludXRlIC09IG9mZnNldE1pbnV0ZTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gbmV3IERhdGUoRGF0ZS5VVEMoeWVhciwgbW9udGgsIGRheSwgaG91ciwgbWludXRlLCBzZWNvbmQpKTsKICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBQREZEYXRlU3RyaW5nOwogICAgfSgpOwoKICAgIGV4cG9ydHMuUERGRGF0ZVN0cmluZyA9IFBERkRhdGVTdHJpbmc7CgogICAgLyoqKi99KSwgKAogIC8qIDE5NSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCgogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICB2YWx1ZTogdHJ1ZQogICAgfSk7CiAgICBleHBvcnRzLkZvbnRMb2FkZXIgPSBleHBvcnRzLkZvbnRGYWNlT2JqZWN0ID0gdm9pZCAwOwoKICAgIHZhciBfcmVnZW5lcmF0b3IgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9fd19wZGZqc19yZXF1aXJlX18oMTkxKSk7CgogICAgdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygxKTsKCiAgICBmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikge3JldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICJkZWZhdWx0Ijogb2JqIH07fQoKICAgIGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mIjtpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAic3ltYm9sIikge190eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikge3JldHVybiB0eXBlb2Ygb2JqO307fSBlbHNlIHtfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHtyZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqO307fXJldHVybiBfdHlwZW9mKG9iaik7fQoKICAgIGZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHtpZiAoY2FsbCAmJiAoX3R5cGVvZihjYWxsKSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7cmV0dXJuIGNhbGw7fXJldHVybiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpO30KCiAgICBmdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHtpZiAoc2VsZiA9PT0gdm9pZCAwKSB7dGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTt9cmV0dXJuIHNlbGY7fQoKICAgIGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7X2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHtyZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pO307cmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTt9CgogICAgZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7aWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpO31zdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7aWYgKHN1cGVyQ2xhc3MpIF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7fQoKICAgIGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7X3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7by5fX3Byb3RvX18gPSBwO3JldHVybiBvO307cmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTt9CgogICAgZnVuY3Rpb24gYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBrZXksIGFyZykge3RyeSB7dmFyIGluZm8gPSBnZW5ba2V5XShhcmcpO3ZhciB2YWx1ZSA9IGluZm8udmFsdWU7fSBjYXRjaCAoZXJyb3IpIHtyZWplY3QoZXJyb3IpO3JldHVybjt9aWYgKGluZm8uZG9uZSkge3Jlc29sdmUodmFsdWUpO30gZWxzZSB7UHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKF9uZXh0LCBfdGhyb3cpO319CgogICAgZnVuY3Rpb24gX2FzeW5jVG9HZW5lcmF0b3IoZm4pIHtyZXR1cm4gZnVuY3Rpb24gKCkge3ZhciBzZWxmID0gdGhpcyxhcmdzID0gYXJndW1lbnRzO3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7dmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpO2Z1bmN0aW9uIF9uZXh0KHZhbHVlKSB7YXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAibmV4dCIsIHZhbHVlKTt9ZnVuY3Rpb24gX3Rocm93KGVycikge2FzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyKTt9X25leHQodW5kZWZpbmVkKTt9KTt9O30KCiAgICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7aWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTt9fQoKICAgIGZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHtmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7dmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTtkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7ZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlO2lmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlO09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTt9fQoKICAgIGZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHtpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTtpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7cmV0dXJuIENvbnN0cnVjdG9yO30KCiAgICB2YXIgQmFzZUZvbnRMb2FkZXIgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBCYXNlRm9udExvYWRlcihfcmVmKSB7CiAgICAgICAgdmFyIGRvY0lkID0gX3JlZi5kb2NJZCwKICAgICAgICAgIG9uVW5zdXBwb3J0ZWRGZWF0dXJlID0gX3JlZi5vblVuc3VwcG9ydGVkRmVhdHVyZTsKCiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEJhc2VGb250TG9hZGVyKTsKCiAgICAgICAgaWYgKHRoaXMuY29uc3RydWN0b3IgPT09IEJhc2VGb250TG9hZGVyKSB7CiAgICAgICAgICAoMCwgX3V0aWwudW5yZWFjaGFibGUpKCJDYW5ub3QgaW5pdGlhbGl6ZSBCYXNlRm9udExvYWRlci4iKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuZG9jSWQgPSBkb2NJZDsKICAgICAgICB0aGlzLl9vblVuc3VwcG9ydGVkRmVhdHVyZSA9IG9uVW5zdXBwb3J0ZWRGZWF0dXJlOwogICAgICAgIHRoaXMubmF0aXZlRm9udEZhY2VzID0gW107CiAgICAgICAgdGhpcy5zdHlsZUVsZW1lbnQgPSBudWxsOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoQmFzZUZvbnRMb2FkZXIsIFt7CiAgICAgICAga2V5OiAiYWRkTmF0aXZlRm9udEZhY2UiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBhZGROYXRpdmVGb250RmFjZShuYXRpdmVGb250RmFjZSkgewogICAgICAgICAgdGhpcy5uYXRpdmVGb250RmFjZXMucHVzaChuYXRpdmVGb250RmFjZSk7CiAgICAgICAgICBkb2N1bWVudC5mb250cy5hZGQobmF0aXZlRm9udEZhY2UpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImluc2VydFJ1bGUiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBpbnNlcnRSdWxlKHJ1bGUpIHsKICAgICAgICAgIHZhciBzdHlsZUVsZW1lbnQgPSB0aGlzLnN0eWxlRWxlbWVudDsKCiAgICAgICAgICBpZiAoIXN0eWxlRWxlbWVudCkgewogICAgICAgICAgICBzdHlsZUVsZW1lbnQgPSB0aGlzLnN0eWxlRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInN0eWxlIik7CiAgICAgICAgICAgIHN0eWxlRWxlbWVudC5pZCA9ICJQREZKU19GT05UX1NUWUxFX1RBR18iLmNvbmNhdCh0aGlzLmRvY0lkKTsKICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJoZWFkIilbMF0uYXBwZW5kQ2hpbGQoc3R5bGVFbGVtZW50KTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgc3R5bGVTaGVldCA9IHN0eWxlRWxlbWVudC5zaGVldDsKICAgICAgICAgIHN0eWxlU2hlZXQuaW5zZXJ0UnVsZShydWxlLCBzdHlsZVNoZWV0LmNzc1J1bGVzLmxlbmd0aCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiY2xlYXIiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjbGVhcigpIHsKICAgICAgICAgIHRoaXMubmF0aXZlRm9udEZhY2VzLmZvckVhY2goZnVuY3Rpb24gKG5hdGl2ZUZvbnRGYWNlKSB7CiAgICAgICAgICAgIGRvY3VtZW50LmZvbnRzWyJkZWxldGUiXShuYXRpdmVGb250RmFjZSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMubmF0aXZlRm9udEZhY2VzLmxlbmd0aCA9IDA7CgogICAgICAgICAgaWYgKHRoaXMuc3R5bGVFbGVtZW50KSB7CiAgICAgICAgICAgIHRoaXMuc3R5bGVFbGVtZW50LnJlbW92ZSgpOwogICAgICAgICAgICB0aGlzLnN0eWxlRWxlbWVudCA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiYmluZCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBfYmluZCA9IF9hc3luY1RvR2VuZXJhdG9yKC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JbImRlZmF1bHQiXS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoZm9udCkgewogICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgICAgICAgdmFyIG5hdGl2ZUZvbnRGYWNlLCBydWxlOwogICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yWyJkZWZhdWx0Il0ud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICBpZiAoIShmb250LmF0dGFjaGVkIHx8IGZvbnQubWlzc2luZ0ZpbGUpKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgZm9udC5hdHRhY2hlZCA9IHRydWU7CgogICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc0ZvbnRMb2FkaW5nQVBJU3VwcG9ydGVkKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTk7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIG5hdGl2ZUZvbnRGYWNlID0gZm9udC5jcmVhdGVOYXRpdmVGb250RmFjZSgpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoIW5hdGl2ZUZvbnRGYWNlKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTg7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkTmF0aXZlRm9udEZhY2UobmF0aXZlRm9udEZhY2UpOwogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSA3OwogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMDsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmF0aXZlRm9udEZhY2UubG9hZGVkOwoKICAgICAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTg7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAxMjsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dC50MCA9IF9jb250ZXh0WyJjYXRjaCJdKDcpOwoKICAgICAgICAgICAgICAgICAgICB0aGlzLl9vblVuc3VwcG9ydGVkRmVhdHVyZSh7CiAgICAgICAgICAgICAgICAgICAgICBmZWF0dXJlSWQ6IF91dGlsLlVOU1VQUE9SVEVEX0ZFQVRVUkVTLmZvbnQKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJGYWlsZWQgdG8gbG9hZCBmb250ICciLmNvbmNhdChuYXRpdmVGb250RmFjZS5mYW1pbHksICInOiAnIikuY29uY2F0KF9jb250ZXh0LnQwLCAiJy4iKSk7CiAgICAgICAgICAgICAgICAgICAgZm9udC5kaXNhYmxlRm9udEZhY2UgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIHRocm93IF9jb250ZXh0LnQwOwoKICAgICAgICAgICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgMTk6CiAgICAgICAgICAgICAgICAgICAgcnVsZSA9IGZvbnQuY3JlYXRlRm9udEZhY2VSdWxlKCk7CgogICAgICAgICAgICAgICAgICAgIGlmICghcnVsZSkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI2OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICB0aGlzLmluc2VydFJ1bGUocnVsZSk7CgogICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc1N5bmNGb250TG9hZGluZ1N1cHBvcnRlZCkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI0OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgMjQ6CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI2OwogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBfdGhpcy5fcXVldWVMb2FkaW5nQ2FsbGJhY2socmVzb2x2ZSk7CgogICAgICAgICAgICAgICAgICAgICAgX3RoaXMuX3ByZXBhcmVGb250TG9hZEV2ZW50KFtydWxlXSwgW2ZvbnRdLCByZXF1ZXN0KTsKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgMjY6CiAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIF9jYWxsZWUsIHRoaXMsIFtbNywgMTJdXSk7CiAgICAgICAgICB9KSk7CgogICAgICAgICAgZnVuY3Rpb24gYmluZChfeCkgewogICAgICAgICAgICByZXR1cm4gX2JpbmQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gYmluZDsKICAgICAgICB9KCkKICAgICAgfSwgewogICAgICAgIGtleTogIl9xdWV1ZUxvYWRpbmdDYWxsYmFjayIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9xdWV1ZUxvYWRpbmdDYWxsYmFjayhjYWxsYmFjaykgewogICAgICAgICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgiQWJzdHJhY3QgbWV0aG9kIGBfcXVldWVMb2FkaW5nQ2FsbGJhY2tgLiIpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIl9wcmVwYXJlRm9udExvYWRFdmVudCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9wcmVwYXJlRm9udExvYWRFdmVudChydWxlcywgZm9udHNUb0xvYWQsIHJlcXVlc3QpIHsKICAgICAgICAgICgwLCBfdXRpbC51bnJlYWNoYWJsZSkoIkFic3RyYWN0IG1ldGhvZCBgX3ByZXBhcmVGb250TG9hZEV2ZW50YC4iKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJpc0ZvbnRMb2FkaW5nQVBJU3VwcG9ydGVkIiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHZhciBzdXBwb3J0ZWQgPSB0eXBlb2YgZG9jdW1lbnQgIT09ICJ1bmRlZmluZWQiICYmICEhZG9jdW1lbnQuZm9udHM7CiAgICAgICAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgImlzRm9udExvYWRpbmdBUElTdXBwb3J0ZWQiLCBzdXBwb3J0ZWQpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImlzU3luY0ZvbnRMb2FkaW5nU3VwcG9ydGVkIiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICgwLCBfdXRpbC51bnJlYWNoYWJsZSkoIkFic3RyYWN0IG1ldGhvZCBgaXNTeW5jRm9udExvYWRpbmdTdXBwb3J0ZWRgLiIpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIl9sb2FkVGVzdEZvbnQiLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgiQWJzdHJhY3QgbWV0aG9kIGBfbG9hZFRlc3RGb250YC4iKTsKICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBCYXNlRm9udExvYWRlcjsKICAgIH0oKTsKCiAgICB2YXIgRm9udExvYWRlcjsKICAgIGV4cG9ydHMuRm9udExvYWRlciA9IEZvbnRMb2FkZXI7CiAgICB7CiAgICAgIGV4cG9ydHMuRm9udExvYWRlciA9IEZvbnRMb2FkZXIgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9CYXNlRm9udExvYWRlcikgewogICAgICAgIF9pbmhlcml0cyhHZW5lcmljRm9udExvYWRlciwgX0Jhc2VGb250TG9hZGVyKTsKCiAgICAgICAgZnVuY3Rpb24gR2VuZXJpY0ZvbnRMb2FkZXIoZG9jSWQpIHsKICAgICAgICAgIHZhciBfdGhpczI7CgogICAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEdlbmVyaWNGb250TG9hZGVyKTsKCiAgICAgICAgICBfdGhpczIgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoR2VuZXJpY0ZvbnRMb2FkZXIpLmNhbGwodGhpcywgZG9jSWQpKTsKICAgICAgICAgIF90aGlzMi5sb2FkaW5nQ29udGV4dCA9IHsKICAgICAgICAgICAgcmVxdWVzdHM6IFtdLAogICAgICAgICAgICBuZXh0UmVxdWVzdElkOiAwCiAgICAgICAgICB9OwogICAgICAgICAgX3RoaXMyLmxvYWRUZXN0Rm9udElkID0gMDsKICAgICAgICAgIHJldHVybiBfdGhpczI7CiAgICAgICAgfQoKICAgICAgICBfY3JlYXRlQ2xhc3MoR2VuZXJpY0ZvbnRMb2FkZXIsIFt7CiAgICAgICAgICBrZXk6ICJfcXVldWVMb2FkaW5nQ2FsbGJhY2siLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9xdWV1ZUxvYWRpbmdDYWxsYmFjayhjYWxsYmFjaykgewogICAgICAgICAgICBmdW5jdGlvbiBjb21wbGV0ZVJlcXVlc3QoKSB7CiAgICAgICAgICAgICAgKDAsIF91dGlsLmFzc2VydCkoIXJlcXVlc3QuZG9uZSwgImNvbXBsZXRlUmVxdWVzdCgpIGNhbm5vdCBiZSBjYWxsZWQgdHdpY2UuIik7CiAgICAgICAgICAgICAgcmVxdWVzdC5kb25lID0gdHJ1ZTsKCiAgICAgICAgICAgICAgd2hpbGUgKGNvbnRleHQucmVxdWVzdHMubGVuZ3RoID4gMCAmJiBjb250ZXh0LnJlcXVlc3RzWzBdLmRvbmUpIHsKICAgICAgICAgICAgICAgIHZhciBvdGhlclJlcXVlc3QgPSBjb250ZXh0LnJlcXVlc3RzLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KG90aGVyUmVxdWVzdC5jYWxsYmFjaywgMCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgY29udGV4dCA9IHRoaXMubG9hZGluZ0NvbnRleHQ7CiAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gewogICAgICAgICAgICAgIGlkOiAicGRmanMtZm9udC1sb2FkaW5nLSIuY29uY2F0KGNvbnRleHQubmV4dFJlcXVlc3RJZCsrKSwKICAgICAgICAgICAgICBkb25lOiBmYWxzZSwKICAgICAgICAgICAgICBjb21wbGV0ZTogY29tcGxldGVSZXF1ZXN0LAogICAgICAgICAgICAgIGNhbGxiYWNrOiBjYWxsYmFjawogICAgICAgICAgICB9OwogICAgICAgICAgICBjb250ZXh0LnJlcXVlc3RzLnB1c2gocmVxdWVzdCk7CiAgICAgICAgICAgIHJldHVybiByZXF1ZXN0OwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogIl9wcmVwYXJlRm9udExvYWRFdmVudCIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX3ByZXBhcmVGb250TG9hZEV2ZW50KHJ1bGVzLCBmb250cywgcmVxdWVzdCkgewogICAgICAgICAgICBmdW5jdGlvbiBpbnQzMihkYXRhLCBvZmZzZXQpIHsKICAgICAgICAgICAgICByZXR1cm4gZGF0YS5jaGFyQ29kZUF0KG9mZnNldCkgPDwgMjQgfCBkYXRhLmNoYXJDb2RlQXQob2Zmc2V0ICsgMSkgPDwgMTYgfCBkYXRhLmNoYXJDb2RlQXQob2Zmc2V0ICsgMikgPDwgOCB8IGRhdGEuY2hhckNvZGVBdChvZmZzZXQgKyAzKSAmIDB4ZmY7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIHNwbGljZVN0cmluZyhzLCBvZmZzZXQsIHJlbW92ZSwgaW5zZXJ0KSB7CiAgICAgICAgICAgICAgdmFyIGNodW5rMSA9IHMuc3Vic3RyaW5nKDAsIG9mZnNldCk7CiAgICAgICAgICAgICAgdmFyIGNodW5rMiA9IHMuc3Vic3RyaW5nKG9mZnNldCArIHJlbW92ZSk7CiAgICAgICAgICAgICAgcmV0dXJuIGNodW5rMSArIGluc2VydCArIGNodW5rMjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGksIGlpOwogICAgICAgICAgICB2YXIgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiY2FudmFzIik7CiAgICAgICAgICAgIGNhbnZhcy53aWR0aCA9IDE7CiAgICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSAxOwogICAgICAgICAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoIjJkIik7CiAgICAgICAgICAgIHZhciBjYWxsZWQgPSAwOwoKICAgICAgICAgICAgZnVuY3Rpb24gaXNGb250UmVhZHkobmFtZSwgY2FsbGJhY2spIHsKICAgICAgICAgICAgICBjYWxsZWQrKzsKCiAgICAgICAgICAgICAgaWYgKGNhbGxlZCA+IDMwKSB7CiAgICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIkxvYWQgdGVzdCBmb250IG5ldmVyIGxvYWRlZC4iKTsKICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjdHguZm9udCA9ICIzMHB4ICIgKyBuYW1lOwogICAgICAgICAgICAgIGN0eC5maWxsVGV4dCgiLiIsIDAsIDIwKTsKICAgICAgICAgICAgICB2YXIgaW1hZ2VEYXRhID0gY3R4LmdldEltYWdlRGF0YSgwLCAwLCAxLCAxKTsKCiAgICAgICAgICAgICAgaWYgKGltYWdlRGF0YS5kYXRhWzNdID4gMCkgewogICAgICAgICAgICAgICAgY2FsbGJhY2soKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHNldFRpbWVvdXQoaXNGb250UmVhZHkuYmluZChudWxsLCBuYW1lLCBjYWxsYmFjaykpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgbG9hZFRlc3RGb250SWQgPSAibHQiLmNvbmNhdChEYXRlLm5vdygpKS5jb25jYXQodGhpcy5sb2FkVGVzdEZvbnRJZCsrKTsKICAgICAgICAgICAgdmFyIGRhdGEgPSB0aGlzLl9sb2FkVGVzdEZvbnQ7CiAgICAgICAgICAgIHZhciBDT01NRU5UX09GRlNFVCA9IDk3NjsKICAgICAgICAgICAgZGF0YSA9IHNwbGljZVN0cmluZyhkYXRhLCBDT01NRU5UX09GRlNFVCwgbG9hZFRlc3RGb250SWQubGVuZ3RoLCBsb2FkVGVzdEZvbnRJZCk7CiAgICAgICAgICAgIHZhciBDRkZfQ0hFQ0tTVU1fT0ZGU0VUID0gMTY7CiAgICAgICAgICAgIHZhciBYWFhYX1ZBTFVFID0gMHg1ODU4NTg1ODsKICAgICAgICAgICAgdmFyIGNoZWNrc3VtID0gaW50MzIoZGF0YSwgQ0ZGX0NIRUNLU1VNX09GRlNFVCk7CgogICAgICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGxvYWRUZXN0Rm9udElkLmxlbmd0aCAtIDM7IGkgPCBpaTsgaSArPSA0KSB7CiAgICAgICAgICAgICAgY2hlY2tzdW0gPSBjaGVja3N1bSAtIFhYWFhfVkFMVUUgKyBpbnQzMihsb2FkVGVzdEZvbnRJZCwgaSkgfCAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoaSA8IGxvYWRUZXN0Rm9udElkLmxlbmd0aCkgewogICAgICAgICAgICAgIGNoZWNrc3VtID0gY2hlY2tzdW0gLSBYWFhYX1ZBTFVFICsgaW50MzIobG9hZFRlc3RGb250SWQgKyAiWFhYIiwgaSkgfCAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICBkYXRhID0gc3BsaWNlU3RyaW5nKGRhdGEsIENGRl9DSEVDS1NVTV9PRkZTRVQsIDQsICgwLCBfdXRpbC5zdHJpbmczMikoY2hlY2tzdW0pKTsKICAgICAgICAgICAgdmFyIHVybCA9ICJ1cmwoZGF0YTpmb250L29wZW50eXBlO2Jhc2U2NCwiLmNvbmNhdChidG9hKGRhdGEpLCAiKTsiKTsKICAgICAgICAgICAgdmFyIHJ1bGUgPSAiQGZvbnQtZmFjZSB7Zm9udC1mYW1pbHk6XCIiLmNvbmNhdChsb2FkVGVzdEZvbnRJZCwgIlwiO3NyYzoiKS5jb25jYXQodXJsLCAifSIpOwogICAgICAgICAgICB0aGlzLmluc2VydFJ1bGUocnVsZSk7CiAgICAgICAgICAgIHZhciBuYW1lcyA9IFtdOwoKICAgICAgICAgICAgZm9yIChpID0gMCwgaWkgPSBmb250cy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgICAgbmFtZXMucHVzaChmb250c1tpXS5sb2FkZWROYW1lKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbmFtZXMucHVzaChsb2FkVGVzdEZvbnRJZCk7CiAgICAgICAgICAgIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgICAgICAgZGl2LnN0eWxlLnZpc2liaWxpdHkgPSAiaGlkZGVuIjsKICAgICAgICAgICAgZGl2LnN0eWxlLndpZHRoID0gZGl2LnN0eWxlLmhlaWdodCA9ICIxMHB4IjsKICAgICAgICAgICAgZGl2LnN0eWxlLnBvc2l0aW9uID0gImFic29sdXRlIjsKICAgICAgICAgICAgZGl2LnN0eWxlLnRvcCA9IGRpdi5zdHlsZS5sZWZ0ID0gIjBweCI7CgogICAgICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IG5hbWVzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHsKICAgICAgICAgICAgICB2YXIgc3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKTsKICAgICAgICAgICAgICBzcGFuLnRleHRDb250ZW50ID0gIkhpIjsKICAgICAgICAgICAgICBzcGFuLnN0eWxlLmZvbnRGYW1pbHkgPSBuYW1lc1tpXTsKICAgICAgICAgICAgICBkaXYuYXBwZW5kQ2hpbGQoc3Bhbik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZGl2KTsKICAgICAgICAgICAgaXNGb250UmVhZHkobG9hZFRlc3RGb250SWQsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGRpdik7CiAgICAgICAgICAgICAgcmVxdWVzdC5jb21wbGV0ZSgpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJpc1N5bmNGb250TG9hZGluZ1N1cHBvcnRlZCIsCiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgdmFyIHN1cHBvcnRlZCA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKHR5cGVvZiBuYXZpZ2F0b3IgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAgc3VwcG9ydGVkID0gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB2YXIgbSA9IC9Nb3ppbGxhXC81LjAuKj9ydjooXGQrKS4qPyBHZWNrby8uZXhlYyhuYXZpZ2F0b3IudXNlckFnZW50KTsKCiAgICAgICAgICAgICAgaWYgKG0gJiYgbVsxXSA+PSAxNCkgewogICAgICAgICAgICAgICAgc3VwcG9ydGVkID0gdHJ1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAiaXNTeW5jRm9udExvYWRpbmdTdXBwb3J0ZWQiLCBzdXBwb3J0ZWQpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogIl9sb2FkVGVzdEZvbnQiLAogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHZhciBnZXRMb2FkVGVzdEZvbnQgPSBmdW5jdGlvbiBnZXRMb2FkVGVzdEZvbnQoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGF0b2IoIlQxUlVUd0FMQUlBQUF3QXdRMFpHSURIdFpnNEFBQU9ZQUFBQWdVWkdWRTFsa3pad0FBQUVIQUFBQUJ4SFJFVkdBQlFBIiArICJGUUFBQkRnQUFBQWVUMU12TWxZTll3a0FBQUVnQUFBQVlHTnRZWEFCRFFMVUFBQUNOQUFBQVVKb1pXRmsveFZGRFFBQSIgKyAiQUx3QUFBQTJhR2hsWVFka0Erb0FBQUQwQUFBQUpHaHRkSGdENkFBQUFBQUVXQUFBQUFadFlYaHdBQUpRQUFBQUFSZ0EiICsgIkFBQUdibUZ0WlZqbWRINEFBQUdBQUFBQXNYQnZjM1QvaGdBekFBQURlQUFBQUNBQUFRQUFBQUVBQUxaUkZzUmZEenoxIiArICJBQXNENkFBQUFBRE9CT1RMQUFBQUFNNEtIRHdBQUFBQUErZ0RJUUFBQUFnQUFnQUFBQUFBQUFBQkFBQURJUUFBQUZvRCIgKyAiNkFBQUFBQUQ2QUFCQUFBQUFBQUFBQUFBQUFBQUFBQUFBUUFBVUFBQUFnQUFBQVFENkFIMEFBVUFBQUtLQXJ3QUFBQ00iICsgIkFvb0N2QUFBQWVBQU1RRUNBQUFDQUFZSkFBQUFBQUFBQUFBQUFRQUFBQUFBQUFBQUFBQUFBRkJtUldRQXdBQXVBQzREIiArICJJUDg0QUZvRElRQUFBQUFBQVFBQUFBQUFBQUFBQUNBQUlBQUJBQUFBRGdDdUFBRUFBQUFBQUFBQUFRQUFBQUVBQUFBQSIgKyAiQUFFQUFRQUFBQUVBQUFBQUFBSUFBUUFBQUFFQUFBQUFBQU1BQVFBQUFBRUFBQUFBQUFRQUFRQUFBQUVBQUFBQUFBVUEiICsgIkFRQUFBQUVBQUFBQUFBWUFBUUFBQUFNQUFRUUpBQUFBQWdBQkFBTUFBUVFKQUFFQUFnQUJBQU1BQVFRSkFBSUFBZ0FCIiArICJBQU1BQVFRSkFBTUFBZ0FCQUFNQUFRUUpBQVFBQWdBQkFBTUFBUVFKQUFVQUFnQUJBQU1BQVFRSkFBWUFBZ0FCV0FCWSIgKyAiQUFBQUFBQUFBd0FBQUFNQUFBQWNBQUVBQUFBQUFEd0FBd0FCQUFBQUhBQUVBQ0FBQUFBRUFBUUFBUUFBQUM3Ly93QUEiICsgIkFDNy8vLy9UQUFFQUFBQUFBQUFCQmdBQUFRQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBIiArICJBQUFBQUFBQUFBQUFBQUFBQUFFQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQSIgKyAiQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUEiICsgIkFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBIiArICJBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQSIgKyAiQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBTUFBQUFBQUFEL2d3QXlBQUFBQVFBQUFBQUFBQUFBQUFBQUFBQUEiICsgIkFBQUJBQVFFQUFFQkFRSllBQUVCQVNINER3RDRHd0hFQXZnY0EvZ1hCSXdNQVl1TCtuejV0UVhrRDVqM0NCTG5FUUFDIiArICJBUUVCSVZoWVdGaFlXRmhZV0ZoWVdGaFlXRmhZV0ZoWVdGaFlXRmhZV0ZoWVdGaFlBQUFCQVFBQUR3QUNBUUVFRS90MyIgKyAiRG92NmZBSDZmQVQrZlBwOCtud0hEb3NNQ3ZtMUN2bTFEQXo2ZkJRQUFBQUFBQUFCQUFBQUFNbUpiekVBQUFBQXpnVGoiICsgIkZRQUFBQURPQk9RcEFBRUFBQUFBQUFBQURBQVVBQVFBQUFBQkFBQUFBZ0FCQUFBQUFBQUFBQUFENkFBQUFBQUFBQT09Iik7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgIl9sb2FkVGVzdEZvbnQiLCBnZXRMb2FkVGVzdEZvbnQoKSk7CiAgICAgICAgICB9CiAgICAgICAgfV0pOwoKICAgICAgICByZXR1cm4gR2VuZXJpY0ZvbnRMb2FkZXI7CiAgICAgIH0oQmFzZUZvbnRMb2FkZXIpOwogICAgfQoKICAgIHZhciBGb250RmFjZU9iamVjdCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgIGZ1bmN0aW9uIEZvbnRGYWNlT2JqZWN0KHRyYW5zbGF0ZWREYXRhLCBfcmVmMikgewogICAgICAgIHZhciBfcmVmMiRpc0V2YWxTdXBwb3J0ZWQgPSBfcmVmMi5pc0V2YWxTdXBwb3J0ZWQsCiAgICAgICAgICBpc0V2YWxTdXBwb3J0ZWQgPSBfcmVmMiRpc0V2YWxTdXBwb3J0ZWQgPT09IHZvaWQgMCA/IHRydWUgOiBfcmVmMiRpc0V2YWxTdXBwb3J0ZWQsCiAgICAgICAgICBfcmVmMiRkaXNhYmxlRm9udEZhY2UgPSBfcmVmMi5kaXNhYmxlRm9udEZhY2UsCiAgICAgICAgICBkaXNhYmxlRm9udEZhY2UgPSBfcmVmMiRkaXNhYmxlRm9udEZhY2UgPT09IHZvaWQgMCA/IGZhbHNlIDogX3JlZjIkZGlzYWJsZUZvbnRGYWNlLAogICAgICAgICAgX3JlZjIkaWdub3JlRXJyb3JzID0gX3JlZjIuaWdub3JlRXJyb3JzLAogICAgICAgICAgaWdub3JlRXJyb3JzID0gX3JlZjIkaWdub3JlRXJyb3JzID09PSB2b2lkIDAgPyBmYWxzZSA6IF9yZWYyJGlnbm9yZUVycm9ycywKICAgICAgICAgIF9yZWYyJG9uVW5zdXBwb3J0ZWRGZSA9IF9yZWYyLm9uVW5zdXBwb3J0ZWRGZWF0dXJlLAogICAgICAgICAgb25VbnN1cHBvcnRlZEZlYXR1cmUgPSBfcmVmMiRvblVuc3VwcG9ydGVkRmUgPT09IHZvaWQgMCA/IG51bGwgOiBfcmVmMiRvblVuc3VwcG9ydGVkRmUsCiAgICAgICAgICBfcmVmMiRmb250UmVnaXN0cnkgPSBfcmVmMi5mb250UmVnaXN0cnksCiAgICAgICAgICBmb250UmVnaXN0cnkgPSBfcmVmMiRmb250UmVnaXN0cnkgPT09IHZvaWQgMCA/IG51bGwgOiBfcmVmMiRmb250UmVnaXN0cnk7CgogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBGb250RmFjZU9iamVjdCk7CgogICAgICAgIHRoaXMuY29tcGlsZWRHbHlwaHMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwoKICAgICAgICBmb3IgKHZhciBpIGluIHRyYW5zbGF0ZWREYXRhKSB7CiAgICAgICAgICB0aGlzW2ldID0gdHJhbnNsYXRlZERhdGFbaV07CiAgICAgICAgfQoKICAgICAgICB0aGlzLmlzRXZhbFN1cHBvcnRlZCA9IGlzRXZhbFN1cHBvcnRlZCAhPT0gZmFsc2U7CiAgICAgICAgdGhpcy5kaXNhYmxlRm9udEZhY2UgPSBkaXNhYmxlRm9udEZhY2UgPT09IHRydWU7CiAgICAgICAgdGhpcy5pZ25vcmVFcnJvcnMgPSBpZ25vcmVFcnJvcnMgPT09IHRydWU7CiAgICAgICAgdGhpcy5fb25VbnN1cHBvcnRlZEZlYXR1cmUgPSBvblVuc3VwcG9ydGVkRmVhdHVyZTsKICAgICAgICB0aGlzLmZvbnRSZWdpc3RyeSA9IGZvbnRSZWdpc3RyeTsKICAgICAgfQoKICAgICAgX2NyZWF0ZUNsYXNzKEZvbnRGYWNlT2JqZWN0LCBbewogICAgICAgIGtleTogImNyZWF0ZU5hdGl2ZUZvbnRGYWNlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlTmF0aXZlRm9udEZhY2UoKSB7CiAgICAgICAgICBpZiAoIXRoaXMuZGF0YSB8fCB0aGlzLmRpc2FibGVGb250RmFjZSkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgbmF0aXZlRm9udEZhY2UgPSBuZXcgRm9udEZhY2UodGhpcy5sb2FkZWROYW1lLCB0aGlzLmRhdGEsIHt9KTsKCiAgICAgICAgICBpZiAodGhpcy5mb250UmVnaXN0cnkpIHsKICAgICAgICAgICAgdGhpcy5mb250UmVnaXN0cnkucmVnaXN0ZXJGb250KHRoaXMpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBuYXRpdmVGb250RmFjZTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJjcmVhdGVGb250RmFjZVJ1bGUiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVGb250RmFjZVJ1bGUoKSB7CiAgICAgICAgICBpZiAoIXRoaXMuZGF0YSB8fCB0aGlzLmRpc2FibGVGb250RmFjZSkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZGF0YSA9ICgwLCBfdXRpbC5ieXRlc1RvU3RyaW5nKShuZXcgVWludDhBcnJheSh0aGlzLmRhdGEpKTsKICAgICAgICAgIHZhciB1cmwgPSAidXJsKGRhdGE6Ii5jb25jYXQodGhpcy5taW1ldHlwZSwgIjtiYXNlNjQsIikuY29uY2F0KGJ0b2EoZGF0YSksICIpOyIpOwogICAgICAgICAgdmFyIHJ1bGUgPSAiQGZvbnQtZmFjZSB7Zm9udC1mYW1pbHk6XCIiLmNvbmNhdCh0aGlzLmxvYWRlZE5hbWUsICJcIjtzcmM6IikuY29uY2F0KHVybCwgIn0iKTsKCiAgICAgICAgICBpZiAodGhpcy5mb250UmVnaXN0cnkpIHsKICAgICAgICAgICAgdGhpcy5mb250UmVnaXN0cnkucmVnaXN0ZXJGb250KHRoaXMsIHVybCk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHJ1bGU7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0UGF0aEdlbmVyYXRvciIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldFBhdGhHZW5lcmF0b3Iob2JqcywgY2hhcmFjdGVyKSB7CiAgICAgICAgICBpZiAodGhpcy5jb21waWxlZEdseXBoc1tjaGFyYWN0ZXJdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29tcGlsZWRHbHlwaHNbY2hhcmFjdGVyXTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgY21kcywgY3VycmVudDsKCiAgICAgICAgICB0cnkgewogICAgICAgICAgICBjbWRzID0gb2Jqcy5nZXQodGhpcy5sb2FkZWROYW1lICsgIl9wYXRoXyIgKyBjaGFyYWN0ZXIpOwogICAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLmlnbm9yZUVycm9ycykgewogICAgICAgICAgICAgIHRocm93IGV4OwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpcy5fb25VbnN1cHBvcnRlZEZlYXR1cmUpIHsKICAgICAgICAgICAgICB0aGlzLl9vblVuc3VwcG9ydGVkRmVhdHVyZSh7CiAgICAgICAgICAgICAgICBmZWF0dXJlSWQ6IF91dGlsLlVOU1VQUE9SVEVEX0ZFQVRVUkVTLmZvbnQKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJnZXRQYXRoR2VuZXJhdG9yIC0gaWdub3JpbmcgY2hhcmFjdGVyOiBcIiIuY29uY2F0KGV4LCAiXCIuIikpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5jb21waWxlZEdseXBoc1tjaGFyYWN0ZXJdID0gZnVuY3Rpb24gKGMsIHNpemUpIHt9OwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0aGlzLmlzRXZhbFN1cHBvcnRlZCAmJiBfdXRpbC5Jc0V2YWxTdXBwb3J0ZWRDYWNoZWQudmFsdWUpIHsKICAgICAgICAgICAgdmFyIGFyZ3MsCiAgICAgICAgICAgICAganMgPSAiIjsKCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGNtZHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICAgIGN1cnJlbnQgPSBjbWRzW2ldOwoKICAgICAgICAgICAgICBpZiAoY3VycmVudC5hcmdzICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGFyZ3MgPSBjdXJyZW50LmFyZ3Muam9pbigiLCIpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBhcmdzID0gIiI7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBqcyArPSAiYy4iICsgY3VycmVudC5jbWQgKyAiKCIgKyBhcmdzICsgIik7XG4iOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdGhpcy5jb21waWxlZEdseXBoc1tjaGFyYWN0ZXJdID0gbmV3IEZ1bmN0aW9uKCJjIiwgInNpemUiLCBqcyk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHRoaXMuY29tcGlsZWRHbHlwaHNbY2hhcmFjdGVyXSA9IGZ1bmN0aW9uIChjLCBzaXplKSB7CiAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwgX2lpID0gY21kcy5sZW5ndGg7IF9pIDwgX2lpOyBfaSsrKSB7CiAgICAgICAgICAgICAgY3VycmVudCA9IGNtZHNbX2ldOwoKICAgICAgICAgICAgICBpZiAoY3VycmVudC5jbWQgPT09ICJzY2FsZSIpIHsKICAgICAgICAgICAgICAgIGN1cnJlbnQuYXJncyA9IFtzaXplLCAtc2l6ZV07CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjW2N1cnJlbnQuY21kXS5hcHBseShjLCBjdXJyZW50LmFyZ3MpOwogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIEZvbnRGYWNlT2JqZWN0OwogICAgfSgpOwoKICAgIGV4cG9ydHMuRm9udEZhY2VPYmplY3QgPSBGb250RmFjZU9iamVjdDsKCiAgICAvKioqL30pLCAoCiAgLyogMTk2ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKCiAgICB2YXIgY29tcGF0aWJpbGl0eVBhcmFtcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICB7CiAgICAgIHZhciBfcmVxdWlyZSA9IF9fd19wZGZqc19yZXF1aXJlX18oNDgpLAogICAgICAgIGlzTm9kZUpTID0gX3JlcXVpcmUuaXNOb2RlSlM7CgogICAgICB2YXIgdXNlckFnZW50ID0gdHlwZW9mIG5hdmlnYXRvciAhPT0gInVuZGVmaW5lZCIgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudCB8fCAiIjsKICAgICAgdmFyIGlzSUUgPSAvVHJpZGVudC8udGVzdCh1c2VyQWdlbnQpOwogICAgICB2YXIgaXNJT1NDaHJvbWUgPSAvQ3JpT1MvLnRlc3QodXNlckFnZW50KTsKCiAgICAgIChmdW5jdGlvbiBjaGVja09uQmxvYlN1cHBvcnQoKSB7CiAgICAgICAgaWYgKGlzSUUgfHwgaXNJT1NDaHJvbWUpIHsKICAgICAgICAgIGNvbXBhdGliaWxpdHlQYXJhbXMuZGlzYWJsZUNyZWF0ZU9iamVjdFVSTCA9IHRydWU7CiAgICAgICAgfQogICAgICB9KSgpOwoKICAgICAgKGZ1bmN0aW9uIGNoZWNrRm9udEZhY2VBbmRJbWFnZSgpIHsKICAgICAgICBpZiAoaXNOb2RlSlMpIHsKICAgICAgICAgIGNvbXBhdGliaWxpdHlQYXJhbXMuZGlzYWJsZUZvbnRGYWNlID0gdHJ1ZTsKICAgICAgICAgIGNvbXBhdGliaWxpdHlQYXJhbXMubmF0aXZlSW1hZ2VEZWNvZGVyU3VwcG9ydCA9ICJub25lIjsKICAgICAgICB9CiAgICAgIH0pKCk7CiAgICB9CiAgICBleHBvcnRzLmFwaUNvbXBhdGliaWxpdHlQYXJhbXMgPSBPYmplY3QuZnJlZXplKGNvbXBhdGliaWxpdHlQYXJhbXMpOwoKICAgIC8qKiovfSksICgKICAvKiAxOTcgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgoKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgICAgdmFsdWU6IHRydWUKICAgIH0pOwogICAgZXhwb3J0cy5DYW52YXNHcmFwaGljcyA9IHZvaWQgMDsKCiAgICB2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEpOwoKICAgIHZhciBfcGF0dGVybl9oZWxwZXIgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE5OCk7CgogICAgdmFyIE1JTl9GT05UX1NJWkUgPSAxNjsKICAgIHZhciBNQVhfRk9OVF9TSVpFID0gMTAwOwogICAgdmFyIE1BWF9HUk9VUF9TSVpFID0gNDA5NjsKICAgIHZhciBNSU5fV0lEVEhfRkFDVE9SID0gMC42NTsKICAgIHZhciBDT01QSUxFX1RZUEUzX0dMWVBIUyA9IHRydWU7CiAgICB2YXIgTUFYX1NJWkVfVE9fQ09NUElMRSA9IDEwMDA7CiAgICB2YXIgRlVMTF9DSFVOS19IRUlHSFQgPSAxNjsKCiAgICBmdW5jdGlvbiBhZGRDb250ZXh0Q3VycmVudFRyYW5zZm9ybShjdHgpIHsKICAgICAgaWYgKCFjdHgubW96Q3VycmVudFRyYW5zZm9ybSkgewogICAgICAgIGN0eC5fb3JpZ2luYWxTYXZlID0gY3R4LnNhdmU7CiAgICAgICAgY3R4Ll9vcmlnaW5hbFJlc3RvcmUgPSBjdHgucmVzdG9yZTsKICAgICAgICBjdHguX29yaWdpbmFsUm90YXRlID0gY3R4LnJvdGF0ZTsKICAgICAgICBjdHguX29yaWdpbmFsU2NhbGUgPSBjdHguc2NhbGU7CiAgICAgICAgY3R4Ll9vcmlnaW5hbFRyYW5zbGF0ZSA9IGN0eC50cmFuc2xhdGU7CiAgICAgICAgY3R4Ll9vcmlnaW5hbFRyYW5zZm9ybSA9IGN0eC50cmFuc2Zvcm07CiAgICAgICAgY3R4Ll9vcmlnaW5hbFNldFRyYW5zZm9ybSA9IGN0eC5zZXRUcmFuc2Zvcm07CiAgICAgICAgY3R4Ll90cmFuc2Zvcm1NYXRyaXggPSBjdHguX3RyYW5zZm9ybU1hdHJpeCB8fCBbMSwgMCwgMCwgMSwgMCwgMF07CiAgICAgICAgY3R4Ll90cmFuc2Zvcm1TdGFjayA9IFtdOwogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjdHgsICJtb3pDdXJyZW50VHJhbnNmb3JtIiwgewogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXRDdXJyZW50VHJhbnNmb3JtKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdHJhbnNmb3JtTWF0cml4OwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjdHgsICJtb3pDdXJyZW50VHJhbnNmb3JtSW52ZXJzZSIsIHsKICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0Q3VycmVudFRyYW5zZm9ybUludmVyc2UoKSB7CiAgICAgICAgICAgIHZhciBtID0gdGhpcy5fdHJhbnNmb3JtTWF0cml4OwogICAgICAgICAgICB2YXIgYSA9IG1bMF0sCiAgICAgICAgICAgICAgYiA9IG1bMV0sCiAgICAgICAgICAgICAgYyA9IG1bMl0sCiAgICAgICAgICAgICAgZCA9IG1bM10sCiAgICAgICAgICAgICAgZSA9IG1bNF0sCiAgICAgICAgICAgICAgZiA9IG1bNV07CiAgICAgICAgICAgIHZhciBhZF9iYyA9IGEgKiBkIC0gYiAqIGM7CiAgICAgICAgICAgIHZhciBiY19hZCA9IGIgKiBjIC0gYSAqIGQ7CiAgICAgICAgICAgIHJldHVybiBbZCAvIGFkX2JjLCBiIC8gYmNfYWQsIGMgLyBiY19hZCwgYSAvIGFkX2JjLCAoZCAqIGUgLSBjICogZikgLyBiY19hZCwgKGIgKiBlIC0gYSAqIGYpIC8gYWRfYmNdOwogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBjdHguc2F2ZSA9IGZ1bmN0aW9uIGN0eFNhdmUoKSB7CiAgICAgICAgICB2YXIgb2xkID0gdGhpcy5fdHJhbnNmb3JtTWF0cml4OwoKICAgICAgICAgIHRoaXMuX3RyYW5zZm9ybVN0YWNrLnB1c2gob2xkKTsKCiAgICAgICAgICB0aGlzLl90cmFuc2Zvcm1NYXRyaXggPSBvbGQuc2xpY2UoMCwgNik7CgogICAgICAgICAgdGhpcy5fb3JpZ2luYWxTYXZlKCk7CiAgICAgICAgfTsKCiAgICAgICAgY3R4LnJlc3RvcmUgPSBmdW5jdGlvbiBjdHhSZXN0b3JlKCkgewogICAgICAgICAgdmFyIHByZXYgPSB0aGlzLl90cmFuc2Zvcm1TdGFjay5wb3AoKTsKCiAgICAgICAgICBpZiAocHJldikgewogICAgICAgICAgICB0aGlzLl90cmFuc2Zvcm1NYXRyaXggPSBwcmV2OwoKICAgICAgICAgICAgdGhpcy5fb3JpZ2luYWxSZXN0b3JlKCk7CiAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgY3R4LnRyYW5zbGF0ZSA9IGZ1bmN0aW9uIGN0eFRyYW5zbGF0ZSh4LCB5KSB7CiAgICAgICAgICB2YXIgbSA9IHRoaXMuX3RyYW5zZm9ybU1hdHJpeDsKICAgICAgICAgIG1bNF0gPSBtWzBdICogeCArIG1bMl0gKiB5ICsgbVs0XTsKICAgICAgICAgIG1bNV0gPSBtWzFdICogeCArIG1bM10gKiB5ICsgbVs1XTsKCiAgICAgICAgICB0aGlzLl9vcmlnaW5hbFRyYW5zbGF0ZSh4LCB5KTsKICAgICAgICB9OwoKICAgICAgICBjdHguc2NhbGUgPSBmdW5jdGlvbiBjdHhTY2FsZSh4LCB5KSB7CiAgICAgICAgICB2YXIgbSA9IHRoaXMuX3RyYW5zZm9ybU1hdHJpeDsKICAgICAgICAgIG1bMF0gPSBtWzBdICogeDsKICAgICAgICAgIG1bMV0gPSBtWzFdICogeDsKICAgICAgICAgIG1bMl0gPSBtWzJdICogeTsKICAgICAgICAgIG1bM10gPSBtWzNdICogeTsKCiAgICAgICAgICB0aGlzLl9vcmlnaW5hbFNjYWxlKHgsIHkpOwogICAgICAgIH07CgogICAgICAgIGN0eC50cmFuc2Zvcm0gPSBmdW5jdGlvbiBjdHhUcmFuc2Zvcm0oYSwgYiwgYywgZCwgZSwgZikgewogICAgICAgICAgdmFyIG0gPSB0aGlzLl90cmFuc2Zvcm1NYXRyaXg7CiAgICAgICAgICB0aGlzLl90cmFuc2Zvcm1NYXRyaXggPSBbbVswXSAqIGEgKyBtWzJdICogYiwgbVsxXSAqIGEgKyBtWzNdICogYiwgbVswXSAqIGMgKyBtWzJdICogZCwgbVsxXSAqIGMgKyBtWzNdICogZCwgbVswXSAqIGUgKyBtWzJdICogZiArIG1bNF0sIG1bMV0gKiBlICsgbVszXSAqIGYgKyBtWzVdXTsKCiAgICAgICAgICBjdHguX29yaWdpbmFsVHJhbnNmb3JtKGEsIGIsIGMsIGQsIGUsIGYpOwogICAgICAgIH07CgogICAgICAgIGN0eC5zZXRUcmFuc2Zvcm0gPSBmdW5jdGlvbiBjdHhTZXRUcmFuc2Zvcm0oYSwgYiwgYywgZCwgZSwgZikgewogICAgICAgICAgdGhpcy5fdHJhbnNmb3JtTWF0cml4ID0gW2EsIGIsIGMsIGQsIGUsIGZdOwoKICAgICAgICAgIGN0eC5fb3JpZ2luYWxTZXRUcmFuc2Zvcm0oYSwgYiwgYywgZCwgZSwgZik7CiAgICAgICAgfTsKCiAgICAgICAgY3R4LnJvdGF0ZSA9IGZ1bmN0aW9uIGN0eFJvdGF0ZShhbmdsZSkgewogICAgICAgICAgdmFyIGNvc1ZhbHVlID0gTWF0aC5jb3MoYW5nbGUpOwogICAgICAgICAgdmFyIHNpblZhbHVlID0gTWF0aC5zaW4oYW5nbGUpOwogICAgICAgICAgdmFyIG0gPSB0aGlzLl90cmFuc2Zvcm1NYXRyaXg7CiAgICAgICAgICB0aGlzLl90cmFuc2Zvcm1NYXRyaXggPSBbbVswXSAqIGNvc1ZhbHVlICsgbVsyXSAqIHNpblZhbHVlLCBtWzFdICogY29zVmFsdWUgKyBtWzNdICogc2luVmFsdWUsIG1bMF0gKiAtc2luVmFsdWUgKyBtWzJdICogY29zVmFsdWUsIG1bMV0gKiAtc2luVmFsdWUgKyBtWzNdICogY29zVmFsdWUsIG1bNF0sIG1bNV1dOwoKICAgICAgICAgIHRoaXMuX29yaWdpbmFsUm90YXRlKGFuZ2xlKTsKICAgICAgICB9OwogICAgICB9CiAgICB9CgogICAgdmFyIENhY2hlZENhbnZhc2VzID0gZnVuY3Rpb24gQ2FjaGVkQ2FudmFzZXNDbG9zdXJlKCkgewogICAgICBmdW5jdGlvbiBDYWNoZWRDYW52YXNlcyhjYW52YXNGYWN0b3J5KSB7CiAgICAgICAgdGhpcy5jYW52YXNGYWN0b3J5ID0gY2FudmFzRmFjdG9yeTsKICAgICAgICB0aGlzLmNhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgfQoKICAgICAgQ2FjaGVkQ2FudmFzZXMucHJvdG90eXBlID0gewogICAgICAgIGdldENhbnZhczogZnVuY3Rpb24gQ2FjaGVkQ2FudmFzZXNfZ2V0Q2FudmFzKGlkLCB3aWR0aCwgaGVpZ2h0LCB0cmFja1RyYW5zZm9ybSkgewogICAgICAgICAgdmFyIGNhbnZhc0VudHJ5OwoKICAgICAgICAgIGlmICh0aGlzLmNhY2hlW2lkXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGNhbnZhc0VudHJ5ID0gdGhpcy5jYWNoZVtpZF07CiAgICAgICAgICAgIHRoaXMuY2FudmFzRmFjdG9yeS5yZXNldChjYW52YXNFbnRyeSwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgIGNhbnZhc0VudHJ5LmNvbnRleHQuc2V0VHJhbnNmb3JtKDEsIDAsIDAsIDEsIDAsIDApOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY2FudmFzRW50cnkgPSB0aGlzLmNhbnZhc0ZhY3RvcnkuY3JlYXRlKHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgICB0aGlzLmNhY2hlW2lkXSA9IGNhbnZhc0VudHJ5OwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0cmFja1RyYW5zZm9ybSkgewogICAgICAgICAgICBhZGRDb250ZXh0Q3VycmVudFRyYW5zZm9ybShjYW52YXNFbnRyeS5jb250ZXh0KTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gY2FudmFzRW50cnk7CiAgICAgICAgfSwKICAgICAgICBjbGVhcjogZnVuY3Rpb24gY2xlYXIoKSB7CiAgICAgICAgICBmb3IgKHZhciBpZCBpbiB0aGlzLmNhY2hlKSB7CiAgICAgICAgICAgIHZhciBjYW52YXNFbnRyeSA9IHRoaXMuY2FjaGVbaWRdOwogICAgICAgICAgICB0aGlzLmNhbnZhc0ZhY3RvcnkuZGVzdHJveShjYW52YXNFbnRyeSk7CiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmNhY2hlW2lkXTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07CiAgICAgIHJldHVybiBDYWNoZWRDYW52YXNlczsKICAgIH0oKTsKCiAgICBmdW5jdGlvbiBjb21waWxlVHlwZTNHbHlwaChpbWdEYXRhKSB7CiAgICAgIHZhciBQT0lOVF9UT19QUk9DRVNTX0xJTUlUID0gMTAwMDsKICAgICAgdmFyIHdpZHRoID0gaW1nRGF0YS53aWR0aCwKICAgICAgICBoZWlnaHQgPSBpbWdEYXRhLmhlaWdodDsKICAgICAgdmFyIGksCiAgICAgICAgaiwKICAgICAgICBqMCwKICAgICAgICB3aWR0aDEgPSB3aWR0aCArIDE7CiAgICAgIHZhciBwb2ludHMgPSBuZXcgVWludDhBcnJheSh3aWR0aDEgKiAoaGVpZ2h0ICsgMSkpOwogICAgICB2YXIgUE9JTlRfVFlQRVMgPSBuZXcgVWludDhBcnJheShbMCwgMiwgNCwgMCwgMSwgMCwgNSwgNCwgOCwgMTAsIDAsIDgsIDAsIDIsIDEsIDBdKTsKICAgICAgdmFyIGxpbmVTaXplID0gd2lkdGggKyA3ICYgfjcsCiAgICAgICAgZGF0YTAgPSBpbWdEYXRhLmRhdGE7CiAgICAgIHZhciBkYXRhID0gbmV3IFVpbnQ4QXJyYXkobGluZVNpemUgKiBoZWlnaHQpLAogICAgICAgIHBvcyA9IDAsCiAgICAgICAgaWk7CgogICAgICBmb3IgKGkgPSAwLCBpaSA9IGRhdGEwLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICB2YXIgbWFzayA9IDEyOCwKICAgICAgICAgIGVsZW0gPSBkYXRhMFtpXTsKCiAgICAgICAgd2hpbGUgKG1hc2sgPiAwKSB7CiAgICAgICAgICBkYXRhW3BvcysrXSA9IGVsZW0gJiBtYXNrID8gMCA6IDI1NTsKICAgICAgICAgIG1hc2sgPj49IDE7CiAgICAgICAgfQogICAgICB9CgogICAgICB2YXIgY291bnQgPSAwOwogICAgICBwb3MgPSAwOwoKICAgICAgaWYgKGRhdGFbcG9zXSAhPT0gMCkgewogICAgICAgIHBvaW50c1swXSA9IDE7CiAgICAgICAgKytjb3VudDsKICAgICAgfQoKICAgICAgZm9yIChqID0gMTsgaiA8IHdpZHRoOyBqKyspIHsKICAgICAgICBpZiAoZGF0YVtwb3NdICE9PSBkYXRhW3BvcyArIDFdKSB7CiAgICAgICAgICBwb2ludHNbal0gPSBkYXRhW3Bvc10gPyAyIDogMTsKICAgICAgICAgICsrY291bnQ7CiAgICAgICAgfQoKICAgICAgICBwb3MrKzsKICAgICAgfQoKICAgICAgaWYgKGRhdGFbcG9zXSAhPT0gMCkgewogICAgICAgIHBvaW50c1tqXSA9IDI7CiAgICAgICAgKytjb3VudDsKICAgICAgfQoKICAgICAgZm9yIChpID0gMTsgaSA8IGhlaWdodDsgaSsrKSB7CiAgICAgICAgcG9zID0gaSAqIGxpbmVTaXplOwogICAgICAgIGowID0gaSAqIHdpZHRoMTsKCiAgICAgICAgaWYgKGRhdGFbcG9zIC0gbGluZVNpemVdICE9PSBkYXRhW3Bvc10pIHsKICAgICAgICAgIHBvaW50c1tqMF0gPSBkYXRhW3Bvc10gPyAxIDogODsKICAgICAgICAgICsrY291bnQ7CiAgICAgICAgfQoKICAgICAgICB2YXIgc3VtID0gKGRhdGFbcG9zXSA/IDQgOiAwKSArIChkYXRhW3BvcyAtIGxpbmVTaXplXSA/IDggOiAwKTsKCiAgICAgICAgZm9yIChqID0gMTsgaiA8IHdpZHRoOyBqKyspIHsKICAgICAgICAgIHN1bSA9IChzdW0gPj4gMikgKyAoZGF0YVtwb3MgKyAxXSA/IDQgOiAwKSArIChkYXRhW3BvcyAtIGxpbmVTaXplICsgMV0gPyA4IDogMCk7CgogICAgICAgICAgaWYgKFBPSU5UX1RZUEVTW3N1bV0pIHsKICAgICAgICAgICAgcG9pbnRzW2owICsgal0gPSBQT0lOVF9UWVBFU1tzdW1dOwogICAgICAgICAgICArK2NvdW50OwogICAgICAgICAgfQoKICAgICAgICAgIHBvcysrOwogICAgICAgIH0KCiAgICAgICAgaWYgKGRhdGFbcG9zIC0gbGluZVNpemVdICE9PSBkYXRhW3Bvc10pIHsKICAgICAgICAgIHBvaW50c1tqMCArIGpdID0gZGF0YVtwb3NdID8gMiA6IDQ7CiAgICAgICAgICArK2NvdW50OwogICAgICAgIH0KCiAgICAgICAgaWYgKGNvdW50ID4gUE9JTlRfVE9fUFJPQ0VTU19MSU1JVCkgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICB9CgogICAgICBwb3MgPSBsaW5lU2l6ZSAqIChoZWlnaHQgLSAxKTsKICAgICAgajAgPSBpICogd2lkdGgxOwoKICAgICAgaWYgKGRhdGFbcG9zXSAhPT0gMCkgewogICAgICAgIHBvaW50c1tqMF0gPSA4OwogICAgICAgICsrY291bnQ7CiAgICAgIH0KCiAgICAgIGZvciAoaiA9IDE7IGogPCB3aWR0aDsgaisrKSB7CiAgICAgICAgaWYgKGRhdGFbcG9zXSAhPT0gZGF0YVtwb3MgKyAxXSkgewogICAgICAgICAgcG9pbnRzW2owICsgal0gPSBkYXRhW3Bvc10gPyA0IDogODsKICAgICAgICAgICsrY291bnQ7CiAgICAgICAgfQoKICAgICAgICBwb3MrKzsKICAgICAgfQoKICAgICAgaWYgKGRhdGFbcG9zXSAhPT0gMCkgewogICAgICAgIHBvaW50c1tqMCArIGpdID0gNDsKICAgICAgICArK2NvdW50OwogICAgICB9CgogICAgICBpZiAoY291bnQgPiBQT0lOVF9UT19QUk9DRVNTX0xJTUlUKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIHZhciBzdGVwcyA9IG5ldyBJbnQzMkFycmF5KFswLCB3aWR0aDEsIC0xLCAwLCAtd2lkdGgxLCAwLCAwLCAwLCAxXSk7CiAgICAgIHZhciBvdXRsaW5lcyA9IFtdOwoKICAgICAgZm9yIChpID0gMDsgY291bnQgJiYgaSA8PSBoZWlnaHQ7IGkrKykgewogICAgICAgIHZhciBwID0gaSAqIHdpZHRoMTsKICAgICAgICB2YXIgZW5kID0gcCArIHdpZHRoOwoKICAgICAgICB3aGlsZSAocCA8IGVuZCAmJiAhcG9pbnRzW3BdKSB7CiAgICAgICAgICBwKys7CiAgICAgICAgfQoKICAgICAgICBpZiAocCA9PT0gZW5kKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIHZhciBjb29yZHMgPSBbcCAlIHdpZHRoMSwgaV07CiAgICAgICAgdmFyIHR5cGUgPSBwb2ludHNbcF0sCiAgICAgICAgICBwMCA9IHAsCiAgICAgICAgICBwcDsKCiAgICAgICAgZG8gewogICAgICAgICAgdmFyIHN0ZXAgPSBzdGVwc1t0eXBlXTsKCiAgICAgICAgICBkbyB7CiAgICAgICAgICAgIHAgKz0gc3RlcDsKICAgICAgICAgIH0gd2hpbGUgKCFwb2ludHNbcF0pOwoKICAgICAgICAgIHBwID0gcG9pbnRzW3BdOwoKICAgICAgICAgIGlmIChwcCAhPT0gNSAmJiBwcCAhPT0gMTApIHsKICAgICAgICAgICAgdHlwZSA9IHBwOwogICAgICAgICAgICBwb2ludHNbcF0gPSAwOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdHlwZSA9IHBwICYgMHgzMyAqIHR5cGUgPj4gNDsKICAgICAgICAgICAgcG9pbnRzW3BdICY9IHR5cGUgPj4gMiB8IHR5cGUgPDwgMjsKICAgICAgICAgIH0KCiAgICAgICAgICBjb29yZHMucHVzaChwICUgd2lkdGgxKTsKICAgICAgICAgIGNvb3Jkcy5wdXNoKHAgLyB3aWR0aDEgfCAwKTsKCiAgICAgICAgICBpZiAoIXBvaW50c1twXSkgewogICAgICAgICAgICAtLWNvdW50OwogICAgICAgICAgfQogICAgICAgIH0gd2hpbGUgKHAwICE9PSBwKTsKCiAgICAgICAgb3V0bGluZXMucHVzaChjb29yZHMpOwogICAgICAgIC0taTsKICAgICAgfQoKICAgICAgdmFyIGRyYXdPdXRsaW5lID0gZnVuY3Rpb24gZHJhd091dGxpbmUoYykgewogICAgICAgIGMuc2F2ZSgpOwogICAgICAgIGMuc2NhbGUoMSAvIHdpZHRoLCAtMSAvIGhlaWdodCk7CiAgICAgICAgYy50cmFuc2xhdGUoMCwgLWhlaWdodCk7CiAgICAgICAgYy5iZWdpblBhdGgoKTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gb3V0bGluZXMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgdmFyIG8gPSBvdXRsaW5lc1tpXTsKICAgICAgICAgIGMubW92ZVRvKG9bMF0sIG9bMV0pOwoKICAgICAgICAgIGZvciAodmFyIGogPSAyLCBqaiA9IG8ubGVuZ3RoOyBqIDwgamo7IGogKz0gMikgewogICAgICAgICAgICBjLmxpbmVUbyhvW2pdLCBvW2ogKyAxXSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBjLmZpbGwoKTsKICAgICAgICBjLmJlZ2luUGF0aCgpOwogICAgICAgIGMucmVzdG9yZSgpOwogICAgICB9OwoKICAgICAgcmV0dXJuIGRyYXdPdXRsaW5lOwogICAgfQoKICAgIHZhciBDYW52YXNFeHRyYVN0YXRlID0gZnVuY3Rpb24gQ2FudmFzRXh0cmFTdGF0ZUNsb3N1cmUoKSB7CiAgICAgIGZ1bmN0aW9uIENhbnZhc0V4dHJhU3RhdGUoKSB7CiAgICAgICAgdGhpcy5hbHBoYUlzU2hhcGUgPSBmYWxzZTsKICAgICAgICB0aGlzLmZvbnRTaXplID0gMDsKICAgICAgICB0aGlzLmZvbnRTaXplU2NhbGUgPSAxOwogICAgICAgIHRoaXMudGV4dE1hdHJpeCA9IF91dGlsLklERU5USVRZX01BVFJJWDsKICAgICAgICB0aGlzLnRleHRNYXRyaXhTY2FsZSA9IDE7CiAgICAgICAgdGhpcy5mb250TWF0cml4ID0gX3V0aWwuRk9OVF9JREVOVElUWV9NQVRSSVg7CiAgICAgICAgdGhpcy5sZWFkaW5nID0gMDsKICAgICAgICB0aGlzLnggPSAwOwogICAgICAgIHRoaXMueSA9IDA7CiAgICAgICAgdGhpcy5saW5lWCA9IDA7CiAgICAgICAgdGhpcy5saW5lWSA9IDA7CiAgICAgICAgdGhpcy5jaGFyU3BhY2luZyA9IDA7CiAgICAgICAgdGhpcy53b3JkU3BhY2luZyA9IDA7CiAgICAgICAgdGhpcy50ZXh0SFNjYWxlID0gMTsKICAgICAgICB0aGlzLnRleHRSZW5kZXJpbmdNb2RlID0gX3V0aWwuVGV4dFJlbmRlcmluZ01vZGUuRklMTDsKICAgICAgICB0aGlzLnRleHRSaXNlID0gMDsKICAgICAgICB0aGlzLmZpbGxDb2xvciA9ICIjMDAwMDAwIjsKICAgICAgICB0aGlzLnN0cm9rZUNvbG9yID0gIiMwMDAwMDAiOwogICAgICAgIHRoaXMucGF0dGVybkZpbGwgPSBmYWxzZTsKICAgICAgICB0aGlzLmZpbGxBbHBoYSA9IDE7CiAgICAgICAgdGhpcy5zdHJva2VBbHBoYSA9IDE7CiAgICAgICAgdGhpcy5saW5lV2lkdGggPSAxOwogICAgICAgIHRoaXMuYWN0aXZlU01hc2sgPSBudWxsOwogICAgICAgIHRoaXMucmVzdW1lU01hc2tDdHggPSBudWxsOwogICAgICB9CgogICAgICBDYW52YXNFeHRyYVN0YXRlLnByb3RvdHlwZSA9IHsKICAgICAgICBjbG9uZTogZnVuY3Rpb24gQ2FudmFzRXh0cmFTdGF0ZV9jbG9uZSgpIHsKICAgICAgICAgIHJldHVybiBPYmplY3QuY3JlYXRlKHRoaXMpOwogICAgICAgIH0sCiAgICAgICAgc2V0Q3VycmVudFBvaW50OiBmdW5jdGlvbiBDYW52YXNFeHRyYVN0YXRlX3NldEN1cnJlbnRQb2ludCh4LCB5KSB7CiAgICAgICAgICB0aGlzLnggPSB4OwogICAgICAgICAgdGhpcy55ID0geTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHJldHVybiBDYW52YXNFeHRyYVN0YXRlOwogICAgfSgpOwoKICAgIHZhciBDYW52YXNHcmFwaGljcyA9IGZ1bmN0aW9uIENhbnZhc0dyYXBoaWNzQ2xvc3VyZSgpIHsKICAgICAgdmFyIEVYRUNVVElPTl9USU1FID0gMTU7CiAgICAgIHZhciBFWEVDVVRJT05fU1RFUFMgPSAxMDsKCiAgICAgIGZ1bmN0aW9uIENhbnZhc0dyYXBoaWNzKGNhbnZhc0N0eCwgY29tbW9uT2Jqcywgb2JqcywgY2FudmFzRmFjdG9yeSwgd2ViR0xDb250ZXh0LCBpbWFnZUxheWVyKSB7CiAgICAgICAgdGhpcy5jdHggPSBjYW52YXNDdHg7CiAgICAgICAgdGhpcy5jdXJyZW50ID0gbmV3IENhbnZhc0V4dHJhU3RhdGUoKTsKICAgICAgICB0aGlzLnN0YXRlU3RhY2sgPSBbXTsKICAgICAgICB0aGlzLnBlbmRpbmdDbGlwID0gbnVsbDsKICAgICAgICB0aGlzLnBlbmRpbmdFT0ZpbGwgPSBmYWxzZTsKICAgICAgICB0aGlzLnJlcyA9IG51bGw7CiAgICAgICAgdGhpcy54b2JqcyA9IG51bGw7CiAgICAgICAgdGhpcy5jb21tb25PYmpzID0gY29tbW9uT2JqczsKICAgICAgICB0aGlzLm9ianMgPSBvYmpzOwogICAgICAgIHRoaXMuY2FudmFzRmFjdG9yeSA9IGNhbnZhc0ZhY3Rvcnk7CiAgICAgICAgdGhpcy53ZWJHTENvbnRleHQgPSB3ZWJHTENvbnRleHQ7CiAgICAgICAgdGhpcy5pbWFnZUxheWVyID0gaW1hZ2VMYXllcjsKICAgICAgICB0aGlzLmdyb3VwU3RhY2sgPSBbXTsKICAgICAgICB0aGlzLnByb2Nlc3NpbmdUeXBlMyA9IG51bGw7CiAgICAgICAgdGhpcy5iYXNlVHJhbnNmb3JtID0gbnVsbDsKICAgICAgICB0aGlzLmJhc2VUcmFuc2Zvcm1TdGFjayA9IFtdOwogICAgICAgIHRoaXMuZ3JvdXBMZXZlbCA9IDA7CiAgICAgICAgdGhpcy5zbWFza1N0YWNrID0gW107CiAgICAgICAgdGhpcy5zbWFza0NvdW50ZXIgPSAwOwogICAgICAgIHRoaXMudGVtcFNNYXNrID0gbnVsbDsKICAgICAgICB0aGlzLmNhY2hlZENhbnZhc2VzID0gbmV3IENhY2hlZENhbnZhc2VzKHRoaXMuY2FudmFzRmFjdG9yeSk7CgogICAgICAgIGlmIChjYW52YXNDdHgpIHsKICAgICAgICAgIGFkZENvbnRleHRDdXJyZW50VHJhbnNmb3JtKGNhbnZhc0N0eCk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLl9jYWNoZWRHZXRTaW5nbGVQaXhlbFdpZHRoID0gbnVsbDsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gcHV0QmluYXJ5SW1hZ2VEYXRhKGN0eCwgaW1nRGF0YSkgewogICAgICAgIGlmICh0eXBlb2YgSW1hZ2VEYXRhICE9PSAidW5kZWZpbmVkIiAmJiBpbWdEYXRhIGluc3RhbmNlb2YgSW1hZ2VEYXRhKSB7CiAgICAgICAgICBjdHgucHV0SW1hZ2VEYXRhKGltZ0RhdGEsIDAsIDApOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIGhlaWdodCA9IGltZ0RhdGEuaGVpZ2h0LAogICAgICAgICAgd2lkdGggPSBpbWdEYXRhLndpZHRoOwogICAgICAgIHZhciBwYXJ0aWFsQ2h1bmtIZWlnaHQgPSBoZWlnaHQgJSBGVUxMX0NIVU5LX0hFSUdIVDsKICAgICAgICB2YXIgZnVsbENodW5rcyA9IChoZWlnaHQgLSBwYXJ0aWFsQ2h1bmtIZWlnaHQpIC8gRlVMTF9DSFVOS19IRUlHSFQ7CiAgICAgICAgdmFyIHRvdGFsQ2h1bmtzID0gcGFydGlhbENodW5rSGVpZ2h0ID09PSAwID8gZnVsbENodW5rcyA6IGZ1bGxDaHVua3MgKyAxOwogICAgICAgIHZhciBjaHVua0ltZ0RhdGEgPSBjdHguY3JlYXRlSW1hZ2VEYXRhKHdpZHRoLCBGVUxMX0NIVU5LX0hFSUdIVCk7CiAgICAgICAgdmFyIHNyY1BvcyA9IDAsCiAgICAgICAgICBkZXN0UG9zOwogICAgICAgIHZhciBzcmMgPSBpbWdEYXRhLmRhdGE7CiAgICAgICAgdmFyIGRlc3QgPSBjaHVua0ltZ0RhdGEuZGF0YTsKICAgICAgICB2YXIgaSwgaiwgdGhpc0NodW5rSGVpZ2h0LCBlbGVtc0luVGhpc0NodW5rOwoKICAgICAgICBpZiAoaW1nRGF0YS5raW5kID09PSBfdXRpbC5JbWFnZUtpbmQuR1JBWVNDQUxFXzFCUFApIHsKICAgICAgICAgIHZhciBzcmNMZW5ndGggPSBzcmMuYnl0ZUxlbmd0aDsKICAgICAgICAgIHZhciBkZXN0MzIgPSBuZXcgVWludDMyQXJyYXkoZGVzdC5idWZmZXIsIDAsIGRlc3QuYnl0ZUxlbmd0aCA+PiAyKTsKICAgICAgICAgIHZhciBkZXN0MzJEYXRhTGVuZ3RoID0gZGVzdDMyLmxlbmd0aDsKICAgICAgICAgIHZhciBmdWxsU3JjRGlmZiA9IHdpZHRoICsgNyA+PiAzOwogICAgICAgICAgdmFyIHdoaXRlID0gMHhmZmZmZmZmZjsKICAgICAgICAgIHZhciBibGFjayA9IF91dGlsLklzTGl0dGxlRW5kaWFuQ2FjaGVkLnZhbHVlID8gMHhmZjAwMDAwMCA6IDB4MDAwMDAwZmY7CgogICAgICAgICAgZm9yIChpID0gMDsgaSA8IHRvdGFsQ2h1bmtzOyBpKyspIHsKICAgICAgICAgICAgdGhpc0NodW5rSGVpZ2h0ID0gaSA8IGZ1bGxDaHVua3MgPyBGVUxMX0NIVU5LX0hFSUdIVCA6IHBhcnRpYWxDaHVua0hlaWdodDsKICAgICAgICAgICAgZGVzdFBvcyA9IDA7CgogICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgdGhpc0NodW5rSGVpZ2h0OyBqKyspIHsKICAgICAgICAgICAgICB2YXIgc3JjRGlmZiA9IHNyY0xlbmd0aCAtIHNyY1BvczsKICAgICAgICAgICAgICB2YXIgayA9IDA7CiAgICAgICAgICAgICAgdmFyIGtFbmQgPSBzcmNEaWZmID4gZnVsbFNyY0RpZmYgPyB3aWR0aCA6IHNyY0RpZmYgKiA4IC0gNzsKICAgICAgICAgICAgICB2YXIga0VuZFVucm9sbGVkID0ga0VuZCAmIH43OwogICAgICAgICAgICAgIHZhciBtYXNrID0gMDsKICAgICAgICAgICAgICB2YXIgc3JjQnl0ZSA9IDA7CgogICAgICAgICAgICAgIGZvciAoOyBrIDwga0VuZFVucm9sbGVkOyBrICs9IDgpIHsKICAgICAgICAgICAgICAgIHNyY0J5dGUgPSBzcmNbc3JjUG9zKytdOwogICAgICAgICAgICAgICAgZGVzdDMyW2Rlc3RQb3MrK10gPSBzcmNCeXRlICYgMTI4ID8gd2hpdGUgOiBibGFjazsKICAgICAgICAgICAgICAgIGRlc3QzMltkZXN0UG9zKytdID0gc3JjQnl0ZSAmIDY0ID8gd2hpdGUgOiBibGFjazsKICAgICAgICAgICAgICAgIGRlc3QzMltkZXN0UG9zKytdID0gc3JjQnl0ZSAmIDMyID8gd2hpdGUgOiBibGFjazsKICAgICAgICAgICAgICAgIGRlc3QzMltkZXN0UG9zKytdID0gc3JjQnl0ZSAmIDE2ID8gd2hpdGUgOiBibGFjazsKICAgICAgICAgICAgICAgIGRlc3QzMltkZXN0UG9zKytdID0gc3JjQnl0ZSAmIDggPyB3aGl0ZSA6IGJsYWNrOwogICAgICAgICAgICAgICAgZGVzdDMyW2Rlc3RQb3MrK10gPSBzcmNCeXRlICYgNCA/IHdoaXRlIDogYmxhY2s7CiAgICAgICAgICAgICAgICBkZXN0MzJbZGVzdFBvcysrXSA9IHNyY0J5dGUgJiAyID8gd2hpdGUgOiBibGFjazsKICAgICAgICAgICAgICAgIGRlc3QzMltkZXN0UG9zKytdID0gc3JjQnl0ZSAmIDEgPyB3aGl0ZSA6IGJsYWNrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZm9yICg7IGsgPCBrRW5kOyBrKyspIHsKICAgICAgICAgICAgICAgIGlmIChtYXNrID09PSAwKSB7CiAgICAgICAgICAgICAgICAgIHNyY0J5dGUgPSBzcmNbc3JjUG9zKytdOwogICAgICAgICAgICAgICAgICBtYXNrID0gMTI4OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGRlc3QzMltkZXN0UG9zKytdID0gc3JjQnl0ZSAmIG1hc2sgPyB3aGl0ZSA6IGJsYWNrOwogICAgICAgICAgICAgICAgbWFzayA+Pj0gMTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdoaWxlIChkZXN0UG9zIDwgZGVzdDMyRGF0YUxlbmd0aCkgewogICAgICAgICAgICAgIGRlc3QzMltkZXN0UG9zKytdID0gMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY3R4LnB1dEltYWdlRGF0YShjaHVua0ltZ0RhdGEsIDAsIGkgKiBGVUxMX0NIVU5LX0hFSUdIVCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChpbWdEYXRhLmtpbmQgPT09IF91dGlsLkltYWdlS2luZC5SR0JBXzMyQlBQKSB7CiAgICAgICAgICBqID0gMDsKICAgICAgICAgIGVsZW1zSW5UaGlzQ2h1bmsgPSB3aWR0aCAqIEZVTExfQ0hVTktfSEVJR0hUICogNDsKCiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZnVsbENodW5rczsgaSsrKSB7CiAgICAgICAgICAgIGRlc3Quc2V0KHNyYy5zdWJhcnJheShzcmNQb3MsIHNyY1BvcyArIGVsZW1zSW5UaGlzQ2h1bmspKTsKICAgICAgICAgICAgc3JjUG9zICs9IGVsZW1zSW5UaGlzQ2h1bms7CiAgICAgICAgICAgIGN0eC5wdXRJbWFnZURhdGEoY2h1bmtJbWdEYXRhLCAwLCBqKTsKICAgICAgICAgICAgaiArPSBGVUxMX0NIVU5LX0hFSUdIVDsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoaSA8IHRvdGFsQ2h1bmtzKSB7CiAgICAgICAgICAgIGVsZW1zSW5UaGlzQ2h1bmsgPSB3aWR0aCAqIHBhcnRpYWxDaHVua0hlaWdodCAqIDQ7CiAgICAgICAgICAgIGRlc3Quc2V0KHNyYy5zdWJhcnJheShzcmNQb3MsIHNyY1BvcyArIGVsZW1zSW5UaGlzQ2h1bmspKTsKICAgICAgICAgICAgY3R4LnB1dEltYWdlRGF0YShjaHVua0ltZ0RhdGEsIDAsIGopOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoaW1nRGF0YS5raW5kID09PSBfdXRpbC5JbWFnZUtpbmQuUkdCXzI0QlBQKSB7CiAgICAgICAgICB0aGlzQ2h1bmtIZWlnaHQgPSBGVUxMX0NIVU5LX0hFSUdIVDsKICAgICAgICAgIGVsZW1zSW5UaGlzQ2h1bmsgPSB3aWR0aCAqIHRoaXNDaHVua0hlaWdodDsKCiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdG90YWxDaHVua3M7IGkrKykgewogICAgICAgICAgICBpZiAoaSA+PSBmdWxsQ2h1bmtzKSB7CiAgICAgICAgICAgICAgdGhpc0NodW5rSGVpZ2h0ID0gcGFydGlhbENodW5rSGVpZ2h0OwogICAgICAgICAgICAgIGVsZW1zSW5UaGlzQ2h1bmsgPSB3aWR0aCAqIHRoaXNDaHVua0hlaWdodDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZGVzdFBvcyA9IDA7CgogICAgICAgICAgICBmb3IgKGogPSBlbGVtc0luVGhpc0NodW5rOyBqLS07KSB7CiAgICAgICAgICAgICAgZGVzdFtkZXN0UG9zKytdID0gc3JjW3NyY1BvcysrXTsKICAgICAgICAgICAgICBkZXN0W2Rlc3RQb3MrK10gPSBzcmNbc3JjUG9zKytdOwogICAgICAgICAgICAgIGRlc3RbZGVzdFBvcysrXSA9IHNyY1tzcmNQb3MrK107CiAgICAgICAgICAgICAgZGVzdFtkZXN0UG9zKytdID0gMjU1OwogICAgICAgICAgICB9CgogICAgICAgICAgICBjdHgucHV0SW1hZ2VEYXRhKGNodW5rSW1nRGF0YSwgMCwgaSAqIEZVTExfQ0hVTktfSEVJR0hUKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJiYWQgaW1hZ2Uga2luZDogIi5jb25jYXQoaW1nRGF0YS5raW5kKSk7CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBwdXRCaW5hcnlJbWFnZU1hc2soY3R4LCBpbWdEYXRhKSB7CiAgICAgICAgdmFyIGhlaWdodCA9IGltZ0RhdGEuaGVpZ2h0LAogICAgICAgICAgd2lkdGggPSBpbWdEYXRhLndpZHRoOwogICAgICAgIHZhciBwYXJ0aWFsQ2h1bmtIZWlnaHQgPSBoZWlnaHQgJSBGVUxMX0NIVU5LX0hFSUdIVDsKICAgICAgICB2YXIgZnVsbENodW5rcyA9IChoZWlnaHQgLSBwYXJ0aWFsQ2h1bmtIZWlnaHQpIC8gRlVMTF9DSFVOS19IRUlHSFQ7CiAgICAgICAgdmFyIHRvdGFsQ2h1bmtzID0gcGFydGlhbENodW5rSGVpZ2h0ID09PSAwID8gZnVsbENodW5rcyA6IGZ1bGxDaHVua3MgKyAxOwogICAgICAgIHZhciBjaHVua0ltZ0RhdGEgPSBjdHguY3JlYXRlSW1hZ2VEYXRhKHdpZHRoLCBGVUxMX0NIVU5LX0hFSUdIVCk7CiAgICAgICAgdmFyIHNyY1BvcyA9IDA7CiAgICAgICAgdmFyIHNyYyA9IGltZ0RhdGEuZGF0YTsKICAgICAgICB2YXIgZGVzdCA9IGNodW5rSW1nRGF0YS5kYXRhOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRvdGFsQ2h1bmtzOyBpKyspIHsKICAgICAgICAgIHZhciB0aGlzQ2h1bmtIZWlnaHQgPSBpIDwgZnVsbENodW5rcyA/IEZVTExfQ0hVTktfSEVJR0hUIDogcGFydGlhbENodW5rSGVpZ2h0OwogICAgICAgICAgdmFyIGRlc3RQb3MgPSAzOwoKICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgdGhpc0NodW5rSGVpZ2h0OyBqKyspIHsKICAgICAgICAgICAgdmFyIG1hc2sgPSAwOwoKICAgICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCB3aWR0aDsgaysrKSB7CiAgICAgICAgICAgICAgaWYgKCFtYXNrKSB7CiAgICAgICAgICAgICAgICB2YXIgZWxlbSA9IHNyY1tzcmNQb3MrK107CiAgICAgICAgICAgICAgICBtYXNrID0gMTI4OwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZGVzdFtkZXN0UG9zXSA9IGVsZW0gJiBtYXNrID8gMCA6IDI1NTsKICAgICAgICAgICAgICBkZXN0UG9zICs9IDQ7CiAgICAgICAgICAgICAgbWFzayA+Pj0gMTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGN0eC5wdXRJbWFnZURhdGEoY2h1bmtJbWdEYXRhLCAwLCBpICogRlVMTF9DSFVOS19IRUlHSFQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZnVuY3Rpb24gY29weUN0eFN0YXRlKHNvdXJjZUN0eCwgZGVzdEN0eCkgewogICAgICAgIHZhciBwcm9wZXJ0aWVzID0gWyJzdHJva2VTdHlsZSIsICJmaWxsU3R5bGUiLCAiZmlsbFJ1bGUiLCAiZ2xvYmFsQWxwaGEiLCAibGluZVdpZHRoIiwgImxpbmVDYXAiLCAibGluZUpvaW4iLCAibWl0ZXJMaW1pdCIsICJnbG9iYWxDb21wb3NpdGVPcGVyYXRpb24iLCAiZm9udCJdOwoKICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBwcm9wZXJ0aWVzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgIHZhciBwcm9wZXJ0eSA9IHByb3BlcnRpZXNbaV07CgogICAgICAgICAgaWYgKHNvdXJjZUN0eFtwcm9wZXJ0eV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBkZXN0Q3R4W3Byb3BlcnR5XSA9IHNvdXJjZUN0eFtwcm9wZXJ0eV07CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoc291cmNlQ3R4LnNldExpbmVEYXNoICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGRlc3RDdHguc2V0TGluZURhc2goc291cmNlQ3R4LmdldExpbmVEYXNoKCkpOwogICAgICAgICAgZGVzdEN0eC5saW5lRGFzaE9mZnNldCA9IHNvdXJjZUN0eC5saW5lRGFzaE9mZnNldDsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHJlc2V0Q3R4VG9EZWZhdWx0KGN0eCkgewogICAgICAgIGN0eC5zdHJva2VTdHlsZSA9ICIjMDAwMDAwIjsKICAgICAgICBjdHguZmlsbFN0eWxlID0gIiMwMDAwMDAiOwogICAgICAgIGN0eC5maWxsUnVsZSA9ICJub256ZXJvIjsKICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxOwogICAgICAgIGN0eC5saW5lV2lkdGggPSAxOwogICAgICAgIGN0eC5saW5lQ2FwID0gImJ1dHQiOwogICAgICAgIGN0eC5saW5lSm9pbiA9ICJtaXRlciI7CiAgICAgICAgY3R4Lm1pdGVyTGltaXQgPSAxMDsKICAgICAgICBjdHguZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gInNvdXJjZS1vdmVyIjsKICAgICAgICBjdHguZm9udCA9ICIxMHB4IHNhbnMtc2VyaWYiOwoKICAgICAgICBpZiAoY3R4LnNldExpbmVEYXNoICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGN0eC5zZXRMaW5lRGFzaChbXSk7CiAgICAgICAgICBjdHgubGluZURhc2hPZmZzZXQgPSAwOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZnVuY3Rpb24gY29tcG9zZVNNYXNrQmFja2Ryb3AoYnl0ZXMsIHIwLCBnMCwgYjApIHsKICAgICAgICB2YXIgbGVuZ3RoID0gYnl0ZXMubGVuZ3RoOwoKICAgICAgICBmb3IgKHZhciBpID0gMzsgaSA8IGxlbmd0aDsgaSArPSA0KSB7CiAgICAgICAgICB2YXIgYWxwaGEgPSBieXRlc1tpXTsKCiAgICAgICAgICBpZiAoYWxwaGEgPT09IDApIHsKICAgICAgICAgICAgYnl0ZXNbaSAtIDNdID0gcjA7CiAgICAgICAgICAgIGJ5dGVzW2kgLSAyXSA9IGcwOwogICAgICAgICAgICBieXRlc1tpIC0gMV0gPSBiMDsKICAgICAgICAgIH0gZWxzZSBpZiAoYWxwaGEgPCAyNTUpIHsKICAgICAgICAgICAgdmFyIGFscGhhXyA9IDI1NSAtIGFscGhhOwogICAgICAgICAgICBieXRlc1tpIC0gM10gPSBieXRlc1tpIC0gM10gKiBhbHBoYSArIHIwICogYWxwaGFfID4+IDg7CiAgICAgICAgICAgIGJ5dGVzW2kgLSAyXSA9IGJ5dGVzW2kgLSAyXSAqIGFscGhhICsgZzAgKiBhbHBoYV8gPj4gODsKICAgICAgICAgICAgYnl0ZXNbaSAtIDFdID0gYnl0ZXNbaSAtIDFdICogYWxwaGEgKyBiMCAqIGFscGhhXyA+PiA4OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgZnVuY3Rpb24gY29tcG9zZVNNYXNrQWxwaGEobWFza0RhdGEsIGxheWVyRGF0YSwgdHJhbnNmZXJNYXApIHsKICAgICAgICB2YXIgbGVuZ3RoID0gbWFza0RhdGEubGVuZ3RoOwogICAgICAgIHZhciBzY2FsZSA9IDEgLyAyNTU7CgogICAgICAgIGZvciAodmFyIGkgPSAzOyBpIDwgbGVuZ3RoOyBpICs9IDQpIHsKICAgICAgICAgIHZhciBhbHBoYSA9IHRyYW5zZmVyTWFwID8gdHJhbnNmZXJNYXBbbWFza0RhdGFbaV1dIDogbWFza0RhdGFbaV07CiAgICAgICAgICBsYXllckRhdGFbaV0gPSBsYXllckRhdGFbaV0gKiBhbHBoYSAqIHNjYWxlIHwgMDsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGNvbXBvc2VTTWFza0x1bWlub3NpdHkobWFza0RhdGEsIGxheWVyRGF0YSwgdHJhbnNmZXJNYXApIHsKICAgICAgICB2YXIgbGVuZ3RoID0gbWFza0RhdGEubGVuZ3RoOwoKICAgICAgICBmb3IgKHZhciBpID0gMzsgaSA8IGxlbmd0aDsgaSArPSA0KSB7CiAgICAgICAgICB2YXIgeSA9IG1hc2tEYXRhW2kgLSAzXSAqIDc3ICsgbWFza0RhdGFbaSAtIDJdICogMTUyICsgbWFza0RhdGFbaSAtIDFdICogMjg7CiAgICAgICAgICBsYXllckRhdGFbaV0gPSB0cmFuc2Zlck1hcCA/IGxheWVyRGF0YVtpXSAqIHRyYW5zZmVyTWFwW3kgPj4gOF0gPj4gOCA6IGxheWVyRGF0YVtpXSAqIHkgPj4gMTY7CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBnZW5lcmljQ29tcG9zZVNNYXNrKG1hc2tDdHgsIGxheWVyQ3R4LCB3aWR0aCwgaGVpZ2h0LCBzdWJ0eXBlLCBiYWNrZHJvcCwgdHJhbnNmZXJNYXApIHsKICAgICAgICB2YXIgaGFzQmFja2Ryb3AgPSAhIWJhY2tkcm9wOwogICAgICAgIHZhciByMCA9IGhhc0JhY2tkcm9wID8gYmFja2Ryb3BbMF0gOiAwOwogICAgICAgIHZhciBnMCA9IGhhc0JhY2tkcm9wID8gYmFja2Ryb3BbMV0gOiAwOwogICAgICAgIHZhciBiMCA9IGhhc0JhY2tkcm9wID8gYmFja2Ryb3BbMl0gOiAwOwogICAgICAgIHZhciBjb21wb3NlRm47CgogICAgICAgIGlmIChzdWJ0eXBlID09PSAiTHVtaW5vc2l0eSIpIHsKICAgICAgICAgIGNvbXBvc2VGbiA9IGNvbXBvc2VTTWFza0x1bWlub3NpdHk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbXBvc2VGbiA9IGNvbXBvc2VTTWFza0FscGhhOwogICAgICAgIH0KCiAgICAgICAgdmFyIFBJWEVMU19UT19QUk9DRVNTID0gMTA0ODU3NjsKICAgICAgICB2YXIgY2h1bmtTaXplID0gTWF0aC5taW4oaGVpZ2h0LCBNYXRoLmNlaWwoUElYRUxTX1RPX1BST0NFU1MgLyB3aWR0aCkpOwoKICAgICAgICBmb3IgKHZhciByb3cgPSAwOyByb3cgPCBoZWlnaHQ7IHJvdyArPSBjaHVua1NpemUpIHsKICAgICAgICAgIHZhciBjaHVua0hlaWdodCA9IE1hdGgubWluKGNodW5rU2l6ZSwgaGVpZ2h0IC0gcm93KTsKICAgICAgICAgIHZhciBtYXNrRGF0YSA9IG1hc2tDdHguZ2V0SW1hZ2VEYXRhKDAsIHJvdywgd2lkdGgsIGNodW5rSGVpZ2h0KTsKICAgICAgICAgIHZhciBsYXllckRhdGEgPSBsYXllckN0eC5nZXRJbWFnZURhdGEoMCwgcm93LCB3aWR0aCwgY2h1bmtIZWlnaHQpOwoKICAgICAgICAgIGlmIChoYXNCYWNrZHJvcCkgewogICAgICAgICAgICBjb21wb3NlU01hc2tCYWNrZHJvcChtYXNrRGF0YS5kYXRhLCByMCwgZzAsIGIwKTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb21wb3NlRm4obWFza0RhdGEuZGF0YSwgbGF5ZXJEYXRhLmRhdGEsIHRyYW5zZmVyTWFwKTsKICAgICAgICAgIG1hc2tDdHgucHV0SW1hZ2VEYXRhKGxheWVyRGF0YSwgMCwgcm93KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGNvbXBvc2VTTWFzayhjdHgsIHNtYXNrLCBsYXllckN0eCwgd2ViR0xDb250ZXh0KSB7CiAgICAgICAgdmFyIG1hc2sgPSBzbWFzay5jYW52YXM7CiAgICAgICAgdmFyIG1hc2tDdHggPSBzbWFzay5jb250ZXh0OwogICAgICAgIGN0eC5zZXRUcmFuc2Zvcm0oc21hc2suc2NhbGVYLCAwLCAwLCBzbWFzay5zY2FsZVksIHNtYXNrLm9mZnNldFgsIHNtYXNrLm9mZnNldFkpOwogICAgICAgIHZhciBiYWNrZHJvcCA9IHNtYXNrLmJhY2tkcm9wIHx8IG51bGw7CgogICAgICAgIGlmICghc21hc2sudHJhbnNmZXJNYXAgJiYgd2ViR0xDb250ZXh0LmlzRW5hYmxlZCkgewogICAgICAgICAgdmFyIGNvbXBvc2VkID0gd2ViR0xDb250ZXh0LmNvbXBvc2VTTWFzayh7CiAgICAgICAgICAgIGxheWVyOiBsYXllckN0eC5jYW52YXMsCiAgICAgICAgICAgIG1hc2s6IG1hc2ssCiAgICAgICAgICAgIHByb3BlcnRpZXM6IHsKICAgICAgICAgICAgICBzdWJ0eXBlOiBzbWFzay5zdWJ0eXBlLAogICAgICAgICAgICAgIGJhY2tkcm9wOiBiYWNrZHJvcAogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIGN0eC5zZXRUcmFuc2Zvcm0oMSwgMCwgMCwgMSwgMCwgMCk7CiAgICAgICAgICBjdHguZHJhd0ltYWdlKGNvbXBvc2VkLCBzbWFzay5vZmZzZXRYLCBzbWFzay5vZmZzZXRZKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGdlbmVyaWNDb21wb3NlU01hc2sobWFza0N0eCwgbGF5ZXJDdHgsIG1hc2sud2lkdGgsIG1hc2suaGVpZ2h0LCBzbWFzay5zdWJ0eXBlLCBiYWNrZHJvcCwgc21hc2sudHJhbnNmZXJNYXApOwogICAgICAgIGN0eC5kcmF3SW1hZ2UobWFzaywgMCwgMCk7CiAgICAgIH0KCiAgICAgIHZhciBMSU5FX0NBUF9TVFlMRVMgPSBbImJ1dHQiLCAicm91bmQiLCAic3F1YXJlIl07CiAgICAgIHZhciBMSU5FX0pPSU5fU1RZTEVTID0gWyJtaXRlciIsICJyb3VuZCIsICJiZXZlbCJdOwogICAgICB2YXIgTk9STUFMX0NMSVAgPSB7fTsKICAgICAgdmFyIEVPX0NMSVAgPSB7fTsKICAgICAgQ2FudmFzR3JhcGhpY3MucHJvdG90eXBlID0gewogICAgICAgIGJlZ2luRHJhd2luZzogZnVuY3Rpb24gYmVnaW5EcmF3aW5nKF9yZWYpIHsKICAgICAgICAgIHZhciB0cmFuc2Zvcm0gPSBfcmVmLnRyYW5zZm9ybSwKICAgICAgICAgICAgdmlld3BvcnQgPSBfcmVmLnZpZXdwb3J0LAogICAgICAgICAgICBfcmVmJHRyYW5zcGFyZW5jeSA9IF9yZWYudHJhbnNwYXJlbmN5LAogICAgICAgICAgICB0cmFuc3BhcmVuY3kgPSBfcmVmJHRyYW5zcGFyZW5jeSA9PT0gdm9pZCAwID8gZmFsc2UgOiBfcmVmJHRyYW5zcGFyZW5jeSwKICAgICAgICAgICAgX3JlZiRiYWNrZ3JvdW5kID0gX3JlZi5iYWNrZ3JvdW5kLAogICAgICAgICAgICBiYWNrZ3JvdW5kID0gX3JlZiRiYWNrZ3JvdW5kID09PSB2b2lkIDAgPyBudWxsIDogX3JlZiRiYWNrZ3JvdW5kOwogICAgICAgICAgdmFyIHdpZHRoID0gdGhpcy5jdHguY2FudmFzLndpZHRoOwogICAgICAgICAgdmFyIGhlaWdodCA9IHRoaXMuY3R4LmNhbnZhcy5oZWlnaHQ7CiAgICAgICAgICB0aGlzLmN0eC5zYXZlKCk7CiAgICAgICAgICB0aGlzLmN0eC5maWxsU3R5bGUgPSBiYWNrZ3JvdW5kIHx8ICJyZ2IoMjU1LCAyNTUsIDI1NSkiOwogICAgICAgICAgdGhpcy5jdHguZmlsbFJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICB0aGlzLmN0eC5yZXN0b3JlKCk7CgogICAgICAgICAgaWYgKHRyYW5zcGFyZW5jeSkgewogICAgICAgICAgICB2YXIgdHJhbnNwYXJlbnRDYW52YXMgPSB0aGlzLmNhY2hlZENhbnZhc2VzLmdldENhbnZhcygidHJhbnNwYXJlbnQiLCB3aWR0aCwgaGVpZ2h0LCB0cnVlKTsKICAgICAgICAgICAgdGhpcy5jb21wb3NpdGVDdHggPSB0aGlzLmN0eDsKICAgICAgICAgICAgdGhpcy50cmFuc3BhcmVudENhbnZhcyA9IHRyYW5zcGFyZW50Q2FudmFzLmNhbnZhczsKICAgICAgICAgICAgdGhpcy5jdHggPSB0cmFuc3BhcmVudENhbnZhcy5jb250ZXh0OwogICAgICAgICAgICB0aGlzLmN0eC5zYXZlKCk7CiAgICAgICAgICAgIHRoaXMuY3R4LnRyYW5zZm9ybS5hcHBseSh0aGlzLmN0eCwgdGhpcy5jb21wb3NpdGVDdHgubW96Q3VycmVudFRyYW5zZm9ybSk7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5jdHguc2F2ZSgpOwogICAgICAgICAgcmVzZXRDdHhUb0RlZmF1bHQodGhpcy5jdHgpOwoKICAgICAgICAgIGlmICh0cmFuc2Zvcm0pIHsKICAgICAgICAgICAgdGhpcy5jdHgudHJhbnNmb3JtLmFwcGx5KHRoaXMuY3R4LCB0cmFuc2Zvcm0pOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuY3R4LnRyYW5zZm9ybS5hcHBseSh0aGlzLmN0eCwgdmlld3BvcnQudHJhbnNmb3JtKTsKICAgICAgICAgIHRoaXMuYmFzZVRyYW5zZm9ybSA9IHRoaXMuY3R4Lm1vekN1cnJlbnRUcmFuc2Zvcm0uc2xpY2UoKTsKCiAgICAgICAgICBpZiAodGhpcy5pbWFnZUxheWVyKSB7CiAgICAgICAgICAgIHRoaXMuaW1hZ2VMYXllci5iZWdpbkxheW91dCgpOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgZXhlY3V0ZU9wZXJhdG9yTGlzdDogZnVuY3Rpb24gQ2FudmFzR3JhcGhpY3NfZXhlY3V0ZU9wZXJhdG9yTGlzdChvcGVyYXRvckxpc3QsIGV4ZWN1dGlvblN0YXJ0SWR4LCBjb250aW51ZUNhbGxiYWNrLCBzdGVwcGVyKSB7CiAgICAgICAgICB2YXIgYXJnc0FycmF5ID0gb3BlcmF0b3JMaXN0LmFyZ3NBcnJheTsKICAgICAgICAgIHZhciBmbkFycmF5ID0gb3BlcmF0b3JMaXN0LmZuQXJyYXk7CiAgICAgICAgICB2YXIgaSA9IGV4ZWN1dGlvblN0YXJ0SWR4IHx8IDA7CiAgICAgICAgICB2YXIgYXJnc0FycmF5TGVuID0gYXJnc0FycmF5Lmxlbmd0aDsKCiAgICAgICAgICBpZiAoYXJnc0FycmF5TGVuID09PSBpKSB7CiAgICAgICAgICAgIHJldHVybiBpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBjaHVua09wZXJhdGlvbnMgPSBhcmdzQXJyYXlMZW4gLSBpID4gRVhFQ1VUSU9OX1NURVBTICYmIHR5cGVvZiBjb250aW51ZUNhbGxiYWNrID09PSAiZnVuY3Rpb24iOwogICAgICAgICAgdmFyIGVuZFRpbWUgPSBjaHVua09wZXJhdGlvbnMgPyBEYXRlLm5vdygpICsgRVhFQ1VUSU9OX1RJTUUgOiAwOwogICAgICAgICAgdmFyIHN0ZXBzID0gMDsKICAgICAgICAgIHZhciBjb21tb25PYmpzID0gdGhpcy5jb21tb25PYmpzOwogICAgICAgICAgdmFyIG9ianMgPSB0aGlzLm9ianM7CiAgICAgICAgICB2YXIgZm5JZDsKCiAgICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgICBpZiAoc3RlcHBlciAhPT0gdW5kZWZpbmVkICYmIGkgPT09IHN0ZXBwZXIubmV4dEJyZWFrUG9pbnQpIHsKICAgICAgICAgICAgICBzdGVwcGVyLmJyZWFrSXQoaSwgY29udGludWVDYWxsYmFjayk7CiAgICAgICAgICAgICAgcmV0dXJuIGk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZuSWQgPSBmbkFycmF5W2ldOwoKICAgICAgICAgICAgaWYgKGZuSWQgIT09IF91dGlsLk9QUy5kZXBlbmRlbmN5KSB7CiAgICAgICAgICAgICAgdGhpc1tmbklkXS5hcHBseSh0aGlzLCBhcmdzQXJyYXlbaV0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHZhciBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gdHJ1ZTsKICAgICAgICAgICAgICB2YXIgX2RpZEl0ZXJhdG9yRXJyb3IgPSBmYWxzZTsKICAgICAgICAgICAgICB2YXIgX2l0ZXJhdG9yRXJyb3IgPSB1bmRlZmluZWQ7CgogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBfaXRlcmF0b3IgPSBhcmdzQXJyYXlbaV1bU3ltYm9sLml0ZXJhdG9yXSgpLCBfc3RlcDsgIShfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gKF9zdGVwID0gX2l0ZXJhdG9yLm5leHQoKSkuZG9uZSk7IF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgIHZhciBkZXBPYmpJZCA9IF9zdGVwLnZhbHVlOwogICAgICAgICAgICAgICAgICB2YXIgb2Jqc1Bvb2wgPSBkZXBPYmpJZC5zdGFydHNXaXRoKCJnXyIpID8gY29tbW9uT2JqcyA6IG9ianM7CgogICAgICAgICAgICAgICAgICBpZiAoIW9ianNQb29sLmhhcyhkZXBPYmpJZCkpIHsKICAgICAgICAgICAgICAgICAgICBvYmpzUG9vbC5nZXQoZGVwT2JqSWQsIGNvbnRpbnVlQ2FsbGJhY2spOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvciA9IHRydWU7CiAgICAgICAgICAgICAgICBfaXRlcmF0b3JFcnJvciA9IGVycjsKICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgaWYgKCFfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uICYmIF9pdGVyYXRvclsicmV0dXJuIl0gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIF9pdGVyYXRvclsicmV0dXJuIl0oKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgaWYgKF9kaWRJdGVyYXRvckVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3I7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGkrKzsKCiAgICAgICAgICAgIGlmIChpID09PSBhcmdzQXJyYXlMZW4pIHsKICAgICAgICAgICAgICByZXR1cm4gaTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGNodW5rT3BlcmF0aW9ucyAmJiArK3N0ZXBzID4gRVhFQ1VUSU9OX1NURVBTKSB7CiAgICAgICAgICAgICAgaWYgKERhdGUubm93KCkgPiBlbmRUaW1lKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZUNhbGxiYWNrKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gaTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHN0ZXBzID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgZW5kRHJhd2luZzogZnVuY3Rpb24gQ2FudmFzR3JhcGhpY3NfZW5kRHJhd2luZygpIHsKICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnQuYWN0aXZlU01hc2sgIT09IG51bGwpIHsKICAgICAgICAgICAgdGhpcy5lbmRTTWFza0dyb3VwKCk7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5jdHgucmVzdG9yZSgpOwoKICAgICAgICAgIGlmICh0aGlzLnRyYW5zcGFyZW50Q2FudmFzKSB7CiAgICAgICAgICAgIHRoaXMuY3R4ID0gdGhpcy5jb21wb3NpdGVDdHg7CiAgICAgICAgICAgIHRoaXMuY3R4LnNhdmUoKTsKICAgICAgICAgICAgdGhpcy5jdHguc2V0VHJhbnNmb3JtKDEsIDAsIDAsIDEsIDAsIDApOwogICAgICAgICAgICB0aGlzLmN0eC5kcmF3SW1hZ2UodGhpcy50cmFuc3BhcmVudENhbnZhcywgMCwgMCk7CiAgICAgICAgICAgIHRoaXMuY3R4LnJlc3RvcmUoKTsKICAgICAgICAgICAgdGhpcy50cmFuc3BhcmVudENhbnZhcyA9IG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5jYWNoZWRDYW52YXNlcy5jbGVhcigpOwogICAgICAgICAgdGhpcy53ZWJHTENvbnRleHQuY2xlYXIoKTsKCiAgICAgICAgICBpZiAodGhpcy5pbWFnZUxheWVyKSB7CiAgICAgICAgICAgIHRoaXMuaW1hZ2VMYXllci5lbmRMYXlvdXQoKTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHNldExpbmVXaWR0aDogZnVuY3Rpb24gQ2FudmFzR3JhcGhpY3Nfc2V0TGluZVdpZHRoKHdpZHRoKSB7CiAgICAgICAgICB0aGlzLmN1cnJlbnQubGluZVdpZHRoID0gd2lkdGg7CiAgICAgICAgICB0aGlzLmN0eC5saW5lV2lkdGggPSB3aWR0aDsKICAgICAgICB9LAogICAgICAgIHNldExpbmVDYXA6IGZ1bmN0aW9uIENhbnZhc0dyYXBoaWNzX3NldExpbmVDYXAoc3R5bGUpIHsKICAgICAgICAgIHRoaXMuY3R4LmxpbmVDYXAgPSBMSU5FX0NBUF9TVFlMRVNbc3R5bGVdOwogICAgICAgIH0sCiAgICAgICAgc2V0TGluZUpvaW46IGZ1bmN0aW9uIENhbnZhc0dyYXBoaWNzX3NldExpbmVKb2luKHN0eWxlKSB7CiAgICAgICAgICB0aGlzLmN0eC5saW5lSm9pbiA9IExJTkVfSk9JTl9TVFlMRVNbc3R5bGVdOwogICAgICAgIH0sCiAgICAgICAgc2V0TWl0ZXJMaW1pdDogZnVuY3Rpb24gQ2FudmFzR3JhcGhpY3Nfc2V0TWl0ZXJMaW1pdChsaW1pdCkgewogICAgICAgICAgdGhpcy5jdHgubWl0ZXJMaW1pdCA9IGxpbWl0OwogICAgICAgIH0sCiAgICAgICAgc2V0RGFzaDogZnVuY3Rpb24gQ2FudmFzR3JhcGhpY3Nfc2V0RGFzaChkYXNoQXJyYXksIGRhc2hQaGFzZSkgewogICAgICAgICAgdmFyIGN0eCA9IHRoaXMuY3R4OwoKICAgICAgICAgIGlmIChjdHguc2V0TGluZURhc2ggIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjdHguc2V0TGluZURhc2goZGFzaEFycmF5KTsKICAgICAgICAgICAgY3R4LmxpbmVEYXNoT2Zmc2V0ID0gZGFzaFBoYXNlOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgc2V0UmVuZGVyaW5nSW50ZW50OiBmdW5jdGlvbiBzZXRSZW5kZXJpbmdJbnRlbnQoaW50ZW50KSB7fSwKICAgICAgICBzZXRGbGF0bmVzczogZnVuY3Rpb24gc2V0RmxhdG5lc3MoZmxhdG5lc3MpIHt9LAogICAgICAgIHNldEdTdGF0ZTogZnVuY3Rpb24gQ2FudmFzR3JhcGhpY3Nfc2V0R1N0YXRlKHN0YXRlcykgewogICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gc3RhdGVzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgdmFyIHN0YXRlID0gc3RhdGVzW2ldOwogICAgICAgICAgICB2YXIga2V5ID0gc3RhdGVbMF07CiAgICAgICAgICAgIHZhciB2YWx1ZSA9IHN0YXRlWzFdOwoKICAgICAgICAgICAgc3dpdGNoIChrZXkpIHsKICAgICAgICAgICAgICBjYXNlICJMVyI6CiAgICAgICAgICAgICAgICB0aGlzLnNldExpbmVXaWR0aCh2YWx1ZSk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAiTEMiOgogICAgICAgICAgICAgICAgdGhpcy5zZXRMaW5lQ2FwKHZhbHVlKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICJMSiI6CiAgICAgICAgICAgICAgICB0aGlzLnNldExpbmVKb2luKHZhbHVlKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICJNTCI6CiAgICAgICAgICAgICAgICB0aGlzLnNldE1pdGVyTGltaXQodmFsdWUpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgIkQiOgogICAgICAgICAgICAgICAgdGhpcy5zZXREYXNoKHZhbHVlWzBdLCB2YWx1ZVsxXSk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAiUkkiOgogICAgICAgICAgICAgICAgdGhpcy5zZXRSZW5kZXJpbmdJbnRlbnQodmFsdWUpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgIkZMIjoKICAgICAgICAgICAgICAgIHRoaXMuc2V0RmxhdG5lc3ModmFsdWUpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgIkZvbnQiOgogICAgICAgICAgICAgICAgdGhpcy5zZXRGb250KHZhbHVlWzBdLCB2YWx1ZVsxXSk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAiQ0EiOgogICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50LnN0cm9rZUFscGhhID0gc3RhdGVbMV07CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAiY2EiOgogICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50LmZpbGxBbHBoYSA9IHN0YXRlWzFdOwogICAgICAgICAgICAgICAgdGhpcy5jdHguZ2xvYmFsQWxwaGEgPSBzdGF0ZVsxXTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICJCTSI6CiAgICAgICAgICAgICAgICB0aGlzLmN0eC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSB2YWx1ZTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICJTTWFzayI6CiAgICAgICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50LmFjdGl2ZVNNYXNrKSB7CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlU3RhY2subGVuZ3RoID4gMCAmJiB0aGlzLnN0YXRlU3RhY2tbdGhpcy5zdGF0ZVN0YWNrLmxlbmd0aCAtIDFdLmFjdGl2ZVNNYXNrID09PSB0aGlzLmN1cnJlbnQuYWN0aXZlU01hc2spIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnN1c3BlbmRTTWFza0dyb3VwKCk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbmRTTWFza0dyb3VwKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnQuYWN0aXZlU01hc2sgPSB2YWx1ZSA/IHRoaXMudGVtcFNNYXNrIDogbnVsbDsKCiAgICAgICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50LmFjdGl2ZVNNYXNrKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuYmVnaW5TTWFza0dyb3VwKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy50ZW1wU01hc2sgPSBudWxsOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGJlZ2luU01hc2tHcm91cDogZnVuY3Rpb24gQ2FudmFzR3JhcGhpY3NfYmVnaW5TTWFza0dyb3VwKCkgewogICAgICAgICAgdmFyIGFjdGl2ZVNNYXNrID0gdGhpcy5jdXJyZW50LmFjdGl2ZVNNYXNrOwogICAgICAgICAgdmFyIGRyYXduV2lkdGggPSBhY3RpdmVTTWFzay5jYW52YXMud2lkdGg7CiAgICAgICAgICB2YXIgZHJhd25IZWlnaHQgPSBhY3RpdmVTTWFzay5jYW52YXMuaGVpZ2h0OwogICAgICAgICAgdmFyIGNhY2hlSWQgPSAic21hc2tHcm91cEF0IiArIHRoaXMuZ3JvdXBMZXZlbDsKICAgICAgICAgIHZhciBzY3JhdGNoQ2FudmFzID0gdGhpcy5jYWNoZWRDYW52YXNlcy5nZXRDYW52YXMoY2FjaGVJZCwgZHJhd25XaWR0aCwgZHJhd25IZWlnaHQsIHRydWUpOwogICAgICAgICAgdmFyIGN1cnJlbnRDdHggPSB0aGlzLmN0eDsKICAgICAgICAgIHZhciBjdXJyZW50VHJhbnNmb3JtID0gY3VycmVudEN0eC5tb3pDdXJyZW50VHJhbnNmb3JtOwogICAgICAgICAgdGhpcy5jdHguc2F2ZSgpOwogICAgICAgICAgdmFyIGdyb3VwQ3R4ID0gc2NyYXRjaENhbnZhcy5jb250ZXh0OwogICAgICAgICAgZ3JvdXBDdHguc2NhbGUoMSAvIGFjdGl2ZVNNYXNrLnNjYWxlWCwgMSAvIGFjdGl2ZVNNYXNrLnNjYWxlWSk7CiAgICAgICAgICBncm91cEN0eC50cmFuc2xhdGUoLWFjdGl2ZVNNYXNrLm9mZnNldFgsIC1hY3RpdmVTTWFzay5vZmZzZXRZKTsKICAgICAgICAgIGdyb3VwQ3R4LnRyYW5zZm9ybS5hcHBseShncm91cEN0eCwgY3VycmVudFRyYW5zZm9ybSk7CiAgICAgICAgICBhY3RpdmVTTWFzay5zdGFydFRyYW5zZm9ybUludmVyc2UgPSBncm91cEN0eC5tb3pDdXJyZW50VHJhbnNmb3JtSW52ZXJzZTsKICAgICAgICAgIGNvcHlDdHhTdGF0ZShjdXJyZW50Q3R4LCBncm91cEN0eCk7CiAgICAgICAgICB0aGlzLmN0eCA9IGdyb3VwQ3R4OwogICAgICAgICAgdGhpcy5zZXRHU3RhdGUoW1siQk0iLCAic291cmNlLW92ZXIiXSwgWyJjYSIsIDFdLCBbIkNBIiwgMV1dKTsKICAgICAgICAgIHRoaXMuZ3JvdXBTdGFjay5wdXNoKGN1cnJlbnRDdHgpOwogICAgICAgICAgdGhpcy5ncm91cExldmVsKys7CiAgICAgICAgfSwKICAgICAgICBzdXNwZW5kU01hc2tHcm91cDogZnVuY3Rpb24gQ2FudmFzR3JhcGhpY3NfZW5kU01hc2tHcm91cCgpIHsKICAgICAgICAgIHZhciBncm91cEN0eCA9IHRoaXMuY3R4OwogICAgICAgICAgdGhpcy5ncm91cExldmVsLS07CiAgICAgICAgICB0aGlzLmN0eCA9IHRoaXMuZ3JvdXBTdGFjay5wb3AoKTsKICAgICAgICAgIGNvbXBvc2VTTWFzayh0aGlzLmN0eCwgdGhpcy5jdXJyZW50LmFjdGl2ZVNNYXNrLCBncm91cEN0eCwgdGhpcy53ZWJHTENvbnRleHQpOwogICAgICAgICAgdGhpcy5jdHgucmVzdG9yZSgpOwogICAgICAgICAgdGhpcy5jdHguc2F2ZSgpOwogICAgICAgICAgY29weUN0eFN0YXRlKGdyb3VwQ3R4LCB0aGlzLmN0eCk7CiAgICAgICAgICB0aGlzLmN1cnJlbnQucmVzdW1lU01hc2tDdHggPSBncm91cEN0eDsKCiAgICAgICAgICB2YXIgZGVsdGFUcmFuc2Zvcm0gPSBfdXRpbC5VdGlsLnRyYW5zZm9ybSh0aGlzLmN1cnJlbnQuYWN0aXZlU01hc2suc3RhcnRUcmFuc2Zvcm1JbnZlcnNlLCBncm91cEN0eC5tb3pDdXJyZW50VHJhbnNmb3JtKTsKCiAgICAgICAgICB0aGlzLmN0eC50cmFuc2Zvcm0uYXBwbHkodGhpcy5jdHgsIGRlbHRhVHJhbnNmb3JtKTsKICAgICAgICAgIGdyb3VwQ3R4LnNhdmUoKTsKICAgICAgICAgIGdyb3VwQ3R4LnNldFRyYW5zZm9ybSgxLCAwLCAwLCAxLCAwLCAwKTsKICAgICAgICAgIGdyb3VwQ3R4LmNsZWFyUmVjdCgwLCAwLCBncm91cEN0eC5jYW52YXMud2lkdGgsIGdyb3VwQ3R4LmNhbnZhcy5oZWlnaHQpOwogICAgICAgICAgZ3JvdXBDdHgucmVzdG9yZSgpOwogICAgICAgIH0sCiAgICAgICAgcmVzdW1lU01hc2tHcm91cDogZnVuY3Rpb24gQ2FudmFzR3JhcGhpY3NfZW5kU01hc2tHcm91cCgpIHsKICAgICAgICAgIHZhciBncm91cEN0eCA9IHRoaXMuY3VycmVudC5yZXN1bWVTTWFza0N0eDsKICAgICAgICAgIHZhciBjdXJyZW50Q3R4ID0gdGhpcy5jdHg7CiAgICAgICAgICB0aGlzLmN0eCA9IGdyb3VwQ3R4OwogICAgICAgICAgdGhpcy5ncm91cFN0YWNrLnB1c2goY3VycmVudEN0eCk7CiAgICAgICAgICB0aGlzLmdyb3VwTGV2ZWwrKzsKICAgICAgICB9LAogICAgICAgIGVuZFNNYXNrR3JvdXA6IGZ1bmN0aW9uIENhbnZhc0dyYXBoaWNzX2VuZFNNYXNrR3JvdXAoKSB7CiAgICAgICAgICB2YXIgZ3JvdXBDdHggPSB0aGlzLmN0eDsKICAgICAgICAgIHRoaXMuZ3JvdXBMZXZlbC0tOwogICAgICAgICAgdGhpcy5jdHggPSB0aGlzLmdyb3VwU3RhY2sucG9wKCk7CiAgICAgICAgICBjb21wb3NlU01hc2sodGhpcy5jdHgsIHRoaXMuY3VycmVudC5hY3RpdmVTTWFzaywgZ3JvdXBDdHgsIHRoaXMud2ViR0xDb250ZXh0KTsKICAgICAgICAgIHRoaXMuY3R4LnJlc3RvcmUoKTsKICAgICAgICAgIGNvcHlDdHhTdGF0ZShncm91cEN0eCwgdGhpcy5jdHgpOwoKICAgICAgICAgIHZhciBkZWx0YVRyYW5zZm9ybSA9IF91dGlsLlV0aWwudHJhbnNmb3JtKHRoaXMuY3VycmVudC5hY3RpdmVTTWFzay5zdGFydFRyYW5zZm9ybUludmVyc2UsIGdyb3VwQ3R4Lm1vekN1cnJlbnRUcmFuc2Zvcm0pOwoKICAgICAgICAgIHRoaXMuY3R4LnRyYW5zZm9ybS5hcHBseSh0aGlzLmN0eCwgZGVsdGFUcmFuc2Zvcm0pOwogICAgICAgIH0sCiAgICAgICAgc2F2ZTogZnVuY3Rpb24gQ2FudmFzR3JhcGhpY3Nfc2F2ZSgpIHsKICAgICAgICAgIHRoaXMuY3R4LnNhdmUoKTsKICAgICAgICAgIHZhciBvbGQgPSB0aGlzLmN1cnJlbnQ7CiAgICAgICAgICB0aGlzLnN0YXRlU3RhY2sucHVzaChvbGQpOwogICAgICAgICAgdGhpcy5jdXJyZW50ID0gb2xkLmNsb25lKCk7CiAgICAgICAgICB0aGlzLmN1cnJlbnQucmVzdW1lU01hc2tDdHggPSBudWxsOwogICAgICAgIH0sCiAgICAgICAgcmVzdG9yZTogZnVuY3Rpb24gQ2FudmFzR3JhcGhpY3NfcmVzdG9yZSgpIHsKICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnQucmVzdW1lU01hc2tDdHgpIHsKICAgICAgICAgICAgdGhpcy5yZXN1bWVTTWFza0dyb3VwKCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRoaXMuY3VycmVudC5hY3RpdmVTTWFzayAhPT0gbnVsbCAmJiAodGhpcy5zdGF0ZVN0YWNrLmxlbmd0aCA9PT0gMCB8fCB0aGlzLnN0YXRlU3RhY2tbdGhpcy5zdGF0ZVN0YWNrLmxlbmd0aCAtIDFdLmFjdGl2ZVNNYXNrICE9PSB0aGlzLmN1cnJlbnQuYWN0aXZlU01hc2spKSB7CiAgICAgICAgICAgIHRoaXMuZW5kU01hc2tHcm91cCgpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0aGlzLnN0YXRlU3RhY2subGVuZ3RoICE9PSAwKSB7CiAgICAgICAgICAgIHRoaXMuY3VycmVudCA9IHRoaXMuc3RhdGVTdGFjay5wb3AoKTsKICAgICAgICAgICAgdGhpcy5jdHgucmVzdG9yZSgpOwogICAgICAgICAgICB0aGlzLnBlbmRpbmdDbGlwID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fY2FjaGVkR2V0U2luZ2xlUGl4ZWxXaWR0aCA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICB0cmFuc2Zvcm06IGZ1bmN0aW9uIENhbnZhc0dyYXBoaWNzX3RyYW5zZm9ybShhLCBiLCBjLCBkLCBlLCBmKSB7CiAgICAgICAgICB0aGlzLmN0eC50cmFuc2Zvcm0oYSwgYiwgYywgZCwgZSwgZik7CiAgICAgICAgICB0aGlzLl9jYWNoZWRHZXRTaW5nbGVQaXhlbFdpZHRoID0gbnVsbDsKICAgICAgICB9LAogICAgICAgIGNvbnN0cnVjdFBhdGg6IGZ1bmN0aW9uIENhbnZhc0dyYXBoaWNzX2NvbnN0cnVjdFBhdGgob3BzLCBhcmdzKSB7CiAgICAgICAgICB2YXIgY3R4ID0gdGhpcy5jdHg7CiAgICAgICAgICB2YXIgY3VycmVudCA9IHRoaXMuY3VycmVudDsKICAgICAgICAgIHZhciB4ID0gY3VycmVudC54LAogICAgICAgICAgICB5ID0gY3VycmVudC55OwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBqID0gMCwgaWkgPSBvcHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICBzd2l0Y2ggKG9wc1tpXSB8IDApIHsKICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5yZWN0YW5nbGU6CiAgICAgICAgICAgICAgICB4ID0gYXJnc1tqKytdOwogICAgICAgICAgICAgICAgeSA9IGFyZ3NbaisrXTsKICAgICAgICAgICAgICAgIHZhciB3aWR0aCA9IGFyZ3NbaisrXTsKICAgICAgICAgICAgICAgIHZhciBoZWlnaHQgPSBhcmdzW2orK107CgogICAgICAgICAgICAgICAgaWYgKHdpZHRoID09PSAwKSB7CiAgICAgICAgICAgICAgICAgIHdpZHRoID0gdGhpcy5nZXRTaW5nbGVQaXhlbFdpZHRoKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGhlaWdodCA9PT0gMCkgewogICAgICAgICAgICAgICAgICBoZWlnaHQgPSB0aGlzLmdldFNpbmdsZVBpeGVsV2lkdGgoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgeHcgPSB4ICsgd2lkdGg7CiAgICAgICAgICAgICAgICB2YXIgeWggPSB5ICsgaGVpZ2h0OwogICAgICAgICAgICAgICAgdGhpcy5jdHgubW92ZVRvKHgsIHkpOwogICAgICAgICAgICAgICAgdGhpcy5jdHgubGluZVRvKHh3LCB5KTsKICAgICAgICAgICAgICAgIHRoaXMuY3R4LmxpbmVUbyh4dywgeWgpOwogICAgICAgICAgICAgICAgdGhpcy5jdHgubGluZVRvKHgsIHloKTsKICAgICAgICAgICAgICAgIHRoaXMuY3R4LmxpbmVUbyh4LCB5KTsKICAgICAgICAgICAgICAgIHRoaXMuY3R4LmNsb3NlUGF0aCgpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLm1vdmVUbzoKICAgICAgICAgICAgICAgIHggPSBhcmdzW2orK107CiAgICAgICAgICAgICAgICB5ID0gYXJnc1tqKytdOwogICAgICAgICAgICAgICAgY3R4Lm1vdmVUbyh4LCB5KTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5saW5lVG86CiAgICAgICAgICAgICAgICB4ID0gYXJnc1tqKytdOwogICAgICAgICAgICAgICAgeSA9IGFyZ3NbaisrXTsKICAgICAgICAgICAgICAgIGN0eC5saW5lVG8oeCwgeSk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMuY3VydmVUbzoKICAgICAgICAgICAgICAgIHggPSBhcmdzW2ogKyA0XTsKICAgICAgICAgICAgICAgIHkgPSBhcmdzW2ogKyA1XTsKICAgICAgICAgICAgICAgIGN0eC5iZXppZXJDdXJ2ZVRvKGFyZ3Nbal0sIGFyZ3NbaiArIDFdLCBhcmdzW2ogKyAyXSwgYXJnc1tqICsgM10sIHgsIHkpOwogICAgICAgICAgICAgICAgaiArPSA2OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLmN1cnZlVG8yOgogICAgICAgICAgICAgICAgY3R4LmJlemllckN1cnZlVG8oeCwgeSwgYXJnc1tqXSwgYXJnc1tqICsgMV0sIGFyZ3NbaiArIDJdLCBhcmdzW2ogKyAzXSk7CiAgICAgICAgICAgICAgICB4ID0gYXJnc1tqICsgMl07CiAgICAgICAgICAgICAgICB5ID0gYXJnc1tqICsgM107CiAgICAgICAgICAgICAgICBqICs9IDQ7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMuY3VydmVUbzM6CiAgICAgICAgICAgICAgICB4ID0gYXJnc1tqICsgMl07CiAgICAgICAgICAgICAgICB5ID0gYXJnc1tqICsgM107CiAgICAgICAgICAgICAgICBjdHguYmV6aWVyQ3VydmVUbyhhcmdzW2pdLCBhcmdzW2ogKyAxXSwgeCwgeSwgeCwgeSk7CiAgICAgICAgICAgICAgICBqICs9IDQ7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMuY2xvc2VQYXRoOgogICAgICAgICAgICAgICAgY3R4LmNsb3NlUGF0aCgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBjdXJyZW50LnNldEN1cnJlbnRQb2ludCh4LCB5KTsKICAgICAgICB9LAogICAgICAgIGNsb3NlUGF0aDogZnVuY3Rpb24gQ2FudmFzR3JhcGhpY3NfY2xvc2VQYXRoKCkgewogICAgICAgICAgdGhpcy5jdHguY2xvc2VQYXRoKCk7CiAgICAgICAgfSwKICAgICAgICBzdHJva2U6IGZ1bmN0aW9uIENhbnZhc0dyYXBoaWNzX3N0cm9rZShjb25zdW1lUGF0aCkgewogICAgICAgICAgY29uc3VtZVBhdGggPSB0eXBlb2YgY29uc3VtZVBhdGggIT09ICJ1bmRlZmluZWQiID8gY29uc3VtZVBhdGggOiB0cnVlOwogICAgICAgICAgdmFyIGN0eCA9IHRoaXMuY3R4OwogICAgICAgICAgdmFyIHN0cm9rZUNvbG9yID0gdGhpcy5jdXJyZW50LnN0cm9rZUNvbG9yOwogICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gdGhpcy5jdXJyZW50LnN0cm9rZUFscGhhOwoKICAgICAgICAgIGlmIChzdHJva2VDb2xvciAmJiBzdHJva2VDb2xvci5oYXNPd25Qcm9wZXJ0eSgidHlwZSIpICYmIHN0cm9rZUNvbG9yLnR5cGUgPT09ICJQYXR0ZXJuIikgewogICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICB2YXIgdHJhbnNmb3JtID0gY3R4Lm1vekN1cnJlbnRUcmFuc2Zvcm07CgogICAgICAgICAgICB2YXIgc2NhbGUgPSBfdXRpbC5VdGlsLnNpbmd1bGFyVmFsdWVEZWNvbXBvc2UyZFNjYWxlKHRyYW5zZm9ybSlbMF07CgogICAgICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSBzdHJva2VDb2xvci5nZXRQYXR0ZXJuKGN0eCwgdGhpcyk7CiAgICAgICAgICAgIGN0eC5saW5lV2lkdGggPSBNYXRoLm1heCh0aGlzLmdldFNpbmdsZVBpeGVsV2lkdGgoKSAqIE1JTl9XSURUSF9GQUNUT1IsIHRoaXMuY3VycmVudC5saW5lV2lkdGggKiBzY2FsZSk7CiAgICAgICAgICAgIGN0eC5zdHJva2UoKTsKICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGN0eC5saW5lV2lkdGggPSBNYXRoLm1heCh0aGlzLmdldFNpbmdsZVBpeGVsV2lkdGgoKSAqIE1JTl9XSURUSF9GQUNUT1IsIHRoaXMuY3VycmVudC5saW5lV2lkdGgpOwogICAgICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGNvbnN1bWVQYXRoKSB7CiAgICAgICAgICAgIHRoaXMuY29uc3VtZVBhdGgoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSB0aGlzLmN1cnJlbnQuZmlsbEFscGhhOwogICAgICAgIH0sCiAgICAgICAgY2xvc2VTdHJva2U6IGZ1bmN0aW9uIENhbnZhc0dyYXBoaWNzX2Nsb3NlU3Ryb2tlKCkgewogICAgICAgICAgdGhpcy5jbG9zZVBhdGgoKTsKICAgICAgICAgIHRoaXMuc3Ryb2tlKCk7CiAgICAgICAgfSwKICAgICAgICBmaWxsOiBmdW5jdGlvbiBDYW52YXNHcmFwaGljc19maWxsKGNvbnN1bWVQYXRoKSB7CiAgICAgICAgICBjb25zdW1lUGF0aCA9IHR5cGVvZiBjb25zdW1lUGF0aCAhPT0gInVuZGVmaW5lZCIgPyBjb25zdW1lUGF0aCA6IHRydWU7CiAgICAgICAgICB2YXIgY3R4ID0gdGhpcy5jdHg7CiAgICAgICAgICB2YXIgZmlsbENvbG9yID0gdGhpcy5jdXJyZW50LmZpbGxDb2xvcjsKICAgICAgICAgIHZhciBpc1BhdHRlcm5GaWxsID0gdGhpcy5jdXJyZW50LnBhdHRlcm5GaWxsOwogICAgICAgICAgdmFyIG5lZWRSZXN0b3JlID0gZmFsc2U7CgogICAgICAgICAgaWYgKGlzUGF0dGVybkZpbGwpIHsKICAgICAgICAgICAgY3R4LnNhdmUoKTsKCiAgICAgICAgICAgIGlmICh0aGlzLmJhc2VUcmFuc2Zvcm0pIHsKICAgICAgICAgICAgICBjdHguc2V0VHJhbnNmb3JtLmFwcGx5KGN0eCwgdGhpcy5iYXNlVHJhbnNmb3JtKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGZpbGxDb2xvci5nZXRQYXR0ZXJuKGN0eCwgdGhpcyk7CiAgICAgICAgICAgIG5lZWRSZXN0b3JlID0gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodGhpcy5wZW5kaW5nRU9GaWxsKSB7CiAgICAgICAgICAgIGN0eC5maWxsKCJldmVub2RkIik7CiAgICAgICAgICAgIHRoaXMucGVuZGluZ0VPRmlsbCA9IGZhbHNlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY3R4LmZpbGwoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAobmVlZFJlc3RvcmUpIHsKICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoY29uc3VtZVBhdGgpIHsKICAgICAgICAgICAgdGhpcy5jb25zdW1lUGF0aCgpOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgZW9GaWxsOiBmdW5jdGlvbiBDYW52YXNHcmFwaGljc19lb0ZpbGwoKSB7CiAgICAgICAgICB0aGlzLnBlbmRpbmdFT0ZpbGwgPSB0cnVlOwogICAgICAgICAgdGhpcy5maWxsKCk7CiAgICAgICAgfSwKICAgICAgICBmaWxsU3Ryb2tlOiBmdW5jdGlvbiBDYW52YXNHcmFwaGljc19maWxsU3Ryb2tlKCkgewogICAgICAgICAgdGhpcy5maWxsKGZhbHNlKTsKICAgICAgICAgIHRoaXMuc3Ryb2tlKGZhbHNlKTsKICAgICAgICAgIHRoaXMuY29uc3VtZVBhdGgoKTsKICAgICAgICB9LAogICAgICAgIGVvRmlsbFN0cm9rZTogZnVuY3Rpb24gQ2FudmFzR3JhcGhpY3NfZW9GaWxsU3Ryb2tlKCkgewogICAgICAgICAgdGhpcy5wZW5kaW5nRU9GaWxsID0gdHJ1ZTsKICAgICAgICAgIHRoaXMuZmlsbFN0cm9rZSgpOwogICAgICAgIH0sCiAgICAgICAgY2xvc2VGaWxsU3Ryb2tlOiBmdW5jdGlvbiBDYW52YXNHcmFwaGljc19jbG9zZUZpbGxTdHJva2UoKSB7CiAgICAgICAgICB0aGlzLmNsb3NlUGF0aCgpOwogICAgICAgICAgdGhpcy5maWxsU3Ryb2tlKCk7CiAgICAgICAgfSwKICAgICAgICBjbG9zZUVPRmlsbFN0cm9rZTogZnVuY3Rpb24gQ2FudmFzR3JhcGhpY3NfY2xvc2VFT0ZpbGxTdHJva2UoKSB7CiAgICAgICAgICB0aGlzLnBlbmRpbmdFT0ZpbGwgPSB0cnVlOwogICAgICAgICAgdGhpcy5jbG9zZVBhdGgoKTsKICAgICAgICAgIHRoaXMuZmlsbFN0cm9rZSgpOwogICAgICAgIH0sCiAgICAgICAgZW5kUGF0aDogZnVuY3Rpb24gQ2FudmFzR3JhcGhpY3NfZW5kUGF0aCgpIHsKICAgICAgICAgIHRoaXMuY29uc3VtZVBhdGgoKTsKICAgICAgICB9LAogICAgICAgIGNsaXA6IGZ1bmN0aW9uIENhbnZhc0dyYXBoaWNzX2NsaXAoKSB7CiAgICAgICAgICB0aGlzLnBlbmRpbmdDbGlwID0gTk9STUFMX0NMSVA7CiAgICAgICAgfSwKICAgICAgICBlb0NsaXA6IGZ1bmN0aW9uIENhbnZhc0dyYXBoaWNzX2VvQ2xpcCgpIHsKICAgICAgICAgIHRoaXMucGVuZGluZ0NsaXAgPSBFT19DTElQOwogICAgICAgIH0sCiAgICAgICAgYmVnaW5UZXh0OiBmdW5jdGlvbiBDYW52YXNHcmFwaGljc19iZWdpblRleHQoKSB7CiAgICAgICAgICB0aGlzLmN1cnJlbnQudGV4dE1hdHJpeCA9IF91dGlsLklERU5USVRZX01BVFJJWDsKICAgICAgICAgIHRoaXMuY3VycmVudC50ZXh0TWF0cml4U2NhbGUgPSAxOwogICAgICAgICAgdGhpcy5jdXJyZW50LnggPSB0aGlzLmN1cnJlbnQubGluZVggPSAwOwogICAgICAgICAgdGhpcy5jdXJyZW50LnkgPSB0aGlzLmN1cnJlbnQubGluZVkgPSAwOwogICAgICAgIH0sCiAgICAgICAgZW5kVGV4dDogZnVuY3Rpb24gQ2FudmFzR3JhcGhpY3NfZW5kVGV4dCgpIHsKICAgICAgICAgIHZhciBwYXRocyA9IHRoaXMucGVuZGluZ1RleHRQYXRoczsKICAgICAgICAgIHZhciBjdHggPSB0aGlzLmN0eDsKCiAgICAgICAgICBpZiAocGF0aHMgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGF0aHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdmFyIHBhdGggPSBwYXRoc1tpXTsKICAgICAgICAgICAgY3R4LnNldFRyYW5zZm9ybS5hcHBseShjdHgsIHBhdGgudHJhbnNmb3JtKTsKICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZShwYXRoLngsIHBhdGgueSk7CiAgICAgICAgICAgIHBhdGguYWRkVG9QYXRoKGN0eCwgcGF0aC5mb250U2l6ZSk7CiAgICAgICAgICB9CgogICAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICAgIGN0eC5jbGlwKCk7CiAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICBkZWxldGUgdGhpcy5wZW5kaW5nVGV4dFBhdGhzOwogICAgICAgIH0sCiAgICAgICAgc2V0Q2hhclNwYWNpbmc6IGZ1bmN0aW9uIENhbnZhc0dyYXBoaWNzX3NldENoYXJTcGFjaW5nKHNwYWNpbmcpIHsKICAgICAgICAgIHRoaXMuY3VycmVudC5jaGFyU3BhY2luZyA9IHNwYWNpbmc7CiAgICAgICAgfSwKICAgICAgICBzZXRXb3JkU3BhY2luZzogZnVuY3Rpb24gQ2FudmFzR3JhcGhpY3Nfc2V0V29yZFNwYWNpbmcoc3BhY2luZykgewogICAgICAgICAgdGhpcy5jdXJyZW50LndvcmRTcGFjaW5nID0gc3BhY2luZzsKICAgICAgICB9LAogICAgICAgIHNldEhTY2FsZTogZnVuY3Rpb24gQ2FudmFzR3JhcGhpY3Nfc2V0SFNjYWxlKHNjYWxlKSB7CiAgICAgICAgICB0aGlzLmN1cnJlbnQudGV4dEhTY2FsZSA9IHNjYWxlIC8gMTAwOwogICAgICAgIH0sCiAgICAgICAgc2V0TGVhZGluZzogZnVuY3Rpb24gQ2FudmFzR3JhcGhpY3Nfc2V0TGVhZGluZyhsZWFkaW5nKSB7CiAgICAgICAgICB0aGlzLmN1cnJlbnQubGVhZGluZyA9IC1sZWFkaW5nOwogICAgICAgIH0sCiAgICAgICAgc2V0Rm9udDogZnVuY3Rpb24gQ2FudmFzR3JhcGhpY3Nfc2V0Rm9udChmb250UmVmTmFtZSwgc2l6ZSkgewogICAgICAgICAgdmFyIGZvbnRPYmogPSB0aGlzLmNvbW1vbk9ianMuZ2V0KGZvbnRSZWZOYW1lKTsKICAgICAgICAgIHZhciBjdXJyZW50ID0gdGhpcy5jdXJyZW50OwoKICAgICAgICAgIGlmICghZm9udE9iaikgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNhbid0IGZpbmQgZm9udCBmb3IgIi5jb25jYXQoZm9udFJlZk5hbWUpKTsKICAgICAgICAgIH0KCiAgICAgICAgICBjdXJyZW50LmZvbnRNYXRyaXggPSBmb250T2JqLmZvbnRNYXRyaXggPyBmb250T2JqLmZvbnRNYXRyaXggOiBfdXRpbC5GT05UX0lERU5USVRZX01BVFJJWDsKCiAgICAgICAgICBpZiAoY3VycmVudC5mb250TWF0cml4WzBdID09PSAwIHx8IGN1cnJlbnQuZm9udE1hdHJpeFszXSA9PT0gMCkgewogICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIkludmFsaWQgZm9udCBtYXRyaXggZm9yIGZvbnQgIiArIGZvbnRSZWZOYW1lKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoc2l6ZSA8IDApIHsKICAgICAgICAgICAgc2l6ZSA9IC1zaXplOwogICAgICAgICAgICBjdXJyZW50LmZvbnREaXJlY3Rpb24gPSAtMTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGN1cnJlbnQuZm9udERpcmVjdGlvbiA9IDE7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5jdXJyZW50LmZvbnQgPSBmb250T2JqOwogICAgICAgICAgdGhpcy5jdXJyZW50LmZvbnRTaXplID0gc2l6ZTsKCiAgICAgICAgICBpZiAoZm9udE9iai5pc1R5cGUzRm9udCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIG5hbWUgPSBmb250T2JqLmxvYWRlZE5hbWUgfHwgInNhbnMtc2VyaWYiOwogICAgICAgICAgdmFyIGJvbGQgPSAibm9ybWFsIjsKCiAgICAgICAgICBpZiAoZm9udE9iai5ibGFjaykgewogICAgICAgICAgICBib2xkID0gIjkwMCI7CiAgICAgICAgICB9IGVsc2UgaWYgKGZvbnRPYmouYm9sZCkgewogICAgICAgICAgICBib2xkID0gImJvbGQiOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBpdGFsaWMgPSBmb250T2JqLml0YWxpYyA/ICJpdGFsaWMiIDogIm5vcm1hbCI7CiAgICAgICAgICB2YXIgdHlwZWZhY2UgPSAiXCIiLmNvbmNhdChuYW1lLCAiXCIsICIpLmNvbmNhdChmb250T2JqLmZhbGxiYWNrTmFtZSk7CiAgICAgICAgICB2YXIgYnJvd3NlckZvbnRTaXplID0gc2l6ZTsKCiAgICAgICAgICBpZiAoc2l6ZSA8IE1JTl9GT05UX1NJWkUpIHsKICAgICAgICAgICAgYnJvd3NlckZvbnRTaXplID0gTUlOX0ZPTlRfU0laRTsKICAgICAgICAgIH0gZWxzZSBpZiAoc2l6ZSA+IE1BWF9GT05UX1NJWkUpIHsKICAgICAgICAgICAgYnJvd3NlckZvbnRTaXplID0gTUFYX0ZPTlRfU0laRTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLmN1cnJlbnQuZm9udFNpemVTY2FsZSA9IHNpemUgLyBicm93c2VyRm9udFNpemU7CiAgICAgICAgICB0aGlzLmN0eC5mb250ID0gIiIuY29uY2F0KGl0YWxpYywgIiAiKS5jb25jYXQoYm9sZCwgIiAiKS5jb25jYXQoYnJvd3NlckZvbnRTaXplLCAicHggIikuY29uY2F0KHR5cGVmYWNlKTsKICAgICAgICB9LAogICAgICAgIHNldFRleHRSZW5kZXJpbmdNb2RlOiBmdW5jdGlvbiBDYW52YXNHcmFwaGljc19zZXRUZXh0UmVuZGVyaW5nTW9kZShtb2RlKSB7CiAgICAgICAgICB0aGlzLmN1cnJlbnQudGV4dFJlbmRlcmluZ01vZGUgPSBtb2RlOwogICAgICAgIH0sCiAgICAgICAgc2V0VGV4dFJpc2U6IGZ1bmN0aW9uIENhbnZhc0dyYXBoaWNzX3NldFRleHRSaXNlKHJpc2UpIHsKICAgICAgICAgIHRoaXMuY3VycmVudC50ZXh0UmlzZSA9IHJpc2U7CiAgICAgICAgfSwKICAgICAgICBtb3ZlVGV4dDogZnVuY3Rpb24gQ2FudmFzR3JhcGhpY3NfbW92ZVRleHQoeCwgeSkgewogICAgICAgICAgdGhpcy5jdXJyZW50LnggPSB0aGlzLmN1cnJlbnQubGluZVggKz0geDsKICAgICAgICAgIHRoaXMuY3VycmVudC55ID0gdGhpcy5jdXJyZW50LmxpbmVZICs9IHk7CiAgICAgICAgfSwKICAgICAgICBzZXRMZWFkaW5nTW92ZVRleHQ6IGZ1bmN0aW9uIENhbnZhc0dyYXBoaWNzX3NldExlYWRpbmdNb3ZlVGV4dCh4LCB5KSB7CiAgICAgICAgICB0aGlzLnNldExlYWRpbmcoLXkpOwogICAgICAgICAgdGhpcy5tb3ZlVGV4dCh4LCB5KTsKICAgICAgICB9LAogICAgICAgIHNldFRleHRNYXRyaXg6IGZ1bmN0aW9uIENhbnZhc0dyYXBoaWNzX3NldFRleHRNYXRyaXgoYSwgYiwgYywgZCwgZSwgZikgewogICAgICAgICAgdGhpcy5jdXJyZW50LnRleHRNYXRyaXggPSBbYSwgYiwgYywgZCwgZSwgZl07CiAgICAgICAgICB0aGlzLmN1cnJlbnQudGV4dE1hdHJpeFNjYWxlID0gTWF0aC5zcXJ0KGEgKiBhICsgYiAqIGIpOwogICAgICAgICAgdGhpcy5jdXJyZW50LnggPSB0aGlzLmN1cnJlbnQubGluZVggPSAwOwogICAgICAgICAgdGhpcy5jdXJyZW50LnkgPSB0aGlzLmN1cnJlbnQubGluZVkgPSAwOwogICAgICAgIH0sCiAgICAgICAgbmV4dExpbmU6IGZ1bmN0aW9uIENhbnZhc0dyYXBoaWNzX25leHRMaW5lKCkgewogICAgICAgICAgdGhpcy5tb3ZlVGV4dCgwLCB0aGlzLmN1cnJlbnQubGVhZGluZyk7CiAgICAgICAgfSwKICAgICAgICBwYWludENoYXI6IGZ1bmN0aW9uIHBhaW50Q2hhcihjaGFyYWN0ZXIsIHgsIHksIHBhdHRlcm5UcmFuc2Zvcm0pIHsKICAgICAgICAgIHZhciBjdHggPSB0aGlzLmN0eDsKICAgICAgICAgIHZhciBjdXJyZW50ID0gdGhpcy5jdXJyZW50OwogICAgICAgICAgdmFyIGZvbnQgPSBjdXJyZW50LmZvbnQ7CiAgICAgICAgICB2YXIgdGV4dFJlbmRlcmluZ01vZGUgPSBjdXJyZW50LnRleHRSZW5kZXJpbmdNb2RlOwogICAgICAgICAgdmFyIGZvbnRTaXplID0gY3VycmVudC5mb250U2l6ZSAvIGN1cnJlbnQuZm9udFNpemVTY2FsZTsKICAgICAgICAgIHZhciBmaWxsU3Ryb2tlTW9kZSA9IHRleHRSZW5kZXJpbmdNb2RlICYgX3V0aWwuVGV4dFJlbmRlcmluZ01vZGUuRklMTF9TVFJPS0VfTUFTSzsKICAgICAgICAgIHZhciBpc0FkZFRvUGF0aFNldCA9ICEhKHRleHRSZW5kZXJpbmdNb2RlICYgX3V0aWwuVGV4dFJlbmRlcmluZ01vZGUuQUREX1RPX1BBVEhfRkxBRyk7CiAgICAgICAgICB2YXIgcGF0dGVybkZpbGwgPSBjdXJyZW50LnBhdHRlcm5GaWxsICYmIGZvbnQuZGF0YTsKICAgICAgICAgIHZhciBhZGRUb1BhdGg7CgogICAgICAgICAgaWYgKGZvbnQuZGlzYWJsZUZvbnRGYWNlIHx8IGlzQWRkVG9QYXRoU2V0IHx8IHBhdHRlcm5GaWxsKSB7CiAgICAgICAgICAgIGFkZFRvUGF0aCA9IGZvbnQuZ2V0UGF0aEdlbmVyYXRvcih0aGlzLmNvbW1vbk9ianMsIGNoYXJhY3Rlcik7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGZvbnQuZGlzYWJsZUZvbnRGYWNlIHx8IHBhdHRlcm5GaWxsKSB7CiAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgIGN0eC50cmFuc2xhdGUoeCwgeSk7CiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgYWRkVG9QYXRoKGN0eCwgZm9udFNpemUpOwoKICAgICAgICAgICAgaWYgKHBhdHRlcm5UcmFuc2Zvcm0pIHsKICAgICAgICAgICAgICBjdHguc2V0VHJhbnNmb3JtLmFwcGx5KGN0eCwgcGF0dGVyblRyYW5zZm9ybSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmaWxsU3Ryb2tlTW9kZSA9PT0gX3V0aWwuVGV4dFJlbmRlcmluZ01vZGUuRklMTCB8fCBmaWxsU3Ryb2tlTW9kZSA9PT0gX3V0aWwuVGV4dFJlbmRlcmluZ01vZGUuRklMTF9TVFJPS0UpIHsKICAgICAgICAgICAgICBjdHguZmlsbCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZmlsbFN0cm9rZU1vZGUgPT09IF91dGlsLlRleHRSZW5kZXJpbmdNb2RlLlNUUk9LRSB8fCBmaWxsU3Ryb2tlTW9kZSA9PT0gX3V0aWwuVGV4dFJlbmRlcmluZ01vZGUuRklMTF9TVFJPS0UpIHsKICAgICAgICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoZmlsbFN0cm9rZU1vZGUgPT09IF91dGlsLlRleHRSZW5kZXJpbmdNb2RlLkZJTEwgfHwgZmlsbFN0cm9rZU1vZGUgPT09IF91dGlsLlRleHRSZW5kZXJpbmdNb2RlLkZJTExfU1RST0tFKSB7CiAgICAgICAgICAgICAgY3R4LmZpbGxUZXh0KGNoYXJhY3RlciwgeCwgeSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmaWxsU3Ryb2tlTW9kZSA9PT0gX3V0aWwuVGV4dFJlbmRlcmluZ01vZGUuU1RST0tFIHx8IGZpbGxTdHJva2VNb2RlID09PSBfdXRpbC5UZXh0UmVuZGVyaW5nTW9kZS5GSUxMX1NUUk9LRSkgewogICAgICAgICAgICAgIGN0eC5zdHJva2VUZXh0KGNoYXJhY3RlciwgeCwgeSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoaXNBZGRUb1BhdGhTZXQpIHsKICAgICAgICAgICAgdmFyIHBhdGhzID0gdGhpcy5wZW5kaW5nVGV4dFBhdGhzIHx8ICh0aGlzLnBlbmRpbmdUZXh0UGF0aHMgPSBbXSk7CiAgICAgICAgICAgIHBhdGhzLnB1c2goewogICAgICAgICAgICAgIHRyYW5zZm9ybTogY3R4Lm1vekN1cnJlbnRUcmFuc2Zvcm0sCiAgICAgICAgICAgICAgeDogeCwKICAgICAgICAgICAgICB5OiB5LAogICAgICAgICAgICAgIGZvbnRTaXplOiBmb250U2l6ZSwKICAgICAgICAgICAgICBhZGRUb1BhdGg6IGFkZFRvUGF0aAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICBnZXQgaXNGb250U3VicGl4ZWxBQUVuYWJsZWQoKSB7CiAgICAgICAgICB2YXIgX3RoaXMkY2FjaGVkQ2FudmFzZXMkID0gdGhpcy5jYWNoZWRDYW52YXNlcy5nZXRDYW52YXMoImlzRm9udFN1YnBpeGVsQUFFbmFibGVkIiwgMTAsIDEwKSwKICAgICAgICAgICAgY3R4ID0gX3RoaXMkY2FjaGVkQ2FudmFzZXMkLmNvbnRleHQ7CgogICAgICAgICAgY3R4LnNjYWxlKDEuNSwgMSk7CiAgICAgICAgICBjdHguZmlsbFRleHQoIkkiLCAwLCAxMCk7CiAgICAgICAgICB2YXIgZGF0YSA9IGN0eC5nZXRJbWFnZURhdGEoMCwgMCwgMTAsIDEwKS5kYXRhOwogICAgICAgICAgdmFyIGVuYWJsZWQgPSBmYWxzZTsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMzsgaSA8IGRhdGEubGVuZ3RoOyBpICs9IDQpIHsKICAgICAgICAgICAgaWYgKGRhdGFbaV0gPiAwICYmIGRhdGFbaV0gPCAyNTUpIHsKICAgICAgICAgICAgICBlbmFibGVkID0gdHJ1ZTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAiaXNGb250U3VicGl4ZWxBQUVuYWJsZWQiLCBlbmFibGVkKTsKICAgICAgICB9LAoKICAgICAgICBzaG93VGV4dDogZnVuY3Rpb24gQ2FudmFzR3JhcGhpY3Nfc2hvd1RleHQoZ2x5cGhzKSB7CiAgICAgICAgICB2YXIgY3VycmVudCA9IHRoaXMuY3VycmVudDsKICAgICAgICAgIHZhciBmb250ID0gY3VycmVudC5mb250OwoKICAgICAgICAgIGlmIChmb250LmlzVHlwZTNGb250KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnNob3dUeXBlM1RleHQoZ2x5cGhzKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZm9udFNpemUgPSBjdXJyZW50LmZvbnRTaXplOwoKICAgICAgICAgIGlmIChmb250U2l6ZSA9PT0gMCkgewogICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBjdHggPSB0aGlzLmN0eDsKICAgICAgICAgIHZhciBmb250U2l6ZVNjYWxlID0gY3VycmVudC5mb250U2l6ZVNjYWxlOwogICAgICAgICAgdmFyIGNoYXJTcGFjaW5nID0gY3VycmVudC5jaGFyU3BhY2luZzsKICAgICAgICAgIHZhciB3b3JkU3BhY2luZyA9IGN1cnJlbnQud29yZFNwYWNpbmc7CiAgICAgICAgICB2YXIgZm9udERpcmVjdGlvbiA9IGN1cnJlbnQuZm9udERpcmVjdGlvbjsKICAgICAgICAgIHZhciB0ZXh0SFNjYWxlID0gY3VycmVudC50ZXh0SFNjYWxlICogZm9udERpcmVjdGlvbjsKICAgICAgICAgIHZhciBnbHlwaHNMZW5ndGggPSBnbHlwaHMubGVuZ3RoOwogICAgICAgICAgdmFyIHZlcnRpY2FsID0gZm9udC52ZXJ0aWNhbDsKICAgICAgICAgIHZhciBzcGFjaW5nRGlyID0gdmVydGljYWwgPyAxIDogLTE7CiAgICAgICAgICB2YXIgZGVmYXVsdFZNZXRyaWNzID0gZm9udC5kZWZhdWx0Vk1ldHJpY3M7CiAgICAgICAgICB2YXIgd2lkdGhBZHZhbmNlU2NhbGUgPSBmb250U2l6ZSAqIGN1cnJlbnQuZm9udE1hdHJpeFswXTsKICAgICAgICAgIHZhciBzaW1wbGVGaWxsVGV4dCA9IGN1cnJlbnQudGV4dFJlbmRlcmluZ01vZGUgPT09IF91dGlsLlRleHRSZW5kZXJpbmdNb2RlLkZJTEwgJiYgIWZvbnQuZGlzYWJsZUZvbnRGYWNlICYmICFjdXJyZW50LnBhdHRlcm5GaWxsOwogICAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICAgIHZhciBwYXR0ZXJuVHJhbnNmb3JtOwoKICAgICAgICAgIGlmIChjdXJyZW50LnBhdHRlcm5GaWxsKSB7CiAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgIHZhciBwYXR0ZXJuID0gY3VycmVudC5maWxsQ29sb3IuZ2V0UGF0dGVybihjdHgsIHRoaXMpOwogICAgICAgICAgICBwYXR0ZXJuVHJhbnNmb3JtID0gY3R4Lm1vekN1cnJlbnRUcmFuc2Zvcm07CiAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBwYXR0ZXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGN0eC50cmFuc2Zvcm0uYXBwbHkoY3R4LCBjdXJyZW50LnRleHRNYXRyaXgpOwogICAgICAgICAgY3R4LnRyYW5zbGF0ZShjdXJyZW50LngsIGN1cnJlbnQueSArIGN1cnJlbnQudGV4dFJpc2UpOwoKICAgICAgICAgIGlmIChmb250RGlyZWN0aW9uID4gMCkgewogICAgICAgICAgICBjdHguc2NhbGUodGV4dEhTY2FsZSwgLTEpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY3R4LnNjYWxlKHRleHRIU2NhbGUsIDEpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBsaW5lV2lkdGggPSBjdXJyZW50LmxpbmVXaWR0aDsKICAgICAgICAgIHZhciBzY2FsZSA9IGN1cnJlbnQudGV4dE1hdHJpeFNjYWxlOwoKICAgICAgICAgIGlmIChzY2FsZSA9PT0gMCB8fCBsaW5lV2lkdGggPT09IDApIHsKICAgICAgICAgICAgdmFyIGZpbGxTdHJva2VNb2RlID0gY3VycmVudC50ZXh0UmVuZGVyaW5nTW9kZSAmIF91dGlsLlRleHRSZW5kZXJpbmdNb2RlLkZJTExfU1RST0tFX01BU0s7CgogICAgICAgICAgICBpZiAoZmlsbFN0cm9rZU1vZGUgPT09IF91dGlsLlRleHRSZW5kZXJpbmdNb2RlLlNUUk9LRSB8fCBmaWxsU3Ryb2tlTW9kZSA9PT0gX3V0aWwuVGV4dFJlbmRlcmluZ01vZGUuRklMTF9TVFJPS0UpIHsKICAgICAgICAgICAgICB0aGlzLl9jYWNoZWRHZXRTaW5nbGVQaXhlbFdpZHRoID0gbnVsbDsKICAgICAgICAgICAgICBsaW5lV2lkdGggPSB0aGlzLmdldFNpbmdsZVBpeGVsV2lkdGgoKSAqIE1JTl9XSURUSF9GQUNUT1I7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGxpbmVXaWR0aCAvPSBzY2FsZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZm9udFNpemVTY2FsZSAhPT0gMS4wKSB7CiAgICAgICAgICAgIGN0eC5zY2FsZShmb250U2l6ZVNjYWxlLCBmb250U2l6ZVNjYWxlKTsKICAgICAgICAgICAgbGluZVdpZHRoIC89IGZvbnRTaXplU2NhbGU7CiAgICAgICAgICB9CgogICAgICAgICAgY3R4LmxpbmVXaWR0aCA9IGxpbmVXaWR0aDsKICAgICAgICAgIHZhciB4ID0gMCwKICAgICAgICAgICAgaTsKCiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZ2x5cGhzTGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgdmFyIGdseXBoID0gZ2x5cGhzW2ldOwoKICAgICAgICAgICAgaWYgKCgwLCBfdXRpbC5pc051bSkoZ2x5cGgpKSB7CiAgICAgICAgICAgICAgeCArPSBzcGFjaW5nRGlyICogZ2x5cGggKiBmb250U2l6ZSAvIDEwMDA7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciByZXN0b3JlTmVlZGVkID0gZmFsc2U7CiAgICAgICAgICAgIHZhciBzcGFjaW5nID0gKGdseXBoLmlzU3BhY2UgPyB3b3JkU3BhY2luZyA6IDApICsgY2hhclNwYWNpbmc7CiAgICAgICAgICAgIHZhciBjaGFyYWN0ZXIgPSBnbHlwaC5mb250Q2hhcjsKICAgICAgICAgICAgdmFyIGFjY2VudCA9IGdseXBoLmFjY2VudDsKICAgICAgICAgICAgdmFyIHNjYWxlZFgsIHNjYWxlZFksIHNjYWxlZEFjY2VudFgsIHNjYWxlZEFjY2VudFk7CiAgICAgICAgICAgIHZhciB3aWR0aCA9IGdseXBoLndpZHRoOwoKICAgICAgICAgICAgaWYgKHZlcnRpY2FsKSB7CiAgICAgICAgICAgICAgdmFyIHZtZXRyaWMsIHZ4LCB2eTsKICAgICAgICAgICAgICB2bWV0cmljID0gZ2x5cGgudm1ldHJpYyB8fCBkZWZhdWx0Vk1ldHJpY3M7CiAgICAgICAgICAgICAgdnggPSBnbHlwaC52bWV0cmljID8gdm1ldHJpY1sxXSA6IHdpZHRoICogMC41OwogICAgICAgICAgICAgIHZ4ID0gLXZ4ICogd2lkdGhBZHZhbmNlU2NhbGU7CiAgICAgICAgICAgICAgdnkgPSB2bWV0cmljWzJdICogd2lkdGhBZHZhbmNlU2NhbGU7CiAgICAgICAgICAgICAgd2lkdGggPSB2bWV0cmljID8gLXZtZXRyaWNbMF0gOiB3aWR0aDsKICAgICAgICAgICAgICBzY2FsZWRYID0gdnggLyBmb250U2l6ZVNjYWxlOwogICAgICAgICAgICAgIHNjYWxlZFkgPSAoeCArIHZ5KSAvIGZvbnRTaXplU2NhbGU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgc2NhbGVkWCA9IHggLyBmb250U2l6ZVNjYWxlOwogICAgICAgICAgICAgIHNjYWxlZFkgPSAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZm9udC5yZW1lYXN1cmUgJiYgd2lkdGggPiAwKSB7CiAgICAgICAgICAgICAgdmFyIG1lYXN1cmVkV2lkdGggPSBjdHgubWVhc3VyZVRleHQoY2hhcmFjdGVyKS53aWR0aCAqIDEwMDAgLyBmb250U2l6ZSAqIGZvbnRTaXplU2NhbGU7CgogICAgICAgICAgICAgIGlmICh3aWR0aCA8IG1lYXN1cmVkV2lkdGggJiYgdGhpcy5pc0ZvbnRTdWJwaXhlbEFBRW5hYmxlZCkgewogICAgICAgICAgICAgICAgdmFyIGNoYXJhY3RlclNjYWxlWCA9IHdpZHRoIC8gbWVhc3VyZWRXaWR0aDsKICAgICAgICAgICAgICAgIHJlc3RvcmVOZWVkZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICAgICAgICAgIGN0eC5zY2FsZShjaGFyYWN0ZXJTY2FsZVgsIDEpOwogICAgICAgICAgICAgICAgc2NhbGVkWCAvPSBjaGFyYWN0ZXJTY2FsZVg7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh3aWR0aCAhPT0gbWVhc3VyZWRXaWR0aCkgewogICAgICAgICAgICAgICAgc2NhbGVkWCArPSAod2lkdGggLSBtZWFzdXJlZFdpZHRoKSAvIDIwMDAgKiBmb250U2l6ZSAvIGZvbnRTaXplU2NhbGU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZ2x5cGguaXNJbkZvbnQgfHwgZm9udC5taXNzaW5nRmlsZSkgewogICAgICAgICAgICAgIGlmIChzaW1wbGVGaWxsVGV4dCAmJiAhYWNjZW50KSB7CiAgICAgICAgICAgICAgICBjdHguZmlsbFRleHQoY2hhcmFjdGVyLCBzY2FsZWRYLCBzY2FsZWRZKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5wYWludENoYXIoY2hhcmFjdGVyLCBzY2FsZWRYLCBzY2FsZWRZLCBwYXR0ZXJuVHJhbnNmb3JtKTsKCiAgICAgICAgICAgICAgICBpZiAoYWNjZW50KSB7CiAgICAgICAgICAgICAgICAgIHNjYWxlZEFjY2VudFggPSBzY2FsZWRYICsgYWNjZW50Lm9mZnNldC54IC8gZm9udFNpemVTY2FsZTsKICAgICAgICAgICAgICAgICAgc2NhbGVkQWNjZW50WSA9IHNjYWxlZFkgLSBhY2NlbnQub2Zmc2V0LnkgLyBmb250U2l6ZVNjYWxlOwogICAgICAgICAgICAgICAgICB0aGlzLnBhaW50Q2hhcihhY2NlbnQuZm9udENoYXIsIHNjYWxlZEFjY2VudFgsIHNjYWxlZEFjY2VudFksIHBhdHRlcm5UcmFuc2Zvcm0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGNoYXJXaWR0aDsKCiAgICAgICAgICAgIGlmICh2ZXJ0aWNhbCkgewogICAgICAgICAgICAgIGNoYXJXaWR0aCA9IHdpZHRoICogd2lkdGhBZHZhbmNlU2NhbGUgLSBzcGFjaW5nICogZm9udERpcmVjdGlvbjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBjaGFyV2lkdGggPSB3aWR0aCAqIHdpZHRoQWR2YW5jZVNjYWxlICsgc3BhY2luZyAqIGZvbnREaXJlY3Rpb247CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHggKz0gY2hhcldpZHRoOwoKICAgICAgICAgICAgaWYgKHJlc3RvcmVOZWVkZWQpIHsKICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHZlcnRpY2FsKSB7CiAgICAgICAgICAgIGN1cnJlbnQueSAtPSB4OwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY3VycmVudC54ICs9IHggKiB0ZXh0SFNjYWxlOwogICAgICAgICAgfQoKICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgfSwKICAgICAgICBzaG93VHlwZTNUZXh0OiBmdW5jdGlvbiBDYW52YXNHcmFwaGljc19zaG93VHlwZTNUZXh0KGdseXBocykgewogICAgICAgICAgdmFyIGN0eCA9IHRoaXMuY3R4OwogICAgICAgICAgdmFyIGN1cnJlbnQgPSB0aGlzLmN1cnJlbnQ7CiAgICAgICAgICB2YXIgZm9udCA9IGN1cnJlbnQuZm9udDsKICAgICAgICAgIHZhciBmb250U2l6ZSA9IGN1cnJlbnQuZm9udFNpemU7CiAgICAgICAgICB2YXIgZm9udERpcmVjdGlvbiA9IGN1cnJlbnQuZm9udERpcmVjdGlvbjsKICAgICAgICAgIHZhciBzcGFjaW5nRGlyID0gZm9udC52ZXJ0aWNhbCA/IDEgOiAtMTsKICAgICAgICAgIHZhciBjaGFyU3BhY2luZyA9IGN1cnJlbnQuY2hhclNwYWNpbmc7CiAgICAgICAgICB2YXIgd29yZFNwYWNpbmcgPSBjdXJyZW50LndvcmRTcGFjaW5nOwogICAgICAgICAgdmFyIHRleHRIU2NhbGUgPSBjdXJyZW50LnRleHRIU2NhbGUgKiBmb250RGlyZWN0aW9uOwogICAgICAgICAgdmFyIGZvbnRNYXRyaXggPSBjdXJyZW50LmZvbnRNYXRyaXggfHwgX3V0aWwuRk9OVF9JREVOVElUWV9NQVRSSVg7CiAgICAgICAgICB2YXIgZ2x5cGhzTGVuZ3RoID0gZ2x5cGhzLmxlbmd0aDsKICAgICAgICAgIHZhciBpc1RleHRJbnZpc2libGUgPSBjdXJyZW50LnRleHRSZW5kZXJpbmdNb2RlID09PSBfdXRpbC5UZXh0UmVuZGVyaW5nTW9kZS5JTlZJU0lCTEU7CiAgICAgICAgICB2YXIgaSwgZ2x5cGgsIHdpZHRoLCBzcGFjaW5nTGVuZ3RoOwoKICAgICAgICAgIGlmIChpc1RleHRJbnZpc2libGUgfHwgZm9udFNpemUgPT09IDApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuX2NhY2hlZEdldFNpbmdsZVBpeGVsV2lkdGggPSBudWxsOwogICAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICAgIGN0eC50cmFuc2Zvcm0uYXBwbHkoY3R4LCBjdXJyZW50LnRleHRNYXRyaXgpOwogICAgICAgICAgY3R4LnRyYW5zbGF0ZShjdXJyZW50LngsIGN1cnJlbnQueSk7CiAgICAgICAgICBjdHguc2NhbGUodGV4dEhTY2FsZSwgZm9udERpcmVjdGlvbik7CgogICAgICAgICAgZm9yIChpID0gMDsgaSA8IGdseXBoc0xlbmd0aDsgKytpKSB7CiAgICAgICAgICAgIGdseXBoID0gZ2x5cGhzW2ldOwoKICAgICAgICAgICAgaWYgKCgwLCBfdXRpbC5pc051bSkoZ2x5cGgpKSB7CiAgICAgICAgICAgICAgc3BhY2luZ0xlbmd0aCA9IHNwYWNpbmdEaXIgKiBnbHlwaCAqIGZvbnRTaXplIC8gMTAwMDsKICAgICAgICAgICAgICB0aGlzLmN0eC50cmFuc2xhdGUoc3BhY2luZ0xlbmd0aCwgMCk7CiAgICAgICAgICAgICAgY3VycmVudC54ICs9IHNwYWNpbmdMZW5ndGggKiB0ZXh0SFNjYWxlOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgc3BhY2luZyA9IChnbHlwaC5pc1NwYWNlID8gd29yZFNwYWNpbmcgOiAwKSArIGNoYXJTcGFjaW5nOwogICAgICAgICAgICB2YXIgb3BlcmF0b3JMaXN0ID0gZm9udC5jaGFyUHJvY09wZXJhdG9yTGlzdFtnbHlwaC5vcGVyYXRvckxpc3RJZF07CgogICAgICAgICAgICBpZiAoIW9wZXJhdG9yTGlzdCkgewogICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiVHlwZTMgY2hhcmFjdGVyIFwiIi5jb25jYXQoZ2x5cGgub3BlcmF0b3JMaXN0SWQsICJcIiBpcyBub3QgYXZhaWxhYmxlLiIpKTsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5wcm9jZXNzaW5nVHlwZTMgPSBnbHlwaDsKICAgICAgICAgICAgdGhpcy5zYXZlKCk7CiAgICAgICAgICAgIGN0eC5zY2FsZShmb250U2l6ZSwgZm9udFNpemUpOwogICAgICAgICAgICBjdHgudHJhbnNmb3JtLmFwcGx5KGN0eCwgZm9udE1hdHJpeCk7CiAgICAgICAgICAgIHRoaXMuZXhlY3V0ZU9wZXJhdG9yTGlzdChvcGVyYXRvckxpc3QpOwogICAgICAgICAgICB0aGlzLnJlc3RvcmUoKTsKCiAgICAgICAgICAgIHZhciB0cmFuc2Zvcm1lZCA9IF91dGlsLlV0aWwuYXBwbHlUcmFuc2Zvcm0oW2dseXBoLndpZHRoLCAwXSwgZm9udE1hdHJpeCk7CgogICAgICAgICAgICB3aWR0aCA9IHRyYW5zZm9ybWVkWzBdICogZm9udFNpemUgKyBzcGFjaW5nOwogICAgICAgICAgICBjdHgudHJhbnNsYXRlKHdpZHRoLCAwKTsKICAgICAgICAgICAgY3VycmVudC54ICs9IHdpZHRoICogdGV4dEhTY2FsZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgICAgdGhpcy5wcm9jZXNzaW5nVHlwZTMgPSBudWxsOwogICAgICAgIH0sCiAgICAgICAgc2V0Q2hhcldpZHRoOiBmdW5jdGlvbiBDYW52YXNHcmFwaGljc19zZXRDaGFyV2lkdGgoeFdpZHRoLCB5V2lkdGgpIHt9LAogICAgICAgIHNldENoYXJXaWR0aEFuZEJvdW5kczogZnVuY3Rpb24gQ2FudmFzR3JhcGhpY3Nfc2V0Q2hhcldpZHRoQW5kQm91bmRzKHhXaWR0aCwgeVdpZHRoLCBsbHgsIGxseSwgdXJ4LCB1cnkpIHsKICAgICAgICAgIHRoaXMuY3R4LnJlY3QobGx4LCBsbHksIHVyeCAtIGxseCwgdXJ5IC0gbGx5KTsKICAgICAgICAgIHRoaXMuY2xpcCgpOwogICAgICAgICAgdGhpcy5lbmRQYXRoKCk7CiAgICAgICAgfSwKICAgICAgICBnZXRDb2xvck5fUGF0dGVybjogZnVuY3Rpb24gQ2FudmFzR3JhcGhpY3NfZ2V0Q29sb3JOX1BhdHRlcm4oSVIpIHsKICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAgICAgdmFyIHBhdHRlcm47CgogICAgICAgICAgaWYgKElSWzBdID09PSAiVGlsaW5nUGF0dGVybiIpIHsKICAgICAgICAgICAgdmFyIGNvbG9yID0gSVJbMV07CiAgICAgICAgICAgIHZhciBiYXNlVHJhbnNmb3JtID0gdGhpcy5iYXNlVHJhbnNmb3JtIHx8IHRoaXMuY3R4Lm1vekN1cnJlbnRUcmFuc2Zvcm0uc2xpY2UoKTsKICAgICAgICAgICAgdmFyIGNhbnZhc0dyYXBoaWNzRmFjdG9yeSA9IHsKICAgICAgICAgICAgICBjcmVhdGVDYW52YXNHcmFwaGljczogZnVuY3Rpb24gY3JlYXRlQ2FudmFzR3JhcGhpY3MoY3R4KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IENhbnZhc0dyYXBoaWNzKGN0eCwgX3RoaXMuY29tbW9uT2JqcywgX3RoaXMub2JqcywgX3RoaXMuY2FudmFzRmFjdG9yeSwgX3RoaXMud2ViR0xDb250ZXh0KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHBhdHRlcm4gPSBuZXcgX3BhdHRlcm5faGVscGVyLlRpbGluZ1BhdHRlcm4oSVIsIGNvbG9yLCB0aGlzLmN0eCwgY2FudmFzR3JhcGhpY3NGYWN0b3J5LCBiYXNlVHJhbnNmb3JtKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHBhdHRlcm4gPSAoMCwgX3BhdHRlcm5faGVscGVyLmdldFNoYWRpbmdQYXR0ZXJuRnJvbUlSKShJUik7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHBhdHRlcm47CiAgICAgICAgfSwKICAgICAgICBzZXRTdHJva2VDb2xvck46IGZ1bmN0aW9uIENhbnZhc0dyYXBoaWNzX3NldFN0cm9rZUNvbG9yTigpIHsKICAgICAgICAgIHRoaXMuY3VycmVudC5zdHJva2VDb2xvciA9IHRoaXMuZ2V0Q29sb3JOX1BhdHRlcm4oYXJndW1lbnRzKTsKICAgICAgICB9LAogICAgICAgIHNldEZpbGxDb2xvck46IGZ1bmN0aW9uIENhbnZhc0dyYXBoaWNzX3NldEZpbGxDb2xvck4oKSB7CiAgICAgICAgICB0aGlzLmN1cnJlbnQuZmlsbENvbG9yID0gdGhpcy5nZXRDb2xvck5fUGF0dGVybihhcmd1bWVudHMpOwogICAgICAgICAgdGhpcy5jdXJyZW50LnBhdHRlcm5GaWxsID0gdHJ1ZTsKICAgICAgICB9LAogICAgICAgIHNldFN0cm9rZVJHQkNvbG9yOiBmdW5jdGlvbiBDYW52YXNHcmFwaGljc19zZXRTdHJva2VSR0JDb2xvcihyLCBnLCBiKSB7CiAgICAgICAgICB2YXIgY29sb3IgPSBfdXRpbC5VdGlsLm1ha2VDc3NSZ2IociwgZywgYik7CgogICAgICAgICAgdGhpcy5jdHguc3Ryb2tlU3R5bGUgPSBjb2xvcjsKICAgICAgICAgIHRoaXMuY3VycmVudC5zdHJva2VDb2xvciA9IGNvbG9yOwogICAgICAgIH0sCiAgICAgICAgc2V0RmlsbFJHQkNvbG9yOiBmdW5jdGlvbiBDYW52YXNHcmFwaGljc19zZXRGaWxsUkdCQ29sb3IociwgZywgYikgewogICAgICAgICAgdmFyIGNvbG9yID0gX3V0aWwuVXRpbC5tYWtlQ3NzUmdiKHIsIGcsIGIpOwoKICAgICAgICAgIHRoaXMuY3R4LmZpbGxTdHlsZSA9IGNvbG9yOwogICAgICAgICAgdGhpcy5jdXJyZW50LmZpbGxDb2xvciA9IGNvbG9yOwogICAgICAgICAgdGhpcy5jdXJyZW50LnBhdHRlcm5GaWxsID0gZmFsc2U7CiAgICAgICAgfSwKICAgICAgICBzaGFkaW5nRmlsbDogZnVuY3Rpb24gQ2FudmFzR3JhcGhpY3Nfc2hhZGluZ0ZpbGwocGF0dGVybklSKSB7CiAgICAgICAgICB2YXIgY3R4ID0gdGhpcy5jdHg7CiAgICAgICAgICB0aGlzLnNhdmUoKTsKICAgICAgICAgIHZhciBwYXR0ZXJuID0gKDAsIF9wYXR0ZXJuX2hlbHBlci5nZXRTaGFkaW5nUGF0dGVybkZyb21JUikocGF0dGVybklSKTsKICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBwYXR0ZXJuLmdldFBhdHRlcm4oY3R4LCB0aGlzLCB0cnVlKTsKICAgICAgICAgIHZhciBpbnYgPSBjdHgubW96Q3VycmVudFRyYW5zZm9ybUludmVyc2U7CgogICAgICAgICAgaWYgKGludikgewogICAgICAgICAgICB2YXIgY2FudmFzID0gY3R4LmNhbnZhczsKICAgICAgICAgICAgdmFyIHdpZHRoID0gY2FudmFzLndpZHRoOwogICAgICAgICAgICB2YXIgaGVpZ2h0ID0gY2FudmFzLmhlaWdodDsKCiAgICAgICAgICAgIHZhciBibCA9IF91dGlsLlV0aWwuYXBwbHlUcmFuc2Zvcm0oWzAsIDBdLCBpbnYpOwoKICAgICAgICAgICAgdmFyIGJyID0gX3V0aWwuVXRpbC5hcHBseVRyYW5zZm9ybShbMCwgaGVpZ2h0XSwgaW52KTsKCiAgICAgICAgICAgIHZhciB1bCA9IF91dGlsLlV0aWwuYXBwbHlUcmFuc2Zvcm0oW3dpZHRoLCAwXSwgaW52KTsKCiAgICAgICAgICAgIHZhciB1ciA9IF91dGlsLlV0aWwuYXBwbHlUcmFuc2Zvcm0oW3dpZHRoLCBoZWlnaHRdLCBpbnYpOwoKICAgICAgICAgICAgdmFyIHgwID0gTWF0aC5taW4oYmxbMF0sIGJyWzBdLCB1bFswXSwgdXJbMF0pOwogICAgICAgICAgICB2YXIgeTAgPSBNYXRoLm1pbihibFsxXSwgYnJbMV0sIHVsWzFdLCB1clsxXSk7CiAgICAgICAgICAgIHZhciB4MSA9IE1hdGgubWF4KGJsWzBdLCBiclswXSwgdWxbMF0sIHVyWzBdKTsKICAgICAgICAgICAgdmFyIHkxID0gTWF0aC5tYXgoYmxbMV0sIGJyWzFdLCB1bFsxXSwgdXJbMV0pOwogICAgICAgICAgICB0aGlzLmN0eC5maWxsUmVjdCh4MCwgeTAsIHgxIC0geDAsIHkxIC0geTApOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5jdHguZmlsbFJlY3QoLTFlMTAsIC0xZTEwLCAyZTEwLCAyZTEwKTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnJlc3RvcmUoKTsKICAgICAgICB9LAogICAgICAgIGJlZ2luSW5saW5lSW1hZ2U6IGZ1bmN0aW9uIENhbnZhc0dyYXBoaWNzX2JlZ2luSW5saW5lSW1hZ2UoKSB7CiAgICAgICAgICAoMCwgX3V0aWwudW5yZWFjaGFibGUpKCJTaG91bGQgbm90IGNhbGwgYmVnaW5JbmxpbmVJbWFnZSIpOwogICAgICAgIH0sCiAgICAgICAgYmVnaW5JbWFnZURhdGE6IGZ1bmN0aW9uIENhbnZhc0dyYXBoaWNzX2JlZ2luSW1hZ2VEYXRhKCkgewogICAgICAgICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgiU2hvdWxkIG5vdCBjYWxsIGJlZ2luSW1hZ2VEYXRhIik7CiAgICAgICAgfSwKICAgICAgICBwYWludEZvcm1YT2JqZWN0QmVnaW46IGZ1bmN0aW9uIENhbnZhc0dyYXBoaWNzX3BhaW50Rm9ybVhPYmplY3RCZWdpbihtYXRyaXgsIGJib3gpIHsKICAgICAgICAgIHRoaXMuc2F2ZSgpOwogICAgICAgICAgdGhpcy5iYXNlVHJhbnNmb3JtU3RhY2sucHVzaCh0aGlzLmJhc2VUcmFuc2Zvcm0pOwoKICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KG1hdHJpeCkgJiYgbWF0cml4Lmxlbmd0aCA9PT0gNikgewogICAgICAgICAgICB0aGlzLnRyYW5zZm9ybS5hcHBseSh0aGlzLCBtYXRyaXgpOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuYmFzZVRyYW5zZm9ybSA9IHRoaXMuY3R4Lm1vekN1cnJlbnRUcmFuc2Zvcm07CgogICAgICAgICAgaWYgKGJib3gpIHsKICAgICAgICAgICAgdmFyIHdpZHRoID0gYmJveFsyXSAtIGJib3hbMF07CiAgICAgICAgICAgIHZhciBoZWlnaHQgPSBiYm94WzNdIC0gYmJveFsxXTsKICAgICAgICAgICAgdGhpcy5jdHgucmVjdChiYm94WzBdLCBiYm94WzFdLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgdGhpcy5jbGlwKCk7CiAgICAgICAgICAgIHRoaXMuZW5kUGF0aCgpOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgcGFpbnRGb3JtWE9iamVjdEVuZDogZnVuY3Rpb24gQ2FudmFzR3JhcGhpY3NfcGFpbnRGb3JtWE9iamVjdEVuZCgpIHsKICAgICAgICAgIHRoaXMucmVzdG9yZSgpOwogICAgICAgICAgdGhpcy5iYXNlVHJhbnNmb3JtID0gdGhpcy5iYXNlVHJhbnNmb3JtU3RhY2sucG9wKCk7CiAgICAgICAgfSwKICAgICAgICBiZWdpbkdyb3VwOiBmdW5jdGlvbiBDYW52YXNHcmFwaGljc19iZWdpbkdyb3VwKGdyb3VwKSB7CiAgICAgICAgICB0aGlzLnNhdmUoKTsKICAgICAgICAgIHZhciBjdXJyZW50Q3R4ID0gdGhpcy5jdHg7CgogICAgICAgICAgaWYgKCFncm91cC5pc29sYXRlZCkgewogICAgICAgICAgICAoMCwgX3V0aWwuaW5mbykoIlRPRE86IFN1cHBvcnQgbm9uLWlzb2xhdGVkIGdyb3Vwcy4iKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZ3JvdXAua25vY2tvdXQpIHsKICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJLbm9ja291dCBncm91cHMgbm90IHN1cHBvcnRlZC4iKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgY3VycmVudFRyYW5zZm9ybSA9IGN1cnJlbnRDdHgubW96Q3VycmVudFRyYW5zZm9ybTsKCiAgICAgICAgICBpZiAoZ3JvdXAubWF0cml4KSB7CiAgICAgICAgICAgIGN1cnJlbnRDdHgudHJhbnNmb3JtLmFwcGx5KGN1cnJlbnRDdHgsIGdyb3VwLm1hdHJpeCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCFncm91cC5iYm94KSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQm91bmRpbmcgYm94IGlzIHJlcXVpcmVkLiIpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBib3VuZHMgPSBfdXRpbC5VdGlsLmdldEF4aWFsQWxpZ25lZEJvdW5kaW5nQm94KGdyb3VwLmJib3gsIGN1cnJlbnRDdHgubW96Q3VycmVudFRyYW5zZm9ybSk7CgogICAgICAgICAgdmFyIGNhbnZhc0JvdW5kcyA9IFswLCAwLCBjdXJyZW50Q3R4LmNhbnZhcy53aWR0aCwgY3VycmVudEN0eC5jYW52YXMuaGVpZ2h0XTsKICAgICAgICAgIGJvdW5kcyA9IF91dGlsLlV0aWwuaW50ZXJzZWN0KGJvdW5kcywgY2FudmFzQm91bmRzKSB8fCBbMCwgMCwgMCwgMF07CiAgICAgICAgICB2YXIgb2Zmc2V0WCA9IE1hdGguZmxvb3IoYm91bmRzWzBdKTsKICAgICAgICAgIHZhciBvZmZzZXRZID0gTWF0aC5mbG9vcihib3VuZHNbMV0pOwogICAgICAgICAgdmFyIGRyYXduV2lkdGggPSBNYXRoLm1heChNYXRoLmNlaWwoYm91bmRzWzJdKSAtIG9mZnNldFgsIDEpOwogICAgICAgICAgdmFyIGRyYXduSGVpZ2h0ID0gTWF0aC5tYXgoTWF0aC5jZWlsKGJvdW5kc1szXSkgLSBvZmZzZXRZLCAxKTsKICAgICAgICAgIHZhciBzY2FsZVggPSAxLAogICAgICAgICAgICBzY2FsZVkgPSAxOwoKICAgICAgICAgIGlmIChkcmF3bldpZHRoID4gTUFYX0dST1VQX1NJWkUpIHsKICAgICAgICAgICAgc2NhbGVYID0gZHJhd25XaWR0aCAvIE1BWF9HUk9VUF9TSVpFOwogICAgICAgICAgICBkcmF3bldpZHRoID0gTUFYX0dST1VQX1NJWkU7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGRyYXduSGVpZ2h0ID4gTUFYX0dST1VQX1NJWkUpIHsKICAgICAgICAgICAgc2NhbGVZID0gZHJhd25IZWlnaHQgLyBNQVhfR1JPVVBfU0laRTsKICAgICAgICAgICAgZHJhd25IZWlnaHQgPSBNQVhfR1JPVVBfU0laRTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgY2FjaGVJZCA9ICJncm91cEF0IiArIHRoaXMuZ3JvdXBMZXZlbDsKCiAgICAgICAgICBpZiAoZ3JvdXAuc21hc2spIHsKICAgICAgICAgICAgY2FjaGVJZCArPSAiX3NtYXNrXyIgKyB0aGlzLnNtYXNrQ291bnRlcisrICUgMjsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgc2NyYXRjaENhbnZhcyA9IHRoaXMuY2FjaGVkQ2FudmFzZXMuZ2V0Q2FudmFzKGNhY2hlSWQsIGRyYXduV2lkdGgsIGRyYXduSGVpZ2h0LCB0cnVlKTsKICAgICAgICAgIHZhciBncm91cEN0eCA9IHNjcmF0Y2hDYW52YXMuY29udGV4dDsKICAgICAgICAgIGdyb3VwQ3R4LnNjYWxlKDEgLyBzY2FsZVgsIDEgLyBzY2FsZVkpOwogICAgICAgICAgZ3JvdXBDdHgudHJhbnNsYXRlKC1vZmZzZXRYLCAtb2Zmc2V0WSk7CiAgICAgICAgICBncm91cEN0eC50cmFuc2Zvcm0uYXBwbHkoZ3JvdXBDdHgsIGN1cnJlbnRUcmFuc2Zvcm0pOwoKICAgICAgICAgIGlmIChncm91cC5zbWFzaykgewogICAgICAgICAgICB0aGlzLnNtYXNrU3RhY2sucHVzaCh7CiAgICAgICAgICAgICAgY2FudmFzOiBzY3JhdGNoQ2FudmFzLmNhbnZhcywKICAgICAgICAgICAgICBjb250ZXh0OiBncm91cEN0eCwKICAgICAgICAgICAgICBvZmZzZXRYOiBvZmZzZXRYLAogICAgICAgICAgICAgIG9mZnNldFk6IG9mZnNldFksCiAgICAgICAgICAgICAgc2NhbGVYOiBzY2FsZVgsCiAgICAgICAgICAgICAgc2NhbGVZOiBzY2FsZVksCiAgICAgICAgICAgICAgc3VidHlwZTogZ3JvdXAuc21hc2suc3VidHlwZSwKICAgICAgICAgICAgICBiYWNrZHJvcDogZ3JvdXAuc21hc2suYmFja2Ryb3AsCiAgICAgICAgICAgICAgdHJhbnNmZXJNYXA6IGdyb3VwLnNtYXNrLnRyYW5zZmVyTWFwIHx8IG51bGwsCiAgICAgICAgICAgICAgc3RhcnRUcmFuc2Zvcm1JbnZlcnNlOiBudWxsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY3VycmVudEN0eC5zZXRUcmFuc2Zvcm0oMSwgMCwgMCwgMSwgMCwgMCk7CiAgICAgICAgICAgIGN1cnJlbnRDdHgudHJhbnNsYXRlKG9mZnNldFgsIG9mZnNldFkpOwogICAgICAgICAgICBjdXJyZW50Q3R4LnNjYWxlKHNjYWxlWCwgc2NhbGVZKTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb3B5Q3R4U3RhdGUoY3VycmVudEN0eCwgZ3JvdXBDdHgpOwogICAgICAgICAgdGhpcy5jdHggPSBncm91cEN0eDsKICAgICAgICAgIHRoaXMuc2V0R1N0YXRlKFtbIkJNIiwgInNvdXJjZS1vdmVyIl0sIFsiY2EiLCAxXSwgWyJDQSIsIDFdXSk7CiAgICAgICAgICB0aGlzLmdyb3VwU3RhY2sucHVzaChjdXJyZW50Q3R4KTsKICAgICAgICAgIHRoaXMuZ3JvdXBMZXZlbCsrOwogICAgICAgICAgdGhpcy5jdXJyZW50LmFjdGl2ZVNNYXNrID0gbnVsbDsKICAgICAgICB9LAogICAgICAgIGVuZEdyb3VwOiBmdW5jdGlvbiBDYW52YXNHcmFwaGljc19lbmRHcm91cChncm91cCkgewogICAgICAgICAgdGhpcy5ncm91cExldmVsLS07CiAgICAgICAgICB2YXIgZ3JvdXBDdHggPSB0aGlzLmN0eDsKICAgICAgICAgIHRoaXMuY3R4ID0gdGhpcy5ncm91cFN0YWNrLnBvcCgpOwoKICAgICAgICAgIGlmICh0aGlzLmN0eC5pbWFnZVNtb290aGluZ0VuYWJsZWQgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICB0aGlzLmN0eC5pbWFnZVNtb290aGluZ0VuYWJsZWQgPSBmYWxzZTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuY3R4Lm1vekltYWdlU21vb3RoaW5nRW5hYmxlZCA9IGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChncm91cC5zbWFzaykgewogICAgICAgICAgICB0aGlzLnRlbXBTTWFzayA9IHRoaXMuc21hc2tTdGFjay5wb3AoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuY3R4LmRyYXdJbWFnZShncm91cEN0eC5jYW52YXMsIDAsIDApOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMucmVzdG9yZSgpOwogICAgICAgIH0sCiAgICAgICAgYmVnaW5Bbm5vdGF0aW9uczogZnVuY3Rpb24gQ2FudmFzR3JhcGhpY3NfYmVnaW5Bbm5vdGF0aW9ucygpIHsKICAgICAgICAgIHRoaXMuc2F2ZSgpOwoKICAgICAgICAgIGlmICh0aGlzLmJhc2VUcmFuc2Zvcm0pIHsKICAgICAgICAgICAgdGhpcy5jdHguc2V0VHJhbnNmb3JtLmFwcGx5KHRoaXMuY3R4LCB0aGlzLmJhc2VUcmFuc2Zvcm0pOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgZW5kQW5ub3RhdGlvbnM6IGZ1bmN0aW9uIENhbnZhc0dyYXBoaWNzX2VuZEFubm90YXRpb25zKCkgewogICAgICAgICAgdGhpcy5yZXN0b3JlKCk7CiAgICAgICAgfSwKICAgICAgICBiZWdpbkFubm90YXRpb246IGZ1bmN0aW9uIENhbnZhc0dyYXBoaWNzX2JlZ2luQW5ub3RhdGlvbihyZWN0LCB0cmFuc2Zvcm0sIG1hdHJpeCkgewogICAgICAgICAgdGhpcy5zYXZlKCk7CiAgICAgICAgICByZXNldEN0eFRvRGVmYXVsdCh0aGlzLmN0eCk7CiAgICAgICAgICB0aGlzLmN1cnJlbnQgPSBuZXcgQ2FudmFzRXh0cmFTdGF0ZSgpOwoKICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHJlY3QpICYmIHJlY3QubGVuZ3RoID09PSA0KSB7CiAgICAgICAgICAgIHZhciB3aWR0aCA9IHJlY3RbMl0gLSByZWN0WzBdOwogICAgICAgICAgICB2YXIgaGVpZ2h0ID0gcmVjdFszXSAtIHJlY3RbMV07CiAgICAgICAgICAgIHRoaXMuY3R4LnJlY3QocmVjdFswXSwgcmVjdFsxXSwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgIHRoaXMuY2xpcCgpOwogICAgICAgICAgICB0aGlzLmVuZFBhdGgoKTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnRyYW5zZm9ybS5hcHBseSh0aGlzLCB0cmFuc2Zvcm0pOwogICAgICAgICAgdGhpcy50cmFuc2Zvcm0uYXBwbHkodGhpcywgbWF0cml4KTsKICAgICAgICB9LAogICAgICAgIGVuZEFubm90YXRpb246IGZ1bmN0aW9uIENhbnZhc0dyYXBoaWNzX2VuZEFubm90YXRpb24oKSB7CiAgICAgICAgICB0aGlzLnJlc3RvcmUoKTsKICAgICAgICB9LAogICAgICAgIHBhaW50SnBlZ1hPYmplY3Q6IGZ1bmN0aW9uIENhbnZhc0dyYXBoaWNzX3BhaW50SnBlZ1hPYmplY3Qob2JqSWQsIHcsIGgpIHsKICAgICAgICAgIHZhciBkb21JbWFnZSA9IHRoaXMucHJvY2Vzc2luZ1R5cGUzID8gdGhpcy5jb21tb25PYmpzLmdldChvYmpJZCkgOiB0aGlzLm9ianMuZ2V0KG9iaklkKTsKCiAgICAgICAgICBpZiAoIWRvbUltYWdlKSB7CiAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiRGVwZW5kZW50IGltYWdlIGlzbid0IHJlYWR5IHlldCIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5zYXZlKCk7CiAgICAgICAgICB2YXIgY3R4ID0gdGhpcy5jdHg7CiAgICAgICAgICBjdHguc2NhbGUoMSAvIHcsIC0xIC8gaCk7CiAgICAgICAgICBjdHguZHJhd0ltYWdlKGRvbUltYWdlLCAwLCAwLCBkb21JbWFnZS53aWR0aCwgZG9tSW1hZ2UuaGVpZ2h0LCAwLCAtaCwgdywgaCk7CgogICAgICAgICAgaWYgKHRoaXMuaW1hZ2VMYXllcikgewogICAgICAgICAgICB2YXIgY3VycmVudFRyYW5zZm9ybSA9IGN0eC5tb3pDdXJyZW50VHJhbnNmb3JtSW52ZXJzZTsKICAgICAgICAgICAgdmFyIHBvc2l0aW9uID0gdGhpcy5nZXRDYW52YXNQb3NpdGlvbigwLCAwKTsKICAgICAgICAgICAgdGhpcy5pbWFnZUxheWVyLmFwcGVuZEltYWdlKHsKICAgICAgICAgICAgICBvYmpJZDogb2JqSWQsCiAgICAgICAgICAgICAgbGVmdDogcG9zaXRpb25bMF0sCiAgICAgICAgICAgICAgdG9wOiBwb3NpdGlvblsxXSwKICAgICAgICAgICAgICB3aWR0aDogdyAvIGN1cnJlbnRUcmFuc2Zvcm1bMF0sCiAgICAgICAgICAgICAgaGVpZ2h0OiBoIC8gY3VycmVudFRyYW5zZm9ybVszXQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnJlc3RvcmUoKTsKICAgICAgICB9LAogICAgICAgIHBhaW50SW1hZ2VNYXNrWE9iamVjdDogZnVuY3Rpb24gQ2FudmFzR3JhcGhpY3NfcGFpbnRJbWFnZU1hc2tYT2JqZWN0KGltZykgewogICAgICAgICAgdmFyIGN0eCA9IHRoaXMuY3R4OwogICAgICAgICAgdmFyIHdpZHRoID0gaW1nLndpZHRoLAogICAgICAgICAgICBoZWlnaHQgPSBpbWcuaGVpZ2h0OwogICAgICAgICAgdmFyIGZpbGxDb2xvciA9IHRoaXMuY3VycmVudC5maWxsQ29sb3I7CiAgICAgICAgICB2YXIgaXNQYXR0ZXJuRmlsbCA9IHRoaXMuY3VycmVudC5wYXR0ZXJuRmlsbDsKICAgICAgICAgIHZhciBnbHlwaCA9IHRoaXMucHJvY2Vzc2luZ1R5cGUzOwoKICAgICAgICAgIGlmIChDT01QSUxFX1RZUEUzX0dMWVBIUyAmJiBnbHlwaCAmJiBnbHlwaC5jb21waWxlZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGlmICh3aWR0aCA8PSBNQVhfU0laRV9UT19DT01QSUxFICYmIGhlaWdodCA8PSBNQVhfU0laRV9UT19DT01QSUxFKSB7CiAgICAgICAgICAgICAgZ2x5cGguY29tcGlsZWQgPSBjb21waWxlVHlwZTNHbHlwaCh7CiAgICAgICAgICAgICAgICBkYXRhOiBpbWcuZGF0YSwKICAgICAgICAgICAgICAgIHdpZHRoOiB3aWR0aCwKICAgICAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZ2x5cGguY29tcGlsZWQgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGdseXBoICYmIGdseXBoLmNvbXBpbGVkKSB7CiAgICAgICAgICAgIGdseXBoLmNvbXBpbGVkKGN0eCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgbWFza0NhbnZhcyA9IHRoaXMuY2FjaGVkQ2FudmFzZXMuZ2V0Q2FudmFzKCJtYXNrQ2FudmFzIiwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICB2YXIgbWFza0N0eCA9IG1hc2tDYW52YXMuY29udGV4dDsKICAgICAgICAgIG1hc2tDdHguc2F2ZSgpOwogICAgICAgICAgcHV0QmluYXJ5SW1hZ2VNYXNrKG1hc2tDdHgsIGltZyk7CiAgICAgICAgICBtYXNrQ3R4Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9ICJzb3VyY2UtaW4iOwogICAgICAgICAgbWFza0N0eC5maWxsU3R5bGUgPSBpc1BhdHRlcm5GaWxsID8gZmlsbENvbG9yLmdldFBhdHRlcm4obWFza0N0eCwgdGhpcykgOiBmaWxsQ29sb3I7CiAgICAgICAgICBtYXNrQ3R4LmZpbGxSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgbWFza0N0eC5yZXN0b3JlKCk7CiAgICAgICAgICB0aGlzLnBhaW50SW5saW5lSW1hZ2VYT2JqZWN0KG1hc2tDYW52YXMuY2FudmFzKTsKICAgICAgICB9LAogICAgICAgIHBhaW50SW1hZ2VNYXNrWE9iamVjdFJlcGVhdDogZnVuY3Rpb24gQ2FudmFzR3JhcGhpY3NfcGFpbnRJbWFnZU1hc2tYT2JqZWN0UmVwZWF0KGltZ0RhdGEsIHNjYWxlWCwgc2NhbGVZLCBwb3NpdGlvbnMpIHsKICAgICAgICAgIHZhciB3aWR0aCA9IGltZ0RhdGEud2lkdGg7CiAgICAgICAgICB2YXIgaGVpZ2h0ID0gaW1nRGF0YS5oZWlnaHQ7CiAgICAgICAgICB2YXIgZmlsbENvbG9yID0gdGhpcy5jdXJyZW50LmZpbGxDb2xvcjsKICAgICAgICAgIHZhciBpc1BhdHRlcm5GaWxsID0gdGhpcy5jdXJyZW50LnBhdHRlcm5GaWxsOwogICAgICAgICAgdmFyIG1hc2tDYW52YXMgPSB0aGlzLmNhY2hlZENhbnZhc2VzLmdldENhbnZhcygibWFza0NhbnZhcyIsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgdmFyIG1hc2tDdHggPSBtYXNrQ2FudmFzLmNvbnRleHQ7CiAgICAgICAgICBtYXNrQ3R4LnNhdmUoKTsKICAgICAgICAgIHB1dEJpbmFyeUltYWdlTWFzayhtYXNrQ3R4LCBpbWdEYXRhKTsKICAgICAgICAgIG1hc2tDdHguZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gInNvdXJjZS1pbiI7CiAgICAgICAgICBtYXNrQ3R4LmZpbGxTdHlsZSA9IGlzUGF0dGVybkZpbGwgPyBmaWxsQ29sb3IuZ2V0UGF0dGVybihtYXNrQ3R4LCB0aGlzKSA6IGZpbGxDb2xvcjsKICAgICAgICAgIG1hc2tDdHguZmlsbFJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICBtYXNrQ3R4LnJlc3RvcmUoKTsKICAgICAgICAgIHZhciBjdHggPSB0aGlzLmN0eDsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBwb3NpdGlvbnMubGVuZ3RoOyBpIDwgaWk7IGkgKz0gMikgewogICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICBjdHgudHJhbnNmb3JtKHNjYWxlWCwgMCwgMCwgc2NhbGVZLCBwb3NpdGlvbnNbaV0sIHBvc2l0aW9uc1tpICsgMV0pOwogICAgICAgICAgICBjdHguc2NhbGUoMSwgLTEpOwogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG1hc2tDYW52YXMuY2FudmFzLCAwLCAwLCB3aWR0aCwgaGVpZ2h0LCAwLCAtMSwgMSwgMSk7CiAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBwYWludEltYWdlTWFza1hPYmplY3RHcm91cDogZnVuY3Rpb24gQ2FudmFzR3JhcGhpY3NfcGFpbnRJbWFnZU1hc2tYT2JqZWN0R3JvdXAoaW1hZ2VzKSB7CiAgICAgICAgICB2YXIgY3R4ID0gdGhpcy5jdHg7CiAgICAgICAgICB2YXIgZmlsbENvbG9yID0gdGhpcy5jdXJyZW50LmZpbGxDb2xvcjsKICAgICAgICAgIHZhciBpc1BhdHRlcm5GaWxsID0gdGhpcy5jdXJyZW50LnBhdHRlcm5GaWxsOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGltYWdlcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgIHZhciBpbWFnZSA9IGltYWdlc1tpXTsKICAgICAgICAgICAgdmFyIHdpZHRoID0gaW1hZ2Uud2lkdGgsCiAgICAgICAgICAgICAgaGVpZ2h0ID0gaW1hZ2UuaGVpZ2h0OwogICAgICAgICAgICB2YXIgbWFza0NhbnZhcyA9IHRoaXMuY2FjaGVkQ2FudmFzZXMuZ2V0Q2FudmFzKCJtYXNrQ2FudmFzIiwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgIHZhciBtYXNrQ3R4ID0gbWFza0NhbnZhcy5jb250ZXh0OwogICAgICAgICAgICBtYXNrQ3R4LnNhdmUoKTsKICAgICAgICAgICAgcHV0QmluYXJ5SW1hZ2VNYXNrKG1hc2tDdHgsIGltYWdlKTsKICAgICAgICAgICAgbWFza0N0eC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSAic291cmNlLWluIjsKICAgICAgICAgICAgbWFza0N0eC5maWxsU3R5bGUgPSBpc1BhdHRlcm5GaWxsID8gZmlsbENvbG9yLmdldFBhdHRlcm4obWFza0N0eCwgdGhpcykgOiBmaWxsQ29sb3I7CiAgICAgICAgICAgIG1hc2tDdHguZmlsbFJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgIG1hc2tDdHgucmVzdG9yZSgpOwogICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICBjdHgudHJhbnNmb3JtLmFwcGx5KGN0eCwgaW1hZ2UudHJhbnNmb3JtKTsKICAgICAgICAgICAgY3R4LnNjYWxlKDEsIC0xKTsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShtYXNrQ2FudmFzLmNhbnZhcywgMCwgMCwgd2lkdGgsIGhlaWdodCwgMCwgLTEsIDEsIDEpOwogICAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgcGFpbnRJbWFnZVhPYmplY3Q6IGZ1bmN0aW9uIENhbnZhc0dyYXBoaWNzX3BhaW50SW1hZ2VYT2JqZWN0KG9iaklkKSB7CiAgICAgICAgICB2YXIgaW1nRGF0YSA9IHRoaXMucHJvY2Vzc2luZ1R5cGUzID8gdGhpcy5jb21tb25PYmpzLmdldChvYmpJZCkgOiB0aGlzLm9ianMuZ2V0KG9iaklkKTsKCiAgICAgICAgICBpZiAoIWltZ0RhdGEpIHsKICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJEZXBlbmRlbnQgaW1hZ2UgaXNuJ3QgcmVhZHkgeWV0Iik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnBhaW50SW5saW5lSW1hZ2VYT2JqZWN0KGltZ0RhdGEpOwogICAgICAgIH0sCiAgICAgICAgcGFpbnRJbWFnZVhPYmplY3RSZXBlYXQ6IGZ1bmN0aW9uIENhbnZhc0dyYXBoaWNzX3BhaW50SW1hZ2VYT2JqZWN0UmVwZWF0KG9iaklkLCBzY2FsZVgsIHNjYWxlWSwgcG9zaXRpb25zKSB7CiAgICAgICAgICB2YXIgaW1nRGF0YSA9IHRoaXMucHJvY2Vzc2luZ1R5cGUzID8gdGhpcy5jb21tb25PYmpzLmdldChvYmpJZCkgOiB0aGlzLm9ianMuZ2V0KG9iaklkKTsKCiAgICAgICAgICBpZiAoIWltZ0RhdGEpIHsKICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJEZXBlbmRlbnQgaW1hZ2UgaXNuJ3QgcmVhZHkgeWV0Iik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgd2lkdGggPSBpbWdEYXRhLndpZHRoOwogICAgICAgICAgdmFyIGhlaWdodCA9IGltZ0RhdGEuaGVpZ2h0OwogICAgICAgICAgdmFyIG1hcCA9IFtdOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IHBvc2l0aW9ucy5sZW5ndGg7IGkgPCBpaTsgaSArPSAyKSB7CiAgICAgICAgICAgIG1hcC5wdXNoKHsKICAgICAgICAgICAgICB0cmFuc2Zvcm06IFtzY2FsZVgsIDAsIDAsIHNjYWxlWSwgcG9zaXRpb25zW2ldLCBwb3NpdGlvbnNbaSArIDFdXSwKICAgICAgICAgICAgICB4OiAwLAogICAgICAgICAgICAgIHk6IDAsCiAgICAgICAgICAgICAgdzogd2lkdGgsCiAgICAgICAgICAgICAgaDogaGVpZ2h0CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMucGFpbnRJbmxpbmVJbWFnZVhPYmplY3RHcm91cChpbWdEYXRhLCBtYXApOwogICAgICAgIH0sCiAgICAgICAgcGFpbnRJbmxpbmVJbWFnZVhPYmplY3Q6IGZ1bmN0aW9uIENhbnZhc0dyYXBoaWNzX3BhaW50SW5saW5lSW1hZ2VYT2JqZWN0KGltZ0RhdGEpIHsKICAgICAgICAgIHZhciB3aWR0aCA9IGltZ0RhdGEud2lkdGg7CiAgICAgICAgICB2YXIgaGVpZ2h0ID0gaW1nRGF0YS5oZWlnaHQ7CiAgICAgICAgICB2YXIgY3R4ID0gdGhpcy5jdHg7CiAgICAgICAgICB0aGlzLnNhdmUoKTsKICAgICAgICAgIGN0eC5zY2FsZSgxIC8gd2lkdGgsIC0xIC8gaGVpZ2h0KTsKICAgICAgICAgIHZhciBjdXJyZW50VHJhbnNmb3JtID0gY3R4Lm1vekN1cnJlbnRUcmFuc2Zvcm1JbnZlcnNlOwogICAgICAgICAgdmFyIGEgPSBjdXJyZW50VHJhbnNmb3JtWzBdLAogICAgICAgICAgICBiID0gY3VycmVudFRyYW5zZm9ybVsxXTsKICAgICAgICAgIHZhciB3aWR0aFNjYWxlID0gTWF0aC5tYXgoTWF0aC5zcXJ0KGEgKiBhICsgYiAqIGIpLCAxKTsKICAgICAgICAgIHZhciBjID0gY3VycmVudFRyYW5zZm9ybVsyXSwKICAgICAgICAgICAgZCA9IGN1cnJlbnRUcmFuc2Zvcm1bM107CiAgICAgICAgICB2YXIgaGVpZ2h0U2NhbGUgPSBNYXRoLm1heChNYXRoLnNxcnQoYyAqIGMgKyBkICogZCksIDEpOwogICAgICAgICAgdmFyIGltZ1RvUGFpbnQsIHRtcENhbnZhczsKCiAgICAgICAgICBpZiAodHlwZW9mIEhUTUxFbGVtZW50ID09PSAiZnVuY3Rpb24iICYmIGltZ0RhdGEgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCB8fCAhaW1nRGF0YS5kYXRhKSB7CiAgICAgICAgICAgIGltZ1RvUGFpbnQgPSBpbWdEYXRhOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdG1wQ2FudmFzID0gdGhpcy5jYWNoZWRDYW52YXNlcy5nZXRDYW52YXMoImlubGluZUltYWdlIiwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgIHZhciB0bXBDdHggPSB0bXBDYW52YXMuY29udGV4dDsKICAgICAgICAgICAgcHV0QmluYXJ5SW1hZ2VEYXRhKHRtcEN0eCwgaW1nRGF0YSk7CiAgICAgICAgICAgIGltZ1RvUGFpbnQgPSB0bXBDYW52YXMuY2FudmFzOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBwYWludFdpZHRoID0gd2lkdGgsCiAgICAgICAgICAgIHBhaW50SGVpZ2h0ID0gaGVpZ2h0OwogICAgICAgICAgdmFyIHRtcENhbnZhc0lkID0gInByZXNjYWxlMSI7CgogICAgICAgICAgd2hpbGUgKHdpZHRoU2NhbGUgPiAyICYmIHBhaW50V2lkdGggPiAxIHx8IGhlaWdodFNjYWxlID4gMiAmJiBwYWludEhlaWdodCA+IDEpIHsKICAgICAgICAgICAgdmFyIG5ld1dpZHRoID0gcGFpbnRXaWR0aCwKICAgICAgICAgICAgICBuZXdIZWlnaHQgPSBwYWludEhlaWdodDsKCiAgICAgICAgICAgIGlmICh3aWR0aFNjYWxlID4gMiAmJiBwYWludFdpZHRoID4gMSkgewogICAgICAgICAgICAgIG5ld1dpZHRoID0gTWF0aC5jZWlsKHBhaW50V2lkdGggLyAyKTsKICAgICAgICAgICAgICB3aWR0aFNjYWxlIC89IHBhaW50V2lkdGggLyBuZXdXaWR0aDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGhlaWdodFNjYWxlID4gMiAmJiBwYWludEhlaWdodCA+IDEpIHsKICAgICAgICAgICAgICBuZXdIZWlnaHQgPSBNYXRoLmNlaWwocGFpbnRIZWlnaHQgLyAyKTsKICAgICAgICAgICAgICBoZWlnaHRTY2FsZSAvPSBwYWludEhlaWdodCAvIG5ld0hlaWdodDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdG1wQ2FudmFzID0gdGhpcy5jYWNoZWRDYW52YXNlcy5nZXRDYW52YXModG1wQ2FudmFzSWQsIG5ld1dpZHRoLCBuZXdIZWlnaHQpOwogICAgICAgICAgICB0bXBDdHggPSB0bXBDYW52YXMuY29udGV4dDsKICAgICAgICAgICAgdG1wQ3R4LmNsZWFyUmVjdCgwLCAwLCBuZXdXaWR0aCwgbmV3SGVpZ2h0KTsKICAgICAgICAgICAgdG1wQ3R4LmRyYXdJbWFnZShpbWdUb1BhaW50LCAwLCAwLCBwYWludFdpZHRoLCBwYWludEhlaWdodCwgMCwgMCwgbmV3V2lkdGgsIG5ld0hlaWdodCk7CiAgICAgICAgICAgIGltZ1RvUGFpbnQgPSB0bXBDYW52YXMuY2FudmFzOwogICAgICAgICAgICBwYWludFdpZHRoID0gbmV3V2lkdGg7CiAgICAgICAgICAgIHBhaW50SGVpZ2h0ID0gbmV3SGVpZ2h0OwogICAgICAgICAgICB0bXBDYW52YXNJZCA9IHRtcENhbnZhc0lkID09PSAicHJlc2NhbGUxIiA/ICJwcmVzY2FsZTIiIDogInByZXNjYWxlMSI7CiAgICAgICAgICB9CgogICAgICAgICAgY3R4LmRyYXdJbWFnZShpbWdUb1BhaW50LCAwLCAwLCBwYWludFdpZHRoLCBwYWludEhlaWdodCwgMCwgLWhlaWdodCwgd2lkdGgsIGhlaWdodCk7CgogICAgICAgICAgaWYgKHRoaXMuaW1hZ2VMYXllcikgewogICAgICAgICAgICB2YXIgcG9zaXRpb24gPSB0aGlzLmdldENhbnZhc1Bvc2l0aW9uKDAsIC1oZWlnaHQpOwogICAgICAgICAgICB0aGlzLmltYWdlTGF5ZXIuYXBwZW5kSW1hZ2UoewogICAgICAgICAgICAgIGltZ0RhdGE6IGltZ0RhdGEsCiAgICAgICAgICAgICAgbGVmdDogcG9zaXRpb25bMF0sCiAgICAgICAgICAgICAgdG9wOiBwb3NpdGlvblsxXSwKICAgICAgICAgICAgICB3aWR0aDogd2lkdGggLyBjdXJyZW50VHJhbnNmb3JtWzBdLAogICAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0IC8gY3VycmVudFRyYW5zZm9ybVszXQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnJlc3RvcmUoKTsKICAgICAgICB9LAogICAgICAgIHBhaW50SW5saW5lSW1hZ2VYT2JqZWN0R3JvdXA6IGZ1bmN0aW9uIENhbnZhc0dyYXBoaWNzX3BhaW50SW5saW5lSW1hZ2VYT2JqZWN0R3JvdXAoaW1nRGF0YSwgbWFwKSB7CiAgICAgICAgICB2YXIgY3R4ID0gdGhpcy5jdHg7CiAgICAgICAgICB2YXIgdyA9IGltZ0RhdGEud2lkdGg7CiAgICAgICAgICB2YXIgaCA9IGltZ0RhdGEuaGVpZ2h0OwogICAgICAgICAgdmFyIHRtcENhbnZhcyA9IHRoaXMuY2FjaGVkQ2FudmFzZXMuZ2V0Q2FudmFzKCJpbmxpbmVJbWFnZSIsIHcsIGgpOwogICAgICAgICAgdmFyIHRtcEN0eCA9IHRtcENhbnZhcy5jb250ZXh0OwogICAgICAgICAgcHV0QmluYXJ5SW1hZ2VEYXRhKHRtcEN0eCwgaW1nRGF0YSk7CgogICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gbWFwLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgdmFyIGVudHJ5ID0gbWFwW2ldOwogICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICBjdHgudHJhbnNmb3JtLmFwcGx5KGN0eCwgZW50cnkudHJhbnNmb3JtKTsKICAgICAgICAgICAgY3R4LnNjYWxlKDEsIC0xKTsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZSh0bXBDYW52YXMuY2FudmFzLCBlbnRyeS54LCBlbnRyeS55LCBlbnRyeS53LCBlbnRyeS5oLCAwLCAtMSwgMSwgMSk7CgogICAgICAgICAgICBpZiAodGhpcy5pbWFnZUxheWVyKSB7CiAgICAgICAgICAgICAgdmFyIHBvc2l0aW9uID0gdGhpcy5nZXRDYW52YXNQb3NpdGlvbihlbnRyeS54LCBlbnRyeS55KTsKICAgICAgICAgICAgICB0aGlzLmltYWdlTGF5ZXIuYXBwZW5kSW1hZ2UoewogICAgICAgICAgICAgICAgaW1nRGF0YTogaW1nRGF0YSwKICAgICAgICAgICAgICAgIGxlZnQ6IHBvc2l0aW9uWzBdLAogICAgICAgICAgICAgICAgdG9wOiBwb3NpdGlvblsxXSwKICAgICAgICAgICAgICAgIHdpZHRoOiB3LAogICAgICAgICAgICAgICAgaGVpZ2h0OiBoCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBwYWludFNvbGlkQ29sb3JJbWFnZU1hc2s6IGZ1bmN0aW9uIENhbnZhc0dyYXBoaWNzX3BhaW50U29saWRDb2xvckltYWdlTWFzaygpIHsKICAgICAgICAgIHRoaXMuY3R4LmZpbGxSZWN0KDAsIDAsIDEsIDEpOwogICAgICAgIH0sCiAgICAgICAgcGFpbnRYT2JqZWN0OiBmdW5jdGlvbiBDYW52YXNHcmFwaGljc19wYWludFhPYmplY3QoKSB7CiAgICAgICAgICAoMCwgX3V0aWwud2FybikoIlVuc3VwcG9ydGVkICdwYWludFhPYmplY3QnIGNvbW1hbmQuIik7CiAgICAgICAgfSwKICAgICAgICBtYXJrUG9pbnQ6IGZ1bmN0aW9uIENhbnZhc0dyYXBoaWNzX21hcmtQb2ludCh0YWcpIHt9LAogICAgICAgIG1hcmtQb2ludFByb3BzOiBmdW5jdGlvbiBDYW52YXNHcmFwaGljc19tYXJrUG9pbnRQcm9wcyh0YWcsIHByb3BlcnRpZXMpIHt9LAogICAgICAgIGJlZ2luTWFya2VkQ29udGVudDogZnVuY3Rpb24gQ2FudmFzR3JhcGhpY3NfYmVnaW5NYXJrZWRDb250ZW50KHRhZykge30sCiAgICAgICAgYmVnaW5NYXJrZWRDb250ZW50UHJvcHM6IGZ1bmN0aW9uIENhbnZhc0dyYXBoaWNzX2JlZ2luTWFya2VkQ29udGVudFByb3BzKHRhZywgcHJvcGVydGllcykge30sCiAgICAgICAgZW5kTWFya2VkQ29udGVudDogZnVuY3Rpb24gQ2FudmFzR3JhcGhpY3NfZW5kTWFya2VkQ29udGVudCgpIHt9LAogICAgICAgIGJlZ2luQ29tcGF0OiBmdW5jdGlvbiBDYW52YXNHcmFwaGljc19iZWdpbkNvbXBhdCgpIHt9LAogICAgICAgIGVuZENvbXBhdDogZnVuY3Rpb24gQ2FudmFzR3JhcGhpY3NfZW5kQ29tcGF0KCkge30sCiAgICAgICAgY29uc3VtZVBhdGg6IGZ1bmN0aW9uIENhbnZhc0dyYXBoaWNzX2NvbnN1bWVQYXRoKCkgewogICAgICAgICAgdmFyIGN0eCA9IHRoaXMuY3R4OwoKICAgICAgICAgIGlmICh0aGlzLnBlbmRpbmdDbGlwKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnBlbmRpbmdDbGlwID09PSBFT19DTElQKSB7CiAgICAgICAgICAgICAgY3R4LmNsaXAoImV2ZW5vZGQiKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBjdHguY2xpcCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLnBlbmRpbmdDbGlwID0gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgfSwKICAgICAgICBnZXRTaW5nbGVQaXhlbFdpZHRoOiBmdW5jdGlvbiBnZXRTaW5nbGVQaXhlbFdpZHRoKHNjYWxlKSB7CiAgICAgICAgICBpZiAodGhpcy5fY2FjaGVkR2V0U2luZ2xlUGl4ZWxXaWR0aCA9PT0gbnVsbCkgewogICAgICAgICAgICB2YXIgaW52ZXJzZSA9IHRoaXMuY3R4Lm1vekN1cnJlbnRUcmFuc2Zvcm1JbnZlcnNlOwogICAgICAgICAgICB0aGlzLl9jYWNoZWRHZXRTaW5nbGVQaXhlbFdpZHRoID0gTWF0aC5zcXJ0KE1hdGgubWF4KGludmVyc2VbMF0gKiBpbnZlcnNlWzBdICsgaW52ZXJzZVsxXSAqIGludmVyc2VbMV0sIGludmVyc2VbMl0gKiBpbnZlcnNlWzJdICsgaW52ZXJzZVszXSAqIGludmVyc2VbM10pKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gdGhpcy5fY2FjaGVkR2V0U2luZ2xlUGl4ZWxXaWR0aDsKICAgICAgICB9LAogICAgICAgIGdldENhbnZhc1Bvc2l0aW9uOiBmdW5jdGlvbiBDYW52YXNHcmFwaGljc19nZXRDYW52YXNQb3NpdGlvbih4LCB5KSB7CiAgICAgICAgICB2YXIgdHJhbnNmb3JtID0gdGhpcy5jdHgubW96Q3VycmVudFRyYW5zZm9ybTsKICAgICAgICAgIHJldHVybiBbdHJhbnNmb3JtWzBdICogeCArIHRyYW5zZm9ybVsyXSAqIHkgKyB0cmFuc2Zvcm1bNF0sIHRyYW5zZm9ybVsxXSAqIHggKyB0cmFuc2Zvcm1bM10gKiB5ICsgdHJhbnNmb3JtWzVdXTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBmb3IgKHZhciBvcCBpbiBfdXRpbC5PUFMpIHsKICAgICAgICBDYW52YXNHcmFwaGljcy5wcm90b3R5cGVbX3V0aWwuT1BTW29wXV0gPSBDYW52YXNHcmFwaGljcy5wcm90b3R5cGVbb3BdOwogICAgICB9CgogICAgICByZXR1cm4gQ2FudmFzR3JhcGhpY3M7CiAgICB9KCk7CgogICAgZXhwb3J0cy5DYW52YXNHcmFwaGljcyA9IENhbnZhc0dyYXBoaWNzOwoKICAgIC8qKiovfSksICgKICAvKiAxOTggKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgoKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgICAgdmFsdWU6IHRydWUKICAgIH0pOwogICAgZXhwb3J0cy5nZXRTaGFkaW5nUGF0dGVybkZyb21JUiA9IGdldFNoYWRpbmdQYXR0ZXJuRnJvbUlSOwogICAgZXhwb3J0cy5UaWxpbmdQYXR0ZXJuID0gdm9pZCAwOwoKICAgIHZhciBfdXRpbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMSk7CgogICAgdmFyIFNoYWRpbmdJUnMgPSB7fTsKCiAgICBmdW5jdGlvbiBhcHBseUJvdW5kaW5nQm94KGN0eCwgYmJveCkgewogICAgICBpZiAoIWJib3ggfHwgdHlwZW9mIFBhdGgyRCA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciB3aWR0aCA9IGJib3hbMl0gLSBiYm94WzBdOwogICAgICB2YXIgaGVpZ2h0ID0gYmJveFszXSAtIGJib3hbMV07CiAgICAgIHZhciByZWdpb24gPSBuZXcgUGF0aDJEKCk7CiAgICAgIHJlZ2lvbi5yZWN0KGJib3hbMF0sIGJib3hbMV0sIHdpZHRoLCBoZWlnaHQpOwogICAgICBjdHguY2xpcChyZWdpb24pOwogICAgfQoKICAgIFNoYWRpbmdJUnMuUmFkaWFsQXhpYWwgPSB7CiAgICAgIGZyb21JUjogZnVuY3Rpb24gUmFkaWFsQXhpYWxfZnJvbUlSKHJhdykgewogICAgICAgIHZhciB0eXBlID0gcmF3WzFdOwogICAgICAgIHZhciBiYm94ID0gcmF3WzJdOwogICAgICAgIHZhciBjb2xvclN0b3BzID0gcmF3WzNdOwogICAgICAgIHZhciBwMCA9IHJhd1s0XTsKICAgICAgICB2YXIgcDEgPSByYXdbNV07CiAgICAgICAgdmFyIHIwID0gcmF3WzZdOwogICAgICAgIHZhciByMSA9IHJhd1s3XTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgdHlwZTogIlBhdHRlcm4iLAogICAgICAgICAgZ2V0UGF0dGVybjogZnVuY3Rpb24gUmFkaWFsQXhpYWxfZ2V0UGF0dGVybihjdHgpIHsKICAgICAgICAgICAgYXBwbHlCb3VuZGluZ0JveChjdHgsIGJib3gpOwogICAgICAgICAgICB2YXIgZ3JhZDsKCiAgICAgICAgICAgIGlmICh0eXBlID09PSAiYXhpYWwiKSB7CiAgICAgICAgICAgICAgZ3JhZCA9IGN0eC5jcmVhdGVMaW5lYXJHcmFkaWVudChwMFswXSwgcDBbMV0sIHAxWzBdLCBwMVsxXSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gInJhZGlhbCIpIHsKICAgICAgICAgICAgICBncmFkID0gY3R4LmNyZWF0ZVJhZGlhbEdyYWRpZW50KHAwWzBdLCBwMFsxXSwgcjAsIHAxWzBdLCBwMVsxXSwgcjEpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBjb2xvclN0b3BzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHsKICAgICAgICAgICAgICB2YXIgYyA9IGNvbG9yU3RvcHNbaV07CiAgICAgICAgICAgICAgZ3JhZC5hZGRDb2xvclN0b3AoY1swXSwgY1sxXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBncmFkOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0KICAgIH07CgogICAgdmFyIGNyZWF0ZU1lc2hDYW52YXMgPSBmdW5jdGlvbiBjcmVhdGVNZXNoQ2FudmFzQ2xvc3VyZSgpIHsKICAgICAgZnVuY3Rpb24gZHJhd1RyaWFuZ2xlKGRhdGEsIGNvbnRleHQsIHAxLCBwMiwgcDMsIGMxLCBjMiwgYzMpIHsKICAgICAgICB2YXIgY29vcmRzID0gY29udGV4dC5jb29yZHMsCiAgICAgICAgICBjb2xvcnMgPSBjb250ZXh0LmNvbG9yczsKICAgICAgICB2YXIgYnl0ZXMgPSBkYXRhLmRhdGEsCiAgICAgICAgICByb3dTaXplID0gZGF0YS53aWR0aCAqIDQ7CiAgICAgICAgdmFyIHRtcDsKCiAgICAgICAgaWYgKGNvb3Jkc1twMSArIDFdID4gY29vcmRzW3AyICsgMV0pIHsKICAgICAgICAgIHRtcCA9IHAxOwogICAgICAgICAgcDEgPSBwMjsKICAgICAgICAgIHAyID0gdG1wOwogICAgICAgICAgdG1wID0gYzE7CiAgICAgICAgICBjMSA9IGMyOwogICAgICAgICAgYzIgPSB0bXA7CiAgICAgICAgfQoKICAgICAgICBpZiAoY29vcmRzW3AyICsgMV0gPiBjb29yZHNbcDMgKyAxXSkgewogICAgICAgICAgdG1wID0gcDI7CiAgICAgICAgICBwMiA9IHAzOwogICAgICAgICAgcDMgPSB0bXA7CiAgICAgICAgICB0bXAgPSBjMjsKICAgICAgICAgIGMyID0gYzM7CiAgICAgICAgICBjMyA9IHRtcDsKICAgICAgICB9CgogICAgICAgIGlmIChjb29yZHNbcDEgKyAxXSA+IGNvb3Jkc1twMiArIDFdKSB7CiAgICAgICAgICB0bXAgPSBwMTsKICAgICAgICAgIHAxID0gcDI7CiAgICAgICAgICBwMiA9IHRtcDsKICAgICAgICAgIHRtcCA9IGMxOwogICAgICAgICAgYzEgPSBjMjsKICAgICAgICAgIGMyID0gdG1wOwogICAgICAgIH0KCiAgICAgICAgdmFyIHgxID0gKGNvb3Jkc1twMV0gKyBjb250ZXh0Lm9mZnNldFgpICogY29udGV4dC5zY2FsZVg7CiAgICAgICAgdmFyIHkxID0gKGNvb3Jkc1twMSArIDFdICsgY29udGV4dC5vZmZzZXRZKSAqIGNvbnRleHQuc2NhbGVZOwogICAgICAgIHZhciB4MiA9IChjb29yZHNbcDJdICsgY29udGV4dC5vZmZzZXRYKSAqIGNvbnRleHQuc2NhbGVYOwogICAgICAgIHZhciB5MiA9IChjb29yZHNbcDIgKyAxXSArIGNvbnRleHQub2Zmc2V0WSkgKiBjb250ZXh0LnNjYWxlWTsKICAgICAgICB2YXIgeDMgPSAoY29vcmRzW3AzXSArIGNvbnRleHQub2Zmc2V0WCkgKiBjb250ZXh0LnNjYWxlWDsKICAgICAgICB2YXIgeTMgPSAoY29vcmRzW3AzICsgMV0gKyBjb250ZXh0Lm9mZnNldFkpICogY29udGV4dC5zY2FsZVk7CgogICAgICAgIGlmICh5MSA+PSB5MykgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIGMxciA9IGNvbG9yc1tjMV0sCiAgICAgICAgICBjMWcgPSBjb2xvcnNbYzEgKyAxXSwKICAgICAgICAgIGMxYiA9IGNvbG9yc1tjMSArIDJdOwogICAgICAgIHZhciBjMnIgPSBjb2xvcnNbYzJdLAogICAgICAgICAgYzJnID0gY29sb3JzW2MyICsgMV0sCiAgICAgICAgICBjMmIgPSBjb2xvcnNbYzIgKyAyXTsKICAgICAgICB2YXIgYzNyID0gY29sb3JzW2MzXSwKICAgICAgICAgIGMzZyA9IGNvbG9yc1tjMyArIDFdLAogICAgICAgICAgYzNiID0gY29sb3JzW2MzICsgMl07CiAgICAgICAgdmFyIG1pblkgPSBNYXRoLnJvdW5kKHkxKSwKICAgICAgICAgIG1heFkgPSBNYXRoLnJvdW5kKHkzKTsKICAgICAgICB2YXIgeGEsIGNhciwgY2FnLCBjYWI7CiAgICAgICAgdmFyIHhiLCBjYnIsIGNiZywgY2JiOwoKICAgICAgICBmb3IgKHZhciB5ID0gbWluWTsgeSA8PSBtYXhZOyB5KyspIHsKICAgICAgICAgIGlmICh5IDwgeTIpIHsKICAgICAgICAgICAgdmFyIF9rID0gdm9pZCAwOwoKICAgICAgICAgICAgaWYgKHkgPCB5MSkgewogICAgICAgICAgICAgIF9rID0gMDsKICAgICAgICAgICAgfSBlbHNlIGlmICh5MSA9PT0geTIpIHsKICAgICAgICAgICAgICBfayA9IDE7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgX2sgPSAoeTEgLSB5KSAvICh5MSAtIHkyKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgeGEgPSB4MSAtICh4MSAtIHgyKSAqIF9rOwogICAgICAgICAgICBjYXIgPSBjMXIgLSAoYzFyIC0gYzJyKSAqIF9rOwogICAgICAgICAgICBjYWcgPSBjMWcgLSAoYzFnIC0gYzJnKSAqIF9rOwogICAgICAgICAgICBjYWIgPSBjMWIgLSAoYzFiIC0gYzJiKSAqIF9rOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIF9rMiA9IHZvaWQgMDsKCiAgICAgICAgICAgIGlmICh5ID4geTMpIHsKICAgICAgICAgICAgICBfazIgPSAxOwogICAgICAgICAgICB9IGVsc2UgaWYgKHkyID09PSB5MykgewogICAgICAgICAgICAgIF9rMiA9IDA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgX2syID0gKHkyIC0geSkgLyAoeTIgLSB5Myk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHhhID0geDIgLSAoeDIgLSB4MykgKiBfazI7CiAgICAgICAgICAgIGNhciA9IGMyciAtIChjMnIgLSBjM3IpICogX2syOwogICAgICAgICAgICBjYWcgPSBjMmcgLSAoYzJnIC0gYzNnKSAqIF9rMjsKICAgICAgICAgICAgY2FiID0gYzJiIC0gKGMyYiAtIGMzYikgKiBfazI7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGsgPSB2b2lkIDA7CgogICAgICAgICAgaWYgKHkgPCB5MSkgewogICAgICAgICAgICBrID0gMDsKICAgICAgICAgIH0gZWxzZSBpZiAoeSA+IHkzKSB7CiAgICAgICAgICAgIGsgPSAxOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgayA9ICh5MSAtIHkpIC8gKHkxIC0geTMpOwogICAgICAgICAgfQoKICAgICAgICAgIHhiID0geDEgLSAoeDEgLSB4MykgKiBrOwogICAgICAgICAgY2JyID0gYzFyIC0gKGMxciAtIGMzcikgKiBrOwogICAgICAgICAgY2JnID0gYzFnIC0gKGMxZyAtIGMzZykgKiBrOwogICAgICAgICAgY2JiID0gYzFiIC0gKGMxYiAtIGMzYikgKiBrOwogICAgICAgICAgdmFyIHgxXyA9IE1hdGgucm91bmQoTWF0aC5taW4oeGEsIHhiKSk7CiAgICAgICAgICB2YXIgeDJfID0gTWF0aC5yb3VuZChNYXRoLm1heCh4YSwgeGIpKTsKICAgICAgICAgIHZhciBqID0gcm93U2l6ZSAqIHkgKyB4MV8gKiA0OwoKICAgICAgICAgIGZvciAodmFyIHggPSB4MV87IHggPD0geDJfOyB4KyspIHsKICAgICAgICAgICAgdmFyIF9rMyA9ICh4YSAtIHgpIC8gKHhhIC0geGIpOwoKICAgICAgICAgICAgaWYgKF9rMyA8IDApIHsKICAgICAgICAgICAgICBfazMgPSAwOwogICAgICAgICAgICB9IGVsc2UgaWYgKF9rMyA+IDEpIHsKICAgICAgICAgICAgICBfazMgPSAxOwogICAgICAgICAgICB9CgogICAgICAgICAgICBieXRlc1tqKytdID0gY2FyIC0gKGNhciAtIGNicikgKiBfazMgfCAwOwogICAgICAgICAgICBieXRlc1tqKytdID0gY2FnIC0gKGNhZyAtIGNiZykgKiBfazMgfCAwOwogICAgICAgICAgICBieXRlc1tqKytdID0gY2FiIC0gKGNhYiAtIGNiYikgKiBfazMgfCAwOwogICAgICAgICAgICBieXRlc1tqKytdID0gMjU1OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgZnVuY3Rpb24gZHJhd0ZpZ3VyZShkYXRhLCBmaWd1cmUsIGNvbnRleHQpIHsKICAgICAgICB2YXIgcHMgPSBmaWd1cmUuY29vcmRzOwogICAgICAgIHZhciBjcyA9IGZpZ3VyZS5jb2xvcnM7CiAgICAgICAgdmFyIGksIGlpOwoKICAgICAgICBzd2l0Y2ggKGZpZ3VyZS50eXBlKSB7CiAgICAgICAgICBjYXNlICJsYXR0aWNlIjoKICAgICAgICAgICAgdmFyIHZlcnRpY2VzUGVyUm93ID0gZmlndXJlLnZlcnRpY2VzUGVyUm93OwogICAgICAgICAgICB2YXIgcm93cyA9IE1hdGguZmxvb3IocHMubGVuZ3RoIC8gdmVydGljZXNQZXJSb3cpIC0gMTsKICAgICAgICAgICAgdmFyIGNvbHMgPSB2ZXJ0aWNlc1BlclJvdyAtIDE7CgogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcm93czsgaSsrKSB7CiAgICAgICAgICAgICAgdmFyIHEgPSBpICogdmVydGljZXNQZXJSb3c7CgogICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgY29sczsgaisrLCBxKyspIHsKICAgICAgICAgICAgICAgIGRyYXdUcmlhbmdsZShkYXRhLCBjb250ZXh0LCBwc1txXSwgcHNbcSArIDFdLCBwc1txICsgdmVydGljZXNQZXJSb3ddLCBjc1txXSwgY3NbcSArIDFdLCBjc1txICsgdmVydGljZXNQZXJSb3ddKTsKICAgICAgICAgICAgICAgIGRyYXdUcmlhbmdsZShkYXRhLCBjb250ZXh0LCBwc1txICsgdmVydGljZXNQZXJSb3cgKyAxXSwgcHNbcSArIDFdLCBwc1txICsgdmVydGljZXNQZXJSb3ddLCBjc1txICsgdmVydGljZXNQZXJSb3cgKyAxXSwgY3NbcSArIDFdLCBjc1txICsgdmVydGljZXNQZXJSb3ddKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgInRyaWFuZ2xlcyI6CiAgICAgICAgICAgIGZvciAoaSA9IDAsIGlpID0gcHMubGVuZ3RoOyBpIDwgaWk7IGkgKz0gMykgewogICAgICAgICAgICAgIGRyYXdUcmlhbmdsZShkYXRhLCBjb250ZXh0LCBwc1tpXSwgcHNbaSArIDFdLCBwc1tpICsgMl0sIGNzW2ldLCBjc1tpICsgMV0sIGNzW2kgKyAyXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiaWxsZWdhbCBmaWd1cmUiKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGNyZWF0ZU1lc2hDYW52YXMoYm91bmRzLCBjb21iaW5lc1NjYWxlLCBjb29yZHMsIGNvbG9ycywgZmlndXJlcywgYmFja2dyb3VuZENvbG9yLCBjYWNoZWRDYW52YXNlcywgd2ViR0xDb250ZXh0KSB7CiAgICAgICAgdmFyIEVYUEVDVEVEX1NDQUxFID0gMS4xOwogICAgICAgIHZhciBNQVhfUEFUVEVSTl9TSVpFID0gMzAwMDsKICAgICAgICB2YXIgQk9SREVSX1NJWkUgPSAyOwogICAgICAgIHZhciBvZmZzZXRYID0gTWF0aC5mbG9vcihib3VuZHNbMF0pOwogICAgICAgIHZhciBvZmZzZXRZID0gTWF0aC5mbG9vcihib3VuZHNbMV0pOwogICAgICAgIHZhciBib3VuZHNXaWR0aCA9IE1hdGguY2VpbChib3VuZHNbMl0pIC0gb2Zmc2V0WDsKICAgICAgICB2YXIgYm91bmRzSGVpZ2h0ID0gTWF0aC5jZWlsKGJvdW5kc1szXSkgLSBvZmZzZXRZOwogICAgICAgIHZhciB3aWR0aCA9IE1hdGgubWluKE1hdGguY2VpbChNYXRoLmFicyhib3VuZHNXaWR0aCAqIGNvbWJpbmVzU2NhbGVbMF0gKiBFWFBFQ1RFRF9TQ0FMRSkpLCBNQVhfUEFUVEVSTl9TSVpFKTsKICAgICAgICB2YXIgaGVpZ2h0ID0gTWF0aC5taW4oTWF0aC5jZWlsKE1hdGguYWJzKGJvdW5kc0hlaWdodCAqIGNvbWJpbmVzU2NhbGVbMV0gKiBFWFBFQ1RFRF9TQ0FMRSkpLCBNQVhfUEFUVEVSTl9TSVpFKTsKICAgICAgICB2YXIgc2NhbGVYID0gYm91bmRzV2lkdGggLyB3aWR0aDsKICAgICAgICB2YXIgc2NhbGVZID0gYm91bmRzSGVpZ2h0IC8gaGVpZ2h0OwogICAgICAgIHZhciBjb250ZXh0ID0gewogICAgICAgICAgY29vcmRzOiBjb29yZHMsCiAgICAgICAgICBjb2xvcnM6IGNvbG9ycywKICAgICAgICAgIG9mZnNldFg6IC1vZmZzZXRYLAogICAgICAgICAgb2Zmc2V0WTogLW9mZnNldFksCiAgICAgICAgICBzY2FsZVg6IDEgLyBzY2FsZVgsCiAgICAgICAgICBzY2FsZVk6IDEgLyBzY2FsZVkKICAgICAgICB9OwogICAgICAgIHZhciBwYWRkZWRXaWR0aCA9IHdpZHRoICsgQk9SREVSX1NJWkUgKiAyOwogICAgICAgIHZhciBwYWRkZWRIZWlnaHQgPSBoZWlnaHQgKyBCT1JERVJfU0laRSAqIDI7CiAgICAgICAgdmFyIGNhbnZhcywgdG1wQ2FudmFzLCBpLCBpaTsKCiAgICAgICAgaWYgKHdlYkdMQ29udGV4dC5pc0VuYWJsZWQpIHsKICAgICAgICAgIGNhbnZhcyA9IHdlYkdMQ29udGV4dC5kcmF3RmlndXJlcyh7CiAgICAgICAgICAgIHdpZHRoOiB3aWR0aCwKICAgICAgICAgICAgaGVpZ2h0OiBoZWlnaHQsCiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogYmFja2dyb3VuZENvbG9yLAogICAgICAgICAgICBmaWd1cmVzOiBmaWd1cmVzLAogICAgICAgICAgICBjb250ZXh0OiBjb250ZXh0CiAgICAgICAgICB9KTsKICAgICAgICAgIHRtcENhbnZhcyA9IGNhY2hlZENhbnZhc2VzLmdldENhbnZhcygibWVzaCIsIHBhZGRlZFdpZHRoLCBwYWRkZWRIZWlnaHQsIGZhbHNlKTsKICAgICAgICAgIHRtcENhbnZhcy5jb250ZXh0LmRyYXdJbWFnZShjYW52YXMsIEJPUkRFUl9TSVpFLCBCT1JERVJfU0laRSk7CiAgICAgICAgICBjYW52YXMgPSB0bXBDYW52YXMuY2FudmFzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0bXBDYW52YXMgPSBjYWNoZWRDYW52YXNlcy5nZXRDYW52YXMoIm1lc2giLCBwYWRkZWRXaWR0aCwgcGFkZGVkSGVpZ2h0LCBmYWxzZSk7CiAgICAgICAgICB2YXIgdG1wQ3R4ID0gdG1wQ2FudmFzLmNvbnRleHQ7CiAgICAgICAgICB2YXIgZGF0YSA9IHRtcEN0eC5jcmVhdGVJbWFnZURhdGEod2lkdGgsIGhlaWdodCk7CgogICAgICAgICAgaWYgKGJhY2tncm91bmRDb2xvcikgewogICAgICAgICAgICB2YXIgYnl0ZXMgPSBkYXRhLmRhdGE7CgogICAgICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGJ5dGVzLmxlbmd0aDsgaSA8IGlpOyBpICs9IDQpIHsKICAgICAgICAgICAgICBieXRlc1tpXSA9IGJhY2tncm91bmRDb2xvclswXTsKICAgICAgICAgICAgICBieXRlc1tpICsgMV0gPSBiYWNrZ3JvdW5kQ29sb3JbMV07CiAgICAgICAgICAgICAgYnl0ZXNbaSArIDJdID0gYmFja2dyb3VuZENvbG9yWzJdOwogICAgICAgICAgICAgIGJ5dGVzW2kgKyAzXSA9IDI1NTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBmaWd1cmVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGRyYXdGaWd1cmUoZGF0YSwgZmlndXJlc1tpXSwgY29udGV4dCk7CiAgICAgICAgICB9CgogICAgICAgICAgdG1wQ3R4LnB1dEltYWdlRGF0YShkYXRhLCBCT1JERVJfU0laRSwgQk9SREVSX1NJWkUpOwogICAgICAgICAgY2FudmFzID0gdG1wQ2FudmFzLmNhbnZhczsKICAgICAgICB9CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICBjYW52YXM6IGNhbnZhcywKICAgICAgICAgIG9mZnNldFg6IG9mZnNldFggLSBCT1JERVJfU0laRSAqIHNjYWxlWCwKICAgICAgICAgIG9mZnNldFk6IG9mZnNldFkgLSBCT1JERVJfU0laRSAqIHNjYWxlWSwKICAgICAgICAgIHNjYWxlWDogc2NhbGVYLAogICAgICAgICAgc2NhbGVZOiBzY2FsZVkKICAgICAgICB9OwogICAgICB9CgogICAgICByZXR1cm4gY3JlYXRlTWVzaENhbnZhczsKICAgIH0oKTsKCiAgICBTaGFkaW5nSVJzLk1lc2ggPSB7CiAgICAgIGZyb21JUjogZnVuY3Rpb24gTWVzaF9mcm9tSVIocmF3KSB7CiAgICAgICAgdmFyIGNvb3JkcyA9IHJhd1syXTsKICAgICAgICB2YXIgY29sb3JzID0gcmF3WzNdOwogICAgICAgIHZhciBmaWd1cmVzID0gcmF3WzRdOwogICAgICAgIHZhciBib3VuZHMgPSByYXdbNV07CiAgICAgICAgdmFyIG1hdHJpeCA9IHJhd1s2XTsKICAgICAgICB2YXIgYmJveCA9IHJhd1s3XTsKICAgICAgICB2YXIgYmFja2dyb3VuZCA9IHJhd1s4XTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgdHlwZTogIlBhdHRlcm4iLAogICAgICAgICAgZ2V0UGF0dGVybjogZnVuY3Rpb24gTWVzaF9nZXRQYXR0ZXJuKGN0eCwgb3duZXIsIHNoYWRpbmdGaWxsKSB7CiAgICAgICAgICAgIGFwcGx5Qm91bmRpbmdCb3goY3R4LCBiYm94KTsKICAgICAgICAgICAgdmFyIHNjYWxlOwoKICAgICAgICAgICAgaWYgKHNoYWRpbmdGaWxsKSB7CiAgICAgICAgICAgICAgc2NhbGUgPSBfdXRpbC5VdGlsLnNpbmd1bGFyVmFsdWVEZWNvbXBvc2UyZFNjYWxlKGN0eC5tb3pDdXJyZW50VHJhbnNmb3JtKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBzY2FsZSA9IF91dGlsLlV0aWwuc2luZ3VsYXJWYWx1ZURlY29tcG9zZTJkU2NhbGUob3duZXIuYmFzZVRyYW5zZm9ybSk7CgogICAgICAgICAgICAgIGlmIChtYXRyaXgpIHsKICAgICAgICAgICAgICAgIHZhciBtYXRyaXhTY2FsZSA9IF91dGlsLlV0aWwuc2luZ3VsYXJWYWx1ZURlY29tcG9zZTJkU2NhbGUobWF0cml4KTsKCiAgICAgICAgICAgICAgICBzY2FsZSA9IFtzY2FsZVswXSAqIG1hdHJpeFNjYWxlWzBdLCBzY2FsZVsxXSAqIG1hdHJpeFNjYWxlWzFdXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciB0ZW1wb3JhcnlQYXR0ZXJuQ2FudmFzID0gY3JlYXRlTWVzaENhbnZhcyhib3VuZHMsIHNjYWxlLCBjb29yZHMsIGNvbG9ycywgZmlndXJlcywgc2hhZGluZ0ZpbGwgPyBudWxsIDogYmFja2dyb3VuZCwgb3duZXIuY2FjaGVkQ2FudmFzZXMsIG93bmVyLndlYkdMQ29udGV4dCk7CgogICAgICAgICAgICBpZiAoIXNoYWRpbmdGaWxsKSB7CiAgICAgICAgICAgICAgY3R4LnNldFRyYW5zZm9ybS5hcHBseShjdHgsIG93bmVyLmJhc2VUcmFuc2Zvcm0pOwoKICAgICAgICAgICAgICBpZiAobWF0cml4KSB7CiAgICAgICAgICAgICAgICBjdHgudHJhbnNmb3JtLmFwcGx5KGN0eCwgbWF0cml4KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGN0eC50cmFuc2xhdGUodGVtcG9yYXJ5UGF0dGVybkNhbnZhcy5vZmZzZXRYLCB0ZW1wb3JhcnlQYXR0ZXJuQ2FudmFzLm9mZnNldFkpOwogICAgICAgICAgICBjdHguc2NhbGUodGVtcG9yYXJ5UGF0dGVybkNhbnZhcy5zY2FsZVgsIHRlbXBvcmFyeVBhdHRlcm5DYW52YXMuc2NhbGVZKTsKICAgICAgICAgICAgcmV0dXJuIGN0eC5jcmVhdGVQYXR0ZXJuKHRlbXBvcmFyeVBhdHRlcm5DYW52YXMuY2FudmFzLCAibm8tcmVwZWF0Iik7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfQogICAgfTsKICAgIFNoYWRpbmdJUnMuRHVtbXkgPSB7CiAgICAgIGZyb21JUjogZnVuY3Rpb24gRHVtbXlfZnJvbUlSKCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICB0eXBlOiAiUGF0dGVybiIsCiAgICAgICAgICBnZXRQYXR0ZXJuOiBmdW5jdGlvbiBEdW1teV9mcm9tSVJfZ2V0UGF0dGVybigpIHsKICAgICAgICAgICAgcmV0dXJuICJob3RwaW5rIjsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9CiAgICB9OwoKICAgIGZ1bmN0aW9uIGdldFNoYWRpbmdQYXR0ZXJuRnJvbUlSKHJhdykgewogICAgICB2YXIgc2hhZGluZ0lSID0gU2hhZGluZ0lSc1tyYXdbMF1dOwoKICAgICAgaWYgKCFzaGFkaW5nSVIpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gSVIgdHlwZTogIi5jb25jYXQocmF3WzBdKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBzaGFkaW5nSVIuZnJvbUlSKHJhdyk7CiAgICB9CgogICAgdmFyIFRpbGluZ1BhdHRlcm4gPSBmdW5jdGlvbiBUaWxpbmdQYXR0ZXJuQ2xvc3VyZSgpIHsKICAgICAgdmFyIFBhaW50VHlwZSA9IHsKICAgICAgICBDT0xPUkVEOiAxLAogICAgICAgIFVOQ09MT1JFRDogMgogICAgICB9OwogICAgICB2YXIgTUFYX1BBVFRFUk5fU0laRSA9IDMwMDA7CgogICAgICBmdW5jdGlvbiBUaWxpbmdQYXR0ZXJuKElSLCBjb2xvciwgY3R4LCBjYW52YXNHcmFwaGljc0ZhY3RvcnksIGJhc2VUcmFuc2Zvcm0pIHsKICAgICAgICB0aGlzLm9wZXJhdG9yTGlzdCA9IElSWzJdOwogICAgICAgIHRoaXMubWF0cml4ID0gSVJbM10gfHwgWzEsIDAsIDAsIDEsIDAsIDBdOwogICAgICAgIHRoaXMuYmJveCA9IElSWzRdOwogICAgICAgIHRoaXMueHN0ZXAgPSBJUls1XTsKICAgICAgICB0aGlzLnlzdGVwID0gSVJbNl07CiAgICAgICAgdGhpcy5wYWludFR5cGUgPSBJUls3XTsKICAgICAgICB0aGlzLnRpbGluZ1R5cGUgPSBJUls4XTsKICAgICAgICB0aGlzLmNvbG9yID0gY29sb3I7CiAgICAgICAgdGhpcy5jYW52YXNHcmFwaGljc0ZhY3RvcnkgPSBjYW52YXNHcmFwaGljc0ZhY3Rvcnk7CiAgICAgICAgdGhpcy5iYXNlVHJhbnNmb3JtID0gYmFzZVRyYW5zZm9ybTsKICAgICAgICB0aGlzLnR5cGUgPSAiUGF0dGVybiI7CiAgICAgICAgdGhpcy5jdHggPSBjdHg7CiAgICAgIH0KCiAgICAgIFRpbGluZ1BhdHRlcm4ucHJvdG90eXBlID0gewogICAgICAgIGNyZWF0ZVBhdHRlcm5DYW52YXM6IGZ1bmN0aW9uIFRpbGluUGF0dGVybl9jcmVhdGVQYXR0ZXJuQ2FudmFzKG93bmVyKSB7CiAgICAgICAgICB2YXIgb3BlcmF0b3JMaXN0ID0gdGhpcy5vcGVyYXRvckxpc3Q7CiAgICAgICAgICB2YXIgYmJveCA9IHRoaXMuYmJveDsKICAgICAgICAgIHZhciB4c3RlcCA9IHRoaXMueHN0ZXA7CiAgICAgICAgICB2YXIgeXN0ZXAgPSB0aGlzLnlzdGVwOwogICAgICAgICAgdmFyIHBhaW50VHlwZSA9IHRoaXMucGFpbnRUeXBlOwogICAgICAgICAgdmFyIHRpbGluZ1R5cGUgPSB0aGlzLnRpbGluZ1R5cGU7CiAgICAgICAgICB2YXIgY29sb3IgPSB0aGlzLmNvbG9yOwogICAgICAgICAgdmFyIGNhbnZhc0dyYXBoaWNzRmFjdG9yeSA9IHRoaXMuY2FudmFzR3JhcGhpY3NGYWN0b3J5OwogICAgICAgICAgKDAsIF91dGlsLmluZm8pKCJUaWxpbmdUeXBlOiAiICsgdGlsaW5nVHlwZSk7CiAgICAgICAgICB2YXIgeDAgPSBiYm94WzBdLAogICAgICAgICAgICB5MCA9IGJib3hbMV0sCiAgICAgICAgICAgIHgxID0gYmJveFsyXSwKICAgICAgICAgICAgeTEgPSBiYm94WzNdOwoKICAgICAgICAgIHZhciBtYXRyaXhTY2FsZSA9IF91dGlsLlV0aWwuc2luZ3VsYXJWYWx1ZURlY29tcG9zZTJkU2NhbGUodGhpcy5tYXRyaXgpOwoKICAgICAgICAgIHZhciBjdXJNYXRyaXhTY2FsZSA9IF91dGlsLlV0aWwuc2luZ3VsYXJWYWx1ZURlY29tcG9zZTJkU2NhbGUodGhpcy5iYXNlVHJhbnNmb3JtKTsKCiAgICAgICAgICB2YXIgY29tYmluZWRTY2FsZSA9IFttYXRyaXhTY2FsZVswXSAqIGN1ck1hdHJpeFNjYWxlWzBdLCBtYXRyaXhTY2FsZVsxXSAqIGN1ck1hdHJpeFNjYWxlWzFdXTsKICAgICAgICAgIHZhciBkaW14ID0gdGhpcy5nZXRTaXplQW5kU2NhbGUoeHN0ZXAsIHRoaXMuY3R4LmNhbnZhcy53aWR0aCwgY29tYmluZWRTY2FsZVswXSk7CiAgICAgICAgICB2YXIgZGlteSA9IHRoaXMuZ2V0U2l6ZUFuZFNjYWxlKHlzdGVwLCB0aGlzLmN0eC5jYW52YXMuaGVpZ2h0LCBjb21iaW5lZFNjYWxlWzFdKTsKICAgICAgICAgIHZhciB0bXBDYW52YXMgPSBvd25lci5jYWNoZWRDYW52YXNlcy5nZXRDYW52YXMoInBhdHRlcm4iLCBkaW14LnNpemUsIGRpbXkuc2l6ZSwgdHJ1ZSk7CiAgICAgICAgICB2YXIgdG1wQ3R4ID0gdG1wQ2FudmFzLmNvbnRleHQ7CiAgICAgICAgICB2YXIgZ3JhcGhpY3MgPSBjYW52YXNHcmFwaGljc0ZhY3RvcnkuY3JlYXRlQ2FudmFzR3JhcGhpY3ModG1wQ3R4KTsKICAgICAgICAgIGdyYXBoaWNzLmdyb3VwTGV2ZWwgPSBvd25lci5ncm91cExldmVsOwogICAgICAgICAgdGhpcy5zZXRGaWxsQW5kU3Ryb2tlU3R5bGVUb0NvbnRleHQoZ3JhcGhpY3MsIHBhaW50VHlwZSwgY29sb3IpOwogICAgICAgICAgZ3JhcGhpY3MudHJhbnNmb3JtKGRpbXguc2NhbGUsIDAsIDAsIGRpbXkuc2NhbGUsIDAsIDApOwogICAgICAgICAgZ3JhcGhpY3MudHJhbnNmb3JtKDEsIDAsIDAsIDEsIC14MCwgLXkwKTsKICAgICAgICAgIHRoaXMuY2xpcEJib3goZ3JhcGhpY3MsIGJib3gsIHgwLCB5MCwgeDEsIHkxKTsKICAgICAgICAgIGdyYXBoaWNzLmV4ZWN1dGVPcGVyYXRvckxpc3Qob3BlcmF0b3JMaXN0KTsKICAgICAgICAgIHRoaXMuY3R4LnRyYW5zZm9ybSgxLCAwLCAwLCAxLCB4MCwgeTApOwogICAgICAgICAgdGhpcy5jdHguc2NhbGUoMSAvIGRpbXguc2NhbGUsIDEgLyBkaW15LnNjYWxlKTsKICAgICAgICAgIHJldHVybiB0bXBDYW52YXMuY2FudmFzOwogICAgICAgIH0sCiAgICAgICAgZ2V0U2l6ZUFuZFNjYWxlOiBmdW5jdGlvbiBUaWxpbmdQYXR0ZXJuX2dldFNpemVBbmRTY2FsZShzdGVwLCByZWFsT3V0cHV0U2l6ZSwgc2NhbGUpIHsKICAgICAgICAgIHN0ZXAgPSBNYXRoLmFicyhzdGVwKTsKICAgICAgICAgIHZhciBtYXhTaXplID0gTWF0aC5tYXgoTUFYX1BBVFRFUk5fU0laRSwgcmVhbE91dHB1dFNpemUpOwogICAgICAgICAgdmFyIHNpemUgPSBNYXRoLmNlaWwoc3RlcCAqIHNjYWxlKTsKCiAgICAgICAgICBpZiAoc2l6ZSA+PSBtYXhTaXplKSB7CiAgICAgICAgICAgIHNpemUgPSBtYXhTaXplOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc2NhbGUgPSBzaXplIC8gc3RlcDsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBzY2FsZTogc2NhbGUsCiAgICAgICAgICAgIHNpemU6IHNpemUKICAgICAgICAgIH07CiAgICAgICAgfSwKICAgICAgICBjbGlwQmJveDogZnVuY3Rpb24gY2xpcEJib3goZ3JhcGhpY3MsIGJib3gsIHgwLCB5MCwgeDEsIHkxKSB7CiAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShiYm94KSAmJiBiYm94Lmxlbmd0aCA9PT0gNCkgewogICAgICAgICAgICB2YXIgYmJveFdpZHRoID0geDEgLSB4MDsKICAgICAgICAgICAgdmFyIGJib3hIZWlnaHQgPSB5MSAtIHkwOwogICAgICAgICAgICBncmFwaGljcy5jdHgucmVjdCh4MCwgeTAsIGJib3hXaWR0aCwgYmJveEhlaWdodCk7CiAgICAgICAgICAgIGdyYXBoaWNzLmNsaXAoKTsKICAgICAgICAgICAgZ3JhcGhpY3MuZW5kUGF0aCgpOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgc2V0RmlsbEFuZFN0cm9rZVN0eWxlVG9Db250ZXh0OiBmdW5jdGlvbiBzZXRGaWxsQW5kU3Ryb2tlU3R5bGVUb0NvbnRleHQoZ3JhcGhpY3MsIHBhaW50VHlwZSwgY29sb3IpIHsKICAgICAgICAgIHZhciBjb250ZXh0ID0gZ3JhcGhpY3MuY3R4LAogICAgICAgICAgICBjdXJyZW50ID0gZ3JhcGhpY3MuY3VycmVudDsKCiAgICAgICAgICBzd2l0Y2ggKHBhaW50VHlwZSkgewogICAgICAgICAgICBjYXNlIFBhaW50VHlwZS5DT0xPUkVEOgogICAgICAgICAgICAgIHZhciBjdHggPSB0aGlzLmN0eDsKICAgICAgICAgICAgICBjb250ZXh0LmZpbGxTdHlsZSA9IGN0eC5maWxsU3R5bGU7CiAgICAgICAgICAgICAgY29udGV4dC5zdHJva2VTdHlsZSA9IGN0eC5zdHJva2VTdHlsZTsKICAgICAgICAgICAgICBjdXJyZW50LmZpbGxDb2xvciA9IGN0eC5maWxsU3R5bGU7CiAgICAgICAgICAgICAgY3VycmVudC5zdHJva2VDb2xvciA9IGN0eC5zdHJva2VTdHlsZTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgUGFpbnRUeXBlLlVOQ09MT1JFRDoKICAgICAgICAgICAgICB2YXIgY3NzQ29sb3IgPSBfdXRpbC5VdGlsLm1ha2VDc3NSZ2IoY29sb3JbMF0sIGNvbG9yWzFdLCBjb2xvclsyXSk7CgogICAgICAgICAgICAgIGNvbnRleHQuZmlsbFN0eWxlID0gY3NzQ29sb3I7CiAgICAgICAgICAgICAgY29udGV4dC5zdHJva2VTdHlsZSA9IGNzc0NvbG9yOwogICAgICAgICAgICAgIGN1cnJlbnQuZmlsbENvbG9yID0gY3NzQ29sb3I7CiAgICAgICAgICAgICAgY3VycmVudC5zdHJva2VDb2xvciA9IGNzc0NvbG9yOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIlVuc3VwcG9ydGVkIHBhaW50IHR5cGU6ICIuY29uY2F0KHBhaW50VHlwZSkpOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgZ2V0UGF0dGVybjogZnVuY3Rpb24gVGlsaW5nUGF0dGVybl9nZXRQYXR0ZXJuKGN0eCwgb3duZXIpIHsKICAgICAgICAgIGN0eCA9IHRoaXMuY3R4OwogICAgICAgICAgY3R4LnNldFRyYW5zZm9ybS5hcHBseShjdHgsIHRoaXMuYmFzZVRyYW5zZm9ybSk7CiAgICAgICAgICBjdHgudHJhbnNmb3JtLmFwcGx5KGN0eCwgdGhpcy5tYXRyaXgpOwogICAgICAgICAgdmFyIHRlbXBvcmFyeVBhdHRlcm5DYW52YXMgPSB0aGlzLmNyZWF0ZVBhdHRlcm5DYW52YXMob3duZXIpOwogICAgICAgICAgcmV0dXJuIGN0eC5jcmVhdGVQYXR0ZXJuKHRlbXBvcmFyeVBhdHRlcm5DYW52YXMsICJyZXBlYXQiKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHJldHVybiBUaWxpbmdQYXR0ZXJuOwogICAgfSgpOwoKICAgIGV4cG9ydHMuVGlsaW5nUGF0dGVybiA9IFRpbGluZ1BhdHRlcm47CgogICAgLyoqKi99KSwgKAogIC8qIDE5OSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCgogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICB2YWx1ZTogdHJ1ZQogICAgfSk7CiAgICBleHBvcnRzLkdsb2JhbFdvcmtlck9wdGlvbnMgPSB2b2lkIDA7CiAgICB2YXIgR2xvYmFsV29ya2VyT3B0aW9ucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBleHBvcnRzLkdsb2JhbFdvcmtlck9wdGlvbnMgPSBHbG9iYWxXb3JrZXJPcHRpb25zOwogICAgR2xvYmFsV29ya2VyT3B0aW9ucy53b3JrZXJQb3J0ID0gR2xvYmFsV29ya2VyT3B0aW9ucy53b3JrZXJQb3J0ID09PSB1bmRlZmluZWQgPyBudWxsIDogR2xvYmFsV29ya2VyT3B0aW9ucy53b3JrZXJQb3J0OwogICAgR2xvYmFsV29ya2VyT3B0aW9ucy53b3JrZXJTcmMgPSBHbG9iYWxXb3JrZXJPcHRpb25zLndvcmtlclNyYyA9PT0gdW5kZWZpbmVkID8gIiIgOiBHbG9iYWxXb3JrZXJPcHRpb25zLndvcmtlclNyYzsKCiAgICAvKioqL30pLCAoCiAgLyogMjAwICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgIHZhbHVlOiB0cnVlCiAgICB9KTsKICAgIGV4cG9ydHMuTWVzc2FnZUhhbmRsZXIgPSB2b2lkIDA7CgogICAgdmFyIF9yZWdlbmVyYXRvciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX193X3BkZmpzX3JlcXVpcmVfXygxOTEpKTsKCiAgICB2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEpOwoKICAgIGZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7cmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgImRlZmF1bHQiOiBvYmogfTt9CgogICAgZnVuY3Rpb24gYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBrZXksIGFyZykge3RyeSB7dmFyIGluZm8gPSBnZW5ba2V5XShhcmcpO3ZhciB2YWx1ZSA9IGluZm8udmFsdWU7fSBjYXRjaCAoZXJyb3IpIHtyZWplY3QoZXJyb3IpO3JldHVybjt9aWYgKGluZm8uZG9uZSkge3Jlc29sdmUodmFsdWUpO30gZWxzZSB7UHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKF9uZXh0LCBfdGhyb3cpO319CgogICAgZnVuY3Rpb24gX2FzeW5jVG9HZW5lcmF0b3IoZm4pIHtyZXR1cm4gZnVuY3Rpb24gKCkge3ZhciBzZWxmID0gdGhpcyxhcmdzID0gYXJndW1lbnRzO3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7dmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpO2Z1bmN0aW9uIF9uZXh0KHZhbHVlKSB7YXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAibmV4dCIsIHZhbHVlKTt9ZnVuY3Rpb24gX3Rocm93KGVycikge2FzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyKTt9X25leHQodW5kZWZpbmVkKTt9KTt9O30KCiAgICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7aWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTt9fQoKICAgIGZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHtmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7dmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTtkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7ZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlO2lmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlO09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTt9fQoKICAgIGZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHtpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTtpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7cmV0dXJuIENvbnN0cnVjdG9yO30KCiAgICBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyJAYmFiZWwvaGVscGVycyAtIHR5cGVvZiI7aWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIpIHtfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHtyZXR1cm4gdHlwZW9mIG9iajt9O30gZWxzZSB7X3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7cmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajt9O31yZXR1cm4gX3R5cGVvZihvYmopO30KCiAgICB2YXIgQ2FsbGJhY2tLaW5kID0gewogICAgICBVTktOT1dOOiAwLAogICAgICBEQVRBOiAxLAogICAgICBFUlJPUjogMgogICAgfTsKICAgIHZhciBTdHJlYW1LaW5kID0gewogICAgICBVTktOT1dOOiAwLAogICAgICBDQU5DRUw6IDEsCiAgICAgIENBTkNFTF9DT01QTEVURTogMiwKICAgICAgQ0xPU0U6IDMsCiAgICAgIEVOUVVFVUU6IDQsCiAgICAgIEVSUk9SOiA1LAogICAgICBQVUxMOiA2LAogICAgICBQVUxMX0NPTVBMRVRFOiA3LAogICAgICBTVEFSVF9DT01QTEVURTogOAogICAgfTsKCiAgICBmdW5jdGlvbiB3cmFwUmVhc29uKHJlYXNvbikgewogICAgICBpZiAoX3R5cGVvZihyZWFzb24pICE9PSAib2JqZWN0IiB8fCByZWFzb24gPT09IG51bGwpIHsKICAgICAgICByZXR1cm4gcmVhc29uOwogICAgICB9CgogICAgICBzd2l0Y2ggKHJlYXNvbi5uYW1lKSB7CiAgICAgICAgY2FzZSAiQWJvcnRFeGNlcHRpb24iOgogICAgICAgICAgcmV0dXJuIG5ldyBfdXRpbC5BYm9ydEV4Y2VwdGlvbihyZWFzb24ubWVzc2FnZSk7CgogICAgICAgIGNhc2UgIk1pc3NpbmdQREZFeGNlcHRpb24iOgogICAgICAgICAgcmV0dXJuIG5ldyBfdXRpbC5NaXNzaW5nUERGRXhjZXB0aW9uKHJlYXNvbi5tZXNzYWdlKTsKCiAgICAgICAgY2FzZSAiVW5leHBlY3RlZFJlc3BvbnNlRXhjZXB0aW9uIjoKICAgICAgICAgIHJldHVybiBuZXcgX3V0aWwuVW5leHBlY3RlZFJlc3BvbnNlRXhjZXB0aW9uKHJlYXNvbi5tZXNzYWdlLCByZWFzb24uc3RhdHVzKTsKCiAgICAgICAgY2FzZSAiVW5rbm93bkVycm9yRXhjZXB0aW9uIjoKICAgICAgICAgIHJldHVybiBuZXcgX3V0aWwuVW5rbm93bkVycm9yRXhjZXB0aW9uKHJlYXNvbi5tZXNzYWdlLCByZWFzb24uZGV0YWlscyk7CgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICByZXR1cm4gbmV3IF91dGlsLlVua25vd25FcnJvckV4Y2VwdGlvbihyZWFzb24ubWVzc2FnZSwgcmVhc29uLnRvU3RyaW5nKCkpOwogICAgICB9CiAgICB9CgogICAgdmFyIE1lc3NhZ2VIYW5kbGVyID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gTWVzc2FnZUhhbmRsZXIoc291cmNlTmFtZSwgdGFyZ2V0TmFtZSwgY29tT2JqKSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIE1lc3NhZ2VIYW5kbGVyKTsKCiAgICAgICAgdGhpcy5zb3VyY2VOYW1lID0gc291cmNlTmFtZTsKICAgICAgICB0aGlzLnRhcmdldE5hbWUgPSB0YXJnZXROYW1lOwogICAgICAgIHRoaXMuY29tT2JqID0gY29tT2JqOwogICAgICAgIHRoaXMuY2FsbGJhY2tJZCA9IDE7CiAgICAgICAgdGhpcy5zdHJlYW1JZCA9IDE7CiAgICAgICAgdGhpcy5wb3N0TWVzc2FnZVRyYW5zZmVycyA9IHRydWU7CiAgICAgICAgdGhpcy5zdHJlYW1TaW5rcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgdGhpcy5zdHJlYW1Db250cm9sbGVycyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgdGhpcy5jYWxsYmFja0NhcGFiaWxpdGllcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgdGhpcy5hY3Rpb25IYW5kbGVyID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKCiAgICAgICAgdGhpcy5fb25Db21PYmpPbk1lc3NhZ2UgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgIHZhciBkYXRhID0gZXZlbnQuZGF0YTsKCiAgICAgICAgICBpZiAoZGF0YS50YXJnZXROYW1lICE9PSBfdGhpcy5zb3VyY2VOYW1lKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZGF0YS5zdHJlYW0pIHsKICAgICAgICAgICAgX3RoaXMuX3Byb2Nlc3NTdHJlYW1NZXNzYWdlKGRhdGEpOwoKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChkYXRhLmNhbGxiYWNrKSB7CiAgICAgICAgICAgIHZhciBjYWxsYmFja0lkID0gZGF0YS5jYWxsYmFja0lkOwogICAgICAgICAgICB2YXIgY2FwYWJpbGl0eSA9IF90aGlzLmNhbGxiYWNrQ2FwYWJpbGl0aWVzW2NhbGxiYWNrSWRdOwoKICAgICAgICAgICAgaWYgKCFjYXBhYmlsaXR5KSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJDYW5ub3QgcmVzb2x2ZSBjYWxsYmFjayAiLmNvbmNhdChjYWxsYmFja0lkKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGRlbGV0ZSBfdGhpcy5jYWxsYmFja0NhcGFiaWxpdGllc1tjYWxsYmFja0lkXTsKCiAgICAgICAgICAgIGlmIChkYXRhLmNhbGxiYWNrID09PSBDYWxsYmFja0tpbmQuREFUQSkgewogICAgICAgICAgICAgIGNhcGFiaWxpdHkucmVzb2x2ZShkYXRhLmRhdGEpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGRhdGEuY2FsbGJhY2sgPT09IENhbGxiYWNrS2luZC5FUlJPUikgewogICAgICAgICAgICAgIGNhcGFiaWxpdHkucmVqZWN0KHdyYXBSZWFzb24oZGF0YS5yZWFzb24pKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVuZXhwZWN0ZWQgY2FsbGJhY2sgY2FzZSIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGFjdGlvbiA9IF90aGlzLmFjdGlvbkhhbmRsZXJbZGF0YS5hY3Rpb25dOwoKICAgICAgICAgIGlmICghYWN0aW9uKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5rbm93biBhY3Rpb24gZnJvbSB3b3JrZXI6ICIuY29uY2F0KGRhdGEuYWN0aW9uKSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGRhdGEuY2FsbGJhY2tJZCkgewogICAgICAgICAgICB2YXIgX3NvdXJjZU5hbWUgPSBfdGhpcy5zb3VyY2VOYW1lOwogICAgICAgICAgICB2YXIgX3RhcmdldE5hbWUgPSBkYXRhLnNvdXJjZU5hbWU7CiAgICAgICAgICAgIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgICAgICAgcmVzb2x2ZShhY3Rpb24oZGF0YS5kYXRhKSk7CiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgICBzb3VyY2VOYW1lOiBfc291cmNlTmFtZSwKICAgICAgICAgICAgICAgIHRhcmdldE5hbWU6IF90YXJnZXROYW1lLAogICAgICAgICAgICAgICAgY2FsbGJhY2s6IENhbGxiYWNrS2luZC5EQVRBLAogICAgICAgICAgICAgICAgY2FsbGJhY2tJZDogZGF0YS5jYWxsYmFja0lkLAogICAgICAgICAgICAgICAgZGF0YTogcmVzdWx0CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgICAgc291cmNlTmFtZTogX3NvdXJjZU5hbWUsCiAgICAgICAgICAgICAgICB0YXJnZXROYW1lOiBfdGFyZ2V0TmFtZSwKICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBDYWxsYmFja0tpbmQuRVJST1IsCiAgICAgICAgICAgICAgICBjYWxsYmFja0lkOiBkYXRhLmNhbGxiYWNrSWQsCiAgICAgICAgICAgICAgICByZWFzb246IHdyYXBSZWFzb24ocmVhc29uKQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChkYXRhLnN0cmVhbUlkKSB7CiAgICAgICAgICAgIF90aGlzLl9jcmVhdGVTdHJlYW1TaW5rKGRhdGEpOwoKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGFjdGlvbihkYXRhLmRhdGEpOwogICAgICAgIH07CgogICAgICAgIGNvbU9iai5hZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIiwgdGhpcy5fb25Db21PYmpPbk1lc3NhZ2UpOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoTWVzc2FnZUhhbmRsZXIsIFt7CiAgICAgICAga2V5OiAib24iLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBvbihhY3Rpb25OYW1lLCBoYW5kbGVyKSB7CiAgICAgICAgICB2YXIgYWggPSB0aGlzLmFjdGlvbkhhbmRsZXI7CgogICAgICAgICAgaWYgKGFoW2FjdGlvbk5hbWVdKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVGhlcmUgaXMgYWxyZWFkeSBhbiBhY3Rpb25OYW1lIGNhbGxlZCBcIiIuY29uY2F0KGFjdGlvbk5hbWUsICJcIiIpKTsKICAgICAgICAgIH0KCiAgICAgICAgICBhaFthY3Rpb25OYW1lXSA9IGhhbmRsZXI7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAic2VuZCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNlbmQoYWN0aW9uTmFtZSwgZGF0YSwgdHJhbnNmZXJzKSB7CiAgICAgICAgICB0aGlzLl9wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgIHNvdXJjZU5hbWU6IHRoaXMuc291cmNlTmFtZSwKICAgICAgICAgICAgdGFyZ2V0TmFtZTogdGhpcy50YXJnZXROYW1lLAogICAgICAgICAgICBhY3Rpb246IGFjdGlvbk5hbWUsCiAgICAgICAgICAgIGRhdGE6IGRhdGEKICAgICAgICAgIH0sIHRyYW5zZmVycyk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAic2VuZFdpdGhQcm9taXNlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gc2VuZFdpdGhQcm9taXNlKGFjdGlvbk5hbWUsIGRhdGEsIHRyYW5zZmVycykgewogICAgICAgICAgdmFyIGNhbGxiYWNrSWQgPSB0aGlzLmNhbGxiYWNrSWQrKzsKICAgICAgICAgIHZhciBjYXBhYmlsaXR5ID0gKDAsIF91dGlsLmNyZWF0ZVByb21pc2VDYXBhYmlsaXR5KSgpOwogICAgICAgICAgdGhpcy5jYWxsYmFja0NhcGFiaWxpdGllc1tjYWxsYmFja0lkXSA9IGNhcGFiaWxpdHk7CgogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdGhpcy5fcG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgIHNvdXJjZU5hbWU6IHRoaXMuc291cmNlTmFtZSwKICAgICAgICAgICAgICB0YXJnZXROYW1lOiB0aGlzLnRhcmdldE5hbWUsCiAgICAgICAgICAgICAgYWN0aW9uOiBhY3Rpb25OYW1lLAogICAgICAgICAgICAgIGNhbGxiYWNrSWQ6IGNhbGxiYWNrSWQsCiAgICAgICAgICAgICAgZGF0YTogZGF0YQogICAgICAgICAgICB9LCB0cmFuc2ZlcnMpOwogICAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgICAgY2FwYWJpbGl0eS5yZWplY3QoZXgpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBjYXBhYmlsaXR5LnByb21pc2U7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAic2VuZFdpdGhTdHJlYW0iLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZW5kV2l0aFN0cmVhbShhY3Rpb25OYW1lLCBkYXRhLCBxdWV1ZWluZ1N0cmF0ZWd5LCB0cmFuc2ZlcnMpIHsKICAgICAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgICAgIHZhciBzdHJlYW1JZCA9IHRoaXMuc3RyZWFtSWQrKzsKICAgICAgICAgIHZhciBzb3VyY2VOYW1lID0gdGhpcy5zb3VyY2VOYW1lOwogICAgICAgICAgdmFyIHRhcmdldE5hbWUgPSB0aGlzLnRhcmdldE5hbWU7CiAgICAgICAgICB2YXIgY29tT2JqID0gdGhpcy5jb21PYmo7CiAgICAgICAgICByZXR1cm4gbmV3IFJlYWRhYmxlU3RyZWFtKHsKICAgICAgICAgICAgc3RhcnQ6IGZ1bmN0aW9uIHN0YXJ0KGNvbnRyb2xsZXIpIHsKICAgICAgICAgICAgICB2YXIgc3RhcnRDYXBhYmlsaXR5ID0gKDAsIF91dGlsLmNyZWF0ZVByb21pc2VDYXBhYmlsaXR5KSgpOwogICAgICAgICAgICAgIF90aGlzMi5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF0gPSB7CiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBjb250cm9sbGVyLAogICAgICAgICAgICAgICAgc3RhcnRDYWxsOiBzdGFydENhcGFiaWxpdHksCiAgICAgICAgICAgICAgICBwdWxsQ2FsbDogbnVsbCwKICAgICAgICAgICAgICAgIGNhbmNlbENhbGw6IG51bGwsCiAgICAgICAgICAgICAgICBpc0Nsb3NlZDogZmFsc2UKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICBfdGhpczIuX3Bvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICAgIHNvdXJjZU5hbWU6IHNvdXJjZU5hbWUsCiAgICAgICAgICAgICAgICB0YXJnZXROYW1lOiB0YXJnZXROYW1lLAogICAgICAgICAgICAgICAgYWN0aW9uOiBhY3Rpb25OYW1lLAogICAgICAgICAgICAgICAgc3RyZWFtSWQ6IHN0cmVhbUlkLAogICAgICAgICAgICAgICAgZGF0YTogZGF0YSwKICAgICAgICAgICAgICAgIGRlc2lyZWRTaXplOiBjb250cm9sbGVyLmRlc2lyZWRTaXplCiAgICAgICAgICAgICAgfSwgdHJhbnNmZXJzKTsKCiAgICAgICAgICAgICAgcmV0dXJuIHN0YXJ0Q2FwYWJpbGl0eS5wcm9taXNlOwogICAgICAgICAgICB9LAogICAgICAgICAgICBwdWxsOiBmdW5jdGlvbiBwdWxsKGNvbnRyb2xsZXIpIHsKICAgICAgICAgICAgICB2YXIgcHVsbENhcGFiaWxpdHkgPSAoMCwgX3V0aWwuY3JlYXRlUHJvbWlzZUNhcGFiaWxpdHkpKCk7CiAgICAgICAgICAgICAgX3RoaXMyLnN0cmVhbUNvbnRyb2xsZXJzW3N0cmVhbUlkXS5wdWxsQ2FsbCA9IHB1bGxDYXBhYmlsaXR5OwogICAgICAgICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgICBzb3VyY2VOYW1lOiBzb3VyY2VOYW1lLAogICAgICAgICAgICAgICAgdGFyZ2V0TmFtZTogdGFyZ2V0TmFtZSwKICAgICAgICAgICAgICAgIHN0cmVhbTogU3RyZWFtS2luZC5QVUxMLAogICAgICAgICAgICAgICAgc3RyZWFtSWQ6IHN0cmVhbUlkLAogICAgICAgICAgICAgICAgZGVzaXJlZFNpemU6IGNvbnRyb2xsZXIuZGVzaXJlZFNpemUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICByZXR1cm4gcHVsbENhcGFiaWxpdHkucHJvbWlzZTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2FuY2VsOiBmdW5jdGlvbiBjYW5jZWwocmVhc29uKSB7CiAgICAgICAgICAgICAgKDAsIF91dGlsLmFzc2VydCkocmVhc29uIGluc3RhbmNlb2YgRXJyb3IsICJjYW5jZWwgbXVzdCBoYXZlIGEgdmFsaWQgcmVhc29uIik7CiAgICAgICAgICAgICAgdmFyIGNhbmNlbENhcGFiaWxpdHkgPSAoMCwgX3V0aWwuY3JlYXRlUHJvbWlzZUNhcGFiaWxpdHkpKCk7CiAgICAgICAgICAgICAgX3RoaXMyLnN0cmVhbUNvbnRyb2xsZXJzW3N0cmVhbUlkXS5jYW5jZWxDYWxsID0gY2FuY2VsQ2FwYWJpbGl0eTsKICAgICAgICAgICAgICBfdGhpczIuc3RyZWFtQ29udHJvbGxlcnNbc3RyZWFtSWRdLmlzQ2xvc2VkID0gdHJ1ZTsKICAgICAgICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgICAgc291cmNlTmFtZTogc291cmNlTmFtZSwKICAgICAgICAgICAgICAgIHRhcmdldE5hbWU6IHRhcmdldE5hbWUsCiAgICAgICAgICAgICAgICBzdHJlYW06IFN0cmVhbUtpbmQuQ0FOQ0VMLAogICAgICAgICAgICAgICAgc3RyZWFtSWQ6IHN0cmVhbUlkLAogICAgICAgICAgICAgICAgcmVhc29uOiB3cmFwUmVhc29uKHJlYXNvbikKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICByZXR1cm4gY2FuY2VsQ2FwYWJpbGl0eS5wcm9taXNlOwogICAgICAgICAgICB9CiAgICAgICAgICB9LCBxdWV1ZWluZ1N0cmF0ZWd5KTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJfY3JlYXRlU3RyZWFtU2luayIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9jcmVhdGVTdHJlYW1TaW5rKGRhdGEpIHsKICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgIHZhciBhY3Rpb24gPSB0aGlzLmFjdGlvbkhhbmRsZXJbZGF0YS5hY3Rpb25dOwogICAgICAgICAgdmFyIHN0cmVhbUlkID0gZGF0YS5zdHJlYW1JZDsKICAgICAgICAgIHZhciBzb3VyY2VOYW1lID0gdGhpcy5zb3VyY2VOYW1lOwogICAgICAgICAgdmFyIHRhcmdldE5hbWUgPSBkYXRhLnNvdXJjZU5hbWU7CiAgICAgICAgICB2YXIgY29tT2JqID0gdGhpcy5jb21PYmo7CiAgICAgICAgICB2YXIgc3RyZWFtU2luayA9IHsKICAgICAgICAgICAgZW5xdWV1ZTogZnVuY3Rpb24gZW5xdWV1ZShjaHVuaykgewogICAgICAgICAgICAgIHZhciBzaXplID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiAxOwogICAgICAgICAgICAgIHZhciB0cmFuc2ZlcnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMiA/IGFyZ3VtZW50c1syXSA6IHVuZGVmaW5lZDsKCiAgICAgICAgICAgICAgaWYgKHRoaXMuaXNDYW5jZWxsZWQpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBsYXN0RGVzaXJlZFNpemUgPSB0aGlzLmRlc2lyZWRTaXplOwogICAgICAgICAgICAgIHRoaXMuZGVzaXJlZFNpemUgLT0gc2l6ZTsKCiAgICAgICAgICAgICAgaWYgKGxhc3REZXNpcmVkU2l6ZSA+IDAgJiYgdGhpcy5kZXNpcmVkU2l6ZSA8PSAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNpbmtDYXBhYmlsaXR5ID0gKDAsIF91dGlsLmNyZWF0ZVByb21pc2VDYXBhYmlsaXR5KSgpOwogICAgICAgICAgICAgICAgdGhpcy5yZWFkeSA9IHRoaXMuc2lua0NhcGFiaWxpdHkucHJvbWlzZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHNlbGYuX3Bvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICAgIHNvdXJjZU5hbWU6IHNvdXJjZU5hbWUsCiAgICAgICAgICAgICAgICB0YXJnZXROYW1lOiB0YXJnZXROYW1lLAogICAgICAgICAgICAgICAgc3RyZWFtOiBTdHJlYW1LaW5kLkVOUVVFVUUsCiAgICAgICAgICAgICAgICBzdHJlYW1JZDogc3RyZWFtSWQsCiAgICAgICAgICAgICAgICBjaHVuazogY2h1bmsKICAgICAgICAgICAgICB9LCB0cmFuc2ZlcnMpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjbG9zZTogZnVuY3Rpb24gY2xvc2UoKSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuaXNDYW5jZWxsZWQpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHRoaXMuaXNDYW5jZWxsZWQgPSB0cnVlOwogICAgICAgICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgICBzb3VyY2VOYW1lOiBzb3VyY2VOYW1lLAogICAgICAgICAgICAgICAgdGFyZ2V0TmFtZTogdGFyZ2V0TmFtZSwKICAgICAgICAgICAgICAgIHN0cmVhbTogU3RyZWFtS2luZC5DTE9TRSwKICAgICAgICAgICAgICAgIHN0cmVhbUlkOiBzdHJlYW1JZAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGRlbGV0ZSBzZWxmLnN0cmVhbVNpbmtzW3N0cmVhbUlkXTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIGVycm9yKHJlYXNvbikgewogICAgICAgICAgICAgICgwLCBfdXRpbC5hc3NlcnQpKHJlYXNvbiBpbnN0YW5jZW9mIEVycm9yLCAiZXJyb3IgbXVzdCBoYXZlIGEgdmFsaWQgcmVhc29uIik7CgogICAgICAgICAgICAgIGlmICh0aGlzLmlzQ2FuY2VsbGVkKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB0aGlzLmlzQ2FuY2VsbGVkID0gdHJ1ZTsKICAgICAgICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgICAgc291cmNlTmFtZTogc291cmNlTmFtZSwKICAgICAgICAgICAgICAgIHRhcmdldE5hbWU6IHRhcmdldE5hbWUsCiAgICAgICAgICAgICAgICBzdHJlYW06IFN0cmVhbUtpbmQuRVJST1IsCiAgICAgICAgICAgICAgICBzdHJlYW1JZDogc3RyZWFtSWQsCiAgICAgICAgICAgICAgICByZWFzb246IHdyYXBSZWFzb24ocmVhc29uKQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzaW5rQ2FwYWJpbGl0eTogKDAsIF91dGlsLmNyZWF0ZVByb21pc2VDYXBhYmlsaXR5KSgpLAogICAgICAgICAgICBvblB1bGw6IG51bGwsCiAgICAgICAgICAgIG9uQ2FuY2VsOiBudWxsLAogICAgICAgICAgICBpc0NhbmNlbGxlZDogZmFsc2UsCiAgICAgICAgICAgIGRlc2lyZWRTaXplOiBkYXRhLmRlc2lyZWRTaXplLAogICAgICAgICAgICByZWFkeTogbnVsbAogICAgICAgICAgfTsKICAgICAgICAgIHN0cmVhbVNpbmsuc2lua0NhcGFiaWxpdHkucmVzb2x2ZSgpOwogICAgICAgICAgc3RyZWFtU2luay5yZWFkeSA9IHN0cmVhbVNpbmsuc2lua0NhcGFiaWxpdHkucHJvbWlzZTsKICAgICAgICAgIHRoaXMuc3RyZWFtU2lua3Nbc3RyZWFtSWRdID0gc3RyZWFtU2luazsKICAgICAgICAgIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgICAgIHJlc29sdmUoYWN0aW9uKGRhdGEuZGF0YSwgc3RyZWFtU2luaykpOwogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgc291cmNlTmFtZTogc291cmNlTmFtZSwKICAgICAgICAgICAgICB0YXJnZXROYW1lOiB0YXJnZXROYW1lLAogICAgICAgICAgICAgIHN0cmVhbTogU3RyZWFtS2luZC5TVEFSVF9DT01QTEVURSwKICAgICAgICAgICAgICBzdHJlYW1JZDogc3RyZWFtSWQsCiAgICAgICAgICAgICAgc3VjY2VzczogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgICAgY29tT2JqLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICBzb3VyY2VOYW1lOiBzb3VyY2VOYW1lLAogICAgICAgICAgICAgIHRhcmdldE5hbWU6IHRhcmdldE5hbWUsCiAgICAgICAgICAgICAgc3RyZWFtOiBTdHJlYW1LaW5kLlNUQVJUX0NPTVBMRVRFLAogICAgICAgICAgICAgIHN0cmVhbUlkOiBzdHJlYW1JZCwKICAgICAgICAgICAgICByZWFzb246IHdyYXBSZWFzb24ocmVhc29uKQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIl9wcm9jZXNzU3RyZWFtTWVzc2FnZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9wcm9jZXNzU3RyZWFtTWVzc2FnZShkYXRhKSB7CiAgICAgICAgICB2YXIgc3RyZWFtSWQgPSBkYXRhLnN0cmVhbUlkOwogICAgICAgICAgdmFyIHNvdXJjZU5hbWUgPSB0aGlzLnNvdXJjZU5hbWU7CiAgICAgICAgICB2YXIgdGFyZ2V0TmFtZSA9IGRhdGEuc291cmNlTmFtZTsKICAgICAgICAgIHZhciBjb21PYmogPSB0aGlzLmNvbU9iajsKCiAgICAgICAgICBzd2l0Y2ggKGRhdGEuc3RyZWFtKSB7CiAgICAgICAgICAgIGNhc2UgU3RyZWFtS2luZC5TVEFSVF9DT01QTEVURToKICAgICAgICAgICAgICBpZiAoZGF0YS5zdWNjZXNzKSB7CiAgICAgICAgICAgICAgICB0aGlzLnN0cmVhbUNvbnRyb2xsZXJzW3N0cmVhbUlkXS5zdGFydENhbGwucmVzb2x2ZSgpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLnN0cmVhbUNvbnRyb2xsZXJzW3N0cmVhbUlkXS5zdGFydENhbGwucmVqZWN0KHdyYXBSZWFzb24oZGF0YS5yZWFzb24pKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSBTdHJlYW1LaW5kLlBVTExfQ09NUExFVEU6CiAgICAgICAgICAgICAgaWYgKGRhdGEuc3VjY2VzcykgewogICAgICAgICAgICAgICAgdGhpcy5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF0ucHVsbENhbGwucmVzb2x2ZSgpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLnN0cmVhbUNvbnRyb2xsZXJzW3N0cmVhbUlkXS5wdWxsQ2FsbC5yZWplY3Qod3JhcFJlYXNvbihkYXRhLnJlYXNvbikpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIFN0cmVhbUtpbmQuUFVMTDoKICAgICAgICAgICAgICBpZiAoIXRoaXMuc3RyZWFtU2lua3Nbc3RyZWFtSWRdKSB7CiAgICAgICAgICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgICAgICBzb3VyY2VOYW1lOiBzb3VyY2VOYW1lLAogICAgICAgICAgICAgICAgICB0YXJnZXROYW1lOiB0YXJnZXROYW1lLAogICAgICAgICAgICAgICAgICBzdHJlYW06IFN0cmVhbUtpbmQuUFVMTF9DT01QTEVURSwKICAgICAgICAgICAgICAgICAgc3RyZWFtSWQ6IHN0cmVhbUlkLAogICAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHRoaXMuc3RyZWFtU2lua3Nbc3RyZWFtSWRdLmRlc2lyZWRTaXplIDw9IDAgJiYgZGF0YS5kZXNpcmVkU2l6ZSA+IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuc3RyZWFtU2lua3Nbc3RyZWFtSWRdLnNpbmtDYXBhYmlsaXR5LnJlc29sdmUoKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHRoaXMuc3RyZWFtU2lua3Nbc3RyZWFtSWRdLmRlc2lyZWRTaXplID0gZGF0YS5kZXNpcmVkU2l6ZTsKICAgICAgICAgICAgICB2YXIgb25QdWxsID0gdGhpcy5zdHJlYW1TaW5rc1tkYXRhLnN0cmVhbUlkXS5vblB1bGw7CiAgICAgICAgICAgICAgbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICAgICAgICAgIHJlc29sdmUob25QdWxsICYmIG9uUHVsbCgpKTsKICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgICAgIHNvdXJjZU5hbWU6IHNvdXJjZU5hbWUsCiAgICAgICAgICAgICAgICAgIHRhcmdldE5hbWU6IHRhcmdldE5hbWUsCiAgICAgICAgICAgICAgICAgIHN0cmVhbTogU3RyZWFtS2luZC5QVUxMX0NPTVBMRVRFLAogICAgICAgICAgICAgICAgICBzdHJlYW1JZDogc3RyZWFtSWQsCiAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgICAgIHNvdXJjZU5hbWU6IHNvdXJjZU5hbWUsCiAgICAgICAgICAgICAgICAgIHRhcmdldE5hbWU6IHRhcmdldE5hbWUsCiAgICAgICAgICAgICAgICAgIHN0cmVhbTogU3RyZWFtS2luZC5QVUxMX0NPTVBMRVRFLAogICAgICAgICAgICAgICAgICBzdHJlYW1JZDogc3RyZWFtSWQsCiAgICAgICAgICAgICAgICAgIHJlYXNvbjogd3JhcFJlYXNvbihyZWFzb24pCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgU3RyZWFtS2luZC5FTlFVRVVFOgogICAgICAgICAgICAgICgwLCBfdXRpbC5hc3NlcnQpKHRoaXMuc3RyZWFtQ29udHJvbGxlcnNbc3RyZWFtSWRdLCAiZW5xdWV1ZSBzaG91bGQgaGF2ZSBzdHJlYW0gY29udHJvbGxlciIpOwoKICAgICAgICAgICAgICBpZiAodGhpcy5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF0uaXNDbG9zZWQpIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdGhpcy5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF0uY29udHJvbGxlci5lbnF1ZXVlKGRhdGEuY2h1bmspOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSBTdHJlYW1LaW5kLkNMT1NFOgogICAgICAgICAgICAgICgwLCBfdXRpbC5hc3NlcnQpKHRoaXMuc3RyZWFtQ29udHJvbGxlcnNbc3RyZWFtSWRdLCAiY2xvc2Ugc2hvdWxkIGhhdmUgc3RyZWFtIGNvbnRyb2xsZXIiKTsKCiAgICAgICAgICAgICAgaWYgKHRoaXMuc3RyZWFtQ29udHJvbGxlcnNbc3RyZWFtSWRdLmlzQ2xvc2VkKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHRoaXMuc3RyZWFtQ29udHJvbGxlcnNbc3RyZWFtSWRdLmlzQ2xvc2VkID0gdHJ1ZTsKICAgICAgICAgICAgICB0aGlzLnN0cmVhbUNvbnRyb2xsZXJzW3N0cmVhbUlkXS5jb250cm9sbGVyLmNsb3NlKCk7CgogICAgICAgICAgICAgIHRoaXMuX2RlbGV0ZVN0cmVhbUNvbnRyb2xsZXIoc3RyZWFtSWQpOwoKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgU3RyZWFtS2luZC5FUlJPUjoKICAgICAgICAgICAgICAoMCwgX3V0aWwuYXNzZXJ0KSh0aGlzLnN0cmVhbUNvbnRyb2xsZXJzW3N0cmVhbUlkXSwgImVycm9yIHNob3VsZCBoYXZlIHN0cmVhbSBjb250cm9sbGVyIik7CiAgICAgICAgICAgICAgdGhpcy5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF0uY29udHJvbGxlci5lcnJvcih3cmFwUmVhc29uKGRhdGEucmVhc29uKSk7CgogICAgICAgICAgICAgIHRoaXMuX2RlbGV0ZVN0cmVhbUNvbnRyb2xsZXIoc3RyZWFtSWQpOwoKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgU3RyZWFtS2luZC5DQU5DRUxfQ09NUExFVEU6CiAgICAgICAgICAgICAgaWYgKGRhdGEuc3VjY2VzcykgewogICAgICAgICAgICAgICAgdGhpcy5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF0uY2FuY2VsQ2FsbC5yZXNvbHZlKCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuc3RyZWFtQ29udHJvbGxlcnNbc3RyZWFtSWRdLmNhbmNlbENhbGwucmVqZWN0KHdyYXBSZWFzb24oZGF0YS5yZWFzb24pKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHRoaXMuX2RlbGV0ZVN0cmVhbUNvbnRyb2xsZXIoc3RyZWFtSWQpOwoKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgU3RyZWFtS2luZC5DQU5DRUw6CiAgICAgICAgICAgICAgaWYgKCF0aGlzLnN0cmVhbVNpbmtzW3N0cmVhbUlkXSkgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgb25DYW5jZWwgPSB0aGlzLnN0cmVhbVNpbmtzW2RhdGEuc3RyZWFtSWRdLm9uQ2FuY2VsOwogICAgICAgICAgICAgIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgICAgICAgICByZXNvbHZlKG9uQ2FuY2VsICYmIG9uQ2FuY2VsKHdyYXBSZWFzb24oZGF0YS5yZWFzb24pKSk7CiAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgICAgICBzb3VyY2VOYW1lOiBzb3VyY2VOYW1lLAogICAgICAgICAgICAgICAgICB0YXJnZXROYW1lOiB0YXJnZXROYW1lLAogICAgICAgICAgICAgICAgICBzdHJlYW06IFN0cmVhbUtpbmQuQ0FOQ0VMX0NPTVBMRVRFLAogICAgICAgICAgICAgICAgICBzdHJlYW1JZDogc3RyZWFtSWQsCiAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgICAgIHNvdXJjZU5hbWU6IHNvdXJjZU5hbWUsCiAgICAgICAgICAgICAgICAgIHRhcmdldE5hbWU6IHRhcmdldE5hbWUsCiAgICAgICAgICAgICAgICAgIHN0cmVhbTogU3RyZWFtS2luZC5DQU5DRUxfQ09NUExFVEUsCiAgICAgICAgICAgICAgICAgIHN0cmVhbUlkOiBzdHJlYW1JZCwKICAgICAgICAgICAgICAgICAgcmVhc29uOiB3cmFwUmVhc29uKHJlYXNvbikKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHRoaXMuc3RyZWFtU2lua3Nbc3RyZWFtSWRdLnNpbmtDYXBhYmlsaXR5LnJlamVjdCh3cmFwUmVhc29uKGRhdGEucmVhc29uKSk7CiAgICAgICAgICAgICAgdGhpcy5zdHJlYW1TaW5rc1tzdHJlYW1JZF0uaXNDYW5jZWxsZWQgPSB0cnVlOwogICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnN0cmVhbVNpbmtzW3N0cmVhbUlkXTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmV4cGVjdGVkIHN0cmVhbSBjYXNlIik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiX2RlbGV0ZVN0cmVhbUNvbnRyb2xsZXIiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgX2RlbGV0ZVN0cmVhbUNvbnRyb2xsZXIyID0gX2FzeW5jVG9HZW5lcmF0b3IoLyojX19QVVJFX18qL19yZWdlbmVyYXRvclsiZGVmYXVsdCJdLm1hcmsoZnVuY3Rpb24gX2NhbGxlZShzdHJlYW1JZCkgewogICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yWyJkZWZhdWx0Il0ud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGxTZXR0bGVkKFt0aGlzLnN0cmVhbUNvbnRyb2xsZXJzW3N0cmVhbUlkXS5zdGFydENhbGwsIHRoaXMuc3RyZWFtQ29udHJvbGxlcnNbc3RyZWFtSWRdLnB1bGxDYWxsLCB0aGlzLnN0cmVhbUNvbnRyb2xsZXJzW3N0cmVhbUlkXS5jYW5jZWxDYWxsXS5tYXAoZnVuY3Rpb24gKGNhcGFiaWxpdHkpIHsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjYXBhYmlsaXR5ICYmIGNhcGFiaWxpdHkucHJvbWlzZTsKICAgICAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuc3RyZWFtQ29udHJvbGxlcnNbc3RyZWFtSWRdOwoKICAgICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBfY2FsbGVlLCB0aGlzKTsKICAgICAgICAgIH0pKTsKCiAgICAgICAgICBmdW5jdGlvbiBfZGVsZXRlU3RyZWFtQ29udHJvbGxlcihfeCkgewogICAgICAgICAgICByZXR1cm4gX2RlbGV0ZVN0cmVhbUNvbnRyb2xsZXIyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIF9kZWxldGVTdHJlYW1Db250cm9sbGVyOwogICAgICAgIH0oKQogICAgICB9LCB7CiAgICAgICAga2V5OiAiX3Bvc3RNZXNzYWdlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX3Bvc3RNZXNzYWdlKG1lc3NhZ2UsIHRyYW5zZmVycykgewogICAgICAgICAgaWYgKHRyYW5zZmVycyAmJiB0aGlzLnBvc3RNZXNzYWdlVHJhbnNmZXJzKSB7CiAgICAgICAgICAgIHRoaXMuY29tT2JqLnBvc3RNZXNzYWdlKG1lc3NhZ2UsIHRyYW5zZmVycyk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmNvbU9iai5wb3N0TWVzc2FnZShtZXNzYWdlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJkZXN0cm95IiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgICAgIHRoaXMuY29tT2JqLnJlbW92ZUV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCB0aGlzLl9vbkNvbU9iak9uTWVzc2FnZSk7CiAgICAgICAgfQogICAgICB9XSk7CgogICAgICByZXR1cm4gTWVzc2FnZUhhbmRsZXI7CiAgICB9KCk7CgogICAgZXhwb3J0cy5NZXNzYWdlSGFuZGxlciA9IE1lc3NhZ2VIYW5kbGVyOwoKICAgIC8qKiovfSksICgKICAvKiAyMDEgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgoKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgICAgdmFsdWU6IHRydWUKICAgIH0pOwogICAgZXhwb3J0cy5NZXRhZGF0YSA9IHZvaWQgMDsKCiAgICB2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEpOwoKICAgIHZhciBfeG1sX3BhcnNlciA9IF9fd19wZGZqc19yZXF1aXJlX18oMjAyKTsKCiAgICBmdW5jdGlvbiBfc2xpY2VkVG9BcnJheShhcnIsIGkpIHtyZXR1cm4gX2FycmF5V2l0aEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgfHwgX25vbkl0ZXJhYmxlUmVzdCgpO30KCiAgICBmdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0KCkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UiKTt9CgogICAgZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkge2lmICghKFN5bWJvbC5pdGVyYXRvciBpbiBPYmplY3QoYXJyKSB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYXJyKSA9PT0gIltvYmplY3QgQXJndW1lbnRzXSIpKSB7cmV0dXJuO312YXIgX2FyciA9IFtdO3ZhciBfbiA9IHRydWU7dmFyIF9kID0gZmFsc2U7dmFyIF9lID0gdW5kZWZpbmVkO3RyeSB7Zm9yICh2YXIgX2kgPSBhcnJbU3ltYm9sLml0ZXJhdG9yXSgpLCBfczsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkge19hcnIucHVzaChfcy52YWx1ZSk7aWYgKGkgJiYgX2Fyci5sZW5ndGggPT09IGkpIGJyZWFrO319IGNhdGNoIChlcnIpIHtfZCA9IHRydWU7X2UgPSBlcnI7fSBmaW5hbGx5IHt0cnkge2lmICghX24gJiYgX2lbInJldHVybiJdICE9IG51bGwpIF9pWyJyZXR1cm4iXSgpO30gZmluYWxseSB7aWYgKF9kKSB0aHJvdyBfZTt9fXJldHVybiBfYXJyO30KCiAgICBmdW5jdGlvbiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB7aWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjt9CgogICAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3Rvcikge2lmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7fX0KCiAgICBmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7Zm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykge3ZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07ZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlO2Rlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTtpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTtPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7fX0KCiAgICBmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7aWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7aWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpO3JldHVybiBDb25zdHJ1Y3Rvcjt9CgogICAgdmFyIE1ldGFkYXRhID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gTWV0YWRhdGEoZGF0YSkgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBNZXRhZGF0YSk7CgogICAgICAgICgwLCBfdXRpbC5hc3NlcnQpKHR5cGVvZiBkYXRhID09PSAic3RyaW5nIiwgIk1ldGFkYXRhOiBpbnB1dCBpcyBub3QgYSBzdHJpbmciKTsKICAgICAgICBkYXRhID0gdGhpcy5fcmVwYWlyKGRhdGEpOwogICAgICAgIHZhciBwYXJzZXIgPSBuZXcgX3htbF9wYXJzZXIuU2ltcGxlWE1MUGFyc2VyKCk7CiAgICAgICAgdmFyIHhtbERvY3VtZW50ID0gcGFyc2VyLnBhcnNlRnJvbVN0cmluZyhkYXRhKTsKICAgICAgICB0aGlzLl9tZXRhZGF0YU1hcCA9IG5ldyBNYXAoKTsKCiAgICAgICAgaWYgKHhtbERvY3VtZW50KSB7CiAgICAgICAgICB0aGlzLl9wYXJzZSh4bWxEb2N1bWVudCk7CiAgICAgICAgfQogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoTWV0YWRhdGEsIFt7CiAgICAgICAga2V5OiAiX3JlcGFpciIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9yZXBhaXIoZGF0YSkgewogICAgICAgICAgcmV0dXJuIGRhdGEucmVwbGFjZSgvXltePF0rLywgIiIpLnJlcGxhY2UoLz5cXDM3NlxcMzc3KFtePF0rKS9nLCBmdW5jdGlvbiAoYWxsLCBjb2RlcykgewogICAgICAgICAgICB2YXIgYnl0ZXMgPSBjb2Rlcy5yZXBsYWNlKC9cXChbMC0zXSkoWzAtN10pKFswLTddKS9nLCBmdW5jdGlvbiAoY29kZSwgZDEsIGQyLCBkMykgewogICAgICAgICAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKGQxICogNjQgKyBkMiAqIDggKyBkMyAqIDEpOwogICAgICAgICAgICB9KS5yZXBsYWNlKC8mKGFtcHxhcG9zfGd0fGx0fHF1b3QpOy9nLCBmdW5jdGlvbiAoc3RyLCBuYW1lKSB7CiAgICAgICAgICAgICAgc3dpdGNoIChuYW1lKSB7CiAgICAgICAgICAgICAgICBjYXNlICJhbXAiOgogICAgICAgICAgICAgICAgICByZXR1cm4gIiYiOwoKICAgICAgICAgICAgICAgIGNhc2UgImFwb3MiOgogICAgICAgICAgICAgICAgICByZXR1cm4gIiciOwoKICAgICAgICAgICAgICAgIGNhc2UgImd0IjoKICAgICAgICAgICAgICAgICAgcmV0dXJuICI+IjsKCiAgICAgICAgICAgICAgICBjYXNlICJsdCI6CiAgICAgICAgICAgICAgICAgIHJldHVybiAiPCI7CgogICAgICAgICAgICAgICAgY2FzZSAicXVvdCI6CiAgICAgICAgICAgICAgICAgIHJldHVybiAnIic7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIl9yZXBhaXI6ICIuY29uY2F0KG5hbWUsICIgaXNuJ3QgZGVmaW5lZC4iKSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YXIgY2hhcnMgPSAiIjsKCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGJ5dGVzLmxlbmd0aDsgaSA8IGlpOyBpICs9IDIpIHsKICAgICAgICAgICAgICB2YXIgY29kZSA9IGJ5dGVzLmNoYXJDb2RlQXQoaSkgKiAyNTYgKyBieXRlcy5jaGFyQ29kZUF0KGkgKyAxKTsKCiAgICAgICAgICAgICAgaWYgKGNvZGUgPj0gMzIgJiYgY29kZSA8IDEyNyAmJiBjb2RlICE9PSA2MCAmJiBjb2RlICE9PSA2MiAmJiBjb2RlICE9PSAzOCkgewogICAgICAgICAgICAgICAgY2hhcnMgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShjb2RlKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY2hhcnMgKz0gIiYjeCIgKyAoMHgxMDAwMCArIGNvZGUpLnRvU3RyaW5nKDE2KS5zdWJzdHJpbmcoMSkgKyAiOyI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gIj4iICsgY2hhcnM7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJfcGFyc2UiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfcGFyc2UoeG1sRG9jdW1lbnQpIHsKICAgICAgICAgIHZhciByZGYgPSB4bWxEb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CgogICAgICAgICAgaWYgKHJkZi5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpICE9PSAicmRmOnJkZiIpIHsKICAgICAgICAgICAgcmRmID0gcmRmLmZpcnN0Q2hpbGQ7CgogICAgICAgICAgICB3aGlsZSAocmRmICYmIHJkZi5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpICE9PSAicmRmOnJkZiIpIHsKICAgICAgICAgICAgICByZGYgPSByZGYubmV4dFNpYmxpbmc7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgbm9kZU5hbWUgPSByZGYgPyByZGYubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA6IG51bGw7CgogICAgICAgICAgaWYgKCFyZGYgfHwgbm9kZU5hbWUgIT09ICJyZGY6cmRmIiB8fCAhcmRmLmhhc0NoaWxkTm9kZXMoKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGNoaWxkcmVuID0gcmRmLmNoaWxkTm9kZXM7CgogICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICB2YXIgZGVzYyA9IGNoaWxkcmVuW2ldOwoKICAgICAgICAgICAgaWYgKGRlc2Mubm9kZU5hbWUudG9Mb3dlckNhc2UoKSAhPT0gInJkZjpkZXNjcmlwdGlvbiIpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9yICh2YXIgaiA9IDAsIGpqID0gZGVzYy5jaGlsZE5vZGVzLmxlbmd0aDsgaiA8IGpqOyBqKyspIHsKICAgICAgICAgICAgICBpZiAoZGVzYy5jaGlsZE5vZGVzW2pdLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgIT09ICIjdGV4dCIpIHsKICAgICAgICAgICAgICAgIHZhciBlbnRyeSA9IGRlc2MuY2hpbGROb2Rlc1tqXTsKICAgICAgICAgICAgICAgIHZhciBuYW1lID0gZW50cnkubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKCiAgICAgICAgICAgICAgICB0aGlzLl9tZXRhZGF0YU1hcC5zZXQobmFtZSwgZW50cnkudGV4dENvbnRlbnQudHJpbSgpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJnZXQiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXQobmFtZSkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX21ldGFkYXRhTWFwLmhhcyhuYW1lKSA/IHRoaXMuX21ldGFkYXRhTWFwLmdldChuYW1lKSA6IG51bGw7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0QWxsIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0QWxsKCkgewogICAgICAgICAgdmFyIG9iaiA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgICB2YXIgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IHRydWU7CiAgICAgICAgICB2YXIgX2RpZEl0ZXJhdG9yRXJyb3IgPSBmYWxzZTsKICAgICAgICAgIHZhciBfaXRlcmF0b3JFcnJvciA9IHVuZGVmaW5lZDsKCiAgICAgICAgICB0cnkgewogICAgICAgICAgICBmb3IgKHZhciBfaXRlcmF0b3IgPSB0aGlzLl9tZXRhZGF0YU1hcFtTeW1ib2wuaXRlcmF0b3JdKCksIF9zdGVwOyAhKF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSAoX3N0ZXAgPSBfaXRlcmF0b3IubmV4dCgpKS5kb25lKTsgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IHRydWUpIHsKICAgICAgICAgICAgICB2YXIgX3N0ZXAkdmFsdWUgPSBfc2xpY2VkVG9BcnJheShfc3RlcC52YWx1ZSwgMiksCiAgICAgICAgICAgICAgICBrZXkgPSBfc3RlcCR2YWx1ZVswXSwKICAgICAgICAgICAgICAgIHZhbHVlID0gX3N0ZXAkdmFsdWVbMV07CgogICAgICAgICAgICAgIG9ialtrZXldID0gdmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvciA9IHRydWU7CiAgICAgICAgICAgIF9pdGVyYXRvckVycm9yID0gZXJyOwogICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gJiYgX2l0ZXJhdG9yWyJyZXR1cm4iXSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBfaXRlcmF0b3JbInJldHVybiJdKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgIGlmIChfZGlkSXRlcmF0b3JFcnJvcikgewogICAgICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3I7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIG9iajsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJoYXMiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBoYXMobmFtZSkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX21ldGFkYXRhTWFwLmhhcyhuYW1lKTsKICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBNZXRhZGF0YTsKICAgIH0oKTsKCiAgICBleHBvcnRzLk1ldGFkYXRhID0gTWV0YWRhdGE7CgogICAgLyoqKi99KSwgKAogIC8qIDIwMiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCgogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICB2YWx1ZTogdHJ1ZQogICAgfSk7CiAgICBleHBvcnRzLlNpbXBsZVhNTFBhcnNlciA9IHZvaWQgMDsKCiAgICBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyJAYmFiZWwvaGVscGVycyAtIHR5cGVvZiI7aWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIpIHtfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHtyZXR1cm4gdHlwZW9mIG9iajt9O30gZWxzZSB7X3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7cmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajt9O31yZXR1cm4gX3R5cGVvZihvYmopO30KCiAgICBmdW5jdGlvbiBfc2xpY2VkVG9BcnJheShhcnIsIGkpIHtyZXR1cm4gX2FycmF5V2l0aEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgfHwgX25vbkl0ZXJhYmxlUmVzdCgpO30KCiAgICBmdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0KCkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UiKTt9CgogICAgZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkge2lmICghKFN5bWJvbC5pdGVyYXRvciBpbiBPYmplY3QoYXJyKSB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYXJyKSA9PT0gIltvYmplY3QgQXJndW1lbnRzXSIpKSB7cmV0dXJuO312YXIgX2FyciA9IFtdO3ZhciBfbiA9IHRydWU7dmFyIF9kID0gZmFsc2U7dmFyIF9lID0gdW5kZWZpbmVkO3RyeSB7Zm9yICh2YXIgX2kgPSBhcnJbU3ltYm9sLml0ZXJhdG9yXSgpLCBfczsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkge19hcnIucHVzaChfcy52YWx1ZSk7aWYgKGkgJiYgX2Fyci5sZW5ndGggPT09IGkpIGJyZWFrO319IGNhdGNoIChlcnIpIHtfZCA9IHRydWU7X2UgPSBlcnI7fSBmaW5hbGx5IHt0cnkge2lmICghX24gJiYgX2lbInJldHVybiJdICE9IG51bGwpIF9pWyJyZXR1cm4iXSgpO30gZmluYWxseSB7aWYgKF9kKSB0aHJvdyBfZTt9fXJldHVybiBfYXJyO30KCiAgICBmdW5jdGlvbiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB7aWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjt9CgogICAgZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkge2lmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHtyZXR1cm4gY2FsbDt9cmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7fQoKICAgIGZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikge2lmIChzZWxmID09PSB2b2lkIDApIHt0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpO31yZXR1cm4gc2VsZjt9CgogICAgZnVuY3Rpb24gX2dldCh0YXJnZXQsIHByb3BlcnR5LCByZWNlaXZlcikge2lmICh0eXBlb2YgUmVmbGVjdCAhPT0gInVuZGVmaW5lZCIgJiYgUmVmbGVjdC5nZXQpIHtfZ2V0ID0gUmVmbGVjdC5nZXQ7fSBlbHNlIHtfZ2V0ID0gZnVuY3Rpb24gX2dldCh0YXJnZXQsIHByb3BlcnR5LCByZWNlaXZlcikge3ZhciBiYXNlID0gX3N1cGVyUHJvcEJhc2UodGFyZ2V0LCBwcm9wZXJ0eSk7aWYgKCFiYXNlKSByZXR1cm47dmFyIGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGJhc2UsIHByb3BlcnR5KTtpZiAoZGVzYy5nZXQpIHtyZXR1cm4gZGVzYy5nZXQuY2FsbChyZWNlaXZlcik7fXJldHVybiBkZXNjLnZhbHVlO307fXJldHVybiBfZ2V0KHRhcmdldCwgcHJvcGVydHksIHJlY2VpdmVyIHx8IHRhcmdldCk7fQoKICAgIGZ1bmN0aW9uIF9zdXBlclByb3BCYXNlKG9iamVjdCwgcHJvcGVydHkpIHt3aGlsZSAoIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KSkge29iamVjdCA9IF9nZXRQcm90b3R5cGVPZihvYmplY3QpO2lmIChvYmplY3QgPT09IG51bGwpIGJyZWFrO31yZXR1cm4gb2JqZWN0O30KCiAgICBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2Yobykge19nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZiA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7cmV0dXJuIG8uX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihvKTt9O3JldHVybiBfZ2V0UHJvdG90eXBlT2Yobyk7fQoKICAgIGZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykge2lmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTt9c3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pO2lmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpO30KCiAgICBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkge19zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkge28uX19wcm90b19fID0gcDtyZXR1cm4gbzt9O3JldHVybiBfc2V0UHJvdG90eXBlT2YobywgcCk7fQoKICAgIGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHtpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpO319CgogICAgZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykge2ZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHt2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldO2Rlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTtkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7aWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7T2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpO319CgogICAgZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykge2lmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpO2lmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTtyZXR1cm4gQ29uc3RydWN0b3I7fQoKICAgIHZhciBYTUxQYXJzZXJFcnJvckNvZGUgPSB7CiAgICAgIE5vRXJyb3I6IDAsCiAgICAgIEVuZE9mRG9jdW1lbnQ6IC0xLAogICAgICBVbnRlcm1pbmF0ZWRDZGF0OiAtMiwKICAgICAgVW50ZXJtaW5hdGVkWG1sRGVjbGFyYXRpb246IC0zLAogICAgICBVbnRlcm1pbmF0ZWREb2N0eXBlRGVjbGFyYXRpb246IC00LAogICAgICBVbnRlcm1pbmF0ZWRDb21tZW50OiAtNSwKICAgICAgTWFsZm9ybWVkRWxlbWVudDogLTYsCiAgICAgIE91dE9mTWVtb3J5OiAtNywKICAgICAgVW50ZXJtaW5hdGVkQXR0cmlidXRlVmFsdWU6IC04LAogICAgICBVbnRlcm1pbmF0ZWRFbGVtZW50OiAtOSwKICAgICAgRWxlbWVudE5ldmVyQmVndW46IC0xMAogICAgfTsKCiAgICBmdW5jdGlvbiBpc1doaXRlc3BhY2UocywgaW5kZXgpIHsKICAgICAgdmFyIGNoID0gc1tpbmRleF07CiAgICAgIHJldHVybiBjaCA9PT0gIiAiIHx8IGNoID09PSAiXG4iIHx8IGNoID09PSAiXHIiIHx8IGNoID09PSAiXHQiOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzV2hpdGVzcGFjZVN0cmluZyhzKSB7CiAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgIGlmICghaXNXaGl0ZXNwYWNlKHMsIGkpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICB2YXIgWE1MUGFyc2VyQmFzZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgIGZ1bmN0aW9uIFhNTFBhcnNlckJhc2UoKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFhNTFBhcnNlckJhc2UpOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoWE1MUGFyc2VyQmFzZSwgW3sKICAgICAgICBrZXk6ICJfcmVzb2x2ZUVudGl0aWVzIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX3Jlc29sdmVFbnRpdGllcyhzKSB7CiAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgICAgIHJldHVybiBzLnJlcGxhY2UoLyYoW147XSspOy9nLCBmdW5jdGlvbiAoYWxsLCBlbnRpdHkpIHsKICAgICAgICAgICAgaWYgKGVudGl0eS5zdWJzdHJpbmcoMCwgMikgPT09ICIjeCIpIHsKICAgICAgICAgICAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShwYXJzZUludChlbnRpdHkuc3Vic3RyaW5nKDIpLCAxNikpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGVudGl0eS5zdWJzdHJpbmcoMCwgMSkgPT09ICIjIikgewogICAgICAgICAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKHBhcnNlSW50KGVudGl0eS5zdWJzdHJpbmcoMSksIDEwKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHN3aXRjaCAoZW50aXR5KSB7CiAgICAgICAgICAgICAgY2FzZSAibHQiOgogICAgICAgICAgICAgICAgcmV0dXJuICI8IjsKCiAgICAgICAgICAgICAgY2FzZSAiZ3QiOgogICAgICAgICAgICAgICAgcmV0dXJuICI+IjsKCiAgICAgICAgICAgICAgY2FzZSAiYW1wIjoKICAgICAgICAgICAgICAgIHJldHVybiAiJiI7CgogICAgICAgICAgICAgIGNhc2UgInF1b3QiOgogICAgICAgICAgICAgICAgcmV0dXJuICciJzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIF90aGlzLm9uUmVzb2x2ZUVudGl0eShlbnRpdHkpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiX3BhcnNlQ29udGVudCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9wYXJzZUNvbnRlbnQocywgc3RhcnQpIHsKICAgICAgICAgIHZhciBhdHRyaWJ1dGVzID0gW107CiAgICAgICAgICB2YXIgcG9zID0gc3RhcnQ7CgogICAgICAgICAgZnVuY3Rpb24gc2tpcFdzKCkgewogICAgICAgICAgICB3aGlsZSAocG9zIDwgcy5sZW5ndGggJiYgaXNXaGl0ZXNwYWNlKHMsIHBvcykpIHsKICAgICAgICAgICAgICArK3BvczsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHdoaWxlIChwb3MgPCBzLmxlbmd0aCAmJiAhaXNXaGl0ZXNwYWNlKHMsIHBvcykgJiYgc1twb3NdICE9PSAiPiIgJiYgc1twb3NdICE9PSAiLyIpIHsKICAgICAgICAgICAgKytwb3M7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIG5hbWUgPSBzLnN1YnN0cmluZyhzdGFydCwgcG9zKTsKICAgICAgICAgIHNraXBXcygpOwoKICAgICAgICAgIHdoaWxlIChwb3MgPCBzLmxlbmd0aCAmJiBzW3Bvc10gIT09ICI+IiAmJiBzW3Bvc10gIT09ICIvIiAmJiBzW3Bvc10gIT09ICI/IikgewogICAgICAgICAgICBza2lwV3MoKTsKICAgICAgICAgICAgdmFyIGF0dHJOYW1lID0gIiIsCiAgICAgICAgICAgICAgYXR0clZhbHVlID0gIiI7CgogICAgICAgICAgICB3aGlsZSAocG9zIDwgcy5sZW5ndGggJiYgIWlzV2hpdGVzcGFjZShzLCBwb3MpICYmIHNbcG9zXSAhPT0gIj0iKSB7CiAgICAgICAgICAgICAgYXR0ck5hbWUgKz0gc1twb3NdOwogICAgICAgICAgICAgICsrcG9zOwogICAgICAgICAgICB9CgogICAgICAgICAgICBza2lwV3MoKTsKCiAgICAgICAgICAgIGlmIChzW3Bvc10gIT09ICI9IikgewogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICArK3BvczsKICAgICAgICAgICAgc2tpcFdzKCk7CiAgICAgICAgICAgIHZhciBhdHRyRW5kQ2hhciA9IHNbcG9zXTsKCiAgICAgICAgICAgIGlmIChhdHRyRW5kQ2hhciAhPT0gJyInICYmIGF0dHJFbmRDaGFyICE9PSAiJyIpIHsKICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGF0dHJFbmRJbmRleCA9IHMuaW5kZXhPZihhdHRyRW5kQ2hhciwgKytwb3MpOwoKICAgICAgICAgICAgaWYgKGF0dHJFbmRJbmRleCA8IDApIHsKICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYXR0clZhbHVlID0gcy5zdWJzdHJpbmcocG9zLCBhdHRyRW5kSW5kZXgpOwogICAgICAgICAgICBhdHRyaWJ1dGVzLnB1c2goewogICAgICAgICAgICAgIG5hbWU6IGF0dHJOYW1lLAogICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9yZXNvbHZlRW50aXRpZXMoYXR0clZhbHVlKQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcG9zID0gYXR0ckVuZEluZGV4ICsgMTsKICAgICAgICAgICAgc2tpcFdzKCk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgbmFtZTogbmFtZSwKICAgICAgICAgICAgYXR0cmlidXRlczogYXR0cmlidXRlcywKICAgICAgICAgICAgcGFyc2VkOiBwb3MgLSBzdGFydAogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJfcGFyc2VQcm9jZXNzaW5nSW5zdHJ1Y3Rpb24iLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfcGFyc2VQcm9jZXNzaW5nSW5zdHJ1Y3Rpb24ocywgc3RhcnQpIHsKICAgICAgICAgIHZhciBwb3MgPSBzdGFydDsKCiAgICAgICAgICBmdW5jdGlvbiBza2lwV3MoKSB7CiAgICAgICAgICAgIHdoaWxlIChwb3MgPCBzLmxlbmd0aCAmJiBpc1doaXRlc3BhY2UocywgcG9zKSkgewogICAgICAgICAgICAgICsrcG9zOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgd2hpbGUgKHBvcyA8IHMubGVuZ3RoICYmICFpc1doaXRlc3BhY2UocywgcG9zKSAmJiBzW3Bvc10gIT09ICI+IiAmJiBzW3Bvc10gIT09ICIvIikgewogICAgICAgICAgICArK3BvczsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgbmFtZSA9IHMuc3Vic3RyaW5nKHN0YXJ0LCBwb3MpOwogICAgICAgICAgc2tpcFdzKCk7CiAgICAgICAgICB2YXIgYXR0clN0YXJ0ID0gcG9zOwoKICAgICAgICAgIHdoaWxlIChwb3MgPCBzLmxlbmd0aCAmJiAoc1twb3NdICE9PSAiPyIgfHwgc1twb3MgKyAxXSAhPT0gIj4iKSkgewogICAgICAgICAgICArK3BvczsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgdmFsdWUgPSBzLnN1YnN0cmluZyhhdHRyU3RhcnQsIHBvcyk7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBuYW1lOiBuYW1lLAogICAgICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgICAgIHBhcnNlZDogcG9zIC0gc3RhcnQKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAicGFyc2VYbWwiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBwYXJzZVhtbChzKSB7CiAgICAgICAgICB2YXIgaSA9IDA7CgogICAgICAgICAgd2hpbGUgKGkgPCBzLmxlbmd0aCkgewogICAgICAgICAgICB2YXIgY2ggPSBzW2ldOwogICAgICAgICAgICB2YXIgaiA9IGk7CgogICAgICAgICAgICBpZiAoY2ggPT09ICI8IikgewogICAgICAgICAgICAgICsrajsKICAgICAgICAgICAgICB2YXIgY2gyID0gc1tqXTsKICAgICAgICAgICAgICB2YXIgcSA9IHZvaWQgMDsKCiAgICAgICAgICAgICAgc3dpdGNoIChjaDIpIHsKICAgICAgICAgICAgICAgIGNhc2UgIi8iOgogICAgICAgICAgICAgICAgICArK2o7CiAgICAgICAgICAgICAgICAgIHEgPSBzLmluZGV4T2YoIj4iLCBqKTsKCiAgICAgICAgICAgICAgICAgIGlmIChxIDwgMCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMub25FcnJvcihYTUxQYXJzZXJFcnJvckNvZGUuVW50ZXJtaW5hdGVkRWxlbWVudCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB0aGlzLm9uRW5kRWxlbWVudChzLnN1YnN0cmluZyhqLCBxKSk7CiAgICAgICAgICAgICAgICAgIGogPSBxICsgMTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSAiPyI6CiAgICAgICAgICAgICAgICAgICsrajsKCiAgICAgICAgICAgICAgICAgIHZhciBwaSA9IHRoaXMuX3BhcnNlUHJvY2Vzc2luZ0luc3RydWN0aW9uKHMsIGopOwoKICAgICAgICAgICAgICAgICAgaWYgKHMuc3Vic3RyaW5nKGogKyBwaS5wYXJzZWQsIGogKyBwaS5wYXJzZWQgKyAyKSAhPT0gIj8+IikgewogICAgICAgICAgICAgICAgICAgIHRoaXMub25FcnJvcihYTUxQYXJzZXJFcnJvckNvZGUuVW50ZXJtaW5hdGVkWG1sRGVjbGFyYXRpb24pOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgdGhpcy5vblBpKHBpLm5hbWUsIHBpLnZhbHVlKTsKICAgICAgICAgICAgICAgICAgaiArPSBwaS5wYXJzZWQgKyAyOwogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlICIhIjoKICAgICAgICAgICAgICAgICAgaWYgKHMuc3Vic3RyaW5nKGogKyAxLCBqICsgMykgPT09ICItLSIpIHsKICAgICAgICAgICAgICAgICAgICBxID0gcy5pbmRleE9mKCItLT4iLCBqICsgMyk7CgogICAgICAgICAgICAgICAgICAgIGlmIChxIDwgMCkgewogICAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkVycm9yKFhNTFBhcnNlckVycm9yQ29kZS5VbnRlcm1pbmF0ZWRDb21tZW50KTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHRoaXMub25Db21tZW50KHMuc3Vic3RyaW5nKGogKyAzLCBxKSk7CiAgICAgICAgICAgICAgICAgICAgaiA9IHEgKyAzOwogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHMuc3Vic3RyaW5nKGogKyAxLCBqICsgOCkgPT09ICJbQ0RBVEFbIikgewogICAgICAgICAgICAgICAgICAgIHEgPSBzLmluZGV4T2YoIl1dPiIsIGogKyA4KTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHEgPCAwKSB7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9uRXJyb3IoWE1MUGFyc2VyRXJyb3JDb2RlLlVudGVybWluYXRlZENkYXQpOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkNkYXRhKHMuc3Vic3RyaW5nKGogKyA4LCBxKSk7CiAgICAgICAgICAgICAgICAgICAgaiA9IHEgKyAzOwogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHMuc3Vic3RyaW5nKGogKyAxLCBqICsgOCkgPT09ICJET0NUWVBFIikgewogICAgICAgICAgICAgICAgICAgIHZhciBxMiA9IHMuaW5kZXhPZigiWyIsIGogKyA4KTsKICAgICAgICAgICAgICAgICAgICB2YXIgY29tcGxleERvY3R5cGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBxID0gcy5pbmRleE9mKCI+IiwgaiArIDgpOwoKICAgICAgICAgICAgICAgICAgICBpZiAocSA8IDApIHsKICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25FcnJvcihYTUxQYXJzZXJFcnJvckNvZGUuVW50ZXJtaW5hdGVkRG9jdHlwZURlY2xhcmF0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmIChxMiA+IDAgJiYgcSA+IHEyKSB7CiAgICAgICAgICAgICAgICAgICAgICBxID0gcy5pbmRleE9mKCJdPiIsIGogKyA4KTsKCiAgICAgICAgICAgICAgICAgICAgICBpZiAocSA8IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkVycm9yKFhNTFBhcnNlckVycm9yQ29kZS5VbnRlcm1pbmF0ZWREb2N0eXBlRGVjbGFyYXRpb24pOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgY29tcGxleERvY3R5cGUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgdmFyIGRvY3R5cGVDb250ZW50ID0gcy5zdWJzdHJpbmcoaiArIDgsIHEgKyAoY29tcGxleERvY3R5cGUgPyAxIDogMCkpOwogICAgICAgICAgICAgICAgICAgIHRoaXMub25Eb2N0eXBlKGRvY3R5cGVDb250ZW50KTsKICAgICAgICAgICAgICAgICAgICBqID0gcSArIChjb21wbGV4RG9jdHlwZSA/IDIgOiAxKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9uRXJyb3IoWE1MUGFyc2VyRXJyb3JDb2RlLk1hbGZvcm1lZEVsZW1lbnQpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSB0aGlzLl9wYXJzZUNvbnRlbnQocywgaik7CgogICAgICAgICAgICAgICAgICBpZiAoY29udGVudCA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMub25FcnJvcihYTUxQYXJzZXJFcnJvckNvZGUuTWFsZm9ybWVkRWxlbWVudCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB2YXIgaXNDbG9zZWQgPSBmYWxzZTsKCiAgICAgICAgICAgICAgICAgIGlmIChzLnN1YnN0cmluZyhqICsgY29udGVudC5wYXJzZWQsIGogKyBjb250ZW50LnBhcnNlZCArIDIpID09PSAiLz4iKSB7CiAgICAgICAgICAgICAgICAgICAgaXNDbG9zZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHMuc3Vic3RyaW5nKGogKyBjb250ZW50LnBhcnNlZCwgaiArIGNvbnRlbnQucGFyc2VkICsgMSkgIT09ICI+IikgewogICAgICAgICAgICAgICAgICAgIHRoaXMub25FcnJvcihYTUxQYXJzZXJFcnJvckNvZGUuVW50ZXJtaW5hdGVkRWxlbWVudCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB0aGlzLm9uQmVnaW5FbGVtZW50KGNvbnRlbnQubmFtZSwgY29udGVudC5hdHRyaWJ1dGVzLCBpc0Nsb3NlZCk7CiAgICAgICAgICAgICAgICAgIGogKz0gY29udGVudC5wYXJzZWQgKyAoaXNDbG9zZWQgPyAyIDogMSk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB3aGlsZSAoaiA8IHMubGVuZ3RoICYmIHNbal0gIT09ICI8IikgewogICAgICAgICAgICAgICAgaisrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIHRleHQgPSBzLnN1YnN0cmluZyhpLCBqKTsKICAgICAgICAgICAgICB0aGlzLm9uVGV4dCh0aGlzLl9yZXNvbHZlRW50aXRpZXModGV4dCkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpID0gajsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJvblJlc29sdmVFbnRpdHkiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBvblJlc29sdmVFbnRpdHkobmFtZSkgewogICAgICAgICAgcmV0dXJuICImIi5jb25jYXQobmFtZSwgIjsiKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJvblBpIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gb25QaShuYW1lLCB2YWx1ZSkge30KICAgICAgfSwgewogICAgICAgIGtleTogIm9uQ29tbWVudCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIG9uQ29tbWVudCh0ZXh0KSB7fQogICAgICB9LCB7CiAgICAgICAga2V5OiAib25DZGF0YSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIG9uQ2RhdGEodGV4dCkge30KICAgICAgfSwgewogICAgICAgIGtleTogIm9uRG9jdHlwZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIG9uRG9jdHlwZShkb2N0eXBlQ29udGVudCkge30KICAgICAgfSwgewogICAgICAgIGtleTogIm9uVGV4dCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIG9uVGV4dCh0ZXh0KSB7fQogICAgICB9LCB7CiAgICAgICAga2V5OiAib25CZWdpbkVsZW1lbnQiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBvbkJlZ2luRWxlbWVudChuYW1lLCBhdHRyaWJ1dGVzLCBpc0VtcHR5KSB7fQogICAgICB9LCB7CiAgICAgICAga2V5OiAib25FbmRFbGVtZW50IiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gb25FbmRFbGVtZW50KG5hbWUpIHt9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJvbkVycm9yIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gb25FcnJvcihjb2RlKSB7fQogICAgICB9XSk7CgogICAgICByZXR1cm4gWE1MUGFyc2VyQmFzZTsKICAgIH0oKTsKCiAgICB2YXIgU2ltcGxlRE9NTm9kZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgIGZ1bmN0aW9uIFNpbXBsZURPTU5vZGUobm9kZU5hbWUsIG5vZGVWYWx1ZSkgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBTaW1wbGVET01Ob2RlKTsKCiAgICAgICAgdGhpcy5ub2RlTmFtZSA9IG5vZGVOYW1lOwogICAgICAgIHRoaXMubm9kZVZhbHVlID0gbm9kZVZhbHVlOwogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAicGFyZW50Tm9kZSIsIHsKICAgICAgICAgIHZhbHVlOiBudWxsLAogICAgICAgICAgd3JpdGFibGU6IHRydWUKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgX2NyZWF0ZUNsYXNzKFNpbXBsZURPTU5vZGUsIFt7CiAgICAgICAga2V5OiAiaGFzQ2hpbGROb2RlcyIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGhhc0NoaWxkTm9kZXMoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5jaGlsZE5vZGVzICYmIHRoaXMuY2hpbGROb2Rlcy5sZW5ndGggPiAwOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImZpcnN0Q2hpbGQiLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuY2hpbGROb2RlcyAmJiB0aGlzLmNoaWxkTm9kZXNbMF07CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAibmV4dFNpYmxpbmciLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgdmFyIGNoaWxkTm9kZXMgPSB0aGlzLnBhcmVudE5vZGUuY2hpbGROb2RlczsKCiAgICAgICAgICBpZiAoIWNoaWxkTm9kZXMpIHsKICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgaW5kZXggPSBjaGlsZE5vZGVzLmluZGV4T2YodGhpcyk7CgogICAgICAgICAgaWYgKGluZGV4ID09PSAtMSkgewogICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBjaGlsZE5vZGVzW2luZGV4ICsgMV07CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAidGV4dENvbnRlbnQiLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgaWYgKCF0aGlzLmNoaWxkTm9kZXMpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubm9kZVZhbHVlIHx8ICIiOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB0aGlzLmNoaWxkTm9kZXMubWFwKGZ1bmN0aW9uIChjaGlsZCkgewogICAgICAgICAgICByZXR1cm4gY2hpbGQudGV4dENvbnRlbnQ7CiAgICAgICAgICB9KS5qb2luKCIiKTsKICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBTaW1wbGVET01Ob2RlOwogICAgfSgpOwoKICAgIHZhciBTaW1wbGVYTUxQYXJzZXIgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9YTUxQYXJzZXJCYXNlKSB7CiAgICAgIF9pbmhlcml0cyhTaW1wbGVYTUxQYXJzZXIsIF9YTUxQYXJzZXJCYXNlKTsKCiAgICAgIGZ1bmN0aW9uIFNpbXBsZVhNTFBhcnNlcigpIHsKICAgICAgICB2YXIgX3RoaXMyOwoKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgU2ltcGxlWE1MUGFyc2VyKTsKCiAgICAgICAgX3RoaXMyID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKFNpbXBsZVhNTFBhcnNlcikuY2FsbCh0aGlzKSk7CiAgICAgICAgX3RoaXMyLl9jdXJyZW50RnJhZ21lbnQgPSBudWxsOwogICAgICAgIF90aGlzMi5fc3RhY2sgPSBudWxsOwogICAgICAgIF90aGlzMi5fZXJyb3JDb2RlID0gWE1MUGFyc2VyRXJyb3JDb2RlLk5vRXJyb3I7CiAgICAgICAgcmV0dXJuIF90aGlzMjsKICAgICAgfQoKICAgICAgX2NyZWF0ZUNsYXNzKFNpbXBsZVhNTFBhcnNlciwgW3sKICAgICAgICBrZXk6ICJwYXJzZUZyb21TdHJpbmciLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBwYXJzZUZyb21TdHJpbmcoZGF0YSkgewogICAgICAgICAgdGhpcy5fY3VycmVudEZyYWdtZW50ID0gW107CiAgICAgICAgICB0aGlzLl9zdGFjayA9IFtdOwogICAgICAgICAgdGhpcy5fZXJyb3JDb2RlID0gWE1MUGFyc2VyRXJyb3JDb2RlLk5vRXJyb3I7CiAgICAgICAgICB0aGlzLnBhcnNlWG1sKGRhdGEpOwoKICAgICAgICAgIGlmICh0aGlzLl9lcnJvckNvZGUgIT09IFhNTFBhcnNlckVycm9yQ29kZS5Ob0Vycm9yKSB7CiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIF90aGlzJF9jdXJyZW50RnJhZ21lbiA9IF9zbGljZWRUb0FycmF5KHRoaXMuX2N1cnJlbnRGcmFnbWVudCwgMSksCiAgICAgICAgICAgIGRvY3VtZW50RWxlbWVudCA9IF90aGlzJF9jdXJyZW50RnJhZ21lblswXTsKCiAgICAgICAgICBpZiAoIWRvY3VtZW50RWxlbWVudCkgewogICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGRvY3VtZW50RWxlbWVudDogZG9jdW1lbnRFbGVtZW50CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIm9uUmVzb2x2ZUVudGl0eSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIG9uUmVzb2x2ZUVudGl0eShuYW1lKSB7CiAgICAgICAgICBzd2l0Y2ggKG5hbWUpIHsKICAgICAgICAgICAgY2FzZSAiYXBvcyI6CiAgICAgICAgICAgICAgcmV0dXJuICInIjsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gX2dldChfZ2V0UHJvdG90eXBlT2YoU2ltcGxlWE1MUGFyc2VyLnByb3RvdHlwZSksICJvblJlc29sdmVFbnRpdHkiLCB0aGlzKS5jYWxsKHRoaXMsIG5hbWUpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIm9uVGV4dCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIG9uVGV4dCh0ZXh0KSB7CiAgICAgICAgICBpZiAoaXNXaGl0ZXNwYWNlU3RyaW5nKHRleHQpKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgbm9kZSA9IG5ldyBTaW1wbGVET01Ob2RlKCIjdGV4dCIsIHRleHQpOwoKICAgICAgICAgIHRoaXMuX2N1cnJlbnRGcmFnbWVudC5wdXNoKG5vZGUpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIm9uQ2RhdGEiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBvbkNkYXRhKHRleHQpIHsKICAgICAgICAgIHZhciBub2RlID0gbmV3IFNpbXBsZURPTU5vZGUoIiN0ZXh0IiwgdGV4dCk7CgogICAgICAgICAgdGhpcy5fY3VycmVudEZyYWdtZW50LnB1c2gobm9kZSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAib25CZWdpbkVsZW1lbnQiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBvbkJlZ2luRWxlbWVudChuYW1lLCBhdHRyaWJ1dGVzLCBpc0VtcHR5KSB7CiAgICAgICAgICB2YXIgbm9kZSA9IG5ldyBTaW1wbGVET01Ob2RlKG5hbWUpOwogICAgICAgICAgbm9kZS5jaGlsZE5vZGVzID0gW107CgogICAgICAgICAgdGhpcy5fY3VycmVudEZyYWdtZW50LnB1c2gobm9kZSk7CgogICAgICAgICAgaWYgKGlzRW1wdHkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuX3N0YWNrLnB1c2godGhpcy5fY3VycmVudEZyYWdtZW50KTsKCiAgICAgICAgICB0aGlzLl9jdXJyZW50RnJhZ21lbnQgPSBub2RlLmNoaWxkTm9kZXM7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAib25FbmRFbGVtZW50IiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gb25FbmRFbGVtZW50KG5hbWUpIHsKICAgICAgICAgIHRoaXMuX2N1cnJlbnRGcmFnbWVudCA9IHRoaXMuX3N0YWNrLnBvcCgpIHx8IFtdOwogICAgICAgICAgdmFyIGxhc3RFbGVtZW50ID0gdGhpcy5fY3VycmVudEZyYWdtZW50W3RoaXMuX2N1cnJlbnRGcmFnbWVudC5sZW5ndGggLSAxXTsKCiAgICAgICAgICBpZiAoIWxhc3RFbGVtZW50KSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBsYXN0RWxlbWVudC5jaGlsZE5vZGVzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgbGFzdEVsZW1lbnQuY2hpbGROb2Rlc1tpXS5wYXJlbnROb2RlID0gbGFzdEVsZW1lbnQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAib25FcnJvciIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIG9uRXJyb3IoY29kZSkgewogICAgICAgICAgdGhpcy5fZXJyb3JDb2RlID0gY29kZTsKICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBTaW1wbGVYTUxQYXJzZXI7CiAgICB9KFhNTFBhcnNlckJhc2UpOwoKICAgIGV4cG9ydHMuU2ltcGxlWE1MUGFyc2VyID0gU2ltcGxlWE1MUGFyc2VyOwoKICAgIC8qKiovfSksICgKICAvKiAyMDMgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgoKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgICAgdmFsdWU6IHRydWUKICAgIH0pOwogICAgZXhwb3J0cy5QREZEYXRhVHJhbnNwb3J0U3RyZWFtID0gdm9pZCAwOwoKICAgIHZhciBfcmVnZW5lcmF0b3IgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9fd19wZGZqc19yZXF1aXJlX18oMTkxKSk7CgogICAgdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygxKTsKCiAgICBmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikge3JldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9O30KCiAgICBmdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7dHJ5IHt2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7dmFyIHZhbHVlID0gaW5mby52YWx1ZTt9IGNhdGNoIChlcnJvcikge3JlamVjdChlcnJvcik7cmV0dXJuO31pZiAoaW5mby5kb25lKSB7cmVzb2x2ZSh2YWx1ZSk7fSBlbHNlIHtQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oX25leHQsIF90aHJvdyk7fX0KCiAgICBmdW5jdGlvbiBfYXN5bmNUb0dlbmVyYXRvcihmbikge3JldHVybiBmdW5jdGlvbiAoKSB7dmFyIHNlbGYgPSB0aGlzLGFyZ3MgPSBhcmd1bWVudHM7cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHt2YXIgZ2VuID0gZm4uYXBwbHkoc2VsZiwgYXJncyk7ZnVuY3Rpb24gX25leHQodmFsdWUpIHthc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJuZXh0IiwgdmFsdWUpO31mdW5jdGlvbiBfdGhyb3coZXJyKSB7YXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAidGhyb3ciLCBlcnIpO31fbmV4dCh1bmRlZmluZWQpO30pO307fQoKICAgIGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHtpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpO319CgogICAgZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykge2ZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHt2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldO2Rlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTtkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7aWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7T2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpO319CgogICAgZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykge2lmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpO2lmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTtyZXR1cm4gQ29uc3RydWN0b3I7fQoKICAgIHZhciBQREZEYXRhVHJhbnNwb3J0U3RyZWFtID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gUERGRGF0YVRyYW5zcG9ydFN0cmVhbShwYXJhbXMsIHBkZkRhdGFSYW5nZVRyYW5zcG9ydCkgewogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBQREZEYXRhVHJhbnNwb3J0U3RyZWFtKTsKCiAgICAgICAgKDAsIF91dGlsLmFzc2VydCkocGRmRGF0YVJhbmdlVHJhbnNwb3J0KTsKICAgICAgICB0aGlzLl9xdWV1ZWRDaHVua3MgPSBbXTsKICAgICAgICB0aGlzLl9wcm9ncmVzc2l2ZURvbmUgPSBwYXJhbXMucHJvZ3Jlc3NpdmVEb25lIHx8IGZhbHNlOwogICAgICAgIHZhciBpbml0aWFsRGF0YSA9IHBhcmFtcy5pbml0aWFsRGF0YTsKCiAgICAgICAgaWYgKGluaXRpYWxEYXRhICYmIGluaXRpYWxEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgIHZhciBidWZmZXIgPSBuZXcgVWludDhBcnJheShpbml0aWFsRGF0YSkuYnVmZmVyOwoKICAgICAgICAgIHRoaXMuX3F1ZXVlZENodW5rcy5wdXNoKGJ1ZmZlcik7CiAgICAgICAgfQoKICAgICAgICB0aGlzLl9wZGZEYXRhUmFuZ2VUcmFuc3BvcnQgPSBwZGZEYXRhUmFuZ2VUcmFuc3BvcnQ7CiAgICAgICAgdGhpcy5faXNTdHJlYW1pbmdTdXBwb3J0ZWQgPSAhcGFyYW1zLmRpc2FibGVTdHJlYW07CiAgICAgICAgdGhpcy5faXNSYW5nZVN1cHBvcnRlZCA9ICFwYXJhbXMuZGlzYWJsZVJhbmdlOwogICAgICAgIHRoaXMuX2NvbnRlbnRMZW5ndGggPSBwYXJhbXMubGVuZ3RoOwogICAgICAgIHRoaXMuX2Z1bGxSZXF1ZXN0UmVhZGVyID0gbnVsbDsKICAgICAgICB0aGlzLl9yYW5nZVJlYWRlcnMgPSBbXTsKCiAgICAgICAgdGhpcy5fcGRmRGF0YVJhbmdlVHJhbnNwb3J0LmFkZFJhbmdlTGlzdGVuZXIoZnVuY3Rpb24gKGJlZ2luLCBjaHVuaykgewogICAgICAgICAgX3RoaXMuX29uUmVjZWl2ZURhdGEoewogICAgICAgICAgICBiZWdpbjogYmVnaW4sCiAgICAgICAgICAgIGNodW5rOiBjaHVuawogICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIHRoaXMuX3BkZkRhdGFSYW5nZVRyYW5zcG9ydC5hZGRQcm9ncmVzc0xpc3RlbmVyKGZ1bmN0aW9uIChsb2FkZWQsIHRvdGFsKSB7CiAgICAgICAgICBfdGhpcy5fb25Qcm9ncmVzcyh7CiAgICAgICAgICAgIGxvYWRlZDogbG9hZGVkLAogICAgICAgICAgICB0b3RhbDogdG90YWwKICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICB0aGlzLl9wZGZEYXRhUmFuZ2VUcmFuc3BvcnQuYWRkUHJvZ3Jlc3NpdmVSZWFkTGlzdGVuZXIoZnVuY3Rpb24gKGNodW5rKSB7CiAgICAgICAgICBfdGhpcy5fb25SZWNlaXZlRGF0YSh7CiAgICAgICAgICAgIGNodW5rOiBjaHVuawogICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIHRoaXMuX3BkZkRhdGFSYW5nZVRyYW5zcG9ydC5hZGRQcm9ncmVzc2l2ZURvbmVMaXN0ZW5lcihmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpcy5fb25Qcm9ncmVzc2l2ZURvbmUoKTsKICAgICAgICB9KTsKCiAgICAgICAgdGhpcy5fcGRmRGF0YVJhbmdlVHJhbnNwb3J0LnRyYW5zcG9ydFJlYWR5KCk7CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhQREZEYXRhVHJhbnNwb3J0U3RyZWFtLCBbewogICAgICAgIGtleTogIl9vblJlY2VpdmVEYXRhIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX29uUmVjZWl2ZURhdGEoYXJncykgewogICAgICAgICAgdmFyIGJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KGFyZ3MuY2h1bmspLmJ1ZmZlcjsKCiAgICAgICAgICBpZiAoYXJncy5iZWdpbiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9mdWxsUmVxdWVzdFJlYWRlcikgewogICAgICAgICAgICAgIHRoaXMuX2Z1bGxSZXF1ZXN0UmVhZGVyLl9lbnF1ZXVlKGJ1ZmZlcik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy5fcXVldWVkQ2h1bmtzLnB1c2goYnVmZmVyKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIGZvdW5kID0gdGhpcy5fcmFuZ2VSZWFkZXJzLnNvbWUoZnVuY3Rpb24gKHJhbmdlUmVhZGVyKSB7CiAgICAgICAgICAgICAgaWYgKHJhbmdlUmVhZGVyLl9iZWdpbiAhPT0gYXJncy5iZWdpbikgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmFuZ2VSZWFkZXIuX2VucXVldWUoYnVmZmVyKTsKCiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgKDAsIF91dGlsLmFzc2VydCkoZm91bmQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIl9vblByb2dyZXNzIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX29uUHJvZ3Jlc3MoZXZ0KSB7CiAgICAgICAgICBpZiAoZXZ0LnRvdGFsID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgdmFyIGZpcnN0UmVhZGVyID0gdGhpcy5fcmFuZ2VSZWFkZXJzWzBdOwoKICAgICAgICAgICAgaWYgKGZpcnN0UmVhZGVyICYmIGZpcnN0UmVhZGVyLm9uUHJvZ3Jlc3MpIHsKICAgICAgICAgICAgICBmaXJzdFJlYWRlci5vblByb2dyZXNzKHsKICAgICAgICAgICAgICAgIGxvYWRlZDogZXZ0LmxvYWRlZAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgZnVsbFJlYWRlciA9IHRoaXMuX2Z1bGxSZXF1ZXN0UmVhZGVyOwoKICAgICAgICAgICAgaWYgKGZ1bGxSZWFkZXIgJiYgZnVsbFJlYWRlci5vblByb2dyZXNzKSB7CiAgICAgICAgICAgICAgZnVsbFJlYWRlci5vblByb2dyZXNzKHsKICAgICAgICAgICAgICAgIGxvYWRlZDogZXZ0LmxvYWRlZCwKICAgICAgICAgICAgICAgIHRvdGFsOiBldnQudG90YWwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIl9vblByb2dyZXNzaXZlRG9uZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9vblByb2dyZXNzaXZlRG9uZSgpIHsKICAgICAgICAgIGlmICh0aGlzLl9mdWxsUmVxdWVzdFJlYWRlcikgewogICAgICAgICAgICB0aGlzLl9mdWxsUmVxdWVzdFJlYWRlci5wcm9ncmVzc2l2ZURvbmUoKTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLl9wcm9ncmVzc2l2ZURvbmUgPSB0cnVlOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIl9yZW1vdmVSYW5nZVJlYWRlciIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9yZW1vdmVSYW5nZVJlYWRlcihyZWFkZXIpIHsKICAgICAgICAgIHZhciBpID0gdGhpcy5fcmFuZ2VSZWFkZXJzLmluZGV4T2YocmVhZGVyKTsKCiAgICAgICAgICBpZiAoaSA+PSAwKSB7CiAgICAgICAgICAgIHRoaXMuX3JhbmdlUmVhZGVycy5zcGxpY2UoaSwgMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0RnVsbFJlYWRlciIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldEZ1bGxSZWFkZXIoKSB7CiAgICAgICAgICAoMCwgX3V0aWwuYXNzZXJ0KSghdGhpcy5fZnVsbFJlcXVlc3RSZWFkZXIpOwogICAgICAgICAgdmFyIHF1ZXVlZENodW5rcyA9IHRoaXMuX3F1ZXVlZENodW5rczsKICAgICAgICAgIHRoaXMuX3F1ZXVlZENodW5rcyA9IG51bGw7CiAgICAgICAgICByZXR1cm4gbmV3IFBERkRhdGFUcmFuc3BvcnRTdHJlYW1SZWFkZXIodGhpcywgcXVldWVkQ2h1bmtzLCB0aGlzLl9wcm9ncmVzc2l2ZURvbmUpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImdldFJhbmdlUmVhZGVyIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UmFuZ2VSZWFkZXIoYmVnaW4sIGVuZCkgewogICAgICAgICAgaWYgKGVuZCA8PSB0aGlzLl9wcm9ncmVzc2l2ZURhdGFMZW5ndGgpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHJlYWRlciA9IG5ldyBQREZEYXRhVHJhbnNwb3J0U3RyZWFtUmFuZ2VSZWFkZXIodGhpcywgYmVnaW4sIGVuZCk7CgogICAgICAgICAgdGhpcy5fcGRmRGF0YVJhbmdlVHJhbnNwb3J0LnJlcXVlc3REYXRhUmFuZ2UoYmVnaW4sIGVuZCk7CgogICAgICAgICAgdGhpcy5fcmFuZ2VSZWFkZXJzLnB1c2gocmVhZGVyKTsKCiAgICAgICAgICByZXR1cm4gcmVhZGVyOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImNhbmNlbEFsbFJlcXVlc3RzIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY2FuY2VsQWxsUmVxdWVzdHMocmVhc29uKSB7CiAgICAgICAgICBpZiAodGhpcy5fZnVsbFJlcXVlc3RSZWFkZXIpIHsKICAgICAgICAgICAgdGhpcy5fZnVsbFJlcXVlc3RSZWFkZXIuY2FuY2VsKHJlYXNvbik7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHJlYWRlcnMgPSB0aGlzLl9yYW5nZVJlYWRlcnMuc2xpY2UoMCk7CgogICAgICAgICAgcmVhZGVycy5mb3JFYWNoKGZ1bmN0aW9uIChyYW5nZVJlYWRlcikgewogICAgICAgICAgICByYW5nZVJlYWRlci5jYW5jZWwocmVhc29uKTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIHRoaXMuX3BkZkRhdGFSYW5nZVRyYW5zcG9ydC5hYm9ydCgpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIl9wcm9ncmVzc2l2ZURhdGFMZW5ndGgiLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX2Z1bGxSZXF1ZXN0UmVhZGVyID8gdGhpcy5fZnVsbFJlcXVlc3RSZWFkZXIuX2xvYWRlZCA6IDA7CiAgICAgICAgfQogICAgICB9XSk7CgogICAgICByZXR1cm4gUERGRGF0YVRyYW5zcG9ydFN0cmVhbTsKICAgIH0oKTsKCiAgICBleHBvcnRzLlBERkRhdGFUcmFuc3BvcnRTdHJlYW0gPSBQREZEYXRhVHJhbnNwb3J0U3RyZWFtOwoKICAgIHZhciBQREZEYXRhVHJhbnNwb3J0U3RyZWFtUmVhZGVyID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gUERGRGF0YVRyYW5zcG9ydFN0cmVhbVJlYWRlcihzdHJlYW0sIHF1ZXVlZENodW5rcykgewogICAgICAgIHZhciBwcm9ncmVzc2l2ZURvbmUgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IGZhbHNlOwoKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUERGRGF0YVRyYW5zcG9ydFN0cmVhbVJlYWRlcik7CgogICAgICAgIHRoaXMuX3N0cmVhbSA9IHN0cmVhbTsKICAgICAgICB0aGlzLl9kb25lID0gcHJvZ3Jlc3NpdmVEb25lIHx8IGZhbHNlOwogICAgICAgIHRoaXMuX2ZpbGVuYW1lID0gbnVsbDsKICAgICAgICB0aGlzLl9xdWV1ZWRDaHVua3MgPSBxdWV1ZWRDaHVua3MgfHwgW107CiAgICAgICAgdGhpcy5fbG9hZGVkID0gMDsKICAgICAgICB2YXIgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IHRydWU7CiAgICAgICAgdmFyIF9kaWRJdGVyYXRvckVycm9yID0gZmFsc2U7CiAgICAgICAgdmFyIF9pdGVyYXRvckVycm9yID0gdW5kZWZpbmVkOwoKICAgICAgICB0cnkgewogICAgICAgICAgZm9yICh2YXIgX2l0ZXJhdG9yID0gdGhpcy5fcXVldWVkQ2h1bmtzW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3N0ZXA7ICEoX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IChfc3RlcCA9IF9pdGVyYXRvci5uZXh0KCkpLmRvbmUpOyBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gdHJ1ZSkgewogICAgICAgICAgICB2YXIgY2h1bmsgPSBfc3RlcC52YWx1ZTsKICAgICAgICAgICAgdGhpcy5fbG9hZGVkICs9IGNodW5rLmJ5dGVMZW5ndGg7CiAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvciA9IHRydWU7CiAgICAgICAgICBfaXRlcmF0b3JFcnJvciA9IGVycjsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uICYmIF9pdGVyYXRvclsicmV0dXJuIl0gIT0gbnVsbCkgewogICAgICAgICAgICAgIF9pdGVyYXRvclsicmV0dXJuIl0oKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKF9kaWRJdGVyYXRvckVycm9yKSB7CiAgICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3I7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXMuX3JlcXVlc3RzID0gW107CiAgICAgICAgdGhpcy5faGVhZGVyc1JlYWR5ID0gUHJvbWlzZS5yZXNvbHZlKCk7CiAgICAgICAgc3RyZWFtLl9mdWxsUmVxdWVzdFJlYWRlciA9IHRoaXM7CiAgICAgICAgdGhpcy5vblByb2dyZXNzID0gbnVsbDsKICAgICAgfQoKICAgICAgX2NyZWF0ZUNsYXNzKFBERkRhdGFUcmFuc3BvcnRTdHJlYW1SZWFkZXIsIFt7CiAgICAgICAga2V5OiAiX2VucXVldWUiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZW5xdWV1ZShjaHVuaykgewogICAgICAgICAgaWYgKHRoaXMuX2RvbmUpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0aGlzLl9yZXF1ZXN0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHZhciByZXF1ZXN0Q2FwYWJpbGl0eSA9IHRoaXMuX3JlcXVlc3RzLnNoaWZ0KCk7CgogICAgICAgICAgICByZXF1ZXN0Q2FwYWJpbGl0eS5yZXNvbHZlKHsKICAgICAgICAgICAgICB2YWx1ZTogY2h1bmssCiAgICAgICAgICAgICAgZG9uZTogZmFsc2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLl9xdWV1ZWRDaHVua3MucHVzaChjaHVuayk7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5fbG9hZGVkICs9IGNodW5rLmJ5dGVMZW5ndGg7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAicmVhZCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBfcmVhZCA9IF9hc3luY1RvR2VuZXJhdG9yKC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JbImRlZmF1bHQiXS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgICAgICAgIHZhciBjaHVuaywgcmVxdWVzdENhcGFiaWxpdHk7CiAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JbImRlZmF1bHQiXS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIGlmICghKHRoaXMuX3F1ZXVlZENodW5rcy5sZW5ndGggPiAwKSkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDM7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGNodW5rID0gdGhpcy5fcXVldWVkQ2h1bmtzLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGNodW5rLAogICAgICAgICAgICAgICAgICAgICAgZG9uZTogZmFsc2UKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2RvbmUpIHsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA1OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgICAgZG9uZTogdHJ1ZQogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICAgIHJlcXVlc3RDYXBhYmlsaXR5ID0gKDAsIF91dGlsLmNyZWF0ZVByb21pc2VDYXBhYmlsaXR5KSgpOwoKICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXF1ZXN0cy5wdXNoKHJlcXVlc3RDYXBhYmlsaXR5KTsKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgcmVxdWVzdENhcGFiaWxpdHkucHJvbWlzZSk7CgogICAgICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIF9jYWxsZWUsIHRoaXMpOwogICAgICAgICAgfSkpOwoKICAgICAgICAgIGZ1bmN0aW9uIHJlYWQoKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVhZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiByZWFkOwogICAgICAgIH0oKQogICAgICB9LCB7CiAgICAgICAga2V5OiAiY2FuY2VsIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY2FuY2VsKHJlYXNvbikgewogICAgICAgICAgdGhpcy5fZG9uZSA9IHRydWU7CgogICAgICAgICAgdGhpcy5fcmVxdWVzdHMuZm9yRWFjaChmdW5jdGlvbiAocmVxdWVzdENhcGFiaWxpdHkpIHsKICAgICAgICAgICAgcmVxdWVzdENhcGFiaWxpdHkucmVzb2x2ZSh7CiAgICAgICAgICAgICAgdmFsdWU6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICBkb25lOiB0cnVlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CgogICAgICAgICAgdGhpcy5fcmVxdWVzdHMgPSBbXTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJwcm9ncmVzc2l2ZURvbmUiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBwcm9ncmVzc2l2ZURvbmUoKSB7CiAgICAgICAgICBpZiAodGhpcy5fZG9uZSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5fZG9uZSA9IHRydWU7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiaGVhZGVyc1JlYWR5IiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9oZWFkZXJzUmVhZHk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZmlsZW5hbWUiLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX2ZpbGVuYW1lOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImlzUmFuZ2VTdXBwb3J0ZWQiLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX3N0cmVhbS5faXNSYW5nZVN1cHBvcnRlZDsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJpc1N0cmVhbWluZ1N1cHBvcnRlZCIsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fc3RyZWFtLl9pc1N0cmVhbWluZ1N1cHBvcnRlZDsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJjb250ZW50TGVuZ3RoIiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9zdHJlYW0uX2NvbnRlbnRMZW5ndGg7CiAgICAgICAgfQogICAgICB9XSk7CgogICAgICByZXR1cm4gUERGRGF0YVRyYW5zcG9ydFN0cmVhbVJlYWRlcjsKICAgIH0oKTsKCiAgICB2YXIgUERGRGF0YVRyYW5zcG9ydFN0cmVhbVJhbmdlUmVhZGVyID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gUERGRGF0YVRyYW5zcG9ydFN0cmVhbVJhbmdlUmVhZGVyKHN0cmVhbSwgYmVnaW4sIGVuZCkgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBQREZEYXRhVHJhbnNwb3J0U3RyZWFtUmFuZ2VSZWFkZXIpOwoKICAgICAgICB0aGlzLl9zdHJlYW0gPSBzdHJlYW07CiAgICAgICAgdGhpcy5fYmVnaW4gPSBiZWdpbjsKICAgICAgICB0aGlzLl9lbmQgPSBlbmQ7CiAgICAgICAgdGhpcy5fcXVldWVkQ2h1bmsgPSBudWxsOwogICAgICAgIHRoaXMuX3JlcXVlc3RzID0gW107CiAgICAgICAgdGhpcy5fZG9uZSA9IGZhbHNlOwogICAgICAgIHRoaXMub25Qcm9ncmVzcyA9IG51bGw7CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhQREZEYXRhVHJhbnNwb3J0U3RyZWFtUmFuZ2VSZWFkZXIsIFt7CiAgICAgICAga2V5OiAiX2VucXVldWUiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZW5xdWV1ZShjaHVuaykgewogICAgICAgICAgaWYgKHRoaXMuX2RvbmUpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0aGlzLl9yZXF1ZXN0cy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgdGhpcy5fcXVldWVkQ2h1bmsgPSBjaHVuazsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciByZXF1ZXN0c0NhcGFiaWxpdHkgPSB0aGlzLl9yZXF1ZXN0cy5zaGlmdCgpOwoKICAgICAgICAgICAgcmVxdWVzdHNDYXBhYmlsaXR5LnJlc29sdmUoewogICAgICAgICAgICAgIHZhbHVlOiBjaHVuaywKICAgICAgICAgICAgICBkb25lOiBmYWxzZQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHRoaXMuX3JlcXVlc3RzLmZvckVhY2goZnVuY3Rpb24gKHJlcXVlc3RDYXBhYmlsaXR5KSB7CiAgICAgICAgICAgICAgcmVxdWVzdENhcGFiaWxpdHkucmVzb2x2ZSh7CiAgICAgICAgICAgICAgICB2YWx1ZTogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgZG9uZTogdHJ1ZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHRoaXMuX3JlcXVlc3RzID0gW107CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5fZG9uZSA9IHRydWU7CgogICAgICAgICAgdGhpcy5fc3RyZWFtLl9yZW1vdmVSYW5nZVJlYWRlcih0aGlzKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJyZWFkIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIF9yZWFkMiA9IF9hc3luY1RvR2VuZXJhdG9yKC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JbImRlZmF1bHQiXS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgICAgICAgICB2YXIgY2h1bmssIHJlcXVlc3RDYXBhYmlsaXR5OwogICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yWyJkZWZhdWx0Il0ud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9xdWV1ZWRDaHVuaykgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA0OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBjaHVuayA9IHRoaXMuX3F1ZXVlZENodW5rOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3F1ZXVlZENodW5rID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGNodW5rLAogICAgICAgICAgICAgICAgICAgICAgZG9uZTogZmFsc2UKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2RvbmUpIHsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNjsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgICBkb25lOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdENhcGFiaWxpdHkgPSAoMCwgX3V0aWwuY3JlYXRlUHJvbWlzZUNhcGFiaWxpdHkpKCk7CgogICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlcXVlc3RzLnB1c2gocmVxdWVzdENhcGFiaWxpdHkpOwoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgcmVxdWVzdENhcGFiaWxpdHkucHJvbWlzZSk7CgogICAgICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBfY2FsbGVlMiwgdGhpcyk7CiAgICAgICAgICB9KSk7CgogICAgICAgICAgZnVuY3Rpb24gcmVhZCgpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZWFkMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiByZWFkOwogICAgICAgIH0oKQogICAgICB9LCB7CiAgICAgICAga2V5OiAiY2FuY2VsIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY2FuY2VsKHJlYXNvbikgewogICAgICAgICAgdGhpcy5fZG9uZSA9IHRydWU7CgogICAgICAgICAgdGhpcy5fcmVxdWVzdHMuZm9yRWFjaChmdW5jdGlvbiAocmVxdWVzdENhcGFiaWxpdHkpIHsKICAgICAgICAgICAgcmVxdWVzdENhcGFiaWxpdHkucmVzb2x2ZSh7CiAgICAgICAgICAgICAgdmFsdWU6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICBkb25lOiB0cnVlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CgogICAgICAgICAgdGhpcy5fcmVxdWVzdHMgPSBbXTsKCiAgICAgICAgICB0aGlzLl9zdHJlYW0uX3JlbW92ZVJhbmdlUmVhZGVyKHRoaXMpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImlzU3RyZWFtaW5nU3VwcG9ydGVkIiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBQREZEYXRhVHJhbnNwb3J0U3RyZWFtUmFuZ2VSZWFkZXI7CiAgICB9KCk7CgogICAgLyoqKi99KSwgKAogIC8qIDIwNCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCgogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICB2YWx1ZTogdHJ1ZQogICAgfSk7CiAgICBleHBvcnRzLldlYkdMQ29udGV4dCA9IHZvaWQgMDsKCiAgICB2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEpOwoKICAgIGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHtpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpO319CgogICAgZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykge2ZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHt2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldO2Rlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTtkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7aWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7T2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpO319CgogICAgZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykge2lmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpO2lmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTtyZXR1cm4gQ29uc3RydWN0b3I7fQoKICAgIHZhciBXZWJHTENvbnRleHQgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBXZWJHTENvbnRleHQoX3JlZikgewogICAgICAgIHZhciBfcmVmJGVuYWJsZSA9IF9yZWYuZW5hYmxlLAogICAgICAgICAgZW5hYmxlID0gX3JlZiRlbmFibGUgPT09IHZvaWQgMCA/IGZhbHNlIDogX3JlZiRlbmFibGU7CgogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBXZWJHTENvbnRleHQpOwoKICAgICAgICB0aGlzLl9lbmFibGVkID0gZW5hYmxlID09PSB0cnVlOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoV2ViR0xDb250ZXh0LCBbewogICAgICAgIGtleTogImNvbXBvc2VTTWFzayIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvc2VTTWFzayhfcmVmMikgewogICAgICAgICAgdmFyIGxheWVyID0gX3JlZjIubGF5ZXIsCiAgICAgICAgICAgIG1hc2sgPSBfcmVmMi5tYXNrLAogICAgICAgICAgICBwcm9wZXJ0aWVzID0gX3JlZjIucHJvcGVydGllczsKICAgICAgICAgIHJldHVybiBXZWJHTFV0aWxzLmNvbXBvc2VTTWFzayhsYXllciwgbWFzaywgcHJvcGVydGllcyk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZHJhd0ZpZ3VyZXMiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBkcmF3RmlndXJlcyhfcmVmMykgewogICAgICAgICAgdmFyIHdpZHRoID0gX3JlZjMud2lkdGgsCiAgICAgICAgICAgIGhlaWdodCA9IF9yZWYzLmhlaWdodCwKICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yID0gX3JlZjMuYmFja2dyb3VuZENvbG9yLAogICAgICAgICAgICBmaWd1cmVzID0gX3JlZjMuZmlndXJlcywKICAgICAgICAgICAgY29udGV4dCA9IF9yZWYzLmNvbnRleHQ7CiAgICAgICAgICByZXR1cm4gV2ViR0xVdGlscy5kcmF3RmlndXJlcyh3aWR0aCwgaGVpZ2h0LCBiYWNrZ3JvdW5kQ29sb3IsIGZpZ3VyZXMsIGNvbnRleHQpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImNsZWFyIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY2xlYXIoKSB7CiAgICAgICAgICBXZWJHTFV0aWxzLmNsZWFudXAoKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJpc0VuYWJsZWQiLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgdmFyIGVuYWJsZWQgPSB0aGlzLl9lbmFibGVkOwoKICAgICAgICAgIGlmIChlbmFibGVkKSB7CiAgICAgICAgICAgIGVuYWJsZWQgPSBXZWJHTFV0aWxzLnRyeUluaXRHTCgpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAiaXNFbmFibGVkIiwgZW5hYmxlZCk7CiAgICAgICAgfQogICAgICB9XSk7CgogICAgICByZXR1cm4gV2ViR0xDb250ZXh0OwogICAgfSgpOwoKICAgIGV4cG9ydHMuV2ViR0xDb250ZXh0ID0gV2ViR0xDb250ZXh0OwoKICAgIHZhciBXZWJHTFV0aWxzID0gZnVuY3Rpb24gV2ViR0xVdGlsc0Nsb3N1cmUoKSB7CiAgICAgIGZ1bmN0aW9uIGxvYWRTaGFkZXIoZ2wsIGNvZGUsIHNoYWRlclR5cGUpIHsKICAgICAgICB2YXIgc2hhZGVyID0gZ2wuY3JlYXRlU2hhZGVyKHNoYWRlclR5cGUpOwogICAgICAgIGdsLnNoYWRlclNvdXJjZShzaGFkZXIsIGNvZGUpOwogICAgICAgIGdsLmNvbXBpbGVTaGFkZXIoc2hhZGVyKTsKICAgICAgICB2YXIgY29tcGlsZWQgPSBnbC5nZXRTaGFkZXJQYXJhbWV0ZXIoc2hhZGVyLCBnbC5DT01QSUxFX1NUQVRVUyk7CgogICAgICAgIGlmICghY29tcGlsZWQpIHsKICAgICAgICAgIHZhciBlcnJvck1zZyA9IGdsLmdldFNoYWRlckluZm9Mb2coc2hhZGVyKTsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiRXJyb3IgZHVyaW5nIHNoYWRlciBjb21waWxhdGlvbjogIiArIGVycm9yTXNnKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBzaGFkZXI7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGNyZWF0ZVZlcnRleFNoYWRlcihnbCwgY29kZSkgewogICAgICAgIHJldHVybiBsb2FkU2hhZGVyKGdsLCBjb2RlLCBnbC5WRVJURVhfU0hBREVSKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gY3JlYXRlRnJhZ21lbnRTaGFkZXIoZ2wsIGNvZGUpIHsKICAgICAgICByZXR1cm4gbG9hZFNoYWRlcihnbCwgY29kZSwgZ2wuRlJBR01FTlRfU0hBREVSKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gY3JlYXRlUHJvZ3JhbShnbCwgc2hhZGVycykgewogICAgICAgIHZhciBwcm9ncmFtID0gZ2wuY3JlYXRlUHJvZ3JhbSgpOwoKICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBzaGFkZXJzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHsKICAgICAgICAgIGdsLmF0dGFjaFNoYWRlcihwcm9ncmFtLCBzaGFkZXJzW2ldKTsKICAgICAgICB9CgogICAgICAgIGdsLmxpbmtQcm9ncmFtKHByb2dyYW0pOwogICAgICAgIHZhciBsaW5rZWQgPSBnbC5nZXRQcm9ncmFtUGFyYW1ldGVyKHByb2dyYW0sIGdsLkxJTktfU1RBVFVTKTsKCiAgICAgICAgaWYgKCFsaW5rZWQpIHsKICAgICAgICAgIHZhciBlcnJvck1zZyA9IGdsLmdldFByb2dyYW1JbmZvTG9nKHByb2dyYW0pOwogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJFcnJvciBkdXJpbmcgcHJvZ3JhbSBsaW5raW5nOiAiICsgZXJyb3JNc2cpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHByb2dyYW07CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGNyZWF0ZVRleHR1cmUoZ2wsIGltYWdlLCB0ZXh0dXJlSWQpIHsKICAgICAgICBnbC5hY3RpdmVUZXh0dXJlKHRleHR1cmVJZCk7CiAgICAgICAgdmFyIHRleHR1cmUgPSBnbC5jcmVhdGVUZXh0dXJlKCk7CiAgICAgICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgdGV4dHVyZSk7CiAgICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX1dSQVBfUywgZ2wuQ0xBTVBfVE9fRURHRSk7CiAgICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX1dSQVBfVCwgZ2wuQ0xBTVBfVE9fRURHRSk7CiAgICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX01JTl9GSUxURVIsIGdsLk5FQVJFU1QpOwogICAgICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NQUdfRklMVEVSLCBnbC5ORUFSRVNUKTsKICAgICAgICBnbC50ZXhJbWFnZTJEKGdsLlRFWFRVUkVfMkQsIDAsIGdsLlJHQkEsIGdsLlJHQkEsIGdsLlVOU0lHTkVEX0JZVEUsIGltYWdlKTsKICAgICAgICByZXR1cm4gdGV4dHVyZTsKICAgICAgfQoKICAgICAgdmFyIGN1cnJlbnRHTCwgY3VycmVudENhbnZhczsKCiAgICAgIGZ1bmN0aW9uIGdlbmVyYXRlR0woKSB7CiAgICAgICAgaWYgKGN1cnJlbnRHTCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgY3VycmVudENhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImNhbnZhcyIpOwogICAgICAgIGN1cnJlbnRHTCA9IGN1cnJlbnRDYW52YXMuZ2V0Q29udGV4dCgid2ViZ2wiLCB7CiAgICAgICAgICBwcmVtdWx0aXBsaWVkYWxwaGE6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHZhciBzbWFza1ZlcnRleFNoYWRlckNvZGUgPSAiXAogIGF0dHJpYnV0ZSB2ZWMyIGFfcG9zaXRpb247ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAogIGF0dHJpYnV0ZSB2ZWMyIGFfdGV4Q29vcmQ7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAogIHVuaWZvcm0gdmVjMiB1X3Jlc29sdXRpb247ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAogIHZhcnlpbmcgdmVjMiB2X3RleENvb3JkOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAogIHZvaWQgbWFpbigpIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAogICAgdmVjMiBjbGlwU3BhY2UgPSAoYV9wb3NpdGlvbiAvIHVfcmVzb2x1dGlvbikgKiAyLjAgLSAxLjA7ICAgXAogICAgZ2xfUG9zaXRpb24gPSB2ZWM0KGNsaXBTcGFjZSAqIHZlYzIoMSwgLTEpLCAwLCAxKTsgICAgICAgICAgXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAogICAgdl90ZXhDb29yZCA9IGFfdGV4Q29vcmQ7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAogIH0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIjsKCgoKCgoKCgoKCgoKCiAgICAgIHZhciBzbWFza0ZyYWdtZW50U2hhZGVyQ29kZSA9ICJcCiAgcHJlY2lzaW9uIG1lZGl1bXAgZmxvYXQ7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCiAgdW5pZm9ybSB2ZWM0IHVfYmFja2Ryb3A7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCiAgdW5pZm9ybSBpbnQgdV9zdWJ0eXBlOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCiAgdW5pZm9ybSBzYW1wbGVyMkQgdV9pbWFnZTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCiAgdW5pZm9ybSBzYW1wbGVyMkQgdV9tYXNrOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCiAgdmFyeWluZyB2ZWMyIHZfdGV4Q29vcmQ7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCiAgdm9pZCBtYWluKCkgeyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCiAgICB2ZWM0IGltYWdlQ29sb3IgPSB0ZXh0dXJlMkQodV9pbWFnZSwgdl90ZXhDb29yZCk7ICAgICAgICAgICBcCiAgICB2ZWM0IG1hc2tDb2xvciA9IHRleHR1cmUyRCh1X21hc2ssIHZfdGV4Q29vcmQpOyAgICAgICAgICAgICBcCiAgICBpZiAodV9iYWNrZHJvcC5hID4gMC4wKSB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCiAgICAgIG1hc2tDb2xvci5yZ2IgPSBtYXNrQ29sb3IucmdiICogbWFza0NvbG9yLmEgKyAgICAgICAgICAgICBcCiAgICAgICAgICAgICAgICAgICAgICB1X2JhY2tkcm9wLnJnYiAqICgxLjAgLSBtYXNrQ29sb3IuYSk7ICAgICBcCiAgICB9ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCiAgICBmbG9hdCBsdW07ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCiAgICBpZiAodV9zdWJ0eXBlID09IDApIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCiAgICAgIGx1bSA9IG1hc2tDb2xvci5hOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCiAgICB9IGVsc2UgeyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCiAgICAgIGx1bSA9IG1hc2tDb2xvci5yICogMC4zICsgbWFza0NvbG9yLmcgKiAwLjU5ICsgICAgICAgICAgICBcCiAgICAgICAgICAgIG1hc2tDb2xvci5iICogMC4xMTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCiAgICB9ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCiAgICBpbWFnZUNvbG9yLmEgKj0gbHVtOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCiAgICBpbWFnZUNvbG9yLnJnYiAqPSBpbWFnZUNvbG9yLmE7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCiAgICBnbF9GcmFnQ29sb3IgPSBpbWFnZUNvbG9yOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCiAgfSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiOwoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgogICAgICB2YXIgc21hc2tDYWNoZSA9IG51bGw7CgogICAgICBmdW5jdGlvbiBpbml0U21hc2tHTCgpIHsKICAgICAgICB2YXIgY2FudmFzLCBnbDsKICAgICAgICBnZW5lcmF0ZUdMKCk7CiAgICAgICAgY2FudmFzID0gY3VycmVudENhbnZhczsKICAgICAgICBjdXJyZW50Q2FudmFzID0gbnVsbDsKICAgICAgICBnbCA9IGN1cnJlbnRHTDsKICAgICAgICBjdXJyZW50R0wgPSBudWxsOwogICAgICAgIHZhciB2ZXJ0ZXhTaGFkZXIgPSBjcmVhdGVWZXJ0ZXhTaGFkZXIoZ2wsIHNtYXNrVmVydGV4U2hhZGVyQ29kZSk7CiAgICAgICAgdmFyIGZyYWdtZW50U2hhZGVyID0gY3JlYXRlRnJhZ21lbnRTaGFkZXIoZ2wsIHNtYXNrRnJhZ21lbnRTaGFkZXJDb2RlKTsKICAgICAgICB2YXIgcHJvZ3JhbSA9IGNyZWF0ZVByb2dyYW0oZ2wsIFt2ZXJ0ZXhTaGFkZXIsIGZyYWdtZW50U2hhZGVyXSk7CiAgICAgICAgZ2wudXNlUHJvZ3JhbShwcm9ncmFtKTsKICAgICAgICB2YXIgY2FjaGUgPSB7fTsKICAgICAgICBjYWNoZS5nbCA9IGdsOwogICAgICAgIGNhY2hlLmNhbnZhcyA9IGNhbnZhczsKICAgICAgICBjYWNoZS5yZXNvbHV0aW9uTG9jYXRpb24gPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24ocHJvZ3JhbSwgInVfcmVzb2x1dGlvbiIpOwogICAgICAgIGNhY2hlLnBvc2l0aW9uTG9jYXRpb24gPSBnbC5nZXRBdHRyaWJMb2NhdGlvbihwcm9ncmFtLCAiYV9wb3NpdGlvbiIpOwogICAgICAgIGNhY2hlLmJhY2tkcm9wTG9jYXRpb24gPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24ocHJvZ3JhbSwgInVfYmFja2Ryb3AiKTsKICAgICAgICBjYWNoZS5zdWJ0eXBlTG9jYXRpb24gPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24ocHJvZ3JhbSwgInVfc3VidHlwZSIpOwogICAgICAgIHZhciB0ZXhDb29yZExvY2F0aW9uID0gZ2wuZ2V0QXR0cmliTG9jYXRpb24ocHJvZ3JhbSwgImFfdGV4Q29vcmQiKTsKICAgICAgICB2YXIgdGV4TGF5ZXJMb2NhdGlvbiA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihwcm9ncmFtLCAidV9pbWFnZSIpOwogICAgICAgIHZhciB0ZXhNYXNrTG9jYXRpb24gPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24ocHJvZ3JhbSwgInVfbWFzayIpOwogICAgICAgIHZhciB0ZXhDb29yZEJ1ZmZlciA9IGdsLmNyZWF0ZUJ1ZmZlcigpOwogICAgICAgIGdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCB0ZXhDb29yZEJ1ZmZlcik7CiAgICAgICAgZ2wuYnVmZmVyRGF0YShnbC5BUlJBWV9CVUZGRVIsIG5ldyBGbG9hdDMyQXJyYXkoWzAuMCwgMC4wLCAxLjAsIDAuMCwgMC4wLCAxLjAsIDAuMCwgMS4wLCAxLjAsIDAuMCwgMS4wLCAxLjBdKSwgZ2wuU1RBVElDX0RSQVcpOwogICAgICAgIGdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KHRleENvb3JkTG9jYXRpb24pOwogICAgICAgIGdsLnZlcnRleEF0dHJpYlBvaW50ZXIodGV4Q29vcmRMb2NhdGlvbiwgMiwgZ2wuRkxPQVQsIGZhbHNlLCAwLCAwKTsKICAgICAgICBnbC51bmlmb3JtMWkodGV4TGF5ZXJMb2NhdGlvbiwgMCk7CiAgICAgICAgZ2wudW5pZm9ybTFpKHRleE1hc2tMb2NhdGlvbiwgMSk7CiAgICAgICAgc21hc2tDYWNoZSA9IGNhY2hlOwogICAgICB9CgogICAgICBmdW5jdGlvbiBjb21wb3NlU01hc2sobGF5ZXIsIG1hc2ssIHByb3BlcnRpZXMpIHsKICAgICAgICB2YXIgd2lkdGggPSBsYXllci53aWR0aCwKICAgICAgICAgIGhlaWdodCA9IGxheWVyLmhlaWdodDsKCiAgICAgICAgaWYgKCFzbWFza0NhY2hlKSB7CiAgICAgICAgICBpbml0U21hc2tHTCgpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGNhY2hlID0gc21hc2tDYWNoZSwKICAgICAgICAgIGNhbnZhcyA9IGNhY2hlLmNhbnZhcywKICAgICAgICAgIGdsID0gY2FjaGUuZ2w7CiAgICAgICAgY2FudmFzLndpZHRoID0gd2lkdGg7CiAgICAgICAgY2FudmFzLmhlaWdodCA9IGhlaWdodDsKICAgICAgICBnbC52aWV3cG9ydCgwLCAwLCBnbC5kcmF3aW5nQnVmZmVyV2lkdGgsIGdsLmRyYXdpbmdCdWZmZXJIZWlnaHQpOwogICAgICAgIGdsLnVuaWZvcm0yZihjYWNoZS5yZXNvbHV0aW9uTG9jYXRpb24sIHdpZHRoLCBoZWlnaHQpOwoKICAgICAgICBpZiAocHJvcGVydGllcy5iYWNrZHJvcCkgewogICAgICAgICAgZ2wudW5pZm9ybTRmKGNhY2hlLnJlc29sdXRpb25Mb2NhdGlvbiwgcHJvcGVydGllcy5iYWNrZHJvcFswXSwgcHJvcGVydGllcy5iYWNrZHJvcFsxXSwgcHJvcGVydGllcy5iYWNrZHJvcFsyXSwgMSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGdsLnVuaWZvcm00ZihjYWNoZS5yZXNvbHV0aW9uTG9jYXRpb24sIDAsIDAsIDAsIDApOwogICAgICAgIH0KCiAgICAgICAgZ2wudW5pZm9ybTFpKGNhY2hlLnN1YnR5cGVMb2NhdGlvbiwgcHJvcGVydGllcy5zdWJ0eXBlID09PSAiTHVtaW5vc2l0eSIgPyAxIDogMCk7CiAgICAgICAgdmFyIHRleHR1cmUgPSBjcmVhdGVUZXh0dXJlKGdsLCBsYXllciwgZ2wuVEVYVFVSRTApOwogICAgICAgIHZhciBtYXNrVGV4dHVyZSA9IGNyZWF0ZVRleHR1cmUoZ2wsIG1hc2ssIGdsLlRFWFRVUkUxKTsKICAgICAgICB2YXIgYnVmZmVyID0gZ2wuY3JlYXRlQnVmZmVyKCk7CiAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIGJ1ZmZlcik7CiAgICAgICAgZ2wuYnVmZmVyRGF0YShnbC5BUlJBWV9CVUZGRVIsIG5ldyBGbG9hdDMyQXJyYXkoWzAsIDAsIHdpZHRoLCAwLCAwLCBoZWlnaHQsIDAsIGhlaWdodCwgd2lkdGgsIDAsIHdpZHRoLCBoZWlnaHRdKSwgZ2wuU1RBVElDX0RSQVcpOwogICAgICAgIGdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KGNhY2hlLnBvc2l0aW9uTG9jYXRpb24pOwogICAgICAgIGdsLnZlcnRleEF0dHJpYlBvaW50ZXIoY2FjaGUucG9zaXRpb25Mb2NhdGlvbiwgMiwgZ2wuRkxPQVQsIGZhbHNlLCAwLCAwKTsKICAgICAgICBnbC5jbGVhckNvbG9yKDAsIDAsIDAsIDApOwogICAgICAgIGdsLmVuYWJsZShnbC5CTEVORCk7CiAgICAgICAgZ2wuYmxlbmRGdW5jKGdsLk9ORSwgZ2wuT05FX01JTlVTX1NSQ19BTFBIQSk7CiAgICAgICAgZ2wuY2xlYXIoZ2wuQ09MT1JfQlVGRkVSX0JJVCk7CiAgICAgICAgZ2wuZHJhd0FycmF5cyhnbC5UUklBTkdMRVMsIDAsIDYpOwogICAgICAgIGdsLmZsdXNoKCk7CiAgICAgICAgZ2wuZGVsZXRlVGV4dHVyZSh0ZXh0dXJlKTsKICAgICAgICBnbC5kZWxldGVUZXh0dXJlKG1hc2tUZXh0dXJlKTsKICAgICAgICBnbC5kZWxldGVCdWZmZXIoYnVmZmVyKTsKICAgICAgICByZXR1cm4gY2FudmFzOwogICAgICB9CgogICAgICB2YXIgZmlndXJlc1ZlcnRleFNoYWRlckNvZGUgPSAiXAogIGF0dHJpYnV0ZSB2ZWMyIGFfcG9zaXRpb247ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAogIGF0dHJpYnV0ZSB2ZWMzIGFfY29sb3I7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAogIHVuaWZvcm0gdmVjMiB1X3Jlc29sdXRpb247ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAogIHVuaWZvcm0gdmVjMiB1X3NjYWxlOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAogIHVuaWZvcm0gdmVjMiB1X29mZnNldDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAogIHZhcnlpbmcgdmVjNCB2X2NvbG9yOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAogIHZvaWQgbWFpbigpIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAogICAgdmVjMiBwb3NpdGlvbiA9IChhX3Bvc2l0aW9uICsgdV9vZmZzZXQpICogdV9zY2FsZTsgICAgICAgICAgXAogICAgdmVjMiBjbGlwU3BhY2UgPSAocG9zaXRpb24gLyB1X3Jlc29sdXRpb24pICogMi4wIC0gMS4wOyAgICAgXAogICAgZ2xfUG9zaXRpb24gPSB2ZWM0KGNsaXBTcGFjZSAqIHZlYzIoMSwgLTEpLCAwLCAxKTsgICAgICAgICAgXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAogICAgdl9jb2xvciA9IHZlYzQoYV9jb2xvciAvIDI1NS4wLCAxLjApOyAgICAgICAgICAgICAgICAgICAgICAgXAogIH0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIjsKCgoKCgoKCgoKCgoKCgoKCiAgICAgIHZhciBmaWd1cmVzRnJhZ21lbnRTaGFkZXJDb2RlID0gIlwKICBwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwKICB2YXJ5aW5nIHZlYzQgdl9jb2xvcjsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwKICB2b2lkIG1haW4oKSB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwKICAgIGdsX0ZyYWdDb2xvciA9IHZfY29sb3I7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwKICB9ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICI7CgoKCgoKCgogICAgICB2YXIgZmlndXJlc0NhY2hlID0gbnVsbDsKCiAgICAgIGZ1bmN0aW9uIGluaXRGaWd1cmVzR0woKSB7CiAgICAgICAgdmFyIGNhbnZhcywgZ2w7CiAgICAgICAgZ2VuZXJhdGVHTCgpOwogICAgICAgIGNhbnZhcyA9IGN1cnJlbnRDYW52YXM7CiAgICAgICAgY3VycmVudENhbnZhcyA9IG51bGw7CiAgICAgICAgZ2wgPSBjdXJyZW50R0w7CiAgICAgICAgY3VycmVudEdMID0gbnVsbDsKICAgICAgICB2YXIgdmVydGV4U2hhZGVyID0gY3JlYXRlVmVydGV4U2hhZGVyKGdsLCBmaWd1cmVzVmVydGV4U2hhZGVyQ29kZSk7CiAgICAgICAgdmFyIGZyYWdtZW50U2hhZGVyID0gY3JlYXRlRnJhZ21lbnRTaGFkZXIoZ2wsIGZpZ3VyZXNGcmFnbWVudFNoYWRlckNvZGUpOwogICAgICAgIHZhciBwcm9ncmFtID0gY3JlYXRlUHJvZ3JhbShnbCwgW3ZlcnRleFNoYWRlciwgZnJhZ21lbnRTaGFkZXJdKTsKICAgICAgICBnbC51c2VQcm9ncmFtKHByb2dyYW0pOwogICAgICAgIHZhciBjYWNoZSA9IHt9OwogICAgICAgIGNhY2hlLmdsID0gZ2w7CiAgICAgICAgY2FjaGUuY2FudmFzID0gY2FudmFzOwogICAgICAgIGNhY2hlLnJlc29sdXRpb25Mb2NhdGlvbiA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihwcm9ncmFtLCAidV9yZXNvbHV0aW9uIik7CiAgICAgICAgY2FjaGUuc2NhbGVMb2NhdGlvbiA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihwcm9ncmFtLCAidV9zY2FsZSIpOwogICAgICAgIGNhY2hlLm9mZnNldExvY2F0aW9uID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKHByb2dyYW0sICJ1X29mZnNldCIpOwogICAgICAgIGNhY2hlLnBvc2l0aW9uTG9jYXRpb24gPSBnbC5nZXRBdHRyaWJMb2NhdGlvbihwcm9ncmFtLCAiYV9wb3NpdGlvbiIpOwogICAgICAgIGNhY2hlLmNvbG9yTG9jYXRpb24gPSBnbC5nZXRBdHRyaWJMb2NhdGlvbihwcm9ncmFtLCAiYV9jb2xvciIpOwogICAgICAgIGZpZ3VyZXNDYWNoZSA9IGNhY2hlOwogICAgICB9CgogICAgICBmdW5jdGlvbiBkcmF3RmlndXJlcyh3aWR0aCwgaGVpZ2h0LCBiYWNrZ3JvdW5kQ29sb3IsIGZpZ3VyZXMsIGNvbnRleHQpIHsKICAgICAgICBpZiAoIWZpZ3VyZXNDYWNoZSkgewogICAgICAgICAgaW5pdEZpZ3VyZXNHTCgpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGNhY2hlID0gZmlndXJlc0NhY2hlLAogICAgICAgICAgY2FudmFzID0gY2FjaGUuY2FudmFzLAogICAgICAgICAgZ2wgPSBjYWNoZS5nbDsKICAgICAgICBjYW52YXMud2lkdGggPSB3aWR0aDsKICAgICAgICBjYW52YXMuaGVpZ2h0ID0gaGVpZ2h0OwogICAgICAgIGdsLnZpZXdwb3J0KDAsIDAsIGdsLmRyYXdpbmdCdWZmZXJXaWR0aCwgZ2wuZHJhd2luZ0J1ZmZlckhlaWdodCk7CiAgICAgICAgZ2wudW5pZm9ybTJmKGNhY2hlLnJlc29sdXRpb25Mb2NhdGlvbiwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgdmFyIGNvdW50ID0gMDsKICAgICAgICB2YXIgaSwgaWksIHJvd3M7CgogICAgICAgIGZvciAoaSA9IDAsIGlpID0gZmlndXJlcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICBzd2l0Y2ggKGZpZ3VyZXNbaV0udHlwZSkgewogICAgICAgICAgICBjYXNlICJsYXR0aWNlIjoKICAgICAgICAgICAgICByb3dzID0gZmlndXJlc1tpXS5jb29yZHMubGVuZ3RoIC8gZmlndXJlc1tpXS52ZXJ0aWNlc1BlclJvdyB8IDA7CiAgICAgICAgICAgICAgY291bnQgKz0gKHJvd3MgLSAxKSAqIChmaWd1cmVzW2ldLnZlcnRpY2VzUGVyUm93IC0gMSkgKiA2OwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAidHJpYW5nbGVzIjoKICAgICAgICAgICAgICBjb3VudCArPSBmaWd1cmVzW2ldLmNvb3Jkcy5sZW5ndGg7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YXIgY29vcmRzID0gbmV3IEZsb2F0MzJBcnJheShjb3VudCAqIDIpOwogICAgICAgIHZhciBjb2xvcnMgPSBuZXcgVWludDhBcnJheShjb3VudCAqIDMpOwogICAgICAgIHZhciBjb29yZHNNYXAgPSBjb250ZXh0LmNvb3JkcywKICAgICAgICAgIGNvbG9yc01hcCA9IGNvbnRleHQuY29sb3JzOwogICAgICAgIHZhciBwSW5kZXggPSAwLAogICAgICAgICAgY0luZGV4ID0gMDsKCiAgICAgICAgZm9yIChpID0gMCwgaWkgPSBmaWd1cmVzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgIHZhciBmaWd1cmUgPSBmaWd1cmVzW2ldLAogICAgICAgICAgICBwcyA9IGZpZ3VyZS5jb29yZHMsCiAgICAgICAgICAgIGNzID0gZmlndXJlLmNvbG9yczsKCiAgICAgICAgICBzd2l0Y2ggKGZpZ3VyZS50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgImxhdHRpY2UiOgogICAgICAgICAgICAgIHZhciBjb2xzID0gZmlndXJlLnZlcnRpY2VzUGVyUm93OwogICAgICAgICAgICAgIHJvd3MgPSBwcy5sZW5ndGggLyBjb2xzIHwgMDsKCiAgICAgICAgICAgICAgZm9yICh2YXIgcm93ID0gMTsgcm93IDwgcm93czsgcm93KyspIHsKICAgICAgICAgICAgICAgIHZhciBvZmZzZXQgPSByb3cgKiBjb2xzICsgMTsKCiAgICAgICAgICAgICAgICBmb3IgKHZhciBjb2wgPSAxOyBjb2wgPCBjb2xzOyBjb2wrKywgb2Zmc2V0KyspIHsKICAgICAgICAgICAgICAgICAgY29vcmRzW3BJbmRleF0gPSBjb29yZHNNYXBbcHNbb2Zmc2V0IC0gY29scyAtIDFdXTsKICAgICAgICAgICAgICAgICAgY29vcmRzW3BJbmRleCArIDFdID0gY29vcmRzTWFwW3BzW29mZnNldCAtIGNvbHMgLSAxXSArIDFdOwogICAgICAgICAgICAgICAgICBjb29yZHNbcEluZGV4ICsgMl0gPSBjb29yZHNNYXBbcHNbb2Zmc2V0IC0gY29sc11dOwogICAgICAgICAgICAgICAgICBjb29yZHNbcEluZGV4ICsgM10gPSBjb29yZHNNYXBbcHNbb2Zmc2V0IC0gY29sc10gKyAxXTsKICAgICAgICAgICAgICAgICAgY29vcmRzW3BJbmRleCArIDRdID0gY29vcmRzTWFwW3BzW29mZnNldCAtIDFdXTsKICAgICAgICAgICAgICAgICAgY29vcmRzW3BJbmRleCArIDVdID0gY29vcmRzTWFwW3BzW29mZnNldCAtIDFdICsgMV07CiAgICAgICAgICAgICAgICAgIGNvbG9yc1tjSW5kZXhdID0gY29sb3JzTWFwW2NzW29mZnNldCAtIGNvbHMgLSAxXV07CiAgICAgICAgICAgICAgICAgIGNvbG9yc1tjSW5kZXggKyAxXSA9IGNvbG9yc01hcFtjc1tvZmZzZXQgLSBjb2xzIC0gMV0gKyAxXTsKICAgICAgICAgICAgICAgICAgY29sb3JzW2NJbmRleCArIDJdID0gY29sb3JzTWFwW2NzW29mZnNldCAtIGNvbHMgLSAxXSArIDJdOwogICAgICAgICAgICAgICAgICBjb2xvcnNbY0luZGV4ICsgM10gPSBjb2xvcnNNYXBbY3Nbb2Zmc2V0IC0gY29sc11dOwogICAgICAgICAgICAgICAgICBjb2xvcnNbY0luZGV4ICsgNF0gPSBjb2xvcnNNYXBbY3Nbb2Zmc2V0IC0gY29sc10gKyAxXTsKICAgICAgICAgICAgICAgICAgY29sb3JzW2NJbmRleCArIDVdID0gY29sb3JzTWFwW2NzW29mZnNldCAtIGNvbHNdICsgMl07CiAgICAgICAgICAgICAgICAgIGNvbG9yc1tjSW5kZXggKyA2XSA9IGNvbG9yc01hcFtjc1tvZmZzZXQgLSAxXV07CiAgICAgICAgICAgICAgICAgIGNvbG9yc1tjSW5kZXggKyA3XSA9IGNvbG9yc01hcFtjc1tvZmZzZXQgLSAxXSArIDFdOwogICAgICAgICAgICAgICAgICBjb2xvcnNbY0luZGV4ICsgOF0gPSBjb2xvcnNNYXBbY3Nbb2Zmc2V0IC0gMV0gKyAyXTsKICAgICAgICAgICAgICAgICAgY29vcmRzW3BJbmRleCArIDZdID0gY29vcmRzW3BJbmRleCArIDJdOwogICAgICAgICAgICAgICAgICBjb29yZHNbcEluZGV4ICsgN10gPSBjb29yZHNbcEluZGV4ICsgM107CiAgICAgICAgICAgICAgICAgIGNvb3Jkc1twSW5kZXggKyA4XSA9IGNvb3Jkc1twSW5kZXggKyA0XTsKICAgICAgICAgICAgICAgICAgY29vcmRzW3BJbmRleCArIDldID0gY29vcmRzW3BJbmRleCArIDVdOwogICAgICAgICAgICAgICAgICBjb29yZHNbcEluZGV4ICsgMTBdID0gY29vcmRzTWFwW3BzW29mZnNldF1dOwogICAgICAgICAgICAgICAgICBjb29yZHNbcEluZGV4ICsgMTFdID0gY29vcmRzTWFwW3BzW29mZnNldF0gKyAxXTsKICAgICAgICAgICAgICAgICAgY29sb3JzW2NJbmRleCArIDldID0gY29sb3JzW2NJbmRleCArIDNdOwogICAgICAgICAgICAgICAgICBjb2xvcnNbY0luZGV4ICsgMTBdID0gY29sb3JzW2NJbmRleCArIDRdOwogICAgICAgICAgICAgICAgICBjb2xvcnNbY0luZGV4ICsgMTFdID0gY29sb3JzW2NJbmRleCArIDVdOwogICAgICAgICAgICAgICAgICBjb2xvcnNbY0luZGV4ICsgMTJdID0gY29sb3JzW2NJbmRleCArIDZdOwogICAgICAgICAgICAgICAgICBjb2xvcnNbY0luZGV4ICsgMTNdID0gY29sb3JzW2NJbmRleCArIDddOwogICAgICAgICAgICAgICAgICBjb2xvcnNbY0luZGV4ICsgMTRdID0gY29sb3JzW2NJbmRleCArIDhdOwogICAgICAgICAgICAgICAgICBjb2xvcnNbY0luZGV4ICsgMTVdID0gY29sb3JzTWFwW2NzW29mZnNldF1dOwogICAgICAgICAgICAgICAgICBjb2xvcnNbY0luZGV4ICsgMTZdID0gY29sb3JzTWFwW2NzW29mZnNldF0gKyAxXTsKICAgICAgICAgICAgICAgICAgY29sb3JzW2NJbmRleCArIDE3XSA9IGNvbG9yc01hcFtjc1tvZmZzZXRdICsgMl07CiAgICAgICAgICAgICAgICAgIHBJbmRleCArPSAxMjsKICAgICAgICAgICAgICAgICAgY0luZGV4ICs9IDE4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICJ0cmlhbmdsZXMiOgogICAgICAgICAgICAgIGZvciAodmFyIGogPSAwLCBqaiA9IHBzLmxlbmd0aDsgaiA8IGpqOyBqKyspIHsKICAgICAgICAgICAgICAgIGNvb3Jkc1twSW5kZXhdID0gY29vcmRzTWFwW3BzW2pdXTsKICAgICAgICAgICAgICAgIGNvb3Jkc1twSW5kZXggKyAxXSA9IGNvb3Jkc01hcFtwc1tqXSArIDFdOwogICAgICAgICAgICAgICAgY29sb3JzW2NJbmRleF0gPSBjb2xvcnNNYXBbY3Nbal1dOwogICAgICAgICAgICAgICAgY29sb3JzW2NJbmRleCArIDFdID0gY29sb3JzTWFwW2NzW2pdICsgMV07CiAgICAgICAgICAgICAgICBjb2xvcnNbY0luZGV4ICsgMl0gPSBjb2xvcnNNYXBbY3Nbal0gKyAyXTsKICAgICAgICAgICAgICAgIHBJbmRleCArPSAyOwogICAgICAgICAgICAgICAgY0luZGV4ICs9IDM7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChiYWNrZ3JvdW5kQ29sb3IpIHsKICAgICAgICAgIGdsLmNsZWFyQ29sb3IoYmFja2dyb3VuZENvbG9yWzBdIC8gMjU1LCBiYWNrZ3JvdW5kQ29sb3JbMV0gLyAyNTUsIGJhY2tncm91bmRDb2xvclsyXSAvIDI1NSwgMS4wKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZ2wuY2xlYXJDb2xvcigwLCAwLCAwLCAwKTsKICAgICAgICB9CgogICAgICAgIGdsLmNsZWFyKGdsLkNPTE9SX0JVRkZFUl9CSVQpOwogICAgICAgIHZhciBjb29yZHNCdWZmZXIgPSBnbC5jcmVhdGVCdWZmZXIoKTsKICAgICAgICBnbC5iaW5kQnVmZmVyKGdsLkFSUkFZX0JVRkZFUiwgY29vcmRzQnVmZmVyKTsKICAgICAgICBnbC5idWZmZXJEYXRhKGdsLkFSUkFZX0JVRkZFUiwgY29vcmRzLCBnbC5TVEFUSUNfRFJBVyk7CiAgICAgICAgZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkoY2FjaGUucG9zaXRpb25Mb2NhdGlvbik7CiAgICAgICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcihjYWNoZS5wb3NpdGlvbkxvY2F0aW9uLCAyLCBnbC5GTE9BVCwgZmFsc2UsIDAsIDApOwogICAgICAgIHZhciBjb2xvcnNCdWZmZXIgPSBnbC5jcmVhdGVCdWZmZXIoKTsKICAgICAgICBnbC5iaW5kQnVmZmVyKGdsLkFSUkFZX0JVRkZFUiwgY29sb3JzQnVmZmVyKTsKICAgICAgICBnbC5idWZmZXJEYXRhKGdsLkFSUkFZX0JVRkZFUiwgY29sb3JzLCBnbC5TVEFUSUNfRFJBVyk7CiAgICAgICAgZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkoY2FjaGUuY29sb3JMb2NhdGlvbik7CiAgICAgICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcihjYWNoZS5jb2xvckxvY2F0aW9uLCAzLCBnbC5VTlNJR05FRF9CWVRFLCBmYWxzZSwgMCwgMCk7CiAgICAgICAgZ2wudW5pZm9ybTJmKGNhY2hlLnNjYWxlTG9jYXRpb24sIGNvbnRleHQuc2NhbGVYLCBjb250ZXh0LnNjYWxlWSk7CiAgICAgICAgZ2wudW5pZm9ybTJmKGNhY2hlLm9mZnNldExvY2F0aW9uLCBjb250ZXh0Lm9mZnNldFgsIGNvbnRleHQub2Zmc2V0WSk7CiAgICAgICAgZ2wuZHJhd0FycmF5cyhnbC5UUklBTkdMRVMsIDAsIGNvdW50KTsKICAgICAgICBnbC5mbHVzaCgpOwogICAgICAgIGdsLmRlbGV0ZUJ1ZmZlcihjb29yZHNCdWZmZXIpOwogICAgICAgIGdsLmRlbGV0ZUJ1ZmZlcihjb2xvcnNCdWZmZXIpOwogICAgICAgIHJldHVybiBjYW52YXM7CiAgICAgIH0KCiAgICAgIHJldHVybiB7CiAgICAgICAgdHJ5SW5pdEdMOiBmdW5jdGlvbiB0cnlJbml0R0woKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBnZW5lcmF0ZUdMKCk7CiAgICAgICAgICAgIHJldHVybiAhIWN1cnJlbnRHTDsKICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7fQoKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9LAogICAgICAgIGNvbXBvc2VTTWFzazogY29tcG9zZVNNYXNrLAogICAgICAgIGRyYXdGaWd1cmVzOiBkcmF3RmlndXJlcywKICAgICAgICBjbGVhbnVwOiBmdW5jdGlvbiBjbGVhbnVwKCkgewogICAgICAgICAgaWYgKHNtYXNrQ2FjaGUgJiYgc21hc2tDYWNoZS5jYW52YXMpIHsKICAgICAgICAgICAgc21hc2tDYWNoZS5jYW52YXMud2lkdGggPSAwOwogICAgICAgICAgICBzbWFza0NhY2hlLmNhbnZhcy5oZWlnaHQgPSAwOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChmaWd1cmVzQ2FjaGUgJiYgZmlndXJlc0NhY2hlLmNhbnZhcykgewogICAgICAgICAgICBmaWd1cmVzQ2FjaGUuY2FudmFzLndpZHRoID0gMDsKICAgICAgICAgICAgZmlndXJlc0NhY2hlLmNhbnZhcy5oZWlnaHQgPSAwOwogICAgICAgICAgfQoKICAgICAgICAgIHNtYXNrQ2FjaGUgPSBudWxsOwogICAgICAgICAgZmlndXJlc0NhY2hlID0gbnVsbDsKICAgICAgICB9CiAgICAgIH07CiAgICB9KCk7CgogICAgLyoqKi99KSwgKAogIC8qIDIwNSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCgogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICB2YWx1ZTogdHJ1ZQogICAgfSk7CiAgICBleHBvcnRzLnJlbmRlclRleHRMYXllciA9IHZvaWQgMDsKCiAgICB2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEpOwoKICAgIHZhciByZW5kZXJUZXh0TGF5ZXIgPSBmdW5jdGlvbiByZW5kZXJUZXh0TGF5ZXJDbG9zdXJlKCkgewogICAgICB2YXIgTUFYX1RFWFRfRElWU19UT19SRU5ERVIgPSAxMDAwMDA7CiAgICAgIHZhciBOb25XaGl0ZXNwYWNlUmVnZXhwID0gL1xTLzsKCiAgICAgIGZ1bmN0aW9uIGlzQWxsV2hpdGVzcGFjZShzdHIpIHsKICAgICAgICByZXR1cm4gIU5vbldoaXRlc3BhY2VSZWdleHAudGVzdChzdHIpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBhcHBlbmRUZXh0KHRhc2ssIGdlb20sIHN0eWxlcykgewogICAgICAgIHZhciB0ZXh0RGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3BhbiIpOwogICAgICAgIHZhciB0ZXh0RGl2UHJvcGVydGllcyA9IHsKICAgICAgICAgIGFuZ2xlOiAwLAogICAgICAgICAgY2FudmFzV2lkdGg6IDAsCiAgICAgICAgICBpc1doaXRlc3BhY2U6IGZhbHNlLAogICAgICAgICAgb3JpZ2luYWxUcmFuc2Zvcm06IG51bGwsCiAgICAgICAgICBwYWRkaW5nQm90dG9tOiAwLAogICAgICAgICAgcGFkZGluZ0xlZnQ6IDAsCiAgICAgICAgICBwYWRkaW5nUmlnaHQ6IDAsCiAgICAgICAgICBwYWRkaW5nVG9wOiAwLAogICAgICAgICAgc2NhbGU6IDEKICAgICAgICB9OwoKICAgICAgICB0YXNrLl90ZXh0RGl2cy5wdXNoKHRleHREaXYpOwoKICAgICAgICBpZiAoaXNBbGxXaGl0ZXNwYWNlKGdlb20uc3RyKSkgewogICAgICAgICAgdGV4dERpdlByb3BlcnRpZXMuaXNXaGl0ZXNwYWNlID0gdHJ1ZTsKCiAgICAgICAgICB0YXNrLl90ZXh0RGl2UHJvcGVydGllcy5zZXQodGV4dERpdiwgdGV4dERpdlByb3BlcnRpZXMpOwoKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciB0eCA9IF91dGlsLlV0aWwudHJhbnNmb3JtKHRhc2suX3ZpZXdwb3J0LnRyYW5zZm9ybSwgZ2VvbS50cmFuc2Zvcm0pOwoKICAgICAgICB2YXIgYW5nbGUgPSBNYXRoLmF0YW4yKHR4WzFdLCB0eFswXSk7CiAgICAgICAgdmFyIHN0eWxlID0gc3R5bGVzW2dlb20uZm9udE5hbWVdOwoKICAgICAgICBpZiAoc3R5bGUudmVydGljYWwpIHsKICAgICAgICAgIGFuZ2xlICs9IE1hdGguUEkgLyAyOwogICAgICAgIH0KCiAgICAgICAgdmFyIGZvbnRIZWlnaHQgPSBNYXRoLnNxcnQodHhbMl0gKiB0eFsyXSArIHR4WzNdICogdHhbM10pOwogICAgICAgIHZhciBmb250QXNjZW50ID0gZm9udEhlaWdodDsKCiAgICAgICAgaWYgKHN0eWxlLmFzY2VudCkgewogICAgICAgICAgZm9udEFzY2VudCA9IHN0eWxlLmFzY2VudCAqIGZvbnRBc2NlbnQ7CiAgICAgICAgfSBlbHNlIGlmIChzdHlsZS5kZXNjZW50KSB7CiAgICAgICAgICBmb250QXNjZW50ID0gKDEgKyBzdHlsZS5kZXNjZW50KSAqIGZvbnRBc2NlbnQ7CiAgICAgICAgfQoKICAgICAgICB2YXIgbGVmdCwgdG9wOwoKICAgICAgICBpZiAoYW5nbGUgPT09IDApIHsKICAgICAgICAgIGxlZnQgPSB0eFs0XTsKICAgICAgICAgIHRvcCA9IHR4WzVdIC0gZm9udEFzY2VudDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbGVmdCA9IHR4WzRdICsgZm9udEFzY2VudCAqIE1hdGguc2luKGFuZ2xlKTsKICAgICAgICAgIHRvcCA9IHR4WzVdIC0gZm9udEFzY2VudCAqIE1hdGguY29zKGFuZ2xlKTsKICAgICAgICB9CgogICAgICAgIHRleHREaXYuc3R5bGUubGVmdCA9ICIiLmNvbmNhdChsZWZ0LCAicHgiKTsKICAgICAgICB0ZXh0RGl2LnN0eWxlLnRvcCA9ICIiLmNvbmNhdCh0b3AsICJweCIpOwogICAgICAgIHRleHREaXYuc3R5bGUuZm9udFNpemUgPSAiIi5jb25jYXQoZm9udEhlaWdodCwgInB4Iik7CiAgICAgICAgdGV4dERpdi5zdHlsZS5mb250RmFtaWx5ID0gc3R5bGUuZm9udEZhbWlseTsKICAgICAgICB0ZXh0RGl2LnRleHRDb250ZW50ID0gZ2VvbS5zdHI7CgogICAgICAgIGlmICh0YXNrLl9mb250SW5zcGVjdG9yRW5hYmxlZCkgewogICAgICAgICAgdGV4dERpdi5kYXRhc2V0LmZvbnROYW1lID0gZ2VvbS5mb250TmFtZTsKICAgICAgICB9CgogICAgICAgIGlmIChhbmdsZSAhPT0gMCkgewogICAgICAgICAgdGV4dERpdlByb3BlcnRpZXMuYW5nbGUgPSBhbmdsZSAqICgxODAgLyBNYXRoLlBJKTsKICAgICAgICB9CgogICAgICAgIGlmIChnZW9tLnN0ci5sZW5ndGggPiAxKSB7CiAgICAgICAgICBpZiAoc3R5bGUudmVydGljYWwpIHsKICAgICAgICAgICAgdGV4dERpdlByb3BlcnRpZXMuY2FudmFzV2lkdGggPSBnZW9tLmhlaWdodCAqIHRhc2suX3ZpZXdwb3J0LnNjYWxlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGV4dERpdlByb3BlcnRpZXMuY2FudmFzV2lkdGggPSBnZW9tLndpZHRoICogdGFzay5fdmlld3BvcnQuc2NhbGU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0YXNrLl90ZXh0RGl2UHJvcGVydGllcy5zZXQodGV4dERpdiwgdGV4dERpdlByb3BlcnRpZXMpOwoKICAgICAgICBpZiAodGFzay5fdGV4dENvbnRlbnRTdHJlYW0pIHsKICAgICAgICAgIHRhc2suX2xheW91dFRleHQodGV4dERpdik7CiAgICAgICAgfQoKICAgICAgICBpZiAodGFzay5fZW5oYW5jZVRleHRTZWxlY3Rpb24pIHsKICAgICAgICAgIHZhciBhbmdsZUNvcyA9IDEsCiAgICAgICAgICAgIGFuZ2xlU2luID0gMDsKCiAgICAgICAgICBpZiAoYW5nbGUgIT09IDApIHsKICAgICAgICAgICAgYW5nbGVDb3MgPSBNYXRoLmNvcyhhbmdsZSk7CiAgICAgICAgICAgIGFuZ2xlU2luID0gTWF0aC5zaW4oYW5nbGUpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBkaXZXaWR0aCA9IChzdHlsZS52ZXJ0aWNhbCA/IGdlb20uaGVpZ2h0IDogZ2VvbS53aWR0aCkgKiB0YXNrLl92aWV3cG9ydC5zY2FsZTsKICAgICAgICAgIHZhciBkaXZIZWlnaHQgPSBmb250SGVpZ2h0OwogICAgICAgICAgdmFyIG0sIGI7CgogICAgICAgICAgaWYgKGFuZ2xlICE9PSAwKSB7CiAgICAgICAgICAgIG0gPSBbYW5nbGVDb3MsIGFuZ2xlU2luLCAtYW5nbGVTaW4sIGFuZ2xlQ29zLCBsZWZ0LCB0b3BdOwogICAgICAgICAgICBiID0gX3V0aWwuVXRpbC5nZXRBeGlhbEFsaWduZWRCb3VuZGluZ0JveChbMCwgMCwgZGl2V2lkdGgsIGRpdkhlaWdodF0sIG0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYiA9IFtsZWZ0LCB0b3AsIGxlZnQgKyBkaXZXaWR0aCwgdG9wICsgZGl2SGVpZ2h0XTsKICAgICAgICAgIH0KCiAgICAgICAgICB0YXNrLl9ib3VuZHMucHVzaCh7CiAgICAgICAgICAgIGxlZnQ6IGJbMF0sCiAgICAgICAgICAgIHRvcDogYlsxXSwKICAgICAgICAgICAgcmlnaHQ6IGJbMl0sCiAgICAgICAgICAgIGJvdHRvbTogYlszXSwKICAgICAgICAgICAgZGl2OiB0ZXh0RGl2LAogICAgICAgICAgICBzaXplOiBbZGl2V2lkdGgsIGRpdkhlaWdodF0sCiAgICAgICAgICAgIG06IG0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZnVuY3Rpb24gcmVuZGVyKHRhc2spIHsKICAgICAgICBpZiAodGFzay5fY2FuY2VsZWQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciB0ZXh0RGl2cyA9IHRhc2suX3RleHREaXZzOwogICAgICAgIHZhciBjYXBhYmlsaXR5ID0gdGFzay5fY2FwYWJpbGl0eTsKICAgICAgICB2YXIgdGV4dERpdnNMZW5ndGggPSB0ZXh0RGl2cy5sZW5ndGg7CgogICAgICAgIGlmICh0ZXh0RGl2c0xlbmd0aCA+IE1BWF9URVhUX0RJVlNfVE9fUkVOREVSKSB7CiAgICAgICAgICB0YXNrLl9yZW5kZXJpbmdEb25lID0gdHJ1ZTsKICAgICAgICAgIGNhcGFiaWxpdHkucmVzb2x2ZSgpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKCF0YXNrLl90ZXh0Q29udGVudFN0cmVhbSkgewogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0ZXh0RGl2c0xlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHRhc2suX2xheW91dFRleHQodGV4dERpdnNbaV0pOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGFzay5fcmVuZGVyaW5nRG9uZSA9IHRydWU7CiAgICAgICAgY2FwYWJpbGl0eS5yZXNvbHZlKCk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGV4cGFuZCh0YXNrKSB7CiAgICAgICAgdmFyIGJvdW5kcyA9IHRhc2suX2JvdW5kczsKICAgICAgICB2YXIgdmlld3BvcnQgPSB0YXNrLl92aWV3cG9ydDsKICAgICAgICB2YXIgZXhwYW5kZWQgPSBleHBhbmRCb3VuZHModmlld3BvcnQud2lkdGgsIHZpZXdwb3J0LmhlaWdodCwgYm91bmRzKTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBleHBhbmRlZC5sZW5ndGg7IGkrKykgewogICAgICAgICAgdmFyIGRpdiA9IGJvdW5kc1tpXS5kaXY7CgogICAgICAgICAgdmFyIGRpdlByb3BlcnRpZXMgPSB0YXNrLl90ZXh0RGl2UHJvcGVydGllcy5nZXQoZGl2KTsKCiAgICAgICAgICBpZiAoZGl2UHJvcGVydGllcy5hbmdsZSA9PT0gMCkgewogICAgICAgICAgICBkaXZQcm9wZXJ0aWVzLnBhZGRpbmdMZWZ0ID0gYm91bmRzW2ldLmxlZnQgLSBleHBhbmRlZFtpXS5sZWZ0OwogICAgICAgICAgICBkaXZQcm9wZXJ0aWVzLnBhZGRpbmdUb3AgPSBib3VuZHNbaV0udG9wIC0gZXhwYW5kZWRbaV0udG9wOwogICAgICAgICAgICBkaXZQcm9wZXJ0aWVzLnBhZGRpbmdSaWdodCA9IGV4cGFuZGVkW2ldLnJpZ2h0IC0gYm91bmRzW2ldLnJpZ2h0OwogICAgICAgICAgICBkaXZQcm9wZXJ0aWVzLnBhZGRpbmdCb3R0b20gPSBleHBhbmRlZFtpXS5ib3R0b20gLSBib3VuZHNbaV0uYm90dG9tOwoKICAgICAgICAgICAgdGFzay5fdGV4dERpdlByb3BlcnRpZXMuc2V0KGRpdiwgZGl2UHJvcGVydGllcyk7CgogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZSA9IGV4cGFuZGVkW2ldLAogICAgICAgICAgICBiID0gYm91bmRzW2ldOwogICAgICAgICAgdmFyIG0gPSBiLm0sCiAgICAgICAgICAgIGMgPSBtWzBdLAogICAgICAgICAgICBzID0gbVsxXTsKICAgICAgICAgIHZhciBwb2ludHMgPSBbWzAsIDBdLCBbMCwgYi5zaXplWzFdXSwgW2Iuc2l6ZVswXSwgMF0sIGIuc2l6ZV07CiAgICAgICAgICB2YXIgdHMgPSBuZXcgRmxvYXQ2NEFycmF5KDY0KTsKICAgICAgICAgIHBvaW50cy5mb3JFYWNoKGZ1bmN0aW9uIChwLCBpKSB7CiAgICAgICAgICAgIHZhciB0ID0gX3V0aWwuVXRpbC5hcHBseVRyYW5zZm9ybShwLCBtKTsKCiAgICAgICAgICAgIHRzW2kgKyAwXSA9IGMgJiYgKGUubGVmdCAtIHRbMF0pIC8gYzsKICAgICAgICAgICAgdHNbaSArIDRdID0gcyAmJiAoZS50b3AgLSB0WzFdKSAvIHM7CiAgICAgICAgICAgIHRzW2kgKyA4XSA9IGMgJiYgKGUucmlnaHQgLSB0WzBdKSAvIGM7CiAgICAgICAgICAgIHRzW2kgKyAxMl0gPSBzICYmIChlLmJvdHRvbSAtIHRbMV0pIC8gczsKICAgICAgICAgICAgdHNbaSArIDE2XSA9IHMgJiYgKGUubGVmdCAtIHRbMF0pIC8gLXM7CiAgICAgICAgICAgIHRzW2kgKyAyMF0gPSBjICYmIChlLnRvcCAtIHRbMV0pIC8gYzsKICAgICAgICAgICAgdHNbaSArIDI0XSA9IHMgJiYgKGUucmlnaHQgLSB0WzBdKSAvIC1zOwogICAgICAgICAgICB0c1tpICsgMjhdID0gYyAmJiAoZS5ib3R0b20gLSB0WzFdKSAvIGM7CiAgICAgICAgICAgIHRzW2kgKyAzMl0gPSBjICYmIChlLmxlZnQgLSB0WzBdKSAvIC1jOwogICAgICAgICAgICB0c1tpICsgMzZdID0gcyAmJiAoZS50b3AgLSB0WzFdKSAvIC1zOwogICAgICAgICAgICB0c1tpICsgNDBdID0gYyAmJiAoZS5yaWdodCAtIHRbMF0pIC8gLWM7CiAgICAgICAgICAgIHRzW2kgKyA0NF0gPSBzICYmIChlLmJvdHRvbSAtIHRbMV0pIC8gLXM7CiAgICAgICAgICAgIHRzW2kgKyA0OF0gPSBzICYmIChlLmxlZnQgLSB0WzBdKSAvIHM7CiAgICAgICAgICAgIHRzW2kgKyA1Ml0gPSBjICYmIChlLnRvcCAtIHRbMV0pIC8gLWM7CiAgICAgICAgICAgIHRzW2kgKyA1Nl0gPSBzICYmIChlLnJpZ2h0IC0gdFswXSkgLyBzOwogICAgICAgICAgICB0c1tpICsgNjBdID0gYyAmJiAoZS5ib3R0b20gLSB0WzFdKSAvIC1jOwogICAgICAgICAgfSk7CgogICAgICAgICAgdmFyIGZpbmRQb3NpdGl2ZU1pbiA9IGZ1bmN0aW9uIGZpbmRQb3NpdGl2ZU1pbih0cywgb2Zmc2V0LCBjb3VudCkgewogICAgICAgICAgICB2YXIgcmVzdWx0ID0gMDsKCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY291bnQ7IGkrKykgewogICAgICAgICAgICAgIHZhciB0ID0gdHNbb2Zmc2V0KytdOwoKICAgICAgICAgICAgICBpZiAodCA+IDApIHsKICAgICAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdCA/IE1hdGgubWluKHQsIHJlc3VsdCkgOiB0OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgIH07CgogICAgICAgICAgdmFyIGJveFNjYWxlID0gMSArIE1hdGgubWluKE1hdGguYWJzKGMpLCBNYXRoLmFicyhzKSk7CiAgICAgICAgICBkaXZQcm9wZXJ0aWVzLnBhZGRpbmdMZWZ0ID0gZmluZFBvc2l0aXZlTWluKHRzLCAzMiwgMTYpIC8gYm94U2NhbGU7CiAgICAgICAgICBkaXZQcm9wZXJ0aWVzLnBhZGRpbmdUb3AgPSBmaW5kUG9zaXRpdmVNaW4odHMsIDQ4LCAxNikgLyBib3hTY2FsZTsKICAgICAgICAgIGRpdlByb3BlcnRpZXMucGFkZGluZ1JpZ2h0ID0gZmluZFBvc2l0aXZlTWluKHRzLCAwLCAxNikgLyBib3hTY2FsZTsKICAgICAgICAgIGRpdlByb3BlcnRpZXMucGFkZGluZ0JvdHRvbSA9IGZpbmRQb3NpdGl2ZU1pbih0cywgMTYsIDE2KSAvIGJveFNjYWxlOwoKICAgICAgICAgIHRhc2suX3RleHREaXZQcm9wZXJ0aWVzLnNldChkaXYsIGRpdlByb3BlcnRpZXMpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZnVuY3Rpb24gZXhwYW5kQm91bmRzKHdpZHRoLCBoZWlnaHQsIGJveGVzKSB7CiAgICAgICAgdmFyIGJvdW5kcyA9IGJveGVzLm1hcChmdW5jdGlvbiAoYm94LCBpKSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICB4MTogYm94LmxlZnQsCiAgICAgICAgICAgIHkxOiBib3gudG9wLAogICAgICAgICAgICB4MjogYm94LnJpZ2h0LAogICAgICAgICAgICB5MjogYm94LmJvdHRvbSwKICAgICAgICAgICAgaW5kZXg6IGksCiAgICAgICAgICAgIHgxTmV3OiB1bmRlZmluZWQsCiAgICAgICAgICAgIHgyTmV3OiB1bmRlZmluZWQKICAgICAgICAgIH07CiAgICAgICAgfSk7CiAgICAgICAgZXhwYW5kQm91bmRzTFRSKHdpZHRoLCBib3VuZHMpOwogICAgICAgIHZhciBleHBhbmRlZCA9IG5ldyBBcnJheShib3hlcy5sZW5ndGgpOwogICAgICAgIGJvdW5kcy5mb3JFYWNoKGZ1bmN0aW9uIChiKSB7CiAgICAgICAgICB2YXIgaSA9IGIuaW5kZXg7CiAgICAgICAgICBleHBhbmRlZFtpXSA9IHsKICAgICAgICAgICAgbGVmdDogYi54MU5ldywKICAgICAgICAgICAgdG9wOiAwLAogICAgICAgICAgICByaWdodDogYi54Mk5ldywKICAgICAgICAgICAgYm90dG9tOiAwCiAgICAgICAgICB9OwogICAgICAgIH0pOwogICAgICAgIGJveGVzLm1hcChmdW5jdGlvbiAoYm94LCBpKSB7CiAgICAgICAgICB2YXIgZSA9IGV4cGFuZGVkW2ldLAogICAgICAgICAgICBiID0gYm91bmRzW2ldOwogICAgICAgICAgYi54MSA9IGJveC50b3A7CiAgICAgICAgICBiLnkxID0gd2lkdGggLSBlLnJpZ2h0OwogICAgICAgICAgYi54MiA9IGJveC5ib3R0b207CiAgICAgICAgICBiLnkyID0gd2lkdGggLSBlLmxlZnQ7CiAgICAgICAgICBiLmluZGV4ID0gaTsKICAgICAgICAgIGIueDFOZXcgPSB1bmRlZmluZWQ7CiAgICAgICAgICBiLngyTmV3ID0gdW5kZWZpbmVkOwogICAgICAgIH0pOwogICAgICAgIGV4cGFuZEJvdW5kc0xUUihoZWlnaHQsIGJvdW5kcyk7CiAgICAgICAgYm91bmRzLmZvckVhY2goZnVuY3Rpb24gKGIpIHsKICAgICAgICAgIHZhciBpID0gYi5pbmRleDsKICAgICAgICAgIGV4cGFuZGVkW2ldLnRvcCA9IGIueDFOZXc7CiAgICAgICAgICBleHBhbmRlZFtpXS5ib3R0b20gPSBiLngyTmV3OwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBleHBhbmRlZDsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZXhwYW5kQm91bmRzTFRSKHdpZHRoLCBib3VuZHMpIHsKICAgICAgICBib3VuZHMuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgcmV0dXJuIGEueDEgLSBiLngxIHx8IGEuaW5kZXggLSBiLmluZGV4OwogICAgICAgIH0pOwogICAgICAgIHZhciBmYWtlQm91bmRhcnkgPSB7CiAgICAgICAgICB4MTogLUluZmluaXR5LAogICAgICAgICAgeTE6IC1JbmZpbml0eSwKICAgICAgICAgIHgyOiAwLAogICAgICAgICAgeTI6IEluZmluaXR5LAogICAgICAgICAgaW5kZXg6IC0xLAogICAgICAgICAgeDFOZXc6IDAsCiAgICAgICAgICB4Mk5ldzogMAogICAgICAgIH07CiAgICAgICAgdmFyIGhvcml6b24gPSBbewogICAgICAgICAgc3RhcnQ6IC1JbmZpbml0eSwKICAgICAgICAgIGVuZDogSW5maW5pdHksCiAgICAgICAgICBib3VuZGFyeTogZmFrZUJvdW5kYXJ5CiAgICAgICAgfV07CiAgICAgICAgYm91bmRzLmZvckVhY2goZnVuY3Rpb24gKGJvdW5kYXJ5KSB7CiAgICAgICAgICB2YXIgaSA9IDA7CgogICAgICAgICAgd2hpbGUgKGkgPCBob3Jpem9uLmxlbmd0aCAmJiBob3Jpem9uW2ldLmVuZCA8PSBib3VuZGFyeS55MSkgewogICAgICAgICAgICBpKys7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGogPSBob3Jpem9uLmxlbmd0aCAtIDE7CgogICAgICAgICAgd2hpbGUgKGogPj0gMCAmJiBob3Jpem9uW2pdLnN0YXJ0ID49IGJvdW5kYXJ5LnkyKSB7CiAgICAgICAgICAgIGotLTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgaG9yaXpvblBhcnQsIGFmZmVjdGVkQm91bmRhcnk7CiAgICAgICAgICB2YXIgcSwKICAgICAgICAgICAgaywKICAgICAgICAgICAgbWF4WE5ldyA9IC1JbmZpbml0eTsKCiAgICAgICAgICBmb3IgKHEgPSBpOyBxIDw9IGo7IHErKykgewogICAgICAgICAgICBob3Jpem9uUGFydCA9IGhvcml6b25bcV07CiAgICAgICAgICAgIGFmZmVjdGVkQm91bmRhcnkgPSBob3Jpem9uUGFydC5ib3VuZGFyeTsKICAgICAgICAgICAgdmFyIHhOZXc7CgogICAgICAgICAgICBpZiAoYWZmZWN0ZWRCb3VuZGFyeS54MiA+IGJvdW5kYXJ5LngxKSB7CiAgICAgICAgICAgICAgeE5ldyA9IGFmZmVjdGVkQm91bmRhcnkuaW5kZXggPiBib3VuZGFyeS5pbmRleCA/IGFmZmVjdGVkQm91bmRhcnkueDFOZXcgOiBib3VuZGFyeS54MTsKICAgICAgICAgICAgfSBlbHNlIGlmIChhZmZlY3RlZEJvdW5kYXJ5LngyTmV3ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICB4TmV3ID0gKGFmZmVjdGVkQm91bmRhcnkueDIgKyBib3VuZGFyeS54MSkgLyAyOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHhOZXcgPSBhZmZlY3RlZEJvdW5kYXJ5LngyTmV3OwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoeE5ldyA+IG1heFhOZXcpIHsKICAgICAgICAgICAgICBtYXhYTmV3ID0geE5ldzsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGJvdW5kYXJ5LngxTmV3ID0gbWF4WE5ldzsKCiAgICAgICAgICBmb3IgKHEgPSBpOyBxIDw9IGo7IHErKykgewogICAgICAgICAgICBob3Jpem9uUGFydCA9IGhvcml6b25bcV07CiAgICAgICAgICAgIGFmZmVjdGVkQm91bmRhcnkgPSBob3Jpem9uUGFydC5ib3VuZGFyeTsKCiAgICAgICAgICAgIGlmIChhZmZlY3RlZEJvdW5kYXJ5LngyTmV3ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICBpZiAoYWZmZWN0ZWRCb3VuZGFyeS54MiA+IGJvdW5kYXJ5LngxKSB7CiAgICAgICAgICAgICAgICBpZiAoYWZmZWN0ZWRCb3VuZGFyeS5pbmRleCA+IGJvdW5kYXJ5LmluZGV4KSB7CiAgICAgICAgICAgICAgICAgIGFmZmVjdGVkQm91bmRhcnkueDJOZXcgPSBhZmZlY3RlZEJvdW5kYXJ5LngyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBhZmZlY3RlZEJvdW5kYXJ5LngyTmV3ID0gbWF4WE5ldzsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWZmZWN0ZWRCb3VuZGFyeS54Mk5ldyA+IG1heFhOZXcpIHsKICAgICAgICAgICAgICBhZmZlY3RlZEJvdW5kYXJ5LngyTmV3ID0gTWF0aC5tYXgobWF4WE5ldywgYWZmZWN0ZWRCb3VuZGFyeS54Mik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgY2hhbmdlZEhvcml6b24gPSBbXSwKICAgICAgICAgICAgbGFzdEJvdW5kYXJ5ID0gbnVsbDsKCiAgICAgICAgICBmb3IgKHEgPSBpOyBxIDw9IGo7IHErKykgewogICAgICAgICAgICBob3Jpem9uUGFydCA9IGhvcml6b25bcV07CiAgICAgICAgICAgIGFmZmVjdGVkQm91bmRhcnkgPSBob3Jpem9uUGFydC5ib3VuZGFyeTsKICAgICAgICAgICAgdmFyIHVzZUJvdW5kYXJ5ID0gYWZmZWN0ZWRCb3VuZGFyeS54MiA+IGJvdW5kYXJ5LngyID8gYWZmZWN0ZWRCb3VuZGFyeSA6IGJvdW5kYXJ5OwoKICAgICAgICAgICAgaWYgKGxhc3RCb3VuZGFyeSA9PT0gdXNlQm91bmRhcnkpIHsKICAgICAgICAgICAgICBjaGFuZ2VkSG9yaXpvbltjaGFuZ2VkSG9yaXpvbi5sZW5ndGggLSAxXS5lbmQgPSBob3Jpem9uUGFydC5lbmQ7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgY2hhbmdlZEhvcml6b24ucHVzaCh7CiAgICAgICAgICAgICAgICBzdGFydDogaG9yaXpvblBhcnQuc3RhcnQsCiAgICAgICAgICAgICAgICBlbmQ6IGhvcml6b25QYXJ0LmVuZCwKICAgICAgICAgICAgICAgIGJvdW5kYXJ5OiB1c2VCb3VuZGFyeQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGxhc3RCb3VuZGFyeSA9IHVzZUJvdW5kYXJ5OwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGhvcml6b25baV0uc3RhcnQgPCBib3VuZGFyeS55MSkgewogICAgICAgICAgICBjaGFuZ2VkSG9yaXpvblswXS5zdGFydCA9IGJvdW5kYXJ5LnkxOwogICAgICAgICAgICBjaGFuZ2VkSG9yaXpvbi51bnNoaWZ0KHsKICAgICAgICAgICAgICBzdGFydDogaG9yaXpvbltpXS5zdGFydCwKICAgICAgICAgICAgICBlbmQ6IGJvdW5kYXJ5LnkxLAogICAgICAgICAgICAgIGJvdW5kYXJ5OiBob3Jpem9uW2ldLmJvdW5kYXJ5CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChib3VuZGFyeS55MiA8IGhvcml6b25bal0uZW5kKSB7CiAgICAgICAgICAgIGNoYW5nZWRIb3Jpem9uW2NoYW5nZWRIb3Jpem9uLmxlbmd0aCAtIDFdLmVuZCA9IGJvdW5kYXJ5LnkyOwogICAgICAgICAgICBjaGFuZ2VkSG9yaXpvbi5wdXNoKHsKICAgICAgICAgICAgICBzdGFydDogYm91bmRhcnkueTIsCiAgICAgICAgICAgICAgZW5kOiBob3Jpem9uW2pdLmVuZCwKICAgICAgICAgICAgICBib3VuZGFyeTogaG9yaXpvbltqXS5ib3VuZGFyeQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3IgKHEgPSBpOyBxIDw9IGo7IHErKykgewogICAgICAgICAgICBob3Jpem9uUGFydCA9IGhvcml6b25bcV07CiAgICAgICAgICAgIGFmZmVjdGVkQm91bmRhcnkgPSBob3Jpem9uUGFydC5ib3VuZGFyeTsKCiAgICAgICAgICAgIGlmIChhZmZlY3RlZEJvdW5kYXJ5LngyTmV3ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHVzZWQgPSBmYWxzZTsKCiAgICAgICAgICAgIGZvciAoayA9IGkgLSAxOyAhdXNlZCAmJiBrID49IDAgJiYgaG9yaXpvbltrXS5zdGFydCA+PSBhZmZlY3RlZEJvdW5kYXJ5LnkxOyBrLS0pIHsKICAgICAgICAgICAgICB1c2VkID0gaG9yaXpvbltrXS5ib3VuZGFyeSA9PT0gYWZmZWN0ZWRCb3VuZGFyeTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9yIChrID0gaiArIDE7ICF1c2VkICYmIGsgPCBob3Jpem9uLmxlbmd0aCAmJiBob3Jpem9uW2tdLmVuZCA8PSBhZmZlY3RlZEJvdW5kYXJ5LnkyOyBrKyspIHsKICAgICAgICAgICAgICB1c2VkID0gaG9yaXpvbltrXS5ib3VuZGFyeSA9PT0gYWZmZWN0ZWRCb3VuZGFyeTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9yIChrID0gMDsgIXVzZWQgJiYgayA8IGNoYW5nZWRIb3Jpem9uLmxlbmd0aDsgaysrKSB7CiAgICAgICAgICAgICAgdXNlZCA9IGNoYW5nZWRIb3Jpem9uW2tdLmJvdW5kYXJ5ID09PSBhZmZlY3RlZEJvdW5kYXJ5OwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIXVzZWQpIHsKICAgICAgICAgICAgICBhZmZlY3RlZEJvdW5kYXJ5LngyTmV3ID0gbWF4WE5ldzsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5zcGxpY2UuYXBwbHkoaG9yaXpvbiwgW2ksIGogLSBpICsgMV0uY29uY2F0KGNoYW5nZWRIb3Jpem9uKSk7CiAgICAgICAgfSk7CiAgICAgICAgaG9yaXpvbi5mb3JFYWNoKGZ1bmN0aW9uIChob3Jpem9uUGFydCkgewogICAgICAgICAgdmFyIGFmZmVjdGVkQm91bmRhcnkgPSBob3Jpem9uUGFydC5ib3VuZGFyeTsKCiAgICAgICAgICBpZiAoYWZmZWN0ZWRCb3VuZGFyeS54Mk5ldyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGFmZmVjdGVkQm91bmRhcnkueDJOZXcgPSBNYXRoLm1heCh3aWR0aCwgYWZmZWN0ZWRCb3VuZGFyeS54Mik7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIFRleHRMYXllclJlbmRlclRhc2soX3JlZikgewogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAgIHZhciB0ZXh0Q29udGVudCA9IF9yZWYudGV4dENvbnRlbnQsCiAgICAgICAgICB0ZXh0Q29udGVudFN0cmVhbSA9IF9yZWYudGV4dENvbnRlbnRTdHJlYW0sCiAgICAgICAgICBjb250YWluZXIgPSBfcmVmLmNvbnRhaW5lciwKICAgICAgICAgIHZpZXdwb3J0ID0gX3JlZi52aWV3cG9ydCwKICAgICAgICAgIHRleHREaXZzID0gX3JlZi50ZXh0RGl2cywKICAgICAgICAgIHRleHRDb250ZW50SXRlbXNTdHIgPSBfcmVmLnRleHRDb250ZW50SXRlbXNTdHIsCiAgICAgICAgICBlbmhhbmNlVGV4dFNlbGVjdGlvbiA9IF9yZWYuZW5oYW5jZVRleHRTZWxlY3Rpb247CiAgICAgICAgdGhpcy5fdGV4dENvbnRlbnQgPSB0ZXh0Q29udGVudDsKICAgICAgICB0aGlzLl90ZXh0Q29udGVudFN0cmVhbSA9IHRleHRDb250ZW50U3RyZWFtOwogICAgICAgIHRoaXMuX2NvbnRhaW5lciA9IGNvbnRhaW5lcjsKICAgICAgICB0aGlzLl92aWV3cG9ydCA9IHZpZXdwb3J0OwogICAgICAgIHRoaXMuX3RleHREaXZzID0gdGV4dERpdnMgfHwgW107CiAgICAgICAgdGhpcy5fdGV4dENvbnRlbnRJdGVtc1N0ciA9IHRleHRDb250ZW50SXRlbXNTdHIgfHwgW107CiAgICAgICAgdGhpcy5fZW5oYW5jZVRleHRTZWxlY3Rpb24gPSAhIWVuaGFuY2VUZXh0U2VsZWN0aW9uOwogICAgICAgIHRoaXMuX2ZvbnRJbnNwZWN0b3JFbmFibGVkID0gISEoZ2xvYmFsVGhpcy5Gb250SW5zcGVjdG9yICYmIGdsb2JhbFRoaXMuRm9udEluc3BlY3Rvci5lbmFibGVkKTsKICAgICAgICB0aGlzLl9yZWFkZXIgPSBudWxsOwogICAgICAgIHRoaXMuX2xheW91dFRleHRMYXN0Rm9udFNpemUgPSBudWxsOwogICAgICAgIHRoaXMuX2xheW91dFRleHRMYXN0Rm9udEZhbWlseSA9IG51bGw7CiAgICAgICAgdGhpcy5fbGF5b3V0VGV4dEN0eCA9IG51bGw7CiAgICAgICAgdGhpcy5fdGV4dERpdlByb3BlcnRpZXMgPSBuZXcgV2Vha01hcCgpOwogICAgICAgIHRoaXMuX3JlbmRlcmluZ0RvbmUgPSBmYWxzZTsKICAgICAgICB0aGlzLl9jYW5jZWxlZCA9IGZhbHNlOwogICAgICAgIHRoaXMuX2NhcGFiaWxpdHkgPSAoMCwgX3V0aWwuY3JlYXRlUHJvbWlzZUNhcGFiaWxpdHkpKCk7CiAgICAgICAgdGhpcy5fcmVuZGVyVGltZXIgPSBudWxsOwogICAgICAgIHRoaXMuX2JvdW5kcyA9IFtdOwoKICAgICAgICB0aGlzLl9jYXBhYmlsaXR5LnByb21pc2VbImZpbmFsbHkiXShmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAoX3RoaXMuX2xheW91dFRleHRDdHgpIHsKICAgICAgICAgICAgX3RoaXMuX2xheW91dFRleHRDdHguY2FudmFzLndpZHRoID0gMDsKICAgICAgICAgICAgX3RoaXMuX2xheW91dFRleHRDdHguY2FudmFzLmhlaWdodCA9IDA7CiAgICAgICAgICAgIF90aGlzLl9sYXlvdXRUZXh0Q3R4ID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoKSB7fSk7CiAgICAgIH0KCiAgICAgIFRleHRMYXllclJlbmRlclRhc2sucHJvdG90eXBlID0gewogICAgICAgIGdldCBwcm9taXNlKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX2NhcGFiaWxpdHkucHJvbWlzZTsKICAgICAgICB9LAoKICAgICAgICBjYW5jZWw6IGZ1bmN0aW9uIFRleHRMYXllcl9jYW5jZWwoKSB7CiAgICAgICAgICB0aGlzLl9jYW5jZWxlZCA9IHRydWU7CgogICAgICAgICAgaWYgKHRoaXMuX3JlYWRlcikgewogICAgICAgICAgICB0aGlzLl9yZWFkZXIuY2FuY2VsKG5ldyBfdXRpbC5BYm9ydEV4Y2VwdGlvbigiVGV4dExheWVyIHRhc2sgY2FuY2VsbGVkLiIpKTsKCiAgICAgICAgICAgIHRoaXMuX3JlYWRlciA9IG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRoaXMuX3JlbmRlclRpbWVyICE9PSBudWxsKSB7CiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLl9yZW5kZXJUaW1lcik7CiAgICAgICAgICAgIHRoaXMuX3JlbmRlclRpbWVyID0gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLl9jYXBhYmlsaXR5LnJlamVjdChuZXcgRXJyb3IoIlRleHRMYXllciB0YXNrIGNhbmNlbGxlZC4iKSk7CiAgICAgICAgfSwKICAgICAgICBfcHJvY2Vzc0l0ZW1zOiBmdW5jdGlvbiBfcHJvY2Vzc0l0ZW1zKGl0ZW1zLCBzdHlsZUNhY2hlKSB7CiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gaXRlbXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgdGhpcy5fdGV4dENvbnRlbnRJdGVtc1N0ci5wdXNoKGl0ZW1zW2ldLnN0cik7CgogICAgICAgICAgICBhcHBlbmRUZXh0KHRoaXMsIGl0ZW1zW2ldLCBzdHlsZUNhY2hlKTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIF9sYXlvdXRUZXh0OiBmdW5jdGlvbiBfbGF5b3V0VGV4dCh0ZXh0RGl2KSB7CiAgICAgICAgICB2YXIgdGV4dERpdlByb3BlcnRpZXMgPSB0aGlzLl90ZXh0RGl2UHJvcGVydGllcy5nZXQodGV4dERpdik7CgogICAgICAgICAgaWYgKHRleHREaXZQcm9wZXJ0aWVzLmlzV2hpdGVzcGFjZSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHRyYW5zZm9ybSA9ICIiOwoKICAgICAgICAgIGlmICh0ZXh0RGl2UHJvcGVydGllcy5jYW52YXNXaWR0aCAhPT0gMCkgewogICAgICAgICAgICB2YXIgX3RleHREaXYkc3R5bGUgPSB0ZXh0RGl2LnN0eWxlLAogICAgICAgICAgICAgIGZvbnRTaXplID0gX3RleHREaXYkc3R5bGUuZm9udFNpemUsCiAgICAgICAgICAgICAgZm9udEZhbWlseSA9IF90ZXh0RGl2JHN0eWxlLmZvbnRGYW1pbHk7CgogICAgICAgICAgICBpZiAoZm9udFNpemUgIT09IHRoaXMuX2xheW91dFRleHRMYXN0Rm9udFNpemUgfHwgZm9udEZhbWlseSAhPT0gdGhpcy5fbGF5b3V0VGV4dExhc3RGb250RmFtaWx5KSB7CiAgICAgICAgICAgICAgdGhpcy5fbGF5b3V0VGV4dEN0eC5mb250ID0gIiIuY29uY2F0KGZvbnRTaXplLCAiICIpLmNvbmNhdChmb250RmFtaWx5KTsKICAgICAgICAgICAgICB0aGlzLl9sYXlvdXRUZXh0TGFzdEZvbnRTaXplID0gZm9udFNpemU7CiAgICAgICAgICAgICAgdGhpcy5fbGF5b3V0VGV4dExhc3RGb250RmFtaWx5ID0gZm9udEZhbWlseTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIF90aGlzJF9sYXlvdXRUZXh0Q3R4JCA9IHRoaXMuX2xheW91dFRleHRDdHgubWVhc3VyZVRleHQodGV4dERpdi50ZXh0Q29udGVudCksCiAgICAgICAgICAgICAgd2lkdGggPSBfdGhpcyRfbGF5b3V0VGV4dEN0eCQud2lkdGg7CgogICAgICAgICAgICBpZiAod2lkdGggPiAwKSB7CiAgICAgICAgICAgICAgdGV4dERpdlByb3BlcnRpZXMuc2NhbGUgPSB0ZXh0RGl2UHJvcGVydGllcy5jYW52YXNXaWR0aCAvIHdpZHRoOwogICAgICAgICAgICAgIHRyYW5zZm9ybSA9ICJzY2FsZVgoIi5jb25jYXQodGV4dERpdlByb3BlcnRpZXMuc2NhbGUsICIpIik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodGV4dERpdlByb3BlcnRpZXMuYW5nbGUgIT09IDApIHsKICAgICAgICAgICAgdHJhbnNmb3JtID0gInJvdGF0ZSgiLmNvbmNhdCh0ZXh0RGl2UHJvcGVydGllcy5hbmdsZSwgImRlZykgIikuY29uY2F0KHRyYW5zZm9ybSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRyYW5zZm9ybS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9lbmhhbmNlVGV4dFNlbGVjdGlvbikgewogICAgICAgICAgICAgIHRleHREaXZQcm9wZXJ0aWVzLm9yaWdpbmFsVHJhbnNmb3JtID0gdHJhbnNmb3JtOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0ZXh0RGl2LnN0eWxlLnRyYW5zZm9ybSA9IHRyYW5zZm9ybTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLl90ZXh0RGl2UHJvcGVydGllcy5zZXQodGV4dERpdiwgdGV4dERpdlByb3BlcnRpZXMpOwoKICAgICAgICAgIHRoaXMuX2NvbnRhaW5lci5hcHBlbmRDaGlsZCh0ZXh0RGl2KTsKICAgICAgICB9LAogICAgICAgIF9yZW5kZXI6IGZ1bmN0aW9uIFRleHRMYXllcl9yZW5kZXIodGltZW91dCkgewogICAgICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICAgICAgdmFyIGNhcGFiaWxpdHkgPSAoMCwgX3V0aWwuY3JlYXRlUHJvbWlzZUNhcGFiaWxpdHkpKCk7CiAgICAgICAgICB2YXIgc3R5bGVDYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgICB2YXIgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiY2FudmFzIik7CiAgICAgICAgICBjYW52YXMubW96T3BhcXVlID0gdHJ1ZTsKICAgICAgICAgIHRoaXMuX2xheW91dFRleHRDdHggPSBjYW52YXMuZ2V0Q29udGV4dCgiMmQiLCB7CiAgICAgICAgICAgIGFscGhhOiBmYWxzZQogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKHRoaXMuX3RleHRDb250ZW50KSB7CiAgICAgICAgICAgIHZhciB0ZXh0SXRlbXMgPSB0aGlzLl90ZXh0Q29udGVudC5pdGVtczsKICAgICAgICAgICAgdmFyIHRleHRTdHlsZXMgPSB0aGlzLl90ZXh0Q29udGVudC5zdHlsZXM7CgogICAgICAgICAgICB0aGlzLl9wcm9jZXNzSXRlbXModGV4dEl0ZW1zLCB0ZXh0U3R5bGVzKTsKCiAgICAgICAgICAgIGNhcGFiaWxpdHkucmVzb2x2ZSgpOwogICAgICAgICAgfSBlbHNlIGlmICh0aGlzLl90ZXh0Q29udGVudFN0cmVhbSkgewogICAgICAgICAgICB2YXIgcHVtcCA9IGZ1bmN0aW9uIHB1bXAoKSB7CiAgICAgICAgICAgICAgX3RoaXMyLl9yZWFkZXIucmVhZCgpLnRoZW4oZnVuY3Rpb24gKF9yZWYyKSB7CiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBfcmVmMi52YWx1ZSwKICAgICAgICAgICAgICAgICAgZG9uZSA9IF9yZWYyLmRvbmU7CgogICAgICAgICAgICAgICAgaWYgKGRvbmUpIHsKICAgICAgICAgICAgICAgICAgY2FwYWJpbGl0eS5yZXNvbHZlKCk7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHN0eWxlQ2FjaGUsIHZhbHVlLnN0eWxlcyk7CgogICAgICAgICAgICAgICAgX3RoaXMyLl9wcm9jZXNzSXRlbXModmFsdWUuaXRlbXMsIHN0eWxlQ2FjaGUpOwoKICAgICAgICAgICAgICAgIHB1bXAoKTsKICAgICAgICAgICAgICB9LCBjYXBhYmlsaXR5LnJlamVjdCk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICB0aGlzLl9yZWFkZXIgPSB0aGlzLl90ZXh0Q29udGVudFN0cmVhbS5nZXRSZWFkZXIoKTsKICAgICAgICAgICAgcHVtcCgpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdOZWl0aGVyICJ0ZXh0Q29udGVudCIgbm9yICJ0ZXh0Q29udGVudFN0cmVhbSInICsgIiBwYXJhbWV0ZXJzIHNwZWNpZmllZC4iKTsKICAgICAgICAgIH0KCiAgICAgICAgICBjYXBhYmlsaXR5LnByb21pc2UudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHN0eWxlQ2FjaGUgPSBudWxsOwoKICAgICAgICAgICAgaWYgKCF0aW1lb3V0KSB7CiAgICAgICAgICAgICAgcmVuZGVyKF90aGlzMik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgX3RoaXMyLl9yZW5kZXJUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmVuZGVyKF90aGlzMik7CiAgICAgICAgICAgICAgICBfdGhpczIuX3JlbmRlclRpbWVyID0gbnVsbDsKICAgICAgICAgICAgICB9LCB0aW1lb3V0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwgdGhpcy5fY2FwYWJpbGl0eS5yZWplY3QpOwogICAgICAgIH0sCiAgICAgICAgZXhwYW5kVGV4dERpdnM6IGZ1bmN0aW9uIFRleHRMYXllcl9leHBhbmRUZXh0RGl2cyhleHBhbmREaXZzKSB7CiAgICAgICAgICBpZiAoIXRoaXMuX2VuaGFuY2VUZXh0U2VsZWN0aW9uIHx8ICF0aGlzLl9yZW5kZXJpbmdEb25lKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodGhpcy5fYm91bmRzICE9PSBudWxsKSB7CiAgICAgICAgICAgIGV4cGFuZCh0aGlzKTsKICAgICAgICAgICAgdGhpcy5fYm91bmRzID0gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgdHJhbnNmb3JtQnVmID0gW10sCiAgICAgICAgICAgIHBhZGRpbmdCdWYgPSBbXTsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSB0aGlzLl90ZXh0RGl2cy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgIHZhciBkaXYgPSB0aGlzLl90ZXh0RGl2c1tpXTsKCiAgICAgICAgICAgIHZhciBkaXZQcm9wcyA9IHRoaXMuX3RleHREaXZQcm9wZXJ0aWVzLmdldChkaXYpOwoKICAgICAgICAgICAgaWYgKGRpdlByb3BzLmlzV2hpdGVzcGFjZSkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZXhwYW5kRGl2cykgewogICAgICAgICAgICAgIHRyYW5zZm9ybUJ1Zi5sZW5ndGggPSAwOwogICAgICAgICAgICAgIHBhZGRpbmdCdWYubGVuZ3RoID0gMDsKCiAgICAgICAgICAgICAgaWYgKGRpdlByb3BzLm9yaWdpbmFsVHJhbnNmb3JtKSB7CiAgICAgICAgICAgICAgICB0cmFuc2Zvcm1CdWYucHVzaChkaXZQcm9wcy5vcmlnaW5hbFRyYW5zZm9ybSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoZGl2UHJvcHMucGFkZGluZ1RvcCA+IDApIHsKICAgICAgICAgICAgICAgIHBhZGRpbmdCdWYucHVzaCgiIi5jb25jYXQoZGl2UHJvcHMucGFkZGluZ1RvcCwgInB4IikpOwogICAgICAgICAgICAgICAgdHJhbnNmb3JtQnVmLnB1c2goInRyYW5zbGF0ZVkoIi5jb25jYXQoLWRpdlByb3BzLnBhZGRpbmdUb3AsICJweCkiKSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHBhZGRpbmdCdWYucHVzaCgwKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChkaXZQcm9wcy5wYWRkaW5nUmlnaHQgPiAwKSB7CiAgICAgICAgICAgICAgICBwYWRkaW5nQnVmLnB1c2goIiIuY29uY2F0KGRpdlByb3BzLnBhZGRpbmdSaWdodCAvIGRpdlByb3BzLnNjYWxlLCAicHgiKSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHBhZGRpbmdCdWYucHVzaCgwKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChkaXZQcm9wcy5wYWRkaW5nQm90dG9tID4gMCkgewogICAgICAgICAgICAgICAgcGFkZGluZ0J1Zi5wdXNoKCIiLmNvbmNhdChkaXZQcm9wcy5wYWRkaW5nQm90dG9tLCAicHgiKSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHBhZGRpbmdCdWYucHVzaCgwKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChkaXZQcm9wcy5wYWRkaW5nTGVmdCA+IDApIHsKICAgICAgICAgICAgICAgIHBhZGRpbmdCdWYucHVzaCgiIi5jb25jYXQoZGl2UHJvcHMucGFkZGluZ0xlZnQgLyBkaXZQcm9wcy5zY2FsZSwgInB4IikpOwogICAgICAgICAgICAgICAgdHJhbnNmb3JtQnVmLnB1c2goInRyYW5zbGF0ZVgoIi5jb25jYXQoLWRpdlByb3BzLnBhZGRpbmdMZWZ0IC8gZGl2UHJvcHMuc2NhbGUsICJweCkiKSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHBhZGRpbmdCdWYucHVzaCgwKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGRpdi5zdHlsZS5wYWRkaW5nID0gcGFkZGluZ0J1Zi5qb2luKCIgIik7CgogICAgICAgICAgICAgIGlmICh0cmFuc2Zvcm1CdWYubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBkaXYuc3R5bGUudHJhbnNmb3JtID0gdHJhbnNmb3JtQnVmLmpvaW4oIiAiKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZGl2LnN0eWxlLnBhZGRpbmcgPSBudWxsOwogICAgICAgICAgICAgIGRpdi5zdHlsZS50cmFuc2Zvcm0gPSBkaXZQcm9wcy5vcmlnaW5hbFRyYW5zZm9ybTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTsKCiAgICAgIGZ1bmN0aW9uIHJlbmRlclRleHRMYXllcihyZW5kZXJQYXJhbWV0ZXJzKSB7CiAgICAgICAgdmFyIHRhc2sgPSBuZXcgVGV4dExheWVyUmVuZGVyVGFzayh7CiAgICAgICAgICB0ZXh0Q29udGVudDogcmVuZGVyUGFyYW1ldGVycy50ZXh0Q29udGVudCwKICAgICAgICAgIHRleHRDb250ZW50U3RyZWFtOiByZW5kZXJQYXJhbWV0ZXJzLnRleHRDb250ZW50U3RyZWFtLAogICAgICAgICAgY29udGFpbmVyOiByZW5kZXJQYXJhbWV0ZXJzLmNvbnRhaW5lciwKICAgICAgICAgIHZpZXdwb3J0OiByZW5kZXJQYXJhbWV0ZXJzLnZpZXdwb3J0LAogICAgICAgICAgdGV4dERpdnM6IHJlbmRlclBhcmFtZXRlcnMudGV4dERpdnMsCiAgICAgICAgICB0ZXh0Q29udGVudEl0ZW1zU3RyOiByZW5kZXJQYXJhbWV0ZXJzLnRleHRDb250ZW50SXRlbXNTdHIsCiAgICAgICAgICBlbmhhbmNlVGV4dFNlbGVjdGlvbjogcmVuZGVyUGFyYW1ldGVycy5lbmhhbmNlVGV4dFNlbGVjdGlvbgogICAgICAgIH0pOwoKICAgICAgICB0YXNrLl9yZW5kZXIocmVuZGVyUGFyYW1ldGVycy50aW1lb3V0KTsKCiAgICAgICAgcmV0dXJuIHRhc2s7CiAgICAgIH0KCiAgICAgIHJldHVybiByZW5kZXJUZXh0TGF5ZXI7CiAgICB9KCk7CgogICAgZXhwb3J0cy5yZW5kZXJUZXh0TGF5ZXIgPSByZW5kZXJUZXh0TGF5ZXI7CgogICAgLyoqKi99KSwgKAogIC8qIDIwNiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCgogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICB2YWx1ZTogdHJ1ZQogICAgfSk7CiAgICBleHBvcnRzLkFubm90YXRpb25MYXllciA9IHZvaWQgMDsKCiAgICB2YXIgX2Rpc3BsYXlfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE5NCk7CgogICAgdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygxKTsKCiAgICBmdW5jdGlvbiBfZ2V0KHRhcmdldCwgcHJvcGVydHksIHJlY2VpdmVyKSB7aWYgKHR5cGVvZiBSZWZsZWN0ICE9PSAidW5kZWZpbmVkIiAmJiBSZWZsZWN0LmdldCkge19nZXQgPSBSZWZsZWN0LmdldDt9IGVsc2Uge19nZXQgPSBmdW5jdGlvbiBfZ2V0KHRhcmdldCwgcHJvcGVydHksIHJlY2VpdmVyKSB7dmFyIGJhc2UgPSBfc3VwZXJQcm9wQmFzZSh0YXJnZXQsIHByb3BlcnR5KTtpZiAoIWJhc2UpIHJldHVybjt2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoYmFzZSwgcHJvcGVydHkpO2lmIChkZXNjLmdldCkge3JldHVybiBkZXNjLmdldC5jYWxsKHJlY2VpdmVyKTt9cmV0dXJuIGRlc2MudmFsdWU7fTt9cmV0dXJuIF9nZXQodGFyZ2V0LCBwcm9wZXJ0eSwgcmVjZWl2ZXIgfHwgdGFyZ2V0KTt9CgogICAgZnVuY3Rpb24gX3N1cGVyUHJvcEJhc2Uob2JqZWN0LCBwcm9wZXJ0eSkge3doaWxlICghT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpKSB7b2JqZWN0ID0gX2dldFByb3RvdHlwZU9mKG9iamVjdCk7aWYgKG9iamVjdCA9PT0gbnVsbCkgYnJlYWs7fXJldHVybiBvYmplY3Q7fQoKICAgIGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mIjtpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAic3ltYm9sIikge190eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikge3JldHVybiB0eXBlb2Ygb2JqO307fSBlbHNlIHtfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHtyZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqO307fXJldHVybiBfdHlwZW9mKG9iaik7fQoKICAgIGZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHtpZiAoY2FsbCAmJiAoX3R5cGVvZihjYWxsKSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7cmV0dXJuIGNhbGw7fXJldHVybiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpO30KCiAgICBmdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHtpZiAoc2VsZiA9PT0gdm9pZCAwKSB7dGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTt9cmV0dXJuIHNlbGY7fQoKICAgIGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7X2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHtyZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pO307cmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTt9CgogICAgZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7aWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpO31zdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7aWYgKHN1cGVyQ2xhc3MpIF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7fQoKICAgIGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7X3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7by5fX3Byb3RvX18gPSBwO3JldHVybiBvO307cmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTt9CgogICAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3Rvcikge2lmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7fX0KCiAgICBmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7Zm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykge3ZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07ZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlO2Rlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTtpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTtPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7fX0KCiAgICBmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7aWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7aWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpO3JldHVybiBDb25zdHJ1Y3Rvcjt9CgogICAgdmFyIEFubm90YXRpb25FbGVtZW50RmFjdG9yeSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgIGZ1bmN0aW9uIEFubm90YXRpb25FbGVtZW50RmFjdG9yeSgpIHsKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQW5ub3RhdGlvbkVsZW1lbnRGYWN0b3J5KTsKICAgICAgfQoKICAgICAgX2NyZWF0ZUNsYXNzKEFubm90YXRpb25FbGVtZW50RmFjdG9yeSwgbnVsbCwgW3sKICAgICAgICBrZXk6ICJjcmVhdGUiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGUocGFyYW1ldGVycykgewogICAgICAgICAgdmFyIHN1YnR5cGUgPSBwYXJhbWV0ZXJzLmRhdGEuYW5ub3RhdGlvblR5cGU7CgogICAgICAgICAgc3dpdGNoIChzdWJ0eXBlKSB7CiAgICAgICAgICAgIGNhc2UgX3V0aWwuQW5ub3RhdGlvblR5cGUuTElOSzoKICAgICAgICAgICAgICByZXR1cm4gbmV3IExpbmtBbm5vdGF0aW9uRWxlbWVudChwYXJhbWV0ZXJzKTsKCiAgICAgICAgICAgIGNhc2UgX3V0aWwuQW5ub3RhdGlvblR5cGUuVEVYVDoKICAgICAgICAgICAgICByZXR1cm4gbmV3IFRleHRBbm5vdGF0aW9uRWxlbWVudChwYXJhbWV0ZXJzKTsKCiAgICAgICAgICAgIGNhc2UgX3V0aWwuQW5ub3RhdGlvblR5cGUuV0lER0VUOgogICAgICAgICAgICAgIHZhciBmaWVsZFR5cGUgPSBwYXJhbWV0ZXJzLmRhdGEuZmllbGRUeXBlOwoKICAgICAgICAgICAgICBzd2l0Y2ggKGZpZWxkVHlwZSkgewogICAgICAgICAgICAgICAgY2FzZSAiVHgiOgogICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFRleHRXaWRnZXRBbm5vdGF0aW9uRWxlbWVudChwYXJhbWV0ZXJzKTsKCiAgICAgICAgICAgICAgICBjYXNlICJCdG4iOgogICAgICAgICAgICAgICAgICBpZiAocGFyYW1ldGVycy5kYXRhLnJhZGlvQnV0dG9uKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSYWRpb0J1dHRvbldpZGdldEFubm90YXRpb25FbGVtZW50KHBhcmFtZXRlcnMpOwogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHBhcmFtZXRlcnMuZGF0YS5jaGVja0JveCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQ2hlY2tib3hXaWRnZXRBbm5vdGF0aW9uRWxlbWVudChwYXJhbWV0ZXJzKTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQdXNoQnV0dG9uV2lkZ2V0QW5ub3RhdGlvbkVsZW1lbnQocGFyYW1ldGVycyk7CgogICAgICAgICAgICAgICAgY2FzZSAiQ2giOgogICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IENob2ljZVdpZGdldEFubm90YXRpb25FbGVtZW50KHBhcmFtZXRlcnMpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBXaWRnZXRBbm5vdGF0aW9uRWxlbWVudChwYXJhbWV0ZXJzKTsKCiAgICAgICAgICAgIGNhc2UgX3V0aWwuQW5ub3RhdGlvblR5cGUuUE9QVVA6CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQb3B1cEFubm90YXRpb25FbGVtZW50KHBhcmFtZXRlcnMpOwoKICAgICAgICAgICAgY2FzZSBfdXRpbC5Bbm5vdGF0aW9uVHlwZS5GUkVFVEVYVDoKICAgICAgICAgICAgICByZXR1cm4gbmV3IEZyZWVUZXh0QW5ub3RhdGlvbkVsZW1lbnQocGFyYW1ldGVycyk7CgogICAgICAgICAgICBjYXNlIF91dGlsLkFubm90YXRpb25UeXBlLkxJTkU6CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBMaW5lQW5ub3RhdGlvbkVsZW1lbnQocGFyYW1ldGVycyk7CgogICAgICAgICAgICBjYXNlIF91dGlsLkFubm90YXRpb25UeXBlLlNRVUFSRToKICAgICAgICAgICAgICByZXR1cm4gbmV3IFNxdWFyZUFubm90YXRpb25FbGVtZW50KHBhcmFtZXRlcnMpOwoKICAgICAgICAgICAgY2FzZSBfdXRpbC5Bbm5vdGF0aW9uVHlwZS5DSVJDTEU6CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBDaXJjbGVBbm5vdGF0aW9uRWxlbWVudChwYXJhbWV0ZXJzKTsKCiAgICAgICAgICAgIGNhc2UgX3V0aWwuQW5ub3RhdGlvblR5cGUuUE9MWUxJTkU6CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQb2x5bGluZUFubm90YXRpb25FbGVtZW50KHBhcmFtZXRlcnMpOwoKICAgICAgICAgICAgY2FzZSBfdXRpbC5Bbm5vdGF0aW9uVHlwZS5DQVJFVDoKICAgICAgICAgICAgICByZXR1cm4gbmV3IENhcmV0QW5ub3RhdGlvbkVsZW1lbnQocGFyYW1ldGVycyk7CgogICAgICAgICAgICBjYXNlIF91dGlsLkFubm90YXRpb25UeXBlLklOSzoKICAgICAgICAgICAgICByZXR1cm4gbmV3IElua0Fubm90YXRpb25FbGVtZW50KHBhcmFtZXRlcnMpOwoKICAgICAgICAgICAgY2FzZSBfdXRpbC5Bbm5vdGF0aW9uVHlwZS5QT0xZR09OOgogICAgICAgICAgICAgIHJldHVybiBuZXcgUG9seWdvbkFubm90YXRpb25FbGVtZW50KHBhcmFtZXRlcnMpOwoKICAgICAgICAgICAgY2FzZSBfdXRpbC5Bbm5vdGF0aW9uVHlwZS5ISUdITElHSFQ6CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBIaWdobGlnaHRBbm5vdGF0aW9uRWxlbWVudChwYXJhbWV0ZXJzKTsKCiAgICAgICAgICAgIGNhc2UgX3V0aWwuQW5ub3RhdGlvblR5cGUuVU5ERVJMSU5FOgogICAgICAgICAgICAgIHJldHVybiBuZXcgVW5kZXJsaW5lQW5ub3RhdGlvbkVsZW1lbnQocGFyYW1ldGVycyk7CgogICAgICAgICAgICBjYXNlIF91dGlsLkFubm90YXRpb25UeXBlLlNRVUlHR0xZOgogICAgICAgICAgICAgIHJldHVybiBuZXcgU3F1aWdnbHlBbm5vdGF0aW9uRWxlbWVudChwYXJhbWV0ZXJzKTsKCiAgICAgICAgICAgIGNhc2UgX3V0aWwuQW5ub3RhdGlvblR5cGUuU1RSSUtFT1VUOgogICAgICAgICAgICAgIHJldHVybiBuZXcgU3RyaWtlT3V0QW5ub3RhdGlvbkVsZW1lbnQocGFyYW1ldGVycyk7CgogICAgICAgICAgICBjYXNlIF91dGlsLkFubm90YXRpb25UeXBlLlNUQU1QOgogICAgICAgICAgICAgIHJldHVybiBuZXcgU3RhbXBBbm5vdGF0aW9uRWxlbWVudChwYXJhbWV0ZXJzKTsKCiAgICAgICAgICAgIGNhc2UgX3V0aWwuQW5ub3RhdGlvblR5cGUuRklMRUFUVEFDSE1FTlQ6CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBGaWxlQXR0YWNobWVudEFubm90YXRpb25FbGVtZW50KHBhcmFtZXRlcnMpOwoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICByZXR1cm4gbmV3IEFubm90YXRpb25FbGVtZW50KHBhcmFtZXRlcnMpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIEFubm90YXRpb25FbGVtZW50RmFjdG9yeTsKICAgIH0oKTsKCiAgICB2YXIgQW5ub3RhdGlvbkVsZW1lbnQgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBBbm5vdGF0aW9uRWxlbWVudChwYXJhbWV0ZXJzKSB7CiAgICAgICAgdmFyIGlzUmVuZGVyYWJsZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CiAgICAgICAgdmFyIGlnbm9yZUJvcmRlciA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogZmFsc2U7CgogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBBbm5vdGF0aW9uRWxlbWVudCk7CgogICAgICAgIHRoaXMuaXNSZW5kZXJhYmxlID0gaXNSZW5kZXJhYmxlOwogICAgICAgIHRoaXMuZGF0YSA9IHBhcmFtZXRlcnMuZGF0YTsKICAgICAgICB0aGlzLmxheWVyID0gcGFyYW1ldGVycy5sYXllcjsKICAgICAgICB0aGlzLnBhZ2UgPSBwYXJhbWV0ZXJzLnBhZ2U7CiAgICAgICAgdGhpcy52aWV3cG9ydCA9IHBhcmFtZXRlcnMudmlld3BvcnQ7CiAgICAgICAgdGhpcy5saW5rU2VydmljZSA9IHBhcmFtZXRlcnMubGlua1NlcnZpY2U7CiAgICAgICAgdGhpcy5kb3dubG9hZE1hbmFnZXIgPSBwYXJhbWV0ZXJzLmRvd25sb2FkTWFuYWdlcjsKICAgICAgICB0aGlzLmltYWdlUmVzb3VyY2VzUGF0aCA9IHBhcmFtZXRlcnMuaW1hZ2VSZXNvdXJjZXNQYXRoOwogICAgICAgIHRoaXMucmVuZGVySW50ZXJhY3RpdmVGb3JtcyA9IHBhcmFtZXRlcnMucmVuZGVySW50ZXJhY3RpdmVGb3JtczsKICAgICAgICB0aGlzLnN2Z0ZhY3RvcnkgPSBwYXJhbWV0ZXJzLnN2Z0ZhY3Rvcnk7CgogICAgICAgIGlmIChpc1JlbmRlcmFibGUpIHsKICAgICAgICAgIHRoaXMuY29udGFpbmVyID0gdGhpcy5fY3JlYXRlQ29udGFpbmVyKGlnbm9yZUJvcmRlcik7CiAgICAgICAgfQogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoQW5ub3RhdGlvbkVsZW1lbnQsIFt7CiAgICAgICAga2V5OiAiX2NyZWF0ZUNvbnRhaW5lciIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9jcmVhdGVDb250YWluZXIoKSB7CiAgICAgICAgICB2YXIgaWdub3JlQm9yZGVyID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBmYWxzZTsKICAgICAgICAgIHZhciBkYXRhID0gdGhpcy5kYXRhLAogICAgICAgICAgICBwYWdlID0gdGhpcy5wYWdlLAogICAgICAgICAgICB2aWV3cG9ydCA9IHRoaXMudmlld3BvcnQ7CiAgICAgICAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2VjdGlvbiIpOwogICAgICAgICAgdmFyIHdpZHRoID0gZGF0YS5yZWN0WzJdIC0gZGF0YS5yZWN0WzBdOwogICAgICAgICAgdmFyIGhlaWdodCA9IGRhdGEucmVjdFszXSAtIGRhdGEucmVjdFsxXTsKICAgICAgICAgIGNvbnRhaW5lci5zZXRBdHRyaWJ1dGUoImRhdGEtYW5ub3RhdGlvbi1pZCIsIGRhdGEuaWQpOwoKICAgICAgICAgIHZhciByZWN0ID0gX3V0aWwuVXRpbC5ub3JtYWxpemVSZWN0KFtkYXRhLnJlY3RbMF0sIHBhZ2Uudmlld1szXSAtIGRhdGEucmVjdFsxXSArIHBhZ2Uudmlld1sxXSwgZGF0YS5yZWN0WzJdLCBwYWdlLnZpZXdbM10gLSBkYXRhLnJlY3RbM10gKyBwYWdlLnZpZXdbMV1dKTsKCiAgICAgICAgICBjb250YWluZXIuc3R5bGUudHJhbnNmb3JtID0gIm1hdHJpeCgiLmNvbmNhdCh2aWV3cG9ydC50cmFuc2Zvcm0uam9pbigiLCIpLCAiKSIpOwogICAgICAgICAgY29udGFpbmVyLnN0eWxlLnRyYW5zZm9ybU9yaWdpbiA9ICItIi5jb25jYXQocmVjdFswXSwgInB4IC0iKS5jb25jYXQocmVjdFsxXSwgInB4Iik7CgogICAgICAgICAgaWYgKCFpZ25vcmVCb3JkZXIgJiYgZGF0YS5ib3JkZXJTdHlsZS53aWR0aCA+IDApIHsKICAgICAgICAgICAgY29udGFpbmVyLnN0eWxlLmJvcmRlcldpZHRoID0gIiIuY29uY2F0KGRhdGEuYm9yZGVyU3R5bGUud2lkdGgsICJweCIpOwoKICAgICAgICAgICAgaWYgKGRhdGEuYm9yZGVyU3R5bGUuc3R5bGUgIT09IF91dGlsLkFubm90YXRpb25Cb3JkZXJTdHlsZVR5cGUuVU5ERVJMSU5FKSB7CiAgICAgICAgICAgICAgd2lkdGggPSB3aWR0aCAtIDIgKiBkYXRhLmJvcmRlclN0eWxlLndpZHRoOwogICAgICAgICAgICAgIGhlaWdodCA9IGhlaWdodCAtIDIgKiBkYXRhLmJvcmRlclN0eWxlLndpZHRoOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgaG9yaXpvbnRhbFJhZGl1cyA9IGRhdGEuYm9yZGVyU3R5bGUuaG9yaXpvbnRhbENvcm5lclJhZGl1czsKICAgICAgICAgICAgdmFyIHZlcnRpY2FsUmFkaXVzID0gZGF0YS5ib3JkZXJTdHlsZS52ZXJ0aWNhbENvcm5lclJhZGl1czsKCiAgICAgICAgICAgIGlmIChob3Jpem9udGFsUmFkaXVzID4gMCB8fCB2ZXJ0aWNhbFJhZGl1cyA+IDApIHsKICAgICAgICAgICAgICB2YXIgcmFkaXVzID0gIiIuY29uY2F0KGhvcml6b250YWxSYWRpdXMsICJweCAvICIpLmNvbmNhdCh2ZXJ0aWNhbFJhZGl1cywgInB4Iik7CiAgICAgICAgICAgICAgY29udGFpbmVyLnN0eWxlLmJvcmRlclJhZGl1cyA9IHJhZGl1czsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc3dpdGNoIChkYXRhLmJvcmRlclN0eWxlLnN0eWxlKSB7CiAgICAgICAgICAgICAgY2FzZSBfdXRpbC5Bbm5vdGF0aW9uQm9yZGVyU3R5bGVUeXBlLlNPTElEOgogICAgICAgICAgICAgICAgY29udGFpbmVyLnN0eWxlLmJvcmRlclN0eWxlID0gInNvbGlkIjsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIF91dGlsLkFubm90YXRpb25Cb3JkZXJTdHlsZVR5cGUuREFTSEVEOgogICAgICAgICAgICAgICAgY29udGFpbmVyLnN0eWxlLmJvcmRlclN0eWxlID0gImRhc2hlZCI7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSBfdXRpbC5Bbm5vdGF0aW9uQm9yZGVyU3R5bGVUeXBlLkJFVkVMRUQ6CiAgICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIlVuaW1wbGVtZW50ZWQgYm9yZGVyIHN0eWxlOiBiZXZlbGVkIik7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSBfdXRpbC5Bbm5vdGF0aW9uQm9yZGVyU3R5bGVUeXBlLklOU0VUOgogICAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJVbmltcGxlbWVudGVkIGJvcmRlciBzdHlsZTogaW5zZXQiKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIF91dGlsLkFubm90YXRpb25Cb3JkZXJTdHlsZVR5cGUuVU5ERVJMSU5FOgogICAgICAgICAgICAgICAgY29udGFpbmVyLnN0eWxlLmJvcmRlckJvdHRvbVN0eWxlID0gInNvbGlkIjsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChkYXRhLmNvbG9yKSB7CiAgICAgICAgICAgICAgY29udGFpbmVyLnN0eWxlLmJvcmRlckNvbG9yID0gX3V0aWwuVXRpbC5tYWtlQ3NzUmdiKGRhdGEuY29sb3JbMF0gfCAwLCBkYXRhLmNvbG9yWzFdIHwgMCwgZGF0YS5jb2xvclsyXSB8IDApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGNvbnRhaW5lci5zdHlsZS5ib3JkZXJXaWR0aCA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBjb250YWluZXIuc3R5bGUubGVmdCA9ICIiLmNvbmNhdChyZWN0WzBdLCAicHgiKTsKICAgICAgICAgIGNvbnRhaW5lci5zdHlsZS50b3AgPSAiIi5jb25jYXQocmVjdFsxXSwgInB4Iik7CiAgICAgICAgICBjb250YWluZXIuc3R5bGUud2lkdGggPSAiIi5jb25jYXQod2lkdGgsICJweCIpOwogICAgICAgICAgY29udGFpbmVyLnN0eWxlLmhlaWdodCA9ICIiLmNvbmNhdChoZWlnaHQsICJweCIpOwogICAgICAgICAgcmV0dXJuIGNvbnRhaW5lcjsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJfY3JlYXRlUG9wdXAiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfY3JlYXRlUG9wdXAoY29udGFpbmVyLCB0cmlnZ2VyLCBkYXRhKSB7CiAgICAgICAgICBpZiAoIXRyaWdnZXIpIHsKICAgICAgICAgICAgdHJpZ2dlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgICAgICB0cmlnZ2VyLnN0eWxlLmhlaWdodCA9IGNvbnRhaW5lci5zdHlsZS5oZWlnaHQ7CiAgICAgICAgICAgIHRyaWdnZXIuc3R5bGUud2lkdGggPSBjb250YWluZXIuc3R5bGUud2lkdGg7CiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0cmlnZ2VyKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcG9wdXBFbGVtZW50ID0gbmV3IFBvcHVwRWxlbWVudCh7CiAgICAgICAgICAgIGNvbnRhaW5lcjogY29udGFpbmVyLAogICAgICAgICAgICB0cmlnZ2VyOiB0cmlnZ2VyLAogICAgICAgICAgICBjb2xvcjogZGF0YS5jb2xvciwKICAgICAgICAgICAgdGl0bGU6IGRhdGEudGl0bGUsCiAgICAgICAgICAgIG1vZGlmaWNhdGlvbkRhdGU6IGRhdGEubW9kaWZpY2F0aW9uRGF0ZSwKICAgICAgICAgICAgY29udGVudHM6IGRhdGEuY29udGVudHMsCiAgICAgICAgICAgIGhpZGVXcmFwcGVyOiB0cnVlCiAgICAgICAgICB9KTsKICAgICAgICAgIHZhciBwb3B1cCA9IHBvcHVwRWxlbWVudC5yZW5kZXIoKTsKICAgICAgICAgIHBvcHVwLnN0eWxlLmxlZnQgPSBjb250YWluZXIuc3R5bGUud2lkdGg7CiAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQocG9wdXApOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInJlbmRlciIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgICAgICgwLCBfdXRpbC51bnJlYWNoYWJsZSkoIkFic3RyYWN0IG1ldGhvZCBgQW5ub3RhdGlvbkVsZW1lbnQucmVuZGVyYCBjYWxsZWQiKTsKICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBBbm5vdGF0aW9uRWxlbWVudDsKICAgIH0oKTsKCiAgICB2YXIgTGlua0Fubm90YXRpb25FbGVtZW50ID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQW5ub3RhdGlvbkVsZW1lbnQpIHsKICAgICAgX2luaGVyaXRzKExpbmtBbm5vdGF0aW9uRWxlbWVudCwgX0Fubm90YXRpb25FbGVtZW50KTsKCiAgICAgIGZ1bmN0aW9uIExpbmtBbm5vdGF0aW9uRWxlbWVudChwYXJhbWV0ZXJzKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIExpbmtBbm5vdGF0aW9uRWxlbWVudCk7CgogICAgICAgIHZhciBpc1JlbmRlcmFibGUgPSAhIShwYXJhbWV0ZXJzLmRhdGEudXJsIHx8IHBhcmFtZXRlcnMuZGF0YS5kZXN0IHx8IHBhcmFtZXRlcnMuZGF0YS5hY3Rpb24pOwogICAgICAgIHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoTGlua0Fubm90YXRpb25FbGVtZW50KS5jYWxsKHRoaXMsIHBhcmFtZXRlcnMsIGlzUmVuZGVyYWJsZSkpOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoTGlua0Fubm90YXRpb25FbGVtZW50LCBbewogICAgICAgIGtleTogInJlbmRlciIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTmFtZSA9ICJsaW5rQW5ub3RhdGlvbiI7CiAgICAgICAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YSwKICAgICAgICAgICAgbGlua1NlcnZpY2UgPSB0aGlzLmxpbmtTZXJ2aWNlOwogICAgICAgICAgdmFyIGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CgogICAgICAgICAgaWYgKGRhdGEudXJsKSB7CiAgICAgICAgICAgICgwLCBfZGlzcGxheV91dGlscy5hZGRMaW5rQXR0cmlidXRlcykobGluaywgewogICAgICAgICAgICAgIHVybDogZGF0YS51cmwsCiAgICAgICAgICAgICAgdGFyZ2V0OiBkYXRhLm5ld1dpbmRvdyA/IF9kaXNwbGF5X3V0aWxzLkxpbmtUYXJnZXQuQkxBTksgOiBsaW5rU2VydmljZS5leHRlcm5hbExpbmtUYXJnZXQsCiAgICAgICAgICAgICAgcmVsOiBsaW5rU2VydmljZS5leHRlcm5hbExpbmtSZWwsCiAgICAgICAgICAgICAgZW5hYmxlZDogbGlua1NlcnZpY2UuZXh0ZXJuYWxMaW5rRW5hYmxlZAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YS5hY3Rpb24pIHsKICAgICAgICAgICAgdGhpcy5fYmluZE5hbWVkQWN0aW9uKGxpbmssIGRhdGEuYWN0aW9uKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuX2JpbmRMaW5rKGxpbmssIGRhdGEuZGVzdCk7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQobGluayk7CiAgICAgICAgICByZXR1cm4gdGhpcy5jb250YWluZXI7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiX2JpbmRMaW5rIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX2JpbmRMaW5rKGxpbmssIGRlc3RpbmF0aW9uKSB7CiAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgICAgIGxpbmsuaHJlZiA9IHRoaXMubGlua1NlcnZpY2UuZ2V0RGVzdGluYXRpb25IYXNoKGRlc3RpbmF0aW9uKTsKCiAgICAgICAgICBsaW5rLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmIChkZXN0aW5hdGlvbikgewogICAgICAgICAgICAgIF90aGlzLmxpbmtTZXJ2aWNlLm5hdmlnYXRlVG8oZGVzdGluYXRpb24pOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9OwoKICAgICAgICAgIGlmIChkZXN0aW5hdGlvbikgewogICAgICAgICAgICBsaW5rLmNsYXNzTmFtZSA9ICJpbnRlcm5hbExpbmsiOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIl9iaW5kTmFtZWRBY3Rpb24iLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfYmluZE5hbWVkQWN0aW9uKGxpbmssIGFjdGlvbikgewogICAgICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICAgICAgbGluay5ocmVmID0gdGhpcy5saW5rU2VydmljZS5nZXRBbmNob3JVcmwoIiIpOwoKICAgICAgICAgIGxpbmsub25jbGljayA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3RoaXMyLmxpbmtTZXJ2aWNlLmV4ZWN1dGVOYW1lZEFjdGlvbihhY3Rpb24pOwoKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfTsKCiAgICAgICAgICBsaW5rLmNsYXNzTmFtZSA9ICJpbnRlcm5hbExpbmsiOwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIExpbmtBbm5vdGF0aW9uRWxlbWVudDsKICAgIH0oQW5ub3RhdGlvbkVsZW1lbnQpOwoKICAgIHZhciBUZXh0QW5ub3RhdGlvbkVsZW1lbnQgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9Bbm5vdGF0aW9uRWxlbWVudDIpIHsKICAgICAgX2luaGVyaXRzKFRleHRBbm5vdGF0aW9uRWxlbWVudCwgX0Fubm90YXRpb25FbGVtZW50Mik7CgogICAgICBmdW5jdGlvbiBUZXh0QW5ub3RhdGlvbkVsZW1lbnQocGFyYW1ldGVycykgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBUZXh0QW5ub3RhdGlvbkVsZW1lbnQpOwoKICAgICAgICB2YXIgaXNSZW5kZXJhYmxlID0gISEocGFyYW1ldGVycy5kYXRhLmhhc1BvcHVwIHx8IHBhcmFtZXRlcnMuZGF0YS50aXRsZSB8fCBwYXJhbWV0ZXJzLmRhdGEuY29udGVudHMpOwogICAgICAgIHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoVGV4dEFubm90YXRpb25FbGVtZW50KS5jYWxsKHRoaXMsIHBhcmFtZXRlcnMsIGlzUmVuZGVyYWJsZSkpOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoVGV4dEFubm90YXRpb25FbGVtZW50LCBbewogICAgICAgIGtleTogInJlbmRlciIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTmFtZSA9ICJ0ZXh0QW5ub3RhdGlvbiI7CiAgICAgICAgICB2YXIgaW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbWciKTsKICAgICAgICAgIGltYWdlLnN0eWxlLmhlaWdodCA9IHRoaXMuY29udGFpbmVyLnN0eWxlLmhlaWdodDsKICAgICAgICAgIGltYWdlLnN0eWxlLndpZHRoID0gdGhpcy5jb250YWluZXIuc3R5bGUud2lkdGg7CiAgICAgICAgICBpbWFnZS5zcmMgPSB0aGlzLmltYWdlUmVzb3VyY2VzUGF0aCArICJhbm5vdGF0aW9uLSIgKyB0aGlzLmRhdGEubmFtZS50b0xvd2VyQ2FzZSgpICsgIi5zdmciOwogICAgICAgICAgaW1hZ2UuYWx0ID0gIlt7e3R5cGV9fSBBbm5vdGF0aW9uXSI7CiAgICAgICAgICBpbWFnZS5kYXRhc2V0LmwxMG5JZCA9ICJ0ZXh0X2Fubm90YXRpb25fdHlwZSI7CiAgICAgICAgICBpbWFnZS5kYXRhc2V0LmwxMG5BcmdzID0gSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICB0eXBlOiB0aGlzLmRhdGEubmFtZQogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKCF0aGlzLmRhdGEuaGFzUG9wdXApIHsKICAgICAgICAgICAgdGhpcy5fY3JlYXRlUG9wdXAodGhpcy5jb250YWluZXIsIGltYWdlLCB0aGlzLmRhdGEpOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKGltYWdlKTsKICAgICAgICAgIHJldHVybiB0aGlzLmNvbnRhaW5lcjsKICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBUZXh0QW5ub3RhdGlvbkVsZW1lbnQ7CiAgICB9KEFubm90YXRpb25FbGVtZW50KTsKCiAgICB2YXIgV2lkZ2V0QW5ub3RhdGlvbkVsZW1lbnQgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9Bbm5vdGF0aW9uRWxlbWVudDMpIHsKICAgICAgX2luaGVyaXRzKFdpZGdldEFubm90YXRpb25FbGVtZW50LCBfQW5ub3RhdGlvbkVsZW1lbnQzKTsKCiAgICAgIGZ1bmN0aW9uIFdpZGdldEFubm90YXRpb25FbGVtZW50KCkgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBXaWRnZXRBbm5vdGF0aW9uRWxlbWVudCk7CgogICAgICAgIHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoV2lkZ2V0QW5ub3RhdGlvbkVsZW1lbnQpLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoV2lkZ2V0QW5ub3RhdGlvbkVsZW1lbnQsIFt7CiAgICAgICAga2V5OiAicmVuZGVyIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuY29udGFpbmVyOwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIFdpZGdldEFubm90YXRpb25FbGVtZW50OwogICAgfShBbm5vdGF0aW9uRWxlbWVudCk7CgogICAgdmFyIFRleHRXaWRnZXRBbm5vdGF0aW9uRWxlbWVudCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX1dpZGdldEFubm90YXRpb25FbGVtKSB7CiAgICAgIF9pbmhlcml0cyhUZXh0V2lkZ2V0QW5ub3RhdGlvbkVsZW1lbnQsIF9XaWRnZXRBbm5vdGF0aW9uRWxlbSk7CgogICAgICBmdW5jdGlvbiBUZXh0V2lkZ2V0QW5ub3RhdGlvbkVsZW1lbnQocGFyYW1ldGVycykgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBUZXh0V2lkZ2V0QW5ub3RhdGlvbkVsZW1lbnQpOwoKICAgICAgICB2YXIgaXNSZW5kZXJhYmxlID0gcGFyYW1ldGVycy5yZW5kZXJJbnRlcmFjdGl2ZUZvcm1zIHx8ICFwYXJhbWV0ZXJzLmRhdGEuaGFzQXBwZWFyYW5jZSAmJiAhIXBhcmFtZXRlcnMuZGF0YS5maWVsZFZhbHVlOwogICAgICAgIHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoVGV4dFdpZGdldEFubm90YXRpb25FbGVtZW50KS5jYWxsKHRoaXMsIHBhcmFtZXRlcnMsIGlzUmVuZGVyYWJsZSkpOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoVGV4dFdpZGdldEFubm90YXRpb25FbGVtZW50LCBbewogICAgICAgIGtleTogInJlbmRlciIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgICAgIHZhciBURVhUX0FMSUdOTUVOVCA9IFsibGVmdCIsICJjZW50ZXIiLCAicmlnaHQiXTsKICAgICAgICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTmFtZSA9ICJ0ZXh0V2lkZ2V0QW5ub3RhdGlvbiI7CiAgICAgICAgICB2YXIgZWxlbWVudCA9IG51bGw7CgogICAgICAgICAgaWYgKHRoaXMucmVuZGVySW50ZXJhY3RpdmVGb3JtcykgewogICAgICAgICAgICBpZiAodGhpcy5kYXRhLm11bHRpTGluZSkgewogICAgICAgICAgICAgIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZXh0YXJlYSIpOwogICAgICAgICAgICAgIGVsZW1lbnQudGV4dENvbnRlbnQgPSB0aGlzLmRhdGEuZmllbGRWYWx1ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW5wdXQiKTsKICAgICAgICAgICAgICBlbGVtZW50LnR5cGUgPSAidGV4dCI7CiAgICAgICAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoInZhbHVlIiwgdGhpcy5kYXRhLmZpZWxkVmFsdWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBlbGVtZW50LmRpc2FibGVkID0gdGhpcy5kYXRhLnJlYWRPbmx5OwoKICAgICAgICAgICAgaWYgKHRoaXMuZGF0YS5tYXhMZW4gIT09IG51bGwpIHsKICAgICAgICAgICAgICBlbGVtZW50Lm1heExlbmd0aCA9IHRoaXMuZGF0YS5tYXhMZW47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0aGlzLmRhdGEuY29tYikgewogICAgICAgICAgICAgIHZhciBmaWVsZFdpZHRoID0gdGhpcy5kYXRhLnJlY3RbMl0gLSB0aGlzLmRhdGEucmVjdFswXTsKICAgICAgICAgICAgICB2YXIgY29tYldpZHRoID0gZmllbGRXaWR0aCAvIHRoaXMuZGF0YS5tYXhMZW47CiAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCJjb21iIik7CiAgICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5sZXR0ZXJTcGFjaW5nID0gImNhbGMoIi5jb25jYXQoY29tYldpZHRoLCAicHggLSAxY2gpIik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgICAgICAgZWxlbWVudC50ZXh0Q29udGVudCA9IHRoaXMuZGF0YS5maWVsZFZhbHVlOwogICAgICAgICAgICBlbGVtZW50LnN0eWxlLnZlcnRpY2FsQWxpZ24gPSAibWlkZGxlIjsKICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gInRhYmxlLWNlbGwiOwogICAgICAgICAgICB2YXIgZm9udCA9IG51bGw7CgogICAgICAgICAgICBpZiAodGhpcy5kYXRhLmZvbnRSZWZOYW1lICYmIHRoaXMucGFnZS5jb21tb25PYmpzLmhhcyh0aGlzLmRhdGEuZm9udFJlZk5hbWUpKSB7CiAgICAgICAgICAgICAgZm9udCA9IHRoaXMucGFnZS5jb21tb25PYmpzLmdldCh0aGlzLmRhdGEuZm9udFJlZk5hbWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLl9zZXRUZXh0U3R5bGUoZWxlbWVudCwgZm9udCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRoaXMuZGF0YS50ZXh0QWxpZ25tZW50ICE9PSBudWxsKSB7CiAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUudGV4dEFsaWduID0gVEVYVF9BTElHTk1FTlRbdGhpcy5kYXRhLnRleHRBbGlnbm1lbnRdOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKGVsZW1lbnQpOwogICAgICAgICAgcmV0dXJuIHRoaXMuY29udGFpbmVyOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIl9zZXRUZXh0U3R5bGUiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfc2V0VGV4dFN0eWxlKGVsZW1lbnQsIGZvbnQpIHsKICAgICAgICAgIHZhciBzdHlsZSA9IGVsZW1lbnQuc3R5bGU7CiAgICAgICAgICBzdHlsZS5mb250U2l6ZSA9ICIiLmNvbmNhdCh0aGlzLmRhdGEuZm9udFNpemUsICJweCIpOwogICAgICAgICAgc3R5bGUuZGlyZWN0aW9uID0gdGhpcy5kYXRhLmZvbnREaXJlY3Rpb24gPCAwID8gInJ0bCIgOiAibHRyIjsKCiAgICAgICAgICBpZiAoIWZvbnQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBib2xkID0gIm5vcm1hbCI7CgogICAgICAgICAgaWYgKGZvbnQuYmxhY2spIHsKICAgICAgICAgICAgYm9sZCA9ICI5MDAiOwogICAgICAgICAgfSBlbHNlIGlmIChmb250LmJvbGQpIHsKICAgICAgICAgICAgYm9sZCA9ICJib2xkIjsKICAgICAgICAgIH0KCiAgICAgICAgICBzdHlsZS5mb250V2VpZ2h0ID0gYm9sZDsKICAgICAgICAgIHN0eWxlLmZvbnRTdHlsZSA9IGZvbnQuaXRhbGljID8gIml0YWxpYyIgOiAibm9ybWFsIjsKICAgICAgICAgIHZhciBmb250RmFtaWx5ID0gZm9udC5sb2FkZWROYW1lID8gIlwiIi5jb25jYXQoZm9udC5sb2FkZWROYW1lLCAiXCIsICIpIDogIiI7CiAgICAgICAgICB2YXIgZmFsbGJhY2tOYW1lID0gZm9udC5mYWxsYmFja05hbWUgfHwgIkhlbHZldGljYSwgc2Fucy1zZXJpZiI7CiAgICAgICAgICBzdHlsZS5mb250RmFtaWx5ID0gZm9udEZhbWlseSArIGZhbGxiYWNrTmFtZTsKICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBUZXh0V2lkZ2V0QW5ub3RhdGlvbkVsZW1lbnQ7CiAgICB9KFdpZGdldEFubm90YXRpb25FbGVtZW50KTsKCiAgICB2YXIgQ2hlY2tib3hXaWRnZXRBbm5vdGF0aW9uRWxlbWVudCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX1dpZGdldEFubm90YXRpb25FbGVtMikgewogICAgICBfaW5oZXJpdHMoQ2hlY2tib3hXaWRnZXRBbm5vdGF0aW9uRWxlbWVudCwgX1dpZGdldEFubm90YXRpb25FbGVtMik7CgogICAgICBmdW5jdGlvbiBDaGVja2JveFdpZGdldEFubm90YXRpb25FbGVtZW50KHBhcmFtZXRlcnMpIHsKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQ2hlY2tib3hXaWRnZXRBbm5vdGF0aW9uRWxlbWVudCk7CgogICAgICAgIHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoQ2hlY2tib3hXaWRnZXRBbm5vdGF0aW9uRWxlbWVudCkuY2FsbCh0aGlzLCBwYXJhbWV0ZXJzLCBwYXJhbWV0ZXJzLnJlbmRlckludGVyYWN0aXZlRm9ybXMpKTsKICAgICAgfQoKICAgICAgX2NyZWF0ZUNsYXNzKENoZWNrYm94V2lkZ2V0QW5ub3RhdGlvbkVsZW1lbnQsIFt7CiAgICAgICAga2V5OiAicmVuZGVyIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICAgICAgdGhpcy5jb250YWluZXIuY2xhc3NOYW1lID0gImJ1dHRvbldpZGdldEFubm90YXRpb24gY2hlY2tCb3giOwogICAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOwogICAgICAgICAgZWxlbWVudC5kaXNhYmxlZCA9IHRoaXMuZGF0YS5yZWFkT25seTsKICAgICAgICAgIGVsZW1lbnQudHlwZSA9ICJjaGVja2JveCI7CgogICAgICAgICAgaWYgKHRoaXMuZGF0YS5maWVsZFZhbHVlICYmIHRoaXMuZGF0YS5maWVsZFZhbHVlICE9PSAiT2ZmIikgewogICAgICAgICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgiY2hlY2tlZCIsIHRydWUpOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKGVsZW1lbnQpOwogICAgICAgICAgcmV0dXJuIHRoaXMuY29udGFpbmVyOwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIENoZWNrYm94V2lkZ2V0QW5ub3RhdGlvbkVsZW1lbnQ7CiAgICB9KFdpZGdldEFubm90YXRpb25FbGVtZW50KTsKCiAgICB2YXIgUmFkaW9CdXR0b25XaWRnZXRBbm5vdGF0aW9uRWxlbWVudCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX1dpZGdldEFubm90YXRpb25FbGVtMykgewogICAgICBfaW5oZXJpdHMoUmFkaW9CdXR0b25XaWRnZXRBbm5vdGF0aW9uRWxlbWVudCwgX1dpZGdldEFubm90YXRpb25FbGVtMyk7CgogICAgICBmdW5jdGlvbiBSYWRpb0J1dHRvbldpZGdldEFubm90YXRpb25FbGVtZW50KHBhcmFtZXRlcnMpIHsKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUmFkaW9CdXR0b25XaWRnZXRBbm5vdGF0aW9uRWxlbWVudCk7CgogICAgICAgIHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoUmFkaW9CdXR0b25XaWRnZXRBbm5vdGF0aW9uRWxlbWVudCkuY2FsbCh0aGlzLCBwYXJhbWV0ZXJzLCBwYXJhbWV0ZXJzLnJlbmRlckludGVyYWN0aXZlRm9ybXMpKTsKICAgICAgfQoKICAgICAgX2NyZWF0ZUNsYXNzKFJhZGlvQnV0dG9uV2lkZ2V0QW5ub3RhdGlvbkVsZW1lbnQsIFt7CiAgICAgICAga2V5OiAicmVuZGVyIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICAgICAgdGhpcy5jb250YWluZXIuY2xhc3NOYW1lID0gImJ1dHRvbldpZGdldEFubm90YXRpb24gcmFkaW9CdXR0b24iOwogICAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOwogICAgICAgICAgZWxlbWVudC5kaXNhYmxlZCA9IHRoaXMuZGF0YS5yZWFkT25seTsKICAgICAgICAgIGVsZW1lbnQudHlwZSA9ICJyYWRpbyI7CiAgICAgICAgICBlbGVtZW50Lm5hbWUgPSB0aGlzLmRhdGEuZmllbGROYW1lOwoKICAgICAgICAgIGlmICh0aGlzLmRhdGEuZmllbGRWYWx1ZSA9PT0gdGhpcy5kYXRhLmJ1dHRvblZhbHVlKSB7CiAgICAgICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCJjaGVja2VkIiwgdHJ1ZSk7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQoZWxlbWVudCk7CiAgICAgICAgICByZXR1cm4gdGhpcy5jb250YWluZXI7CiAgICAgICAgfQogICAgICB9XSk7CgogICAgICByZXR1cm4gUmFkaW9CdXR0b25XaWRnZXRBbm5vdGF0aW9uRWxlbWVudDsKICAgIH0oV2lkZ2V0QW5ub3RhdGlvbkVsZW1lbnQpOwoKICAgIHZhciBQdXNoQnV0dG9uV2lkZ2V0QW5ub3RhdGlvbkVsZW1lbnQgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9MaW5rQW5ub3RhdGlvbkVsZW1lbikgewogICAgICBfaW5oZXJpdHMoUHVzaEJ1dHRvbldpZGdldEFubm90YXRpb25FbGVtZW50LCBfTGlua0Fubm90YXRpb25FbGVtZW4pOwoKICAgICAgZnVuY3Rpb24gUHVzaEJ1dHRvbldpZGdldEFubm90YXRpb25FbGVtZW50KCkgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBQdXNoQnV0dG9uV2lkZ2V0QW5ub3RhdGlvbkVsZW1lbnQpOwoKICAgICAgICByZXR1cm4gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKFB1c2hCdXR0b25XaWRnZXRBbm5vdGF0aW9uRWxlbWVudCkuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhQdXNoQnV0dG9uV2lkZ2V0QW5ub3RhdGlvbkVsZW1lbnQsIFt7CiAgICAgICAga2V5OiAicmVuZGVyIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICAgICAgdmFyIGNvbnRhaW5lciA9IF9nZXQoX2dldFByb3RvdHlwZU9mKFB1c2hCdXR0b25XaWRnZXRBbm5vdGF0aW9uRWxlbWVudC5wcm90b3R5cGUpLCAicmVuZGVyIiwgdGhpcykuY2FsbCh0aGlzKTsKCiAgICAgICAgICBjb250YWluZXIuY2xhc3NOYW1lID0gImJ1dHRvbldpZGdldEFubm90YXRpb24gcHVzaEJ1dHRvbiI7CiAgICAgICAgICByZXR1cm4gY29udGFpbmVyOwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIFB1c2hCdXR0b25XaWRnZXRBbm5vdGF0aW9uRWxlbWVudDsKICAgIH0oTGlua0Fubm90YXRpb25FbGVtZW50KTsKCiAgICB2YXIgQ2hvaWNlV2lkZ2V0QW5ub3RhdGlvbkVsZW1lbnQgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9XaWRnZXRBbm5vdGF0aW9uRWxlbTQpIHsKICAgICAgX2luaGVyaXRzKENob2ljZVdpZGdldEFubm90YXRpb25FbGVtZW50LCBfV2lkZ2V0QW5ub3RhdGlvbkVsZW00KTsKCiAgICAgIGZ1bmN0aW9uIENob2ljZVdpZGdldEFubm90YXRpb25FbGVtZW50KHBhcmFtZXRlcnMpIHsKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQ2hvaWNlV2lkZ2V0QW5ub3RhdGlvbkVsZW1lbnQpOwoKICAgICAgICByZXR1cm4gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKENob2ljZVdpZGdldEFubm90YXRpb25FbGVtZW50KS5jYWxsKHRoaXMsIHBhcmFtZXRlcnMsIHBhcmFtZXRlcnMucmVuZGVySW50ZXJhY3RpdmVGb3JtcykpOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoQ2hvaWNlV2lkZ2V0QW5ub3RhdGlvbkVsZW1lbnQsIFt7CiAgICAgICAga2V5OiAicmVuZGVyIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICAgICAgdGhpcy5jb250YWluZXIuY2xhc3NOYW1lID0gImNob2ljZVdpZGdldEFubm90YXRpb24iOwogICAgICAgICAgdmFyIHNlbGVjdEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzZWxlY3QiKTsKICAgICAgICAgIHNlbGVjdEVsZW1lbnQuZGlzYWJsZWQgPSB0aGlzLmRhdGEucmVhZE9ubHk7CgogICAgICAgICAgaWYgKCF0aGlzLmRhdGEuY29tYm8pIHsKICAgICAgICAgICAgc2VsZWN0RWxlbWVudC5zaXplID0gdGhpcy5kYXRhLm9wdGlvbnMubGVuZ3RoOwoKICAgICAgICAgICAgaWYgKHRoaXMuZGF0YS5tdWx0aVNlbGVjdCkgewogICAgICAgICAgICAgIHNlbGVjdEVsZW1lbnQubXVsdGlwbGUgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSB0cnVlOwogICAgICAgICAgdmFyIF9kaWRJdGVyYXRvckVycm9yID0gZmFsc2U7CiAgICAgICAgICB2YXIgX2l0ZXJhdG9yRXJyb3IgPSB1bmRlZmluZWQ7CgogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZm9yICh2YXIgX2l0ZXJhdG9yID0gdGhpcy5kYXRhLm9wdGlvbnNbU3ltYm9sLml0ZXJhdG9yXSgpLCBfc3RlcDsgIShfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gKF9zdGVwID0gX2l0ZXJhdG9yLm5leHQoKSkuZG9uZSk7IF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSB0cnVlKSB7CiAgICAgICAgICAgICAgdmFyIG9wdGlvbiA9IF9zdGVwLnZhbHVlOwogICAgICAgICAgICAgIHZhciBvcHRpb25FbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgib3B0aW9uIik7CiAgICAgICAgICAgICAgb3B0aW9uRWxlbWVudC50ZXh0Q29udGVudCA9IG9wdGlvbi5kaXNwbGF5VmFsdWU7CiAgICAgICAgICAgICAgb3B0aW9uRWxlbWVudC52YWx1ZSA9IG9wdGlvbi5leHBvcnRWYWx1ZTsKCiAgICAgICAgICAgICAgaWYgKHRoaXMuZGF0YS5maWVsZFZhbHVlLmluY2x1ZGVzKG9wdGlvbi5kaXNwbGF5VmFsdWUpKSB7CiAgICAgICAgICAgICAgICBvcHRpb25FbGVtZW50LnNldEF0dHJpYnV0ZSgic2VsZWN0ZWQiLCB0cnVlKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHNlbGVjdEVsZW1lbnQuYXBwZW5kQ2hpbGQob3B0aW9uRWxlbWVudCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvciA9IHRydWU7CiAgICAgICAgICAgIF9pdGVyYXRvckVycm9yID0gZXJyOwogICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gJiYgX2l0ZXJhdG9yWyJyZXR1cm4iXSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBfaXRlcmF0b3JbInJldHVybiJdKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgIGlmIChfZGlkSXRlcmF0b3JFcnJvcikgewogICAgICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3I7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQoc2VsZWN0RWxlbWVudCk7CiAgICAgICAgICByZXR1cm4gdGhpcy5jb250YWluZXI7CiAgICAgICAgfQogICAgICB9XSk7CgogICAgICByZXR1cm4gQ2hvaWNlV2lkZ2V0QW5ub3RhdGlvbkVsZW1lbnQ7CiAgICB9KFdpZGdldEFubm90YXRpb25FbGVtZW50KTsKCiAgICB2YXIgUG9wdXBBbm5vdGF0aW9uRWxlbWVudCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0Fubm90YXRpb25FbGVtZW50NCkgewogICAgICBfaW5oZXJpdHMoUG9wdXBBbm5vdGF0aW9uRWxlbWVudCwgX0Fubm90YXRpb25FbGVtZW50NCk7CgogICAgICBmdW5jdGlvbiBQb3B1cEFubm90YXRpb25FbGVtZW50KHBhcmFtZXRlcnMpIHsKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUG9wdXBBbm5vdGF0aW9uRWxlbWVudCk7CgogICAgICAgIHZhciBpc1JlbmRlcmFibGUgPSAhIShwYXJhbWV0ZXJzLmRhdGEudGl0bGUgfHwgcGFyYW1ldGVycy5kYXRhLmNvbnRlbnRzKTsKICAgICAgICByZXR1cm4gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKFBvcHVwQW5ub3RhdGlvbkVsZW1lbnQpLmNhbGwodGhpcywgcGFyYW1ldGVycywgaXNSZW5kZXJhYmxlKSk7CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhQb3B1cEFubm90YXRpb25FbGVtZW50LCBbewogICAgICAgIGtleTogInJlbmRlciIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgICAgIHZhciBJR05PUkVfVFlQRVMgPSBbIkxpbmUiLCAiU3F1YXJlIiwgIkNpcmNsZSIsICJQb2x5TGluZSIsICJQb2x5Z29uIiwgIkluayJdOwogICAgICAgICAgdGhpcy5jb250YWluZXIuY2xhc3NOYW1lID0gInBvcHVwQW5ub3RhdGlvbiI7CgogICAgICAgICAgaWYgKElHTk9SRV9UWVBFUy5pbmNsdWRlcyh0aGlzLmRhdGEucGFyZW50VHlwZSkpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29udGFpbmVyOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBzZWxlY3RvciA9ICJbZGF0YS1hbm5vdGF0aW9uLWlkPVwiIi5jb25jYXQodGhpcy5kYXRhLnBhcmVudElkLCAiXCJdIik7CiAgICAgICAgICB2YXIgcGFyZW50RWxlbWVudCA9IHRoaXMubGF5ZXIucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7CgogICAgICAgICAgaWYgKCFwYXJlbnRFbGVtZW50KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnRhaW5lcjsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcG9wdXAgPSBuZXcgUG9wdXBFbGVtZW50KHsKICAgICAgICAgICAgY29udGFpbmVyOiB0aGlzLmNvbnRhaW5lciwKICAgICAgICAgICAgdHJpZ2dlcjogcGFyZW50RWxlbWVudCwKICAgICAgICAgICAgY29sb3I6IHRoaXMuZGF0YS5jb2xvciwKICAgICAgICAgICAgdGl0bGU6IHRoaXMuZGF0YS50aXRsZSwKICAgICAgICAgICAgbW9kaWZpY2F0aW9uRGF0ZTogdGhpcy5kYXRhLm1vZGlmaWNhdGlvbkRhdGUsCiAgICAgICAgICAgIGNvbnRlbnRzOiB0aGlzLmRhdGEuY29udGVudHMKICAgICAgICAgIH0pOwogICAgICAgICAgdmFyIHBhcmVudExlZnQgPSBwYXJzZUZsb2F0KHBhcmVudEVsZW1lbnQuc3R5bGUubGVmdCk7CiAgICAgICAgICB2YXIgcGFyZW50V2lkdGggPSBwYXJzZUZsb2F0KHBhcmVudEVsZW1lbnQuc3R5bGUud2lkdGgpOwogICAgICAgICAgdGhpcy5jb250YWluZXIuc3R5bGUudHJhbnNmb3JtT3JpZ2luID0gIi0iLmNvbmNhdChwYXJlbnRMZWZ0ICsgcGFyZW50V2lkdGgsICJweCAtIikuY29uY2F0KHBhcmVudEVsZW1lbnQuc3R5bGUudG9wKTsKICAgICAgICAgIHRoaXMuY29udGFpbmVyLnN0eWxlLmxlZnQgPSAiIi5jb25jYXQocGFyZW50TGVmdCArIHBhcmVudFdpZHRoLCAicHgiKTsKICAgICAgICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKHBvcHVwLnJlbmRlcigpKTsKICAgICAgICAgIHJldHVybiB0aGlzLmNvbnRhaW5lcjsKICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBQb3B1cEFubm90YXRpb25FbGVtZW50OwogICAgfShBbm5vdGF0aW9uRWxlbWVudCk7CgogICAgdmFyIFBvcHVwRWxlbWVudCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgIGZ1bmN0aW9uIFBvcHVwRWxlbWVudChwYXJhbWV0ZXJzKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFBvcHVwRWxlbWVudCk7CgogICAgICAgIHRoaXMuY29udGFpbmVyID0gcGFyYW1ldGVycy5jb250YWluZXI7CiAgICAgICAgdGhpcy50cmlnZ2VyID0gcGFyYW1ldGVycy50cmlnZ2VyOwogICAgICAgIHRoaXMuY29sb3IgPSBwYXJhbWV0ZXJzLmNvbG9yOwogICAgICAgIHRoaXMudGl0bGUgPSBwYXJhbWV0ZXJzLnRpdGxlOwogICAgICAgIHRoaXMubW9kaWZpY2F0aW9uRGF0ZSA9IHBhcmFtZXRlcnMubW9kaWZpY2F0aW9uRGF0ZTsKICAgICAgICB0aGlzLmNvbnRlbnRzID0gcGFyYW1ldGVycy5jb250ZW50czsKICAgICAgICB0aGlzLmhpZGVXcmFwcGVyID0gcGFyYW1ldGVycy5oaWRlV3JhcHBlciB8fCBmYWxzZTsKICAgICAgICB0aGlzLnBpbm5lZCA9IGZhbHNlOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoUG9wdXBFbGVtZW50LCBbewogICAgICAgIGtleTogInJlbmRlciIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgICAgIHZhciBCQUNLR1JPVU5EX0VOTElHSFQgPSAwLjc7CiAgICAgICAgICB2YXIgd3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgICAgd3JhcHBlci5jbGFzc05hbWUgPSAicG9wdXBXcmFwcGVyIjsKICAgICAgICAgIHRoaXMuaGlkZUVsZW1lbnQgPSB0aGlzLmhpZGVXcmFwcGVyID8gd3JhcHBlciA6IHRoaXMuY29udGFpbmVyOwogICAgICAgICAgdGhpcy5oaWRlRWxlbWVudC5zZXRBdHRyaWJ1dGUoImhpZGRlbiIsIHRydWUpOwogICAgICAgICAgdmFyIHBvcHVwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgICBwb3B1cC5jbGFzc05hbWUgPSAicG9wdXAiOwogICAgICAgICAgdmFyIGNvbG9yID0gdGhpcy5jb2xvcjsKCiAgICAgICAgICBpZiAoY29sb3IpIHsKICAgICAgICAgICAgdmFyIHIgPSBCQUNLR1JPVU5EX0VOTElHSFQgKiAoMjU1IC0gY29sb3JbMF0pICsgY29sb3JbMF07CiAgICAgICAgICAgIHZhciBnID0gQkFDS0dST1VORF9FTkxJR0hUICogKDI1NSAtIGNvbG9yWzFdKSArIGNvbG9yWzFdOwogICAgICAgICAgICB2YXIgYiA9IEJBQ0tHUk9VTkRfRU5MSUdIVCAqICgyNTUgLSBjb2xvclsyXSkgKyBjb2xvclsyXTsKICAgICAgICAgICAgcG9wdXAuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gX3V0aWwuVXRpbC5tYWtlQ3NzUmdiKHIgfCAwLCBnIHwgMCwgYiB8IDApOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImgxIik7CiAgICAgICAgICB0aXRsZS50ZXh0Q29udGVudCA9IHRoaXMudGl0bGU7CiAgICAgICAgICBwb3B1cC5hcHBlbmRDaGlsZCh0aXRsZSk7CgogICAgICAgICAgdmFyIGRhdGVPYmplY3QgPSBfZGlzcGxheV91dGlscy5QREZEYXRlU3RyaW5nLnRvRGF0ZU9iamVjdCh0aGlzLm1vZGlmaWNhdGlvbkRhdGUpOwoKICAgICAgICAgIGlmIChkYXRlT2JqZWN0KSB7CiAgICAgICAgICAgIHZhciBtb2RpZmljYXRpb25EYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3BhbiIpOwogICAgICAgICAgICBtb2RpZmljYXRpb25EYXRlLnRleHRDb250ZW50ID0gInt7ZGF0ZX19LCB7e3RpbWV9fSI7CiAgICAgICAgICAgIG1vZGlmaWNhdGlvbkRhdGUuZGF0YXNldC5sMTBuSWQgPSAiYW5ub3RhdGlvbl9kYXRlX3N0cmluZyI7CiAgICAgICAgICAgIG1vZGlmaWNhdGlvbkRhdGUuZGF0YXNldC5sMTBuQXJncyA9IEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgICAgICBkYXRlOiBkYXRlT2JqZWN0LnRvTG9jYWxlRGF0ZVN0cmluZygpLAogICAgICAgICAgICAgIHRpbWU6IGRhdGVPYmplY3QudG9Mb2NhbGVUaW1lU3RyaW5nKCkKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHBvcHVwLmFwcGVuZENoaWxkKG1vZGlmaWNhdGlvbkRhdGUpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBjb250ZW50cyA9IHRoaXMuX2Zvcm1hdENvbnRlbnRzKHRoaXMuY29udGVudHMpOwoKICAgICAgICAgIHBvcHVwLmFwcGVuZENoaWxkKGNvbnRlbnRzKTsKICAgICAgICAgIHRoaXMudHJpZ2dlci5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIHRoaXMuX3RvZ2dsZS5iaW5kKHRoaXMpKTsKICAgICAgICAgIHRoaXMudHJpZ2dlci5hZGRFdmVudExpc3RlbmVyKCJtb3VzZW92ZXIiLCB0aGlzLl9zaG93LmJpbmQodGhpcywgZmFsc2UpKTsKICAgICAgICAgIHRoaXMudHJpZ2dlci5hZGRFdmVudExpc3RlbmVyKCJtb3VzZW91dCIsIHRoaXMuX2hpZGUuYmluZCh0aGlzLCBmYWxzZSkpOwogICAgICAgICAgcG9wdXAuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCB0aGlzLl9oaWRlLmJpbmQodGhpcywgdHJ1ZSkpOwogICAgICAgICAgd3JhcHBlci5hcHBlbmRDaGlsZChwb3B1cCk7CiAgICAgICAgICByZXR1cm4gd3JhcHBlcjsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJfZm9ybWF0Q29udGVudHMiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZm9ybWF0Q29udGVudHMoY29udGVudHMpIHsKICAgICAgICAgIHZhciBwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgicCIpOwogICAgICAgICAgdmFyIGxpbmVzID0gY29udGVudHMuc3BsaXQoLyg/OlxyXG4/fFxuKS8pOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGxpbmVzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHsKICAgICAgICAgICAgdmFyIGxpbmUgPSBsaW5lc1tpXTsKICAgICAgICAgICAgcC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShsaW5lKSk7CgogICAgICAgICAgICBpZiAoaSA8IGlpIC0gMSkgewogICAgICAgICAgICAgIHAuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnIiKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gcDsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJfdG9nZ2xlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX3RvZ2dsZSgpIHsKICAgICAgICAgIGlmICh0aGlzLnBpbm5lZCkgewogICAgICAgICAgICB0aGlzLl9oaWRlKHRydWUpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5fc2hvdyh0cnVlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJfc2hvdyIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9zaG93KCkgewogICAgICAgICAgdmFyIHBpbiA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogZmFsc2U7CgogICAgICAgICAgaWYgKHBpbikgewogICAgICAgICAgICB0aGlzLnBpbm5lZCA9IHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRoaXMuaGlkZUVsZW1lbnQuaGFzQXR0cmlidXRlKCJoaWRkZW4iKSkgewogICAgICAgICAgICB0aGlzLmhpZGVFbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgiaGlkZGVuIik7CiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLnN0eWxlLnpJbmRleCArPSAxOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIl9oaWRlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX2hpZGUoKSB7CiAgICAgICAgICB2YXIgdW5waW4gPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHRydWU7CgogICAgICAgICAgaWYgKHVucGluKSB7CiAgICAgICAgICAgIHRoaXMucGlubmVkID0gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCF0aGlzLmhpZGVFbGVtZW50Lmhhc0F0dHJpYnV0ZSgiaGlkZGVuIikgJiYgIXRoaXMucGlubmVkKSB7CiAgICAgICAgICAgIHRoaXMuaGlkZUVsZW1lbnQuc2V0QXR0cmlidXRlKCJoaWRkZW4iLCB0cnVlKTsKICAgICAgICAgICAgdGhpcy5jb250YWluZXIuc3R5bGUuekluZGV4IC09IDE7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9XSk7CgogICAgICByZXR1cm4gUG9wdXBFbGVtZW50OwogICAgfSgpOwoKICAgIHZhciBGcmVlVGV4dEFubm90YXRpb25FbGVtZW50ID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQW5ub3RhdGlvbkVsZW1lbnQ1KSB7CiAgICAgIF9pbmhlcml0cyhGcmVlVGV4dEFubm90YXRpb25FbGVtZW50LCBfQW5ub3RhdGlvbkVsZW1lbnQ1KTsKCiAgICAgIGZ1bmN0aW9uIEZyZWVUZXh0QW5ub3RhdGlvbkVsZW1lbnQocGFyYW1ldGVycykgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBGcmVlVGV4dEFubm90YXRpb25FbGVtZW50KTsKCiAgICAgICAgdmFyIGlzUmVuZGVyYWJsZSA9ICEhKHBhcmFtZXRlcnMuZGF0YS5oYXNQb3B1cCB8fCBwYXJhbWV0ZXJzLmRhdGEudGl0bGUgfHwgcGFyYW1ldGVycy5kYXRhLmNvbnRlbnRzKTsKICAgICAgICByZXR1cm4gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKEZyZWVUZXh0QW5ub3RhdGlvbkVsZW1lbnQpLmNhbGwodGhpcywgcGFyYW1ldGVycywgaXNSZW5kZXJhYmxlLCB0cnVlKSk7CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhGcmVlVGV4dEFubm90YXRpb25FbGVtZW50LCBbewogICAgICAgIGtleTogInJlbmRlciIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTmFtZSA9ICJmcmVlVGV4dEFubm90YXRpb24iOwoKICAgICAgICAgIGlmICghdGhpcy5kYXRhLmhhc1BvcHVwKSB7CiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZVBvcHVwKHRoaXMuY29udGFpbmVyLCBudWxsLCB0aGlzLmRhdGEpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB0aGlzLmNvbnRhaW5lcjsKICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBGcmVlVGV4dEFubm90YXRpb25FbGVtZW50OwogICAgfShBbm5vdGF0aW9uRWxlbWVudCk7CgogICAgdmFyIExpbmVBbm5vdGF0aW9uRWxlbWVudCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0Fubm90YXRpb25FbGVtZW50NikgewogICAgICBfaW5oZXJpdHMoTGluZUFubm90YXRpb25FbGVtZW50LCBfQW5ub3RhdGlvbkVsZW1lbnQ2KTsKCiAgICAgIGZ1bmN0aW9uIExpbmVBbm5vdGF0aW9uRWxlbWVudChwYXJhbWV0ZXJzKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIExpbmVBbm5vdGF0aW9uRWxlbWVudCk7CgogICAgICAgIHZhciBpc1JlbmRlcmFibGUgPSAhIShwYXJhbWV0ZXJzLmRhdGEuaGFzUG9wdXAgfHwgcGFyYW1ldGVycy5kYXRhLnRpdGxlIHx8IHBhcmFtZXRlcnMuZGF0YS5jb250ZW50cyk7CiAgICAgICAgcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihMaW5lQW5ub3RhdGlvbkVsZW1lbnQpLmNhbGwodGhpcywgcGFyYW1ldGVycywgaXNSZW5kZXJhYmxlLCB0cnVlKSk7CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhMaW5lQW5ub3RhdGlvbkVsZW1lbnQsIFt7CiAgICAgICAga2V5OiAicmVuZGVyIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICAgICAgdGhpcy5jb250YWluZXIuY2xhc3NOYW1lID0gImxpbmVBbm5vdGF0aW9uIjsKICAgICAgICAgIHZhciBkYXRhID0gdGhpcy5kYXRhOwogICAgICAgICAgdmFyIHdpZHRoID0gZGF0YS5yZWN0WzJdIC0gZGF0YS5yZWN0WzBdOwogICAgICAgICAgdmFyIGhlaWdodCA9IGRhdGEucmVjdFszXSAtIGRhdGEucmVjdFsxXTsKICAgICAgICAgIHZhciBzdmcgPSB0aGlzLnN2Z0ZhY3RvcnkuY3JlYXRlKHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgdmFyIGxpbmUgPSB0aGlzLnN2Z0ZhY3RvcnkuY3JlYXRlRWxlbWVudCgic3ZnOmxpbmUiKTsKICAgICAgICAgIGxpbmUuc2V0QXR0cmlidXRlKCJ4MSIsIGRhdGEucmVjdFsyXSAtIGRhdGEubGluZUNvb3JkaW5hdGVzWzBdKTsKICAgICAgICAgIGxpbmUuc2V0QXR0cmlidXRlKCJ5MSIsIGRhdGEucmVjdFszXSAtIGRhdGEubGluZUNvb3JkaW5hdGVzWzFdKTsKICAgICAgICAgIGxpbmUuc2V0QXR0cmlidXRlKCJ4MiIsIGRhdGEucmVjdFsyXSAtIGRhdGEubGluZUNvb3JkaW5hdGVzWzJdKTsKICAgICAgICAgIGxpbmUuc2V0QXR0cmlidXRlKCJ5MiIsIGRhdGEucmVjdFszXSAtIGRhdGEubGluZUNvb3JkaW5hdGVzWzNdKTsKICAgICAgICAgIGxpbmUuc2V0QXR0cmlidXRlKCJzdHJva2Utd2lkdGgiLCBkYXRhLmJvcmRlclN0eWxlLndpZHRoIHx8IDEpOwogICAgICAgICAgbGluZS5zZXRBdHRyaWJ1dGUoInN0cm9rZSIsICJ0cmFuc3BhcmVudCIpOwogICAgICAgICAgc3ZnLmFwcGVuZENoaWxkKGxpbmUpOwogICAgICAgICAgdGhpcy5jb250YWluZXIuYXBwZW5kKHN2Zyk7CgogICAgICAgICAgdGhpcy5fY3JlYXRlUG9wdXAodGhpcy5jb250YWluZXIsIGxpbmUsIGRhdGEpOwoKICAgICAgICAgIHJldHVybiB0aGlzLmNvbnRhaW5lcjsKICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBMaW5lQW5ub3RhdGlvbkVsZW1lbnQ7CiAgICB9KEFubm90YXRpb25FbGVtZW50KTsKCiAgICB2YXIgU3F1YXJlQW5ub3RhdGlvbkVsZW1lbnQgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9Bbm5vdGF0aW9uRWxlbWVudDcpIHsKICAgICAgX2luaGVyaXRzKFNxdWFyZUFubm90YXRpb25FbGVtZW50LCBfQW5ub3RhdGlvbkVsZW1lbnQ3KTsKCiAgICAgIGZ1bmN0aW9uIFNxdWFyZUFubm90YXRpb25FbGVtZW50KHBhcmFtZXRlcnMpIHsKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgU3F1YXJlQW5ub3RhdGlvbkVsZW1lbnQpOwoKICAgICAgICB2YXIgaXNSZW5kZXJhYmxlID0gISEocGFyYW1ldGVycy5kYXRhLmhhc1BvcHVwIHx8IHBhcmFtZXRlcnMuZGF0YS50aXRsZSB8fCBwYXJhbWV0ZXJzLmRhdGEuY29udGVudHMpOwogICAgICAgIHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoU3F1YXJlQW5ub3RhdGlvbkVsZW1lbnQpLmNhbGwodGhpcywgcGFyYW1ldGVycywgaXNSZW5kZXJhYmxlLCB0cnVlKSk7CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhTcXVhcmVBbm5vdGF0aW9uRWxlbWVudCwgW3sKICAgICAgICBrZXk6ICJyZW5kZXIiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICAgICAgICB0aGlzLmNvbnRhaW5lci5jbGFzc05hbWUgPSAic3F1YXJlQW5ub3RhdGlvbiI7CiAgICAgICAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgICAgIHZhciB3aWR0aCA9IGRhdGEucmVjdFsyXSAtIGRhdGEucmVjdFswXTsKICAgICAgICAgIHZhciBoZWlnaHQgPSBkYXRhLnJlY3RbM10gLSBkYXRhLnJlY3RbMV07CiAgICAgICAgICB2YXIgc3ZnID0gdGhpcy5zdmdGYWN0b3J5LmNyZWF0ZSh3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgIHZhciBib3JkZXJXaWR0aCA9IGRhdGEuYm9yZGVyU3R5bGUud2lkdGg7CiAgICAgICAgICB2YXIgc3F1YXJlID0gdGhpcy5zdmdGYWN0b3J5LmNyZWF0ZUVsZW1lbnQoInN2ZzpyZWN0Iik7CiAgICAgICAgICBzcXVhcmUuc2V0QXR0cmlidXRlKCJ4IiwgYm9yZGVyV2lkdGggLyAyKTsKICAgICAgICAgIHNxdWFyZS5zZXRBdHRyaWJ1dGUoInkiLCBib3JkZXJXaWR0aCAvIDIpOwogICAgICAgICAgc3F1YXJlLnNldEF0dHJpYnV0ZSgid2lkdGgiLCB3aWR0aCAtIGJvcmRlcldpZHRoKTsKICAgICAgICAgIHNxdWFyZS5zZXRBdHRyaWJ1dGUoImhlaWdodCIsIGhlaWdodCAtIGJvcmRlcldpZHRoKTsKICAgICAgICAgIHNxdWFyZS5zZXRBdHRyaWJ1dGUoInN0cm9rZS13aWR0aCIsIGJvcmRlcldpZHRoIHx8IDEpOwogICAgICAgICAgc3F1YXJlLnNldEF0dHJpYnV0ZSgic3Ryb2tlIiwgInRyYW5zcGFyZW50Iik7CiAgICAgICAgICBzcXVhcmUuc2V0QXR0cmlidXRlKCJmaWxsIiwgIm5vbmUiKTsKICAgICAgICAgIHN2Zy5hcHBlbmRDaGlsZChzcXVhcmUpOwogICAgICAgICAgdGhpcy5jb250YWluZXIuYXBwZW5kKHN2Zyk7CgogICAgICAgICAgdGhpcy5fY3JlYXRlUG9wdXAodGhpcy5jb250YWluZXIsIHNxdWFyZSwgZGF0YSk7CgogICAgICAgICAgcmV0dXJuIHRoaXMuY29udGFpbmVyOwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIFNxdWFyZUFubm90YXRpb25FbGVtZW50OwogICAgfShBbm5vdGF0aW9uRWxlbWVudCk7CgogICAgdmFyIENpcmNsZUFubm90YXRpb25FbGVtZW50ID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQW5ub3RhdGlvbkVsZW1lbnQ4KSB7CiAgICAgIF9pbmhlcml0cyhDaXJjbGVBbm5vdGF0aW9uRWxlbWVudCwgX0Fubm90YXRpb25FbGVtZW50OCk7CgogICAgICBmdW5jdGlvbiBDaXJjbGVBbm5vdGF0aW9uRWxlbWVudChwYXJhbWV0ZXJzKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIENpcmNsZUFubm90YXRpb25FbGVtZW50KTsKCiAgICAgICAgdmFyIGlzUmVuZGVyYWJsZSA9ICEhKHBhcmFtZXRlcnMuZGF0YS5oYXNQb3B1cCB8fCBwYXJhbWV0ZXJzLmRhdGEudGl0bGUgfHwgcGFyYW1ldGVycy5kYXRhLmNvbnRlbnRzKTsKICAgICAgICByZXR1cm4gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKENpcmNsZUFubm90YXRpb25FbGVtZW50KS5jYWxsKHRoaXMsIHBhcmFtZXRlcnMsIGlzUmVuZGVyYWJsZSwgdHJ1ZSkpOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoQ2lyY2xlQW5ub3RhdGlvbkVsZW1lbnQsIFt7CiAgICAgICAga2V5OiAicmVuZGVyIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICAgICAgdGhpcy5jb250YWluZXIuY2xhc3NOYW1lID0gImNpcmNsZUFubm90YXRpb24iOwogICAgICAgICAgdmFyIGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgICAgICB2YXIgd2lkdGggPSBkYXRhLnJlY3RbMl0gLSBkYXRhLnJlY3RbMF07CiAgICAgICAgICB2YXIgaGVpZ2h0ID0gZGF0YS5yZWN0WzNdIC0gZGF0YS5yZWN0WzFdOwogICAgICAgICAgdmFyIHN2ZyA9IHRoaXMuc3ZnRmFjdG9yeS5jcmVhdGUod2lkdGgsIGhlaWdodCk7CiAgICAgICAgICB2YXIgYm9yZGVyV2lkdGggPSBkYXRhLmJvcmRlclN0eWxlLndpZHRoOwogICAgICAgICAgdmFyIGNpcmNsZSA9IHRoaXMuc3ZnRmFjdG9yeS5jcmVhdGVFbGVtZW50KCJzdmc6ZWxsaXBzZSIpOwogICAgICAgICAgY2lyY2xlLnNldEF0dHJpYnV0ZSgiY3giLCB3aWR0aCAvIDIpOwogICAgICAgICAgY2lyY2xlLnNldEF0dHJpYnV0ZSgiY3kiLCBoZWlnaHQgLyAyKTsKICAgICAgICAgIGNpcmNsZS5zZXRBdHRyaWJ1dGUoInJ4Iiwgd2lkdGggLyAyIC0gYm9yZGVyV2lkdGggLyAyKTsKICAgICAgICAgIGNpcmNsZS5zZXRBdHRyaWJ1dGUoInJ5IiwgaGVpZ2h0IC8gMiAtIGJvcmRlcldpZHRoIC8gMik7CiAgICAgICAgICBjaXJjbGUuc2V0QXR0cmlidXRlKCJzdHJva2Utd2lkdGgiLCBib3JkZXJXaWR0aCB8fCAxKTsKICAgICAgICAgIGNpcmNsZS5zZXRBdHRyaWJ1dGUoInN0cm9rZSIsICJ0cmFuc3BhcmVudCIpOwogICAgICAgICAgY2lyY2xlLnNldEF0dHJpYnV0ZSgiZmlsbCIsICJub25lIik7CiAgICAgICAgICBzdmcuYXBwZW5kQ2hpbGQoY2lyY2xlKTsKICAgICAgICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZChzdmcpOwoKICAgICAgICAgIHRoaXMuX2NyZWF0ZVBvcHVwKHRoaXMuY29udGFpbmVyLCBjaXJjbGUsIGRhdGEpOwoKICAgICAgICAgIHJldHVybiB0aGlzLmNvbnRhaW5lcjsKICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBDaXJjbGVBbm5vdGF0aW9uRWxlbWVudDsKICAgIH0oQW5ub3RhdGlvbkVsZW1lbnQpOwoKICAgIHZhciBQb2x5bGluZUFubm90YXRpb25FbGVtZW50ID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQW5ub3RhdGlvbkVsZW1lbnQ5KSB7CiAgICAgIF9pbmhlcml0cyhQb2x5bGluZUFubm90YXRpb25FbGVtZW50LCBfQW5ub3RhdGlvbkVsZW1lbnQ5KTsKCiAgICAgIGZ1bmN0aW9uIFBvbHlsaW5lQW5ub3RhdGlvbkVsZW1lbnQocGFyYW1ldGVycykgewogICAgICAgIHZhciBfdGhpczM7CgogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBQb2x5bGluZUFubm90YXRpb25FbGVtZW50KTsKCiAgICAgICAgdmFyIGlzUmVuZGVyYWJsZSA9ICEhKHBhcmFtZXRlcnMuZGF0YS5oYXNQb3B1cCB8fCBwYXJhbWV0ZXJzLmRhdGEudGl0bGUgfHwgcGFyYW1ldGVycy5kYXRhLmNvbnRlbnRzKTsKICAgICAgICBfdGhpczMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoUG9seWxpbmVBbm5vdGF0aW9uRWxlbWVudCkuY2FsbCh0aGlzLCBwYXJhbWV0ZXJzLCBpc1JlbmRlcmFibGUsIHRydWUpKTsKICAgICAgICBfdGhpczMuY29udGFpbmVyQ2xhc3NOYW1lID0gInBvbHlsaW5lQW5ub3RhdGlvbiI7CiAgICAgICAgX3RoaXMzLnN2Z0VsZW1lbnROYW1lID0gInN2Zzpwb2x5bGluZSI7CiAgICAgICAgcmV0dXJuIF90aGlzMzsKICAgICAgfQoKICAgICAgX2NyZWF0ZUNsYXNzKFBvbHlsaW5lQW5ub3RhdGlvbkVsZW1lbnQsIFt7CiAgICAgICAga2V5OiAicmVuZGVyIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICAgICAgdGhpcy5jb250YWluZXIuY2xhc3NOYW1lID0gdGhpcy5jb250YWluZXJDbGFzc05hbWU7CiAgICAgICAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgICAgIHZhciB3aWR0aCA9IGRhdGEucmVjdFsyXSAtIGRhdGEucmVjdFswXTsKICAgICAgICAgIHZhciBoZWlnaHQgPSBkYXRhLnJlY3RbM10gLSBkYXRhLnJlY3RbMV07CiAgICAgICAgICB2YXIgc3ZnID0gdGhpcy5zdmdGYWN0b3J5LmNyZWF0ZSh3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgIHZhciBwb2ludHMgPSBbXTsKICAgICAgICAgIHZhciBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiA9IHRydWU7CiAgICAgICAgICB2YXIgX2RpZEl0ZXJhdG9yRXJyb3IyID0gZmFsc2U7CiAgICAgICAgICB2YXIgX2l0ZXJhdG9yRXJyb3IyID0gdW5kZWZpbmVkOwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZvciAodmFyIF9pdGVyYXRvcjIgPSBkYXRhLnZlcnRpY2VzW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3N0ZXAyOyAhKF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yID0gKF9zdGVwMiA9IF9pdGVyYXRvcjIubmV4dCgpKS5kb25lKTsgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIgPSB0cnVlKSB7CiAgICAgICAgICAgICAgdmFyIGNvb3JkaW5hdGUgPSBfc3RlcDIudmFsdWU7CiAgICAgICAgICAgICAgdmFyIHggPSBjb29yZGluYXRlLnggLSBkYXRhLnJlY3RbMF07CiAgICAgICAgICAgICAgdmFyIHkgPSBkYXRhLnJlY3RbM10gLSBjb29yZGluYXRlLnk7CiAgICAgICAgICAgICAgcG9pbnRzLnB1c2goeCArICIsIiArIHkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgX2RpZEl0ZXJhdG9yRXJyb3IyID0gdHJ1ZTsKICAgICAgICAgICAgX2l0ZXJhdG9yRXJyb3IyID0gZXJyOwogICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yICYmIF9pdGVyYXRvcjJbInJldHVybiJdICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIF9pdGVyYXRvcjJbInJldHVybiJdKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgIGlmIChfZGlkSXRlcmF0b3JFcnJvcjIpIHsKICAgICAgICAgICAgICAgIHRocm93IF9pdGVyYXRvckVycm9yMjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBwb2ludHMgPSBwb2ludHMuam9pbigiICIpOwogICAgICAgICAgdmFyIHBvbHlsaW5lID0gdGhpcy5zdmdGYWN0b3J5LmNyZWF0ZUVsZW1lbnQodGhpcy5zdmdFbGVtZW50TmFtZSk7CiAgICAgICAgICBwb2x5bGluZS5zZXRBdHRyaWJ1dGUoInBvaW50cyIsIHBvaW50cyk7CiAgICAgICAgICBwb2x5bGluZS5zZXRBdHRyaWJ1dGUoInN0cm9rZS13aWR0aCIsIGRhdGEuYm9yZGVyU3R5bGUud2lkdGggfHwgMSk7CiAgICAgICAgICBwb2x5bGluZS5zZXRBdHRyaWJ1dGUoInN0cm9rZSIsICJ0cmFuc3BhcmVudCIpOwogICAgICAgICAgcG9seWxpbmUuc2V0QXR0cmlidXRlKCJmaWxsIiwgIm5vbmUiKTsKICAgICAgICAgIHN2Zy5hcHBlbmRDaGlsZChwb2x5bGluZSk7CiAgICAgICAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmQoc3ZnKTsKCiAgICAgICAgICB0aGlzLl9jcmVhdGVQb3B1cCh0aGlzLmNvbnRhaW5lciwgcG9seWxpbmUsIGRhdGEpOwoKICAgICAgICAgIHJldHVybiB0aGlzLmNvbnRhaW5lcjsKICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBQb2x5bGluZUFubm90YXRpb25FbGVtZW50OwogICAgfShBbm5vdGF0aW9uRWxlbWVudCk7CgogICAgdmFyIFBvbHlnb25Bbm5vdGF0aW9uRWxlbWVudCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX1BvbHlsaW5lQW5ub3RhdGlvbkVsKSB7CiAgICAgIF9pbmhlcml0cyhQb2x5Z29uQW5ub3RhdGlvbkVsZW1lbnQsIF9Qb2x5bGluZUFubm90YXRpb25FbCk7CgogICAgICBmdW5jdGlvbiBQb2x5Z29uQW5ub3RhdGlvbkVsZW1lbnQocGFyYW1ldGVycykgewogICAgICAgIHZhciBfdGhpczQ7CgogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBQb2x5Z29uQW5ub3RhdGlvbkVsZW1lbnQpOwoKICAgICAgICBfdGhpczQgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoUG9seWdvbkFubm90YXRpb25FbGVtZW50KS5jYWxsKHRoaXMsIHBhcmFtZXRlcnMpKTsKICAgICAgICBfdGhpczQuY29udGFpbmVyQ2xhc3NOYW1lID0gInBvbHlnb25Bbm5vdGF0aW9uIjsKICAgICAgICBfdGhpczQuc3ZnRWxlbWVudE5hbWUgPSAic3ZnOnBvbHlnb24iOwogICAgICAgIHJldHVybiBfdGhpczQ7CiAgICAgIH0KCiAgICAgIHJldHVybiBQb2x5Z29uQW5ub3RhdGlvbkVsZW1lbnQ7CiAgICB9KFBvbHlsaW5lQW5ub3RhdGlvbkVsZW1lbnQpOwoKICAgIHZhciBDYXJldEFubm90YXRpb25FbGVtZW50ID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQW5ub3RhdGlvbkVsZW1lbnQxMCkgewogICAgICBfaW5oZXJpdHMoQ2FyZXRBbm5vdGF0aW9uRWxlbWVudCwgX0Fubm90YXRpb25FbGVtZW50MTApOwoKICAgICAgZnVuY3Rpb24gQ2FyZXRBbm5vdGF0aW9uRWxlbWVudChwYXJhbWV0ZXJzKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIENhcmV0QW5ub3RhdGlvbkVsZW1lbnQpOwoKICAgICAgICB2YXIgaXNSZW5kZXJhYmxlID0gISEocGFyYW1ldGVycy5kYXRhLmhhc1BvcHVwIHx8IHBhcmFtZXRlcnMuZGF0YS50aXRsZSB8fCBwYXJhbWV0ZXJzLmRhdGEuY29udGVudHMpOwogICAgICAgIHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoQ2FyZXRBbm5vdGF0aW9uRWxlbWVudCkuY2FsbCh0aGlzLCBwYXJhbWV0ZXJzLCBpc1JlbmRlcmFibGUsIHRydWUpKTsKICAgICAgfQoKICAgICAgX2NyZWF0ZUNsYXNzKENhcmV0QW5ub3RhdGlvbkVsZW1lbnQsIFt7CiAgICAgICAga2V5OiAicmVuZGVyIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICAgICAgdGhpcy5jb250YWluZXIuY2xhc3NOYW1lID0gImNhcmV0QW5ub3RhdGlvbiI7CgogICAgICAgICAgaWYgKCF0aGlzLmRhdGEuaGFzUG9wdXApIHsKICAgICAgICAgICAgdGhpcy5fY3JlYXRlUG9wdXAodGhpcy5jb250YWluZXIsIG51bGwsIHRoaXMuZGF0YSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHRoaXMuY29udGFpbmVyOwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIENhcmV0QW5ub3RhdGlvbkVsZW1lbnQ7CiAgICB9KEFubm90YXRpb25FbGVtZW50KTsKCiAgICB2YXIgSW5rQW5ub3RhdGlvbkVsZW1lbnQgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9Bbm5vdGF0aW9uRWxlbWVudDExKSB7CiAgICAgIF9pbmhlcml0cyhJbmtBbm5vdGF0aW9uRWxlbWVudCwgX0Fubm90YXRpb25FbGVtZW50MTEpOwoKICAgICAgZnVuY3Rpb24gSW5rQW5ub3RhdGlvbkVsZW1lbnQocGFyYW1ldGVycykgewogICAgICAgIHZhciBfdGhpczU7CgogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBJbmtBbm5vdGF0aW9uRWxlbWVudCk7CgogICAgICAgIHZhciBpc1JlbmRlcmFibGUgPSAhIShwYXJhbWV0ZXJzLmRhdGEuaGFzUG9wdXAgfHwgcGFyYW1ldGVycy5kYXRhLnRpdGxlIHx8IHBhcmFtZXRlcnMuZGF0YS5jb250ZW50cyk7CiAgICAgICAgX3RoaXM1ID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKElua0Fubm90YXRpb25FbGVtZW50KS5jYWxsKHRoaXMsIHBhcmFtZXRlcnMsIGlzUmVuZGVyYWJsZSwgdHJ1ZSkpOwogICAgICAgIF90aGlzNS5jb250YWluZXJDbGFzc05hbWUgPSAiaW5rQW5ub3RhdGlvbiI7CiAgICAgICAgX3RoaXM1LnN2Z0VsZW1lbnROYW1lID0gInN2Zzpwb2x5bGluZSI7CiAgICAgICAgcmV0dXJuIF90aGlzNTsKICAgICAgfQoKICAgICAgX2NyZWF0ZUNsYXNzKElua0Fubm90YXRpb25FbGVtZW50LCBbewogICAgICAgIGtleTogInJlbmRlciIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTmFtZSA9IHRoaXMuY29udGFpbmVyQ2xhc3NOYW1lOwogICAgICAgICAgdmFyIGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgICAgICB2YXIgd2lkdGggPSBkYXRhLnJlY3RbMl0gLSBkYXRhLnJlY3RbMF07CiAgICAgICAgICB2YXIgaGVpZ2h0ID0gZGF0YS5yZWN0WzNdIC0gZGF0YS5yZWN0WzFdOwogICAgICAgICAgdmFyIHN2ZyA9IHRoaXMuc3ZnRmFjdG9yeS5jcmVhdGUod2lkdGgsIGhlaWdodCk7CiAgICAgICAgICB2YXIgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjMgPSB0cnVlOwogICAgICAgICAgdmFyIF9kaWRJdGVyYXRvckVycm9yMyA9IGZhbHNlOwogICAgICAgICAgdmFyIF9pdGVyYXRvckVycm9yMyA9IHVuZGVmaW5lZDsKCiAgICAgICAgICB0cnkgewogICAgICAgICAgICBmb3IgKHZhciBfaXRlcmF0b3IzID0gZGF0YS5pbmtMaXN0c1tTeW1ib2wuaXRlcmF0b3JdKCksIF9zdGVwMzsgIShfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMyA9IChfc3RlcDMgPSBfaXRlcmF0b3IzLm5leHQoKSkuZG9uZSk7IF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24zID0gdHJ1ZSkgewogICAgICAgICAgICAgIHZhciBpbmtMaXN0ID0gX3N0ZXAzLnZhbHVlOwogICAgICAgICAgICAgIHZhciBwb2ludHMgPSBbXTsKICAgICAgICAgICAgICB2YXIgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjQgPSB0cnVlOwogICAgICAgICAgICAgIHZhciBfZGlkSXRlcmF0b3JFcnJvcjQgPSBmYWxzZTsKICAgICAgICAgICAgICB2YXIgX2l0ZXJhdG9yRXJyb3I0ID0gdW5kZWZpbmVkOwoKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZm9yICh2YXIgX2l0ZXJhdG9yNCA9IGlua0xpc3RbU3ltYm9sLml0ZXJhdG9yXSgpLCBfc3RlcDQ7ICEoX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjQgPSAoX3N0ZXA0ID0gX2l0ZXJhdG9yNC5uZXh0KCkpLmRvbmUpOyBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uNCA9IHRydWUpIHsKICAgICAgICAgICAgICAgICAgdmFyIGNvb3JkaW5hdGUgPSBfc3RlcDQudmFsdWU7CiAgICAgICAgICAgICAgICAgIHZhciB4ID0gY29vcmRpbmF0ZS54IC0gZGF0YS5yZWN0WzBdOwogICAgICAgICAgICAgICAgICB2YXIgeSA9IGRhdGEucmVjdFszXSAtIGNvb3JkaW5hdGUueTsKICAgICAgICAgICAgICAgICAgcG9pbnRzLnB1c2goIiIuY29uY2F0KHgsICIsIikuY29uY2F0KHkpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgIF9kaWRJdGVyYXRvckVycm9yNCA9IHRydWU7CiAgICAgICAgICAgICAgICBfaXRlcmF0b3JFcnJvcjQgPSBlcnI7CiAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgIGlmICghX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjQgJiYgX2l0ZXJhdG9yNFsicmV0dXJuIl0gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIF9pdGVyYXRvcjRbInJldHVybiJdKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICAgIGlmIChfZGlkSXRlcmF0b3JFcnJvcjQpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBfaXRlcmF0b3JFcnJvcjQ7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHBvaW50cyA9IHBvaW50cy5qb2luKCIgIik7CiAgICAgICAgICAgICAgdmFyIHBvbHlsaW5lID0gdGhpcy5zdmdGYWN0b3J5LmNyZWF0ZUVsZW1lbnQodGhpcy5zdmdFbGVtZW50TmFtZSk7CiAgICAgICAgICAgICAgcG9seWxpbmUuc2V0QXR0cmlidXRlKCJwb2ludHMiLCBwb2ludHMpOwogICAgICAgICAgICAgIHBvbHlsaW5lLnNldEF0dHJpYnV0ZSgic3Ryb2tlLXdpZHRoIiwgZGF0YS5ib3JkZXJTdHlsZS53aWR0aCB8fCAxKTsKICAgICAgICAgICAgICBwb2x5bGluZS5zZXRBdHRyaWJ1dGUoInN0cm9rZSIsICJ0cmFuc3BhcmVudCIpOwogICAgICAgICAgICAgIHBvbHlsaW5lLnNldEF0dHJpYnV0ZSgiZmlsbCIsICJub25lIik7CgogICAgICAgICAgICAgIHRoaXMuX2NyZWF0ZVBvcHVwKHRoaXMuY29udGFpbmVyLCBwb2x5bGluZSwgZGF0YSk7CgogICAgICAgICAgICAgIHN2Zy5hcHBlbmRDaGlsZChwb2x5bGluZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvcjMgPSB0cnVlOwogICAgICAgICAgICBfaXRlcmF0b3JFcnJvcjMgPSBlcnI7CiAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGlmICghX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjMgJiYgX2l0ZXJhdG9yM1sicmV0dXJuIl0gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgX2l0ZXJhdG9yM1sicmV0dXJuIl0oKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgaWYgKF9kaWRJdGVyYXRvckVycm9yMykgewogICAgICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3IzOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZChzdmcpOwogICAgICAgICAgcmV0dXJuIHRoaXMuY29udGFpbmVyOwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIElua0Fubm90YXRpb25FbGVtZW50OwogICAgfShBbm5vdGF0aW9uRWxlbWVudCk7CgogICAgdmFyIEhpZ2hsaWdodEFubm90YXRpb25FbGVtZW50ID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQW5ub3RhdGlvbkVsZW1lbnQxMikgewogICAgICBfaW5oZXJpdHMoSGlnaGxpZ2h0QW5ub3RhdGlvbkVsZW1lbnQsIF9Bbm5vdGF0aW9uRWxlbWVudDEyKTsKCiAgICAgIGZ1bmN0aW9uIEhpZ2hsaWdodEFubm90YXRpb25FbGVtZW50KHBhcmFtZXRlcnMpIHsKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgSGlnaGxpZ2h0QW5ub3RhdGlvbkVsZW1lbnQpOwoKICAgICAgICB2YXIgaXNSZW5kZXJhYmxlID0gISEocGFyYW1ldGVycy5kYXRhLmhhc1BvcHVwIHx8IHBhcmFtZXRlcnMuZGF0YS50aXRsZSB8fCBwYXJhbWV0ZXJzLmRhdGEuY29udGVudHMpOwogICAgICAgIHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoSGlnaGxpZ2h0QW5ub3RhdGlvbkVsZW1lbnQpLmNhbGwodGhpcywgcGFyYW1ldGVycywgaXNSZW5kZXJhYmxlLCB0cnVlKSk7CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhIaWdobGlnaHRBbm5vdGF0aW9uRWxlbWVudCwgW3sKICAgICAgICBrZXk6ICJyZW5kZXIiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICAgICAgICB0aGlzLmNvbnRhaW5lci5jbGFzc05hbWUgPSAiaGlnaGxpZ2h0QW5ub3RhdGlvbiI7CgogICAgICAgICAgaWYgKCF0aGlzLmRhdGEuaGFzUG9wdXApIHsKICAgICAgICAgICAgdGhpcy5fY3JlYXRlUG9wdXAodGhpcy5jb250YWluZXIsIG51bGwsIHRoaXMuZGF0YSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHRoaXMuY29udGFpbmVyOwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIEhpZ2hsaWdodEFubm90YXRpb25FbGVtZW50OwogICAgfShBbm5vdGF0aW9uRWxlbWVudCk7CgogICAgdmFyIFVuZGVybGluZUFubm90YXRpb25FbGVtZW50ID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQW5ub3RhdGlvbkVsZW1lbnQxMykgewogICAgICBfaW5oZXJpdHMoVW5kZXJsaW5lQW5ub3RhdGlvbkVsZW1lbnQsIF9Bbm5vdGF0aW9uRWxlbWVudDEzKTsKCiAgICAgIGZ1bmN0aW9uIFVuZGVybGluZUFubm90YXRpb25FbGVtZW50KHBhcmFtZXRlcnMpIHsKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgVW5kZXJsaW5lQW5ub3RhdGlvbkVsZW1lbnQpOwoKICAgICAgICB2YXIgaXNSZW5kZXJhYmxlID0gISEocGFyYW1ldGVycy5kYXRhLmhhc1BvcHVwIHx8IHBhcmFtZXRlcnMuZGF0YS50aXRsZSB8fCBwYXJhbWV0ZXJzLmRhdGEuY29udGVudHMpOwogICAgICAgIHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoVW5kZXJsaW5lQW5ub3RhdGlvbkVsZW1lbnQpLmNhbGwodGhpcywgcGFyYW1ldGVycywgaXNSZW5kZXJhYmxlLCB0cnVlKSk7CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhVbmRlcmxpbmVBbm5vdGF0aW9uRWxlbWVudCwgW3sKICAgICAgICBrZXk6ICJyZW5kZXIiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICAgICAgICB0aGlzLmNvbnRhaW5lci5jbGFzc05hbWUgPSAidW5kZXJsaW5lQW5ub3RhdGlvbiI7CgogICAgICAgICAgaWYgKCF0aGlzLmRhdGEuaGFzUG9wdXApIHsKICAgICAgICAgICAgdGhpcy5fY3JlYXRlUG9wdXAodGhpcy5jb250YWluZXIsIG51bGwsIHRoaXMuZGF0YSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHRoaXMuY29udGFpbmVyOwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIFVuZGVybGluZUFubm90YXRpb25FbGVtZW50OwogICAgfShBbm5vdGF0aW9uRWxlbWVudCk7CgogICAgdmFyIFNxdWlnZ2x5QW5ub3RhdGlvbkVsZW1lbnQgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9Bbm5vdGF0aW9uRWxlbWVudDE0KSB7CiAgICAgIF9pbmhlcml0cyhTcXVpZ2dseUFubm90YXRpb25FbGVtZW50LCBfQW5ub3RhdGlvbkVsZW1lbnQxNCk7CgogICAgICBmdW5jdGlvbiBTcXVpZ2dseUFubm90YXRpb25FbGVtZW50KHBhcmFtZXRlcnMpIHsKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgU3F1aWdnbHlBbm5vdGF0aW9uRWxlbWVudCk7CgogICAgICAgIHZhciBpc1JlbmRlcmFibGUgPSAhIShwYXJhbWV0ZXJzLmRhdGEuaGFzUG9wdXAgfHwgcGFyYW1ldGVycy5kYXRhLnRpdGxlIHx8IHBhcmFtZXRlcnMuZGF0YS5jb250ZW50cyk7CiAgICAgICAgcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihTcXVpZ2dseUFubm90YXRpb25FbGVtZW50KS5jYWxsKHRoaXMsIHBhcmFtZXRlcnMsIGlzUmVuZGVyYWJsZSwgdHJ1ZSkpOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoU3F1aWdnbHlBbm5vdGF0aW9uRWxlbWVudCwgW3sKICAgICAgICBrZXk6ICJyZW5kZXIiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICAgICAgICB0aGlzLmNvbnRhaW5lci5jbGFzc05hbWUgPSAic3F1aWdnbHlBbm5vdGF0aW9uIjsKCiAgICAgICAgICBpZiAoIXRoaXMuZGF0YS5oYXNQb3B1cCkgewogICAgICAgICAgICB0aGlzLl9jcmVhdGVQb3B1cCh0aGlzLmNvbnRhaW5lciwgbnVsbCwgdGhpcy5kYXRhKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gdGhpcy5jb250YWluZXI7CiAgICAgICAgfQogICAgICB9XSk7CgogICAgICByZXR1cm4gU3F1aWdnbHlBbm5vdGF0aW9uRWxlbWVudDsKICAgIH0oQW5ub3RhdGlvbkVsZW1lbnQpOwoKICAgIHZhciBTdHJpa2VPdXRBbm5vdGF0aW9uRWxlbWVudCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0Fubm90YXRpb25FbGVtZW50MTUpIHsKICAgICAgX2luaGVyaXRzKFN0cmlrZU91dEFubm90YXRpb25FbGVtZW50LCBfQW5ub3RhdGlvbkVsZW1lbnQxNSk7CgogICAgICBmdW5jdGlvbiBTdHJpa2VPdXRBbm5vdGF0aW9uRWxlbWVudChwYXJhbWV0ZXJzKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFN0cmlrZU91dEFubm90YXRpb25FbGVtZW50KTsKCiAgICAgICAgdmFyIGlzUmVuZGVyYWJsZSA9ICEhKHBhcmFtZXRlcnMuZGF0YS5oYXNQb3B1cCB8fCBwYXJhbWV0ZXJzLmRhdGEudGl0bGUgfHwgcGFyYW1ldGVycy5kYXRhLmNvbnRlbnRzKTsKICAgICAgICByZXR1cm4gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKFN0cmlrZU91dEFubm90YXRpb25FbGVtZW50KS5jYWxsKHRoaXMsIHBhcmFtZXRlcnMsIGlzUmVuZGVyYWJsZSwgdHJ1ZSkpOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoU3RyaWtlT3V0QW5ub3RhdGlvbkVsZW1lbnQsIFt7CiAgICAgICAga2V5OiAicmVuZGVyIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICAgICAgdGhpcy5jb250YWluZXIuY2xhc3NOYW1lID0gInN0cmlrZW91dEFubm90YXRpb24iOwoKICAgICAgICAgIGlmICghdGhpcy5kYXRhLmhhc1BvcHVwKSB7CiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZVBvcHVwKHRoaXMuY29udGFpbmVyLCBudWxsLCB0aGlzLmRhdGEpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB0aGlzLmNvbnRhaW5lcjsKICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBTdHJpa2VPdXRBbm5vdGF0aW9uRWxlbWVudDsKICAgIH0oQW5ub3RhdGlvbkVsZW1lbnQpOwoKICAgIHZhciBTdGFtcEFubm90YXRpb25FbGVtZW50ID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQW5ub3RhdGlvbkVsZW1lbnQxNikgewogICAgICBfaW5oZXJpdHMoU3RhbXBBbm5vdGF0aW9uRWxlbWVudCwgX0Fubm90YXRpb25FbGVtZW50MTYpOwoKICAgICAgZnVuY3Rpb24gU3RhbXBBbm5vdGF0aW9uRWxlbWVudChwYXJhbWV0ZXJzKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFN0YW1wQW5ub3RhdGlvbkVsZW1lbnQpOwoKICAgICAgICB2YXIgaXNSZW5kZXJhYmxlID0gISEocGFyYW1ldGVycy5kYXRhLmhhc1BvcHVwIHx8IHBhcmFtZXRlcnMuZGF0YS50aXRsZSB8fCBwYXJhbWV0ZXJzLmRhdGEuY29udGVudHMpOwogICAgICAgIHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoU3RhbXBBbm5vdGF0aW9uRWxlbWVudCkuY2FsbCh0aGlzLCBwYXJhbWV0ZXJzLCBpc1JlbmRlcmFibGUsIHRydWUpKTsKICAgICAgfQoKICAgICAgX2NyZWF0ZUNsYXNzKFN0YW1wQW5ub3RhdGlvbkVsZW1lbnQsIFt7CiAgICAgICAga2V5OiAicmVuZGVyIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICAgICAgdGhpcy5jb250YWluZXIuY2xhc3NOYW1lID0gInN0YW1wQW5ub3RhdGlvbiI7CgogICAgICAgICAgaWYgKCF0aGlzLmRhdGEuaGFzUG9wdXApIHsKICAgICAgICAgICAgdGhpcy5fY3JlYXRlUG9wdXAodGhpcy5jb250YWluZXIsIG51bGwsIHRoaXMuZGF0YSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHRoaXMuY29udGFpbmVyOwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIFN0YW1wQW5ub3RhdGlvbkVsZW1lbnQ7CiAgICB9KEFubm90YXRpb25FbGVtZW50KTsKCiAgICB2YXIgRmlsZUF0dGFjaG1lbnRBbm5vdGF0aW9uRWxlbWVudCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0Fubm90YXRpb25FbGVtZW50MTcpIHsKICAgICAgX2luaGVyaXRzKEZpbGVBdHRhY2htZW50QW5ub3RhdGlvbkVsZW1lbnQsIF9Bbm5vdGF0aW9uRWxlbWVudDE3KTsKCiAgICAgIGZ1bmN0aW9uIEZpbGVBdHRhY2htZW50QW5ub3RhdGlvbkVsZW1lbnQocGFyYW1ldGVycykgewogICAgICAgIHZhciBfdGhpczY7CgogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBGaWxlQXR0YWNobWVudEFubm90YXRpb25FbGVtZW50KTsKCiAgICAgICAgX3RoaXM2ID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKEZpbGVBdHRhY2htZW50QW5ub3RhdGlvbkVsZW1lbnQpLmNhbGwodGhpcywgcGFyYW1ldGVycywgdHJ1ZSkpOwogICAgICAgIHZhciBfdGhpczYkZGF0YSRmaWxlID0gX3RoaXM2LmRhdGEuZmlsZSwKICAgICAgICAgIGZpbGVuYW1lID0gX3RoaXM2JGRhdGEkZmlsZS5maWxlbmFtZSwKICAgICAgICAgIGNvbnRlbnQgPSBfdGhpczYkZGF0YSRmaWxlLmNvbnRlbnQ7CiAgICAgICAgX3RoaXM2LmZpbGVuYW1lID0gKDAsIF9kaXNwbGF5X3V0aWxzLmdldEZpbGVuYW1lRnJvbVVybCkoZmlsZW5hbWUpOwogICAgICAgIF90aGlzNi5jb250ZW50ID0gY29udGVudDsKCiAgICAgICAgaWYgKF90aGlzNi5saW5rU2VydmljZS5ldmVudEJ1cykgewogICAgICAgICAgX3RoaXM2LmxpbmtTZXJ2aWNlLmV2ZW50QnVzLmRpc3BhdGNoKCJmaWxlYXR0YWNobWVudGFubm90YXRpb24iLCB7CiAgICAgICAgICAgIHNvdXJjZTogX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpczYpLAogICAgICAgICAgICBpZDogKDAsIF91dGlsLnN0cmluZ1RvUERGU3RyaW5nKShmaWxlbmFtZSksCiAgICAgICAgICAgIGZpbGVuYW1lOiBmaWxlbmFtZSwKICAgICAgICAgICAgY29udGVudDogY29udGVudAogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gX3RoaXM2OwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoRmlsZUF0dGFjaG1lbnRBbm5vdGF0aW9uRWxlbWVudCwgW3sKICAgICAgICBrZXk6ICJyZW5kZXIiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICAgICAgICB0aGlzLmNvbnRhaW5lci5jbGFzc05hbWUgPSAiZmlsZUF0dGFjaG1lbnRBbm5vdGF0aW9uIjsKICAgICAgICAgIHZhciB0cmlnZ2VyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgICB0cmlnZ2VyLnN0eWxlLmhlaWdodCA9IHRoaXMuY29udGFpbmVyLnN0eWxlLmhlaWdodDsKICAgICAgICAgIHRyaWdnZXIuc3R5bGUud2lkdGggPSB0aGlzLmNvbnRhaW5lci5zdHlsZS53aWR0aDsKICAgICAgICAgIHRyaWdnZXIuYWRkRXZlbnRMaXN0ZW5lcigiZGJsY2xpY2siLCB0aGlzLl9kb3dubG9hZC5iaW5kKHRoaXMpKTsKCiAgICAgICAgICBpZiAoIXRoaXMuZGF0YS5oYXNQb3B1cCAmJiAodGhpcy5kYXRhLnRpdGxlIHx8IHRoaXMuZGF0YS5jb250ZW50cykpIHsKICAgICAgICAgICAgdGhpcy5fY3JlYXRlUG9wdXAodGhpcy5jb250YWluZXIsIHRyaWdnZXIsIHRoaXMuZGF0YSk7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQodHJpZ2dlcik7CiAgICAgICAgICByZXR1cm4gdGhpcy5jb250YWluZXI7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiX2Rvd25sb2FkIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX2Rvd25sb2FkKCkgewogICAgICAgICAgaWYgKCF0aGlzLmRvd25sb2FkTWFuYWdlcikgewogICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIkRvd25sb2FkIGNhbm5vdCBiZSBzdGFydGVkIGR1ZSB0byB1bmF2YWlsYWJsZSBkb3dubG9hZCBtYW5hZ2VyIik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLmRvd25sb2FkTWFuYWdlci5kb3dubG9hZERhdGEodGhpcy5jb250ZW50LCB0aGlzLmZpbGVuYW1lLCAiIik7CiAgICAgICAgfQogICAgICB9XSk7CgogICAgICByZXR1cm4gRmlsZUF0dGFjaG1lbnRBbm5vdGF0aW9uRWxlbWVudDsKICAgIH0oQW5ub3RhdGlvbkVsZW1lbnQpOwoKICAgIHZhciBBbm5vdGF0aW9uTGF5ZXIgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBBbm5vdGF0aW9uTGF5ZXIoKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEFubm90YXRpb25MYXllcik7CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhBbm5vdGF0aW9uTGF5ZXIsIG51bGwsIFt7CiAgICAgICAga2V5OiAicmVuZGVyIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKHBhcmFtZXRlcnMpIHsKICAgICAgICAgIHZhciBzb3J0ZWRBbm5vdGF0aW9ucyA9IFtdLAogICAgICAgICAgICBwb3B1cEFubm90YXRpb25zID0gW107CiAgICAgICAgICB2YXIgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjUgPSB0cnVlOwogICAgICAgICAgdmFyIF9kaWRJdGVyYXRvckVycm9yNSA9IGZhbHNlOwogICAgICAgICAgdmFyIF9pdGVyYXRvckVycm9yNSA9IHVuZGVmaW5lZDsKCiAgICAgICAgICB0cnkgewogICAgICAgICAgICBmb3IgKHZhciBfaXRlcmF0b3I1ID0gcGFyYW1ldGVycy5hbm5vdGF0aW9uc1tTeW1ib2wuaXRlcmF0b3JdKCksIF9zdGVwNTsgIShfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uNSA9IChfc3RlcDUgPSBfaXRlcmF0b3I1Lm5leHQoKSkuZG9uZSk7IF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb241ID0gdHJ1ZSkgewogICAgICAgICAgICAgIHZhciBkYXRhID0gX3N0ZXA1LnZhbHVlOwoKICAgICAgICAgICAgICBpZiAoIWRhdGEpIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGRhdGEuYW5ub3RhdGlvblR5cGUgPT09IF91dGlsLkFubm90YXRpb25UeXBlLlBPUFVQKSB7CiAgICAgICAgICAgICAgICBwb3B1cEFubm90YXRpb25zLnB1c2goZGF0YSk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHNvcnRlZEFubm90YXRpb25zLnB1c2goZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvcjUgPSB0cnVlOwogICAgICAgICAgICBfaXRlcmF0b3JFcnJvcjUgPSBlcnI7CiAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGlmICghX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjUgJiYgX2l0ZXJhdG9yNVsicmV0dXJuIl0gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgX2l0ZXJhdG9yNVsicmV0dXJuIl0oKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgaWYgKF9kaWRJdGVyYXRvckVycm9yNSkgewogICAgICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3I1OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmIChwb3B1cEFubm90YXRpb25zLmxlbmd0aCkgewogICAgICAgICAgICBzb3J0ZWRBbm5vdGF0aW9ucy5wdXNoLmFwcGx5KHNvcnRlZEFubm90YXRpb25zLCBwb3B1cEFubm90YXRpb25zKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9zb3J0ZWRBbm5vdGF0aW9ucyA9IHNvcnRlZEFubm90YXRpb25zOyBfaSA8IF9zb3J0ZWRBbm5vdGF0aW9ucy5sZW5ndGg7IF9pKyspIHsKICAgICAgICAgICAgdmFyIF9kYXRhID0gX3NvcnRlZEFubm90YXRpb25zW19pXTsKICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBBbm5vdGF0aW9uRWxlbWVudEZhY3RvcnkuY3JlYXRlKHsKICAgICAgICAgICAgICBkYXRhOiBfZGF0YSwKICAgICAgICAgICAgICBsYXllcjogcGFyYW1ldGVycy5kaXYsCiAgICAgICAgICAgICAgcGFnZTogcGFyYW1ldGVycy5wYWdlLAogICAgICAgICAgICAgIHZpZXdwb3J0OiBwYXJhbWV0ZXJzLnZpZXdwb3J0LAogICAgICAgICAgICAgIGxpbmtTZXJ2aWNlOiBwYXJhbWV0ZXJzLmxpbmtTZXJ2aWNlLAogICAgICAgICAgICAgIGRvd25sb2FkTWFuYWdlcjogcGFyYW1ldGVycy5kb3dubG9hZE1hbmFnZXIsCiAgICAgICAgICAgICAgaW1hZ2VSZXNvdXJjZXNQYXRoOiBwYXJhbWV0ZXJzLmltYWdlUmVzb3VyY2VzUGF0aCB8fCAiIiwKICAgICAgICAgICAgICByZW5kZXJJbnRlcmFjdGl2ZUZvcm1zOiBwYXJhbWV0ZXJzLnJlbmRlckludGVyYWN0aXZlRm9ybXMgfHwgZmFsc2UsCiAgICAgICAgICAgICAgc3ZnRmFjdG9yeTogbmV3IF9kaXNwbGF5X3V0aWxzLkRPTVNWR0ZhY3RvcnkoKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChlbGVtZW50LmlzUmVuZGVyYWJsZSkgewogICAgICAgICAgICAgIHBhcmFtZXRlcnMuZGl2LmFwcGVuZENoaWxkKGVsZW1lbnQucmVuZGVyKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAidXBkYXRlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gdXBkYXRlKHBhcmFtZXRlcnMpIHsKICAgICAgICAgIHZhciBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uNiA9IHRydWU7CiAgICAgICAgICB2YXIgX2RpZEl0ZXJhdG9yRXJyb3I2ID0gZmFsc2U7CiAgICAgICAgICB2YXIgX2l0ZXJhdG9yRXJyb3I2ID0gdW5kZWZpbmVkOwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZvciAodmFyIF9pdGVyYXRvcjYgPSBwYXJhbWV0ZXJzLmFubm90YXRpb25zW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3N0ZXA2OyAhKF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb242ID0gKF9zdGVwNiA9IF9pdGVyYXRvcjYubmV4dCgpKS5kb25lKTsgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjYgPSB0cnVlKSB7CiAgICAgICAgICAgICAgdmFyIGRhdGEgPSBfc3RlcDYudmFsdWU7CiAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBwYXJhbWV0ZXJzLmRpdi5xdWVyeVNlbGVjdG9yKCJbZGF0YS1hbm5vdGF0aW9uLWlkPVwiIi5jb25jYXQoZGF0YS5pZCwgIlwiXSIpKTsKCiAgICAgICAgICAgICAgaWYgKGVsZW1lbnQpIHsKICAgICAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUudHJhbnNmb3JtID0gIm1hdHJpeCgiLmNvbmNhdChwYXJhbWV0ZXJzLnZpZXdwb3J0LnRyYW5zZm9ybS5qb2luKCIsIiksICIpIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgX2RpZEl0ZXJhdG9yRXJyb3I2ID0gdHJ1ZTsKICAgICAgICAgICAgX2l0ZXJhdG9yRXJyb3I2ID0gZXJyOwogICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb242ICYmIF9pdGVyYXRvcjZbInJldHVybiJdICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIF9pdGVyYXRvcjZbInJldHVybiJdKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgIGlmIChfZGlkSXRlcmF0b3JFcnJvcjYpIHsKICAgICAgICAgICAgICAgIHRocm93IF9pdGVyYXRvckVycm9yNjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBwYXJhbWV0ZXJzLmRpdi5yZW1vdmVBdHRyaWJ1dGUoImhpZGRlbiIpOwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIEFubm90YXRpb25MYXllcjsKICAgIH0oKTsKCiAgICBleHBvcnRzLkFubm90YXRpb25MYXllciA9IEFubm90YXRpb25MYXllcjsKCiAgICAvKioqL30pLCAoCiAgLyogMjA3ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgIHZhbHVlOiB0cnVlCiAgICB9KTsKICAgIGV4cG9ydHMuU1ZHR3JhcGhpY3MgPSB2b2lkIDA7CgogICAgdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygxKTsKCiAgICB2YXIgX2Rpc3BsYXlfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE5NCk7CgogICAgdmFyIF9pc19ub2RlID0gX193X3BkZmpzX3JlcXVpcmVfXyg0OCk7CgogICAgZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikge3JldHVybiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5KGFycikgfHwgX25vbkl0ZXJhYmxlU3ByZWFkKCk7fQoKICAgIGZ1bmN0aW9uIF9ub25JdGVyYWJsZVNwcmVhZCgpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gc3ByZWFkIG5vbi1pdGVyYWJsZSBpbnN0YW5jZSIpO30KCiAgICBmdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5KGl0ZXIpIHtpZiAoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChpdGVyKSB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoaXRlcikgPT09ICJbb2JqZWN0IEFyZ3VtZW50c10iKSByZXR1cm4gQXJyYXkuZnJvbShpdGVyKTt9CgogICAgZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzKGFycikge2lmIChBcnJheS5pc0FycmF5KGFycikpIHtmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShhcnIubGVuZ3RoKTsgaSA8IGFyci5sZW5ndGg7IGkrKykge2FycjJbaV0gPSBhcnJbaV07fXJldHVybiBhcnIyO319CgogICAgZnVuY3Rpb24gX3NsaWNlZFRvQXJyYXkoYXJyLCBpKSB7cmV0dXJuIF9hcnJheVdpdGhIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHx8IF9ub25JdGVyYWJsZVJlc3QoKTt9CgogICAgZnVuY3Rpb24gX25vbkl0ZXJhYmxlUmVzdCgpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7fQoKICAgIGZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHtpZiAoIShTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGFycikgfHwgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGFycikgPT09ICJbb2JqZWN0IEFyZ3VtZW50c10iKSkge3JldHVybjt9dmFyIF9hcnIgPSBbXTt2YXIgX24gPSB0cnVlO3ZhciBfZCA9IGZhbHNlO3ZhciBfZSA9IHVuZGVmaW5lZDt0cnkge2ZvciAodmFyIF9pID0gYXJyW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3M7ICEoX24gPSAoX3MgPSBfaS5uZXh0KCkpLmRvbmUpOyBfbiA9IHRydWUpIHtfYXJyLnB1c2goX3MudmFsdWUpO2lmIChpICYmIF9hcnIubGVuZ3RoID09PSBpKSBicmVhazt9fSBjYXRjaCAoZXJyKSB7X2QgPSB0cnVlO19lID0gZXJyO30gZmluYWxseSB7dHJ5IHtpZiAoIV9uICYmIF9pWyJyZXR1cm4iXSAhPSBudWxsKSBfaVsicmV0dXJuIl0oKTt9IGZpbmFsbHkge2lmIChfZCkgdGhyb3cgX2U7fX1yZXR1cm4gX2Fycjt9CgogICAgZnVuY3Rpb24gX2FycmF5V2l0aEhvbGVzKGFycikge2lmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBhcnI7fQoKICAgIGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHtpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpO319CgogICAgZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykge2ZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHt2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldO2Rlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTtkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7aWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7T2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpO319CgogICAgZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykge2lmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpO2lmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTtyZXR1cm4gQ29uc3RydWN0b3I7fQoKICAgIHZhciBTVkdHcmFwaGljcyA9IGZ1bmN0aW9uIFNWR0dyYXBoaWNzKCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vdCBpbXBsZW1lbnRlZDogU1ZHR3JhcGhpY3MiKTsKICAgIH07CgogICAgZXhwb3J0cy5TVkdHcmFwaGljcyA9IFNWR0dyYXBoaWNzOwogICAgewogICAgICB2YXIgb3BMaXN0VG9UcmVlID0gZnVuY3Rpb24gb3BMaXN0VG9UcmVlKG9wTGlzdCkgewogICAgICAgIHZhciBvcFRyZWUgPSBbXTsKICAgICAgICB2YXIgdG1wID0gW107CiAgICAgICAgdmFyIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSB0cnVlOwogICAgICAgIHZhciBfZGlkSXRlcmF0b3JFcnJvciA9IGZhbHNlOwogICAgICAgIHZhciBfaXRlcmF0b3JFcnJvciA9IHVuZGVmaW5lZDsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgIGZvciAodmFyIF9pdGVyYXRvciA9IG9wTGlzdFtTeW1ib2wuaXRlcmF0b3JdKCksIF9zdGVwOyAhKF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSAoX3N0ZXAgPSBfaXRlcmF0b3IubmV4dCgpKS5kb25lKTsgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IHRydWUpIHsKICAgICAgICAgICAgdmFyIG9wTGlzdEVsZW1lbnQgPSBfc3RlcC52YWx1ZTsKCiAgICAgICAgICAgIGlmIChvcExpc3RFbGVtZW50LmZuID09PSAic2F2ZSIpIHsKICAgICAgICAgICAgICBvcFRyZWUucHVzaCh7CiAgICAgICAgICAgICAgICBmbklkOiA5MiwKICAgICAgICAgICAgICAgIGZuOiAiZ3JvdXAiLAogICAgICAgICAgICAgICAgaXRlbXM6IFtdCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgdG1wLnB1c2gob3BUcmVlKTsKICAgICAgICAgICAgICBvcFRyZWUgPSBvcFRyZWVbb3BUcmVlLmxlbmd0aCAtIDFdLml0ZW1zOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAob3BMaXN0RWxlbWVudC5mbiA9PT0gInJlc3RvcmUiKSB7CiAgICAgICAgICAgICAgb3BUcmVlID0gdG1wLnBvcCgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIG9wVHJlZS5wdXNoKG9wTGlzdEVsZW1lbnQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvciA9IHRydWU7CiAgICAgICAgICBfaXRlcmF0b3JFcnJvciA9IGVycjsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uICYmIF9pdGVyYXRvclsicmV0dXJuIl0gIT0gbnVsbCkgewogICAgICAgICAgICAgIF9pdGVyYXRvclsicmV0dXJuIl0oKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKF9kaWRJdGVyYXRvckVycm9yKSB7CiAgICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3I7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBvcFRyZWU7CiAgICAgIH07CgogICAgICB2YXIgcGYgPSBmdW5jdGlvbiBwZih2YWx1ZSkgewogICAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKHZhbHVlKSkgewogICAgICAgICAgcmV0dXJuIHZhbHVlLnRvU3RyaW5nKCk7CiAgICAgICAgfQoKICAgICAgICB2YXIgcyA9IHZhbHVlLnRvRml4ZWQoMTApOwogICAgICAgIHZhciBpID0gcy5sZW5ndGggLSAxOwoKICAgICAgICBpZiAoc1tpXSAhPT0gIjAiKSB7CiAgICAgICAgICByZXR1cm4gczsKICAgICAgICB9CgogICAgICAgIGRvIHsKICAgICAgICAgIGktLTsKICAgICAgICB9IHdoaWxlIChzW2ldID09PSAiMCIpOwoKICAgICAgICByZXR1cm4gcy5zdWJzdHJpbmcoMCwgc1tpXSA9PT0gIi4iID8gaSA6IGkgKyAxKTsKICAgICAgfTsKCiAgICAgIHZhciBwbSA9IGZ1bmN0aW9uIHBtKG0pIHsKICAgICAgICBpZiAobVs0XSA9PT0gMCAmJiBtWzVdID09PSAwKSB7CiAgICAgICAgICBpZiAobVsxXSA9PT0gMCAmJiBtWzJdID09PSAwKSB7CiAgICAgICAgICAgIGlmIChtWzBdID09PSAxICYmIG1bM10gPT09IDEpIHsKICAgICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAic2NhbGUoIi5jb25jYXQocGYobVswXSksICIgIikuY29uY2F0KHBmKG1bM10pLCAiKSIpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChtWzBdID09PSBtWzNdICYmIG1bMV0gPT09IC1tWzJdKSB7CiAgICAgICAgICAgIHZhciBhID0gTWF0aC5hY29zKG1bMF0pICogMTgwIC8gTWF0aC5QSTsKICAgICAgICAgICAgcmV0dXJuICJyb3RhdGUoIi5jb25jYXQocGYoYSksICIpIik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChtWzBdID09PSAxICYmIG1bMV0gPT09IDAgJiYgbVsyXSA9PT0gMCAmJiBtWzNdID09PSAxKSB7CiAgICAgICAgICAgIHJldHVybiAidHJhbnNsYXRlKCIuY29uY2F0KHBmKG1bNF0pLCAiICIpLmNvbmNhdChwZihtWzVdKSwgIikiKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiAibWF0cml4KCIuY29uY2F0KHBmKG1bMF0pLCAiICIpLmNvbmNhdChwZihtWzFdKSwgIiAiKS5jb25jYXQocGYobVsyXSksICIgIikuY29uY2F0KHBmKG1bM10pLCAiICIpLmNvbmNhdChwZihtWzRdKSwgIiAiKSArICIiLmNvbmNhdChwZihtWzVdKSwgIikiKTsKICAgICAgfTsKCiAgICAgIHZhciBTVkdfREVGQVVMVFMgPSB7CiAgICAgICAgZm9udFN0eWxlOiAibm9ybWFsIiwKICAgICAgICBmb250V2VpZ2h0OiAibm9ybWFsIiwKICAgICAgICBmaWxsQ29sb3I6ICIjMDAwMDAwIgogICAgICB9OwogICAgICB2YXIgWE1MX05TID0gImh0dHA6Ly93d3cudzMub3JnL1hNTC8xOTk4L25hbWVzcGFjZSI7CiAgICAgIHZhciBYTElOS19OUyA9ICJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIjsKICAgICAgdmFyIExJTkVfQ0FQX1NUWUxFUyA9IFsiYnV0dCIsICJyb3VuZCIsICJzcXVhcmUiXTsKICAgICAgdmFyIExJTkVfSk9JTl9TVFlMRVMgPSBbIm1pdGVyIiwgInJvdW5kIiwgImJldmVsIl07CgogICAgICB2YXIgY29udmVydEltZ0RhdGFUb1BuZyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgUE5HX0hFQURFUiA9IG5ldyBVaW50OEFycmF5KFsweDg5LCAweDUwLCAweDRlLCAweDQ3LCAweDBkLCAweDBhLCAweDFhLCAweDBhXSk7CiAgICAgICAgdmFyIENIVU5LX1dSQVBQRVJfU0laRSA9IDEyOwogICAgICAgIHZhciBjcmNUYWJsZSA9IG5ldyBJbnQzMkFycmF5KDI1Nik7CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMjU2OyBpKyspIHsKICAgICAgICAgIHZhciBjID0gaTsKCiAgICAgICAgICBmb3IgKHZhciBoID0gMDsgaCA8IDg7IGgrKykgewogICAgICAgICAgICBpZiAoYyAmIDEpIHsKICAgICAgICAgICAgICBjID0gMHhlZGI4ODMyMCBeIGMgPj4gMSAmIDB4N2ZmZmZmZmY7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgYyA9IGMgPj4gMSAmIDB4N2ZmZmZmZmY7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBjcmNUYWJsZVtpXSA9IGM7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBjcmMzMihkYXRhLCBzdGFydCwgZW5kKSB7CiAgICAgICAgICB2YXIgY3JjID0gLTE7CgogICAgICAgICAgZm9yICh2YXIgX2kgPSBzdGFydDsgX2kgPCBlbmQ7IF9pKyspIHsKICAgICAgICAgICAgdmFyIGEgPSAoY3JjIF4gZGF0YVtfaV0pICYgMHhmZjsKICAgICAgICAgICAgdmFyIGIgPSBjcmNUYWJsZVthXTsKICAgICAgICAgICAgY3JjID0gY3JjID4+PiA4IF4gYjsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gY3JjIF4gLTE7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiB3cml0ZVBuZ0NodW5rKHR5cGUsIGJvZHksIGRhdGEsIG9mZnNldCkgewogICAgICAgICAgdmFyIHAgPSBvZmZzZXQ7CiAgICAgICAgICB2YXIgbGVuID0gYm9keS5sZW5ndGg7CiAgICAgICAgICBkYXRhW3BdID0gbGVuID4+IDI0ICYgMHhmZjsKICAgICAgICAgIGRhdGFbcCArIDFdID0gbGVuID4+IDE2ICYgMHhmZjsKICAgICAgICAgIGRhdGFbcCArIDJdID0gbGVuID4+IDggJiAweGZmOwogICAgICAgICAgZGF0YVtwICsgM10gPSBsZW4gJiAweGZmOwogICAgICAgICAgcCArPSA0OwogICAgICAgICAgZGF0YVtwXSA9IHR5cGUuY2hhckNvZGVBdCgwKSAmIDB4ZmY7CiAgICAgICAgICBkYXRhW3AgKyAxXSA9IHR5cGUuY2hhckNvZGVBdCgxKSAmIDB4ZmY7CiAgICAgICAgICBkYXRhW3AgKyAyXSA9IHR5cGUuY2hhckNvZGVBdCgyKSAmIDB4ZmY7CiAgICAgICAgICBkYXRhW3AgKyAzXSA9IHR5cGUuY2hhckNvZGVBdCgzKSAmIDB4ZmY7CiAgICAgICAgICBwICs9IDQ7CiAgICAgICAgICBkYXRhLnNldChib2R5LCBwKTsKICAgICAgICAgIHAgKz0gYm9keS5sZW5ndGg7CiAgICAgICAgICB2YXIgY3JjID0gY3JjMzIoZGF0YSwgb2Zmc2V0ICsgNCwgcCk7CiAgICAgICAgICBkYXRhW3BdID0gY3JjID4+IDI0ICYgMHhmZjsKICAgICAgICAgIGRhdGFbcCArIDFdID0gY3JjID4+IDE2ICYgMHhmZjsKICAgICAgICAgIGRhdGFbcCArIDJdID0gY3JjID4+IDggJiAweGZmOwogICAgICAgICAgZGF0YVtwICsgM10gPSBjcmMgJiAweGZmOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYWRsZXIzMihkYXRhLCBzdGFydCwgZW5kKSB7CiAgICAgICAgICB2YXIgYSA9IDE7CiAgICAgICAgICB2YXIgYiA9IDA7CgogICAgICAgICAgZm9yICh2YXIgX2kyID0gc3RhcnQ7IF9pMiA8IGVuZDsgKytfaTIpIHsKICAgICAgICAgICAgYSA9IChhICsgKGRhdGFbX2kyXSAmIDB4ZmYpKSAlIDY1NTIxOwogICAgICAgICAgICBiID0gKGIgKyBhKSAlIDY1NTIxOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBiIDw8IDE2IHwgYTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGRlZmxhdGVTeW5jKGxpdGVyYWxzKSB7CiAgICAgICAgICBpZiAoIV9pc19ub2RlLmlzTm9kZUpTKSB7CiAgICAgICAgICAgIHJldHVybiBkZWZsYXRlU3luY1VuY29tcHJlc3NlZChsaXRlcmFscyk7CiAgICAgICAgICB9CgogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdmFyIGlucHV0OwoKICAgICAgICAgICAgaWYgKHBhcnNlSW50KHByb2Nlc3MudmVyc2lvbnMubm9kZSkgPj0gOCkgewogICAgICAgICAgICAgIGlucHV0ID0gbGl0ZXJhbHM7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgaW5wdXQgPSBCdWZmZXIuZnJvbShsaXRlcmFscyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBvdXRwdXQgPSByZXF1aXJlKCJ6bGliIikuZGVmbGF0ZVN5bmMoaW5wdXQsIHsKICAgICAgICAgICAgICBsZXZlbDogOQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHJldHVybiBvdXRwdXQgaW5zdGFuY2VvZiBVaW50OEFycmF5ID8gb3V0cHV0IDogbmV3IFVpbnQ4QXJyYXkob3V0cHV0KTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJOb3QgY29tcHJlc3NpbmcgUE5HIGJlY2F1c2UgemxpYi5kZWZsYXRlU3luYyBpcyB1bmF2YWlsYWJsZTogIiArIGUpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBkZWZsYXRlU3luY1VuY29tcHJlc3NlZChsaXRlcmFscyk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBkZWZsYXRlU3luY1VuY29tcHJlc3NlZChsaXRlcmFscykgewogICAgICAgICAgdmFyIGxlbiA9IGxpdGVyYWxzLmxlbmd0aDsKICAgICAgICAgIHZhciBtYXhCbG9ja0xlbmd0aCA9IDB4ZmZmZjsKICAgICAgICAgIHZhciBkZWZsYXRlQmxvY2tzID0gTWF0aC5jZWlsKGxlbiAvIG1heEJsb2NrTGVuZ3RoKTsKICAgICAgICAgIHZhciBpZGF0ID0gbmV3IFVpbnQ4QXJyYXkoMiArIGxlbiArIGRlZmxhdGVCbG9ja3MgKiA1ICsgNCk7CiAgICAgICAgICB2YXIgcGkgPSAwOwogICAgICAgICAgaWRhdFtwaSsrXSA9IDB4Nzg7CiAgICAgICAgICBpZGF0W3BpKytdID0gMHg5YzsKICAgICAgICAgIHZhciBwb3MgPSAwOwoKICAgICAgICAgIHdoaWxlIChsZW4gPiBtYXhCbG9ja0xlbmd0aCkgewogICAgICAgICAgICBpZGF0W3BpKytdID0gMHgwMDsKICAgICAgICAgICAgaWRhdFtwaSsrXSA9IDB4ZmY7CiAgICAgICAgICAgIGlkYXRbcGkrK10gPSAweGZmOwogICAgICAgICAgICBpZGF0W3BpKytdID0gMHgwMDsKICAgICAgICAgICAgaWRhdFtwaSsrXSA9IDB4MDA7CiAgICAgICAgICAgIGlkYXQuc2V0KGxpdGVyYWxzLnN1YmFycmF5KHBvcywgcG9zICsgbWF4QmxvY2tMZW5ndGgpLCBwaSk7CiAgICAgICAgICAgIHBpICs9IG1heEJsb2NrTGVuZ3RoOwogICAgICAgICAgICBwb3MgKz0gbWF4QmxvY2tMZW5ndGg7CiAgICAgICAgICAgIGxlbiAtPSBtYXhCbG9ja0xlbmd0aDsKICAgICAgICAgIH0KCiAgICAgICAgICBpZGF0W3BpKytdID0gMHgwMTsKICAgICAgICAgIGlkYXRbcGkrK10gPSBsZW4gJiAweGZmOwogICAgICAgICAgaWRhdFtwaSsrXSA9IGxlbiA+PiA4ICYgMHhmZjsKICAgICAgICAgIGlkYXRbcGkrK10gPSB+bGVuICYgMHhmZmZmICYgMHhmZjsKICAgICAgICAgIGlkYXRbcGkrK10gPSAofmxlbiAmIDB4ZmZmZikgPj4gOCAmIDB4ZmY7CiAgICAgICAgICBpZGF0LnNldChsaXRlcmFscy5zdWJhcnJheShwb3MpLCBwaSk7CiAgICAgICAgICBwaSArPSBsaXRlcmFscy5sZW5ndGggLSBwb3M7CiAgICAgICAgICB2YXIgYWRsZXIgPSBhZGxlcjMyKGxpdGVyYWxzLCAwLCBsaXRlcmFscy5sZW5ndGgpOwogICAgICAgICAgaWRhdFtwaSsrXSA9IGFkbGVyID4+IDI0ICYgMHhmZjsKICAgICAgICAgIGlkYXRbcGkrK10gPSBhZGxlciA+PiAxNiAmIDB4ZmY7CiAgICAgICAgICBpZGF0W3BpKytdID0gYWRsZXIgPj4gOCAmIDB4ZmY7CiAgICAgICAgICBpZGF0W3BpKytdID0gYWRsZXIgJiAweGZmOwogICAgICAgICAgcmV0dXJuIGlkYXQ7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBlbmNvZGUoaW1nRGF0YSwga2luZCwgZm9yY2VEYXRhU2NoZW1hLCBpc01hc2spIHsKICAgICAgICAgIHZhciB3aWR0aCA9IGltZ0RhdGEud2lkdGg7CiAgICAgICAgICB2YXIgaGVpZ2h0ID0gaW1nRGF0YS5oZWlnaHQ7CiAgICAgICAgICB2YXIgYml0RGVwdGgsIGNvbG9yVHlwZSwgbGluZVNpemU7CiAgICAgICAgICB2YXIgYnl0ZXMgPSBpbWdEYXRhLmRhdGE7CgogICAgICAgICAgc3dpdGNoIChraW5kKSB7CiAgICAgICAgICAgIGNhc2UgX3V0aWwuSW1hZ2VLaW5kLkdSQVlTQ0FMRV8xQlBQOgogICAgICAgICAgICAgIGNvbG9yVHlwZSA9IDA7CiAgICAgICAgICAgICAgYml0RGVwdGggPSAxOwogICAgICAgICAgICAgIGxpbmVTaXplID0gd2lkdGggKyA3ID4+IDM7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIF91dGlsLkltYWdlS2luZC5SR0JfMjRCUFA6CiAgICAgICAgICAgICAgY29sb3JUeXBlID0gMjsKICAgICAgICAgICAgICBiaXREZXB0aCA9IDg7CiAgICAgICAgICAgICAgbGluZVNpemUgPSB3aWR0aCAqIDM7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIF91dGlsLkltYWdlS2luZC5SR0JBXzMyQlBQOgogICAgICAgICAgICAgIGNvbG9yVHlwZSA9IDY7CiAgICAgICAgICAgICAgYml0RGVwdGggPSA4OwogICAgICAgICAgICAgIGxpbmVTaXplID0gd2lkdGggKiA0OwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgZm9ybWF0Iik7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGxpdGVyYWxzID0gbmV3IFVpbnQ4QXJyYXkoKDEgKyBsaW5lU2l6ZSkgKiBoZWlnaHQpOwogICAgICAgICAgdmFyIG9mZnNldExpdGVyYWxzID0gMCwKICAgICAgICAgICAgb2Zmc2V0Qnl0ZXMgPSAwOwoKICAgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgaGVpZ2h0OyArK3kpIHsKICAgICAgICAgICAgbGl0ZXJhbHNbb2Zmc2V0TGl0ZXJhbHMrK10gPSAwOwogICAgICAgICAgICBsaXRlcmFscy5zZXQoYnl0ZXMuc3ViYXJyYXkob2Zmc2V0Qnl0ZXMsIG9mZnNldEJ5dGVzICsgbGluZVNpemUpLCBvZmZzZXRMaXRlcmFscyk7CiAgICAgICAgICAgIG9mZnNldEJ5dGVzICs9IGxpbmVTaXplOwogICAgICAgICAgICBvZmZzZXRMaXRlcmFscyArPSBsaW5lU2l6ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoa2luZCA9PT0gX3V0aWwuSW1hZ2VLaW5kLkdSQVlTQ0FMRV8xQlBQICYmIGlzTWFzaykgewogICAgICAgICAgICBvZmZzZXRMaXRlcmFscyA9IDA7CgogICAgICAgICAgICBmb3IgKHZhciBfeSA9IDA7IF95IDwgaGVpZ2h0OyBfeSsrKSB7CiAgICAgICAgICAgICAgb2Zmc2V0TGl0ZXJhbHMrKzsKCiAgICAgICAgICAgICAgZm9yICh2YXIgX2kzID0gMDsgX2kzIDwgbGluZVNpemU7IF9pMysrKSB7CiAgICAgICAgICAgICAgICBsaXRlcmFsc1tvZmZzZXRMaXRlcmFscysrXSBePSAweGZmOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHZhciBpaGRyID0gbmV3IFVpbnQ4QXJyYXkoW3dpZHRoID4+IDI0ICYgMHhmZiwgd2lkdGggPj4gMTYgJiAweGZmLCB3aWR0aCA+PiA4ICYgMHhmZiwgd2lkdGggJiAweGZmLCBoZWlnaHQgPj4gMjQgJiAweGZmLCBoZWlnaHQgPj4gMTYgJiAweGZmLCBoZWlnaHQgPj4gOCAmIDB4ZmYsIGhlaWdodCAmIDB4ZmYsIGJpdERlcHRoLCBjb2xvclR5cGUsIDB4MDAsIDB4MDAsIDB4MDBdKTsKICAgICAgICAgIHZhciBpZGF0ID0gZGVmbGF0ZVN5bmMobGl0ZXJhbHMpOwogICAgICAgICAgdmFyIHBuZ0xlbmd0aCA9IFBOR19IRUFERVIubGVuZ3RoICsgQ0hVTktfV1JBUFBFUl9TSVpFICogMyArIGloZHIubGVuZ3RoICsgaWRhdC5sZW5ndGg7CiAgICAgICAgICB2YXIgZGF0YSA9IG5ldyBVaW50OEFycmF5KHBuZ0xlbmd0aCk7CiAgICAgICAgICB2YXIgb2Zmc2V0ID0gMDsKICAgICAgICAgIGRhdGEuc2V0KFBOR19IRUFERVIsIG9mZnNldCk7CiAgICAgICAgICBvZmZzZXQgKz0gUE5HX0hFQURFUi5sZW5ndGg7CiAgICAgICAgICB3cml0ZVBuZ0NodW5rKCJJSERSIiwgaWhkciwgZGF0YSwgb2Zmc2V0KTsKICAgICAgICAgIG9mZnNldCArPSBDSFVOS19XUkFQUEVSX1NJWkUgKyBpaGRyLmxlbmd0aDsKICAgICAgICAgIHdyaXRlUG5nQ2h1bmsoIklEQVRBIiwgaWRhdCwgZGF0YSwgb2Zmc2V0KTsKICAgICAgICAgIG9mZnNldCArPSBDSFVOS19XUkFQUEVSX1NJWkUgKyBpZGF0Lmxlbmd0aDsKICAgICAgICAgIHdyaXRlUG5nQ2h1bmsoIklFTkQiLCBuZXcgVWludDhBcnJheSgwKSwgZGF0YSwgb2Zmc2V0KTsKICAgICAgICAgIHJldHVybiAoMCwgX3V0aWwuY3JlYXRlT2JqZWN0VVJMKShkYXRhLCAiaW1hZ2UvcG5nIiwgZm9yY2VEYXRhU2NoZW1hKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBmdW5jdGlvbiBjb252ZXJ0SW1nRGF0YVRvUG5nKGltZ0RhdGEsIGZvcmNlRGF0YVNjaGVtYSwgaXNNYXNrKSB7CiAgICAgICAgICB2YXIga2luZCA9IGltZ0RhdGEua2luZCA9PT0gdW5kZWZpbmVkID8gX3V0aWwuSW1hZ2VLaW5kLkdSQVlTQ0FMRV8xQlBQIDogaW1nRGF0YS5raW5kOwogICAgICAgICAgcmV0dXJuIGVuY29kZShpbWdEYXRhLCBraW5kLCBmb3JjZURhdGFTY2hlbWEsIGlzTWFzayk7CiAgICAgICAgfTsKICAgICAgfSgpOwoKICAgICAgdmFyIFNWR0V4dHJhU3RhdGUgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIFNWR0V4dHJhU3RhdGUoKSB7CiAgICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgU1ZHRXh0cmFTdGF0ZSk7CgogICAgICAgICAgdGhpcy5mb250U2l6ZVNjYWxlID0gMTsKICAgICAgICAgIHRoaXMuZm9udFdlaWdodCA9IFNWR19ERUZBVUxUUy5mb250V2VpZ2h0OwogICAgICAgICAgdGhpcy5mb250U2l6ZSA9IDA7CiAgICAgICAgICB0aGlzLnRleHRNYXRyaXggPSBfdXRpbC5JREVOVElUWV9NQVRSSVg7CiAgICAgICAgICB0aGlzLmZvbnRNYXRyaXggPSBfdXRpbC5GT05UX0lERU5USVRZX01BVFJJWDsKICAgICAgICAgIHRoaXMubGVhZGluZyA9IDA7CiAgICAgICAgICB0aGlzLnRleHRSZW5kZXJpbmdNb2RlID0gX3V0aWwuVGV4dFJlbmRlcmluZ01vZGUuRklMTDsKICAgICAgICAgIHRoaXMudGV4dE1hdHJpeFNjYWxlID0gMTsKICAgICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgICB0aGlzLnkgPSAwOwogICAgICAgICAgdGhpcy5saW5lWCA9IDA7CiAgICAgICAgICB0aGlzLmxpbmVZID0gMDsKICAgICAgICAgIHRoaXMuY2hhclNwYWNpbmcgPSAwOwogICAgICAgICAgdGhpcy53b3JkU3BhY2luZyA9IDA7CiAgICAgICAgICB0aGlzLnRleHRIU2NhbGUgPSAxOwogICAgICAgICAgdGhpcy50ZXh0UmlzZSA9IDA7CiAgICAgICAgICB0aGlzLmZpbGxDb2xvciA9IFNWR19ERUZBVUxUUy5maWxsQ29sb3I7CiAgICAgICAgICB0aGlzLnN0cm9rZUNvbG9yID0gIiMwMDAwMDAiOwogICAgICAgICAgdGhpcy5maWxsQWxwaGEgPSAxOwogICAgICAgICAgdGhpcy5zdHJva2VBbHBoYSA9IDE7CiAgICAgICAgICB0aGlzLmxpbmVXaWR0aCA9IDE7CiAgICAgICAgICB0aGlzLmxpbmVKb2luID0gIiI7CiAgICAgICAgICB0aGlzLmxpbmVDYXAgPSAiIjsKICAgICAgICAgIHRoaXMubWl0ZXJMaW1pdCA9IDA7CiAgICAgICAgICB0aGlzLmRhc2hBcnJheSA9IFtdOwogICAgICAgICAgdGhpcy5kYXNoUGhhc2UgPSAwOwogICAgICAgICAgdGhpcy5kZXBlbmRlbmNpZXMgPSBbXTsKICAgICAgICAgIHRoaXMuYWN0aXZlQ2xpcFVybCA9IG51bGw7CiAgICAgICAgICB0aGlzLmNsaXBHcm91cCA9IG51bGw7CiAgICAgICAgICB0aGlzLm1hc2tJZCA9ICIiOwogICAgICAgIH0KCiAgICAgICAgX2NyZWF0ZUNsYXNzKFNWR0V4dHJhU3RhdGUsIFt7CiAgICAgICAgICBrZXk6ICJjbG9uZSIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY2xvbmUoKSB7CiAgICAgICAgICAgIHJldHVybiBPYmplY3QuY3JlYXRlKHRoaXMpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogInNldEN1cnJlbnRQb2ludCIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gc2V0Q3VycmVudFBvaW50KHgsIHkpIHsKICAgICAgICAgICAgdGhpcy54ID0geDsKICAgICAgICAgICAgdGhpcy55ID0geTsKICAgICAgICAgIH0KICAgICAgICB9XSk7CgogICAgICAgIHJldHVybiBTVkdFeHRyYVN0YXRlOwogICAgICB9KCk7CgogICAgICB2YXIgY2xpcENvdW50ID0gMDsKICAgICAgdmFyIG1hc2tDb3VudCA9IDA7CiAgICAgIHZhciBzaGFkaW5nQ291bnQgPSAwOwoKICAgICAgZXhwb3J0cy5TVkdHcmFwaGljcyA9IFNWR0dyYXBoaWNzID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBTVkdHcmFwaGljcyhjb21tb25PYmpzLCBvYmpzLCBmb3JjZURhdGFTY2hlbWEpIHsKICAgICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBTVkdHcmFwaGljcyk7CgogICAgICAgICAgdGhpcy5zdmdGYWN0b3J5ID0gbmV3IF9kaXNwbGF5X3V0aWxzLkRPTVNWR0ZhY3RvcnkoKTsKICAgICAgICAgIHRoaXMuY3VycmVudCA9IG5ldyBTVkdFeHRyYVN0YXRlKCk7CiAgICAgICAgICB0aGlzLnRyYW5zZm9ybU1hdHJpeCA9IF91dGlsLklERU5USVRZX01BVFJJWDsKICAgICAgICAgIHRoaXMudHJhbnNmb3JtU3RhY2sgPSBbXTsKICAgICAgICAgIHRoaXMuZXh0cmFTdGFjayA9IFtdOwogICAgICAgICAgdGhpcy5jb21tb25PYmpzID0gY29tbW9uT2JqczsKICAgICAgICAgIHRoaXMub2JqcyA9IG9ianM7CiAgICAgICAgICB0aGlzLnBlbmRpbmdDbGlwID0gbnVsbDsKICAgICAgICAgIHRoaXMucGVuZGluZ0VPRmlsbCA9IGZhbHNlOwogICAgICAgICAgdGhpcy5lbWJlZEZvbnRzID0gZmFsc2U7CiAgICAgICAgICB0aGlzLmVtYmVkZGVkRm9udHMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgICAgdGhpcy5jc3NTdHlsZSA9IG51bGw7CiAgICAgICAgICB0aGlzLmZvcmNlRGF0YVNjaGVtYSA9ICEhZm9yY2VEYXRhU2NoZW1hOwogICAgICAgICAgdGhpcy5fb3BlcmF0b3JJZE1hcHBpbmcgPSBbXTsKCiAgICAgICAgICBmb3IgKHZhciBvcCBpbiBfdXRpbC5PUFMpIHsKICAgICAgICAgICAgdGhpcy5fb3BlcmF0b3JJZE1hcHBpbmdbX3V0aWwuT1BTW29wXV0gPSBvcDsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIF9jcmVhdGVDbGFzcyhTVkdHcmFwaGljcywgW3sKICAgICAgICAgIGtleTogInNhdmUiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNhdmUoKSB7CiAgICAgICAgICAgIHRoaXMudHJhbnNmb3JtU3RhY2sucHVzaCh0aGlzLnRyYW5zZm9ybU1hdHJpeCk7CiAgICAgICAgICAgIHZhciBvbGQgPSB0aGlzLmN1cnJlbnQ7CiAgICAgICAgICAgIHRoaXMuZXh0cmFTdGFjay5wdXNoKG9sZCk7CiAgICAgICAgICAgIHRoaXMuY3VycmVudCA9IG9sZC5jbG9uZSgpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogInJlc3RvcmUiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlc3RvcmUoKSB7CiAgICAgICAgICAgIHRoaXMudHJhbnNmb3JtTWF0cml4ID0gdGhpcy50cmFuc2Zvcm1TdGFjay5wb3AoKTsKICAgICAgICAgICAgdGhpcy5jdXJyZW50ID0gdGhpcy5leHRyYVN0YWNrLnBvcCgpOwogICAgICAgICAgICB0aGlzLnBlbmRpbmdDbGlwID0gbnVsbDsKICAgICAgICAgICAgdGhpcy50Z3JwID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJncm91cCIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ3JvdXAoaXRlbXMpIHsKICAgICAgICAgICAgdGhpcy5zYXZlKCk7CiAgICAgICAgICAgIHRoaXMuZXhlY3V0ZU9wVHJlZShpdGVtcyk7CiAgICAgICAgICAgIHRoaXMucmVzdG9yZSgpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogImxvYWREZXBlbmRlbmNpZXMiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGxvYWREZXBlbmRlbmNpZXMob3BlcmF0b3JMaXN0KSB7CiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAgICAgICB2YXIgZm5BcnJheSA9IG9wZXJhdG9yTGlzdC5mbkFycmF5OwogICAgICAgICAgICB2YXIgYXJnc0FycmF5ID0gb3BlcmF0b3JMaXN0LmFyZ3NBcnJheTsKCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGZuQXJyYXkubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICAgIGlmIChmbkFycmF5W2ldICE9PSBfdXRpbC5PUFMuZGVwZW5kZW5jeSkgewogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIgPSB0cnVlOwogICAgICAgICAgICAgIHZhciBfZGlkSXRlcmF0b3JFcnJvcjIgPSBmYWxzZTsKICAgICAgICAgICAgICB2YXIgX2l0ZXJhdG9yRXJyb3IyID0gdW5kZWZpbmVkOwoKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdmFyIF9sb29wID0gZnVuY3Rpb24gX2xvb3AoKSB7CiAgICAgICAgICAgICAgICAgIHZhciBvYmogPSBfc3RlcDIudmFsdWU7CiAgICAgICAgICAgICAgICAgIHZhciBvYmpzUG9vbCA9IG9iai5zdGFydHNXaXRoKCJnXyIpID8gX3RoaXMuY29tbW9uT2JqcyA6IF90aGlzLm9ianM7CiAgICAgICAgICAgICAgICAgIHZhciBwcm9taXNlID0gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICAgICAgICAgICAgICBvYmpzUG9vbC5nZXQob2JqLCByZXNvbHZlKTsKICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICBfdGhpcy5jdXJyZW50LmRlcGVuZGVuY2llcy5wdXNoKHByb21pc2UpOwogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICBmb3IgKHZhciBfaXRlcmF0b3IyID0gYXJnc0FycmF5W2ldW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3N0ZXAyOyAhKF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yID0gKF9zdGVwMiA9IF9pdGVyYXRvcjIubmV4dCgpKS5kb25lKTsgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIgPSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgIF9sb29wKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvcjIgPSB0cnVlOwogICAgICAgICAgICAgICAgX2l0ZXJhdG9yRXJyb3IyID0gZXJyOwogICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yICYmIF9pdGVyYXRvcjJbInJldHVybiJdICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBfaXRlcmF0b3IyWyJyZXR1cm4iXSgpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICBpZiAoX2RpZEl0ZXJhdG9yRXJyb3IyKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3IyOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwodGhpcy5jdXJyZW50LmRlcGVuZGVuY2llcyk7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAidHJhbnNmb3JtIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiB0cmFuc2Zvcm0oYSwgYiwgYywgZCwgZSwgZikgewogICAgICAgICAgICB2YXIgdHJhbnNmb3JtTWF0cml4ID0gW2EsIGIsIGMsIGQsIGUsIGZdOwogICAgICAgICAgICB0aGlzLnRyYW5zZm9ybU1hdHJpeCA9IF91dGlsLlV0aWwudHJhbnNmb3JtKHRoaXMudHJhbnNmb3JtTWF0cml4LCB0cmFuc2Zvcm1NYXRyaXgpOwogICAgICAgICAgICB0aGlzLnRncnAgPSBudWxsOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogImdldFNWRyIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0U1ZHKG9wZXJhdG9yTGlzdCwgdmlld3BvcnQpIHsKICAgICAgICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICAgICAgICB0aGlzLnZpZXdwb3J0ID0gdmlld3BvcnQ7CgogICAgICAgICAgICB2YXIgc3ZnRWxlbWVudCA9IHRoaXMuX2luaXRpYWxpemUodmlld3BvcnQpOwoKICAgICAgICAgICAgcmV0dXJuIHRoaXMubG9hZERlcGVuZGVuY2llcyhvcGVyYXRvckxpc3QpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIF90aGlzMi50cmFuc2Zvcm1NYXRyaXggPSBfdXRpbC5JREVOVElUWV9NQVRSSVg7CgogICAgICAgICAgICAgIF90aGlzMi5leGVjdXRlT3BUcmVlKF90aGlzMi5jb252ZXJ0T3BMaXN0KG9wZXJhdG9yTGlzdCkpOwoKICAgICAgICAgICAgICByZXR1cm4gc3ZnRWxlbWVudDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAiY29udmVydE9wTGlzdCIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY29udmVydE9wTGlzdChvcGVyYXRvckxpc3QpIHsKICAgICAgICAgICAgdmFyIG9wZXJhdG9ySWRNYXBwaW5nID0gdGhpcy5fb3BlcmF0b3JJZE1hcHBpbmc7CiAgICAgICAgICAgIHZhciBhcmdzQXJyYXkgPSBvcGVyYXRvckxpc3QuYXJnc0FycmF5OwogICAgICAgICAgICB2YXIgZm5BcnJheSA9IG9wZXJhdG9yTGlzdC5mbkFycmF5OwogICAgICAgICAgICB2YXIgb3BMaXN0ID0gW107CgogICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBmbkFycmF5Lmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgICB2YXIgZm5JZCA9IGZuQXJyYXlbaV07CiAgICAgICAgICAgICAgb3BMaXN0LnB1c2goewogICAgICAgICAgICAgICAgZm5JZDogZm5JZCwKICAgICAgICAgICAgICAgIGZuOiBvcGVyYXRvcklkTWFwcGluZ1tmbklkXSwKICAgICAgICAgICAgICAgIGFyZ3M6IGFyZ3NBcnJheVtpXQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gb3BMaXN0VG9UcmVlKG9wTGlzdCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAiZXhlY3V0ZU9wVHJlZSIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZXhlY3V0ZU9wVHJlZShvcFRyZWUpIHsKICAgICAgICAgICAgdmFyIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24zID0gdHJ1ZTsKICAgICAgICAgICAgdmFyIF9kaWRJdGVyYXRvckVycm9yMyA9IGZhbHNlOwogICAgICAgICAgICB2YXIgX2l0ZXJhdG9yRXJyb3IzID0gdW5kZWZpbmVkOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBmb3IgKHZhciBfaXRlcmF0b3IzID0gb3BUcmVlW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3N0ZXAzOyAhKF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24zID0gKF9zdGVwMyA9IF9pdGVyYXRvcjMubmV4dCgpKS5kb25lKTsgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjMgPSB0cnVlKSB7CiAgICAgICAgICAgICAgICB2YXIgb3BUcmVlRWxlbWVudCA9IF9zdGVwMy52YWx1ZTsKICAgICAgICAgICAgICAgIHZhciBmbiA9IG9wVHJlZUVsZW1lbnQuZm47CiAgICAgICAgICAgICAgICB2YXIgZm5JZCA9IG9wVHJlZUVsZW1lbnQuZm5JZDsKICAgICAgICAgICAgICAgIHZhciBhcmdzID0gb3BUcmVlRWxlbWVudC5hcmdzOwoKICAgICAgICAgICAgICAgIHN3aXRjaCAoZm5JZCB8IDApIHsKICAgICAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMuYmVnaW5UZXh0OgogICAgICAgICAgICAgICAgICAgIHRoaXMuYmVnaW5UZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5kZXBlbmRlbmN5OgogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0TGVhZGluZzoKICAgICAgICAgICAgICAgICAgICB0aGlzLnNldExlYWRpbmcoYXJncyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5zZXRMZWFkaW5nTW92ZVRleHQ6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRMZWFkaW5nTW92ZVRleHQoYXJnc1swXSwgYXJnc1sxXSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5zZXRGb250OgogICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0Rm9udChhcmdzKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNob3dUZXh0OgogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1RleHQoYXJnc1swXSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5zaG93U3BhY2VkVGV4dDoKICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dUZXh0KGFyZ3NbMF0pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMuZW5kVGV4dDoKICAgICAgICAgICAgICAgICAgICB0aGlzLmVuZFRleHQoKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLm1vdmVUZXh0OgogICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZVRleHQoYXJnc1swXSwgYXJnc1sxXSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5zZXRDaGFyU3BhY2luZzoKICAgICAgICAgICAgICAgICAgICB0aGlzLnNldENoYXJTcGFjaW5nKGFyZ3NbMF0pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0V29yZFNwYWNpbmc6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRXb3JkU3BhY2luZyhhcmdzWzBdKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNldEhTY2FsZToKICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEhTY2FsZShhcmdzWzBdKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNldFRleHRNYXRyaXg6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRUZXh0TWF0cml4KGFyZ3NbMF0sIGFyZ3NbMV0sIGFyZ3NbMl0sIGFyZ3NbM10sIGFyZ3NbNF0sIGFyZ3NbNV0pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0VGV4dFJpc2U6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRUZXh0UmlzZShhcmdzWzBdKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNldFRleHRSZW5kZXJpbmdNb2RlOgogICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0VGV4dFJlbmRlcmluZ01vZGUoYXJnc1swXSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5zZXRMaW5lV2lkdGg6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRMaW5lV2lkdGgoYXJnc1swXSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5zZXRMaW5lSm9pbjoKICAgICAgICAgICAgICAgICAgICB0aGlzLnNldExpbmVKb2luKGFyZ3NbMF0pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0TGluZUNhcDoKICAgICAgICAgICAgICAgICAgICB0aGlzLnNldExpbmVDYXAoYXJnc1swXSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5zZXRNaXRlckxpbWl0OgogICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0TWl0ZXJMaW1pdChhcmdzWzBdKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNldEZpbGxSR0JDb2xvcjoKICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEZpbGxSR0JDb2xvcihhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNldFN0cm9rZVJHQkNvbG9yOgogICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0U3Ryb2tlUkdCQ29sb3IoYXJnc1swXSwgYXJnc1sxXSwgYXJnc1syXSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5zZXRTdHJva2VDb2xvck46CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdHJva2VDb2xvck4oYXJncyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5zZXRGaWxsQ29sb3JOOgogICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0RmlsbENvbG9yTihhcmdzKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNoYWRpbmdGaWxsOgogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hhZGluZ0ZpbGwoYXJnc1swXSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5zZXREYXNoOgogICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0RGFzaChhcmdzWzBdLCBhcmdzWzFdKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNldFJlbmRlcmluZ0ludGVudDoKICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFJlbmRlcmluZ0ludGVudChhcmdzWzBdKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNldEZsYXRuZXNzOgogICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0RmxhdG5lc3MoYXJnc1swXSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5zZXRHU3RhdGU6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRHU3RhdGUoYXJnc1swXSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5maWxsOgogICAgICAgICAgICAgICAgICAgIHRoaXMuZmlsbCgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMuZW9GaWxsOgogICAgICAgICAgICAgICAgICAgIHRoaXMuZW9GaWxsKCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5zdHJva2U6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdHJva2UoKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLmZpbGxTdHJva2U6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWxsU3Ryb2tlKCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5lb0ZpbGxTdHJva2U6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lb0ZpbGxTdHJva2UoKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLmNsaXA6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGlwKCJub256ZXJvIik7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5lb0NsaXA6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGlwKCJldmVub2RkIik7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5wYWludFNvbGlkQ29sb3JJbWFnZU1hc2s6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYWludFNvbGlkQ29sb3JJbWFnZU1hc2soKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnBhaW50SnBlZ1hPYmplY3Q6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYWludEpwZWdYT2JqZWN0KGFyZ3NbMF0sIGFyZ3NbMV0sIGFyZ3NbMl0pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMucGFpbnRJbWFnZVhPYmplY3Q6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYWludEltYWdlWE9iamVjdChhcmdzWzBdKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnBhaW50SW5saW5lSW1hZ2VYT2JqZWN0OgogICAgICAgICAgICAgICAgICAgIHRoaXMucGFpbnRJbmxpbmVJbWFnZVhPYmplY3QoYXJnc1swXSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5wYWludEltYWdlTWFza1hPYmplY3Q6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYWludEltYWdlTWFza1hPYmplY3QoYXJnc1swXSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5wYWludEZvcm1YT2JqZWN0QmVnaW46CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYWludEZvcm1YT2JqZWN0QmVnaW4oYXJnc1swXSwgYXJnc1sxXSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5wYWludEZvcm1YT2JqZWN0RW5kOgogICAgICAgICAgICAgICAgICAgIHRoaXMucGFpbnRGb3JtWE9iamVjdEVuZCgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMuY2xvc2VQYXRoOgogICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VQYXRoKCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5jbG9zZVN0cm9rZToKICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlU3Ryb2tlKCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5jbG9zZUZpbGxTdHJva2U6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZUZpbGxTdHJva2UoKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLmNsb3NlRU9GaWxsU3Ryb2tlOgogICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VFT0ZpbGxTdHJva2UoKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLm5leHRMaW5lOgogICAgICAgICAgICAgICAgICAgIHRoaXMubmV4dExpbmUoKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnRyYW5zZm9ybToKICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zZm9ybShhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdLCBhcmdzWzNdLCBhcmdzWzRdLCBhcmdzWzVdKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLmNvbnN0cnVjdFBhdGg6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25zdHJ1Y3RQYXRoKGFyZ3NbMF0sIGFyZ3NbMV0pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMuZW5kUGF0aDoKICAgICAgICAgICAgICAgICAgICB0aGlzLmVuZFBhdGgoKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgOTI6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5ncm91cChvcFRyZWVFbGVtZW50Lml0ZW1zKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJVbmltcGxlbWVudGVkIG9wZXJhdG9yICIuY29uY2F0KGZuKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvcjMgPSB0cnVlOwogICAgICAgICAgICAgIF9pdGVyYXRvckVycm9yMyA9IGVycjsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYgKCFfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMyAmJiBfaXRlcmF0b3IzWyJyZXR1cm4iXSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgIF9pdGVyYXRvcjNbInJldHVybiJdKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIGlmIChfZGlkSXRlcmF0b3JFcnJvcjMpIHsKICAgICAgICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3IzOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogInNldFdvcmRTcGFjaW5nIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRXb3JkU3BhY2luZyh3b3JkU3BhY2luZykgewogICAgICAgICAgICB0aGlzLmN1cnJlbnQud29yZFNwYWNpbmcgPSB3b3JkU3BhY2luZzsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJzZXRDaGFyU3BhY2luZyIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gc2V0Q2hhclNwYWNpbmcoY2hhclNwYWNpbmcpIHsKICAgICAgICAgICAgdGhpcy5jdXJyZW50LmNoYXJTcGFjaW5nID0gY2hhclNwYWNpbmc7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAibmV4dExpbmUiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIG5leHRMaW5lKCkgewogICAgICAgICAgICB0aGlzLm1vdmVUZXh0KDAsIHRoaXMuY3VycmVudC5sZWFkaW5nKTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJzZXRUZXh0TWF0cml4IiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRUZXh0TWF0cml4KGEsIGIsIGMsIGQsIGUsIGYpIHsKICAgICAgICAgICAgdmFyIGN1cnJlbnQgPSB0aGlzLmN1cnJlbnQ7CiAgICAgICAgICAgIGN1cnJlbnQudGV4dE1hdHJpeCA9IGN1cnJlbnQubGluZU1hdHJpeCA9IFthLCBiLCBjLCBkLCBlLCBmXTsKICAgICAgICAgICAgY3VycmVudC50ZXh0TWF0cml4U2NhbGUgPSBNYXRoLnNxcnQoYSAqIGEgKyBiICogYik7CiAgICAgICAgICAgIGN1cnJlbnQueCA9IGN1cnJlbnQubGluZVggPSAwOwogICAgICAgICAgICBjdXJyZW50LnkgPSBjdXJyZW50LmxpbmVZID0gMDsKICAgICAgICAgICAgY3VycmVudC54Y29vcmRzID0gW107CiAgICAgICAgICAgIGN1cnJlbnQudHNwYW4gPSB0aGlzLnN2Z0ZhY3RvcnkuY3JlYXRlRWxlbWVudCgic3ZnOnRzcGFuIik7CiAgICAgICAgICAgIGN1cnJlbnQudHNwYW4uc2V0QXR0cmlidXRlTlMobnVsbCwgImZvbnQtZmFtaWx5IiwgY3VycmVudC5mb250RmFtaWx5KTsKICAgICAgICAgICAgY3VycmVudC50c3Bhbi5zZXRBdHRyaWJ1dGVOUyhudWxsLCAiZm9udC1zaXplIiwgIiIuY29uY2F0KHBmKGN1cnJlbnQuZm9udFNpemUpLCAicHgiKSk7CiAgICAgICAgICAgIGN1cnJlbnQudHNwYW4uc2V0QXR0cmlidXRlTlMobnVsbCwgInkiLCBwZigtY3VycmVudC55KSk7CiAgICAgICAgICAgIGN1cnJlbnQudHh0RWxlbWVudCA9IHRoaXMuc3ZnRmFjdG9yeS5jcmVhdGVFbGVtZW50KCJzdmc6dGV4dCIpOwogICAgICAgICAgICBjdXJyZW50LnR4dEVsZW1lbnQuYXBwZW5kQ2hpbGQoY3VycmVudC50c3Bhbik7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAiYmVnaW5UZXh0IiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBiZWdpblRleHQoKSB7CiAgICAgICAgICAgIHZhciBjdXJyZW50ID0gdGhpcy5jdXJyZW50OwogICAgICAgICAgICBjdXJyZW50LnggPSBjdXJyZW50LmxpbmVYID0gMDsKICAgICAgICAgICAgY3VycmVudC55ID0gY3VycmVudC5saW5lWSA9IDA7CiAgICAgICAgICAgIGN1cnJlbnQudGV4dE1hdHJpeCA9IF91dGlsLklERU5USVRZX01BVFJJWDsKICAgICAgICAgICAgY3VycmVudC5saW5lTWF0cml4ID0gX3V0aWwuSURFTlRJVFlfTUFUUklYOwogICAgICAgICAgICBjdXJyZW50LnRleHRNYXRyaXhTY2FsZSA9IDE7CiAgICAgICAgICAgIGN1cnJlbnQudHNwYW4gPSB0aGlzLnN2Z0ZhY3RvcnkuY3JlYXRlRWxlbWVudCgic3ZnOnRzcGFuIik7CiAgICAgICAgICAgIGN1cnJlbnQudHh0RWxlbWVudCA9IHRoaXMuc3ZnRmFjdG9yeS5jcmVhdGVFbGVtZW50KCJzdmc6dGV4dCIpOwogICAgICAgICAgICBjdXJyZW50LnR4dGdycCA9IHRoaXMuc3ZnRmFjdG9yeS5jcmVhdGVFbGVtZW50KCJzdmc6ZyIpOwogICAgICAgICAgICBjdXJyZW50Lnhjb29yZHMgPSBbXTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJtb3ZlVGV4dCIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gbW92ZVRleHQoeCwgeSkgewogICAgICAgICAgICB2YXIgY3VycmVudCA9IHRoaXMuY3VycmVudDsKICAgICAgICAgICAgY3VycmVudC54ID0gY3VycmVudC5saW5lWCArPSB4OwogICAgICAgICAgICBjdXJyZW50LnkgPSBjdXJyZW50LmxpbmVZICs9IHk7CiAgICAgICAgICAgIGN1cnJlbnQueGNvb3JkcyA9IFtdOwogICAgICAgICAgICBjdXJyZW50LnRzcGFuID0gdGhpcy5zdmdGYWN0b3J5LmNyZWF0ZUVsZW1lbnQoInN2Zzp0c3BhbiIpOwogICAgICAgICAgICBjdXJyZW50LnRzcGFuLnNldEF0dHJpYnV0ZU5TKG51bGwsICJmb250LWZhbWlseSIsIGN1cnJlbnQuZm9udEZhbWlseSk7CiAgICAgICAgICAgIGN1cnJlbnQudHNwYW4uc2V0QXR0cmlidXRlTlMobnVsbCwgImZvbnQtc2l6ZSIsICIiLmNvbmNhdChwZihjdXJyZW50LmZvbnRTaXplKSwgInB4IikpOwogICAgICAgICAgICBjdXJyZW50LnRzcGFuLnNldEF0dHJpYnV0ZU5TKG51bGwsICJ5IiwgcGYoLWN1cnJlbnQueSkpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogInNob3dUZXh0IiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzaG93VGV4dChnbHlwaHMpIHsKICAgICAgICAgICAgdmFyIGN1cnJlbnQgPSB0aGlzLmN1cnJlbnQ7CiAgICAgICAgICAgIHZhciBmb250ID0gY3VycmVudC5mb250OwogICAgICAgICAgICB2YXIgZm9udFNpemUgPSBjdXJyZW50LmZvbnRTaXplOwoKICAgICAgICAgICAgaWYgKGZvbnRTaXplID09PSAwKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgY2hhclNwYWNpbmcgPSBjdXJyZW50LmNoYXJTcGFjaW5nOwogICAgICAgICAgICB2YXIgd29yZFNwYWNpbmcgPSBjdXJyZW50LndvcmRTcGFjaW5nOwogICAgICAgICAgICB2YXIgZm9udERpcmVjdGlvbiA9IGN1cnJlbnQuZm9udERpcmVjdGlvbjsKICAgICAgICAgICAgdmFyIHRleHRIU2NhbGUgPSBjdXJyZW50LnRleHRIU2NhbGUgKiBmb250RGlyZWN0aW9uOwogICAgICAgICAgICB2YXIgdmVydGljYWwgPSBmb250LnZlcnRpY2FsOwogICAgICAgICAgICB2YXIgd2lkdGhBZHZhbmNlU2NhbGUgPSBmb250U2l6ZSAqIGN1cnJlbnQuZm9udE1hdHJpeFswXTsKICAgICAgICAgICAgdmFyIHggPSAwOwogICAgICAgICAgICB2YXIgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjQgPSB0cnVlOwogICAgICAgICAgICB2YXIgX2RpZEl0ZXJhdG9yRXJyb3I0ID0gZmFsc2U7CiAgICAgICAgICAgIHZhciBfaXRlcmF0b3JFcnJvcjQgPSB1bmRlZmluZWQ7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGZvciAodmFyIF9pdGVyYXRvcjQgPSBnbHlwaHNbU3ltYm9sLml0ZXJhdG9yXSgpLCBfc3RlcDQ7ICEoX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjQgPSAoX3N0ZXA0ID0gX2l0ZXJhdG9yNC5uZXh0KCkpLmRvbmUpOyBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uNCA9IHRydWUpIHsKICAgICAgICAgICAgICAgIHZhciBnbHlwaCA9IF9zdGVwNC52YWx1ZTsKCiAgICAgICAgICAgICAgICBpZiAoZ2x5cGggPT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgeCArPSBmb250RGlyZWN0aW9uICogd29yZFNwYWNpbmc7CiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICgoMCwgX3V0aWwuaXNOdW0pKGdseXBoKSkgewogICAgICAgICAgICAgICAgICB4ICs9IC1nbHlwaCAqIGZvbnRTaXplICogMC4wMDE7CiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHZhciB3aWR0aCA9IGdseXBoLndpZHRoOwogICAgICAgICAgICAgICAgdmFyIGNoYXJhY3RlciA9IGdseXBoLmZvbnRDaGFyOwogICAgICAgICAgICAgICAgdmFyIHNwYWNpbmcgPSAoZ2x5cGguaXNTcGFjZSA/IHdvcmRTcGFjaW5nIDogMCkgKyBjaGFyU3BhY2luZzsKICAgICAgICAgICAgICAgIHZhciBjaGFyV2lkdGggPSB3aWR0aCAqIHdpZHRoQWR2YW5jZVNjYWxlICsgc3BhY2luZyAqIGZvbnREaXJlY3Rpb247CgogICAgICAgICAgICAgICAgaWYgKCFnbHlwaC5pc0luRm9udCAmJiAhZm9udC5taXNzaW5nRmlsZSkgewogICAgICAgICAgICAgICAgICB4ICs9IGNoYXJXaWR0aDsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY3VycmVudC54Y29vcmRzLnB1c2goY3VycmVudC54ICsgeCk7CiAgICAgICAgICAgICAgICBjdXJyZW50LnRzcGFuLnRleHRDb250ZW50ICs9IGNoYXJhY3RlcjsKICAgICAgICAgICAgICAgIHggKz0gY2hhcldpZHRoOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgX2RpZEl0ZXJhdG9yRXJyb3I0ID0gdHJ1ZTsKICAgICAgICAgICAgICBfaXRlcmF0b3JFcnJvcjQgPSBlcnI7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICghX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjQgJiYgX2l0ZXJhdG9yNFsicmV0dXJuIl0gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICBfaXRlcmF0b3I0WyJyZXR1cm4iXSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBpZiAoX2RpZEl0ZXJhdG9yRXJyb3I0KSB7CiAgICAgICAgICAgICAgICAgIHRocm93IF9pdGVyYXRvckVycm9yNDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh2ZXJ0aWNhbCkgewogICAgICAgICAgICAgIGN1cnJlbnQueSAtPSB4ICogdGV4dEhTY2FsZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBjdXJyZW50LnggKz0geCAqIHRleHRIU2NhbGU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGN1cnJlbnQudHNwYW4uc2V0QXR0cmlidXRlTlMobnVsbCwgIngiLCBjdXJyZW50Lnhjb29yZHMubWFwKHBmKS5qb2luKCIgIikpOwogICAgICAgICAgICBjdXJyZW50LnRzcGFuLnNldEF0dHJpYnV0ZU5TKG51bGwsICJ5IiwgcGYoLWN1cnJlbnQueSkpOwogICAgICAgICAgICBjdXJyZW50LnRzcGFuLnNldEF0dHJpYnV0ZU5TKG51bGwsICJmb250LWZhbWlseSIsIGN1cnJlbnQuZm9udEZhbWlseSk7CiAgICAgICAgICAgIGN1cnJlbnQudHNwYW4uc2V0QXR0cmlidXRlTlMobnVsbCwgImZvbnQtc2l6ZSIsICIiLmNvbmNhdChwZihjdXJyZW50LmZvbnRTaXplKSwgInB4IikpOwoKICAgICAgICAgICAgaWYgKGN1cnJlbnQuZm9udFN0eWxlICE9PSBTVkdfREVGQVVMVFMuZm9udFN0eWxlKSB7CiAgICAgICAgICAgICAgY3VycmVudC50c3Bhbi5zZXRBdHRyaWJ1dGVOUyhudWxsLCAiZm9udC1zdHlsZSIsIGN1cnJlbnQuZm9udFN0eWxlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGN1cnJlbnQuZm9udFdlaWdodCAhPT0gU1ZHX0RFRkFVTFRTLmZvbnRXZWlnaHQpIHsKICAgICAgICAgICAgICBjdXJyZW50LnRzcGFuLnNldEF0dHJpYnV0ZU5TKG51bGwsICJmb250LXdlaWdodCIsIGN1cnJlbnQuZm9udFdlaWdodCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBmaWxsU3Ryb2tlTW9kZSA9IGN1cnJlbnQudGV4dFJlbmRlcmluZ01vZGUgJiBfdXRpbC5UZXh0UmVuZGVyaW5nTW9kZS5GSUxMX1NUUk9LRV9NQVNLOwoKICAgICAgICAgICAgaWYgKGZpbGxTdHJva2VNb2RlID09PSBfdXRpbC5UZXh0UmVuZGVyaW5nTW9kZS5GSUxMIHx8IGZpbGxTdHJva2VNb2RlID09PSBfdXRpbC5UZXh0UmVuZGVyaW5nTW9kZS5GSUxMX1NUUk9LRSkgewogICAgICAgICAgICAgIGlmIChjdXJyZW50LmZpbGxDb2xvciAhPT0gU1ZHX0RFRkFVTFRTLmZpbGxDb2xvcikgewogICAgICAgICAgICAgICAgY3VycmVudC50c3Bhbi5zZXRBdHRyaWJ1dGVOUyhudWxsLCAiZmlsbCIsIGN1cnJlbnQuZmlsbENvbG9yKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChjdXJyZW50LmZpbGxBbHBoYSA8IDEpIHsKICAgICAgICAgICAgICAgIGN1cnJlbnQudHNwYW4uc2V0QXR0cmlidXRlTlMobnVsbCwgImZpbGwtb3BhY2l0eSIsIGN1cnJlbnQuZmlsbEFscGhhKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoY3VycmVudC50ZXh0UmVuZGVyaW5nTW9kZSA9PT0gX3V0aWwuVGV4dFJlbmRlcmluZ01vZGUuQUREX1RPX1BBVEgpIHsKICAgICAgICAgICAgICBjdXJyZW50LnRzcGFuLnNldEF0dHJpYnV0ZU5TKG51bGwsICJmaWxsIiwgInRyYW5zcGFyZW50Iik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgY3VycmVudC50c3Bhbi5zZXRBdHRyaWJ1dGVOUyhudWxsLCAiZmlsbCIsICJub25lIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmaWxsU3Ryb2tlTW9kZSA9PT0gX3V0aWwuVGV4dFJlbmRlcmluZ01vZGUuU1RST0tFIHx8IGZpbGxTdHJva2VNb2RlID09PSBfdXRpbC5UZXh0UmVuZGVyaW5nTW9kZS5GSUxMX1NUUk9LRSkgewogICAgICAgICAgICAgIHZhciBsaW5lV2lkdGhTY2FsZSA9IDEgLyAoY3VycmVudC50ZXh0TWF0cml4U2NhbGUgfHwgMSk7CgogICAgICAgICAgICAgIHRoaXMuX3NldFN0cm9rZUF0dHJpYnV0ZXMoY3VycmVudC50c3BhbiwgbGluZVdpZHRoU2NhbGUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgdGV4dE1hdHJpeCA9IGN1cnJlbnQudGV4dE1hdHJpeDsKCiAgICAgICAgICAgIGlmIChjdXJyZW50LnRleHRSaXNlICE9PSAwKSB7CiAgICAgICAgICAgICAgdGV4dE1hdHJpeCA9IHRleHRNYXRyaXguc2xpY2UoKTsKICAgICAgICAgICAgICB0ZXh0TWF0cml4WzVdICs9IGN1cnJlbnQudGV4dFJpc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGN1cnJlbnQudHh0RWxlbWVudC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAidHJhbnNmb3JtIiwgIiIuY29uY2F0KHBtKHRleHRNYXRyaXgpLCAiIHNjYWxlKCIpLmNvbmNhdChwZih0ZXh0SFNjYWxlKSwgIiwgLTEpIikpOwogICAgICAgICAgICBjdXJyZW50LnR4dEVsZW1lbnQuc2V0QXR0cmlidXRlTlMoWE1MX05TLCAieG1sOnNwYWNlIiwgInByZXNlcnZlIik7CiAgICAgICAgICAgIGN1cnJlbnQudHh0RWxlbWVudC5hcHBlbmRDaGlsZChjdXJyZW50LnRzcGFuKTsKICAgICAgICAgICAgY3VycmVudC50eHRncnAuYXBwZW5kQ2hpbGQoY3VycmVudC50eHRFbGVtZW50KTsKCiAgICAgICAgICAgIHRoaXMuX2Vuc3VyZVRyYW5zZm9ybUdyb3VwKCkuYXBwZW5kQ2hpbGQoY3VycmVudC50eHRFbGVtZW50KTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJzZXRMZWFkaW5nTW92ZVRleHQiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNldExlYWRpbmdNb3ZlVGV4dCh4LCB5KSB7CiAgICAgICAgICAgIHRoaXMuc2V0TGVhZGluZygteSk7CiAgICAgICAgICAgIHRoaXMubW92ZVRleHQoeCwgeSk7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAiYWRkRm9udFN0eWxlIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRGb250U3R5bGUoZm9udE9iaikgewogICAgICAgICAgICBpZiAoIXRoaXMuY3NzU3R5bGUpIHsKICAgICAgICAgICAgICB0aGlzLmNzc1N0eWxlID0gdGhpcy5zdmdGYWN0b3J5LmNyZWF0ZUVsZW1lbnQoInN2ZzpzdHlsZSIpOwogICAgICAgICAgICAgIHRoaXMuY3NzU3R5bGUuc2V0QXR0cmlidXRlTlMobnVsbCwgInR5cGUiLCAidGV4dC9jc3MiKTsKICAgICAgICAgICAgICB0aGlzLmRlZnMuYXBwZW5kQ2hpbGQodGhpcy5jc3NTdHlsZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciB1cmwgPSAoMCwgX3V0aWwuY3JlYXRlT2JqZWN0VVJMKShmb250T2JqLmRhdGEsIGZvbnRPYmoubWltZXR5cGUsIHRoaXMuZm9yY2VEYXRhU2NoZW1hKTsKICAgICAgICAgICAgdGhpcy5jc3NTdHlsZS50ZXh0Q29udGVudCArPSAiQGZvbnQtZmFjZSB7IGZvbnQtZmFtaWx5OiBcIiIuY29uY2F0KGZvbnRPYmoubG9hZGVkTmFtZSwgIlwiOyIpICsgIiBzcmM6IHVybCgiLmNvbmNhdCh1cmwsICIpOyB9XG4iKTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJzZXRGb250IiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRGb250KGRldGFpbHMpIHsKICAgICAgICAgICAgdmFyIGN1cnJlbnQgPSB0aGlzLmN1cnJlbnQ7CiAgICAgICAgICAgIHZhciBmb250T2JqID0gdGhpcy5jb21tb25PYmpzLmdldChkZXRhaWxzWzBdKTsKICAgICAgICAgICAgdmFyIHNpemUgPSBkZXRhaWxzWzFdOwogICAgICAgICAgICBjdXJyZW50LmZvbnQgPSBmb250T2JqOwoKICAgICAgICAgICAgaWYgKHRoaXMuZW1iZWRGb250cyAmJiBmb250T2JqLmRhdGEgJiYgIXRoaXMuZW1iZWRkZWRGb250c1tmb250T2JqLmxvYWRlZE5hbWVdKSB7CiAgICAgICAgICAgICAgdGhpcy5hZGRGb250U3R5bGUoZm9udE9iaik7CiAgICAgICAgICAgICAgdGhpcy5lbWJlZGRlZEZvbnRzW2ZvbnRPYmoubG9hZGVkTmFtZV0gPSBmb250T2JqOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjdXJyZW50LmZvbnRNYXRyaXggPSBmb250T2JqLmZvbnRNYXRyaXggPyBmb250T2JqLmZvbnRNYXRyaXggOiBfdXRpbC5GT05UX0lERU5USVRZX01BVFJJWDsKICAgICAgICAgICAgdmFyIGJvbGQgPSAibm9ybWFsIjsKCiAgICAgICAgICAgIGlmIChmb250T2JqLmJsYWNrKSB7CiAgICAgICAgICAgICAgYm9sZCA9ICI5MDAiOwogICAgICAgICAgICB9IGVsc2UgaWYgKGZvbnRPYmouYm9sZCkgewogICAgICAgICAgICAgIGJvbGQgPSAiYm9sZCI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBpdGFsaWMgPSBmb250T2JqLml0YWxpYyA/ICJpdGFsaWMiIDogIm5vcm1hbCI7CgogICAgICAgICAgICBpZiAoc2l6ZSA8IDApIHsKICAgICAgICAgICAgICBzaXplID0gLXNpemU7CiAgICAgICAgICAgICAgY3VycmVudC5mb250RGlyZWN0aW9uID0gLTE7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgY3VycmVudC5mb250RGlyZWN0aW9uID0gMTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY3VycmVudC5mb250U2l6ZSA9IHNpemU7CiAgICAgICAgICAgIGN1cnJlbnQuZm9udEZhbWlseSA9IGZvbnRPYmoubG9hZGVkTmFtZTsKICAgICAgICAgICAgY3VycmVudC5mb250V2VpZ2h0ID0gYm9sZDsKICAgICAgICAgICAgY3VycmVudC5mb250U3R5bGUgPSBpdGFsaWM7CiAgICAgICAgICAgIGN1cnJlbnQudHNwYW4gPSB0aGlzLnN2Z0ZhY3RvcnkuY3JlYXRlRWxlbWVudCgic3ZnOnRzcGFuIik7CiAgICAgICAgICAgIGN1cnJlbnQudHNwYW4uc2V0QXR0cmlidXRlTlMobnVsbCwgInkiLCBwZigtY3VycmVudC55KSk7CiAgICAgICAgICAgIGN1cnJlbnQueGNvb3JkcyA9IFtdOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogImVuZFRleHQiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGVuZFRleHQoKSB7CiAgICAgICAgICAgIHZhciBjdXJyZW50ID0gdGhpcy5jdXJyZW50OwoKICAgICAgICAgICAgaWYgKGN1cnJlbnQudGV4dFJlbmRlcmluZ01vZGUgJiBfdXRpbC5UZXh0UmVuZGVyaW5nTW9kZS5BRERfVE9fUEFUSF9GTEFHICYmIGN1cnJlbnQudHh0RWxlbWVudCAmJiBjdXJyZW50LnR4dEVsZW1lbnQuaGFzQ2hpbGROb2RlcygpKSB7CiAgICAgICAgICAgICAgY3VycmVudC5lbGVtZW50ID0gY3VycmVudC50eHRFbGVtZW50OwogICAgICAgICAgICAgIHRoaXMuY2xpcCgibm9uemVybyIpOwogICAgICAgICAgICAgIHRoaXMuZW5kUGF0aCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAic2V0TGluZVdpZHRoIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRMaW5lV2lkdGgod2lkdGgpIHsKICAgICAgICAgICAgaWYgKHdpZHRoID4gMCkgewogICAgICAgICAgICAgIHRoaXMuY3VycmVudC5saW5lV2lkdGggPSB3aWR0aDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogInNldExpbmVDYXAiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNldExpbmVDYXAoc3R5bGUpIHsKICAgICAgICAgICAgdGhpcy5jdXJyZW50LmxpbmVDYXAgPSBMSU5FX0NBUF9TVFlMRVNbc3R5bGVdOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogInNldExpbmVKb2luIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRMaW5lSm9pbihzdHlsZSkgewogICAgICAgICAgICB0aGlzLmN1cnJlbnQubGluZUpvaW4gPSBMSU5FX0pPSU5fU1RZTEVTW3N0eWxlXTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJzZXRNaXRlckxpbWl0IiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRNaXRlckxpbWl0KGxpbWl0KSB7CiAgICAgICAgICAgIHRoaXMuY3VycmVudC5taXRlckxpbWl0ID0gbGltaXQ7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAic2V0U3Ryb2tlQWxwaGEiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNldFN0cm9rZUFscGhhKHN0cm9rZUFscGhhKSB7CiAgICAgICAgICAgIHRoaXMuY3VycmVudC5zdHJva2VBbHBoYSA9IHN0cm9rZUFscGhhOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogInNldFN0cm9rZVJHQkNvbG9yIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRTdHJva2VSR0JDb2xvcihyLCBnLCBiKSB7CiAgICAgICAgICAgIHRoaXMuY3VycmVudC5zdHJva2VDb2xvciA9IF91dGlsLlV0aWwubWFrZUNzc1JnYihyLCBnLCBiKTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJzZXRGaWxsQWxwaGEiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNldEZpbGxBbHBoYShmaWxsQWxwaGEpIHsKICAgICAgICAgICAgdGhpcy5jdXJyZW50LmZpbGxBbHBoYSA9IGZpbGxBbHBoYTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJzZXRGaWxsUkdCQ29sb3IiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNldEZpbGxSR0JDb2xvcihyLCBnLCBiKSB7CiAgICAgICAgICAgIHRoaXMuY3VycmVudC5maWxsQ29sb3IgPSBfdXRpbC5VdGlsLm1ha2VDc3NSZ2IociwgZywgYik7CiAgICAgICAgICAgIHRoaXMuY3VycmVudC50c3BhbiA9IHRoaXMuc3ZnRmFjdG9yeS5jcmVhdGVFbGVtZW50KCJzdmc6dHNwYW4iKTsKICAgICAgICAgICAgdGhpcy5jdXJyZW50Lnhjb29yZHMgPSBbXTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJzZXRTdHJva2VDb2xvck4iLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNldFN0cm9rZUNvbG9yTihhcmdzKSB7CiAgICAgICAgICAgIHRoaXMuY3VycmVudC5zdHJva2VDb2xvciA9IHRoaXMuX21ha2VDb2xvck5fUGF0dGVybihhcmdzKTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJzZXRGaWxsQ29sb3JOIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRGaWxsQ29sb3JOKGFyZ3MpIHsKICAgICAgICAgICAgdGhpcy5jdXJyZW50LmZpbGxDb2xvciA9IHRoaXMuX21ha2VDb2xvck5fUGF0dGVybihhcmdzKTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJzaGFkaW5nRmlsbCIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gc2hhZGluZ0ZpbGwoYXJncykgewogICAgICAgICAgICB2YXIgd2lkdGggPSB0aGlzLnZpZXdwb3J0LndpZHRoOwogICAgICAgICAgICB2YXIgaGVpZ2h0ID0gdGhpcy52aWV3cG9ydC5oZWlnaHQ7CgogICAgICAgICAgICB2YXIgaW52ID0gX3V0aWwuVXRpbC5pbnZlcnNlVHJhbnNmb3JtKHRoaXMudHJhbnNmb3JtTWF0cml4KTsKCiAgICAgICAgICAgIHZhciBibCA9IF91dGlsLlV0aWwuYXBwbHlUcmFuc2Zvcm0oWzAsIDBdLCBpbnYpOwoKICAgICAgICAgICAgdmFyIGJyID0gX3V0aWwuVXRpbC5hcHBseVRyYW5zZm9ybShbMCwgaGVpZ2h0XSwgaW52KTsKCiAgICAgICAgICAgIHZhciB1bCA9IF91dGlsLlV0aWwuYXBwbHlUcmFuc2Zvcm0oW3dpZHRoLCAwXSwgaW52KTsKCiAgICAgICAgICAgIHZhciB1ciA9IF91dGlsLlV0aWwuYXBwbHlUcmFuc2Zvcm0oW3dpZHRoLCBoZWlnaHRdLCBpbnYpOwoKICAgICAgICAgICAgdmFyIHgwID0gTWF0aC5taW4oYmxbMF0sIGJyWzBdLCB1bFswXSwgdXJbMF0pOwogICAgICAgICAgICB2YXIgeTAgPSBNYXRoLm1pbihibFsxXSwgYnJbMV0sIHVsWzFdLCB1clsxXSk7CiAgICAgICAgICAgIHZhciB4MSA9IE1hdGgubWF4KGJsWzBdLCBiclswXSwgdWxbMF0sIHVyWzBdKTsKICAgICAgICAgICAgdmFyIHkxID0gTWF0aC5tYXgoYmxbMV0sIGJyWzFdLCB1bFsxXSwgdXJbMV0pOwogICAgICAgICAgICB2YXIgcmVjdCA9IHRoaXMuc3ZnRmFjdG9yeS5jcmVhdGVFbGVtZW50KCJzdmc6cmVjdCIpOwogICAgICAgICAgICByZWN0LnNldEF0dHJpYnV0ZU5TKG51bGwsICJ4IiwgeDApOwogICAgICAgICAgICByZWN0LnNldEF0dHJpYnV0ZU5TKG51bGwsICJ5IiwgeTApOwogICAgICAgICAgICByZWN0LnNldEF0dHJpYnV0ZU5TKG51bGwsICJ3aWR0aCIsIHgxIC0geDApOwogICAgICAgICAgICByZWN0LnNldEF0dHJpYnV0ZU5TKG51bGwsICJoZWlnaHQiLCB5MSAtIHkwKTsKICAgICAgICAgICAgcmVjdC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAiZmlsbCIsIHRoaXMuX21ha2VTaGFkaW5nUGF0dGVybihhcmdzKSk7CgogICAgICAgICAgICB0aGlzLl9lbnN1cmVUcmFuc2Zvcm1Hcm91cCgpLmFwcGVuZENoaWxkKHJlY3QpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogIl9tYWtlQ29sb3JOX1BhdHRlcm4iLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9tYWtlQ29sb3JOX1BhdHRlcm4oYXJncykgewogICAgICAgICAgICBpZiAoYXJnc1swXSA9PT0gIlRpbGluZ1BhdHRlcm4iKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21ha2VUaWxpbmdQYXR0ZXJuKGFyZ3MpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdGhpcy5fbWFrZVNoYWRpbmdQYXR0ZXJuKGFyZ3MpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogIl9tYWtlVGlsaW5nUGF0dGVybiIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX21ha2VUaWxpbmdQYXR0ZXJuKGFyZ3MpIHsKICAgICAgICAgICAgdmFyIGNvbG9yID0gYXJnc1sxXTsKICAgICAgICAgICAgdmFyIG9wZXJhdG9yTGlzdCA9IGFyZ3NbMl07CiAgICAgICAgICAgIHZhciBtYXRyaXggPSBhcmdzWzNdIHx8IF91dGlsLklERU5USVRZX01BVFJJWDsKCiAgICAgICAgICAgIHZhciBfYXJncyQgPSBfc2xpY2VkVG9BcnJheShhcmdzWzRdLCA0KSwKICAgICAgICAgICAgICB4MCA9IF9hcmdzJFswXSwKICAgICAgICAgICAgICB5MCA9IF9hcmdzJFsxXSwKICAgICAgICAgICAgICB4MSA9IF9hcmdzJFsyXSwKICAgICAgICAgICAgICB5MSA9IF9hcmdzJFszXTsKCiAgICAgICAgICAgIHZhciB4c3RlcCA9IGFyZ3NbNV07CiAgICAgICAgICAgIHZhciB5c3RlcCA9IGFyZ3NbNl07CiAgICAgICAgICAgIHZhciBwYWludFR5cGUgPSBhcmdzWzddOwogICAgICAgICAgICB2YXIgdGlsaW5nSWQgPSAic2hhZGluZyIuY29uY2F0KHNoYWRpbmdDb3VudCsrKTsKCiAgICAgICAgICAgIHZhciBfVXRpbCRhcHBseVRyYW5zZm9ybSA9IF91dGlsLlV0aWwuYXBwbHlUcmFuc2Zvcm0oW3gwLCB5MF0sIG1hdHJpeCksCiAgICAgICAgICAgICAgX1V0aWwkYXBwbHlUcmFuc2Zvcm0yID0gX3NsaWNlZFRvQXJyYXkoX1V0aWwkYXBwbHlUcmFuc2Zvcm0sIDIpLAogICAgICAgICAgICAgIHR4MCA9IF9VdGlsJGFwcGx5VHJhbnNmb3JtMlswXSwKICAgICAgICAgICAgICB0eTAgPSBfVXRpbCRhcHBseVRyYW5zZm9ybTJbMV07CgogICAgICAgICAgICB2YXIgX1V0aWwkYXBwbHlUcmFuc2Zvcm0zID0gX3V0aWwuVXRpbC5hcHBseVRyYW5zZm9ybShbeDEsIHkxXSwgbWF0cml4KSwKICAgICAgICAgICAgICBfVXRpbCRhcHBseVRyYW5zZm9ybTQgPSBfc2xpY2VkVG9BcnJheShfVXRpbCRhcHBseVRyYW5zZm9ybTMsIDIpLAogICAgICAgICAgICAgIHR4MSA9IF9VdGlsJGFwcGx5VHJhbnNmb3JtNFswXSwKICAgICAgICAgICAgICB0eTEgPSBfVXRpbCRhcHBseVRyYW5zZm9ybTRbMV07CgogICAgICAgICAgICB2YXIgX1V0aWwkc2luZ3VsYXJWYWx1ZURlID0gX3V0aWwuVXRpbC5zaW5ndWxhclZhbHVlRGVjb21wb3NlMmRTY2FsZShtYXRyaXgpLAogICAgICAgICAgICAgIF9VdGlsJHNpbmd1bGFyVmFsdWVEZTIgPSBfc2xpY2VkVG9BcnJheShfVXRpbCRzaW5ndWxhclZhbHVlRGUsIDIpLAogICAgICAgICAgICAgIHhzY2FsZSA9IF9VdGlsJHNpbmd1bGFyVmFsdWVEZTJbMF0sCiAgICAgICAgICAgICAgeXNjYWxlID0gX1V0aWwkc2luZ3VsYXJWYWx1ZURlMlsxXTsKCiAgICAgICAgICAgIHZhciB0eHN0ZXAgPSB4c3RlcCAqIHhzY2FsZTsKICAgICAgICAgICAgdmFyIHR5c3RlcCA9IHlzdGVwICogeXNjYWxlOwogICAgICAgICAgICB2YXIgdGlsaW5nID0gdGhpcy5zdmdGYWN0b3J5LmNyZWF0ZUVsZW1lbnQoInN2ZzpwYXR0ZXJuIik7CiAgICAgICAgICAgIHRpbGluZy5zZXRBdHRyaWJ1dGVOUyhudWxsLCAiaWQiLCB0aWxpbmdJZCk7CiAgICAgICAgICAgIHRpbGluZy5zZXRBdHRyaWJ1dGVOUyhudWxsLCAicGF0dGVyblVuaXRzIiwgInVzZXJTcGFjZU9uVXNlIik7CiAgICAgICAgICAgIHRpbGluZy5zZXRBdHRyaWJ1dGVOUyhudWxsLCAid2lkdGgiLCB0eHN0ZXApOwogICAgICAgICAgICB0aWxpbmcuc2V0QXR0cmlidXRlTlMobnVsbCwgImhlaWdodCIsIHR5c3RlcCk7CiAgICAgICAgICAgIHRpbGluZy5zZXRBdHRyaWJ1dGVOUyhudWxsLCAieCIsICIiLmNvbmNhdCh0eDApKTsKICAgICAgICAgICAgdGlsaW5nLnNldEF0dHJpYnV0ZU5TKG51bGwsICJ5IiwgIiIuY29uY2F0KHR5MCkpOwogICAgICAgICAgICB2YXIgc3ZnID0gdGhpcy5zdmc7CiAgICAgICAgICAgIHZhciB0cmFuc2Zvcm1NYXRyaXggPSB0aGlzLnRyYW5zZm9ybU1hdHJpeDsKICAgICAgICAgICAgdmFyIGZpbGxDb2xvciA9IHRoaXMuY3VycmVudC5maWxsQ29sb3I7CiAgICAgICAgICAgIHZhciBzdHJva2VDb2xvciA9IHRoaXMuY3VycmVudC5zdHJva2VDb2xvcjsKICAgICAgICAgICAgdmFyIGJib3ggPSB0aGlzLnN2Z0ZhY3RvcnkuY3JlYXRlKHR4MSAtIHR4MCwgdHkxIC0gdHkwKTsKICAgICAgICAgICAgdGhpcy5zdmcgPSBiYm94OwogICAgICAgICAgICB0aGlzLnRyYW5zZm9ybU1hdHJpeCA9IG1hdHJpeDsKCiAgICAgICAgICAgIGlmIChwYWludFR5cGUgPT09IDIpIHsKICAgICAgICAgICAgICB2YXIgY3NzQ29sb3IgPSBfdXRpbC5VdGlsLm1ha2VDc3NSZ2IuYXBwbHkoX3V0aWwuVXRpbCwgX3RvQ29uc3VtYWJsZUFycmF5KGNvbG9yKSk7CgogICAgICAgICAgICAgIHRoaXMuY3VycmVudC5maWxsQ29sb3IgPSBjc3NDb2xvcjsKICAgICAgICAgICAgICB0aGlzLmN1cnJlbnQuc3Ryb2tlQ29sb3IgPSBjc3NDb2xvcjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5leGVjdXRlT3BUcmVlKHRoaXMuY29udmVydE9wTGlzdChvcGVyYXRvckxpc3QpKTsKICAgICAgICAgICAgdGhpcy5zdmcgPSBzdmc7CiAgICAgICAgICAgIHRoaXMudHJhbnNmb3JtTWF0cml4ID0gdHJhbnNmb3JtTWF0cml4OwogICAgICAgICAgICB0aGlzLmN1cnJlbnQuZmlsbENvbG9yID0gZmlsbENvbG9yOwogICAgICAgICAgICB0aGlzLmN1cnJlbnQuc3Ryb2tlQ29sb3IgPSBzdHJva2VDb2xvcjsKICAgICAgICAgICAgdGlsaW5nLmFwcGVuZENoaWxkKGJib3guY2hpbGROb2Rlc1swXSk7CiAgICAgICAgICAgIHRoaXMuZGVmcy5hcHBlbmRDaGlsZCh0aWxpbmcpOwogICAgICAgICAgICByZXR1cm4gInVybCgjIi5jb25jYXQodGlsaW5nSWQsICIpIik7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAiX21ha2VTaGFkaW5nUGF0dGVybiIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX21ha2VTaGFkaW5nUGF0dGVybihhcmdzKSB7CiAgICAgICAgICAgIHN3aXRjaCAoYXJnc1swXSkgewogICAgICAgICAgICAgIGNhc2UgIlJhZGlhbEF4aWFsIjoKICAgICAgICAgICAgICAgIHZhciBzaGFkaW5nSWQgPSAic2hhZGluZyIuY29uY2F0KHNoYWRpbmdDb3VudCsrKTsKICAgICAgICAgICAgICAgIHZhciBjb2xvclN0b3BzID0gYXJnc1szXTsKICAgICAgICAgICAgICAgIHZhciBncmFkaWVudDsKCiAgICAgICAgICAgICAgICBzd2l0Y2ggKGFyZ3NbMV0pIHsKICAgICAgICAgICAgICAgICAgY2FzZSAiYXhpYWwiOgogICAgICAgICAgICAgICAgICAgIHZhciBwb2ludDAgPSBhcmdzWzRdOwogICAgICAgICAgICAgICAgICAgIHZhciBwb2ludDEgPSBhcmdzWzVdOwogICAgICAgICAgICAgICAgICAgIGdyYWRpZW50ID0gdGhpcy5zdmdGYWN0b3J5LmNyZWF0ZUVsZW1lbnQoInN2ZzpsaW5lYXJHcmFkaWVudCIpOwogICAgICAgICAgICAgICAgICAgIGdyYWRpZW50LnNldEF0dHJpYnV0ZU5TKG51bGwsICJpZCIsIHNoYWRpbmdJZCk7CiAgICAgICAgICAgICAgICAgICAgZ3JhZGllbnQuc2V0QXR0cmlidXRlTlMobnVsbCwgImdyYWRpZW50VW5pdHMiLCAidXNlclNwYWNlT25Vc2UiKTsKICAgICAgICAgICAgICAgICAgICBncmFkaWVudC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAieDEiLCBwb2ludDBbMF0pOwogICAgICAgICAgICAgICAgICAgIGdyYWRpZW50LnNldEF0dHJpYnV0ZU5TKG51bGwsICJ5MSIsIHBvaW50MFsxXSk7CiAgICAgICAgICAgICAgICAgICAgZ3JhZGllbnQuc2V0QXR0cmlidXRlTlMobnVsbCwgIngyIiwgcG9pbnQxWzBdKTsKICAgICAgICAgICAgICAgICAgICBncmFkaWVudC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAieTIiLCBwb2ludDFbMV0pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgY2FzZSAicmFkaWFsIjoKICAgICAgICAgICAgICAgICAgICB2YXIgZm9jYWxQb2ludCA9IGFyZ3NbNF07CiAgICAgICAgICAgICAgICAgICAgdmFyIGNpcmNsZVBvaW50ID0gYXJnc1s1XTsKICAgICAgICAgICAgICAgICAgICB2YXIgZm9jYWxSYWRpdXMgPSBhcmdzWzZdOwogICAgICAgICAgICAgICAgICAgIHZhciBjaXJjbGVSYWRpdXMgPSBhcmdzWzddOwogICAgICAgICAgICAgICAgICAgIGdyYWRpZW50ID0gdGhpcy5zdmdGYWN0b3J5LmNyZWF0ZUVsZW1lbnQoInN2ZzpyYWRpYWxHcmFkaWVudCIpOwogICAgICAgICAgICAgICAgICAgIGdyYWRpZW50LnNldEF0dHJpYnV0ZU5TKG51bGwsICJpZCIsIHNoYWRpbmdJZCk7CiAgICAgICAgICAgICAgICAgICAgZ3JhZGllbnQuc2V0QXR0cmlidXRlTlMobnVsbCwgImdyYWRpZW50VW5pdHMiLCAidXNlclNwYWNlT25Vc2UiKTsKICAgICAgICAgICAgICAgICAgICBncmFkaWVudC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAiY3giLCBjaXJjbGVQb2ludFswXSk7CiAgICAgICAgICAgICAgICAgICAgZ3JhZGllbnQuc2V0QXR0cmlidXRlTlMobnVsbCwgImN5IiwgY2lyY2xlUG9pbnRbMV0pOwogICAgICAgICAgICAgICAgICAgIGdyYWRpZW50LnNldEF0dHJpYnV0ZU5TKG51bGwsICJyIiwgY2lyY2xlUmFkaXVzKTsKICAgICAgICAgICAgICAgICAgICBncmFkaWVudC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAiZngiLCBmb2NhbFBvaW50WzBdKTsKICAgICAgICAgICAgICAgICAgICBncmFkaWVudC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAiZnkiLCBmb2NhbFBvaW50WzFdKTsKICAgICAgICAgICAgICAgICAgICBncmFkaWVudC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAiZnIiLCBmb2NhbFJhZGl1cyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5rbm93biBSYWRpYWxBeGlhbCB0eXBlOiAiLmNvbmNhdChhcmdzWzFdKSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdmFyIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb241ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHZhciBfZGlkSXRlcmF0b3JFcnJvcjUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHZhciBfaXRlcmF0b3JFcnJvcjUgPSB1bmRlZmluZWQ7CgogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgZm9yICh2YXIgX2l0ZXJhdG9yNSA9IGNvbG9yU3RvcHNbU3ltYm9sLml0ZXJhdG9yXSgpLCBfc3RlcDU7ICEoX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjUgPSAoX3N0ZXA1ID0gX2l0ZXJhdG9yNS5uZXh0KCkpLmRvbmUpOyBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uNSA9IHRydWUpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY29sb3JTdG9wID0gX3N0ZXA1LnZhbHVlOwogICAgICAgICAgICAgICAgICAgIHZhciBzdG9wID0gdGhpcy5zdmdGYWN0b3J5LmNyZWF0ZUVsZW1lbnQoInN2ZzpzdG9wIik7CiAgICAgICAgICAgICAgICAgICAgc3RvcC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAib2Zmc2V0IiwgY29sb3JTdG9wWzBdKTsKICAgICAgICAgICAgICAgICAgICBzdG9wLnNldEF0dHJpYnV0ZU5TKG51bGwsICJzdG9wLWNvbG9yIiwgY29sb3JTdG9wWzFdKTsKICAgICAgICAgICAgICAgICAgICBncmFkaWVudC5hcHBlbmRDaGlsZChzdG9wKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICAgIF9kaWRJdGVyYXRvckVycm9yNSA9IHRydWU7CiAgICAgICAgICAgICAgICAgIF9pdGVyYXRvckVycm9yNSA9IGVycjsKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uNSAmJiBfaXRlcmF0b3I1WyJyZXR1cm4iXSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICBfaXRlcmF0b3I1WyJyZXR1cm4iXSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICBpZiAoX2RpZEl0ZXJhdG9yRXJyb3I1KSB7CiAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBfaXRlcmF0b3JFcnJvcjU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy5kZWZzLmFwcGVuZENoaWxkKGdyYWRpZW50KTsKICAgICAgICAgICAgICAgIHJldHVybiAidXJsKCMiLmNvbmNhdChzaGFkaW5nSWQsICIpIik7CgogICAgICAgICAgICAgIGNhc2UgIk1lc2giOgogICAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJVbmltcGxlbWVudGVkIHBhdHRlcm4gTWVzaCIpOwogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgICAgICAgIGNhc2UgIkR1bW15IjoKICAgICAgICAgICAgICAgIHJldHVybiAiaG90cGluayI7CgogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gSVIgdHlwZTogIi5jb25jYXQoYXJnc1swXSkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAic2V0RGFzaCIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gc2V0RGFzaChkYXNoQXJyYXksIGRhc2hQaGFzZSkgewogICAgICAgICAgICB0aGlzLmN1cnJlbnQuZGFzaEFycmF5ID0gZGFzaEFycmF5OwogICAgICAgICAgICB0aGlzLmN1cnJlbnQuZGFzaFBoYXNlID0gZGFzaFBoYXNlOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogImNvbnN0cnVjdFBhdGgiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNvbnN0cnVjdFBhdGgob3BzLCBhcmdzKSB7CiAgICAgICAgICAgIHZhciBjdXJyZW50ID0gdGhpcy5jdXJyZW50OwogICAgICAgICAgICB2YXIgeCA9IGN1cnJlbnQueCwKICAgICAgICAgICAgICB5ID0gY3VycmVudC55OwogICAgICAgICAgICB2YXIgZCA9IFtdOwogICAgICAgICAgICB2YXIgaiA9IDA7CiAgICAgICAgICAgIHZhciBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uNiA9IHRydWU7CiAgICAgICAgICAgIHZhciBfZGlkSXRlcmF0b3JFcnJvcjYgPSBmYWxzZTsKICAgICAgICAgICAgdmFyIF9pdGVyYXRvckVycm9yNiA9IHVuZGVmaW5lZDsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgX2l0ZXJhdG9yNiA9IG9wc1tTeW1ib2wuaXRlcmF0b3JdKCksIF9zdGVwNjsgIShfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uNiA9IChfc3RlcDYgPSBfaXRlcmF0b3I2Lm5leHQoKSkuZG9uZSk7IF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb242ID0gdHJ1ZSkgewogICAgICAgICAgICAgICAgdmFyIG9wID0gX3N0ZXA2LnZhbHVlOwoKICAgICAgICAgICAgICAgIHN3aXRjaCAob3AgfCAwKSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnJlY3RhbmdsZToKICAgICAgICAgICAgICAgICAgICB4ID0gYXJnc1tqKytdOwogICAgICAgICAgICAgICAgICAgIHkgPSBhcmdzW2orK107CiAgICAgICAgICAgICAgICAgICAgdmFyIHdpZHRoID0gYXJnc1tqKytdOwogICAgICAgICAgICAgICAgICAgIHZhciBoZWlnaHQgPSBhcmdzW2orK107CiAgICAgICAgICAgICAgICAgICAgdmFyIHh3ID0geCArIHdpZHRoOwogICAgICAgICAgICAgICAgICAgIHZhciB5aCA9IHkgKyBoZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgZC5wdXNoKCJNIiwgcGYoeCksIHBmKHkpLCAiTCIsIHBmKHh3KSwgcGYoeSksICJMIiwgcGYoeHcpLCBwZih5aCksICJMIiwgcGYoeCksIHBmKHloKSwgIloiKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLm1vdmVUbzoKICAgICAgICAgICAgICAgICAgICB4ID0gYXJnc1tqKytdOwogICAgICAgICAgICAgICAgICAgIHkgPSBhcmdzW2orK107CiAgICAgICAgICAgICAgICAgICAgZC5wdXNoKCJNIiwgcGYoeCksIHBmKHkpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLmxpbmVUbzoKICAgICAgICAgICAgICAgICAgICB4ID0gYXJnc1tqKytdOwogICAgICAgICAgICAgICAgICAgIHkgPSBhcmdzW2orK107CiAgICAgICAgICAgICAgICAgICAgZC5wdXNoKCJMIiwgcGYoeCksIHBmKHkpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLmN1cnZlVG86CiAgICAgICAgICAgICAgICAgICAgeCA9IGFyZ3NbaiArIDRdOwogICAgICAgICAgICAgICAgICAgIHkgPSBhcmdzW2ogKyA1XTsKICAgICAgICAgICAgICAgICAgICBkLnB1c2goIkMiLCBwZihhcmdzW2pdKSwgcGYoYXJnc1tqICsgMV0pLCBwZihhcmdzW2ogKyAyXSksIHBmKGFyZ3NbaiArIDNdKSwgcGYoeCksIHBmKHkpKTsKICAgICAgICAgICAgICAgICAgICBqICs9IDY7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5jdXJ2ZVRvMjoKICAgICAgICAgICAgICAgICAgICBkLnB1c2goIkMiLCBwZih4KSwgcGYoeSksIHBmKGFyZ3Nbal0pLCBwZihhcmdzW2ogKyAxXSksIHBmKGFyZ3NbaiArIDJdKSwgcGYoYXJnc1tqICsgM10pKTsKICAgICAgICAgICAgICAgICAgICB4ID0gYXJnc1tqICsgMl07CiAgICAgICAgICAgICAgICAgICAgeSA9IGFyZ3NbaiArIDNdOwogICAgICAgICAgICAgICAgICAgIGogKz0gNDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLmN1cnZlVG8zOgogICAgICAgICAgICAgICAgICAgIHggPSBhcmdzW2ogKyAyXTsKICAgICAgICAgICAgICAgICAgICB5ID0gYXJnc1tqICsgM107CiAgICAgICAgICAgICAgICAgICAgZC5wdXNoKCJDIiwgcGYoYXJnc1tqXSksIHBmKGFyZ3NbaiArIDFdKSwgcGYoeCksIHBmKHkpLCBwZih4KSwgcGYoeSkpOwogICAgICAgICAgICAgICAgICAgIGogKz0gNDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLmNsb3NlUGF0aDoKICAgICAgICAgICAgICAgICAgICBkLnB1c2goIloiKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgIF9kaWRJdGVyYXRvckVycm9yNiA9IHRydWU7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yRXJyb3I2ID0gZXJyOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb242ICYmIF9pdGVyYXRvcjZbInJldHVybiJdICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yNlsicmV0dXJuIl0oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgaWYgKF9kaWRJdGVyYXRvckVycm9yNikgewogICAgICAgICAgICAgICAgICB0aHJvdyBfaXRlcmF0b3JFcnJvcjY7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBkID0gZC5qb2luKCIgIik7CgogICAgICAgICAgICBpZiAoY3VycmVudC5wYXRoICYmIG9wcy5sZW5ndGggPiAwICYmIG9wc1swXSAhPT0gX3V0aWwuT1BTLnJlY3RhbmdsZSAmJiBvcHNbMF0gIT09IF91dGlsLk9QUy5tb3ZlVG8pIHsKICAgICAgICAgICAgICBkID0gY3VycmVudC5wYXRoLmdldEF0dHJpYnV0ZU5TKG51bGwsICJkIikgKyBkOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGN1cnJlbnQucGF0aCA9IHRoaXMuc3ZnRmFjdG9yeS5jcmVhdGVFbGVtZW50KCJzdmc6cGF0aCIpOwoKICAgICAgICAgICAgICB0aGlzLl9lbnN1cmVUcmFuc2Zvcm1Hcm91cCgpLmFwcGVuZENoaWxkKGN1cnJlbnQucGF0aCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGN1cnJlbnQucGF0aC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAiZCIsIGQpOwogICAgICAgICAgICBjdXJyZW50LnBhdGguc2V0QXR0cmlidXRlTlMobnVsbCwgImZpbGwiLCAibm9uZSIpOwogICAgICAgICAgICBjdXJyZW50LmVsZW1lbnQgPSBjdXJyZW50LnBhdGg7CiAgICAgICAgICAgIGN1cnJlbnQuc2V0Q3VycmVudFBvaW50KHgsIHkpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogImVuZFBhdGgiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGVuZFBhdGgoKSB7CiAgICAgICAgICAgIHZhciBjdXJyZW50ID0gdGhpcy5jdXJyZW50OwogICAgICAgICAgICBjdXJyZW50LnBhdGggPSBudWxsOwoKICAgICAgICAgICAgaWYgKCF0aGlzLnBlbmRpbmdDbGlwKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIWN1cnJlbnQuZWxlbWVudCkgewogICAgICAgICAgICAgIHRoaXMucGVuZGluZ0NsaXAgPSBudWxsOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGNsaXBJZCA9ICJjbGlwcGF0aCIuY29uY2F0KGNsaXBDb3VudCsrKTsKICAgICAgICAgICAgdmFyIGNsaXBQYXRoID0gdGhpcy5zdmdGYWN0b3J5LmNyZWF0ZUVsZW1lbnQoInN2ZzpjbGlwUGF0aCIpOwogICAgICAgICAgICBjbGlwUGF0aC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAiaWQiLCBjbGlwSWQpOwogICAgICAgICAgICBjbGlwUGF0aC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAidHJhbnNmb3JtIiwgcG0odGhpcy50cmFuc2Zvcm1NYXRyaXgpKTsKICAgICAgICAgICAgdmFyIGNsaXBFbGVtZW50ID0gY3VycmVudC5lbGVtZW50LmNsb25lTm9kZSh0cnVlKTsKCiAgICAgICAgICAgIGlmICh0aGlzLnBlbmRpbmdDbGlwID09PSAiZXZlbm9kZCIpIHsKICAgICAgICAgICAgICBjbGlwRWxlbWVudC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAiY2xpcC1ydWxlIiwgImV2ZW5vZGQiKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBjbGlwRWxlbWVudC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAiY2xpcC1ydWxlIiwgIm5vbnplcm8iKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5wZW5kaW5nQ2xpcCA9IG51bGw7CiAgICAgICAgICAgIGNsaXBQYXRoLmFwcGVuZENoaWxkKGNsaXBFbGVtZW50KTsKICAgICAgICAgICAgdGhpcy5kZWZzLmFwcGVuZENoaWxkKGNsaXBQYXRoKTsKCiAgICAgICAgICAgIGlmIChjdXJyZW50LmFjdGl2ZUNsaXBVcmwpIHsKICAgICAgICAgICAgICBjdXJyZW50LmNsaXBHcm91cCA9IG51bGw7CiAgICAgICAgICAgICAgdGhpcy5leHRyYVN0YWNrLmZvckVhY2goZnVuY3Rpb24gKHByZXYpIHsKICAgICAgICAgICAgICAgIHByZXYuY2xpcEdyb3VwID0gbnVsbDsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBjbGlwUGF0aC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAiY2xpcC1wYXRoIiwgY3VycmVudC5hY3RpdmVDbGlwVXJsKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY3VycmVudC5hY3RpdmVDbGlwVXJsID0gInVybCgjIi5jb25jYXQoY2xpcElkLCAiKSIpOwogICAgICAgICAgICB0aGlzLnRncnAgPSBudWxsOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogImNsaXAiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNsaXAodHlwZSkgewogICAgICAgICAgICB0aGlzLnBlbmRpbmdDbGlwID0gdHlwZTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJjbG9zZVBhdGgiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNsb3NlUGF0aCgpIHsKICAgICAgICAgICAgdmFyIGN1cnJlbnQgPSB0aGlzLmN1cnJlbnQ7CgogICAgICAgICAgICBpZiAoY3VycmVudC5wYXRoKSB7CiAgICAgICAgICAgICAgdmFyIGQgPSAiIi5jb25jYXQoY3VycmVudC5wYXRoLmdldEF0dHJpYnV0ZU5TKG51bGwsICJkIiksICJaIik7CiAgICAgICAgICAgICAgY3VycmVudC5wYXRoLnNldEF0dHJpYnV0ZU5TKG51bGwsICJkIiwgZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJzZXRMZWFkaW5nIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRMZWFkaW5nKGxlYWRpbmcpIHsKICAgICAgICAgICAgdGhpcy5jdXJyZW50LmxlYWRpbmcgPSAtbGVhZGluZzsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJzZXRUZXh0UmlzZSIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gc2V0VGV4dFJpc2UodGV4dFJpc2UpIHsKICAgICAgICAgICAgdGhpcy5jdXJyZW50LnRleHRSaXNlID0gdGV4dFJpc2U7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAic2V0VGV4dFJlbmRlcmluZ01vZGUiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNldFRleHRSZW5kZXJpbmdNb2RlKHRleHRSZW5kZXJpbmdNb2RlKSB7CiAgICAgICAgICAgIHRoaXMuY3VycmVudC50ZXh0UmVuZGVyaW5nTW9kZSA9IHRleHRSZW5kZXJpbmdNb2RlOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogInNldEhTY2FsZSIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gc2V0SFNjYWxlKHNjYWxlKSB7CiAgICAgICAgICAgIHRoaXMuY3VycmVudC50ZXh0SFNjYWxlID0gc2NhbGUgLyAxMDA7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAic2V0UmVuZGVyaW5nSW50ZW50IiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRSZW5kZXJpbmdJbnRlbnQoaW50ZW50KSB7fQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogInNldEZsYXRuZXNzIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRGbGF0bmVzcyhmbGF0bmVzcykge30KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJzZXRHU3RhdGUiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNldEdTdGF0ZShzdGF0ZXMpIHsKICAgICAgICAgICAgdmFyIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb243ID0gdHJ1ZTsKICAgICAgICAgICAgdmFyIF9kaWRJdGVyYXRvckVycm9yNyA9IGZhbHNlOwogICAgICAgICAgICB2YXIgX2l0ZXJhdG9yRXJyb3I3ID0gdW5kZWZpbmVkOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBmb3IgKHZhciBfaXRlcmF0b3I3ID0gc3RhdGVzW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3N0ZXA3OyAhKF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb243ID0gKF9zdGVwNyA9IF9pdGVyYXRvcjcubmV4dCgpKS5kb25lKTsgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjcgPSB0cnVlKSB7CiAgICAgICAgICAgICAgICB2YXIgX3N0ZXA3JHZhbHVlID0gX3NsaWNlZFRvQXJyYXkoX3N0ZXA3LnZhbHVlLCAyKSwKICAgICAgICAgICAgICAgICAga2V5ID0gX3N0ZXA3JHZhbHVlWzBdLAogICAgICAgICAgICAgICAgICB2YWx1ZSA9IF9zdGVwNyR2YWx1ZVsxXTsKCiAgICAgICAgICAgICAgICBzd2l0Y2ggKGtleSkgewogICAgICAgICAgICAgICAgICBjYXNlICJMVyI6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRMaW5lV2lkdGgodmFsdWUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgY2FzZSAiTEMiOgogICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0TGluZUNhcCh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlICJMSiI6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRMaW5lSm9pbih2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlICJNTCI6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRNaXRlckxpbWl0KHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgIkQiOgogICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0RGFzaCh2YWx1ZVswXSwgdmFsdWVbMV0pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgY2FzZSAiUkkiOgogICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0UmVuZGVyaW5nSW50ZW50KHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgIkZMIjoKICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEZsYXRuZXNzKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgIkZvbnQiOgogICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0Rm9udCh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlICJDQSI6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdHJva2VBbHBoYSh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlICJjYSI6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRGaWxsQWxwaGEodmFsdWUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIlVuaW1wbGVtZW50ZWQgZ3JhcGhpYyBzdGF0ZSBvcGVyYXRvciAiLmNvbmNhdChrZXkpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgIF9kaWRJdGVyYXRvckVycm9yNyA9IHRydWU7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yRXJyb3I3ID0gZXJyOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb243ICYmIF9pdGVyYXRvcjdbInJldHVybiJdICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yN1sicmV0dXJuIl0oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgaWYgKF9kaWRJdGVyYXRvckVycm9yNykgewogICAgICAgICAgICAgICAgICB0aHJvdyBfaXRlcmF0b3JFcnJvcjc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAiZmlsbCIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZmlsbCgpIHsKICAgICAgICAgICAgdmFyIGN1cnJlbnQgPSB0aGlzLmN1cnJlbnQ7CgogICAgICAgICAgICBpZiAoY3VycmVudC5lbGVtZW50KSB7CiAgICAgICAgICAgICAgY3VycmVudC5lbGVtZW50LnNldEF0dHJpYnV0ZU5TKG51bGwsICJmaWxsIiwgY3VycmVudC5maWxsQ29sb3IpOwogICAgICAgICAgICAgIGN1cnJlbnQuZWxlbWVudC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAiZmlsbC1vcGFjaXR5IiwgY3VycmVudC5maWxsQWxwaGEpOwogICAgICAgICAgICAgIHRoaXMuZW5kUGF0aCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAic3Ryb2tlIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzdHJva2UoKSB7CiAgICAgICAgICAgIHZhciBjdXJyZW50ID0gdGhpcy5jdXJyZW50OwoKICAgICAgICAgICAgaWYgKGN1cnJlbnQuZWxlbWVudCkgewogICAgICAgICAgICAgIHRoaXMuX3NldFN0cm9rZUF0dHJpYnV0ZXMoY3VycmVudC5lbGVtZW50KTsKCiAgICAgICAgICAgICAgY3VycmVudC5lbGVtZW50LnNldEF0dHJpYnV0ZU5TKG51bGwsICJmaWxsIiwgIm5vbmUiKTsKICAgICAgICAgICAgICB0aGlzLmVuZFBhdGgoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogIl9zZXRTdHJva2VBdHRyaWJ1dGVzIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfc2V0U3Ryb2tlQXR0cmlidXRlcyhlbGVtZW50KSB7CiAgICAgICAgICAgIHZhciBsaW5lV2lkdGhTY2FsZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogMTsKICAgICAgICAgICAgdmFyIGN1cnJlbnQgPSB0aGlzLmN1cnJlbnQ7CiAgICAgICAgICAgIHZhciBkYXNoQXJyYXkgPSBjdXJyZW50LmRhc2hBcnJheTsKCiAgICAgICAgICAgIGlmIChsaW5lV2lkdGhTY2FsZSAhPT0gMSAmJiBkYXNoQXJyYXkubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIGRhc2hBcnJheSA9IGRhc2hBcnJheS5tYXAoZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbGluZVdpZHRoU2NhbGUgKiB2YWx1ZTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAic3Ryb2tlIiwgY3VycmVudC5zdHJva2VDb2xvcik7CiAgICAgICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlTlMobnVsbCwgInN0cm9rZS1vcGFjaXR5IiwgY3VycmVudC5zdHJva2VBbHBoYSk7CiAgICAgICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlTlMobnVsbCwgInN0cm9rZS1taXRlcmxpbWl0IiwgcGYoY3VycmVudC5taXRlckxpbWl0KSk7CiAgICAgICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlTlMobnVsbCwgInN0cm9rZS1saW5lY2FwIiwgY3VycmVudC5saW5lQ2FwKTsKICAgICAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAic3Ryb2tlLWxpbmVqb2luIiwgY3VycmVudC5saW5lSm9pbik7CiAgICAgICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlTlMobnVsbCwgInN0cm9rZS13aWR0aCIsIHBmKGxpbmVXaWR0aFNjYWxlICogY3VycmVudC5saW5lV2lkdGgpICsgInB4Iik7CiAgICAgICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlTlMobnVsbCwgInN0cm9rZS1kYXNoYXJyYXkiLCBkYXNoQXJyYXkubWFwKHBmKS5qb2luKCIgIikpOwogICAgICAgICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZU5TKG51bGwsICJzdHJva2UtZGFzaG9mZnNldCIsIHBmKGxpbmVXaWR0aFNjYWxlICogY3VycmVudC5kYXNoUGhhc2UpICsgInB4Iik7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAiZW9GaWxsIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBlb0ZpbGwoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnQuZWxlbWVudCkgewogICAgICAgICAgICAgIHRoaXMuY3VycmVudC5lbGVtZW50LnNldEF0dHJpYnV0ZU5TKG51bGwsICJmaWxsLXJ1bGUiLCAiZXZlbm9kZCIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLmZpbGwoKTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJmaWxsU3Ryb2tlIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBmaWxsU3Ryb2tlKCkgewogICAgICAgICAgICB0aGlzLnN0cm9rZSgpOwogICAgICAgICAgICB0aGlzLmZpbGwoKTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJlb0ZpbGxTdHJva2UiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGVvRmlsbFN0cm9rZSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudC5lbGVtZW50KSB7CiAgICAgICAgICAgICAgdGhpcy5jdXJyZW50LmVsZW1lbnQuc2V0QXR0cmlidXRlTlMobnVsbCwgImZpbGwtcnVsZSIsICJldmVub2RkIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuZmlsbFN0cm9rZSgpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogImNsb3NlU3Ryb2tlIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjbG9zZVN0cm9rZSgpIHsKICAgICAgICAgICAgdGhpcy5jbG9zZVBhdGgoKTsKICAgICAgICAgICAgdGhpcy5zdHJva2UoKTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJjbG9zZUZpbGxTdHJva2UiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNsb3NlRmlsbFN0cm9rZSgpIHsKICAgICAgICAgICAgdGhpcy5jbG9zZVBhdGgoKTsKICAgICAgICAgICAgdGhpcy5maWxsU3Ryb2tlKCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAiY2xvc2VFT0ZpbGxTdHJva2UiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNsb3NlRU9GaWxsU3Ryb2tlKCkgewogICAgICAgICAgICB0aGlzLmNsb3NlUGF0aCgpOwogICAgICAgICAgICB0aGlzLmVvRmlsbFN0cm9rZSgpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogInBhaW50U29saWRDb2xvckltYWdlTWFzayIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcGFpbnRTb2xpZENvbG9ySW1hZ2VNYXNrKCkgewogICAgICAgICAgICB2YXIgcmVjdCA9IHRoaXMuc3ZnRmFjdG9yeS5jcmVhdGVFbGVtZW50KCJzdmc6cmVjdCIpOwogICAgICAgICAgICByZWN0LnNldEF0dHJpYnV0ZU5TKG51bGwsICJ4IiwgIjAiKTsKICAgICAgICAgICAgcmVjdC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAieSIsICIwIik7CiAgICAgICAgICAgIHJlY3Quc2V0QXR0cmlidXRlTlMobnVsbCwgIndpZHRoIiwgIjFweCIpOwogICAgICAgICAgICByZWN0LnNldEF0dHJpYnV0ZU5TKG51bGwsICJoZWlnaHQiLCAiMXB4Iik7CiAgICAgICAgICAgIHJlY3Quc2V0QXR0cmlidXRlTlMobnVsbCwgImZpbGwiLCB0aGlzLmN1cnJlbnQuZmlsbENvbG9yKTsKCiAgICAgICAgICAgIHRoaXMuX2Vuc3VyZVRyYW5zZm9ybUdyb3VwKCkuYXBwZW5kQ2hpbGQocmVjdCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAicGFpbnRKcGVnWE9iamVjdCIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcGFpbnRKcGVnWE9iamVjdChvYmpJZCwgdywgaCkgewogICAgICAgICAgICB2YXIgaW1nT2JqID0gdGhpcy5vYmpzLmdldChvYmpJZCk7CiAgICAgICAgICAgIHZhciBpbWdFbCA9IHRoaXMuc3ZnRmFjdG9yeS5jcmVhdGVFbGVtZW50KCJzdmc6aW1hZ2UiKTsKICAgICAgICAgICAgaW1nRWwuc2V0QXR0cmlidXRlTlMoWExJTktfTlMsICJ4bGluazpocmVmIiwgaW1nT2JqLnNyYyk7CiAgICAgICAgICAgIGltZ0VsLnNldEF0dHJpYnV0ZU5TKG51bGwsICJ3aWR0aCIsIHBmKHcpKTsKICAgICAgICAgICAgaW1nRWwuc2V0QXR0cmlidXRlTlMobnVsbCwgImhlaWdodCIsIHBmKGgpKTsKICAgICAgICAgICAgaW1nRWwuc2V0QXR0cmlidXRlTlMobnVsbCwgIngiLCAiMCIpOwogICAgICAgICAgICBpbWdFbC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAieSIsIHBmKC1oKSk7CiAgICAgICAgICAgIGltZ0VsLnNldEF0dHJpYnV0ZU5TKG51bGwsICJ0cmFuc2Zvcm0iLCAic2NhbGUoIi5jb25jYXQocGYoMSAvIHcpLCAiICIpLmNvbmNhdChwZigtMSAvIGgpLCAiKSIpKTsKCiAgICAgICAgICAgIHRoaXMuX2Vuc3VyZVRyYW5zZm9ybUdyb3VwKCkuYXBwZW5kQ2hpbGQoaW1nRWwpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogInBhaW50SW1hZ2VYT2JqZWN0IiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBwYWludEltYWdlWE9iamVjdChvYmpJZCkgewogICAgICAgICAgICB2YXIgaW1nRGF0YSA9IHRoaXMub2Jqcy5nZXQob2JqSWQpOwoKICAgICAgICAgICAgaWYgKCFpbWdEYXRhKSB7CiAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJEZXBlbmRlbnQgaW1hZ2Ugd2l0aCBvYmplY3QgSUQgIi5jb25jYXQob2JqSWQsICIgaXMgbm90IHJlYWR5IHlldCIpKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMucGFpbnRJbmxpbmVJbWFnZVhPYmplY3QoaW1nRGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAicGFpbnRJbmxpbmVJbWFnZVhPYmplY3QiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHBhaW50SW5saW5lSW1hZ2VYT2JqZWN0KGltZ0RhdGEsIG1hc2spIHsKICAgICAgICAgICAgdmFyIHdpZHRoID0gaW1nRGF0YS53aWR0aDsKICAgICAgICAgICAgdmFyIGhlaWdodCA9IGltZ0RhdGEuaGVpZ2h0OwogICAgICAgICAgICB2YXIgaW1nU3JjID0gY29udmVydEltZ0RhdGFUb1BuZyhpbWdEYXRhLCB0aGlzLmZvcmNlRGF0YVNjaGVtYSwgISFtYXNrKTsKICAgICAgICAgICAgdmFyIGNsaXByZWN0ID0gdGhpcy5zdmdGYWN0b3J5LmNyZWF0ZUVsZW1lbnQoInN2ZzpyZWN0Iik7CiAgICAgICAgICAgIGNsaXByZWN0LnNldEF0dHJpYnV0ZU5TKG51bGwsICJ4IiwgIjAiKTsKICAgICAgICAgICAgY2xpcHJlY3Quc2V0QXR0cmlidXRlTlMobnVsbCwgInkiLCAiMCIpOwogICAgICAgICAgICBjbGlwcmVjdC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAid2lkdGgiLCBwZih3aWR0aCkpOwogICAgICAgICAgICBjbGlwcmVjdC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAiaGVpZ2h0IiwgcGYoaGVpZ2h0KSk7CiAgICAgICAgICAgIHRoaXMuY3VycmVudC5lbGVtZW50ID0gY2xpcHJlY3Q7CiAgICAgICAgICAgIHRoaXMuY2xpcCgibm9uemVybyIpOwogICAgICAgICAgICB2YXIgaW1nRWwgPSB0aGlzLnN2Z0ZhY3RvcnkuY3JlYXRlRWxlbWVudCgic3ZnOmltYWdlIik7CiAgICAgICAgICAgIGltZ0VsLnNldEF0dHJpYnV0ZU5TKFhMSU5LX05TLCAieGxpbms6aHJlZiIsIGltZ1NyYyk7CiAgICAgICAgICAgIGltZ0VsLnNldEF0dHJpYnV0ZU5TKG51bGwsICJ4IiwgIjAiKTsKICAgICAgICAgICAgaW1nRWwuc2V0QXR0cmlidXRlTlMobnVsbCwgInkiLCBwZigtaGVpZ2h0KSk7CiAgICAgICAgICAgIGltZ0VsLnNldEF0dHJpYnV0ZU5TKG51bGwsICJ3aWR0aCIsIHBmKHdpZHRoKSArICJweCIpOwogICAgICAgICAgICBpbWdFbC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAiaGVpZ2h0IiwgcGYoaGVpZ2h0KSArICJweCIpOwogICAgICAgICAgICBpbWdFbC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAidHJhbnNmb3JtIiwgInNjYWxlKCIuY29uY2F0KHBmKDEgLyB3aWR0aCksICIgIikuY29uY2F0KHBmKC0xIC8gaGVpZ2h0KSwgIikiKSk7CgogICAgICAgICAgICBpZiAobWFzaykgewogICAgICAgICAgICAgIG1hc2suYXBwZW5kQ2hpbGQoaW1nRWwpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMuX2Vuc3VyZVRyYW5zZm9ybUdyb3VwKCkuYXBwZW5kQ2hpbGQoaW1nRWwpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAicGFpbnRJbWFnZU1hc2tYT2JqZWN0IiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBwYWludEltYWdlTWFza1hPYmplY3QoaW1nRGF0YSkgewogICAgICAgICAgICB2YXIgY3VycmVudCA9IHRoaXMuY3VycmVudDsKICAgICAgICAgICAgdmFyIHdpZHRoID0gaW1nRGF0YS53aWR0aDsKICAgICAgICAgICAgdmFyIGhlaWdodCA9IGltZ0RhdGEuaGVpZ2h0OwogICAgICAgICAgICB2YXIgZmlsbENvbG9yID0gY3VycmVudC5maWxsQ29sb3I7CiAgICAgICAgICAgIGN1cnJlbnQubWFza0lkID0gIm1hc2siLmNvbmNhdChtYXNrQ291bnQrKyk7CiAgICAgICAgICAgIHZhciBtYXNrID0gdGhpcy5zdmdGYWN0b3J5LmNyZWF0ZUVsZW1lbnQoInN2ZzptYXNrIik7CiAgICAgICAgICAgIG1hc2suc2V0QXR0cmlidXRlTlMobnVsbCwgImlkIiwgY3VycmVudC5tYXNrSWQpOwogICAgICAgICAgICB2YXIgcmVjdCA9IHRoaXMuc3ZnRmFjdG9yeS5jcmVhdGVFbGVtZW50KCJzdmc6cmVjdCIpOwogICAgICAgICAgICByZWN0LnNldEF0dHJpYnV0ZU5TKG51bGwsICJ4IiwgIjAiKTsKICAgICAgICAgICAgcmVjdC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAieSIsICIwIik7CiAgICAgICAgICAgIHJlY3Quc2V0QXR0cmlidXRlTlMobnVsbCwgIndpZHRoIiwgcGYod2lkdGgpKTsKICAgICAgICAgICAgcmVjdC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAiaGVpZ2h0IiwgcGYoaGVpZ2h0KSk7CiAgICAgICAgICAgIHJlY3Quc2V0QXR0cmlidXRlTlMobnVsbCwgImZpbGwiLCBmaWxsQ29sb3IpOwogICAgICAgICAgICByZWN0LnNldEF0dHJpYnV0ZU5TKG51bGwsICJtYXNrIiwgInVybCgjIi5jb25jYXQoY3VycmVudC5tYXNrSWQsICIpIikpOwogICAgICAgICAgICB0aGlzLmRlZnMuYXBwZW5kQ2hpbGQobWFzayk7CgogICAgICAgICAgICB0aGlzLl9lbnN1cmVUcmFuc2Zvcm1Hcm91cCgpLmFwcGVuZENoaWxkKHJlY3QpOwoKICAgICAgICAgICAgdGhpcy5wYWludElubGluZUltYWdlWE9iamVjdChpbWdEYXRhLCBtYXNrKTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJwYWludEZvcm1YT2JqZWN0QmVnaW4iLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHBhaW50Rm9ybVhPYmplY3RCZWdpbihtYXRyaXgsIGJib3gpIHsKICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkobWF0cml4KSAmJiBtYXRyaXgubGVuZ3RoID09PSA2KSB7CiAgICAgICAgICAgICAgdGhpcy50cmFuc2Zvcm0obWF0cml4WzBdLCBtYXRyaXhbMV0sIG1hdHJpeFsyXSwgbWF0cml4WzNdLCBtYXRyaXhbNF0sIG1hdHJpeFs1XSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChiYm94KSB7CiAgICAgICAgICAgICAgdmFyIHdpZHRoID0gYmJveFsyXSAtIGJib3hbMF07CiAgICAgICAgICAgICAgdmFyIGhlaWdodCA9IGJib3hbM10gLSBiYm94WzFdOwogICAgICAgICAgICAgIHZhciBjbGlwcmVjdCA9IHRoaXMuc3ZnRmFjdG9yeS5jcmVhdGVFbGVtZW50KCJzdmc6cmVjdCIpOwogICAgICAgICAgICAgIGNsaXByZWN0LnNldEF0dHJpYnV0ZU5TKG51bGwsICJ4IiwgYmJveFswXSk7CiAgICAgICAgICAgICAgY2xpcHJlY3Quc2V0QXR0cmlidXRlTlMobnVsbCwgInkiLCBiYm94WzFdKTsKICAgICAgICAgICAgICBjbGlwcmVjdC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAid2lkdGgiLCBwZih3aWR0aCkpOwogICAgICAgICAgICAgIGNsaXByZWN0LnNldEF0dHJpYnV0ZU5TKG51bGwsICJoZWlnaHQiLCBwZihoZWlnaHQpKTsKICAgICAgICAgICAgICB0aGlzLmN1cnJlbnQuZWxlbWVudCA9IGNsaXByZWN0OwogICAgICAgICAgICAgIHRoaXMuY2xpcCgibm9uemVybyIpOwogICAgICAgICAgICAgIHRoaXMuZW5kUGF0aCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAicGFpbnRGb3JtWE9iamVjdEVuZCIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcGFpbnRGb3JtWE9iamVjdEVuZCgpIHt9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAiX2luaXRpYWxpemUiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9pbml0aWFsaXplKHZpZXdwb3J0KSB7CiAgICAgICAgICAgIHZhciBzdmcgPSB0aGlzLnN2Z0ZhY3RvcnkuY3JlYXRlKHZpZXdwb3J0LndpZHRoLCB2aWV3cG9ydC5oZWlnaHQpOwogICAgICAgICAgICB2YXIgZGVmaW5pdGlvbnMgPSB0aGlzLnN2Z0ZhY3RvcnkuY3JlYXRlRWxlbWVudCgic3ZnOmRlZnMiKTsKICAgICAgICAgICAgc3ZnLmFwcGVuZENoaWxkKGRlZmluaXRpb25zKTsKICAgICAgICAgICAgdGhpcy5kZWZzID0gZGVmaW5pdGlvbnM7CiAgICAgICAgICAgIHZhciByb290R3JvdXAgPSB0aGlzLnN2Z0ZhY3RvcnkuY3JlYXRlRWxlbWVudCgic3ZnOmciKTsKICAgICAgICAgICAgcm9vdEdyb3VwLnNldEF0dHJpYnV0ZU5TKG51bGwsICJ0cmFuc2Zvcm0iLCBwbSh2aWV3cG9ydC50cmFuc2Zvcm0pKTsKICAgICAgICAgICAgc3ZnLmFwcGVuZENoaWxkKHJvb3RHcm91cCk7CiAgICAgICAgICAgIHRoaXMuc3ZnID0gcm9vdEdyb3VwOwogICAgICAgICAgICByZXR1cm4gc3ZnOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogIl9lbnN1cmVDbGlwR3JvdXAiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9lbnN1cmVDbGlwR3JvdXAoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5jdXJyZW50LmNsaXBHcm91cCkgewogICAgICAgICAgICAgIHZhciBjbGlwR3JvdXAgPSB0aGlzLnN2Z0ZhY3RvcnkuY3JlYXRlRWxlbWVudCgic3ZnOmciKTsKICAgICAgICAgICAgICBjbGlwR3JvdXAuc2V0QXR0cmlidXRlTlMobnVsbCwgImNsaXAtcGF0aCIsIHRoaXMuY3VycmVudC5hY3RpdmVDbGlwVXJsKTsKICAgICAgICAgICAgICB0aGlzLnN2Zy5hcHBlbmRDaGlsZChjbGlwR3JvdXApOwogICAgICAgICAgICAgIHRoaXMuY3VycmVudC5jbGlwR3JvdXAgPSBjbGlwR3JvdXA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnQuY2xpcEdyb3VwOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogIl9lbnN1cmVUcmFuc2Zvcm1Hcm91cCIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX2Vuc3VyZVRyYW5zZm9ybUdyb3VwKCkgewogICAgICAgICAgICBpZiAoIXRoaXMudGdycCkgewogICAgICAgICAgICAgIHRoaXMudGdycCA9IHRoaXMuc3ZnRmFjdG9yeS5jcmVhdGVFbGVtZW50KCJzdmc6ZyIpOwogICAgICAgICAgICAgIHRoaXMudGdycC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAidHJhbnNmb3JtIiwgcG0odGhpcy50cmFuc2Zvcm1NYXRyaXgpKTsKCiAgICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudC5hY3RpdmVDbGlwVXJsKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9lbnN1cmVDbGlwR3JvdXAoKS5hcHBlbmRDaGlsZCh0aGlzLnRncnApOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLnN2Zy5hcHBlbmRDaGlsZCh0aGlzLnRncnApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHRoaXMudGdycDsKICAgICAgICAgIH0KICAgICAgICB9XSk7CgogICAgICAgIHJldHVybiBTVkdHcmFwaGljczsKICAgICAgfSgpOwogICAgfQoKICAgIC8qKiovfSksICgKICAvKiAyMDggKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgoKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgICAgdmFsdWU6IHRydWUKICAgIH0pOwogICAgZXhwb3J0cy5QREZOb2RlU3RyZWFtID0gdm9pZCAwOwoKICAgIHZhciBfcmVnZW5lcmF0b3IgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9fd19wZGZqc19yZXF1aXJlX18oMTkxKSk7CgogICAgdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygxKTsKCiAgICB2YXIgX25ldHdvcmtfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIwOSk7CgogICAgZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHtyZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyAiZGVmYXVsdCI6IG9iaiB9O30KCiAgICBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyJAYmFiZWwvaGVscGVycyAtIHR5cGVvZiI7aWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIpIHtfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHtyZXR1cm4gdHlwZW9mIG9iajt9O30gZWxzZSB7X3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7cmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajt9O31yZXR1cm4gX3R5cGVvZihvYmopO30KCiAgICBmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7aWYgKGNhbGwgJiYgKF90eXBlb2YoY2FsbCkgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSkge3JldHVybiBjYWxsO31yZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKTt9CgogICAgZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7aWYgKHNlbGYgPT09IHZvaWQgMCkge3Rocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7fXJldHVybiBzZWxmO30KCiAgICBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2Yobykge19nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZiA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7cmV0dXJuIG8uX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihvKTt9O3JldHVybiBfZ2V0UHJvdG90eXBlT2Yobyk7fQoKICAgIGZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykge2lmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTt9c3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pO2lmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpO30KCiAgICBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkge19zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkge28uX19wcm90b19fID0gcDtyZXR1cm4gbzt9O3JldHVybiBfc2V0UHJvdG90eXBlT2YobywgcCk7fQoKICAgIGZ1bmN0aW9uIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywga2V5LCBhcmcpIHt0cnkge3ZhciBpbmZvID0gZ2VuW2tleV0oYXJnKTt2YXIgdmFsdWUgPSBpbmZvLnZhbHVlO30gY2F0Y2ggKGVycm9yKSB7cmVqZWN0KGVycm9yKTtyZXR1cm47fWlmIChpbmZvLmRvbmUpIHtyZXNvbHZlKHZhbHVlKTt9IGVsc2Uge1Byb21pc2UucmVzb2x2ZSh2YWx1ZSkudGhlbihfbmV4dCwgX3Rocm93KTt9fQoKICAgIGZ1bmN0aW9uIF9hc3luY1RvR2VuZXJhdG9yKGZuKSB7cmV0dXJuIGZ1bmN0aW9uICgpIHt2YXIgc2VsZiA9IHRoaXMsYXJncyA9IGFyZ3VtZW50cztyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge3ZhciBnZW4gPSBmbi5hcHBseShzZWxmLCBhcmdzKTtmdW5jdGlvbiBfbmV4dCh2YWx1ZSkge2FzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgIm5leHQiLCB2YWx1ZSk7fWZ1bmN0aW9uIF90aHJvdyhlcnIpIHthc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJ0aHJvdyIsIGVycik7fV9uZXh0KHVuZGVmaW5lZCk7fSk7fTt9CgogICAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3Rvcikge2lmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7fX0KCiAgICBmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7Zm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykge3ZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07ZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlO2Rlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTtpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTtPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7fX0KCiAgICBmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7aWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7aWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpO3JldHVybiBDb25zdHJ1Y3Rvcjt9CgogICAgdmFyIGZzID0gcmVxdWlyZSgiZnMiKTsKCiAgICB2YXIgaHR0cCA9IHJlcXVpcmUoImh0dHAiKTsKCiAgICB2YXIgaHR0cHMgPSByZXF1aXJlKCJodHRwcyIpOwoKICAgIHZhciB1cmwgPSByZXF1aXJlKCJ1cmwiKTsKCiAgICB2YXIgZmlsZVVyaVJlZ2V4ID0gL15maWxlOlwvXC9cL1thLXpBLVpdOlwvLzsKCiAgICBmdW5jdGlvbiBwYXJzZVVybChzb3VyY2VVcmwpIHsKICAgICAgdmFyIHBhcnNlZFVybCA9IHVybC5wYXJzZShzb3VyY2VVcmwpOwoKICAgICAgaWYgKHBhcnNlZFVybC5wcm90b2NvbCA9PT0gImZpbGU6IiB8fCBwYXJzZWRVcmwuaG9zdCkgewogICAgICAgIHJldHVybiBwYXJzZWRVcmw7CiAgICAgIH0KCiAgICAgIGlmICgvXlthLXpdOlsvXFxdL2kudGVzdChzb3VyY2VVcmwpKSB7CiAgICAgICAgcmV0dXJuIHVybC5wYXJzZSgiZmlsZTovLy8iLmNvbmNhdChzb3VyY2VVcmwpKTsKICAgICAgfQoKICAgICAgaWYgKCFwYXJzZWRVcmwuaG9zdCkgewogICAgICAgIHBhcnNlZFVybC5wcm90b2NvbCA9ICJmaWxlOiI7CiAgICAgIH0KCiAgICAgIHJldHVybiBwYXJzZWRVcmw7CiAgICB9CgogICAgdmFyIFBERk5vZGVTdHJlYW0gPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBQREZOb2RlU3RyZWFtKHNvdXJjZSkgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBQREZOb2RlU3RyZWFtKTsKCiAgICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7CiAgICAgICAgdGhpcy51cmwgPSBwYXJzZVVybChzb3VyY2UudXJsKTsKICAgICAgICB0aGlzLmlzSHR0cCA9IHRoaXMudXJsLnByb3RvY29sID09PSAiaHR0cDoiIHx8IHRoaXMudXJsLnByb3RvY29sID09PSAiaHR0cHM6IjsKICAgICAgICB0aGlzLmlzRnNVcmwgPSB0aGlzLnVybC5wcm90b2NvbCA9PT0gImZpbGU6IjsKICAgICAgICB0aGlzLmh0dHBIZWFkZXJzID0gdGhpcy5pc0h0dHAgJiYgc291cmNlLmh0dHBIZWFkZXJzIHx8IHt9OwogICAgICAgIHRoaXMuX2Z1bGxSZXF1ZXN0UmVhZGVyID0gbnVsbDsKICAgICAgICB0aGlzLl9yYW5nZVJlcXVlc3RSZWFkZXJzID0gW107CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhQREZOb2RlU3RyZWFtLCBbewogICAgICAgIGtleTogImdldEZ1bGxSZWFkZXIiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRGdWxsUmVhZGVyKCkgewogICAgICAgICAgKDAsIF91dGlsLmFzc2VydCkoIXRoaXMuX2Z1bGxSZXF1ZXN0UmVhZGVyKTsKICAgICAgICAgIHRoaXMuX2Z1bGxSZXF1ZXN0UmVhZGVyID0gdGhpcy5pc0ZzVXJsID8gbmV3IFBERk5vZGVTdHJlYW1Gc0Z1bGxSZWFkZXIodGhpcykgOiBuZXcgUERGTm9kZVN0cmVhbUZ1bGxSZWFkZXIodGhpcyk7CiAgICAgICAgICByZXR1cm4gdGhpcy5fZnVsbFJlcXVlc3RSZWFkZXI7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0UmFuZ2VSZWFkZXIiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRSYW5nZVJlYWRlcihzdGFydCwgZW5kKSB7CiAgICAgICAgICBpZiAoZW5kIDw9IHRoaXMuX3Byb2dyZXNzaXZlRGF0YUxlbmd0aCkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcmFuZ2VSZWFkZXIgPSB0aGlzLmlzRnNVcmwgPyBuZXcgUERGTm9kZVN0cmVhbUZzUmFuZ2VSZWFkZXIodGhpcywgc3RhcnQsIGVuZCkgOiBuZXcgUERGTm9kZVN0cmVhbVJhbmdlUmVhZGVyKHRoaXMsIHN0YXJ0LCBlbmQpOwoKICAgICAgICAgIHRoaXMuX3JhbmdlUmVxdWVzdFJlYWRlcnMucHVzaChyYW5nZVJlYWRlcik7CgogICAgICAgICAgcmV0dXJuIHJhbmdlUmVhZGVyOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImNhbmNlbEFsbFJlcXVlc3RzIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY2FuY2VsQWxsUmVxdWVzdHMocmVhc29uKSB7CiAgICAgICAgICBpZiAodGhpcy5fZnVsbFJlcXVlc3RSZWFkZXIpIHsKICAgICAgICAgICAgdGhpcy5fZnVsbFJlcXVlc3RSZWFkZXIuY2FuY2VsKHJlYXNvbik7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHJlYWRlcnMgPSB0aGlzLl9yYW5nZVJlcXVlc3RSZWFkZXJzLnNsaWNlKDApOwoKICAgICAgICAgIHJlYWRlcnMuZm9yRWFjaChmdW5jdGlvbiAocmVhZGVyKSB7CiAgICAgICAgICAgIHJlYWRlci5jYW5jZWwocmVhc29uKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIl9wcm9ncmVzc2l2ZURhdGFMZW5ndGgiLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX2Z1bGxSZXF1ZXN0UmVhZGVyID8gdGhpcy5fZnVsbFJlcXVlc3RSZWFkZXIuX2xvYWRlZCA6IDA7CiAgICAgICAgfQogICAgICB9XSk7CgogICAgICByZXR1cm4gUERGTm9kZVN0cmVhbTsKICAgIH0oKTsKCiAgICBleHBvcnRzLlBERk5vZGVTdHJlYW0gPSBQREZOb2RlU3RyZWFtOwoKICAgIHZhciBCYXNlRnVsbFJlYWRlciA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgIGZ1bmN0aW9uIEJhc2VGdWxsUmVhZGVyKHN0cmVhbSkgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBCYXNlRnVsbFJlYWRlcik7CgogICAgICAgIHRoaXMuX3VybCA9IHN0cmVhbS51cmw7CiAgICAgICAgdGhpcy5fZG9uZSA9IGZhbHNlOwogICAgICAgIHRoaXMuX3N0b3JlZEVycm9yID0gbnVsbDsKICAgICAgICB0aGlzLm9uUHJvZ3Jlc3MgPSBudWxsOwogICAgICAgIHZhciBzb3VyY2UgPSBzdHJlYW0uc291cmNlOwogICAgICAgIHRoaXMuX2NvbnRlbnRMZW5ndGggPSBzb3VyY2UubGVuZ3RoOwogICAgICAgIHRoaXMuX2xvYWRlZCA9IDA7CiAgICAgICAgdGhpcy5fZmlsZW5hbWUgPSBudWxsOwogICAgICAgIHRoaXMuX2Rpc2FibGVSYW5nZSA9IHNvdXJjZS5kaXNhYmxlUmFuZ2UgfHwgZmFsc2U7CiAgICAgICAgdGhpcy5fcmFuZ2VDaHVua1NpemUgPSBzb3VyY2UucmFuZ2VDaHVua1NpemU7CgogICAgICAgIGlmICghdGhpcy5fcmFuZ2VDaHVua1NpemUgJiYgIXRoaXMuX2Rpc2FibGVSYW5nZSkgewogICAgICAgICAgdGhpcy5fZGlzYWJsZVJhbmdlID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIHRoaXMuX2lzU3RyZWFtaW5nU3VwcG9ydGVkID0gIXNvdXJjZS5kaXNhYmxlU3RyZWFtOwogICAgICAgIHRoaXMuX2lzUmFuZ2VTdXBwb3J0ZWQgPSAhc291cmNlLmRpc2FibGVSYW5nZTsKICAgICAgICB0aGlzLl9yZWFkYWJsZVN0cmVhbSA9IG51bGw7CiAgICAgICAgdGhpcy5fcmVhZENhcGFiaWxpdHkgPSAoMCwgX3V0aWwuY3JlYXRlUHJvbWlzZUNhcGFiaWxpdHkpKCk7CiAgICAgICAgdGhpcy5faGVhZGVyc0NhcGFiaWxpdHkgPSAoMCwgX3V0aWwuY3JlYXRlUHJvbWlzZUNhcGFiaWxpdHkpKCk7CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhCYXNlRnVsbFJlYWRlciwgW3sKICAgICAgICBrZXk6ICJyZWFkIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIF9yZWFkID0gX2FzeW5jVG9HZW5lcmF0b3IoLyojX19QVVJFX18qL19yZWdlbmVyYXRvclsiZGVmYXVsdCJdLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICAgICAgdmFyIGNodW5rLCBidWZmZXI7CiAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JbImRlZmF1bHQiXS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZWFkQ2FwYWJpbGl0eS5wcm9taXNlOwoKICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5fZG9uZSkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgICBkb25lOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9zdG9yZWRFcnJvcikgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDY7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHRocm93IHRoaXMuX3N0b3JlZEVycm9yOwoKICAgICAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgICAgIGNodW5rID0gdGhpcy5fcmVhZGFibGVTdHJlYW0ucmVhZCgpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoIShjaHVuayA9PT0gbnVsbCkpIHsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMDsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVhZENhcGFiaWxpdHkgPSAoMCwgX3V0aWwuY3JlYXRlUHJvbWlzZUNhcGFiaWxpdHkpKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgdGhpcy5yZWFkKCkpOwoKICAgICAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgICAgICB0aGlzLl9sb2FkZWQgKz0gY2h1bmsubGVuZ3RoOwoKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vblByb2dyZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9uUHJvZ3Jlc3MoewogICAgICAgICAgICAgICAgICAgICAgICBsb2FkZWQ6IHRoaXMuX2xvYWRlZCwKICAgICAgICAgICAgICAgICAgICAgICAgdG90YWw6IHRoaXMuX2NvbnRlbnRMZW5ndGgKICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgYnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkoY2h1bmspLmJ1ZmZlcjsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogYnVmZmVyLAogICAgICAgICAgICAgICAgICAgICAgZG9uZTogZmFsc2UKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIF9jYWxsZWUsIHRoaXMpOwogICAgICAgICAgfSkpOwoKICAgICAgICAgIGZ1bmN0aW9uIHJlYWQoKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVhZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiByZWFkOwogICAgICAgIH0oKQogICAgICB9LCB7CiAgICAgICAga2V5OiAiY2FuY2VsIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY2FuY2VsKHJlYXNvbikgewogICAgICAgICAgaWYgKCF0aGlzLl9yZWFkYWJsZVN0cmVhbSkgewogICAgICAgICAgICB0aGlzLl9lcnJvcihyZWFzb24pOwoKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuX3JlYWRhYmxlU3RyZWFtLmRlc3Ryb3kocmVhc29uKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJfZXJyb3IiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZXJyb3IocmVhc29uKSB7CiAgICAgICAgICB0aGlzLl9zdG9yZWRFcnJvciA9IHJlYXNvbjsKCiAgICAgICAgICB0aGlzLl9yZWFkQ2FwYWJpbGl0eS5yZXNvbHZlKCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiX3NldFJlYWRhYmxlU3RyZWFtIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX3NldFJlYWRhYmxlU3RyZWFtKHJlYWRhYmxlU3RyZWFtKSB7CiAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgICAgIHRoaXMuX3JlYWRhYmxlU3RyZWFtID0gcmVhZGFibGVTdHJlYW07CiAgICAgICAgICByZWFkYWJsZVN0cmVhbS5vbigicmVhZGFibGUiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzLl9yZWFkQ2FwYWJpbGl0eS5yZXNvbHZlKCk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHJlYWRhYmxlU3RyZWFtLm9uKCJlbmQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJlYWRhYmxlU3RyZWFtLmRlc3Ryb3koKTsKICAgICAgICAgICAgX3RoaXMuX2RvbmUgPSB0cnVlOwoKICAgICAgICAgICAgX3RoaXMuX3JlYWRDYXBhYmlsaXR5LnJlc29sdmUoKTsKICAgICAgICAgIH0pOwogICAgICAgICAgcmVhZGFibGVTdHJlYW0ub24oImVycm9yIiwgZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgICBfdGhpcy5fZXJyb3IocmVhc29uKTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmICghdGhpcy5faXNTdHJlYW1pbmdTdXBwb3J0ZWQgJiYgdGhpcy5faXNSYW5nZVN1cHBvcnRlZCkgewogICAgICAgICAgICB0aGlzLl9lcnJvcihuZXcgX3V0aWwuQWJvcnRFeGNlcHRpb24oInN0cmVhbWluZyBpcyBkaXNhYmxlZCIpKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodGhpcy5fc3RvcmVkRXJyb3IpIHsKICAgICAgICAgICAgdGhpcy5fcmVhZGFibGVTdHJlYW0uZGVzdHJveSh0aGlzLl9zdG9yZWRFcnJvcik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiaGVhZGVyc1JlYWR5IiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9oZWFkZXJzQ2FwYWJpbGl0eS5wcm9taXNlOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImZpbGVuYW1lIiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9maWxlbmFtZTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJjb250ZW50TGVuZ3RoIiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9jb250ZW50TGVuZ3RoOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImlzUmFuZ2VTdXBwb3J0ZWQiLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX2lzUmFuZ2VTdXBwb3J0ZWQ7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiaXNTdHJlYW1pbmdTdXBwb3J0ZWQiLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX2lzU3RyZWFtaW5nU3VwcG9ydGVkOwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIEJhc2VGdWxsUmVhZGVyOwogICAgfSgpOwoKICAgIHZhciBCYXNlUmFuZ2VSZWFkZXIgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBCYXNlUmFuZ2VSZWFkZXIoc3RyZWFtKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEJhc2VSYW5nZVJlYWRlcik7CgogICAgICAgIHRoaXMuX3VybCA9IHN0cmVhbS51cmw7CiAgICAgICAgdGhpcy5fZG9uZSA9IGZhbHNlOwogICAgICAgIHRoaXMuX3N0b3JlZEVycm9yID0gbnVsbDsKICAgICAgICB0aGlzLm9uUHJvZ3Jlc3MgPSBudWxsOwogICAgICAgIHRoaXMuX2xvYWRlZCA9IDA7CiAgICAgICAgdGhpcy5fcmVhZGFibGVTdHJlYW0gPSBudWxsOwogICAgICAgIHRoaXMuX3JlYWRDYXBhYmlsaXR5ID0gKDAsIF91dGlsLmNyZWF0ZVByb21pc2VDYXBhYmlsaXR5KSgpOwogICAgICAgIHZhciBzb3VyY2UgPSBzdHJlYW0uc291cmNlOwogICAgICAgIHRoaXMuX2lzU3RyZWFtaW5nU3VwcG9ydGVkID0gIXNvdXJjZS5kaXNhYmxlU3RyZWFtOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoQmFzZVJhbmdlUmVhZGVyLCBbewogICAgICAgIGtleTogInJlYWQiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgX3JlYWQyID0gX2FzeW5jVG9HZW5lcmF0b3IoLyojX19QVVJFX18qL19yZWdlbmVyYXRvclsiZGVmYXVsdCJdLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgICAgICAgIHZhciBjaHVuaywgYnVmZmVyOwogICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yWyJkZWZhdWx0Il0ud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAyOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZWFkQ2FwYWJpbGl0eS5wcm9taXNlOwoKICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5fZG9uZSkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA0OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICAgIGRvbmU6IHRydWUKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX3N0b3JlZEVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDY7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHRocm93IHRoaXMuX3N0b3JlZEVycm9yOwoKICAgICAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgICAgIGNodW5rID0gdGhpcy5fcmVhZGFibGVTdHJlYW0ucmVhZCgpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoIShjaHVuayA9PT0gbnVsbCkpIHsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlYWRDYXBhYmlsaXR5ID0gKDAsIF91dGlsLmNyZWF0ZVByb21pc2VDYXBhYmlsaXR5KSgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCB0aGlzLnJlYWQoKSk7CgogICAgICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgICAgIHRoaXMuX2xvYWRlZCArPSBjaHVuay5sZW5ndGg7CgogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm9uUHJvZ3Jlc3MpIHsKICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25Qcm9ncmVzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlZDogdGhpcy5fbG9hZGVkCiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KGNodW5rKS5idWZmZXI7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBidWZmZXIsCiAgICAgICAgICAgICAgICAgICAgICBkb25lOiBmYWxzZQogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIF9jYWxsZWUyLCB0aGlzKTsKICAgICAgICAgIH0pKTsKCiAgICAgICAgICBmdW5jdGlvbiByZWFkKCkgewogICAgICAgICAgICByZXR1cm4gX3JlYWQyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHJlYWQ7CiAgICAgICAgfSgpCiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJjYW5jZWwiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjYW5jZWwocmVhc29uKSB7CiAgICAgICAgICBpZiAoIXRoaXMuX3JlYWRhYmxlU3RyZWFtKSB7CiAgICAgICAgICAgIHRoaXMuX2Vycm9yKHJlYXNvbik7CgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5fcmVhZGFibGVTdHJlYW0uZGVzdHJveShyZWFzb24pOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIl9lcnJvciIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9lcnJvcihyZWFzb24pIHsKICAgICAgICAgIHRoaXMuX3N0b3JlZEVycm9yID0gcmVhc29uOwoKICAgICAgICAgIHRoaXMuX3JlYWRDYXBhYmlsaXR5LnJlc29sdmUoKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJfc2V0UmVhZGFibGVTdHJlYW0iLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfc2V0UmVhZGFibGVTdHJlYW0ocmVhZGFibGVTdHJlYW0pIHsKICAgICAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgICAgIHRoaXMuX3JlYWRhYmxlU3RyZWFtID0gcmVhZGFibGVTdHJlYW07CiAgICAgICAgICByZWFkYWJsZVN0cmVhbS5vbigicmVhZGFibGUiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzMi5fcmVhZENhcGFiaWxpdHkucmVzb2x2ZSgpOwogICAgICAgICAgfSk7CiAgICAgICAgICByZWFkYWJsZVN0cmVhbS5vbigiZW5kIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZWFkYWJsZVN0cmVhbS5kZXN0cm95KCk7CiAgICAgICAgICAgIF90aGlzMi5fZG9uZSA9IHRydWU7CgogICAgICAgICAgICBfdGhpczIuX3JlYWRDYXBhYmlsaXR5LnJlc29sdmUoKTsKICAgICAgICAgIH0pOwogICAgICAgICAgcmVhZGFibGVTdHJlYW0ub24oImVycm9yIiwgZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgICBfdGhpczIuX2Vycm9yKHJlYXNvbik7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAodGhpcy5fc3RvcmVkRXJyb3IpIHsKICAgICAgICAgICAgdGhpcy5fcmVhZGFibGVTdHJlYW0uZGVzdHJveSh0aGlzLl9zdG9yZWRFcnJvcik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiaXNTdHJlYW1pbmdTdXBwb3J0ZWQiLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX2lzU3RyZWFtaW5nU3VwcG9ydGVkOwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIEJhc2VSYW5nZVJlYWRlcjsKICAgIH0oKTsKCiAgICBmdW5jdGlvbiBjcmVhdGVSZXF1ZXN0T3B0aW9ucyh1cmwsIGhlYWRlcnMpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBwcm90b2NvbDogdXJsLnByb3RvY29sLAogICAgICAgIGF1dGg6IHVybC5hdXRoLAogICAgICAgIGhvc3Q6IHVybC5ob3N0bmFtZSwKICAgICAgICBwb3J0OiB1cmwucG9ydCwKICAgICAgICBwYXRoOiB1cmwucGF0aCwKICAgICAgICBtZXRob2Q6ICJHRVQiLAogICAgICAgIGhlYWRlcnM6IGhlYWRlcnMKICAgICAgfTsKICAgIH0KCiAgICB2YXIgUERGTm9kZVN0cmVhbUZ1bGxSZWFkZXIgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9CYXNlRnVsbFJlYWRlcikgewogICAgICBfaW5oZXJpdHMoUERGTm9kZVN0cmVhbUZ1bGxSZWFkZXIsIF9CYXNlRnVsbFJlYWRlcik7CgogICAgICBmdW5jdGlvbiBQREZOb2RlU3RyZWFtRnVsbFJlYWRlcihzdHJlYW0pIHsKICAgICAgICB2YXIgX3RoaXMzOwoKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUERGTm9kZVN0cmVhbUZ1bGxSZWFkZXIpOwoKICAgICAgICBfdGhpczMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoUERGTm9kZVN0cmVhbUZ1bGxSZWFkZXIpLmNhbGwodGhpcywgc3RyZWFtKSk7CgogICAgICAgIHZhciBoYW5kbGVSZXNwb25zZSA9IGZ1bmN0aW9uIGhhbmRsZVJlc3BvbnNlKHJlc3BvbnNlKSB7CiAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzQ29kZSA9PT0gNDA0KSB7CiAgICAgICAgICAgIHZhciBlcnJvciA9IG5ldyBfdXRpbC5NaXNzaW5nUERGRXhjZXB0aW9uKCJNaXNzaW5nIFBERiBcIiIuY29uY2F0KF90aGlzMy5fdXJsLCAiXCIuIikpOwogICAgICAgICAgICBfdGhpczMuX3N0b3JlZEVycm9yID0gZXJyb3I7CgogICAgICAgICAgICBfdGhpczMuX2hlYWRlcnNDYXBhYmlsaXR5LnJlamVjdChlcnJvcik7CgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMzLl9oZWFkZXJzQ2FwYWJpbGl0eS5yZXNvbHZlKCk7CgogICAgICAgICAgX3RoaXMzLl9zZXRSZWFkYWJsZVN0cmVhbShyZXNwb25zZSk7CgogICAgICAgICAgdmFyIGdldFJlc3BvbnNlSGVhZGVyID0gZnVuY3Rpb24gZ2V0UmVzcG9uc2VIZWFkZXIobmFtZSkgewogICAgICAgICAgICByZXR1cm4gX3RoaXMzLl9yZWFkYWJsZVN0cmVhbS5oZWFkZXJzW25hbWUudG9Mb3dlckNhc2UoKV07CiAgICAgICAgICB9OwoKICAgICAgICAgIHZhciBfdmFsaWRhdGVSYW5nZVJlcXVlc3QgPSAoMCwgX25ldHdvcmtfdXRpbHMudmFsaWRhdGVSYW5nZVJlcXVlc3RDYXBhYmlsaXRpZXMpKHsKICAgICAgICAgICAgICBnZXRSZXNwb25zZUhlYWRlcjogZ2V0UmVzcG9uc2VIZWFkZXIsCiAgICAgICAgICAgICAgaXNIdHRwOiBzdHJlYW0uaXNIdHRwLAogICAgICAgICAgICAgIHJhbmdlQ2h1bmtTaXplOiBfdGhpczMuX3JhbmdlQ2h1bmtTaXplLAogICAgICAgICAgICAgIGRpc2FibGVSYW5nZTogX3RoaXMzLl9kaXNhYmxlUmFuZ2UKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIGFsbG93UmFuZ2VSZXF1ZXN0cyA9IF92YWxpZGF0ZVJhbmdlUmVxdWVzdC5hbGxvd1JhbmdlUmVxdWVzdHMsCiAgICAgICAgICAgIHN1Z2dlc3RlZExlbmd0aCA9IF92YWxpZGF0ZVJhbmdlUmVxdWVzdC5zdWdnZXN0ZWRMZW5ndGg7CgogICAgICAgICAgX3RoaXMzLl9pc1JhbmdlU3VwcG9ydGVkID0gYWxsb3dSYW5nZVJlcXVlc3RzOwogICAgICAgICAgX3RoaXMzLl9jb250ZW50TGVuZ3RoID0gc3VnZ2VzdGVkTGVuZ3RoIHx8IF90aGlzMy5fY29udGVudExlbmd0aDsKICAgICAgICAgIF90aGlzMy5fZmlsZW5hbWUgPSAoMCwgX25ldHdvcmtfdXRpbHMuZXh0cmFjdEZpbGVuYW1lRnJvbUhlYWRlcikoZ2V0UmVzcG9uc2VIZWFkZXIpOwogICAgICAgIH07CgogICAgICAgIF90aGlzMy5fcmVxdWVzdCA9IG51bGw7CgogICAgICAgIGlmIChfdGhpczMuX3VybC5wcm90b2NvbCA9PT0gImh0dHA6IikgewogICAgICAgICAgX3RoaXMzLl9yZXF1ZXN0ID0gaHR0cC5yZXF1ZXN0KGNyZWF0ZVJlcXVlc3RPcHRpb25zKF90aGlzMy5fdXJsLCBzdHJlYW0uaHR0cEhlYWRlcnMpLCBoYW5kbGVSZXNwb25zZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIF90aGlzMy5fcmVxdWVzdCA9IGh0dHBzLnJlcXVlc3QoY3JlYXRlUmVxdWVzdE9wdGlvbnMoX3RoaXMzLl91cmwsIHN0cmVhbS5odHRwSGVhZGVycyksIGhhbmRsZVJlc3BvbnNlKTsKICAgICAgICB9CgogICAgICAgIF90aGlzMy5fcmVxdWVzdC5vbigiZXJyb3IiLCBmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICBfdGhpczMuX3N0b3JlZEVycm9yID0gcmVhc29uOwoKICAgICAgICAgIF90aGlzMy5faGVhZGVyc0NhcGFiaWxpdHkucmVqZWN0KHJlYXNvbik7CiAgICAgICAgfSk7CgogICAgICAgIF90aGlzMy5fcmVxdWVzdC5lbmQoKTsKCiAgICAgICAgcmV0dXJuIF90aGlzMzsKICAgICAgfQoKICAgICAgcmV0dXJuIFBERk5vZGVTdHJlYW1GdWxsUmVhZGVyOwogICAgfShCYXNlRnVsbFJlYWRlcik7CgogICAgdmFyIFBERk5vZGVTdHJlYW1SYW5nZVJlYWRlciA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0Jhc2VSYW5nZVJlYWRlcikgewogICAgICBfaW5oZXJpdHMoUERGTm9kZVN0cmVhbVJhbmdlUmVhZGVyLCBfQmFzZVJhbmdlUmVhZGVyKTsKCiAgICAgIGZ1bmN0aW9uIFBERk5vZGVTdHJlYW1SYW5nZVJlYWRlcihzdHJlYW0sIHN0YXJ0LCBlbmQpIHsKICAgICAgICB2YXIgX3RoaXM0OwoKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUERGTm9kZVN0cmVhbVJhbmdlUmVhZGVyKTsKCiAgICAgICAgX3RoaXM0ID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKFBERk5vZGVTdHJlYW1SYW5nZVJlYWRlcikuY2FsbCh0aGlzLCBzdHJlYW0pKTsKICAgICAgICBfdGhpczQuX2h0dHBIZWFkZXJzID0ge307CgogICAgICAgIGZvciAodmFyIHByb3BlcnR5IGluIHN0cmVhbS5odHRwSGVhZGVycykgewogICAgICAgICAgdmFyIHZhbHVlID0gc3RyZWFtLmh0dHBIZWFkZXJzW3Byb3BlcnR5XTsKCiAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBfdGhpczQuX2h0dHBIZWFkZXJzW3Byb3BlcnR5XSA9IHZhbHVlOwogICAgICAgIH0KCiAgICAgICAgX3RoaXM0Ll9odHRwSGVhZGVyc1siUmFuZ2UiXSA9ICJieXRlcz0iLmNvbmNhdChzdGFydCwgIi0iKS5jb25jYXQoZW5kIC0gMSk7CgogICAgICAgIHZhciBoYW5kbGVSZXNwb25zZSA9IGZ1bmN0aW9uIGhhbmRsZVJlc3BvbnNlKHJlc3BvbnNlKSB7CiAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzQ29kZSA9PT0gNDA0KSB7CiAgICAgICAgICAgIHZhciBlcnJvciA9IG5ldyBfdXRpbC5NaXNzaW5nUERGRXhjZXB0aW9uKCJNaXNzaW5nIFBERiBcIiIuY29uY2F0KF90aGlzNC5fdXJsLCAiXCIuIikpOwogICAgICAgICAgICBfdGhpczQuX3N0b3JlZEVycm9yID0gZXJyb3I7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBfdGhpczQuX3NldFJlYWRhYmxlU3RyZWFtKHJlc3BvbnNlKTsKICAgICAgICB9OwoKICAgICAgICBfdGhpczQuX3JlcXVlc3QgPSBudWxsOwoKICAgICAgICBpZiAoX3RoaXM0Ll91cmwucHJvdG9jb2wgPT09ICJodHRwOiIpIHsKICAgICAgICAgIF90aGlzNC5fcmVxdWVzdCA9IGh0dHAucmVxdWVzdChjcmVhdGVSZXF1ZXN0T3B0aW9ucyhfdGhpczQuX3VybCwgX3RoaXM0Ll9odHRwSGVhZGVycyksIGhhbmRsZVJlc3BvbnNlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX3RoaXM0Ll9yZXF1ZXN0ID0gaHR0cHMucmVxdWVzdChjcmVhdGVSZXF1ZXN0T3B0aW9ucyhfdGhpczQuX3VybCwgX3RoaXM0Ll9odHRwSGVhZGVycyksIGhhbmRsZVJlc3BvbnNlKTsKICAgICAgICB9CgogICAgICAgIF90aGlzNC5fcmVxdWVzdC5vbigiZXJyb3IiLCBmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICBfdGhpczQuX3N0b3JlZEVycm9yID0gcmVhc29uOwogICAgICAgIH0pOwoKICAgICAgICBfdGhpczQuX3JlcXVlc3QuZW5kKCk7CgogICAgICAgIHJldHVybiBfdGhpczQ7CiAgICAgIH0KCiAgICAgIHJldHVybiBQREZOb2RlU3RyZWFtUmFuZ2VSZWFkZXI7CiAgICB9KEJhc2VSYW5nZVJlYWRlcik7CgogICAgdmFyIFBERk5vZGVTdHJlYW1Gc0Z1bGxSZWFkZXIgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9CYXNlRnVsbFJlYWRlcjIpIHsKICAgICAgX2luaGVyaXRzKFBERk5vZGVTdHJlYW1Gc0Z1bGxSZWFkZXIsIF9CYXNlRnVsbFJlYWRlcjIpOwoKICAgICAgZnVuY3Rpb24gUERGTm9kZVN0cmVhbUZzRnVsbFJlYWRlcihzdHJlYW0pIHsKICAgICAgICB2YXIgX3RoaXM1OwoKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUERGTm9kZVN0cmVhbUZzRnVsbFJlYWRlcik7CgogICAgICAgIF90aGlzNSA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihQREZOb2RlU3RyZWFtRnNGdWxsUmVhZGVyKS5jYWxsKHRoaXMsIHN0cmVhbSkpOwogICAgICAgIHZhciBwYXRoID0gZGVjb2RlVVJJQ29tcG9uZW50KF90aGlzNS5fdXJsLnBhdGgpOwoKICAgICAgICBpZiAoZmlsZVVyaVJlZ2V4LnRlc3QoX3RoaXM1Ll91cmwuaHJlZikpIHsKICAgICAgICAgIHBhdGggPSBwYXRoLnJlcGxhY2UoL15cLy8sICIiKTsKICAgICAgICB9CgogICAgICAgIGZzLmxzdGF0KHBhdGgsIGZ1bmN0aW9uIChlcnJvciwgc3RhdCkgewogICAgICAgICAgaWYgKGVycm9yKSB7CiAgICAgICAgICAgIGlmIChlcnJvci5jb2RlID09PSAiRU5PRU5UIikgewogICAgICAgICAgICAgIGVycm9yID0gbmV3IF91dGlsLk1pc3NpbmdQREZFeGNlcHRpb24oIk1pc3NpbmcgUERGIFwiIi5jb25jYXQocGF0aCwgIlwiLiIpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgX3RoaXM1Ll9zdG9yZWRFcnJvciA9IGVycm9yOwoKICAgICAgICAgICAgX3RoaXM1Ll9oZWFkZXJzQ2FwYWJpbGl0eS5yZWplY3QoZXJyb3IpOwoKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIF90aGlzNS5fY29udGVudExlbmd0aCA9IHN0YXQuc2l6ZTsKCiAgICAgICAgICBfdGhpczUuX3NldFJlYWRhYmxlU3RyZWFtKGZzLmNyZWF0ZVJlYWRTdHJlYW0ocGF0aCkpOwoKICAgICAgICAgIF90aGlzNS5faGVhZGVyc0NhcGFiaWxpdHkucmVzb2x2ZSgpOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBfdGhpczU7CiAgICAgIH0KCiAgICAgIHJldHVybiBQREZOb2RlU3RyZWFtRnNGdWxsUmVhZGVyOwogICAgfShCYXNlRnVsbFJlYWRlcik7CgogICAgdmFyIFBERk5vZGVTdHJlYW1Gc1JhbmdlUmVhZGVyID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQmFzZVJhbmdlUmVhZGVyMikgewogICAgICBfaW5oZXJpdHMoUERGTm9kZVN0cmVhbUZzUmFuZ2VSZWFkZXIsIF9CYXNlUmFuZ2VSZWFkZXIyKTsKCiAgICAgIGZ1bmN0aW9uIFBERk5vZGVTdHJlYW1Gc1JhbmdlUmVhZGVyKHN0cmVhbSwgc3RhcnQsIGVuZCkgewogICAgICAgIHZhciBfdGhpczY7CgogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBQREZOb2RlU3RyZWFtRnNSYW5nZVJlYWRlcik7CgogICAgICAgIF90aGlzNiA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihQREZOb2RlU3RyZWFtRnNSYW5nZVJlYWRlcikuY2FsbCh0aGlzLCBzdHJlYW0pKTsKICAgICAgICB2YXIgcGF0aCA9IGRlY29kZVVSSUNvbXBvbmVudChfdGhpczYuX3VybC5wYXRoKTsKCiAgICAgICAgaWYgKGZpbGVVcmlSZWdleC50ZXN0KF90aGlzNi5fdXJsLmhyZWYpKSB7CiAgICAgICAgICBwYXRoID0gcGF0aC5yZXBsYWNlKC9eXC8vLCAiIik7CiAgICAgICAgfQoKICAgICAgICBfdGhpczYuX3NldFJlYWRhYmxlU3RyZWFtKGZzLmNyZWF0ZVJlYWRTdHJlYW0ocGF0aCwgewogICAgICAgICAgc3RhcnQ6IHN0YXJ0LAogICAgICAgICAgZW5kOiBlbmQgLSAxCiAgICAgICAgfSkpOwoKICAgICAgICByZXR1cm4gX3RoaXM2OwogICAgICB9CgogICAgICByZXR1cm4gUERGTm9kZVN0cmVhbUZzUmFuZ2VSZWFkZXI7CiAgICB9KEJhc2VSYW5nZVJlYWRlcik7CgogICAgLyoqKi99KSwgKAogIC8qIDIwOSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCgogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICB2YWx1ZTogdHJ1ZQogICAgfSk7CiAgICBleHBvcnRzLmNyZWF0ZVJlc3BvbnNlU3RhdHVzRXJyb3IgPSBjcmVhdGVSZXNwb25zZVN0YXR1c0Vycm9yOwogICAgZXhwb3J0cy5leHRyYWN0RmlsZW5hbWVGcm9tSGVhZGVyID0gZXh0cmFjdEZpbGVuYW1lRnJvbUhlYWRlcjsKICAgIGV4cG9ydHMudmFsaWRhdGVSYW5nZVJlcXVlc3RDYXBhYmlsaXRpZXMgPSB2YWxpZGF0ZVJhbmdlUmVxdWVzdENhcGFiaWxpdGllczsKICAgIGV4cG9ydHMudmFsaWRhdGVSZXNwb25zZVN0YXR1cyA9IHZhbGlkYXRlUmVzcG9uc2VTdGF0dXM7CgogICAgdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygxKTsKCiAgICB2YXIgX2NvbnRlbnRfZGlzcG9zaXRpb24gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIxMCk7CgogICAgZnVuY3Rpb24gdmFsaWRhdGVSYW5nZVJlcXVlc3RDYXBhYmlsaXRpZXMoX3JlZikgewogICAgICB2YXIgZ2V0UmVzcG9uc2VIZWFkZXIgPSBfcmVmLmdldFJlc3BvbnNlSGVhZGVyLAogICAgICAgIGlzSHR0cCA9IF9yZWYuaXNIdHRwLAogICAgICAgIHJhbmdlQ2h1bmtTaXplID0gX3JlZi5yYW5nZUNodW5rU2l6ZSwKICAgICAgICBkaXNhYmxlUmFuZ2UgPSBfcmVmLmRpc2FibGVSYW5nZTsKICAgICAgKDAsIF91dGlsLmFzc2VydCkocmFuZ2VDaHVua1NpemUgPiAwLCAiUmFuZ2UgY2h1bmsgc2l6ZSBtdXN0IGJlIGxhcmdlciB0aGFuIHplcm8iKTsKICAgICAgdmFyIHJldHVyblZhbHVlcyA9IHsKICAgICAgICBhbGxvd1JhbmdlUmVxdWVzdHM6IGZhbHNlLAogICAgICAgIHN1Z2dlc3RlZExlbmd0aDogdW5kZWZpbmVkCiAgICAgIH07CiAgICAgIHZhciBsZW5ndGggPSBwYXJzZUludChnZXRSZXNwb25zZUhlYWRlcigiQ29udGVudC1MZW5ndGgiKSwgMTApOwoKICAgICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGxlbmd0aCkpIHsKICAgICAgICByZXR1cm4gcmV0dXJuVmFsdWVzOwogICAgICB9CgogICAgICByZXR1cm5WYWx1ZXMuc3VnZ2VzdGVkTGVuZ3RoID0gbGVuZ3RoOwoKICAgICAgaWYgKGxlbmd0aCA8PSAyICogcmFuZ2VDaHVua1NpemUpIHsKICAgICAgICByZXR1cm4gcmV0dXJuVmFsdWVzOwogICAgICB9CgogICAgICBpZiAoZGlzYWJsZVJhbmdlIHx8ICFpc0h0dHApIHsKICAgICAgICByZXR1cm4gcmV0dXJuVmFsdWVzOwogICAgICB9CgogICAgICBpZiAoZ2V0UmVzcG9uc2VIZWFkZXIoIkFjY2VwdC1SYW5nZXMiKSAhPT0gImJ5dGVzIikgewogICAgICAgIHJldHVybiByZXR1cm5WYWx1ZXM7CiAgICAgIH0KCiAgICAgIHZhciBjb250ZW50RW5jb2RpbmcgPSBnZXRSZXNwb25zZUhlYWRlcigiQ29udGVudC1FbmNvZGluZyIpIHx8ICJpZGVudGl0eSI7CgogICAgICBpZiAoY29udGVudEVuY29kaW5nICE9PSAiaWRlbnRpdHkiKSB7CiAgICAgICAgcmV0dXJuIHJldHVyblZhbHVlczsKICAgICAgfQoKICAgICAgcmV0dXJuVmFsdWVzLmFsbG93UmFuZ2VSZXF1ZXN0cyA9IHRydWU7CiAgICAgIHJldHVybiByZXR1cm5WYWx1ZXM7CiAgICB9CgogICAgZnVuY3Rpb24gZXh0cmFjdEZpbGVuYW1lRnJvbUhlYWRlcihnZXRSZXNwb25zZUhlYWRlcikgewogICAgICB2YXIgY29udGVudERpc3Bvc2l0aW9uID0gZ2V0UmVzcG9uc2VIZWFkZXIoIkNvbnRlbnQtRGlzcG9zaXRpb24iKTsKCiAgICAgIGlmIChjb250ZW50RGlzcG9zaXRpb24pIHsKICAgICAgICB2YXIgZmlsZW5hbWUgPSAoMCwgX2NvbnRlbnRfZGlzcG9zaXRpb24uZ2V0RmlsZW5hbWVGcm9tQ29udGVudERpc3Bvc2l0aW9uSGVhZGVyKShjb250ZW50RGlzcG9zaXRpb24pOwoKICAgICAgICBpZiAoZmlsZW5hbWUuaW5jbHVkZXMoIiUiKSkgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZmlsZW5hbWUgPSBkZWNvZGVVUklDb21wb25lbnQoZmlsZW5hbWUpOwogICAgICAgICAgfSBjYXRjaCAoZXgpIHt9CiAgICAgICAgfQoKICAgICAgICBpZiAoL1wucGRmJC9pLnRlc3QoZmlsZW5hbWUpKSB7CiAgICAgICAgICByZXR1cm4gZmlsZW5hbWU7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBmdW5jdGlvbiBjcmVhdGVSZXNwb25zZVN0YXR1c0Vycm9yKHN0YXR1cywgdXJsKSB7CiAgICAgIGlmIChzdGF0dXMgPT09IDQwNCB8fCBzdGF0dXMgPT09IDAgJiYgdXJsLnN0YXJ0c1dpdGgoImZpbGU6IikpIHsKICAgICAgICByZXR1cm4gbmV3IF91dGlsLk1pc3NpbmdQREZFeGNlcHRpb24oJ01pc3NpbmcgUERGICInICsgdXJsICsgJyIuJyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBuZXcgX3V0aWwuVW5leHBlY3RlZFJlc3BvbnNlRXhjZXB0aW9uKCJVbmV4cGVjdGVkIHNlcnZlciByZXNwb25zZSAoIiArIHN0YXR1cyArICcpIHdoaWxlIHJldHJpZXZpbmcgUERGICInICsgdXJsICsgJyIuJywgc3RhdHVzKTsKICAgIH0KCiAgICBmdW5jdGlvbiB2YWxpZGF0ZVJlc3BvbnNlU3RhdHVzKHN0YXR1cykgewogICAgICByZXR1cm4gc3RhdHVzID09PSAyMDAgfHwgc3RhdHVzID09PSAyMDY7CiAgICB9CgogICAgLyoqKi99KSwgKAogIC8qIDIxMCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCgogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICB2YWx1ZTogdHJ1ZQogICAgfSk7CiAgICBleHBvcnRzLmdldEZpbGVuYW1lRnJvbUNvbnRlbnREaXNwb3NpdGlvbkhlYWRlciA9IGdldEZpbGVuYW1lRnJvbUNvbnRlbnREaXNwb3NpdGlvbkhlYWRlcjsKCiAgICBmdW5jdGlvbiBfc2xpY2VkVG9BcnJheShhcnIsIGkpIHtyZXR1cm4gX2FycmF5V2l0aEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgfHwgX25vbkl0ZXJhYmxlUmVzdCgpO30KCiAgICBmdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0KCkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UiKTt9CgogICAgZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkge2lmICghKFN5bWJvbC5pdGVyYXRvciBpbiBPYmplY3QoYXJyKSB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYXJyKSA9PT0gIltvYmplY3QgQXJndW1lbnRzXSIpKSB7cmV0dXJuO312YXIgX2FyciA9IFtdO3ZhciBfbiA9IHRydWU7dmFyIF9kID0gZmFsc2U7dmFyIF9lID0gdW5kZWZpbmVkO3RyeSB7Zm9yICh2YXIgX2kgPSBhcnJbU3ltYm9sLml0ZXJhdG9yXSgpLCBfczsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkge19hcnIucHVzaChfcy52YWx1ZSk7aWYgKGkgJiYgX2Fyci5sZW5ndGggPT09IGkpIGJyZWFrO319IGNhdGNoIChlcnIpIHtfZCA9IHRydWU7X2UgPSBlcnI7fSBmaW5hbGx5IHt0cnkge2lmICghX24gJiYgX2lbInJldHVybiJdICE9IG51bGwpIF9pWyJyZXR1cm4iXSgpO30gZmluYWxseSB7aWYgKF9kKSB0aHJvdyBfZTt9fXJldHVybiBfYXJyO30KCiAgICBmdW5jdGlvbiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB7aWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjt9CgogICAgZnVuY3Rpb24gZ2V0RmlsZW5hbWVGcm9tQ29udGVudERpc3Bvc2l0aW9uSGVhZGVyKGNvbnRlbnREaXNwb3NpdGlvbikgewogICAgICB2YXIgbmVlZHNFbmNvZGluZ0ZpeHVwID0gdHJ1ZTsKICAgICAgdmFyIHRtcCA9IHRvUGFyYW1SZWdFeHAoImZpbGVuYW1lXFwqIiwgImkiKS5leGVjKGNvbnRlbnREaXNwb3NpdGlvbik7CgogICAgICBpZiAodG1wKSB7CiAgICAgICAgdG1wID0gdG1wWzFdOwogICAgICAgIHZhciBmaWxlbmFtZSA9IHJmYzI2MTZ1bnF1b3RlKHRtcCk7CiAgICAgICAgZmlsZW5hbWUgPSB1bmVzY2FwZShmaWxlbmFtZSk7CiAgICAgICAgZmlsZW5hbWUgPSByZmM1OTg3ZGVjb2RlKGZpbGVuYW1lKTsKICAgICAgICBmaWxlbmFtZSA9IHJmYzIwNDdkZWNvZGUoZmlsZW5hbWUpOwogICAgICAgIHJldHVybiBmaXh1cEVuY29kaW5nKGZpbGVuYW1lKTsKICAgICAgfQoKICAgICAgdG1wID0gcmZjMjIzMWdldHBhcmFtKGNvbnRlbnREaXNwb3NpdGlvbik7CgogICAgICBpZiAodG1wKSB7CiAgICAgICAgdmFyIF9maWxlbmFtZSA9IHJmYzIwNDdkZWNvZGUodG1wKTsKCiAgICAgICAgcmV0dXJuIGZpeHVwRW5jb2RpbmcoX2ZpbGVuYW1lKTsKICAgICAgfQoKICAgICAgdG1wID0gdG9QYXJhbVJlZ0V4cCgiZmlsZW5hbWUiLCAiaSIpLmV4ZWMoY29udGVudERpc3Bvc2l0aW9uKTsKCiAgICAgIGlmICh0bXApIHsKICAgICAgICB0bXAgPSB0bXBbMV07CgogICAgICAgIHZhciBfZmlsZW5hbWUyID0gcmZjMjYxNnVucXVvdGUodG1wKTsKCiAgICAgICAgX2ZpbGVuYW1lMiA9IHJmYzIwNDdkZWNvZGUoX2ZpbGVuYW1lMik7CiAgICAgICAgcmV0dXJuIGZpeHVwRW5jb2RpbmcoX2ZpbGVuYW1lMik7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHRvUGFyYW1SZWdFeHAoYXR0cmlidXRlUGF0dGVybiwgZmxhZ3MpIHsKICAgICAgICByZXR1cm4gbmV3IFJlZ0V4cCgiKD86Xnw7KVxccyoiICsgYXR0cmlidXRlUGF0dGVybiArICJcXHMqPVxccyoiICsgIigiICsgJ1teIjtcXHNdW147XFxzXSonICsgInwiICsgJyIoPzpbXiJcXFxcXXxcXFxcIj8pKyI/JyArICIpIiwgZmxhZ3MpOwogICAgICB9CgogICAgICBmdW5jdGlvbiB0ZXh0ZGVjb2RlKGVuY29kaW5nLCB2YWx1ZSkgewogICAgICAgIGlmIChlbmNvZGluZykgewogICAgICAgICAgaWYgKCEvXltceDAwLVx4RkZdKyQvLnRlc3QodmFsdWUpKSB7CiAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICB0cnkgewogICAgICAgICAgICB2YXIgZGVjb2RlciA9IG5ldyBUZXh0RGVjb2RlcihlbmNvZGluZywgewogICAgICAgICAgICAgIGZhdGFsOiB0cnVlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YXIgYnl0ZXMgPSBBcnJheS5mcm9tKHZhbHVlLCBmdW5jdGlvbiAoY2gpIHsKICAgICAgICAgICAgICByZXR1cm4gY2guY2hhckNvZGVBdCgwKSAmIDB4ZmY7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YWx1ZSA9IGRlY29kZXIuZGVjb2RlKG5ldyBVaW50OEFycmF5KGJ5dGVzKSk7CiAgICAgICAgICAgIG5lZWRzRW5jb2RpbmdGaXh1cCA9IGZhbHNlOwogICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBpZiAoL151dGYtPzgkL2kudGVzdChlbmNvZGluZykpIHsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdmFsdWUgPSBkZWNvZGVVUklDb21wb25lbnQoZXNjYXBlKHZhbHVlKSk7CiAgICAgICAgICAgICAgICBuZWVkc0VuY29kaW5nRml4dXAgPSBmYWxzZTsKICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHt9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZml4dXBFbmNvZGluZyh2YWx1ZSkgewogICAgICAgIGlmIChuZWVkc0VuY29kaW5nRml4dXAgJiYgL1tceDgwLVx4ZmZdLy50ZXN0KHZhbHVlKSkgewogICAgICAgICAgdmFsdWUgPSB0ZXh0ZGVjb2RlKCJ1dGYtOCIsIHZhbHVlKTsKCiAgICAgICAgICBpZiAobmVlZHNFbmNvZGluZ0ZpeHVwKSB7CiAgICAgICAgICAgIHZhbHVlID0gdGV4dGRlY29kZSgiaXNvLTg4NTktMSIsIHZhbHVlKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gcmZjMjIzMWdldHBhcmFtKGNvbnRlbnREaXNwb3NpdGlvbikgewogICAgICAgIHZhciBtYXRjaGVzID0gW107CiAgICAgICAgdmFyIG1hdGNoOwogICAgICAgIHZhciBpdGVyID0gdG9QYXJhbVJlZ0V4cCgiZmlsZW5hbWVcXCooKD8hMFxcZClcXGQrKShcXCo/KSIsICJpZyIpOwoKICAgICAgICB3aGlsZSAoKG1hdGNoID0gaXRlci5leGVjKGNvbnRlbnREaXNwb3NpdGlvbikpICE9PSBudWxsKSB7CiAgICAgICAgICB2YXIgX21hdGNoID0gbWF0Y2gsCiAgICAgICAgICAgIF9tYXRjaDIgPSBfc2xpY2VkVG9BcnJheShfbWF0Y2gsIDQpLAogICAgICAgICAgICBuID0gX21hdGNoMlsxXSwKICAgICAgICAgICAgcXVvdCA9IF9tYXRjaDJbMl0sCiAgICAgICAgICAgIHBhcnQgPSBfbWF0Y2gyWzNdOwoKICAgICAgICAgIG4gPSBwYXJzZUludChuLCAxMCk7CgogICAgICAgICAgaWYgKG4gaW4gbWF0Y2hlcykgewogICAgICAgICAgICBpZiAobiA9PT0gMCkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBtYXRjaGVzW25dID0gW3F1b3QsIHBhcnRdOwogICAgICAgIH0KCiAgICAgICAgdmFyIHBhcnRzID0gW107CgogICAgICAgIGZvciAodmFyIF9uMiA9IDA7IF9uMiA8IG1hdGNoZXMubGVuZ3RoOyArK19uMikgewogICAgICAgICAgaWYgKCEoX24yIGluIG1hdGNoZXMpKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBfbWF0Y2hlcyRfbiA9IF9zbGljZWRUb0FycmF5KG1hdGNoZXNbX24yXSwgMiksCiAgICAgICAgICAgIF9xdW90ID0gX21hdGNoZXMkX25bMF0sCiAgICAgICAgICAgIF9wYXJ0ID0gX21hdGNoZXMkX25bMV07CgogICAgICAgICAgX3BhcnQgPSByZmMyNjE2dW5xdW90ZShfcGFydCk7CgogICAgICAgICAgaWYgKF9xdW90KSB7CiAgICAgICAgICAgIF9wYXJ0ID0gdW5lc2NhcGUoX3BhcnQpOwoKICAgICAgICAgICAgaWYgKF9uMiA9PT0gMCkgewogICAgICAgICAgICAgIF9wYXJ0ID0gcmZjNTk4N2RlY29kZShfcGFydCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBwYXJ0cy5wdXNoKF9wYXJ0KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBwYXJ0cy5qb2luKCIiKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gcmZjMjYxNnVucXVvdGUodmFsdWUpIHsKICAgICAgICBpZiAodmFsdWUuc3RhcnRzV2l0aCgnIicpKSB7CiAgICAgICAgICB2YXIgcGFydHMgPSB2YWx1ZS5zbGljZSgxKS5zcGxpdCgnXFwiJyk7CgogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXJ0cy5sZW5ndGg7ICsraSkgewogICAgICAgICAgICB2YXIgcXVvdGluZGV4ID0gcGFydHNbaV0uaW5kZXhPZignIicpOwoKICAgICAgICAgICAgaWYgKHF1b3RpbmRleCAhPT0gLTEpIHsKICAgICAgICAgICAgICBwYXJ0c1tpXSA9IHBhcnRzW2ldLnNsaWNlKDAsIHF1b3RpbmRleCk7CiAgICAgICAgICAgICAgcGFydHMubGVuZ3RoID0gaSArIDE7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHBhcnRzW2ldID0gcGFydHNbaV0ucmVwbGFjZSgvXFwoLikvZywgIiQxIik7CiAgICAgICAgICB9CgogICAgICAgICAgdmFsdWUgPSBwYXJ0cy5qb2luKCciJyk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHJmYzU5ODdkZWNvZGUoZXh0dmFsdWUpIHsKICAgICAgICB2YXIgZW5jb2RpbmdlbmQgPSBleHR2YWx1ZS5pbmRleE9mKCInIik7CgogICAgICAgIGlmIChlbmNvZGluZ2VuZCA9PT0gLTEpIHsKICAgICAgICAgIHJldHVybiBleHR2YWx1ZTsKICAgICAgICB9CgogICAgICAgIHZhciBlbmNvZGluZyA9IGV4dHZhbHVlLnNsaWNlKDAsIGVuY29kaW5nZW5kKTsKICAgICAgICB2YXIgbGFuZ3ZhbHVlID0gZXh0dmFsdWUuc2xpY2UoZW5jb2RpbmdlbmQgKyAxKTsKICAgICAgICB2YXIgdmFsdWUgPSBsYW5ndmFsdWUucmVwbGFjZSgvXlteJ10qJy8sICIiKTsKICAgICAgICByZXR1cm4gdGV4dGRlY29kZShlbmNvZGluZywgdmFsdWUpOwogICAgICB9CgogICAgICBmdW5jdGlvbiByZmMyMDQ3ZGVjb2RlKHZhbHVlKSB7CiAgICAgICAgaWYgKCF2YWx1ZS5zdGFydHNXaXRoKCI9PyIpIHx8IC9bXHgwMC1ceDE5XHg4MC1ceGZmXS8udGVzdCh2YWx1ZSkpIHsKICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB2YWx1ZS5yZXBsYWNlKC89XD8oW1x3LV0qKVw/KFtRcUJiXSlcPygoPzpbXj9dfFw/KD8hPSkpKilcPz0vZywgZnVuY3Rpb24gKF8sIGNoYXJzZXQsIGVuY29kaW5nLCB0ZXh0KSB7CiAgICAgICAgICBpZiAoZW5jb2RpbmcgPT09ICJxIiB8fCBlbmNvZGluZyA9PT0gIlEiKSB7CiAgICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL18vZywgIiAiKTsKICAgICAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvPShbMC05YS1mQS1GXXsyfSkvZywgZnVuY3Rpb24gKF8sIGhleCkgewogICAgICAgICAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKHBhcnNlSW50KGhleCwgMTYpKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiB0ZXh0ZGVjb2RlKGNoYXJzZXQsIHRleHQpOwogICAgICAgICAgfQoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHRleHQgPSBhdG9iKHRleHQpOwogICAgICAgICAgfSBjYXRjaCAoZSkge30KCiAgICAgICAgICByZXR1cm4gdGV4dGRlY29kZShjaGFyc2V0LCB0ZXh0KTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgcmV0dXJuICIiOwogICAgfQoKICAgIC8qKiovfSksICgKICAvKiAyMTEgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgoKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgICAgdmFsdWU6IHRydWUKICAgIH0pOwogICAgZXhwb3J0cy5QREZOZXR3b3JrU3RyZWFtID0gdm9pZCAwOwoKICAgIHZhciBfcmVnZW5lcmF0b3IgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9fd19wZGZqc19yZXF1aXJlX18oMTkxKSk7CgogICAgdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygxKTsKCiAgICB2YXIgX25ldHdvcmtfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIwOSk7CgogICAgZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHtyZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTt9CgogICAgZnVuY3Rpb24gYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBrZXksIGFyZykge3RyeSB7dmFyIGluZm8gPSBnZW5ba2V5XShhcmcpO3ZhciB2YWx1ZSA9IGluZm8udmFsdWU7fSBjYXRjaCAoZXJyb3IpIHtyZWplY3QoZXJyb3IpO3JldHVybjt9aWYgKGluZm8uZG9uZSkge3Jlc29sdmUodmFsdWUpO30gZWxzZSB7UHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKF9uZXh0LCBfdGhyb3cpO319CgogICAgZnVuY3Rpb24gX2FzeW5jVG9HZW5lcmF0b3IoZm4pIHtyZXR1cm4gZnVuY3Rpb24gKCkge3ZhciBzZWxmID0gdGhpcyxhcmdzID0gYXJndW1lbnRzO3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7dmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpO2Z1bmN0aW9uIF9uZXh0KHZhbHVlKSB7YXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAibmV4dCIsIHZhbHVlKTt9ZnVuY3Rpb24gX3Rocm93KGVycikge2FzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyKTt9X25leHQodW5kZWZpbmVkKTt9KTt9O30KCiAgICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7aWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTt9fQoKICAgIGZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHtmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7dmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTtkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7ZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlO2lmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlO09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTt9fQoKICAgIGZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHtpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTtpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7cmV0dXJuIENvbnN0cnVjdG9yO30KCiAgICA7CiAgICB2YXIgT0tfUkVTUE9OU0UgPSAyMDA7CiAgICB2YXIgUEFSVElBTF9DT05URU5UX1JFU1BPTlNFID0gMjA2OwoKICAgIGZ1bmN0aW9uIGdldEFycmF5QnVmZmVyKHhocikgewogICAgICB2YXIgZGF0YSA9IHhoci5yZXNwb25zZTsKCiAgICAgIGlmICh0eXBlb2YgZGF0YSAhPT0gInN0cmluZyIpIHsKICAgICAgICByZXR1cm4gZGF0YTsKICAgICAgfQoKICAgICAgdmFyIGFycmF5ID0gKDAsIF91dGlsLnN0cmluZ1RvQnl0ZXMpKGRhdGEpOwogICAgICByZXR1cm4gYXJyYXkuYnVmZmVyOwogICAgfQoKICAgIHZhciBOZXR3b3JrTWFuYWdlciA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgIGZ1bmN0aW9uIE5ldHdvcmtNYW5hZ2VyKHVybCwgYXJncykgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBOZXR3b3JrTWFuYWdlcik7CgogICAgICAgIHRoaXMudXJsID0gdXJsOwogICAgICAgIGFyZ3MgPSBhcmdzIHx8IHt9OwogICAgICAgIHRoaXMuaXNIdHRwID0gL15odHRwcz86L2kudGVzdCh1cmwpOwogICAgICAgIHRoaXMuaHR0cEhlYWRlcnMgPSB0aGlzLmlzSHR0cCAmJiBhcmdzLmh0dHBIZWFkZXJzIHx8IHt9OwogICAgICAgIHRoaXMud2l0aENyZWRlbnRpYWxzID0gYXJncy53aXRoQ3JlZGVudGlhbHMgfHwgZmFsc2U7CgogICAgICAgIHRoaXMuZ2V0WGhyID0gYXJncy5nZXRYaHIgfHwgZnVuY3Rpb24gTmV0d29ya01hbmFnZXJfZ2V0WGhyKCkgewogICAgICAgICAgcmV0dXJuIG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogICAgICAgIH07CgogICAgICAgIHRoaXMuY3VyclhocklkID0gMDsKICAgICAgICB0aGlzLnBlbmRpbmdSZXF1ZXN0cyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhOZXR3b3JrTWFuYWdlciwgW3sKICAgICAgICBrZXk6ICJyZXF1ZXN0UmFuZ2UiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiByZXF1ZXN0UmFuZ2UoYmVnaW4sIGVuZCwgbGlzdGVuZXJzKSB7CiAgICAgICAgICB2YXIgYXJncyA9IHsKICAgICAgICAgICAgYmVnaW46IGJlZ2luLAogICAgICAgICAgICBlbmQ6IGVuZAogICAgICAgICAgfTsKCiAgICAgICAgICBmb3IgKHZhciBwcm9wIGluIGxpc3RlbmVycykgewogICAgICAgICAgICBhcmdzW3Byb3BdID0gbGlzdGVuZXJzW3Byb3BdOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB0aGlzLnJlcXVlc3QoYXJncyk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAicmVxdWVzdEZ1bGwiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiByZXF1ZXN0RnVsbChsaXN0ZW5lcnMpIHsKICAgICAgICAgIHJldHVybiB0aGlzLnJlcXVlc3QobGlzdGVuZXJzKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJyZXF1ZXN0IiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcmVxdWVzdChhcmdzKSB7CiAgICAgICAgICB2YXIgeGhyID0gdGhpcy5nZXRYaHIoKTsKICAgICAgICAgIHZhciB4aHJJZCA9IHRoaXMuY3VyclhocklkKys7CiAgICAgICAgICB2YXIgcGVuZGluZ1JlcXVlc3QgPSB0aGlzLnBlbmRpbmdSZXF1ZXN0c1t4aHJJZF0gPSB7CiAgICAgICAgICAgIHhocjogeGhyCiAgICAgICAgICB9OwogICAgICAgICAgeGhyLm9wZW4oIkdFVCIsIHRoaXMudXJsKTsKICAgICAgICAgIHhoci53aXRoQ3JlZGVudGlhbHMgPSB0aGlzLndpdGhDcmVkZW50aWFsczsKCiAgICAgICAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiB0aGlzLmh0dHBIZWFkZXJzKSB7CiAgICAgICAgICAgIHZhciB2YWx1ZSA9IHRoaXMuaHR0cEhlYWRlcnNbcHJvcGVydHldOwoKICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIocHJvcGVydHksIHZhbHVlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodGhpcy5pc0h0dHAgJiYgImJlZ2luIiBpbiBhcmdzICYmICJlbmQiIGluIGFyZ3MpIHsKICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoIlJhbmdlIiwgImJ5dGVzPSIuY29uY2F0KGFyZ3MuYmVnaW4sICItIikuY29uY2F0KGFyZ3MuZW5kIC0gMSkpOwogICAgICAgICAgICBwZW5kaW5nUmVxdWVzdC5leHBlY3RlZFN0YXR1cyA9IFBBUlRJQUxfQ09OVEVOVF9SRVNQT05TRTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHBlbmRpbmdSZXF1ZXN0LmV4cGVjdGVkU3RhdHVzID0gT0tfUkVTUE9OU0U7CiAgICAgICAgICB9CgogICAgICAgICAgeGhyLnJlc3BvbnNlVHlwZSA9ICJhcnJheWJ1ZmZlciI7CgogICAgICAgICAgaWYgKGFyZ3Mub25FcnJvcikgewogICAgICAgICAgICB4aHIub25lcnJvciA9IGZ1bmN0aW9uIChldnQpIHsKICAgICAgICAgICAgICBhcmdzLm9uRXJyb3IoeGhyLnN0YXR1cyk7CiAgICAgICAgICAgIH07CiAgICAgICAgICB9CgogICAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IHRoaXMub25TdGF0ZUNoYW5nZS5iaW5kKHRoaXMsIHhocklkKTsKICAgICAgICAgIHhoci5vbnByb2dyZXNzID0gdGhpcy5vblByb2dyZXNzLmJpbmQodGhpcywgeGhySWQpOwogICAgICAgICAgcGVuZGluZ1JlcXVlc3Qub25IZWFkZXJzUmVjZWl2ZWQgPSBhcmdzLm9uSGVhZGVyc1JlY2VpdmVkOwogICAgICAgICAgcGVuZGluZ1JlcXVlc3Qub25Eb25lID0gYXJncy5vbkRvbmU7CiAgICAgICAgICBwZW5kaW5nUmVxdWVzdC5vbkVycm9yID0gYXJncy5vbkVycm9yOwogICAgICAgICAgcGVuZGluZ1JlcXVlc3Qub25Qcm9ncmVzcyA9IGFyZ3Mub25Qcm9ncmVzczsKICAgICAgICAgIHhoci5zZW5kKG51bGwpOwogICAgICAgICAgcmV0dXJuIHhocklkOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIm9uUHJvZ3Jlc3MiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBvblByb2dyZXNzKHhocklkLCBldnQpIHsKICAgICAgICAgIHZhciBwZW5kaW5nUmVxdWVzdCA9IHRoaXMucGVuZGluZ1JlcXVlc3RzW3hocklkXTsKCiAgICAgICAgICBpZiAoIXBlbmRpbmdSZXF1ZXN0KSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAocGVuZGluZ1JlcXVlc3Qub25Qcm9ncmVzcykgewogICAgICAgICAgICBwZW5kaW5nUmVxdWVzdC5vblByb2dyZXNzKGV2dCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAib25TdGF0ZUNoYW5nZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIG9uU3RhdGVDaGFuZ2UoeGhySWQsIGV2dCkgewogICAgICAgICAgdmFyIHBlbmRpbmdSZXF1ZXN0ID0gdGhpcy5wZW5kaW5nUmVxdWVzdHNbeGhySWRdOwoKICAgICAgICAgIGlmICghcGVuZGluZ1JlcXVlc3QpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciB4aHIgPSBwZW5kaW5nUmVxdWVzdC54aHI7CgogICAgICAgICAgaWYgKHhoci5yZWFkeVN0YXRlID49IDIgJiYgcGVuZGluZ1JlcXVlc3Qub25IZWFkZXJzUmVjZWl2ZWQpIHsKICAgICAgICAgICAgcGVuZGluZ1JlcXVlc3Qub25IZWFkZXJzUmVjZWl2ZWQoKTsKICAgICAgICAgICAgZGVsZXRlIHBlbmRpbmdSZXF1ZXN0Lm9uSGVhZGVyc1JlY2VpdmVkOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh4aHIucmVhZHlTdGF0ZSAhPT0gNCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCEoeGhySWQgaW4gdGhpcy5wZW5kaW5nUmVxdWVzdHMpKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBkZWxldGUgdGhpcy5wZW5kaW5nUmVxdWVzdHNbeGhySWRdOwoKICAgICAgICAgIGlmICh4aHIuc3RhdHVzID09PSAwICYmIHRoaXMuaXNIdHRwKSB7CiAgICAgICAgICAgIGlmIChwZW5kaW5nUmVxdWVzdC5vbkVycm9yKSB7CiAgICAgICAgICAgICAgcGVuZGluZ1JlcXVlc3Qub25FcnJvcih4aHIuc3RhdHVzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciB4aHJTdGF0dXMgPSB4aHIuc3RhdHVzIHx8IE9LX1JFU1BPTlNFOwogICAgICAgICAgdmFyIG9rX3Jlc3BvbnNlX29uX3JhbmdlX3JlcXVlc3QgPSB4aHJTdGF0dXMgPT09IE9LX1JFU1BPTlNFICYmIHBlbmRpbmdSZXF1ZXN0LmV4cGVjdGVkU3RhdHVzID09PSBQQVJUSUFMX0NPTlRFTlRfUkVTUE9OU0U7CgogICAgICAgICAgaWYgKCFva19yZXNwb25zZV9vbl9yYW5nZV9yZXF1ZXN0ICYmIHhoclN0YXR1cyAhPT0gcGVuZGluZ1JlcXVlc3QuZXhwZWN0ZWRTdGF0dXMpIHsKICAgICAgICAgICAgaWYgKHBlbmRpbmdSZXF1ZXN0Lm9uRXJyb3IpIHsKICAgICAgICAgICAgICBwZW5kaW5nUmVxdWVzdC5vbkVycm9yKHhoci5zdGF0dXMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGNodW5rID0gZ2V0QXJyYXlCdWZmZXIoeGhyKTsKCiAgICAgICAgICBpZiAoeGhyU3RhdHVzID09PSBQQVJUSUFMX0NPTlRFTlRfUkVTUE9OU0UpIHsKICAgICAgICAgICAgdmFyIHJhbmdlSGVhZGVyID0geGhyLmdldFJlc3BvbnNlSGVhZGVyKCJDb250ZW50LVJhbmdlIik7CiAgICAgICAgICAgIHZhciBtYXRjaGVzID0gL2J5dGVzIChcZCspLShcZCspXC8oXGQrKS8uZXhlYyhyYW5nZUhlYWRlcik7CiAgICAgICAgICAgIHBlbmRpbmdSZXF1ZXN0Lm9uRG9uZSh7CiAgICAgICAgICAgICAgYmVnaW46IHBhcnNlSW50KG1hdGNoZXNbMV0sIDEwKSwKICAgICAgICAgICAgICBjaHVuazogY2h1bmsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKGNodW5rKSB7CiAgICAgICAgICAgIHBlbmRpbmdSZXF1ZXN0Lm9uRG9uZSh7CiAgICAgICAgICAgICAgYmVnaW46IDAsCiAgICAgICAgICAgICAgY2h1bms6IGNodW5rCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChwZW5kaW5nUmVxdWVzdC5vbkVycm9yKSB7CiAgICAgICAgICAgIHBlbmRpbmdSZXF1ZXN0Lm9uRXJyb3IoeGhyLnN0YXR1cyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiaGFzUGVuZGluZ1JlcXVlc3RzIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaGFzUGVuZGluZ1JlcXVlc3RzKCkgewogICAgICAgICAgZm9yICh2YXIgeGhySWQgaW4gdGhpcy5wZW5kaW5nUmVxdWVzdHMpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImdldFJlcXVlc3RYaHIiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRSZXF1ZXN0WGhyKHhocklkKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5wZW5kaW5nUmVxdWVzdHNbeGhySWRdLnhocjsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJpc1BlbmRpbmdSZXF1ZXN0IiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaXNQZW5kaW5nUmVxdWVzdCh4aHJJZCkgewogICAgICAgICAgcmV0dXJuIHhocklkIGluIHRoaXMucGVuZGluZ1JlcXVlc3RzOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImFib3J0QWxsUmVxdWVzdHMiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBhYm9ydEFsbFJlcXVlc3RzKCkgewogICAgICAgICAgZm9yICh2YXIgeGhySWQgaW4gdGhpcy5wZW5kaW5nUmVxdWVzdHMpIHsKICAgICAgICAgICAgdGhpcy5hYm9ydFJlcXVlc3QoeGhySWQgfCAwKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJhYm9ydFJlcXVlc3QiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBhYm9ydFJlcXVlc3QoeGhySWQpIHsKICAgICAgICAgIHZhciB4aHIgPSB0aGlzLnBlbmRpbmdSZXF1ZXN0c1t4aHJJZF0ueGhyOwogICAgICAgICAgZGVsZXRlIHRoaXMucGVuZGluZ1JlcXVlc3RzW3hocklkXTsKICAgICAgICAgIHhoci5hYm9ydCgpOwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIE5ldHdvcmtNYW5hZ2VyOwogICAgfSgpOwoKICAgIHZhciBQREZOZXR3b3JrU3RyZWFtID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gUERGTmV0d29ya1N0cmVhbShzb3VyY2UpIHsKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUERGTmV0d29ya1N0cmVhbSk7CgogICAgICAgIHRoaXMuX3NvdXJjZSA9IHNvdXJjZTsKICAgICAgICB0aGlzLl9tYW5hZ2VyID0gbmV3IE5ldHdvcmtNYW5hZ2VyKHNvdXJjZS51cmwsIHsKICAgICAgICAgIGh0dHBIZWFkZXJzOiBzb3VyY2UuaHR0cEhlYWRlcnMsCiAgICAgICAgICB3aXRoQ3JlZGVudGlhbHM6IHNvdXJjZS53aXRoQ3JlZGVudGlhbHMKICAgICAgICB9KTsKICAgICAgICB0aGlzLl9yYW5nZUNodW5rU2l6ZSA9IHNvdXJjZS5yYW5nZUNodW5rU2l6ZTsKICAgICAgICB0aGlzLl9mdWxsUmVxdWVzdFJlYWRlciA9IG51bGw7CiAgICAgICAgdGhpcy5fcmFuZ2VSZXF1ZXN0UmVhZGVycyA9IFtdOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoUERGTmV0d29ya1N0cmVhbSwgW3sKICAgICAgICBrZXk6ICJfb25SYW5nZVJlcXVlc3RSZWFkZXJDbG9zZWQiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfb25SYW5nZVJlcXVlc3RSZWFkZXJDbG9zZWQocmVhZGVyKSB7CiAgICAgICAgICB2YXIgaSA9IHRoaXMuX3JhbmdlUmVxdWVzdFJlYWRlcnMuaW5kZXhPZihyZWFkZXIpOwoKICAgICAgICAgIGlmIChpID49IDApIHsKICAgICAgICAgICAgdGhpcy5fcmFuZ2VSZXF1ZXN0UmVhZGVycy5zcGxpY2UoaSwgMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0RnVsbFJlYWRlciIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldEZ1bGxSZWFkZXIoKSB7CiAgICAgICAgICAoMCwgX3V0aWwuYXNzZXJ0KSghdGhpcy5fZnVsbFJlcXVlc3RSZWFkZXIpOwogICAgICAgICAgdGhpcy5fZnVsbFJlcXVlc3RSZWFkZXIgPSBuZXcgUERGTmV0d29ya1N0cmVhbUZ1bGxSZXF1ZXN0UmVhZGVyKHRoaXMuX21hbmFnZXIsIHRoaXMuX3NvdXJjZSk7CiAgICAgICAgICByZXR1cm4gdGhpcy5fZnVsbFJlcXVlc3RSZWFkZXI7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0UmFuZ2VSZWFkZXIiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRSYW5nZVJlYWRlcihiZWdpbiwgZW5kKSB7CiAgICAgICAgICB2YXIgcmVhZGVyID0gbmV3IFBERk5ldHdvcmtTdHJlYW1SYW5nZVJlcXVlc3RSZWFkZXIodGhpcy5fbWFuYWdlciwgYmVnaW4sIGVuZCk7CiAgICAgICAgICByZWFkZXIub25DbG9zZWQgPSB0aGlzLl9vblJhbmdlUmVxdWVzdFJlYWRlckNsb3NlZC5iaW5kKHRoaXMpOwoKICAgICAgICAgIHRoaXMuX3JhbmdlUmVxdWVzdFJlYWRlcnMucHVzaChyZWFkZXIpOwoKICAgICAgICAgIHJldHVybiByZWFkZXI7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiY2FuY2VsQWxsUmVxdWVzdHMiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjYW5jZWxBbGxSZXF1ZXN0cyhyZWFzb24pIHsKICAgICAgICAgIGlmICh0aGlzLl9mdWxsUmVxdWVzdFJlYWRlcikgewogICAgICAgICAgICB0aGlzLl9mdWxsUmVxdWVzdFJlYWRlci5jYW5jZWwocmVhc29uKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcmVhZGVycyA9IHRoaXMuX3JhbmdlUmVxdWVzdFJlYWRlcnMuc2xpY2UoMCk7CgogICAgICAgICAgcmVhZGVycy5mb3JFYWNoKGZ1bmN0aW9uIChyZWFkZXIpIHsKICAgICAgICAgICAgcmVhZGVyLmNhbmNlbChyZWFzb24pOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9XSk7CgogICAgICByZXR1cm4gUERGTmV0d29ya1N0cmVhbTsKICAgIH0oKTsKCiAgICBleHBvcnRzLlBERk5ldHdvcmtTdHJlYW0gPSBQREZOZXR3b3JrU3RyZWFtOwoKICAgIHZhciBQREZOZXR3b3JrU3RyZWFtRnVsbFJlcXVlc3RSZWFkZXIgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBQREZOZXR3b3JrU3RyZWFtRnVsbFJlcXVlc3RSZWFkZXIobWFuYWdlciwgc291cmNlKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFBERk5ldHdvcmtTdHJlYW1GdWxsUmVxdWVzdFJlYWRlcik7CgogICAgICAgIHRoaXMuX21hbmFnZXIgPSBtYW5hZ2VyOwogICAgICAgIHZhciBhcmdzID0gewogICAgICAgICAgb25IZWFkZXJzUmVjZWl2ZWQ6IHRoaXMuX29uSGVhZGVyc1JlY2VpdmVkLmJpbmQodGhpcyksCiAgICAgICAgICBvbkRvbmU6IHRoaXMuX29uRG9uZS5iaW5kKHRoaXMpLAogICAgICAgICAgb25FcnJvcjogdGhpcy5fb25FcnJvci5iaW5kKHRoaXMpLAogICAgICAgICAgb25Qcm9ncmVzczogdGhpcy5fb25Qcm9ncmVzcy5iaW5kKHRoaXMpCiAgICAgICAgfTsKICAgICAgICB0aGlzLl91cmwgPSBzb3VyY2UudXJsOwogICAgICAgIHRoaXMuX2Z1bGxSZXF1ZXN0SWQgPSBtYW5hZ2VyLnJlcXVlc3RGdWxsKGFyZ3MpOwogICAgICAgIHRoaXMuX2hlYWRlcnNSZWNlaXZlZENhcGFiaWxpdHkgPSAoMCwgX3V0aWwuY3JlYXRlUHJvbWlzZUNhcGFiaWxpdHkpKCk7CiAgICAgICAgdGhpcy5fZGlzYWJsZVJhbmdlID0gc291cmNlLmRpc2FibGVSYW5nZSB8fCBmYWxzZTsKICAgICAgICB0aGlzLl9jb250ZW50TGVuZ3RoID0gc291cmNlLmxlbmd0aDsKICAgICAgICB0aGlzLl9yYW5nZUNodW5rU2l6ZSA9IHNvdXJjZS5yYW5nZUNodW5rU2l6ZTsKCiAgICAgICAgaWYgKCF0aGlzLl9yYW5nZUNodW5rU2l6ZSAmJiAhdGhpcy5fZGlzYWJsZVJhbmdlKSB7CiAgICAgICAgICB0aGlzLl9kaXNhYmxlUmFuZ2UgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5faXNTdHJlYW1pbmdTdXBwb3J0ZWQgPSBmYWxzZTsKICAgICAgICB0aGlzLl9pc1JhbmdlU3VwcG9ydGVkID0gZmFsc2U7CiAgICAgICAgdGhpcy5fY2FjaGVkQ2h1bmtzID0gW107CiAgICAgICAgdGhpcy5fcmVxdWVzdHMgPSBbXTsKICAgICAgICB0aGlzLl9kb25lID0gZmFsc2U7CiAgICAgICAgdGhpcy5fc3RvcmVkRXJyb3IgPSB1bmRlZmluZWQ7CiAgICAgICAgdGhpcy5fZmlsZW5hbWUgPSBudWxsOwogICAgICAgIHRoaXMub25Qcm9ncmVzcyA9IG51bGw7CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhQREZOZXR3b3JrU3RyZWFtRnVsbFJlcXVlc3RSZWFkZXIsIFt7CiAgICAgICAga2V5OiAiX29uSGVhZGVyc1JlY2VpdmVkIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX29uSGVhZGVyc1JlY2VpdmVkKCkgewogICAgICAgICAgdmFyIGZ1bGxSZXF1ZXN0WGhySWQgPSB0aGlzLl9mdWxsUmVxdWVzdElkOwoKICAgICAgICAgIHZhciBmdWxsUmVxdWVzdFhociA9IHRoaXMuX21hbmFnZXIuZ2V0UmVxdWVzdFhocihmdWxsUmVxdWVzdFhocklkKTsKCiAgICAgICAgICB2YXIgZ2V0UmVzcG9uc2VIZWFkZXIgPSBmdW5jdGlvbiBnZXRSZXNwb25zZUhlYWRlcihuYW1lKSB7CiAgICAgICAgICAgIHJldHVybiBmdWxsUmVxdWVzdFhoci5nZXRSZXNwb25zZUhlYWRlcihuYW1lKTsKICAgICAgICAgIH07CgogICAgICAgICAgdmFyIF92YWxpZGF0ZVJhbmdlUmVxdWVzdCA9ICgwLCBfbmV0d29ya191dGlscy52YWxpZGF0ZVJhbmdlUmVxdWVzdENhcGFiaWxpdGllcykoewogICAgICAgICAgICAgIGdldFJlc3BvbnNlSGVhZGVyOiBnZXRSZXNwb25zZUhlYWRlciwKICAgICAgICAgICAgICBpc0h0dHA6IHRoaXMuX21hbmFnZXIuaXNIdHRwLAogICAgICAgICAgICAgIHJhbmdlQ2h1bmtTaXplOiB0aGlzLl9yYW5nZUNodW5rU2l6ZSwKICAgICAgICAgICAgICBkaXNhYmxlUmFuZ2U6IHRoaXMuX2Rpc2FibGVSYW5nZQogICAgICAgICAgICB9KSwKICAgICAgICAgICAgYWxsb3dSYW5nZVJlcXVlc3RzID0gX3ZhbGlkYXRlUmFuZ2VSZXF1ZXN0LmFsbG93UmFuZ2VSZXF1ZXN0cywKICAgICAgICAgICAgc3VnZ2VzdGVkTGVuZ3RoID0gX3ZhbGlkYXRlUmFuZ2VSZXF1ZXN0LnN1Z2dlc3RlZExlbmd0aDsKCiAgICAgICAgICBpZiAoYWxsb3dSYW5nZVJlcXVlc3RzKSB7CiAgICAgICAgICAgIHRoaXMuX2lzUmFuZ2VTdXBwb3J0ZWQgPSB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuX2NvbnRlbnRMZW5ndGggPSBzdWdnZXN0ZWRMZW5ndGggfHwgdGhpcy5fY29udGVudExlbmd0aDsKICAgICAgICAgIHRoaXMuX2ZpbGVuYW1lID0gKDAsIF9uZXR3b3JrX3V0aWxzLmV4dHJhY3RGaWxlbmFtZUZyb21IZWFkZXIpKGdldFJlc3BvbnNlSGVhZGVyKTsKCiAgICAgICAgICBpZiAodGhpcy5faXNSYW5nZVN1cHBvcnRlZCkgewogICAgICAgICAgICB0aGlzLl9tYW5hZ2VyLmFib3J0UmVxdWVzdChmdWxsUmVxdWVzdFhocklkKTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLl9oZWFkZXJzUmVjZWl2ZWRDYXBhYmlsaXR5LnJlc29sdmUoKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJfb25Eb25lIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX29uRG9uZShhcmdzKSB7CiAgICAgICAgICBpZiAoYXJncykgewogICAgICAgICAgICBpZiAodGhpcy5fcmVxdWVzdHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIHZhciByZXF1ZXN0Q2FwYWJpbGl0eSA9IHRoaXMuX3JlcXVlc3RzLnNoaWZ0KCk7CgogICAgICAgICAgICAgIHJlcXVlc3RDYXBhYmlsaXR5LnJlc29sdmUoewogICAgICAgICAgICAgICAgdmFsdWU6IGFyZ3MuY2h1bmssCiAgICAgICAgICAgICAgICBkb25lOiBmYWxzZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMuX2NhY2hlZENodW5rcy5wdXNoKGFyZ3MuY2h1bmspOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5fZG9uZSA9IHRydWU7CgogICAgICAgICAgaWYgKHRoaXMuX2NhY2hlZENodW5rcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLl9yZXF1ZXN0cy5mb3JFYWNoKGZ1bmN0aW9uIChyZXF1ZXN0Q2FwYWJpbGl0eSkgewogICAgICAgICAgICByZXF1ZXN0Q2FwYWJpbGl0eS5yZXNvbHZlKHsKICAgICAgICAgICAgICB2YWx1ZTogdW5kZWZpbmVkLAogICAgICAgICAgICAgIGRvbmU6IHRydWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKCiAgICAgICAgICB0aGlzLl9yZXF1ZXN0cyA9IFtdOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIl9vbkVycm9yIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX29uRXJyb3Ioc3RhdHVzKSB7CiAgICAgICAgICB2YXIgdXJsID0gdGhpcy5fdXJsOwogICAgICAgICAgdmFyIGV4Y2VwdGlvbiA9ICgwLCBfbmV0d29ya191dGlscy5jcmVhdGVSZXNwb25zZVN0YXR1c0Vycm9yKShzdGF0dXMsIHVybCk7CiAgICAgICAgICB0aGlzLl9zdG9yZWRFcnJvciA9IGV4Y2VwdGlvbjsKCiAgICAgICAgICB0aGlzLl9oZWFkZXJzUmVjZWl2ZWRDYXBhYmlsaXR5LnJlamVjdChleGNlcHRpb24pOwoKICAgICAgICAgIHRoaXMuX3JlcXVlc3RzLmZvckVhY2goZnVuY3Rpb24gKHJlcXVlc3RDYXBhYmlsaXR5KSB7CiAgICAgICAgICAgIHJlcXVlc3RDYXBhYmlsaXR5LnJlamVjdChleGNlcHRpb24pOwogICAgICAgICAgfSk7CgogICAgICAgICAgdGhpcy5fcmVxdWVzdHMgPSBbXTsKICAgICAgICAgIHRoaXMuX2NhY2hlZENodW5rcyA9IFtdOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIl9vblByb2dyZXNzIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX29uUHJvZ3Jlc3MoZGF0YSkgewogICAgICAgICAgaWYgKHRoaXMub25Qcm9ncmVzcykgewogICAgICAgICAgICB0aGlzLm9uUHJvZ3Jlc3MoewogICAgICAgICAgICAgIGxvYWRlZDogZGF0YS5sb2FkZWQsCiAgICAgICAgICAgICAgdG90YWw6IGRhdGEubGVuZ3RoQ29tcHV0YWJsZSA/IGRhdGEudG90YWwgOiB0aGlzLl9jb250ZW50TGVuZ3RoCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInJlYWQiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgX3JlYWQgPSBfYXN5bmNUb0dlbmVyYXRvcigvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yWyJkZWZhdWx0Il0ubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICAgICAgICB2YXIgY2h1bmssIHJlcXVlc3RDYXBhYmlsaXR5OwogICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yWyJkZWZhdWx0Il0ud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX3N0b3JlZEVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgdGhpcy5fc3RvcmVkRXJyb3I7CgogICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgaWYgKCEodGhpcy5fY2FjaGVkQ2h1bmtzLmxlbmd0aCA+IDApKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNTsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgY2h1bmsgPSB0aGlzLl9jYWNoZWRDaHVua3Muc2hpZnQoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogY2h1bmssCiAgICAgICAgICAgICAgICAgICAgICBkb25lOiBmYWxzZQogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5fZG9uZSkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDc7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgICBkb25lOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdENhcGFiaWxpdHkgPSAoMCwgX3V0aWwuY3JlYXRlUHJvbWlzZUNhcGFiaWxpdHkpKCk7CgogICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlcXVlc3RzLnB1c2gocmVxdWVzdENhcGFiaWxpdHkpOwoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCByZXF1ZXN0Q2FwYWJpbGl0eS5wcm9taXNlKTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIF9jYWxsZWUsIHRoaXMpOwogICAgICAgICAgfSkpOwoKICAgICAgICAgIGZ1bmN0aW9uIHJlYWQoKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVhZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiByZWFkOwogICAgICAgIH0oKQogICAgICB9LCB7CiAgICAgICAga2V5OiAiY2FuY2VsIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY2FuY2VsKHJlYXNvbikgewogICAgICAgICAgdGhpcy5fZG9uZSA9IHRydWU7CgogICAgICAgICAgdGhpcy5faGVhZGVyc1JlY2VpdmVkQ2FwYWJpbGl0eS5yZWplY3QocmVhc29uKTsKCiAgICAgICAgICB0aGlzLl9yZXF1ZXN0cy5mb3JFYWNoKGZ1bmN0aW9uIChyZXF1ZXN0Q2FwYWJpbGl0eSkgewogICAgICAgICAgICByZXF1ZXN0Q2FwYWJpbGl0eS5yZXNvbHZlKHsKICAgICAgICAgICAgICB2YWx1ZTogdW5kZWZpbmVkLAogICAgICAgICAgICAgIGRvbmU6IHRydWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKCiAgICAgICAgICB0aGlzLl9yZXF1ZXN0cyA9IFtdOwoKICAgICAgICAgIGlmICh0aGlzLl9tYW5hZ2VyLmlzUGVuZGluZ1JlcXVlc3QodGhpcy5fZnVsbFJlcXVlc3RJZCkpIHsKICAgICAgICAgICAgdGhpcy5fbWFuYWdlci5hYm9ydFJlcXVlc3QodGhpcy5fZnVsbFJlcXVlc3RJZCk7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5fZnVsbFJlcXVlc3RSZWFkZXIgPSBudWxsOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImZpbGVuYW1lIiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9maWxlbmFtZTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJpc1JhbmdlU3VwcG9ydGVkIiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9pc1JhbmdlU3VwcG9ydGVkOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImlzU3RyZWFtaW5nU3VwcG9ydGVkIiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9pc1N0cmVhbWluZ1N1cHBvcnRlZDsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJjb250ZW50TGVuZ3RoIiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9jb250ZW50TGVuZ3RoOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImhlYWRlcnNSZWFkeSIsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5faGVhZGVyc1JlY2VpdmVkQ2FwYWJpbGl0eS5wcm9taXNlOwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIFBERk5ldHdvcmtTdHJlYW1GdWxsUmVxdWVzdFJlYWRlcjsKICAgIH0oKTsKCiAgICB2YXIgUERGTmV0d29ya1N0cmVhbVJhbmdlUmVxdWVzdFJlYWRlciA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgIGZ1bmN0aW9uIFBERk5ldHdvcmtTdHJlYW1SYW5nZVJlcXVlc3RSZWFkZXIobWFuYWdlciwgYmVnaW4sIGVuZCkgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBQREZOZXR3b3JrU3RyZWFtUmFuZ2VSZXF1ZXN0UmVhZGVyKTsKCiAgICAgICAgdGhpcy5fbWFuYWdlciA9IG1hbmFnZXI7CiAgICAgICAgdmFyIGFyZ3MgPSB7CiAgICAgICAgICBvbkRvbmU6IHRoaXMuX29uRG9uZS5iaW5kKHRoaXMpLAogICAgICAgICAgb25Qcm9ncmVzczogdGhpcy5fb25Qcm9ncmVzcy5iaW5kKHRoaXMpCiAgICAgICAgfTsKICAgICAgICB0aGlzLl9yZXF1ZXN0SWQgPSBtYW5hZ2VyLnJlcXVlc3RSYW5nZShiZWdpbiwgZW5kLCBhcmdzKTsKICAgICAgICB0aGlzLl9yZXF1ZXN0cyA9IFtdOwogICAgICAgIHRoaXMuX3F1ZXVlZENodW5rID0gbnVsbDsKICAgICAgICB0aGlzLl9kb25lID0gZmFsc2U7CiAgICAgICAgdGhpcy5vblByb2dyZXNzID0gbnVsbDsKICAgICAgICB0aGlzLm9uQ2xvc2VkID0gbnVsbDsKICAgICAgfQoKICAgICAgX2NyZWF0ZUNsYXNzKFBERk5ldHdvcmtTdHJlYW1SYW5nZVJlcXVlc3RSZWFkZXIsIFt7CiAgICAgICAga2V5OiAiX2Nsb3NlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX2Nsb3NlKCkgewogICAgICAgICAgaWYgKHRoaXMub25DbG9zZWQpIHsKICAgICAgICAgICAgdGhpcy5vbkNsb3NlZCh0aGlzKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJfb25Eb25lIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX29uRG9uZShkYXRhKSB7CiAgICAgICAgICB2YXIgY2h1bmsgPSBkYXRhLmNodW5rOwoKICAgICAgICAgIGlmICh0aGlzLl9yZXF1ZXN0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHZhciByZXF1ZXN0Q2FwYWJpbGl0eSA9IHRoaXMuX3JlcXVlc3RzLnNoaWZ0KCk7CgogICAgICAgICAgICByZXF1ZXN0Q2FwYWJpbGl0eS5yZXNvbHZlKHsKICAgICAgICAgICAgICB2YWx1ZTogY2h1bmssCiAgICAgICAgICAgICAgZG9uZTogZmFsc2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLl9xdWV1ZWRDaHVuayA9IGNodW5rOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuX2RvbmUgPSB0cnVlOwoKICAgICAgICAgIHRoaXMuX3JlcXVlc3RzLmZvckVhY2goZnVuY3Rpb24gKHJlcXVlc3RDYXBhYmlsaXR5KSB7CiAgICAgICAgICAgIHJlcXVlc3RDYXBhYmlsaXR5LnJlc29sdmUoewogICAgICAgICAgICAgIHZhbHVlOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgZG9uZTogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIHRoaXMuX3JlcXVlc3RzID0gW107CgogICAgICAgICAgdGhpcy5fY2xvc2UoKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJfb25Qcm9ncmVzcyIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9vblByb2dyZXNzKGV2dCkgewogICAgICAgICAgaWYgKCF0aGlzLmlzU3RyZWFtaW5nU3VwcG9ydGVkICYmIHRoaXMub25Qcm9ncmVzcykgewogICAgICAgICAgICB0aGlzLm9uUHJvZ3Jlc3MoewogICAgICAgICAgICAgIGxvYWRlZDogZXZ0LmxvYWRlZAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJyZWFkIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIF9yZWFkMiA9IF9hc3luY1RvR2VuZXJhdG9yKC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JbImRlZmF1bHQiXS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgICAgICAgICB2YXIgY2h1bmssIHJlcXVlc3RDYXBhYmlsaXR5OwogICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yWyJkZWZhdWx0Il0ud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgaWYgKCEodGhpcy5fcXVldWVkQ2h1bmsgIT09IG51bGwpKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGNodW5rID0gdGhpcy5fcXVldWVkQ2h1bms7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcXVldWVkQ2h1bmsgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogY2h1bmssCiAgICAgICAgICAgICAgICAgICAgICBkb25lOiBmYWxzZQogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5fZG9uZSkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA2OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICAgIGRvbmU6IHRydWUKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgICAgICByZXF1ZXN0Q2FwYWJpbGl0eSA9ICgwLCBfdXRpbC5jcmVhdGVQcm9taXNlQ2FwYWJpbGl0eSkoKTsKCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVxdWVzdHMucHVzaChyZXF1ZXN0Q2FwYWJpbGl0eSk7CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCByZXF1ZXN0Q2FwYWJpbGl0eS5wcm9taXNlKTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIF9jYWxsZWUyLCB0aGlzKTsKICAgICAgICAgIH0pKTsKCiAgICAgICAgICBmdW5jdGlvbiByZWFkKCkgewogICAgICAgICAgICByZXR1cm4gX3JlYWQyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHJlYWQ7CiAgICAgICAgfSgpCiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJjYW5jZWwiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjYW5jZWwocmVhc29uKSB7CiAgICAgICAgICB0aGlzLl9kb25lID0gdHJ1ZTsKCiAgICAgICAgICB0aGlzLl9yZXF1ZXN0cy5mb3JFYWNoKGZ1bmN0aW9uIChyZXF1ZXN0Q2FwYWJpbGl0eSkgewogICAgICAgICAgICByZXF1ZXN0Q2FwYWJpbGl0eS5yZXNvbHZlKHsKICAgICAgICAgICAgICB2YWx1ZTogdW5kZWZpbmVkLAogICAgICAgICAgICAgIGRvbmU6IHRydWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKCiAgICAgICAgICB0aGlzLl9yZXF1ZXN0cyA9IFtdOwoKICAgICAgICAgIGlmICh0aGlzLl9tYW5hZ2VyLmlzUGVuZGluZ1JlcXVlc3QodGhpcy5fcmVxdWVzdElkKSkgewogICAgICAgICAgICB0aGlzLl9tYW5hZ2VyLmFib3J0UmVxdWVzdCh0aGlzLl9yZXF1ZXN0SWQpOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuX2Nsb3NlKCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiaXNTdHJlYW1pbmdTdXBwb3J0ZWQiLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIFBERk5ldHdvcmtTdHJlYW1SYW5nZVJlcXVlc3RSZWFkZXI7CiAgICB9KCk7CgogICAgLyoqKi99KSwgKAogIC8qIDIxMiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCgogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICB2YWx1ZTogdHJ1ZQogICAgfSk7CiAgICBleHBvcnRzLlBERkZldGNoU3RyZWFtID0gdm9pZCAwOwoKICAgIHZhciBfcmVnZW5lcmF0b3IgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9fd19wZGZqc19yZXF1aXJlX18oMTkxKSk7CgogICAgdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygxKTsKCiAgICB2YXIgX25ldHdvcmtfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIwOSk7CgogICAgZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHtyZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTt9CgogICAgZnVuY3Rpb24gYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBrZXksIGFyZykge3RyeSB7dmFyIGluZm8gPSBnZW5ba2V5XShhcmcpO3ZhciB2YWx1ZSA9IGluZm8udmFsdWU7fSBjYXRjaCAoZXJyb3IpIHtyZWplY3QoZXJyb3IpO3JldHVybjt9aWYgKGluZm8uZG9uZSkge3Jlc29sdmUodmFsdWUpO30gZWxzZSB7UHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKF9uZXh0LCBfdGhyb3cpO319CgogICAgZnVuY3Rpb24gX2FzeW5jVG9HZW5lcmF0b3IoZm4pIHtyZXR1cm4gZnVuY3Rpb24gKCkge3ZhciBzZWxmID0gdGhpcyxhcmdzID0gYXJndW1lbnRzO3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7dmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpO2Z1bmN0aW9uIF9uZXh0KHZhbHVlKSB7YXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAibmV4dCIsIHZhbHVlKTt9ZnVuY3Rpb24gX3Rocm93KGVycikge2FzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyKTt9X25leHQodW5kZWZpbmVkKTt9KTt9O30KCiAgICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7aWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTt9fQoKICAgIGZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHtmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7dmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTtkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7ZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlO2lmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlO09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTt9fQoKICAgIGZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHtpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTtpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7cmV0dXJuIENvbnN0cnVjdG9yO30KCiAgICBmdW5jdGlvbiBjcmVhdGVGZXRjaE9wdGlvbnMoaGVhZGVycywgd2l0aENyZWRlbnRpYWxzLCBhYm9ydENvbnRyb2xsZXIpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBtZXRob2Q6ICJHRVQiLAogICAgICAgIGhlYWRlcnM6IGhlYWRlcnMsCiAgICAgICAgc2lnbmFsOiBhYm9ydENvbnRyb2xsZXIgJiYgYWJvcnRDb250cm9sbGVyLnNpZ25hbCwKICAgICAgICBtb2RlOiAiY29ycyIsCiAgICAgICAgY3JlZGVudGlhbHM6IHdpdGhDcmVkZW50aWFscyA/ICJpbmNsdWRlIiA6ICJzYW1lLW9yaWdpbiIsCiAgICAgICAgcmVkaXJlY3Q6ICJmb2xsb3ciCiAgICAgIH07CiAgICB9CgogICAgZnVuY3Rpb24gY3JlYXRlSGVhZGVycyhodHRwSGVhZGVycykgewogICAgICB2YXIgaGVhZGVycyA9IG5ldyBIZWFkZXJzKCk7CgogICAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBodHRwSGVhZGVycykgewogICAgICAgIHZhciB2YWx1ZSA9IGh0dHBIZWFkZXJzW3Byb3BlcnR5XTsKCiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KCiAgICAgICAgaGVhZGVycy5hcHBlbmQocHJvcGVydHksIHZhbHVlKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGhlYWRlcnM7CiAgICB9CgogICAgdmFyIFBERkZldGNoU3RyZWFtID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gUERGRmV0Y2hTdHJlYW0oc291cmNlKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFBERkZldGNoU3RyZWFtKTsKCiAgICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7CiAgICAgICAgdGhpcy5pc0h0dHAgPSAvXmh0dHBzPzovaS50ZXN0KHNvdXJjZS51cmwpOwogICAgICAgIHRoaXMuaHR0cEhlYWRlcnMgPSB0aGlzLmlzSHR0cCAmJiBzb3VyY2UuaHR0cEhlYWRlcnMgfHwge307CiAgICAgICAgdGhpcy5fZnVsbFJlcXVlc3RSZWFkZXIgPSBudWxsOwogICAgICAgIHRoaXMuX3JhbmdlUmVxdWVzdFJlYWRlcnMgPSBbXTsKICAgICAgfQoKICAgICAgX2NyZWF0ZUNsYXNzKFBERkZldGNoU3RyZWFtLCBbewogICAgICAgIGtleTogImdldEZ1bGxSZWFkZXIiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRGdWxsUmVhZGVyKCkgewogICAgICAgICAgKDAsIF91dGlsLmFzc2VydCkoIXRoaXMuX2Z1bGxSZXF1ZXN0UmVhZGVyKTsKICAgICAgICAgIHRoaXMuX2Z1bGxSZXF1ZXN0UmVhZGVyID0gbmV3IFBERkZldGNoU3RyZWFtUmVhZGVyKHRoaXMpOwogICAgICAgICAgcmV0dXJuIHRoaXMuX2Z1bGxSZXF1ZXN0UmVhZGVyOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImdldFJhbmdlUmVhZGVyIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UmFuZ2VSZWFkZXIoYmVnaW4sIGVuZCkgewogICAgICAgICAgaWYgKGVuZCA8PSB0aGlzLl9wcm9ncmVzc2l2ZURhdGFMZW5ndGgpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHJlYWRlciA9IG5ldyBQREZGZXRjaFN0cmVhbVJhbmdlUmVhZGVyKHRoaXMsIGJlZ2luLCBlbmQpOwoKICAgICAgICAgIHRoaXMuX3JhbmdlUmVxdWVzdFJlYWRlcnMucHVzaChyZWFkZXIpOwoKICAgICAgICAgIHJldHVybiByZWFkZXI7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiY2FuY2VsQWxsUmVxdWVzdHMiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjYW5jZWxBbGxSZXF1ZXN0cyhyZWFzb24pIHsKICAgICAgICAgIGlmICh0aGlzLl9mdWxsUmVxdWVzdFJlYWRlcikgewogICAgICAgICAgICB0aGlzLl9mdWxsUmVxdWVzdFJlYWRlci5jYW5jZWwocmVhc29uKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcmVhZGVycyA9IHRoaXMuX3JhbmdlUmVxdWVzdFJlYWRlcnMuc2xpY2UoMCk7CgogICAgICAgICAgcmVhZGVycy5mb3JFYWNoKGZ1bmN0aW9uIChyZWFkZXIpIHsKICAgICAgICAgICAgcmVhZGVyLmNhbmNlbChyZWFzb24pOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiX3Byb2dyZXNzaXZlRGF0YUxlbmd0aCIsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fZnVsbFJlcXVlc3RSZWFkZXIgPyB0aGlzLl9mdWxsUmVxdWVzdFJlYWRlci5fbG9hZGVkIDogMDsKICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBQREZGZXRjaFN0cmVhbTsKICAgIH0oKTsKCiAgICBleHBvcnRzLlBERkZldGNoU3RyZWFtID0gUERGRmV0Y2hTdHJlYW07CgogICAgdmFyIFBERkZldGNoU3RyZWFtUmVhZGVyID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gUERGRmV0Y2hTdHJlYW1SZWFkZXIoc3RyZWFtKSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFBERkZldGNoU3RyZWFtUmVhZGVyKTsKCiAgICAgICAgdGhpcy5fc3RyZWFtID0gc3RyZWFtOwogICAgICAgIHRoaXMuX3JlYWRlciA9IG51bGw7CiAgICAgICAgdGhpcy5fbG9hZGVkID0gMDsKICAgICAgICB0aGlzLl9maWxlbmFtZSA9IG51bGw7CiAgICAgICAgdmFyIHNvdXJjZSA9IHN0cmVhbS5zb3VyY2U7CiAgICAgICAgdGhpcy5fd2l0aENyZWRlbnRpYWxzID0gc291cmNlLndpdGhDcmVkZW50aWFscyB8fCBmYWxzZTsKICAgICAgICB0aGlzLl9jb250ZW50TGVuZ3RoID0gc291cmNlLmxlbmd0aDsKICAgICAgICB0aGlzLl9oZWFkZXJzQ2FwYWJpbGl0eSA9ICgwLCBfdXRpbC5jcmVhdGVQcm9taXNlQ2FwYWJpbGl0eSkoKTsKICAgICAgICB0aGlzLl9kaXNhYmxlUmFuZ2UgPSBzb3VyY2UuZGlzYWJsZVJhbmdlIHx8IGZhbHNlOwogICAgICAgIHRoaXMuX3JhbmdlQ2h1bmtTaXplID0gc291cmNlLnJhbmdlQ2h1bmtTaXplOwoKICAgICAgICBpZiAoIXRoaXMuX3JhbmdlQ2h1bmtTaXplICYmICF0aGlzLl9kaXNhYmxlUmFuZ2UpIHsKICAgICAgICAgIHRoaXMuX2Rpc2FibGVSYW5nZSA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBpZiAodHlwZW9mIEFib3J0Q29udHJvbGxlciAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgIHRoaXMuX2Fib3J0Q29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuX2lzU3RyZWFtaW5nU3VwcG9ydGVkID0gIXNvdXJjZS5kaXNhYmxlU3RyZWFtOwogICAgICAgIHRoaXMuX2lzUmFuZ2VTdXBwb3J0ZWQgPSAhc291cmNlLmRpc2FibGVSYW5nZTsKICAgICAgICB0aGlzLl9oZWFkZXJzID0gY3JlYXRlSGVhZGVycyh0aGlzLl9zdHJlYW0uaHR0cEhlYWRlcnMpOwogICAgICAgIHZhciB1cmwgPSBzb3VyY2UudXJsOwogICAgICAgIGZldGNoKHVybCwgY3JlYXRlRmV0Y2hPcHRpb25zKHRoaXMuX2hlYWRlcnMsIHRoaXMuX3dpdGhDcmVkZW50aWFscywgdGhpcy5fYWJvcnRDb250cm9sbGVyKSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIGlmICghKDAsIF9uZXR3b3JrX3V0aWxzLnZhbGlkYXRlUmVzcG9uc2VTdGF0dXMpKHJlc3BvbnNlLnN0YXR1cykpIHsKICAgICAgICAgICAgdGhyb3cgKDAsIF9uZXR3b3JrX3V0aWxzLmNyZWF0ZVJlc3BvbnNlU3RhdHVzRXJyb3IpKHJlc3BvbnNlLnN0YXR1cywgdXJsKTsKICAgICAgICAgIH0KCiAgICAgICAgICBfdGhpcy5fcmVhZGVyID0gcmVzcG9uc2UuYm9keS5nZXRSZWFkZXIoKTsKCiAgICAgICAgICBfdGhpcy5faGVhZGVyc0NhcGFiaWxpdHkucmVzb2x2ZSgpOwoKICAgICAgICAgIHZhciBnZXRSZXNwb25zZUhlYWRlciA9IGZ1bmN0aW9uIGdldFJlc3BvbnNlSGVhZGVyKG5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmhlYWRlcnMuZ2V0KG5hbWUpOwogICAgICAgICAgfTsKCiAgICAgICAgICB2YXIgX3ZhbGlkYXRlUmFuZ2VSZXF1ZXN0ID0gKDAsIF9uZXR3b3JrX3V0aWxzLnZhbGlkYXRlUmFuZ2VSZXF1ZXN0Q2FwYWJpbGl0aWVzKSh7CiAgICAgICAgICAgICAgZ2V0UmVzcG9uc2VIZWFkZXI6IGdldFJlc3BvbnNlSGVhZGVyLAogICAgICAgICAgICAgIGlzSHR0cDogX3RoaXMuX3N0cmVhbS5pc0h0dHAsCiAgICAgICAgICAgICAgcmFuZ2VDaHVua1NpemU6IF90aGlzLl9yYW5nZUNodW5rU2l6ZSwKICAgICAgICAgICAgICBkaXNhYmxlUmFuZ2U6IF90aGlzLl9kaXNhYmxlUmFuZ2UKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIGFsbG93UmFuZ2VSZXF1ZXN0cyA9IF92YWxpZGF0ZVJhbmdlUmVxdWVzdC5hbGxvd1JhbmdlUmVxdWVzdHMsCiAgICAgICAgICAgIHN1Z2dlc3RlZExlbmd0aCA9IF92YWxpZGF0ZVJhbmdlUmVxdWVzdC5zdWdnZXN0ZWRMZW5ndGg7CgogICAgICAgICAgX3RoaXMuX2lzUmFuZ2VTdXBwb3J0ZWQgPSBhbGxvd1JhbmdlUmVxdWVzdHM7CiAgICAgICAgICBfdGhpcy5fY29udGVudExlbmd0aCA9IHN1Z2dlc3RlZExlbmd0aCB8fCBfdGhpcy5fY29udGVudExlbmd0aDsKICAgICAgICAgIF90aGlzLl9maWxlbmFtZSA9ICgwLCBfbmV0d29ya191dGlscy5leHRyYWN0RmlsZW5hbWVGcm9tSGVhZGVyKShnZXRSZXNwb25zZUhlYWRlcik7CgogICAgICAgICAgaWYgKCFfdGhpcy5faXNTdHJlYW1pbmdTdXBwb3J0ZWQgJiYgX3RoaXMuX2lzUmFuZ2VTdXBwb3J0ZWQpIHsKICAgICAgICAgICAgX3RoaXMuY2FuY2VsKG5ldyBfdXRpbC5BYm9ydEV4Y2VwdGlvbigiU3RyZWFtaW5nIGlzIGRpc2FibGVkLiIpKTsKICAgICAgICAgIH0KICAgICAgICB9KVsiY2F0Y2giXSh0aGlzLl9oZWFkZXJzQ2FwYWJpbGl0eS5yZWplY3QpOwogICAgICAgIHRoaXMub25Qcm9ncmVzcyA9IG51bGw7CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhQREZGZXRjaFN0cmVhbVJlYWRlciwgW3sKICAgICAgICBrZXk6ICJyZWFkIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIF9yZWFkID0gX2FzeW5jVG9HZW5lcmF0b3IoLyojX19QVVJFX18qL19yZWdlbmVyYXRvclsiZGVmYXVsdCJdLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICAgICAgdmFyIF9yZWYsIHZhbHVlLCBkb25lLCBidWZmZXI7CgogICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yWyJkZWZhdWx0Il0ud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5faGVhZGVyc0NhcGFiaWxpdHkucHJvbWlzZTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNDsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVhZGVyLnJlYWQoKTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICBfcmVmID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IF9yZWYudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgZG9uZSA9IF9yZWYuZG9uZTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCFkb25lKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gOTsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLAogICAgICAgICAgICAgICAgICAgICAgZG9uZTogZG9uZQogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgICAgIHRoaXMuX2xvYWRlZCArPSB2YWx1ZS5ieXRlTGVuZ3RoOwoKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vblByb2dyZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9uUHJvZ3Jlc3MoewogICAgICAgICAgICAgICAgICAgICAgICBsb2FkZWQ6IHRoaXMuX2xvYWRlZCwKICAgICAgICAgICAgICAgICAgICAgICAgdG90YWw6IHRoaXMuX2NvbnRlbnRMZW5ndGgKICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgYnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkodmFsdWUpLmJ1ZmZlcjsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogYnVmZmVyLAogICAgICAgICAgICAgICAgICAgICAgZG9uZTogZmFsc2UKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIF9jYWxsZWUsIHRoaXMpOwogICAgICAgICAgfSkpOwoKICAgICAgICAgIGZ1bmN0aW9uIHJlYWQoKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVhZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiByZWFkOwogICAgICAgIH0oKQogICAgICB9LCB7CiAgICAgICAga2V5OiAiY2FuY2VsIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY2FuY2VsKHJlYXNvbikgewogICAgICAgICAgaWYgKHRoaXMuX3JlYWRlcikgewogICAgICAgICAgICB0aGlzLl9yZWFkZXIuY2FuY2VsKHJlYXNvbik7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRoaXMuX2Fib3J0Q29udHJvbGxlcikgewogICAgICAgICAgICB0aGlzLl9hYm9ydENvbnRyb2xsZXIuYWJvcnQoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJoZWFkZXJzUmVhZHkiLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX2hlYWRlcnNDYXBhYmlsaXR5LnByb21pc2U7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZmlsZW5hbWUiLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX2ZpbGVuYW1lOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImNvbnRlbnRMZW5ndGgiLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnRlbnRMZW5ndGg7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiaXNSYW5nZVN1cHBvcnRlZCIsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5faXNSYW5nZVN1cHBvcnRlZDsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJpc1N0cmVhbWluZ1N1cHBvcnRlZCIsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5faXNTdHJlYW1pbmdTdXBwb3J0ZWQ7CiAgICAgICAgfQogICAgICB9XSk7CgogICAgICByZXR1cm4gUERGRmV0Y2hTdHJlYW1SZWFkZXI7CiAgICB9KCk7CgogICAgdmFyIFBERkZldGNoU3RyZWFtUmFuZ2VSZWFkZXIgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBQREZGZXRjaFN0cmVhbVJhbmdlUmVhZGVyKHN0cmVhbSwgYmVnaW4sIGVuZCkgewogICAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUERGRmV0Y2hTdHJlYW1SYW5nZVJlYWRlcik7CgogICAgICAgIHRoaXMuX3N0cmVhbSA9IHN0cmVhbTsKICAgICAgICB0aGlzLl9yZWFkZXIgPSBudWxsOwogICAgICAgIHRoaXMuX2xvYWRlZCA9IDA7CiAgICAgICAgdmFyIHNvdXJjZSA9IHN0cmVhbS5zb3VyY2U7CiAgICAgICAgdGhpcy5fd2l0aENyZWRlbnRpYWxzID0gc291cmNlLndpdGhDcmVkZW50aWFscyB8fCBmYWxzZTsKICAgICAgICB0aGlzLl9yZWFkQ2FwYWJpbGl0eSA9ICgwLCBfdXRpbC5jcmVhdGVQcm9taXNlQ2FwYWJpbGl0eSkoKTsKICAgICAgICB0aGlzLl9pc1N0cmVhbWluZ1N1cHBvcnRlZCA9ICFzb3VyY2UuZGlzYWJsZVN0cmVhbTsKCiAgICAgICAgaWYgKHR5cGVvZiBBYm9ydENvbnRyb2xsZXIgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICB0aGlzLl9hYm9ydENvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLl9oZWFkZXJzID0gY3JlYXRlSGVhZGVycyh0aGlzLl9zdHJlYW0uaHR0cEhlYWRlcnMpOwoKICAgICAgICB0aGlzLl9oZWFkZXJzLmFwcGVuZCgiUmFuZ2UiLCAiYnl0ZXM9Ii5jb25jYXQoYmVnaW4sICItIikuY29uY2F0KGVuZCAtIDEpKTsKCiAgICAgICAgdmFyIHVybCA9IHNvdXJjZS51cmw7CiAgICAgICAgZmV0Y2godXJsLCBjcmVhdGVGZXRjaE9wdGlvbnModGhpcy5faGVhZGVycywgdGhpcy5fd2l0aENyZWRlbnRpYWxzLCB0aGlzLl9hYm9ydENvbnRyb2xsZXIpKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgaWYgKCEoMCwgX25ldHdvcmtfdXRpbHMudmFsaWRhdGVSZXNwb25zZVN0YXR1cykocmVzcG9uc2Uuc3RhdHVzKSkgewogICAgICAgICAgICB0aHJvdyAoMCwgX25ldHdvcmtfdXRpbHMuY3JlYXRlUmVzcG9uc2VTdGF0dXNFcnJvcikocmVzcG9uc2Uuc3RhdHVzLCB1cmwpOwogICAgICAgICAgfQoKICAgICAgICAgIF90aGlzMi5fcmVhZENhcGFiaWxpdHkucmVzb2x2ZSgpOwoKICAgICAgICAgIF90aGlzMi5fcmVhZGVyID0gcmVzcG9uc2UuYm9keS5nZXRSZWFkZXIoKTsKICAgICAgICB9KTsKICAgICAgICB0aGlzLm9uUHJvZ3Jlc3MgPSBudWxsOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoUERGRmV0Y2hTdHJlYW1SYW5nZVJlYWRlciwgW3sKICAgICAgICBrZXk6ICJyZWFkIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIF9yZWFkMiA9IF9hc3luY1RvR2VuZXJhdG9yKC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JbImRlZmF1bHQiXS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgICAgICAgICB2YXIgX3JlZjIsIHZhbHVlLCBkb25lLCBidWZmZXI7CgogICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yWyJkZWZhdWx0Il0ud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAyOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZWFkQ2FwYWJpbGl0eS5wcm9taXNlOwoKICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNDsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVhZGVyLnJlYWQoKTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICBfcmVmMiA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gX3JlZjIudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgZG9uZSA9IF9yZWYyLmRvbmU7CgogICAgICAgICAgICAgICAgICAgIGlmICghZG9uZSkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA5OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLAogICAgICAgICAgICAgICAgICAgICAgZG9uZTogZG9uZQogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgICAgIHRoaXMuX2xvYWRlZCArPSB2YWx1ZS5ieXRlTGVuZ3RoOwoKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vblByb2dyZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9uUHJvZ3Jlc3MoewogICAgICAgICAgICAgICAgICAgICAgICBsb2FkZWQ6IHRoaXMuX2xvYWRlZAogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBidWZmZXIgPSBuZXcgVWludDhBcnJheSh2YWx1ZSkuYnVmZmVyOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogYnVmZmVyLAogICAgICAgICAgICAgICAgICAgICAgZG9uZTogZmFsc2UKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBfY2FsbGVlMiwgdGhpcyk7CiAgICAgICAgICB9KSk7CgogICAgICAgICAgZnVuY3Rpb24gcmVhZCgpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZWFkMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiByZWFkOwogICAgICAgIH0oKQogICAgICB9LCB7CiAgICAgICAga2V5OiAiY2FuY2VsIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY2FuY2VsKHJlYXNvbikgewogICAgICAgICAgaWYgKHRoaXMuX3JlYWRlcikgewogICAgICAgICAgICB0aGlzLl9yZWFkZXIuY2FuY2VsKHJlYXNvbik7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRoaXMuX2Fib3J0Q29udHJvbGxlcikgewogICAgICAgICAgICB0aGlzLl9hYm9ydENvbnRyb2xsZXIuYWJvcnQoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJpc1N0cmVhbWluZ1N1cHBvcnRlZCIsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5faXNTdHJlYW1pbmdTdXBwb3J0ZWQ7CiAgICAgICAgfQogICAgICB9XSk7CgogICAgICByZXR1cm4gUERGRmV0Y2hTdHJlYW1SYW5nZVJlYWRlcjsKICAgIH0oKTsKCiAgICAvKioqL30KICAvKioqKioqLyldKTsKfSk7"
          document.head.appendChild(pdfjsScript)

          pdfjsScript.addEventListener("load", function () {
            pdfjsLib.GlobalWorkerOptions.workerSrc =
              "data:text/javascript;base64,LyoqCiAqIEBsaWNzdGFydCBUaGUgZm9sbG93aW5nIGlzIHRoZSBlbnRpcmUgbGljZW5zZSBub3RpY2UgZm9yIHRoZQogKiBKYXZhc2NyaXB0IGNvZGUgaW4gdGhpcyBwYWdlCiAqCiAqIENvcHlyaWdodCAyMDIwIE1vemlsbGEgRm91bmRhdGlvbgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKgogKiBAbGljZW5kIFRoZSBhYm92ZSBpcyB0aGUgZW50aXJlIGxpY2Vuc2Ugbm90aWNlIGZvciB0aGUKICogSmF2YXNjcmlwdCBjb2RlIGluIHRoaXMgcGFnZQogKi8KCihmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7CiAgaWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0JykKICBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTtlbHNlCiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkKICBkZWZpbmUoInBkZmpzLWRpc3QvYnVpbGQvcGRmLndvcmtlciIsIFtdLCBmYWN0b3J5KTtlbHNlCiAgaWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JykKICBleHBvcnRzWyJwZGZqcy1kaXN0L2J1aWxkL3BkZi53b3JrZXIiXSA9IGZhY3RvcnkoKTtlbHNlCgogIHJvb3RbInBkZmpzLWRpc3QvYnVpbGQvcGRmLndvcmtlciJdID0gcm9vdC5wZGZqc1dvcmtlciA9IGZhY3RvcnkoKTsKfSkodGhpcywgZnVuY3Rpb24gKCkgewogIHJldHVybiAvKioqKioqL2Z1bmN0aW9uIChtb2R1bGVzKSB7Ly8gd2VicGFja0Jvb3RzdHJhcAogICAgLyoqKioqKi8gLy8gVGhlIG1vZHVsZSBjYWNoZQogICAgLyoqKioqKi92YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9OwogICAgLyoqKioqKi8KICAgIC8qKioqKiovIC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uCiAgICAvKioqKioqL2Z1bmN0aW9uIF9fd19wZGZqc19yZXF1aXJlX18obW9kdWxlSWQpIHsKICAgICAgLyoqKioqKi8KICAgICAgLyoqKioqKi8gLy8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlCiAgICAgIC8qKioqKiovaWYgKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7CiAgICAgICAgLyoqKioqKi9yZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0czsKICAgICAgICAvKioqKioqL30KICAgICAgLyoqKioqKi8gLy8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSkKICAgICAgLyoqKioqKi92YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7CiAgICAgICAgLyoqKioqKi9pOiBtb2R1bGVJZCwKICAgICAgICAvKioqKioqL2w6IGZhbHNlLAogICAgICAgIC8qKioqKiovZXhwb3J0czoge30KICAgICAgICAvKioqKioqLyB9OwogICAgICAvKioqKioqLwogICAgICAvKioqKioqLyAvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb24KICAgICAgLyoqKioqKi9tb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKTsKICAgICAgLyoqKioqKi8KICAgICAgLyoqKioqKi8gLy8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZAogICAgICAvKioqKioqL21vZHVsZS5sID0gdHJ1ZTsKICAgICAgLyoqKioqKi8KICAgICAgLyoqKioqKi8gLy8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGUKICAgICAgLyoqKioqKi9yZXR1cm4gbW9kdWxlLmV4cG9ydHM7CiAgICAgIC8qKioqKiovfQogICAgLyoqKioqKi8KICAgIC8qKioqKiovCiAgICAvKioqKioqLyAvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKQogICAgLyoqKioqKi9fX3dfcGRmanNfcmVxdWlyZV9fLm0gPSBtb2R1bGVzOwogICAgLyoqKioqKi8KICAgIC8qKioqKiovIC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlCiAgICAvKioqKioqL19fd19wZGZqc19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7CiAgICAvKioqKioqLwogICAgLyoqKioqKi8gLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzCiAgICAvKioqKioqL19fd19wZGZqc19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uIChleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHsKICAgICAgLyoqKioqKi9pZiAoIV9fd19wZGZqc19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkgewogICAgICAgIC8qKioqKiovT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7CiAgICAgICAgLyoqKioqKi99CiAgICAgIC8qKioqKiovfTsKICAgIC8qKioqKiovCiAgICAvKioqKioqLyAvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzCiAgICAvKioqKioqL19fd19wZGZqc19yZXF1aXJlX18uciA9IGZ1bmN0aW9uIChleHBvcnRzKSB7CiAgICAgIC8qKioqKiovaWYgKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykgewogICAgICAgIC8qKioqKiovT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7CiAgICAgICAgLyoqKioqKi99CiAgICAgIC8qKioqKiovT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTsKICAgICAgLyoqKioqKi99OwogICAgLyoqKioqKi8KICAgIC8qKioqKiovIC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdAogICAgLyoqKioqKi8gLy8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0CiAgICAvKioqKioqLyAvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnMKICAgIC8qKioqKiovIC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdAogICAgLyoqKioqKi8gLy8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZQogICAgLyoqKioqKi9fX3dfcGRmanNfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbiAodmFsdWUsIG1vZGUpIHsKICAgICAgLyoqKioqKi9pZiAobW9kZSAmIDEpIHZhbHVlID0gX193X3BkZmpzX3JlcXVpcmVfXyh2YWx1ZSk7CiAgICAgIC8qKioqKiovaWYgKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7CiAgICAgIC8qKioqKiovaWYgKG1vZGUgJiA0ICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlOwogICAgICAvKioqKioqL3ZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIC8qKioqKiovX193X3BkZmpzX3JlcXVpcmVfXy5yKG5zKTsKICAgICAgLyoqKioqKi9PYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7CiAgICAgIC8qKioqKiovaWYgKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yICh2YXIga2V5IGluIHZhbHVlKSBfX3dfcGRmanNfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24gKGtleSkge3JldHVybiB2YWx1ZVtrZXldO30uYmluZChudWxsLCBrZXkpKTsKICAgICAgLyoqKioqKi9yZXR1cm4gbnM7CiAgICAgIC8qKioqKiovfTsKICAgIC8qKioqKiovCiAgICAvKioqKioqLyAvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlcwogICAgLyoqKioqKi9fX3dfcGRmanNfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbiAobW9kdWxlKSB7CiAgICAgIC8qKioqKiovdmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/CiAgICAgIC8qKioqKiovZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHtyZXR1cm4gbW9kdWxlWydkZWZhdWx0J107fSA6CiAgICAgIC8qKioqKiovZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHtyZXR1cm4gbW9kdWxlO307CiAgICAgIC8qKioqKiovX193X3BkZmpzX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpOwogICAgICAvKioqKioqL3JldHVybiBnZXR0ZXI7CiAgICAgIC8qKioqKiovfTsKICAgIC8qKioqKiovCiAgICAvKioqKioqLyAvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwKICAgIC8qKioqKiovX193X3BkZmpzX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24gKG9iamVjdCwgcHJvcGVydHkpIHtyZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpO307CiAgICAvKioqKioqLwogICAgLyoqKioqKi8gLy8gX193ZWJwYWNrX3B1YmxpY19wYXRoX18KICAgIC8qKioqKiovX193X3BkZmpzX3JlcXVpcmVfXy5wID0gIiI7CiAgICAvKioqKioqLwogICAgLyoqKioqKi8KICAgIC8qKioqKiovIC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0cwogICAgLyoqKioqKi9yZXR1cm4gX193X3BkZmpzX3JlcXVpcmVfXyhfX3dfcGRmanNfcmVxdWlyZV9fLnMgPSAwKTsKICAgIC8qKioqKiovfQogIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCiAgLyoqKioqKi8oWygKICAvKiAwICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKCiAgICB2YXIgcGRmanNWZXJzaW9uID0gJzIuNC40NTYnOwogICAgdmFyIHBkZmpzQnVpbGQgPSAnMjI4YTU5MWMnOwoKICAgIHZhciBwZGZqc0NvcmVXb3JrZXIgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEpOwoKICAgIGV4cG9ydHMuV29ya2VyTWVzc2FnZUhhbmRsZXIgPSBwZGZqc0NvcmVXb3JrZXIuV29ya2VyTWVzc2FnZUhhbmRsZXI7CgogICAgLyoqKi99KSwgKAogIC8qIDEgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgoKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgICAgdmFsdWU6IHRydWUKICAgIH0pOwogICAgZXhwb3J0cy5Xb3JrZXJNZXNzYWdlSGFuZGxlciA9IGV4cG9ydHMuV29ya2VyVGFzayA9IHZvaWQgMDsKCiAgICB2YXIgX3JlZ2VuZXJhdG9yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfX3dfcGRmanNfcmVxdWlyZV9fKDIpKTsKCiAgICB2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUpOwoKICAgIHZhciBfcHJpbWl0aXZlcyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTk0KTsKCiAgICB2YXIgX3BkZl9tYW5hZ2VyID0gX193X3BkZmpzX3JlcXVpcmVfXygxOTUpOwoKICAgIHZhciBfaXNfbm9kZSA9IF9fd19wZGZqc19yZXF1aXJlX18oNTIpOwoKICAgIHZhciBfbWVzc2FnZV9oYW5kbGVyID0gX193X3BkZmpzX3JlcXVpcmVfXygyMzQpOwoKICAgIHZhciBfd29ya2VyX3N0cmVhbSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjM1KTsKCiAgICB2YXIgX2NvcmVfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE5Nyk7CgogICAgZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHtyZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyAiZGVmYXVsdCI6IG9iaiB9O30KCiAgICBmdW5jdGlvbiBfc2xpY2VkVG9BcnJheShhcnIsIGkpIHtyZXR1cm4gX2FycmF5V2l0aEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgfHwgX25vbkl0ZXJhYmxlUmVzdCgpO30KCiAgICBmdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0KCkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UiKTt9CgogICAgZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkge2lmICghKFN5bWJvbC5pdGVyYXRvciBpbiBPYmplY3QoYXJyKSB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYXJyKSA9PT0gIltvYmplY3QgQXJndW1lbnRzXSIpKSB7cmV0dXJuO312YXIgX2FyciA9IFtdO3ZhciBfbiA9IHRydWU7dmFyIF9kID0gZmFsc2U7dmFyIF9lID0gdW5kZWZpbmVkO3RyeSB7Zm9yICh2YXIgX2kgPSBhcnJbU3ltYm9sLml0ZXJhdG9yXSgpLCBfczsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkge19hcnIucHVzaChfcy52YWx1ZSk7aWYgKGkgJiYgX2Fyci5sZW5ndGggPT09IGkpIGJyZWFrO319IGNhdGNoIChlcnIpIHtfZCA9IHRydWU7X2UgPSBlcnI7fSBmaW5hbGx5IHt0cnkge2lmICghX24gJiYgX2lbInJldHVybiJdICE9IG51bGwpIF9pWyJyZXR1cm4iXSgpO30gZmluYWxseSB7aWYgKF9kKSB0aHJvdyBfZTt9fXJldHVybiBfYXJyO30KCiAgICBmdW5jdGlvbiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB7aWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjt9CgogICAgZnVuY3Rpb24gYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBrZXksIGFyZykge3RyeSB7dmFyIGluZm8gPSBnZW5ba2V5XShhcmcpO3ZhciB2YWx1ZSA9IGluZm8udmFsdWU7fSBjYXRjaCAoZXJyb3IpIHtyZWplY3QoZXJyb3IpO3JldHVybjt9aWYgKGluZm8uZG9uZSkge3Jlc29sdmUodmFsdWUpO30gZWxzZSB7UHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKF9uZXh0LCBfdGhyb3cpO319CgogICAgZnVuY3Rpb24gX2FzeW5jVG9HZW5lcmF0b3IoZm4pIHtyZXR1cm4gZnVuY3Rpb24gKCkge3ZhciBzZWxmID0gdGhpcyxhcmdzID0gYXJndW1lbnRzO3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7dmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpO2Z1bmN0aW9uIF9uZXh0KHZhbHVlKSB7YXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAibmV4dCIsIHZhbHVlKTt9ZnVuY3Rpb24gX3Rocm93KGVycikge2FzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyKTt9X25leHQodW5kZWZpbmVkKTt9KTt9O30KCiAgICB2YXIgV29ya2VyVGFzayA9IGZ1bmN0aW9uIFdvcmtlclRhc2tDbG9zdXJlKCkgewogICAgICBmdW5jdGlvbiBXb3JrZXJUYXNrKG5hbWUpIHsKICAgICAgICB0aGlzLm5hbWUgPSBuYW1lOwogICAgICAgIHRoaXMudGVybWluYXRlZCA9IGZhbHNlOwogICAgICAgIHRoaXMuX2NhcGFiaWxpdHkgPSAoMCwgX3V0aWwuY3JlYXRlUHJvbWlzZUNhcGFiaWxpdHkpKCk7CiAgICAgIH0KCiAgICAgIFdvcmtlclRhc2sucHJvdG90eXBlID0gewogICAgICAgIGdldCBmaW5pc2hlZCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9jYXBhYmlsaXR5LnByb21pc2U7CiAgICAgICAgfSwKCiAgICAgICAgZmluaXNoOiBmdW5jdGlvbiBmaW5pc2goKSB7CiAgICAgICAgICB0aGlzLl9jYXBhYmlsaXR5LnJlc29sdmUoKTsKICAgICAgICB9LAogICAgICAgIHRlcm1pbmF0ZTogZnVuY3Rpb24gdGVybWluYXRlKCkgewogICAgICAgICAgdGhpcy50ZXJtaW5hdGVkID0gdHJ1ZTsKICAgICAgICB9LAogICAgICAgIGVuc3VyZU5vdFRlcm1pbmF0ZWQ6IGZ1bmN0aW9uIGVuc3VyZU5vdFRlcm1pbmF0ZWQoKSB7CiAgICAgICAgICBpZiAodGhpcy50ZXJtaW5hdGVkKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiV29ya2VyIHRhc2sgd2FzIHRlcm1pbmF0ZWQiKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07CiAgICAgIHJldHVybiBXb3JrZXJUYXNrOwogICAgfSgpOwoKICAgIGV4cG9ydHMuV29ya2VyVGFzayA9IFdvcmtlclRhc2s7CiAgICB2YXIgV29ya2VyTWVzc2FnZUhhbmRsZXIgPSB7CiAgICAgIHNldHVwOiBmdW5jdGlvbiBzZXR1cChoYW5kbGVyLCBwb3J0KSB7CiAgICAgICAgdmFyIHRlc3RNZXNzYWdlUHJvY2Vzc2VkID0gZmFsc2U7CiAgICAgICAgaGFuZGxlci5vbigidGVzdCIsIGZ1bmN0aW9uIHdwaFNldHVwVGVzdChkYXRhKSB7CiAgICAgICAgICBpZiAodGVzdE1lc3NhZ2VQcm9jZXNzZWQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHRlc3RNZXNzYWdlUHJvY2Vzc2VkID0gdHJ1ZTsKCiAgICAgICAgICBpZiAoIShkYXRhIGluc3RhbmNlb2YgVWludDhBcnJheSkpIHsKICAgICAgICAgICAgaGFuZGxlci5zZW5kKCJ0ZXN0IiwgbnVsbCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgc3VwcG9ydFRyYW5zZmVycyA9IGRhdGFbMF0gPT09IDI1NTsKICAgICAgICAgIGhhbmRsZXIucG9zdE1lc3NhZ2VUcmFuc2ZlcnMgPSBzdXBwb3J0VHJhbnNmZXJzOwogICAgICAgICAgaGFuZGxlci5zZW5kKCJ0ZXN0IiwgewogICAgICAgICAgICBzdXBwb3J0VHJhbnNmZXJzOiBzdXBwb3J0VHJhbnNmZXJzCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgICBoYW5kbGVyLm9uKCJjb25maWd1cmUiLCBmdW5jdGlvbiB3cGhDb25maWd1cmUoZGF0YSkgewogICAgICAgICAgKDAsIF91dGlsLnNldFZlcmJvc2l0eUxldmVsKShkYXRhLnZlcmJvc2l0eSk7CiAgICAgICAgfSk7CiAgICAgICAgaGFuZGxlci5vbigiR2V0RG9jUmVxdWVzdCIsIGZ1bmN0aW9uIHdwaFNldHVwRG9jKGRhdGEpIHsKICAgICAgICAgIHJldHVybiBXb3JrZXJNZXNzYWdlSGFuZGxlci5jcmVhdGVEb2N1bWVudEhhbmRsZXIoZGF0YSwgcG9ydCk7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIGNyZWF0ZURvY3VtZW50SGFuZGxlcjogZnVuY3Rpb24gY3JlYXRlRG9jdW1lbnRIYW5kbGVyKGRvY1BhcmFtcywgcG9ydCkgewogICAgICAgIHZhciBwZGZNYW5hZ2VyOwogICAgICAgIHZhciB0ZXJtaW5hdGVkID0gZmFsc2U7CiAgICAgICAgdmFyIGNhbmNlbFhIUnMgPSBudWxsOwogICAgICAgIHZhciBXb3JrZXJUYXNrcyA9IFtdOwogICAgICAgIHZhciB2ZXJib3NpdHkgPSAoMCwgX3V0aWwuZ2V0VmVyYm9zaXR5TGV2ZWwpKCk7CiAgICAgICAgdmFyIGFwaVZlcnNpb24gPSBkb2NQYXJhbXMuYXBpVmVyc2lvbjsKICAgICAgICB2YXIgd29ya2VyVmVyc2lvbiA9ICcyLjQuNDU2JzsKCiAgICAgICAgaWYgKGFwaVZlcnNpb24gIT09IHdvcmtlclZlcnNpb24pIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVGhlIEFQSSB2ZXJzaW9uIFwiIi5jb25jYXQoYXBpVmVyc2lvbiwgIlwiIGRvZXMgbm90IG1hdGNoICIpICsgInRoZSBXb3JrZXIgdmVyc2lvbiBcIiIuY29uY2F0KHdvcmtlclZlcnNpb24sICJcIi4iKSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgZW51bWVyYWJsZVByb3BlcnRpZXMgPSBbXTsKCiAgICAgICAgZm9yICh2YXIgcHJvcGVydHkgaW4gW10pIHsKICAgICAgICAgIGVudW1lcmFibGVQcm9wZXJ0aWVzLnB1c2gocHJvcGVydHkpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGVudW1lcmFibGVQcm9wZXJ0aWVzLmxlbmd0aCkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUaGUgYEFycmF5LnByb3RvdHlwZWAgY29udGFpbnMgdW5leHBlY3RlZCBlbnVtZXJhYmxlIHByb3BlcnRpZXM6ICIgKyBlbnVtZXJhYmxlUHJvcGVydGllcy5qb2luKCIsICIpICsgIjsgdGh1cyBicmVha2luZyBlLmcuIGBmb3IuLi5pbmAgaXRlcmF0aW9uIG9mIGBBcnJheWBzLiIpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGRvY0lkID0gZG9jUGFyYW1zLmRvY0lkOwogICAgICAgIHZhciBkb2NCYXNlVXJsID0gZG9jUGFyYW1zLmRvY0Jhc2VVcmw7CiAgICAgICAgdmFyIHdvcmtlckhhbmRsZXJOYW1lID0gZG9jUGFyYW1zLmRvY0lkICsgIl93b3JrZXIiOwogICAgICAgIHZhciBoYW5kbGVyID0gbmV3IF9tZXNzYWdlX2hhbmRsZXIuTWVzc2FnZUhhbmRsZXIod29ya2VySGFuZGxlck5hbWUsIGRvY0lkLCBwb3J0KTsKICAgICAgICBoYW5kbGVyLnBvc3RNZXNzYWdlVHJhbnNmZXJzID0gZG9jUGFyYW1zLnBvc3RNZXNzYWdlVHJhbnNmZXJzOwoKICAgICAgICBmdW5jdGlvbiBlbnN1cmVOb3RUZXJtaW5hdGVkKCkgewogICAgICAgICAgaWYgKHRlcm1pbmF0ZWQpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJXb3JrZXIgd2FzIHRlcm1pbmF0ZWQiKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHN0YXJ0V29ya2VyVGFzayh0YXNrKSB7CiAgICAgICAgICBXb3JrZXJUYXNrcy5wdXNoKHRhc2spOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZmluaXNoV29ya2VyVGFzayh0YXNrKSB7CiAgICAgICAgICB0YXNrLmZpbmlzaCgpOwogICAgICAgICAgdmFyIGkgPSBXb3JrZXJUYXNrcy5pbmRleE9mKHRhc2spOwogICAgICAgICAgV29ya2VyVGFza3Muc3BsaWNlKGksIDEpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gbG9hZERvY3VtZW50KF94KSB7CiAgICAgICAgICByZXR1cm4gX2xvYWREb2N1bWVudC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gX2xvYWREb2N1bWVudCgpIHsKICAgICAgICAgIF9sb2FkRG9jdW1lbnQgPSBfYXN5bmNUb0dlbmVyYXRvcigvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yWyJkZWZhdWx0Il0ubWFyayhmdW5jdGlvbiBfY2FsbGVlKHJlY292ZXJ5TW9kZSkgewogICAgICAgICAgICB2YXIgX3JlZjQsIF9yZWY1LCBudW1QYWdlcywgZmluZ2VycHJpbnQ7CgogICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yWyJkZWZhdWx0Il0ud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGRmTWFuYWdlci5lbnN1cmVEb2MoImNoZWNrSGVhZGVyIik7CgogICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZW5zdXJlRG9jKCJwYXJzZVN0YXJ0WFJlZiIpOwoKICAgICAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA2OwogICAgICAgICAgICAgICAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZURvYygicGFyc2UiLCBbcmVjb3ZlcnlNb2RlXSk7CgogICAgICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlY292ZXJ5TW9kZSkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDk7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA5OwogICAgICAgICAgICAgICAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZURvYygiY2hlY2tGaXJzdFBhZ2UiKTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKFtwZGZNYW5hZ2VyLmVuc3VyZURvYygibnVtUGFnZXMiKSwgcGRmTWFuYWdlci5lbnN1cmVEb2MoImZpbmdlcnByaW50IildKTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICAgICAgX3JlZjQgPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICAgICAgICAgIF9yZWY1ID0gX3NsaWNlZFRvQXJyYXkoX3JlZjQsIDIpOwogICAgICAgICAgICAgICAgICAgIG51bVBhZ2VzID0gX3JlZjVbMF07CiAgICAgICAgICAgICAgICAgICAgZmluZ2VycHJpbnQgPSBfcmVmNVsxXTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgICAgICBudW1QYWdlczogbnVtUGFnZXMsCiAgICAgICAgICAgICAgICAgICAgICBmaW5nZXJwcmludDogZmluZ2VycHJpbnQKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIF9jYWxsZWUpOwogICAgICAgICAgfSkpOwogICAgICAgICAgcmV0dXJuIF9sb2FkRG9jdW1lbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGdldFBkZk1hbmFnZXIoZGF0YSwgZXZhbHVhdG9yT3B0aW9ucykgewogICAgICAgICAgdmFyIHBkZk1hbmFnZXJDYXBhYmlsaXR5ID0gKDAsIF91dGlsLmNyZWF0ZVByb21pc2VDYXBhYmlsaXR5KSgpOwogICAgICAgICAgdmFyIHBkZk1hbmFnZXI7CiAgICAgICAgICB2YXIgc291cmNlID0gZGF0YS5zb3VyY2U7CgogICAgICAgICAgaWYgKHNvdXJjZS5kYXRhKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgcGRmTWFuYWdlciA9IG5ldyBfcGRmX21hbmFnZXIuTG9jYWxQZGZNYW5hZ2VyKGRvY0lkLCBzb3VyY2UuZGF0YSwgc291cmNlLnBhc3N3b3JkLCBldmFsdWF0b3JPcHRpb25zLCBkb2NCYXNlVXJsKTsKICAgICAgICAgICAgICBwZGZNYW5hZ2VyQ2FwYWJpbGl0eS5yZXNvbHZlKHBkZk1hbmFnZXIpOwogICAgICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgICAgIHBkZk1hbmFnZXJDYXBhYmlsaXR5LnJlamVjdChleCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBwZGZNYW5hZ2VyQ2FwYWJpbGl0eS5wcm9taXNlOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBwZGZTdHJlYW0sCiAgICAgICAgICAgIGNhY2hlZENodW5rcyA9IFtdOwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHBkZlN0cmVhbSA9IG5ldyBfd29ya2VyX3N0cmVhbS5QREZXb3JrZXJTdHJlYW0oaGFuZGxlcik7CiAgICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgICBwZGZNYW5hZ2VyQ2FwYWJpbGl0eS5yZWplY3QoZXgpOwogICAgICAgICAgICByZXR1cm4gcGRmTWFuYWdlckNhcGFiaWxpdHkucHJvbWlzZTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZnVsbFJlcXVlc3QgPSBwZGZTdHJlYW0uZ2V0RnVsbFJlYWRlcigpOwogICAgICAgICAgZnVsbFJlcXVlc3QuaGVhZGVyc1JlYWR5LnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAoIWZ1bGxSZXF1ZXN0LmlzUmFuZ2VTdXBwb3J0ZWQpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBkaXNhYmxlQXV0b0ZldGNoID0gc291cmNlLmRpc2FibGVBdXRvRmV0Y2ggfHwgZnVsbFJlcXVlc3QuaXNTdHJlYW1pbmdTdXBwb3J0ZWQ7CiAgICAgICAgICAgIHBkZk1hbmFnZXIgPSBuZXcgX3BkZl9tYW5hZ2VyLk5ldHdvcmtQZGZNYW5hZ2VyKGRvY0lkLCBwZGZTdHJlYW0sIHsKICAgICAgICAgICAgICBtc2dIYW5kbGVyOiBoYW5kbGVyLAogICAgICAgICAgICAgIHBhc3N3b3JkOiBzb3VyY2UucGFzc3dvcmQsCiAgICAgICAgICAgICAgbGVuZ3RoOiBmdWxsUmVxdWVzdC5jb250ZW50TGVuZ3RoLAogICAgICAgICAgICAgIGRpc2FibGVBdXRvRmV0Y2g6IGRpc2FibGVBdXRvRmV0Y2gsCiAgICAgICAgICAgICAgcmFuZ2VDaHVua1NpemU6IHNvdXJjZS5yYW5nZUNodW5rU2l6ZQogICAgICAgICAgICB9LCBldmFsdWF0b3JPcHRpb25zLCBkb2NCYXNlVXJsKTsKCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2FjaGVkQ2h1bmtzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgcGRmTWFuYWdlci5zZW5kUHJvZ3Jlc3NpdmVEYXRhKGNhY2hlZENodW5rc1tpXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNhY2hlZENodW5rcyA9IFtdOwogICAgICAgICAgICBwZGZNYW5hZ2VyQ2FwYWJpbGl0eS5yZXNvbHZlKHBkZk1hbmFnZXIpOwogICAgICAgICAgICBjYW5jZWxYSFJzID0gbnVsbDsKICAgICAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgICAgcGRmTWFuYWdlckNhcGFiaWxpdHkucmVqZWN0KHJlYXNvbik7CiAgICAgICAgICAgIGNhbmNlbFhIUnMgPSBudWxsOwogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgbG9hZGVkID0gMDsKCiAgICAgICAgICB2YXIgZmx1c2hDaHVua3MgPSBmdW5jdGlvbiBmbHVzaENodW5rcygpIHsKICAgICAgICAgICAgdmFyIHBkZkZpbGUgPSAoMCwgX3V0aWwuYXJyYXlzVG9CeXRlcykoY2FjaGVkQ2h1bmtzKTsKCiAgICAgICAgICAgIGlmIChzb3VyY2UubGVuZ3RoICYmIHBkZkZpbGUubGVuZ3RoICE9PSBzb3VyY2UubGVuZ3RoKSB7CiAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJyZXBvcnRlZCBIVFRQIGxlbmd0aCBpcyBkaWZmZXJlbnQgZnJvbSBhY3R1YWwiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBwZGZNYW5hZ2VyID0gbmV3IF9wZGZfbWFuYWdlci5Mb2NhbFBkZk1hbmFnZXIoZG9jSWQsIHBkZkZpbGUsIHNvdXJjZS5wYXNzd29yZCwgZXZhbHVhdG9yT3B0aW9ucywgZG9jQmFzZVVybCk7CiAgICAgICAgICAgICAgcGRmTWFuYWdlckNhcGFiaWxpdHkucmVzb2x2ZShwZGZNYW5hZ2VyKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgICAgICBwZGZNYW5hZ2VyQ2FwYWJpbGl0eS5yZWplY3QoZXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjYWNoZWRDaHVua3MgPSBbXTsKICAgICAgICAgIH07CgogICAgICAgICAgdmFyIHJlYWRQcm9taXNlID0gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgICB2YXIgcmVhZENodW5rID0gZnVuY3Rpb24gcmVhZENodW5rKGNodW5rKSB7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGVuc3VyZU5vdFRlcm1pbmF0ZWQoKTsKCiAgICAgICAgICAgICAgICBpZiAoY2h1bmsuZG9uZSkgewogICAgICAgICAgICAgICAgICBpZiAoIXBkZk1hbmFnZXIpIHsKICAgICAgICAgICAgICAgICAgICBmbHVzaENodW5rcygpOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBjYW5jZWxYSFJzID0gbnVsbDsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHZhciBkYXRhID0gY2h1bmsudmFsdWU7CiAgICAgICAgICAgICAgICBsb2FkZWQgKz0gKDAsIF91dGlsLmFycmF5Qnl0ZUxlbmd0aCkoZGF0YSk7CgogICAgICAgICAgICAgICAgaWYgKCFmdWxsUmVxdWVzdC5pc1N0cmVhbWluZ1N1cHBvcnRlZCkgewogICAgICAgICAgICAgICAgICBoYW5kbGVyLnNlbmQoIkRvY1Byb2dyZXNzIiwgewogICAgICAgICAgICAgICAgICAgIGxvYWRlZDogbG9hZGVkLAogICAgICAgICAgICAgICAgICAgIHRvdGFsOiBNYXRoLm1heChsb2FkZWQsIGZ1bGxSZXF1ZXN0LmNvbnRlbnRMZW5ndGggfHwgMCkKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHBkZk1hbmFnZXIpIHsKICAgICAgICAgICAgICAgICAgcGRmTWFuYWdlci5zZW5kUHJvZ3Jlc3NpdmVEYXRhKGRhdGEpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgY2FjaGVkQ2h1bmtzLnB1c2goZGF0YSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVsbFJlcXVlc3QucmVhZCgpLnRoZW4ocmVhZENodW5rLCByZWplY3QpOwogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIHJlamVjdChlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBmdWxsUmVxdWVzdC5yZWFkKCkudGhlbihyZWFkQ2h1bmssIHJlamVjdCk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHJlYWRQcm9taXNlWyJjYXRjaCJdKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIHBkZk1hbmFnZXJDYXBhYmlsaXR5LnJlamVjdChlKTsKICAgICAgICAgICAgY2FuY2VsWEhScyA9IG51bGw7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBjYW5jZWxYSFJzID0gZnVuY3Rpb24gY2FuY2VsWEhScyhyZWFzb24pIHsKICAgICAgICAgICAgcGRmU3RyZWFtLmNhbmNlbEFsbFJlcXVlc3RzKHJlYXNvbik7CiAgICAgICAgICB9OwoKICAgICAgICAgIHJldHVybiBwZGZNYW5hZ2VyQ2FwYWJpbGl0eS5wcm9taXNlOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc2V0dXBEb2MoZGF0YSkgewogICAgICAgICAgZnVuY3Rpb24gb25TdWNjZXNzKGRvYykgewogICAgICAgICAgICBlbnN1cmVOb3RUZXJtaW5hdGVkKCk7CiAgICAgICAgICAgIGhhbmRsZXIuc2VuZCgiR2V0RG9jIiwgewogICAgICAgICAgICAgIHBkZkluZm86IGRvYwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBvbkZhaWx1cmUoZXgpIHsKICAgICAgICAgICAgZW5zdXJlTm90VGVybWluYXRlZCgpOwoKICAgICAgICAgICAgaWYgKGV4IGluc3RhbmNlb2YgX3V0aWwuUGFzc3dvcmRFeGNlcHRpb24pIHsKICAgICAgICAgICAgICB2YXIgdGFzayA9IG5ldyBXb3JrZXJUYXNrKCJQYXNzd29yZEV4Y2VwdGlvbjogcmVzcG9uc2UgIi5jb25jYXQoZXguY29kZSkpOwogICAgICAgICAgICAgIHN0YXJ0V29ya2VyVGFzayh0YXNrKTsKICAgICAgICAgICAgICBoYW5kbGVyLnNlbmRXaXRoUHJvbWlzZSgiUGFzc3dvcmRSZXF1ZXN0IiwgZXgpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgIGZpbmlzaFdvcmtlclRhc2sodGFzayk7CiAgICAgICAgICAgICAgICBwZGZNYW5hZ2VyLnVwZGF0ZVBhc3N3b3JkKGRhdGEucGFzc3dvcmQpOwogICAgICAgICAgICAgICAgcGRmTWFuYWdlclJlYWR5KCk7CiAgICAgICAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgZmluaXNoV29ya2VyVGFzayh0YXNrKTsKICAgICAgICAgICAgICAgIGhhbmRsZXIuc2VuZCgiRG9jRXhjZXB0aW9uIiwgZXgpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKGV4IGluc3RhbmNlb2YgX3V0aWwuSW52YWxpZFBERkV4Y2VwdGlvbiB8fCBleCBpbnN0YW5jZW9mIF91dGlsLk1pc3NpbmdQREZFeGNlcHRpb24gfHwgZXggaW5zdGFuY2VvZiBfdXRpbC5VbmV4cGVjdGVkUmVzcG9uc2VFeGNlcHRpb24gfHwgZXggaW5zdGFuY2VvZiBfdXRpbC5Vbmtub3duRXJyb3JFeGNlcHRpb24pIHsKICAgICAgICAgICAgICBoYW5kbGVyLnNlbmQoIkRvY0V4Y2VwdGlvbiIsIGV4KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBoYW5kbGVyLnNlbmQoIkRvY0V4Y2VwdGlvbiIsIG5ldyBfdXRpbC5Vbmtub3duRXJyb3JFeGNlcHRpb24oZXgubWVzc2FnZSwgZXgudG9TdHJpbmcoKSkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gcGRmTWFuYWdlclJlYWR5KCkgewogICAgICAgICAgICBlbnN1cmVOb3RUZXJtaW5hdGVkKCk7CiAgICAgICAgICAgIGxvYWREb2N1bWVudChmYWxzZSkudGhlbihvblN1Y2Nlc3MsIGZ1bmN0aW9uIGxvYWRGYWlsdXJlKGV4KSB7CiAgICAgICAgICAgICAgZW5zdXJlTm90VGVybWluYXRlZCgpOwoKICAgICAgICAgICAgICBpZiAoIShleCBpbnN0YW5jZW9mIF9jb3JlX3V0aWxzLlhSZWZQYXJzZUV4Y2VwdGlvbikpIHsKICAgICAgICAgICAgICAgIG9uRmFpbHVyZShleCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBwZGZNYW5hZ2VyLnJlcXVlc3RMb2FkZWRTdHJlYW0oKTsKICAgICAgICAgICAgICBwZGZNYW5hZ2VyLm9uTG9hZGVkU3RyZWFtKCkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBlbnN1cmVOb3RUZXJtaW5hdGVkKCk7CiAgICAgICAgICAgICAgICBsb2FkRG9jdW1lbnQodHJ1ZSkudGhlbihvblN1Y2Nlc3MsIG9uRmFpbHVyZSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0sIG9uRmFpbHVyZSk7CiAgICAgICAgICB9CgogICAgICAgICAgZW5zdXJlTm90VGVybWluYXRlZCgpOwogICAgICAgICAgdmFyIGV2YWx1YXRvck9wdGlvbnMgPSB7CiAgICAgICAgICAgIGZvcmNlRGF0YVNjaGVtYTogZGF0YS5kaXNhYmxlQ3JlYXRlT2JqZWN0VVJMLAogICAgICAgICAgICBtYXhJbWFnZVNpemU6IGRhdGEubWF4SW1hZ2VTaXplLAogICAgICAgICAgICBkaXNhYmxlRm9udEZhY2U6IGRhdGEuZGlzYWJsZUZvbnRGYWNlLAogICAgICAgICAgICBuYXRpdmVJbWFnZURlY29kZXJTdXBwb3J0OiBkYXRhLm5hdGl2ZUltYWdlRGVjb2RlclN1cHBvcnQsCiAgICAgICAgICAgIGlnbm9yZUVycm9yczogZGF0YS5pZ25vcmVFcnJvcnMsCiAgICAgICAgICAgIGlzRXZhbFN1cHBvcnRlZDogZGF0YS5pc0V2YWxTdXBwb3J0ZWQKICAgICAgICAgIH07CiAgICAgICAgICBnZXRQZGZNYW5hZ2VyKGRhdGEsIGV2YWx1YXRvck9wdGlvbnMpLnRoZW4oZnVuY3Rpb24gKG5ld1BkZk1hbmFnZXIpIHsKICAgICAgICAgICAgaWYgKHRlcm1pbmF0ZWQpIHsKICAgICAgICAgICAgICBuZXdQZGZNYW5hZ2VyLnRlcm1pbmF0ZShuZXcgX3V0aWwuQWJvcnRFeGNlcHRpb24oIldvcmtlciB3YXMgdGVybWluYXRlZC4iKSk7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJXb3JrZXIgd2FzIHRlcm1pbmF0ZWQiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcGRmTWFuYWdlciA9IG5ld1BkZk1hbmFnZXI7CiAgICAgICAgICAgIHBkZk1hbmFnZXIub25Mb2FkZWRTdHJlYW0oKS50aGVuKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICAgICAgICBoYW5kbGVyLnNlbmQoIkRhdGFMb2FkZWQiLCB7CiAgICAgICAgICAgICAgICBsZW5ndGg6IHN0cmVhbS5ieXRlcy5ieXRlTGVuZ3RoCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSkudGhlbihwZGZNYW5hZ2VyUmVhZHksIG9uRmFpbHVyZSk7CiAgICAgICAgfQoKICAgICAgICBoYW5kbGVyLm9uKCJHZXRQYWdlIiwgZnVuY3Rpb24gd3BoU2V0dXBHZXRQYWdlKGRhdGEpIHsKICAgICAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmdldFBhZ2UoZGF0YS5wYWdlSW5kZXgpLnRoZW4oZnVuY3Rpb24gKHBhZ2UpIHsKICAgICAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKFtwZGZNYW5hZ2VyLmVuc3VyZShwYWdlLCAicm90YXRlIiksIHBkZk1hbmFnZXIuZW5zdXJlKHBhZ2UsICJyZWYiKSwgcGRmTWFuYWdlci5lbnN1cmUocGFnZSwgInVzZXJVbml0IiksIHBkZk1hbmFnZXIuZW5zdXJlKHBhZ2UsICJ2aWV3IildKS50aGVuKGZ1bmN0aW9uIChfcmVmKSB7CiAgICAgICAgICAgICAgdmFyIF9yZWYyID0gX3NsaWNlZFRvQXJyYXkoX3JlZiwgNCksCiAgICAgICAgICAgICAgICByb3RhdGUgPSBfcmVmMlswXSwKICAgICAgICAgICAgICAgIHJlZiA9IF9yZWYyWzFdLAogICAgICAgICAgICAgICAgdXNlclVuaXQgPSBfcmVmMlsyXSwKICAgICAgICAgICAgICAgIHZpZXcgPSBfcmVmMlszXTsKCiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHJvdGF0ZTogcm90YXRlLAogICAgICAgICAgICAgICAgcmVmOiByZWYsCiAgICAgICAgICAgICAgICB1c2VyVW5pdDogdXNlclVuaXQsCiAgICAgICAgICAgICAgICB2aWV3OiB2aWV3CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgICBoYW5kbGVyLm9uKCJHZXRQYWdlSW5kZXgiLCBmdW5jdGlvbiB3cGhTZXR1cEdldFBhZ2VJbmRleChkYXRhKSB7CiAgICAgICAgICB2YXIgcmVmID0gX3ByaW1pdGl2ZXMuUmVmLmdldChkYXRhLnJlZi5udW0sIGRhdGEucmVmLmdlbik7CgogICAgICAgICAgdmFyIGNhdGFsb2cgPSBwZGZNYW5hZ2VyLnBkZkRvY3VtZW50LmNhdGFsb2c7CiAgICAgICAgICByZXR1cm4gY2F0YWxvZy5nZXRQYWdlSW5kZXgocmVmKTsKICAgICAgICB9KTsKICAgICAgICBoYW5kbGVyLm9uKCJHZXREZXN0aW5hdGlvbnMiLCBmdW5jdGlvbiB3cGhTZXR1cEdldERlc3RpbmF0aW9ucyhkYXRhKSB7CiAgICAgICAgICByZXR1cm4gcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJkZXN0aW5hdGlvbnMiKTsKICAgICAgICB9KTsKICAgICAgICBoYW5kbGVyLm9uKCJHZXREZXN0aW5hdGlvbiIsIGZ1bmN0aW9uIHdwaFNldHVwR2V0RGVzdGluYXRpb24oZGF0YSkgewogICAgICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygiZ2V0RGVzdGluYXRpb24iLCBbZGF0YS5pZF0pOwogICAgICAgIH0pOwogICAgICAgIGhhbmRsZXIub24oIkdldFBhZ2VMYWJlbHMiLCBmdW5jdGlvbiB3cGhTZXR1cEdldFBhZ2VMYWJlbHMoZGF0YSkgewogICAgICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygicGFnZUxhYmVscyIpOwogICAgICAgIH0pOwogICAgICAgIGhhbmRsZXIub24oIkdldFBhZ2VMYXlvdXQiLCBmdW5jdGlvbiB3cGhTZXR1cEdldFBhZ2VMYXlvdXQoZGF0YSkgewogICAgICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygicGFnZUxheW91dCIpOwogICAgICAgIH0pOwogICAgICAgIGhhbmRsZXIub24oIkdldFBhZ2VNb2RlIiwgZnVuY3Rpb24gd3BoU2V0dXBHZXRQYWdlTW9kZShkYXRhKSB7CiAgICAgICAgICByZXR1cm4gcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJwYWdlTW9kZSIpOwogICAgICAgIH0pOwogICAgICAgIGhhbmRsZXIub24oIkdldFZpZXdlclByZWZlcmVuY2VzIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coInZpZXdlclByZWZlcmVuY2VzIik7CiAgICAgICAgfSk7CiAgICAgICAgaGFuZGxlci5vbigiR2V0T3BlbkFjdGlvbiIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICByZXR1cm4gcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJvcGVuQWN0aW9uIik7CiAgICAgICAgfSk7CiAgICAgICAgaGFuZGxlci5vbigiR2V0QXR0YWNobWVudHMiLCBmdW5jdGlvbiB3cGhTZXR1cEdldEF0dGFjaG1lbnRzKGRhdGEpIHsKICAgICAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coImF0dGFjaG1lbnRzIik7CiAgICAgICAgfSk7CiAgICAgICAgaGFuZGxlci5vbigiR2V0SmF2YVNjcmlwdCIsIGZ1bmN0aW9uIHdwaFNldHVwR2V0SmF2YVNjcmlwdChkYXRhKSB7CiAgICAgICAgICByZXR1cm4gcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJqYXZhU2NyaXB0Iik7CiAgICAgICAgfSk7CiAgICAgICAgaGFuZGxlci5vbigiR2V0T3V0bGluZSIsIGZ1bmN0aW9uIHdwaFNldHVwR2V0T3V0bGluZShkYXRhKSB7CiAgICAgICAgICByZXR1cm4gcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJkb2N1bWVudE91dGxpbmUiKTsKICAgICAgICB9KTsKICAgICAgICBoYW5kbGVyLm9uKCJHZXRQZXJtaXNzaW9ucyIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICByZXR1cm4gcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJwZXJtaXNzaW9ucyIpOwogICAgICAgIH0pOwogICAgICAgIGhhbmRsZXIub24oIkdldE1ldGFkYXRhIiwgZnVuY3Rpb24gd3BoU2V0dXBHZXRNZXRhZGF0YShkYXRhKSB7CiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3BkZk1hbmFnZXIuZW5zdXJlRG9jKCJkb2N1bWVudEluZm8iKSwgcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJtZXRhZGF0YSIpXSk7CiAgICAgICAgfSk7CiAgICAgICAgaGFuZGxlci5vbigiR2V0RGF0YSIsIGZ1bmN0aW9uIHdwaFNldHVwR2V0RGF0YShkYXRhKSB7CiAgICAgICAgICBwZGZNYW5hZ2VyLnJlcXVlc3RMb2FkZWRTdHJlYW0oKTsKICAgICAgICAgIHJldHVybiBwZGZNYW5hZ2VyLm9uTG9hZGVkU3RyZWFtKCkudGhlbihmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICAgIHJldHVybiBzdHJlYW0uYnl0ZXM7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgICBoYW5kbGVyLm9uKCJHZXRTdGF0cyIsIGZ1bmN0aW9uIHdwaFNldHVwR2V0U3RhdHMoZGF0YSkgewogICAgICAgICAgcmV0dXJuIHBkZk1hbmFnZXIucGRmRG9jdW1lbnQueHJlZi5zdGF0czsKICAgICAgICB9KTsKICAgICAgICBoYW5kbGVyLm9uKCJHZXRBbm5vdGF0aW9ucyIsIGZ1bmN0aW9uIChfcmVmMykgewogICAgICAgICAgdmFyIHBhZ2VJbmRleCA9IF9yZWYzLnBhZ2VJbmRleCwKICAgICAgICAgICAgaW50ZW50ID0gX3JlZjMuaW50ZW50OwogICAgICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZ2V0UGFnZShwYWdlSW5kZXgpLnRoZW4oZnVuY3Rpb24gKHBhZ2UpIHsKICAgICAgICAgICAgcmV0dXJuIHBhZ2UuZ2V0QW5ub3RhdGlvbnNEYXRhKGludGVudCk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgICBoYW5kbGVyLm9uKCJHZXRPcGVyYXRvckxpc3QiLCBmdW5jdGlvbiB3cGhTZXR1cFJlbmRlclBhZ2UoZGF0YSwgc2luaykgewogICAgICAgICAgdmFyIHBhZ2VJbmRleCA9IGRhdGEucGFnZUluZGV4OwogICAgICAgICAgcGRmTWFuYWdlci5nZXRQYWdlKHBhZ2VJbmRleCkudGhlbihmdW5jdGlvbiAocGFnZSkgewogICAgICAgICAgICB2YXIgdGFzayA9IG5ldyBXb3JrZXJUYXNrKCJHZXRPcGVyYXRvckxpc3Q6IHBhZ2UgIi5jb25jYXQocGFnZUluZGV4KSk7CiAgICAgICAgICAgIHN0YXJ0V29ya2VyVGFzayh0YXNrKTsKICAgICAgICAgICAgdmFyIHN0YXJ0ID0gdmVyYm9zaXR5ID49IF91dGlsLlZlcmJvc2l0eUxldmVsLklORk9TID8gRGF0ZS5ub3coKSA6IDA7CiAgICAgICAgICAgIHBhZ2UuZ2V0T3BlcmF0b3JMaXN0KHsKICAgICAgICAgICAgICBoYW5kbGVyOiBoYW5kbGVyLAogICAgICAgICAgICAgIHNpbms6IHNpbmssCiAgICAgICAgICAgICAgdGFzazogdGFzaywKICAgICAgICAgICAgICBpbnRlbnQ6IGRhdGEuaW50ZW50LAogICAgICAgICAgICAgIHJlbmRlckludGVyYWN0aXZlRm9ybXM6IGRhdGEucmVuZGVySW50ZXJhY3RpdmVGb3JtcwogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChvcGVyYXRvckxpc3RJbmZvKSB7CiAgICAgICAgICAgICAgZmluaXNoV29ya2VyVGFzayh0YXNrKTsKCiAgICAgICAgICAgICAgaWYgKHN0YXJ0KSB7CiAgICAgICAgICAgICAgICAoMCwgX3V0aWwuaW5mbykoInBhZ2U9Ii5jb25jYXQocGFnZUluZGV4ICsgMSwgIiAtIGdldE9wZXJhdG9yTGlzdDogdGltZT0iKSArICIiLmNvbmNhdChEYXRlLm5vdygpIC0gc3RhcnQsICJtcywgbGVuPSIpLmNvbmNhdChvcGVyYXRvckxpc3RJbmZvLmxlbmd0aCkpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgc2luay5jbG9zZSgpOwogICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICAgICAgZmluaXNoV29ya2VyVGFzayh0YXNrKTsKCiAgICAgICAgICAgICAgaWYgKHRhc2sudGVybWluYXRlZCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaGFuZGxlci5zZW5kKCJVbnN1cHBvcnRlZEZlYXR1cmUiLCB7CiAgICAgICAgICAgICAgICBmZWF0dXJlSWQ6IF91dGlsLlVOU1VQUE9SVEVEX0ZFQVRVUkVTLnVua25vd24KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBzaW5rLmVycm9yKHJlYXNvbik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfSwgdGhpcyk7CiAgICAgICAgaGFuZGxlci5vbigiR2V0VGV4dENvbnRlbnQiLCBmdW5jdGlvbiB3cGhFeHRyYWN0VGV4dChkYXRhLCBzaW5rKSB7CiAgICAgICAgICB2YXIgcGFnZUluZGV4ID0gZGF0YS5wYWdlSW5kZXg7CgogICAgICAgICAgc2luay5vblB1bGwgPSBmdW5jdGlvbiAoZGVzaXJlZFNpemUpIHt9OwoKICAgICAgICAgIHNpbmsub25DYW5jZWwgPSBmdW5jdGlvbiAocmVhc29uKSB7fTsKCiAgICAgICAgICBwZGZNYW5hZ2VyLmdldFBhZ2UocGFnZUluZGV4KS50aGVuKGZ1bmN0aW9uIChwYWdlKSB7CiAgICAgICAgICAgIHZhciB0YXNrID0gbmV3IFdvcmtlclRhc2soIkdldFRleHRDb250ZW50OiBwYWdlICIgKyBwYWdlSW5kZXgpOwogICAgICAgICAgICBzdGFydFdvcmtlclRhc2sodGFzayk7CiAgICAgICAgICAgIHZhciBzdGFydCA9IHZlcmJvc2l0eSA+PSBfdXRpbC5WZXJib3NpdHlMZXZlbC5JTkZPUyA/IERhdGUubm93KCkgOiAwOwogICAgICAgICAgICBwYWdlLmV4dHJhY3RUZXh0Q29udGVudCh7CiAgICAgICAgICAgICAgaGFuZGxlcjogaGFuZGxlciwKICAgICAgICAgICAgICB0YXNrOiB0YXNrLAogICAgICAgICAgICAgIHNpbms6IHNpbmssCiAgICAgICAgICAgICAgbm9ybWFsaXplV2hpdGVzcGFjZTogZGF0YS5ub3JtYWxpemVXaGl0ZXNwYWNlLAogICAgICAgICAgICAgIGNvbWJpbmVUZXh0SXRlbXM6IGRhdGEuY29tYmluZVRleHRJdGVtcwogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBmaW5pc2hXb3JrZXJUYXNrKHRhc2spOwoKICAgICAgICAgICAgICBpZiAoc3RhcnQpIHsKICAgICAgICAgICAgICAgICgwLCBfdXRpbC5pbmZvKSgicGFnZT0iLmNvbmNhdChwYWdlSW5kZXggKyAxLCAiIC0gZ2V0VGV4dENvbnRlbnQ6IHRpbWU9IikgKyAiIi5jb25jYXQoRGF0ZS5ub3coKSAtIHN0YXJ0LCAibXMiKSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzaW5rLmNsb3NlKCk7CiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgICAgICBmaW5pc2hXb3JrZXJUYXNrKHRhc2spOwoKICAgICAgICAgICAgICBpZiAodGFzay50ZXJtaW5hdGVkKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzaW5rLmVycm9yKHJlYXNvbik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgaGFuZGxlci5vbigiRm9udEZhbGxiYWNrIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmZvbnRGYWxsYmFjayhkYXRhLmlkLCBoYW5kbGVyKTsKICAgICAgICB9KTsKICAgICAgICBoYW5kbGVyLm9uKCJDbGVhbnVwIiwgZnVuY3Rpb24gd3BoQ2xlYW51cChkYXRhKSB7CiAgICAgICAgICByZXR1cm4gcGRmTWFuYWdlci5jbGVhbnVwKCk7CiAgICAgICAgfSk7CiAgICAgICAgaGFuZGxlci5vbigiVGVybWluYXRlIiwgZnVuY3Rpb24gd3BoVGVybWluYXRlKGRhdGEpIHsKICAgICAgICAgIHRlcm1pbmF0ZWQgPSB0cnVlOwogICAgICAgICAgdmFyIHdhaXRPbiA9IFtdOwoKICAgICAgICAgIGlmIChwZGZNYW5hZ2VyKSB7CiAgICAgICAgICAgIHBkZk1hbmFnZXIudGVybWluYXRlKG5ldyBfdXRpbC5BYm9ydEV4Y2VwdGlvbigiV29ya2VyIHdhcyB0ZXJtaW5hdGVkLiIpKTsKICAgICAgICAgICAgdmFyIGNsZWFudXBQcm9taXNlID0gcGRmTWFuYWdlci5jbGVhbnVwKCk7CiAgICAgICAgICAgIHdhaXRPbi5wdXNoKGNsZWFudXBQcm9taXNlKTsKICAgICAgICAgICAgcGRmTWFuYWdlciA9IG51bGw7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAoMCwgX3ByaW1pdGl2ZXMuY2xlYXJQcmltaXRpdmVDYWNoZXMpKCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGNhbmNlbFhIUnMpIHsKICAgICAgICAgICAgY2FuY2VsWEhScyhuZXcgX3V0aWwuQWJvcnRFeGNlcHRpb24oIldvcmtlciB3YXMgdGVybWluYXRlZC4iKSk7CiAgICAgICAgICB9CgogICAgICAgICAgV29ya2VyVGFza3MuZm9yRWFjaChmdW5jdGlvbiAodGFzaykgewogICAgICAgICAgICB3YWl0T24ucHVzaCh0YXNrLmZpbmlzaGVkKTsKICAgICAgICAgICAgdGFzay50ZXJtaW5hdGUoKTsKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKHdhaXRPbikudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGhhbmRsZXIuZGVzdHJveSgpOwogICAgICAgICAgICBoYW5kbGVyID0gbnVsbDsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICAgIGhhbmRsZXIub24oIlJlYWR5IiwgZnVuY3Rpb24gd3BoUmVhZHkoZGF0YSkgewogICAgICAgICAgc2V0dXBEb2MoZG9jUGFyYW1zKTsKICAgICAgICAgIGRvY1BhcmFtcyA9IG51bGw7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHdvcmtlckhhbmRsZXJOYW1lOwogICAgICB9LAogICAgICBpbml0aWFsaXplRnJvbVBvcnQ6IGZ1bmN0aW9uIGluaXRpYWxpemVGcm9tUG9ydChwb3J0KSB7CiAgICAgICAgdmFyIGhhbmRsZXIgPSBuZXcgX21lc3NhZ2VfaGFuZGxlci5NZXNzYWdlSGFuZGxlcigid29ya2VyIiwgIm1haW4iLCBwb3J0KTsKICAgICAgICBXb3JrZXJNZXNzYWdlSGFuZGxlci5zZXR1cChoYW5kbGVyLCBwb3J0KTsKICAgICAgICBoYW5kbGVyLnNlbmQoInJlYWR5IiwgbnVsbCk7CiAgICAgIH0KICAgIH07CiAgICBleHBvcnRzLldvcmtlck1lc3NhZ2VIYW5kbGVyID0gV29ya2VyTWVzc2FnZUhhbmRsZXI7CgogICAgZnVuY3Rpb24gaXNNZXNzYWdlUG9ydChtYXliZVBvcnQpIHsKICAgICAgcmV0dXJuIHR5cGVvZiBtYXliZVBvcnQucG9zdE1lc3NhZ2UgPT09ICJmdW5jdGlvbiIgJiYgIm9ubWVzc2FnZSIgaW4gbWF5YmVQb3J0OwogICAgfQoKICAgIGlmICh0eXBlb2Ygd2luZG93ID09PSAidW5kZWZpbmVkIiAmJiAhX2lzX25vZGUuaXNOb2RlSlMgJiYgdHlwZW9mIHNlbGYgIT09ICJ1bmRlZmluZWQiICYmIGlzTWVzc2FnZVBvcnQoc2VsZikpIHsKICAgICAgV29ya2VyTWVzc2FnZUhhbmRsZXIuaW5pdGlhbGl6ZUZyb21Qb3J0KHNlbGYpOwogICAgfQoKICAgIC8qKiovfSksICgKICAvKiAyICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKCiAgICBtb2R1bGUuZXhwb3J0cyA9IF9fd19wZGZqc19yZXF1aXJlX18oMyk7CgogICAgLyoqKi99KSwgKAogIC8qIDMgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CiAgICAvKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi8oZnVuY3Rpb24gKG1vZHVsZSkgewoKICAgICAgZnVuY3Rpb24gX3R5cGVvZihvYmopIHsiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2YiO2lmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7X3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7cmV0dXJuIHR5cGVvZiBvYmo7fTt9IGVsc2Uge190eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikge3JldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmo7fTt9cmV0dXJuIF90eXBlb2Yob2JqKTt9CgogICAgICB2YXIgcnVudGltZSA9IGZ1bmN0aW9uIChleHBvcnRzKSB7CiAgICAgICAgInVzZSBzdHJpY3QiOwoKICAgICAgICB2YXIgT3AgPSBPYmplY3QucHJvdG90eXBlOwogICAgICAgIHZhciBoYXNPd24gPSBPcC5oYXNPd25Qcm9wZXJ0eTsKICAgICAgICB2YXIgdW5kZWZpbmVkOwogICAgICAgIHZhciAkU3ltYm9sID0gdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiA/IFN5bWJvbCA6IHt9OwogICAgICAgIHZhciBpdGVyYXRvclN5bWJvbCA9ICRTeW1ib2wuaXRlcmF0b3IgfHwgIkBAaXRlcmF0b3IiOwogICAgICAgIHZhciBhc3luY0l0ZXJhdG9yU3ltYm9sID0gJFN5bWJvbC5hc3luY0l0ZXJhdG9yIHx8ICJAQGFzeW5jSXRlcmF0b3IiOwogICAgICAgIHZhciB0b1N0cmluZ1RhZ1N5bWJvbCA9ICRTeW1ib2wudG9TdHJpbmdUYWcgfHwgIkBAdG9TdHJpbmdUYWciOwoKICAgICAgICBmdW5jdGlvbiB3cmFwKGlubmVyRm4sIG91dGVyRm4sIHNlbGYsIHRyeUxvY3NMaXN0KSB7CiAgICAgICAgICB2YXIgcHJvdG9HZW5lcmF0b3IgPSBvdXRlckZuICYmIG91dGVyRm4ucHJvdG90eXBlIGluc3RhbmNlb2YgR2VuZXJhdG9yID8gb3V0ZXJGbiA6IEdlbmVyYXRvcjsKICAgICAgICAgIHZhciBnZW5lcmF0b3IgPSBPYmplY3QuY3JlYXRlKHByb3RvR2VuZXJhdG9yLnByb3RvdHlwZSk7CiAgICAgICAgICB2YXIgY29udGV4dCA9IG5ldyBDb250ZXh0KHRyeUxvY3NMaXN0IHx8IFtdKTsKICAgICAgICAgIGdlbmVyYXRvci5faW52b2tlID0gbWFrZUludm9rZU1ldGhvZChpbm5lckZuLCBzZWxmLCBjb250ZXh0KTsKICAgICAgICAgIHJldHVybiBnZW5lcmF0b3I7CiAgICAgICAgfQoKICAgICAgICBleHBvcnRzLndyYXAgPSB3cmFwOwoKICAgICAgICBmdW5jdGlvbiB0cnlDYXRjaChmbiwgb2JqLCBhcmcpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgdHlwZTogIm5vcm1hbCIsCiAgICAgICAgICAgICAgYXJnOiBmbi5jYWxsKG9iaiwgYXJnKQogICAgICAgICAgICB9OwogICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgdHlwZTogInRocm93IiwKICAgICAgICAgICAgICBhcmc6IGVycgogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFyIEdlblN0YXRlU3VzcGVuZGVkU3RhcnQgPSAic3VzcGVuZGVkU3RhcnQiOwogICAgICAgIHZhciBHZW5TdGF0ZVN1c3BlbmRlZFlpZWxkID0gInN1c3BlbmRlZFlpZWxkIjsKICAgICAgICB2YXIgR2VuU3RhdGVFeGVjdXRpbmcgPSAiZXhlY3V0aW5nIjsKICAgICAgICB2YXIgR2VuU3RhdGVDb21wbGV0ZWQgPSAiY29tcGxldGVkIjsKICAgICAgICB2YXIgQ29udGludWVTZW50aW5lbCA9IHt9OwoKICAgICAgICBmdW5jdGlvbiBHZW5lcmF0b3IoKSB7fQoKICAgICAgICBmdW5jdGlvbiBHZW5lcmF0b3JGdW5jdGlvbigpIHt9CgogICAgICAgIGZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKCkge30KCiAgICAgICAgdmFyIEl0ZXJhdG9yUHJvdG90eXBlID0ge307CgogICAgICAgIEl0ZXJhdG9yUHJvdG90eXBlW2l0ZXJhdG9yU3ltYm9sXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH07CgogICAgICAgIHZhciBnZXRQcm90byA9IE9iamVjdC5nZXRQcm90b3R5cGVPZjsKICAgICAgICB2YXIgTmF0aXZlSXRlcmF0b3JQcm90b3R5cGUgPSBnZXRQcm90byAmJiBnZXRQcm90byhnZXRQcm90byh2YWx1ZXMoW10pKSk7CgogICAgICAgIGlmIChOYXRpdmVJdGVyYXRvclByb3RvdHlwZSAmJiBOYXRpdmVJdGVyYXRvclByb3RvdHlwZSAhPT0gT3AgJiYgaGFzT3duLmNhbGwoTmF0aXZlSXRlcmF0b3JQcm90b3R5cGUsIGl0ZXJhdG9yU3ltYm9sKSkgewogICAgICAgICAgSXRlcmF0b3JQcm90b3R5cGUgPSBOYXRpdmVJdGVyYXRvclByb3RvdHlwZTsKICAgICAgICB9CgogICAgICAgIHZhciBHcCA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLnByb3RvdHlwZSA9IEdlbmVyYXRvci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEl0ZXJhdG9yUHJvdG90eXBlKTsKICAgICAgICBHZW5lcmF0b3JGdW5jdGlvbi5wcm90b3R5cGUgPSBHcC5jb25zdHJ1Y3RvciA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlOwogICAgICAgIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLmNvbnN0cnVjdG9yID0gR2VuZXJhdG9yRnVuY3Rpb247CiAgICAgICAgR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGVbdG9TdHJpbmdUYWdTeW1ib2xdID0gR2VuZXJhdG9yRnVuY3Rpb24uZGlzcGxheU5hbWUgPSAiR2VuZXJhdG9yRnVuY3Rpb24iOwoKICAgICAgICBmdW5jdGlvbiBkZWZpbmVJdGVyYXRvck1ldGhvZHMocHJvdG90eXBlKSB7CiAgICAgICAgICBbIm5leHQiLCAidGhyb3ciLCAicmV0dXJuIl0uZm9yRWFjaChmdW5jdGlvbiAobWV0aG9kKSB7CiAgICAgICAgICAgIHByb3RvdHlwZVttZXRob2RdID0gZnVuY3Rpb24gKGFyZykgewogICAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBhcmcpOwogICAgICAgICAgICB9OwogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBleHBvcnRzLmlzR2VuZXJhdG9yRnVuY3Rpb24gPSBmdW5jdGlvbiAoZ2VuRnVuKSB7CiAgICAgICAgICB2YXIgY3RvciA9IHR5cGVvZiBnZW5GdW4gPT09ICJmdW5jdGlvbiIgJiYgZ2VuRnVuLmNvbnN0cnVjdG9yOwogICAgICAgICAgcmV0dXJuIGN0b3IgPyBjdG9yID09PSBHZW5lcmF0b3JGdW5jdGlvbiB8fCAoY3Rvci5kaXNwbGF5TmFtZSB8fCBjdG9yLm5hbWUpID09PSAiR2VuZXJhdG9yRnVuY3Rpb24iIDogZmFsc2U7CiAgICAgICAgfTsKCiAgICAgICAgZXhwb3J0cy5tYXJrID0gZnVuY3Rpb24gKGdlbkZ1bikgewogICAgICAgICAgaWYgKE9iamVjdC5zZXRQcm90b3R5cGVPZikgewogICAgICAgICAgICBPYmplY3Quc2V0UHJvdG90eXBlT2YoZ2VuRnVuLCBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBnZW5GdW4uX19wcm90b19fID0gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGU7CgogICAgICAgICAgICBpZiAoISh0b1N0cmluZ1RhZ1N5bWJvbCBpbiBnZW5GdW4pKSB7CiAgICAgICAgICAgICAgZ2VuRnVuW3RvU3RyaW5nVGFnU3ltYm9sXSA9ICJHZW5lcmF0b3JGdW5jdGlvbiI7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBnZW5GdW4ucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShHcCk7CiAgICAgICAgICByZXR1cm4gZ2VuRnVuOwogICAgICAgIH07CgogICAgICAgIGV4cG9ydHMuYXdyYXAgPSBmdW5jdGlvbiAoYXJnKSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBfX2F3YWl0OiBhcmcKICAgICAgICAgIH07CiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gQXN5bmNJdGVyYXRvcihnZW5lcmF0b3IsIFByb21pc2VJbXBsKSB7CiAgICAgICAgICBmdW5jdGlvbiBpbnZva2UobWV0aG9kLCBhcmcsIHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgICB2YXIgcmVjb3JkID0gdHJ5Q2F0Y2goZ2VuZXJhdG9yW21ldGhvZF0sIGdlbmVyYXRvciwgYXJnKTsKCiAgICAgICAgICAgIGlmIChyZWNvcmQudHlwZSA9PT0gInRocm93IikgewogICAgICAgICAgICAgIHJlamVjdChyZWNvcmQuYXJnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gcmVjb3JkLmFyZzsKICAgICAgICAgICAgICB2YXIgdmFsdWUgPSByZXN1bHQudmFsdWU7CgogICAgICAgICAgICAgIGlmICh2YWx1ZSAmJiBfdHlwZW9mKHZhbHVlKSA9PT0gIm9iamVjdCIgJiYgaGFzT3duLmNhbGwodmFsdWUsICJfX2F3YWl0IikpIHsKICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlSW1wbC5yZXNvbHZlKHZhbHVlLl9fYXdhaXQpLnRoZW4oZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgIGludm9rZSgibmV4dCIsIHZhbHVlLCByZXNvbHZlLCByZWplY3QpOwogICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikgewogICAgICAgICAgICAgICAgICBpbnZva2UoInRocm93IiwgZXJyLCByZXNvbHZlLCByZWplY3QpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZUltcGwucmVzb2x2ZSh2YWx1ZSkudGhlbihmdW5jdGlvbiAodW53cmFwcGVkKSB7CiAgICAgICAgICAgICAgICByZXN1bHQudmFsdWUgPSB1bndyYXBwZWQ7CiAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7CiAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaW52b2tlKCJ0aHJvdyIsIGVycm9yLCByZXNvbHZlLCByZWplY3QpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHByZXZpb3VzUHJvbWlzZTsKCiAgICAgICAgICBmdW5jdGlvbiBlbnF1ZXVlKG1ldGhvZCwgYXJnKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnKCkgewogICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZUltcGwoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgICAgICAgaW52b2tlKG1ldGhvZCwgYXJnLCByZXNvbHZlLCByZWplY3QpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcHJldmlvdXNQcm9taXNlID0gcHJldmlvdXNQcm9taXNlID8gcHJldmlvdXNQcm9taXNlLnRoZW4oY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcsIGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnKSA6IGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnKCk7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5faW52b2tlID0gZW5xdWV1ZTsKICAgICAgICB9CgogICAgICAgIGRlZmluZUl0ZXJhdG9yTWV0aG9kcyhBc3luY0l0ZXJhdG9yLnByb3RvdHlwZSk7CgogICAgICAgIEFzeW5jSXRlcmF0b3IucHJvdG90eXBlW2FzeW5jSXRlcmF0b3JTeW1ib2xdID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfTsKCiAgICAgICAgZXhwb3J0cy5Bc3luY0l0ZXJhdG9yID0gQXN5bmNJdGVyYXRvcjsKCiAgICAgICAgZXhwb3J0cy5hc3luYyA9IGZ1bmN0aW9uIChpbm5lckZuLCBvdXRlckZuLCBzZWxmLCB0cnlMb2NzTGlzdCwgUHJvbWlzZUltcGwpIHsKICAgICAgICAgIGlmIChQcm9taXNlSW1wbCA9PT0gdm9pZCAwKSBQcm9taXNlSW1wbCA9IFByb21pc2U7CiAgICAgICAgICB2YXIgaXRlciA9IG5ldyBBc3luY0l0ZXJhdG9yKHdyYXAoaW5uZXJGbiwgb3V0ZXJGbiwgc2VsZiwgdHJ5TG9jc0xpc3QpLCBQcm9taXNlSW1wbCk7CiAgICAgICAgICByZXR1cm4gZXhwb3J0cy5pc0dlbmVyYXRvckZ1bmN0aW9uKG91dGVyRm4pID8gaXRlciA6IGl0ZXIubmV4dCgpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICByZXR1cm4gcmVzdWx0LmRvbmUgPyByZXN1bHQudmFsdWUgOiBpdGVyLm5leHQoKTsKICAgICAgICAgIH0pOwogICAgICAgIH07CgogICAgICAgIGZ1bmN0aW9uIG1ha2VJbnZva2VNZXRob2QoaW5uZXJGbiwgc2VsZiwgY29udGV4dCkgewogICAgICAgICAgdmFyIHN0YXRlID0gR2VuU3RhdGVTdXNwZW5kZWRTdGFydDsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbiBpbnZva2UobWV0aG9kLCBhcmcpIHsKICAgICAgICAgICAgaWYgKHN0YXRlID09PSBHZW5TdGF0ZUV4ZWN1dGluZykgewogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiR2VuZXJhdG9yIGlzIGFscmVhZHkgcnVubmluZyIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoc3RhdGUgPT09IEdlblN0YXRlQ29tcGxldGVkKSB7CiAgICAgICAgICAgICAgaWYgKG1ldGhvZCA9PT0gInRocm93IikgewogICAgICAgICAgICAgICAgdGhyb3cgYXJnOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIGRvbmVSZXN1bHQoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29udGV4dC5tZXRob2QgPSBtZXRob2Q7CiAgICAgICAgICAgIGNvbnRleHQuYXJnID0gYXJnOwoKICAgICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgICB2YXIgZGVsZWdhdGUgPSBjb250ZXh0LmRlbGVnYXRlOwoKICAgICAgICAgICAgICBpZiAoZGVsZWdhdGUpIHsKICAgICAgICAgICAgICAgIHZhciBkZWxlZ2F0ZVJlc3VsdCA9IG1heWJlSW52b2tlRGVsZWdhdGUoZGVsZWdhdGUsIGNvbnRleHQpOwoKICAgICAgICAgICAgICAgIGlmIChkZWxlZ2F0ZVJlc3VsdCkgewogICAgICAgICAgICAgICAgICBpZiAoZGVsZWdhdGVSZXN1bHQgPT09IENvbnRpbnVlU2VudGluZWwpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICByZXR1cm4gZGVsZWdhdGVSZXN1bHQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoY29udGV4dC5tZXRob2QgPT09ICJuZXh0IikgewogICAgICAgICAgICAgICAgY29udGV4dC5zZW50ID0gY29udGV4dC5fc2VudCA9IGNvbnRleHQuYXJnOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoY29udGV4dC5tZXRob2QgPT09ICJ0aHJvdyIpIHsKICAgICAgICAgICAgICAgIGlmIChzdGF0ZSA9PT0gR2VuU3RhdGVTdXNwZW5kZWRTdGFydCkgewogICAgICAgICAgICAgICAgICBzdGF0ZSA9IEdlblN0YXRlQ29tcGxldGVkOwogICAgICAgICAgICAgICAgICB0aHJvdyBjb250ZXh0LmFyZzsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb250ZXh0LmRpc3BhdGNoRXhjZXB0aW9uKGNvbnRleHQuYXJnKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvbnRleHQubWV0aG9kID09PSAicmV0dXJuIikgewogICAgICAgICAgICAgICAgY29udGV4dC5hYnJ1cHQoInJldHVybiIsIGNvbnRleHQuYXJnKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHN0YXRlID0gR2VuU3RhdGVFeGVjdXRpbmc7CiAgICAgICAgICAgICAgdmFyIHJlY29yZCA9IHRyeUNhdGNoKGlubmVyRm4sIHNlbGYsIGNvbnRleHQpOwoKICAgICAgICAgICAgICBpZiAocmVjb3JkLnR5cGUgPT09ICJub3JtYWwiKSB7CiAgICAgICAgICAgICAgICBzdGF0ZSA9IGNvbnRleHQuZG9uZSA/IEdlblN0YXRlQ29tcGxldGVkIDogR2VuU3RhdGVTdXNwZW5kZWRZaWVsZDsKCiAgICAgICAgICAgICAgICBpZiAocmVjb3JkLmFyZyA9PT0gQ29udGludWVTZW50aW5lbCkgewogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICB2YWx1ZTogcmVjb3JkLmFyZywKICAgICAgICAgICAgICAgICAgZG9uZTogY29udGV4dC5kb25lCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVjb3JkLnR5cGUgPT09ICJ0aHJvdyIpIHsKICAgICAgICAgICAgICAgIHN0YXRlID0gR2VuU3RhdGVDb21wbGV0ZWQ7CiAgICAgICAgICAgICAgICBjb250ZXh0Lm1ldGhvZCA9ICJ0aHJvdyI7CiAgICAgICAgICAgICAgICBjb250ZXh0LmFyZyA9IHJlY29yZC5hcmc7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gbWF5YmVJbnZva2VEZWxlZ2F0ZShkZWxlZ2F0ZSwgY29udGV4dCkgewogICAgICAgICAgdmFyIG1ldGhvZCA9IGRlbGVnYXRlLml0ZXJhdG9yW2NvbnRleHQubWV0aG9kXTsKCiAgICAgICAgICBpZiAobWV0aG9kID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgY29udGV4dC5kZWxlZ2F0ZSA9IG51bGw7CgogICAgICAgICAgICBpZiAoY29udGV4dC5tZXRob2QgPT09ICJ0aHJvdyIpIHsKICAgICAgICAgICAgICBpZiAoZGVsZWdhdGUuaXRlcmF0b3JbInJldHVybiJdKSB7CiAgICAgICAgICAgICAgICBjb250ZXh0Lm1ldGhvZCA9ICJyZXR1cm4iOwogICAgICAgICAgICAgICAgY29udGV4dC5hcmcgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICBtYXliZUludm9rZURlbGVnYXRlKGRlbGVnYXRlLCBjb250ZXh0KTsKCiAgICAgICAgICAgICAgICBpZiAoY29udGV4dC5tZXRob2QgPT09ICJ0aHJvdyIpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjb250ZXh0Lm1ldGhvZCA9ICJ0aHJvdyI7CiAgICAgICAgICAgICAgY29udGV4dC5hcmcgPSBuZXcgVHlwZUVycm9yKCJUaGUgaXRlcmF0b3IgZG9lcyBub3QgcHJvdmlkZSBhICd0aHJvdycgbWV0aG9kIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBDb250aW51ZVNlbnRpbmVsOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciByZWNvcmQgPSB0cnlDYXRjaChtZXRob2QsIGRlbGVnYXRlLml0ZXJhdG9yLCBjb250ZXh0LmFyZyk7CgogICAgICAgICAgaWYgKHJlY29yZC50eXBlID09PSAidGhyb3ciKSB7CiAgICAgICAgICAgIGNvbnRleHQubWV0aG9kID0gInRocm93IjsKICAgICAgICAgICAgY29udGV4dC5hcmcgPSByZWNvcmQuYXJnOwogICAgICAgICAgICBjb250ZXh0LmRlbGVnYXRlID0gbnVsbDsKICAgICAgICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGluZm8gPSByZWNvcmQuYXJnOwoKICAgICAgICAgIGlmICghaW5mbykgewogICAgICAgICAgICBjb250ZXh0Lm1ldGhvZCA9ICJ0aHJvdyI7CiAgICAgICAgICAgIGNvbnRleHQuYXJnID0gbmV3IFR5cGVFcnJvcigiaXRlcmF0b3IgcmVzdWx0IGlzIG5vdCBhbiBvYmplY3QiKTsKICAgICAgICAgICAgY29udGV4dC5kZWxlZ2F0ZSA9IG51bGw7CiAgICAgICAgICAgIHJldHVybiBDb250aW51ZVNlbnRpbmVsOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChpbmZvLmRvbmUpIHsKICAgICAgICAgICAgY29udGV4dFtkZWxlZ2F0ZS5yZXN1bHROYW1lXSA9IGluZm8udmFsdWU7CiAgICAgICAgICAgIGNvbnRleHQubmV4dCA9IGRlbGVnYXRlLm5leHRMb2M7CgogICAgICAgICAgICBpZiAoY29udGV4dC5tZXRob2QgIT09ICJyZXR1cm4iKSB7CiAgICAgICAgICAgICAgY29udGV4dC5tZXRob2QgPSAibmV4dCI7CiAgICAgICAgICAgICAgY29udGV4dC5hcmcgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBpbmZvOwogICAgICAgICAgfQoKICAgICAgICAgIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsOwogICAgICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7CiAgICAgICAgfQoKICAgICAgICBkZWZpbmVJdGVyYXRvck1ldGhvZHMoR3ApOwogICAgICAgIEdwW3RvU3RyaW5nVGFnU3ltYm9sXSA9ICJHZW5lcmF0b3IiOwoKICAgICAgICBHcFtpdGVyYXRvclN5bWJvbF0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9OwoKICAgICAgICBHcC50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiAiW29iamVjdCBHZW5lcmF0b3JdIjsKICAgICAgICB9OwoKICAgICAgICBmdW5jdGlvbiBwdXNoVHJ5RW50cnkobG9jcykgewogICAgICAgICAgdmFyIGVudHJ5ID0gewogICAgICAgICAgICB0cnlMb2M6IGxvY3NbMF0KICAgICAgICAgIH07CgogICAgICAgICAgaWYgKDEgaW4gbG9jcykgewogICAgICAgICAgICBlbnRyeS5jYXRjaExvYyA9IGxvY3NbMV07CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKDIgaW4gbG9jcykgewogICAgICAgICAgICBlbnRyeS5maW5hbGx5TG9jID0gbG9jc1syXTsKICAgICAgICAgICAgZW50cnkuYWZ0ZXJMb2MgPSBsb2NzWzNdOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMudHJ5RW50cmllcy5wdXNoKGVudHJ5KTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHJlc2V0VHJ5RW50cnkoZW50cnkpIHsKICAgICAgICAgIHZhciByZWNvcmQgPSBlbnRyeS5jb21wbGV0aW9uIHx8IHt9OwogICAgICAgICAgcmVjb3JkLnR5cGUgPSAibm9ybWFsIjsKICAgICAgICAgIGRlbGV0ZSByZWNvcmQuYXJnOwogICAgICAgICAgZW50cnkuY29tcGxldGlvbiA9IHJlY29yZDsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIENvbnRleHQodHJ5TG9jc0xpc3QpIHsKICAgICAgICAgIHRoaXMudHJ5RW50cmllcyA9IFt7CiAgICAgICAgICAgIHRyeUxvYzogInJvb3QiCiAgICAgICAgICB9XTsKICAgICAgICAgIHRyeUxvY3NMaXN0LmZvckVhY2gocHVzaFRyeUVudHJ5LCB0aGlzKTsKICAgICAgICAgIHRoaXMucmVzZXQodHJ1ZSk7CiAgICAgICAgfQoKICAgICAgICBleHBvcnRzLmtleXMgPSBmdW5jdGlvbiAob2JqZWN0KSB7CiAgICAgICAgICB2YXIga2V5cyA9IFtdOwoKICAgICAgICAgIGZvciAodmFyIGtleSBpbiBvYmplY3QpIHsKICAgICAgICAgICAga2V5cy5wdXNoKGtleSk7CiAgICAgICAgICB9CgogICAgICAgICAga2V5cy5yZXZlcnNlKCk7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gbmV4dCgpIHsKICAgICAgICAgICAgd2hpbGUgKGtleXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgdmFyIGtleSA9IGtleXMucG9wKCk7CgogICAgICAgICAgICAgIGlmIChrZXkgaW4gb2JqZWN0KSB7CiAgICAgICAgICAgICAgICBuZXh0LnZhbHVlID0ga2V5OwogICAgICAgICAgICAgICAgbmV4dC5kb25lID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV4dDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG5leHQuZG9uZSA9IHRydWU7CiAgICAgICAgICAgIHJldHVybiBuZXh0OwogICAgICAgICAgfTsKICAgICAgICB9OwoKICAgICAgICBmdW5jdGlvbiB2YWx1ZXMoaXRlcmFibGUpIHsKICAgICAgICAgIGlmIChpdGVyYWJsZSkgewogICAgICAgICAgICB2YXIgaXRlcmF0b3JNZXRob2QgPSBpdGVyYWJsZVtpdGVyYXRvclN5bWJvbF07CgogICAgICAgICAgICBpZiAoaXRlcmF0b3JNZXRob2QpIHsKICAgICAgICAgICAgICByZXR1cm4gaXRlcmF0b3JNZXRob2QuY2FsbChpdGVyYWJsZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0eXBlb2YgaXRlcmFibGUubmV4dCA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgIHJldHVybiBpdGVyYWJsZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCFpc05hTihpdGVyYWJsZS5sZW5ndGgpKSB7CiAgICAgICAgICAgICAgdmFyIGkgPSAtMSwKICAgICAgICAgICAgICAgIG5leHQgPSBmdW5jdGlvbiBuZXh0KCkgewogICAgICAgICAgICAgICAgICB3aGlsZSAoKytpIDwgaXRlcmFibGUubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc093bi5jYWxsKGl0ZXJhYmxlLCBpKSkgewogICAgICAgICAgICAgICAgICAgICAgbmV4dC52YWx1ZSA9IGl0ZXJhYmxlW2ldOwogICAgICAgICAgICAgICAgICAgICAgbmV4dC5kb25lID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV4dDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIG5leHQudmFsdWUgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICAgIG5leHQuZG9uZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHJldHVybiBuZXh0OwogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgcmV0dXJuIG5leHQubmV4dCA9IG5leHQ7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBuZXh0OiBkb25lUmVzdWx0CiAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgZXhwb3J0cy52YWx1ZXMgPSB2YWx1ZXM7CgogICAgICAgIGZ1bmN0aW9uIGRvbmVSZXN1bHQoKSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICB2YWx1ZTogdW5kZWZpbmVkLAogICAgICAgICAgICBkb25lOiB0cnVlCiAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgQ29udGV4dC5wcm90b3R5cGUgPSB7CiAgICAgICAgICBjb25zdHJ1Y3RvcjogQ29udGV4dCwKICAgICAgICAgIHJlc2V0OiBmdW5jdGlvbiByZXNldChza2lwVGVtcFJlc2V0KSB7CiAgICAgICAgICAgIHRoaXMucHJldiA9IDA7CiAgICAgICAgICAgIHRoaXMubmV4dCA9IDA7CiAgICAgICAgICAgIHRoaXMuc2VudCA9IHRoaXMuX3NlbnQgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgIHRoaXMuZG9uZSA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmRlbGVnYXRlID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5tZXRob2QgPSAibmV4dCI7CiAgICAgICAgICAgIHRoaXMuYXJnID0gdW5kZWZpbmVkOwogICAgICAgICAgICB0aGlzLnRyeUVudHJpZXMuZm9yRWFjaChyZXNldFRyeUVudHJ5KTsKCiAgICAgICAgICAgIGlmICghc2tpcFRlbXBSZXNldCkgewogICAgICAgICAgICAgIGZvciAodmFyIG5hbWUgaW4gdGhpcykgewogICAgICAgICAgICAgICAgaWYgKG5hbWUuY2hhckF0KDApID09PSAidCIgJiYgaGFzT3duLmNhbGwodGhpcywgbmFtZSkgJiYgIWlzTmFOKCtuYW1lLnNsaWNlKDEpKSkgewogICAgICAgICAgICAgICAgICB0aGlzW25hbWVdID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgIHN0b3A6IGZ1bmN0aW9uIHN0b3AoKSB7CiAgICAgICAgICAgIHRoaXMuZG9uZSA9IHRydWU7CiAgICAgICAgICAgIHZhciByb290RW50cnkgPSB0aGlzLnRyeUVudHJpZXNbMF07CiAgICAgICAgICAgIHZhciByb290UmVjb3JkID0gcm9vdEVudHJ5LmNvbXBsZXRpb247CgogICAgICAgICAgICBpZiAocm9vdFJlY29yZC50eXBlID09PSAidGhyb3ciKSB7CiAgICAgICAgICAgICAgdGhyb3cgcm9vdFJlY29yZC5hcmc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB0aGlzLnJ2YWw7CiAgICAgICAgICB9LAogICAgICAgICAgZGlzcGF0Y2hFeGNlcHRpb246IGZ1bmN0aW9uIGRpc3BhdGNoRXhjZXB0aW9uKGV4Y2VwdGlvbikgewogICAgICAgICAgICBpZiAodGhpcy5kb25lKSB7CiAgICAgICAgICAgICAgdGhyb3cgZXhjZXB0aW9uOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgY29udGV4dCA9IHRoaXM7CgogICAgICAgICAgICBmdW5jdGlvbiBoYW5kbGUobG9jLCBjYXVnaHQpIHsKICAgICAgICAgICAgICByZWNvcmQudHlwZSA9ICJ0aHJvdyI7CiAgICAgICAgICAgICAgcmVjb3JkLmFyZyA9IGV4Y2VwdGlvbjsKICAgICAgICAgICAgICBjb250ZXh0Lm5leHQgPSBsb2M7CgogICAgICAgICAgICAgIGlmIChjYXVnaHQpIHsKICAgICAgICAgICAgICAgIGNvbnRleHQubWV0aG9kID0gIm5leHQiOwogICAgICAgICAgICAgICAgY29udGV4dC5hcmcgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gISFjYXVnaHQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHsKICAgICAgICAgICAgICB2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV07CiAgICAgICAgICAgICAgdmFyIHJlY29yZCA9IGVudHJ5LmNvbXBsZXRpb247CgogICAgICAgICAgICAgIGlmIChlbnRyeS50cnlMb2MgPT09ICJyb290IikgewogICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZSgiZW5kIik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoZW50cnkudHJ5TG9jIDw9IHRoaXMucHJldikgewogICAgICAgICAgICAgICAgdmFyIGhhc0NhdGNoID0gaGFzT3duLmNhbGwoZW50cnksICJjYXRjaExvYyIpOwogICAgICAgICAgICAgICAgdmFyIGhhc0ZpbmFsbHkgPSBoYXNPd24uY2FsbChlbnRyeSwgImZpbmFsbHlMb2MiKTsKCiAgICAgICAgICAgICAgICBpZiAoaGFzQ2F0Y2ggJiYgaGFzRmluYWxseSkgewogICAgICAgICAgICAgICAgICBpZiAodGhpcy5wcmV2IDwgZW50cnkuY2F0Y2hMb2MpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlKGVudHJ5LmNhdGNoTG9jLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnByZXYgPCBlbnRyeS5maW5hbGx5TG9jKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZShlbnRyeS5maW5hbGx5TG9jKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChoYXNDYXRjaCkgewogICAgICAgICAgICAgICAgICBpZiAodGhpcy5wcmV2IDwgZW50cnkuY2F0Y2hMb2MpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlKGVudHJ5LmNhdGNoTG9jLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChoYXNGaW5hbGx5KSB7CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnByZXYgPCBlbnRyeS5maW5hbGx5TG9jKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZShlbnRyeS5maW5hbGx5TG9jKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJ0cnkgc3RhdGVtZW50IHdpdGhvdXQgY2F0Y2ggb3IgZmluYWxseSIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgIGFicnVwdDogZnVuY3Rpb24gYWJydXB0KHR5cGUsIGFyZykgewogICAgICAgICAgICBmb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7CiAgICAgICAgICAgICAgdmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldOwoKICAgICAgICAgICAgICBpZiAoZW50cnkudHJ5TG9jIDw9IHRoaXMucHJldiAmJiBoYXNPd24uY2FsbChlbnRyeSwgImZpbmFsbHlMb2MiKSAmJiB0aGlzLnByZXYgPCBlbnRyeS5maW5hbGx5TG9jKSB7CiAgICAgICAgICAgICAgICB2YXIgZmluYWxseUVudHJ5ID0gZW50cnk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmaW5hbGx5RW50cnkgJiYgKHR5cGUgPT09ICJicmVhayIgfHwgdHlwZSA9PT0gImNvbnRpbnVlIikgJiYgZmluYWxseUVudHJ5LnRyeUxvYyA8PSBhcmcgJiYgYXJnIDw9IGZpbmFsbHlFbnRyeS5maW5hbGx5TG9jKSB7CiAgICAgICAgICAgICAgZmluYWxseUVudHJ5ID0gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHJlY29yZCA9IGZpbmFsbHlFbnRyeSA/IGZpbmFsbHlFbnRyeS5jb21wbGV0aW9uIDoge307CiAgICAgICAgICAgIHJlY29yZC50eXBlID0gdHlwZTsKICAgICAgICAgICAgcmVjb3JkLmFyZyA9IGFyZzsKCiAgICAgICAgICAgIGlmIChmaW5hbGx5RW50cnkpIHsKICAgICAgICAgICAgICB0aGlzLm1ldGhvZCA9ICJuZXh0IjsKICAgICAgICAgICAgICB0aGlzLm5leHQgPSBmaW5hbGx5RW50cnkuZmluYWxseUxvYzsKICAgICAgICAgICAgICByZXR1cm4gQ29udGludWVTZW50aW5lbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29tcGxldGUocmVjb3JkKTsKICAgICAgICAgIH0sCiAgICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24gY29tcGxldGUocmVjb3JkLCBhZnRlckxvYykgewogICAgICAgICAgICBpZiAocmVjb3JkLnR5cGUgPT09ICJ0aHJvdyIpIHsKICAgICAgICAgICAgICB0aHJvdyByZWNvcmQuYXJnOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocmVjb3JkLnR5cGUgPT09ICJicmVhayIgfHwgcmVjb3JkLnR5cGUgPT09ICJjb250aW51ZSIpIHsKICAgICAgICAgICAgICB0aGlzLm5leHQgPSByZWNvcmQuYXJnOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlY29yZC50eXBlID09PSAicmV0dXJuIikgewogICAgICAgICAgICAgIHRoaXMucnZhbCA9IHRoaXMuYXJnID0gcmVjb3JkLmFyZzsKICAgICAgICAgICAgICB0aGlzLm1ldGhvZCA9ICJyZXR1cm4iOwogICAgICAgICAgICAgIHRoaXMubmV4dCA9ICJlbmQiOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlY29yZC50eXBlID09PSAibm9ybWFsIiAmJiBhZnRlckxvYykgewogICAgICAgICAgICAgIHRoaXMubmV4dCA9IGFmdGVyTG9jOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gQ29udGludWVTZW50aW5lbDsKICAgICAgICAgIH0sCiAgICAgICAgICBmaW5pc2g6IGZ1bmN0aW9uIGZpbmlzaChmaW5hbGx5TG9jKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHsKICAgICAgICAgICAgICB2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV07CgogICAgICAgICAgICAgIGlmIChlbnRyeS5maW5hbGx5TG9jID09PSBmaW5hbGx5TG9jKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNvbXBsZXRlKGVudHJ5LmNvbXBsZXRpb24sIGVudHJ5LmFmdGVyTG9jKTsKICAgICAgICAgICAgICAgIHJlc2V0VHJ5RW50cnkoZW50cnkpOwogICAgICAgICAgICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgImNhdGNoIjogZnVuY3Rpb24gX2NhdGNoKHRyeUxvYykgewogICAgICAgICAgICBmb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7CiAgICAgICAgICAgICAgdmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldOwoKICAgICAgICAgICAgICBpZiAoZW50cnkudHJ5TG9jID09PSB0cnlMb2MpIHsKICAgICAgICAgICAgICAgIHZhciByZWNvcmQgPSBlbnRyeS5jb21wbGV0aW9uOwoKICAgICAgICAgICAgICAgIGlmIChyZWNvcmQudHlwZSA9PT0gInRocm93IikgewogICAgICAgICAgICAgICAgICB2YXIgdGhyb3duID0gcmVjb3JkLmFyZzsKICAgICAgICAgICAgICAgICAgcmVzZXRUcnlFbnRyeShlbnRyeSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIHRocm93bjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiaWxsZWdhbCBjYXRjaCBhdHRlbXB0Iik7CiAgICAgICAgICB9LAogICAgICAgICAgZGVsZWdhdGVZaWVsZDogZnVuY3Rpb24gZGVsZWdhdGVZaWVsZChpdGVyYWJsZSwgcmVzdWx0TmFtZSwgbmV4dExvYykgewogICAgICAgICAgICB0aGlzLmRlbGVnYXRlID0gewogICAgICAgICAgICAgIGl0ZXJhdG9yOiB2YWx1ZXMoaXRlcmFibGUpLAogICAgICAgICAgICAgIHJlc3VsdE5hbWU6IHJlc3VsdE5hbWUsCiAgICAgICAgICAgICAgbmV4dExvYzogbmV4dExvYwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgaWYgKHRoaXMubWV0aG9kID09PSAibmV4dCIpIHsKICAgICAgICAgICAgICB0aGlzLmFyZyA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gZXhwb3J0czsKICAgICAgfSgoZmFsc2UgPyB1bmRlZmluZWQgOiBfdHlwZW9mKG1vZHVsZSkpID09PSAib2JqZWN0IiA/IG1vZHVsZS5leHBvcnRzIDoge30pOwoKICAgICAgdHJ5IHsKICAgICAgICByZWdlbmVyYXRvclJ1bnRpbWUgPSBydW50aW1lOwogICAgICB9IGNhdGNoIChhY2NpZGVudGFsU3RyaWN0TW9kZSkgewogICAgICAgIEZ1bmN0aW9uKCJyIiwgInJlZ2VuZXJhdG9yUnVudGltZSA9IHIiKShydW50aW1lKTsKICAgICAgfQogICAgICAvKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi99KS5jYWxsKHRoaXMsIF9fd19wZGZqc19yZXF1aXJlX18oNCkobW9kdWxlKSk7CgogICAgLyoqKi99KSwgKAogIC8qIDQgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgoKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKG1vZHVsZSkgewogICAgICBpZiAoIW1vZHVsZS53ZWJwYWNrUG9seWZpbGwpIHsKICAgICAgICBtb2R1bGUuZGVwcmVjYXRlID0gZnVuY3Rpb24gKCkge307CgogICAgICAgIG1vZHVsZS5wYXRocyA9IFtdOwogICAgICAgIGlmICghbW9kdWxlLmNoaWxkcmVuKSBtb2R1bGUuY2hpbGRyZW4gPSBbXTsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobW9kdWxlLCAibG9hZGVkIiwgewogICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gbW9kdWxlLmw7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG1vZHVsZSwgImlkIiwgewogICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gbW9kdWxlLmk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgbW9kdWxlLndlYnBhY2tQb2x5ZmlsbCA9IDE7CiAgICAgIH0KCiAgICAgIHJldHVybiBtb2R1bGU7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiA1ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgIHZhbHVlOiB0cnVlCiAgICB9KTsKICAgIGV4cG9ydHMuYXJyYXlCeXRlTGVuZ3RoID0gYXJyYXlCeXRlTGVuZ3RoOwogICAgZXhwb3J0cy5hcnJheXNUb0J5dGVzID0gYXJyYXlzVG9CeXRlczsKICAgIGV4cG9ydHMuYXNzZXJ0ID0gYXNzZXJ0OwogICAgZXhwb3J0cy5ieXRlc1RvU3RyaW5nID0gYnl0ZXNUb1N0cmluZzsKICAgIGV4cG9ydHMuY3JlYXRlUHJvbWlzZUNhcGFiaWxpdHkgPSBjcmVhdGVQcm9taXNlQ2FwYWJpbGl0eTsKICAgIGV4cG9ydHMuZ2V0VmVyYm9zaXR5TGV2ZWwgPSBnZXRWZXJib3NpdHlMZXZlbDsKICAgIGV4cG9ydHMuaW5mbyA9IGluZm87CiAgICBleHBvcnRzLmlzQXJyYXlCdWZmZXIgPSBpc0FycmF5QnVmZmVyOwogICAgZXhwb3J0cy5pc0FycmF5RXF1YWwgPSBpc0FycmF5RXF1YWw7CiAgICBleHBvcnRzLmlzQm9vbCA9IGlzQm9vbDsKICAgIGV4cG9ydHMuaXNFbXB0eU9iaiA9IGlzRW1wdHlPYmo7CiAgICBleHBvcnRzLmlzTnVtID0gaXNOdW07CiAgICBleHBvcnRzLmlzU3RyaW5nID0gaXNTdHJpbmc7CiAgICBleHBvcnRzLmlzU2FtZU9yaWdpbiA9IGlzU2FtZU9yaWdpbjsKICAgIGV4cG9ydHMuY3JlYXRlVmFsaWRBYnNvbHV0ZVVybCA9IGNyZWF0ZVZhbGlkQWJzb2x1dGVVcmw7CiAgICBleHBvcnRzLnJlbW92ZU51bGxDaGFyYWN0ZXJzID0gcmVtb3ZlTnVsbENoYXJhY3RlcnM7CiAgICBleHBvcnRzLnNldFZlcmJvc2l0eUxldmVsID0gc2V0VmVyYm9zaXR5TGV2ZWw7CiAgICBleHBvcnRzLnNoYWRvdyA9IHNoYWRvdzsKICAgIGV4cG9ydHMuc3RyaW5nMzIgPSBzdHJpbmczMjsKICAgIGV4cG9ydHMuc3RyaW5nVG9CeXRlcyA9IHN0cmluZ1RvQnl0ZXM7CiAgICBleHBvcnRzLnN0cmluZ1RvUERGU3RyaW5nID0gc3RyaW5nVG9QREZTdHJpbmc7CiAgICBleHBvcnRzLnN0cmluZ1RvVVRGOFN0cmluZyA9IHN0cmluZ1RvVVRGOFN0cmluZzsKICAgIGV4cG9ydHMudXRmOFN0cmluZ1RvU3RyaW5nID0gdXRmOFN0cmluZ1RvU3RyaW5nOwogICAgZXhwb3J0cy53YXJuID0gd2FybjsKICAgIGV4cG9ydHMudW5yZWFjaGFibGUgPSB1bnJlYWNoYWJsZTsKICAgIGV4cG9ydHMuSXNFdmFsU3VwcG9ydGVkQ2FjaGVkID0gZXhwb3J0cy5Jc0xpdHRsZUVuZGlhbkNhY2hlZCA9IGV4cG9ydHMuY3JlYXRlT2JqZWN0VVJMID0gZXhwb3J0cy5Gb3JtYXRFcnJvciA9IGV4cG9ydHMuVXRpbCA9IGV4cG9ydHMuVW5rbm93bkVycm9yRXhjZXB0aW9uID0gZXhwb3J0cy5VbmV4cGVjdGVkUmVzcG9uc2VFeGNlcHRpb24gPSBleHBvcnRzLlRleHRSZW5kZXJpbmdNb2RlID0gZXhwb3J0cy5TdHJlYW1UeXBlID0gZXhwb3J0cy5QZXJtaXNzaW9uRmxhZyA9IGV4cG9ydHMuUGFzc3dvcmRSZXNwb25zZXMgPSBleHBvcnRzLlBhc3N3b3JkRXhjZXB0aW9uID0gZXhwb3J0cy5OYXRpdmVJbWFnZURlY29kaW5nID0gZXhwb3J0cy5NaXNzaW5nUERGRXhjZXB0aW9uID0gZXhwb3J0cy5JbnZhbGlkUERGRXhjZXB0aW9uID0gZXhwb3J0cy5BYm9ydEV4Y2VwdGlvbiA9IGV4cG9ydHMuQ01hcENvbXByZXNzaW9uVHlwZSA9IGV4cG9ydHMuSW1hZ2VLaW5kID0gZXhwb3J0cy5Gb250VHlwZSA9IGV4cG9ydHMuQW5ub3RhdGlvblR5cGUgPSBleHBvcnRzLkFubm90YXRpb25TdGF0ZU1vZGVsVHlwZSA9IGV4cG9ydHMuQW5ub3RhdGlvblJldmlld1N0YXRlID0gZXhwb3J0cy5Bbm5vdGF0aW9uUmVwbHlUeXBlID0gZXhwb3J0cy5Bbm5vdGF0aW9uTWFya2VkU3RhdGUgPSBleHBvcnRzLkFubm90YXRpb25GbGFnID0gZXhwb3J0cy5Bbm5vdGF0aW9uRmllbGRGbGFnID0gZXhwb3J0cy5Bbm5vdGF0aW9uQm9yZGVyU3R5bGVUeXBlID0gZXhwb3J0cy5VTlNVUFBPUlRFRF9GRUFUVVJFUyA9IGV4cG9ydHMuVmVyYm9zaXR5TGV2ZWwgPSBleHBvcnRzLk9QUyA9IGV4cG9ydHMuSURFTlRJVFlfTUFUUklYID0gZXhwb3J0cy5GT05UX0lERU5USVRZX01BVFJJWCA9IGV4cG9ydHMuQmFzZUV4Y2VwdGlvbiA9IHZvaWQgMDsKCiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDYpOwoKICAgIGZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHtmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7dmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTtkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7ZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlO2lmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlO09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTt9fQoKICAgIGZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHtpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTtpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7cmV0dXJuIENvbnN0cnVjdG9yO30KCiAgICBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyJAYmFiZWwvaGVscGVycyAtIHR5cGVvZiI7aWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIpIHtfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHtyZXR1cm4gdHlwZW9mIG9iajt9O30gZWxzZSB7X3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7cmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajt9O31yZXR1cm4gX3R5cGVvZihvYmopO30KCiAgICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7aWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTt9fQoKICAgIGZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHtpZiAoY2FsbCAmJiAoX3R5cGVvZihjYWxsKSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7cmV0dXJuIGNhbGw7fXJldHVybiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpO30KCiAgICBmdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHtpZiAoc2VsZiA9PT0gdm9pZCAwKSB7dGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTt9cmV0dXJuIHNlbGY7fQoKICAgIGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7X2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHtyZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pO307cmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTt9CgogICAgZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7aWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpO31zdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7aWYgKHN1cGVyQ2xhc3MpIF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7fQoKICAgIGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7X3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7by5fX3Byb3RvX18gPSBwO3JldHVybiBvO307cmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTt9CgogICAgdmFyIElERU5USVRZX01BVFJJWCA9IFsxLCAwLCAwLCAxLCAwLCAwXTsKICAgIGV4cG9ydHMuSURFTlRJVFlfTUFUUklYID0gSURFTlRJVFlfTUFUUklYOwogICAgdmFyIEZPTlRfSURFTlRJVFlfTUFUUklYID0gWzAuMDAxLCAwLCAwLCAwLjAwMSwgMCwgMF07CiAgICBleHBvcnRzLkZPTlRfSURFTlRJVFlfTUFUUklYID0gRk9OVF9JREVOVElUWV9NQVRSSVg7CiAgICB2YXIgTmF0aXZlSW1hZ2VEZWNvZGluZyA9IHsKICAgICAgTk9ORTogIm5vbmUiLAogICAgICBERUNPREU6ICJkZWNvZGUiLAogICAgICBESVNQTEFZOiAiZGlzcGxheSIKICAgIH07CiAgICBleHBvcnRzLk5hdGl2ZUltYWdlRGVjb2RpbmcgPSBOYXRpdmVJbWFnZURlY29kaW5nOwogICAgdmFyIFBlcm1pc3Npb25GbGFnID0gewogICAgICBQUklOVDogMHgwNCwKICAgICAgTU9ESUZZX0NPTlRFTlRTOiAweDA4LAogICAgICBDT1BZOiAweDEwLAogICAgICBNT0RJRllfQU5OT1RBVElPTlM6IDB4MjAsCiAgICAgIEZJTExfSU5URVJBQ1RJVkVfRk9STVM6IDB4MTAwLAogICAgICBDT1BZX0ZPUl9BQ0NFU1NJQklMSVRZOiAweDIwMCwKICAgICAgQVNTRU1CTEU6IDB4NDAwLAogICAgICBQUklOVF9ISUdIX1FVQUxJVFk6IDB4ODAwCiAgICB9OwogICAgZXhwb3J0cy5QZXJtaXNzaW9uRmxhZyA9IFBlcm1pc3Npb25GbGFnOwogICAgdmFyIFRleHRSZW5kZXJpbmdNb2RlID0gewogICAgICBGSUxMOiAwLAogICAgICBTVFJPS0U6IDEsCiAgICAgIEZJTExfU1RST0tFOiAyLAogICAgICBJTlZJU0lCTEU6IDMsCiAgICAgIEZJTExfQUREX1RPX1BBVEg6IDQsCiAgICAgIFNUUk9LRV9BRERfVE9fUEFUSDogNSwKICAgICAgRklMTF9TVFJPS0VfQUREX1RPX1BBVEg6IDYsCiAgICAgIEFERF9UT19QQVRIOiA3LAogICAgICBGSUxMX1NUUk9LRV9NQVNLOiAzLAogICAgICBBRERfVE9fUEFUSF9GTEFHOiA0CiAgICB9OwogICAgZXhwb3J0cy5UZXh0UmVuZGVyaW5nTW9kZSA9IFRleHRSZW5kZXJpbmdNb2RlOwogICAgdmFyIEltYWdlS2luZCA9IHsKICAgICAgR1JBWVNDQUxFXzFCUFA6IDEsCiAgICAgIFJHQl8yNEJQUDogMiwKICAgICAgUkdCQV8zMkJQUDogMwogICAgfTsKICAgIGV4cG9ydHMuSW1hZ2VLaW5kID0gSW1hZ2VLaW5kOwogICAgdmFyIEFubm90YXRpb25UeXBlID0gewogICAgICBURVhUOiAxLAogICAgICBMSU5LOiAyLAogICAgICBGUkVFVEVYVDogMywKICAgICAgTElORTogNCwKICAgICAgU1FVQVJFOiA1LAogICAgICBDSVJDTEU6IDYsCiAgICAgIFBPTFlHT046IDcsCiAgICAgIFBPTFlMSU5FOiA4LAogICAgICBISUdITElHSFQ6IDksCiAgICAgIFVOREVSTElORTogMTAsCiAgICAgIFNRVUlHR0xZOiAxMSwKICAgICAgU1RSSUtFT1VUOiAxMiwKICAgICAgU1RBTVA6IDEzLAogICAgICBDQVJFVDogMTQsCiAgICAgIElOSzogMTUsCiAgICAgIFBPUFVQOiAxNiwKICAgICAgRklMRUFUVEFDSE1FTlQ6IDE3LAogICAgICBTT1VORDogMTgsCiAgICAgIE1PVklFOiAxOSwKICAgICAgV0lER0VUOiAyMCwKICAgICAgU0NSRUVOOiAyMSwKICAgICAgUFJJTlRFUk1BUks6IDIyLAogICAgICBUUkFQTkVUOiAyMywKICAgICAgV0FURVJNQVJLOiAyNCwKICAgICAgVEhSRUVEOiAyNSwKICAgICAgUkVEQUNUOiAyNgogICAgfTsKICAgIGV4cG9ydHMuQW5ub3RhdGlvblR5cGUgPSBBbm5vdGF0aW9uVHlwZTsKICAgIHZhciBBbm5vdGF0aW9uU3RhdGVNb2RlbFR5cGUgPSB7CiAgICAgIE1BUktFRDogIk1hcmtlZCIsCiAgICAgIFJFVklFVzogIlJldmlldyIKICAgIH07CiAgICBleHBvcnRzLkFubm90YXRpb25TdGF0ZU1vZGVsVHlwZSA9IEFubm90YXRpb25TdGF0ZU1vZGVsVHlwZTsKICAgIHZhciBBbm5vdGF0aW9uTWFya2VkU3RhdGUgPSB7CiAgICAgIE1BUktFRDogIk1hcmtlZCIsCiAgICAgIFVOTUFSS0VEOiAiVW5tYXJrZWQiCiAgICB9OwogICAgZXhwb3J0cy5Bbm5vdGF0aW9uTWFya2VkU3RhdGUgPSBBbm5vdGF0aW9uTWFya2VkU3RhdGU7CiAgICB2YXIgQW5ub3RhdGlvblJldmlld1N0YXRlID0gewogICAgICBBQ0NFUFRFRDogIkFjY2VwdGVkIiwKICAgICAgUkVKRUNURUQ6ICJSZWplY3RlZCIsCiAgICAgIENBTkNFTExFRDogIkNhbmNlbGxlZCIsCiAgICAgIENPTVBMRVRFRDogIkNvbXBsZXRlZCIsCiAgICAgIE5PTkU6ICJOb25lIgogICAgfTsKICAgIGV4cG9ydHMuQW5ub3RhdGlvblJldmlld1N0YXRlID0gQW5ub3RhdGlvblJldmlld1N0YXRlOwogICAgdmFyIEFubm90YXRpb25SZXBseVR5cGUgPSB7CiAgICAgIEdST1VQOiAiR3JvdXAiLAogICAgICBSRVBMWTogIlIiCiAgICB9OwogICAgZXhwb3J0cy5Bbm5vdGF0aW9uUmVwbHlUeXBlID0gQW5ub3RhdGlvblJlcGx5VHlwZTsKICAgIHZhciBBbm5vdGF0aW9uRmxhZyA9IHsKICAgICAgSU5WSVNJQkxFOiAweDAxLAogICAgICBISURERU46IDB4MDIsCiAgICAgIFBSSU5UOiAweDA0LAogICAgICBOT1pPT006IDB4MDgsCiAgICAgIE5PUk9UQVRFOiAweDEwLAogICAgICBOT1ZJRVc6IDB4MjAsCiAgICAgIFJFQURPTkxZOiAweDQwLAogICAgICBMT0NLRUQ6IDB4ODAsCiAgICAgIFRPR0dMRU5PVklFVzogMHgxMDAsCiAgICAgIExPQ0tFRENPTlRFTlRTOiAweDIwMAogICAgfTsKICAgIGV4cG9ydHMuQW5ub3RhdGlvbkZsYWcgPSBBbm5vdGF0aW9uRmxhZzsKICAgIHZhciBBbm5vdGF0aW9uRmllbGRGbGFnID0gewogICAgICBSRUFET05MWTogMHgwMDAwMDAxLAogICAgICBSRVFVSVJFRDogMHgwMDAwMDAyLAogICAgICBOT0VYUE9SVDogMHgwMDAwMDA0LAogICAgICBNVUxUSUxJTkU6IDB4MDAwMTAwMCwKICAgICAgUEFTU1dPUkQ6IDB4MDAwMjAwMCwKICAgICAgTk9UT0dHTEVUT09GRjogMHgwMDA0MDAwLAogICAgICBSQURJTzogMHgwMDA4MDAwLAogICAgICBQVVNIQlVUVE9OOiAweDAwMTAwMDAsCiAgICAgIENPTUJPOiAweDAwMjAwMDAsCiAgICAgIEVESVQ6IDB4MDA0MDAwMCwKICAgICAgU09SVDogMHgwMDgwMDAwLAogICAgICBGSUxFU0VMRUNUOiAweDAxMDAwMDAsCiAgICAgIE1VTFRJU0VMRUNUOiAweDAyMDAwMDAsCiAgICAgIERPTk9UU1BFTExDSEVDSzogMHgwNDAwMDAwLAogICAgICBET05PVFNDUk9MTDogMHgwODAwMDAwLAogICAgICBDT01COiAweDEwMDAwMDAsCiAgICAgIFJJQ0hURVhUOiAweDIwMDAwMDAsCiAgICAgIFJBRElPU0lOVU5JU09OOiAweDIwMDAwMDAsCiAgICAgIENPTU1JVE9OU0VMQ0hBTkdFOiAweDQwMDAwMDAKICAgIH07CiAgICBleHBvcnRzLkFubm90YXRpb25GaWVsZEZsYWcgPSBBbm5vdGF0aW9uRmllbGRGbGFnOwogICAgdmFyIEFubm90YXRpb25Cb3JkZXJTdHlsZVR5cGUgPSB7CiAgICAgIFNPTElEOiAxLAogICAgICBEQVNIRUQ6IDIsCiAgICAgIEJFVkVMRUQ6IDMsCiAgICAgIElOU0VUOiA0LAogICAgICBVTkRFUkxJTkU6IDUKICAgIH07CiAgICBleHBvcnRzLkFubm90YXRpb25Cb3JkZXJTdHlsZVR5cGUgPSBBbm5vdGF0aW9uQm9yZGVyU3R5bGVUeXBlOwogICAgdmFyIFN0cmVhbVR5cGUgPSB7CiAgICAgIFVOS05PV046ICJVTktOT1dOIiwKICAgICAgRkxBVEU6ICJGTEFURSIsCiAgICAgIExaVzogIkxaVyIsCiAgICAgIERDVDogIkRDVCIsCiAgICAgIEpQWDogIkpQWCIsCiAgICAgIEpCSUc6ICJKQklHIiwKICAgICAgQTg1OiAiQTg1IiwKICAgICAgQUhYOiAiQUhYIiwKICAgICAgQ0NGOiAiQ0NGIiwKICAgICAgUkxYOiAiUkxYIgogICAgfTsKICAgIGV4cG9ydHMuU3RyZWFtVHlwZSA9IFN0cmVhbVR5cGU7CiAgICB2YXIgRm9udFR5cGUgPSB7CiAgICAgIFVOS05PV046ICJVTktOT1dOIiwKICAgICAgVFlQRTE6ICJUWVBFMSIsCiAgICAgIFRZUEUxQzogIlRZUEUxQyIsCiAgICAgIENJREZPTlRUWVBFMDogIkNJREZPTlRUWVBFMCIsCiAgICAgIENJREZPTlRUWVBFMEM6ICJDSURGT05UVFlQRTBDIiwKICAgICAgVFJVRVRZUEU6ICJUUlVFVFlQRSIsCiAgICAgIENJREZPTlRUWVBFMjogIkNJREZPTlRUWVBFMiIsCiAgICAgIFRZUEUzOiAiVFlQRTMiLAogICAgICBPUEVOVFlQRTogIk9QRU5UWVBFIiwKICAgICAgVFlQRTA6ICJUWVBFMCIsCiAgICAgIE1NVFlQRTE6ICJNTVRZUEUxIgogICAgfTsKICAgIGV4cG9ydHMuRm9udFR5cGUgPSBGb250VHlwZTsKICAgIHZhciBWZXJib3NpdHlMZXZlbCA9IHsKICAgICAgRVJST1JTOiAwLAogICAgICBXQVJOSU5HUzogMSwKICAgICAgSU5GT1M6IDUKICAgIH07CiAgICBleHBvcnRzLlZlcmJvc2l0eUxldmVsID0gVmVyYm9zaXR5TGV2ZWw7CiAgICB2YXIgQ01hcENvbXByZXNzaW9uVHlwZSA9IHsKICAgICAgTk9ORTogMCwKICAgICAgQklOQVJZOiAxLAogICAgICBTVFJFQU06IDIKICAgIH07CiAgICBleHBvcnRzLkNNYXBDb21wcmVzc2lvblR5cGUgPSBDTWFwQ29tcHJlc3Npb25UeXBlOwogICAgdmFyIE9QUyA9IHsKICAgICAgZGVwZW5kZW5jeTogMSwKICAgICAgc2V0TGluZVdpZHRoOiAyLAogICAgICBzZXRMaW5lQ2FwOiAzLAogICAgICBzZXRMaW5lSm9pbjogNCwKICAgICAgc2V0TWl0ZXJMaW1pdDogNSwKICAgICAgc2V0RGFzaDogNiwKICAgICAgc2V0UmVuZGVyaW5nSW50ZW50OiA3LAogICAgICBzZXRGbGF0bmVzczogOCwKICAgICAgc2V0R1N0YXRlOiA5LAogICAgICBzYXZlOiAxMCwKICAgICAgcmVzdG9yZTogMTEsCiAgICAgIHRyYW5zZm9ybTogMTIsCiAgICAgIG1vdmVUbzogMTMsCiAgICAgIGxpbmVUbzogMTQsCiAgICAgIGN1cnZlVG86IDE1LAogICAgICBjdXJ2ZVRvMjogMTYsCiAgICAgIGN1cnZlVG8zOiAxNywKICAgICAgY2xvc2VQYXRoOiAxOCwKICAgICAgcmVjdGFuZ2xlOiAxOSwKICAgICAgc3Ryb2tlOiAyMCwKICAgICAgY2xvc2VTdHJva2U6IDIxLAogICAgICBmaWxsOiAyMiwKICAgICAgZW9GaWxsOiAyMywKICAgICAgZmlsbFN0cm9rZTogMjQsCiAgICAgIGVvRmlsbFN0cm9rZTogMjUsCiAgICAgIGNsb3NlRmlsbFN0cm9rZTogMjYsCiAgICAgIGNsb3NlRU9GaWxsU3Ryb2tlOiAyNywKICAgICAgZW5kUGF0aDogMjgsCiAgICAgIGNsaXA6IDI5LAogICAgICBlb0NsaXA6IDMwLAogICAgICBiZWdpblRleHQ6IDMxLAogICAgICBlbmRUZXh0OiAzMiwKICAgICAgc2V0Q2hhclNwYWNpbmc6IDMzLAogICAgICBzZXRXb3JkU3BhY2luZzogMzQsCiAgICAgIHNldEhTY2FsZTogMzUsCiAgICAgIHNldExlYWRpbmc6IDM2LAogICAgICBzZXRGb250OiAzNywKICAgICAgc2V0VGV4dFJlbmRlcmluZ01vZGU6IDM4LAogICAgICBzZXRUZXh0UmlzZTogMzksCiAgICAgIG1vdmVUZXh0OiA0MCwKICAgICAgc2V0TGVhZGluZ01vdmVUZXh0OiA0MSwKICAgICAgc2V0VGV4dE1hdHJpeDogNDIsCiAgICAgIG5leHRMaW5lOiA0MywKICAgICAgc2hvd1RleHQ6IDQ0LAogICAgICBzaG93U3BhY2VkVGV4dDogNDUsCiAgICAgIG5leHRMaW5lU2hvd1RleHQ6IDQ2LAogICAgICBuZXh0TGluZVNldFNwYWNpbmdTaG93VGV4dDogNDcsCiAgICAgIHNldENoYXJXaWR0aDogNDgsCiAgICAgIHNldENoYXJXaWR0aEFuZEJvdW5kczogNDksCiAgICAgIHNldFN0cm9rZUNvbG9yU3BhY2U6IDUwLAogICAgICBzZXRGaWxsQ29sb3JTcGFjZTogNTEsCiAgICAgIHNldFN0cm9rZUNvbG9yOiA1MiwKICAgICAgc2V0U3Ryb2tlQ29sb3JOOiA1MywKICAgICAgc2V0RmlsbENvbG9yOiA1NCwKICAgICAgc2V0RmlsbENvbG9yTjogNTUsCiAgICAgIHNldFN0cm9rZUdyYXk6IDU2LAogICAgICBzZXRGaWxsR3JheTogNTcsCiAgICAgIHNldFN0cm9rZVJHQkNvbG9yOiA1OCwKICAgICAgc2V0RmlsbFJHQkNvbG9yOiA1OSwKICAgICAgc2V0U3Ryb2tlQ01ZS0NvbG9yOiA2MCwKICAgICAgc2V0RmlsbENNWUtDb2xvcjogNjEsCiAgICAgIHNoYWRpbmdGaWxsOiA2MiwKICAgICAgYmVnaW5JbmxpbmVJbWFnZTogNjMsCiAgICAgIGJlZ2luSW1hZ2VEYXRhOiA2NCwKICAgICAgZW5kSW5saW5lSW1hZ2U6IDY1LAogICAgICBwYWludFhPYmplY3Q6IDY2LAogICAgICBtYXJrUG9pbnQ6IDY3LAogICAgICBtYXJrUG9pbnRQcm9wczogNjgsCiAgICAgIGJlZ2luTWFya2VkQ29udGVudDogNjksCiAgICAgIGJlZ2luTWFya2VkQ29udGVudFByb3BzOiA3MCwKICAgICAgZW5kTWFya2VkQ29udGVudDogNzEsCiAgICAgIGJlZ2luQ29tcGF0OiA3MiwKICAgICAgZW5kQ29tcGF0OiA3MywKICAgICAgcGFpbnRGb3JtWE9iamVjdEJlZ2luOiA3NCwKICAgICAgcGFpbnRGb3JtWE9iamVjdEVuZDogNzUsCiAgICAgIGJlZ2luR3JvdXA6IDc2LAogICAgICBlbmRHcm91cDogNzcsCiAgICAgIGJlZ2luQW5ub3RhdGlvbnM6IDc4LAogICAgICBlbmRBbm5vdGF0aW9uczogNzksCiAgICAgIGJlZ2luQW5ub3RhdGlvbjogODAsCiAgICAgIGVuZEFubm90YXRpb246IDgxLAogICAgICBwYWludEpwZWdYT2JqZWN0OiA4MiwKICAgICAgcGFpbnRJbWFnZU1hc2tYT2JqZWN0OiA4MywKICAgICAgcGFpbnRJbWFnZU1hc2tYT2JqZWN0R3JvdXA6IDg0LAogICAgICBwYWludEltYWdlWE9iamVjdDogODUsCiAgICAgIHBhaW50SW5saW5lSW1hZ2VYT2JqZWN0OiA4NiwKICAgICAgcGFpbnRJbmxpbmVJbWFnZVhPYmplY3RHcm91cDogODcsCiAgICAgIHBhaW50SW1hZ2VYT2JqZWN0UmVwZWF0OiA4OCwKICAgICAgcGFpbnRJbWFnZU1hc2tYT2JqZWN0UmVwZWF0OiA4OSwKICAgICAgcGFpbnRTb2xpZENvbG9ySW1hZ2VNYXNrOiA5MCwKICAgICAgY29uc3RydWN0UGF0aDogOTEKICAgIH07CiAgICBleHBvcnRzLk9QUyA9IE9QUzsKICAgIHZhciBVTlNVUFBPUlRFRF9GRUFUVVJFUyA9IHsKICAgICAgdW5rbm93bjogInVua25vd24iLAogICAgICBmb3JtczogImZvcm1zIiwKICAgICAgamF2YVNjcmlwdDogImphdmFTY3JpcHQiLAogICAgICBzbWFzazogInNtYXNrIiwKICAgICAgc2hhZGluZ1BhdHRlcm46ICJzaGFkaW5nUGF0dGVybiIsCiAgICAgIGZvbnQ6ICJmb250IgogICAgfTsKICAgIGV4cG9ydHMuVU5TVVBQT1JURURfRkVBVFVSRVMgPSBVTlNVUFBPUlRFRF9GRUFUVVJFUzsKICAgIHZhciBQYXNzd29yZFJlc3BvbnNlcyA9IHsKICAgICAgTkVFRF9QQVNTV09SRDogMSwKICAgICAgSU5DT1JSRUNUX1BBU1NXT1JEOiAyCiAgICB9OwogICAgZXhwb3J0cy5QYXNzd29yZFJlc3BvbnNlcyA9IFBhc3N3b3JkUmVzcG9uc2VzOwogICAgdmFyIHZlcmJvc2l0eSA9IFZlcmJvc2l0eUxldmVsLldBUk5JTkdTOwoKICAgIGZ1bmN0aW9uIHNldFZlcmJvc2l0eUxldmVsKGxldmVsKSB7CiAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKGxldmVsKSkgewogICAgICAgIHZlcmJvc2l0eSA9IGxldmVsOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VmVyYm9zaXR5TGV2ZWwoKSB7CiAgICAgIHJldHVybiB2ZXJib3NpdHk7CiAgICB9CgogICAgZnVuY3Rpb24gaW5mbyhtc2cpIHsKICAgICAgaWYgKHZlcmJvc2l0eSA+PSBWZXJib3NpdHlMZXZlbC5JTkZPUykgewogICAgICAgIGNvbnNvbGUubG9nKCJJbmZvOiAiLmNvbmNhdChtc2cpKTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHdhcm4obXNnKSB7CiAgICAgIGlmICh2ZXJib3NpdHkgPj0gVmVyYm9zaXR5TGV2ZWwuV0FSTklOR1MpIHsKICAgICAgICBjb25zb2xlLmxvZygiV2FybmluZzogIi5jb25jYXQobXNnKSk7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiB1bnJlYWNoYWJsZShtc2cpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKG1zZyk7CiAgICB9CgogICAgZnVuY3Rpb24gYXNzZXJ0KGNvbmQsIG1zZykgewogICAgICBpZiAoIWNvbmQpIHsKICAgICAgICB1bnJlYWNoYWJsZShtc2cpOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gaXNTYW1lT3JpZ2luKGJhc2VVcmwsIG90aGVyVXJsKSB7CiAgICAgIHZhciBiYXNlOwoKICAgICAgdHJ5IHsKICAgICAgICBiYXNlID0gbmV3IFVSTChiYXNlVXJsKTsKCiAgICAgICAgaWYgKCFiYXNlLm9yaWdpbiB8fCBiYXNlLm9yaWdpbiA9PT0gIm51bGwiKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICB2YXIgb3RoZXIgPSBuZXcgVVJMKG90aGVyVXJsLCBiYXNlKTsKICAgICAgcmV0dXJuIGJhc2Uub3JpZ2luID09PSBvdGhlci5vcmlnaW47CiAgICB9CgogICAgZnVuY3Rpb24gX2lzVmFsaWRQcm90b2NvbCh1cmwpIHsKICAgICAgaWYgKCF1cmwpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHN3aXRjaCAodXJsLnByb3RvY29sKSB7CiAgICAgICAgY2FzZSAiaHR0cDoiOgogICAgICAgIGNhc2UgImh0dHBzOiI6CiAgICAgICAgY2FzZSAiZnRwOiI6CiAgICAgICAgY2FzZSAibWFpbHRvOiI6CiAgICAgICAgY2FzZSAidGVsOiI6CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGNyZWF0ZVZhbGlkQWJzb2x1dGVVcmwodXJsLCBiYXNlVXJsKSB7CiAgICAgIGlmICghdXJsKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIHRyeSB7CiAgICAgICAgdmFyIGFic29sdXRlVXJsID0gYmFzZVVybCA/IG5ldyBVUkwodXJsLCBiYXNlVXJsKSA6IG5ldyBVUkwodXJsKTsKCiAgICAgICAgaWYgKF9pc1ZhbGlkUHJvdG9jb2woYWJzb2x1dGVVcmwpKSB7CiAgICAgICAgICByZXR1cm4gYWJzb2x1dGVVcmw7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChleCkge30KCiAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIGZ1bmN0aW9uIHNoYWRvdyhvYmosIHByb3AsIHZhbHVlKSB7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIHByb3AsIHsKICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgd3JpdGFibGU6IGZhbHNlCiAgICAgIH0pOwogICAgICByZXR1cm4gdmFsdWU7CiAgICB9CgogICAgdmFyIEJhc2VFeGNlcHRpb24gPSBmdW5jdGlvbiBCYXNlRXhjZXB0aW9uQ2xvc3VyZSgpIHsKICAgICAgZnVuY3Rpb24gQmFzZUV4Y2VwdGlvbihtZXNzYWdlKSB7CiAgICAgICAgaWYgKHRoaXMuY29uc3RydWN0b3IgPT09IEJhc2VFeGNlcHRpb24pIHsKICAgICAgICAgIHVucmVhY2hhYmxlKCJDYW5ub3QgaW5pdGlhbGl6ZSBCYXNlRXhjZXB0aW9uLiIpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5tZXNzYWdlID0gbWVzc2FnZTsKICAgICAgICB0aGlzLm5hbWUgPSB0aGlzLmNvbnN0cnVjdG9yLm5hbWU7CiAgICAgIH0KCiAgICAgIEJhc2VFeGNlcHRpb24ucHJvdG90eXBlID0gbmV3IEVycm9yKCk7CiAgICAgIEJhc2VFeGNlcHRpb24uY29uc3RydWN0b3IgPSBCYXNlRXhjZXB0aW9uOwogICAgICByZXR1cm4gQmFzZUV4Y2VwdGlvbjsKICAgIH0oKTsKCiAgICBleHBvcnRzLkJhc2VFeGNlcHRpb24gPSBCYXNlRXhjZXB0aW9uOwoKICAgIHZhciBQYXNzd29yZEV4Y2VwdGlvbiA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0Jhc2VFeGNlcHRpb24pIHsKICAgICAgX2luaGVyaXRzKFBhc3N3b3JkRXhjZXB0aW9uLCBfQmFzZUV4Y2VwdGlvbik7CgogICAgICBmdW5jdGlvbiBQYXNzd29yZEV4Y2VwdGlvbihtc2csIGNvZGUpIHsKICAgICAgICB2YXIgX3RoaXM7CgogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBQYXNzd29yZEV4Y2VwdGlvbik7CgogICAgICAgIF90aGlzID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKFBhc3N3b3JkRXhjZXB0aW9uKS5jYWxsKHRoaXMsIG1zZykpOwogICAgICAgIF90aGlzLmNvZGUgPSBjb2RlOwogICAgICAgIHJldHVybiBfdGhpczsKICAgICAgfQoKICAgICAgcmV0dXJuIFBhc3N3b3JkRXhjZXB0aW9uOwogICAgfShCYXNlRXhjZXB0aW9uKTsKCiAgICBleHBvcnRzLlBhc3N3b3JkRXhjZXB0aW9uID0gUGFzc3dvcmRFeGNlcHRpb247CgogICAgdmFyIFVua25vd25FcnJvckV4Y2VwdGlvbiA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0Jhc2VFeGNlcHRpb24yKSB7CiAgICAgIF9pbmhlcml0cyhVbmtub3duRXJyb3JFeGNlcHRpb24sIF9CYXNlRXhjZXB0aW9uMik7CgogICAgICBmdW5jdGlvbiBVbmtub3duRXJyb3JFeGNlcHRpb24obXNnLCBkZXRhaWxzKSB7CiAgICAgICAgdmFyIF90aGlzMjsKCiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFVua25vd25FcnJvckV4Y2VwdGlvbik7CgogICAgICAgIF90aGlzMiA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihVbmtub3duRXJyb3JFeGNlcHRpb24pLmNhbGwodGhpcywgbXNnKSk7CiAgICAgICAgX3RoaXMyLmRldGFpbHMgPSBkZXRhaWxzOwogICAgICAgIHJldHVybiBfdGhpczI7CiAgICAgIH0KCiAgICAgIHJldHVybiBVbmtub3duRXJyb3JFeGNlcHRpb247CiAgICB9KEJhc2VFeGNlcHRpb24pOwoKICAgIGV4cG9ydHMuVW5rbm93bkVycm9yRXhjZXB0aW9uID0gVW5rbm93bkVycm9yRXhjZXB0aW9uOwoKICAgIHZhciBJbnZhbGlkUERGRXhjZXB0aW9uID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQmFzZUV4Y2VwdGlvbjMpIHsKICAgICAgX2luaGVyaXRzKEludmFsaWRQREZFeGNlcHRpb24sIF9CYXNlRXhjZXB0aW9uMyk7CgogICAgICBmdW5jdGlvbiBJbnZhbGlkUERGRXhjZXB0aW9uKCkgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBJbnZhbGlkUERGRXhjZXB0aW9uKTsKCiAgICAgICAgcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihJbnZhbGlkUERGRXhjZXB0aW9uKS5hcHBseSh0aGlzLCBhcmd1bWVudHMpKTsKICAgICAgfQoKICAgICAgcmV0dXJuIEludmFsaWRQREZFeGNlcHRpb247CiAgICB9KEJhc2VFeGNlcHRpb24pOwoKICAgIGV4cG9ydHMuSW52YWxpZFBERkV4Y2VwdGlvbiA9IEludmFsaWRQREZFeGNlcHRpb247CgogICAgdmFyIE1pc3NpbmdQREZFeGNlcHRpb24gPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9CYXNlRXhjZXB0aW9uNCkgewogICAgICBfaW5oZXJpdHMoTWlzc2luZ1BERkV4Y2VwdGlvbiwgX0Jhc2VFeGNlcHRpb240KTsKCiAgICAgIGZ1bmN0aW9uIE1pc3NpbmdQREZFeGNlcHRpb24oKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIE1pc3NpbmdQREZFeGNlcHRpb24pOwoKICAgICAgICByZXR1cm4gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKE1pc3NpbmdQREZFeGNlcHRpb24pLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpOwogICAgICB9CgogICAgICByZXR1cm4gTWlzc2luZ1BERkV4Y2VwdGlvbjsKICAgIH0oQmFzZUV4Y2VwdGlvbik7CgogICAgZXhwb3J0cy5NaXNzaW5nUERGRXhjZXB0aW9uID0gTWlzc2luZ1BERkV4Y2VwdGlvbjsKCiAgICB2YXIgVW5leHBlY3RlZFJlc3BvbnNlRXhjZXB0aW9uID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQmFzZUV4Y2VwdGlvbjUpIHsKICAgICAgX2luaGVyaXRzKFVuZXhwZWN0ZWRSZXNwb25zZUV4Y2VwdGlvbiwgX0Jhc2VFeGNlcHRpb241KTsKCiAgICAgIGZ1bmN0aW9uIFVuZXhwZWN0ZWRSZXNwb25zZUV4Y2VwdGlvbihtc2csIHN0YXR1cykgewogICAgICAgIHZhciBfdGhpczM7CgogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBVbmV4cGVjdGVkUmVzcG9uc2VFeGNlcHRpb24pOwoKICAgICAgICBfdGhpczMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoVW5leHBlY3RlZFJlc3BvbnNlRXhjZXB0aW9uKS5jYWxsKHRoaXMsIG1zZykpOwogICAgICAgIF90aGlzMy5zdGF0dXMgPSBzdGF0dXM7CiAgICAgICAgcmV0dXJuIF90aGlzMzsKICAgICAgfQoKICAgICAgcmV0dXJuIFVuZXhwZWN0ZWRSZXNwb25zZUV4Y2VwdGlvbjsKICAgIH0oQmFzZUV4Y2VwdGlvbik7CgogICAgZXhwb3J0cy5VbmV4cGVjdGVkUmVzcG9uc2VFeGNlcHRpb24gPSBVbmV4cGVjdGVkUmVzcG9uc2VFeGNlcHRpb247CgogICAgdmFyIEZvcm1hdEVycm9yID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQmFzZUV4Y2VwdGlvbjYpIHsKICAgICAgX2luaGVyaXRzKEZvcm1hdEVycm9yLCBfQmFzZUV4Y2VwdGlvbjYpOwoKICAgICAgZnVuY3Rpb24gRm9ybWF0RXJyb3IoKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEZvcm1hdEVycm9yKTsKCiAgICAgICAgcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihGb3JtYXRFcnJvcikuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBGb3JtYXRFcnJvcjsKICAgIH0oQmFzZUV4Y2VwdGlvbik7CgogICAgZXhwb3J0cy5Gb3JtYXRFcnJvciA9IEZvcm1hdEVycm9yOwoKICAgIHZhciBBYm9ydEV4Y2VwdGlvbiA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0Jhc2VFeGNlcHRpb243KSB7CiAgICAgIF9pbmhlcml0cyhBYm9ydEV4Y2VwdGlvbiwgX0Jhc2VFeGNlcHRpb243KTsKCiAgICAgIGZ1bmN0aW9uIEFib3J0RXhjZXB0aW9uKCkgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBBYm9ydEV4Y2VwdGlvbik7CgogICAgICAgIHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoQWJvcnRFeGNlcHRpb24pLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpOwogICAgICB9CgogICAgICByZXR1cm4gQWJvcnRFeGNlcHRpb247CiAgICB9KEJhc2VFeGNlcHRpb24pOwoKICAgIGV4cG9ydHMuQWJvcnRFeGNlcHRpb24gPSBBYm9ydEV4Y2VwdGlvbjsKICAgIHZhciBOdWxsQ2hhcmFjdGVyc1JlZ0V4cCA9IC9ceDAwL2c7CgogICAgZnVuY3Rpb24gcmVtb3ZlTnVsbENoYXJhY3RlcnMoc3RyKSB7CiAgICAgIGlmICh0eXBlb2Ygc3RyICE9PSAic3RyaW5nIikgewogICAgICAgIHdhcm4oIlRoZSBhcmd1bWVudCBmb3IgcmVtb3ZlTnVsbENoYXJhY3RlcnMgbXVzdCBiZSBhIHN0cmluZy4iKTsKICAgICAgICByZXR1cm4gc3RyOwogICAgICB9CgogICAgICByZXR1cm4gc3RyLnJlcGxhY2UoTnVsbENoYXJhY3RlcnNSZWdFeHAsICIiKTsKICAgIH0KCiAgICBmdW5jdGlvbiBieXRlc1RvU3RyaW5nKGJ5dGVzKSB7CiAgICAgIGFzc2VydChieXRlcyAhPT0gbnVsbCAmJiBfdHlwZW9mKGJ5dGVzKSA9PT0gIm9iamVjdCIgJiYgYnl0ZXMubGVuZ3RoICE9PSB1bmRlZmluZWQsICJJbnZhbGlkIGFyZ3VtZW50IGZvciBieXRlc1RvU3RyaW5nIik7CiAgICAgIHZhciBsZW5ndGggPSBieXRlcy5sZW5ndGg7CiAgICAgIHZhciBNQVhfQVJHVU1FTlRfQ09VTlQgPSA4MTkyOwoKICAgICAgaWYgKGxlbmd0aCA8IE1BWF9BUkdVTUVOVF9DT1VOVCkgewogICAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIGJ5dGVzKTsKICAgICAgfQoKICAgICAgdmFyIHN0ckJ1ZiA9IFtdOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkgKz0gTUFYX0FSR1VNRU5UX0NPVU5UKSB7CiAgICAgICAgdmFyIGNodW5rRW5kID0gTWF0aC5taW4oaSArIE1BWF9BUkdVTUVOVF9DT1VOVCwgbGVuZ3RoKTsKICAgICAgICB2YXIgY2h1bmsgPSBieXRlcy5zdWJhcnJheShpLCBjaHVua0VuZCk7CiAgICAgICAgc3RyQnVmLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCBjaHVuaykpOwogICAgICB9CgogICAgICByZXR1cm4gc3RyQnVmLmpvaW4oIiIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0cmluZ1RvQnl0ZXMoc3RyKSB7CiAgICAgIGFzc2VydCh0eXBlb2Ygc3RyID09PSAic3RyaW5nIiwgIkludmFsaWQgYXJndW1lbnQgZm9yIHN0cmluZ1RvQnl0ZXMiKTsKICAgICAgdmFyIGxlbmd0aCA9IHN0ci5sZW5ndGg7CiAgICAgIHZhciBieXRlcyA9IG5ldyBVaW50OEFycmF5KGxlbmd0aCk7CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7CiAgICAgICAgYnl0ZXNbaV0gPSBzdHIuY2hhckNvZGVBdChpKSAmIDB4ZmY7CiAgICAgIH0KCiAgICAgIHJldHVybiBieXRlczsKICAgIH0KCiAgICBmdW5jdGlvbiBhcnJheUJ5dGVMZW5ndGgoYXJyKSB7CiAgICAgIGlmIChhcnIubGVuZ3RoICE9PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gYXJyLmxlbmd0aDsKICAgICAgfQoKICAgICAgYXNzZXJ0KGFyci5ieXRlTGVuZ3RoICE9PSB1bmRlZmluZWQpOwogICAgICByZXR1cm4gYXJyLmJ5dGVMZW5ndGg7CiAgICB9CgogICAgZnVuY3Rpb24gYXJyYXlzVG9CeXRlcyhhcnIpIHsKICAgICAgdmFyIGxlbmd0aCA9IGFyci5sZW5ndGg7CgogICAgICBpZiAobGVuZ3RoID09PSAxICYmIGFyclswXSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpIHsKICAgICAgICByZXR1cm4gYXJyWzBdOwogICAgICB9CgogICAgICB2YXIgcmVzdWx0TGVuZ3RoID0gMDsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICByZXN1bHRMZW5ndGggKz0gYXJyYXlCeXRlTGVuZ3RoKGFycltpXSk7CiAgICAgIH0KCiAgICAgIHZhciBwb3MgPSAwOwogICAgICB2YXIgZGF0YSA9IG5ldyBVaW50OEFycmF5KHJlc3VsdExlbmd0aCk7CgogICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgbGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgdmFyIGl0ZW0gPSBhcnJbX2ldOwoKICAgICAgICBpZiAoIShpdGVtIGluc3RhbmNlb2YgVWludDhBcnJheSkpIHsKICAgICAgICAgIGlmICh0eXBlb2YgaXRlbSA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgaXRlbSA9IHN0cmluZ1RvQnl0ZXMoaXRlbSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpdGVtID0gbmV3IFVpbnQ4QXJyYXkoaXRlbSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YXIgaXRlbUxlbmd0aCA9IGl0ZW0uYnl0ZUxlbmd0aDsKICAgICAgICBkYXRhLnNldChpdGVtLCBwb3MpOwogICAgICAgIHBvcyArPSBpdGVtTGVuZ3RoOwogICAgICB9CgogICAgICByZXR1cm4gZGF0YTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJpbmczMih2YWx1ZSkgewogICAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZSh2YWx1ZSA+PiAyNCAmIDB4ZmYsIHZhbHVlID4+IDE2ICYgMHhmZiwgdmFsdWUgPj4gOCAmIDB4ZmYsIHZhbHVlICYgMHhmZik7CiAgICB9CgogICAgZnVuY3Rpb24gaXNMaXR0bGVFbmRpYW4oKSB7CiAgICAgIHZhciBidWZmZXI4ID0gbmV3IFVpbnQ4QXJyYXkoNCk7CiAgICAgIGJ1ZmZlcjhbMF0gPSAxOwogICAgICB2YXIgdmlldzMyID0gbmV3IFVpbnQzMkFycmF5KGJ1ZmZlcjguYnVmZmVyLCAwLCAxKTsKICAgICAgcmV0dXJuIHZpZXczMlswXSA9PT0gMTsKICAgIH0KCiAgICB2YXIgSXNMaXR0bGVFbmRpYW5DYWNoZWQgPSB7CiAgICAgIGdldCB2YWx1ZSgpIHsKICAgICAgICByZXR1cm4gc2hhZG93KHRoaXMsICJ2YWx1ZSIsIGlzTGl0dGxlRW5kaWFuKCkpOwogICAgICB9CgogICAgfTsKICAgIGV4cG9ydHMuSXNMaXR0bGVFbmRpYW5DYWNoZWQgPSBJc0xpdHRsZUVuZGlhbkNhY2hlZDsKCiAgICBmdW5jdGlvbiBpc0V2YWxTdXBwb3J0ZWQoKSB7CiAgICAgIHRyeSB7CiAgICAgICAgbmV3IEZ1bmN0aW9uKCIiKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQoKICAgIHZhciBJc0V2YWxTdXBwb3J0ZWRDYWNoZWQgPSB7CiAgICAgIGdldCB2YWx1ZSgpIHsKICAgICAgICByZXR1cm4gc2hhZG93KHRoaXMsICJ2YWx1ZSIsIGlzRXZhbFN1cHBvcnRlZCgpKTsKICAgICAgfQoKICAgIH07CiAgICBleHBvcnRzLklzRXZhbFN1cHBvcnRlZENhY2hlZCA9IElzRXZhbFN1cHBvcnRlZENhY2hlZDsKICAgIHZhciByZ2JCdWYgPSBbInJnYigiLCAwLCAiLCIsIDAsICIsIiwgMCwgIikiXTsKCiAgICB2YXIgVXRpbCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgIGZ1bmN0aW9uIFV0aWwoKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFV0aWwpOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoVXRpbCwgbnVsbCwgW3sKICAgICAgICBrZXk6ICJtYWtlQ3NzUmdiIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gbWFrZUNzc1JnYihyLCBnLCBiKSB7CiAgICAgICAgICByZ2JCdWZbMV0gPSByOwogICAgICAgICAgcmdiQnVmWzNdID0gZzsKICAgICAgICAgIHJnYkJ1Zls1XSA9IGI7CiAgICAgICAgICByZXR1cm4gcmdiQnVmLmpvaW4oIiIpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInRyYW5zZm9ybSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHRyYW5zZm9ybShtMSwgbTIpIHsKICAgICAgICAgIHJldHVybiBbbTFbMF0gKiBtMlswXSArIG0xWzJdICogbTJbMV0sIG0xWzFdICogbTJbMF0gKyBtMVszXSAqIG0yWzFdLCBtMVswXSAqIG0yWzJdICsgbTFbMl0gKiBtMlszXSwgbTFbMV0gKiBtMlsyXSArIG0xWzNdICogbTJbM10sIG0xWzBdICogbTJbNF0gKyBtMVsyXSAqIG0yWzVdICsgbTFbNF0sIG0xWzFdICogbTJbNF0gKyBtMVszXSAqIG0yWzVdICsgbTFbNV1dOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImFwcGx5VHJhbnNmb3JtIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gYXBwbHlUcmFuc2Zvcm0ocCwgbSkgewogICAgICAgICAgdmFyIHh0ID0gcFswXSAqIG1bMF0gKyBwWzFdICogbVsyXSArIG1bNF07CiAgICAgICAgICB2YXIgeXQgPSBwWzBdICogbVsxXSArIHBbMV0gKiBtWzNdICsgbVs1XTsKICAgICAgICAgIHJldHVybiBbeHQsIHl0XTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJhcHBseUludmVyc2VUcmFuc2Zvcm0iLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBhcHBseUludmVyc2VUcmFuc2Zvcm0ocCwgbSkgewogICAgICAgICAgdmFyIGQgPSBtWzBdICogbVszXSAtIG1bMV0gKiBtWzJdOwogICAgICAgICAgdmFyIHh0ID0gKHBbMF0gKiBtWzNdIC0gcFsxXSAqIG1bMl0gKyBtWzJdICogbVs1XSAtIG1bNF0gKiBtWzNdKSAvIGQ7CiAgICAgICAgICB2YXIgeXQgPSAoLXBbMF0gKiBtWzFdICsgcFsxXSAqIG1bMF0gKyBtWzRdICogbVsxXSAtIG1bNV0gKiBtWzBdKSAvIGQ7CiAgICAgICAgICByZXR1cm4gW3h0LCB5dF07CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0QXhpYWxBbGlnbmVkQm91bmRpbmdCb3giLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRBeGlhbEFsaWduZWRCb3VuZGluZ0JveChyLCBtKSB7CiAgICAgICAgICB2YXIgcDEgPSBVdGlsLmFwcGx5VHJhbnNmb3JtKHIsIG0pOwogICAgICAgICAgdmFyIHAyID0gVXRpbC5hcHBseVRyYW5zZm9ybShyLnNsaWNlKDIsIDQpLCBtKTsKICAgICAgICAgIHZhciBwMyA9IFV0aWwuYXBwbHlUcmFuc2Zvcm0oW3JbMF0sIHJbM11dLCBtKTsKICAgICAgICAgIHZhciBwNCA9IFV0aWwuYXBwbHlUcmFuc2Zvcm0oW3JbMl0sIHJbMV1dLCBtKTsKICAgICAgICAgIHJldHVybiBbTWF0aC5taW4ocDFbMF0sIHAyWzBdLCBwM1swXSwgcDRbMF0pLCBNYXRoLm1pbihwMVsxXSwgcDJbMV0sIHAzWzFdLCBwNFsxXSksIE1hdGgubWF4KHAxWzBdLCBwMlswXSwgcDNbMF0sIHA0WzBdKSwgTWF0aC5tYXgocDFbMV0sIHAyWzFdLCBwM1sxXSwgcDRbMV0pXTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJpbnZlcnNlVHJhbnNmb3JtIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaW52ZXJzZVRyYW5zZm9ybShtKSB7CiAgICAgICAgICB2YXIgZCA9IG1bMF0gKiBtWzNdIC0gbVsxXSAqIG1bMl07CiAgICAgICAgICByZXR1cm4gW21bM10gLyBkLCAtbVsxXSAvIGQsIC1tWzJdIC8gZCwgbVswXSAvIGQsIChtWzJdICogbVs1XSAtIG1bNF0gKiBtWzNdKSAvIGQsIChtWzRdICogbVsxXSAtIG1bNV0gKiBtWzBdKSAvIGRdOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImFwcGx5M2RUcmFuc2Zvcm0iLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBhcHBseTNkVHJhbnNmb3JtKG0sIHYpIHsKICAgICAgICAgIHJldHVybiBbbVswXSAqIHZbMF0gKyBtWzFdICogdlsxXSArIG1bMl0gKiB2WzJdLCBtWzNdICogdlswXSArIG1bNF0gKiB2WzFdICsgbVs1XSAqIHZbMl0sIG1bNl0gKiB2WzBdICsgbVs3XSAqIHZbMV0gKyBtWzhdICogdlsyXV07CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAic2luZ3VsYXJWYWx1ZURlY29tcG9zZTJkU2NhbGUiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzaW5ndWxhclZhbHVlRGVjb21wb3NlMmRTY2FsZShtKSB7CiAgICAgICAgICB2YXIgdHJhbnNwb3NlID0gW21bMF0sIG1bMl0sIG1bMV0sIG1bM11dOwogICAgICAgICAgdmFyIGEgPSBtWzBdICogdHJhbnNwb3NlWzBdICsgbVsxXSAqIHRyYW5zcG9zZVsyXTsKICAgICAgICAgIHZhciBiID0gbVswXSAqIHRyYW5zcG9zZVsxXSArIG1bMV0gKiB0cmFuc3Bvc2VbM107CiAgICAgICAgICB2YXIgYyA9IG1bMl0gKiB0cmFuc3Bvc2VbMF0gKyBtWzNdICogdHJhbnNwb3NlWzJdOwogICAgICAgICAgdmFyIGQgPSBtWzJdICogdHJhbnNwb3NlWzFdICsgbVszXSAqIHRyYW5zcG9zZVszXTsKICAgICAgICAgIHZhciBmaXJzdCA9IChhICsgZCkgLyAyOwogICAgICAgICAgdmFyIHNlY29uZCA9IE1hdGguc3FydCgoYSArIGQpICogKGEgKyBkKSAtIDQgKiAoYSAqIGQgLSBjICogYikpIC8gMjsKICAgICAgICAgIHZhciBzeCA9IGZpcnN0ICsgc2Vjb25kIHx8IDE7CiAgICAgICAgICB2YXIgc3kgPSBmaXJzdCAtIHNlY29uZCB8fCAxOwogICAgICAgICAgcmV0dXJuIFtNYXRoLnNxcnQoc3gpLCBNYXRoLnNxcnQoc3kpXTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJub3JtYWxpemVSZWN0IiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gbm9ybWFsaXplUmVjdChyZWN0KSB7CiAgICAgICAgICB2YXIgciA9IHJlY3Quc2xpY2UoMCk7CgogICAgICAgICAgaWYgKHJlY3RbMF0gPiByZWN0WzJdKSB7CiAgICAgICAgICAgIHJbMF0gPSByZWN0WzJdOwogICAgICAgICAgICByWzJdID0gcmVjdFswXTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAocmVjdFsxXSA+IHJlY3RbM10pIHsKICAgICAgICAgICAgclsxXSA9IHJlY3RbM107CiAgICAgICAgICAgIHJbM10gPSByZWN0WzFdOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiByOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImludGVyc2VjdCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGludGVyc2VjdChyZWN0MSwgcmVjdDIpIHsKICAgICAgICAgIGZ1bmN0aW9uIGNvbXBhcmUoYSwgYikgewogICAgICAgICAgICByZXR1cm4gYSAtIGI7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIG9yZGVyZWRYID0gW3JlY3QxWzBdLCByZWN0MVsyXSwgcmVjdDJbMF0sIHJlY3QyWzJdXS5zb3J0KGNvbXBhcmUpOwogICAgICAgICAgdmFyIG9yZGVyZWRZID0gW3JlY3QxWzFdLCByZWN0MVszXSwgcmVjdDJbMV0sIHJlY3QyWzNdXS5zb3J0KGNvbXBhcmUpOwogICAgICAgICAgdmFyIHJlc3VsdCA9IFtdOwogICAgICAgICAgcmVjdDEgPSBVdGlsLm5vcm1hbGl6ZVJlY3QocmVjdDEpOwogICAgICAgICAgcmVjdDIgPSBVdGlsLm5vcm1hbGl6ZVJlY3QocmVjdDIpOwoKICAgICAgICAgIGlmIChvcmRlcmVkWFswXSA9PT0gcmVjdDFbMF0gJiYgb3JkZXJlZFhbMV0gPT09IHJlY3QyWzBdIHx8IG9yZGVyZWRYWzBdID09PSByZWN0MlswXSAmJiBvcmRlcmVkWFsxXSA9PT0gcmVjdDFbMF0pIHsKICAgICAgICAgICAgcmVzdWx0WzBdID0gb3JkZXJlZFhbMV07CiAgICAgICAgICAgIHJlc3VsdFsyXSA9IG9yZGVyZWRYWzJdOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKG9yZGVyZWRZWzBdID09PSByZWN0MVsxXSAmJiBvcmRlcmVkWVsxXSA9PT0gcmVjdDJbMV0gfHwgb3JkZXJlZFlbMF0gPT09IHJlY3QyWzFdICYmIG9yZGVyZWRZWzFdID09PSByZWN0MVsxXSkgewogICAgICAgICAgICByZXN1bHRbMV0gPSBvcmRlcmVkWVsxXTsKICAgICAgICAgICAgcmVzdWx0WzNdID0gb3JkZXJlZFlbMl07CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIFV0aWw7CiAgICB9KCk7CgogICAgZXhwb3J0cy5VdGlsID0gVXRpbDsKICAgIHZhciBQREZTdHJpbmdUcmFuc2xhdGVUYWJsZSA9IFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAweDJEOCwgMHgyQzcsIDB4MkM2LCAweDJEOSwgMHgyREQsIDB4MkRCLCAweDJEQSwgMHgyREMsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDB4MjAyMiwgMHgyMDIwLCAweDIwMjEsIDB4MjAyNiwgMHgyMDE0LCAweDIwMTMsIDB4MTkyLCAweDIwNDQsIDB4MjAzOSwgMHgyMDNBLCAweDIyMTIsIDB4MjAzMCwgMHgyMDFFLCAweDIwMUMsIDB4MjAxRCwgMHgyMDE4LCAweDIwMTksIDB4MjAxQSwgMHgyMTIyLCAweEZCMDEsIDB4RkIwMiwgMHgxNDEsIDB4MTUyLCAweDE2MCwgMHgxNzgsIDB4MTdELCAweDEzMSwgMHgxNDIsIDB4MTUzLCAweDE2MSwgMHgxN0UsIDAsIDB4MjBBQ107CgogICAgZnVuY3Rpb24gc3RyaW5nVG9QREZTdHJpbmcoc3RyKSB7CiAgICAgIHZhciBsZW5ndGggPSBzdHIubGVuZ3RoLAogICAgICAgIHN0ckJ1ZiA9IFtdOwoKICAgICAgaWYgKHN0clswXSA9PT0gIlx4RkUiICYmIHN0clsxXSA9PT0gIlx4RkYiKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDI7IGkgPCBsZW5ndGg7IGkgKz0gMikgewogICAgICAgICAgc3RyQnVmLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZShzdHIuY2hhckNvZGVBdChpKSA8PCA4IHwgc3RyLmNoYXJDb2RlQXQoaSArIDEpKSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHN0clswXSA9PT0gIlx4RkYiICYmIHN0clsxXSA9PT0gIlx4RkUiKSB7CiAgICAgICAgZm9yICh2YXIgX2kyID0gMjsgX2kyIDwgbGVuZ3RoOyBfaTIgKz0gMikgewogICAgICAgICAgc3RyQnVmLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZShzdHIuY2hhckNvZGVBdChfaTIgKyAxKSA8PCA4IHwgc3RyLmNoYXJDb2RlQXQoX2kyKSkpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBmb3IgKHZhciBfaTMgPSAwOyBfaTMgPCBsZW5ndGg7ICsrX2kzKSB7CiAgICAgICAgICB2YXIgY29kZSA9IFBERlN0cmluZ1RyYW5zbGF0ZVRhYmxlW3N0ci5jaGFyQ29kZUF0KF9pMyldOwogICAgICAgICAgc3RyQnVmLnB1c2goY29kZSA/IFN0cmluZy5mcm9tQ2hhckNvZGUoY29kZSkgOiBzdHIuY2hhckF0KF9pMykpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHN0ckJ1Zi5qb2luKCIiKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJpbmdUb1VURjhTdHJpbmcoc3RyKSB7CiAgICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQoZXNjYXBlKHN0cikpOwogICAgfQoKICAgIGZ1bmN0aW9uIHV0ZjhTdHJpbmdUb1N0cmluZyhzdHIpIHsKICAgICAgcmV0dXJuIHVuZXNjYXBlKGVuY29kZVVSSUNvbXBvbmVudChzdHIpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBpc0VtcHR5T2JqKG9iaikgewogICAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBpc0Jvb2wodikgewogICAgICByZXR1cm4gdHlwZW9mIHYgPT09ICJib29sZWFuIjsKICAgIH0KCiAgICBmdW5jdGlvbiBpc051bSh2KSB7CiAgICAgIHJldHVybiB0eXBlb2YgdiA9PT0gIm51bWJlciI7CiAgICB9CgogICAgZnVuY3Rpb24gaXNTdHJpbmcodikgewogICAgICByZXR1cm4gdHlwZW9mIHYgPT09ICJzdHJpbmciOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzQXJyYXlCdWZmZXIodikgewogICAgICByZXR1cm4gX3R5cGVvZih2KSA9PT0gIm9iamVjdCIgJiYgdiAhPT0gbnVsbCAmJiB2LmJ5dGVMZW5ndGggIT09IHVuZGVmaW5lZDsKICAgIH0KCiAgICBmdW5jdGlvbiBpc0FycmF5RXF1YWwoYXJyMSwgYXJyMikgewogICAgICBpZiAoYXJyMS5sZW5ndGggIT09IGFycjIubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gYXJyMS5ldmVyeShmdW5jdGlvbiAoZWxlbWVudCwgaW5kZXgpIHsKICAgICAgICByZXR1cm4gZWxlbWVudCA9PT0gYXJyMltpbmRleF07CiAgICAgIH0pOwogICAgfQoKICAgIGZ1bmN0aW9uIGNyZWF0ZVByb21pc2VDYXBhYmlsaXR5KCkgewogICAgICB2YXIgY2FwYWJpbGl0eSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIHZhciBpc1NldHRsZWQgPSBmYWxzZTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGNhcGFiaWxpdHksICJzZXR0bGVkIiwgewogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuIGlzU2V0dGxlZDsKICAgICAgICB9CiAgICAgIH0pOwogICAgICBjYXBhYmlsaXR5LnByb21pc2UgPSBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgY2FwYWJpbGl0eS5yZXNvbHZlID0gZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgIGlzU2V0dGxlZCA9IHRydWU7CiAgICAgICAgICByZXNvbHZlKGRhdGEpOwogICAgICAgIH07CgogICAgICAgIGNhcGFiaWxpdHkucmVqZWN0ID0gZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgaXNTZXR0bGVkID0gdHJ1ZTsKICAgICAgICAgIHJlamVjdChyZWFzb24pOwogICAgICAgIH07CiAgICAgIH0pOwogICAgICByZXR1cm4gY2FwYWJpbGl0eTsKICAgIH0KCiAgICB2YXIgY3JlYXRlT2JqZWN0VVJMID0gZnVuY3Rpb24gY3JlYXRlT2JqZWN0VVJMQ2xvc3VyZSgpIHsKICAgICAgdmFyIGRpZ2l0cyA9ICJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvPSI7CiAgICAgIHJldHVybiBmdW5jdGlvbiBjcmVhdGVPYmplY3RVUkwoZGF0YSwgY29udGVudFR5cGUpIHsKICAgICAgICB2YXIgZm9yY2VEYXRhU2NoZW1hID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiBmYWxzZTsKCiAgICAgICAgaWYgKCFmb3JjZURhdGFTY2hlbWEgJiYgVVJMLmNyZWF0ZU9iamVjdFVSTCkgewogICAgICAgICAgdmFyIGJsb2IgPSBuZXcgQmxvYihbZGF0YV0sIHsKICAgICAgICAgICAgdHlwZTogY29udGVudFR5cGUKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7CiAgICAgICAgfQoKICAgICAgICB2YXIgYnVmZmVyID0gImRhdGE6Ii5jb25jYXQoY29udGVudFR5cGUsICI7YmFzZTY0LCIpOwoKICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBkYXRhLmxlbmd0aDsgaSA8IGlpOyBpICs9IDMpIHsKICAgICAgICAgIHZhciBiMSA9IGRhdGFbaV0gJiAweGZmOwogICAgICAgICAgdmFyIGIyID0gZGF0YVtpICsgMV0gJiAweGZmOwogICAgICAgICAgdmFyIGIzID0gZGF0YVtpICsgMl0gJiAweGZmOwogICAgICAgICAgdmFyIGQxID0gYjEgPj4gMiwKICAgICAgICAgICAgZDIgPSAoYjEgJiAzKSA8PCA0IHwgYjIgPj4gNDsKICAgICAgICAgIHZhciBkMyA9IGkgKyAxIDwgaWkgPyAoYjIgJiAweGYpIDw8IDIgfCBiMyA+PiA2IDogNjQ7CiAgICAgICAgICB2YXIgZDQgPSBpICsgMiA8IGlpID8gYjMgJiAweDNmIDogNjQ7CiAgICAgICAgICBidWZmZXIgKz0gZGlnaXRzW2QxXSArIGRpZ2l0c1tkMl0gKyBkaWdpdHNbZDNdICsgZGlnaXRzW2Q0XTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBidWZmZXI7CiAgICAgIH07CiAgICB9KCk7CgogICAgZXhwb3J0cy5jcmVhdGVPYmplY3RVUkwgPSBjcmVhdGVPYmplY3RVUkw7CgogICAgLyoqKi99KSwgKAogIC8qIDYgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgoKICAgIGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mIjtpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAic3ltYm9sIikge190eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikge3JldHVybiB0eXBlb2Ygb2JqO307fSBlbHNlIHtfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHtyZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqO307fXJldHVybiBfdHlwZW9mKG9iaik7fQoKICAgIGlmICh0eXBlb2YgZ2xvYmFsVGhpcyA9PT0gInVuZGVmaW5lZCIgfHwgIWdsb2JhbFRoaXMuX3BkZmpzQ29tcGF0aWJpbGl0eUNoZWNrZWQpIHsKICAgICAgaWYgKHR5cGVvZiBnbG9iYWxUaGlzID09PSAidW5kZWZpbmVkIiB8fCBnbG9iYWxUaGlzLk1hdGggIT09IE1hdGgpIHsKICAgICAgICBnbG9iYWxUaGlzID0gX193X3BkZmpzX3JlcXVpcmVfXyg3KTsKICAgICAgfQoKICAgICAgZ2xvYmFsVGhpcy5fcGRmanNDb21wYXRpYmlsaXR5Q2hlY2tlZCA9IHRydWU7CgogICAgICB2YXIgX3JlcXVpcmUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUyKSwKICAgICAgICBpc05vZGVKUyA9IF9yZXF1aXJlLmlzTm9kZUpTOwoKICAgICAgdmFyIGhhc0RPTSA9ICh0eXBlb2Ygd2luZG93ID09PSAidW5kZWZpbmVkIiA/ICJ1bmRlZmluZWQiIDogX3R5cGVvZih3aW5kb3cpKSA9PT0gIm9iamVjdCIgJiYgKHR5cGVvZiBkb2N1bWVudCA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YoZG9jdW1lbnQpKSA9PT0gIm9iamVjdCI7CiAgICAgIHZhciB1c2VyQWdlbnQgPSB0eXBlb2YgbmF2aWdhdG9yICE9PSAidW5kZWZpbmVkIiAmJiBuYXZpZ2F0b3IudXNlckFnZW50IHx8ICIiOwogICAgICB2YXIgaXNJRSA9IC9UcmlkZW50Ly50ZXN0KHVzZXJBZ2VudCk7CgogICAgICAoZnVuY3Rpb24gY2hlY2tOb2RlQnRvYSgpIHsKICAgICAgICBpZiAoZ2xvYmFsVGhpcy5idG9hIHx8ICFpc05vZGVKUykgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgZ2xvYmFsVGhpcy5idG9hID0gZnVuY3Rpb24gKGNoYXJzKSB7CiAgICAgICAgICByZXR1cm4gQnVmZmVyLmZyb20oY2hhcnMsICJiaW5hcnkiKS50b1N0cmluZygiYmFzZTY0Iik7CiAgICAgICAgfTsKICAgICAgfSkoKTsKCiAgICAgIChmdW5jdGlvbiBjaGVja05vZGVBdG9iKCkgewogICAgICAgIGlmIChnbG9iYWxUaGlzLmF0b2IgfHwgIWlzTm9kZUpTKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBnbG9iYWxUaGlzLmF0b2IgPSBmdW5jdGlvbiAoaW5wdXQpIHsKICAgICAgICAgIHJldHVybiBCdWZmZXIuZnJvbShpbnB1dCwgImJhc2U2NCIpLnRvU3RyaW5nKCJiaW5hcnkiKTsKICAgICAgICB9OwogICAgICB9KSgpOwoKICAgICAgKGZ1bmN0aW9uIGNoZWNrQ2hpbGROb2RlUmVtb3ZlKCkgewogICAgICAgIGlmICghaGFzRE9NKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAodHlwZW9mIEVsZW1lbnQucHJvdG90eXBlLnJlbW92ZSAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIEVsZW1lbnQucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmICh0aGlzLnBhcmVudE5vZGUpIHsKICAgICAgICAgICAgdGhpcy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMpOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0pKCk7CgogICAgICAoZnVuY3Rpb24gY2hlY2tET01Ub2tlbkxpc3RBZGRSZW1vdmUoKSB7CiAgICAgICAgaWYgKCFoYXNET00gfHwgaXNOb2RlSlMpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgICBkaXYuY2xhc3NMaXN0LmFkZCgidGVzdE9uZSIsICJ0ZXN0VHdvIik7CgogICAgICAgIGlmIChkaXYuY2xhc3NMaXN0LmNvbnRhaW5zKCJ0ZXN0T25lIikgPT09IHRydWUgJiYgZGl2LmNsYXNzTGlzdC5jb250YWlucygidGVzdFR3byIpID09PSB0cnVlKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgT3JpZ2luYWxET01Ub2tlbkxpc3RBZGQgPSBET01Ub2tlbkxpc3QucHJvdG90eXBlLmFkZDsKICAgICAgICB2YXIgT3JpZ2luYWxET01Ub2tlbkxpc3RSZW1vdmUgPSBET01Ub2tlbkxpc3QucHJvdG90eXBlLnJlbW92ZTsKCiAgICAgICAgRE9NVG9rZW5MaXN0LnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgdG9rZW5zID0gbmV3IEFycmF5KF9sZW4pLCBfa2V5ID0gMDsgX2tleSA8IF9sZW47IF9rZXkrKykgewogICAgICAgICAgICB0b2tlbnNbX2tleV0gPSBhcmd1bWVudHNbX2tleV07CiAgICAgICAgICB9CgogICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfdG9rZW5zID0gdG9rZW5zOyBfaSA8IF90b2tlbnMubGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgICAgIHZhciB0b2tlbiA9IF90b2tlbnNbX2ldOwogICAgICAgICAgICBPcmlnaW5hbERPTVRva2VuTGlzdEFkZC5jYWxsKHRoaXMsIHRva2VuKTsKICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBET01Ub2tlbkxpc3QucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGZvciAodmFyIF9sZW4yID0gYXJndW1lbnRzLmxlbmd0aCwgdG9rZW5zID0gbmV3IEFycmF5KF9sZW4yKSwgX2tleTIgPSAwOyBfa2V5MiA8IF9sZW4yOyBfa2V5MisrKSB7CiAgICAgICAgICAgIHRva2Vuc1tfa2V5Ml0gPSBhcmd1bWVudHNbX2tleTJdOwogICAgICAgICAgfQoKICAgICAgICAgIGZvciAodmFyIF9pMiA9IDAsIF90b2tlbnMyID0gdG9rZW5zOyBfaTIgPCBfdG9rZW5zMi5sZW5ndGg7IF9pMisrKSB7CiAgICAgICAgICAgIHZhciB0b2tlbiA9IF90b2tlbnMyW19pMl07CiAgICAgICAgICAgIE9yaWdpbmFsRE9NVG9rZW5MaXN0UmVtb3ZlLmNhbGwodGhpcywgdG9rZW4pOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0pKCk7CgogICAgICAoZnVuY3Rpb24gY2hlY2tET01Ub2tlbkxpc3RUb2dnbGUoKSB7CiAgICAgICAgaWYgKCFoYXNET00gfHwgaXNOb2RlSlMpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKCiAgICAgICAgaWYgKGRpdi5jbGFzc0xpc3QudG9nZ2xlKCJ0ZXN0IiwgMCkgPT09IGZhbHNlKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBET01Ub2tlbkxpc3QucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uICh0b2tlbikgewogICAgICAgICAgdmFyIGZvcmNlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyAhIWFyZ3VtZW50c1sxXSA6ICF0aGlzLmNvbnRhaW5zKHRva2VuKTsKICAgICAgICAgIHJldHVybiB0aGlzW2ZvcmNlID8gImFkZCIgOiAicmVtb3ZlIl0odG9rZW4pLCBmb3JjZTsKICAgICAgICB9OwogICAgICB9KSgpOwoKICAgICAgKGZ1bmN0aW9uIGNoZWNrV2luZG93SGlzdG9yeVB1c2hTdGF0ZVJlcGxhY2VTdGF0ZSgpIHsKICAgICAgICBpZiAoIWhhc0RPTSB8fCAhaXNJRSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIE9yaWdpbmFsUHVzaFN0YXRlID0gd2luZG93Lmhpc3RvcnkucHVzaFN0YXRlOwogICAgICAgIHZhciBPcmlnaW5hbFJlcGxhY2VTdGF0ZSA9IHdpbmRvdy5oaXN0b3J5LnJlcGxhY2VTdGF0ZTsKCiAgICAgICAgd2luZG93Lmhpc3RvcnkucHVzaFN0YXRlID0gZnVuY3Rpb24gKHN0YXRlLCB0aXRsZSwgdXJsKSB7CiAgICAgICAgICB2YXIgYXJncyA9IHVybCA9PT0gdW5kZWZpbmVkID8gW3N0YXRlLCB0aXRsZV0gOiBbc3RhdGUsIHRpdGxlLCB1cmxdOwogICAgICAgICAgT3JpZ2luYWxQdXNoU3RhdGUuYXBwbHkodGhpcywgYXJncyk7CiAgICAgICAgfTsKCiAgICAgICAgd2luZG93Lmhpc3RvcnkucmVwbGFjZVN0YXRlID0gZnVuY3Rpb24gKHN0YXRlLCB0aXRsZSwgdXJsKSB7CiAgICAgICAgICB2YXIgYXJncyA9IHVybCA9PT0gdW5kZWZpbmVkID8gW3N0YXRlLCB0aXRsZV0gOiBbc3RhdGUsIHRpdGxlLCB1cmxdOwogICAgICAgICAgT3JpZ2luYWxSZXBsYWNlU3RhdGUuYXBwbHkodGhpcywgYXJncyk7CiAgICAgICAgfTsKICAgICAgfSkoKTsKCiAgICAgIChmdW5jdGlvbiBjaGVja1N0cmluZ1N0YXJ0c1dpdGgoKSB7CiAgICAgICAgaWYgKFN0cmluZy5wcm90b3R5cGUuc3RhcnRzV2l0aCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgX193X3BkZmpzX3JlcXVpcmVfXyg1Myk7CiAgICAgIH0pKCk7CgogICAgICAoZnVuY3Rpb24gY2hlY2tTdHJpbmdFbmRzV2l0aCgpIHsKICAgICAgICBpZiAoU3RyaW5nLnByb3RvdHlwZS5lbmRzV2l0aCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgX193X3BkZmpzX3JlcXVpcmVfXyg2NCk7CiAgICAgIH0pKCk7CgogICAgICAoZnVuY3Rpb24gY2hlY2tTdHJpbmdJbmNsdWRlcygpIHsKICAgICAgICBpZiAoU3RyaW5nLnByb3RvdHlwZS5pbmNsdWRlcykgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgX193X3BkZmpzX3JlcXVpcmVfXyg2Nik7CiAgICAgIH0pKCk7CgogICAgICAoZnVuY3Rpb24gY2hlY2tBcnJheUluY2x1ZGVzKCkgewogICAgICAgIGlmIChBcnJheS5wcm90b3R5cGUuaW5jbHVkZXMpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIF9fd19wZGZqc19yZXF1aXJlX18oNjgpOwogICAgICB9KSgpOwoKICAgICAgKGZ1bmN0aW9uIGNoZWNrQXJyYXlGcm9tKCkgewogICAgICAgIGlmIChBcnJheS5mcm9tKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDc2KTsKICAgICAgfSkoKTsKCiAgICAgIChmdW5jdGlvbiBjaGVja09iamVjdEFzc2lnbigpIHsKICAgICAgICBpZiAoT2JqZWN0LmFzc2lnbikgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgX193X3BkZmpzX3JlcXVpcmVfXyg5OCk7CiAgICAgIH0pKCk7CgogICAgICAoZnVuY3Rpb24gY2hlY2tNYXRoTG9nMigpIHsKICAgICAgICBpZiAoTWF0aC5sb2cyKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBNYXRoLmxvZzIgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEwMSk7CiAgICAgIH0pKCk7CgogICAgICAoZnVuY3Rpb24gY2hlY2tOdW1iZXJJc05hTigpIHsKICAgICAgICBpZiAoTnVtYmVyLmlzTmFOKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBOdW1iZXIuaXNOYU4gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEwMyk7CiAgICAgIH0pKCk7CgogICAgICAoZnVuY3Rpb24gY2hlY2tOdW1iZXJJc0ludGVnZXIoKSB7CiAgICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIE51bWJlci5pc0ludGVnZXIgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEwNSk7CiAgICAgIH0pKCk7CgogICAgICAoZnVuY3Rpb24gY2hlY2tQcm9taXNlKCkgewogICAgICAgIGlmIChnbG9iYWxUaGlzLlByb21pc2UgJiYgZ2xvYmFsVGhpcy5Qcm9taXNlLmFsbFNldHRsZWQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGdsb2JhbFRoaXMuUHJvbWlzZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTA4KTsKICAgICAgfSkoKTsKCiAgICAgIChmdW5jdGlvbiBjaGVja1VSTCgpIHsKICAgICAgICBnbG9iYWxUaGlzLlVSTCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTMyKTsKICAgICAgfSkoKTsKCiAgICAgIChmdW5jdGlvbiBjaGVja1JlYWRhYmxlU3RyZWFtKCkgewogICAgICAgIHZhciBpc1JlYWRhYmxlU3RyZWFtU3VwcG9ydGVkID0gZmFsc2U7CgogICAgICAgIGlmICh0eXBlb2YgUmVhZGFibGVTdHJlYW0gIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBuZXcgUmVhZGFibGVTdHJlYW0oewogICAgICAgICAgICAgIHN0YXJ0OiBmdW5jdGlvbiBzdGFydChjb250cm9sbGVyKSB7CiAgICAgICAgICAgICAgICBjb250cm9sbGVyLmNsb3NlKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaXNSZWFkYWJsZVN0cmVhbVN1cHBvcnRlZCA9IHRydWU7CiAgICAgICAgICB9IGNhdGNoIChlKSB7fQogICAgICAgIH0KCiAgICAgICAgaWYgKGlzUmVhZGFibGVTdHJlYW1TdXBwb3J0ZWQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGdsb2JhbFRoaXMuUmVhZGFibGVTdHJlYW0gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEzOSkuUmVhZGFibGVTdHJlYW07CiAgICAgIH0pKCk7CgogICAgICAoZnVuY3Rpb24gY2hlY2tNYXBFbnRyaWVzKCkgewogICAgICAgIGlmIChnbG9iYWxUaGlzLk1hcCAmJiBnbG9iYWxUaGlzLk1hcC5wcm90b3R5cGUuZW50cmllcykgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgZ2xvYmFsVGhpcy5NYXAgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE0MCk7CiAgICAgIH0pKCk7CgogICAgICAoZnVuY3Rpb24gY2hlY2tTZXRFbnRyaWVzKCkgewogICAgICAgIGlmIChnbG9iYWxUaGlzLlNldCAmJiBnbG9iYWxUaGlzLlNldC5wcm90b3R5cGUuZW50cmllcykgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgZ2xvYmFsVGhpcy5TZXQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE0Nyk7CiAgICAgIH0pKCk7CgogICAgICAoZnVuY3Rpb24gY2hlY2tXZWFrTWFwKCkgewogICAgICAgIGlmIChnbG9iYWxUaGlzLldlYWtNYXApIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGdsb2JhbFRoaXMuV2Vha01hcCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTQ5KTsKICAgICAgfSkoKTsKCiAgICAgIChmdW5jdGlvbiBjaGVja1dlYWtTZXQoKSB7CiAgICAgICAgaWYgKGdsb2JhbFRoaXMuV2Vha1NldCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgZ2xvYmFsVGhpcy5XZWFrU2V0ID0gX193X3BkZmpzX3JlcXVpcmVfXygxNTUpOwogICAgICB9KSgpOwoKICAgICAgKGZ1bmN0aW9uIGNoZWNrU3RyaW5nQ29kZVBvaW50QXQoKSB7CiAgICAgICAgaWYgKFN0cmluZy5wcm90b3R5cGUuY29kZVBvaW50QXQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIF9fd19wZGZqc19yZXF1aXJlX18oMTU3KTsKICAgICAgfSkoKTsKCiAgICAgIChmdW5jdGlvbiBjaGVja1N0cmluZ0Zyb21Db2RlUG9pbnQoKSB7CiAgICAgICAgaWYgKFN0cmluZy5mcm9tQ29kZVBvaW50KSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBTdHJpbmcuZnJvbUNvZGVQb2ludCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTU5KTsKICAgICAgfSkoKTsKCiAgICAgIChmdW5jdGlvbiBjaGVja1N5bWJvbCgpIHsKICAgICAgICBpZiAoZ2xvYmFsVGhpcy5TeW1ib2wpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIF9fd19wZGZqc19yZXF1aXJlX18oMTYxKTsKICAgICAgfSkoKTsKCiAgICAgIChmdW5jdGlvbiBjaGVja1N0cmluZ1BhZFN0YXJ0KCkgewogICAgICAgIGlmIChTdHJpbmcucHJvdG90eXBlLnBhZFN0YXJ0KSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDE4NCk7CiAgICAgIH0pKCk7CgogICAgICAoZnVuY3Rpb24gY2hlY2tTdHJpbmdQYWRFbmQoKSB7CiAgICAgICAgaWYgKFN0cmluZy5wcm90b3R5cGUucGFkRW5kKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDE4OSk7CiAgICAgIH0pKCk7CgogICAgICAoZnVuY3Rpb24gY2hlY2tPYmplY3RWYWx1ZXMoKSB7CiAgICAgICAgaWYgKE9iamVjdC52YWx1ZXMpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIE9iamVjdC52YWx1ZXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE5MSk7CiAgICAgIH0pKCk7CiAgICB9CgogICAgLyoqKi99KSwgKAogIC8qIDcgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDgpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEwKTsKCiAgICAvKioqL30pLCAoCiAgLyogOCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciAkID0gX193X3BkZmpzX3JlcXVpcmVfXyg5KTsKICAgIHZhciBnbG9iYWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEwKTsKICAgICQoeyBnbG9iYWw6IHRydWUgfSwgeyBnbG9iYWxUaGlzOiBnbG9iYWwgfSk7CgogICAgLyoqKi99KSwgKAogIC8qIDkgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgZ2xvYmFsID0gX193X3BkZmpzX3JlcXVpcmVfXygxMCk7CiAgICB2YXIgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0gX193X3BkZmpzX3JlcXVpcmVfXygxMSkuZjsKICAgIHZhciBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDI1KTsKICAgIHZhciByZWRlZmluZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjgpOwogICAgdmFyIHNldEdsb2JhbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMjkpOwogICAgdmFyIGNvcHlDb25zdHJ1Y3RvclByb3BlcnRpZXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDM5KTsKICAgIHZhciBpc0ZvcmNlZCA9IF9fd19wZGZqc19yZXF1aXJlX18oNTEpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAob3B0aW9ucywgc291cmNlKSB7CiAgICAgIHZhciBUQVJHRVQgPSBvcHRpb25zLnRhcmdldDsKICAgICAgdmFyIEdMT0JBTCA9IG9wdGlvbnMuZ2xvYmFsOwogICAgICB2YXIgU1RBVElDID0gb3B0aW9ucy5zdGF0OwogICAgICB2YXIgRk9SQ0VELCB0YXJnZXQsIGtleSwgdGFyZ2V0UHJvcGVydHksIHNvdXJjZVByb3BlcnR5LCBkZXNjcmlwdG9yOwogICAgICBpZiAoR0xPQkFMKSB7CiAgICAgICAgdGFyZ2V0ID0gZ2xvYmFsOwogICAgICB9IGVsc2UgaWYgKFNUQVRJQykgewogICAgICAgIHRhcmdldCA9IGdsb2JhbFtUQVJHRVRdIHx8IHNldEdsb2JhbChUQVJHRVQsIHt9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0YXJnZXQgPSAoZ2xvYmFsW1RBUkdFVF0gfHwge30pLnByb3RvdHlwZTsKICAgICAgfQogICAgICBpZiAodGFyZ2V0KQogICAgICBmb3IgKGtleSBpbiBzb3VyY2UpIHsKICAgICAgICBzb3VyY2VQcm9wZXJ0eSA9IHNvdXJjZVtrZXldOwogICAgICAgIGlmIChvcHRpb25zLm5vVGFyZ2V0R2V0KSB7CiAgICAgICAgICBkZXNjcmlwdG9yID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KTsKICAgICAgICAgIHRhcmdldFByb3BlcnR5ID0gZGVzY3JpcHRvciAmJiBkZXNjcmlwdG9yLnZhbHVlOwogICAgICAgIH0gZWxzZQogICAgICAgIHRhcmdldFByb3BlcnR5ID0gdGFyZ2V0W2tleV07CiAgICAgICAgRk9SQ0VEID0gaXNGb3JjZWQoR0xPQkFMID8ga2V5IDogVEFSR0VUICsgKFNUQVRJQyA/ICcuJyA6ICcjJykgKyBrZXksIG9wdGlvbnMuZm9yY2VkKTsKICAgICAgICBpZiAoIUZPUkNFRCAmJiB0YXJnZXRQcm9wZXJ0eSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBpZiAodHlwZW9mIHNvdXJjZVByb3BlcnR5ID09PSB0eXBlb2YgdGFyZ2V0UHJvcGVydHkpCiAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIGNvcHlDb25zdHJ1Y3RvclByb3BlcnRpZXMoc291cmNlUHJvcGVydHksIHRhcmdldFByb3BlcnR5KTsKICAgICAgICB9CiAgICAgICAgaWYgKG9wdGlvbnMuc2hhbSB8fCB0YXJnZXRQcm9wZXJ0eSAmJiB0YXJnZXRQcm9wZXJ0eS5zaGFtKSB7CiAgICAgICAgICBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkoc291cmNlUHJvcGVydHksICdzaGFtJywgdHJ1ZSk7CiAgICAgICAgfQogICAgICAgIHJlZGVmaW5lKHRhcmdldCwga2V5LCBzb3VyY2VQcm9wZXJ0eSwgb3B0aW9ucyk7CiAgICAgIH0KICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDEwICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgogICAgdmFyIGNoZWNrID0gZnVuY3Rpb24gY2hlY2soaXQpIHsKICAgICAgcmV0dXJuIGl0ICYmIGl0Lk1hdGggPT0gTWF0aCAmJiBpdDsKICAgIH07CiAgICBtb2R1bGUuZXhwb3J0cyA9IGNoZWNrKHR5cGVvZiBnbG9iYWxUaGlzID09ICdvYmplY3QnICYmIGdsb2JhbFRoaXMpIHx8IGNoZWNrKHR5cGVvZiB3aW5kb3cgPT0gJ29iamVjdCcgJiYgd2luZG93KSB8fCBjaGVjayh0eXBlb2Ygc2VsZiA9PSAnb2JqZWN0JyAmJiBzZWxmKSB8fCBjaGVjayh0eXBlb2YgZ2xvYmFsID09ICdvYmplY3QnICYmIGdsb2JhbCkgfHwgRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKTsKCiAgICAvKioqL30pLCAoCiAgLyogMTEgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgREVTQ1JJUFRPUlMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEyKTsKICAgIHZhciBwcm9wZXJ0eUlzRW51bWVyYWJsZU1vZHVsZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTQpOwogICAgdmFyIGNyZWF0ZVByb3BlcnR5RGVzY3JpcHRvciA9IF9fd19wZGZqc19yZXF1aXJlX18oMTUpOwogICAgdmFyIHRvSW5kZXhlZE9iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTYpOwogICAgdmFyIHRvUHJpbWl0aXZlID0gX193X3BkZmpzX3JlcXVpcmVfXygyMCk7CiAgICB2YXIgaGFzID0gX193X3BkZmpzX3JlcXVpcmVfXygyMik7CiAgICB2YXIgSUU4X0RPTV9ERUZJTkUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIzKTsKICAgIHZhciBuYXRpdmVHZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOwogICAgZXhwb3J0cy5mID0gREVTQ1JJUFRPUlMgPyBuYXRpdmVHZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgOiBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTywgUCkgewogICAgICBPID0gdG9JbmRleGVkT2JqZWN0KE8pOwogICAgICBQID0gdG9QcmltaXRpdmUoUCwgdHJ1ZSk7CiAgICAgIGlmIChJRThfRE9NX0RFRklORSkKICAgICAgdHJ5IHsKICAgICAgICByZXR1cm4gbmF0aXZlR2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE8sIFApOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICB9CiAgICAgIGlmIChoYXMoTywgUCkpCiAgICAgIHJldHVybiBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IoIXByb3BlcnR5SXNFbnVtZXJhYmxlTW9kdWxlLmYuY2FsbChPLCBQKSwgT1tQXSk7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAxMiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBmYWlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTMpOwogICAgbW9kdWxlLmV4cG9ydHMgPSAhZmFpbHMoZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KHt9LCAxLCB7CiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICByZXR1cm4gNzsKICAgICAgICB9CiAgICAgIH0pWzFdICE9IDc7CiAgICB9KTsKCiAgICAvKioqL30pLCAoCiAgLyogMTMgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKCiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChleGVjKSB7CiAgICAgIHRyeSB7CiAgICAgICAgcmV0dXJuICEhZXhlYygpOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAxNCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbmF0aXZlUHJvcGVydHlJc0VudW1lcmFibGUgPSB7fS5wcm9wZXJ0eUlzRW51bWVyYWJsZTsKICAgIHZhciBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOwogICAgdmFyIE5BU0hPUk5fQlVHID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yICYmICFuYXRpdmVQcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKHsgMTogMiB9LCAxKTsKICAgIGV4cG9ydHMuZiA9IE5BU0hPUk5fQlVHID8gZnVuY3Rpb24gcHJvcGVydHlJc0VudW1lcmFibGUoVikgewogICAgICB2YXIgZGVzY3JpcHRvciA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvcih0aGlzLCBWKTsKICAgICAgcmV0dXJuICEhZGVzY3JpcHRvciAmJiBkZXNjcmlwdG9yLmVudW1lcmFibGU7CiAgICB9IDogbmF0aXZlUHJvcGVydHlJc0VudW1lcmFibGU7CgogICAgLyoqKi99KSwgKAogIC8qIDE1ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoYml0bWFwLCB2YWx1ZSkgewogICAgICByZXR1cm4gewogICAgICAgIGVudW1lcmFibGU6ICEoYml0bWFwICYgMSksCiAgICAgICAgY29uZmlndXJhYmxlOiAhKGJpdG1hcCAmIDIpLAogICAgICAgIHdyaXRhYmxlOiAhKGJpdG1hcCAmIDQpLAogICAgICAgIHZhbHVlOiB2YWx1ZQogICAgICB9OwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogMTYgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgSW5kZXhlZE9iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTcpOwogICAgdmFyIHJlcXVpcmVPYmplY3RDb2VyY2libGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE5KTsKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7CiAgICAgIHJldHVybiBJbmRleGVkT2JqZWN0KHJlcXVpcmVPYmplY3RDb2VyY2libGUoaXQpKTsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDE3ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGZhaWxzID0gX193X3BkZmpzX3JlcXVpcmVfXygxMyk7CiAgICB2YXIgY2xhc3NvZiA9IF9fd19wZGZqc19yZXF1aXJlX18oMTgpOwogICAgdmFyIHNwbGl0ID0gJycuc3BsaXQ7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGZhaWxzKGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuICFPYmplY3QoJ3onKS5wcm9wZXJ0eUlzRW51bWVyYWJsZSgwKTsKICAgIH0pID8gZnVuY3Rpb24gKGl0KSB7CiAgICAgIHJldHVybiBjbGFzc29mKGl0KSA9PSAnU3RyaW5nJyA/IHNwbGl0LmNhbGwoaXQsICcnKSA6IE9iamVjdChpdCk7CiAgICB9IDogT2JqZWN0OwoKICAgIC8qKiovfSksICgKICAvKiAxOCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewoKICAgIHZhciB0b1N0cmluZyA9IHt9LnRvU3RyaW5nOwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsKICAgICAgcmV0dXJuIHRvU3RyaW5nLmNhbGwoaXQpLnNsaWNlKDgsIC0xKTsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDE5ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsKICAgICAgaWYgKGl0ID09IHVuZGVmaW5lZCkKICAgICAgdGhyb3cgVHlwZUVycm9yKCJDYW4ndCBjYWxsIG1ldGhvZCBvbiAiICsgaXQpOwogICAgICByZXR1cm4gaXQ7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAyMCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBpc09iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oMjEpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaW5wdXQsIFBSRUZFUlJFRF9TVFJJTkcpIHsKICAgICAgaWYgKCFpc09iamVjdChpbnB1dCkpCiAgICAgIHJldHVybiBpbnB1dDsKICAgICAgdmFyIGZuLCB2YWw7CiAgICAgIGlmIChQUkVGRVJSRURfU1RSSU5HICYmIHR5cGVvZiAoZm4gPSBpbnB1dC50b1N0cmluZykgPT0gJ2Z1bmN0aW9uJyAmJiAhaXNPYmplY3QodmFsID0gZm4uY2FsbChpbnB1dCkpKQogICAgICByZXR1cm4gdmFsOwogICAgICBpZiAodHlwZW9mIChmbiA9IGlucHV0LnZhbHVlT2YpID09ICdmdW5jdGlvbicgJiYgIWlzT2JqZWN0KHZhbCA9IGZuLmNhbGwoaW5wdXQpKSkKICAgICAgcmV0dXJuIHZhbDsKICAgICAgaWYgKCFQUkVGRVJSRURfU1RSSU5HICYmIHR5cGVvZiAoZm4gPSBpbnB1dC50b1N0cmluZykgPT0gJ2Z1bmN0aW9uJyAmJiAhaXNPYmplY3QodmFsID0gZm4uY2FsbChpbnB1dCkpKQogICAgICByZXR1cm4gdmFsOwogICAgICB0aHJvdyBUeXBlRXJyb3IoIkNhbid0IGNvbnZlcnQgb2JqZWN0IHRvIHByaW1pdGl2ZSB2YWx1ZSIpOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogMjEgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKCiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkgewogICAgICByZXR1cm4gdHlwZW9mIGl0ID09PSAnb2JqZWN0JyA/IGl0ICE9PSBudWxsIDogdHlwZW9mIGl0ID09PSAnZnVuY3Rpb24nOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogMjIgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKCiAgICB2YXIgaGFzT3duUHJvcGVydHkgPSB7fS5oYXNPd25Qcm9wZXJ0eTsKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0LCBrZXkpIHsKICAgICAgcmV0dXJuIGhhc093blByb3BlcnR5LmNhbGwoaXQsIGtleSk7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAyMyAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBERVNDUklQVE9SUyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTIpOwogICAgdmFyIGZhaWxzID0gX193X3BkZmpzX3JlcXVpcmVfXygxMyk7CiAgICB2YXIgY3JlYXRlRWxlbWVudCA9IF9fd19wZGZqc19yZXF1aXJlX18oMjQpOwogICAgbW9kdWxlLmV4cG9ydHMgPSAhREVTQ1JJUFRPUlMgJiYgIWZhaWxzKGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjcmVhdGVFbGVtZW50KCdkaXYnKSwgJ2EnLCB7CiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICByZXR1cm4gNzsKICAgICAgICB9CiAgICAgIH0pLmEgIT0gNzsKICAgIH0pOwoKICAgIC8qKiovfSksICgKICAvKiAyNCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBnbG9iYWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEwKTsKICAgIHZhciBpc09iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oMjEpOwogICAgdmFyIGRvY3VtZW50ID0gZ2xvYmFsLmRvY3VtZW50OwogICAgdmFyIEVYSVNUUyA9IGlzT2JqZWN0KGRvY3VtZW50KSAmJiBpc09iamVjdChkb2N1bWVudC5jcmVhdGVFbGVtZW50KTsKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7CiAgICAgIHJldHVybiBFWElTVFMgPyBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGl0KSA6IHt9OwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogMjUgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgREVTQ1JJUFRPUlMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEyKTsKICAgIHZhciBkZWZpbmVQcm9wZXJ0eU1vZHVsZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjYpOwogICAgdmFyIGNyZWF0ZVByb3BlcnR5RGVzY3JpcHRvciA9IF9fd19wZGZqc19yZXF1aXJlX18oMTUpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBERVNDUklQVE9SUyA/IGZ1bmN0aW9uIChvYmplY3QsIGtleSwgdmFsdWUpIHsKICAgICAgcmV0dXJuIGRlZmluZVByb3BlcnR5TW9kdWxlLmYob2JqZWN0LCBrZXksIGNyZWF0ZVByb3BlcnR5RGVzY3JpcHRvcigxLCB2YWx1ZSkpOwogICAgfSA6IGZ1bmN0aW9uIChvYmplY3QsIGtleSwgdmFsdWUpIHsKICAgICAgb2JqZWN0W2tleV0gPSB2YWx1ZTsKICAgICAgcmV0dXJuIG9iamVjdDsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDI2ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIERFU0NSSVBUT1JTID0gX193X3BkZmpzX3JlcXVpcmVfXygxMik7CiAgICB2YXIgSUU4X0RPTV9ERUZJTkUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIzKTsKICAgIHZhciBhbk9iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oMjcpOwogICAgdmFyIHRvUHJpbWl0aXZlID0gX193X3BkZmpzX3JlcXVpcmVfXygyMCk7CiAgICB2YXIgbmF0aXZlRGVmaW5lUHJvcGVydHkgPSBPYmplY3QuZGVmaW5lUHJvcGVydHk7CiAgICBleHBvcnRzLmYgPSBERVNDUklQVE9SUyA/IG5hdGl2ZURlZmluZVByb3BlcnR5IDogZnVuY3Rpb24gZGVmaW5lUHJvcGVydHkoTywgUCwgQXR0cmlidXRlcykgewogICAgICBhbk9iamVjdChPKTsKICAgICAgUCA9IHRvUHJpbWl0aXZlKFAsIHRydWUpOwogICAgICBhbk9iamVjdChBdHRyaWJ1dGVzKTsKICAgICAgaWYgKElFOF9ET01fREVGSU5FKQogICAgICB0cnkgewogICAgICAgIHJldHVybiBuYXRpdmVEZWZpbmVQcm9wZXJ0eShPLCBQLCBBdHRyaWJ1dGVzKTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgfQogICAgICBpZiAoJ2dldCcgaW4gQXR0cmlidXRlcyB8fCAnc2V0JyBpbiBBdHRyaWJ1dGVzKQogICAgICB0aHJvdyBUeXBlRXJyb3IoJ0FjY2Vzc29ycyBub3Qgc3VwcG9ydGVkJyk7CiAgICAgIGlmICgndmFsdWUnIGluIEF0dHJpYnV0ZXMpCiAgICAgIE9bUF0gPSBBdHRyaWJ1dGVzLnZhbHVlOwogICAgICByZXR1cm4gTzsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDI3ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGlzT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygyMSk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkgewogICAgICBpZiAoIWlzT2JqZWN0KGl0KSkgewogICAgICAgIHRocm93IFR5cGVFcnJvcihTdHJpbmcoaXQpICsgJyBpcyBub3QgYW4gb2JqZWN0Jyk7CiAgICAgIH0KICAgICAgcmV0dXJuIGl0OwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogMjggKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgZ2xvYmFsID0gX193X3BkZmpzX3JlcXVpcmVfXygxMCk7CiAgICB2YXIgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5ID0gX193X3BkZmpzX3JlcXVpcmVfXygyNSk7CiAgICB2YXIgaGFzID0gX193X3BkZmpzX3JlcXVpcmVfXygyMik7CiAgICB2YXIgc2V0R2xvYmFsID0gX193X3BkZmpzX3JlcXVpcmVfXygyOSk7CiAgICB2YXIgaW5zcGVjdFNvdXJjZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMzApOwogICAgdmFyIEludGVybmFsU3RhdGVNb2R1bGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDMyKTsKICAgIHZhciBnZXRJbnRlcm5hbFN0YXRlID0gSW50ZXJuYWxTdGF0ZU1vZHVsZS5nZXQ7CiAgICB2YXIgZW5mb3JjZUludGVybmFsU3RhdGUgPSBJbnRlcm5hbFN0YXRlTW9kdWxlLmVuZm9yY2U7CiAgICB2YXIgVEVNUExBVEUgPSBTdHJpbmcoU3RyaW5nKS5zcGxpdCgnU3RyaW5nJyk7CiAgICAobW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoTywga2V5LCB2YWx1ZSwgb3B0aW9ucykgewogICAgICB2YXIgdW5zYWZlID0gb3B0aW9ucyA/ICEhb3B0aW9ucy51bnNhZmUgOiBmYWxzZTsKICAgICAgdmFyIHNpbXBsZSA9IG9wdGlvbnMgPyAhIW9wdGlvbnMuZW51bWVyYWJsZSA6IGZhbHNlOwogICAgICB2YXIgbm9UYXJnZXRHZXQgPSBvcHRpb25zID8gISFvcHRpb25zLm5vVGFyZ2V0R2V0IDogZmFsc2U7CiAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT0gJ2Z1bmN0aW9uJykgewogICAgICAgIGlmICh0eXBlb2Yga2V5ID09ICdzdHJpbmcnICYmICFoYXModmFsdWUsICduYW1lJykpCiAgICAgICAgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5KHZhbHVlLCAnbmFtZScsIGtleSk7CiAgICAgICAgZW5mb3JjZUludGVybmFsU3RhdGUodmFsdWUpLnNvdXJjZSA9IFRFTVBMQVRFLmpvaW4odHlwZW9mIGtleSA9PSAnc3RyaW5nJyA/IGtleSA6ICcnKTsKICAgICAgfQogICAgICBpZiAoTyA9PT0gZ2xvYmFsKSB7CiAgICAgICAgaWYgKHNpbXBsZSkKICAgICAgICBPW2tleV0gPSB2YWx1ZTtlbHNlCgogICAgICAgIHNldEdsb2JhbChrZXksIHZhbHVlKTsKICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSBpZiAoIXVuc2FmZSkgewogICAgICAgIGRlbGV0ZSBPW2tleV07CiAgICAgIH0gZWxzZSBpZiAoIW5vVGFyZ2V0R2V0ICYmIE9ba2V5XSkgewogICAgICAgIHNpbXBsZSA9IHRydWU7CiAgICAgIH0KICAgICAgaWYgKHNpbXBsZSkKICAgICAgT1trZXldID0gdmFsdWU7ZWxzZQoKICAgICAgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5KE8sIGtleSwgdmFsdWUpOwogICAgfSkoRnVuY3Rpb24ucHJvdG90eXBlLCAndG9TdHJpbmcnLCBmdW5jdGlvbiB0b1N0cmluZygpIHsKICAgICAgcmV0dXJuIHR5cGVvZiB0aGlzID09ICdmdW5jdGlvbicgJiYgZ2V0SW50ZXJuYWxTdGF0ZSh0aGlzKS5zb3VyY2UgfHwgaW5zcGVjdFNvdXJjZSh0aGlzKTsKICAgIH0pOwoKICAgIC8qKiovfSksICgKICAvKiAyOSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBnbG9iYWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEwKTsKICAgIHZhciBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDI1KTsKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsKICAgICAgdHJ5IHsKICAgICAgICBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkoZ2xvYmFsLCBrZXksIHZhbHVlKTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBnbG9iYWxba2V5XSA9IHZhbHVlOwogICAgICB9CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDMwICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIHN0b3JlID0gX193X3BkZmpzX3JlcXVpcmVfXygzMSk7CiAgICB2YXIgZnVuY3Rpb25Ub1N0cmluZyA9IEZ1bmN0aW9uLnRvU3RyaW5nOwogICAgaWYgKHR5cGVvZiBzdG9yZS5pbnNwZWN0U291cmNlICE9ICdmdW5jdGlvbicpIHsKICAgICAgc3RvcmUuaW5zcGVjdFNvdXJjZSA9IGZ1bmN0aW9uIChpdCkgewogICAgICAgIHJldHVybiBmdW5jdGlvblRvU3RyaW5nLmNhbGwoaXQpOwogICAgICB9OwogICAgfQogICAgbW9kdWxlLmV4cG9ydHMgPSBzdG9yZS5pbnNwZWN0U291cmNlOwoKICAgIC8qKiovfSksICgKICAvKiAzMSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBnbG9iYWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEwKTsKICAgIHZhciBzZXRHbG9iYWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDI5KTsKICAgIHZhciBTSEFSRUQgPSAnX19jb3JlLWpzX3NoYXJlZF9fJzsKICAgIHZhciBzdG9yZSA9IGdsb2JhbFtTSEFSRURdIHx8IHNldEdsb2JhbChTSEFSRUQsIHt9KTsKICAgIG1vZHVsZS5leHBvcnRzID0gc3RvcmU7CgogICAgLyoqKi99KSwgKAogIC8qIDMyICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIE5BVElWRV9XRUFLX01BUCA9IF9fd19wZGZqc19yZXF1aXJlX18oMzMpOwogICAgdmFyIGdsb2JhbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTApOwogICAgdmFyIGlzT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygyMSk7CiAgICB2YXIgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5ID0gX193X3BkZmpzX3JlcXVpcmVfXygyNSk7CiAgICB2YXIgb2JqZWN0SGFzID0gX193X3BkZmpzX3JlcXVpcmVfXygyMik7CiAgICB2YXIgc2hhcmVkS2V5ID0gX193X3BkZmpzX3JlcXVpcmVfXygzNCk7CiAgICB2YXIgaGlkZGVuS2V5cyA9IF9fd19wZGZqc19yZXF1aXJlX18oMzgpOwogICAgdmFyIFdlYWtNYXAgPSBnbG9iYWwuV2Vha01hcDsKICAgIHZhciBzZXQsIGdldCwgaGFzOwogICAgdmFyIGVuZm9yY2UgPSBmdW5jdGlvbiBlbmZvcmNlKGl0KSB7CiAgICAgIHJldHVybiBoYXMoaXQpID8gZ2V0KGl0KSA6IHNldChpdCwge30pOwogICAgfTsKICAgIHZhciBnZXR0ZXJGb3IgPSBmdW5jdGlvbiBnZXR0ZXJGb3IoVFlQRSkgewogICAgICByZXR1cm4gZnVuY3Rpb24gKGl0KSB7CiAgICAgICAgdmFyIHN0YXRlOwogICAgICAgIGlmICghaXNPYmplY3QoaXQpIHx8IChzdGF0ZSA9IGdldChpdCkpLnR5cGUgIT09IFRZUEUpIHsKICAgICAgICAgIHRocm93IFR5cGVFcnJvcignSW5jb21wYXRpYmxlIHJlY2VpdmVyLCAnICsgVFlQRSArICcgcmVxdWlyZWQnKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN0YXRlOwogICAgICB9OwogICAgfTsKICAgIGlmIChOQVRJVkVfV0VBS19NQVApIHsKICAgICAgdmFyIHN0b3JlID0gbmV3IFdlYWtNYXAoKTsKICAgICAgdmFyIHdtZ2V0ID0gc3RvcmUuZ2V0OwogICAgICB2YXIgd21oYXMgPSBzdG9yZS5oYXM7CiAgICAgIHZhciB3bXNldCA9IHN0b3JlLnNldDsKICAgICAgc2V0ID0gZnVuY3Rpb24gc2V0KGl0LCBtZXRhZGF0YSkgewogICAgICAgIHdtc2V0LmNhbGwoc3RvcmUsIGl0LCBtZXRhZGF0YSk7CiAgICAgICAgcmV0dXJuIG1ldGFkYXRhOwogICAgICB9OwogICAgICBnZXQgPSBmdW5jdGlvbiBnZXQoaXQpIHsKICAgICAgICByZXR1cm4gd21nZXQuY2FsbChzdG9yZSwgaXQpIHx8IHt9OwogICAgICB9OwogICAgICBoYXMgPSBmdW5jdGlvbiBoYXMoaXQpIHsKICAgICAgICByZXR1cm4gd21oYXMuY2FsbChzdG9yZSwgaXQpOwogICAgICB9OwogICAgfSBlbHNlIHsKICAgICAgdmFyIFNUQVRFID0gc2hhcmVkS2V5KCdzdGF0ZScpOwogICAgICBoaWRkZW5LZXlzW1NUQVRFXSA9IHRydWU7CiAgICAgIHNldCA9IGZ1bmN0aW9uIHNldChpdCwgbWV0YWRhdGEpIHsKICAgICAgICBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkoaXQsIFNUQVRFLCBtZXRhZGF0YSk7CiAgICAgICAgcmV0dXJuIG1ldGFkYXRhOwogICAgICB9OwogICAgICBnZXQgPSBmdW5jdGlvbiBnZXQoaXQpIHsKICAgICAgICByZXR1cm4gb2JqZWN0SGFzKGl0LCBTVEFURSkgPyBpdFtTVEFURV0gOiB7fTsKICAgICAgfTsKICAgICAgaGFzID0gZnVuY3Rpb24gaGFzKGl0KSB7CiAgICAgICAgcmV0dXJuIG9iamVjdEhhcyhpdCwgU1RBVEUpOwogICAgICB9OwogICAgfQogICAgbW9kdWxlLmV4cG9ydHMgPSB7CiAgICAgIHNldDogc2V0LAogICAgICBnZXQ6IGdldCwKICAgICAgaGFzOiBoYXMsCiAgICAgIGVuZm9yY2U6IGVuZm9yY2UsCiAgICAgIGdldHRlckZvcjogZ2V0dGVyRm9yCiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAzMyAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBnbG9iYWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEwKTsKICAgIHZhciBpbnNwZWN0U291cmNlID0gX193X3BkZmpzX3JlcXVpcmVfXygzMCk7CiAgICB2YXIgV2Vha01hcCA9IGdsb2JhbC5XZWFrTWFwOwogICAgbW9kdWxlLmV4cG9ydHMgPSB0eXBlb2YgV2Vha01hcCA9PT0gJ2Z1bmN0aW9uJyAmJiAvbmF0aXZlIGNvZGUvLnRlc3QoaW5zcGVjdFNvdXJjZShXZWFrTWFwKSk7CgogICAgLyoqKi99KSwgKAogIC8qIDM0ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIHNoYXJlZCA9IF9fd19wZGZqc19yZXF1aXJlX18oMzUpOwogICAgdmFyIHVpZCA9IF9fd19wZGZqc19yZXF1aXJlX18oMzcpOwogICAgdmFyIGtleXMgPSBzaGFyZWQoJ2tleXMnKTsKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGtleSkgewogICAgICByZXR1cm4ga2V5c1trZXldIHx8IChrZXlzW2tleV0gPSB1aWQoa2V5KSk7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAzNSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBJU19QVVJFID0gX193X3BkZmpzX3JlcXVpcmVfXygzNik7CiAgICB2YXIgc3RvcmUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDMxKTsKICAgIChtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CiAgICAgIHJldHVybiBzdG9yZVtrZXldIHx8IChzdG9yZVtrZXldID0gdmFsdWUgIT09IHVuZGVmaW5lZCA/IHZhbHVlIDoge30pOwogICAgfSkoJ3ZlcnNpb25zJywgW10pLnB1c2goewogICAgICB2ZXJzaW9uOiAnMy42LjQnLAogICAgICBtb2RlOiBJU19QVVJFID8gJ3B1cmUnIDogJ2dsb2JhbCcsCiAgICAgIGNvcHlyaWdodDogJ8KpIDIwMjAgRGVuaXMgUHVzaGthcmV2ICh6bG9pcm9jay5ydSknCiAgICB9KTsKCiAgICAvKioqL30pLCAoCiAgLyogMzYgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKCiAgICBtb2R1bGUuZXhwb3J0cyA9IGZhbHNlOwoKICAgIC8qKiovfSksICgKICAvKiAzNyAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewoKICAgIHZhciBpZCA9IDA7CiAgICB2YXIgcG9zdGZpeCA9IE1hdGgucmFuZG9tKCk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChrZXkpIHsKICAgICAgcmV0dXJuICdTeW1ib2woJyArIFN0cmluZyhrZXkgPT09IHVuZGVmaW5lZCA/ICcnIDoga2V5KSArICcpXycgKyAoKytpZCArIHBvc3RmaXgpLnRvU3RyaW5nKDM2KTsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDM4ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgogICAgbW9kdWxlLmV4cG9ydHMgPSB7fTsKCiAgICAvKioqL30pLCAoCiAgLyogMzkgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgaGFzID0gX193X3BkZmpzX3JlcXVpcmVfXygyMik7CiAgICB2YXIgb3duS2V5cyA9IF9fd19wZGZqc19yZXF1aXJlX18oNDApOwogICAgdmFyIGdldE93blByb3BlcnR5RGVzY3JpcHRvck1vZHVsZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTEpOwogICAgdmFyIGRlZmluZVByb3BlcnR5TW9kdWxlID0gX193X3BkZmpzX3JlcXVpcmVfXygyNik7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uICh0YXJnZXQsIHNvdXJjZSkgewogICAgICB2YXIga2V5cyA9IG93bktleXMoc291cmNlKTsKICAgICAgdmFyIGRlZmluZVByb3BlcnR5ID0gZGVmaW5lUHJvcGVydHlNb2R1bGUuZjsKICAgICAgdmFyIGdldE93blByb3BlcnR5RGVzY3JpcHRvciA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvck1vZHVsZS5mOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIga2V5ID0ga2V5c1tpXTsKICAgICAgICBpZiAoIWhhcyh0YXJnZXQsIGtleSkpCiAgICAgICAgZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIGdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOwogICAgICB9CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiA0MCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBnZXRCdWlsdEluID0gX193X3BkZmpzX3JlcXVpcmVfXyg0MSk7CiAgICB2YXIgZ2V0T3duUHJvcGVydHlOYW1lc01vZHVsZSA9IF9fd19wZGZqc19yZXF1aXJlX18oNDMpOwogICAgdmFyIGdldE93blByb3BlcnR5U3ltYm9sc01vZHVsZSA9IF9fd19wZGZqc19yZXF1aXJlX18oNTApOwogICAgdmFyIGFuT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygyNyk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGdldEJ1aWx0SW4oJ1JlZmxlY3QnLCAnb3duS2V5cycpIHx8IGZ1bmN0aW9uIG93bktleXMoaXQpIHsKICAgICAgdmFyIGtleXMgPSBnZXRPd25Qcm9wZXJ0eU5hbWVzTW9kdWxlLmYoYW5PYmplY3QoaXQpKTsKICAgICAgdmFyIGdldE93blByb3BlcnR5U3ltYm9scyA9IGdldE93blByb3BlcnR5U3ltYm9sc01vZHVsZS5mOwogICAgICByZXR1cm4gZ2V0T3duUHJvcGVydHlTeW1ib2xzID8ga2V5cy5jb25jYXQoZ2V0T3duUHJvcGVydHlTeW1ib2xzKGl0KSkgOiBrZXlzOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogNDEgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgcGF0aCA9IF9fd19wZGZqc19yZXF1aXJlX18oNDIpOwogICAgdmFyIGdsb2JhbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTApOwogICAgdmFyIGFGdW5jdGlvbiA9IGZ1bmN0aW9uIGFGdW5jdGlvbih2YXJpYWJsZSkgewogICAgICByZXR1cm4gdHlwZW9mIHZhcmlhYmxlID09ICdmdW5jdGlvbicgPyB2YXJpYWJsZSA6IHVuZGVmaW5lZDsKICAgIH07CiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChuYW1lc3BhY2UsIG1ldGhvZCkgewogICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA8IDIgPyBhRnVuY3Rpb24ocGF0aFtuYW1lc3BhY2VdKSB8fCBhRnVuY3Rpb24oZ2xvYmFsW25hbWVzcGFjZV0pIDogcGF0aFtuYW1lc3BhY2VdICYmIHBhdGhbbmFtZXNwYWNlXVttZXRob2RdIHx8IGdsb2JhbFtuYW1lc3BhY2VdICYmIGdsb2JhbFtuYW1lc3BhY2VdW21ldGhvZF07CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiA0MiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBnbG9iYWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEwKTsKICAgIG1vZHVsZS5leHBvcnRzID0gZ2xvYmFsOwoKICAgIC8qKiovfSksICgKICAvKiA0MyAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBpbnRlcm5hbE9iamVjdEtleXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDQ0KTsKICAgIHZhciBlbnVtQnVnS2V5cyA9IF9fd19wZGZqc19yZXF1aXJlX18oNDkpOwogICAgdmFyIGhpZGRlbktleXMgPSBlbnVtQnVnS2V5cy5jb25jYXQoJ2xlbmd0aCcsICdwcm90b3R5cGUnKTsKICAgIGV4cG9ydHMuZiA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzIHx8IGZ1bmN0aW9uIGdldE93blByb3BlcnR5TmFtZXMoTykgewogICAgICByZXR1cm4gaW50ZXJuYWxPYmplY3RLZXlzKE8sIGhpZGRlbktleXMpOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogNDQgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgaGFzID0gX193X3BkZmpzX3JlcXVpcmVfXygyMik7CiAgICB2YXIgdG9JbmRleGVkT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygxNik7CiAgICB2YXIgaW5kZXhPZiA9IF9fd19wZGZqc19yZXF1aXJlX18oNDUpLmluZGV4T2Y7CiAgICB2YXIgaGlkZGVuS2V5cyA9IF9fd19wZGZqc19yZXF1aXJlX18oMzgpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAob2JqZWN0LCBuYW1lcykgewogICAgICB2YXIgTyA9IHRvSW5kZXhlZE9iamVjdChvYmplY3QpOwogICAgICB2YXIgaSA9IDA7CiAgICAgIHZhciByZXN1bHQgPSBbXTsKICAgICAgdmFyIGtleTsKICAgICAgZm9yIChrZXkgaW4gTykKICAgICAgIWhhcyhoaWRkZW5LZXlzLCBrZXkpICYmIGhhcyhPLCBrZXkpICYmIHJlc3VsdC5wdXNoKGtleSk7CiAgICAgIHdoaWxlIChuYW1lcy5sZW5ndGggPiBpKQogICAgICBpZiAoaGFzKE8sIGtleSA9IG5hbWVzW2krK10pKSB7CiAgICAgICAgfmluZGV4T2YocmVzdWx0LCBrZXkpIHx8IHJlc3VsdC5wdXNoKGtleSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDQ1ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIHRvSW5kZXhlZE9iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTYpOwogICAgdmFyIHRvTGVuZ3RoID0gX193X3BkZmpzX3JlcXVpcmVfXyg0Nik7CiAgICB2YXIgdG9BYnNvbHV0ZUluZGV4ID0gX193X3BkZmpzX3JlcXVpcmVfXyg0OCk7CiAgICB2YXIgY3JlYXRlTWV0aG9kID0gZnVuY3Rpb24gY3JlYXRlTWV0aG9kKElTX0lOQ0xVREVTKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoJHRoaXMsIGVsLCBmcm9tSW5kZXgpIHsKICAgICAgICB2YXIgTyA9IHRvSW5kZXhlZE9iamVjdCgkdGhpcyk7CiAgICAgICAgdmFyIGxlbmd0aCA9IHRvTGVuZ3RoKE8ubGVuZ3RoKTsKICAgICAgICB2YXIgaW5kZXggPSB0b0Fic29sdXRlSW5kZXgoZnJvbUluZGV4LCBsZW5ndGgpOwogICAgICAgIHZhciB2YWx1ZTsKICAgICAgICBpZiAoSVNfSU5DTFVERVMgJiYgZWwgIT0gZWwpCiAgICAgICAgd2hpbGUgKGxlbmd0aCA+IGluZGV4KSB7CiAgICAgICAgICB2YWx1ZSA9IE9baW5kZXgrK107CiAgICAgICAgICBpZiAodmFsdWUgIT0gdmFsdWUpCiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UKCiAgICAgICAgZm9yICg7IGxlbmd0aCA+IGluZGV4OyBpbmRleCsrKSB7CiAgICAgICAgICBpZiAoKElTX0lOQ0xVREVTIHx8IGluZGV4IGluIE8pICYmIE9baW5kZXhdID09PSBlbCkKICAgICAgICAgIHJldHVybiBJU19JTkNMVURFUyB8fCBpbmRleCB8fCAwOwogICAgICAgIH0KICAgICAgICByZXR1cm4gIUlTX0lOQ0xVREVTICYmIC0xOwogICAgICB9OwogICAgfTsKICAgIG1vZHVsZS5leHBvcnRzID0gewogICAgICBpbmNsdWRlczogY3JlYXRlTWV0aG9kKHRydWUpLAogICAgICBpbmRleE9mOiBjcmVhdGVNZXRob2QoZmFsc2UpCiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiA0NiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciB0b0ludGVnZXIgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDQ3KTsKICAgIHZhciBtaW4gPSBNYXRoLm1pbjsKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGFyZ3VtZW50KSB7CiAgICAgIHJldHVybiBhcmd1bWVudCA+IDAgPyBtaW4odG9JbnRlZ2VyKGFyZ3VtZW50KSwgMHgxRkZGRkZGRkZGRkZGRikgOiAwOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogNDcgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKCiAgICB2YXIgY2VpbCA9IE1hdGguY2VpbDsKICAgIHZhciBmbG9vciA9IE1hdGguZmxvb3I7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChhcmd1bWVudCkgewogICAgICByZXR1cm4gaXNOYU4oYXJndW1lbnQgPSArYXJndW1lbnQpID8gMCA6IChhcmd1bWVudCA+IDAgPyBmbG9vciA6IGNlaWwpKGFyZ3VtZW50KTsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDQ4ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIHRvSW50ZWdlciA9IF9fd19wZGZqc19yZXF1aXJlX18oNDcpOwogICAgdmFyIG1heCA9IE1hdGgubWF4OwogICAgdmFyIG1pbiA9IE1hdGgubWluOwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaW5kZXgsIGxlbmd0aCkgewogICAgICB2YXIgaW50ZWdlciA9IHRvSW50ZWdlcihpbmRleCk7CiAgICAgIHJldHVybiBpbnRlZ2VyIDwgMCA/IG1heChpbnRlZ2VyICsgbGVuZ3RoLCAwKSA6IG1pbihpbnRlZ2VyLCBsZW5ndGgpOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogNDkgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKCiAgICBtb2R1bGUuZXhwb3J0cyA9IFsKICAgICdjb25zdHJ1Y3RvcicsCiAgICAnaGFzT3duUHJvcGVydHknLAogICAgJ2lzUHJvdG90eXBlT2YnLAogICAgJ3Byb3BlcnR5SXNFbnVtZXJhYmxlJywKICAgICd0b0xvY2FsZVN0cmluZycsCiAgICAndG9TdHJpbmcnLAogICAgJ3ZhbHVlT2YnXTsKCgogICAgLyoqKi99KSwgKAogIC8qIDUwICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgogICAgZXhwb3J0cy5mID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9sczsKCiAgICAvKioqL30pLCAoCiAgLyogNTEgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgZmFpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEzKTsKICAgIHZhciByZXBsYWNlbWVudCA9IC8jfFwucHJvdG90eXBlXC4vOwogICAgdmFyIGlzRm9yY2VkID0gZnVuY3Rpb24gaXNGb3JjZWQoZmVhdHVyZSwgZGV0ZWN0aW9uKSB7CiAgICAgIHZhciB2YWx1ZSA9IGRhdGFbbm9ybWFsaXplKGZlYXR1cmUpXTsKICAgICAgcmV0dXJuIHZhbHVlID09IFBPTFlGSUxMID8gdHJ1ZSA6IHZhbHVlID09IE5BVElWRSA/IGZhbHNlIDogdHlwZW9mIGRldGVjdGlvbiA9PSAnZnVuY3Rpb24nID8gZmFpbHMoZGV0ZWN0aW9uKSA6ICEhZGV0ZWN0aW9uOwogICAgfTsKICAgIHZhciBub3JtYWxpemUgPSBpc0ZvcmNlZC5ub3JtYWxpemUgPSBmdW5jdGlvbiAoc3RyaW5nKSB7CiAgICAgIHJldHVybiBTdHJpbmcoc3RyaW5nKS5yZXBsYWNlKHJlcGxhY2VtZW50LCAnLicpLnRvTG93ZXJDYXNlKCk7CiAgICB9OwogICAgdmFyIGRhdGEgPSBpc0ZvcmNlZC5kYXRhID0ge307CiAgICB2YXIgTkFUSVZFID0gaXNGb3JjZWQuTkFUSVZFID0gJ04nOwogICAgdmFyIFBPTFlGSUxMID0gaXNGb3JjZWQuUE9MWUZJTEwgPSAnUCc7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGlzRm9yY2VkOwoKICAgIC8qKiovfSksICgKICAvKiA1MiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCgogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICB2YWx1ZTogdHJ1ZQogICAgfSk7CiAgICBleHBvcnRzLmlzTm9kZUpTID0gdm9pZCAwOwoKICAgIGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mIjtpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAic3ltYm9sIikge190eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikge3JldHVybiB0eXBlb2Ygb2JqO307fSBlbHNlIHtfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHtyZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqO307fXJldHVybiBfdHlwZW9mKG9iaik7fQoKICAgIHZhciBpc05vZGVKUyA9ICh0eXBlb2YgcHJvY2VzcyA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YocHJvY2VzcykpID09PSAib2JqZWN0IiAmJiBwcm9jZXNzICsgIiIgPT09ICJbb2JqZWN0IHByb2Nlc3NdIiAmJiAhcHJvY2Vzcy52ZXJzaW9uc1sibnciXSAmJiAhcHJvY2Vzcy52ZXJzaW9uc1siZWxlY3Ryb24iXTsKICAgIGV4cG9ydHMuaXNOb2RlSlMgPSBpc05vZGVKUzsKCiAgICAvKioqL30pLCAoCiAgLyogNTMgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDU0KTsKICAgIHZhciBlbnRyeVVuYmluZCA9IF9fd19wZGZqc19yZXF1aXJlX18oNjEpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBlbnRyeVVuYmluZCgnU3RyaW5nJywgJ3N0YXJ0c1dpdGgnKTsKCiAgICAvKioqL30pLCAoCiAgLyogNTQgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyICQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDkpOwogICAgdmFyIGdldE93blByb3BlcnR5RGVzY3JpcHRvciA9IF9fd19wZGZqc19yZXF1aXJlX18oMTEpLmY7CiAgICB2YXIgdG9MZW5ndGggPSBfX3dfcGRmanNfcmVxdWlyZV9fKDQ2KTsKICAgIHZhciBub3RBUmVnRXhwID0gX193X3BkZmpzX3JlcXVpcmVfXyg1NSk7CiAgICB2YXIgcmVxdWlyZU9iamVjdENvZXJjaWJsZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTkpOwogICAgdmFyIGNvcnJlY3RJc1JlZ0V4cExvZ2ljID0gX193X3BkZmpzX3JlcXVpcmVfXyg2MCk7CiAgICB2YXIgSVNfUFVSRSA9IF9fd19wZGZqc19yZXF1aXJlX18oMzYpOwogICAgdmFyIG5hdGl2ZVN0YXJ0c1dpdGggPSAnJy5zdGFydHNXaXRoOwogICAgdmFyIG1pbiA9IE1hdGgubWluOwogICAgdmFyIENPUlJFQ1RfSVNfUkVHRVhQX0xPR0lDID0gY29ycmVjdElzUmVnRXhwTG9naWMoJ3N0YXJ0c1dpdGgnKTsKICAgIHZhciBNRE5fUE9MWUZJTExfQlVHID0gIUlTX1BVUkUgJiYgIUNPUlJFQ1RfSVNfUkVHRVhQX0xPR0lDICYmICEhZnVuY3Rpb24gKCkgewogICAgICB2YXIgZGVzY3JpcHRvciA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvcihTdHJpbmcucHJvdG90eXBlLCAnc3RhcnRzV2l0aCcpOwogICAgICByZXR1cm4gZGVzY3JpcHRvciAmJiAhZGVzY3JpcHRvci53cml0YWJsZTsKICAgIH0oKTsKICAgICQoewogICAgICB0YXJnZXQ6ICdTdHJpbmcnLAogICAgICBwcm90bzogdHJ1ZSwKICAgICAgZm9yY2VkOiAhTUROX1BPTFlGSUxMX0JVRyAmJiAhQ09SUkVDVF9JU19SRUdFWFBfTE9HSUMKICAgIH0sIHsKICAgICAgc3RhcnRzV2l0aDogZnVuY3Rpb24gc3RhcnRzV2l0aChzZWFyY2hTdHJpbmcpIHsKICAgICAgICB2YXIgdGhhdCA9IFN0cmluZyhyZXF1aXJlT2JqZWN0Q29lcmNpYmxlKHRoaXMpKTsKICAgICAgICBub3RBUmVnRXhwKHNlYXJjaFN0cmluZyk7CiAgICAgICAgdmFyIGluZGV4ID0gdG9MZW5ndGgobWluKGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkLCB0aGF0Lmxlbmd0aCkpOwogICAgICAgIHZhciBzZWFyY2ggPSBTdHJpbmcoc2VhcmNoU3RyaW5nKTsKICAgICAgICByZXR1cm4gbmF0aXZlU3RhcnRzV2l0aCA/IG5hdGl2ZVN0YXJ0c1dpdGguY2FsbCh0aGF0LCBzZWFyY2gsIGluZGV4KSA6IHRoYXQuc2xpY2UoaW5kZXgsIGluZGV4ICsgc2VhcmNoLmxlbmd0aCkgPT09IHNlYXJjaDsKICAgICAgfQogICAgfSk7CgogICAgLyoqKi99KSwgKAogIC8qIDU1ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGlzUmVnRXhwID0gX193X3BkZmpzX3JlcXVpcmVfXyg1Nik7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkgewogICAgICBpZiAoaXNSZWdFeHAoaXQpKSB7CiAgICAgICAgdGhyb3cgVHlwZUVycm9yKCJUaGUgbWV0aG9kIGRvZXNuJ3QgYWNjZXB0IHJlZ3VsYXIgZXhwcmVzc2lvbnMiKTsKICAgICAgfQogICAgICByZXR1cm4gaXQ7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiA1NiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBpc09iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oMjEpOwogICAgdmFyIGNsYXNzb2YgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE4KTsKICAgIHZhciB3ZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDU3KTsKICAgIHZhciBNQVRDSCA9IHdlbGxLbm93blN5bWJvbCgnbWF0Y2gnKTsKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7CiAgICAgIHZhciBpc1JlZ0V4cDsKICAgICAgcmV0dXJuIGlzT2JqZWN0KGl0KSAmJiAoKGlzUmVnRXhwID0gaXRbTUFUQ0hdKSAhPT0gdW5kZWZpbmVkID8gISFpc1JlZ0V4cCA6IGNsYXNzb2YoaXQpID09ICdSZWdFeHAnKTsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDU3ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGdsb2JhbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTApOwogICAgdmFyIHNoYXJlZCA9IF9fd19wZGZqc19yZXF1aXJlX18oMzUpOwogICAgdmFyIGhhcyA9IF9fd19wZGZqc19yZXF1aXJlX18oMjIpOwogICAgdmFyIHVpZCA9IF9fd19wZGZqc19yZXF1aXJlX18oMzcpOwogICAgdmFyIE5BVElWRV9TWU1CT0wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDU4KTsKICAgIHZhciBVU0VfU1lNQk9MX0FTX1VJRCA9IF9fd19wZGZqc19yZXF1aXJlX18oNTkpOwogICAgdmFyIFdlbGxLbm93blN5bWJvbHNTdG9yZSA9IHNoYXJlZCgnd2tzJyk7CiAgICB2YXIgU3ltYm9sID0gZ2xvYmFsLlN5bWJvbDsKICAgIHZhciBjcmVhdGVXZWxsS25vd25TeW1ib2wgPSBVU0VfU1lNQk9MX0FTX1VJRCA/IFN5bWJvbCA6IFN5bWJvbCAmJiBTeW1ib2wud2l0aG91dFNldHRlciB8fCB1aWQ7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChuYW1lKSB7CiAgICAgIGlmICghaGFzKFdlbGxLbm93blN5bWJvbHNTdG9yZSwgbmFtZSkpIHsKICAgICAgICBpZiAoTkFUSVZFX1NZTUJPTCAmJiBoYXMoU3ltYm9sLCBuYW1lKSkKICAgICAgICBXZWxsS25vd25TeW1ib2xzU3RvcmVbbmFtZV0gPSBTeW1ib2xbbmFtZV07ZWxzZQoKICAgICAgICBXZWxsS25vd25TeW1ib2xzU3RvcmVbbmFtZV0gPSBjcmVhdGVXZWxsS25vd25TeW1ib2woJ1N5bWJvbC4nICsgbmFtZSk7CiAgICAgIH0KICAgICAgcmV0dXJuIFdlbGxLbm93blN5bWJvbHNTdG9yZVtuYW1lXTsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDU4ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGZhaWxzID0gX193X3BkZmpzX3JlcXVpcmVfXygxMyk7CiAgICBtb2R1bGUuZXhwb3J0cyA9ICEhT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyAmJiAhZmFpbHMoZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gIVN0cmluZyhTeW1ib2woKSk7CiAgICB9KTsKCiAgICAvKioqL30pLCAoCiAgLyogNTkgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgTkFUSVZFX1NZTUJPTCA9IF9fd19wZGZqc19yZXF1aXJlX18oNTgpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBOQVRJVkVfU1lNQk9MICYmICFTeW1ib2wuc2hhbSAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09ICdzeW1ib2wnOwoKICAgIC8qKiovfSksICgKICAvKiA2MCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciB3ZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDU3KTsKICAgIHZhciBNQVRDSCA9IHdlbGxLbm93blN5bWJvbCgnbWF0Y2gnKTsKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKE1FVEhPRF9OQU1FKSB7CiAgICAgIHZhciByZWdleHAgPSAvLi87CiAgICAgIHRyeSB7CiAgICAgICAgJy8uLydbTUVUSE9EX05BTUVdKHJlZ2V4cCk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICB0cnkgewogICAgICAgICAgcmVnZXhwW01BVENIXSA9IGZhbHNlOwogICAgICAgICAgcmV0dXJuICcvLi8nW01FVEhPRF9OQU1FXShyZWdleHApOwogICAgICAgIH0gY2F0Y2ggKGYpIHsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogNjEgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgZ2xvYmFsID0gX193X3BkZmpzX3JlcXVpcmVfXygxMCk7CiAgICB2YXIgYmluZCA9IF9fd19wZGZqc19yZXF1aXJlX18oNjIpOwogICAgdmFyIGNhbGwgPSBGdW5jdGlvbi5jYWxsOwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoQ09OU1RSVUNUT1IsIE1FVEhPRCwgbGVuZ3RoKSB7CiAgICAgIHJldHVybiBiaW5kKGNhbGwsIGdsb2JhbFtDT05TVFJVQ1RPUl0ucHJvdG90eXBlW01FVEhPRF0sIGxlbmd0aCk7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiA2MiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBhRnVuY3Rpb24gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDYzKTsKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGZuLCB0aGF0LCBsZW5ndGgpIHsKICAgICAgYUZ1bmN0aW9uKGZuKTsKICAgICAgaWYgKHRoYXQgPT09IHVuZGVmaW5lZCkKICAgICAgcmV0dXJuIGZuOwogICAgICBzd2l0Y2ggKGxlbmd0aCkgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBmbi5jYWxsKHRoYXQpOwogICAgICAgICAgfTsKICAgICAgICBjYXNlIDE6CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgcmV0dXJuIGZuLmNhbGwodGhhdCwgYSk7CiAgICAgICAgICB9OwogICAgICAgIGNhc2UgMjoKICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICByZXR1cm4gZm4uY2FsbCh0aGF0LCBhLCBiKTsKICAgICAgICAgIH07CiAgICAgICAgY2FzZSAzOgogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhLCBiLCBjKSB7CiAgICAgICAgICAgIHJldHVybiBmbi5jYWxsKHRoYXQsIGEsIGIsIGMpOwogICAgICAgICAgfTsKICAgICAgfQogICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBmbi5hcHBseSh0aGF0LCBhcmd1bWVudHMpOwogICAgICB9OwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogNjMgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKCiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkgewogICAgICBpZiAodHlwZW9mIGl0ICE9ICdmdW5jdGlvbicpIHsKICAgICAgICB0aHJvdyBUeXBlRXJyb3IoU3RyaW5nKGl0KSArICcgaXMgbm90IGEgZnVuY3Rpb24nKTsKICAgICAgfQogICAgICByZXR1cm4gaXQ7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiA2NCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIF9fd19wZGZqc19yZXF1aXJlX18oNjUpOwogICAgdmFyIGVudHJ5VW5iaW5kID0gX193X3BkZmpzX3JlcXVpcmVfXyg2MSk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGVudHJ5VW5iaW5kKCdTdHJpbmcnLCAnZW5kc1dpdGgnKTsKCiAgICAvKioqL30pLCAoCiAgLyogNjUgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyICQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDkpOwogICAgdmFyIGdldE93blByb3BlcnR5RGVzY3JpcHRvciA9IF9fd19wZGZqc19yZXF1aXJlX18oMTEpLmY7CiAgICB2YXIgdG9MZW5ndGggPSBfX3dfcGRmanNfcmVxdWlyZV9fKDQ2KTsKICAgIHZhciBub3RBUmVnRXhwID0gX193X3BkZmpzX3JlcXVpcmVfXyg1NSk7CiAgICB2YXIgcmVxdWlyZU9iamVjdENvZXJjaWJsZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTkpOwogICAgdmFyIGNvcnJlY3RJc1JlZ0V4cExvZ2ljID0gX193X3BkZmpzX3JlcXVpcmVfXyg2MCk7CiAgICB2YXIgSVNfUFVSRSA9IF9fd19wZGZqc19yZXF1aXJlX18oMzYpOwogICAgdmFyIG5hdGl2ZUVuZHNXaXRoID0gJycuZW5kc1dpdGg7CiAgICB2YXIgbWluID0gTWF0aC5taW47CiAgICB2YXIgQ09SUkVDVF9JU19SRUdFWFBfTE9HSUMgPSBjb3JyZWN0SXNSZWdFeHBMb2dpYygnZW5kc1dpdGgnKTsKICAgIHZhciBNRE5fUE9MWUZJTExfQlVHID0gIUlTX1BVUkUgJiYgIUNPUlJFQ1RfSVNfUkVHRVhQX0xPR0lDICYmICEhZnVuY3Rpb24gKCkgewogICAgICB2YXIgZGVzY3JpcHRvciA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvcihTdHJpbmcucHJvdG90eXBlLCAnZW5kc1dpdGgnKTsKICAgICAgcmV0dXJuIGRlc2NyaXB0b3IgJiYgIWRlc2NyaXB0b3Iud3JpdGFibGU7CiAgICB9KCk7CiAgICAkKHsKICAgICAgdGFyZ2V0OiAnU3RyaW5nJywKICAgICAgcHJvdG86IHRydWUsCiAgICAgIGZvcmNlZDogIU1ETl9QT0xZRklMTF9CVUcgJiYgIUNPUlJFQ1RfSVNfUkVHRVhQX0xPR0lDCiAgICB9LCB7CiAgICAgIGVuZHNXaXRoOiBmdW5jdGlvbiBlbmRzV2l0aChzZWFyY2hTdHJpbmcpIHsKICAgICAgICB2YXIgdGhhdCA9IFN0cmluZyhyZXF1aXJlT2JqZWN0Q29lcmNpYmxlKHRoaXMpKTsKICAgICAgICBub3RBUmVnRXhwKHNlYXJjaFN0cmluZyk7CiAgICAgICAgdmFyIGVuZFBvc2l0aW9uID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQ7CiAgICAgICAgdmFyIGxlbiA9IHRvTGVuZ3RoKHRoYXQubGVuZ3RoKTsKICAgICAgICB2YXIgZW5kID0gZW5kUG9zaXRpb24gPT09IHVuZGVmaW5lZCA/IGxlbiA6IG1pbih0b0xlbmd0aChlbmRQb3NpdGlvbiksIGxlbik7CiAgICAgICAgdmFyIHNlYXJjaCA9IFN0cmluZyhzZWFyY2hTdHJpbmcpOwogICAgICAgIHJldHVybiBuYXRpdmVFbmRzV2l0aCA/IG5hdGl2ZUVuZHNXaXRoLmNhbGwodGhhdCwgc2VhcmNoLCBlbmQpIDogdGhhdC5zbGljZShlbmQgLSBzZWFyY2gubGVuZ3RoLCBlbmQpID09PSBzZWFyY2g7CiAgICAgIH0KICAgIH0pOwoKICAgIC8qKiovfSksICgKICAvKiA2NiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIF9fd19wZGZqc19yZXF1aXJlX18oNjcpOwogICAgdmFyIGVudHJ5VW5iaW5kID0gX193X3BkZmpzX3JlcXVpcmVfXyg2MSk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGVudHJ5VW5iaW5kKCdTdHJpbmcnLCAnaW5jbHVkZXMnKTsKCiAgICAvKioqL30pLCAoCiAgLyogNjcgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyICQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDkpOwogICAgdmFyIG5vdEFSZWdFeHAgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDU1KTsKICAgIHZhciByZXF1aXJlT2JqZWN0Q29lcmNpYmxlID0gX193X3BkZmpzX3JlcXVpcmVfXygxOSk7CiAgICB2YXIgY29ycmVjdElzUmVnRXhwTG9naWMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDYwKTsKICAgICQoewogICAgICB0YXJnZXQ6ICdTdHJpbmcnLAogICAgICBwcm90bzogdHJ1ZSwKICAgICAgZm9yY2VkOiAhY29ycmVjdElzUmVnRXhwTG9naWMoJ2luY2x1ZGVzJykKICAgIH0sIHsKICAgICAgaW5jbHVkZXM6IGZ1bmN0aW9uIGluY2x1ZGVzKHNlYXJjaFN0cmluZykgewogICAgICAgIHJldHVybiAhIX5TdHJpbmcocmVxdWlyZU9iamVjdENvZXJjaWJsZSh0aGlzKSkuaW5kZXhPZihub3RBUmVnRXhwKHNlYXJjaFN0cmluZyksIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkKTsKICAgICAgfQogICAgfSk7CgogICAgLyoqKi99KSwgKAogIC8qIDY4ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgX193X3BkZmpzX3JlcXVpcmVfXyg2OSk7CiAgICB2YXIgZW50cnlVbmJpbmQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDYxKTsKICAgIG1vZHVsZS5leHBvcnRzID0gZW50cnlVbmJpbmQoJ0FycmF5JywgJ2luY2x1ZGVzJyk7CgogICAgLyoqKi99KSwgKAogIC8qIDY5ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciAkID0gX193X3BkZmpzX3JlcXVpcmVfXyg5KTsKICAgIHZhciAkaW5jbHVkZXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDQ1KS5pbmNsdWRlczsKICAgIHZhciBhZGRUb1Vuc2NvcGFibGVzID0gX193X3BkZmpzX3JlcXVpcmVfXyg3MCk7CiAgICB2YXIgYXJyYXlNZXRob2RVc2VzVG9MZW5ndGggPSBfX3dfcGRmanNfcmVxdWlyZV9fKDc1KTsKICAgIHZhciBVU0VTX1RPX0xFTkdUSCA9IGFycmF5TWV0aG9kVXNlc1RvTGVuZ3RoKCdpbmRleE9mJywgewogICAgICBBQ0NFU1NPUlM6IHRydWUsCiAgICAgIDE6IDAKICAgIH0pOwogICAgJCh7CiAgICAgIHRhcmdldDogJ0FycmF5JywKICAgICAgcHJvdG86IHRydWUsCiAgICAgIGZvcmNlZDogIVVTRVNfVE9fTEVOR1RICiAgICB9LCB7CiAgICAgIGluY2x1ZGVzOiBmdW5jdGlvbiBpbmNsdWRlcyhlbCkgewogICAgICAgIHJldHVybiAkaW5jbHVkZXModGhpcywgZWwsIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkKTsKICAgICAgfQogICAgfSk7CiAgICBhZGRUb1Vuc2NvcGFibGVzKCdpbmNsdWRlcycpOwoKICAgIC8qKiovfSksICgKICAvKiA3MCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciB3ZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDU3KTsKICAgIHZhciBjcmVhdGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDcxKTsKICAgIHZhciBkZWZpbmVQcm9wZXJ0eU1vZHVsZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjYpOwogICAgdmFyIFVOU0NPUEFCTEVTID0gd2VsbEtub3duU3ltYm9sKCd1bnNjb3BhYmxlcycpOwogICAgdmFyIEFycmF5UHJvdG90eXBlID0gQXJyYXkucHJvdG90eXBlOwogICAgaWYgKEFycmF5UHJvdG90eXBlW1VOU0NPUEFCTEVTXSA9PSB1bmRlZmluZWQpIHsKICAgICAgZGVmaW5lUHJvcGVydHlNb2R1bGUuZihBcnJheVByb3RvdHlwZSwgVU5TQ09QQUJMRVMsIHsKICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgdmFsdWU6IGNyZWF0ZShudWxsKQogICAgICB9KTsKICAgIH0KICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGtleSkgewogICAgICBBcnJheVByb3RvdHlwZVtVTlNDT1BBQkxFU11ba2V5XSA9IHRydWU7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiA3MSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBhbk9iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oMjcpOwogICAgdmFyIGRlZmluZVByb3BlcnRpZXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDcyKTsKICAgIHZhciBlbnVtQnVnS2V5cyA9IF9fd19wZGZqc19yZXF1aXJlX18oNDkpOwogICAgdmFyIGhpZGRlbktleXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDM4KTsKICAgIHZhciBodG1sID0gX193X3BkZmpzX3JlcXVpcmVfXyg3NCk7CiAgICB2YXIgZG9jdW1lbnRDcmVhdGVFbGVtZW50ID0gX193X3BkZmpzX3JlcXVpcmVfXygyNCk7CiAgICB2YXIgc2hhcmVkS2V5ID0gX193X3BkZmpzX3JlcXVpcmVfXygzNCk7CiAgICB2YXIgR1QgPSAnPic7CiAgICB2YXIgTFQgPSAnPCc7CiAgICB2YXIgUFJPVE9UWVBFID0gJ3Byb3RvdHlwZSc7CiAgICB2YXIgU0NSSVBUID0gJ3NjcmlwdCc7CiAgICB2YXIgSUVfUFJPVE8gPSBzaGFyZWRLZXkoJ0lFX1BST1RPJyk7CiAgICB2YXIgRW1wdHlDb25zdHJ1Y3RvciA9IGZ1bmN0aW9uIEVtcHR5Q29uc3RydWN0b3IoKSB7CiAgICB9OwogICAgdmFyIHNjcmlwdFRhZyA9IGZ1bmN0aW9uIHNjcmlwdFRhZyhjb250ZW50KSB7CiAgICAgIHJldHVybiBMVCArIFNDUklQVCArIEdUICsgY29udGVudCArIExUICsgJy8nICsgU0NSSVBUICsgR1Q7CiAgICB9OwogICAgdmFyIE51bGxQcm90b09iamVjdFZpYUFjdGl2ZVggPSBmdW5jdGlvbiBOdWxsUHJvdG9PYmplY3RWaWFBY3RpdmVYKGFjdGl2ZVhEb2N1bWVudCkgewogICAgICBhY3RpdmVYRG9jdW1lbnQud3JpdGUoc2NyaXB0VGFnKCcnKSk7CiAgICAgIGFjdGl2ZVhEb2N1bWVudC5jbG9zZSgpOwogICAgICB2YXIgdGVtcCA9IGFjdGl2ZVhEb2N1bWVudC5wYXJlbnRXaW5kb3cuT2JqZWN0OwogICAgICBhY3RpdmVYRG9jdW1lbnQgPSBudWxsOwogICAgICByZXR1cm4gdGVtcDsKICAgIH07CiAgICB2YXIgTnVsbFByb3RvT2JqZWN0VmlhSUZyYW1lID0gZnVuY3Rpb24gTnVsbFByb3RvT2JqZWN0VmlhSUZyYW1lKCkgewogICAgICB2YXIgaWZyYW1lID0gZG9jdW1lbnRDcmVhdGVFbGVtZW50KCdpZnJhbWUnKTsKICAgICAgdmFyIEpTID0gJ2phdmEnICsgU0NSSVBUICsgJzonOwogICAgICB2YXIgaWZyYW1lRG9jdW1lbnQ7CiAgICAgIGlmcmFtZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICBodG1sLmFwcGVuZENoaWxkKGlmcmFtZSk7CiAgICAgIGlmcmFtZS5zcmMgPSBTdHJpbmcoSlMpOwogICAgICBpZnJhbWVEb2N1bWVudCA9IGlmcmFtZS5jb250ZW50V2luZG93LmRvY3VtZW50OwogICAgICBpZnJhbWVEb2N1bWVudC5vcGVuKCk7CiAgICAgIGlmcmFtZURvY3VtZW50LndyaXRlKHNjcmlwdFRhZygnZG9jdW1lbnQuRj1PYmplY3QnKSk7CiAgICAgIGlmcmFtZURvY3VtZW50LmNsb3NlKCk7CiAgICAgIHJldHVybiBpZnJhbWVEb2N1bWVudC5GOwogICAgfTsKICAgIHZhciBhY3RpdmVYRG9jdW1lbnQ7CiAgICB2YXIgX051bGxQcm90b09iamVjdCA9IGZ1bmN0aW9uIE51bGxQcm90b09iamVjdCgpIHsKICAgICAgdHJ5IHsKICAgICAgICBhY3RpdmVYRG9jdW1lbnQgPSBkb2N1bWVudC5kb21haW4gJiYgbmV3IEFjdGl2ZVhPYmplY3QoJ2h0bWxmaWxlJyk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIH0KICAgICAgX051bGxQcm90b09iamVjdCA9IGFjdGl2ZVhEb2N1bWVudCA/IE51bGxQcm90b09iamVjdFZpYUFjdGl2ZVgoYWN0aXZlWERvY3VtZW50KSA6IE51bGxQcm90b09iamVjdFZpYUlGcmFtZSgpOwogICAgICB2YXIgbGVuZ3RoID0gZW51bUJ1Z0tleXMubGVuZ3RoOwogICAgICB3aGlsZSAobGVuZ3RoLS0pCiAgICAgIGRlbGV0ZSBfTnVsbFByb3RvT2JqZWN0W1BST1RPVFlQRV1bZW51bUJ1Z0tleXNbbGVuZ3RoXV07CiAgICAgIHJldHVybiBfTnVsbFByb3RvT2JqZWN0KCk7CiAgICB9OwogICAgaGlkZGVuS2V5c1tJRV9QUk9UT10gPSB0cnVlOwogICAgbW9kdWxlLmV4cG9ydHMgPSBPYmplY3QuY3JlYXRlIHx8IGZ1bmN0aW9uIGNyZWF0ZShPLCBQcm9wZXJ0aWVzKSB7CiAgICAgIHZhciByZXN1bHQ7CiAgICAgIGlmIChPICE9PSBudWxsKSB7CiAgICAgICAgRW1wdHlDb25zdHJ1Y3RvcltQUk9UT1RZUEVdID0gYW5PYmplY3QoTyk7CiAgICAgICAgcmVzdWx0ID0gbmV3IEVtcHR5Q29uc3RydWN0b3IoKTsKICAgICAgICBFbXB0eUNvbnN0cnVjdG9yW1BST1RPVFlQRV0gPSBudWxsOwogICAgICAgIHJlc3VsdFtJRV9QUk9UT10gPSBPOwogICAgICB9IGVsc2UKICAgICAgcmVzdWx0ID0gX051bGxQcm90b09iamVjdCgpOwogICAgICByZXR1cm4gUHJvcGVydGllcyA9PT0gdW5kZWZpbmVkID8gcmVzdWx0IDogZGVmaW5lUHJvcGVydGllcyhyZXN1bHQsIFByb3BlcnRpZXMpOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogNzIgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgREVTQ1JJUFRPUlMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEyKTsKICAgIHZhciBkZWZpbmVQcm9wZXJ0eU1vZHVsZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjYpOwogICAgdmFyIGFuT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygyNyk7CiAgICB2YXIgb2JqZWN0S2V5cyA9IF9fd19wZGZqc19yZXF1aXJlX18oNzMpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBERVNDUklQVE9SUyA/IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzIDogZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyhPLCBQcm9wZXJ0aWVzKSB7CiAgICAgIGFuT2JqZWN0KE8pOwogICAgICB2YXIga2V5cyA9IG9iamVjdEtleXMoUHJvcGVydGllcyk7CiAgICAgIHZhciBsZW5ndGggPSBrZXlzLmxlbmd0aDsKICAgICAgdmFyIGluZGV4ID0gMDsKICAgICAgdmFyIGtleTsKICAgICAgd2hpbGUgKGxlbmd0aCA+IGluZGV4KQogICAgICBkZWZpbmVQcm9wZXJ0eU1vZHVsZS5mKE8sIGtleSA9IGtleXNbaW5kZXgrK10sIFByb3BlcnRpZXNba2V5XSk7CiAgICAgIHJldHVybiBPOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogNzMgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgaW50ZXJuYWxPYmplY3RLZXlzID0gX193X3BkZmpzX3JlcXVpcmVfXyg0NCk7CiAgICB2YXIgZW51bUJ1Z0tleXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDQ5KTsKICAgIG1vZHVsZS5leHBvcnRzID0gT2JqZWN0LmtleXMgfHwgZnVuY3Rpb24ga2V5cyhPKSB7CiAgICAgIHJldHVybiBpbnRlcm5hbE9iamVjdEtleXMoTywgZW51bUJ1Z0tleXMpOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogNzQgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgZ2V0QnVpbHRJbiA9IF9fd19wZGZqc19yZXF1aXJlX18oNDEpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBnZXRCdWlsdEluKCdkb2N1bWVudCcsICdkb2N1bWVudEVsZW1lbnQnKTsKCiAgICAvKioqL30pLCAoCiAgLyogNzUgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgREVTQ1JJUFRPUlMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEyKTsKICAgIHZhciBmYWlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTMpOwogICAgdmFyIGhhcyA9IF9fd19wZGZqc19yZXF1aXJlX18oMjIpOwogICAgdmFyIGRlZmluZVByb3BlcnR5ID0gT2JqZWN0LmRlZmluZVByb3BlcnR5OwogICAgdmFyIGNhY2hlID0ge307CiAgICB2YXIgdGhyb3dlciA9IGZ1bmN0aW9uIHRocm93ZXIoaXQpIHsKICAgICAgdGhyb3cgaXQ7CiAgICB9OwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoTUVUSE9EX05BTUUsIG9wdGlvbnMpIHsKICAgICAgaWYgKGhhcyhjYWNoZSwgTUVUSE9EX05BTUUpKQogICAgICByZXR1cm4gY2FjaGVbTUVUSE9EX05BTUVdOwogICAgICBpZiAoIW9wdGlvbnMpCiAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgdmFyIG1ldGhvZCA9IFtdW01FVEhPRF9OQU1FXTsKICAgICAgdmFyIEFDQ0VTU09SUyA9IGhhcyhvcHRpb25zLCAnQUNDRVNTT1JTJykgPyBvcHRpb25zLkFDQ0VTU09SUyA6IGZhbHNlOwogICAgICB2YXIgYXJndW1lbnQwID0gaGFzKG9wdGlvbnMsIDApID8gb3B0aW9uc1swXSA6IHRocm93ZXI7CiAgICAgIHZhciBhcmd1bWVudDEgPSBoYXMob3B0aW9ucywgMSkgPyBvcHRpb25zWzFdIDogdW5kZWZpbmVkOwogICAgICByZXR1cm4gY2FjaGVbTUVUSE9EX05BTUVdID0gISFtZXRob2QgJiYgIWZhaWxzKGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoQUNDRVNTT1JTICYmICFERVNDUklQVE9SUykKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB2YXIgTyA9IHsgbGVuZ3RoOiAtMSB9OwogICAgICAgIGlmIChBQ0NFU1NPUlMpCiAgICAgICAgZGVmaW5lUHJvcGVydHkoTywgMSwgewogICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgIGdldDogdGhyb3dlcgogICAgICAgIH0pO2Vsc2UKCiAgICAgICAgT1sxXSA9IDE7CiAgICAgICAgbWV0aG9kLmNhbGwoTywgYXJndW1lbnQwLCBhcmd1bWVudDEpOwogICAgICB9KTsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDc2ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgX193X3BkZmpzX3JlcXVpcmVfXyg3Nyk7CiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDg5KTsKICAgIHZhciBwYXRoID0gX193X3BkZmpzX3JlcXVpcmVfXyg0Mik7CiAgICBtb2R1bGUuZXhwb3J0cyA9IHBhdGguQXJyYXkuZnJvbTsKCiAgICAvKioqL30pLCAoCiAgLyogNzcgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGNoYXJBdCA9IF9fd19wZGZqc19yZXF1aXJlX18oNzgpLmNoYXJBdDsKICAgIHZhciBJbnRlcm5hbFN0YXRlTW9kdWxlID0gX193X3BkZmpzX3JlcXVpcmVfXygzMik7CiAgICB2YXIgZGVmaW5lSXRlcmF0b3IgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDc5KTsKICAgIHZhciBTVFJJTkdfSVRFUkFUT1IgPSAnU3RyaW5nIEl0ZXJhdG9yJzsKICAgIHZhciBzZXRJbnRlcm5hbFN0YXRlID0gSW50ZXJuYWxTdGF0ZU1vZHVsZS5zZXQ7CiAgICB2YXIgZ2V0SW50ZXJuYWxTdGF0ZSA9IEludGVybmFsU3RhdGVNb2R1bGUuZ2V0dGVyRm9yKFNUUklOR19JVEVSQVRPUik7CiAgICBkZWZpbmVJdGVyYXRvcihTdHJpbmcsICdTdHJpbmcnLCBmdW5jdGlvbiAoaXRlcmF0ZWQpIHsKICAgICAgc2V0SW50ZXJuYWxTdGF0ZSh0aGlzLCB7CiAgICAgICAgdHlwZTogU1RSSU5HX0lURVJBVE9SLAogICAgICAgIHN0cmluZzogU3RyaW5nKGl0ZXJhdGVkKSwKICAgICAgICBpbmRleDogMAogICAgICB9KTsKICAgIH0sIGZ1bmN0aW9uIG5leHQoKSB7CiAgICAgIHZhciBzdGF0ZSA9IGdldEludGVybmFsU3RhdGUodGhpcyk7CiAgICAgIHZhciBzdHJpbmcgPSBzdGF0ZS5zdHJpbmc7CiAgICAgIHZhciBpbmRleCA9IHN0YXRlLmluZGV4OwogICAgICB2YXIgcG9pbnQ7CiAgICAgIGlmIChpbmRleCA+PSBzdHJpbmcubGVuZ3RoKQogICAgICByZXR1cm4gewogICAgICAgIHZhbHVlOiB1bmRlZmluZWQsCiAgICAgICAgZG9uZTogdHJ1ZQogICAgICB9OwogICAgICBwb2ludCA9IGNoYXJBdChzdHJpbmcsIGluZGV4KTsKICAgICAgc3RhdGUuaW5kZXggKz0gcG9pbnQubGVuZ3RoOwogICAgICByZXR1cm4gewogICAgICAgIHZhbHVlOiBwb2ludCwKICAgICAgICBkb25lOiBmYWxzZQogICAgICB9OwogICAgfSk7CgogICAgLyoqKi99KSwgKAogIC8qIDc4ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIHRvSW50ZWdlciA9IF9fd19wZGZqc19yZXF1aXJlX18oNDcpOwogICAgdmFyIHJlcXVpcmVPYmplY3RDb2VyY2libGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE5KTsKICAgIHZhciBjcmVhdGVNZXRob2QgPSBmdW5jdGlvbiBjcmVhdGVNZXRob2QoQ09OVkVSVF9UT19TVFJJTkcpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uICgkdGhpcywgcG9zKSB7CiAgICAgICAgdmFyIFMgPSBTdHJpbmcocmVxdWlyZU9iamVjdENvZXJjaWJsZSgkdGhpcykpOwogICAgICAgIHZhciBwb3NpdGlvbiA9IHRvSW50ZWdlcihwb3MpOwogICAgICAgIHZhciBzaXplID0gUy5sZW5ndGg7CiAgICAgICAgdmFyIGZpcnN0LCBzZWNvbmQ7CiAgICAgICAgaWYgKHBvc2l0aW9uIDwgMCB8fCBwb3NpdGlvbiA+PSBzaXplKQogICAgICAgIHJldHVybiBDT05WRVJUX1RPX1NUUklORyA/ICcnIDogdW5kZWZpbmVkOwogICAgICAgIGZpcnN0ID0gUy5jaGFyQ29kZUF0KHBvc2l0aW9uKTsKICAgICAgICByZXR1cm4gZmlyc3QgPCAweEQ4MDAgfHwgZmlyc3QgPiAweERCRkYgfHwgcG9zaXRpb24gKyAxID09PSBzaXplIHx8IChzZWNvbmQgPSBTLmNoYXJDb2RlQXQocG9zaXRpb24gKyAxKSkgPCAweERDMDAgfHwgc2Vjb25kID4gMHhERkZGID8gQ09OVkVSVF9UT19TVFJJTkcgPyBTLmNoYXJBdChwb3NpdGlvbikgOiBmaXJzdCA6IENPTlZFUlRfVE9fU1RSSU5HID8gUy5zbGljZShwb3NpdGlvbiwgcG9zaXRpb24gKyAyKSA6IChmaXJzdCAtIDB4RDgwMCA8PCAxMCkgKyAoc2Vjb25kIC0gMHhEQzAwKSArIDB4MTAwMDA7CiAgICAgIH07CiAgICB9OwogICAgbW9kdWxlLmV4cG9ydHMgPSB7CiAgICAgIGNvZGVBdDogY3JlYXRlTWV0aG9kKGZhbHNlKSwKICAgICAgY2hhckF0OiBjcmVhdGVNZXRob2QodHJ1ZSkKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDc5ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciAkID0gX193X3BkZmpzX3JlcXVpcmVfXyg5KTsKICAgIHZhciBjcmVhdGVJdGVyYXRvckNvbnN0cnVjdG9yID0gX193X3BkZmpzX3JlcXVpcmVfXyg4MCk7CiAgICB2YXIgZ2V0UHJvdG90eXBlT2YgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDgyKTsKICAgIHZhciBzZXRQcm90b3R5cGVPZiA9IF9fd19wZGZqc19yZXF1aXJlX18oODcpOwogICAgdmFyIHNldFRvU3RyaW5nVGFnID0gX193X3BkZmpzX3JlcXVpcmVfXyg4NSk7CiAgICB2YXIgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5ID0gX193X3BkZmpzX3JlcXVpcmVfXygyNSk7CiAgICB2YXIgcmVkZWZpbmUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDI4KTsKICAgIHZhciB3ZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDU3KTsKICAgIHZhciBJU19QVVJFID0gX193X3BkZmpzX3JlcXVpcmVfXygzNik7CiAgICB2YXIgSXRlcmF0b3JzID0gX193X3BkZmpzX3JlcXVpcmVfXyg4Nik7CiAgICB2YXIgSXRlcmF0b3JzQ29yZSA9IF9fd19wZGZqc19yZXF1aXJlX18oODEpOwogICAgdmFyIEl0ZXJhdG9yUHJvdG90eXBlID0gSXRlcmF0b3JzQ29yZS5JdGVyYXRvclByb3RvdHlwZTsKICAgIHZhciBCVUdHWV9TQUZBUklfSVRFUkFUT1JTID0gSXRlcmF0b3JzQ29yZS5CVUdHWV9TQUZBUklfSVRFUkFUT1JTOwogICAgdmFyIElURVJBVE9SID0gd2VsbEtub3duU3ltYm9sKCdpdGVyYXRvcicpOwogICAgdmFyIEtFWVMgPSAna2V5cyc7CiAgICB2YXIgVkFMVUVTID0gJ3ZhbHVlcyc7CiAgICB2YXIgRU5UUklFUyA9ICdlbnRyaWVzJzsKICAgIHZhciByZXR1cm5UaGlzID0gZnVuY3Rpb24gcmV0dXJuVGhpcygpIHsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoSXRlcmFibGUsIE5BTUUsIEl0ZXJhdG9yQ29uc3RydWN0b3IsIG5leHQsIERFRkFVTFQsIElTX1NFVCwgRk9SQ0VEKSB7CiAgICAgIGNyZWF0ZUl0ZXJhdG9yQ29uc3RydWN0b3IoSXRlcmF0b3JDb25zdHJ1Y3RvciwgTkFNRSwgbmV4dCk7CiAgICAgIHZhciBnZXRJdGVyYXRpb25NZXRob2QgPSBmdW5jdGlvbiBnZXRJdGVyYXRpb25NZXRob2QoS0lORCkgewogICAgICAgIGlmIChLSU5EID09PSBERUZBVUxUICYmIGRlZmF1bHRJdGVyYXRvcikKICAgICAgICByZXR1cm4gZGVmYXVsdEl0ZXJhdG9yOwogICAgICAgIGlmICghQlVHR1lfU0FGQVJJX0lURVJBVE9SUyAmJiBLSU5EIGluIEl0ZXJhYmxlUHJvdG90eXBlKQogICAgICAgIHJldHVybiBJdGVyYWJsZVByb3RvdHlwZVtLSU5EXTsKICAgICAgICBzd2l0Y2ggKEtJTkQpIHsKICAgICAgICAgIGNhc2UgS0VZUzoKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGtleXMoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBJdGVyYXRvckNvbnN0cnVjdG9yKHRoaXMsIEtJTkQpOwogICAgICAgICAgICB9OwogICAgICAgICAgY2FzZSBWQUxVRVM6CiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiB2YWx1ZXMoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBJdGVyYXRvckNvbnN0cnVjdG9yKHRoaXMsIEtJTkQpOwogICAgICAgICAgICB9OwogICAgICAgICAgY2FzZSBFTlRSSUVTOgogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gZW50cmllcygpIHsKICAgICAgICAgICAgICByZXR1cm4gbmV3IEl0ZXJhdG9yQ29uc3RydWN0b3IodGhpcywgS0lORCk7CiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gbmV3IEl0ZXJhdG9yQ29uc3RydWN0b3IodGhpcyk7CiAgICAgICAgfTsKICAgICAgfTsKICAgICAgdmFyIFRPX1NUUklOR19UQUcgPSBOQU1FICsgJyBJdGVyYXRvcic7CiAgICAgIHZhciBJTkNPUlJFQ1RfVkFMVUVTX05BTUUgPSBmYWxzZTsKICAgICAgdmFyIEl0ZXJhYmxlUHJvdG90eXBlID0gSXRlcmFibGUucHJvdG90eXBlOwogICAgICB2YXIgbmF0aXZlSXRlcmF0b3IgPSBJdGVyYWJsZVByb3RvdHlwZVtJVEVSQVRPUl0gfHwgSXRlcmFibGVQcm90b3R5cGVbJ0BAaXRlcmF0b3InXSB8fCBERUZBVUxUICYmIEl0ZXJhYmxlUHJvdG90eXBlW0RFRkFVTFRdOwogICAgICB2YXIgZGVmYXVsdEl0ZXJhdG9yID0gIUJVR0dZX1NBRkFSSV9JVEVSQVRPUlMgJiYgbmF0aXZlSXRlcmF0b3IgfHwgZ2V0SXRlcmF0aW9uTWV0aG9kKERFRkFVTFQpOwogICAgICB2YXIgYW55TmF0aXZlSXRlcmF0b3IgPSBOQU1FID09ICdBcnJheScgPyBJdGVyYWJsZVByb3RvdHlwZS5lbnRyaWVzIHx8IG5hdGl2ZUl0ZXJhdG9yIDogbmF0aXZlSXRlcmF0b3I7CiAgICAgIHZhciBDdXJyZW50SXRlcmF0b3JQcm90b3R5cGUsIG1ldGhvZHMsIEtFWTsKICAgICAgaWYgKGFueU5hdGl2ZUl0ZXJhdG9yKSB7CiAgICAgICAgQ3VycmVudEl0ZXJhdG9yUHJvdG90eXBlID0gZ2V0UHJvdG90eXBlT2YoYW55TmF0aXZlSXRlcmF0b3IuY2FsbChuZXcgSXRlcmFibGUoKSkpOwogICAgICAgIGlmIChJdGVyYXRvclByb3RvdHlwZSAhPT0gT2JqZWN0LnByb3RvdHlwZSAmJiBDdXJyZW50SXRlcmF0b3JQcm90b3R5cGUubmV4dCkgewogICAgICAgICAgaWYgKCFJU19QVVJFICYmIGdldFByb3RvdHlwZU9mKEN1cnJlbnRJdGVyYXRvclByb3RvdHlwZSkgIT09IEl0ZXJhdG9yUHJvdG90eXBlKSB7CiAgICAgICAgICAgIGlmIChzZXRQcm90b3R5cGVPZikgewogICAgICAgICAgICAgIHNldFByb3RvdHlwZU9mKEN1cnJlbnRJdGVyYXRvclByb3RvdHlwZSwgSXRlcmF0b3JQcm90b3R5cGUpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBDdXJyZW50SXRlcmF0b3JQcm90b3R5cGVbSVRFUkFUT1JdICE9ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkoQ3VycmVudEl0ZXJhdG9yUHJvdG90eXBlLCBJVEVSQVRPUiwgcmV0dXJuVGhpcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHNldFRvU3RyaW5nVGFnKEN1cnJlbnRJdGVyYXRvclByb3RvdHlwZSwgVE9fU1RSSU5HX1RBRywgdHJ1ZSwgdHJ1ZSk7CiAgICAgICAgICBpZiAoSVNfUFVSRSkKICAgICAgICAgIEl0ZXJhdG9yc1tUT19TVFJJTkdfVEFHXSA9IHJldHVyblRoaXM7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChERUZBVUxUID09IFZBTFVFUyAmJiBuYXRpdmVJdGVyYXRvciAmJiBuYXRpdmVJdGVyYXRvci5uYW1lICE9PSBWQUxVRVMpIHsKICAgICAgICBJTkNPUlJFQ1RfVkFMVUVTX05BTUUgPSB0cnVlOwogICAgICAgIGRlZmF1bHRJdGVyYXRvciA9IGZ1bmN0aW9uIHZhbHVlcygpIHsKICAgICAgICAgIHJldHVybiBuYXRpdmVJdGVyYXRvci5jYWxsKHRoaXMpOwogICAgICAgIH07CiAgICAgIH0KICAgICAgaWYgKCghSVNfUFVSRSB8fCBGT1JDRUQpICYmIEl0ZXJhYmxlUHJvdG90eXBlW0lURVJBVE9SXSAhPT0gZGVmYXVsdEl0ZXJhdG9yKSB7CiAgICAgICAgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5KEl0ZXJhYmxlUHJvdG90eXBlLCBJVEVSQVRPUiwgZGVmYXVsdEl0ZXJhdG9yKTsKICAgICAgfQogICAgICBJdGVyYXRvcnNbTkFNRV0gPSBkZWZhdWx0SXRlcmF0b3I7CiAgICAgIGlmIChERUZBVUxUKSB7CiAgICAgICAgbWV0aG9kcyA9IHsKICAgICAgICAgIHZhbHVlczogZ2V0SXRlcmF0aW9uTWV0aG9kKFZBTFVFUyksCiAgICAgICAgICBrZXlzOiBJU19TRVQgPyBkZWZhdWx0SXRlcmF0b3IgOiBnZXRJdGVyYXRpb25NZXRob2QoS0VZUyksCiAgICAgICAgICBlbnRyaWVzOiBnZXRJdGVyYXRpb25NZXRob2QoRU5UUklFUykKICAgICAgICB9OwogICAgICAgIGlmIChGT1JDRUQpCiAgICAgICAgZm9yIChLRVkgaW4gbWV0aG9kcykgewogICAgICAgICAgaWYgKEJVR0dZX1NBRkFSSV9JVEVSQVRPUlMgfHwgSU5DT1JSRUNUX1ZBTFVFU19OQU1FIHx8ICEoS0VZIGluIEl0ZXJhYmxlUHJvdG90eXBlKSkgewogICAgICAgICAgICByZWRlZmluZShJdGVyYWJsZVByb3RvdHlwZSwgS0VZLCBtZXRob2RzW0tFWV0pOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZQoKICAgICAgICAkKHsKICAgICAgICAgIHRhcmdldDogTkFNRSwKICAgICAgICAgIHByb3RvOiB0cnVlLAogICAgICAgICAgZm9yY2VkOiBCVUdHWV9TQUZBUklfSVRFUkFUT1JTIHx8IElOQ09SUkVDVF9WQUxVRVNfTkFNRQogICAgICAgIH0sIG1ldGhvZHMpOwogICAgICB9CiAgICAgIHJldHVybiBtZXRob2RzOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogODAgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIEl0ZXJhdG9yUHJvdG90eXBlID0gX193X3BkZmpzX3JlcXVpcmVfXyg4MSkuSXRlcmF0b3JQcm90b3R5cGU7CiAgICB2YXIgY3JlYXRlID0gX193X3BkZmpzX3JlcXVpcmVfXyg3MSk7CiAgICB2YXIgY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yID0gX193X3BkZmpzX3JlcXVpcmVfXygxNSk7CiAgICB2YXIgc2V0VG9TdHJpbmdUYWcgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDg1KTsKICAgIHZhciBJdGVyYXRvcnMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDg2KTsKICAgIHZhciByZXR1cm5UaGlzID0gZnVuY3Rpb24gcmV0dXJuVGhpcygpIHsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoSXRlcmF0b3JDb25zdHJ1Y3RvciwgTkFNRSwgbmV4dCkgewogICAgICB2YXIgVE9fU1RSSU5HX1RBRyA9IE5BTUUgKyAnIEl0ZXJhdG9yJzsKICAgICAgSXRlcmF0b3JDb25zdHJ1Y3Rvci5wcm90b3R5cGUgPSBjcmVhdGUoSXRlcmF0b3JQcm90b3R5cGUsIHsgbmV4dDogY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yKDEsIG5leHQpIH0pOwogICAgICBzZXRUb1N0cmluZ1RhZyhJdGVyYXRvckNvbnN0cnVjdG9yLCBUT19TVFJJTkdfVEFHLCBmYWxzZSwgdHJ1ZSk7CiAgICAgIEl0ZXJhdG9yc1tUT19TVFJJTkdfVEFHXSA9IHJldHVyblRoaXM7CiAgICAgIHJldHVybiBJdGVyYXRvckNvbnN0cnVjdG9yOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogODEgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGdldFByb3RvdHlwZU9mID0gX193X3BkZmpzX3JlcXVpcmVfXyg4Mik7CiAgICB2YXIgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5ID0gX193X3BkZmpzX3JlcXVpcmVfXygyNSk7CiAgICB2YXIgaGFzID0gX193X3BkZmpzX3JlcXVpcmVfXygyMik7CiAgICB2YXIgd2VsbEtub3duU3ltYm9sID0gX193X3BkZmpzX3JlcXVpcmVfXyg1Nyk7CiAgICB2YXIgSVNfUFVSRSA9IF9fd19wZGZqc19yZXF1aXJlX18oMzYpOwogICAgdmFyIElURVJBVE9SID0gd2VsbEtub3duU3ltYm9sKCdpdGVyYXRvcicpOwogICAgdmFyIEJVR0dZX1NBRkFSSV9JVEVSQVRPUlMgPSBmYWxzZTsKICAgIHZhciByZXR1cm5UaGlzID0gZnVuY3Rpb24gcmV0dXJuVGhpcygpIHsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwogICAgdmFyIEl0ZXJhdG9yUHJvdG90eXBlLCBQcm90b3R5cGVPZkFycmF5SXRlcmF0b3JQcm90b3R5cGUsIGFycmF5SXRlcmF0b3I7CiAgICBpZiAoW10ua2V5cykgewogICAgICBhcnJheUl0ZXJhdG9yID0gW10ua2V5cygpOwogICAgICBpZiAoISgnbmV4dCcgaW4gYXJyYXlJdGVyYXRvcikpCiAgICAgIEJVR0dZX1NBRkFSSV9JVEVSQVRPUlMgPSB0cnVlO2Vsc2UKICAgICAgewogICAgICAgIFByb3RvdHlwZU9mQXJyYXlJdGVyYXRvclByb3RvdHlwZSA9IGdldFByb3RvdHlwZU9mKGdldFByb3RvdHlwZU9mKGFycmF5SXRlcmF0b3IpKTsKICAgICAgICBpZiAoUHJvdG90eXBlT2ZBcnJheUl0ZXJhdG9yUHJvdG90eXBlICE9PSBPYmplY3QucHJvdG90eXBlKQogICAgICAgIEl0ZXJhdG9yUHJvdG90eXBlID0gUHJvdG90eXBlT2ZBcnJheUl0ZXJhdG9yUHJvdG90eXBlOwogICAgICB9CiAgICB9CiAgICBpZiAoSXRlcmF0b3JQcm90b3R5cGUgPT0gdW5kZWZpbmVkKQogICAgSXRlcmF0b3JQcm90b3R5cGUgPSB7fTsKICAgIGlmICghSVNfUFVSRSAmJiAhaGFzKEl0ZXJhdG9yUHJvdG90eXBlLCBJVEVSQVRPUikpIHsKICAgICAgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5KEl0ZXJhdG9yUHJvdG90eXBlLCBJVEVSQVRPUiwgcmV0dXJuVGhpcyk7CiAgICB9CiAgICBtb2R1bGUuZXhwb3J0cyA9IHsKICAgICAgSXRlcmF0b3JQcm90b3R5cGU6IEl0ZXJhdG9yUHJvdG90eXBlLAogICAgICBCVUdHWV9TQUZBUklfSVRFUkFUT1JTOiBCVUdHWV9TQUZBUklfSVRFUkFUT1JTCiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiA4MiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBoYXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIyKTsKICAgIHZhciB0b09iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oODMpOwogICAgdmFyIHNoYXJlZEtleSA9IF9fd19wZGZqc19yZXF1aXJlX18oMzQpOwogICAgdmFyIENPUlJFQ1RfUFJPVE9UWVBFX0dFVFRFUiA9IF9fd19wZGZqc19yZXF1aXJlX18oODQpOwogICAgdmFyIElFX1BST1RPID0gc2hhcmVkS2V5KCdJRV9QUk9UTycpOwogICAgdmFyIE9iamVjdFByb3RvdHlwZSA9IE9iamVjdC5wcm90b3R5cGU7CiAgICBtb2R1bGUuZXhwb3J0cyA9IENPUlJFQ1RfUFJPVE9UWVBFX0dFVFRFUiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZiA6IGZ1bmN0aW9uIChPKSB7CiAgICAgIE8gPSB0b09iamVjdChPKTsKICAgICAgaWYgKGhhcyhPLCBJRV9QUk9UTykpCiAgICAgIHJldHVybiBPW0lFX1BST1RPXTsKICAgICAgaWYgKHR5cGVvZiBPLmNvbnN0cnVjdG9yID09ICdmdW5jdGlvbicgJiYgTyBpbnN0YW5jZW9mIE8uY29uc3RydWN0b3IpIHsKICAgICAgICByZXR1cm4gTy5jb25zdHJ1Y3Rvci5wcm90b3R5cGU7CiAgICAgIH0KICAgICAgcmV0dXJuIE8gaW5zdGFuY2VvZiBPYmplY3QgPyBPYmplY3RQcm90b3R5cGUgOiBudWxsOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogODMgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgcmVxdWlyZU9iamVjdENvZXJjaWJsZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTkpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoYXJndW1lbnQpIHsKICAgICAgcmV0dXJuIE9iamVjdChyZXF1aXJlT2JqZWN0Q29lcmNpYmxlKGFyZ3VtZW50KSk7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiA4NCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBmYWlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTMpOwogICAgbW9kdWxlLmV4cG9ydHMgPSAhZmFpbHMoZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBGKCkgewogICAgICB9CiAgICAgIEYucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gbnVsbDsKICAgICAgcmV0dXJuIE9iamVjdC5nZXRQcm90b3R5cGVPZihuZXcgRigpKSAhPT0gRi5wcm90b3R5cGU7CiAgICB9KTsKCiAgICAvKioqL30pLCAoCiAgLyogODUgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgZGVmaW5lUHJvcGVydHkgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDI2KS5mOwogICAgdmFyIGhhcyA9IF9fd19wZGZqc19yZXF1aXJlX18oMjIpOwogICAgdmFyIHdlbGxLbm93blN5bWJvbCA9IF9fd19wZGZqc19yZXF1aXJlX18oNTcpOwogICAgdmFyIFRPX1NUUklOR19UQUcgPSB3ZWxsS25vd25TeW1ib2woJ3RvU3RyaW5nVGFnJyk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCwgVEFHLCBTVEFUSUMpIHsKICAgICAgaWYgKGl0ICYmICFoYXMoaXQgPSBTVEFUSUMgPyBpdCA6IGl0LnByb3RvdHlwZSwgVE9fU1RSSU5HX1RBRykpIHsKICAgICAgICBkZWZpbmVQcm9wZXJ0eShpdCwgVE9fU1RSSU5HX1RBRywgewogICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICAgICAgdmFsdWU6IFRBRwogICAgICAgIH0pOwogICAgICB9CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiA4NiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewoKICAgIG1vZHVsZS5leHBvcnRzID0ge307CgogICAgLyoqKi99KSwgKAogIC8qIDg3ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGFuT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygyNyk7CiAgICB2YXIgYVBvc3NpYmxlUHJvdG90eXBlID0gX193X3BkZmpzX3JlcXVpcmVfXyg4OCk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCAoJ19fcHJvdG9fXycgaW4ge30gPyBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBDT1JSRUNUX1NFVFRFUiA9IGZhbHNlOwogICAgICB2YXIgdGVzdCA9IHt9OwogICAgICB2YXIgc2V0dGVyOwogICAgICB0cnkgewogICAgICAgIHNldHRlciA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoT2JqZWN0LnByb3RvdHlwZSwgJ19fcHJvdG9fXycpLnNldDsKICAgICAgICBzZXR0ZXIuY2FsbCh0ZXN0LCBbXSk7CiAgICAgICAgQ09SUkVDVF9TRVRURVIgPSB0ZXN0IGluc3RhbmNlb2YgQXJyYXk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIH0KICAgICAgcmV0dXJuIGZ1bmN0aW9uIHNldFByb3RvdHlwZU9mKE8sIHByb3RvKSB7CiAgICAgICAgYW5PYmplY3QoTyk7CiAgICAgICAgYVBvc3NpYmxlUHJvdG90eXBlKHByb3RvKTsKICAgICAgICBpZiAoQ09SUkVDVF9TRVRURVIpCiAgICAgICAgc2V0dGVyLmNhbGwoTywgcHJvdG8pO2Vsc2UKCiAgICAgICAgTy5fX3Byb3RvX18gPSBwcm90bzsKICAgICAgICByZXR1cm4gTzsKICAgICAgfTsKICAgIH0oKSA6IHVuZGVmaW5lZCk7CgogICAgLyoqKi99KSwgKAogIC8qIDg4ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGlzT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygyMSk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkgewogICAgICBpZiAoIWlzT2JqZWN0KGl0KSAmJiBpdCAhPT0gbnVsbCkgewogICAgICAgIHRocm93IFR5cGVFcnJvcigiQ2FuJ3Qgc2V0ICIgKyBTdHJpbmcoaXQpICsgJyBhcyBhIHByb3RvdHlwZScpOwogICAgICB9CiAgICAgIHJldHVybiBpdDsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDg5ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyICQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDkpOwogICAgdmFyIGZyb20gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDkwKTsKICAgIHZhciBjaGVja0NvcnJlY3RuZXNzT2ZJdGVyYXRpb24gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDk3KTsKICAgIHZhciBJTkNPUlJFQ1RfSVRFUkFUSU9OID0gIWNoZWNrQ29ycmVjdG5lc3NPZkl0ZXJhdGlvbihmdW5jdGlvbiAoaXRlcmFibGUpIHsKICAgICAgQXJyYXkuZnJvbShpdGVyYWJsZSk7CiAgICB9KTsKICAgICQoewogICAgICB0YXJnZXQ6ICdBcnJheScsCiAgICAgIHN0YXQ6IHRydWUsCiAgICAgIGZvcmNlZDogSU5DT1JSRUNUX0lURVJBVElPTgogICAgfSwgeyBmcm9tOiBmcm9tIH0pOwoKICAgIC8qKiovfSksICgKICAvKiA5MCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgYmluZCA9IF9fd19wZGZqc19yZXF1aXJlX18oNjIpOwogICAgdmFyIHRvT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXyg4Myk7CiAgICB2YXIgY2FsbFdpdGhTYWZlSXRlcmF0aW9uQ2xvc2luZyA9IF9fd19wZGZqc19yZXF1aXJlX18oOTEpOwogICAgdmFyIGlzQXJyYXlJdGVyYXRvck1ldGhvZCA9IF9fd19wZGZqc19yZXF1aXJlX18oOTIpOwogICAgdmFyIHRvTGVuZ3RoID0gX193X3BkZmpzX3JlcXVpcmVfXyg0Nik7CiAgICB2YXIgY3JlYXRlUHJvcGVydHkgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDkzKTsKICAgIHZhciBnZXRJdGVyYXRvck1ldGhvZCA9IF9fd19wZGZqc19yZXF1aXJlX18oOTQpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBmcm9tKGFycmF5TGlrZSkgewogICAgICB2YXIgTyA9IHRvT2JqZWN0KGFycmF5TGlrZSk7CiAgICAgIHZhciBDID0gdHlwZW9mIHRoaXMgPT0gJ2Z1bmN0aW9uJyA/IHRoaXMgOiBBcnJheTsKICAgICAgdmFyIGFyZ3VtZW50c0xlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICAgIHZhciBtYXBmbiA9IGFyZ3VtZW50c0xlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQ7CiAgICAgIHZhciBtYXBwaW5nID0gbWFwZm4gIT09IHVuZGVmaW5lZDsKICAgICAgdmFyIGl0ZXJhdG9yTWV0aG9kID0gZ2V0SXRlcmF0b3JNZXRob2QoTyk7CiAgICAgIHZhciBpbmRleCA9IDA7CiAgICAgIHZhciBsZW5ndGgsIHJlc3VsdCwgc3RlcCwgaXRlcmF0b3IsIG5leHQsIHZhbHVlOwogICAgICBpZiAobWFwcGluZykKICAgICAgbWFwZm4gPSBiaW5kKG1hcGZuLCBhcmd1bWVudHNMZW5ndGggPiAyID8gYXJndW1lbnRzWzJdIDogdW5kZWZpbmVkLCAyKTsKICAgICAgaWYgKGl0ZXJhdG9yTWV0aG9kICE9IHVuZGVmaW5lZCAmJiAhKEMgPT0gQXJyYXkgJiYgaXNBcnJheUl0ZXJhdG9yTWV0aG9kKGl0ZXJhdG9yTWV0aG9kKSkpIHsKICAgICAgICBpdGVyYXRvciA9IGl0ZXJhdG9yTWV0aG9kLmNhbGwoTyk7CiAgICAgICAgbmV4dCA9IGl0ZXJhdG9yLm5leHQ7CiAgICAgICAgcmVzdWx0ID0gbmV3IEMoKTsKICAgICAgICBmb3IgKDsgIShzdGVwID0gbmV4dC5jYWxsKGl0ZXJhdG9yKSkuZG9uZTsgaW5kZXgrKykgewogICAgICAgICAgdmFsdWUgPSBtYXBwaW5nID8gY2FsbFdpdGhTYWZlSXRlcmF0aW9uQ2xvc2luZyhpdGVyYXRvciwgbWFwZm4sIFsKICAgICAgICAgIHN0ZXAudmFsdWUsCiAgICAgICAgICBpbmRleF0sCiAgICAgICAgICB0cnVlKSA6IHN0ZXAudmFsdWU7CiAgICAgICAgICBjcmVhdGVQcm9wZXJ0eShyZXN1bHQsIGluZGV4LCB2YWx1ZSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGxlbmd0aCA9IHRvTGVuZ3RoKE8ubGVuZ3RoKTsKICAgICAgICByZXN1bHQgPSBuZXcgQyhsZW5ndGgpOwogICAgICAgIGZvciAoOyBsZW5ndGggPiBpbmRleDsgaW5kZXgrKykgewogICAgICAgICAgdmFsdWUgPSBtYXBwaW5nID8gbWFwZm4oT1tpbmRleF0sIGluZGV4KSA6IE9baW5kZXhdOwogICAgICAgICAgY3JlYXRlUHJvcGVydHkocmVzdWx0LCBpbmRleCwgdmFsdWUpOwogICAgICAgIH0KICAgICAgfQogICAgICByZXN1bHQubGVuZ3RoID0gaW5kZXg7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiA5MSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBhbk9iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oMjcpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXRlcmF0b3IsIGZuLCB2YWx1ZSwgRU5UUklFUykgewogICAgICB0cnkgewogICAgICAgIHJldHVybiBFTlRSSUVTID8gZm4oYW5PYmplY3QodmFsdWUpWzBdLCB2YWx1ZVsxXSkgOiBmbih2YWx1ZSk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgdmFyIHJldHVybk1ldGhvZCA9IGl0ZXJhdG9yWydyZXR1cm4nXTsKICAgICAgICBpZiAocmV0dXJuTWV0aG9kICE9PSB1bmRlZmluZWQpCiAgICAgICAgYW5PYmplY3QocmV0dXJuTWV0aG9kLmNhbGwoaXRlcmF0b3IpKTsKICAgICAgICB0aHJvdyBlcnJvcjsKICAgICAgfQogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogOTIgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgd2VsbEtub3duU3ltYm9sID0gX193X3BkZmpzX3JlcXVpcmVfXyg1Nyk7CiAgICB2YXIgSXRlcmF0b3JzID0gX193X3BkZmpzX3JlcXVpcmVfXyg4Nik7CiAgICB2YXIgSVRFUkFUT1IgPSB3ZWxsS25vd25TeW1ib2woJ2l0ZXJhdG9yJyk7CiAgICB2YXIgQXJyYXlQcm90b3R5cGUgPSBBcnJheS5wcm90b3R5cGU7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkgewogICAgICByZXR1cm4gaXQgIT09IHVuZGVmaW5lZCAmJiAoSXRlcmF0b3JzLkFycmF5ID09PSBpdCB8fCBBcnJheVByb3RvdHlwZVtJVEVSQVRPUl0gPT09IGl0KTsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDkzICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciB0b1ByaW1pdGl2ZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjApOwogICAgdmFyIGRlZmluZVByb3BlcnR5TW9kdWxlID0gX193X3BkZmpzX3JlcXVpcmVfXygyNik7CiAgICB2YXIgY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yID0gX193X3BkZmpzX3JlcXVpcmVfXygxNSk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChvYmplY3QsIGtleSwgdmFsdWUpIHsKICAgICAgdmFyIHByb3BlcnR5S2V5ID0gdG9QcmltaXRpdmUoa2V5KTsKICAgICAgaWYgKHByb3BlcnR5S2V5IGluIG9iamVjdCkKICAgICAgZGVmaW5lUHJvcGVydHlNb2R1bGUuZihvYmplY3QsIHByb3BlcnR5S2V5LCBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IoMCwgdmFsdWUpKTtlbHNlCgogICAgICBvYmplY3RbcHJvcGVydHlLZXldID0gdmFsdWU7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiA5NCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBjbGFzc29mID0gX193X3BkZmpzX3JlcXVpcmVfXyg5NSk7CiAgICB2YXIgSXRlcmF0b3JzID0gX193X3BkZmpzX3JlcXVpcmVfXyg4Nik7CiAgICB2YXIgd2VsbEtub3duU3ltYm9sID0gX193X3BkZmpzX3JlcXVpcmVfXyg1Nyk7CiAgICB2YXIgSVRFUkFUT1IgPSB3ZWxsS25vd25TeW1ib2woJ2l0ZXJhdG9yJyk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkgewogICAgICBpZiAoaXQgIT0gdW5kZWZpbmVkKQogICAgICByZXR1cm4gaXRbSVRFUkFUT1JdIHx8IGl0WydAQGl0ZXJhdG9yJ10gfHwgSXRlcmF0b3JzW2NsYXNzb2YoaXQpXTsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDk1ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIFRPX1NUUklOR19UQUdfU1VQUE9SVCA9IF9fd19wZGZqc19yZXF1aXJlX18oOTYpOwogICAgdmFyIGNsYXNzb2ZSYXcgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE4KTsKICAgIHZhciB3ZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDU3KTsKICAgIHZhciBUT19TVFJJTkdfVEFHID0gd2VsbEtub3duU3ltYm9sKCd0b1N0cmluZ1RhZycpOwogICAgdmFyIENPUlJFQ1RfQVJHVU1FTlRTID0gY2xhc3NvZlJhdyhmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBhcmd1bWVudHM7CiAgICB9KCkpID09ICdBcmd1bWVudHMnOwogICAgdmFyIHRyeUdldCA9IGZ1bmN0aW9uIHRyeUdldChpdCwga2V5KSB7CiAgICAgIHRyeSB7CiAgICAgICAgcmV0dXJuIGl0W2tleV07CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIH0KICAgIH07CiAgICBtb2R1bGUuZXhwb3J0cyA9IFRPX1NUUklOR19UQUdfU1VQUE9SVCA/IGNsYXNzb2ZSYXcgOiBmdW5jdGlvbiAoaXQpIHsKICAgICAgdmFyIE8sIHRhZywgcmVzdWx0OwogICAgICByZXR1cm4gaXQgPT09IHVuZGVmaW5lZCA/ICdVbmRlZmluZWQnIDogaXQgPT09IG51bGwgPyAnTnVsbCcgOiB0eXBlb2YgKHRhZyA9IHRyeUdldChPID0gT2JqZWN0KGl0KSwgVE9fU1RSSU5HX1RBRykpID09ICdzdHJpbmcnID8gdGFnIDogQ09SUkVDVF9BUkdVTUVOVFMgPyBjbGFzc29mUmF3KE8pIDogKHJlc3VsdCA9IGNsYXNzb2ZSYXcoTykpID09ICdPYmplY3QnICYmIHR5cGVvZiBPLmNhbGxlZSA9PSAnZnVuY3Rpb24nID8gJ0FyZ3VtZW50cycgOiByZXN1bHQ7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiA5NiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciB3ZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDU3KTsKICAgIHZhciBUT19TVFJJTkdfVEFHID0gd2VsbEtub3duU3ltYm9sKCd0b1N0cmluZ1RhZycpOwogICAgdmFyIHRlc3QgPSB7fTsKICAgIHRlc3RbVE9fU1RSSU5HX1RBR10gPSAneic7CiAgICBtb2R1bGUuZXhwb3J0cyA9IFN0cmluZyh0ZXN0KSA9PT0gJ1tvYmplY3Qgel0nOwoKICAgIC8qKiovfSksICgKICAvKiA5NyAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciB3ZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDU3KTsKICAgIHZhciBJVEVSQVRPUiA9IHdlbGxLbm93blN5bWJvbCgnaXRlcmF0b3InKTsKICAgIHZhciBTQUZFX0NMT1NJTkcgPSBmYWxzZTsKICAgIHRyeSB7CiAgICAgIHZhciBjYWxsZWQgPSAwOwogICAgICB2YXIgaXRlcmF0b3JXaXRoUmV0dXJuID0gewogICAgICAgIG5leHQ6IGZ1bmN0aW9uIG5leHQoKSB7CiAgICAgICAgICByZXR1cm4geyBkb25lOiAhIWNhbGxlZCsrIH07CiAgICAgICAgfSwKICAgICAgICAncmV0dXJuJzogZnVuY3Rpb24gX3JldHVybigpIHsKICAgICAgICAgIFNBRkVfQ0xPU0lORyA9IHRydWU7CiAgICAgICAgfQogICAgICB9OwogICAgICBpdGVyYXRvcldpdGhSZXR1cm5bSVRFUkFUT1JdID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9OwogICAgICBBcnJheS5mcm9tKGl0ZXJhdG9yV2l0aFJldHVybiwgZnVuY3Rpb24gKCkgewogICAgICAgIHRocm93IDI7CiAgICAgIH0pOwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgIH0KICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGV4ZWMsIFNLSVBfQ0xPU0lORykgewogICAgICBpZiAoIVNLSVBfQ0xPU0lORyAmJiAhU0FGRV9DTE9TSU5HKQogICAgICByZXR1cm4gZmFsc2U7CiAgICAgIHZhciBJVEVSQVRJT05fU1VQUE9SVCA9IGZhbHNlOwogICAgICB0cnkgewogICAgICAgIHZhciBvYmplY3QgPSB7fTsKICAgICAgICBvYmplY3RbSVRFUkFUT1JdID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgbmV4dDogZnVuY3Rpb24gbmV4dCgpIHsKICAgICAgICAgICAgICByZXR1cm4geyBkb25lOiBJVEVSQVRJT05fU1VQUE9SVCA9IHRydWUgfTsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICB9OwogICAgICAgIGV4ZWMob2JqZWN0KTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgfQogICAgICByZXR1cm4gSVRFUkFUSU9OX1NVUFBPUlQ7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiA5OCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIF9fd19wZGZqc19yZXF1aXJlX18oOTkpOwogICAgdmFyIHBhdGggPSBfX3dfcGRmanNfcmVxdWlyZV9fKDQyKTsKICAgIG1vZHVsZS5leHBvcnRzID0gcGF0aC5PYmplY3QuYXNzaWduOwoKICAgIC8qKiovfSksICgKICAvKiA5OSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciAkID0gX193X3BkZmpzX3JlcXVpcmVfXyg5KTsKICAgIHZhciBhc3NpZ24gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEwMCk7CiAgICAkKHsKICAgICAgdGFyZ2V0OiAnT2JqZWN0JywKICAgICAgc3RhdDogdHJ1ZSwKICAgICAgZm9yY2VkOiBPYmplY3QuYXNzaWduICE9PSBhc3NpZ24KICAgIH0sIHsgYXNzaWduOiBhc3NpZ24gfSk7CgogICAgLyoqKi99KSwgKAogIC8qIDEwMCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgREVTQ1JJUFRPUlMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEyKTsKICAgIHZhciBmYWlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTMpOwogICAgdmFyIG9iamVjdEtleXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDczKTsKICAgIHZhciBnZXRPd25Qcm9wZXJ0eVN5bWJvbHNNb2R1bGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUwKTsKICAgIHZhciBwcm9wZXJ0eUlzRW51bWVyYWJsZU1vZHVsZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTQpOwogICAgdmFyIHRvT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXyg4Myk7CiAgICB2YXIgSW5kZXhlZE9iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTcpOwogICAgdmFyIG5hdGl2ZUFzc2lnbiA9IE9iamVjdC5hc3NpZ247CiAgICB2YXIgZGVmaW5lUHJvcGVydHkgPSBPYmplY3QuZGVmaW5lUHJvcGVydHk7CiAgICBtb2R1bGUuZXhwb3J0cyA9ICFuYXRpdmVBc3NpZ24gfHwgZmFpbHMoZnVuY3Rpb24gKCkgewogICAgICBpZiAoREVTQ1JJUFRPUlMgJiYgbmF0aXZlQXNzaWduKHsgYjogMSB9LCBuYXRpdmVBc3NpZ24oZGVmaW5lUHJvcGVydHkoe30sICdhJywgewogICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICBkZWZpbmVQcm9wZXJ0eSh0aGlzLCAnYicsIHsKICAgICAgICAgICAgdmFsdWU6IDMsCiAgICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLCB7IGI6IDIgfSkpLmIgIT09IDEpCiAgICAgIHJldHVybiB0cnVlOwogICAgICB2YXIgQSA9IHt9OwogICAgICB2YXIgQiA9IHt9OwogICAgICB2YXIgc3ltYm9sID0gU3ltYm9sKCk7CiAgICAgIHZhciBhbHBoYWJldCA9ICdhYmNkZWZnaGlqa2xtbm9wcXJzdCc7CiAgICAgIEFbc3ltYm9sXSA9IDc7CiAgICAgIGFscGhhYmV0LnNwbGl0KCcnKS5mb3JFYWNoKGZ1bmN0aW9uIChjaHIpIHsKICAgICAgICBCW2Nocl0gPSBjaHI7CiAgICAgIH0pOwogICAgICByZXR1cm4gbmF0aXZlQXNzaWduKHt9LCBBKVtzeW1ib2xdICE9IDcgfHwgb2JqZWN0S2V5cyhuYXRpdmVBc3NpZ24oe30sIEIpKS5qb2luKCcnKSAhPSBhbHBoYWJldDsKICAgIH0pID8gZnVuY3Rpb24gYXNzaWduKHRhcmdldCwgc291cmNlKSB7CiAgICAgIHZhciBUID0gdG9PYmplY3QodGFyZ2V0KTsKICAgICAgdmFyIGFyZ3VtZW50c0xlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICAgIHZhciBpbmRleCA9IDE7CiAgICAgIHZhciBnZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPSBnZXRPd25Qcm9wZXJ0eVN5bWJvbHNNb2R1bGUuZjsKICAgICAgdmFyIHByb3BlcnR5SXNFbnVtZXJhYmxlID0gcHJvcGVydHlJc0VudW1lcmFibGVNb2R1bGUuZjsKICAgICAgd2hpbGUgKGFyZ3VtZW50c0xlbmd0aCA+IGluZGV4KSB7CiAgICAgICAgdmFyIFMgPSBJbmRleGVkT2JqZWN0KGFyZ3VtZW50c1tpbmRleCsrXSk7CiAgICAgICAgdmFyIGtleXMgPSBnZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPyBvYmplY3RLZXlzKFMpLmNvbmNhdChnZXRPd25Qcm9wZXJ0eVN5bWJvbHMoUykpIDogb2JqZWN0S2V5cyhTKTsKICAgICAgICB2YXIgbGVuZ3RoID0ga2V5cy5sZW5ndGg7CiAgICAgICAgdmFyIGogPSAwOwogICAgICAgIHZhciBrZXk7CiAgICAgICAgd2hpbGUgKGxlbmd0aCA+IGopIHsKICAgICAgICAgIGtleSA9IGtleXNbaisrXTsKICAgICAgICAgIGlmICghREVTQ1JJUFRPUlMgfHwgcHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChTLCBrZXkpKQogICAgICAgICAgVFtrZXldID0gU1trZXldOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gVDsKICAgIH0gOiBuYXRpdmVBc3NpZ247CgogICAgLyoqKi99KSwgKAogIC8qIDEwMSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIF9fd19wZGZqc19yZXF1aXJlX18oMTAyKTsKICAgIHZhciBwYXRoID0gX193X3BkZmpzX3JlcXVpcmVfXyg0Mik7CiAgICBtb2R1bGUuZXhwb3J0cyA9IHBhdGguTWF0aC5sb2cyOwoKICAgIC8qKiovfSksICgKICAvKiAxMDIgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgJCA9IF9fd19wZGZqc19yZXF1aXJlX18oOSk7CiAgICB2YXIgbG9nID0gTWF0aC5sb2c7CiAgICB2YXIgTE4yID0gTWF0aC5MTjI7CiAgICAkKHsKICAgICAgdGFyZ2V0OiAnTWF0aCcsCiAgICAgIHN0YXQ6IHRydWUKICAgIH0sIHsKICAgICAgbG9nMjogZnVuY3Rpb24gbG9nMih4KSB7CiAgICAgICAgcmV0dXJuIGxvZyh4KSAvIExOMjsKICAgICAgfQogICAgfSk7CgogICAgLyoqKi99KSwgKAogIC8qIDEwMyAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIF9fd19wZGZqc19yZXF1aXJlX18oMTA0KTsKICAgIHZhciBwYXRoID0gX193X3BkZmpzX3JlcXVpcmVfXyg0Mik7CiAgICBtb2R1bGUuZXhwb3J0cyA9IHBhdGguTnVtYmVyLmlzTmFOOwoKICAgIC8qKiovfSksICgKICAvKiAxMDQgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgJCA9IF9fd19wZGZqc19yZXF1aXJlX18oOSk7CiAgICAkKHsKICAgICAgdGFyZ2V0OiAnTnVtYmVyJywKICAgICAgc3RhdDogdHJ1ZQogICAgfSwgewogICAgICBpc05hTjogZnVuY3Rpb24gaXNOYU4obnVtYmVyKSB7CiAgICAgICAgcmV0dXJuIG51bWJlciAhPSBudW1iZXI7CiAgICAgIH0KICAgIH0pOwoKICAgIC8qKiovfSksICgKICAvKiAxMDUgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDEwNik7CiAgICB2YXIgcGF0aCA9IF9fd19wZGZqc19yZXF1aXJlX18oNDIpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBwYXRoLk51bWJlci5pc0ludGVnZXI7CgogICAgLyoqKi99KSwgKAogIC8qIDEwNiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciAkID0gX193X3BkZmpzX3JlcXVpcmVfXyg5KTsKICAgIHZhciBpc0ludGVnZXIgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEwNyk7CiAgICAkKHsKICAgICAgdGFyZ2V0OiAnTnVtYmVyJywKICAgICAgc3RhdDogdHJ1ZQogICAgfSwgeyBpc0ludGVnZXI6IGlzSW50ZWdlciB9KTsKCiAgICAvKioqL30pLCAoCiAgLyogMTA3ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGlzT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygyMSk7CiAgICB2YXIgZmxvb3IgPSBNYXRoLmZsb29yOwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBpc0ludGVnZXIoaXQpIHsKICAgICAgcmV0dXJuICFpc09iamVjdChpdCkgJiYgaXNGaW5pdGUoaXQpICYmIGZsb29yKGl0KSA9PT0gaXQ7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAxMDggKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDEwOSk7CiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDc3KTsKICAgIF9fd19wZGZqc19yZXF1aXJlX18oMTExKTsKICAgIF9fd19wZGZqc19yZXF1aXJlX18oMTE0KTsKICAgIF9fd19wZGZqc19yZXF1aXJlX18oMTMwKTsKICAgIF9fd19wZGZqc19yZXF1aXJlX18oMTMxKTsKICAgIHZhciBwYXRoID0gX193X3BkZmpzX3JlcXVpcmVfXyg0Mik7CiAgICBtb2R1bGUuZXhwb3J0cyA9IHBhdGguUHJvbWlzZTsKCiAgICAvKioqL30pLCAoCiAgLyogMTA5ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIFRPX1NUUklOR19UQUdfU1VQUE9SVCA9IF9fd19wZGZqc19yZXF1aXJlX18oOTYpOwogICAgdmFyIHJlZGVmaW5lID0gX193X3BkZmpzX3JlcXVpcmVfXygyOCk7CiAgICB2YXIgdG9TdHJpbmcgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDExMCk7CiAgICBpZiAoIVRPX1NUUklOR19UQUdfU1VQUE9SVCkgewogICAgICByZWRlZmluZShPYmplY3QucHJvdG90eXBlLCAndG9TdHJpbmcnLCB0b1N0cmluZywgeyB1bnNhZmU6IHRydWUgfSk7CiAgICB9CgogICAgLyoqKi99KSwgKAogIC8qIDExMCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgVE9fU1RSSU5HX1RBR19TVVBQT1JUID0gX193X3BkZmpzX3JlcXVpcmVfXyg5Nik7CiAgICB2YXIgY2xhc3NvZiA9IF9fd19wZGZqc19yZXF1aXJlX18oOTUpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBUT19TVFJJTkdfVEFHX1NVUFBPUlQgPyB7fS50b1N0cmluZyA6IGZ1bmN0aW9uIHRvU3RyaW5nKCkgewogICAgICByZXR1cm4gJ1tvYmplY3QgJyArIGNsYXNzb2YodGhpcykgKyAnXSc7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAxMTEgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgZ2xvYmFsID0gX193X3BkZmpzX3JlcXVpcmVfXygxMCk7CiAgICB2YXIgRE9NSXRlcmFibGVzID0gX193X3BkZmpzX3JlcXVpcmVfXygxMTIpOwogICAgdmFyIEFycmF5SXRlcmF0b3JNZXRob2RzID0gX193X3BkZmpzX3JlcXVpcmVfXygxMTMpOwogICAgdmFyIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjUpOwogICAgdmFyIHdlbGxLbm93blN5bWJvbCA9IF9fd19wZGZqc19yZXF1aXJlX18oNTcpOwogICAgdmFyIElURVJBVE9SID0gd2VsbEtub3duU3ltYm9sKCdpdGVyYXRvcicpOwogICAgdmFyIFRPX1NUUklOR19UQUcgPSB3ZWxsS25vd25TeW1ib2woJ3RvU3RyaW5nVGFnJyk7CiAgICB2YXIgQXJyYXlWYWx1ZXMgPSBBcnJheUl0ZXJhdG9yTWV0aG9kcy52YWx1ZXM7CiAgICBmb3IgKHZhciBDT0xMRUNUSU9OX05BTUUgaW4gRE9NSXRlcmFibGVzKSB7CiAgICAgIHZhciBDb2xsZWN0aW9uID0gZ2xvYmFsW0NPTExFQ1RJT05fTkFNRV07CiAgICAgIHZhciBDb2xsZWN0aW9uUHJvdG90eXBlID0gQ29sbGVjdGlvbiAmJiBDb2xsZWN0aW9uLnByb3RvdHlwZTsKICAgICAgaWYgKENvbGxlY3Rpb25Qcm90b3R5cGUpIHsKICAgICAgICBpZiAoQ29sbGVjdGlvblByb3RvdHlwZVtJVEVSQVRPUl0gIT09IEFycmF5VmFsdWVzKQogICAgICAgIHRyeSB7CiAgICAgICAgICBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkoQ29sbGVjdGlvblByb3RvdHlwZSwgSVRFUkFUT1IsIEFycmF5VmFsdWVzKTsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgQ29sbGVjdGlvblByb3RvdHlwZVtJVEVSQVRPUl0gPSBBcnJheVZhbHVlczsKICAgICAgICB9CiAgICAgICAgaWYgKCFDb2xsZWN0aW9uUHJvdG90eXBlW1RPX1NUUklOR19UQUddKSB7CiAgICAgICAgICBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkoQ29sbGVjdGlvblByb3RvdHlwZSwgVE9fU1RSSU5HX1RBRywgQ09MTEVDVElPTl9OQU1FKTsKICAgICAgICB9CiAgICAgICAgaWYgKERPTUl0ZXJhYmxlc1tDT0xMRUNUSU9OX05BTUVdKQogICAgICAgIGZvciAodmFyIE1FVEhPRF9OQU1FIGluIEFycmF5SXRlcmF0b3JNZXRob2RzKSB7CiAgICAgICAgICBpZiAoQ29sbGVjdGlvblByb3RvdHlwZVtNRVRIT0RfTkFNRV0gIT09IEFycmF5SXRlcmF0b3JNZXRob2RzW01FVEhPRF9OQU1FXSkKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eShDb2xsZWN0aW9uUHJvdG90eXBlLCBNRVRIT0RfTkFNRSwgQXJyYXlJdGVyYXRvck1ldGhvZHNbTUVUSE9EX05BTUVdKTsKICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIENvbGxlY3Rpb25Qcm90b3R5cGVbTUVUSE9EX05BTUVdID0gQXJyYXlJdGVyYXRvck1ldGhvZHNbTUVUSE9EX05BTUVdOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIC8qKiovfSksICgKICAvKiAxMTIgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKCiAgICBtb2R1bGUuZXhwb3J0cyA9IHsKICAgICAgQ1NTUnVsZUxpc3Q6IDAsCiAgICAgIENTU1N0eWxlRGVjbGFyYXRpb246IDAsCiAgICAgIENTU1ZhbHVlTGlzdDogMCwKICAgICAgQ2xpZW50UmVjdExpc3Q6IDAsCiAgICAgIERPTVJlY3RMaXN0OiAwLAogICAgICBET01TdHJpbmdMaXN0OiAwLAogICAgICBET01Ub2tlbkxpc3Q6IDEsCiAgICAgIERhdGFUcmFuc2Zlckl0ZW1MaXN0OiAwLAogICAgICBGaWxlTGlzdDogMCwKICAgICAgSFRNTEFsbENvbGxlY3Rpb246IDAsCiAgICAgIEhUTUxDb2xsZWN0aW9uOiAwLAogICAgICBIVE1MRm9ybUVsZW1lbnQ6IDAsCiAgICAgIEhUTUxTZWxlY3RFbGVtZW50OiAwLAogICAgICBNZWRpYUxpc3Q6IDAsCiAgICAgIE1pbWVUeXBlQXJyYXk6IDAsCiAgICAgIE5hbWVkTm9kZU1hcDogMCwKICAgICAgTm9kZUxpc3Q6IDEsCiAgICAgIFBhaW50UmVxdWVzdExpc3Q6IDAsCiAgICAgIFBsdWdpbjogMCwKICAgICAgUGx1Z2luQXJyYXk6IDAsCiAgICAgIFNWR0xlbmd0aExpc3Q6IDAsCiAgICAgIFNWR051bWJlckxpc3Q6IDAsCiAgICAgIFNWR1BhdGhTZWdMaXN0OiAwLAogICAgICBTVkdQb2ludExpc3Q6IDAsCiAgICAgIFNWR1N0cmluZ0xpc3Q6IDAsCiAgICAgIFNWR1RyYW5zZm9ybUxpc3Q6IDAsCiAgICAgIFNvdXJjZUJ1ZmZlckxpc3Q6IDAsCiAgICAgIFN0eWxlU2hlZXRMaXN0OiAwLAogICAgICBUZXh0VHJhY2tDdWVMaXN0OiAwLAogICAgICBUZXh0VHJhY2tMaXN0OiAwLAogICAgICBUb3VjaExpc3Q6IDAKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDExMyAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgdG9JbmRleGVkT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygxNik7CiAgICB2YXIgYWRkVG9VbnNjb3BhYmxlcyA9IF9fd19wZGZqc19yZXF1aXJlX18oNzApOwogICAgdmFyIEl0ZXJhdG9ycyA9IF9fd19wZGZqc19yZXF1aXJlX18oODYpOwogICAgdmFyIEludGVybmFsU3RhdGVNb2R1bGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDMyKTsKICAgIHZhciBkZWZpbmVJdGVyYXRvciA9IF9fd19wZGZqc19yZXF1aXJlX18oNzkpOwogICAgdmFyIEFSUkFZX0lURVJBVE9SID0gJ0FycmF5IEl0ZXJhdG9yJzsKICAgIHZhciBzZXRJbnRlcm5hbFN0YXRlID0gSW50ZXJuYWxTdGF0ZU1vZHVsZS5zZXQ7CiAgICB2YXIgZ2V0SW50ZXJuYWxTdGF0ZSA9IEludGVybmFsU3RhdGVNb2R1bGUuZ2V0dGVyRm9yKEFSUkFZX0lURVJBVE9SKTsKICAgIG1vZHVsZS5leHBvcnRzID0gZGVmaW5lSXRlcmF0b3IoQXJyYXksICdBcnJheScsIGZ1bmN0aW9uIChpdGVyYXRlZCwga2luZCkgewogICAgICBzZXRJbnRlcm5hbFN0YXRlKHRoaXMsIHsKICAgICAgICB0eXBlOiBBUlJBWV9JVEVSQVRPUiwKICAgICAgICB0YXJnZXQ6IHRvSW5kZXhlZE9iamVjdChpdGVyYXRlZCksCiAgICAgICAgaW5kZXg6IDAsCiAgICAgICAga2luZDoga2luZAogICAgICB9KTsKICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIHN0YXRlID0gZ2V0SW50ZXJuYWxTdGF0ZSh0aGlzKTsKICAgICAgdmFyIHRhcmdldCA9IHN0YXRlLnRhcmdldDsKICAgICAgdmFyIGtpbmQgPSBzdGF0ZS5raW5kOwogICAgICB2YXIgaW5kZXggPSBzdGF0ZS5pbmRleCsrOwogICAgICBpZiAoIXRhcmdldCB8fCBpbmRleCA+PSB0YXJnZXQubGVuZ3RoKSB7CiAgICAgICAgc3RhdGUudGFyZ2V0ID0gdW5kZWZpbmVkOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICB2YWx1ZTogdW5kZWZpbmVkLAogICAgICAgICAgZG9uZTogdHJ1ZQogICAgICAgIH07CiAgICAgIH0KICAgICAgaWYgKGtpbmQgPT0gJ2tleXMnKQogICAgICByZXR1cm4gewogICAgICAgIHZhbHVlOiBpbmRleCwKICAgICAgICBkb25lOiBmYWxzZQogICAgICB9OwogICAgICBpZiAoa2luZCA9PSAndmFsdWVzJykKICAgICAgcmV0dXJuIHsKICAgICAgICB2YWx1ZTogdGFyZ2V0W2luZGV4XSwKICAgICAgICBkb25lOiBmYWxzZQogICAgICB9OwogICAgICByZXR1cm4gewogICAgICAgIHZhbHVlOiBbCiAgICAgICAgaW5kZXgsCiAgICAgICAgdGFyZ2V0W2luZGV4XV0sCgogICAgICAgIGRvbmU6IGZhbHNlCiAgICAgIH07CiAgICB9LCAndmFsdWVzJyk7CiAgICBJdGVyYXRvcnMuQXJndW1lbnRzID0gSXRlcmF0b3JzLkFycmF5OwogICAgYWRkVG9VbnNjb3BhYmxlcygna2V5cycpOwogICAgYWRkVG9VbnNjb3BhYmxlcygndmFsdWVzJyk7CiAgICBhZGRUb1Vuc2NvcGFibGVzKCdlbnRyaWVzJyk7CgogICAgLyoqKi99KSwgKAogIC8qIDExNCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgJCA9IF9fd19wZGZqc19yZXF1aXJlX18oOSk7CiAgICB2YXIgSVNfUFVSRSA9IF9fd19wZGZqc19yZXF1aXJlX18oMzYpOwogICAgdmFyIGdsb2JhbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTApOwogICAgdmFyIGdldEJ1aWx0SW4gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDQxKTsKICAgIHZhciBOYXRpdmVQcm9taXNlID0gX193X3BkZmpzX3JlcXVpcmVfXygxMTUpOwogICAgdmFyIHJlZGVmaW5lID0gX193X3BkZmpzX3JlcXVpcmVfXygyOCk7CiAgICB2YXIgcmVkZWZpbmVBbGwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDExNik7CiAgICB2YXIgc2V0VG9TdHJpbmdUYWcgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDg1KTsKICAgIHZhciBzZXRTcGVjaWVzID0gX193X3BkZmpzX3JlcXVpcmVfXygxMTcpOwogICAgdmFyIGlzT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygyMSk7CiAgICB2YXIgYUZ1bmN0aW9uID0gX193X3BkZmpzX3JlcXVpcmVfXyg2Myk7CiAgICB2YXIgYW5JbnN0YW5jZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTE4KTsKICAgIHZhciBjbGFzc29mID0gX193X3BkZmpzX3JlcXVpcmVfXygxOCk7CiAgICB2YXIgaW5zcGVjdFNvdXJjZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMzApOwogICAgdmFyIGl0ZXJhdGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDExOSk7CiAgICB2YXIgY2hlY2tDb3JyZWN0bmVzc09mSXRlcmF0aW9uID0gX193X3BkZmpzX3JlcXVpcmVfXyg5Nyk7CiAgICB2YXIgc3BlY2llc0NvbnN0cnVjdG9yID0gX193X3BkZmpzX3JlcXVpcmVfXygxMjApOwogICAgdmFyIHRhc2sgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEyMSkuc2V0OwogICAgdmFyIG1pY3JvdGFzayA9IF9fd19wZGZqc19yZXF1aXJlX18oMTI0KTsKICAgIHZhciBwcm9taXNlUmVzb2x2ZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTI1KTsKICAgIHZhciBob3N0UmVwb3J0RXJyb3JzID0gX193X3BkZmpzX3JlcXVpcmVfXygxMjcpOwogICAgdmFyIG5ld1Byb21pc2VDYXBhYmlsaXR5TW9kdWxlID0gX193X3BkZmpzX3JlcXVpcmVfXygxMjYpOwogICAgdmFyIHBlcmZvcm0gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEyOCk7CiAgICB2YXIgSW50ZXJuYWxTdGF0ZU1vZHVsZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMzIpOwogICAgdmFyIGlzRm9yY2VkID0gX193X3BkZmpzX3JlcXVpcmVfXyg1MSk7CiAgICB2YXIgd2VsbEtub3duU3ltYm9sID0gX193X3BkZmpzX3JlcXVpcmVfXyg1Nyk7CiAgICB2YXIgVjhfVkVSU0lPTiA9IF9fd19wZGZqc19yZXF1aXJlX18oMTI5KTsKICAgIHZhciBTUEVDSUVTID0gd2VsbEtub3duU3ltYm9sKCdzcGVjaWVzJyk7CiAgICB2YXIgUFJPTUlTRSA9ICdQcm9taXNlJzsKICAgIHZhciBnZXRJbnRlcm5hbFN0YXRlID0gSW50ZXJuYWxTdGF0ZU1vZHVsZS5nZXQ7CiAgICB2YXIgc2V0SW50ZXJuYWxTdGF0ZSA9IEludGVybmFsU3RhdGVNb2R1bGUuc2V0OwogICAgdmFyIGdldEludGVybmFsUHJvbWlzZVN0YXRlID0gSW50ZXJuYWxTdGF0ZU1vZHVsZS5nZXR0ZXJGb3IoUFJPTUlTRSk7CiAgICB2YXIgUHJvbWlzZUNvbnN0cnVjdG9yID0gTmF0aXZlUHJvbWlzZTsKICAgIHZhciBUeXBlRXJyb3IgPSBnbG9iYWwuVHlwZUVycm9yOwogICAgdmFyIGRvY3VtZW50ID0gZ2xvYmFsLmRvY3VtZW50OwogICAgdmFyIHByb2Nlc3MgPSBnbG9iYWwucHJvY2VzczsKICAgIHZhciAkZmV0Y2ggPSBnZXRCdWlsdEluKCdmZXRjaCcpOwogICAgdmFyIG5ld1Byb21pc2VDYXBhYmlsaXR5ID0gbmV3UHJvbWlzZUNhcGFiaWxpdHlNb2R1bGUuZjsKICAgIHZhciBuZXdHZW5lcmljUHJvbWlzZUNhcGFiaWxpdHkgPSBuZXdQcm9taXNlQ2FwYWJpbGl0eTsKICAgIHZhciBJU19OT0RFID0gY2xhc3NvZihwcm9jZXNzKSA9PSAncHJvY2Vzcyc7CiAgICB2YXIgRElTUEFUQ0hfRVZFTlQgPSAhIShkb2N1bWVudCAmJiBkb2N1bWVudC5jcmVhdGVFdmVudCAmJiBnbG9iYWwuZGlzcGF0Y2hFdmVudCk7CiAgICB2YXIgVU5IQU5ETEVEX1JFSkVDVElPTiA9ICd1bmhhbmRsZWRyZWplY3Rpb24nOwogICAgdmFyIFJFSkVDVElPTl9IQU5ETEVEID0gJ3JlamVjdGlvbmhhbmRsZWQnOwogICAgdmFyIFBFTkRJTkcgPSAwOwogICAgdmFyIEZVTEZJTExFRCA9IDE7CiAgICB2YXIgUkVKRUNURUQgPSAyOwogICAgdmFyIEhBTkRMRUQgPSAxOwogICAgdmFyIFVOSEFORExFRCA9IDI7CiAgICB2YXIgSW50ZXJuYWwsIE93blByb21pc2VDYXBhYmlsaXR5LCBQcm9taXNlV3JhcHBlciwgbmF0aXZlVGhlbjsKICAgIHZhciBGT1JDRUQgPSBpc0ZvcmNlZChQUk9NSVNFLCBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBHTE9CQUxfQ09SRV9KU19QUk9NSVNFID0gaW5zcGVjdFNvdXJjZShQcm9taXNlQ29uc3RydWN0b3IpICE9PSBTdHJpbmcoUHJvbWlzZUNvbnN0cnVjdG9yKTsKICAgICAgaWYgKCFHTE9CQUxfQ09SRV9KU19QUk9NSVNFKSB7CiAgICAgICAgaWYgKFY4X1ZFUlNJT04gPT09IDY2KQogICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIGlmICghSVNfTk9ERSAmJiB0eXBlb2YgUHJvbWlzZVJlamVjdGlvbkV2ZW50ICE9ICdmdW5jdGlvbicpCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgaWYgKElTX1BVUkUgJiYgIVByb21pc2VDb25zdHJ1Y3Rvci5wcm90b3R5cGVbJ2ZpbmFsbHknXSkKICAgICAgcmV0dXJuIHRydWU7CiAgICAgIGlmIChWOF9WRVJTSU9OID49IDUxICYmIC9uYXRpdmUgY29kZS8udGVzdChQcm9taXNlQ29uc3RydWN0b3IpKQogICAgICByZXR1cm4gZmFsc2U7CiAgICAgIHZhciBwcm9taXNlID0gUHJvbWlzZUNvbnN0cnVjdG9yLnJlc29sdmUoMSk7CiAgICAgIHZhciBGYWtlUHJvbWlzZSA9IGZ1bmN0aW9uIEZha2VQcm9taXNlKGV4ZWMpIHsKICAgICAgICBleGVjKGZ1bmN0aW9uICgpIHsKICAgICAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgfSk7CiAgICAgIH07CiAgICAgIHZhciBjb25zdHJ1Y3RvciA9IHByb21pc2UuY29uc3RydWN0b3IgPSB7fTsKICAgICAgY29uc3RydWN0b3JbU1BFQ0lFU10gPSBGYWtlUHJvbWlzZTsKICAgICAgcmV0dXJuICEocHJvbWlzZS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgfSkgaW5zdGFuY2VvZiBGYWtlUHJvbWlzZSk7CiAgICB9KTsKICAgIHZhciBJTkNPUlJFQ1RfSVRFUkFUSU9OID0gRk9SQ0VEIHx8ICFjaGVja0NvcnJlY3RuZXNzT2ZJdGVyYXRpb24oZnVuY3Rpb24gKGl0ZXJhYmxlKSB7CiAgICAgIFByb21pc2VDb25zdHJ1Y3Rvci5hbGwoaXRlcmFibGUpWydjYXRjaCddKGZ1bmN0aW9uICgpIHsKICAgICAgfSk7CiAgICB9KTsKICAgIHZhciBpc1RoZW5hYmxlID0gZnVuY3Rpb24gaXNUaGVuYWJsZShpdCkgewogICAgICB2YXIgdGhlbjsKICAgICAgcmV0dXJuIGlzT2JqZWN0KGl0KSAmJiB0eXBlb2YgKHRoZW4gPSBpdC50aGVuKSA9PSAnZnVuY3Rpb24nID8gdGhlbiA6IGZhbHNlOwogICAgfTsKICAgIHZhciBub3RpZnkgPSBmdW5jdGlvbiBub3RpZnkocHJvbWlzZSwgc3RhdGUsIGlzUmVqZWN0KSB7CiAgICAgIGlmIChzdGF0ZS5ub3RpZmllZCkKICAgICAgcmV0dXJuOwogICAgICBzdGF0ZS5ub3RpZmllZCA9IHRydWU7CiAgICAgIHZhciBjaGFpbiA9IHN0YXRlLnJlYWN0aW9uczsKICAgICAgbWljcm90YXNrKGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgdmFsdWUgPSBzdGF0ZS52YWx1ZTsKICAgICAgICB2YXIgb2sgPSBzdGF0ZS5zdGF0ZSA9PSBGVUxGSUxMRUQ7CiAgICAgICAgdmFyIGluZGV4ID0gMDsKICAgICAgICB3aGlsZSAoY2hhaW4ubGVuZ3RoID4gaW5kZXgpIHsKICAgICAgICAgIHZhciByZWFjdGlvbiA9IGNoYWluW2luZGV4KytdOwogICAgICAgICAgdmFyIGhhbmRsZXIgPSBvayA/IHJlYWN0aW9uLm9rIDogcmVhY3Rpb24uZmFpbDsKICAgICAgICAgIHZhciByZXNvbHZlID0gcmVhY3Rpb24ucmVzb2x2ZTsKICAgICAgICAgIHZhciByZWplY3QgPSByZWFjdGlvbi5yZWplY3Q7CiAgICAgICAgICB2YXIgZG9tYWluID0gcmVhY3Rpb24uZG9tYWluOwogICAgICAgICAgdmFyIHJlc3VsdCwgdGhlbiwgZXhpdGVkOwogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGhhbmRsZXIpIHsKICAgICAgICAgICAgICBpZiAoIW9rKSB7CiAgICAgICAgICAgICAgICBpZiAoc3RhdGUucmVqZWN0aW9uID09PSBVTkhBTkRMRUQpCiAgICAgICAgICAgICAgICBvbkhhbmRsZVVuaGFuZGxlZChwcm9taXNlLCBzdGF0ZSk7CiAgICAgICAgICAgICAgICBzdGF0ZS5yZWplY3Rpb24gPSBIQU5ETEVEOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoaGFuZGxlciA9PT0gdHJ1ZSkKICAgICAgICAgICAgICByZXN1bHQgPSB2YWx1ZTtlbHNlCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKGRvbWFpbikKICAgICAgICAgICAgICAgIGRvbWFpbi5lbnRlcigpOwogICAgICAgICAgICAgICAgcmVzdWx0ID0gaGFuZGxlcih2YWx1ZSk7CiAgICAgICAgICAgICAgICBpZiAoZG9tYWluKSB7CiAgICAgICAgICAgICAgICAgIGRvbWFpbi5leGl0KCk7CiAgICAgICAgICAgICAgICAgIGV4aXRlZCA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IHJlYWN0aW9uLnByb21pc2UpIHsKICAgICAgICAgICAgICAgIHJlamVjdChUeXBlRXJyb3IoJ1Byb21pc2UtY2hhaW4gY3ljbGUnKSk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGVuID0gaXNUaGVuYWJsZShyZXN1bHQpKSB7CiAgICAgICAgICAgICAgICB0aGVuLmNhbGwocmVzdWx0LCByZXNvbHZlLCByZWplY3QpOwogICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIHJlamVjdCh2YWx1ZSk7CiAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICBpZiAoZG9tYWluICYmICFleGl0ZWQpCiAgICAgICAgICAgIGRvbWFpbi5leGl0KCk7CiAgICAgICAgICAgIHJlamVjdChlcnJvcik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHN0YXRlLnJlYWN0aW9ucyA9IFtdOwogICAgICAgIHN0YXRlLm5vdGlmaWVkID0gZmFsc2U7CiAgICAgICAgaWYgKGlzUmVqZWN0ICYmICFzdGF0ZS5yZWplY3Rpb24pCiAgICAgICAgb25VbmhhbmRsZWQocHJvbWlzZSwgc3RhdGUpOwogICAgICB9KTsKICAgIH07CiAgICB2YXIgZGlzcGF0Y2hFdmVudCA9IGZ1bmN0aW9uIGRpc3BhdGNoRXZlbnQobmFtZSwgcHJvbWlzZSwgcmVhc29uKSB7CiAgICAgIHZhciBldmVudCwgaGFuZGxlcjsKICAgICAgaWYgKERJU1BBVENIX0VWRU5UKSB7CiAgICAgICAgZXZlbnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnRXZlbnQnKTsKICAgICAgICBldmVudC5wcm9taXNlID0gcHJvbWlzZTsKICAgICAgICBldmVudC5yZWFzb24gPSByZWFzb247CiAgICAgICAgZXZlbnQuaW5pdEV2ZW50KG5hbWUsIGZhbHNlLCB0cnVlKTsKICAgICAgICBnbG9iYWwuZGlzcGF0Y2hFdmVudChldmVudCk7CiAgICAgIH0gZWxzZQogICAgICBldmVudCA9IHsKICAgICAgICBwcm9taXNlOiBwcm9taXNlLAogICAgICAgIHJlYXNvbjogcmVhc29uCiAgICAgIH07CiAgICAgIGlmIChoYW5kbGVyID0gZ2xvYmFsWydvbicgKyBuYW1lXSkKICAgICAgaGFuZGxlcihldmVudCk7ZWxzZQogICAgICBpZiAobmFtZSA9PT0gVU5IQU5ETEVEX1JFSkVDVElPTikKICAgICAgaG9zdFJlcG9ydEVycm9ycygnVW5oYW5kbGVkIHByb21pc2UgcmVqZWN0aW9uJywgcmVhc29uKTsKICAgIH07CiAgICB2YXIgb25VbmhhbmRsZWQgPSBmdW5jdGlvbiBvblVuaGFuZGxlZChwcm9taXNlLCBzdGF0ZSkgewogICAgICB0YXNrLmNhbGwoZ2xvYmFsLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHZhbHVlID0gc3RhdGUudmFsdWU7CiAgICAgICAgdmFyIElTX1VOSEFORExFRCA9IGlzVW5oYW5kbGVkKHN0YXRlKTsKICAgICAgICB2YXIgcmVzdWx0OwogICAgICAgIGlmIChJU19VTkhBTkRMRUQpIHsKICAgICAgICAgIHJlc3VsdCA9IHBlcmZvcm0oZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAoSVNfTk9ERSkgewogICAgICAgICAgICAgIHByb2Nlc3MuZW1pdCgndW5oYW5kbGVkUmVqZWN0aW9uJywgdmFsdWUsIHByb21pc2UpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgZGlzcGF0Y2hFdmVudChVTkhBTkRMRURfUkVKRUNUSU9OLCBwcm9taXNlLCB2YWx1ZSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHN0YXRlLnJlamVjdGlvbiA9IElTX05PREUgfHwgaXNVbmhhbmRsZWQoc3RhdGUpID8gVU5IQU5ETEVEIDogSEFORExFRDsKICAgICAgICAgIGlmIChyZXN1bHQuZXJyb3IpCiAgICAgICAgICB0aHJvdyByZXN1bHQudmFsdWU7CiAgICAgICAgfQogICAgICB9KTsKICAgIH07CiAgICB2YXIgaXNVbmhhbmRsZWQgPSBmdW5jdGlvbiBpc1VuaGFuZGxlZChzdGF0ZSkgewogICAgICByZXR1cm4gc3RhdGUucmVqZWN0aW9uICE9PSBIQU5ETEVEICYmICFzdGF0ZS5wYXJlbnQ7CiAgICB9OwogICAgdmFyIG9uSGFuZGxlVW5oYW5kbGVkID0gZnVuY3Rpb24gb25IYW5kbGVVbmhhbmRsZWQocHJvbWlzZSwgc3RhdGUpIHsKICAgICAgdGFzay5jYWxsKGdsb2JhbCwgZnVuY3Rpb24gKCkgewogICAgICAgIGlmIChJU19OT0RFKSB7CiAgICAgICAgICBwcm9jZXNzLmVtaXQoJ3JlamVjdGlvbkhhbmRsZWQnLCBwcm9taXNlKTsKICAgICAgICB9IGVsc2UKICAgICAgICBkaXNwYXRjaEV2ZW50KFJFSkVDVElPTl9IQU5ETEVELCBwcm9taXNlLCBzdGF0ZS52YWx1ZSk7CiAgICAgIH0pOwogICAgfTsKICAgIHZhciBiaW5kID0gZnVuY3Rpb24gYmluZChmbiwgcHJvbWlzZSwgc3RhdGUsIHVud3JhcCkgewogICAgICByZXR1cm4gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgZm4ocHJvbWlzZSwgc3RhdGUsIHZhbHVlLCB1bndyYXApOwogICAgICB9OwogICAgfTsKICAgIHZhciBpbnRlcm5hbFJlamVjdCA9IGZ1bmN0aW9uIGludGVybmFsUmVqZWN0KHByb21pc2UsIHN0YXRlLCB2YWx1ZSwgdW53cmFwKSB7CiAgICAgIGlmIChzdGF0ZS5kb25lKQogICAgICByZXR1cm47CiAgICAgIHN0YXRlLmRvbmUgPSB0cnVlOwogICAgICBpZiAodW53cmFwKQogICAgICBzdGF0ZSA9IHVud3JhcDsKICAgICAgc3RhdGUudmFsdWUgPSB2YWx1ZTsKICAgICAgc3RhdGUuc3RhdGUgPSBSRUpFQ1RFRDsKICAgICAgbm90aWZ5KHByb21pc2UsIHN0YXRlLCB0cnVlKTsKICAgIH07CiAgICB2YXIgX2ludGVybmFsUmVzb2x2ZSA9IGZ1bmN0aW9uIGludGVybmFsUmVzb2x2ZShwcm9taXNlLCBzdGF0ZSwgdmFsdWUsIHVud3JhcCkgewogICAgICBpZiAoc3RhdGUuZG9uZSkKICAgICAgcmV0dXJuOwogICAgICBzdGF0ZS5kb25lID0gdHJ1ZTsKICAgICAgaWYgKHVud3JhcCkKICAgICAgc3RhdGUgPSB1bndyYXA7CiAgICAgIHRyeSB7CiAgICAgICAgaWYgKHByb21pc2UgPT09IHZhbHVlKQogICAgICAgIHRocm93IFR5cGVFcnJvcigiUHJvbWlzZSBjYW4ndCBiZSByZXNvbHZlZCBpdHNlbGYiKTsKICAgICAgICB2YXIgdGhlbiA9IGlzVGhlbmFibGUodmFsdWUpOwogICAgICAgIGlmICh0aGVuKSB7CiAgICAgICAgICBtaWNyb3Rhc2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgd3JhcHBlciA9IHsgZG9uZTogZmFsc2UgfTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICB0aGVuLmNhbGwodmFsdWUsIGJpbmQoX2ludGVybmFsUmVzb2x2ZSwgcHJvbWlzZSwgd3JhcHBlciwgc3RhdGUpLCBiaW5kKGludGVybmFsUmVqZWN0LCBwcm9taXNlLCB3cmFwcGVyLCBzdGF0ZSkpOwogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgIGludGVybmFsUmVqZWN0KHByb21pc2UsIHdyYXBwZXIsIGVycm9yLCBzdGF0ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdGF0ZS52YWx1ZSA9IHZhbHVlOwogICAgICAgICAgc3RhdGUuc3RhdGUgPSBGVUxGSUxMRUQ7CiAgICAgICAgICBub3RpZnkocHJvbWlzZSwgc3RhdGUsIGZhbHNlKTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgaW50ZXJuYWxSZWplY3QocHJvbWlzZSwgeyBkb25lOiBmYWxzZSB9LCBlcnJvciwgc3RhdGUpOwogICAgICB9CiAgICB9OwogICAgaWYgKEZPUkNFRCkgewogICAgICBQcm9taXNlQ29uc3RydWN0b3IgPSBmdW5jdGlvbiBQcm9taXNlKGV4ZWN1dG9yKSB7CiAgICAgICAgYW5JbnN0YW5jZSh0aGlzLCBQcm9taXNlQ29uc3RydWN0b3IsIFBST01JU0UpOwogICAgICAgIGFGdW5jdGlvbihleGVjdXRvcik7CiAgICAgICAgSW50ZXJuYWwuY2FsbCh0aGlzKTsKICAgICAgICB2YXIgc3RhdGUgPSBnZXRJbnRlcm5hbFN0YXRlKHRoaXMpOwogICAgICAgIHRyeSB7CiAgICAgICAgICBleGVjdXRvcihiaW5kKF9pbnRlcm5hbFJlc29sdmUsIHRoaXMsIHN0YXRlKSwgYmluZChpbnRlcm5hbFJlamVjdCwgdGhpcywgc3RhdGUpKTsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgaW50ZXJuYWxSZWplY3QodGhpcywgc3RhdGUsIGVycm9yKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIEludGVybmFsID0gZnVuY3Rpb24gUHJvbWlzZShleGVjdXRvcikgewogICAgICAgIHNldEludGVybmFsU3RhdGUodGhpcywgewogICAgICAgICAgdHlwZTogUFJPTUlTRSwKICAgICAgICAgIGRvbmU6IGZhbHNlLAogICAgICAgICAgbm90aWZpZWQ6IGZhbHNlLAogICAgICAgICAgcGFyZW50OiBmYWxzZSwKICAgICAgICAgIHJlYWN0aW9uczogW10sCiAgICAgICAgICByZWplY3Rpb246IGZhbHNlLAogICAgICAgICAgc3RhdGU6IFBFTkRJTkcsCiAgICAgICAgICB2YWx1ZTogdW5kZWZpbmVkCiAgICAgICAgfSk7CiAgICAgIH07CiAgICAgIEludGVybmFsLnByb3RvdHlwZSA9IHJlZGVmaW5lQWxsKFByb21pc2VDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHsKICAgICAgICB0aGVuOiBmdW5jdGlvbiB0aGVuKG9uRnVsZmlsbGVkLCBvblJlamVjdGVkKSB7CiAgICAgICAgICB2YXIgc3RhdGUgPSBnZXRJbnRlcm5hbFByb21pc2VTdGF0ZSh0aGlzKTsKICAgICAgICAgIHZhciByZWFjdGlvbiA9IG5ld1Byb21pc2VDYXBhYmlsaXR5KHNwZWNpZXNDb25zdHJ1Y3Rvcih0aGlzLCBQcm9taXNlQ29uc3RydWN0b3IpKTsKICAgICAgICAgIHJlYWN0aW9uLm9rID0gdHlwZW9mIG9uRnVsZmlsbGVkID09ICdmdW5jdGlvbicgPyBvbkZ1bGZpbGxlZCA6IHRydWU7CiAgICAgICAgICByZWFjdGlvbi5mYWlsID0gdHlwZW9mIG9uUmVqZWN0ZWQgPT0gJ2Z1bmN0aW9uJyAmJiBvblJlamVjdGVkOwogICAgICAgICAgcmVhY3Rpb24uZG9tYWluID0gSVNfTk9ERSA/IHByb2Nlc3MuZG9tYWluIDogdW5kZWZpbmVkOwogICAgICAgICAgc3RhdGUucGFyZW50ID0gdHJ1ZTsKICAgICAgICAgIHN0YXRlLnJlYWN0aW9ucy5wdXNoKHJlYWN0aW9uKTsKICAgICAgICAgIGlmIChzdGF0ZS5zdGF0ZSAhPSBQRU5ESU5HKQogICAgICAgICAgbm90aWZ5KHRoaXMsIHN0YXRlLCBmYWxzZSk7CiAgICAgICAgICByZXR1cm4gcmVhY3Rpb24ucHJvbWlzZTsKICAgICAgICB9LAogICAgICAgICdjYXRjaCc6IGZ1bmN0aW9uIF9jYXRjaChvblJlamVjdGVkKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy50aGVuKHVuZGVmaW5lZCwgb25SZWplY3RlZCk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgT3duUHJvbWlzZUNhcGFiaWxpdHkgPSBmdW5jdGlvbiBPd25Qcm9taXNlQ2FwYWJpbGl0eSgpIHsKICAgICAgICB2YXIgcHJvbWlzZSA9IG5ldyBJbnRlcm5hbCgpOwogICAgICAgIHZhciBzdGF0ZSA9IGdldEludGVybmFsU3RhdGUocHJvbWlzZSk7CiAgICAgICAgdGhpcy5wcm9taXNlID0gcHJvbWlzZTsKICAgICAgICB0aGlzLnJlc29sdmUgPSBiaW5kKF9pbnRlcm5hbFJlc29sdmUsIHByb21pc2UsIHN0YXRlKTsKICAgICAgICB0aGlzLnJlamVjdCA9IGJpbmQoaW50ZXJuYWxSZWplY3QsIHByb21pc2UsIHN0YXRlKTsKICAgICAgfTsKICAgICAgbmV3UHJvbWlzZUNhcGFiaWxpdHlNb2R1bGUuZiA9IG5ld1Byb21pc2VDYXBhYmlsaXR5ID0gZnVuY3Rpb24gbmV3UHJvbWlzZUNhcGFiaWxpdHkoQykgewogICAgICAgIHJldHVybiBDID09PSBQcm9taXNlQ29uc3RydWN0b3IgfHwgQyA9PT0gUHJvbWlzZVdyYXBwZXIgPyBuZXcgT3duUHJvbWlzZUNhcGFiaWxpdHkoQykgOiBuZXdHZW5lcmljUHJvbWlzZUNhcGFiaWxpdHkoQyk7CiAgICAgIH07CiAgICAgIGlmICghSVNfUFVSRSAmJiB0eXBlb2YgTmF0aXZlUHJvbWlzZSA9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgbmF0aXZlVGhlbiA9IE5hdGl2ZVByb21pc2UucHJvdG90eXBlLnRoZW47CiAgICAgICAgcmVkZWZpbmUoTmF0aXZlUHJvbWlzZS5wcm90b3R5cGUsICd0aGVuJywgZnVuY3Rpb24gdGhlbihvbkZ1bGZpbGxlZCwgb25SZWplY3RlZCkgewogICAgICAgICAgdmFyIHRoYXQgPSB0aGlzOwogICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlQ29uc3RydWN0b3IoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgICBuYXRpdmVUaGVuLmNhbGwodGhhdCwgcmVzb2x2ZSwgcmVqZWN0KTsKICAgICAgICAgIH0pLnRoZW4ob25GdWxmaWxsZWQsIG9uUmVqZWN0ZWQpOwogICAgICAgIH0sIHsgdW5zYWZlOiB0cnVlIH0pOwogICAgICAgIGlmICh0eXBlb2YgJGZldGNoID09ICdmdW5jdGlvbicpCiAgICAgICAgJCh7CiAgICAgICAgICBnbG9iYWw6IHRydWUsCiAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgICAgZm9yY2VkOiB0cnVlCiAgICAgICAgfSwgewogICAgICAgICAgZmV0Y2g6IGZ1bmN0aW9uIGZldGNoKGlucHV0KSB7CiAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVzb2x2ZShQcm9taXNlQ29uc3RydWN0b3IsICRmZXRjaC5hcHBseShnbG9iYWwsIGFyZ3VtZW50cykpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgICAkKHsKICAgICAgZ2xvYmFsOiB0cnVlLAogICAgICB3cmFwOiB0cnVlLAogICAgICBmb3JjZWQ6IEZPUkNFRAogICAgfSwgeyBQcm9taXNlOiBQcm9taXNlQ29uc3RydWN0b3IgfSk7CiAgICBzZXRUb1N0cmluZ1RhZyhQcm9taXNlQ29uc3RydWN0b3IsIFBST01JU0UsIGZhbHNlLCB0cnVlKTsKICAgIHNldFNwZWNpZXMoUFJPTUlTRSk7CiAgICBQcm9taXNlV3JhcHBlciA9IGdldEJ1aWx0SW4oUFJPTUlTRSk7CiAgICAkKHsKICAgICAgdGFyZ2V0OiBQUk9NSVNFLAogICAgICBzdGF0OiB0cnVlLAogICAgICBmb3JjZWQ6IEZPUkNFRAogICAgfSwgewogICAgICByZWplY3Q6IGZ1bmN0aW9uIHJlamVjdChyKSB7CiAgICAgICAgdmFyIGNhcGFiaWxpdHkgPSBuZXdQcm9taXNlQ2FwYWJpbGl0eSh0aGlzKTsKICAgICAgICBjYXBhYmlsaXR5LnJlamVjdC5jYWxsKHVuZGVmaW5lZCwgcik7CiAgICAgICAgcmV0dXJuIGNhcGFiaWxpdHkucHJvbWlzZTsKICAgICAgfQogICAgfSk7CiAgICAkKHsKICAgICAgdGFyZ2V0OiBQUk9NSVNFLAogICAgICBzdGF0OiB0cnVlLAogICAgICBmb3JjZWQ6IElTX1BVUkUgfHwgRk9SQ0VECiAgICB9LCB7CiAgICAgIHJlc29sdmU6IGZ1bmN0aW9uIHJlc29sdmUoeCkgewogICAgICAgIHJldHVybiBwcm9taXNlUmVzb2x2ZShJU19QVVJFICYmIHRoaXMgPT09IFByb21pc2VXcmFwcGVyID8gUHJvbWlzZUNvbnN0cnVjdG9yIDogdGhpcywgeCk7CiAgICAgIH0KICAgIH0pOwogICAgJCh7CiAgICAgIHRhcmdldDogUFJPTUlTRSwKICAgICAgc3RhdDogdHJ1ZSwKICAgICAgZm9yY2VkOiBJTkNPUlJFQ1RfSVRFUkFUSU9OCiAgICB9LCB7CiAgICAgIGFsbDogZnVuY3Rpb24gYWxsKGl0ZXJhYmxlKSB7CiAgICAgICAgdmFyIEMgPSB0aGlzOwogICAgICAgIHZhciBjYXBhYmlsaXR5ID0gbmV3UHJvbWlzZUNhcGFiaWxpdHkoQyk7CiAgICAgICAgdmFyIHJlc29sdmUgPSBjYXBhYmlsaXR5LnJlc29sdmU7CiAgICAgICAgdmFyIHJlamVjdCA9IGNhcGFiaWxpdHkucmVqZWN0OwogICAgICAgIHZhciByZXN1bHQgPSBwZXJmb3JtKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciAkcHJvbWlzZVJlc29sdmUgPSBhRnVuY3Rpb24oQy5yZXNvbHZlKTsKICAgICAgICAgIHZhciB2YWx1ZXMgPSBbXTsKICAgICAgICAgIHZhciBjb3VudGVyID0gMDsKICAgICAgICAgIHZhciByZW1haW5pbmcgPSAxOwogICAgICAgICAgaXRlcmF0ZShpdGVyYWJsZSwgZnVuY3Rpb24gKHByb21pc2UpIHsKICAgICAgICAgICAgdmFyIGluZGV4ID0gY291bnRlcisrOwogICAgICAgICAgICB2YXIgYWxyZWFkeUNhbGxlZCA9IGZhbHNlOwogICAgICAgICAgICB2YWx1ZXMucHVzaCh1bmRlZmluZWQpOwogICAgICAgICAgICByZW1haW5pbmcrKzsKICAgICAgICAgICAgJHByb21pc2VSZXNvbHZlLmNhbGwoQywgcHJvbWlzZSkudGhlbihmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICAgICAgICBpZiAoYWxyZWFkeUNhbGxlZCkKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgYWxyZWFkeUNhbGxlZCA9IHRydWU7CiAgICAgICAgICAgICAgdmFsdWVzW2luZGV4XSA9IHZhbHVlOwogICAgICAgICAgICAgIC0tcmVtYWluaW5nIHx8IHJlc29sdmUodmFsdWVzKTsKICAgICAgICAgICAgfSwgcmVqZWN0KTsKICAgICAgICAgIH0pOwogICAgICAgICAgLS1yZW1haW5pbmcgfHwgcmVzb2x2ZSh2YWx1ZXMpOwogICAgICAgIH0pOwogICAgICAgIGlmIChyZXN1bHQuZXJyb3IpCiAgICAgICAgcmVqZWN0KHJlc3VsdC52YWx1ZSk7CiAgICAgICAgcmV0dXJuIGNhcGFiaWxpdHkucHJvbWlzZTsKICAgICAgfSwKICAgICAgcmFjZTogZnVuY3Rpb24gcmFjZShpdGVyYWJsZSkgewogICAgICAgIHZhciBDID0gdGhpczsKICAgICAgICB2YXIgY2FwYWJpbGl0eSA9IG5ld1Byb21pc2VDYXBhYmlsaXR5KEMpOwogICAgICAgIHZhciByZWplY3QgPSBjYXBhYmlsaXR5LnJlamVjdDsKICAgICAgICB2YXIgcmVzdWx0ID0gcGVyZm9ybShmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgJHByb21pc2VSZXNvbHZlID0gYUZ1bmN0aW9uKEMucmVzb2x2ZSk7CiAgICAgICAgICBpdGVyYXRlKGl0ZXJhYmxlLCBmdW5jdGlvbiAocHJvbWlzZSkgewogICAgICAgICAgICAkcHJvbWlzZVJlc29sdmUuY2FsbChDLCBwcm9taXNlKS50aGVuKGNhcGFiaWxpdHkucmVzb2x2ZSwgcmVqZWN0KTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICAgIGlmIChyZXN1bHQuZXJyb3IpCiAgICAgICAgcmVqZWN0KHJlc3VsdC52YWx1ZSk7CiAgICAgICAgcmV0dXJuIGNhcGFiaWxpdHkucHJvbWlzZTsKICAgICAgfQogICAgfSk7CgogICAgLyoqKi99KSwgKAogIC8qIDExNSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBnbG9iYWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEwKTsKICAgIG1vZHVsZS5leHBvcnRzID0gZ2xvYmFsLlByb21pc2U7CgogICAgLyoqKi99KSwgKAogIC8qIDExNiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciByZWRlZmluZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjgpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAodGFyZ2V0LCBzcmMsIG9wdGlvbnMpIHsKICAgICAgZm9yICh2YXIga2V5IGluIHNyYykKICAgICAgcmVkZWZpbmUodGFyZ2V0LCBrZXksIHNyY1trZXldLCBvcHRpb25zKTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDExNyAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgZ2V0QnVpbHRJbiA9IF9fd19wZGZqc19yZXF1aXJlX18oNDEpOwogICAgdmFyIGRlZmluZVByb3BlcnR5TW9kdWxlID0gX193X3BkZmpzX3JlcXVpcmVfXygyNik7CiAgICB2YXIgd2VsbEtub3duU3ltYm9sID0gX193X3BkZmpzX3JlcXVpcmVfXyg1Nyk7CiAgICB2YXIgREVTQ1JJUFRPUlMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEyKTsKICAgIHZhciBTUEVDSUVTID0gd2VsbEtub3duU3ltYm9sKCdzcGVjaWVzJyk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChDT05TVFJVQ1RPUl9OQU1FKSB7CiAgICAgIHZhciBDb25zdHJ1Y3RvciA9IGdldEJ1aWx0SW4oQ09OU1RSVUNUT1JfTkFNRSk7CiAgICAgIHZhciBkZWZpbmVQcm9wZXJ0eSA9IGRlZmluZVByb3BlcnR5TW9kdWxlLmY7CiAgICAgIGlmIChERVNDUklQVE9SUyAmJiBDb25zdHJ1Y3RvciAmJiAhQ29uc3RydWN0b3JbU1BFQ0lFU10pIHsKICAgICAgICBkZWZpbmVQcm9wZXJ0eShDb25zdHJ1Y3RvciwgU1BFQ0lFUywgewogICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAxMTggKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKCiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCwgQ29uc3RydWN0b3IsIG5hbWUpIHsKICAgICAgaWYgKCEoaXQgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsKICAgICAgICB0aHJvdyBUeXBlRXJyb3IoJ0luY29ycmVjdCAnICsgKG5hbWUgPyBuYW1lICsgJyAnIDogJycpICsgJ2ludm9jYXRpb24nKTsKICAgICAgfQogICAgICByZXR1cm4gaXQ7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAxMTkgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgYW5PYmplY3QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDI3KTsKICAgIHZhciBpc0FycmF5SXRlcmF0b3JNZXRob2QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDkyKTsKICAgIHZhciB0b0xlbmd0aCA9IF9fd19wZGZqc19yZXF1aXJlX18oNDYpOwogICAgdmFyIGJpbmQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDYyKTsKICAgIHZhciBnZXRJdGVyYXRvck1ldGhvZCA9IF9fd19wZGZqc19yZXF1aXJlX18oOTQpOwogICAgdmFyIGNhbGxXaXRoU2FmZUl0ZXJhdGlvbkNsb3NpbmcgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDkxKTsKICAgIHZhciBSZXN1bHQgPSBmdW5jdGlvbiBSZXN1bHQoc3RvcHBlZCwgcmVzdWx0KSB7CiAgICAgIHRoaXMuc3RvcHBlZCA9IHN0b3BwZWQ7CiAgICAgIHRoaXMucmVzdWx0ID0gcmVzdWx0OwogICAgfTsKICAgIHZhciBpdGVyYXRlID0gbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXRlcmFibGUsIGZuLCB0aGF0LCBBU19FTlRSSUVTLCBJU19JVEVSQVRPUikgewogICAgICB2YXIgYm91bmRGdW5jdGlvbiA9IGJpbmQoZm4sIHRoYXQsIEFTX0VOVFJJRVMgPyAyIDogMSk7CiAgICAgIHZhciBpdGVyYXRvciwgaXRlckZuLCBpbmRleCwgbGVuZ3RoLCByZXN1bHQsIG5leHQsIHN0ZXA7CiAgICAgIGlmIChJU19JVEVSQVRPUikgewogICAgICAgIGl0ZXJhdG9yID0gaXRlcmFibGU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaXRlckZuID0gZ2V0SXRlcmF0b3JNZXRob2QoaXRlcmFibGUpOwogICAgICAgIGlmICh0eXBlb2YgaXRlckZuICE9ICdmdW5jdGlvbicpCiAgICAgICAgdGhyb3cgVHlwZUVycm9yKCdUYXJnZXQgaXMgbm90IGl0ZXJhYmxlJyk7CiAgICAgICAgaWYgKGlzQXJyYXlJdGVyYXRvck1ldGhvZChpdGVyRm4pKSB7CiAgICAgICAgICBmb3IgKGluZGV4ID0gMCwgbGVuZ3RoID0gdG9MZW5ndGgoaXRlcmFibGUubGVuZ3RoKTsgbGVuZ3RoID4gaW5kZXg7IGluZGV4KyspIHsKICAgICAgICAgICAgcmVzdWx0ID0gQVNfRU5UUklFUyA/IGJvdW5kRnVuY3Rpb24oYW5PYmplY3Qoc3RlcCA9IGl0ZXJhYmxlW2luZGV4XSlbMF0sIHN0ZXBbMV0pIDogYm91bmRGdW5jdGlvbihpdGVyYWJsZVtpbmRleF0pOwogICAgICAgICAgICBpZiAocmVzdWx0ICYmIHJlc3VsdCBpbnN0YW5jZW9mIFJlc3VsdCkKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBuZXcgUmVzdWx0KGZhbHNlKTsKICAgICAgICB9CiAgICAgICAgaXRlcmF0b3IgPSBpdGVyRm4uY2FsbChpdGVyYWJsZSk7CiAgICAgIH0KICAgICAgbmV4dCA9IGl0ZXJhdG9yLm5leHQ7CiAgICAgIHdoaWxlICghKHN0ZXAgPSBuZXh0LmNhbGwoaXRlcmF0b3IpKS5kb25lKSB7CiAgICAgICAgcmVzdWx0ID0gY2FsbFdpdGhTYWZlSXRlcmF0aW9uQ2xvc2luZyhpdGVyYXRvciwgYm91bmRGdW5jdGlvbiwgc3RlcC52YWx1ZSwgQVNfRU5UUklFUyk7CiAgICAgICAgaWYgKHR5cGVvZiByZXN1bHQgPT0gJ29iamVjdCcgJiYgcmVzdWx0ICYmIHJlc3VsdCBpbnN0YW5jZW9mIFJlc3VsdCkKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9CiAgICAgIHJldHVybiBuZXcgUmVzdWx0KGZhbHNlKTsKICAgIH07CiAgICBpdGVyYXRlLnN0b3AgPSBmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgIHJldHVybiBuZXcgUmVzdWx0KHRydWUsIHJlc3VsdCk7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAxMjAgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgYW5PYmplY3QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDI3KTsKICAgIHZhciBhRnVuY3Rpb24gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDYzKTsKICAgIHZhciB3ZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDU3KTsKICAgIHZhciBTUEVDSUVTID0gd2VsbEtub3duU3ltYm9sKCdzcGVjaWVzJyk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChPLCBkZWZhdWx0Q29uc3RydWN0b3IpIHsKICAgICAgdmFyIEMgPSBhbk9iamVjdChPKS5jb25zdHJ1Y3RvcjsKICAgICAgdmFyIFM7CiAgICAgIHJldHVybiBDID09PSB1bmRlZmluZWQgfHwgKFMgPSBhbk9iamVjdChDKVtTUEVDSUVTXSkgPT0gdW5kZWZpbmVkID8gZGVmYXVsdENvbnN0cnVjdG9yIDogYUZ1bmN0aW9uKFMpOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogMTIxICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGdsb2JhbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTApOwogICAgdmFyIGZhaWxzID0gX193X3BkZmpzX3JlcXVpcmVfXygxMyk7CiAgICB2YXIgY2xhc3NvZiA9IF9fd19wZGZqc19yZXF1aXJlX18oMTgpOwogICAgdmFyIGJpbmQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDYyKTsKICAgIHZhciBodG1sID0gX193X3BkZmpzX3JlcXVpcmVfXyg3NCk7CiAgICB2YXIgY3JlYXRlRWxlbWVudCA9IF9fd19wZGZqc19yZXF1aXJlX18oMjQpOwogICAgdmFyIElTX0lPUyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTIyKTsKICAgIHZhciBsb2NhdGlvbiA9IGdsb2JhbC5sb2NhdGlvbjsKICAgIHZhciBzZXQgPSBnbG9iYWwuc2V0SW1tZWRpYXRlOwogICAgdmFyIGNsZWFyID0gZ2xvYmFsLmNsZWFySW1tZWRpYXRlOwogICAgdmFyIHByb2Nlc3MgPSBnbG9iYWwucHJvY2VzczsKICAgIHZhciBNZXNzYWdlQ2hhbm5lbCA9IGdsb2JhbC5NZXNzYWdlQ2hhbm5lbDsKICAgIHZhciBEaXNwYXRjaCA9IGdsb2JhbC5EaXNwYXRjaDsKICAgIHZhciBjb3VudGVyID0gMDsKICAgIHZhciBxdWV1ZSA9IHt9OwogICAgdmFyIE9OUkVBRFlTVEFURUNIQU5HRSA9ICdvbnJlYWR5c3RhdGVjaGFuZ2UnOwogICAgdmFyIGRlZmVyLCBjaGFubmVsLCBwb3J0OwogICAgdmFyIHJ1biA9IGZ1bmN0aW9uIHJ1bihpZCkgewogICAgICBpZiAocXVldWUuaGFzT3duUHJvcGVydHkoaWQpKSB7CiAgICAgICAgdmFyIGZuID0gcXVldWVbaWRdOwogICAgICAgIGRlbGV0ZSBxdWV1ZVtpZF07CiAgICAgICAgZm4oKTsKICAgICAgfQogICAgfTsKICAgIHZhciBydW5uZXIgPSBmdW5jdGlvbiBydW5uZXIoaWQpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICBydW4oaWQpOwogICAgICB9OwogICAgfTsKICAgIHZhciBsaXN0ZW5lciA9IGZ1bmN0aW9uIGxpc3RlbmVyKGV2ZW50KSB7CiAgICAgIHJ1bihldmVudC5kYXRhKTsKICAgIH07CiAgICB2YXIgcG9zdCA9IGZ1bmN0aW9uIHBvc3QoaWQpIHsKICAgICAgZ2xvYmFsLnBvc3RNZXNzYWdlKGlkICsgJycsIGxvY2F0aW9uLnByb3RvY29sICsgJy8vJyArIGxvY2F0aW9uLmhvc3QpOwogICAgfTsKICAgIGlmICghc2V0IHx8ICFjbGVhcikgewogICAgICBzZXQgPSBmdW5jdGlvbiBzZXRJbW1lZGlhdGUoZm4pIHsKICAgICAgICB2YXIgYXJncyA9IFtdOwogICAgICAgIHZhciBpID0gMTsKICAgICAgICB3aGlsZSAoYXJndW1lbnRzLmxlbmd0aCA+IGkpCiAgICAgICAgYXJncy5wdXNoKGFyZ3VtZW50c1tpKytdKTsKICAgICAgICBxdWV1ZVsrK2NvdW50ZXJdID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgKHR5cGVvZiBmbiA9PSAnZnVuY3Rpb24nID8gZm4gOiBGdW5jdGlvbihmbikpLmFwcGx5KHVuZGVmaW5lZCwgYXJncyk7CiAgICAgICAgfTsKICAgICAgICBkZWZlcihjb3VudGVyKTsKICAgICAgICByZXR1cm4gY291bnRlcjsKICAgICAgfTsKICAgICAgY2xlYXIgPSBmdW5jdGlvbiBjbGVhckltbWVkaWF0ZShpZCkgewogICAgICAgIGRlbGV0ZSBxdWV1ZVtpZF07CiAgICAgIH07CiAgICAgIGlmIChjbGFzc29mKHByb2Nlc3MpID09ICdwcm9jZXNzJykgewogICAgICAgIGRlZmVyID0gZnVuY3Rpb24gZGVmZXIoaWQpIHsKICAgICAgICAgIHByb2Nlc3MubmV4dFRpY2socnVubmVyKGlkKSk7CiAgICAgICAgfTsKICAgICAgfSBlbHNlIGlmIChEaXNwYXRjaCAmJiBEaXNwYXRjaC5ub3cpIHsKICAgICAgICBkZWZlciA9IGZ1bmN0aW9uIGRlZmVyKGlkKSB7CiAgICAgICAgICBEaXNwYXRjaC5ub3cocnVubmVyKGlkKSk7CiAgICAgICAgfTsKICAgICAgfSBlbHNlIGlmIChNZXNzYWdlQ2hhbm5lbCAmJiAhSVNfSU9TKSB7CiAgICAgICAgY2hhbm5lbCA9IG5ldyBNZXNzYWdlQ2hhbm5lbCgpOwogICAgICAgIHBvcnQgPSBjaGFubmVsLnBvcnQyOwogICAgICAgIGNoYW5uZWwucG9ydDEub25tZXNzYWdlID0gbGlzdGVuZXI7CiAgICAgICAgZGVmZXIgPSBiaW5kKHBvcnQucG9zdE1lc3NhZ2UsIHBvcnQsIDEpOwogICAgICB9IGVsc2UgaWYgKGdsb2JhbC5hZGRFdmVudExpc3RlbmVyICYmIHR5cGVvZiBwb3N0TWVzc2FnZSA9PSAnZnVuY3Rpb24nICYmICFnbG9iYWwuaW1wb3J0U2NyaXB0cyAmJiAhZmFpbHMocG9zdCkpIHsKICAgICAgICBkZWZlciA9IHBvc3Q7CiAgICAgICAgZ2xvYmFsLmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBsaXN0ZW5lciwgZmFsc2UpOwogICAgICB9IGVsc2UgaWYgKE9OUkVBRFlTVEFURUNIQU5HRSBpbiBjcmVhdGVFbGVtZW50KCdzY3JpcHQnKSkgewogICAgICAgIGRlZmVyID0gZnVuY3Rpb24gZGVmZXIoaWQpIHsKICAgICAgICAgIGh0bWwuYXBwZW5kQ2hpbGQoY3JlYXRlRWxlbWVudCgnc2NyaXB0JykpW09OUkVBRFlTVEFURUNIQU5HRV0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGh0bWwucmVtb3ZlQ2hpbGQodGhpcyk7CiAgICAgICAgICAgIHJ1bihpZCk7CiAgICAgICAgICB9OwogICAgICAgIH07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGVmZXIgPSBmdW5jdGlvbiBkZWZlcihpZCkgewogICAgICAgICAgc2V0VGltZW91dChydW5uZXIoaWQpLCAwKTsKICAgICAgICB9OwogICAgICB9CiAgICB9CiAgICBtb2R1bGUuZXhwb3J0cyA9IHsKICAgICAgc2V0OiBzZXQsCiAgICAgIGNsZWFyOiBjbGVhcgogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogMTIyICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIHVzZXJBZ2VudCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTIzKTsKICAgIG1vZHVsZS5leHBvcnRzID0gLyhpcGhvbmV8aXBvZHxpcGFkKS4qYXBwbGV3ZWJraXQvaS50ZXN0KHVzZXJBZ2VudCk7CgogICAgLyoqKi99KSwgKAogIC8qIDEyMyAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBnZXRCdWlsdEluID0gX193X3BkZmpzX3JlcXVpcmVfXyg0MSk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGdldEJ1aWx0SW4oJ25hdmlnYXRvcicsICd1c2VyQWdlbnQnKSB8fCAnJzsKCiAgICAvKioqL30pLCAoCiAgLyogMTI0ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGdsb2JhbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTApOwogICAgdmFyIGdldE93blByb3BlcnR5RGVzY3JpcHRvciA9IF9fd19wZGZqc19yZXF1aXJlX18oMTEpLmY7CiAgICB2YXIgY2xhc3NvZiA9IF9fd19wZGZqc19yZXF1aXJlX18oMTgpOwogICAgdmFyIG1hY3JvdGFzayA9IF9fd19wZGZqc19yZXF1aXJlX18oMTIxKS5zZXQ7CiAgICB2YXIgSVNfSU9TID0gX193X3BkZmpzX3JlcXVpcmVfXygxMjIpOwogICAgdmFyIE11dGF0aW9uT2JzZXJ2ZXIgPSBnbG9iYWwuTXV0YXRpb25PYnNlcnZlciB8fCBnbG9iYWwuV2ViS2l0TXV0YXRpb25PYnNlcnZlcjsKICAgIHZhciBwcm9jZXNzID0gZ2xvYmFsLnByb2Nlc3M7CiAgICB2YXIgUHJvbWlzZSA9IGdsb2JhbC5Qcm9taXNlOwogICAgdmFyIElTX05PREUgPSBjbGFzc29mKHByb2Nlc3MpID09ICdwcm9jZXNzJzsKICAgIHZhciBxdWV1ZU1pY3JvdGFza0Rlc2NyaXB0b3IgPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoZ2xvYmFsLCAncXVldWVNaWNyb3Rhc2snKTsKICAgIHZhciBxdWV1ZU1pY3JvdGFzayA9IHF1ZXVlTWljcm90YXNrRGVzY3JpcHRvciAmJiBxdWV1ZU1pY3JvdGFza0Rlc2NyaXB0b3IudmFsdWU7CiAgICB2YXIgZmx1c2gsIGhlYWQsIGxhc3QsIG5vdGlmeSwgdG9nZ2xlLCBub2RlLCBwcm9taXNlLCB0aGVuOwogICAgaWYgKCFxdWV1ZU1pY3JvdGFzaykgewogICAgICBmbHVzaCA9IGZ1bmN0aW9uIGZsdXNoKCkgewogICAgICAgIHZhciBwYXJlbnQsIGZuOwogICAgICAgIGlmIChJU19OT0RFICYmIChwYXJlbnQgPSBwcm9jZXNzLmRvbWFpbikpCiAgICAgICAgcGFyZW50LmV4aXQoKTsKICAgICAgICB3aGlsZSAoaGVhZCkgewogICAgICAgICAgZm4gPSBoZWFkLmZuOwogICAgICAgICAgaGVhZCA9IGhlYWQubmV4dDsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZuKCk7CiAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICBpZiAoaGVhZCkKICAgICAgICAgICAgbm90aWZ5KCk7ZWxzZQoKICAgICAgICAgICAgbGFzdCA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgdGhyb3cgZXJyb3I7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGxhc3QgPSB1bmRlZmluZWQ7CiAgICAgICAgaWYgKHBhcmVudCkKICAgICAgICBwYXJlbnQuZW50ZXIoKTsKICAgICAgfTsKICAgICAgaWYgKElTX05PREUpIHsKICAgICAgICBub3RpZnkgPSBmdW5jdGlvbiBub3RpZnkoKSB7CiAgICAgICAgICBwcm9jZXNzLm5leHRUaWNrKGZsdXNoKTsKICAgICAgICB9OwogICAgICB9IGVsc2UgaWYgKE11dGF0aW9uT2JzZXJ2ZXIgJiYgIUlTX0lPUykgewogICAgICAgIHRvZ2dsZSA9IHRydWU7CiAgICAgICAgbm9kZSA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnKTsKICAgICAgICBuZXcgTXV0YXRpb25PYnNlcnZlcihmbHVzaCkub2JzZXJ2ZShub2RlLCB7IGNoYXJhY3RlckRhdGE6IHRydWUgfSk7CiAgICAgICAgbm90aWZ5ID0gZnVuY3Rpb24gbm90aWZ5KCkgewogICAgICAgICAgbm9kZS5kYXRhID0gdG9nZ2xlID0gIXRvZ2dsZTsKICAgICAgICB9OwogICAgICB9IGVsc2UgaWYgKFByb21pc2UgJiYgUHJvbWlzZS5yZXNvbHZlKSB7CiAgICAgICAgcHJvbWlzZSA9IFByb21pc2UucmVzb2x2ZSh1bmRlZmluZWQpOwogICAgICAgIHRoZW4gPSBwcm9taXNlLnRoZW47CiAgICAgICAgbm90aWZ5ID0gZnVuY3Rpb24gbm90aWZ5KCkgewogICAgICAgICAgdGhlbi5jYWxsKHByb21pc2UsIGZsdXNoKTsKICAgICAgICB9OwogICAgICB9IGVsc2UgewogICAgICAgIG5vdGlmeSA9IGZ1bmN0aW9uIG5vdGlmeSgpIHsKICAgICAgICAgIG1hY3JvdGFzay5jYWxsKGdsb2JhbCwgZmx1c2gpOwogICAgICAgIH07CiAgICAgIH0KICAgIH0KICAgIG1vZHVsZS5leHBvcnRzID0gcXVldWVNaWNyb3Rhc2sgfHwgZnVuY3Rpb24gKGZuKSB7CiAgICAgIHZhciB0YXNrID0gewogICAgICAgIGZuOiBmbiwKICAgICAgICBuZXh0OiB1bmRlZmluZWQKICAgICAgfTsKICAgICAgaWYgKGxhc3QpCiAgICAgIGxhc3QubmV4dCA9IHRhc2s7CiAgICAgIGlmICghaGVhZCkgewogICAgICAgIGhlYWQgPSB0YXNrOwogICAgICAgIG5vdGlmeSgpOwogICAgICB9CiAgICAgIGxhc3QgPSB0YXNrOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogMTI1ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGFuT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygyNyk7CiAgICB2YXIgaXNPYmplY3QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIxKTsKICAgIHZhciBuZXdQcm9taXNlQ2FwYWJpbGl0eSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTI2KTsKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKEMsIHgpIHsKICAgICAgYW5PYmplY3QoQyk7CiAgICAgIGlmIChpc09iamVjdCh4KSAmJiB4LmNvbnN0cnVjdG9yID09PSBDKQogICAgICByZXR1cm4geDsKICAgICAgdmFyIHByb21pc2VDYXBhYmlsaXR5ID0gbmV3UHJvbWlzZUNhcGFiaWxpdHkuZihDKTsKICAgICAgdmFyIHJlc29sdmUgPSBwcm9taXNlQ2FwYWJpbGl0eS5yZXNvbHZlOwogICAgICByZXNvbHZlKHgpOwogICAgICByZXR1cm4gcHJvbWlzZUNhcGFiaWxpdHkucHJvbWlzZTsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDEyNiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgYUZ1bmN0aW9uID0gX193X3BkZmpzX3JlcXVpcmVfXyg2Myk7CiAgICB2YXIgUHJvbWlzZUNhcGFiaWxpdHkgPSBmdW5jdGlvbiBQcm9taXNlQ2FwYWJpbGl0eShDKSB7CiAgICAgIHZhciByZXNvbHZlLCByZWplY3Q7CiAgICAgIHRoaXMucHJvbWlzZSA9IG5ldyBDKGZ1bmN0aW9uICgkJHJlc29sdmUsICQkcmVqZWN0KSB7CiAgICAgICAgaWYgKHJlc29sdmUgIT09IHVuZGVmaW5lZCB8fCByZWplY3QgIT09IHVuZGVmaW5lZCkKICAgICAgICB0aHJvdyBUeXBlRXJyb3IoJ0JhZCBQcm9taXNlIGNvbnN0cnVjdG9yJyk7CiAgICAgICAgcmVzb2x2ZSA9ICQkcmVzb2x2ZTsKICAgICAgICByZWplY3QgPSAkJHJlamVjdDsKICAgICAgfSk7CiAgICAgIHRoaXMucmVzb2x2ZSA9IGFGdW5jdGlvbihyZXNvbHZlKTsKICAgICAgdGhpcy5yZWplY3QgPSBhRnVuY3Rpb24ocmVqZWN0KTsKICAgIH07CiAgICBtb2R1bGUuZXhwb3J0cy5mID0gZnVuY3Rpb24gKEMpIHsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlQ2FwYWJpbGl0eShDKTsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDEyNyAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBnbG9iYWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEwKTsKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgdmFyIGNvbnNvbGUgPSBnbG9iYWwuY29uc29sZTsKICAgICAgaWYgKGNvbnNvbGUgJiYgY29uc29sZS5lcnJvcikgewogICAgICAgIGFyZ3VtZW50cy5sZW5ndGggPT09IDEgPyBjb25zb2xlLmVycm9yKGEpIDogY29uc29sZS5lcnJvcihhLCBiKTsKICAgICAgfQogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogMTI4ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoZXhlYykgewogICAgICB0cnkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBlcnJvcjogZmFsc2UsCiAgICAgICAgICB2YWx1ZTogZXhlYygpCiAgICAgICAgfTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgZXJyb3I6IHRydWUsCiAgICAgICAgICB2YWx1ZTogZXJyb3IKICAgICAgICB9OwogICAgICB9CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAxMjkgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgZ2xvYmFsID0gX193X3BkZmpzX3JlcXVpcmVfXygxMCk7CiAgICB2YXIgdXNlckFnZW50ID0gX193X3BkZmpzX3JlcXVpcmVfXygxMjMpOwogICAgdmFyIHByb2Nlc3MgPSBnbG9iYWwucHJvY2VzczsKICAgIHZhciB2ZXJzaW9ucyA9IHByb2Nlc3MgJiYgcHJvY2Vzcy52ZXJzaW9uczsKICAgIHZhciB2OCA9IHZlcnNpb25zICYmIHZlcnNpb25zLnY4OwogICAgdmFyIG1hdGNoLCB2ZXJzaW9uOwogICAgaWYgKHY4KSB7CiAgICAgIG1hdGNoID0gdjguc3BsaXQoJy4nKTsKICAgICAgdmVyc2lvbiA9IG1hdGNoWzBdICsgbWF0Y2hbMV07CiAgICB9IGVsc2UgaWYgKHVzZXJBZ2VudCkgewogICAgICBtYXRjaCA9IHVzZXJBZ2VudC5tYXRjaCgvRWRnZVwvKFxkKykvKTsKICAgICAgaWYgKCFtYXRjaCB8fCBtYXRjaFsxXSA+PSA3NCkgewogICAgICAgIG1hdGNoID0gdXNlckFnZW50Lm1hdGNoKC9DaHJvbWVcLyhcZCspLyk7CiAgICAgICAgaWYgKG1hdGNoKQogICAgICAgIHZlcnNpb24gPSBtYXRjaFsxXTsKICAgICAgfQogICAgfQogICAgbW9kdWxlLmV4cG9ydHMgPSB2ZXJzaW9uICYmICt2ZXJzaW9uOwoKICAgIC8qKiovfSksICgKICAvKiAxMzAgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyICQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDkpOwogICAgdmFyIGFGdW5jdGlvbiA9IF9fd19wZGZqc19yZXF1aXJlX18oNjMpOwogICAgdmFyIG5ld1Byb21pc2VDYXBhYmlsaXR5TW9kdWxlID0gX193X3BkZmpzX3JlcXVpcmVfXygxMjYpOwogICAgdmFyIHBlcmZvcm0gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEyOCk7CiAgICB2YXIgaXRlcmF0ZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTE5KTsKICAgICQoewogICAgICB0YXJnZXQ6ICdQcm9taXNlJywKICAgICAgc3RhdDogdHJ1ZQogICAgfSwgewogICAgICBhbGxTZXR0bGVkOiBmdW5jdGlvbiBhbGxTZXR0bGVkKGl0ZXJhYmxlKSB7CiAgICAgICAgdmFyIEMgPSB0aGlzOwogICAgICAgIHZhciBjYXBhYmlsaXR5ID0gbmV3UHJvbWlzZUNhcGFiaWxpdHlNb2R1bGUuZihDKTsKICAgICAgICB2YXIgcmVzb2x2ZSA9IGNhcGFiaWxpdHkucmVzb2x2ZTsKICAgICAgICB2YXIgcmVqZWN0ID0gY2FwYWJpbGl0eS5yZWplY3Q7CiAgICAgICAgdmFyIHJlc3VsdCA9IHBlcmZvcm0oZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIHByb21pc2VSZXNvbHZlID0gYUZ1bmN0aW9uKEMucmVzb2x2ZSk7CiAgICAgICAgICB2YXIgdmFsdWVzID0gW107CiAgICAgICAgICB2YXIgY291bnRlciA9IDA7CiAgICAgICAgICB2YXIgcmVtYWluaW5nID0gMTsKICAgICAgICAgIGl0ZXJhdGUoaXRlcmFibGUsIGZ1bmN0aW9uIChwcm9taXNlKSB7CiAgICAgICAgICAgIHZhciBpbmRleCA9IGNvdW50ZXIrKzsKICAgICAgICAgICAgdmFyIGFscmVhZHlDYWxsZWQgPSBmYWxzZTsKICAgICAgICAgICAgdmFsdWVzLnB1c2godW5kZWZpbmVkKTsKICAgICAgICAgICAgcmVtYWluaW5nKys7CiAgICAgICAgICAgIHByb21pc2VSZXNvbHZlLmNhbGwoQywgcHJvbWlzZSkudGhlbihmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICAgICAgICBpZiAoYWxyZWFkeUNhbGxlZCkKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgYWxyZWFkeUNhbGxlZCA9IHRydWU7CiAgICAgICAgICAgICAgdmFsdWVzW2luZGV4XSA9IHsKICAgICAgICAgICAgICAgIHN0YXR1czogJ2Z1bGZpbGxlZCcsCiAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIC0tcmVtYWluaW5nIHx8IHJlc29sdmUodmFsdWVzKTsKICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICBpZiAoYWxyZWFkeUNhbGxlZCkKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgYWxyZWFkeUNhbGxlZCA9IHRydWU7CiAgICAgICAgICAgICAgdmFsdWVzW2luZGV4XSA9IHsKICAgICAgICAgICAgICAgIHN0YXR1czogJ3JlamVjdGVkJywKICAgICAgICAgICAgICAgIHJlYXNvbjogZQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgLS1yZW1haW5pbmcgfHwgcmVzb2x2ZSh2YWx1ZXMpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgICAgLS1yZW1haW5pbmcgfHwgcmVzb2x2ZSh2YWx1ZXMpOwogICAgICAgIH0pOwogICAgICAgIGlmIChyZXN1bHQuZXJyb3IpCiAgICAgICAgcmVqZWN0KHJlc3VsdC52YWx1ZSk7CiAgICAgICAgcmV0dXJuIGNhcGFiaWxpdHkucHJvbWlzZTsKICAgICAgfQogICAgfSk7CgogICAgLyoqKi99KSwgKAogIC8qIDEzMSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgJCA9IF9fd19wZGZqc19yZXF1aXJlX18oOSk7CiAgICB2YXIgSVNfUFVSRSA9IF9fd19wZGZqc19yZXF1aXJlX18oMzYpOwogICAgdmFyIE5hdGl2ZVByb21pc2UgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDExNSk7CiAgICB2YXIgZmFpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEzKTsKICAgIHZhciBnZXRCdWlsdEluID0gX193X3BkZmpzX3JlcXVpcmVfXyg0MSk7CiAgICB2YXIgc3BlY2llc0NvbnN0cnVjdG9yID0gX193X3BkZmpzX3JlcXVpcmVfXygxMjApOwogICAgdmFyIHByb21pc2VSZXNvbHZlID0gX193X3BkZmpzX3JlcXVpcmVfXygxMjUpOwogICAgdmFyIHJlZGVmaW5lID0gX193X3BkZmpzX3JlcXVpcmVfXygyOCk7CiAgICB2YXIgTk9OX0dFTkVSSUMgPSAhIU5hdGl2ZVByb21pc2UgJiYgZmFpbHMoZnVuY3Rpb24gKCkgewogICAgICBOYXRpdmVQcm9taXNlLnByb3RvdHlwZVsnZmluYWxseSddLmNhbGwoewogICAgICAgIHRoZW46IGZ1bmN0aW9uIHRoZW4oKSB7CiAgICAgICAgfQogICAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgIH0pOwogICAgfSk7CiAgICAkKHsKICAgICAgdGFyZ2V0OiAnUHJvbWlzZScsCiAgICAgIHByb3RvOiB0cnVlLAogICAgICByZWFsOiB0cnVlLAogICAgICBmb3JjZWQ6IE5PTl9HRU5FUklDCiAgICB9LCB7CiAgICAgICdmaW5hbGx5JzogZnVuY3Rpb24gX2ZpbmFsbHkob25GaW5hbGx5KSB7CiAgICAgICAgdmFyIEMgPSBzcGVjaWVzQ29uc3RydWN0b3IodGhpcywgZ2V0QnVpbHRJbignUHJvbWlzZScpKTsKICAgICAgICB2YXIgaXNGdW5jdGlvbiA9IHR5cGVvZiBvbkZpbmFsbHkgPT0gJ2Z1bmN0aW9uJzsKICAgICAgICByZXR1cm4gdGhpcy50aGVuKGlzRnVuY3Rpb24gPyBmdW5jdGlvbiAoeCkgewogICAgICAgICAgcmV0dXJuIHByb21pc2VSZXNvbHZlKEMsIG9uRmluYWxseSgpKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHg7CiAgICAgICAgICB9KTsKICAgICAgICB9IDogb25GaW5hbGx5LCBpc0Z1bmN0aW9uID8gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHJldHVybiBwcm9taXNlUmVzb2x2ZShDLCBvbkZpbmFsbHkoKSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgICB9KTsKICAgICAgICB9IDogb25GaW5hbGx5KTsKICAgICAgfQogICAgfSk7CiAgICBpZiAoIUlTX1BVUkUgJiYgdHlwZW9mIE5hdGl2ZVByb21pc2UgPT0gJ2Z1bmN0aW9uJyAmJiAhTmF0aXZlUHJvbWlzZS5wcm90b3R5cGVbJ2ZpbmFsbHknXSkgewogICAgICByZWRlZmluZShOYXRpdmVQcm9taXNlLnByb3RvdHlwZSwgJ2ZpbmFsbHknLCBnZXRCdWlsdEluKCdQcm9taXNlJykucHJvdG90eXBlWydmaW5hbGx5J10pOwogICAgfQoKICAgIC8qKiovfSksICgKICAvKiAxMzIgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDEzMyk7CiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDEzOCk7CiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDEzNik7CiAgICB2YXIgcGF0aCA9IF9fd19wZGZqc19yZXF1aXJlX18oNDIpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBwYXRoLlVSTDsKCiAgICAvKioqL30pLCAoCiAgLyogMTMzICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKICAgIF9fd19wZGZqc19yZXF1aXJlX18oNzcpOwogICAgdmFyICQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDkpOwogICAgdmFyIERFU0NSSVBUT1JTID0gX193X3BkZmpzX3JlcXVpcmVfXygxMik7CiAgICB2YXIgVVNFX05BVElWRV9VUkwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEzNCk7CiAgICB2YXIgZ2xvYmFsID0gX193X3BkZmpzX3JlcXVpcmVfXygxMCk7CiAgICB2YXIgZGVmaW5lUHJvcGVydGllcyA9IF9fd19wZGZqc19yZXF1aXJlX18oNzIpOwogICAgdmFyIHJlZGVmaW5lID0gX193X3BkZmpzX3JlcXVpcmVfXygyOCk7CiAgICB2YXIgYW5JbnN0YW5jZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTE4KTsKICAgIHZhciBoYXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIyKTsKICAgIHZhciBhc3NpZ24gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEwMCk7CiAgICB2YXIgYXJyYXlGcm9tID0gX193X3BkZmpzX3JlcXVpcmVfXyg5MCk7CiAgICB2YXIgY29kZUF0ID0gX193X3BkZmpzX3JlcXVpcmVfXyg3OCkuY29kZUF0OwogICAgdmFyIHRvQVNDSUkgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEzNSk7CiAgICB2YXIgc2V0VG9TdHJpbmdUYWcgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDg1KTsKICAgIHZhciBVUkxTZWFyY2hQYXJhbXNNb2R1bGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEzNik7CiAgICB2YXIgSW50ZXJuYWxTdGF0ZU1vZHVsZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMzIpOwogICAgdmFyIE5hdGl2ZVVSTCA9IGdsb2JhbC5VUkw7CiAgICB2YXIgVVJMU2VhcmNoUGFyYW1zID0gVVJMU2VhcmNoUGFyYW1zTW9kdWxlLlVSTFNlYXJjaFBhcmFtczsKICAgIHZhciBnZXRJbnRlcm5hbFNlYXJjaFBhcmFtc1N0YXRlID0gVVJMU2VhcmNoUGFyYW1zTW9kdWxlLmdldFN0YXRlOwogICAgdmFyIHNldEludGVybmFsU3RhdGUgPSBJbnRlcm5hbFN0YXRlTW9kdWxlLnNldDsKICAgIHZhciBnZXRJbnRlcm5hbFVSTFN0YXRlID0gSW50ZXJuYWxTdGF0ZU1vZHVsZS5nZXR0ZXJGb3IoJ1VSTCcpOwogICAgdmFyIGZsb29yID0gTWF0aC5mbG9vcjsKICAgIHZhciBwb3cgPSBNYXRoLnBvdzsKICAgIHZhciBJTlZBTElEX0FVVEhPUklUWSA9ICdJbnZhbGlkIGF1dGhvcml0eSc7CiAgICB2YXIgSU5WQUxJRF9TQ0hFTUUgPSAnSW52YWxpZCBzY2hlbWUnOwogICAgdmFyIElOVkFMSURfSE9TVCA9ICdJbnZhbGlkIGhvc3QnOwogICAgdmFyIElOVkFMSURfUE9SVCA9ICdJbnZhbGlkIHBvcnQnOwogICAgdmFyIEFMUEhBID0gL1tBLVphLXpdLzsKICAgIHZhciBBTFBIQU5VTUVSSUMgPSAvW1xkK1wtLkEtWmEtel0vOwogICAgdmFyIERJR0lUID0gL1xkLzsKICAgIHZhciBIRVhfU1RBUlQgPSAvXigweHwwWCkvOwogICAgdmFyIE9DVCA9IC9eWzAtN10rJC87CiAgICB2YXIgREVDID0gL15cZCskLzsKICAgIHZhciBIRVggPSAvXltcZEEtRmEtZl0rJC87CiAgICB2YXIgRk9SQklEREVOX0hPU1RfQ09ERV9QT0lOVCA9IC9bXHUwMDAwXHUwMDA5XHUwMDBBXHUwMDBEICMlLzo/QFtcXF1dLzsKICAgIHZhciBGT1JCSURERU5fSE9TVF9DT0RFX1BPSU5UX0VYQ0xVRElOR19QRVJDRU5UID0gL1tcdTAwMDBcdTAwMDlcdTAwMEFcdTAwMEQgIy86P0BbXFxdXS87CiAgICB2YXIgTEVBRElOR19BTkRfVFJBSUxJTkdfQzBfQ09OVFJPTF9PUl9TUEFDRSA9IC9eW1x1MDAwMC1cdTAwMUYgXSt8W1x1MDAwMC1cdTAwMUYgXSskL2c7CiAgICB2YXIgVEFCX0FORF9ORVdfTElORSA9IC9bXHUwMDA5XHUwMDBBXHUwMDBEXS9nOwogICAgdmFyIEVPRjsKICAgIHZhciBwYXJzZUhvc3QgPSBmdW5jdGlvbiBwYXJzZUhvc3QodXJsLCBpbnB1dCkgewogICAgICB2YXIgcmVzdWx0LCBjb2RlUG9pbnRzLCBpbmRleDsKICAgICAgaWYgKGlucHV0LmNoYXJBdCgwKSA9PSAnWycpIHsKICAgICAgICBpZiAoaW5wdXQuY2hhckF0KGlucHV0Lmxlbmd0aCAtIDEpICE9ICddJykKICAgICAgICByZXR1cm4gSU5WQUxJRF9IT1NUOwogICAgICAgIHJlc3VsdCA9IHBhcnNlSVB2NihpbnB1dC5zbGljZSgxLCAtMSkpOwogICAgICAgIGlmICghcmVzdWx0KQogICAgICAgIHJldHVybiBJTlZBTElEX0hPU1Q7CiAgICAgICAgdXJsLmhvc3QgPSByZXN1bHQ7CiAgICAgIH0gZWxzZSBpZiAoIWlzU3BlY2lhbCh1cmwpKSB7CiAgICAgICAgaWYgKEZPUkJJRERFTl9IT1NUX0NPREVfUE9JTlRfRVhDTFVESU5HX1BFUkNFTlQudGVzdChpbnB1dCkpCiAgICAgICAgcmV0dXJuIElOVkFMSURfSE9TVDsKICAgICAgICByZXN1bHQgPSAnJzsKICAgICAgICBjb2RlUG9pbnRzID0gYXJyYXlGcm9tKGlucHV0KTsKICAgICAgICBmb3IgKGluZGV4ID0gMDsgaW5kZXggPCBjb2RlUG9pbnRzLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgcmVzdWx0ICs9IHBlcmNlbnRFbmNvZGUoY29kZVBvaW50c1tpbmRleF0sIEMwQ29udHJvbFBlcmNlbnRFbmNvZGVTZXQpOwogICAgICAgIH0KICAgICAgICB1cmwuaG9zdCA9IHJlc3VsdDsKICAgICAgfSBlbHNlIHsKICAgICAgICBpbnB1dCA9IHRvQVNDSUkoaW5wdXQpOwogICAgICAgIGlmIChGT1JCSURERU5fSE9TVF9DT0RFX1BPSU5ULnRlc3QoaW5wdXQpKQogICAgICAgIHJldHVybiBJTlZBTElEX0hPU1Q7CiAgICAgICAgcmVzdWx0ID0gcGFyc2VJUHY0KGlucHV0KTsKICAgICAgICBpZiAocmVzdWx0ID09PSBudWxsKQogICAgICAgIHJldHVybiBJTlZBTElEX0hPU1Q7CiAgICAgICAgdXJsLmhvc3QgPSByZXN1bHQ7CiAgICAgIH0KICAgIH07CiAgICB2YXIgcGFyc2VJUHY0ID0gZnVuY3Rpb24gcGFyc2VJUHY0KGlucHV0KSB7CiAgICAgIHZhciBwYXJ0cyA9IGlucHV0LnNwbGl0KCcuJyk7CiAgICAgIHZhciBwYXJ0c0xlbmd0aCwgbnVtYmVycywgaW5kZXgsIHBhcnQsIHJhZGl4LCBudW1iZXIsIGlwdjQ7CiAgICAgIGlmIChwYXJ0cy5sZW5ndGggJiYgcGFydHNbcGFydHMubGVuZ3RoIC0gMV0gPT0gJycpIHsKICAgICAgICBwYXJ0cy5wb3AoKTsKICAgICAgfQogICAgICBwYXJ0c0xlbmd0aCA9IHBhcnRzLmxlbmd0aDsKICAgICAgaWYgKHBhcnRzTGVuZ3RoID4gNCkKICAgICAgcmV0dXJuIGlucHV0OwogICAgICBudW1iZXJzID0gW107CiAgICAgIGZvciAoaW5kZXggPSAwOyBpbmRleCA8IHBhcnRzTGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgcGFydCA9IHBhcnRzW2luZGV4XTsKICAgICAgICBpZiAocGFydCA9PSAnJykKICAgICAgICByZXR1cm4gaW5wdXQ7CiAgICAgICAgcmFkaXggPSAxMDsKICAgICAgICBpZiAocGFydC5sZW5ndGggPiAxICYmIHBhcnQuY2hhckF0KDApID09ICcwJykgewogICAgICAgICAgcmFkaXggPSBIRVhfU1RBUlQudGVzdChwYXJ0KSA/IDE2IDogODsKICAgICAgICAgIHBhcnQgPSBwYXJ0LnNsaWNlKHJhZGl4ID09IDggPyAxIDogMik7CiAgICAgICAgfQogICAgICAgIGlmIChwYXJ0ID09PSAnJykgewogICAgICAgICAgbnVtYmVyID0gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKCEocmFkaXggPT0gMTAgPyBERUMgOiByYWRpeCA9PSA4ID8gT0NUIDogSEVYKS50ZXN0KHBhcnQpKQogICAgICAgICAgcmV0dXJuIGlucHV0OwogICAgICAgICAgbnVtYmVyID0gcGFyc2VJbnQocGFydCwgcmFkaXgpOwogICAgICAgIH0KICAgICAgICBudW1iZXJzLnB1c2gobnVtYmVyKTsKICAgICAgfQogICAgICBmb3IgKGluZGV4ID0gMDsgaW5kZXggPCBwYXJ0c0xlbmd0aDsgaW5kZXgrKykgewogICAgICAgIG51bWJlciA9IG51bWJlcnNbaW5kZXhdOwogICAgICAgIGlmIChpbmRleCA9PSBwYXJ0c0xlbmd0aCAtIDEpIHsKICAgICAgICAgIGlmIChudW1iZXIgPj0gcG93KDI1NiwgNSAtIHBhcnRzTGVuZ3RoKSkKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0gZWxzZSBpZiAobnVtYmVyID4gMjU1KQogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGlwdjQgPSBudW1iZXJzLnBvcCgpOwogICAgICBmb3IgKGluZGV4ID0gMDsgaW5kZXggPCBudW1iZXJzLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgIGlwdjQgKz0gbnVtYmVyc1tpbmRleF0gKiBwb3coMjU2LCAzIC0gaW5kZXgpOwogICAgICB9CiAgICAgIHJldHVybiBpcHY0OwogICAgfTsKICAgIHZhciBwYXJzZUlQdjYgPSBmdW5jdGlvbiBwYXJzZUlQdjYoaW5wdXQpIHsKICAgICAgdmFyIGFkZHJlc3MgPSBbCiAgICAgIDAsCiAgICAgIDAsCiAgICAgIDAsCiAgICAgIDAsCiAgICAgIDAsCiAgICAgIDAsCiAgICAgIDAsCiAgICAgIDBdOwoKICAgICAgdmFyIHBpZWNlSW5kZXggPSAwOwogICAgICB2YXIgY29tcHJlc3MgPSBudWxsOwogICAgICB2YXIgcG9pbnRlciA9IDA7CiAgICAgIHZhciB2YWx1ZSwgbGVuZ3RoLCBudW1iZXJzU2VlbiwgaXB2NFBpZWNlLCBudW1iZXIsIHN3YXBzLCBzd2FwOwogICAgICB2YXIgY2hhciA9IGZ1bmN0aW9uIGNoYXIoKSB7CiAgICAgICAgcmV0dXJuIGlucHV0LmNoYXJBdChwb2ludGVyKTsKICAgICAgfTsKICAgICAgaWYgKGNoYXIoKSA9PSAnOicpIHsKICAgICAgICBpZiAoaW5wdXQuY2hhckF0KDEpICE9ICc6JykKICAgICAgICByZXR1cm47CiAgICAgICAgcG9pbnRlciArPSAyOwogICAgICAgIHBpZWNlSW5kZXgrKzsKICAgICAgICBjb21wcmVzcyA9IHBpZWNlSW5kZXg7CiAgICAgIH0KICAgICAgd2hpbGUgKGNoYXIoKSkgewogICAgICAgIGlmIChwaWVjZUluZGV4ID09IDgpCiAgICAgICAgcmV0dXJuOwogICAgICAgIGlmIChjaGFyKCkgPT0gJzonKSB7CiAgICAgICAgICBpZiAoY29tcHJlc3MgIT09IG51bGwpCiAgICAgICAgICByZXR1cm47CiAgICAgICAgICBwb2ludGVyKys7CiAgICAgICAgICBwaWVjZUluZGV4Kys7CiAgICAgICAgICBjb21wcmVzcyA9IHBpZWNlSW5kZXg7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgdmFsdWUgPSBsZW5ndGggPSAwOwogICAgICAgIHdoaWxlIChsZW5ndGggPCA0ICYmIEhFWC50ZXN0KGNoYXIoKSkpIHsKICAgICAgICAgIHZhbHVlID0gdmFsdWUgKiAxNiArIHBhcnNlSW50KGNoYXIoKSwgMTYpOwogICAgICAgICAgcG9pbnRlcisrOwogICAgICAgICAgbGVuZ3RoKys7CiAgICAgICAgfQogICAgICAgIGlmIChjaGFyKCkgPT0gJy4nKSB7CiAgICAgICAgICBpZiAobGVuZ3RoID09IDApCiAgICAgICAgICByZXR1cm47CiAgICAgICAgICBwb2ludGVyIC09IGxlbmd0aDsKICAgICAgICAgIGlmIChwaWVjZUluZGV4ID4gNikKICAgICAgICAgIHJldHVybjsKICAgICAgICAgIG51bWJlcnNTZWVuID0gMDsKICAgICAgICAgIHdoaWxlIChjaGFyKCkpIHsKICAgICAgICAgICAgaXB2NFBpZWNlID0gbnVsbDsKICAgICAgICAgICAgaWYgKG51bWJlcnNTZWVuID4gMCkgewogICAgICAgICAgICAgIGlmIChjaGFyKCkgPT0gJy4nICYmIG51bWJlcnNTZWVuIDwgNCkKICAgICAgICAgICAgICBwb2ludGVyKys7ZWxzZQoKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFESUdJVC50ZXN0KGNoYXIoKSkpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgd2hpbGUgKERJR0lULnRlc3QoY2hhcigpKSkgewogICAgICAgICAgICAgIG51bWJlciA9IHBhcnNlSW50KGNoYXIoKSwgMTApOwogICAgICAgICAgICAgIGlmIChpcHY0UGllY2UgPT09IG51bGwpCiAgICAgICAgICAgICAgaXB2NFBpZWNlID0gbnVtYmVyO2Vsc2UKICAgICAgICAgICAgICBpZiAoaXB2NFBpZWNlID09IDApCiAgICAgICAgICAgICAgcmV0dXJuO2Vsc2UKCiAgICAgICAgICAgICAgaXB2NFBpZWNlID0gaXB2NFBpZWNlICogMTAgKyBudW1iZXI7CiAgICAgICAgICAgICAgaWYgKGlwdjRQaWVjZSA+IDI1NSkKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgcG9pbnRlcisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFkZHJlc3NbcGllY2VJbmRleF0gPSBhZGRyZXNzW3BpZWNlSW5kZXhdICogMjU2ICsgaXB2NFBpZWNlOwogICAgICAgICAgICBudW1iZXJzU2VlbisrOwogICAgICAgICAgICBpZiAobnVtYmVyc1NlZW4gPT0gMiB8fCBudW1iZXJzU2VlbiA9PSA0KQogICAgICAgICAgICBwaWVjZUluZGV4Kys7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobnVtYmVyc1NlZW4gIT0gNCkKICAgICAgICAgIHJldHVybjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0gZWxzZSBpZiAoY2hhcigpID09ICc6JykgewogICAgICAgICAgcG9pbnRlcisrOwogICAgICAgICAgaWYgKCFjaGFyKCkpCiAgICAgICAgICByZXR1cm47CiAgICAgICAgfSBlbHNlIGlmIChjaGFyKCkpCiAgICAgICAgcmV0dXJuOwogICAgICAgIGFkZHJlc3NbcGllY2VJbmRleCsrXSA9IHZhbHVlOwogICAgICB9CiAgICAgIGlmIChjb21wcmVzcyAhPT0gbnVsbCkgewogICAgICAgIHN3YXBzID0gcGllY2VJbmRleCAtIGNvbXByZXNzOwogICAgICAgIHBpZWNlSW5kZXggPSA3OwogICAgICAgIHdoaWxlIChwaWVjZUluZGV4ICE9IDAgJiYgc3dhcHMgPiAwKSB7CiAgICAgICAgICBzd2FwID0gYWRkcmVzc1twaWVjZUluZGV4XTsKICAgICAgICAgIGFkZHJlc3NbcGllY2VJbmRleC0tXSA9IGFkZHJlc3NbY29tcHJlc3MgKyBzd2FwcyAtIDFdOwogICAgICAgICAgYWRkcmVzc1tjb21wcmVzcyArIC0tc3dhcHNdID0gc3dhcDsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAocGllY2VJbmRleCAhPSA4KQogICAgICByZXR1cm47CiAgICAgIHJldHVybiBhZGRyZXNzOwogICAgfTsKICAgIHZhciBmaW5kTG9uZ2VzdFplcm9TZXF1ZW5jZSA9IGZ1bmN0aW9uIGZpbmRMb25nZXN0WmVyb1NlcXVlbmNlKGlwdjYpIHsKICAgICAgdmFyIG1heEluZGV4ID0gbnVsbDsKICAgICAgdmFyIG1heExlbmd0aCA9IDE7CiAgICAgIHZhciBjdXJyU3RhcnQgPSBudWxsOwogICAgICB2YXIgY3Vyckxlbmd0aCA9IDA7CiAgICAgIHZhciBpbmRleCA9IDA7CiAgICAgIGZvciAoOyBpbmRleCA8IDg7IGluZGV4KyspIHsKICAgICAgICBpZiAoaXB2NltpbmRleF0gIT09IDApIHsKICAgICAgICAgIGlmIChjdXJyTGVuZ3RoID4gbWF4TGVuZ3RoKSB7CiAgICAgICAgICAgIG1heEluZGV4ID0gY3VyclN0YXJ0OwogICAgICAgICAgICBtYXhMZW5ndGggPSBjdXJyTGVuZ3RoOwogICAgICAgICAgfQogICAgICAgICAgY3VyclN0YXJ0ID0gbnVsbDsKICAgICAgICAgIGN1cnJMZW5ndGggPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoY3VyclN0YXJ0ID09PSBudWxsKQogICAgICAgICAgY3VyclN0YXJ0ID0gaW5kZXg7CiAgICAgICAgICArK2N1cnJMZW5ndGg7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChjdXJyTGVuZ3RoID4gbWF4TGVuZ3RoKSB7CiAgICAgICAgbWF4SW5kZXggPSBjdXJyU3RhcnQ7CiAgICAgICAgbWF4TGVuZ3RoID0gY3Vyckxlbmd0aDsKICAgICAgfQogICAgICByZXR1cm4gbWF4SW5kZXg7CiAgICB9OwogICAgdmFyIHNlcmlhbGl6ZUhvc3QgPSBmdW5jdGlvbiBzZXJpYWxpemVIb3N0KGhvc3QpIHsKICAgICAgdmFyIHJlc3VsdCwgaW5kZXgsIGNvbXByZXNzLCBpZ25vcmUwOwogICAgICBpZiAodHlwZW9mIGhvc3QgPT0gJ251bWJlcicpIHsKICAgICAgICByZXN1bHQgPSBbXTsKICAgICAgICBmb3IgKGluZGV4ID0gMDsgaW5kZXggPCA0OyBpbmRleCsrKSB7CiAgICAgICAgICByZXN1bHQudW5zaGlmdChob3N0ICUgMjU2KTsKICAgICAgICAgIGhvc3QgPSBmbG9vcihob3N0IC8gMjU2KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdC5qb2luKCcuJyk7CiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGhvc3QgPT0gJ29iamVjdCcpIHsKICAgICAgICByZXN1bHQgPSAnJzsKICAgICAgICBjb21wcmVzcyA9IGZpbmRMb25nZXN0WmVyb1NlcXVlbmNlKGhvc3QpOwogICAgICAgIGZvciAoaW5kZXggPSAwOyBpbmRleCA8IDg7IGluZGV4KyspIHsKICAgICAgICAgIGlmIChpZ25vcmUwICYmIGhvc3RbaW5kZXhdID09PSAwKQogICAgICAgICAgY29udGludWU7CiAgICAgICAgICBpZiAoaWdub3JlMCkKICAgICAgICAgIGlnbm9yZTAgPSBmYWxzZTsKICAgICAgICAgIGlmIChjb21wcmVzcyA9PT0gaW5kZXgpIHsKICAgICAgICAgICAgcmVzdWx0ICs9IGluZGV4ID8gJzonIDogJzo6JzsKICAgICAgICAgICAgaWdub3JlMCA9IHRydWU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXN1bHQgKz0gaG9zdFtpbmRleF0udG9TdHJpbmcoMTYpOwogICAgICAgICAgICBpZiAoaW5kZXggPCA3KQogICAgICAgICAgICByZXN1bHQgKz0gJzonOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gJ1snICsgcmVzdWx0ICsgJ10nOwogICAgICB9CiAgICAgIHJldHVybiBob3N0OwogICAgfTsKICAgIHZhciBDMENvbnRyb2xQZXJjZW50RW5jb2RlU2V0ID0ge307CiAgICB2YXIgZnJhZ21lbnRQZXJjZW50RW5jb2RlU2V0ID0gYXNzaWduKHt9LCBDMENvbnRyb2xQZXJjZW50RW5jb2RlU2V0LCB7CiAgICAgICcgJzogMSwKICAgICAgJyInOiAxLAogICAgICAnPCc6IDEsCiAgICAgICc+JzogMSwKICAgICAgJ2AnOiAxCiAgICB9KTsKICAgIHZhciBwYXRoUGVyY2VudEVuY29kZVNldCA9IGFzc2lnbih7fSwgZnJhZ21lbnRQZXJjZW50RW5jb2RlU2V0LCB7CiAgICAgICcjJzogMSwKICAgICAgJz8nOiAxLAogICAgICAneyc6IDEsCiAgICAgICd9JzogMQogICAgfSk7CiAgICB2YXIgdXNlcmluZm9QZXJjZW50RW5jb2RlU2V0ID0gYXNzaWduKHt9LCBwYXRoUGVyY2VudEVuY29kZVNldCwgewogICAgICAnLyc6IDEsCiAgICAgICc6JzogMSwKICAgICAgJzsnOiAxLAogICAgICAnPSc6IDEsCiAgICAgICdAJzogMSwKICAgICAgJ1snOiAxLAogICAgICAnXFwnOiAxLAogICAgICAnXSc6IDEsCiAgICAgICdeJzogMSwKICAgICAgJ3wnOiAxCiAgICB9KTsKICAgIHZhciBwZXJjZW50RW5jb2RlID0gZnVuY3Rpb24gcGVyY2VudEVuY29kZShjaGFyLCBzZXQpIHsKICAgICAgdmFyIGNvZGUgPSBjb2RlQXQoY2hhciwgMCk7CiAgICAgIHJldHVybiBjb2RlID4gMHgyMCAmJiBjb2RlIDwgMHg3RiAmJiAhaGFzKHNldCwgY2hhcikgPyBjaGFyIDogZW5jb2RlVVJJQ29tcG9uZW50KGNoYXIpOwogICAgfTsKICAgIHZhciBzcGVjaWFsU2NoZW1lcyA9IHsKICAgICAgZnRwOiAyMSwKICAgICAgZmlsZTogbnVsbCwKICAgICAgaHR0cDogODAsCiAgICAgIGh0dHBzOiA0NDMsCiAgICAgIHdzOiA4MCwKICAgICAgd3NzOiA0NDMKICAgIH07CiAgICB2YXIgaXNTcGVjaWFsID0gZnVuY3Rpb24gaXNTcGVjaWFsKHVybCkgewogICAgICByZXR1cm4gaGFzKHNwZWNpYWxTY2hlbWVzLCB1cmwuc2NoZW1lKTsKICAgIH07CiAgICB2YXIgaW5jbHVkZXNDcmVkZW50aWFscyA9IGZ1bmN0aW9uIGluY2x1ZGVzQ3JlZGVudGlhbHModXJsKSB7CiAgICAgIHJldHVybiB1cmwudXNlcm5hbWUgIT0gJycgfHwgdXJsLnBhc3N3b3JkICE9ICcnOwogICAgfTsKICAgIHZhciBjYW5ub3RIYXZlVXNlcm5hbWVQYXNzd29yZFBvcnQgPSBmdW5jdGlvbiBjYW5ub3RIYXZlVXNlcm5hbWVQYXNzd29yZFBvcnQodXJsKSB7CiAgICAgIHJldHVybiAhdXJsLmhvc3QgfHwgdXJsLmNhbm5vdEJlQUJhc2VVUkwgfHwgdXJsLnNjaGVtZSA9PSAnZmlsZSc7CiAgICB9OwogICAgdmFyIGlzV2luZG93c0RyaXZlTGV0dGVyID0gZnVuY3Rpb24gaXNXaW5kb3dzRHJpdmVMZXR0ZXIoc3RyaW5nLCBub3JtYWxpemVkKSB7CiAgICAgIHZhciBzZWNvbmQ7CiAgICAgIHJldHVybiBzdHJpbmcubGVuZ3RoID09IDIgJiYgQUxQSEEudGVzdChzdHJpbmcuY2hhckF0KDApKSAmJiAoKHNlY29uZCA9IHN0cmluZy5jaGFyQXQoMSkpID09ICc6JyB8fCAhbm9ybWFsaXplZCAmJiBzZWNvbmQgPT0gJ3wnKTsKICAgIH07CiAgICB2YXIgc3RhcnRzV2l0aFdpbmRvd3NEcml2ZUxldHRlciA9IGZ1bmN0aW9uIHN0YXJ0c1dpdGhXaW5kb3dzRHJpdmVMZXR0ZXIoc3RyaW5nKSB7CiAgICAgIHZhciB0aGlyZDsKICAgICAgcmV0dXJuIHN0cmluZy5sZW5ndGggPiAxICYmIGlzV2luZG93c0RyaXZlTGV0dGVyKHN0cmluZy5zbGljZSgwLCAyKSkgJiYgKHN0cmluZy5sZW5ndGggPT0gMiB8fCAodGhpcmQgPSBzdHJpbmcuY2hhckF0KDIpKSA9PT0gJy8nIHx8IHRoaXJkID09PSAnXFwnIHx8IHRoaXJkID09PSAnPycgfHwgdGhpcmQgPT09ICcjJyk7CiAgICB9OwogICAgdmFyIHNob3J0ZW5VUkxzUGF0aCA9IGZ1bmN0aW9uIHNob3J0ZW5VUkxzUGF0aCh1cmwpIHsKICAgICAgdmFyIHBhdGggPSB1cmwucGF0aDsKICAgICAgdmFyIHBhdGhTaXplID0gcGF0aC5sZW5ndGg7CiAgICAgIGlmIChwYXRoU2l6ZSAmJiAodXJsLnNjaGVtZSAhPSAnZmlsZScgfHwgcGF0aFNpemUgIT0gMSB8fCAhaXNXaW5kb3dzRHJpdmVMZXR0ZXIocGF0aFswXSwgdHJ1ZSkpKSB7CiAgICAgICAgcGF0aC5wb3AoKTsKICAgICAgfQogICAgfTsKICAgIHZhciBpc1NpbmdsZURvdCA9IGZ1bmN0aW9uIGlzU2luZ2xlRG90KHNlZ21lbnQpIHsKICAgICAgcmV0dXJuIHNlZ21lbnQgPT09ICcuJyB8fCBzZWdtZW50LnRvTG93ZXJDYXNlKCkgPT09ICclMmUnOwogICAgfTsKICAgIHZhciBpc0RvdWJsZURvdCA9IGZ1bmN0aW9uIGlzRG91YmxlRG90KHNlZ21lbnQpIHsKICAgICAgc2VnbWVudCA9IHNlZ21lbnQudG9Mb3dlckNhc2UoKTsKICAgICAgcmV0dXJuIHNlZ21lbnQgPT09ICcuLicgfHwgc2VnbWVudCA9PT0gJyUyZS4nIHx8IHNlZ21lbnQgPT09ICcuJTJlJyB8fCBzZWdtZW50ID09PSAnJTJlJTJlJzsKICAgIH07CiAgICB2YXIgU0NIRU1FX1NUQVJUID0ge307CiAgICB2YXIgU0NIRU1FID0ge307CiAgICB2YXIgTk9fU0NIRU1FID0ge307CiAgICB2YXIgU1BFQ0lBTF9SRUxBVElWRV9PUl9BVVRIT1JJVFkgPSB7fTsKICAgIHZhciBQQVRIX09SX0FVVEhPUklUWSA9IHt9OwogICAgdmFyIFJFTEFUSVZFID0ge307CiAgICB2YXIgUkVMQVRJVkVfU0xBU0ggPSB7fTsKICAgIHZhciBTUEVDSUFMX0FVVEhPUklUWV9TTEFTSEVTID0ge307CiAgICB2YXIgU1BFQ0lBTF9BVVRIT1JJVFlfSUdOT1JFX1NMQVNIRVMgPSB7fTsKICAgIHZhciBBVVRIT1JJVFkgPSB7fTsKICAgIHZhciBIT1NUID0ge307CiAgICB2YXIgSE9TVE5BTUUgPSB7fTsKICAgIHZhciBQT1JUID0ge307CiAgICB2YXIgRklMRSA9IHt9OwogICAgdmFyIEZJTEVfU0xBU0ggPSB7fTsKICAgIHZhciBGSUxFX0hPU1QgPSB7fTsKICAgIHZhciBQQVRIX1NUQVJUID0ge307CiAgICB2YXIgUEFUSCA9IHt9OwogICAgdmFyIENBTk5PVF9CRV9BX0JBU0VfVVJMX1BBVEggPSB7fTsKICAgIHZhciBRVUVSWSA9IHt9OwogICAgdmFyIEZSQUdNRU5UID0ge307CiAgICB2YXIgcGFyc2VVUkwgPSBmdW5jdGlvbiBwYXJzZVVSTCh1cmwsIGlucHV0LCBzdGF0ZU92ZXJyaWRlLCBiYXNlKSB7CiAgICAgIHZhciBzdGF0ZSA9IHN0YXRlT3ZlcnJpZGUgfHwgU0NIRU1FX1NUQVJUOwogICAgICB2YXIgcG9pbnRlciA9IDA7CiAgICAgIHZhciBidWZmZXIgPSAnJzsKICAgICAgdmFyIHNlZW5BdCA9IGZhbHNlOwogICAgICB2YXIgc2VlbkJyYWNrZXQgPSBmYWxzZTsKICAgICAgdmFyIHNlZW5QYXNzd29yZFRva2VuID0gZmFsc2U7CiAgICAgIHZhciBjb2RlUG9pbnRzLCBjaGFyLCBidWZmZXJDb2RlUG9pbnRzLCBmYWlsdXJlOwogICAgICBpZiAoIXN0YXRlT3ZlcnJpZGUpIHsKICAgICAgICB1cmwuc2NoZW1lID0gJyc7CiAgICAgICAgdXJsLnVzZXJuYW1lID0gJyc7CiAgICAgICAgdXJsLnBhc3N3b3JkID0gJyc7CiAgICAgICAgdXJsLmhvc3QgPSBudWxsOwogICAgICAgIHVybC5wb3J0ID0gbnVsbDsKICAgICAgICB1cmwucGF0aCA9IFtdOwogICAgICAgIHVybC5xdWVyeSA9IG51bGw7CiAgICAgICAgdXJsLmZyYWdtZW50ID0gbnVsbDsKICAgICAgICB1cmwuY2Fubm90QmVBQmFzZVVSTCA9IGZhbHNlOwogICAgICAgIGlucHV0ID0gaW5wdXQucmVwbGFjZShMRUFESU5HX0FORF9UUkFJTElOR19DMF9DT05UUk9MX09SX1NQQUNFLCAnJyk7CiAgICAgIH0KICAgICAgaW5wdXQgPSBpbnB1dC5yZXBsYWNlKFRBQl9BTkRfTkVXX0xJTkUsICcnKTsKICAgICAgY29kZVBvaW50cyA9IGFycmF5RnJvbShpbnB1dCk7CiAgICAgIHdoaWxlIChwb2ludGVyIDw9IGNvZGVQb2ludHMubGVuZ3RoKSB7CiAgICAgICAgY2hhciA9IGNvZGVQb2ludHNbcG9pbnRlcl07CiAgICAgICAgc3dpdGNoIChzdGF0ZSkgewogICAgICAgICAgY2FzZSBTQ0hFTUVfU1RBUlQ6CiAgICAgICAgICAgIGlmIChjaGFyICYmIEFMUEhBLnRlc3QoY2hhcikpIHsKICAgICAgICAgICAgICBidWZmZXIgKz0gY2hhci50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgIHN0YXRlID0gU0NIRU1FOwogICAgICAgICAgICB9IGVsc2UgaWYgKCFzdGF0ZU92ZXJyaWRlKSB7CiAgICAgICAgICAgICAgc3RhdGUgPSBOT19TQ0hFTUU7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICByZXR1cm4gSU5WQUxJRF9TQ0hFTUU7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBTQ0hFTUU6CiAgICAgICAgICAgIGlmIChjaGFyICYmIChBTFBIQU5VTUVSSUMudGVzdChjaGFyKSB8fCBjaGFyID09ICcrJyB8fCBjaGFyID09ICctJyB8fCBjaGFyID09ICcuJykpIHsKICAgICAgICAgICAgICBidWZmZXIgKz0gY2hhci50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGNoYXIgPT0gJzonKSB7CiAgICAgICAgICAgICAgaWYgKHN0YXRlT3ZlcnJpZGUgJiYgKGlzU3BlY2lhbCh1cmwpICE9IGhhcyhzcGVjaWFsU2NoZW1lcywgYnVmZmVyKSB8fCBidWZmZXIgPT0gJ2ZpbGUnICYmIChpbmNsdWRlc0NyZWRlbnRpYWxzKHVybCkgfHwgdXJsLnBvcnQgIT09IG51bGwpIHx8IHVybC5zY2hlbWUgPT0gJ2ZpbGUnICYmICF1cmwuaG9zdCkpCiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIHVybC5zY2hlbWUgPSBidWZmZXI7CiAgICAgICAgICAgICAgaWYgKHN0YXRlT3ZlcnJpZGUpIHsKICAgICAgICAgICAgICAgIGlmIChpc1NwZWNpYWwodXJsKSAmJiBzcGVjaWFsU2NoZW1lc1t1cmwuc2NoZW1lXSA9PSB1cmwucG9ydCkKICAgICAgICAgICAgICAgIHVybC5wb3J0ID0gbnVsbDsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnVmZmVyID0gJyc7CiAgICAgICAgICAgICAgaWYgKHVybC5zY2hlbWUgPT0gJ2ZpbGUnKSB7CiAgICAgICAgICAgICAgICBzdGF0ZSA9IEZJTEU7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc1NwZWNpYWwodXJsKSAmJiBiYXNlICYmIGJhc2Uuc2NoZW1lID09IHVybC5zY2hlbWUpIHsKICAgICAgICAgICAgICAgIHN0YXRlID0gU1BFQ0lBTF9SRUxBVElWRV9PUl9BVVRIT1JJVFk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc1NwZWNpYWwodXJsKSkgewogICAgICAgICAgICAgICAgc3RhdGUgPSBTUEVDSUFMX0FVVEhPUklUWV9TTEFTSEVTOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoY29kZVBvaW50c1twb2ludGVyICsgMV0gPT0gJy8nKSB7CiAgICAgICAgICAgICAgICBzdGF0ZSA9IFBBVEhfT1JfQVVUSE9SSVRZOwogICAgICAgICAgICAgICAgcG9pbnRlcisrOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB1cmwuY2Fubm90QmVBQmFzZVVSTCA9IHRydWU7CiAgICAgICAgICAgICAgICB1cmwucGF0aC5wdXNoKCcnKTsKICAgICAgICAgICAgICAgIHN0YXRlID0gQ0FOTk9UX0JFX0FfQkFTRV9VUkxfUEFUSDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoIXN0YXRlT3ZlcnJpZGUpIHsKICAgICAgICAgICAgICBidWZmZXIgPSAnJzsKICAgICAgICAgICAgICBzdGF0ZSA9IE5PX1NDSEVNRTsKICAgICAgICAgICAgICBwb2ludGVyID0gMDsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIHJldHVybiBJTlZBTElEX1NDSEVNRTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE5PX1NDSEVNRToKICAgICAgICAgICAgaWYgKCFiYXNlIHx8IGJhc2UuY2Fubm90QmVBQmFzZVVSTCAmJiBjaGFyICE9ICcjJykKICAgICAgICAgICAgcmV0dXJuIElOVkFMSURfU0NIRU1FOwogICAgICAgICAgICBpZiAoYmFzZS5jYW5ub3RCZUFCYXNlVVJMICYmIGNoYXIgPT0gJyMnKSB7CiAgICAgICAgICAgICAgdXJsLnNjaGVtZSA9IGJhc2Uuc2NoZW1lOwogICAgICAgICAgICAgIHVybC5wYXRoID0gYmFzZS5wYXRoLnNsaWNlKCk7CiAgICAgICAgICAgICAgdXJsLnF1ZXJ5ID0gYmFzZS5xdWVyeTsKICAgICAgICAgICAgICB1cmwuZnJhZ21lbnQgPSAnJzsKICAgICAgICAgICAgICB1cmwuY2Fubm90QmVBQmFzZVVSTCA9IHRydWU7CiAgICAgICAgICAgICAgc3RhdGUgPSBGUkFHTUVOVDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdGF0ZSA9IGJhc2Uuc2NoZW1lID09ICdmaWxlJyA/IEZJTEUgOiBSRUxBVElWRTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICBjYXNlIFNQRUNJQUxfUkVMQVRJVkVfT1JfQVVUSE9SSVRZOgogICAgICAgICAgICBpZiAoY2hhciA9PSAnLycgJiYgY29kZVBvaW50c1twb2ludGVyICsgMV0gPT0gJy8nKSB7CiAgICAgICAgICAgICAgc3RhdGUgPSBTUEVDSUFMX0FVVEhPUklUWV9JR05PUkVfU0xBU0hFUzsKICAgICAgICAgICAgICBwb2ludGVyKys7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgc3RhdGUgPSBSRUxBVElWRTsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgUEFUSF9PUl9BVVRIT1JJVFk6CiAgICAgICAgICAgIGlmIChjaGFyID09ICcvJykgewogICAgICAgICAgICAgIHN0YXRlID0gQVVUSE9SSVRZOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHN0YXRlID0gUEFUSDsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgY2FzZSBSRUxBVElWRToKICAgICAgICAgICAgdXJsLnNjaGVtZSA9IGJhc2Uuc2NoZW1lOwogICAgICAgICAgICBpZiAoY2hhciA9PSBFT0YpIHsKICAgICAgICAgICAgICB1cmwudXNlcm5hbWUgPSBiYXNlLnVzZXJuYW1lOwogICAgICAgICAgICAgIHVybC5wYXNzd29yZCA9IGJhc2UucGFzc3dvcmQ7CiAgICAgICAgICAgICAgdXJsLmhvc3QgPSBiYXNlLmhvc3Q7CiAgICAgICAgICAgICAgdXJsLnBvcnQgPSBiYXNlLnBvcnQ7CiAgICAgICAgICAgICAgdXJsLnBhdGggPSBiYXNlLnBhdGguc2xpY2UoKTsKICAgICAgICAgICAgICB1cmwucXVlcnkgPSBiYXNlLnF1ZXJ5OwogICAgICAgICAgICB9IGVsc2UgaWYgKGNoYXIgPT0gJy8nIHx8IGNoYXIgPT0gJ1xcJyAmJiBpc1NwZWNpYWwodXJsKSkgewogICAgICAgICAgICAgIHN0YXRlID0gUkVMQVRJVkVfU0xBU0g7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoY2hhciA9PSAnPycpIHsKICAgICAgICAgICAgICB1cmwudXNlcm5hbWUgPSBiYXNlLnVzZXJuYW1lOwogICAgICAgICAgICAgIHVybC5wYXNzd29yZCA9IGJhc2UucGFzc3dvcmQ7CiAgICAgICAgICAgICAgdXJsLmhvc3QgPSBiYXNlLmhvc3Q7CiAgICAgICAgICAgICAgdXJsLnBvcnQgPSBiYXNlLnBvcnQ7CiAgICAgICAgICAgICAgdXJsLnBhdGggPSBiYXNlLnBhdGguc2xpY2UoKTsKICAgICAgICAgICAgICB1cmwucXVlcnkgPSAnJzsKICAgICAgICAgICAgICBzdGF0ZSA9IFFVRVJZOwogICAgICAgICAgICB9IGVsc2UgaWYgKGNoYXIgPT0gJyMnKSB7CiAgICAgICAgICAgICAgdXJsLnVzZXJuYW1lID0gYmFzZS51c2VybmFtZTsKICAgICAgICAgICAgICB1cmwucGFzc3dvcmQgPSBiYXNlLnBhc3N3b3JkOwogICAgICAgICAgICAgIHVybC5ob3N0ID0gYmFzZS5ob3N0OwogICAgICAgICAgICAgIHVybC5wb3J0ID0gYmFzZS5wb3J0OwogICAgICAgICAgICAgIHVybC5wYXRoID0gYmFzZS5wYXRoLnNsaWNlKCk7CiAgICAgICAgICAgICAgdXJsLnF1ZXJ5ID0gYmFzZS5xdWVyeTsKICAgICAgICAgICAgICB1cmwuZnJhZ21lbnQgPSAnJzsKICAgICAgICAgICAgICBzdGF0ZSA9IEZSQUdNRU5UOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHVybC51c2VybmFtZSA9IGJhc2UudXNlcm5hbWU7CiAgICAgICAgICAgICAgdXJsLnBhc3N3b3JkID0gYmFzZS5wYXNzd29yZDsKICAgICAgICAgICAgICB1cmwuaG9zdCA9IGJhc2UuaG9zdDsKICAgICAgICAgICAgICB1cmwucG9ydCA9IGJhc2UucG9ydDsKICAgICAgICAgICAgICB1cmwucGF0aCA9IGJhc2UucGF0aC5zbGljZSgpOwogICAgICAgICAgICAgIHVybC5wYXRoLnBvcCgpOwogICAgICAgICAgICAgIHN0YXRlID0gUEFUSDsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgUkVMQVRJVkVfU0xBU0g6CiAgICAgICAgICAgIGlmIChpc1NwZWNpYWwodXJsKSAmJiAoY2hhciA9PSAnLycgfHwgY2hhciA9PSAnXFwnKSkgewogICAgICAgICAgICAgIHN0YXRlID0gU1BFQ0lBTF9BVVRIT1JJVFlfSUdOT1JFX1NMQVNIRVM7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoY2hhciA9PSAnLycpIHsKICAgICAgICAgICAgICBzdGF0ZSA9IEFVVEhPUklUWTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB1cmwudXNlcm5hbWUgPSBiYXNlLnVzZXJuYW1lOwogICAgICAgICAgICAgIHVybC5wYXNzd29yZCA9IGJhc2UucGFzc3dvcmQ7CiAgICAgICAgICAgICAgdXJsLmhvc3QgPSBiYXNlLmhvc3Q7CiAgICAgICAgICAgICAgdXJsLnBvcnQgPSBiYXNlLnBvcnQ7CiAgICAgICAgICAgICAgc3RhdGUgPSBQQVRIOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBTUEVDSUFMX0FVVEhPUklUWV9TTEFTSEVTOgogICAgICAgICAgICBzdGF0ZSA9IFNQRUNJQUxfQVVUSE9SSVRZX0lHTk9SRV9TTEFTSEVTOwogICAgICAgICAgICBpZiAoY2hhciAhPSAnLycgfHwgYnVmZmVyLmNoYXJBdChwb2ludGVyICsgMSkgIT0gJy8nKQogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgcG9pbnRlcisrOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgU1BFQ0lBTF9BVVRIT1JJVFlfSUdOT1JFX1NMQVNIRVM6CiAgICAgICAgICAgIGlmIChjaGFyICE9ICcvJyAmJiBjaGFyICE9ICdcXCcpIHsKICAgICAgICAgICAgICBzdGF0ZSA9IEFVVEhPUklUWTsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgQVVUSE9SSVRZOgogICAgICAgICAgICBpZiAoY2hhciA9PSAnQCcpIHsKICAgICAgICAgICAgICBpZiAoc2VlbkF0KQogICAgICAgICAgICAgIGJ1ZmZlciA9ICclNDAnICsgYnVmZmVyOwogICAgICAgICAgICAgIHNlZW5BdCA9IHRydWU7CiAgICAgICAgICAgICAgYnVmZmVyQ29kZVBvaW50cyA9IGFycmF5RnJvbShidWZmZXIpOwogICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYnVmZmVyQ29kZVBvaW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdmFyIGNvZGVQb2ludCA9IGJ1ZmZlckNvZGVQb2ludHNbaV07CiAgICAgICAgICAgICAgICBpZiAoY29kZVBvaW50ID09ICc6JyAmJiAhc2VlblBhc3N3b3JkVG9rZW4pIHsKICAgICAgICAgICAgICAgICAgc2VlblBhc3N3b3JkVG9rZW4gPSB0cnVlOwogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciBlbmNvZGVkQ29kZVBvaW50cyA9IHBlcmNlbnRFbmNvZGUoY29kZVBvaW50LCB1c2VyaW5mb1BlcmNlbnRFbmNvZGVTZXQpOwogICAgICAgICAgICAgICAgaWYgKHNlZW5QYXNzd29yZFRva2VuKQogICAgICAgICAgICAgICAgdXJsLnBhc3N3b3JkICs9IGVuY29kZWRDb2RlUG9pbnRzO2Vsc2UKCiAgICAgICAgICAgICAgICB1cmwudXNlcm5hbWUgKz0gZW5jb2RlZENvZGVQb2ludHM7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJ1ZmZlciA9ICcnOwogICAgICAgICAgICB9IGVsc2UgaWYgKGNoYXIgPT0gRU9GIHx8IGNoYXIgPT0gJy8nIHx8IGNoYXIgPT0gJz8nIHx8IGNoYXIgPT0gJyMnIHx8IGNoYXIgPT0gJ1xcJyAmJiBpc1NwZWNpYWwodXJsKSkgewogICAgICAgICAgICAgIGlmIChzZWVuQXQgJiYgYnVmZmVyID09ICcnKQogICAgICAgICAgICAgIHJldHVybiBJTlZBTElEX0FVVEhPUklUWTsKICAgICAgICAgICAgICBwb2ludGVyIC09IGFycmF5RnJvbShidWZmZXIpLmxlbmd0aCArIDE7CiAgICAgICAgICAgICAgYnVmZmVyID0gJyc7CiAgICAgICAgICAgICAgc3RhdGUgPSBIT1NUOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgYnVmZmVyICs9IGNoYXI7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBIT1NUOgogICAgICAgICAgY2FzZSBIT1NUTkFNRToKICAgICAgICAgICAgaWYgKHN0YXRlT3ZlcnJpZGUgJiYgdXJsLnNjaGVtZSA9PSAnZmlsZScpIHsKICAgICAgICAgICAgICBzdGF0ZSA9IEZJTEVfSE9TVDsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfSBlbHNlIGlmIChjaGFyID09ICc6JyAmJiAhc2VlbkJyYWNrZXQpIHsKICAgICAgICAgICAgICBpZiAoYnVmZmVyID09ICcnKQogICAgICAgICAgICAgIHJldHVybiBJTlZBTElEX0hPU1Q7CiAgICAgICAgICAgICAgZmFpbHVyZSA9IHBhcnNlSG9zdCh1cmwsIGJ1ZmZlcik7CiAgICAgICAgICAgICAgaWYgKGZhaWx1cmUpCiAgICAgICAgICAgICAgcmV0dXJuIGZhaWx1cmU7CiAgICAgICAgICAgICAgYnVmZmVyID0gJyc7CiAgICAgICAgICAgICAgc3RhdGUgPSBQT1JUOwogICAgICAgICAgICAgIGlmIChzdGF0ZU92ZXJyaWRlID09IEhPU1ROQU1FKQogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfSBlbHNlIGlmIChjaGFyID09IEVPRiB8fCBjaGFyID09ICcvJyB8fCBjaGFyID09ICc/JyB8fCBjaGFyID09ICcjJyB8fCBjaGFyID09ICdcXCcgJiYgaXNTcGVjaWFsKHVybCkpIHsKICAgICAgICAgICAgICBpZiAoaXNTcGVjaWFsKHVybCkgJiYgYnVmZmVyID09ICcnKQogICAgICAgICAgICAgIHJldHVybiBJTlZBTElEX0hPU1Q7CiAgICAgICAgICAgICAgaWYgKHN0YXRlT3ZlcnJpZGUgJiYgYnVmZmVyID09ICcnICYmIChpbmNsdWRlc0NyZWRlbnRpYWxzKHVybCkgfHwgdXJsLnBvcnQgIT09IG51bGwpKQogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICBmYWlsdXJlID0gcGFyc2VIb3N0KHVybCwgYnVmZmVyKTsKICAgICAgICAgICAgICBpZiAoZmFpbHVyZSkKICAgICAgICAgICAgICByZXR1cm4gZmFpbHVyZTsKICAgICAgICAgICAgICBidWZmZXIgPSAnJzsKICAgICAgICAgICAgICBzdGF0ZSA9IFBBVEhfU1RBUlQ7CiAgICAgICAgICAgICAgaWYgKHN0YXRlT3ZlcnJpZGUpCiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGlmIChjaGFyID09ICdbJykKICAgICAgICAgICAgICBzZWVuQnJhY2tldCA9IHRydWU7ZWxzZQogICAgICAgICAgICAgIGlmIChjaGFyID09ICddJykKICAgICAgICAgICAgICBzZWVuQnJhY2tldCA9IGZhbHNlOwogICAgICAgICAgICAgIGJ1ZmZlciArPSBjaGFyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBQT1JUOgogICAgICAgICAgICBpZiAoRElHSVQudGVzdChjaGFyKSkgewogICAgICAgICAgICAgIGJ1ZmZlciArPSBjaGFyOwogICAgICAgICAgICB9IGVsc2UgaWYgKGNoYXIgPT0gRU9GIHx8IGNoYXIgPT0gJy8nIHx8IGNoYXIgPT0gJz8nIHx8IGNoYXIgPT0gJyMnIHx8IGNoYXIgPT0gJ1xcJyAmJiBpc1NwZWNpYWwodXJsKSB8fCBzdGF0ZU92ZXJyaWRlKSB7CiAgICAgICAgICAgICAgaWYgKGJ1ZmZlciAhPSAnJykgewogICAgICAgICAgICAgICAgdmFyIHBvcnQgPSBwYXJzZUludChidWZmZXIsIDEwKTsKICAgICAgICAgICAgICAgIGlmIChwb3J0ID4gMHhGRkZGKQogICAgICAgICAgICAgICAgcmV0dXJuIElOVkFMSURfUE9SVDsKICAgICAgICAgICAgICAgIHVybC5wb3J0ID0gaXNTcGVjaWFsKHVybCkgJiYgcG9ydCA9PT0gc3BlY2lhbFNjaGVtZXNbdXJsLnNjaGVtZV0gPyBudWxsIDogcG9ydDsKICAgICAgICAgICAgICAgIGJ1ZmZlciA9ICcnOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoc3RhdGVPdmVycmlkZSkKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgc3RhdGUgPSBQQVRIX1NUQVJUOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgcmV0dXJuIElOVkFMSURfUE9SVDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIEZJTEU6CiAgICAgICAgICAgIHVybC5zY2hlbWUgPSAnZmlsZSc7CiAgICAgICAgICAgIGlmIChjaGFyID09ICcvJyB8fCBjaGFyID09ICdcXCcpCiAgICAgICAgICAgIHN0YXRlID0gRklMRV9TTEFTSDtlbHNlCiAgICAgICAgICAgIGlmIChiYXNlICYmIGJhc2Uuc2NoZW1lID09ICdmaWxlJykgewogICAgICAgICAgICAgIGlmIChjaGFyID09IEVPRikgewogICAgICAgICAgICAgICAgdXJsLmhvc3QgPSBiYXNlLmhvc3Q7CiAgICAgICAgICAgICAgICB1cmwucGF0aCA9IGJhc2UucGF0aC5zbGljZSgpOwogICAgICAgICAgICAgICAgdXJsLnF1ZXJ5ID0gYmFzZS5xdWVyeTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNoYXIgPT0gJz8nKSB7CiAgICAgICAgICAgICAgICB1cmwuaG9zdCA9IGJhc2UuaG9zdDsKICAgICAgICAgICAgICAgIHVybC5wYXRoID0gYmFzZS5wYXRoLnNsaWNlKCk7CiAgICAgICAgICAgICAgICB1cmwucXVlcnkgPSAnJzsKICAgICAgICAgICAgICAgIHN0YXRlID0gUVVFUlk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChjaGFyID09ICcjJykgewogICAgICAgICAgICAgICAgdXJsLmhvc3QgPSBiYXNlLmhvc3Q7CiAgICAgICAgICAgICAgICB1cmwucGF0aCA9IGJhc2UucGF0aC5zbGljZSgpOwogICAgICAgICAgICAgICAgdXJsLnF1ZXJ5ID0gYmFzZS5xdWVyeTsKICAgICAgICAgICAgICAgIHVybC5mcmFnbWVudCA9ICcnOwogICAgICAgICAgICAgICAgc3RhdGUgPSBGUkFHTUVOVDsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKCFzdGFydHNXaXRoV2luZG93c0RyaXZlTGV0dGVyKGNvZGVQb2ludHMuc2xpY2UocG9pbnRlcikuam9pbignJykpKSB7CiAgICAgICAgICAgICAgICAgIHVybC5ob3N0ID0gYmFzZS5ob3N0OwogICAgICAgICAgICAgICAgICB1cmwucGF0aCA9IGJhc2UucGF0aC5zbGljZSgpOwogICAgICAgICAgICAgICAgICBzaG9ydGVuVVJMc1BhdGgodXJsKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHN0YXRlID0gUEFUSDsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBzdGF0ZSA9IFBBVEg7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIEZJTEVfU0xBU0g6CiAgICAgICAgICAgIGlmIChjaGFyID09ICcvJyB8fCBjaGFyID09ICdcXCcpIHsKICAgICAgICAgICAgICBzdGF0ZSA9IEZJTEVfSE9TVDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYmFzZSAmJiBiYXNlLnNjaGVtZSA9PSAnZmlsZScgJiYgIXN0YXJ0c1dpdGhXaW5kb3dzRHJpdmVMZXR0ZXIoY29kZVBvaW50cy5zbGljZShwb2ludGVyKS5qb2luKCcnKSkpIHsKICAgICAgICAgICAgICBpZiAoaXNXaW5kb3dzRHJpdmVMZXR0ZXIoYmFzZS5wYXRoWzBdLCB0cnVlKSkKICAgICAgICAgICAgICB1cmwucGF0aC5wdXNoKGJhc2UucGF0aFswXSk7ZWxzZQoKICAgICAgICAgICAgICB1cmwuaG9zdCA9IGJhc2UuaG9zdDsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdGF0ZSA9IFBBVEg7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgY2FzZSBGSUxFX0hPU1Q6CiAgICAgICAgICAgIGlmIChjaGFyID09IEVPRiB8fCBjaGFyID09ICcvJyB8fCBjaGFyID09ICdcXCcgfHwgY2hhciA9PSAnPycgfHwgY2hhciA9PSAnIycpIHsKICAgICAgICAgICAgICBpZiAoIXN0YXRlT3ZlcnJpZGUgJiYgaXNXaW5kb3dzRHJpdmVMZXR0ZXIoYnVmZmVyKSkgewogICAgICAgICAgICAgICAgc3RhdGUgPSBQQVRIOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoYnVmZmVyID09ICcnKSB7CiAgICAgICAgICAgICAgICB1cmwuaG9zdCA9ICcnOwogICAgICAgICAgICAgICAgaWYgKHN0YXRlT3ZlcnJpZGUpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICBzdGF0ZSA9IFBBVEhfU1RBUlQ7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGZhaWx1cmUgPSBwYXJzZUhvc3QodXJsLCBidWZmZXIpOwogICAgICAgICAgICAgICAgaWYgKGZhaWx1cmUpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFpbHVyZTsKICAgICAgICAgICAgICAgIGlmICh1cmwuaG9zdCA9PSAnbG9jYWxob3N0JykKICAgICAgICAgICAgICAgIHVybC5ob3N0ID0gJyc7CiAgICAgICAgICAgICAgICBpZiAoc3RhdGVPdmVycmlkZSkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIGJ1ZmZlciA9ICcnOwogICAgICAgICAgICAgICAgc3RhdGUgPSBQQVRIX1NUQVJUOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIGJ1ZmZlciArPSBjaGFyOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgUEFUSF9TVEFSVDoKICAgICAgICAgICAgaWYgKGlzU3BlY2lhbCh1cmwpKSB7CiAgICAgICAgICAgICAgc3RhdGUgPSBQQVRIOwogICAgICAgICAgICAgIGlmIChjaGFyICE9ICcvJyAmJiBjaGFyICE9ICdcXCcpCiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoIXN0YXRlT3ZlcnJpZGUgJiYgY2hhciA9PSAnPycpIHsKICAgICAgICAgICAgICB1cmwucXVlcnkgPSAnJzsKICAgICAgICAgICAgICBzdGF0ZSA9IFFVRVJZOwogICAgICAgICAgICB9IGVsc2UgaWYgKCFzdGF0ZU92ZXJyaWRlICYmIGNoYXIgPT0gJyMnKSB7CiAgICAgICAgICAgICAgdXJsLmZyYWdtZW50ID0gJyc7CiAgICAgICAgICAgICAgc3RhdGUgPSBGUkFHTUVOVDsKICAgICAgICAgICAgfSBlbHNlIGlmIChjaGFyICE9IEVPRikgewogICAgICAgICAgICAgIHN0YXRlID0gUEFUSDsKICAgICAgICAgICAgICBpZiAoY2hhciAhPSAnLycpCiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIFBBVEg6CiAgICAgICAgICAgIGlmIChjaGFyID09IEVPRiB8fCBjaGFyID09ICcvJyB8fCBjaGFyID09ICdcXCcgJiYgaXNTcGVjaWFsKHVybCkgfHwgIXN0YXRlT3ZlcnJpZGUgJiYgKGNoYXIgPT0gJz8nIHx8IGNoYXIgPT0gJyMnKSkgewogICAgICAgICAgICAgIGlmIChpc0RvdWJsZURvdChidWZmZXIpKSB7CiAgICAgICAgICAgICAgICBzaG9ydGVuVVJMc1BhdGgodXJsKTsKICAgICAgICAgICAgICAgIGlmIChjaGFyICE9ICcvJyAmJiAhKGNoYXIgPT0gJ1xcJyAmJiBpc1NwZWNpYWwodXJsKSkpIHsKICAgICAgICAgICAgICAgICAgdXJsLnBhdGgucHVzaCgnJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc1NpbmdsZURvdChidWZmZXIpKSB7CiAgICAgICAgICAgICAgICBpZiAoY2hhciAhPSAnLycgJiYgIShjaGFyID09ICdcXCcgJiYgaXNTcGVjaWFsKHVybCkpKSB7CiAgICAgICAgICAgICAgICAgIHVybC5wYXRoLnB1c2goJycpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAodXJsLnNjaGVtZSA9PSAnZmlsZScgJiYgIXVybC5wYXRoLmxlbmd0aCAmJiBpc1dpbmRvd3NEcml2ZUxldHRlcihidWZmZXIpKSB7CiAgICAgICAgICAgICAgICAgIGlmICh1cmwuaG9zdCkKICAgICAgICAgICAgICAgICAgdXJsLmhvc3QgPSAnJzsKICAgICAgICAgICAgICAgICAgYnVmZmVyID0gYnVmZmVyLmNoYXJBdCgwKSArICc6JzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHVybC5wYXRoLnB1c2goYnVmZmVyKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnVmZmVyID0gJyc7CiAgICAgICAgICAgICAgaWYgKHVybC5zY2hlbWUgPT0gJ2ZpbGUnICYmIChjaGFyID09IEVPRiB8fCBjaGFyID09ICc/JyB8fCBjaGFyID09ICcjJykpIHsKICAgICAgICAgICAgICAgIHdoaWxlICh1cmwucGF0aC5sZW5ndGggPiAxICYmIHVybC5wYXRoWzBdID09PSAnJykgewogICAgICAgICAgICAgICAgICB1cmwucGF0aC5zaGlmdCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoY2hhciA9PSAnPycpIHsKICAgICAgICAgICAgICAgIHVybC5xdWVyeSA9ICcnOwogICAgICAgICAgICAgICAgc3RhdGUgPSBRVUVSWTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNoYXIgPT0gJyMnKSB7CiAgICAgICAgICAgICAgICB1cmwuZnJhZ21lbnQgPSAnJzsKICAgICAgICAgICAgICAgIHN0YXRlID0gRlJBR01FTlQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGJ1ZmZlciArPSBwZXJjZW50RW5jb2RlKGNoYXIsIHBhdGhQZXJjZW50RW5jb2RlU2V0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgQ0FOTk9UX0JFX0FfQkFTRV9VUkxfUEFUSDoKICAgICAgICAgICAgaWYgKGNoYXIgPT0gJz8nKSB7CiAgICAgICAgICAgICAgdXJsLnF1ZXJ5ID0gJyc7CiAgICAgICAgICAgICAgc3RhdGUgPSBRVUVSWTsKICAgICAgICAgICAgfSBlbHNlIGlmIChjaGFyID09ICcjJykgewogICAgICAgICAgICAgIHVybC5mcmFnbWVudCA9ICcnOwogICAgICAgICAgICAgIHN0YXRlID0gRlJBR01FTlQ7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoY2hhciAhPSBFT0YpIHsKICAgICAgICAgICAgICB1cmwucGF0aFswXSArPSBwZXJjZW50RW5jb2RlKGNoYXIsIEMwQ29udHJvbFBlcmNlbnRFbmNvZGVTZXQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBRVUVSWToKICAgICAgICAgICAgaWYgKCFzdGF0ZU92ZXJyaWRlICYmIGNoYXIgPT0gJyMnKSB7CiAgICAgICAgICAgICAgdXJsLmZyYWdtZW50ID0gJyc7CiAgICAgICAgICAgICAgc3RhdGUgPSBGUkFHTUVOVDsKICAgICAgICAgICAgfSBlbHNlIGlmIChjaGFyICE9IEVPRikgewogICAgICAgICAgICAgIGlmIChjaGFyID09ICInIiAmJiBpc1NwZWNpYWwodXJsKSkKICAgICAgICAgICAgICB1cmwucXVlcnkgKz0gJyUyNyc7ZWxzZQogICAgICAgICAgICAgIGlmIChjaGFyID09ICcjJykKICAgICAgICAgICAgICB1cmwucXVlcnkgKz0gJyUyMyc7ZWxzZQoKICAgICAgICAgICAgICB1cmwucXVlcnkgKz0gcGVyY2VudEVuY29kZShjaGFyLCBDMENvbnRyb2xQZXJjZW50RW5jb2RlU2V0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgRlJBR01FTlQ6CiAgICAgICAgICAgIGlmIChjaGFyICE9IEVPRikKICAgICAgICAgICAgdXJsLmZyYWdtZW50ICs9IHBlcmNlbnRFbmNvZGUoY2hhciwgZnJhZ21lbnRQZXJjZW50RW5jb2RlU2V0KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHBvaW50ZXIrKzsKICAgICAgfQogICAgfTsKICAgIHZhciBVUkxDb25zdHJ1Y3RvciA9IGZ1bmN0aW9uIFVSTCh1cmwpIHsKICAgICAgdmFyIHRoYXQgPSBhbkluc3RhbmNlKHRoaXMsIFVSTENvbnN0cnVjdG9yLCAnVVJMJyk7CiAgICAgIHZhciBiYXNlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQ7CiAgICAgIHZhciB1cmxTdHJpbmcgPSBTdHJpbmcodXJsKTsKICAgICAgdmFyIHN0YXRlID0gc2V0SW50ZXJuYWxTdGF0ZSh0aGF0LCB7IHR5cGU6ICdVUkwnIH0pOwogICAgICB2YXIgYmFzZVN0YXRlLCBmYWlsdXJlOwogICAgICBpZiAoYmFzZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgaWYgKGJhc2UgaW5zdGFuY2VvZiBVUkxDb25zdHJ1Y3RvcikKICAgICAgICBiYXNlU3RhdGUgPSBnZXRJbnRlcm5hbFVSTFN0YXRlKGJhc2UpO2Vsc2UKICAgICAgICB7CiAgICAgICAgICBmYWlsdXJlID0gcGFyc2VVUkwoYmFzZVN0YXRlID0ge30sIFN0cmluZyhiYXNlKSk7CiAgICAgICAgICBpZiAoZmFpbHVyZSkKICAgICAgICAgIHRocm93IFR5cGVFcnJvcihmYWlsdXJlKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZmFpbHVyZSA9IHBhcnNlVVJMKHN0YXRlLCB1cmxTdHJpbmcsIG51bGwsIGJhc2VTdGF0ZSk7CiAgICAgIGlmIChmYWlsdXJlKQogICAgICB0aHJvdyBUeXBlRXJyb3IoZmFpbHVyZSk7CiAgICAgIHZhciBzZWFyY2hQYXJhbXMgPSBzdGF0ZS5zZWFyY2hQYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKCk7CiAgICAgIHZhciBzZWFyY2hQYXJhbXNTdGF0ZSA9IGdldEludGVybmFsU2VhcmNoUGFyYW1zU3RhdGUoc2VhcmNoUGFyYW1zKTsKICAgICAgc2VhcmNoUGFyYW1zU3RhdGUudXBkYXRlU2VhcmNoUGFyYW1zKHN0YXRlLnF1ZXJ5KTsKICAgICAgc2VhcmNoUGFyYW1zU3RhdGUudXBkYXRlVVJMID0gZnVuY3Rpb24gKCkgewogICAgICAgIHN0YXRlLnF1ZXJ5ID0gU3RyaW5nKHNlYXJjaFBhcmFtcykgfHwgbnVsbDsKICAgICAgfTsKICAgICAgaWYgKCFERVNDUklQVE9SUykgewogICAgICAgIHRoYXQuaHJlZiA9IHNlcmlhbGl6ZVVSTC5jYWxsKHRoYXQpOwogICAgICAgIHRoYXQub3JpZ2luID0gZ2V0T3JpZ2luLmNhbGwodGhhdCk7CiAgICAgICAgdGhhdC5wcm90b2NvbCA9IGdldFByb3RvY29sLmNhbGwodGhhdCk7CiAgICAgICAgdGhhdC51c2VybmFtZSA9IGdldFVzZXJuYW1lLmNhbGwodGhhdCk7CiAgICAgICAgdGhhdC5wYXNzd29yZCA9IGdldFBhc3N3b3JkLmNhbGwodGhhdCk7CiAgICAgICAgdGhhdC5ob3N0ID0gZ2V0SG9zdC5jYWxsKHRoYXQpOwogICAgICAgIHRoYXQuaG9zdG5hbWUgPSBnZXRIb3N0bmFtZS5jYWxsKHRoYXQpOwogICAgICAgIHRoYXQucG9ydCA9IGdldFBvcnQuY2FsbCh0aGF0KTsKICAgICAgICB0aGF0LnBhdGhuYW1lID0gZ2V0UGF0aG5hbWUuY2FsbCh0aGF0KTsKICAgICAgICB0aGF0LnNlYXJjaCA9IGdldFNlYXJjaC5jYWxsKHRoYXQpOwogICAgICAgIHRoYXQuc2VhcmNoUGFyYW1zID0gZ2V0U2VhcmNoUGFyYW1zLmNhbGwodGhhdCk7CiAgICAgICAgdGhhdC5oYXNoID0gZ2V0SGFzaC5jYWxsKHRoYXQpOwogICAgICB9CiAgICB9OwogICAgdmFyIFVSTFByb3RvdHlwZSA9IFVSTENvbnN0cnVjdG9yLnByb3RvdHlwZTsKICAgIHZhciBzZXJpYWxpemVVUkwgPSBmdW5jdGlvbiBzZXJpYWxpemVVUkwoKSB7CiAgICAgIHZhciB1cmwgPSBnZXRJbnRlcm5hbFVSTFN0YXRlKHRoaXMpOwogICAgICB2YXIgc2NoZW1lID0gdXJsLnNjaGVtZTsKICAgICAgdmFyIHVzZXJuYW1lID0gdXJsLnVzZXJuYW1lOwogICAgICB2YXIgcGFzc3dvcmQgPSB1cmwucGFzc3dvcmQ7CiAgICAgIHZhciBob3N0ID0gdXJsLmhvc3Q7CiAgICAgIHZhciBwb3J0ID0gdXJsLnBvcnQ7CiAgICAgIHZhciBwYXRoID0gdXJsLnBhdGg7CiAgICAgIHZhciBxdWVyeSA9IHVybC5xdWVyeTsKICAgICAgdmFyIGZyYWdtZW50ID0gdXJsLmZyYWdtZW50OwogICAgICB2YXIgb3V0cHV0ID0gc2NoZW1lICsgJzonOwogICAgICBpZiAoaG9zdCAhPT0gbnVsbCkgewogICAgICAgIG91dHB1dCArPSAnLy8nOwogICAgICAgIGlmIChpbmNsdWRlc0NyZWRlbnRpYWxzKHVybCkpIHsKICAgICAgICAgIG91dHB1dCArPSB1c2VybmFtZSArIChwYXNzd29yZCA/ICc6JyArIHBhc3N3b3JkIDogJycpICsgJ0AnOwogICAgICAgIH0KICAgICAgICBvdXRwdXQgKz0gc2VyaWFsaXplSG9zdChob3N0KTsKICAgICAgICBpZiAocG9ydCAhPT0gbnVsbCkKICAgICAgICBvdXRwdXQgKz0gJzonICsgcG9ydDsKICAgICAgfSBlbHNlIGlmIChzY2hlbWUgPT0gJ2ZpbGUnKQogICAgICBvdXRwdXQgKz0gJy8vJzsKICAgICAgb3V0cHV0ICs9IHVybC5jYW5ub3RCZUFCYXNlVVJMID8gcGF0aFswXSA6IHBhdGgubGVuZ3RoID8gJy8nICsgcGF0aC5qb2luKCcvJykgOiAnJzsKICAgICAgaWYgKHF1ZXJ5ICE9PSBudWxsKQogICAgICBvdXRwdXQgKz0gJz8nICsgcXVlcnk7CiAgICAgIGlmIChmcmFnbWVudCAhPT0gbnVsbCkKICAgICAgb3V0cHV0ICs9ICcjJyArIGZyYWdtZW50OwogICAgICByZXR1cm4gb3V0cHV0OwogICAgfTsKICAgIHZhciBnZXRPcmlnaW4gPSBmdW5jdGlvbiBnZXRPcmlnaW4oKSB7CiAgICAgIHZhciB1cmwgPSBnZXRJbnRlcm5hbFVSTFN0YXRlKHRoaXMpOwogICAgICB2YXIgc2NoZW1lID0gdXJsLnNjaGVtZTsKICAgICAgdmFyIHBvcnQgPSB1cmwucG9ydDsKICAgICAgaWYgKHNjaGVtZSA9PSAnYmxvYicpCiAgICAgIHRyeSB7CiAgICAgICAgcmV0dXJuIG5ldyBVUkwoc2NoZW1lLnBhdGhbMF0pLm9yaWdpbjsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICByZXR1cm4gJ251bGwnOwogICAgICB9CiAgICAgIGlmIChzY2hlbWUgPT0gJ2ZpbGUnIHx8ICFpc1NwZWNpYWwodXJsKSkKICAgICAgcmV0dXJuICdudWxsJzsKICAgICAgcmV0dXJuIHNjaGVtZSArICc6Ly8nICsgc2VyaWFsaXplSG9zdCh1cmwuaG9zdCkgKyAocG9ydCAhPT0gbnVsbCA/ICc6JyArIHBvcnQgOiAnJyk7CiAgICB9OwogICAgdmFyIGdldFByb3RvY29sID0gZnVuY3Rpb24gZ2V0UHJvdG9jb2woKSB7CiAgICAgIHJldHVybiBnZXRJbnRlcm5hbFVSTFN0YXRlKHRoaXMpLnNjaGVtZSArICc6JzsKICAgIH07CiAgICB2YXIgZ2V0VXNlcm5hbWUgPSBmdW5jdGlvbiBnZXRVc2VybmFtZSgpIHsKICAgICAgcmV0dXJuIGdldEludGVybmFsVVJMU3RhdGUodGhpcykudXNlcm5hbWU7CiAgICB9OwogICAgdmFyIGdldFBhc3N3b3JkID0gZnVuY3Rpb24gZ2V0UGFzc3dvcmQoKSB7CiAgICAgIHJldHVybiBnZXRJbnRlcm5hbFVSTFN0YXRlKHRoaXMpLnBhc3N3b3JkOwogICAgfTsKICAgIHZhciBnZXRIb3N0ID0gZnVuY3Rpb24gZ2V0SG9zdCgpIHsKICAgICAgdmFyIHVybCA9IGdldEludGVybmFsVVJMU3RhdGUodGhpcyk7CiAgICAgIHZhciBob3N0ID0gdXJsLmhvc3Q7CiAgICAgIHZhciBwb3J0ID0gdXJsLnBvcnQ7CiAgICAgIHJldHVybiBob3N0ID09PSBudWxsID8gJycgOiBwb3J0ID09PSBudWxsID8gc2VyaWFsaXplSG9zdChob3N0KSA6IHNlcmlhbGl6ZUhvc3QoaG9zdCkgKyAnOicgKyBwb3J0OwogICAgfTsKICAgIHZhciBnZXRIb3N0bmFtZSA9IGZ1bmN0aW9uIGdldEhvc3RuYW1lKCkgewogICAgICB2YXIgaG9zdCA9IGdldEludGVybmFsVVJMU3RhdGUodGhpcykuaG9zdDsKICAgICAgcmV0dXJuIGhvc3QgPT09IG51bGwgPyAnJyA6IHNlcmlhbGl6ZUhvc3QoaG9zdCk7CiAgICB9OwogICAgdmFyIGdldFBvcnQgPSBmdW5jdGlvbiBnZXRQb3J0KCkgewogICAgICB2YXIgcG9ydCA9IGdldEludGVybmFsVVJMU3RhdGUodGhpcykucG9ydDsKICAgICAgcmV0dXJuIHBvcnQgPT09IG51bGwgPyAnJyA6IFN0cmluZyhwb3J0KTsKICAgIH07CiAgICB2YXIgZ2V0UGF0aG5hbWUgPSBmdW5jdGlvbiBnZXRQYXRobmFtZSgpIHsKICAgICAgdmFyIHVybCA9IGdldEludGVybmFsVVJMU3RhdGUodGhpcyk7CiAgICAgIHZhciBwYXRoID0gdXJsLnBhdGg7CiAgICAgIHJldHVybiB1cmwuY2Fubm90QmVBQmFzZVVSTCA/IHBhdGhbMF0gOiBwYXRoLmxlbmd0aCA/ICcvJyArIHBhdGguam9pbignLycpIDogJyc7CiAgICB9OwogICAgdmFyIGdldFNlYXJjaCA9IGZ1bmN0aW9uIGdldFNlYXJjaCgpIHsKICAgICAgdmFyIHF1ZXJ5ID0gZ2V0SW50ZXJuYWxVUkxTdGF0ZSh0aGlzKS5xdWVyeTsKICAgICAgcmV0dXJuIHF1ZXJ5ID8gJz8nICsgcXVlcnkgOiAnJzsKICAgIH07CiAgICB2YXIgZ2V0U2VhcmNoUGFyYW1zID0gZnVuY3Rpb24gZ2V0U2VhcmNoUGFyYW1zKCkgewogICAgICByZXR1cm4gZ2V0SW50ZXJuYWxVUkxTdGF0ZSh0aGlzKS5zZWFyY2hQYXJhbXM7CiAgICB9OwogICAgdmFyIGdldEhhc2ggPSBmdW5jdGlvbiBnZXRIYXNoKCkgewogICAgICB2YXIgZnJhZ21lbnQgPSBnZXRJbnRlcm5hbFVSTFN0YXRlKHRoaXMpLmZyYWdtZW50OwogICAgICByZXR1cm4gZnJhZ21lbnQgPyAnIycgKyBmcmFnbWVudCA6ICcnOwogICAgfTsKICAgIHZhciBhY2Nlc3NvckRlc2NyaXB0b3IgPSBmdW5jdGlvbiBhY2Nlc3NvckRlc2NyaXB0b3IoZ2V0dGVyLCBzZXR0ZXIpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBnZXQ6IGdldHRlciwKICAgICAgICBzZXQ6IHNldHRlciwKICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZQogICAgICB9OwogICAgfTsKICAgIGlmIChERVNDUklQVE9SUykgewogICAgICBkZWZpbmVQcm9wZXJ0aWVzKFVSTFByb3RvdHlwZSwgewogICAgICAgIGhyZWY6IGFjY2Vzc29yRGVzY3JpcHRvcihzZXJpYWxpemVVUkwsIGZ1bmN0aW9uIChocmVmKSB7CiAgICAgICAgICB2YXIgdXJsID0gZ2V0SW50ZXJuYWxVUkxTdGF0ZSh0aGlzKTsKICAgICAgICAgIHZhciB1cmxTdHJpbmcgPSBTdHJpbmcoaHJlZik7CiAgICAgICAgICB2YXIgZmFpbHVyZSA9IHBhcnNlVVJMKHVybCwgdXJsU3RyaW5nKTsKICAgICAgICAgIGlmIChmYWlsdXJlKQogICAgICAgICAgdGhyb3cgVHlwZUVycm9yKGZhaWx1cmUpOwogICAgICAgICAgZ2V0SW50ZXJuYWxTZWFyY2hQYXJhbXNTdGF0ZSh1cmwuc2VhcmNoUGFyYW1zKS51cGRhdGVTZWFyY2hQYXJhbXModXJsLnF1ZXJ5KTsKICAgICAgICB9KSwKICAgICAgICBvcmlnaW46IGFjY2Vzc29yRGVzY3JpcHRvcihnZXRPcmlnaW4pLAogICAgICAgIHByb3RvY29sOiBhY2Nlc3NvckRlc2NyaXB0b3IoZ2V0UHJvdG9jb2wsIGZ1bmN0aW9uIChwcm90b2NvbCkgewogICAgICAgICAgdmFyIHVybCA9IGdldEludGVybmFsVVJMU3RhdGUodGhpcyk7CiAgICAgICAgICBwYXJzZVVSTCh1cmwsIFN0cmluZyhwcm90b2NvbCkgKyAnOicsIFNDSEVNRV9TVEFSVCk7CiAgICAgICAgfSksCiAgICAgICAgdXNlcm5hbWU6IGFjY2Vzc29yRGVzY3JpcHRvcihnZXRVc2VybmFtZSwgZnVuY3Rpb24gKHVzZXJuYW1lKSB7CiAgICAgICAgICB2YXIgdXJsID0gZ2V0SW50ZXJuYWxVUkxTdGF0ZSh0aGlzKTsKICAgICAgICAgIHZhciBjb2RlUG9pbnRzID0gYXJyYXlGcm9tKFN0cmluZyh1c2VybmFtZSkpOwogICAgICAgICAgaWYgKGNhbm5vdEhhdmVVc2VybmFtZVBhc3N3b3JkUG9ydCh1cmwpKQogICAgICAgICAgcmV0dXJuOwogICAgICAgICAgdXJsLnVzZXJuYW1lID0gJyc7CiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvZGVQb2ludHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdXJsLnVzZXJuYW1lICs9IHBlcmNlbnRFbmNvZGUoY29kZVBvaW50c1tpXSwgdXNlcmluZm9QZXJjZW50RW5jb2RlU2V0KTsKICAgICAgICAgIH0KICAgICAgICB9KSwKICAgICAgICBwYXNzd29yZDogYWNjZXNzb3JEZXNjcmlwdG9yKGdldFBhc3N3b3JkLCBmdW5jdGlvbiAocGFzc3dvcmQpIHsKICAgICAgICAgIHZhciB1cmwgPSBnZXRJbnRlcm5hbFVSTFN0YXRlKHRoaXMpOwogICAgICAgICAgdmFyIGNvZGVQb2ludHMgPSBhcnJheUZyb20oU3RyaW5nKHBhc3N3b3JkKSk7CiAgICAgICAgICBpZiAoY2Fubm90SGF2ZVVzZXJuYW1lUGFzc3dvcmRQb3J0KHVybCkpCiAgICAgICAgICByZXR1cm47CiAgICAgICAgICB1cmwucGFzc3dvcmQgPSAnJzsKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY29kZVBvaW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB1cmwucGFzc3dvcmQgKz0gcGVyY2VudEVuY29kZShjb2RlUG9pbnRzW2ldLCB1c2VyaW5mb1BlcmNlbnRFbmNvZGVTZXQpOwogICAgICAgICAgfQogICAgICAgIH0pLAogICAgICAgIGhvc3Q6IGFjY2Vzc29yRGVzY3JpcHRvcihnZXRIb3N0LCBmdW5jdGlvbiAoaG9zdCkgewogICAgICAgICAgdmFyIHVybCA9IGdldEludGVybmFsVVJMU3RhdGUodGhpcyk7CiAgICAgICAgICBpZiAodXJsLmNhbm5vdEJlQUJhc2VVUkwpCiAgICAgICAgICByZXR1cm47CiAgICAgICAgICBwYXJzZVVSTCh1cmwsIFN0cmluZyhob3N0KSwgSE9TVCk7CiAgICAgICAgfSksCiAgICAgICAgaG9zdG5hbWU6IGFjY2Vzc29yRGVzY3JpcHRvcihnZXRIb3N0bmFtZSwgZnVuY3Rpb24gKGhvc3RuYW1lKSB7CiAgICAgICAgICB2YXIgdXJsID0gZ2V0SW50ZXJuYWxVUkxTdGF0ZSh0aGlzKTsKICAgICAgICAgIGlmICh1cmwuY2Fubm90QmVBQmFzZVVSTCkKICAgICAgICAgIHJldHVybjsKICAgICAgICAgIHBhcnNlVVJMKHVybCwgU3RyaW5nKGhvc3RuYW1lKSwgSE9TVE5BTUUpOwogICAgICAgIH0pLAogICAgICAgIHBvcnQ6IGFjY2Vzc29yRGVzY3JpcHRvcihnZXRQb3J0LCBmdW5jdGlvbiAocG9ydCkgewogICAgICAgICAgdmFyIHVybCA9IGdldEludGVybmFsVVJMU3RhdGUodGhpcyk7CiAgICAgICAgICBpZiAoY2Fubm90SGF2ZVVzZXJuYW1lUGFzc3dvcmRQb3J0KHVybCkpCiAgICAgICAgICByZXR1cm47CiAgICAgICAgICBwb3J0ID0gU3RyaW5nKHBvcnQpOwogICAgICAgICAgaWYgKHBvcnQgPT0gJycpCiAgICAgICAgICB1cmwucG9ydCA9IG51bGw7ZWxzZQoKICAgICAgICAgIHBhcnNlVVJMKHVybCwgcG9ydCwgUE9SVCk7CiAgICAgICAgfSksCiAgICAgICAgcGF0aG5hbWU6IGFjY2Vzc29yRGVzY3JpcHRvcihnZXRQYXRobmFtZSwgZnVuY3Rpb24gKHBhdGhuYW1lKSB7CiAgICAgICAgICB2YXIgdXJsID0gZ2V0SW50ZXJuYWxVUkxTdGF0ZSh0aGlzKTsKICAgICAgICAgIGlmICh1cmwuY2Fubm90QmVBQmFzZVVSTCkKICAgICAgICAgIHJldHVybjsKICAgICAgICAgIHVybC5wYXRoID0gW107CiAgICAgICAgICBwYXJzZVVSTCh1cmwsIHBhdGhuYW1lICsgJycsIFBBVEhfU1RBUlQpOwogICAgICAgIH0pLAogICAgICAgIHNlYXJjaDogYWNjZXNzb3JEZXNjcmlwdG9yKGdldFNlYXJjaCwgZnVuY3Rpb24gKHNlYXJjaCkgewogICAgICAgICAgdmFyIHVybCA9IGdldEludGVybmFsVVJMU3RhdGUodGhpcyk7CiAgICAgICAgICBzZWFyY2ggPSBTdHJpbmcoc2VhcmNoKTsKICAgICAgICAgIGlmIChzZWFyY2ggPT0gJycpIHsKICAgICAgICAgICAgdXJsLnF1ZXJ5ID0gbnVsbDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICgnPycgPT0gc2VhcmNoLmNoYXJBdCgwKSkKICAgICAgICAgICAgc2VhcmNoID0gc2VhcmNoLnNsaWNlKDEpOwogICAgICAgICAgICB1cmwucXVlcnkgPSAnJzsKICAgICAgICAgICAgcGFyc2VVUkwodXJsLCBzZWFyY2gsIFFVRVJZKTsKICAgICAgICAgIH0KICAgICAgICAgIGdldEludGVybmFsU2VhcmNoUGFyYW1zU3RhdGUodXJsLnNlYXJjaFBhcmFtcykudXBkYXRlU2VhcmNoUGFyYW1zKHVybC5xdWVyeSk7CiAgICAgICAgfSksCiAgICAgICAgc2VhcmNoUGFyYW1zOiBhY2Nlc3NvckRlc2NyaXB0b3IoZ2V0U2VhcmNoUGFyYW1zKSwKICAgICAgICBoYXNoOiBhY2Nlc3NvckRlc2NyaXB0b3IoZ2V0SGFzaCwgZnVuY3Rpb24gKGhhc2gpIHsKICAgICAgICAgIHZhciB1cmwgPSBnZXRJbnRlcm5hbFVSTFN0YXRlKHRoaXMpOwogICAgICAgICAgaGFzaCA9IFN0cmluZyhoYXNoKTsKICAgICAgICAgIGlmIChoYXNoID09ICcnKSB7CiAgICAgICAgICAgIHVybC5mcmFnbWVudCA9IG51bGw7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIGlmICgnIycgPT0gaGFzaC5jaGFyQXQoMCkpCiAgICAgICAgICBoYXNoID0gaGFzaC5zbGljZSgxKTsKICAgICAgICAgIHVybC5mcmFnbWVudCA9ICcnOwogICAgICAgICAgcGFyc2VVUkwodXJsLCBoYXNoLCBGUkFHTUVOVCk7CiAgICAgICAgfSkKICAgICAgfSk7CiAgICB9CiAgICByZWRlZmluZShVUkxQcm90b3R5cGUsICd0b0pTT04nLCBmdW5jdGlvbiB0b0pTT04oKSB7CiAgICAgIHJldHVybiBzZXJpYWxpemVVUkwuY2FsbCh0aGlzKTsKICAgIH0sIHsgZW51bWVyYWJsZTogdHJ1ZSB9KTsKICAgIHJlZGVmaW5lKFVSTFByb3RvdHlwZSwgJ3RvU3RyaW5nJywgZnVuY3Rpb24gdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBzZXJpYWxpemVVUkwuY2FsbCh0aGlzKTsKICAgIH0sIHsgZW51bWVyYWJsZTogdHJ1ZSB9KTsKICAgIGlmIChOYXRpdmVVUkwpIHsKICAgICAgdmFyIG5hdGl2ZUNyZWF0ZU9iamVjdFVSTCA9IE5hdGl2ZVVSTC5jcmVhdGVPYmplY3RVUkw7CiAgICAgIHZhciBuYXRpdmVSZXZva2VPYmplY3RVUkwgPSBOYXRpdmVVUkwucmV2b2tlT2JqZWN0VVJMOwogICAgICBpZiAobmF0aXZlQ3JlYXRlT2JqZWN0VVJMKQogICAgICByZWRlZmluZShVUkxDb25zdHJ1Y3RvciwgJ2NyZWF0ZU9iamVjdFVSTCcsIGZ1bmN0aW9uIGNyZWF0ZU9iamVjdFVSTChibG9iKSB7CiAgICAgICAgcmV0dXJuIG5hdGl2ZUNyZWF0ZU9iamVjdFVSTC5hcHBseShOYXRpdmVVUkwsIGFyZ3VtZW50cyk7CiAgICAgIH0pOwogICAgICBpZiAobmF0aXZlUmV2b2tlT2JqZWN0VVJMKQogICAgICByZWRlZmluZShVUkxDb25zdHJ1Y3RvciwgJ3Jldm9rZU9iamVjdFVSTCcsIGZ1bmN0aW9uIHJldm9rZU9iamVjdFVSTCh1cmwpIHsKICAgICAgICByZXR1cm4gbmF0aXZlUmV2b2tlT2JqZWN0VVJMLmFwcGx5KE5hdGl2ZVVSTCwgYXJndW1lbnRzKTsKICAgICAgfSk7CiAgICB9CiAgICBzZXRUb1N0cmluZ1RhZyhVUkxDb25zdHJ1Y3RvciwgJ1VSTCcpOwogICAgJCh7CiAgICAgIGdsb2JhbDogdHJ1ZSwKICAgICAgZm9yY2VkOiAhVVNFX05BVElWRV9VUkwsCiAgICAgIHNoYW06ICFERVNDUklQVE9SUwogICAgfSwgeyBVUkw6IFVSTENvbnN0cnVjdG9yIH0pOwoKICAgIC8qKiovfSksICgKICAvKiAxMzQgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgZmFpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEzKTsKICAgIHZhciB3ZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDU3KTsKICAgIHZhciBJU19QVVJFID0gX193X3BkZmpzX3JlcXVpcmVfXygzNik7CiAgICB2YXIgSVRFUkFUT1IgPSB3ZWxsS25vd25TeW1ib2woJ2l0ZXJhdG9yJyk7CiAgICBtb2R1bGUuZXhwb3J0cyA9ICFmYWlscyhmdW5jdGlvbiAoKSB7CiAgICAgIHZhciB1cmwgPSBuZXcgVVJMKCdiP2E9MSZiPTImYz0zJywgJ2h0dHA6Ly9hJyk7CiAgICAgIHZhciBzZWFyY2hQYXJhbXMgPSB1cmwuc2VhcmNoUGFyYW1zOwogICAgICB2YXIgcmVzdWx0ID0gJyc7CiAgICAgIHVybC5wYXRobmFtZSA9ICdjJTIwZCc7CiAgICAgIHNlYXJjaFBhcmFtcy5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7CiAgICAgICAgc2VhcmNoUGFyYW1zWydkZWxldGUnXSgnYicpOwogICAgICAgIHJlc3VsdCArPSBrZXkgKyB2YWx1ZTsKICAgICAgfSk7CiAgICAgIHJldHVybiBJU19QVVJFICYmICF1cmwudG9KU09OIHx8ICFzZWFyY2hQYXJhbXMuc29ydCB8fCB1cmwuaHJlZiAhPT0gJ2h0dHA6Ly9hL2MlMjBkP2E9MSZjPTMnIHx8IHNlYXJjaFBhcmFtcy5nZXQoJ2MnKSAhPT0gJzMnIHx8IFN0cmluZyhuZXcgVVJMU2VhcmNoUGFyYW1zKCc/YT0xJykpICE9PSAnYT0xJyB8fCAhc2VhcmNoUGFyYW1zW0lURVJBVE9SXSB8fCBuZXcgVVJMKCdodHRwczovL2FAYicpLnVzZXJuYW1lICE9PSAnYScgfHwgbmV3IFVSTFNlYXJjaFBhcmFtcyhuZXcgVVJMU2VhcmNoUGFyYW1zKCdhPWInKSkuZ2V0KCdhJykgIT09ICdiJyB8fCBuZXcgVVJMKCdodHRwOi8v0YLQtdGB0YInKS5ob3N0ICE9PSAneG4tLWUxYXliYycgfHwgbmV3IFVSTCgnaHR0cDovL2Ej0LEnKS5oYXNoICE9PSAnIyVEMCVCMScgfHwgcmVzdWx0ICE9PSAnYTFjMycgfHwgbmV3IFVSTCgnaHR0cDovL3gnLCB1bmRlZmluZWQpLmhvc3QgIT09ICd4JzsKICAgIH0pOwoKICAgIC8qKiovfSksICgKICAvKiAxMzUgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIG1heEludCA9IDIxNDc0ODM2NDc7CiAgICB2YXIgYmFzZSA9IDM2OwogICAgdmFyIHRNaW4gPSAxOwogICAgdmFyIHRNYXggPSAyNjsKICAgIHZhciBza2V3ID0gMzg7CiAgICB2YXIgZGFtcCA9IDcwMDsKICAgIHZhciBpbml0aWFsQmlhcyA9IDcyOwogICAgdmFyIGluaXRpYWxOID0gMTI4OwogICAgdmFyIGRlbGltaXRlciA9ICctJzsKICAgIHZhciByZWdleE5vbkFTQ0lJID0gL1teXDAtXHUwMDdFXS87CiAgICB2YXIgcmVnZXhTZXBhcmF0b3JzID0gL1suXHUzMDAyXHVGRjBFXHVGRjYxXS9nOwogICAgdmFyIE9WRVJGTE9XX0VSUk9SID0gJ092ZXJmbG93OiBpbnB1dCBuZWVkcyB3aWRlciBpbnRlZ2VycyB0byBwcm9jZXNzJzsKICAgIHZhciBiYXNlTWludXNUTWluID0gYmFzZSAtIHRNaW47CiAgICB2YXIgZmxvb3IgPSBNYXRoLmZsb29yOwogICAgdmFyIHN0cmluZ0Zyb21DaGFyQ29kZSA9IFN0cmluZy5mcm9tQ2hhckNvZGU7CiAgICB2YXIgdWNzMmRlY29kZSA9IGZ1bmN0aW9uIHVjczJkZWNvZGUoc3RyaW5nKSB7CiAgICAgIHZhciBvdXRwdXQgPSBbXTsKICAgICAgdmFyIGNvdW50ZXIgPSAwOwogICAgICB2YXIgbGVuZ3RoID0gc3RyaW5nLmxlbmd0aDsKICAgICAgd2hpbGUgKGNvdW50ZXIgPCBsZW5ndGgpIHsKICAgICAgICB2YXIgdmFsdWUgPSBzdHJpbmcuY2hhckNvZGVBdChjb3VudGVyKyspOwogICAgICAgIGlmICh2YWx1ZSA+PSAweEQ4MDAgJiYgdmFsdWUgPD0gMHhEQkZGICYmIGNvdW50ZXIgPCBsZW5ndGgpIHsKICAgICAgICAgIHZhciBleHRyYSA9IHN0cmluZy5jaGFyQ29kZUF0KGNvdW50ZXIrKyk7CiAgICAgICAgICBpZiAoKGV4dHJhICYgMHhGQzAwKSA9PSAweERDMDApIHsKICAgICAgICAgICAgb3V0cHV0LnB1c2goKCh2YWx1ZSAmIDB4M0ZGKSA8PCAxMCkgKyAoZXh0cmEgJiAweDNGRikgKyAweDEwMDAwKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG91dHB1dC5wdXNoKHZhbHVlKTsKICAgICAgICAgICAgY291bnRlci0tOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBvdXRwdXQucHVzaCh2YWx1ZSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBvdXRwdXQ7CiAgICB9OwogICAgdmFyIGRpZ2l0VG9CYXNpYyA9IGZ1bmN0aW9uIGRpZ2l0VG9CYXNpYyhkaWdpdCkgewogICAgICByZXR1cm4gZGlnaXQgKyAyMiArIDc1ICogKGRpZ2l0IDwgMjYpOwogICAgfTsKICAgIHZhciBhZGFwdCA9IGZ1bmN0aW9uIGFkYXB0KGRlbHRhLCBudW1Qb2ludHMsIGZpcnN0VGltZSkgewogICAgICB2YXIgayA9IDA7CiAgICAgIGRlbHRhID0gZmlyc3RUaW1lID8gZmxvb3IoZGVsdGEgLyBkYW1wKSA6IGRlbHRhID4+IDE7CiAgICAgIGRlbHRhICs9IGZsb29yKGRlbHRhIC8gbnVtUG9pbnRzKTsKICAgICAgZm9yICg7IGRlbHRhID4gYmFzZU1pbnVzVE1pbiAqIHRNYXggPj4gMTsgayArPSBiYXNlKSB7CiAgICAgICAgZGVsdGEgPSBmbG9vcihkZWx0YSAvIGJhc2VNaW51c1RNaW4pOwogICAgICB9CiAgICAgIHJldHVybiBmbG9vcihrICsgKGJhc2VNaW51c1RNaW4gKyAxKSAqIGRlbHRhIC8gKGRlbHRhICsgc2tldykpOwogICAgfTsKICAgIHZhciBlbmNvZGUgPSBmdW5jdGlvbiBlbmNvZGUoaW5wdXQpIHsKICAgICAgdmFyIG91dHB1dCA9IFtdOwogICAgICBpbnB1dCA9IHVjczJkZWNvZGUoaW5wdXQpOwogICAgICB2YXIgaW5wdXRMZW5ndGggPSBpbnB1dC5sZW5ndGg7CiAgICAgIHZhciBuID0gaW5pdGlhbE47CiAgICAgIHZhciBkZWx0YSA9IDA7CiAgICAgIHZhciBiaWFzID0gaW5pdGlhbEJpYXM7CiAgICAgIHZhciBpLCBjdXJyZW50VmFsdWU7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBpbnB1dC5sZW5ndGg7IGkrKykgewogICAgICAgIGN1cnJlbnRWYWx1ZSA9IGlucHV0W2ldOwogICAgICAgIGlmIChjdXJyZW50VmFsdWUgPCAweDgwKSB7CiAgICAgICAgICBvdXRwdXQucHVzaChzdHJpbmdGcm9tQ2hhckNvZGUoY3VycmVudFZhbHVlKSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHZhciBiYXNpY0xlbmd0aCA9IG91dHB1dC5sZW5ndGg7CiAgICAgIHZhciBoYW5kbGVkQ1BDb3VudCA9IGJhc2ljTGVuZ3RoOwogICAgICBpZiAoYmFzaWNMZW5ndGgpIHsKICAgICAgICBvdXRwdXQucHVzaChkZWxpbWl0ZXIpOwogICAgICB9CiAgICAgIHdoaWxlIChoYW5kbGVkQ1BDb3VudCA8IGlucHV0TGVuZ3RoKSB7CiAgICAgICAgdmFyIG0gPSBtYXhJbnQ7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGlucHV0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBjdXJyZW50VmFsdWUgPSBpbnB1dFtpXTsKICAgICAgICAgIGlmIChjdXJyZW50VmFsdWUgPj0gbiAmJiBjdXJyZW50VmFsdWUgPCBtKSB7CiAgICAgICAgICAgIG0gPSBjdXJyZW50VmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHZhciBoYW5kbGVkQ1BDb3VudFBsdXNPbmUgPSBoYW5kbGVkQ1BDb3VudCArIDE7CiAgICAgICAgaWYgKG0gLSBuID4gZmxvb3IoKG1heEludCAtIGRlbHRhKSAvIGhhbmRsZWRDUENvdW50UGx1c09uZSkpIHsKICAgICAgICAgIHRocm93IFJhbmdlRXJyb3IoT1ZFUkZMT1dfRVJST1IpOwogICAgICAgIH0KICAgICAgICBkZWx0YSArPSAobSAtIG4pICogaGFuZGxlZENQQ291bnRQbHVzT25lOwogICAgICAgIG4gPSBtOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBpbnB1dC5sZW5ndGg7IGkrKykgewogICAgICAgICAgY3VycmVudFZhbHVlID0gaW5wdXRbaV07CiAgICAgICAgICBpZiAoY3VycmVudFZhbHVlIDwgbiAmJiArK2RlbHRhID4gbWF4SW50KSB7CiAgICAgICAgICAgIHRocm93IFJhbmdlRXJyb3IoT1ZFUkZMT1dfRVJST1IpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGN1cnJlbnRWYWx1ZSA9PSBuKSB7CiAgICAgICAgICAgIHZhciBxID0gZGVsdGE7CiAgICAgICAgICAgIGZvciAodmFyIGsgPSBiYXNlOzsgayArPSBiYXNlKSB7CiAgICAgICAgICAgICAgdmFyIHQgPSBrIDw9IGJpYXMgPyB0TWluIDogayA+PSBiaWFzICsgdE1heCA/IHRNYXggOiBrIC0gYmlhczsKICAgICAgICAgICAgICBpZiAocSA8IHQpCiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgdmFyIHFNaW51c1QgPSBxIC0gdDsKICAgICAgICAgICAgICB2YXIgYmFzZU1pbnVzVCA9IGJhc2UgLSB0OwogICAgICAgICAgICAgIG91dHB1dC5wdXNoKHN0cmluZ0Zyb21DaGFyQ29kZShkaWdpdFRvQmFzaWModCArIHFNaW51c1QgJSBiYXNlTWludXNUKSkpOwogICAgICAgICAgICAgIHEgPSBmbG9vcihxTWludXNUIC8gYmFzZU1pbnVzVCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgb3V0cHV0LnB1c2goc3RyaW5nRnJvbUNoYXJDb2RlKGRpZ2l0VG9CYXNpYyhxKSkpOwogICAgICAgICAgICBiaWFzID0gYWRhcHQoZGVsdGEsIGhhbmRsZWRDUENvdW50UGx1c09uZSwgaGFuZGxlZENQQ291bnQgPT0gYmFzaWNMZW5ndGgpOwogICAgICAgICAgICBkZWx0YSA9IDA7CiAgICAgICAgICAgICsraGFuZGxlZENQQ291bnQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICsrZGVsdGE7CiAgICAgICAgKytuOwogICAgICB9CiAgICAgIHJldHVybiBvdXRwdXQuam9pbignJyk7CiAgICB9OwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaW5wdXQpIHsKICAgICAgdmFyIGVuY29kZWQgPSBbXTsKICAgICAgdmFyIGxhYmVscyA9IGlucHV0LnRvTG93ZXJDYXNlKCkucmVwbGFjZShyZWdleFNlcGFyYXRvcnMsICIuIikuc3BsaXQoJy4nKTsKICAgICAgdmFyIGksIGxhYmVsOwogICAgICBmb3IgKGkgPSAwOyBpIDwgbGFiZWxzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGFiZWwgPSBsYWJlbHNbaV07CiAgICAgICAgZW5jb2RlZC5wdXNoKHJlZ2V4Tm9uQVNDSUkudGVzdChsYWJlbCkgPyAneG4tLScgKyBlbmNvZGUobGFiZWwpIDogbGFiZWwpOwogICAgICB9CiAgICAgIHJldHVybiBlbmNvZGVkLmpvaW4oJy4nKTsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDEzNiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDExMyk7CiAgICB2YXIgJCA9IF9fd19wZGZqc19yZXF1aXJlX18oOSk7CiAgICB2YXIgZ2V0QnVpbHRJbiA9IF9fd19wZGZqc19yZXF1aXJlX18oNDEpOwogICAgdmFyIFVTRV9OQVRJVkVfVVJMID0gX193X3BkZmpzX3JlcXVpcmVfXygxMzQpOwogICAgdmFyIHJlZGVmaW5lID0gX193X3BkZmpzX3JlcXVpcmVfXygyOCk7CiAgICB2YXIgcmVkZWZpbmVBbGwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDExNik7CiAgICB2YXIgc2V0VG9TdHJpbmdUYWcgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDg1KTsKICAgIHZhciBjcmVhdGVJdGVyYXRvckNvbnN0cnVjdG9yID0gX193X3BkZmpzX3JlcXVpcmVfXyg4MCk7CiAgICB2YXIgSW50ZXJuYWxTdGF0ZU1vZHVsZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMzIpOwogICAgdmFyIGFuSW5zdGFuY2UgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDExOCk7CiAgICB2YXIgaGFzT3duID0gX193X3BkZmpzX3JlcXVpcmVfXygyMik7CiAgICB2YXIgYmluZCA9IF9fd19wZGZqc19yZXF1aXJlX18oNjIpOwogICAgdmFyIGNsYXNzb2YgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDk1KTsKICAgIHZhciBhbk9iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oMjcpOwogICAgdmFyIGlzT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygyMSk7CiAgICB2YXIgY3JlYXRlID0gX193X3BkZmpzX3JlcXVpcmVfXyg3MSk7CiAgICB2YXIgY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yID0gX193X3BkZmpzX3JlcXVpcmVfXygxNSk7CiAgICB2YXIgZ2V0SXRlcmF0b3IgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEzNyk7CiAgICB2YXIgZ2V0SXRlcmF0b3JNZXRob2QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDk0KTsKICAgIHZhciB3ZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDU3KTsKICAgIHZhciAkZmV0Y2ggPSBnZXRCdWlsdEluKCdmZXRjaCcpOwogICAgdmFyIEhlYWRlcnMgPSBnZXRCdWlsdEluKCdIZWFkZXJzJyk7CiAgICB2YXIgSVRFUkFUT1IgPSB3ZWxsS25vd25TeW1ib2woJ2l0ZXJhdG9yJyk7CiAgICB2YXIgVVJMX1NFQVJDSF9QQVJBTVMgPSAnVVJMU2VhcmNoUGFyYW1zJzsKICAgIHZhciBVUkxfU0VBUkNIX1BBUkFNU19JVEVSQVRPUiA9IFVSTF9TRUFSQ0hfUEFSQU1TICsgJ0l0ZXJhdG9yJzsKICAgIHZhciBzZXRJbnRlcm5hbFN0YXRlID0gSW50ZXJuYWxTdGF0ZU1vZHVsZS5zZXQ7CiAgICB2YXIgZ2V0SW50ZXJuYWxQYXJhbXNTdGF0ZSA9IEludGVybmFsU3RhdGVNb2R1bGUuZ2V0dGVyRm9yKFVSTF9TRUFSQ0hfUEFSQU1TKTsKICAgIHZhciBnZXRJbnRlcm5hbEl0ZXJhdG9yU3RhdGUgPSBJbnRlcm5hbFN0YXRlTW9kdWxlLmdldHRlckZvcihVUkxfU0VBUkNIX1BBUkFNU19JVEVSQVRPUik7CiAgICB2YXIgcGx1cyA9IC9cKy9nOwogICAgdmFyIHNlcXVlbmNlcyA9IEFycmF5KDQpOwogICAgdmFyIHBlcmNlbnRTZXF1ZW5jZSA9IGZ1bmN0aW9uIHBlcmNlbnRTZXF1ZW5jZShieXRlcykgewogICAgICByZXR1cm4gc2VxdWVuY2VzW2J5dGVzIC0gMV0gfHwgKHNlcXVlbmNlc1tieXRlcyAtIDFdID0gUmVnRXhwKCcoKD86JVtcXGRhLWZdezJ9KXsnICsgYnl0ZXMgKyAnfSknLCAnZ2knKSk7CiAgICB9OwogICAgdmFyIHBlcmNlbnREZWNvZGUgPSBmdW5jdGlvbiBwZXJjZW50RGVjb2RlKHNlcXVlbmNlKSB7CiAgICAgIHRyeSB7CiAgICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChzZXF1ZW5jZSk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgcmV0dXJuIHNlcXVlbmNlOwogICAgICB9CiAgICB9OwogICAgdmFyIGRlc2VyaWFsaXplID0gZnVuY3Rpb24gZGVzZXJpYWxpemUoaXQpIHsKICAgICAgdmFyIHJlc3VsdCA9IGl0LnJlcGxhY2UocGx1cywgJyAnKTsKICAgICAgdmFyIGJ5dGVzID0gNDsKICAgICAgdHJ5IHsKICAgICAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHJlc3VsdCk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgd2hpbGUgKGJ5dGVzKSB7CiAgICAgICAgICByZXN1bHQgPSByZXN1bHQucmVwbGFjZShwZXJjZW50U2VxdWVuY2UoYnl0ZXMtLSksIHBlcmNlbnREZWNvZGUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9CiAgICB9OwogICAgdmFyIGZpbmQgPSAvWyEnKCl+XXwlMjAvZzsKICAgIHZhciByZXBsYWNlID0gewogICAgICAnISc6ICclMjEnLAogICAgICAiJyI6ICclMjcnLAogICAgICAnKCc6ICclMjgnLAogICAgICAnKSc6ICclMjknLAogICAgICAnfic6ICclN0UnLAogICAgICAnJTIwJzogJysnCiAgICB9OwogICAgdmFyIHJlcGxhY2VyID0gZnVuY3Rpb24gcmVwbGFjZXIobWF0Y2gpIHsKICAgICAgcmV0dXJuIHJlcGxhY2VbbWF0Y2hdOwogICAgfTsKICAgIHZhciBzZXJpYWxpemUgPSBmdW5jdGlvbiBzZXJpYWxpemUoaXQpIHsKICAgICAgcmV0dXJuIGVuY29kZVVSSUNvbXBvbmVudChpdCkucmVwbGFjZShmaW5kLCByZXBsYWNlcik7CiAgICB9OwogICAgdmFyIHBhcnNlU2VhcmNoUGFyYW1zID0gZnVuY3Rpb24gcGFyc2VTZWFyY2hQYXJhbXMocmVzdWx0LCBxdWVyeSkgewogICAgICBpZiAocXVlcnkpIHsKICAgICAgICB2YXIgYXR0cmlidXRlcyA9IHF1ZXJ5LnNwbGl0KCcmJyk7CiAgICAgICAgdmFyIGluZGV4ID0gMDsKICAgICAgICB2YXIgYXR0cmlidXRlLCBlbnRyeTsKICAgICAgICB3aGlsZSAoaW5kZXggPCBhdHRyaWJ1dGVzLmxlbmd0aCkgewogICAgICAgICAgYXR0cmlidXRlID0gYXR0cmlidXRlc1tpbmRleCsrXTsKICAgICAgICAgIGlmIChhdHRyaWJ1dGUubGVuZ3RoKSB7CiAgICAgICAgICAgIGVudHJ5ID0gYXR0cmlidXRlLnNwbGl0KCc9Jyk7CiAgICAgICAgICAgIHJlc3VsdC5wdXNoKHsKICAgICAgICAgICAgICBrZXk6IGRlc2VyaWFsaXplKGVudHJ5LnNoaWZ0KCkpLAogICAgICAgICAgICAgIHZhbHVlOiBkZXNlcmlhbGl6ZShlbnRyeS5qb2luKCc9JykpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfTsKICAgIHZhciB1cGRhdGVTZWFyY2hQYXJhbXMgPSBmdW5jdGlvbiB1cGRhdGVTZWFyY2hQYXJhbXMocXVlcnkpIHsKICAgICAgdGhpcy5lbnRyaWVzLmxlbmd0aCA9IDA7CiAgICAgIHBhcnNlU2VhcmNoUGFyYW1zKHRoaXMuZW50cmllcywgcXVlcnkpOwogICAgfTsKICAgIHZhciB2YWxpZGF0ZUFyZ3VtZW50c0xlbmd0aCA9IGZ1bmN0aW9uIHZhbGlkYXRlQXJndW1lbnRzTGVuZ3RoKHBhc3NlZCwgcmVxdWlyZWQpIHsKICAgICAgaWYgKHBhc3NlZCA8IHJlcXVpcmVkKQogICAgICB0aHJvdyBUeXBlRXJyb3IoJ05vdCBlbm91Z2ggYXJndW1lbnRzJyk7CiAgICB9OwogICAgdmFyIFVSTFNlYXJjaFBhcmFtc0l0ZXJhdG9yID0gY3JlYXRlSXRlcmF0b3JDb25zdHJ1Y3RvcihmdW5jdGlvbiBJdGVyYXRvcihwYXJhbXMsIGtpbmQpIHsKICAgICAgc2V0SW50ZXJuYWxTdGF0ZSh0aGlzLCB7CiAgICAgICAgdHlwZTogVVJMX1NFQVJDSF9QQVJBTVNfSVRFUkFUT1IsCiAgICAgICAgaXRlcmF0b3I6IGdldEl0ZXJhdG9yKGdldEludGVybmFsUGFyYW1zU3RhdGUocGFyYW1zKS5lbnRyaWVzKSwKICAgICAgICBraW5kOiBraW5kCiAgICAgIH0pOwogICAgfSwgJ0l0ZXJhdG9yJywgZnVuY3Rpb24gbmV4dCgpIHsKICAgICAgdmFyIHN0YXRlID0gZ2V0SW50ZXJuYWxJdGVyYXRvclN0YXRlKHRoaXMpOwogICAgICB2YXIga2luZCA9IHN0YXRlLmtpbmQ7CiAgICAgIHZhciBzdGVwID0gc3RhdGUuaXRlcmF0b3IubmV4dCgpOwogICAgICB2YXIgZW50cnkgPSBzdGVwLnZhbHVlOwogICAgICBpZiAoIXN0ZXAuZG9uZSkgewogICAgICAgIHN0ZXAudmFsdWUgPSBraW5kID09PSAna2V5cycgPyBlbnRyeS5rZXkgOiBraW5kID09PSAndmFsdWVzJyA/IGVudHJ5LnZhbHVlIDogWwogICAgICAgIGVudHJ5LmtleSwKICAgICAgICBlbnRyeS52YWx1ZV07CgogICAgICB9CiAgICAgIHJldHVybiBzdGVwOwogICAgfSk7CiAgICB2YXIgVVJMU2VhcmNoUGFyYW1zQ29uc3RydWN0b3IgPSBmdW5jdGlvbiBVUkxTZWFyY2hQYXJhbXMoKSB7CiAgICAgIGFuSW5zdGFuY2UodGhpcywgVVJMU2VhcmNoUGFyYW1zQ29uc3RydWN0b3IsIFVSTF9TRUFSQ0hfUEFSQU1TKTsKICAgICAgdmFyIGluaXQgPSBhcmd1bWVudHMubGVuZ3RoID4gMCA/IGFyZ3VtZW50c1swXSA6IHVuZGVmaW5lZDsKICAgICAgdmFyIHRoYXQgPSB0aGlzOwogICAgICB2YXIgZW50cmllcyA9IFtdOwogICAgICB2YXIgaXRlcmF0b3JNZXRob2QsIGl0ZXJhdG9yLCBuZXh0LCBzdGVwLCBlbnRyeUl0ZXJhdG9yLCBlbnRyeU5leHQsIGZpcnN0LCBzZWNvbmQsIGtleTsKICAgICAgc2V0SW50ZXJuYWxTdGF0ZSh0aGF0LCB7CiAgICAgICAgdHlwZTogVVJMX1NFQVJDSF9QQVJBTVMsCiAgICAgICAgZW50cmllczogZW50cmllcywKICAgICAgICB1cGRhdGVVUkw6IGZ1bmN0aW9uIHVwZGF0ZVVSTCgpIHsKICAgICAgICB9LAogICAgICAgIHVwZGF0ZVNlYXJjaFBhcmFtczogdXBkYXRlU2VhcmNoUGFyYW1zCiAgICAgIH0pOwogICAgICBpZiAoaW5pdCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgaWYgKGlzT2JqZWN0KGluaXQpKSB7CiAgICAgICAgICBpdGVyYXRvck1ldGhvZCA9IGdldEl0ZXJhdG9yTWV0aG9kKGluaXQpOwogICAgICAgICAgaWYgKHR5cGVvZiBpdGVyYXRvck1ldGhvZCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICBpdGVyYXRvciA9IGl0ZXJhdG9yTWV0aG9kLmNhbGwoaW5pdCk7CiAgICAgICAgICAgIG5leHQgPSBpdGVyYXRvci5uZXh0OwogICAgICAgICAgICB3aGlsZSAoIShzdGVwID0gbmV4dC5jYWxsKGl0ZXJhdG9yKSkuZG9uZSkgewogICAgICAgICAgICAgIGVudHJ5SXRlcmF0b3IgPSBnZXRJdGVyYXRvcihhbk9iamVjdChzdGVwLnZhbHVlKSk7CiAgICAgICAgICAgICAgZW50cnlOZXh0ID0gZW50cnlJdGVyYXRvci5uZXh0OwogICAgICAgICAgICAgIGlmICgoZmlyc3QgPSBlbnRyeU5leHQuY2FsbChlbnRyeUl0ZXJhdG9yKSkuZG9uZSB8fCAoc2Vjb25kID0gZW50cnlOZXh0LmNhbGwoZW50cnlJdGVyYXRvcikpLmRvbmUgfHwgIWVudHJ5TmV4dC5jYWxsKGVudHJ5SXRlcmF0b3IpLmRvbmUpCiAgICAgICAgICAgICAgdGhyb3cgVHlwZUVycm9yKCdFeHBlY3RlZCBzZXF1ZW5jZSB3aXRoIGxlbmd0aCAyJyk7CiAgICAgICAgICAgICAgZW50cmllcy5wdXNoKHsKICAgICAgICAgICAgICAgIGtleTogZmlyc3QudmFsdWUgKyAnJywKICAgICAgICAgICAgICAgIHZhbHVlOiBzZWNvbmQudmFsdWUgKyAnJwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UKICAgICAgICAgIGZvciAoa2V5IGluIGluaXQpCiAgICAgICAgICBpZiAoaGFzT3duKGluaXQsIGtleSkpCiAgICAgICAgICBlbnRyaWVzLnB1c2goewogICAgICAgICAgICBrZXk6IGtleSwKICAgICAgICAgICAgdmFsdWU6IGluaXRba2V5XSArICcnCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcGFyc2VTZWFyY2hQYXJhbXMoZW50cmllcywgdHlwZW9mIGluaXQgPT09ICdzdHJpbmcnID8gaW5pdC5jaGFyQXQoMCkgPT09ICc/JyA/IGluaXQuc2xpY2UoMSkgOiBpbml0IDogaW5pdCArICcnKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgICB2YXIgVVJMU2VhcmNoUGFyYW1zUHJvdG90eXBlID0gVVJMU2VhcmNoUGFyYW1zQ29uc3RydWN0b3IucHJvdG90eXBlOwogICAgcmVkZWZpbmVBbGwoVVJMU2VhcmNoUGFyYW1zUHJvdG90eXBlLCB7CiAgICAgIGFwcGVuZDogZnVuY3Rpb24gYXBwZW5kKG5hbWUsIHZhbHVlKSB7CiAgICAgICAgdmFsaWRhdGVBcmd1bWVudHNMZW5ndGgoYXJndW1lbnRzLmxlbmd0aCwgMik7CiAgICAgICAgdmFyIHN0YXRlID0gZ2V0SW50ZXJuYWxQYXJhbXNTdGF0ZSh0aGlzKTsKICAgICAgICBzdGF0ZS5lbnRyaWVzLnB1c2goewogICAgICAgICAga2V5OiBuYW1lICsgJycsCiAgICAgICAgICB2YWx1ZTogdmFsdWUgKyAnJwogICAgICAgIH0pOwogICAgICAgIHN0YXRlLnVwZGF0ZVVSTCgpOwogICAgICB9LAogICAgICAnZGVsZXRlJzogZnVuY3Rpb24gX2RlbGV0ZShuYW1lKSB7CiAgICAgICAgdmFsaWRhdGVBcmd1bWVudHNMZW5ndGgoYXJndW1lbnRzLmxlbmd0aCwgMSk7CiAgICAgICAgdmFyIHN0YXRlID0gZ2V0SW50ZXJuYWxQYXJhbXNTdGF0ZSh0aGlzKTsKICAgICAgICB2YXIgZW50cmllcyA9IHN0YXRlLmVudHJpZXM7CiAgICAgICAgdmFyIGtleSA9IG5hbWUgKyAnJzsKICAgICAgICB2YXIgaW5kZXggPSAwOwogICAgICAgIHdoaWxlIChpbmRleCA8IGVudHJpZXMubGVuZ3RoKSB7CiAgICAgICAgICBpZiAoZW50cmllc1tpbmRleF0ua2V5ID09PSBrZXkpCiAgICAgICAgICBlbnRyaWVzLnNwbGljZShpbmRleCwgMSk7ZWxzZQoKICAgICAgICAgIGluZGV4Kys7CiAgICAgICAgfQogICAgICAgIHN0YXRlLnVwZGF0ZVVSTCgpOwogICAgICB9LAogICAgICBnZXQ6IGZ1bmN0aW9uIGdldChuYW1lKSB7CiAgICAgICAgdmFsaWRhdGVBcmd1bWVudHNMZW5ndGgoYXJndW1lbnRzLmxlbmd0aCwgMSk7CiAgICAgICAgdmFyIGVudHJpZXMgPSBnZXRJbnRlcm5hbFBhcmFtc1N0YXRlKHRoaXMpLmVudHJpZXM7CiAgICAgICAgdmFyIGtleSA9IG5hbWUgKyAnJzsKICAgICAgICB2YXIgaW5kZXggPSAwOwogICAgICAgIGZvciAoOyBpbmRleCA8IGVudHJpZXMubGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICBpZiAoZW50cmllc1tpbmRleF0ua2V5ID09PSBrZXkpCiAgICAgICAgICByZXR1cm4gZW50cmllc1tpbmRleF0udmFsdWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgICB9LAogICAgICBnZXRBbGw6IGZ1bmN0aW9uIGdldEFsbChuYW1lKSB7CiAgICAgICAgdmFsaWRhdGVBcmd1bWVudHNMZW5ndGgoYXJndW1lbnRzLmxlbmd0aCwgMSk7CiAgICAgICAgdmFyIGVudHJpZXMgPSBnZXRJbnRlcm5hbFBhcmFtc1N0YXRlKHRoaXMpLmVudHJpZXM7CiAgICAgICAgdmFyIGtleSA9IG5hbWUgKyAnJzsKICAgICAgICB2YXIgcmVzdWx0ID0gW107CiAgICAgICAgdmFyIGluZGV4ID0gMDsKICAgICAgICBmb3IgKDsgaW5kZXggPCBlbnRyaWVzLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgaWYgKGVudHJpZXNbaW5kZXhdLmtleSA9PT0ga2V5KQogICAgICAgICAgcmVzdWx0LnB1c2goZW50cmllc1tpbmRleF0udmFsdWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9LAogICAgICBoYXM6IGZ1bmN0aW9uIGhhcyhuYW1lKSB7CiAgICAgICAgdmFsaWRhdGVBcmd1bWVudHNMZW5ndGgoYXJndW1lbnRzLmxlbmd0aCwgMSk7CiAgICAgICAgdmFyIGVudHJpZXMgPSBnZXRJbnRlcm5hbFBhcmFtc1N0YXRlKHRoaXMpLmVudHJpZXM7CiAgICAgICAgdmFyIGtleSA9IG5hbWUgKyAnJzsKICAgICAgICB2YXIgaW5kZXggPSAwOwogICAgICAgIHdoaWxlIChpbmRleCA8IGVudHJpZXMubGVuZ3RoKSB7CiAgICAgICAgICBpZiAoZW50cmllc1tpbmRleCsrXS5rZXkgPT09IGtleSkKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0sCiAgICAgIHNldDogZnVuY3Rpb24gc2V0KG5hbWUsIHZhbHVlKSB7CiAgICAgICAgdmFsaWRhdGVBcmd1bWVudHNMZW5ndGgoYXJndW1lbnRzLmxlbmd0aCwgMSk7CiAgICAgICAgdmFyIHN0YXRlID0gZ2V0SW50ZXJuYWxQYXJhbXNTdGF0ZSh0aGlzKTsKICAgICAgICB2YXIgZW50cmllcyA9IHN0YXRlLmVudHJpZXM7CiAgICAgICAgdmFyIGZvdW5kID0gZmFsc2U7CiAgICAgICAgdmFyIGtleSA9IG5hbWUgKyAnJzsKICAgICAgICB2YXIgdmFsID0gdmFsdWUgKyAnJzsKICAgICAgICB2YXIgaW5kZXggPSAwOwogICAgICAgIHZhciBlbnRyeTsKICAgICAgICBmb3IgKDsgaW5kZXggPCBlbnRyaWVzLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgZW50cnkgPSBlbnRyaWVzW2luZGV4XTsKICAgICAgICAgIGlmIChlbnRyeS5rZXkgPT09IGtleSkgewogICAgICAgICAgICBpZiAoZm91bmQpCiAgICAgICAgICAgIGVudHJpZXMuc3BsaWNlKGluZGV4LS0sIDEpO2Vsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICBlbnRyeS52YWx1ZSA9IHZhbDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIWZvdW5kKQogICAgICAgIGVudHJpZXMucHVzaCh7CiAgICAgICAgICBrZXk6IGtleSwKICAgICAgICAgIHZhbHVlOiB2YWwKICAgICAgICB9KTsKICAgICAgICBzdGF0ZS51cGRhdGVVUkwoKTsKICAgICAgfSwKICAgICAgc29ydDogZnVuY3Rpb24gc29ydCgpIHsKICAgICAgICB2YXIgc3RhdGUgPSBnZXRJbnRlcm5hbFBhcmFtc1N0YXRlKHRoaXMpOwogICAgICAgIHZhciBlbnRyaWVzID0gc3RhdGUuZW50cmllczsKICAgICAgICB2YXIgc2xpY2UgPSBlbnRyaWVzLnNsaWNlKCk7CiAgICAgICAgdmFyIGVudHJ5LCBlbnRyaWVzSW5kZXgsIHNsaWNlSW5kZXg7CiAgICAgICAgZW50cmllcy5sZW5ndGggPSAwOwogICAgICAgIGZvciAoc2xpY2VJbmRleCA9IDA7IHNsaWNlSW5kZXggPCBzbGljZS5sZW5ndGg7IHNsaWNlSW5kZXgrKykgewogICAgICAgICAgZW50cnkgPSBzbGljZVtzbGljZUluZGV4XTsKICAgICAgICAgIGZvciAoZW50cmllc0luZGV4ID0gMDsgZW50cmllc0luZGV4IDwgc2xpY2VJbmRleDsgZW50cmllc0luZGV4KyspIHsKICAgICAgICAgICAgaWYgKGVudHJpZXNbZW50cmllc0luZGV4XS5rZXkgPiBlbnRyeS5rZXkpIHsKICAgICAgICAgICAgICBlbnRyaWVzLnNwbGljZShlbnRyaWVzSW5kZXgsIDAsIGVudHJ5KTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKGVudHJpZXNJbmRleCA9PT0gc2xpY2VJbmRleCkKICAgICAgICAgIGVudHJpZXMucHVzaChlbnRyeSk7CiAgICAgICAgfQogICAgICAgIHN0YXRlLnVwZGF0ZVVSTCgpOwogICAgICB9LAogICAgICBmb3JFYWNoOiBmdW5jdGlvbiBmb3JFYWNoKGNhbGxiYWNrKSB7CiAgICAgICAgdmFyIGVudHJpZXMgPSBnZXRJbnRlcm5hbFBhcmFtc1N0YXRlKHRoaXMpLmVudHJpZXM7CiAgICAgICAgdmFyIGJvdW5kRnVuY3Rpb24gPSBiaW5kKGNhbGxiYWNrLCBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZCwgMyk7CiAgICAgICAgdmFyIGluZGV4ID0gMDsKICAgICAgICB2YXIgZW50cnk7CiAgICAgICAgd2hpbGUgKGluZGV4IDwgZW50cmllcy5sZW5ndGgpIHsKICAgICAgICAgIGVudHJ5ID0gZW50cmllc1tpbmRleCsrXTsKICAgICAgICAgIGJvdW5kRnVuY3Rpb24oZW50cnkudmFsdWUsIGVudHJ5LmtleSwgdGhpcyk7CiAgICAgICAgfQogICAgICB9LAogICAgICBrZXlzOiBmdW5jdGlvbiBrZXlzKCkgewogICAgICAgIHJldHVybiBuZXcgVVJMU2VhcmNoUGFyYW1zSXRlcmF0b3IodGhpcywgJ2tleXMnKTsKICAgICAgfSwKICAgICAgdmFsdWVzOiBmdW5jdGlvbiB2YWx1ZXMoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBVUkxTZWFyY2hQYXJhbXNJdGVyYXRvcih0aGlzLCAndmFsdWVzJyk7CiAgICAgIH0sCiAgICAgIGVudHJpZXM6IGZ1bmN0aW9uIGVudHJpZXMoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBVUkxTZWFyY2hQYXJhbXNJdGVyYXRvcih0aGlzLCAnZW50cmllcycpOwogICAgICB9CiAgICB9LCB7IGVudW1lcmFibGU6IHRydWUgfSk7CiAgICByZWRlZmluZShVUkxTZWFyY2hQYXJhbXNQcm90b3R5cGUsIElURVJBVE9SLCBVUkxTZWFyY2hQYXJhbXNQcm90b3R5cGUuZW50cmllcyk7CiAgICByZWRlZmluZShVUkxTZWFyY2hQYXJhbXNQcm90b3R5cGUsICd0b1N0cmluZycsIGZ1bmN0aW9uIHRvU3RyaW5nKCkgewogICAgICB2YXIgZW50cmllcyA9IGdldEludGVybmFsUGFyYW1zU3RhdGUodGhpcykuZW50cmllczsKICAgICAgdmFyIHJlc3VsdCA9IFtdOwogICAgICB2YXIgaW5kZXggPSAwOwogICAgICB2YXIgZW50cnk7CiAgICAgIHdoaWxlIChpbmRleCA8IGVudHJpZXMubGVuZ3RoKSB7CiAgICAgICAgZW50cnkgPSBlbnRyaWVzW2luZGV4KytdOwogICAgICAgIHJlc3VsdC5wdXNoKHNlcmlhbGl6ZShlbnRyeS5rZXkpICsgJz0nICsgc2VyaWFsaXplKGVudHJ5LnZhbHVlKSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHJlc3VsdC5qb2luKCcmJyk7CiAgICB9LCB7IGVudW1lcmFibGU6IHRydWUgfSk7CiAgICBzZXRUb1N0cmluZ1RhZyhVUkxTZWFyY2hQYXJhbXNDb25zdHJ1Y3RvciwgVVJMX1NFQVJDSF9QQVJBTVMpOwogICAgJCh7CiAgICAgIGdsb2JhbDogdHJ1ZSwKICAgICAgZm9yY2VkOiAhVVNFX05BVElWRV9VUkwKICAgIH0sIHsgVVJMU2VhcmNoUGFyYW1zOiBVUkxTZWFyY2hQYXJhbXNDb25zdHJ1Y3RvciB9KTsKICAgIGlmICghVVNFX05BVElWRV9VUkwgJiYgdHlwZW9mICRmZXRjaCA9PSAnZnVuY3Rpb24nICYmIHR5cGVvZiBIZWFkZXJzID09ICdmdW5jdGlvbicpIHsKICAgICAgJCh7CiAgICAgICAgZ2xvYmFsOiB0cnVlLAogICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgZm9yY2VkOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBmZXRjaDogZnVuY3Rpb24gZmV0Y2goaW5wdXQpIHsKICAgICAgICAgIHZhciBhcmdzID0gW2lucHV0XTsKICAgICAgICAgIHZhciBpbml0LCBib2R5LCBoZWFkZXJzOwogICAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgIGluaXQgPSBhcmd1bWVudHNbMV07CiAgICAgICAgICAgIGlmIChpc09iamVjdChpbml0KSkgewogICAgICAgICAgICAgIGJvZHkgPSBpbml0LmJvZHk7CiAgICAgICAgICAgICAgaWYgKGNsYXNzb2YoYm9keSkgPT09IFVSTF9TRUFSQ0hfUEFSQU1TKSB7CiAgICAgICAgICAgICAgICBoZWFkZXJzID0gaW5pdC5oZWFkZXJzID8gbmV3IEhlYWRlcnMoaW5pdC5oZWFkZXJzKSA6IG5ldyBIZWFkZXJzKCk7CiAgICAgICAgICAgICAgICBpZiAoIWhlYWRlcnMuaGFzKCdjb250ZW50LXR5cGUnKSkgewogICAgICAgICAgICAgICAgICBoZWFkZXJzLnNldCgnY29udGVudC10eXBlJywgJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZDtjaGFyc2V0PVVURi04Jyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpbml0ID0gY3JlYXRlKGluaXQsIHsKICAgICAgICAgICAgICAgICAgYm9keTogY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yKDAsIFN0cmluZyhib2R5KSksCiAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IGNyZWF0ZVByb3BlcnR5RGVzY3JpcHRvcigwLCBoZWFkZXJzKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGFyZ3MucHVzaChpbml0KTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiAkZmV0Y2guYXBwbHkodGhpcywgYXJncyk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIG1vZHVsZS5leHBvcnRzID0gewogICAgICBVUkxTZWFyY2hQYXJhbXM6IFVSTFNlYXJjaFBhcmFtc0NvbnN0cnVjdG9yLAogICAgICBnZXRTdGF0ZTogZ2V0SW50ZXJuYWxQYXJhbXNTdGF0ZQogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogMTM3ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGFuT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygyNyk7CiAgICB2YXIgZ2V0SXRlcmF0b3JNZXRob2QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDk0KTsKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7CiAgICAgIHZhciBpdGVyYXRvck1ldGhvZCA9IGdldEl0ZXJhdG9yTWV0aG9kKGl0KTsKICAgICAgaWYgKHR5cGVvZiBpdGVyYXRvck1ldGhvZCAhPSAnZnVuY3Rpb24nKSB7CiAgICAgICAgdGhyb3cgVHlwZUVycm9yKFN0cmluZyhpdCkgKyAnIGlzIG5vdCBpdGVyYWJsZScpOwogICAgICB9CiAgICAgIHJldHVybiBhbk9iamVjdChpdGVyYXRvck1ldGhvZC5jYWxsKGl0KSk7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAxMzggKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyICQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDkpOwogICAgJCh7CiAgICAgIHRhcmdldDogJ1VSTCcsCiAgICAgIHByb3RvOiB0cnVlLAogICAgICBlbnVtZXJhYmxlOiB0cnVlCiAgICB9LCB7CiAgICAgIHRvSlNPTjogZnVuY3Rpb24gdG9KU09OKCkgewogICAgICAgIHJldHVybiBVUkwucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodGhpcyk7CiAgICAgIH0KICAgIH0pOwoKICAgIC8qKiovfSksICgKICAvKiAxMzkgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAoZnVuY3Rpb24gKGdsb2JhbCwgZmFjdG9yeSkgewogICAgICB0cnVlID8gZmFjdG9yeShleHBvcnRzKSA6IHVuZGVmaW5lZDsKICAgIH0pKHRoaXMsIGZ1bmN0aW9uIChleHBvcnRzKSB7CiAgICAgICd1c2Ugc3RyaWN0JzsKICAgICAgdmFyIFN5bWJvbFBvbHlmaWxsID0gdHlwZW9mIFN5bWJvbCA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAnc3ltYm9sJyA/IFN5bWJvbCA6IGZ1bmN0aW9uIChkZXNjcmlwdGlvbikgewogICAgICAgIHJldHVybiAiU3ltYm9sKCIgKyBkZXNjcmlwdGlvbiArICIpIjsKICAgICAgfTsKICAgICAgZnVuY3Rpb24gbm9vcCgpIHsKICAgICAgfQogICAgICB2YXIgTnVtYmVySXNOYU4gPSBOdW1iZXIuaXNOYU4gfHwgZnVuY3Rpb24gKHgpIHsKICAgICAgICByZXR1cm4geCAhPT0geDsKICAgICAgfTsKICAgICAgdmFyIHJldGhyb3dBc3NlcnRpb25FcnJvclJlamVjdGlvbiA9IG5vb3A7CiAgICAgIGZ1bmN0aW9uIHR5cGVJc09iamVjdCh4KSB7CiAgICAgICAgcmV0dXJuIHR5cGVvZiB4ID09PSAnb2JqZWN0JyAmJiB4ICE9PSBudWxsIHx8IHR5cGVvZiB4ID09PSAnZnVuY3Rpb24nOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGNyZWF0ZUFycmF5RnJvbUxpc3QoZWxlbWVudHMpIHsKICAgICAgICByZXR1cm4gZWxlbWVudHMuc2xpY2UoKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBBcnJheUJ1ZmZlckNvcHkoZGVzdCwgZGVzdE9mZnNldCwgc3JjLCBzcmNPZmZzZXQsIG4pIHsKICAgICAgICBuZXcgVWludDhBcnJheShkZXN0KS5zZXQobmV3IFVpbnQ4QXJyYXkoc3JjLCBzcmNPZmZzZXQsIG4pLCBkZXN0T2Zmc2V0KTsKICAgICAgfQogICAgICBmdW5jdGlvbiBJc0Zpbml0ZU5vbk5lZ2F0aXZlTnVtYmVyKHYpIHsKICAgICAgICBpZiAoSXNOb25OZWdhdGl2ZU51bWJlcih2KSA9PT0gZmFsc2UpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKHYgPT09IEluZmluaXR5KSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIElzTm9uTmVnYXRpdmVOdW1iZXIodikgewogICAgICAgIGlmICh0eXBlb2YgdiAhPT0gJ251bWJlcicpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKE51bWJlcklzTmFOKHYpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmICh2IDwgMCkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBmdW5jdGlvbiBDYWxsKEYsIFYsIGFyZ3MpIHsKICAgICAgICBpZiAodHlwZW9mIEYgIT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0FyZ3VtZW50IGlzIG5vdCBhIGZ1bmN0aW9uJyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBGdW5jdGlvbi5wcm90b3R5cGUuYXBwbHkuY2FsbChGLCBWLCBhcmdzKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBDcmVhdGVBbGdvcml0aG1Gcm9tVW5kZXJseWluZ01ldGhvZCh1bmRlcmx5aW5nT2JqZWN0LCBtZXRob2ROYW1lLCBhbGdvQXJnQ291bnQsIGV4dHJhQXJncykgewogICAgICAgIHZhciBtZXRob2QgPSB1bmRlcmx5aW5nT2JqZWN0W21ldGhvZE5hbWVdOwogICAgICAgIGlmIChtZXRob2QgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgaWYgKHR5cGVvZiBtZXRob2QgIT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihtZXRob2QgKyAiIGlzIG5vdCBhIG1ldGhvZCIpOwogICAgICAgICAgfQogICAgICAgICAgc3dpdGNoIChhbGdvQXJnQ291bnQpIHsKICAgICAgICAgICAgY2FzZSAwOnsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlQ2FsbChtZXRob2QsIHVuZGVybHlpbmdPYmplY3QsIGV4dHJhQXJncyk7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAxOnsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoYXJnKSB7CiAgICAgICAgICAgICAgICAgIHZhciBmdWxsQXJncyA9IFthcmddLmNvbmNhdChleHRyYUFyZ3MpOwogICAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZUNhbGwobWV0aG9kLCB1bmRlcmx5aW5nT2JqZWN0LCBmdWxsQXJncyk7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBwcm9taXNlUmVzb2x2ZWRXaXRoKHVuZGVmaW5lZCk7CiAgICAgICAgfTsKICAgICAgfQogICAgICBmdW5jdGlvbiBJbnZva2VPck5vb3AoTywgUCwgYXJncykgewogICAgICAgIHZhciBtZXRob2QgPSBPW1BdOwogICAgICAgIGlmIChtZXRob2QgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIENhbGwobWV0aG9kLCBPLCBhcmdzKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBQcm9taXNlQ2FsbChGLCBWLCBhcmdzKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJldHVybiBwcm9taXNlUmVzb2x2ZWRXaXRoKENhbGwoRiwgViwgYXJncykpOwogICAgICAgIH0gY2F0Y2ggKHZhbHVlKSB7CiAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aCh2YWx1ZSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIFRyYW5zZmVyQXJyYXlCdWZmZXIoTykgewogICAgICAgIHJldHVybiBPOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIElzRGV0YWNoZWRCdWZmZXIoTykgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBmdW5jdGlvbiBWYWxpZGF0ZUFuZE5vcm1hbGl6ZUhpZ2hXYXRlck1hcmsoaGlnaFdhdGVyTWFyaykgewogICAgICAgIGhpZ2hXYXRlck1hcmsgPSBOdW1iZXIoaGlnaFdhdGVyTWFyayk7CiAgICAgICAgaWYgKE51bWJlcklzTmFOKGhpZ2hXYXRlck1hcmspIHx8IGhpZ2hXYXRlck1hcmsgPCAwKSB7CiAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignaGlnaFdhdGVyTWFyayBwcm9wZXJ0eSBvZiBhIHF1ZXVpbmcgc3RyYXRlZ3kgbXVzdCBiZSBub24tbmVnYXRpdmUgYW5kIG5vbi1OYU4nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGhpZ2hXYXRlck1hcms7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gTWFrZVNpemVBbGdvcml0aG1Gcm9tU2l6ZUZ1bmN0aW9uKHNpemUpIHsKICAgICAgICBpZiAoc2l6ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGlmICh0eXBlb2Ygc2l6ZSAhPT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignc2l6ZSBwcm9wZXJ0eSBvZiBhIHF1ZXVpbmcgc3RyYXRlZ3kgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmdW5jdGlvbiAoY2h1bmspIHsKICAgICAgICAgIHJldHVybiBzaXplKGNodW5rKTsKICAgICAgICB9OwogICAgICB9CiAgICAgIHZhciBvcmlnaW5hbFByb21pc2UgPSBQcm9taXNlOwogICAgICB2YXIgb3JpZ2luYWxQcm9taXNlVGhlbiA9IFByb21pc2UucHJvdG90eXBlLnRoZW47CiAgICAgIHZhciBvcmlnaW5hbFByb21pc2VSZXNvbHZlID0gUHJvbWlzZS5yZXNvbHZlLmJpbmQob3JpZ2luYWxQcm9taXNlKTsKICAgICAgdmFyIG9yaWdpbmFsUHJvbWlzZVJlamVjdCA9IFByb21pc2UucmVqZWN0LmJpbmQob3JpZ2luYWxQcm9taXNlKTsKICAgICAgZnVuY3Rpb24gbmV3UHJvbWlzZShleGVjdXRvcikgewogICAgICAgIHJldHVybiBuZXcgb3JpZ2luYWxQcm9taXNlKGV4ZWN1dG9yKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBwcm9taXNlUmVzb2x2ZWRXaXRoKHZhbHVlKSB7CiAgICAgICAgcmV0dXJuIG9yaWdpbmFsUHJvbWlzZVJlc29sdmUodmFsdWUpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHByb21pc2VSZWplY3RlZFdpdGgocmVhc29uKSB7CiAgICAgICAgcmV0dXJuIG9yaWdpbmFsUHJvbWlzZVJlamVjdChyZWFzb24pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFBlcmZvcm1Qcm9taXNlVGhlbihwcm9taXNlLCBvbkZ1bGZpbGxlZCwgb25SZWplY3RlZCkgewogICAgICAgIHJldHVybiBvcmlnaW5hbFByb21pc2VUaGVuLmNhbGwocHJvbWlzZSwgb25GdWxmaWxsZWQsIG9uUmVqZWN0ZWQpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHVwb25Qcm9taXNlKHByb21pc2UsIG9uRnVsZmlsbGVkLCBvblJlamVjdGVkKSB7CiAgICAgICAgUGVyZm9ybVByb21pc2VUaGVuKFBlcmZvcm1Qcm9taXNlVGhlbihwcm9taXNlLCBvbkZ1bGZpbGxlZCwgb25SZWplY3RlZCksIHVuZGVmaW5lZCwgcmV0aHJvd0Fzc2VydGlvbkVycm9yUmVqZWN0aW9uKTsKICAgICAgfQogICAgICBmdW5jdGlvbiB1cG9uRnVsZmlsbG1lbnQocHJvbWlzZSwgb25GdWxmaWxsZWQpIHsKICAgICAgICB1cG9uUHJvbWlzZShwcm9taXNlLCBvbkZ1bGZpbGxlZCk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gdXBvblJlamVjdGlvbihwcm9taXNlLCBvblJlamVjdGVkKSB7CiAgICAgICAgdXBvblByb21pc2UocHJvbWlzZSwgdW5kZWZpbmVkLCBvblJlamVjdGVkKTsKICAgICAgfQogICAgICBmdW5jdGlvbiB0cmFuc2Zvcm1Qcm9taXNlV2l0aChwcm9taXNlLCBmdWxmaWxsbWVudEhhbmRsZXIsIHJlamVjdGlvbkhhbmRsZXIpIHsKICAgICAgICByZXR1cm4gUGVyZm9ybVByb21pc2VUaGVuKHByb21pc2UsIGZ1bGZpbGxtZW50SGFuZGxlciwgcmVqZWN0aW9uSGFuZGxlcik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gc2V0UHJvbWlzZUlzSGFuZGxlZFRvVHJ1ZShwcm9taXNlKSB7CiAgICAgICAgUGVyZm9ybVByb21pc2VUaGVuKHByb21pc2UsIHVuZGVmaW5lZCwgcmV0aHJvd0Fzc2VydGlvbkVycm9yUmVqZWN0aW9uKTsKICAgICAgfQogICAgICB2YXIgUVVFVUVfTUFYX0FSUkFZX1NJWkUgPSAxNjM4NDsKICAgICAgdmFyIFNpbXBsZVF1ZXVlID0gZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIFNpbXBsZVF1ZXVlKCkgewogICAgICAgICAgdGhpcy5fY3Vyc29yID0gMDsKICAgICAgICAgIHRoaXMuX3NpemUgPSAwOwogICAgICAgICAgdGhpcy5fZnJvbnQgPSB7CiAgICAgICAgICAgIF9lbGVtZW50czogW10sCiAgICAgICAgICAgIF9uZXh0OiB1bmRlZmluZWQKICAgICAgICAgIH07CiAgICAgICAgICB0aGlzLl9iYWNrID0gdGhpcy5fZnJvbnQ7CiAgICAgICAgICB0aGlzLl9jdXJzb3IgPSAwOwogICAgICAgICAgdGhpcy5fc2l6ZSA9IDA7CiAgICAgICAgfQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTaW1wbGVRdWV1ZS5wcm90b3R5cGUsICJsZW5ndGgiLCB7CiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NpemU7CiAgICAgICAgICB9LAogICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIFNpbXBsZVF1ZXVlLnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24gKGVsZW1lbnQpIHsKICAgICAgICAgIHZhciBvbGRCYWNrID0gdGhpcy5fYmFjazsKICAgICAgICAgIHZhciBuZXdCYWNrID0gb2xkQmFjazsKICAgICAgICAgIGlmIChvbGRCYWNrLl9lbGVtZW50cy5sZW5ndGggPT09IFFVRVVFX01BWF9BUlJBWV9TSVpFIC0gMSkgewogICAgICAgICAgICBuZXdCYWNrID0gewogICAgICAgICAgICAgIF9lbGVtZW50czogW10sCiAgICAgICAgICAgICAgX25leHQ6IHVuZGVmaW5lZAogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgICAgb2xkQmFjay5fZWxlbWVudHMucHVzaChlbGVtZW50KTsKICAgICAgICAgIGlmIChuZXdCYWNrICE9PSBvbGRCYWNrKSB7CiAgICAgICAgICAgIHRoaXMuX2JhY2sgPSBuZXdCYWNrOwogICAgICAgICAgICBvbGRCYWNrLl9uZXh0ID0gbmV3QmFjazsKICAgICAgICAgIH0KICAgICAgICAgICsrdGhpcy5fc2l6ZTsKICAgICAgICB9OwogICAgICAgIFNpbXBsZVF1ZXVlLnByb3RvdHlwZS5zaGlmdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBvbGRGcm9udCA9IHRoaXMuX2Zyb250OwogICAgICAgICAgdmFyIG5ld0Zyb250ID0gb2xkRnJvbnQ7CiAgICAgICAgICB2YXIgb2xkQ3Vyc29yID0gdGhpcy5fY3Vyc29yOwogICAgICAgICAgdmFyIG5ld0N1cnNvciA9IG9sZEN1cnNvciArIDE7CiAgICAgICAgICB2YXIgZWxlbWVudHMgPSBvbGRGcm9udC5fZWxlbWVudHM7CiAgICAgICAgICB2YXIgZWxlbWVudCA9IGVsZW1lbnRzW29sZEN1cnNvcl07CiAgICAgICAgICBpZiAobmV3Q3Vyc29yID09PSBRVUVVRV9NQVhfQVJSQVlfU0laRSkgewogICAgICAgICAgICBuZXdGcm9udCA9IG9sZEZyb250Ll9uZXh0OwogICAgICAgICAgICBuZXdDdXJzb3IgPSAwOwogICAgICAgICAgfQogICAgICAgICAgLS10aGlzLl9zaXplOwogICAgICAgICAgdGhpcy5fY3Vyc29yID0gbmV3Q3Vyc29yOwogICAgICAgICAgaWYgKG9sZEZyb250ICE9PSBuZXdGcm9udCkgewogICAgICAgICAgICB0aGlzLl9mcm9udCA9IG5ld0Zyb250OwogICAgICAgICAgfQogICAgICAgICAgZWxlbWVudHNbb2xkQ3Vyc29yXSA9IHVuZGVmaW5lZDsKICAgICAgICAgIHJldHVybiBlbGVtZW50OwogICAgICAgIH07CiAgICAgICAgU2ltcGxlUXVldWUucHJvdG90eXBlLmZvckVhY2ggPSBmdW5jdGlvbiAoY2FsbGJhY2spIHsKICAgICAgICAgIHZhciBpID0gdGhpcy5fY3Vyc29yOwogICAgICAgICAgdmFyIG5vZGUgPSB0aGlzLl9mcm9udDsKICAgICAgICAgIHZhciBlbGVtZW50cyA9IG5vZGUuX2VsZW1lbnRzOwogICAgICAgICAgd2hpbGUgKGkgIT09IGVsZW1lbnRzLmxlbmd0aCB8fCBub2RlLl9uZXh0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgaWYgKGkgPT09IGVsZW1lbnRzLmxlbmd0aCkgewogICAgICAgICAgICAgIG5vZGUgPSBub2RlLl9uZXh0OwogICAgICAgICAgICAgIGVsZW1lbnRzID0gbm9kZS5fZWxlbWVudHM7CiAgICAgICAgICAgICAgaSA9IDA7CiAgICAgICAgICAgICAgaWYgKGVsZW1lbnRzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhbGxiYWNrKGVsZW1lbnRzW2ldKTsKICAgICAgICAgICAgKytpOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgU2ltcGxlUXVldWUucHJvdG90eXBlLnBlZWsgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgZnJvbnQgPSB0aGlzLl9mcm9udDsKICAgICAgICAgIHZhciBjdXJzb3IgPSB0aGlzLl9jdXJzb3I7CiAgICAgICAgICByZXR1cm4gZnJvbnQuX2VsZW1lbnRzW2N1cnNvcl07CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gU2ltcGxlUXVldWU7CiAgICAgIH0oKTsKICAgICAgZnVuY3Rpb24gUmVhZGFibGVTdHJlYW1DcmVhdGVSZWFkUmVzdWx0KHZhbHVlLCBkb25lLCBmb3JBdXRob3JDb2RlKSB7CiAgICAgICAgdmFyIHByb3RvdHlwZSA9IG51bGw7CiAgICAgICAgaWYgKGZvckF1dGhvckNvZGUgPT09IHRydWUpIHsKICAgICAgICAgIHByb3RvdHlwZSA9IE9iamVjdC5wcm90b3R5cGU7CiAgICAgICAgfQogICAgICAgIHZhciBvYmogPSBPYmplY3QuY3JlYXRlKHByb3RvdHlwZSk7CiAgICAgICAgb2JqLnZhbHVlID0gdmFsdWU7CiAgICAgICAgb2JqLmRvbmUgPSBkb25lOwogICAgICAgIHJldHVybiBvYmo7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmVhZGFibGVTdHJlYW1SZWFkZXJHZW5lcmljSW5pdGlhbGl6ZShyZWFkZXIsIHN0cmVhbSkgewogICAgICAgIHJlYWRlci5fZm9yQXV0aG9yQ29kZSA9IHRydWU7CiAgICAgICAgcmVhZGVyLl9vd25lclJlYWRhYmxlU3RyZWFtID0gc3RyZWFtOwogICAgICAgIHN0cmVhbS5fcmVhZGVyID0gcmVhZGVyOwogICAgICAgIGlmIChzdHJlYW0uX3N0YXRlID09PSAncmVhZGFibGUnKSB7CiAgICAgICAgICBkZWZhdWx0UmVhZGVyQ2xvc2VkUHJvbWlzZUluaXRpYWxpemUocmVhZGVyKTsKICAgICAgICB9IGVsc2UgaWYgKHN0cmVhbS5fc3RhdGUgPT09ICdjbG9zZWQnKSB7CiAgICAgICAgICBkZWZhdWx0UmVhZGVyQ2xvc2VkUHJvbWlzZUluaXRpYWxpemVBc1Jlc29sdmVkKHJlYWRlcik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRlZmF1bHRSZWFkZXJDbG9zZWRQcm9taXNlSW5pdGlhbGl6ZUFzUmVqZWN0ZWQocmVhZGVyLCBzdHJlYW0uX3N0b3JlZEVycm9yKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmVhZGFibGVTdHJlYW1SZWFkZXJHZW5lcmljQ2FuY2VsKHJlYWRlciwgcmVhc29uKSB7CiAgICAgICAgdmFyIHN0cmVhbSA9IHJlYWRlci5fb3duZXJSZWFkYWJsZVN0cmVhbTsKICAgICAgICByZXR1cm4gUmVhZGFibGVTdHJlYW1DYW5jZWwoc3RyZWFtLCByZWFzb24pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlU3RyZWFtUmVhZGVyR2VuZXJpY1JlbGVhc2UocmVhZGVyKSB7CiAgICAgICAgaWYgKHJlYWRlci5fb3duZXJSZWFkYWJsZVN0cmVhbS5fc3RhdGUgPT09ICdyZWFkYWJsZScpIHsKICAgICAgICAgIGRlZmF1bHRSZWFkZXJDbG9zZWRQcm9taXNlUmVqZWN0KHJlYWRlciwgbmV3IFR5cGVFcnJvcignUmVhZGVyIHdhcyByZWxlYXNlZCBhbmQgY2FuIG5vIGxvbmdlciBiZSB1c2VkIHRvIG1vbml0b3IgdGhlIHN0cmVhbVwncyBjbG9zZWRuZXNzJykpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBkZWZhdWx0UmVhZGVyQ2xvc2VkUHJvbWlzZVJlc2V0VG9SZWplY3RlZChyZWFkZXIsIG5ldyBUeXBlRXJyb3IoJ1JlYWRlciB3YXMgcmVsZWFzZWQgYW5kIGNhbiBubyBsb25nZXIgYmUgdXNlZCB0byBtb25pdG9yIHRoZSBzdHJlYW1cJ3MgY2xvc2VkbmVzcycpKTsKICAgICAgICB9CiAgICAgICAgcmVhZGVyLl9vd25lclJlYWRhYmxlU3RyZWFtLl9yZWFkZXIgPSB1bmRlZmluZWQ7CiAgICAgICAgcmVhZGVyLl9vd25lclJlYWRhYmxlU3RyZWFtID0gdW5kZWZpbmVkOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHJlYWRlckxvY2tFeGNlcHRpb24obmFtZSkgewogICAgICAgIHJldHVybiBuZXcgVHlwZUVycm9yKCdDYW5ub3QgJyArIG5hbWUgKyAnIGEgc3RyZWFtIHVzaW5nIGEgcmVsZWFzZWQgcmVhZGVyJyk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZGVmYXVsdFJlYWRlckNsb3NlZFByb21pc2VJbml0aWFsaXplKHJlYWRlcikgewogICAgICAgIHJlYWRlci5fY2xvc2VkUHJvbWlzZSA9IG5ld1Byb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgcmVhZGVyLl9jbG9zZWRQcm9taXNlX3Jlc29sdmUgPSByZXNvbHZlOwogICAgICAgICAgcmVhZGVyLl9jbG9zZWRQcm9taXNlX3JlamVjdCA9IHJlamVjdDsKICAgICAgICB9KTsKICAgICAgfQogICAgICBmdW5jdGlvbiBkZWZhdWx0UmVhZGVyQ2xvc2VkUHJvbWlzZUluaXRpYWxpemVBc1JlamVjdGVkKHJlYWRlciwgcmVhc29uKSB7CiAgICAgICAgZGVmYXVsdFJlYWRlckNsb3NlZFByb21pc2VJbml0aWFsaXplKHJlYWRlcik7CiAgICAgICAgZGVmYXVsdFJlYWRlckNsb3NlZFByb21pc2VSZWplY3QocmVhZGVyLCByZWFzb24pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGRlZmF1bHRSZWFkZXJDbG9zZWRQcm9taXNlSW5pdGlhbGl6ZUFzUmVzb2x2ZWQocmVhZGVyKSB7CiAgICAgICAgZGVmYXVsdFJlYWRlckNsb3NlZFByb21pc2VJbml0aWFsaXplKHJlYWRlcik7CiAgICAgICAgZGVmYXVsdFJlYWRlckNsb3NlZFByb21pc2VSZXNvbHZlKHJlYWRlcik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZGVmYXVsdFJlYWRlckNsb3NlZFByb21pc2VSZWplY3QocmVhZGVyLCByZWFzb24pIHsKICAgICAgICBzZXRQcm9taXNlSXNIYW5kbGVkVG9UcnVlKHJlYWRlci5fY2xvc2VkUHJvbWlzZSk7CiAgICAgICAgcmVhZGVyLl9jbG9zZWRQcm9taXNlX3JlamVjdChyZWFzb24pOwogICAgICAgIHJlYWRlci5fY2xvc2VkUHJvbWlzZV9yZXNvbHZlID0gdW5kZWZpbmVkOwogICAgICAgIHJlYWRlci5fY2xvc2VkUHJvbWlzZV9yZWplY3QgPSB1bmRlZmluZWQ7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZGVmYXVsdFJlYWRlckNsb3NlZFByb21pc2VSZXNldFRvUmVqZWN0ZWQocmVhZGVyLCByZWFzb24pIHsKICAgICAgICBkZWZhdWx0UmVhZGVyQ2xvc2VkUHJvbWlzZUluaXRpYWxpemVBc1JlamVjdGVkKHJlYWRlciwgcmVhc29uKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBkZWZhdWx0UmVhZGVyQ2xvc2VkUHJvbWlzZVJlc29sdmUocmVhZGVyKSB7CiAgICAgICAgcmVhZGVyLl9jbG9zZWRQcm9taXNlX3Jlc29sdmUodW5kZWZpbmVkKTsKICAgICAgICByZWFkZXIuX2Nsb3NlZFByb21pc2VfcmVzb2x2ZSA9IHVuZGVmaW5lZDsKICAgICAgICByZWFkZXIuX2Nsb3NlZFByb21pc2VfcmVqZWN0ID0gdW5kZWZpbmVkOwogICAgICB9CiAgICAgIHZhciBDYW5jZWxTdGVwcyA9IFN5bWJvbFBvbHlmaWxsKCdbW0NhbmNlbFN0ZXBzXV0nKTsKICAgICAgdmFyIFB1bGxTdGVwcyA9IFN5bWJvbFBvbHlmaWxsKCdbW1B1bGxTdGVwc11dJyk7CiAgICAgIGZ1bmN0aW9uIEFjcXVpcmVSZWFkYWJsZVN0cmVhbURlZmF1bHRSZWFkZXIoc3RyZWFtLCBmb3JBdXRob3JDb2RlKSB7CiAgICAgICAgaWYgKGZvckF1dGhvckNvZGUgPT09IHZvaWQgMCkgewogICAgICAgICAgZm9yQXV0aG9yQ29kZSA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICB2YXIgcmVhZGVyID0gbmV3IFJlYWRhYmxlU3RyZWFtRGVmYXVsdFJlYWRlcihzdHJlYW0pOwogICAgICAgIHJlYWRlci5fZm9yQXV0aG9yQ29kZSA9IGZvckF1dGhvckNvZGU7CiAgICAgICAgcmV0dXJuIHJlYWRlcjsKICAgICAgfQogICAgICBmdW5jdGlvbiBSZWFkYWJsZVN0cmVhbUFkZFJlYWRSZXF1ZXN0KHN0cmVhbSkgewogICAgICAgIHZhciBwcm9taXNlID0gbmV3UHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICB2YXIgcmVhZFJlcXVlc3QgPSB7CiAgICAgICAgICAgIF9yZXNvbHZlOiByZXNvbHZlLAogICAgICAgICAgICBfcmVqZWN0OiByZWplY3QKICAgICAgICAgIH07CiAgICAgICAgICBzdHJlYW0uX3JlYWRlci5fcmVhZFJlcXVlc3RzLnB1c2gocmVhZFJlcXVlc3QpOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBwcm9taXNlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlU3RyZWFtRnVsZmlsbFJlYWRSZXF1ZXN0KHN0cmVhbSwgY2h1bmssIGRvbmUpIHsKICAgICAgICB2YXIgcmVhZGVyID0gc3RyZWFtLl9yZWFkZXI7CiAgICAgICAgdmFyIHJlYWRSZXF1ZXN0ID0gcmVhZGVyLl9yZWFkUmVxdWVzdHMuc2hpZnQoKTsKICAgICAgICByZWFkUmVxdWVzdC5fcmVzb2x2ZShSZWFkYWJsZVN0cmVhbUNyZWF0ZVJlYWRSZXN1bHQoY2h1bmssIGRvbmUsIHJlYWRlci5fZm9yQXV0aG9yQ29kZSkpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlU3RyZWFtR2V0TnVtUmVhZFJlcXVlc3RzKHN0cmVhbSkgewogICAgICAgIHJldHVybiBzdHJlYW0uX3JlYWRlci5fcmVhZFJlcXVlc3RzLmxlbmd0aDsKICAgICAgfQogICAgICBmdW5jdGlvbiBSZWFkYWJsZVN0cmVhbUhhc0RlZmF1bHRSZWFkZXIoc3RyZWFtKSB7CiAgICAgICAgdmFyIHJlYWRlciA9IHN0cmVhbS5fcmVhZGVyOwogICAgICAgIGlmIChyZWFkZXIgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoIUlzUmVhZGFibGVTdHJlYW1EZWZhdWx0UmVhZGVyKHJlYWRlcikpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgdmFyIFJlYWRhYmxlU3RyZWFtRGVmYXVsdFJlYWRlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBSZWFkYWJsZVN0cmVhbURlZmF1bHRSZWFkZXIoc3RyZWFtKSB7CiAgICAgICAgICBpZiAoSXNSZWFkYWJsZVN0cmVhbShzdHJlYW0pID09PSBmYWxzZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdSZWFkYWJsZVN0cmVhbURlZmF1bHRSZWFkZXIgY2FuIG9ubHkgYmUgY29uc3RydWN0ZWQgd2l0aCBhIFJlYWRhYmxlU3RyZWFtIGluc3RhbmNlJyk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoSXNSZWFkYWJsZVN0cmVhbUxvY2tlZChzdHJlYW0pID09PSB0cnVlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1RoaXMgc3RyZWFtIGhhcyBhbHJlYWR5IGJlZW4gbG9ja2VkIGZvciBleGNsdXNpdmUgcmVhZGluZyBieSBhbm90aGVyIHJlYWRlcicpOwogICAgICAgICAgfQogICAgICAgICAgUmVhZGFibGVTdHJlYW1SZWFkZXJHZW5lcmljSW5pdGlhbGl6ZSh0aGlzLCBzdHJlYW0pOwogICAgICAgICAgdGhpcy5fcmVhZFJlcXVlc3RzID0gbmV3IFNpbXBsZVF1ZXVlKCk7CiAgICAgICAgfQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZWFkYWJsZVN0cmVhbURlZmF1bHRSZWFkZXIucHJvdG90eXBlLCAiY2xvc2VkIiwgewogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIGlmICghSXNSZWFkYWJsZVN0cmVhbURlZmF1bHRSZWFkZXIodGhpcykpIHsKICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChkZWZhdWx0UmVhZGVyQnJhbmRDaGVja0V4Y2VwdGlvbignY2xvc2VkJykpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jbG9zZWRQcm9taXNlOwogICAgICAgICAgfSwKICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICB9KTsKICAgICAgICBSZWFkYWJsZVN0cmVhbURlZmF1bHRSZWFkZXIucHJvdG90eXBlLmNhbmNlbCA9IGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgIGlmICghSXNSZWFkYWJsZVN0cmVhbURlZmF1bHRSZWFkZXIodGhpcykpIHsKICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZWplY3RlZFdpdGgoZGVmYXVsdFJlYWRlckJyYW5kQ2hlY2tFeGNlcHRpb24oJ2NhbmNlbCcpKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLl9vd25lclJlYWRhYmxlU3RyZWFtID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZWplY3RlZFdpdGgocmVhZGVyTG9ja0V4Y2VwdGlvbignY2FuY2VsJykpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIFJlYWRhYmxlU3RyZWFtUmVhZGVyR2VuZXJpY0NhbmNlbCh0aGlzLCByZWFzb24pOwogICAgICAgIH07CiAgICAgICAgUmVhZGFibGVTdHJlYW1EZWZhdWx0UmVhZGVyLnByb3RvdHlwZS5yZWFkID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKCFJc1JlYWRhYmxlU3RyZWFtRGVmYXVsdFJlYWRlcih0aGlzKSkgewogICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChkZWZhdWx0UmVhZGVyQnJhbmRDaGVja0V4Y2VwdGlvbigncmVhZCcpKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLl9vd25lclJlYWRhYmxlU3RyZWFtID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZWplY3RlZFdpdGgocmVhZGVyTG9ja0V4Y2VwdGlvbigncmVhZCBmcm9tJykpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIFJlYWRhYmxlU3RyZWFtRGVmYXVsdFJlYWRlclJlYWQodGhpcyk7CiAgICAgICAgfTsKICAgICAgICBSZWFkYWJsZVN0cmVhbURlZmF1bHRSZWFkZXIucHJvdG90eXBlLnJlbGVhc2VMb2NrID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKCFJc1JlYWRhYmxlU3RyZWFtRGVmYXVsdFJlYWRlcih0aGlzKSkgewogICAgICAgICAgICB0aHJvdyBkZWZhdWx0UmVhZGVyQnJhbmRDaGVja0V4Y2VwdGlvbigncmVsZWFzZUxvY2snKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLl9vd25lclJlYWRhYmxlU3RyZWFtID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHRoaXMuX3JlYWRSZXF1ZXN0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1RyaWVkIHRvIHJlbGVhc2UgYSByZWFkZXIgbG9jayB3aGVuIHRoYXQgcmVhZGVyIGhhcyBwZW5kaW5nIHJlYWQoKSBjYWxscyB1bi1zZXR0bGVkJyk7CiAgICAgICAgICB9CiAgICAgICAgICBSZWFkYWJsZVN0cmVhbVJlYWRlckdlbmVyaWNSZWxlYXNlKHRoaXMpOwogICAgICAgIH07CiAgICAgICAgcmV0dXJuIFJlYWRhYmxlU3RyZWFtRGVmYXVsdFJlYWRlcjsKICAgICAgfSgpOwogICAgICBmdW5jdGlvbiBJc1JlYWRhYmxlU3RyZWFtRGVmYXVsdFJlYWRlcih4KSB7CiAgICAgICAgaWYgKCF0eXBlSXNPYmplY3QoeCkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoeCwgJ19yZWFkUmVxdWVzdHMnKSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBmdW5jdGlvbiBSZWFkYWJsZVN0cmVhbURlZmF1bHRSZWFkZXJSZWFkKHJlYWRlcikgewogICAgICAgIHZhciBzdHJlYW0gPSByZWFkZXIuX293bmVyUmVhZGFibGVTdHJlYW07CiAgICAgICAgc3RyZWFtLl9kaXN0dXJiZWQgPSB0cnVlOwogICAgICAgIGlmIChzdHJlYW0uX3N0YXRlID09PSAnY2xvc2VkJykgewogICAgICAgICAgcmV0dXJuIHByb21pc2VSZXNvbHZlZFdpdGgoUmVhZGFibGVTdHJlYW1DcmVhdGVSZWFkUmVzdWx0KHVuZGVmaW5lZCwgdHJ1ZSwgcmVhZGVyLl9mb3JBdXRob3JDb2RlKSk7CiAgICAgICAgfQogICAgICAgIGlmIChzdHJlYW0uX3N0YXRlID09PSAnZXJyb3JlZCcpIHsKICAgICAgICAgIHJldHVybiBwcm9taXNlUmVqZWN0ZWRXaXRoKHN0cmVhbS5fc3RvcmVkRXJyb3IpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3RyZWFtLl9yZWFkYWJsZVN0cmVhbUNvbnRyb2xsZXJbUHVsbFN0ZXBzXSgpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGRlZmF1bHRSZWFkZXJCcmFuZENoZWNrRXhjZXB0aW9uKG5hbWUpIHsKICAgICAgICByZXR1cm4gbmV3IFR5cGVFcnJvcigiUmVhZGFibGVTdHJlYW1EZWZhdWx0UmVhZGVyLnByb3RvdHlwZS4iICsgbmFtZSArICIgY2FuIG9ubHkgYmUgdXNlZCBvbiBhIFJlYWRhYmxlU3RyZWFtRGVmYXVsdFJlYWRlciIpOwogICAgICB9CiAgICAgIHZhciBfYTsKICAgICAgdmFyIEFzeW5jSXRlcmF0b3JQcm90b3R5cGU7CiAgICAgIGlmICh0eXBlb2YgU3ltYm9sUG9seWZpbGwuYXN5bmNJdGVyYXRvciA9PT0gJ3N5bWJvbCcpIHsKICAgICAgICBBc3luY0l0ZXJhdG9yUHJvdG90eXBlID0gKF9hID0ge30sIF9hW1N5bWJvbFBvbHlmaWxsLmFzeW5jSXRlcmF0b3JdID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfSwgX2EpOwogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShBc3luY0l0ZXJhdG9yUHJvdG90eXBlLCBTeW1ib2xQb2x5ZmlsbC5hc3luY0l0ZXJhdG9yLCB7IGVudW1lcmFibGU6IGZhbHNlIH0pOwogICAgICB9CiAgICAgIHZhciBSZWFkYWJsZVN0cmVhbUFzeW5jSXRlcmF0b3JQcm90b3R5cGUgPSB7CiAgICAgICAgbmV4dDogZnVuY3Rpb24gbmV4dCgpIHsKICAgICAgICAgIGlmIChJc1JlYWRhYmxlU3RyZWFtQXN5bmNJdGVyYXRvcih0aGlzKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZWplY3RlZFdpdGgoc3RyZWFtQXN5bmNJdGVyYXRvckJyYW5kQ2hlY2tFeGNlcHRpb24oJ25leHQnKSk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgcmVhZGVyID0gdGhpcy5fYXN5bmNJdGVyYXRvclJlYWRlcjsKICAgICAgICAgIGlmIChyZWFkZXIuX293bmVyUmVhZGFibGVTdHJlYW0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChyZWFkZXJMb2NrRXhjZXB0aW9uKCdpdGVyYXRlJykpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHRyYW5zZm9ybVByb21pc2VXaXRoKFJlYWRhYmxlU3RyZWFtRGVmYXVsdFJlYWRlclJlYWQocmVhZGVyKSwgZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICB2YXIgZG9uZSA9IHJlc3VsdC5kb25lOwogICAgICAgICAgICBpZiAoZG9uZSkgewogICAgICAgICAgICAgIFJlYWRhYmxlU3RyZWFtUmVhZGVyR2VuZXJpY1JlbGVhc2UocmVhZGVyKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgdmFsdWUgPSByZXN1bHQudmFsdWU7CiAgICAgICAgICAgIHJldHVybiBSZWFkYWJsZVN0cmVhbUNyZWF0ZVJlYWRSZXN1bHQodmFsdWUsIGRvbmUsIHRydWUpOwogICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICByZXR1cm46IGZ1bmN0aW9uIF9yZXR1cm4odmFsdWUpIHsKICAgICAgICAgIGlmIChJc1JlYWRhYmxlU3RyZWFtQXN5bmNJdGVyYXRvcih0aGlzKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZWplY3RlZFdpdGgoc3RyZWFtQXN5bmNJdGVyYXRvckJyYW5kQ2hlY2tFeGNlcHRpb24oJ25leHQnKSk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgcmVhZGVyID0gdGhpcy5fYXN5bmNJdGVyYXRvclJlYWRlcjsKICAgICAgICAgIGlmIChyZWFkZXIuX293bmVyUmVhZGFibGVTdHJlYW0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChyZWFkZXJMb2NrRXhjZXB0aW9uKCdmaW5pc2ggaXRlcmF0aW5nJykpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHJlYWRlci5fcmVhZFJlcXVlc3RzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZWplY3RlZFdpdGgobmV3IFR5cGVFcnJvcignVHJpZWQgdG8gcmVsZWFzZSBhIHJlYWRlciBsb2NrIHdoZW4gdGhhdCByZWFkZXIgaGFzIHBlbmRpbmcgcmVhZCgpIGNhbGxzIHVuLXNldHRsZWQnKSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodGhpcy5fcHJldmVudENhbmNlbCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9IFJlYWRhYmxlU3RyZWFtUmVhZGVyR2VuZXJpY0NhbmNlbChyZWFkZXIsIHZhbHVlKTsKICAgICAgICAgICAgUmVhZGFibGVTdHJlYW1SZWFkZXJHZW5lcmljUmVsZWFzZShyZWFkZXIpOwogICAgICAgICAgICByZXR1cm4gdHJhbnNmb3JtUHJvbWlzZVdpdGgocmVzdWx0LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIFJlYWRhYmxlU3RyZWFtQ3JlYXRlUmVhZFJlc3VsdCh2YWx1ZSwgdHJ1ZSwgdHJ1ZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgUmVhZGFibGVTdHJlYW1SZWFkZXJHZW5lcmljUmVsZWFzZShyZWFkZXIpOwogICAgICAgICAgcmV0dXJuIHByb21pc2VSZXNvbHZlZFdpdGgoUmVhZGFibGVTdHJlYW1DcmVhdGVSZWFkUmVzdWx0KHZhbHVlLCB0cnVlLCB0cnVlKSk7CiAgICAgICAgfQogICAgICB9OwogICAgICBpZiAoQXN5bmNJdGVyYXRvclByb3RvdHlwZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKFJlYWRhYmxlU3RyZWFtQXN5bmNJdGVyYXRvclByb3RvdHlwZSwgQXN5bmNJdGVyYXRvclByb3RvdHlwZSk7CiAgICAgIH0KICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFJlYWRhYmxlU3RyZWFtQXN5bmNJdGVyYXRvclByb3RvdHlwZSwgJ25leHQnLCB7IGVudW1lcmFibGU6IGZhbHNlIH0pOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUmVhZGFibGVTdHJlYW1Bc3luY0l0ZXJhdG9yUHJvdG90eXBlLCAncmV0dXJuJywgeyBlbnVtZXJhYmxlOiBmYWxzZSB9KTsKICAgICAgZnVuY3Rpb24gQWNxdWlyZVJlYWRhYmxlU3RyZWFtQXN5bmNJdGVyYXRvcihzdHJlYW0sIHByZXZlbnRDYW5jZWwpIHsKICAgICAgICBpZiAocHJldmVudENhbmNlbCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICBwcmV2ZW50Q2FuY2VsID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHZhciByZWFkZXIgPSBBY3F1aXJlUmVhZGFibGVTdHJlYW1EZWZhdWx0UmVhZGVyKHN0cmVhbSk7CiAgICAgICAgdmFyIGl0ZXJhdG9yID0gT2JqZWN0LmNyZWF0ZShSZWFkYWJsZVN0cmVhbUFzeW5jSXRlcmF0b3JQcm90b3R5cGUpOwogICAgICAgIGl0ZXJhdG9yLl9hc3luY0l0ZXJhdG9yUmVhZGVyID0gcmVhZGVyOwogICAgICAgIGl0ZXJhdG9yLl9wcmV2ZW50Q2FuY2VsID0gQm9vbGVhbihwcmV2ZW50Q2FuY2VsKTsKICAgICAgICByZXR1cm4gaXRlcmF0b3I7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gSXNSZWFkYWJsZVN0cmVhbUFzeW5jSXRlcmF0b3IoeCkgewogICAgICAgIGlmICghdHlwZUlzT2JqZWN0KHgpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmICghT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHgsICdfYXN5bmNJdGVyYXRvclJlYWRlcicpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHN0cmVhbUFzeW5jSXRlcmF0b3JCcmFuZENoZWNrRXhjZXB0aW9uKG5hbWUpIHsKICAgICAgICByZXR1cm4gbmV3IFR5cGVFcnJvcigiUmVhZGFibGVTdHJlYW1Bc3luY0l0ZXJhdG9yLiIgKyBuYW1lICsgIiBjYW4gb25seSBiZSB1c2VkIG9uIGEgUmVhZGFibGVTdGVhbUFzeW5jSXRlcmF0b3IiKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBEZXF1ZXVlVmFsdWUoY29udGFpbmVyKSB7CiAgICAgICAgdmFyIHBhaXIgPSBjb250YWluZXIuX3F1ZXVlLnNoaWZ0KCk7CiAgICAgICAgY29udGFpbmVyLl9xdWV1ZVRvdGFsU2l6ZSAtPSBwYWlyLnNpemU7CiAgICAgICAgaWYgKGNvbnRhaW5lci5fcXVldWVUb3RhbFNpemUgPCAwKSB7CiAgICAgICAgICBjb250YWluZXIuX3F1ZXVlVG90YWxTaXplID0gMDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHBhaXIudmFsdWU7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gRW5xdWV1ZVZhbHVlV2l0aFNpemUoY29udGFpbmVyLCB2YWx1ZSwgc2l6ZSkgewogICAgICAgIHNpemUgPSBOdW1iZXIoc2l6ZSk7CiAgICAgICAgaWYgKCFJc0Zpbml0ZU5vbk5lZ2F0aXZlTnVtYmVyKHNpemUpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignU2l6ZSBtdXN0IGJlIGEgZmluaXRlLCBub24tTmFOLCBub24tbmVnYXRpdmUgbnVtYmVyLicpOwogICAgICAgIH0KICAgICAgICBjb250YWluZXIuX3F1ZXVlLnB1c2goewogICAgICAgICAgdmFsdWU6IHZhbHVlLAogICAgICAgICAgc2l6ZTogc2l6ZQogICAgICAgIH0pOwogICAgICAgIGNvbnRhaW5lci5fcXVldWVUb3RhbFNpemUgKz0gc2l6ZTsKICAgICAgfQogICAgICBmdW5jdGlvbiBQZWVrUXVldWVWYWx1ZShjb250YWluZXIpIHsKICAgICAgICB2YXIgcGFpciA9IGNvbnRhaW5lci5fcXVldWUucGVlaygpOwogICAgICAgIHJldHVybiBwYWlyLnZhbHVlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlc2V0UXVldWUoY29udGFpbmVyKSB7CiAgICAgICAgY29udGFpbmVyLl9xdWV1ZSA9IG5ldyBTaW1wbGVRdWV1ZSgpOwogICAgICAgIGNvbnRhaW5lci5fcXVldWVUb3RhbFNpemUgPSAwOwogICAgICB9CiAgICAgIHZhciBBYm9ydFN0ZXBzID0gU3ltYm9sUG9seWZpbGwoJ1tbQWJvcnRTdGVwc11dJyk7CiAgICAgIHZhciBFcnJvclN0ZXBzID0gU3ltYm9sUG9seWZpbGwoJ1tbRXJyb3JTdGVwc11dJyk7CiAgICAgIHZhciBXcml0YWJsZVN0cmVhbSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBXcml0YWJsZVN0cmVhbSh1bmRlcmx5aW5nU2luaywgc3RyYXRlZ3kpIHsKICAgICAgICAgIGlmICh1bmRlcmx5aW5nU2luayA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgIHVuZGVybHlpbmdTaW5rID0ge307CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoc3RyYXRlZ3kgPT09IHZvaWQgMCkgewogICAgICAgICAgICBzdHJhdGVneSA9IHt9OwogICAgICAgICAgfQogICAgICAgICAgSW5pdGlhbGl6ZVdyaXRhYmxlU3RyZWFtKHRoaXMpOwogICAgICAgICAgdmFyIHNpemUgPSBzdHJhdGVneS5zaXplOwogICAgICAgICAgdmFyIGhpZ2hXYXRlck1hcmsgPSBzdHJhdGVneS5oaWdoV2F0ZXJNYXJrOwogICAgICAgICAgdmFyIHR5cGUgPSB1bmRlcmx5aW5nU2luay50eXBlOwogICAgICAgICAgaWYgKHR5cGUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignSW52YWxpZCB0eXBlIGlzIHNwZWNpZmllZCcpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHNpemVBbGdvcml0aG0gPSBNYWtlU2l6ZUFsZ29yaXRobUZyb21TaXplRnVuY3Rpb24oc2l6ZSk7CiAgICAgICAgICBpZiAoaGlnaFdhdGVyTWFyayA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGhpZ2hXYXRlck1hcmsgPSAxOwogICAgICAgICAgfQogICAgICAgICAgaGlnaFdhdGVyTWFyayA9IFZhbGlkYXRlQW5kTm9ybWFsaXplSGlnaFdhdGVyTWFyayhoaWdoV2F0ZXJNYXJrKTsKICAgICAgICAgIFNldFVwV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckZyb21VbmRlcmx5aW5nU2luayh0aGlzLCB1bmRlcmx5aW5nU2luaywgaGlnaFdhdGVyTWFyaywgc2l6ZUFsZ29yaXRobSk7CiAgICAgICAgfQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShXcml0YWJsZVN0cmVhbS5wcm90b3R5cGUsICJsb2NrZWQiLCB7CiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgaWYgKElzV3JpdGFibGVTdHJlYW0odGhpcykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgdGhyb3cgc3RyZWFtQnJhbmRDaGVja0V4Y2VwdGlvbignbG9ja2VkJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIElzV3JpdGFibGVTdHJlYW1Mb2NrZWQodGhpcyk7CiAgICAgICAgICB9LAogICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIFdyaXRhYmxlU3RyZWFtLnByb3RvdHlwZS5hYm9ydCA9IGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgIGlmIChJc1dyaXRhYmxlU3RyZWFtKHRoaXMpID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChzdHJlYW1CcmFuZENoZWNrRXhjZXB0aW9uKCdhYm9ydCcpKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChJc1dyaXRhYmxlU3RyZWFtTG9ja2VkKHRoaXMpID09PSB0cnVlKSB7CiAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVqZWN0ZWRXaXRoKG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBhYm9ydCBhIHN0cmVhbSB0aGF0IGFscmVhZHkgaGFzIGEgd3JpdGVyJykpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIFdyaXRhYmxlU3RyZWFtQWJvcnQodGhpcywgcmVhc29uKTsKICAgICAgICB9OwogICAgICAgIFdyaXRhYmxlU3RyZWFtLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmIChJc1dyaXRhYmxlU3RyZWFtKHRoaXMpID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChzdHJlYW1CcmFuZENoZWNrRXhjZXB0aW9uKCdjbG9zZScpKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChJc1dyaXRhYmxlU3RyZWFtTG9ja2VkKHRoaXMpID09PSB0cnVlKSB7CiAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVqZWN0ZWRXaXRoKG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjbG9zZSBhIHN0cmVhbSB0aGF0IGFscmVhZHkgaGFzIGEgd3JpdGVyJykpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKFdyaXRhYmxlU3RyZWFtQ2xvc2VRdWV1ZWRPckluRmxpZ2h0KHRoaXMpID09PSB0cnVlKSB7CiAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVqZWN0ZWRXaXRoKG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjbG9zZSBhbiBhbHJlYWR5LWNsb3Npbmcgc3RyZWFtJykpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIFdyaXRhYmxlU3RyZWFtQ2xvc2UodGhpcyk7CiAgICAgICAgfTsKICAgICAgICBXcml0YWJsZVN0cmVhbS5wcm90b3R5cGUuZ2V0V3JpdGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKElzV3JpdGFibGVTdHJlYW0odGhpcykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRocm93IHN0cmVhbUJyYW5kQ2hlY2tFeGNlcHRpb24oJ2dldFdyaXRlcicpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIEFjcXVpcmVXcml0YWJsZVN0cmVhbURlZmF1bHRXcml0ZXIodGhpcyk7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gV3JpdGFibGVTdHJlYW07CiAgICAgIH0oKTsKICAgICAgZnVuY3Rpb24gQWNxdWlyZVdyaXRhYmxlU3RyZWFtRGVmYXVsdFdyaXRlcihzdHJlYW0pIHsKICAgICAgICByZXR1cm4gbmV3IFdyaXRhYmxlU3RyZWFtRGVmYXVsdFdyaXRlcihzdHJlYW0pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIENyZWF0ZVdyaXRhYmxlU3RyZWFtKHN0YXJ0QWxnb3JpdGhtLCB3cml0ZUFsZ29yaXRobSwgY2xvc2VBbGdvcml0aG0sIGFib3J0QWxnb3JpdGhtLCBoaWdoV2F0ZXJNYXJrLCBzaXplQWxnb3JpdGhtKSB7CiAgICAgICAgaWYgKGhpZ2hXYXRlck1hcmsgPT09IHZvaWQgMCkgewogICAgICAgICAgaGlnaFdhdGVyTWFyayA9IDE7CiAgICAgICAgfQogICAgICAgIGlmIChzaXplQWxnb3JpdGhtID09PSB2b2lkIDApIHsKICAgICAgICAgIHNpemVBbGdvcml0aG0gPSBmdW5jdGlvbiBzaXplQWxnb3JpdGhtKCkgewogICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIHZhciBzdHJlYW0gPSBPYmplY3QuY3JlYXRlKFdyaXRhYmxlU3RyZWFtLnByb3RvdHlwZSk7CiAgICAgICAgSW5pdGlhbGl6ZVdyaXRhYmxlU3RyZWFtKHN0cmVhbSk7CiAgICAgICAgdmFyIGNvbnRyb2xsZXIgPSBPYmplY3QuY3JlYXRlKFdyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXIucHJvdG90eXBlKTsKICAgICAgICBTZXRVcFdyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXIoc3RyZWFtLCBjb250cm9sbGVyLCBzdGFydEFsZ29yaXRobSwgd3JpdGVBbGdvcml0aG0sIGNsb3NlQWxnb3JpdGhtLCBhYm9ydEFsZ29yaXRobSwgaGlnaFdhdGVyTWFyaywgc2l6ZUFsZ29yaXRobSk7CiAgICAgICAgcmV0dXJuIHN0cmVhbTsKICAgICAgfQogICAgICBmdW5jdGlvbiBJbml0aWFsaXplV3JpdGFibGVTdHJlYW0oc3RyZWFtKSB7CiAgICAgICAgc3RyZWFtLl9zdGF0ZSA9ICd3cml0YWJsZSc7CiAgICAgICAgc3RyZWFtLl9zdG9yZWRFcnJvciA9IHVuZGVmaW5lZDsKICAgICAgICBzdHJlYW0uX3dyaXRlciA9IHVuZGVmaW5lZDsKICAgICAgICBzdHJlYW0uX3dyaXRhYmxlU3RyZWFtQ29udHJvbGxlciA9IHVuZGVmaW5lZDsKICAgICAgICBzdHJlYW0uX3dyaXRlUmVxdWVzdHMgPSBuZXcgU2ltcGxlUXVldWUoKTsKICAgICAgICBzdHJlYW0uX2luRmxpZ2h0V3JpdGVSZXF1ZXN0ID0gdW5kZWZpbmVkOwogICAgICAgIHN0cmVhbS5fY2xvc2VSZXF1ZXN0ID0gdW5kZWZpbmVkOwogICAgICAgIHN0cmVhbS5faW5GbGlnaHRDbG9zZVJlcXVlc3QgPSB1bmRlZmluZWQ7CiAgICAgICAgc3RyZWFtLl9wZW5kaW5nQWJvcnRSZXF1ZXN0ID0gdW5kZWZpbmVkOwogICAgICAgIHN0cmVhbS5fYmFja3ByZXNzdXJlID0gZmFsc2U7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gSXNXcml0YWJsZVN0cmVhbSh4KSB7CiAgICAgICAgaWYgKCF0eXBlSXNPYmplY3QoeCkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoeCwgJ193cml0YWJsZVN0cmVhbUNvbnRyb2xsZXInKSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBmdW5jdGlvbiBJc1dyaXRhYmxlU3RyZWFtTG9ja2VkKHN0cmVhbSkgewogICAgICAgIGlmIChzdHJlYW0uX3dyaXRlciA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFdyaXRhYmxlU3RyZWFtQWJvcnQoc3RyZWFtLCByZWFzb24pIHsKICAgICAgICB2YXIgc3RhdGUgPSBzdHJlYW0uX3N0YXRlOwogICAgICAgIGlmIChzdGF0ZSA9PT0gJ2Nsb3NlZCcgfHwgc3RhdGUgPT09ICdlcnJvcmVkJykgewogICAgICAgICAgcmV0dXJuIHByb21pc2VSZXNvbHZlZFdpdGgodW5kZWZpbmVkKTsKICAgICAgICB9CiAgICAgICAgaWYgKHN0cmVhbS5fcGVuZGluZ0Fib3J0UmVxdWVzdCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICByZXR1cm4gc3RyZWFtLl9wZW5kaW5nQWJvcnRSZXF1ZXN0Ll9wcm9taXNlOwogICAgICAgIH0KICAgICAgICB2YXIgd2FzQWxyZWFkeUVycm9yaW5nID0gZmFsc2U7CiAgICAgICAgaWYgKHN0YXRlID09PSAnZXJyb3JpbmcnKSB7CiAgICAgICAgICB3YXNBbHJlYWR5RXJyb3JpbmcgPSB0cnVlOwogICAgICAgICAgcmVhc29uID0gdW5kZWZpbmVkOwogICAgICAgIH0KICAgICAgICB2YXIgcHJvbWlzZSA9IG5ld1Byb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgc3RyZWFtLl9wZW5kaW5nQWJvcnRSZXF1ZXN0ID0gewogICAgICAgICAgICBfcHJvbWlzZTogdW5kZWZpbmVkLAogICAgICAgICAgICBfcmVzb2x2ZTogcmVzb2x2ZSwKICAgICAgICAgICAgX3JlamVjdDogcmVqZWN0LAogICAgICAgICAgICBfcmVhc29uOiByZWFzb24sCiAgICAgICAgICAgIF93YXNBbHJlYWR5RXJyb3Jpbmc6IHdhc0FscmVhZHlFcnJvcmluZwogICAgICAgICAgfTsKICAgICAgICB9KTsKICAgICAgICBzdHJlYW0uX3BlbmRpbmdBYm9ydFJlcXVlc3QuX3Byb21pc2UgPSBwcm9taXNlOwogICAgICAgIGlmICh3YXNBbHJlYWR5RXJyb3JpbmcgPT09IGZhbHNlKSB7CiAgICAgICAgICBXcml0YWJsZVN0cmVhbVN0YXJ0RXJyb3Jpbmcoc3RyZWFtLCByZWFzb24pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcHJvbWlzZTsKICAgICAgfQogICAgICBmdW5jdGlvbiBXcml0YWJsZVN0cmVhbUNsb3NlKHN0cmVhbSkgewogICAgICAgIHZhciBzdGF0ZSA9IHN0cmVhbS5fc3RhdGU7CiAgICAgICAgaWYgKHN0YXRlID09PSAnY2xvc2VkJyB8fCBzdGF0ZSA9PT0gJ2Vycm9yZWQnKSB7CiAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChuZXcgVHlwZUVycm9yKCJUaGUgc3RyZWFtIChpbiAiICsgc3RhdGUgKyAiIHN0YXRlKSBpcyBub3QgaW4gdGhlIHdyaXRhYmxlIHN0YXRlIGFuZCBjYW5ub3QgYmUgY2xvc2VkIikpOwogICAgICAgIH0KICAgICAgICB2YXIgcHJvbWlzZSA9IG5ld1Byb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgdmFyIGNsb3NlUmVxdWVzdCA9IHsKICAgICAgICAgICAgX3Jlc29sdmU6IHJlc29sdmUsCiAgICAgICAgICAgIF9yZWplY3Q6IHJlamVjdAogICAgICAgICAgfTsKICAgICAgICAgIHN0cmVhbS5fY2xvc2VSZXF1ZXN0ID0gY2xvc2VSZXF1ZXN0OwogICAgICAgIH0pOwogICAgICAgIHZhciB3cml0ZXIgPSBzdHJlYW0uX3dyaXRlcjsKICAgICAgICBpZiAod3JpdGVyICE9PSB1bmRlZmluZWQgJiYgc3RyZWFtLl9iYWNrcHJlc3N1cmUgPT09IHRydWUgJiYgc3RhdGUgPT09ICd3cml0YWJsZScpIHsKICAgICAgICAgIGRlZmF1bHRXcml0ZXJSZWFkeVByb21pc2VSZXNvbHZlKHdyaXRlcik7CiAgICAgICAgfQogICAgICAgIFdyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJDbG9zZShzdHJlYW0uX3dyaXRhYmxlU3RyZWFtQ29udHJvbGxlcik7CiAgICAgICAgcmV0dXJuIHByb21pc2U7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gV3JpdGFibGVTdHJlYW1BZGRXcml0ZVJlcXVlc3Qoc3RyZWFtKSB7CiAgICAgICAgdmFyIHByb21pc2UgPSBuZXdQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgIHZhciB3cml0ZVJlcXVlc3QgPSB7CiAgICAgICAgICAgIF9yZXNvbHZlOiByZXNvbHZlLAogICAgICAgICAgICBfcmVqZWN0OiByZWplY3QKICAgICAgICAgIH07CiAgICAgICAgICBzdHJlYW0uX3dyaXRlUmVxdWVzdHMucHVzaCh3cml0ZVJlcXVlc3QpOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBwcm9taXNlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFdyaXRhYmxlU3RyZWFtRGVhbFdpdGhSZWplY3Rpb24oc3RyZWFtLCBlcnJvcikgewogICAgICAgIHZhciBzdGF0ZSA9IHN0cmVhbS5fc3RhdGU7CiAgICAgICAgaWYgKHN0YXRlID09PSAnd3JpdGFibGUnKSB7CiAgICAgICAgICBXcml0YWJsZVN0cmVhbVN0YXJ0RXJyb3Jpbmcoc3RyZWFtLCBlcnJvcik7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIFdyaXRhYmxlU3RyZWFtRmluaXNoRXJyb3Jpbmcoc3RyZWFtKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBXcml0YWJsZVN0cmVhbVN0YXJ0RXJyb3Jpbmcoc3RyZWFtLCByZWFzb24pIHsKICAgICAgICB2YXIgY29udHJvbGxlciA9IHN0cmVhbS5fd3JpdGFibGVTdHJlYW1Db250cm9sbGVyOwogICAgICAgIHN0cmVhbS5fc3RhdGUgPSAnZXJyb3JpbmcnOwogICAgICAgIHN0cmVhbS5fc3RvcmVkRXJyb3IgPSByZWFzb247CiAgICAgICAgdmFyIHdyaXRlciA9IHN0cmVhbS5fd3JpdGVyOwogICAgICAgIGlmICh3cml0ZXIgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyRW5zdXJlUmVhZHlQcm9taXNlUmVqZWN0ZWQod3JpdGVyLCByZWFzb24pOwogICAgICAgIH0KICAgICAgICBpZiAoV3JpdGFibGVTdHJlYW1IYXNPcGVyYXRpb25NYXJrZWRJbkZsaWdodChzdHJlYW0pID09PSBmYWxzZSAmJiBjb250cm9sbGVyLl9zdGFydGVkID09PSB0cnVlKSB7CiAgICAgICAgICBXcml0YWJsZVN0cmVhbUZpbmlzaEVycm9yaW5nKHN0cmVhbSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIFdyaXRhYmxlU3RyZWFtRmluaXNoRXJyb3Jpbmcoc3RyZWFtKSB7CiAgICAgICAgc3RyZWFtLl9zdGF0ZSA9ICdlcnJvcmVkJzsKICAgICAgICBzdHJlYW0uX3dyaXRhYmxlU3RyZWFtQ29udHJvbGxlcltFcnJvclN0ZXBzXSgpOwogICAgICAgIHZhciBzdG9yZWRFcnJvciA9IHN0cmVhbS5fc3RvcmVkRXJyb3I7CiAgICAgICAgc3RyZWFtLl93cml0ZVJlcXVlc3RzLmZvckVhY2goZnVuY3Rpb24gKHdyaXRlUmVxdWVzdCkgewogICAgICAgICAgd3JpdGVSZXF1ZXN0Ll9yZWplY3Qoc3RvcmVkRXJyb3IpOwogICAgICAgIH0pOwogICAgICAgIHN0cmVhbS5fd3JpdGVSZXF1ZXN0cyA9IG5ldyBTaW1wbGVRdWV1ZSgpOwogICAgICAgIGlmIChzdHJlYW0uX3BlbmRpbmdBYm9ydFJlcXVlc3QgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgV3JpdGFibGVTdHJlYW1SZWplY3RDbG9zZUFuZENsb3NlZFByb21pc2VJZk5lZWRlZChzdHJlYW0pOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB2YXIgYWJvcnRSZXF1ZXN0ID0gc3RyZWFtLl9wZW5kaW5nQWJvcnRSZXF1ZXN0OwogICAgICAgIHN0cmVhbS5fcGVuZGluZ0Fib3J0UmVxdWVzdCA9IHVuZGVmaW5lZDsKICAgICAgICBpZiAoYWJvcnRSZXF1ZXN0Ll93YXNBbHJlYWR5RXJyb3JpbmcgPT09IHRydWUpIHsKICAgICAgICAgIGFib3J0UmVxdWVzdC5fcmVqZWN0KHN0b3JlZEVycm9yKTsKICAgICAgICAgIFdyaXRhYmxlU3RyZWFtUmVqZWN0Q2xvc2VBbmRDbG9zZWRQcm9taXNlSWZOZWVkZWQoc3RyZWFtKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdmFyIHByb21pc2UgPSBzdHJlYW0uX3dyaXRhYmxlU3RyZWFtQ29udHJvbGxlcltBYm9ydFN0ZXBzXShhYm9ydFJlcXVlc3QuX3JlYXNvbik7CiAgICAgICAgdXBvblByb21pc2UocHJvbWlzZSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgYWJvcnRSZXF1ZXN0Ll9yZXNvbHZlKCk7CiAgICAgICAgICBXcml0YWJsZVN0cmVhbVJlamVjdENsb3NlQW5kQ2xvc2VkUHJvbWlzZUlmTmVlZGVkKHN0cmVhbSk7CiAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgYWJvcnRSZXF1ZXN0Ll9yZWplY3QocmVhc29uKTsKICAgICAgICAgIFdyaXRhYmxlU3RyZWFtUmVqZWN0Q2xvc2VBbmRDbG9zZWRQcm9taXNlSWZOZWVkZWQoc3RyZWFtKTsKICAgICAgICB9KTsKICAgICAgfQogICAgICBmdW5jdGlvbiBXcml0YWJsZVN0cmVhbUZpbmlzaEluRmxpZ2h0V3JpdGUoc3RyZWFtKSB7CiAgICAgICAgc3RyZWFtLl9pbkZsaWdodFdyaXRlUmVxdWVzdC5fcmVzb2x2ZSh1bmRlZmluZWQpOwogICAgICAgIHN0cmVhbS5faW5GbGlnaHRXcml0ZVJlcXVlc3QgPSB1bmRlZmluZWQ7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gV3JpdGFibGVTdHJlYW1GaW5pc2hJbkZsaWdodFdyaXRlV2l0aEVycm9yKHN0cmVhbSwgZXJyb3IpIHsKICAgICAgICBzdHJlYW0uX2luRmxpZ2h0V3JpdGVSZXF1ZXN0Ll9yZWplY3QoZXJyb3IpOwogICAgICAgIHN0cmVhbS5faW5GbGlnaHRXcml0ZVJlcXVlc3QgPSB1bmRlZmluZWQ7CiAgICAgICAgV3JpdGFibGVTdHJlYW1EZWFsV2l0aFJlamVjdGlvbihzdHJlYW0sIGVycm9yKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBXcml0YWJsZVN0cmVhbUZpbmlzaEluRmxpZ2h0Q2xvc2Uoc3RyZWFtKSB7CiAgICAgICAgc3RyZWFtLl9pbkZsaWdodENsb3NlUmVxdWVzdC5fcmVzb2x2ZSh1bmRlZmluZWQpOwogICAgICAgIHN0cmVhbS5faW5GbGlnaHRDbG9zZVJlcXVlc3QgPSB1bmRlZmluZWQ7CiAgICAgICAgdmFyIHN0YXRlID0gc3RyZWFtLl9zdGF0ZTsKICAgICAgICBpZiAoc3RhdGUgPT09ICdlcnJvcmluZycpIHsKICAgICAgICAgIHN0cmVhbS5fc3RvcmVkRXJyb3IgPSB1bmRlZmluZWQ7CiAgICAgICAgICBpZiAoc3RyZWFtLl9wZW5kaW5nQWJvcnRSZXF1ZXN0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgc3RyZWFtLl9wZW5kaW5nQWJvcnRSZXF1ZXN0Ll9yZXNvbHZlKCk7CiAgICAgICAgICAgIHN0cmVhbS5fcGVuZGluZ0Fib3J0UmVxdWVzdCA9IHVuZGVmaW5lZDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgc3RyZWFtLl9zdGF0ZSA9ICdjbG9zZWQnOwogICAgICAgIHZhciB3cml0ZXIgPSBzdHJlYW0uX3dyaXRlcjsKICAgICAgICBpZiAod3JpdGVyICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGRlZmF1bHRXcml0ZXJDbG9zZWRQcm9taXNlUmVzb2x2ZSh3cml0ZXIpOwogICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiBXcml0YWJsZVN0cmVhbUZpbmlzaEluRmxpZ2h0Q2xvc2VXaXRoRXJyb3Ioc3RyZWFtLCBlcnJvcikgewogICAgICAgIHN0cmVhbS5faW5GbGlnaHRDbG9zZVJlcXVlc3QuX3JlamVjdChlcnJvcik7CiAgICAgICAgc3RyZWFtLl9pbkZsaWdodENsb3NlUmVxdWVzdCA9IHVuZGVmaW5lZDsKICAgICAgICBpZiAoc3RyZWFtLl9wZW5kaW5nQWJvcnRSZXF1ZXN0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHN0cmVhbS5fcGVuZGluZ0Fib3J0UmVxdWVzdC5fcmVqZWN0KGVycm9yKTsKICAgICAgICAgIHN0cmVhbS5fcGVuZGluZ0Fib3J0UmVxdWVzdCA9IHVuZGVmaW5lZDsKICAgICAgICB9CiAgICAgICAgV3JpdGFibGVTdHJlYW1EZWFsV2l0aFJlamVjdGlvbihzdHJlYW0sIGVycm9yKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBXcml0YWJsZVN0cmVhbUNsb3NlUXVldWVkT3JJbkZsaWdodChzdHJlYW0pIHsKICAgICAgICBpZiAoc3RyZWFtLl9jbG9zZVJlcXVlc3QgPT09IHVuZGVmaW5lZCAmJiBzdHJlYW0uX2luRmxpZ2h0Q2xvc2VSZXF1ZXN0ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gV3JpdGFibGVTdHJlYW1IYXNPcGVyYXRpb25NYXJrZWRJbkZsaWdodChzdHJlYW0pIHsKICAgICAgICBpZiAoc3RyZWFtLl9pbkZsaWdodFdyaXRlUmVxdWVzdCA9PT0gdW5kZWZpbmVkICYmIHN0cmVhbS5faW5GbGlnaHRDbG9zZVJlcXVlc3QgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBmdW5jdGlvbiBXcml0YWJsZVN0cmVhbU1hcmtDbG9zZVJlcXVlc3RJbkZsaWdodChzdHJlYW0pIHsKICAgICAgICBzdHJlYW0uX2luRmxpZ2h0Q2xvc2VSZXF1ZXN0ID0gc3RyZWFtLl9jbG9zZVJlcXVlc3Q7CiAgICAgICAgc3RyZWFtLl9jbG9zZVJlcXVlc3QgPSB1bmRlZmluZWQ7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gV3JpdGFibGVTdHJlYW1NYXJrRmlyc3RXcml0ZVJlcXVlc3RJbkZsaWdodChzdHJlYW0pIHsKICAgICAgICBzdHJlYW0uX2luRmxpZ2h0V3JpdGVSZXF1ZXN0ID0gc3RyZWFtLl93cml0ZVJlcXVlc3RzLnNoaWZ0KCk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gV3JpdGFibGVTdHJlYW1SZWplY3RDbG9zZUFuZENsb3NlZFByb21pc2VJZk5lZWRlZChzdHJlYW0pIHsKICAgICAgICBpZiAoc3RyZWFtLl9jbG9zZVJlcXVlc3QgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgc3RyZWFtLl9jbG9zZVJlcXVlc3QuX3JlamVjdChzdHJlYW0uX3N0b3JlZEVycm9yKTsKICAgICAgICAgIHN0cmVhbS5fY2xvc2VSZXF1ZXN0ID0gdW5kZWZpbmVkOwogICAgICAgIH0KICAgICAgICB2YXIgd3JpdGVyID0gc3RyZWFtLl93cml0ZXI7CiAgICAgICAgaWYgKHdyaXRlciAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBkZWZhdWx0V3JpdGVyQ2xvc2VkUHJvbWlzZVJlamVjdCh3cml0ZXIsIHN0cmVhbS5fc3RvcmVkRXJyb3IpOwogICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiBXcml0YWJsZVN0cmVhbVVwZGF0ZUJhY2twcmVzc3VyZShzdHJlYW0sIGJhY2twcmVzc3VyZSkgewogICAgICAgIHZhciB3cml0ZXIgPSBzdHJlYW0uX3dyaXRlcjsKICAgICAgICBpZiAod3JpdGVyICE9PSB1bmRlZmluZWQgJiYgYmFja3ByZXNzdXJlICE9PSBzdHJlYW0uX2JhY2twcmVzc3VyZSkgewogICAgICAgICAgaWYgKGJhY2twcmVzc3VyZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICBkZWZhdWx0V3JpdGVyUmVhZHlQcm9taXNlUmVzZXQod3JpdGVyKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRlZmF1bHRXcml0ZXJSZWFkeVByb21pc2VSZXNvbHZlKHdyaXRlcik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHN0cmVhbS5fYmFja3ByZXNzdXJlID0gYmFja3ByZXNzdXJlOwogICAgICB9CiAgICAgIHZhciBXcml0YWJsZVN0cmVhbURlZmF1bHRXcml0ZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyKHN0cmVhbSkgewogICAgICAgICAgaWYgKElzV3JpdGFibGVTdHJlYW0oc3RyZWFtKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyIGNhbiBvbmx5IGJlIGNvbnN0cnVjdGVkIHdpdGggYSBXcml0YWJsZVN0cmVhbSBpbnN0YW5jZScpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKElzV3JpdGFibGVTdHJlYW1Mb2NrZWQoc3RyZWFtKSA9PT0gdHJ1ZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdUaGlzIHN0cmVhbSBoYXMgYWxyZWFkeSBiZWVuIGxvY2tlZCBmb3IgZXhjbHVzaXZlIHdyaXRpbmcgYnkgYW5vdGhlciB3cml0ZXInKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuX293bmVyV3JpdGFibGVTdHJlYW0gPSBzdHJlYW07CiAgICAgICAgICBzdHJlYW0uX3dyaXRlciA9IHRoaXM7CiAgICAgICAgICB2YXIgc3RhdGUgPSBzdHJlYW0uX3N0YXRlOwogICAgICAgICAgaWYgKHN0YXRlID09PSAnd3JpdGFibGUnKSB7CiAgICAgICAgICAgIGlmIChXcml0YWJsZVN0cmVhbUNsb3NlUXVldWVkT3JJbkZsaWdodChzdHJlYW0pID09PSBmYWxzZSAmJiBzdHJlYW0uX2JhY2twcmVzc3VyZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgIGRlZmF1bHRXcml0ZXJSZWFkeVByb21pc2VJbml0aWFsaXplKHRoaXMpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGRlZmF1bHRXcml0ZXJSZWFkeVByb21pc2VJbml0aWFsaXplQXNSZXNvbHZlZCh0aGlzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBkZWZhdWx0V3JpdGVyQ2xvc2VkUHJvbWlzZUluaXRpYWxpemUodGhpcyk7CiAgICAgICAgICB9IGVsc2UgaWYgKHN0YXRlID09PSAnZXJyb3JpbmcnKSB7CiAgICAgICAgICAgIGRlZmF1bHRXcml0ZXJSZWFkeVByb21pc2VJbml0aWFsaXplQXNSZWplY3RlZCh0aGlzLCBzdHJlYW0uX3N0b3JlZEVycm9yKTsKICAgICAgICAgICAgZGVmYXVsdFdyaXRlckNsb3NlZFByb21pc2VJbml0aWFsaXplKHRoaXMpOwogICAgICAgICAgfSBlbHNlIGlmIChzdGF0ZSA9PT0gJ2Nsb3NlZCcpIHsKICAgICAgICAgICAgZGVmYXVsdFdyaXRlclJlYWR5UHJvbWlzZUluaXRpYWxpemVBc1Jlc29sdmVkKHRoaXMpOwogICAgICAgICAgICBkZWZhdWx0V3JpdGVyQ2xvc2VkUHJvbWlzZUluaXRpYWxpemVBc1Jlc29sdmVkKHRoaXMpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIHN0b3JlZEVycm9yID0gc3RyZWFtLl9zdG9yZWRFcnJvcjsKICAgICAgICAgICAgZGVmYXVsdFdyaXRlclJlYWR5UHJvbWlzZUluaXRpYWxpemVBc1JlamVjdGVkKHRoaXMsIHN0b3JlZEVycm9yKTsKICAgICAgICAgICAgZGVmYXVsdFdyaXRlckNsb3NlZFByb21pc2VJbml0aWFsaXplQXNSZWplY3RlZCh0aGlzLCBzdG9yZWRFcnJvcik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShXcml0YWJsZVN0cmVhbURlZmF1bHRXcml0ZXIucHJvdG90eXBlLCAiY2xvc2VkIiwgewogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIGlmIChJc1dyaXRhYmxlU3RyZWFtRGVmYXVsdFdyaXRlcih0aGlzKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChkZWZhdWx0V3JpdGVyQnJhbmRDaGVja0V4Y2VwdGlvbignY2xvc2VkJykpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jbG9zZWRQcm9taXNlOwogICAgICAgICAgfSwKICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICB9KTsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyLnByb3RvdHlwZSwgImRlc2lyZWRTaXplIiwgewogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIGlmIChJc1dyaXRhYmxlU3RyZWFtRGVmYXVsdFdyaXRlcih0aGlzKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICB0aHJvdyBkZWZhdWx0V3JpdGVyQnJhbmRDaGVja0V4Y2VwdGlvbignZGVzaXJlZFNpemUnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5fb3duZXJXcml0YWJsZVN0cmVhbSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgdGhyb3cgZGVmYXVsdFdyaXRlckxvY2tFeGNlcHRpb24oJ2Rlc2lyZWRTaXplJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIFdyaXRhYmxlU3RyZWFtRGVmYXVsdFdyaXRlckdldERlc2lyZWRTaXplKHRoaXMpOwogICAgICAgICAgfSwKICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICB9KTsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyLnByb3RvdHlwZSwgInJlYWR5IiwgewogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIGlmIChJc1dyaXRhYmxlU3RyZWFtRGVmYXVsdFdyaXRlcih0aGlzKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChkZWZhdWx0V3JpdGVyQnJhbmRDaGVja0V4Y2VwdGlvbigncmVhZHknKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlYWR5UHJvbWlzZTsKICAgICAgICAgIH0sCiAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgICAgfSk7CiAgICAgICAgV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyLnByb3RvdHlwZS5hYm9ydCA9IGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgIGlmIChJc1dyaXRhYmxlU3RyZWFtRGVmYXVsdFdyaXRlcih0aGlzKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZWplY3RlZFdpdGgoZGVmYXVsdFdyaXRlckJyYW5kQ2hlY2tFeGNlcHRpb24oJ2Fib3J0JykpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHRoaXMuX293bmVyV3JpdGFibGVTdHJlYW0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChkZWZhdWx0V3JpdGVyTG9ja0V4Y2VwdGlvbignYWJvcnQnKSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyQWJvcnQodGhpcywgcmVhc29uKTsKICAgICAgICB9OwogICAgICAgIFdyaXRhYmxlU3RyZWFtRGVmYXVsdFdyaXRlci5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAoSXNXcml0YWJsZVN0cmVhbURlZmF1bHRXcml0ZXIodGhpcykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVqZWN0ZWRXaXRoKGRlZmF1bHRXcml0ZXJCcmFuZENoZWNrRXhjZXB0aW9uKCdjbG9zZScpKTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBzdHJlYW0gPSB0aGlzLl9vd25lcldyaXRhYmxlU3RyZWFtOwogICAgICAgICAgaWYgKHN0cmVhbSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVqZWN0ZWRXaXRoKGRlZmF1bHRXcml0ZXJMb2NrRXhjZXB0aW9uKCdjbG9zZScpKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChXcml0YWJsZVN0cmVhbUNsb3NlUXVldWVkT3JJbkZsaWdodChzdHJlYW0pID09PSB0cnVlKSB7CiAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVqZWN0ZWRXaXRoKG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjbG9zZSBhbiBhbHJlYWR5LWNsb3Npbmcgc3RyZWFtJykpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIFdyaXRhYmxlU3RyZWFtRGVmYXVsdFdyaXRlckNsb3NlKHRoaXMpOwogICAgICAgIH07CiAgICAgICAgV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyLnByb3RvdHlwZS5yZWxlYXNlTG9jayA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmIChJc1dyaXRhYmxlU3RyZWFtRGVmYXVsdFdyaXRlcih0aGlzKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgdGhyb3cgZGVmYXVsdFdyaXRlckJyYW5kQ2hlY2tFeGNlcHRpb24oJ3JlbGVhc2VMb2NrJyk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgc3RyZWFtID0gdGhpcy5fb3duZXJXcml0YWJsZVN0cmVhbTsKICAgICAgICAgIGlmIChzdHJlYW0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBXcml0YWJsZVN0cmVhbURlZmF1bHRXcml0ZXJSZWxlYXNlKHRoaXMpOwogICAgICAgIH07CiAgICAgICAgV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyLnByb3RvdHlwZS53cml0ZSA9IGZ1bmN0aW9uIChjaHVuaykgewogICAgICAgICAgaWYgKElzV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyKHRoaXMpID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChkZWZhdWx0V3JpdGVyQnJhbmRDaGVja0V4Y2VwdGlvbignd3JpdGUnKSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodGhpcy5fb3duZXJXcml0YWJsZVN0cmVhbSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVqZWN0ZWRXaXRoKGRlZmF1bHRXcml0ZXJMb2NrRXhjZXB0aW9uKCd3cml0ZSB0bycpKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBXcml0YWJsZVN0cmVhbURlZmF1bHRXcml0ZXJXcml0ZSh0aGlzLCBjaHVuayk7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyOwogICAgICB9KCk7CiAgICAgIGZ1bmN0aW9uIElzV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyKHgpIHsKICAgICAgICBpZiAoIXR5cGVJc09iamVjdCh4KSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh4LCAnX293bmVyV3JpdGFibGVTdHJlYW0nKSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBmdW5jdGlvbiBXcml0YWJsZVN0cmVhbURlZmF1bHRXcml0ZXJBYm9ydCh3cml0ZXIsIHJlYXNvbikgewogICAgICAgIHZhciBzdHJlYW0gPSB3cml0ZXIuX293bmVyV3JpdGFibGVTdHJlYW07CiAgICAgICAgcmV0dXJuIFdyaXRhYmxlU3RyZWFtQWJvcnQoc3RyZWFtLCByZWFzb24pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFdyaXRhYmxlU3RyZWFtRGVmYXVsdFdyaXRlckNsb3NlKHdyaXRlcikgewogICAgICAgIHZhciBzdHJlYW0gPSB3cml0ZXIuX293bmVyV3JpdGFibGVTdHJlYW07CiAgICAgICAgcmV0dXJuIFdyaXRhYmxlU3RyZWFtQ2xvc2Uoc3RyZWFtKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBXcml0YWJsZVN0cmVhbURlZmF1bHRXcml0ZXJDbG9zZVdpdGhFcnJvclByb3BhZ2F0aW9uKHdyaXRlcikgewogICAgICAgIHZhciBzdHJlYW0gPSB3cml0ZXIuX293bmVyV3JpdGFibGVTdHJlYW07CiAgICAgICAgdmFyIHN0YXRlID0gc3RyZWFtLl9zdGF0ZTsKICAgICAgICBpZiAoV3JpdGFibGVTdHJlYW1DbG9zZVF1ZXVlZE9ySW5GbGlnaHQoc3RyZWFtKSA9PT0gdHJ1ZSB8fCBzdGF0ZSA9PT0gJ2Nsb3NlZCcpIHsKICAgICAgICAgIHJldHVybiBwcm9taXNlUmVzb2x2ZWRXaXRoKHVuZGVmaW5lZCk7CiAgICAgICAgfQogICAgICAgIGlmIChzdGF0ZSA9PT0gJ2Vycm9yZWQnKSB7CiAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChzdHJlYW0uX3N0b3JlZEVycm9yKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFdyaXRhYmxlU3RyZWFtRGVmYXVsdFdyaXRlckNsb3NlKHdyaXRlcik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyRW5zdXJlQ2xvc2VkUHJvbWlzZVJlamVjdGVkKHdyaXRlciwgZXJyb3IpIHsKICAgICAgICBpZiAod3JpdGVyLl9jbG9zZWRQcm9taXNlU3RhdGUgPT09ICdwZW5kaW5nJykgewogICAgICAgICAgZGVmYXVsdFdyaXRlckNsb3NlZFByb21pc2VSZWplY3Qod3JpdGVyLCBlcnJvcik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRlZmF1bHRXcml0ZXJDbG9zZWRQcm9taXNlUmVzZXRUb1JlamVjdGVkKHdyaXRlciwgZXJyb3IpOwogICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiBXcml0YWJsZVN0cmVhbURlZmF1bHRXcml0ZXJFbnN1cmVSZWFkeVByb21pc2VSZWplY3RlZCh3cml0ZXIsIGVycm9yKSB7CiAgICAgICAgaWYgKHdyaXRlci5fcmVhZHlQcm9taXNlU3RhdGUgPT09ICdwZW5kaW5nJykgewogICAgICAgICAgZGVmYXVsdFdyaXRlclJlYWR5UHJvbWlzZVJlamVjdCh3cml0ZXIsIGVycm9yKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGVmYXVsdFdyaXRlclJlYWR5UHJvbWlzZVJlc2V0VG9SZWplY3RlZCh3cml0ZXIsIGVycm9yKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyR2V0RGVzaXJlZFNpemUod3JpdGVyKSB7CiAgICAgICAgdmFyIHN0cmVhbSA9IHdyaXRlci5fb3duZXJXcml0YWJsZVN0cmVhbTsKICAgICAgICB2YXIgc3RhdGUgPSBzdHJlYW0uX3N0YXRlOwogICAgICAgIGlmIChzdGF0ZSA9PT0gJ2Vycm9yZWQnIHx8IHN0YXRlID09PSAnZXJyb3JpbmcnKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgaWYgKHN0YXRlID09PSAnY2xvc2VkJykgewogICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHJldHVybiBXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyR2V0RGVzaXJlZFNpemUoc3RyZWFtLl93cml0YWJsZVN0cmVhbUNvbnRyb2xsZXIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFdyaXRhYmxlU3RyZWFtRGVmYXVsdFdyaXRlclJlbGVhc2Uod3JpdGVyKSB7CiAgICAgICAgdmFyIHN0cmVhbSA9IHdyaXRlci5fb3duZXJXcml0YWJsZVN0cmVhbTsKICAgICAgICB2YXIgcmVsZWFzZWRFcnJvciA9IG5ldyBUeXBlRXJyb3IoJ1dyaXRlciB3YXMgcmVsZWFzZWQgYW5kIGNhbiBubyBsb25nZXIgYmUgdXNlZCB0byBtb25pdG9yIHRoZSBzdHJlYW1cJ3MgY2xvc2VkbmVzcycpOwogICAgICAgIFdyaXRhYmxlU3RyZWFtRGVmYXVsdFdyaXRlckVuc3VyZVJlYWR5UHJvbWlzZVJlamVjdGVkKHdyaXRlciwgcmVsZWFzZWRFcnJvcik7CiAgICAgICAgV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyRW5zdXJlQ2xvc2VkUHJvbWlzZVJlamVjdGVkKHdyaXRlciwgcmVsZWFzZWRFcnJvcik7CiAgICAgICAgc3RyZWFtLl93cml0ZXIgPSB1bmRlZmluZWQ7CiAgICAgICAgd3JpdGVyLl9vd25lcldyaXRhYmxlU3RyZWFtID0gdW5kZWZpbmVkOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFdyaXRhYmxlU3RyZWFtRGVmYXVsdFdyaXRlcldyaXRlKHdyaXRlciwgY2h1bmspIHsKICAgICAgICB2YXIgc3RyZWFtID0gd3JpdGVyLl9vd25lcldyaXRhYmxlU3RyZWFtOwogICAgICAgIHZhciBjb250cm9sbGVyID0gc3RyZWFtLl93cml0YWJsZVN0cmVhbUNvbnRyb2xsZXI7CiAgICAgICAgdmFyIGNodW5rU2l6ZSA9IFdyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJHZXRDaHVua1NpemUoY29udHJvbGxlciwgY2h1bmspOwogICAgICAgIGlmIChzdHJlYW0gIT09IHdyaXRlci5fb3duZXJXcml0YWJsZVN0cmVhbSkgewogICAgICAgICAgcmV0dXJuIHByb21pc2VSZWplY3RlZFdpdGgoZGVmYXVsdFdyaXRlckxvY2tFeGNlcHRpb24oJ3dyaXRlIHRvJykpOwogICAgICAgIH0KICAgICAgICB2YXIgc3RhdGUgPSBzdHJlYW0uX3N0YXRlOwogICAgICAgIGlmIChzdGF0ZSA9PT0gJ2Vycm9yZWQnKSB7CiAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChzdHJlYW0uX3N0b3JlZEVycm9yKTsKICAgICAgICB9CiAgICAgICAgaWYgKFdyaXRhYmxlU3RyZWFtQ2xvc2VRdWV1ZWRPckluRmxpZ2h0KHN0cmVhbSkgPT09IHRydWUgfHwgc3RhdGUgPT09ICdjbG9zZWQnKSB7CiAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChuZXcgVHlwZUVycm9yKCdUaGUgc3RyZWFtIGlzIGNsb3Npbmcgb3IgY2xvc2VkIGFuZCBjYW5ub3QgYmUgd3JpdHRlbiB0bycpKTsKICAgICAgICB9CiAgICAgICAgaWYgKHN0YXRlID09PSAnZXJyb3JpbmcnKSB7CiAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChzdHJlYW0uX3N0b3JlZEVycm9yKTsKICAgICAgICB9CiAgICAgICAgdmFyIHByb21pc2UgPSBXcml0YWJsZVN0cmVhbUFkZFdyaXRlUmVxdWVzdChzdHJlYW0pOwogICAgICAgIFdyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJXcml0ZShjb250cm9sbGVyLCBjaHVuaywgY2h1bmtTaXplKTsKICAgICAgICByZXR1cm4gcHJvbWlzZTsKICAgICAgfQogICAgICB2YXIgV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyKCkgewogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlciBjYW5ub3QgYmUgY29uc3RydWN0ZWQgZXhwbGljaXRseScpOwogICAgICAgIH0KICAgICAgICBXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBpZiAoSXNXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyKHRoaXMpID09PSBmYWxzZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyLnByb3RvdHlwZS5lcnJvciBjYW4gb25seSBiZSB1c2VkIG9uIGEgV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlcicpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHN0YXRlID0gdGhpcy5fY29udHJvbGxlZFdyaXRhYmxlU3RyZWFtLl9zdGF0ZTsKICAgICAgICAgIGlmIChzdGF0ZSAhPT0gJ3dyaXRhYmxlJykgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyRXJyb3IodGhpcywgZSk7CiAgICAgICAgfTsKICAgICAgICBXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyLnByb3RvdHlwZVtBYm9ydFN0ZXBzXSA9IGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgIHZhciByZXN1bHQgPSB0aGlzLl9hYm9ydEFsZ29yaXRobShyZWFzb24pOwogICAgICAgICAgV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckNsZWFyQWxnb3JpdGhtcyh0aGlzKTsKICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfTsKICAgICAgICBXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyLnByb3RvdHlwZVtFcnJvclN0ZXBzXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIFJlc2V0UXVldWUodGhpcyk7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlcjsKICAgICAgfSgpOwogICAgICBmdW5jdGlvbiBJc1dyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXIoeCkgewogICAgICAgIGlmICghdHlwZUlzT2JqZWN0KHgpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmICghT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHgsICdfY29udHJvbGxlZFdyaXRhYmxlU3RyZWFtJykpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gU2V0VXBXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyKHN0cmVhbSwgY29udHJvbGxlciwgc3RhcnRBbGdvcml0aG0sIHdyaXRlQWxnb3JpdGhtLCBjbG9zZUFsZ29yaXRobSwgYWJvcnRBbGdvcml0aG0sIGhpZ2hXYXRlck1hcmssIHNpemVBbGdvcml0aG0pIHsKICAgICAgICBjb250cm9sbGVyLl9jb250cm9sbGVkV3JpdGFibGVTdHJlYW0gPSBzdHJlYW07CiAgICAgICAgc3RyZWFtLl93cml0YWJsZVN0cmVhbUNvbnRyb2xsZXIgPSBjb250cm9sbGVyOwogICAgICAgIGNvbnRyb2xsZXIuX3F1ZXVlID0gdW5kZWZpbmVkOwogICAgICAgIGNvbnRyb2xsZXIuX3F1ZXVlVG90YWxTaXplID0gdW5kZWZpbmVkOwogICAgICAgIFJlc2V0UXVldWUoY29udHJvbGxlcik7CiAgICAgICAgY29udHJvbGxlci5fc3RhcnRlZCA9IGZhbHNlOwogICAgICAgIGNvbnRyb2xsZXIuX3N0cmF0ZWd5U2l6ZUFsZ29yaXRobSA9IHNpemVBbGdvcml0aG07CiAgICAgICAgY29udHJvbGxlci5fc3RyYXRlZ3lIV00gPSBoaWdoV2F0ZXJNYXJrOwogICAgICAgIGNvbnRyb2xsZXIuX3dyaXRlQWxnb3JpdGhtID0gd3JpdGVBbGdvcml0aG07CiAgICAgICAgY29udHJvbGxlci5fY2xvc2VBbGdvcml0aG0gPSBjbG9zZUFsZ29yaXRobTsKICAgICAgICBjb250cm9sbGVyLl9hYm9ydEFsZ29yaXRobSA9IGFib3J0QWxnb3JpdGhtOwogICAgICAgIHZhciBiYWNrcHJlc3N1cmUgPSBXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyR2V0QmFja3ByZXNzdXJlKGNvbnRyb2xsZXIpOwogICAgICAgIFdyaXRhYmxlU3RyZWFtVXBkYXRlQmFja3ByZXNzdXJlKHN0cmVhbSwgYmFja3ByZXNzdXJlKTsKICAgICAgICB2YXIgc3RhcnRSZXN1bHQgPSBzdGFydEFsZ29yaXRobSgpOwogICAgICAgIHZhciBzdGFydFByb21pc2UgPSBwcm9taXNlUmVzb2x2ZWRXaXRoKHN0YXJ0UmVzdWx0KTsKICAgICAgICB1cG9uUHJvbWlzZShzdGFydFByb21pc2UsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGNvbnRyb2xsZXIuX3N0YXJ0ZWQgPSB0cnVlOwogICAgICAgICAgV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckFkdmFuY2VRdWV1ZUlmTmVlZGVkKGNvbnRyb2xsZXIpOwogICAgICAgIH0sIGZ1bmN0aW9uIChyKSB7CiAgICAgICAgICBjb250cm9sbGVyLl9zdGFydGVkID0gdHJ1ZTsKICAgICAgICAgIFdyaXRhYmxlU3RyZWFtRGVhbFdpdGhSZWplY3Rpb24oc3RyZWFtLCByKTsKICAgICAgICB9KTsKICAgICAgfQogICAgICBmdW5jdGlvbiBTZXRVcFdyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJGcm9tVW5kZXJseWluZ1Npbmsoc3RyZWFtLCB1bmRlcmx5aW5nU2luaywgaGlnaFdhdGVyTWFyaywgc2l6ZUFsZ29yaXRobSkgewogICAgICAgIHZhciBjb250cm9sbGVyID0gT2JqZWN0LmNyZWF0ZShXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyLnByb3RvdHlwZSk7CiAgICAgICAgZnVuY3Rpb24gc3RhcnRBbGdvcml0aG0oKSB7CiAgICAgICAgICByZXR1cm4gSW52b2tlT3JOb29wKHVuZGVybHlpbmdTaW5rLCAnc3RhcnQnLCBbY29udHJvbGxlcl0pOwogICAgICAgIH0KICAgICAgICB2YXIgd3JpdGVBbGdvcml0aG0gPSBDcmVhdGVBbGdvcml0aG1Gcm9tVW5kZXJseWluZ01ldGhvZCh1bmRlcmx5aW5nU2luaywgJ3dyaXRlJywgMSwgW2NvbnRyb2xsZXJdKTsKICAgICAgICB2YXIgY2xvc2VBbGdvcml0aG0gPSBDcmVhdGVBbGdvcml0aG1Gcm9tVW5kZXJseWluZ01ldGhvZCh1bmRlcmx5aW5nU2luaywgJ2Nsb3NlJywgMCwgW10pOwogICAgICAgIHZhciBhYm9ydEFsZ29yaXRobSA9IENyZWF0ZUFsZ29yaXRobUZyb21VbmRlcmx5aW5nTWV0aG9kKHVuZGVybHlpbmdTaW5rLCAnYWJvcnQnLCAxLCBbXSk7CiAgICAgICAgU2V0VXBXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyKHN0cmVhbSwgY29udHJvbGxlciwgc3RhcnRBbGdvcml0aG0sIHdyaXRlQWxnb3JpdGhtLCBjbG9zZUFsZ29yaXRobSwgYWJvcnRBbGdvcml0aG0sIGhpZ2hXYXRlck1hcmssIHNpemVBbGdvcml0aG0pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFdyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJDbGVhckFsZ29yaXRobXMoY29udHJvbGxlcikgewogICAgICAgIGNvbnRyb2xsZXIuX3dyaXRlQWxnb3JpdGhtID0gdW5kZWZpbmVkOwogICAgICAgIGNvbnRyb2xsZXIuX2Nsb3NlQWxnb3JpdGhtID0gdW5kZWZpbmVkOwogICAgICAgIGNvbnRyb2xsZXIuX2Fib3J0QWxnb3JpdGhtID0gdW5kZWZpbmVkOwogICAgICAgIGNvbnRyb2xsZXIuX3N0cmF0ZWd5U2l6ZUFsZ29yaXRobSA9IHVuZGVmaW5lZDsKICAgICAgfQogICAgICBmdW5jdGlvbiBXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyQ2xvc2UoY29udHJvbGxlcikgewogICAgICAgIEVucXVldWVWYWx1ZVdpdGhTaXplKGNvbnRyb2xsZXIsICdjbG9zZScsIDApOwogICAgICAgIFdyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJBZHZhbmNlUXVldWVJZk5lZWRlZChjb250cm9sbGVyKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyR2V0Q2h1bmtTaXplKGNvbnRyb2xsZXIsIGNodW5rKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJldHVybiBjb250cm9sbGVyLl9zdHJhdGVneVNpemVBbGdvcml0aG0oY2h1bmspOwogICAgICAgIH0gY2F0Y2ggKGNodW5rU2l6ZUUpIHsKICAgICAgICAgIFdyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJFcnJvcklmTmVlZGVkKGNvbnRyb2xsZXIsIGNodW5rU2l6ZUUpOwogICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIFdyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJHZXREZXNpcmVkU2l6ZShjb250cm9sbGVyKSB7CiAgICAgICAgcmV0dXJuIGNvbnRyb2xsZXIuX3N0cmF0ZWd5SFdNIC0gY29udHJvbGxlci5fcXVldWVUb3RhbFNpemU7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlcldyaXRlKGNvbnRyb2xsZXIsIGNodW5rLCBjaHVua1NpemUpIHsKICAgICAgICB2YXIgd3JpdGVSZWNvcmQgPSB7IGNodW5rOiBjaHVuayB9OwogICAgICAgIHRyeSB7CiAgICAgICAgICBFbnF1ZXVlVmFsdWVXaXRoU2l6ZShjb250cm9sbGVyLCB3cml0ZVJlY29yZCwgY2h1bmtTaXplKTsKICAgICAgICB9IGNhdGNoIChlbnF1ZXVlRSkgewogICAgICAgICAgV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckVycm9ySWZOZWVkZWQoY29udHJvbGxlciwgZW5xdWV1ZUUpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB2YXIgc3RyZWFtID0gY29udHJvbGxlci5fY29udHJvbGxlZFdyaXRhYmxlU3RyZWFtOwogICAgICAgIGlmIChXcml0YWJsZVN0cmVhbUNsb3NlUXVldWVkT3JJbkZsaWdodChzdHJlYW0pID09PSBmYWxzZSAmJiBzdHJlYW0uX3N0YXRlID09PSAnd3JpdGFibGUnKSB7CiAgICAgICAgICB2YXIgYmFja3ByZXNzdXJlID0gV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckdldEJhY2twcmVzc3VyZShjb250cm9sbGVyKTsKICAgICAgICAgIFdyaXRhYmxlU3RyZWFtVXBkYXRlQmFja3ByZXNzdXJlKHN0cmVhbSwgYmFja3ByZXNzdXJlKTsKICAgICAgICB9CiAgICAgICAgV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckFkdmFuY2VRdWV1ZUlmTmVlZGVkKGNvbnRyb2xsZXIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFdyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJBZHZhbmNlUXVldWVJZk5lZWRlZChjb250cm9sbGVyKSB7CiAgICAgICAgdmFyIHN0cmVhbSA9IGNvbnRyb2xsZXIuX2NvbnRyb2xsZWRXcml0YWJsZVN0cmVhbTsKICAgICAgICBpZiAoY29udHJvbGxlci5fc3RhcnRlZCA9PT0gZmFsc2UpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKHN0cmVhbS5faW5GbGlnaHRXcml0ZVJlcXVlc3QgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB2YXIgc3RhdGUgPSBzdHJlYW0uX3N0YXRlOwogICAgICAgIGlmIChzdGF0ZSA9PT0gJ2Vycm9yaW5nJykgewogICAgICAgICAgV3JpdGFibGVTdHJlYW1GaW5pc2hFcnJvcmluZyhzdHJlYW0pOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoY29udHJvbGxlci5fcXVldWUubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHZhciB3cml0ZVJlY29yZCA9IFBlZWtRdWV1ZVZhbHVlKGNvbnRyb2xsZXIpOwogICAgICAgIGlmICh3cml0ZVJlY29yZCA9PT0gJ2Nsb3NlJykgewogICAgICAgICAgV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlclByb2Nlc3NDbG9zZShjb250cm9sbGVyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlclByb2Nlc3NXcml0ZShjb250cm9sbGVyLCB3cml0ZVJlY29yZC5jaHVuayk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIFdyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJFcnJvcklmTmVlZGVkKGNvbnRyb2xsZXIsIGVycm9yKSB7CiAgICAgICAgaWYgKGNvbnRyb2xsZXIuX2NvbnRyb2xsZWRXcml0YWJsZVN0cmVhbS5fc3RhdGUgPT09ICd3cml0YWJsZScpIHsKICAgICAgICAgIFdyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJFcnJvcihjb250cm9sbGVyLCBlcnJvcik7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIFdyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJQcm9jZXNzQ2xvc2UoY29udHJvbGxlcikgewogICAgICAgIHZhciBzdHJlYW0gPSBjb250cm9sbGVyLl9jb250cm9sbGVkV3JpdGFibGVTdHJlYW07CiAgICAgICAgV3JpdGFibGVTdHJlYW1NYXJrQ2xvc2VSZXF1ZXN0SW5GbGlnaHQoc3RyZWFtKTsKICAgICAgICBEZXF1ZXVlVmFsdWUoY29udHJvbGxlcik7CiAgICAgICAgdmFyIHNpbmtDbG9zZVByb21pc2UgPSBjb250cm9sbGVyLl9jbG9zZUFsZ29yaXRobSgpOwogICAgICAgIFdyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJDbGVhckFsZ29yaXRobXMoY29udHJvbGxlcik7CiAgICAgICAgdXBvblByb21pc2Uoc2lua0Nsb3NlUHJvbWlzZSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgV3JpdGFibGVTdHJlYW1GaW5pc2hJbkZsaWdodENsb3NlKHN0cmVhbSk7CiAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgV3JpdGFibGVTdHJlYW1GaW5pc2hJbkZsaWdodENsb3NlV2l0aEVycm9yKHN0cmVhbSwgcmVhc29uKTsKICAgICAgICB9KTsKICAgICAgfQogICAgICBmdW5jdGlvbiBXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyUHJvY2Vzc1dyaXRlKGNvbnRyb2xsZXIsIGNodW5rKSB7CiAgICAgICAgdmFyIHN0cmVhbSA9IGNvbnRyb2xsZXIuX2NvbnRyb2xsZWRXcml0YWJsZVN0cmVhbTsKICAgICAgICBXcml0YWJsZVN0cmVhbU1hcmtGaXJzdFdyaXRlUmVxdWVzdEluRmxpZ2h0KHN0cmVhbSk7CiAgICAgICAgdmFyIHNpbmtXcml0ZVByb21pc2UgPSBjb250cm9sbGVyLl93cml0ZUFsZ29yaXRobShjaHVuayk7CiAgICAgICAgdXBvblByb21pc2Uoc2lua1dyaXRlUHJvbWlzZSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgV3JpdGFibGVTdHJlYW1GaW5pc2hJbkZsaWdodFdyaXRlKHN0cmVhbSk7CiAgICAgICAgICB2YXIgc3RhdGUgPSBzdHJlYW0uX3N0YXRlOwogICAgICAgICAgRGVxdWV1ZVZhbHVlKGNvbnRyb2xsZXIpOwogICAgICAgICAgaWYgKFdyaXRhYmxlU3RyZWFtQ2xvc2VRdWV1ZWRPckluRmxpZ2h0KHN0cmVhbSkgPT09IGZhbHNlICYmIHN0YXRlID09PSAnd3JpdGFibGUnKSB7CiAgICAgICAgICAgIHZhciBiYWNrcHJlc3N1cmUgPSBXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyR2V0QmFja3ByZXNzdXJlKGNvbnRyb2xsZXIpOwogICAgICAgICAgICBXcml0YWJsZVN0cmVhbVVwZGF0ZUJhY2twcmVzc3VyZShzdHJlYW0sIGJhY2twcmVzc3VyZSk7CiAgICAgICAgICB9CiAgICAgICAgICBXcml0YWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyQWR2YW5jZVF1ZXVlSWZOZWVkZWQoY29udHJvbGxlcik7CiAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgaWYgKHN0cmVhbS5fc3RhdGUgPT09ICd3cml0YWJsZScpIHsKICAgICAgICAgICAgV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckNsZWFyQWxnb3JpdGhtcyhjb250cm9sbGVyKTsKICAgICAgICAgIH0KICAgICAgICAgIFdyaXRhYmxlU3RyZWFtRmluaXNoSW5GbGlnaHRXcml0ZVdpdGhFcnJvcihzdHJlYW0sIHJlYXNvbik7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckdldEJhY2twcmVzc3VyZShjb250cm9sbGVyKSB7CiAgICAgICAgdmFyIGRlc2lyZWRTaXplID0gV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckdldERlc2lyZWRTaXplKGNvbnRyb2xsZXIpOwogICAgICAgIHJldHVybiBkZXNpcmVkU2l6ZSA8PSAwOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFdyaXRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJFcnJvcihjb250cm9sbGVyLCBlcnJvcikgewogICAgICAgIHZhciBzdHJlYW0gPSBjb250cm9sbGVyLl9jb250cm9sbGVkV3JpdGFibGVTdHJlYW07CiAgICAgICAgV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckNsZWFyQWxnb3JpdGhtcyhjb250cm9sbGVyKTsKICAgICAgICBXcml0YWJsZVN0cmVhbVN0YXJ0RXJyb3Jpbmcoc3RyZWFtLCBlcnJvcik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gc3RyZWFtQnJhbmRDaGVja0V4Y2VwdGlvbihuYW1lKSB7CiAgICAgICAgcmV0dXJuIG5ldyBUeXBlRXJyb3IoIldyaXRhYmxlU3RyZWFtLnByb3RvdHlwZS4iICsgbmFtZSArICIgY2FuIG9ubHkgYmUgdXNlZCBvbiBhIFdyaXRhYmxlU3RyZWFtIik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZGVmYXVsdFdyaXRlckJyYW5kQ2hlY2tFeGNlcHRpb24obmFtZSkgewogICAgICAgIHJldHVybiBuZXcgVHlwZUVycm9yKCJXcml0YWJsZVN0cmVhbURlZmF1bHRXcml0ZXIucHJvdG90eXBlLiIgKyBuYW1lICsgIiBjYW4gb25seSBiZSB1c2VkIG9uIGEgV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyIik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZGVmYXVsdFdyaXRlckxvY2tFeGNlcHRpb24obmFtZSkgewogICAgICAgIHJldHVybiBuZXcgVHlwZUVycm9yKCdDYW5ub3QgJyArIG5hbWUgKyAnIGEgc3RyZWFtIHVzaW5nIGEgcmVsZWFzZWQgd3JpdGVyJyk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZGVmYXVsdFdyaXRlckNsb3NlZFByb21pc2VJbml0aWFsaXplKHdyaXRlcikgewogICAgICAgIHdyaXRlci5fY2xvc2VkUHJvbWlzZSA9IG5ld1Byb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgd3JpdGVyLl9jbG9zZWRQcm9taXNlX3Jlc29sdmUgPSByZXNvbHZlOwogICAgICAgICAgd3JpdGVyLl9jbG9zZWRQcm9taXNlX3JlamVjdCA9IHJlamVjdDsKICAgICAgICAgIHdyaXRlci5fY2xvc2VkUHJvbWlzZVN0YXRlID0gJ3BlbmRpbmcnOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGRlZmF1bHRXcml0ZXJDbG9zZWRQcm9taXNlSW5pdGlhbGl6ZUFzUmVqZWN0ZWQod3JpdGVyLCByZWFzb24pIHsKICAgICAgICBkZWZhdWx0V3JpdGVyQ2xvc2VkUHJvbWlzZUluaXRpYWxpemUod3JpdGVyKTsKICAgICAgICBkZWZhdWx0V3JpdGVyQ2xvc2VkUHJvbWlzZVJlamVjdCh3cml0ZXIsIHJlYXNvbik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZGVmYXVsdFdyaXRlckNsb3NlZFByb21pc2VJbml0aWFsaXplQXNSZXNvbHZlZCh3cml0ZXIpIHsKICAgICAgICBkZWZhdWx0V3JpdGVyQ2xvc2VkUHJvbWlzZUluaXRpYWxpemUod3JpdGVyKTsKICAgICAgICBkZWZhdWx0V3JpdGVyQ2xvc2VkUHJvbWlzZVJlc29sdmUod3JpdGVyKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBkZWZhdWx0V3JpdGVyQ2xvc2VkUHJvbWlzZVJlamVjdCh3cml0ZXIsIHJlYXNvbikgewogICAgICAgIHNldFByb21pc2VJc0hhbmRsZWRUb1RydWUod3JpdGVyLl9jbG9zZWRQcm9taXNlKTsKICAgICAgICB3cml0ZXIuX2Nsb3NlZFByb21pc2VfcmVqZWN0KHJlYXNvbik7CiAgICAgICAgd3JpdGVyLl9jbG9zZWRQcm9taXNlX3Jlc29sdmUgPSB1bmRlZmluZWQ7CiAgICAgICAgd3JpdGVyLl9jbG9zZWRQcm9taXNlX3JlamVjdCA9IHVuZGVmaW5lZDsKICAgICAgICB3cml0ZXIuX2Nsb3NlZFByb21pc2VTdGF0ZSA9ICdyZWplY3RlZCc7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZGVmYXVsdFdyaXRlckNsb3NlZFByb21pc2VSZXNldFRvUmVqZWN0ZWQod3JpdGVyLCByZWFzb24pIHsKICAgICAgICBkZWZhdWx0V3JpdGVyQ2xvc2VkUHJvbWlzZUluaXRpYWxpemVBc1JlamVjdGVkKHdyaXRlciwgcmVhc29uKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBkZWZhdWx0V3JpdGVyQ2xvc2VkUHJvbWlzZVJlc29sdmUod3JpdGVyKSB7CiAgICAgICAgd3JpdGVyLl9jbG9zZWRQcm9taXNlX3Jlc29sdmUodW5kZWZpbmVkKTsKICAgICAgICB3cml0ZXIuX2Nsb3NlZFByb21pc2VfcmVzb2x2ZSA9IHVuZGVmaW5lZDsKICAgICAgICB3cml0ZXIuX2Nsb3NlZFByb21pc2VfcmVqZWN0ID0gdW5kZWZpbmVkOwogICAgICAgIHdyaXRlci5fY2xvc2VkUHJvbWlzZVN0YXRlID0gJ3Jlc29sdmVkJzsKICAgICAgfQogICAgICBmdW5jdGlvbiBkZWZhdWx0V3JpdGVyUmVhZHlQcm9taXNlSW5pdGlhbGl6ZSh3cml0ZXIpIHsKICAgICAgICB3cml0ZXIuX3JlYWR5UHJvbWlzZSA9IG5ld1Byb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgd3JpdGVyLl9yZWFkeVByb21pc2VfcmVzb2x2ZSA9IHJlc29sdmU7CiAgICAgICAgICB3cml0ZXIuX3JlYWR5UHJvbWlzZV9yZWplY3QgPSByZWplY3Q7CiAgICAgICAgfSk7CiAgICAgICAgd3JpdGVyLl9yZWFkeVByb21pc2VTdGF0ZSA9ICdwZW5kaW5nJzsKICAgICAgfQogICAgICBmdW5jdGlvbiBkZWZhdWx0V3JpdGVyUmVhZHlQcm9taXNlSW5pdGlhbGl6ZUFzUmVqZWN0ZWQod3JpdGVyLCByZWFzb24pIHsKICAgICAgICBkZWZhdWx0V3JpdGVyUmVhZHlQcm9taXNlSW5pdGlhbGl6ZSh3cml0ZXIpOwogICAgICAgIGRlZmF1bHRXcml0ZXJSZWFkeVByb21pc2VSZWplY3Qod3JpdGVyLCByZWFzb24pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGRlZmF1bHRXcml0ZXJSZWFkeVByb21pc2VJbml0aWFsaXplQXNSZXNvbHZlZCh3cml0ZXIpIHsKICAgICAgICBkZWZhdWx0V3JpdGVyUmVhZHlQcm9taXNlSW5pdGlhbGl6ZSh3cml0ZXIpOwogICAgICAgIGRlZmF1bHRXcml0ZXJSZWFkeVByb21pc2VSZXNvbHZlKHdyaXRlcik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZGVmYXVsdFdyaXRlclJlYWR5UHJvbWlzZVJlamVjdCh3cml0ZXIsIHJlYXNvbikgewogICAgICAgIHNldFByb21pc2VJc0hhbmRsZWRUb1RydWUod3JpdGVyLl9yZWFkeVByb21pc2UpOwogICAgICAgIHdyaXRlci5fcmVhZHlQcm9taXNlX3JlamVjdChyZWFzb24pOwogICAgICAgIHdyaXRlci5fcmVhZHlQcm9taXNlX3Jlc29sdmUgPSB1bmRlZmluZWQ7CiAgICAgICAgd3JpdGVyLl9yZWFkeVByb21pc2VfcmVqZWN0ID0gdW5kZWZpbmVkOwogICAgICAgIHdyaXRlci5fcmVhZHlQcm9taXNlU3RhdGUgPSAncmVqZWN0ZWQnOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGRlZmF1bHRXcml0ZXJSZWFkeVByb21pc2VSZXNldCh3cml0ZXIpIHsKICAgICAgICBkZWZhdWx0V3JpdGVyUmVhZHlQcm9taXNlSW5pdGlhbGl6ZSh3cml0ZXIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGRlZmF1bHRXcml0ZXJSZWFkeVByb21pc2VSZXNldFRvUmVqZWN0ZWQod3JpdGVyLCByZWFzb24pIHsKICAgICAgICBkZWZhdWx0V3JpdGVyUmVhZHlQcm9taXNlSW5pdGlhbGl6ZUFzUmVqZWN0ZWQod3JpdGVyLCByZWFzb24pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGRlZmF1bHRXcml0ZXJSZWFkeVByb21pc2VSZXNvbHZlKHdyaXRlcikgewogICAgICAgIHdyaXRlci5fcmVhZHlQcm9taXNlX3Jlc29sdmUodW5kZWZpbmVkKTsKICAgICAgICB3cml0ZXIuX3JlYWR5UHJvbWlzZV9yZXNvbHZlID0gdW5kZWZpbmVkOwogICAgICAgIHdyaXRlci5fcmVhZHlQcm9taXNlX3JlamVjdCA9IHVuZGVmaW5lZDsKICAgICAgICB3cml0ZXIuX3JlYWR5UHJvbWlzZVN0YXRlID0gJ2Z1bGZpbGxlZCc7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gaXNBYm9ydFNpZ25hbCh2YWx1ZSkgewogICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdvYmplY3QnIHx8IHZhbHVlID09PSBudWxsKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHRyeSB7CiAgICAgICAgICByZXR1cm4gdHlwZW9mIHZhbHVlLmFib3J0ZWQgPT09ICdib29sZWFuJzsKICAgICAgICB9IGNhdGNoIChfYSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgICB2YXIgTmF0aXZlRE9NRXhjZXB0aW9uID0gdHlwZW9mIERPTUV4Y2VwdGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyBET01FeGNlcHRpb24gOiB1bmRlZmluZWQ7CiAgICAgIGZ1bmN0aW9uIGlzRE9NRXhjZXB0aW9uQ29uc3RydWN0b3IoY3RvcikgewogICAgICAgIGlmICghKHR5cGVvZiBjdG9yID09PSAnZnVuY3Rpb24nIHx8IHR5cGVvZiBjdG9yID09PSAnb2JqZWN0JykpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgdHJ5IHsKICAgICAgICAgIG5ldyBjdG9yKCk7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGNhdGNoIChfYSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiBjcmVhdGVET01FeGNlcHRpb25Qb2x5ZmlsbCgpIHsKICAgICAgICB2YXIgY3RvciA9IGZ1bmN0aW9uIERPTUV4Y2VwdGlvbihtZXNzYWdlLCBuYW1lKSB7CiAgICAgICAgICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlIHx8ICcnOwogICAgICAgICAgdGhpcy5uYW1lID0gbmFtZSB8fCAnRXJyb3InOwogICAgICAgICAgaWYgKEVycm9yLmNhcHR1cmVTdGFja1RyYWNlKSB7CiAgICAgICAgICAgIEVycm9yLmNhcHR1cmVTdGFja1RyYWNlKHRoaXMsIHRoaXMuY29uc3RydWN0b3IpOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgY3Rvci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEVycm9yLnByb3RvdHlwZSk7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGN0b3IucHJvdG90eXBlLCAnY29uc3RydWN0b3InLCB7CiAgICAgICAgICB2YWx1ZTogY3RvciwKICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGN0b3I7CiAgICAgIH0KICAgICAgdmFyIERPTUV4Y2VwdGlvbiQxID0gaXNET01FeGNlcHRpb25Db25zdHJ1Y3RvcihOYXRpdmVET01FeGNlcHRpb24pID8gTmF0aXZlRE9NRXhjZXB0aW9uIDogY3JlYXRlRE9NRXhjZXB0aW9uUG9seWZpbGwoKTsKICAgICAgZnVuY3Rpb24gUmVhZGFibGVTdHJlYW1QaXBlVG8oc291cmNlLCBkZXN0LCBwcmV2ZW50Q2xvc2UsIHByZXZlbnRBYm9ydCwgcHJldmVudENhbmNlbCwgc2lnbmFsKSB7CiAgICAgICAgdmFyIHJlYWRlciA9IEFjcXVpcmVSZWFkYWJsZVN0cmVhbURlZmF1bHRSZWFkZXIoc291cmNlKTsKICAgICAgICB2YXIgd3JpdGVyID0gQWNxdWlyZVdyaXRhYmxlU3RyZWFtRGVmYXVsdFdyaXRlcihkZXN0KTsKICAgICAgICBzb3VyY2UuX2Rpc3R1cmJlZCA9IHRydWU7CiAgICAgICAgdmFyIHNodXR0aW5nRG93biA9IGZhbHNlOwogICAgICAgIHZhciBjdXJyZW50V3JpdGUgPSBwcm9taXNlUmVzb2x2ZWRXaXRoKHVuZGVmaW5lZCk7CiAgICAgICAgcmV0dXJuIG5ld1Byb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgdmFyIGFib3J0QWxnb3JpdGhtOwogICAgICAgICAgaWYgKHNpZ25hbCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGFib3J0QWxnb3JpdGhtID0gZnVuY3Rpb24gYWJvcnRBbGdvcml0aG0oKSB7CiAgICAgICAgICAgICAgdmFyIGVycm9yID0gbmV3IERPTUV4Y2VwdGlvbiQxKCdBYm9ydGVkJywgJ0Fib3J0RXJyb3InKTsKICAgICAgICAgICAgICB2YXIgYWN0aW9ucyA9IFtdOwogICAgICAgICAgICAgIGlmIChwcmV2ZW50QWJvcnQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICBhY3Rpb25zLnB1c2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICBpZiAoZGVzdC5fc3RhdGUgPT09ICd3cml0YWJsZScpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gV3JpdGFibGVTdHJlYW1BYm9ydChkZXN0LCBlcnJvcik7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZXNvbHZlZFdpdGgodW5kZWZpbmVkKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAocHJldmVudENhbmNlbCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIGFjdGlvbnMucHVzaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIGlmIChzb3VyY2UuX3N0YXRlID09PSAncmVhZGFibGUnKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFJlYWRhYmxlU3RyZWFtQ2FuY2VsKHNvdXJjZSwgZXJyb3IpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVzb2x2ZWRXaXRoKHVuZGVmaW5lZCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgc2h1dGRvd25XaXRoQWN0aW9uKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLmFsbChhY3Rpb25zLm1hcChmdW5jdGlvbiAoYWN0aW9uKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBhY3Rpb24oKTsKICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICB9LCB0cnVlLCBlcnJvcik7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmIChzaWduYWwuYWJvcnRlZCA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgIGFib3J0QWxnb3JpdGhtKCk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNpZ25hbC5hZGRFdmVudExpc3RlbmVyKCdhYm9ydCcsIGFib3J0QWxnb3JpdGhtKTsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIHBpcGVMb29wKCkgewogICAgICAgICAgICByZXR1cm4gbmV3UHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZUxvb3AsIHJlamVjdExvb3ApIHsKICAgICAgICAgICAgICBmdW5jdGlvbiBuZXh0KGRvbmUpIHsKICAgICAgICAgICAgICAgIGlmIChkb25lKSB7CiAgICAgICAgICAgICAgICAgIHJlc29sdmVMb29wKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBQZXJmb3JtUHJvbWlzZVRoZW4ocGlwZVN0ZXAoKSwgbmV4dCwgcmVqZWN0TG9vcCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIG5leHQoZmFsc2UpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIHBpcGVTdGVwKCkgewogICAgICAgICAgICBpZiAoc2h1dHRpbmdEb3duID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZXNvbHZlZFdpdGgodHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIFBlcmZvcm1Qcm9taXNlVGhlbih3cml0ZXIuX3JlYWR5UHJvbWlzZSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiBQZXJmb3JtUHJvbWlzZVRoZW4oUmVhZGFibGVTdHJlYW1EZWZhdWx0UmVhZGVyUmVhZChyZWFkZXIpLCBmdW5jdGlvbiAoX2EpIHsKICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IF9hLnZhbHVlLGRvbmUgPSBfYS5kb25lOwogICAgICAgICAgICAgICAgaWYgKGRvbmUgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjdXJyZW50V3JpdGUgPSBQZXJmb3JtUHJvbWlzZVRoZW4oV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyV3JpdGUod3JpdGVyLCB2YWx1ZSksIHVuZGVmaW5lZCwgbm9vcCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgaXNPckJlY29tZXNFcnJvcmVkKHNvdXJjZSwgcmVhZGVyLl9jbG9zZWRQcm9taXNlLCBmdW5jdGlvbiAoc3RvcmVkRXJyb3IpIHsKICAgICAgICAgICAgaWYgKHByZXZlbnRBYm9ydCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICBzaHV0ZG93bldpdGhBY3Rpb24oZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIFdyaXRhYmxlU3RyZWFtQWJvcnQoZGVzdCwgc3RvcmVkRXJyb3IpOwogICAgICAgICAgICAgIH0sIHRydWUsIHN0b3JlZEVycm9yKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBzaHV0ZG93bih0cnVlLCBzdG9yZWRFcnJvcik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgaXNPckJlY29tZXNFcnJvcmVkKGRlc3QsIHdyaXRlci5fY2xvc2VkUHJvbWlzZSwgZnVuY3Rpb24gKHN0b3JlZEVycm9yKSB7CiAgICAgICAgICAgIGlmIChwcmV2ZW50Q2FuY2VsID09PSBmYWxzZSkgewogICAgICAgICAgICAgIHNodXRkb3duV2l0aEFjdGlvbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gUmVhZGFibGVTdHJlYW1DYW5jZWwoc291cmNlLCBzdG9yZWRFcnJvcik7CiAgICAgICAgICAgICAgfSwgdHJ1ZSwgc3RvcmVkRXJyb3IpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHNodXRkb3duKHRydWUsIHN0b3JlZEVycm9yKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICBpc09yQmVjb21lc0Nsb3NlZChzb3VyY2UsIHJlYWRlci5fY2xvc2VkUHJvbWlzZSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAocHJldmVudENsb3NlID09PSBmYWxzZSkgewogICAgICAgICAgICAgIHNodXRkb3duV2l0aEFjdGlvbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gV3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyQ2xvc2VXaXRoRXJyb3JQcm9wYWdhdGlvbih3cml0ZXIpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHNodXRkb3duKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgaWYgKFdyaXRhYmxlU3RyZWFtQ2xvc2VRdWV1ZWRPckluRmxpZ2h0KGRlc3QpID09PSB0cnVlIHx8IGRlc3QuX3N0YXRlID09PSAnY2xvc2VkJykgewogICAgICAgICAgICB2YXIgZGVzdENsb3NlZF8xID0gbmV3IFR5cGVFcnJvcigndGhlIGRlc3RpbmF0aW9uIHdyaXRhYmxlIHN0cmVhbSBjbG9zZWQgYmVmb3JlIGFsbCBkYXRhIGNvdWxkIGJlIHBpcGVkIHRvIGl0Jyk7CiAgICAgICAgICAgIGlmIChwcmV2ZW50Q2FuY2VsID09PSBmYWxzZSkgewogICAgICAgICAgICAgIHNodXRkb3duV2l0aEFjdGlvbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gUmVhZGFibGVTdHJlYW1DYW5jZWwoc291cmNlLCBkZXN0Q2xvc2VkXzEpOwogICAgICAgICAgICAgIH0sIHRydWUsIGRlc3RDbG9zZWRfMSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgc2h1dGRvd24odHJ1ZSwgZGVzdENsb3NlZF8xKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgc2V0UHJvbWlzZUlzSGFuZGxlZFRvVHJ1ZShwaXBlTG9vcCgpKTsKICAgICAgICAgIGZ1bmN0aW9uIHdhaXRGb3JXcml0ZXNUb0ZpbmlzaCgpIHsKICAgICAgICAgICAgdmFyIG9sZEN1cnJlbnRXcml0ZSA9IGN1cnJlbnRXcml0ZTsKICAgICAgICAgICAgcmV0dXJuIFBlcmZvcm1Qcm9taXNlVGhlbihjdXJyZW50V3JpdGUsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4gb2xkQ3VycmVudFdyaXRlICE9PSBjdXJyZW50V3JpdGUgPyB3YWl0Rm9yV3JpdGVzVG9GaW5pc2goKSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBpc09yQmVjb21lc0Vycm9yZWQoc3RyZWFtLCBwcm9taXNlLCBhY3Rpb24pIHsKICAgICAgICAgICAgaWYgKHN0cmVhbS5fc3RhdGUgPT09ICdlcnJvcmVkJykgewogICAgICAgICAgICAgIGFjdGlvbihzdHJlYW0uX3N0b3JlZEVycm9yKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB1cG9uUmVqZWN0aW9uKHByb21pc2UsIGFjdGlvbik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGlzT3JCZWNvbWVzQ2xvc2VkKHN0cmVhbSwgcHJvbWlzZSwgYWN0aW9uKSB7CiAgICAgICAgICAgIGlmIChzdHJlYW0uX3N0YXRlID09PSAnY2xvc2VkJykgewogICAgICAgICAgICAgIGFjdGlvbigpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHVwb25GdWxmaWxsbWVudChwcm9taXNlLCBhY3Rpb24pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBzaHV0ZG93bldpdGhBY3Rpb24oYWN0aW9uLCBvcmlnaW5hbElzRXJyb3IsIG9yaWdpbmFsRXJyb3IpIHsKICAgICAgICAgICAgaWYgKHNodXR0aW5nRG93biA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBzaHV0dGluZ0Rvd24gPSB0cnVlOwogICAgICAgICAgICBpZiAoZGVzdC5fc3RhdGUgPT09ICd3cml0YWJsZScgJiYgV3JpdGFibGVTdHJlYW1DbG9zZVF1ZXVlZE9ySW5GbGlnaHQoZGVzdCkgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgdXBvbkZ1bGZpbGxtZW50KHdhaXRGb3JXcml0ZXNUb0ZpbmlzaCgpLCBkb1RoZVJlc3QpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGRvVGhlUmVzdCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGRvVGhlUmVzdCgpIHsKICAgICAgICAgICAgICB1cG9uUHJvbWlzZShhY3Rpb24oKSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZpbmFsaXplKG9yaWdpbmFsSXNFcnJvciwgb3JpZ2luYWxFcnJvcik7CiAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKG5ld0Vycm9yKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmluYWxpemUodHJ1ZSwgbmV3RXJyb3IpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBzaHV0ZG93bihpc0Vycm9yLCBlcnJvcikgewogICAgICAgICAgICBpZiAoc2h1dHRpbmdEb3duID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNodXR0aW5nRG93biA9IHRydWU7CiAgICAgICAgICAgIGlmIChkZXN0Ll9zdGF0ZSA9PT0gJ3dyaXRhYmxlJyAmJiBXcml0YWJsZVN0cmVhbUNsb3NlUXVldWVkT3JJbkZsaWdodChkZXN0KSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICB1cG9uRnVsZmlsbG1lbnQod2FpdEZvcldyaXRlc1RvRmluaXNoKCksIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmaW5hbGl6ZShpc0Vycm9yLCBlcnJvcik7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZmluYWxpemUoaXNFcnJvciwgZXJyb3IpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBmaW5hbGl6ZShpc0Vycm9yLCBlcnJvcikgewogICAgICAgICAgICBXcml0YWJsZVN0cmVhbURlZmF1bHRXcml0ZXJSZWxlYXNlKHdyaXRlcik7CiAgICAgICAgICAgIFJlYWRhYmxlU3RyZWFtUmVhZGVyR2VuZXJpY1JlbGVhc2UocmVhZGVyKTsKICAgICAgICAgICAgaWYgKHNpZ25hbCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgc2lnbmFsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Fib3J0JywgYWJvcnRBbGdvcml0aG0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChpc0Vycm9yKSB7CiAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByZXNvbHZlKHVuZGVmaW5lZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgICB2YXIgUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyKCkgewogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigpOwogICAgICAgIH0KICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlci5wcm90b3R5cGUsICJkZXNpcmVkU2l6ZSIsIHsKICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICBpZiAoSXNSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyKHRoaXMpID09PSBmYWxzZSkgewogICAgICAgICAgICAgIHRocm93IGRlZmF1bHRDb250cm9sbGVyQnJhbmRDaGVja0V4Y2VwdGlvbignZGVzaXJlZFNpemUnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckdldERlc2lyZWRTaXplKHRoaXMpOwogICAgICAgICAgfSwKICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICB9KTsKICAgICAgICBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmIChJc1JlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXIodGhpcykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRocm93IGRlZmF1bHRDb250cm9sbGVyQnJhbmRDaGVja0V4Y2VwdGlvbignY2xvc2UnKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyQ2FuQ2xvc2VPckVucXVldWUodGhpcykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1RoZSBzdHJlYW0gaXMgbm90IGluIGEgc3RhdGUgdGhhdCBwZXJtaXRzIGNsb3NlJyk7CiAgICAgICAgICB9CiAgICAgICAgICBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyQ2xvc2UodGhpcyk7CiAgICAgICAgfTsKICAgICAgICBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyLnByb3RvdHlwZS5lbnF1ZXVlID0gZnVuY3Rpb24gKGNodW5rKSB7CiAgICAgICAgICBpZiAoSXNSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyKHRoaXMpID09PSBmYWxzZSkgewogICAgICAgICAgICB0aHJvdyBkZWZhdWx0Q29udHJvbGxlckJyYW5kQ2hlY2tFeGNlcHRpb24oJ2VucXVldWUnKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyQ2FuQ2xvc2VPckVucXVldWUodGhpcykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1RoZSBzdHJlYW0gaXMgbm90IGluIGEgc3RhdGUgdGhhdCBwZXJtaXRzIGVucXVldWUnKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyRW5xdWV1ZSh0aGlzLCBjaHVuayk7CiAgICAgICAgfTsKICAgICAgICBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBpZiAoSXNSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyKHRoaXMpID09PSBmYWxzZSkgewogICAgICAgICAgICB0aHJvdyBkZWZhdWx0Q29udHJvbGxlckJyYW5kQ2hlY2tFeGNlcHRpb24oJ2Vycm9yJyk7CiAgICAgICAgICB9CiAgICAgICAgICBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyRXJyb3IodGhpcywgZSk7CiAgICAgICAgfTsKICAgICAgICBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyLnByb3RvdHlwZVtDYW5jZWxTdGVwc10gPSBmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICBSZXNldFF1ZXVlKHRoaXMpOwogICAgICAgICAgdmFyIHJlc3VsdCA9IHRoaXMuX2NhbmNlbEFsZ29yaXRobShyZWFzb24pOwogICAgICAgICAgUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckNsZWFyQWxnb3JpdGhtcyh0aGlzKTsKICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfTsKICAgICAgICBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyLnByb3RvdHlwZVtQdWxsU3RlcHNdID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIHN0cmVhbSA9IHRoaXMuX2NvbnRyb2xsZWRSZWFkYWJsZVN0cmVhbTsKICAgICAgICAgIGlmICh0aGlzLl9xdWV1ZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHZhciBjaHVuayA9IERlcXVldWVWYWx1ZSh0aGlzKTsKICAgICAgICAgICAgaWYgKHRoaXMuX2Nsb3NlUmVxdWVzdGVkID09PSB0cnVlICYmIHRoaXMuX3F1ZXVlLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgIFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJDbGVhckFsZ29yaXRobXModGhpcyk7CiAgICAgICAgICAgICAgUmVhZGFibGVTdHJlYW1DbG9zZShzdHJlYW0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJDYWxsUHVsbElmTmVlZGVkKHRoaXMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVzb2x2ZWRXaXRoKFJlYWRhYmxlU3RyZWFtQ3JlYXRlUmVhZFJlc3VsdChjaHVuaywgZmFsc2UsIHN0cmVhbS5fcmVhZGVyLl9mb3JBdXRob3JDb2RlKSk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgcGVuZGluZ1Byb21pc2UgPSBSZWFkYWJsZVN0cmVhbUFkZFJlYWRSZXF1ZXN0KHN0cmVhbSk7CiAgICAgICAgICBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyQ2FsbFB1bGxJZk5lZWRlZCh0aGlzKTsKICAgICAgICAgIHJldHVybiBwZW5kaW5nUHJvbWlzZTsKICAgICAgICB9OwogICAgICAgIHJldHVybiBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyOwogICAgICB9KCk7CiAgICAgIGZ1bmN0aW9uIElzUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlcih4KSB7CiAgICAgICAgaWYgKCF0eXBlSXNPYmplY3QoeCkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoeCwgJ19jb250cm9sbGVkUmVhZGFibGVTdHJlYW0nKSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBmdW5jdGlvbiBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyQ2FsbFB1bGxJZk5lZWRlZChjb250cm9sbGVyKSB7CiAgICAgICAgdmFyIHNob3VsZFB1bGwgPSBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyU2hvdWxkQ2FsbFB1bGwoY29udHJvbGxlcik7CiAgICAgICAgaWYgKHNob3VsZFB1bGwgPT09IGZhbHNlKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmIChjb250cm9sbGVyLl9wdWxsaW5nID09PSB0cnVlKSB7CiAgICAgICAgICBjb250cm9sbGVyLl9wdWxsQWdhaW4gPSB0cnVlOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb250cm9sbGVyLl9wdWxsaW5nID0gdHJ1ZTsKICAgICAgICB2YXIgcHVsbFByb21pc2UgPSBjb250cm9sbGVyLl9wdWxsQWxnb3JpdGhtKCk7CiAgICAgICAgdXBvblByb21pc2UocHVsbFByb21pc2UsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGNvbnRyb2xsZXIuX3B1bGxpbmcgPSBmYWxzZTsKICAgICAgICAgIGlmIChjb250cm9sbGVyLl9wdWxsQWdhaW4gPT09IHRydWUpIHsKICAgICAgICAgICAgY29udHJvbGxlci5fcHVsbEFnYWluID0gZmFsc2U7CiAgICAgICAgICAgIFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJDYWxsUHVsbElmTmVlZGVkKGNvbnRyb2xsZXIpOwogICAgICAgICAgfQogICAgICAgIH0sIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyRXJyb3IoY29udHJvbGxlciwgZSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlclNob3VsZENhbGxQdWxsKGNvbnRyb2xsZXIpIHsKICAgICAgICB2YXIgc3RyZWFtID0gY29udHJvbGxlci5fY29udHJvbGxlZFJlYWRhYmxlU3RyZWFtOwogICAgICAgIGlmIChSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyQ2FuQ2xvc2VPckVucXVldWUoY29udHJvbGxlcikgPT09IGZhbHNlKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmIChjb250cm9sbGVyLl9zdGFydGVkID09PSBmYWxzZSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoSXNSZWFkYWJsZVN0cmVhbUxvY2tlZChzdHJlYW0pID09PSB0cnVlICYmIFJlYWRhYmxlU3RyZWFtR2V0TnVtUmVhZFJlcXVlc3RzKHN0cmVhbSkgPiAwKSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgdmFyIGRlc2lyZWRTaXplID0gUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckdldERlc2lyZWRTaXplKGNvbnRyb2xsZXIpOwogICAgICAgIGlmIChkZXNpcmVkU2l6ZSA+IDApIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckNsZWFyQWxnb3JpdGhtcyhjb250cm9sbGVyKSB7CiAgICAgICAgY29udHJvbGxlci5fcHVsbEFsZ29yaXRobSA9IHVuZGVmaW5lZDsKICAgICAgICBjb250cm9sbGVyLl9jYW5jZWxBbGdvcml0aG0gPSB1bmRlZmluZWQ7CiAgICAgICAgY29udHJvbGxlci5fc3RyYXRlZ3lTaXplQWxnb3JpdGhtID0gdW5kZWZpbmVkOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJDbG9zZShjb250cm9sbGVyKSB7CiAgICAgICAgdmFyIHN0cmVhbSA9IGNvbnRyb2xsZXIuX2NvbnRyb2xsZWRSZWFkYWJsZVN0cmVhbTsKICAgICAgICBjb250cm9sbGVyLl9jbG9zZVJlcXVlc3RlZCA9IHRydWU7CiAgICAgICAgaWYgKGNvbnRyb2xsZXIuX3F1ZXVlLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckNsZWFyQWxnb3JpdGhtcyhjb250cm9sbGVyKTsKICAgICAgICAgIFJlYWRhYmxlU3RyZWFtQ2xvc2Uoc3RyZWFtKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckVucXVldWUoY29udHJvbGxlciwgY2h1bmspIHsKICAgICAgICB2YXIgc3RyZWFtID0gY29udHJvbGxlci5fY29udHJvbGxlZFJlYWRhYmxlU3RyZWFtOwogICAgICAgIGlmIChJc1JlYWRhYmxlU3RyZWFtTG9ja2VkKHN0cmVhbSkgPT09IHRydWUgJiYgUmVhZGFibGVTdHJlYW1HZXROdW1SZWFkUmVxdWVzdHMoc3RyZWFtKSA+IDApIHsKICAgICAgICAgIFJlYWRhYmxlU3RyZWFtRnVsZmlsbFJlYWRSZXF1ZXN0KHN0cmVhbSwgY2h1bmssIGZhbHNlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIGNodW5rU2l6ZSA9IHZvaWQgMDsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNodW5rU2l6ZSA9IGNvbnRyb2xsZXIuX3N0cmF0ZWd5U2l6ZUFsZ29yaXRobShjaHVuayk7CiAgICAgICAgICB9IGNhdGNoIChjaHVua1NpemVFKSB7CiAgICAgICAgICAgIFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJFcnJvcihjb250cm9sbGVyLCBjaHVua1NpemVFKTsKICAgICAgICAgICAgdGhyb3cgY2h1bmtTaXplRTsKICAgICAgICAgIH0KICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIEVucXVldWVWYWx1ZVdpdGhTaXplKGNvbnRyb2xsZXIsIGNodW5rLCBjaHVua1NpemUpOwogICAgICAgICAgfSBjYXRjaCAoZW5xdWV1ZUUpIHsKICAgICAgICAgICAgUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckVycm9yKGNvbnRyb2xsZXIsIGVucXVldWVFKTsKICAgICAgICAgICAgdGhyb3cgZW5xdWV1ZUU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJDYWxsUHVsbElmTmVlZGVkKGNvbnRyb2xsZXIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJFcnJvcihjb250cm9sbGVyLCBlKSB7CiAgICAgICAgdmFyIHN0cmVhbSA9IGNvbnRyb2xsZXIuX2NvbnRyb2xsZWRSZWFkYWJsZVN0cmVhbTsKICAgICAgICBpZiAoc3RyZWFtLl9zdGF0ZSAhPT0gJ3JlYWRhYmxlJykgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBSZXNldFF1ZXVlKGNvbnRyb2xsZXIpOwogICAgICAgIFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJDbGVhckFsZ29yaXRobXMoY29udHJvbGxlcik7CiAgICAgICAgUmVhZGFibGVTdHJlYW1FcnJvcihzdHJlYW0sIGUpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJHZXREZXNpcmVkU2l6ZShjb250cm9sbGVyKSB7CiAgICAgICAgdmFyIHN0cmVhbSA9IGNvbnRyb2xsZXIuX2NvbnRyb2xsZWRSZWFkYWJsZVN0cmVhbTsKICAgICAgICB2YXIgc3RhdGUgPSBzdHJlYW0uX3N0YXRlOwogICAgICAgIGlmIChzdGF0ZSA9PT0gJ2Vycm9yZWQnKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgaWYgKHN0YXRlID09PSAnY2xvc2VkJykgewogICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHJldHVybiBjb250cm9sbGVyLl9zdHJhdGVneUhXTSAtIGNvbnRyb2xsZXIuX3F1ZXVlVG90YWxTaXplOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJIYXNCYWNrcHJlc3N1cmUoY29udHJvbGxlcikgewogICAgICAgIGlmIChSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyU2hvdWxkQ2FsbFB1bGwoY29udHJvbGxlcikgPT09IHRydWUpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckNhbkNsb3NlT3JFbnF1ZXVlKGNvbnRyb2xsZXIpIHsKICAgICAgICB2YXIgc3RhdGUgPSBjb250cm9sbGVyLl9jb250cm9sbGVkUmVhZGFibGVTdHJlYW0uX3N0YXRlOwogICAgICAgIGlmIChjb250cm9sbGVyLl9jbG9zZVJlcXVlc3RlZCA9PT0gZmFsc2UgJiYgc3RhdGUgPT09ICdyZWFkYWJsZScpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gU2V0VXBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyKHN0cmVhbSwgY29udHJvbGxlciwgc3RhcnRBbGdvcml0aG0sIHB1bGxBbGdvcml0aG0sIGNhbmNlbEFsZ29yaXRobSwgaGlnaFdhdGVyTWFyaywgc2l6ZUFsZ29yaXRobSkgewogICAgICAgIGNvbnRyb2xsZXIuX2NvbnRyb2xsZWRSZWFkYWJsZVN0cmVhbSA9IHN0cmVhbTsKICAgICAgICBjb250cm9sbGVyLl9xdWV1ZSA9IHVuZGVmaW5lZDsKICAgICAgICBjb250cm9sbGVyLl9xdWV1ZVRvdGFsU2l6ZSA9IHVuZGVmaW5lZDsKICAgICAgICBSZXNldFF1ZXVlKGNvbnRyb2xsZXIpOwogICAgICAgIGNvbnRyb2xsZXIuX3N0YXJ0ZWQgPSBmYWxzZTsKICAgICAgICBjb250cm9sbGVyLl9jbG9zZVJlcXVlc3RlZCA9IGZhbHNlOwogICAgICAgIGNvbnRyb2xsZXIuX3B1bGxBZ2FpbiA9IGZhbHNlOwogICAgICAgIGNvbnRyb2xsZXIuX3B1bGxpbmcgPSBmYWxzZTsKICAgICAgICBjb250cm9sbGVyLl9zdHJhdGVneVNpemVBbGdvcml0aG0gPSBzaXplQWxnb3JpdGhtOwogICAgICAgIGNvbnRyb2xsZXIuX3N0cmF0ZWd5SFdNID0gaGlnaFdhdGVyTWFyazsKICAgICAgICBjb250cm9sbGVyLl9wdWxsQWxnb3JpdGhtID0gcHVsbEFsZ29yaXRobTsKICAgICAgICBjb250cm9sbGVyLl9jYW5jZWxBbGdvcml0aG0gPSBjYW5jZWxBbGdvcml0aG07CiAgICAgICAgc3RyZWFtLl9yZWFkYWJsZVN0cmVhbUNvbnRyb2xsZXIgPSBjb250cm9sbGVyOwogICAgICAgIHZhciBzdGFydFJlc3VsdCA9IHN0YXJ0QWxnb3JpdGhtKCk7CiAgICAgICAgdXBvblByb21pc2UocHJvbWlzZVJlc29sdmVkV2l0aChzdGFydFJlc3VsdCksIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGNvbnRyb2xsZXIuX3N0YXJ0ZWQgPSB0cnVlOwogICAgICAgICAgUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckNhbGxQdWxsSWZOZWVkZWQoY29udHJvbGxlcik7CiAgICAgICAgfSwgZnVuY3Rpb24gKHIpIHsKICAgICAgICAgIFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJFcnJvcihjb250cm9sbGVyLCByKTsKICAgICAgICB9KTsKICAgICAgfQogICAgICBmdW5jdGlvbiBTZXRVcFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJGcm9tVW5kZXJseWluZ1NvdXJjZShzdHJlYW0sIHVuZGVybHlpbmdTb3VyY2UsIGhpZ2hXYXRlck1hcmssIHNpemVBbGdvcml0aG0pIHsKICAgICAgICB2YXIgY29udHJvbGxlciA9IE9iamVjdC5jcmVhdGUoUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlci5wcm90b3R5cGUpOwogICAgICAgIGZ1bmN0aW9uIHN0YXJ0QWxnb3JpdGhtKCkgewogICAgICAgICAgcmV0dXJuIEludm9rZU9yTm9vcCh1bmRlcmx5aW5nU291cmNlLCAnc3RhcnQnLCBbY29udHJvbGxlcl0pOwogICAgICAgIH0KICAgICAgICB2YXIgcHVsbEFsZ29yaXRobSA9IENyZWF0ZUFsZ29yaXRobUZyb21VbmRlcmx5aW5nTWV0aG9kKHVuZGVybHlpbmdTb3VyY2UsICdwdWxsJywgMCwgW2NvbnRyb2xsZXJdKTsKICAgICAgICB2YXIgY2FuY2VsQWxnb3JpdGhtID0gQ3JlYXRlQWxnb3JpdGhtRnJvbVVuZGVybHlpbmdNZXRob2QodW5kZXJseWluZ1NvdXJjZSwgJ2NhbmNlbCcsIDEsIFtdKTsKICAgICAgICBTZXRVcFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXIoc3RyZWFtLCBjb250cm9sbGVyLCBzdGFydEFsZ29yaXRobSwgcHVsbEFsZ29yaXRobSwgY2FuY2VsQWxnb3JpdGhtLCBoaWdoV2F0ZXJNYXJrLCBzaXplQWxnb3JpdGhtKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBkZWZhdWx0Q29udHJvbGxlckJyYW5kQ2hlY2tFeGNlcHRpb24obmFtZSkgewogICAgICAgIHJldHVybiBuZXcgVHlwZUVycm9yKCJSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyLnByb3RvdHlwZS4iICsgbmFtZSArICIgY2FuIG9ubHkgYmUgdXNlZCBvbiBhIFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXIiKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBSZWFkYWJsZVN0cmVhbVRlZShzdHJlYW0sIGNsb25lRm9yQnJhbmNoMikgewogICAgICAgIHZhciByZWFkZXIgPSBBY3F1aXJlUmVhZGFibGVTdHJlYW1EZWZhdWx0UmVhZGVyKHN0cmVhbSk7CiAgICAgICAgdmFyIHJlYWRpbmcgPSBmYWxzZTsKICAgICAgICB2YXIgY2FuY2VsZWQxID0gZmFsc2U7CiAgICAgICAgdmFyIGNhbmNlbGVkMiA9IGZhbHNlOwogICAgICAgIHZhciByZWFzb24xOwogICAgICAgIHZhciByZWFzb24yOwogICAgICAgIHZhciBicmFuY2gxOwogICAgICAgIHZhciBicmFuY2gyOwogICAgICAgIHZhciByZXNvbHZlQ2FuY2VsUHJvbWlzZTsKICAgICAgICB2YXIgY2FuY2VsUHJvbWlzZSA9IG5ld1Byb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICAgIHJlc29sdmVDYW5jZWxQcm9taXNlID0gcmVzb2x2ZTsKICAgICAgICB9KTsKICAgICAgICBmdW5jdGlvbiBwdWxsQWxnb3JpdGhtKCkgewogICAgICAgICAgaWYgKHJlYWRpbmcgPT09IHRydWUpIHsKICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZXNvbHZlZFdpdGgodW5kZWZpbmVkKTsKICAgICAgICAgIH0KICAgICAgICAgIHJlYWRpbmcgPSB0cnVlOwogICAgICAgICAgdmFyIHJlYWRQcm9taXNlID0gdHJhbnNmb3JtUHJvbWlzZVdpdGgoUmVhZGFibGVTdHJlYW1EZWZhdWx0UmVhZGVyUmVhZChyZWFkZXIpLCBmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgIHJlYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgdmFyIGRvbmUgPSByZXN1bHQuZG9uZTsKICAgICAgICAgICAgaWYgKGRvbmUgPT09IHRydWUpIHsKICAgICAgICAgICAgICBpZiAoY2FuY2VsZWQxID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckNsb3NlKGJyYW5jaDEuX3JlYWRhYmxlU3RyZWFtQ29udHJvbGxlcik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChjYW5jZWxlZDIgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyQ2xvc2UoYnJhbmNoMi5fcmVhZGFibGVTdHJlYW1Db250cm9sbGVyKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciB2YWx1ZSA9IHJlc3VsdC52YWx1ZTsKICAgICAgICAgICAgdmFyIHZhbHVlMSA9IHZhbHVlOwogICAgICAgICAgICB2YXIgdmFsdWUyID0gdmFsdWU7CiAgICAgICAgICAgIGlmIChjYW5jZWxlZDEgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckVucXVldWUoYnJhbmNoMS5fcmVhZGFibGVTdHJlYW1Db250cm9sbGVyLCB2YWx1ZTEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChjYW5jZWxlZDIgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckVucXVldWUoYnJhbmNoMi5fcmVhZGFibGVTdHJlYW1Db250cm9sbGVyLCB2YWx1ZTIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIHNldFByb21pc2VJc0hhbmRsZWRUb1RydWUocmVhZFByb21pc2UpOwogICAgICAgICAgcmV0dXJuIHByb21pc2VSZXNvbHZlZFdpdGgodW5kZWZpbmVkKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gY2FuY2VsMUFsZ29yaXRobShyZWFzb24pIHsKICAgICAgICAgIGNhbmNlbGVkMSA9IHRydWU7CiAgICAgICAgICByZWFzb24xID0gcmVhc29uOwogICAgICAgICAgaWYgKGNhbmNlbGVkMiA9PT0gdHJ1ZSkgewogICAgICAgICAgICB2YXIgY29tcG9zaXRlUmVhc29uID0gY3JlYXRlQXJyYXlGcm9tTGlzdChbCiAgICAgICAgICAgIHJlYXNvbjEsCiAgICAgICAgICAgIHJlYXNvbjJdCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHZhciBjYW5jZWxSZXN1bHQgPSBSZWFkYWJsZVN0cmVhbUNhbmNlbChzdHJlYW0sIGNvbXBvc2l0ZVJlYXNvbik7CiAgICAgICAgICAgIHJlc29sdmVDYW5jZWxQcm9taXNlKGNhbmNlbFJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gY2FuY2VsUHJvbWlzZTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gY2FuY2VsMkFsZ29yaXRobShyZWFzb24pIHsKICAgICAgICAgIGNhbmNlbGVkMiA9IHRydWU7CiAgICAgICAgICByZWFzb24yID0gcmVhc29uOwogICAgICAgICAgaWYgKGNhbmNlbGVkMSA9PT0gdHJ1ZSkgewogICAgICAgICAgICB2YXIgY29tcG9zaXRlUmVhc29uID0gY3JlYXRlQXJyYXlGcm9tTGlzdChbCiAgICAgICAgICAgIHJlYXNvbjEsCiAgICAgICAgICAgIHJlYXNvbjJdCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHZhciBjYW5jZWxSZXN1bHQgPSBSZWFkYWJsZVN0cmVhbUNhbmNlbChzdHJlYW0sIGNvbXBvc2l0ZVJlYXNvbik7CiAgICAgICAgICAgIHJlc29sdmVDYW5jZWxQcm9taXNlKGNhbmNlbFJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gY2FuY2VsUHJvbWlzZTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gc3RhcnRBbGdvcml0aG0oKSB7CiAgICAgICAgfQogICAgICAgIGJyYW5jaDEgPSBDcmVhdGVSZWFkYWJsZVN0cmVhbShzdGFydEFsZ29yaXRobSwgcHVsbEFsZ29yaXRobSwgY2FuY2VsMUFsZ29yaXRobSk7CiAgICAgICAgYnJhbmNoMiA9IENyZWF0ZVJlYWRhYmxlU3RyZWFtKHN0YXJ0QWxnb3JpdGhtLCBwdWxsQWxnb3JpdGhtLCBjYW5jZWwyQWxnb3JpdGhtKTsKICAgICAgICB1cG9uUmVqZWN0aW9uKHJlYWRlci5fY2xvc2VkUHJvbWlzZSwgZnVuY3Rpb24gKHIpIHsKICAgICAgICAgIFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJFcnJvcihicmFuY2gxLl9yZWFkYWJsZVN0cmVhbUNvbnRyb2xsZXIsIHIpOwogICAgICAgICAgUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckVycm9yKGJyYW5jaDIuX3JlYWRhYmxlU3RyZWFtQ29udHJvbGxlciwgcik7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIFsKICAgICAgICBicmFuY2gxLAogICAgICAgIGJyYW5jaDJdOwoKICAgICAgfQogICAgICB2YXIgTnVtYmVySXNJbnRlZ2VyID0gTnVtYmVyLmlzSW50ZWdlciB8fCBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyAmJiBpc0Zpbml0ZSh2YWx1ZSkgJiYgTWF0aC5mbG9vcih2YWx1ZSkgPT09IHZhbHVlOwogICAgICB9OwogICAgICB2YXIgUmVhZGFibGVTdHJlYW1CWU9CUmVxdWVzdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBSZWFkYWJsZVN0cmVhbUJZT0JSZXF1ZXN0KCkgewogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignUmVhZGFibGVTdHJlYW1CWU9CUmVxdWVzdCBjYW5ub3QgYmUgdXNlZCBkaXJlY3RseScpOwogICAgICAgIH0KICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUmVhZGFibGVTdHJlYW1CWU9CUmVxdWVzdC5wcm90b3R5cGUsICJ2aWV3IiwgewogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIGlmIChJc1JlYWRhYmxlU3RyZWFtQllPQlJlcXVlc3QodGhpcykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgdGhyb3cgYnlvYlJlcXVlc3RCcmFuZENoZWNrRXhjZXB0aW9uKCd2aWV3Jyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ZpZXc7CiAgICAgICAgICB9LAogICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIFJlYWRhYmxlU3RyZWFtQllPQlJlcXVlc3QucHJvdG90eXBlLnJlc3BvbmQgPSBmdW5jdGlvbiAoYnl0ZXNXcml0dGVuKSB7CiAgICAgICAgICBpZiAoSXNSZWFkYWJsZVN0cmVhbUJZT0JSZXF1ZXN0KHRoaXMpID09PSBmYWxzZSkgewogICAgICAgICAgICB0aHJvdyBieW9iUmVxdWVzdEJyYW5kQ2hlY2tFeGNlcHRpb24oJ3Jlc3BvbmQnKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLl9hc3NvY2lhdGVkUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlciA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1RoaXMgQllPQiByZXF1ZXN0IGhhcyBiZWVuIGludmFsaWRhdGVkJyk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoSXNEZXRhY2hlZEJ1ZmZlcih0aGlzLl92aWV3LmJ1ZmZlcikgPT09IHRydWUpIDsKICAgICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJSZXNwb25kKHRoaXMuX2Fzc29jaWF0ZWRSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyLCBieXRlc1dyaXR0ZW4pOwogICAgICAgIH07CiAgICAgICAgUmVhZGFibGVTdHJlYW1CWU9CUmVxdWVzdC5wcm90b3R5cGUucmVzcG9uZFdpdGhOZXdWaWV3ID0gZnVuY3Rpb24gKHZpZXcpIHsKICAgICAgICAgIGlmIChJc1JlYWRhYmxlU3RyZWFtQllPQlJlcXVlc3QodGhpcykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRocm93IGJ5b2JSZXF1ZXN0QnJhbmRDaGVja0V4Y2VwdGlvbigncmVzcG9uZCcpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHRoaXMuX2Fzc29jaWF0ZWRSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVGhpcyBCWU9CIHJlcXVlc3QgaGFzIGJlZW4gaW52YWxpZGF0ZWQnKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICghQXJyYXlCdWZmZXIuaXNWaWV3KHZpZXcpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1lvdSBjYW4gb25seSByZXNwb25kIHdpdGggYXJyYXkgYnVmZmVyIHZpZXdzJyk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoSXNEZXRhY2hlZEJ1ZmZlcih2aWV3LmJ1ZmZlcikgPT09IHRydWUpIDsKICAgICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJSZXNwb25kV2l0aE5ld1ZpZXcodGhpcy5fYXNzb2NpYXRlZFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXIsIHZpZXcpOwogICAgICAgIH07CiAgICAgICAgcmV0dXJuIFJlYWRhYmxlU3RyZWFtQllPQlJlcXVlc3Q7CiAgICAgIH0oKTsKICAgICAgdmFyIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlcigpIHsKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1JlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXIgY29uc3RydWN0b3IgY2Fubm90IGJlIHVzZWQgZGlyZWN0bHknKTsKICAgICAgICB9CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXIucHJvdG90eXBlLCAiYnlvYlJlcXVlc3QiLCB7CiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgaWYgKElzUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlcih0aGlzKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICB0aHJvdyBieXRlU3RyZWFtQ29udHJvbGxlckJyYW5kQ2hlY2tFeGNlcHRpb24oJ2J5b2JSZXF1ZXN0Jyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMuX2J5b2JSZXF1ZXN0ID09PSB1bmRlZmluZWQgJiYgdGhpcy5fcGVuZGluZ1B1bGxJbnRvcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgdmFyIGZpcnN0RGVzY3JpcHRvciA9IHRoaXMuX3BlbmRpbmdQdWxsSW50b3MucGVlaygpOwogICAgICAgICAgICAgIHZhciB2aWV3ID0gbmV3IFVpbnQ4QXJyYXkoZmlyc3REZXNjcmlwdG9yLmJ1ZmZlciwgZmlyc3REZXNjcmlwdG9yLmJ5dGVPZmZzZXQgKyBmaXJzdERlc2NyaXB0b3IuYnl0ZXNGaWxsZWQsIGZpcnN0RGVzY3JpcHRvci5ieXRlTGVuZ3RoIC0gZmlyc3REZXNjcmlwdG9yLmJ5dGVzRmlsbGVkKTsKICAgICAgICAgICAgICB2YXIgYnlvYlJlcXVlc3QgPSBPYmplY3QuY3JlYXRlKFJlYWRhYmxlU3RyZWFtQllPQlJlcXVlc3QucHJvdG90eXBlKTsKICAgICAgICAgICAgICBTZXRVcFJlYWRhYmxlU3RyZWFtQllPQlJlcXVlc3QoYnlvYlJlcXVlc3QsIHRoaXMsIHZpZXcpOwogICAgICAgICAgICAgIHRoaXMuX2J5b2JSZXF1ZXN0ID0gYnlvYlJlcXVlc3Q7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2J5b2JSZXF1ZXN0OwogICAgICAgICAgfSwKICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICB9KTsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlci5wcm90b3R5cGUsICJkZXNpcmVkU2l6ZSIsIHsKICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICBpZiAoSXNSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyKHRoaXMpID09PSBmYWxzZSkgewogICAgICAgICAgICAgIHRocm93IGJ5dGVTdHJlYW1Db250cm9sbGVyQnJhbmRDaGVja0V4Y2VwdGlvbignZGVzaXJlZFNpemUnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlckdldERlc2lyZWRTaXplKHRoaXMpOwogICAgICAgICAgfSwKICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICB9KTsKICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmIChJc1JlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXIodGhpcykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRocm93IGJ5dGVTdHJlYW1Db250cm9sbGVyQnJhbmRDaGVja0V4Y2VwdGlvbignY2xvc2UnKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLl9jbG9zZVJlcXVlc3RlZCA9PT0gdHJ1ZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdUaGUgc3RyZWFtIGhhcyBhbHJlYWR5IGJlZW4gY2xvc2VkOyBkbyBub3QgY2xvc2UgaXQgYWdhaW4hJyk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgc3RhdGUgPSB0aGlzLl9jb250cm9sbGVkUmVhZGFibGVCeXRlU3RyZWFtLl9zdGF0ZTsKICAgICAgICAgIGlmIChzdGF0ZSAhPT0gJ3JlYWRhYmxlJykgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJUaGUgc3RyZWFtIChpbiAiICsgc3RhdGUgKyAiIHN0YXRlKSBpcyBub3QgaW4gdGhlIHJlYWRhYmxlIHN0YXRlIGFuZCBjYW5ub3QgYmUgY2xvc2VkIik7CiAgICAgICAgICB9CiAgICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyQ2xvc2UodGhpcyk7CiAgICAgICAgfTsKICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyLnByb3RvdHlwZS5lbnF1ZXVlID0gZnVuY3Rpb24gKGNodW5rKSB7CiAgICAgICAgICBpZiAoSXNSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyKHRoaXMpID09PSBmYWxzZSkgewogICAgICAgICAgICB0aHJvdyBieXRlU3RyZWFtQ29udHJvbGxlckJyYW5kQ2hlY2tFeGNlcHRpb24oJ2VucXVldWUnKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLl9jbG9zZVJlcXVlc3RlZCA9PT0gdHJ1ZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdzdHJlYW0gaXMgY2xvc2VkIG9yIGRyYWluaW5nJyk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgc3RhdGUgPSB0aGlzLl9jb250cm9sbGVkUmVhZGFibGVCeXRlU3RyZWFtLl9zdGF0ZTsKICAgICAgICAgIGlmIChzdGF0ZSAhPT0gJ3JlYWRhYmxlJykgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJUaGUgc3RyZWFtIChpbiAiICsgc3RhdGUgKyAiIHN0YXRlKSBpcyBub3QgaW4gdGhlIHJlYWRhYmxlIHN0YXRlIGFuZCBjYW5ub3QgYmUgZW5xdWV1ZWQgdG8iKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICghQXJyYXlCdWZmZXIuaXNWaWV3KGNodW5rKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdZb3UgY2FuIG9ubHkgZW5xdWV1ZSBhcnJheSBidWZmZXIgdmlld3Mgd2hlbiB1c2luZyBhIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXInKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChJc0RldGFjaGVkQnVmZmVyKGNodW5rLmJ1ZmZlcikgPT09IHRydWUpIDsKICAgICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJFbnF1ZXVlKHRoaXMsIGNodW5rKTsKICAgICAgICB9OwogICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGlmIChJc1JlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXIodGhpcykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRocm93IGJ5dGVTdHJlYW1Db250cm9sbGVyQnJhbmRDaGVja0V4Y2VwdGlvbignZXJyb3InKTsKICAgICAgICAgIH0KICAgICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJFcnJvcih0aGlzLCBlKTsKICAgICAgICB9OwogICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXIucHJvdG90eXBlW0NhbmNlbFN0ZXBzXSA9IGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgIGlmICh0aGlzLl9wZW5kaW5nUHVsbEludG9zLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgdmFyIGZpcnN0RGVzY3JpcHRvciA9IHRoaXMuX3BlbmRpbmdQdWxsSW50b3MucGVlaygpOwogICAgICAgICAgICBmaXJzdERlc2NyaXB0b3IuYnl0ZXNGaWxsZWQgPSAwOwogICAgICAgICAgfQogICAgICAgICAgUmVzZXRRdWV1ZSh0aGlzKTsKICAgICAgICAgIHZhciByZXN1bHQgPSB0aGlzLl9jYW5jZWxBbGdvcml0aG0ocmVhc29uKTsKICAgICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJDbGVhckFsZ29yaXRobXModGhpcyk7CiAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH07CiAgICAgICAgUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlci5wcm90b3R5cGVbUHVsbFN0ZXBzXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBzdHJlYW0gPSB0aGlzLl9jb250cm9sbGVkUmVhZGFibGVCeXRlU3RyZWFtOwogICAgICAgICAgaWYgKHRoaXMuX3F1ZXVlVG90YWxTaXplID4gMCkgewogICAgICAgICAgICB2YXIgZW50cnkgPSB0aGlzLl9xdWV1ZS5zaGlmdCgpOwogICAgICAgICAgICB0aGlzLl9xdWV1ZVRvdGFsU2l6ZSAtPSBlbnRyeS5ieXRlTGVuZ3RoOwogICAgICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVySGFuZGxlUXVldWVEcmFpbih0aGlzKTsKICAgICAgICAgICAgdmFyIHZpZXcgPSB2b2lkIDA7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgdmlldyA9IG5ldyBVaW50OEFycmF5KGVudHJ5LmJ1ZmZlciwgZW50cnkuYnl0ZU9mZnNldCwgZW50cnkuYnl0ZUxlbmd0aCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKHZpZXdFKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZWplY3RlZFdpdGgodmlld0UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVzb2x2ZWRXaXRoKFJlYWRhYmxlU3RyZWFtQ3JlYXRlUmVhZFJlc3VsdCh2aWV3LCBmYWxzZSwgc3RyZWFtLl9yZWFkZXIuX2ZvckF1dGhvckNvZGUpKTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBhdXRvQWxsb2NhdGVDaHVua1NpemUgPSB0aGlzLl9hdXRvQWxsb2NhdGVDaHVua1NpemU7CiAgICAgICAgICBpZiAoYXV0b0FsbG9jYXRlQ2h1bmtTaXplICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgdmFyIGJ1ZmZlciA9IHZvaWQgMDsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBidWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIoYXV0b0FsbG9jYXRlQ2h1bmtTaXplKTsKICAgICAgICAgICAgfSBjYXRjaCAoYnVmZmVyRSkgewogICAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVqZWN0ZWRXaXRoKGJ1ZmZlckUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBwdWxsSW50b0Rlc2NyaXB0b3IgPSB7CiAgICAgICAgICAgICAgYnVmZmVyOiBidWZmZXIsCiAgICAgICAgICAgICAgYnl0ZU9mZnNldDogMCwKICAgICAgICAgICAgICBieXRlTGVuZ3RoOiBhdXRvQWxsb2NhdGVDaHVua1NpemUsCiAgICAgICAgICAgICAgYnl0ZXNGaWxsZWQ6IDAsCiAgICAgICAgICAgICAgZWxlbWVudFNpemU6IDEsCiAgICAgICAgICAgICAgY3RvcjogVWludDhBcnJheSwKICAgICAgICAgICAgICByZWFkZXJUeXBlOiAnZGVmYXVsdCcKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdGhpcy5fcGVuZGluZ1B1bGxJbnRvcy5wdXNoKHB1bGxJbnRvRGVzY3JpcHRvcik7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgcHJvbWlzZSA9IFJlYWRhYmxlU3RyZWFtQWRkUmVhZFJlcXVlc3Qoc3RyZWFtKTsKICAgICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJDYWxsUHVsbElmTmVlZGVkKHRoaXMpOwogICAgICAgICAgcmV0dXJuIHByb21pc2U7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlcjsKICAgICAgfSgpOwogICAgICBmdW5jdGlvbiBJc1JlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXIoeCkgewogICAgICAgIGlmICghdHlwZUlzT2JqZWN0KHgpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmICghT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHgsICdfY29udHJvbGxlZFJlYWRhYmxlQnl0ZVN0cmVhbScpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIElzUmVhZGFibGVTdHJlYW1CWU9CUmVxdWVzdCh4KSB7CiAgICAgICAgaWYgKCF0eXBlSXNPYmplY3QoeCkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoeCwgJ19hc3NvY2lhdGVkUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlcicpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJDYWxsUHVsbElmTmVlZGVkKGNvbnRyb2xsZXIpIHsKICAgICAgICB2YXIgc2hvdWxkUHVsbCA9IFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJTaG91bGRDYWxsUHVsbChjb250cm9sbGVyKTsKICAgICAgICBpZiAoc2hvdWxkUHVsbCA9PT0gZmFsc2UpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKGNvbnRyb2xsZXIuX3B1bGxpbmcgPT09IHRydWUpIHsKICAgICAgICAgIGNvbnRyb2xsZXIuX3B1bGxBZ2FpbiA9IHRydWU7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnRyb2xsZXIuX3B1bGxpbmcgPSB0cnVlOwogICAgICAgIHZhciBwdWxsUHJvbWlzZSA9IGNvbnRyb2xsZXIuX3B1bGxBbGdvcml0aG0oKTsKICAgICAgICB1cG9uUHJvbWlzZShwdWxsUHJvbWlzZSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgY29udHJvbGxlci5fcHVsbGluZyA9IGZhbHNlOwogICAgICAgICAgaWYgKGNvbnRyb2xsZXIuX3B1bGxBZ2FpbiA9PT0gdHJ1ZSkgewogICAgICAgICAgICBjb250cm9sbGVyLl9wdWxsQWdhaW4gPSBmYWxzZTsKICAgICAgICAgICAgUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlckNhbGxQdWxsSWZOZWVkZWQoY29udHJvbGxlcik7CiAgICAgICAgICB9CiAgICAgICAgfSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJFcnJvcihjb250cm9sbGVyLCBlKTsKICAgICAgICB9KTsKICAgICAgfQogICAgICBmdW5jdGlvbiBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyQ2xlYXJQZW5kaW5nUHVsbEludG9zKGNvbnRyb2xsZXIpIHsKICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVySW52YWxpZGF0ZUJZT0JSZXF1ZXN0KGNvbnRyb2xsZXIpOwogICAgICAgIGNvbnRyb2xsZXIuX3BlbmRpbmdQdWxsSW50b3MgPSBuZXcgU2ltcGxlUXVldWUoKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyQ29tbWl0UHVsbEludG9EZXNjcmlwdG9yKHN0cmVhbSwgcHVsbEludG9EZXNjcmlwdG9yKSB7CiAgICAgICAgdmFyIGRvbmUgPSBmYWxzZTsKICAgICAgICBpZiAoc3RyZWFtLl9zdGF0ZSA9PT0gJ2Nsb3NlZCcpIHsKICAgICAgICAgIGRvbmUgPSB0cnVlOwogICAgICAgIH0KICAgICAgICB2YXIgZmlsbGVkVmlldyA9IFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJDb252ZXJ0UHVsbEludG9EZXNjcmlwdG9yKHB1bGxJbnRvRGVzY3JpcHRvcik7CiAgICAgICAgaWYgKHB1bGxJbnRvRGVzY3JpcHRvci5yZWFkZXJUeXBlID09PSAnZGVmYXVsdCcpIHsKICAgICAgICAgIFJlYWRhYmxlU3RyZWFtRnVsZmlsbFJlYWRSZXF1ZXN0KHN0cmVhbSwgZmlsbGVkVmlldywgZG9uZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFJlYWRhYmxlU3RyZWFtRnVsZmlsbFJlYWRJbnRvUmVxdWVzdChzdHJlYW0sIGZpbGxlZFZpZXcsIGRvbmUpOwogICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyQ29udmVydFB1bGxJbnRvRGVzY3JpcHRvcihwdWxsSW50b0Rlc2NyaXB0b3IpIHsKICAgICAgICB2YXIgYnl0ZXNGaWxsZWQgPSBwdWxsSW50b0Rlc2NyaXB0b3IuYnl0ZXNGaWxsZWQ7CiAgICAgICAgdmFyIGVsZW1lbnRTaXplID0gcHVsbEludG9EZXNjcmlwdG9yLmVsZW1lbnRTaXplOwogICAgICAgIHJldHVybiBuZXcgcHVsbEludG9EZXNjcmlwdG9yLmN0b3IocHVsbEludG9EZXNjcmlwdG9yLmJ1ZmZlciwgcHVsbEludG9EZXNjcmlwdG9yLmJ5dGVPZmZzZXQsIGJ5dGVzRmlsbGVkIC8gZWxlbWVudFNpemUpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJFbnF1ZXVlQ2h1bmtUb1F1ZXVlKGNvbnRyb2xsZXIsIGJ1ZmZlciwgYnl0ZU9mZnNldCwgYnl0ZUxlbmd0aCkgewogICAgICAgIGNvbnRyb2xsZXIuX3F1ZXVlLnB1c2goewogICAgICAgICAgYnVmZmVyOiBidWZmZXIsCiAgICAgICAgICBieXRlT2Zmc2V0OiBieXRlT2Zmc2V0LAogICAgICAgICAgYnl0ZUxlbmd0aDogYnl0ZUxlbmd0aAogICAgICAgIH0pOwogICAgICAgIGNvbnRyb2xsZXIuX3F1ZXVlVG90YWxTaXplICs9IGJ5dGVMZW5ndGg7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlckZpbGxQdWxsSW50b0Rlc2NyaXB0b3JGcm9tUXVldWUoY29udHJvbGxlciwgcHVsbEludG9EZXNjcmlwdG9yKSB7CiAgICAgICAgdmFyIGVsZW1lbnRTaXplID0gcHVsbEludG9EZXNjcmlwdG9yLmVsZW1lbnRTaXplOwogICAgICAgIHZhciBjdXJyZW50QWxpZ25lZEJ5dGVzID0gcHVsbEludG9EZXNjcmlwdG9yLmJ5dGVzRmlsbGVkIC0gcHVsbEludG9EZXNjcmlwdG9yLmJ5dGVzRmlsbGVkICUgZWxlbWVudFNpemU7CiAgICAgICAgdmFyIG1heEJ5dGVzVG9Db3B5ID0gTWF0aC5taW4oY29udHJvbGxlci5fcXVldWVUb3RhbFNpemUsIHB1bGxJbnRvRGVzY3JpcHRvci5ieXRlTGVuZ3RoIC0gcHVsbEludG9EZXNjcmlwdG9yLmJ5dGVzRmlsbGVkKTsKICAgICAgICB2YXIgbWF4Qnl0ZXNGaWxsZWQgPSBwdWxsSW50b0Rlc2NyaXB0b3IuYnl0ZXNGaWxsZWQgKyBtYXhCeXRlc1RvQ29weTsKICAgICAgICB2YXIgbWF4QWxpZ25lZEJ5dGVzID0gbWF4Qnl0ZXNGaWxsZWQgLSBtYXhCeXRlc0ZpbGxlZCAlIGVsZW1lbnRTaXplOwogICAgICAgIHZhciB0b3RhbEJ5dGVzVG9Db3B5UmVtYWluaW5nID0gbWF4Qnl0ZXNUb0NvcHk7CiAgICAgICAgdmFyIHJlYWR5ID0gZmFsc2U7CiAgICAgICAgaWYgKG1heEFsaWduZWRCeXRlcyA+IGN1cnJlbnRBbGlnbmVkQnl0ZXMpIHsKICAgICAgICAgIHRvdGFsQnl0ZXNUb0NvcHlSZW1haW5pbmcgPSBtYXhBbGlnbmVkQnl0ZXMgLSBwdWxsSW50b0Rlc2NyaXB0b3IuYnl0ZXNGaWxsZWQ7CiAgICAgICAgICByZWFkeSA9IHRydWU7CiAgICAgICAgfQogICAgICAgIHZhciBxdWV1ZSA9IGNvbnRyb2xsZXIuX3F1ZXVlOwogICAgICAgIHdoaWxlICh0b3RhbEJ5dGVzVG9Db3B5UmVtYWluaW5nID4gMCkgewogICAgICAgICAgdmFyIGhlYWRPZlF1ZXVlID0gcXVldWUucGVlaygpOwogICAgICAgICAgdmFyIGJ5dGVzVG9Db3B5ID0gTWF0aC5taW4odG90YWxCeXRlc1RvQ29weVJlbWFpbmluZywgaGVhZE9mUXVldWUuYnl0ZUxlbmd0aCk7CiAgICAgICAgICB2YXIgZGVzdFN0YXJ0ID0gcHVsbEludG9EZXNjcmlwdG9yLmJ5dGVPZmZzZXQgKyBwdWxsSW50b0Rlc2NyaXB0b3IuYnl0ZXNGaWxsZWQ7CiAgICAgICAgICBBcnJheUJ1ZmZlckNvcHkocHVsbEludG9EZXNjcmlwdG9yLmJ1ZmZlciwgZGVzdFN0YXJ0LCBoZWFkT2ZRdWV1ZS5idWZmZXIsIGhlYWRPZlF1ZXVlLmJ5dGVPZmZzZXQsIGJ5dGVzVG9Db3B5KTsKICAgICAgICAgIGlmIChoZWFkT2ZRdWV1ZS5ieXRlTGVuZ3RoID09PSBieXRlc1RvQ29weSkgewogICAgICAgICAgICBxdWV1ZS5zaGlmdCgpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaGVhZE9mUXVldWUuYnl0ZU9mZnNldCArPSBieXRlc1RvQ29weTsKICAgICAgICAgICAgaGVhZE9mUXVldWUuYnl0ZUxlbmd0aCAtPSBieXRlc1RvQ29weTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnRyb2xsZXIuX3F1ZXVlVG90YWxTaXplIC09IGJ5dGVzVG9Db3B5OwogICAgICAgICAgUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlckZpbGxIZWFkUHVsbEludG9EZXNjcmlwdG9yKGNvbnRyb2xsZXIsIGJ5dGVzVG9Db3B5LCBwdWxsSW50b0Rlc2NyaXB0b3IpOwogICAgICAgICAgdG90YWxCeXRlc1RvQ29weVJlbWFpbmluZyAtPSBieXRlc1RvQ29weTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlYWR5OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJGaWxsSGVhZFB1bGxJbnRvRGVzY3JpcHRvcihjb250cm9sbGVyLCBzaXplLCBwdWxsSW50b0Rlc2NyaXB0b3IpIHsKICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVySW52YWxpZGF0ZUJZT0JSZXF1ZXN0KGNvbnRyb2xsZXIpOwogICAgICAgIHB1bGxJbnRvRGVzY3JpcHRvci5ieXRlc0ZpbGxlZCArPSBzaXplOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJIYW5kbGVRdWV1ZURyYWluKGNvbnRyb2xsZXIpIHsKICAgICAgICBpZiAoY29udHJvbGxlci5fcXVldWVUb3RhbFNpemUgPT09IDAgJiYgY29udHJvbGxlci5fY2xvc2VSZXF1ZXN0ZWQgPT09IHRydWUpIHsKICAgICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJDbGVhckFsZ29yaXRobXMoY29udHJvbGxlcik7CiAgICAgICAgICBSZWFkYWJsZVN0cmVhbUNsb3NlKGNvbnRyb2xsZXIuX2NvbnRyb2xsZWRSZWFkYWJsZUJ5dGVTdHJlYW0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyQ2FsbFB1bGxJZk5lZWRlZChjb250cm9sbGVyKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlckludmFsaWRhdGVCWU9CUmVxdWVzdChjb250cm9sbGVyKSB7CiAgICAgICAgaWYgKGNvbnRyb2xsZXIuX2J5b2JSZXF1ZXN0ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY29udHJvbGxlci5fYnlvYlJlcXVlc3QuX2Fzc29jaWF0ZWRSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyID0gdW5kZWZpbmVkOwogICAgICAgIGNvbnRyb2xsZXIuX2J5b2JSZXF1ZXN0Ll92aWV3ID0gdW5kZWZpbmVkOwogICAgICAgIGNvbnRyb2xsZXIuX2J5b2JSZXF1ZXN0ID0gdW5kZWZpbmVkOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJQcm9jZXNzUHVsbEludG9EZXNjcmlwdG9yc1VzaW5nUXVldWUoY29udHJvbGxlcikgewogICAgICAgIHdoaWxlIChjb250cm9sbGVyLl9wZW5kaW5nUHVsbEludG9zLmxlbmd0aCA+IDApIHsKICAgICAgICAgIGlmIChjb250cm9sbGVyLl9xdWV1ZVRvdGFsU2l6ZSA9PT0gMCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgcHVsbEludG9EZXNjcmlwdG9yID0gY29udHJvbGxlci5fcGVuZGluZ1B1bGxJbnRvcy5wZWVrKCk7CiAgICAgICAgICBpZiAoUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlckZpbGxQdWxsSW50b0Rlc2NyaXB0b3JGcm9tUXVldWUoY29udHJvbGxlciwgcHVsbEludG9EZXNjcmlwdG9yKSA9PT0gdHJ1ZSkgewogICAgICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyU2hpZnRQZW5kaW5nUHVsbEludG8oY29udHJvbGxlcik7CiAgICAgICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJDb21taXRQdWxsSW50b0Rlc2NyaXB0b3IoY29udHJvbGxlci5fY29udHJvbGxlZFJlYWRhYmxlQnl0ZVN0cmVhbSwgcHVsbEludG9EZXNjcmlwdG9yKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlclB1bGxJbnRvKGNvbnRyb2xsZXIsIHZpZXcpIHsKICAgICAgICB2YXIgc3RyZWFtID0gY29udHJvbGxlci5fY29udHJvbGxlZFJlYWRhYmxlQnl0ZVN0cmVhbTsKICAgICAgICB2YXIgZWxlbWVudFNpemUgPSAxOwogICAgICAgIGlmICh2aWV3LmNvbnN0cnVjdG9yICE9PSBEYXRhVmlldykgewogICAgICAgICAgZWxlbWVudFNpemUgPSB2aWV3LmNvbnN0cnVjdG9yLkJZVEVTX1BFUl9FTEVNRU5UOwogICAgICAgIH0KICAgICAgICB2YXIgY3RvciA9IHZpZXcuY29uc3RydWN0b3I7CiAgICAgICAgdmFyIGJ1ZmZlciA9IFRyYW5zZmVyQXJyYXlCdWZmZXIodmlldy5idWZmZXIpOwogICAgICAgIHZhciBwdWxsSW50b0Rlc2NyaXB0b3IgPSB7CiAgICAgICAgICBidWZmZXI6IGJ1ZmZlciwKICAgICAgICAgIGJ5dGVPZmZzZXQ6IHZpZXcuYnl0ZU9mZnNldCwKICAgICAgICAgIGJ5dGVMZW5ndGg6IHZpZXcuYnl0ZUxlbmd0aCwKICAgICAgICAgIGJ5dGVzRmlsbGVkOiAwLAogICAgICAgICAgZWxlbWVudFNpemU6IGVsZW1lbnRTaXplLAogICAgICAgICAgY3RvcjogY3RvciwKICAgICAgICAgIHJlYWRlclR5cGU6ICdieW9iJwogICAgICAgIH07CiAgICAgICAgaWYgKGNvbnRyb2xsZXIuX3BlbmRpbmdQdWxsSW50b3MubGVuZ3RoID4gMCkgewogICAgICAgICAgY29udHJvbGxlci5fcGVuZGluZ1B1bGxJbnRvcy5wdXNoKHB1bGxJbnRvRGVzY3JpcHRvcik7CiAgICAgICAgICByZXR1cm4gUmVhZGFibGVTdHJlYW1BZGRSZWFkSW50b1JlcXVlc3Qoc3RyZWFtKTsKICAgICAgICB9CiAgICAgICAgaWYgKHN0cmVhbS5fc3RhdGUgPT09ICdjbG9zZWQnKSB7CiAgICAgICAgICB2YXIgZW1wdHlWaWV3ID0gbmV3IGN0b3IocHVsbEludG9EZXNjcmlwdG9yLmJ1ZmZlciwgcHVsbEludG9EZXNjcmlwdG9yLmJ5dGVPZmZzZXQsIDApOwogICAgICAgICAgcmV0dXJuIHByb21pc2VSZXNvbHZlZFdpdGgoUmVhZGFibGVTdHJlYW1DcmVhdGVSZWFkUmVzdWx0KGVtcHR5VmlldywgdHJ1ZSwgc3RyZWFtLl9yZWFkZXIuX2ZvckF1dGhvckNvZGUpKTsKICAgICAgICB9CiAgICAgICAgaWYgKGNvbnRyb2xsZXIuX3F1ZXVlVG90YWxTaXplID4gMCkgewogICAgICAgICAgaWYgKFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJGaWxsUHVsbEludG9EZXNjcmlwdG9yRnJvbVF1ZXVlKGNvbnRyb2xsZXIsIHB1bGxJbnRvRGVzY3JpcHRvcikgPT09IHRydWUpIHsKICAgICAgICAgICAgdmFyIGZpbGxlZFZpZXcgPSBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyQ29udmVydFB1bGxJbnRvRGVzY3JpcHRvcihwdWxsSW50b0Rlc2NyaXB0b3IpOwogICAgICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVySGFuZGxlUXVldWVEcmFpbihjb250cm9sbGVyKTsKICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZXNvbHZlZFdpdGgoUmVhZGFibGVTdHJlYW1DcmVhdGVSZWFkUmVzdWx0KGZpbGxlZFZpZXcsIGZhbHNlLCBzdHJlYW0uX3JlYWRlci5fZm9yQXV0aG9yQ29kZSkpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGNvbnRyb2xsZXIuX2Nsb3NlUmVxdWVzdGVkID09PSB0cnVlKSB7CiAgICAgICAgICAgIHZhciBlID0gbmV3IFR5cGVFcnJvcignSW5zdWZmaWNpZW50IGJ5dGVzIHRvIGZpbGwgZWxlbWVudHMgaW4gdGhlIGdpdmVuIGJ1ZmZlcicpOwogICAgICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyRXJyb3IoY29udHJvbGxlciwgZSk7CiAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVqZWN0ZWRXaXRoKGUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb250cm9sbGVyLl9wZW5kaW5nUHVsbEludG9zLnB1c2gocHVsbEludG9EZXNjcmlwdG9yKTsKICAgICAgICB2YXIgcHJvbWlzZSA9IFJlYWRhYmxlU3RyZWFtQWRkUmVhZEludG9SZXF1ZXN0KHN0cmVhbSk7CiAgICAgICAgUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlckNhbGxQdWxsSWZOZWVkZWQoY29udHJvbGxlcik7CiAgICAgICAgcmV0dXJuIHByb21pc2U7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlclJlc3BvbmRJbkNsb3NlZFN0YXRlKGNvbnRyb2xsZXIsIGZpcnN0RGVzY3JpcHRvcikgewogICAgICAgIGZpcnN0RGVzY3JpcHRvci5idWZmZXIgPSBUcmFuc2ZlckFycmF5QnVmZmVyKGZpcnN0RGVzY3JpcHRvci5idWZmZXIpOwogICAgICAgIHZhciBzdHJlYW0gPSBjb250cm9sbGVyLl9jb250cm9sbGVkUmVhZGFibGVCeXRlU3RyZWFtOwogICAgICAgIGlmIChSZWFkYWJsZVN0cmVhbUhhc0JZT0JSZWFkZXIoc3RyZWFtKSA9PT0gdHJ1ZSkgewogICAgICAgICAgd2hpbGUgKFJlYWRhYmxlU3RyZWFtR2V0TnVtUmVhZEludG9SZXF1ZXN0cyhzdHJlYW0pID4gMCkgewogICAgICAgICAgICB2YXIgcHVsbEludG9EZXNjcmlwdG9yID0gUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlclNoaWZ0UGVuZGluZ1B1bGxJbnRvKGNvbnRyb2xsZXIpOwogICAgICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyQ29tbWl0UHVsbEludG9EZXNjcmlwdG9yKHN0cmVhbSwgcHVsbEludG9EZXNjcmlwdG9yKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlclJlc3BvbmRJblJlYWRhYmxlU3RhdGUoY29udHJvbGxlciwgYnl0ZXNXcml0dGVuLCBwdWxsSW50b0Rlc2NyaXB0b3IpIHsKICAgICAgICBpZiAocHVsbEludG9EZXNjcmlwdG9yLmJ5dGVzRmlsbGVkICsgYnl0ZXNXcml0dGVuID4gcHVsbEludG9EZXNjcmlwdG9yLmJ5dGVMZW5ndGgpIHsKICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdieXRlc1dyaXR0ZW4gb3V0IG9mIHJhbmdlJyk7CiAgICAgICAgfQogICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJGaWxsSGVhZFB1bGxJbnRvRGVzY3JpcHRvcihjb250cm9sbGVyLCBieXRlc1dyaXR0ZW4sIHB1bGxJbnRvRGVzY3JpcHRvcik7CiAgICAgICAgaWYgKHB1bGxJbnRvRGVzY3JpcHRvci5ieXRlc0ZpbGxlZCA8IHB1bGxJbnRvRGVzY3JpcHRvci5lbGVtZW50U2l6ZSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyU2hpZnRQZW5kaW5nUHVsbEludG8oY29udHJvbGxlcik7CiAgICAgICAgdmFyIHJlbWFpbmRlclNpemUgPSBwdWxsSW50b0Rlc2NyaXB0b3IuYnl0ZXNGaWxsZWQgJSBwdWxsSW50b0Rlc2NyaXB0b3IuZWxlbWVudFNpemU7CiAgICAgICAgaWYgKHJlbWFpbmRlclNpemUgPiAwKSB7CiAgICAgICAgICB2YXIgZW5kID0gcHVsbEludG9EZXNjcmlwdG9yLmJ5dGVPZmZzZXQgKyBwdWxsSW50b0Rlc2NyaXB0b3IuYnl0ZXNGaWxsZWQ7CiAgICAgICAgICB2YXIgcmVtYWluZGVyID0gcHVsbEludG9EZXNjcmlwdG9yLmJ1ZmZlci5zbGljZShlbmQgLSByZW1haW5kZXJTaXplLCBlbmQpOwogICAgICAgICAgUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlckVucXVldWVDaHVua1RvUXVldWUoY29udHJvbGxlciwgcmVtYWluZGVyLCAwLCByZW1haW5kZXIuYnl0ZUxlbmd0aCk7CiAgICAgICAgfQogICAgICAgIHB1bGxJbnRvRGVzY3JpcHRvci5idWZmZXIgPSBUcmFuc2ZlckFycmF5QnVmZmVyKHB1bGxJbnRvRGVzY3JpcHRvci5idWZmZXIpOwogICAgICAgIHB1bGxJbnRvRGVzY3JpcHRvci5ieXRlc0ZpbGxlZCAtPSByZW1haW5kZXJTaXplOwogICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJDb21taXRQdWxsSW50b0Rlc2NyaXB0b3IoY29udHJvbGxlci5fY29udHJvbGxlZFJlYWRhYmxlQnl0ZVN0cmVhbSwgcHVsbEludG9EZXNjcmlwdG9yKTsKICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyUHJvY2Vzc1B1bGxJbnRvRGVzY3JpcHRvcnNVc2luZ1F1ZXVlKGNvbnRyb2xsZXIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJSZXNwb25kSW50ZXJuYWwoY29udHJvbGxlciwgYnl0ZXNXcml0dGVuKSB7CiAgICAgICAgdmFyIGZpcnN0RGVzY3JpcHRvciA9IGNvbnRyb2xsZXIuX3BlbmRpbmdQdWxsSW50b3MucGVlaygpOwogICAgICAgIHZhciBzdHJlYW0gPSBjb250cm9sbGVyLl9jb250cm9sbGVkUmVhZGFibGVCeXRlU3RyZWFtOwogICAgICAgIGlmIChzdHJlYW0uX3N0YXRlID09PSAnY2xvc2VkJykgewogICAgICAgICAgaWYgKGJ5dGVzV3JpdHRlbiAhPT0gMCkgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdieXRlc1dyaXR0ZW4gbXVzdCBiZSAwIHdoZW4gY2FsbGluZyByZXNwb25kKCkgb24gYSBjbG9zZWQgc3RyZWFtJyk7CiAgICAgICAgICB9CiAgICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyUmVzcG9uZEluQ2xvc2VkU3RhdGUoY29udHJvbGxlciwgZmlyc3REZXNjcmlwdG9yKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlclJlc3BvbmRJblJlYWRhYmxlU3RhdGUoY29udHJvbGxlciwgYnl0ZXNXcml0dGVuLCBmaXJzdERlc2NyaXB0b3IpOwogICAgICAgIH0KICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyQ2FsbFB1bGxJZk5lZWRlZChjb250cm9sbGVyKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyU2hpZnRQZW5kaW5nUHVsbEludG8oY29udHJvbGxlcikgewogICAgICAgIHZhciBkZXNjcmlwdG9yID0gY29udHJvbGxlci5fcGVuZGluZ1B1bGxJbnRvcy5zaGlmdCgpOwogICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJJbnZhbGlkYXRlQllPQlJlcXVlc3QoY29udHJvbGxlcik7CiAgICAgICAgcmV0dXJuIGRlc2NyaXB0b3I7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlclNob3VsZENhbGxQdWxsKGNvbnRyb2xsZXIpIHsKICAgICAgICB2YXIgc3RyZWFtID0gY29udHJvbGxlci5fY29udHJvbGxlZFJlYWRhYmxlQnl0ZVN0cmVhbTsKICAgICAgICBpZiAoc3RyZWFtLl9zdGF0ZSAhPT0gJ3JlYWRhYmxlJykgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoY29udHJvbGxlci5fY2xvc2VSZXF1ZXN0ZWQgPT09IHRydWUpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKGNvbnRyb2xsZXIuX3N0YXJ0ZWQgPT09IGZhbHNlKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmIChSZWFkYWJsZVN0cmVhbUhhc0RlZmF1bHRSZWFkZXIoc3RyZWFtKSA9PT0gdHJ1ZSAmJiBSZWFkYWJsZVN0cmVhbUdldE51bVJlYWRSZXF1ZXN0cyhzdHJlYW0pID4gMCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChSZWFkYWJsZVN0cmVhbUhhc0JZT0JSZWFkZXIoc3RyZWFtKSA9PT0gdHJ1ZSAmJiBSZWFkYWJsZVN0cmVhbUdldE51bVJlYWRJbnRvUmVxdWVzdHMoc3RyZWFtKSA+IDApIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICB2YXIgZGVzaXJlZFNpemUgPSBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyR2V0RGVzaXJlZFNpemUoY29udHJvbGxlcik7CiAgICAgICAgaWYgKGRlc2lyZWRTaXplID4gMCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBmdW5jdGlvbiBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyQ2xlYXJBbGdvcml0aG1zKGNvbnRyb2xsZXIpIHsKICAgICAgICBjb250cm9sbGVyLl9wdWxsQWxnb3JpdGhtID0gdW5kZWZpbmVkOwogICAgICAgIGNvbnRyb2xsZXIuX2NhbmNlbEFsZ29yaXRobSA9IHVuZGVmaW5lZDsKICAgICAgfQogICAgICBmdW5jdGlvbiBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyQ2xvc2UoY29udHJvbGxlcikgewogICAgICAgIHZhciBzdHJlYW0gPSBjb250cm9sbGVyLl9jb250cm9sbGVkUmVhZGFibGVCeXRlU3RyZWFtOwogICAgICAgIGlmIChjb250cm9sbGVyLl9xdWV1ZVRvdGFsU2l6ZSA+IDApIHsKICAgICAgICAgIGNvbnRyb2xsZXIuX2Nsb3NlUmVxdWVzdGVkID0gdHJ1ZTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKGNvbnRyb2xsZXIuX3BlbmRpbmdQdWxsSW50b3MubGVuZ3RoID4gMCkgewogICAgICAgICAgdmFyIGZpcnN0UGVuZGluZ1B1bGxJbnRvID0gY29udHJvbGxlci5fcGVuZGluZ1B1bGxJbnRvcy5wZWVrKCk7CiAgICAgICAgICBpZiAoZmlyc3RQZW5kaW5nUHVsbEludG8uYnl0ZXNGaWxsZWQgPiAwKSB7CiAgICAgICAgICAgIHZhciBlID0gbmV3IFR5cGVFcnJvcignSW5zdWZmaWNpZW50IGJ5dGVzIHRvIGZpbGwgZWxlbWVudHMgaW4gdGhlIGdpdmVuIGJ1ZmZlcicpOwogICAgICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyRXJyb3IoY29udHJvbGxlciwgZSk7CiAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJDbGVhckFsZ29yaXRobXMoY29udHJvbGxlcik7CiAgICAgICAgUmVhZGFibGVTdHJlYW1DbG9zZShzdHJlYW0pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJFbnF1ZXVlKGNvbnRyb2xsZXIsIGNodW5rKSB7CiAgICAgICAgdmFyIHN0cmVhbSA9IGNvbnRyb2xsZXIuX2NvbnRyb2xsZWRSZWFkYWJsZUJ5dGVTdHJlYW07CiAgICAgICAgdmFyIGJ1ZmZlciA9IGNodW5rLmJ1ZmZlcjsKICAgICAgICB2YXIgYnl0ZU9mZnNldCA9IGNodW5rLmJ5dGVPZmZzZXQ7CiAgICAgICAgdmFyIGJ5dGVMZW5ndGggPSBjaHVuay5ieXRlTGVuZ3RoOwogICAgICAgIHZhciB0cmFuc2ZlcnJlZEJ1ZmZlciA9IFRyYW5zZmVyQXJyYXlCdWZmZXIoYnVmZmVyKTsKICAgICAgICBpZiAoUmVhZGFibGVTdHJlYW1IYXNEZWZhdWx0UmVhZGVyKHN0cmVhbSkgPT09IHRydWUpIHsKICAgICAgICAgIGlmIChSZWFkYWJsZVN0cmVhbUdldE51bVJlYWRSZXF1ZXN0cyhzdHJlYW0pID09PSAwKSB7CiAgICAgICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJFbnF1ZXVlQ2h1bmtUb1F1ZXVlKGNvbnRyb2xsZXIsIHRyYW5zZmVycmVkQnVmZmVyLCBieXRlT2Zmc2V0LCBieXRlTGVuZ3RoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciB0cmFuc2ZlcnJlZFZpZXcgPSBuZXcgVWludDhBcnJheSh0cmFuc2ZlcnJlZEJ1ZmZlciwgYnl0ZU9mZnNldCwgYnl0ZUxlbmd0aCk7CiAgICAgICAgICAgIFJlYWRhYmxlU3RyZWFtRnVsZmlsbFJlYWRSZXF1ZXN0KHN0cmVhbSwgdHJhbnNmZXJyZWRWaWV3LCBmYWxzZSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChSZWFkYWJsZVN0cmVhbUhhc0JZT0JSZWFkZXIoc3RyZWFtKSA9PT0gdHJ1ZSkgewogICAgICAgICAgUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlckVucXVldWVDaHVua1RvUXVldWUoY29udHJvbGxlciwgdHJhbnNmZXJyZWRCdWZmZXIsIGJ5dGVPZmZzZXQsIGJ5dGVMZW5ndGgpOwogICAgICAgICAgUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlclByb2Nlc3NQdWxsSW50b0Rlc2NyaXB0b3JzVXNpbmdRdWV1ZShjb250cm9sbGVyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlckVucXVldWVDaHVua1RvUXVldWUoY29udHJvbGxlciwgdHJhbnNmZXJyZWRCdWZmZXIsIGJ5dGVPZmZzZXQsIGJ5dGVMZW5ndGgpOwogICAgICAgIH0KICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyQ2FsbFB1bGxJZk5lZWRlZChjb250cm9sbGVyKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyRXJyb3IoY29udHJvbGxlciwgZSkgewogICAgICAgIHZhciBzdHJlYW0gPSBjb250cm9sbGVyLl9jb250cm9sbGVkUmVhZGFibGVCeXRlU3RyZWFtOwogICAgICAgIGlmIChzdHJlYW0uX3N0YXRlICE9PSAncmVhZGFibGUnKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJDbGVhclBlbmRpbmdQdWxsSW50b3MoY29udHJvbGxlcik7CiAgICAgICAgUmVzZXRRdWV1ZShjb250cm9sbGVyKTsKICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyQ2xlYXJBbGdvcml0aG1zKGNvbnRyb2xsZXIpOwogICAgICAgIFJlYWRhYmxlU3RyZWFtRXJyb3Ioc3RyZWFtLCBlKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyR2V0RGVzaXJlZFNpemUoY29udHJvbGxlcikgewogICAgICAgIHZhciBzdHJlYW0gPSBjb250cm9sbGVyLl9jb250cm9sbGVkUmVhZGFibGVCeXRlU3RyZWFtOwogICAgICAgIHZhciBzdGF0ZSA9IHN0cmVhbS5fc3RhdGU7CiAgICAgICAgaWYgKHN0YXRlID09PSAnZXJyb3JlZCcpIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBpZiAoc3RhdGUgPT09ICdjbG9zZWQnKSB7CiAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNvbnRyb2xsZXIuX3N0cmF0ZWd5SFdNIC0gY29udHJvbGxlci5fcXVldWVUb3RhbFNpemU7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlclJlc3BvbmQoY29udHJvbGxlciwgYnl0ZXNXcml0dGVuKSB7CiAgICAgICAgYnl0ZXNXcml0dGVuID0gTnVtYmVyKGJ5dGVzV3JpdHRlbik7CiAgICAgICAgaWYgKElzRmluaXRlTm9uTmVnYXRpdmVOdW1iZXIoYnl0ZXNXcml0dGVuKSA9PT0gZmFsc2UpIHsKICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdieXRlc1dyaXR0ZW4gbXVzdCBiZSBhIGZpbml0ZScpOwogICAgICAgIH0KICAgICAgICBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyUmVzcG9uZEludGVybmFsKGNvbnRyb2xsZXIsIGJ5dGVzV3JpdHRlbik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlclJlc3BvbmRXaXRoTmV3Vmlldyhjb250cm9sbGVyLCB2aWV3KSB7CiAgICAgICAgdmFyIGZpcnN0RGVzY3JpcHRvciA9IGNvbnRyb2xsZXIuX3BlbmRpbmdQdWxsSW50b3MucGVlaygpOwogICAgICAgIGlmIChmaXJzdERlc2NyaXB0b3IuYnl0ZU9mZnNldCArIGZpcnN0RGVzY3JpcHRvci5ieXRlc0ZpbGxlZCAhPT0gdmlldy5ieXRlT2Zmc2V0KSB7CiAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignVGhlIHJlZ2lvbiBzcGVjaWZpZWQgYnkgdmlldyBkb2VzIG5vdCBtYXRjaCBieW9iUmVxdWVzdCcpOwogICAgICAgIH0KICAgICAgICBpZiAoZmlyc3REZXNjcmlwdG9yLmJ5dGVMZW5ndGggIT09IHZpZXcuYnl0ZUxlbmd0aCkgewogICAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ1RoZSBidWZmZXIgb2YgdmlldyBoYXMgZGlmZmVyZW50IGNhcGFjaXR5IHRoYW4gYnlvYlJlcXVlc3QnKTsKICAgICAgICB9CiAgICAgICAgZmlyc3REZXNjcmlwdG9yLmJ1ZmZlciA9IHZpZXcuYnVmZmVyOwogICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJSZXNwb25kSW50ZXJuYWwoY29udHJvbGxlciwgdmlldy5ieXRlTGVuZ3RoKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBTZXRVcFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXIoc3RyZWFtLCBjb250cm9sbGVyLCBzdGFydEFsZ29yaXRobSwgcHVsbEFsZ29yaXRobSwgY2FuY2VsQWxnb3JpdGhtLCBoaWdoV2F0ZXJNYXJrLCBhdXRvQWxsb2NhdGVDaHVua1NpemUpIHsKICAgICAgICBjb250cm9sbGVyLl9jb250cm9sbGVkUmVhZGFibGVCeXRlU3RyZWFtID0gc3RyZWFtOwogICAgICAgIGNvbnRyb2xsZXIuX3B1bGxBZ2FpbiA9IGZhbHNlOwogICAgICAgIGNvbnRyb2xsZXIuX3B1bGxpbmcgPSBmYWxzZTsKICAgICAgICBjb250cm9sbGVyLl9ieW9iUmVxdWVzdCA9IHVuZGVmaW5lZDsKICAgICAgICBjb250cm9sbGVyLl9xdWV1ZSA9IGNvbnRyb2xsZXIuX3F1ZXVlVG90YWxTaXplID0gdW5kZWZpbmVkOwogICAgICAgIFJlc2V0UXVldWUoY29udHJvbGxlcik7CiAgICAgICAgY29udHJvbGxlci5fY2xvc2VSZXF1ZXN0ZWQgPSBmYWxzZTsKICAgICAgICBjb250cm9sbGVyLl9zdGFydGVkID0gZmFsc2U7CiAgICAgICAgY29udHJvbGxlci5fc3RyYXRlZ3lIV00gPSBWYWxpZGF0ZUFuZE5vcm1hbGl6ZUhpZ2hXYXRlck1hcmsoaGlnaFdhdGVyTWFyayk7CiAgICAgICAgY29udHJvbGxlci5fcHVsbEFsZ29yaXRobSA9IHB1bGxBbGdvcml0aG07CiAgICAgICAgY29udHJvbGxlci5fY2FuY2VsQWxnb3JpdGhtID0gY2FuY2VsQWxnb3JpdGhtOwogICAgICAgIGNvbnRyb2xsZXIuX2F1dG9BbGxvY2F0ZUNodW5rU2l6ZSA9IGF1dG9BbGxvY2F0ZUNodW5rU2l6ZTsKICAgICAgICBjb250cm9sbGVyLl9wZW5kaW5nUHVsbEludG9zID0gbmV3IFNpbXBsZVF1ZXVlKCk7CiAgICAgICAgc3RyZWFtLl9yZWFkYWJsZVN0cmVhbUNvbnRyb2xsZXIgPSBjb250cm9sbGVyOwogICAgICAgIHZhciBzdGFydFJlc3VsdCA9IHN0YXJ0QWxnb3JpdGhtKCk7CiAgICAgICAgdXBvblByb21pc2UocHJvbWlzZVJlc29sdmVkV2l0aChzdGFydFJlc3VsdCksIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGNvbnRyb2xsZXIuX3N0YXJ0ZWQgPSB0cnVlOwogICAgICAgICAgUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlckNhbGxQdWxsSWZOZWVkZWQoY29udHJvbGxlcik7CiAgICAgICAgfSwgZnVuY3Rpb24gKHIpIHsKICAgICAgICAgIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJFcnJvcihjb250cm9sbGVyLCByKTsKICAgICAgICB9KTsKICAgICAgfQogICAgICBmdW5jdGlvbiBTZXRVcFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJGcm9tVW5kZXJseWluZ1NvdXJjZShzdHJlYW0sIHVuZGVybHlpbmdCeXRlU291cmNlLCBoaWdoV2F0ZXJNYXJrKSB7CiAgICAgICAgdmFyIGNvbnRyb2xsZXIgPSBPYmplY3QuY3JlYXRlKFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXIucHJvdG90eXBlKTsKICAgICAgICBmdW5jdGlvbiBzdGFydEFsZ29yaXRobSgpIHsKICAgICAgICAgIHJldHVybiBJbnZva2VPck5vb3AodW5kZXJseWluZ0J5dGVTb3VyY2UsICdzdGFydCcsIFtjb250cm9sbGVyXSk7CiAgICAgICAgfQogICAgICAgIHZhciBwdWxsQWxnb3JpdGhtID0gQ3JlYXRlQWxnb3JpdGhtRnJvbVVuZGVybHlpbmdNZXRob2QodW5kZXJseWluZ0J5dGVTb3VyY2UsICdwdWxsJywgMCwgW2NvbnRyb2xsZXJdKTsKICAgICAgICB2YXIgY2FuY2VsQWxnb3JpdGhtID0gQ3JlYXRlQWxnb3JpdGhtRnJvbVVuZGVybHlpbmdNZXRob2QodW5kZXJseWluZ0J5dGVTb3VyY2UsICdjYW5jZWwnLCAxLCBbXSk7CiAgICAgICAgdmFyIGF1dG9BbGxvY2F0ZUNodW5rU2l6ZSA9IHVuZGVybHlpbmdCeXRlU291cmNlLmF1dG9BbGxvY2F0ZUNodW5rU2l6ZTsKICAgICAgICBpZiAoYXV0b0FsbG9jYXRlQ2h1bmtTaXplICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGF1dG9BbGxvY2F0ZUNodW5rU2l6ZSA9IE51bWJlcihhdXRvQWxsb2NhdGVDaHVua1NpemUpOwogICAgICAgICAgaWYgKE51bWJlcklzSW50ZWdlcihhdXRvQWxsb2NhdGVDaHVua1NpemUpID09PSBmYWxzZSB8fCBhdXRvQWxsb2NhdGVDaHVua1NpemUgPD0gMCkgewogICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignYXV0b0FsbG9jYXRlQ2h1bmtTaXplIG11c3QgYmUgYSBwb3NpdGl2ZSBpbnRlZ2VyJyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIFNldFVwUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlcihzdHJlYW0sIGNvbnRyb2xsZXIsIHN0YXJ0QWxnb3JpdGhtLCBwdWxsQWxnb3JpdGhtLCBjYW5jZWxBbGdvcml0aG0sIGhpZ2hXYXRlck1hcmssIGF1dG9BbGxvY2F0ZUNodW5rU2l6ZSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gU2V0VXBSZWFkYWJsZVN0cmVhbUJZT0JSZXF1ZXN0KHJlcXVlc3QsIGNvbnRyb2xsZXIsIHZpZXcpIHsKICAgICAgICByZXF1ZXN0Ll9hc3NvY2lhdGVkUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlciA9IGNvbnRyb2xsZXI7CiAgICAgICAgcmVxdWVzdC5fdmlldyA9IHZpZXc7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gYnlvYlJlcXVlc3RCcmFuZENoZWNrRXhjZXB0aW9uKG5hbWUpIHsKICAgICAgICByZXR1cm4gbmV3IFR5cGVFcnJvcigiUmVhZGFibGVTdHJlYW1CWU9CUmVxdWVzdC5wcm90b3R5cGUuIiArIG5hbWUgKyAiIGNhbiBvbmx5IGJlIHVzZWQgb24gYSBSZWFkYWJsZVN0cmVhbUJZT0JSZXF1ZXN0Iik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gYnl0ZVN0cmVhbUNvbnRyb2xsZXJCcmFuZENoZWNrRXhjZXB0aW9uKG5hbWUpIHsKICAgICAgICByZXR1cm4gbmV3IFR5cGVFcnJvcigiUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlci5wcm90b3R5cGUuIiArIG5hbWUgKyAiIGNhbiBvbmx5IGJlIHVzZWQgb24gYSBSZWFkYWJsZUJ5dGVTdHJlYW1Db250cm9sbGVyIik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gQWNxdWlyZVJlYWRhYmxlU3RyZWFtQllPQlJlYWRlcihzdHJlYW0sIGZvckF1dGhvckNvZGUpIHsKICAgICAgICBpZiAoZm9yQXV0aG9yQ29kZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICBmb3JBdXRob3JDb2RlID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHZhciByZWFkZXIgPSBuZXcgUmVhZGFibGVTdHJlYW1CWU9CUmVhZGVyKHN0cmVhbSk7CiAgICAgICAgcmVhZGVyLl9mb3JBdXRob3JDb2RlID0gZm9yQXV0aG9yQ29kZTsKICAgICAgICByZXR1cm4gcmVhZGVyOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlU3RyZWFtQWRkUmVhZEludG9SZXF1ZXN0KHN0cmVhbSkgewogICAgICAgIHZhciBwcm9taXNlID0gbmV3UHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICB2YXIgcmVhZEludG9SZXF1ZXN0ID0gewogICAgICAgICAgICBfcmVzb2x2ZTogcmVzb2x2ZSwKICAgICAgICAgICAgX3JlamVjdDogcmVqZWN0CiAgICAgICAgICB9OwogICAgICAgICAgc3RyZWFtLl9yZWFkZXIuX3JlYWRJbnRvUmVxdWVzdHMucHVzaChyZWFkSW50b1JlcXVlc3QpOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBwcm9taXNlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlU3RyZWFtRnVsZmlsbFJlYWRJbnRvUmVxdWVzdChzdHJlYW0sIGNodW5rLCBkb25lKSB7CiAgICAgICAgdmFyIHJlYWRlciA9IHN0cmVhbS5fcmVhZGVyOwogICAgICAgIHZhciByZWFkSW50b1JlcXVlc3QgPSByZWFkZXIuX3JlYWRJbnRvUmVxdWVzdHMuc2hpZnQoKTsKICAgICAgICByZWFkSW50b1JlcXVlc3QuX3Jlc29sdmUoUmVhZGFibGVTdHJlYW1DcmVhdGVSZWFkUmVzdWx0KGNodW5rLCBkb25lLCByZWFkZXIuX2ZvckF1dGhvckNvZGUpKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBSZWFkYWJsZVN0cmVhbUdldE51bVJlYWRJbnRvUmVxdWVzdHMoc3RyZWFtKSB7CiAgICAgICAgcmV0dXJuIHN0cmVhbS5fcmVhZGVyLl9yZWFkSW50b1JlcXVlc3RzLmxlbmd0aDsKICAgICAgfQogICAgICBmdW5jdGlvbiBSZWFkYWJsZVN0cmVhbUhhc0JZT0JSZWFkZXIoc3RyZWFtKSB7CiAgICAgICAgdmFyIHJlYWRlciA9IHN0cmVhbS5fcmVhZGVyOwogICAgICAgIGlmIChyZWFkZXIgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoIUlzUmVhZGFibGVTdHJlYW1CWU9CUmVhZGVyKHJlYWRlcikpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgdmFyIFJlYWRhYmxlU3RyZWFtQllPQlJlYWRlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBSZWFkYWJsZVN0cmVhbUJZT0JSZWFkZXIoc3RyZWFtKSB7CiAgICAgICAgICBpZiAoIUlzUmVhZGFibGVTdHJlYW0oc3RyZWFtKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdSZWFkYWJsZVN0cmVhbUJZT0JSZWFkZXIgY2FuIG9ubHkgYmUgY29uc3RydWN0ZWQgd2l0aCBhIFJlYWRhYmxlU3RyZWFtIGluc3RhbmNlIGdpdmVuIGEgJyArICdieXRlIHNvdXJjZScpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKElzUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlcihzdHJlYW0uX3JlYWRhYmxlU3RyZWFtQ29udHJvbGxlcikgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjb25zdHJ1Y3QgYSBSZWFkYWJsZVN0cmVhbUJZT0JSZWFkZXIgZm9yIGEgc3RyZWFtIG5vdCBjb25zdHJ1Y3RlZCB3aXRoIGEgYnl0ZSAnICsgJ3NvdXJjZScpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKElzUmVhZGFibGVTdHJlYW1Mb2NrZWQoc3RyZWFtKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdUaGlzIHN0cmVhbSBoYXMgYWxyZWFkeSBiZWVuIGxvY2tlZCBmb3IgZXhjbHVzaXZlIHJlYWRpbmcgYnkgYW5vdGhlciByZWFkZXInKTsKICAgICAgICAgIH0KICAgICAgICAgIFJlYWRhYmxlU3RyZWFtUmVhZGVyR2VuZXJpY0luaXRpYWxpemUodGhpcywgc3RyZWFtKTsKICAgICAgICAgIHRoaXMuX3JlYWRJbnRvUmVxdWVzdHMgPSBuZXcgU2ltcGxlUXVldWUoKTsKICAgICAgICB9CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFJlYWRhYmxlU3RyZWFtQllPQlJlYWRlci5wcm90b3R5cGUsICJjbG9zZWQiLCB7CiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgaWYgKCFJc1JlYWRhYmxlU3RyZWFtQllPQlJlYWRlcih0aGlzKSkgewogICAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVqZWN0ZWRXaXRoKGJ5b2JSZWFkZXJCcmFuZENoZWNrRXhjZXB0aW9uKCdjbG9zZWQnKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Nsb3NlZFByb21pc2U7CiAgICAgICAgICB9LAogICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIFJlYWRhYmxlU3RyZWFtQllPQlJlYWRlci5wcm90b3R5cGUuY2FuY2VsID0gZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgaWYgKCFJc1JlYWRhYmxlU3RyZWFtQllPQlJlYWRlcih0aGlzKSkgewogICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChieW9iUmVhZGVyQnJhbmRDaGVja0V4Y2VwdGlvbignY2FuY2VsJykpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHRoaXMuX293bmVyUmVhZGFibGVTdHJlYW0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChyZWFkZXJMb2NrRXhjZXB0aW9uKCdjYW5jZWwnKSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gUmVhZGFibGVTdHJlYW1SZWFkZXJHZW5lcmljQ2FuY2VsKHRoaXMsIHJlYXNvbik7CiAgICAgICAgfTsKICAgICAgICBSZWFkYWJsZVN0cmVhbUJZT0JSZWFkZXIucHJvdG90eXBlLnJlYWQgPSBmdW5jdGlvbiAodmlldykgewogICAgICAgICAgaWYgKCFJc1JlYWRhYmxlU3RyZWFtQllPQlJlYWRlcih0aGlzKSkgewogICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChieW9iUmVhZGVyQnJhbmRDaGVja0V4Y2VwdGlvbigncmVhZCcpKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLl9vd25lclJlYWRhYmxlU3RyZWFtID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZWplY3RlZFdpdGgocmVhZGVyTG9ja0V4Y2VwdGlvbigncmVhZCBmcm9tJykpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCFBcnJheUJ1ZmZlci5pc1ZpZXcodmlldykpIHsKICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZWplY3RlZFdpdGgobmV3IFR5cGVFcnJvcigndmlldyBtdXN0IGJlIGFuIGFycmF5IGJ1ZmZlciB2aWV3JykpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKElzRGV0YWNoZWRCdWZmZXIodmlldy5idWZmZXIpID09PSB0cnVlKSA7CiAgICAgICAgICBpZiAodmlldy5ieXRlTGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVqZWN0ZWRXaXRoKG5ldyBUeXBlRXJyb3IoJ3ZpZXcgbXVzdCBoYXZlIG5vbi16ZXJvIGJ5dGVMZW5ndGgnKSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gUmVhZGFibGVTdHJlYW1CWU9CUmVhZGVyUmVhZCh0aGlzLCB2aWV3KTsKICAgICAgICB9OwogICAgICAgIFJlYWRhYmxlU3RyZWFtQllPQlJlYWRlci5wcm90b3R5cGUucmVsZWFzZUxvY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAoIUlzUmVhZGFibGVTdHJlYW1CWU9CUmVhZGVyKHRoaXMpKSB7CiAgICAgICAgICAgIHRocm93IGJ5b2JSZWFkZXJCcmFuZENoZWNrRXhjZXB0aW9uKCdyZWxlYXNlTG9jaycpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHRoaXMuX293bmVyUmVhZGFibGVTdHJlYW0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodGhpcy5fcmVhZEludG9SZXF1ZXN0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1RyaWVkIHRvIHJlbGVhc2UgYSByZWFkZXIgbG9jayB3aGVuIHRoYXQgcmVhZGVyIGhhcyBwZW5kaW5nIHJlYWQoKSBjYWxscyB1bi1zZXR0bGVkJyk7CiAgICAgICAgICB9CiAgICAgICAgICBSZWFkYWJsZVN0cmVhbVJlYWRlckdlbmVyaWNSZWxlYXNlKHRoaXMpOwogICAgICAgIH07CiAgICAgICAgcmV0dXJuIFJlYWRhYmxlU3RyZWFtQllPQlJlYWRlcjsKICAgICAgfSgpOwogICAgICBmdW5jdGlvbiBJc1JlYWRhYmxlU3RyZWFtQllPQlJlYWRlcih4KSB7CiAgICAgICAgaWYgKCF0eXBlSXNPYmplY3QoeCkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoeCwgJ19yZWFkSW50b1JlcXVlc3RzJykpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmVhZGFibGVTdHJlYW1CWU9CUmVhZGVyUmVhZChyZWFkZXIsIHZpZXcpIHsKICAgICAgICB2YXIgc3RyZWFtID0gcmVhZGVyLl9vd25lclJlYWRhYmxlU3RyZWFtOwogICAgICAgIHN0cmVhbS5fZGlzdHVyYmVkID0gdHJ1ZTsKICAgICAgICBpZiAoc3RyZWFtLl9zdGF0ZSA9PT0gJ2Vycm9yZWQnKSB7CiAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChzdHJlYW0uX3N0b3JlZEVycm9yKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFJlYWRhYmxlQnl0ZVN0cmVhbUNvbnRyb2xsZXJQdWxsSW50byhzdHJlYW0uX3JlYWRhYmxlU3RyZWFtQ29udHJvbGxlciwgdmlldyk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gYnlvYlJlYWRlckJyYW5kQ2hlY2tFeGNlcHRpb24obmFtZSkgewogICAgICAgIHJldHVybiBuZXcgVHlwZUVycm9yKCJSZWFkYWJsZVN0cmVhbUJZT0JSZWFkZXIucHJvdG90eXBlLiIgKyBuYW1lICsgIiBjYW4gb25seSBiZSB1c2VkIG9uIGEgUmVhZGFibGVTdHJlYW1CWU9CUmVhZGVyIik7CiAgICAgIH0KICAgICAgdmFyIFJlYWRhYmxlU3RyZWFtID0gZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlU3RyZWFtKHVuZGVybHlpbmdTb3VyY2UsIHN0cmF0ZWd5KSB7CiAgICAgICAgICBpZiAodW5kZXJseWluZ1NvdXJjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgIHVuZGVybHlpbmdTb3VyY2UgPSB7fTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChzdHJhdGVneSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgIHN0cmF0ZWd5ID0ge307CiAgICAgICAgICB9CiAgICAgICAgICBJbml0aWFsaXplUmVhZGFibGVTdHJlYW0odGhpcyk7CiAgICAgICAgICB2YXIgc2l6ZSA9IHN0cmF0ZWd5LnNpemU7CiAgICAgICAgICB2YXIgaGlnaFdhdGVyTWFyayA9IHN0cmF0ZWd5LmhpZ2hXYXRlck1hcms7CiAgICAgICAgICB2YXIgdHlwZSA9IHVuZGVybHlpbmdTb3VyY2UudHlwZTsKICAgICAgICAgIHZhciB0eXBlU3RyaW5nID0gU3RyaW5nKHR5cGUpOwogICAgICAgICAgaWYgKHR5cGVTdHJpbmcgPT09ICdieXRlcycpIHsKICAgICAgICAgICAgaWYgKHNpemUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdUaGUgc3RyYXRlZ3kgZm9yIGEgYnl0ZSBzdHJlYW0gY2Fubm90IGhhdmUgYSBzaXplIGZ1bmN0aW9uJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGhpZ2hXYXRlck1hcmsgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIGhpZ2hXYXRlck1hcmsgPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGhpZ2hXYXRlck1hcmsgPSBWYWxpZGF0ZUFuZE5vcm1hbGl6ZUhpZ2hXYXRlck1hcmsoaGlnaFdhdGVyTWFyayk7CiAgICAgICAgICAgIFNldFVwUmVhZGFibGVCeXRlU3RyZWFtQ29udHJvbGxlckZyb21VbmRlcmx5aW5nU291cmNlKHRoaXMsIHVuZGVybHlpbmdTb3VyY2UsIGhpZ2hXYXRlck1hcmspOwogICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgdmFyIHNpemVBbGdvcml0aG0gPSBNYWtlU2l6ZUFsZ29yaXRobUZyb21TaXplRnVuY3Rpb24oc2l6ZSk7CiAgICAgICAgICAgIGlmIChoaWdoV2F0ZXJNYXJrID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICBoaWdoV2F0ZXJNYXJrID0gMTsKICAgICAgICAgICAgfQogICAgICAgICAgICBoaWdoV2F0ZXJNYXJrID0gVmFsaWRhdGVBbmROb3JtYWxpemVIaWdoV2F0ZXJNYXJrKGhpZ2hXYXRlck1hcmspOwogICAgICAgICAgICBTZXRVcFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJGcm9tVW5kZXJseWluZ1NvdXJjZSh0aGlzLCB1bmRlcmx5aW5nU291cmNlLCBoaWdoV2F0ZXJNYXJrLCBzaXplQWxnb3JpdGhtKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdJbnZhbGlkIHR5cGUgaXMgc3BlY2lmaWVkJyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZWFkYWJsZVN0cmVhbS5wcm90b3R5cGUsICJsb2NrZWQiLCB7CiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgaWYgKElzUmVhZGFibGVTdHJlYW0odGhpcykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgdGhyb3cgc3RyZWFtQnJhbmRDaGVja0V4Y2VwdGlvbiQxKCdsb2NrZWQnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gSXNSZWFkYWJsZVN0cmVhbUxvY2tlZCh0aGlzKTsKICAgICAgICAgIH0sCiAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgICAgfSk7CiAgICAgICAgUmVhZGFibGVTdHJlYW0ucHJvdG90eXBlLmNhbmNlbCA9IGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgIGlmIChJc1JlYWRhYmxlU3RyZWFtKHRoaXMpID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aChzdHJlYW1CcmFuZENoZWNrRXhjZXB0aW9uJDEoJ2NhbmNlbCcpKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChJc1JlYWRhYmxlU3RyZWFtTG9ja2VkKHRoaXMpID09PSB0cnVlKSB7CiAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVqZWN0ZWRXaXRoKG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjYW5jZWwgYSBzdHJlYW0gdGhhdCBhbHJlYWR5IGhhcyBhIHJlYWRlcicpKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBSZWFkYWJsZVN0cmVhbUNhbmNlbCh0aGlzLCByZWFzb24pOwogICAgICAgIH07CiAgICAgICAgUmVhZGFibGVTdHJlYW0ucHJvdG90eXBlLmdldFJlYWRlciA9IGZ1bmN0aW9uIChfYSkgewogICAgICAgICAgdmFyIG1vZGUgPSAoX2EgPT09IHZvaWQgMCA/IHt9IDogX2EpLm1vZGU7CiAgICAgICAgICBpZiAoSXNSZWFkYWJsZVN0cmVhbSh0aGlzKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgdGhyb3cgc3RyZWFtQnJhbmRDaGVja0V4Y2VwdGlvbiQxKCdnZXRSZWFkZXInKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChtb2RlID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgcmV0dXJuIEFjcXVpcmVSZWFkYWJsZVN0cmVhbURlZmF1bHRSZWFkZXIodGhpcywgdHJ1ZSk7CiAgICAgICAgICB9CiAgICAgICAgICBtb2RlID0gU3RyaW5nKG1vZGUpOwogICAgICAgICAgaWYgKG1vZGUgPT09ICdieW9iJykgewogICAgICAgICAgICByZXR1cm4gQWNxdWlyZVJlYWRhYmxlU3RyZWFtQllPQlJlYWRlcih0aGlzLCB0cnVlKTsKICAgICAgICAgIH0KICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdJbnZhbGlkIG1vZGUgaXMgc3BlY2lmaWVkJyk7CiAgICAgICAgfTsKICAgICAgICBSZWFkYWJsZVN0cmVhbS5wcm90b3R5cGUucGlwZVRocm91Z2ggPSBmdW5jdGlvbiAoX2EsIF9iKSB7CiAgICAgICAgICB2YXIgd3JpdGFibGUgPSBfYS53cml0YWJsZSxyZWFkYWJsZSA9IF9hLnJlYWRhYmxlOwogICAgICAgICAgdmFyIF9jID0gX2IgPT09IHZvaWQgMCA/IHt9IDogX2IscHJldmVudENsb3NlID0gX2MucHJldmVudENsb3NlLHByZXZlbnRBYm9ydCA9IF9jLnByZXZlbnRBYm9ydCxwcmV2ZW50Q2FuY2VsID0gX2MucHJldmVudENhbmNlbCxzaWduYWwgPSBfYy5zaWduYWw7CiAgICAgICAgICBpZiAoSXNSZWFkYWJsZVN0cmVhbSh0aGlzKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgdGhyb3cgc3RyZWFtQnJhbmRDaGVja0V4Y2VwdGlvbiQxKCdwaXBlVGhyb3VnaCcpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKElzV3JpdGFibGVTdHJlYW0od3JpdGFibGUpID09PSBmYWxzZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCd3cml0YWJsZSBhcmd1bWVudCB0byBwaXBlVGhyb3VnaCBtdXN0IGJlIGEgV3JpdGFibGVTdHJlYW0nKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChJc1JlYWRhYmxlU3RyZWFtKHJlYWRhYmxlKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigncmVhZGFibGUgYXJndW1lbnQgdG8gcGlwZVRocm91Z2ggbXVzdCBiZSBhIFJlYWRhYmxlU3RyZWFtJyk7CiAgICAgICAgICB9CiAgICAgICAgICBwcmV2ZW50Q2xvc2UgPSBCb29sZWFuKHByZXZlbnRDbG9zZSk7CiAgICAgICAgICBwcmV2ZW50QWJvcnQgPSBCb29sZWFuKHByZXZlbnRBYm9ydCk7CiAgICAgICAgICBwcmV2ZW50Q2FuY2VsID0gQm9vbGVhbihwcmV2ZW50Q2FuY2VsKTsKICAgICAgICAgIGlmIChzaWduYWwgIT09IHVuZGVmaW5lZCAmJiAhaXNBYm9ydFNpZ25hbChzaWduYWwpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1JlYWRhYmxlU3RyZWFtLnByb3RvdHlwZS5waXBlVGhyb3VnaFwncyBzaWduYWwgb3B0aW9uIG11c3QgYmUgYW4gQWJvcnRTaWduYWwnKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChJc1JlYWRhYmxlU3RyZWFtTG9ja2VkKHRoaXMpID09PSB0cnVlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1JlYWRhYmxlU3RyZWFtLnByb3RvdHlwZS5waXBlVGhyb3VnaCBjYW5ub3QgYmUgdXNlZCBvbiBhIGxvY2tlZCBSZWFkYWJsZVN0cmVhbScpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKElzV3JpdGFibGVTdHJlYW1Mb2NrZWQod3JpdGFibGUpID09PSB0cnVlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1JlYWRhYmxlU3RyZWFtLnByb3RvdHlwZS5waXBlVGhyb3VnaCBjYW5ub3QgYmUgdXNlZCBvbiBhIGxvY2tlZCBXcml0YWJsZVN0cmVhbScpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHByb21pc2UgPSBSZWFkYWJsZVN0cmVhbVBpcGVUbyh0aGlzLCB3cml0YWJsZSwgcHJldmVudENsb3NlLCBwcmV2ZW50QWJvcnQsIHByZXZlbnRDYW5jZWwsIHNpZ25hbCk7CiAgICAgICAgICBzZXRQcm9taXNlSXNIYW5kbGVkVG9UcnVlKHByb21pc2UpOwogICAgICAgICAgcmV0dXJuIHJlYWRhYmxlOwogICAgICAgIH07CiAgICAgICAgUmVhZGFibGVTdHJlYW0ucHJvdG90eXBlLnBpcGVUbyA9IGZ1bmN0aW9uIChkZXN0LCBfYSkgewogICAgICAgICAgdmFyIF9iID0gX2EgPT09IHZvaWQgMCA/IHt9IDogX2EscHJldmVudENsb3NlID0gX2IucHJldmVudENsb3NlLHByZXZlbnRBYm9ydCA9IF9iLnByZXZlbnRBYm9ydCxwcmV2ZW50Q2FuY2VsID0gX2IucHJldmVudENhbmNlbCxzaWduYWwgPSBfYi5zaWduYWw7CiAgICAgICAgICBpZiAoSXNSZWFkYWJsZVN0cmVhbSh0aGlzKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZWplY3RlZFdpdGgoc3RyZWFtQnJhbmRDaGVja0V4Y2VwdGlvbiQxKCdwaXBlVG8nKSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoSXNXcml0YWJsZVN0cmVhbShkZXN0KSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZWplY3RlZFdpdGgobmV3IFR5cGVFcnJvcignUmVhZGFibGVTdHJlYW0ucHJvdG90eXBlLnBpcGVUb1wncyBmaXJzdCBhcmd1bWVudCBtdXN0IGJlIGEgV3JpdGFibGVTdHJlYW0nKSk7CiAgICAgICAgICB9CiAgICAgICAgICBwcmV2ZW50Q2xvc2UgPSBCb29sZWFuKHByZXZlbnRDbG9zZSk7CiAgICAgICAgICBwcmV2ZW50QWJvcnQgPSBCb29sZWFuKHByZXZlbnRBYm9ydCk7CiAgICAgICAgICBwcmV2ZW50Q2FuY2VsID0gQm9vbGVhbihwcmV2ZW50Q2FuY2VsKTsKICAgICAgICAgIGlmIChzaWduYWwgIT09IHVuZGVmaW5lZCAmJiAhaXNBYm9ydFNpZ25hbChzaWduYWwpKSB7CiAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVqZWN0ZWRXaXRoKG5ldyBUeXBlRXJyb3IoJ1JlYWRhYmxlU3RyZWFtLnByb3RvdHlwZS5waXBlVG9cJ3Mgc2lnbmFsIG9wdGlvbiBtdXN0IGJlIGFuIEFib3J0U2lnbmFsJykpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKElzUmVhZGFibGVTdHJlYW1Mb2NrZWQodGhpcykgPT09IHRydWUpIHsKICAgICAgICAgICAgcmV0dXJuIHByb21pc2VSZWplY3RlZFdpdGgobmV3IFR5cGVFcnJvcignUmVhZGFibGVTdHJlYW0ucHJvdG90eXBlLnBpcGVUbyBjYW5ub3QgYmUgdXNlZCBvbiBhIGxvY2tlZCBSZWFkYWJsZVN0cmVhbScpKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChJc1dyaXRhYmxlU3RyZWFtTG9ja2VkKGRlc3QpID09PSB0cnVlKSB7CiAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVqZWN0ZWRXaXRoKG5ldyBUeXBlRXJyb3IoJ1JlYWRhYmxlU3RyZWFtLnByb3RvdHlwZS5waXBlVG8gY2Fubm90IGJlIHVzZWQgb24gYSBsb2NrZWQgV3JpdGFibGVTdHJlYW0nKSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gUmVhZGFibGVTdHJlYW1QaXBlVG8odGhpcywgZGVzdCwgcHJldmVudENsb3NlLCBwcmV2ZW50QWJvcnQsIHByZXZlbnRDYW5jZWwsIHNpZ25hbCk7CiAgICAgICAgfTsKICAgICAgICBSZWFkYWJsZVN0cmVhbS5wcm90b3R5cGUudGVlID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKElzUmVhZGFibGVTdHJlYW0odGhpcykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRocm93IHN0cmVhbUJyYW5kQ2hlY2tFeGNlcHRpb24kMSgndGVlJyk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgYnJhbmNoZXMgPSBSZWFkYWJsZVN0cmVhbVRlZSh0aGlzKTsKICAgICAgICAgIHJldHVybiBjcmVhdGVBcnJheUZyb21MaXN0KGJyYW5jaGVzKTsKICAgICAgICB9OwogICAgICAgIFJlYWRhYmxlU3RyZWFtLnByb3RvdHlwZS5nZXRJdGVyYXRvciA9IGZ1bmN0aW9uIChfYSkgewogICAgICAgICAgdmFyIF9iID0gKF9hID09PSB2b2lkIDAgPyB7fSA6IF9hKS5wcmV2ZW50Q2FuY2VsLHByZXZlbnRDYW5jZWwgPSBfYiA9PT0gdm9pZCAwID8gZmFsc2UgOiBfYjsKICAgICAgICAgIGlmIChJc1JlYWRhYmxlU3RyZWFtKHRoaXMpID09PSBmYWxzZSkgewogICAgICAgICAgICB0aHJvdyBzdHJlYW1CcmFuZENoZWNrRXhjZXB0aW9uJDEoJ2dldEl0ZXJhdG9yJyk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gQWNxdWlyZVJlYWRhYmxlU3RyZWFtQXN5bmNJdGVyYXRvcih0aGlzLCBwcmV2ZW50Q2FuY2VsKTsKICAgICAgICB9OwogICAgICAgIHJldHVybiBSZWFkYWJsZVN0cmVhbTsKICAgICAgfSgpOwogICAgICBpZiAodHlwZW9mIFN5bWJvbFBvbHlmaWxsLmFzeW5jSXRlcmF0b3IgPT09ICdzeW1ib2wnKSB7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFJlYWRhYmxlU3RyZWFtLnByb3RvdHlwZSwgU3ltYm9sUG9seWZpbGwuYXN5bmNJdGVyYXRvciwgewogICAgICAgICAgdmFsdWU6IFJlYWRhYmxlU3RyZWFtLnByb3RvdHlwZS5nZXRJdGVyYXRvciwKICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlLAogICAgICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICB9KTsKICAgICAgfQogICAgICBmdW5jdGlvbiBDcmVhdGVSZWFkYWJsZVN0cmVhbShzdGFydEFsZ29yaXRobSwgcHVsbEFsZ29yaXRobSwgY2FuY2VsQWxnb3JpdGhtLCBoaWdoV2F0ZXJNYXJrLCBzaXplQWxnb3JpdGhtKSB7CiAgICAgICAgaWYgKGhpZ2hXYXRlck1hcmsgPT09IHZvaWQgMCkgewogICAgICAgICAgaGlnaFdhdGVyTWFyayA9IDE7CiAgICAgICAgfQogICAgICAgIGlmIChzaXplQWxnb3JpdGhtID09PSB2b2lkIDApIHsKICAgICAgICAgIHNpemVBbGdvcml0aG0gPSBmdW5jdGlvbiBzaXplQWxnb3JpdGhtKCkgewogICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIHZhciBzdHJlYW0gPSBPYmplY3QuY3JlYXRlKFJlYWRhYmxlU3RyZWFtLnByb3RvdHlwZSk7CiAgICAgICAgSW5pdGlhbGl6ZVJlYWRhYmxlU3RyZWFtKHN0cmVhbSk7CiAgICAgICAgdmFyIGNvbnRyb2xsZXIgPSBPYmplY3QuY3JlYXRlKFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXIucHJvdG90eXBlKTsKICAgICAgICBTZXRVcFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXIoc3RyZWFtLCBjb250cm9sbGVyLCBzdGFydEFsZ29yaXRobSwgcHVsbEFsZ29yaXRobSwgY2FuY2VsQWxnb3JpdGhtLCBoaWdoV2F0ZXJNYXJrLCBzaXplQWxnb3JpdGhtKTsKICAgICAgICByZXR1cm4gc3RyZWFtOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEluaXRpYWxpemVSZWFkYWJsZVN0cmVhbShzdHJlYW0pIHsKICAgICAgICBzdHJlYW0uX3N0YXRlID0gJ3JlYWRhYmxlJzsKICAgICAgICBzdHJlYW0uX3JlYWRlciA9IHVuZGVmaW5lZDsKICAgICAgICBzdHJlYW0uX3N0b3JlZEVycm9yID0gdW5kZWZpbmVkOwogICAgICAgIHN0cmVhbS5fZGlzdHVyYmVkID0gZmFsc2U7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gSXNSZWFkYWJsZVN0cmVhbSh4KSB7CiAgICAgICAgaWYgKCF0eXBlSXNPYmplY3QoeCkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoeCwgJ19yZWFkYWJsZVN0cmVhbUNvbnRyb2xsZXInKSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBmdW5jdGlvbiBJc1JlYWRhYmxlU3RyZWFtTG9ja2VkKHN0cmVhbSkgewogICAgICAgIGlmIChzdHJlYW0uX3JlYWRlciA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlYWRhYmxlU3RyZWFtQ2FuY2VsKHN0cmVhbSwgcmVhc29uKSB7CiAgICAgICAgc3RyZWFtLl9kaXN0dXJiZWQgPSB0cnVlOwogICAgICAgIGlmIChzdHJlYW0uX3N0YXRlID09PSAnY2xvc2VkJykgewogICAgICAgICAgcmV0dXJuIHByb21pc2VSZXNvbHZlZFdpdGgodW5kZWZpbmVkKTsKICAgICAgICB9CiAgICAgICAgaWYgKHN0cmVhbS5fc3RhdGUgPT09ICdlcnJvcmVkJykgewogICAgICAgICAgcmV0dXJuIHByb21pc2VSZWplY3RlZFdpdGgoc3RyZWFtLl9zdG9yZWRFcnJvcik7CiAgICAgICAgfQogICAgICAgIFJlYWRhYmxlU3RyZWFtQ2xvc2Uoc3RyZWFtKTsKICAgICAgICB2YXIgc291cmNlQ2FuY2VsUHJvbWlzZSA9IHN0cmVhbS5fcmVhZGFibGVTdHJlYW1Db250cm9sbGVyW0NhbmNlbFN0ZXBzXShyZWFzb24pOwogICAgICAgIHJldHVybiB0cmFuc2Zvcm1Qcm9taXNlV2l0aChzb3VyY2VDYW5jZWxQcm9taXNlLCBub29wKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBSZWFkYWJsZVN0cmVhbUNsb3NlKHN0cmVhbSkgewogICAgICAgIHN0cmVhbS5fc3RhdGUgPSAnY2xvc2VkJzsKICAgICAgICB2YXIgcmVhZGVyID0gc3RyZWFtLl9yZWFkZXI7CiAgICAgICAgaWYgKHJlYWRlciA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmIChJc1JlYWRhYmxlU3RyZWFtRGVmYXVsdFJlYWRlcihyZWFkZXIpKSB7CiAgICAgICAgICByZWFkZXIuX3JlYWRSZXF1ZXN0cy5mb3JFYWNoKGZ1bmN0aW9uIChyZWFkUmVxdWVzdCkgewogICAgICAgICAgICByZWFkUmVxdWVzdC5fcmVzb2x2ZShSZWFkYWJsZVN0cmVhbUNyZWF0ZVJlYWRSZXN1bHQodW5kZWZpbmVkLCB0cnVlLCByZWFkZXIuX2ZvckF1dGhvckNvZGUpKTsKICAgICAgICAgIH0pOwogICAgICAgICAgcmVhZGVyLl9yZWFkUmVxdWVzdHMgPSBuZXcgU2ltcGxlUXVldWUoKTsKICAgICAgICB9CiAgICAgICAgZGVmYXVsdFJlYWRlckNsb3NlZFByb21pc2VSZXNvbHZlKHJlYWRlcik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmVhZGFibGVTdHJlYW1FcnJvcihzdHJlYW0sIGUpIHsKICAgICAgICBzdHJlYW0uX3N0YXRlID0gJ2Vycm9yZWQnOwogICAgICAgIHN0cmVhbS5fc3RvcmVkRXJyb3IgPSBlOwogICAgICAgIHZhciByZWFkZXIgPSBzdHJlYW0uX3JlYWRlcjsKICAgICAgICBpZiAocmVhZGVyID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKElzUmVhZGFibGVTdHJlYW1EZWZhdWx0UmVhZGVyKHJlYWRlcikpIHsKICAgICAgICAgIHJlYWRlci5fcmVhZFJlcXVlc3RzLmZvckVhY2goZnVuY3Rpb24gKHJlYWRSZXF1ZXN0KSB7CiAgICAgICAgICAgIHJlYWRSZXF1ZXN0Ll9yZWplY3QoZSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHJlYWRlci5fcmVhZFJlcXVlc3RzID0gbmV3IFNpbXBsZVF1ZXVlKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJlYWRlci5fcmVhZEludG9SZXF1ZXN0cy5mb3JFYWNoKGZ1bmN0aW9uIChyZWFkSW50b1JlcXVlc3QpIHsKICAgICAgICAgICAgcmVhZEludG9SZXF1ZXN0Ll9yZWplY3QoZSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHJlYWRlci5fcmVhZEludG9SZXF1ZXN0cyA9IG5ldyBTaW1wbGVRdWV1ZSgpOwogICAgICAgIH0KICAgICAgICBkZWZhdWx0UmVhZGVyQ2xvc2VkUHJvbWlzZVJlamVjdChyZWFkZXIsIGUpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHN0cmVhbUJyYW5kQ2hlY2tFeGNlcHRpb24kMShuYW1lKSB7CiAgICAgICAgcmV0dXJuIG5ldyBUeXBlRXJyb3IoIlJlYWRhYmxlU3RyZWFtLnByb3RvdHlwZS4iICsgbmFtZSArICIgY2FuIG9ubHkgYmUgdXNlZCBvbiBhIFJlYWRhYmxlU3RyZWFtIik7CiAgICAgIH0KICAgICAgdmFyIEJ5dGVMZW5ndGhRdWV1aW5nU3RyYXRlZ3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gQnl0ZUxlbmd0aFF1ZXVpbmdTdHJhdGVneShfYSkgewogICAgICAgICAgdmFyIGhpZ2hXYXRlck1hcmsgPSBfYS5oaWdoV2F0ZXJNYXJrOwogICAgICAgICAgdGhpcy5oaWdoV2F0ZXJNYXJrID0gaGlnaFdhdGVyTWFyazsKICAgICAgICB9CiAgICAgICAgQnl0ZUxlbmd0aFF1ZXVpbmdTdHJhdGVneS5wcm90b3R5cGUuc2l6ZSA9IGZ1bmN0aW9uIChjaHVuaykgewogICAgICAgICAgcmV0dXJuIGNodW5rLmJ5dGVMZW5ndGg7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gQnl0ZUxlbmd0aFF1ZXVpbmdTdHJhdGVneTsKICAgICAgfSgpOwogICAgICB2YXIgQ291bnRRdWV1aW5nU3RyYXRlZ3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gQ291bnRRdWV1aW5nU3RyYXRlZ3koX2EpIHsKICAgICAgICAgIHZhciBoaWdoV2F0ZXJNYXJrID0gX2EuaGlnaFdhdGVyTWFyazsKICAgICAgICAgIHRoaXMuaGlnaFdhdGVyTWFyayA9IGhpZ2hXYXRlck1hcms7CiAgICAgICAgfQogICAgICAgIENvdW50UXVldWluZ1N0cmF0ZWd5LnByb3RvdHlwZS5zaXplID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gQ291bnRRdWV1aW5nU3RyYXRlZ3k7CiAgICAgIH0oKTsKICAgICAgdmFyIFRyYW5zZm9ybVN0cmVhbSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBUcmFuc2Zvcm1TdHJlYW0odHJhbnNmb3JtZXIsIHdyaXRhYmxlU3RyYXRlZ3ksIHJlYWRhYmxlU3RyYXRlZ3kpIHsKICAgICAgICAgIGlmICh0cmFuc2Zvcm1lciA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgIHRyYW5zZm9ybWVyID0ge307CiAgICAgICAgICB9CiAgICAgICAgICBpZiAod3JpdGFibGVTdHJhdGVneSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgIHdyaXRhYmxlU3RyYXRlZ3kgPSB7fTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChyZWFkYWJsZVN0cmF0ZWd5ID09PSB2b2lkIDApIHsKICAgICAgICAgICAgcmVhZGFibGVTdHJhdGVneSA9IHt9OwogICAgICAgICAgfQogICAgICAgICAgdmFyIHdyaXRhYmxlU2l6ZUZ1bmN0aW9uID0gd3JpdGFibGVTdHJhdGVneS5zaXplOwogICAgICAgICAgdmFyIHdyaXRhYmxlSGlnaFdhdGVyTWFyayA9IHdyaXRhYmxlU3RyYXRlZ3kuaGlnaFdhdGVyTWFyazsKICAgICAgICAgIHZhciByZWFkYWJsZVNpemVGdW5jdGlvbiA9IHJlYWRhYmxlU3RyYXRlZ3kuc2l6ZTsKICAgICAgICAgIHZhciByZWFkYWJsZUhpZ2hXYXRlck1hcmsgPSByZWFkYWJsZVN0cmF0ZWd5LmhpZ2hXYXRlck1hcms7CiAgICAgICAgICB2YXIgd3JpdGFibGVUeXBlID0gdHJhbnNmb3JtZXIud3JpdGFibGVUeXBlOwogICAgICAgICAgaWYgKHdyaXRhYmxlVHlwZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdJbnZhbGlkIHdyaXRhYmxlIHR5cGUgc3BlY2lmaWVkJyk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgd3JpdGFibGVTaXplQWxnb3JpdGhtID0gTWFrZVNpemVBbGdvcml0aG1Gcm9tU2l6ZUZ1bmN0aW9uKHdyaXRhYmxlU2l6ZUZ1bmN0aW9uKTsKICAgICAgICAgIGlmICh3cml0YWJsZUhpZ2hXYXRlck1hcmsgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICB3cml0YWJsZUhpZ2hXYXRlck1hcmsgPSAxOwogICAgICAgICAgfQogICAgICAgICAgd3JpdGFibGVIaWdoV2F0ZXJNYXJrID0gVmFsaWRhdGVBbmROb3JtYWxpemVIaWdoV2F0ZXJNYXJrKHdyaXRhYmxlSGlnaFdhdGVyTWFyayk7CiAgICAgICAgICB2YXIgcmVhZGFibGVUeXBlID0gdHJhbnNmb3JtZXIucmVhZGFibGVUeXBlOwogICAgICAgICAgaWYgKHJlYWRhYmxlVHlwZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdJbnZhbGlkIHJlYWRhYmxlIHR5cGUgc3BlY2lmaWVkJyk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgcmVhZGFibGVTaXplQWxnb3JpdGhtID0gTWFrZVNpemVBbGdvcml0aG1Gcm9tU2l6ZUZ1bmN0aW9uKHJlYWRhYmxlU2l6ZUZ1bmN0aW9uKTsKICAgICAgICAgIGlmIChyZWFkYWJsZUhpZ2hXYXRlck1hcmsgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICByZWFkYWJsZUhpZ2hXYXRlck1hcmsgPSAwOwogICAgICAgICAgfQogICAgICAgICAgcmVhZGFibGVIaWdoV2F0ZXJNYXJrID0gVmFsaWRhdGVBbmROb3JtYWxpemVIaWdoV2F0ZXJNYXJrKHJlYWRhYmxlSGlnaFdhdGVyTWFyayk7CiAgICAgICAgICB2YXIgc3RhcnRQcm9taXNlX3Jlc29sdmU7CiAgICAgICAgICB2YXIgc3RhcnRQcm9taXNlID0gbmV3UHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgICAgICBzdGFydFByb21pc2VfcmVzb2x2ZSA9IHJlc29sdmU7CiAgICAgICAgICB9KTsKICAgICAgICAgIEluaXRpYWxpemVUcmFuc2Zvcm1TdHJlYW0odGhpcywgc3RhcnRQcm9taXNlLCB3cml0YWJsZUhpZ2hXYXRlck1hcmssIHdyaXRhYmxlU2l6ZUFsZ29yaXRobSwgcmVhZGFibGVIaWdoV2F0ZXJNYXJrLCByZWFkYWJsZVNpemVBbGdvcml0aG0pOwogICAgICAgICAgU2V0VXBUcmFuc2Zvcm1TdHJlYW1EZWZhdWx0Q29udHJvbGxlckZyb21UcmFuc2Zvcm1lcih0aGlzLCB0cmFuc2Zvcm1lcik7CiAgICAgICAgICB2YXIgc3RhcnRSZXN1bHQgPSBJbnZva2VPck5vb3AodHJhbnNmb3JtZXIsICdzdGFydCcsIFt0aGlzLl90cmFuc2Zvcm1TdHJlYW1Db250cm9sbGVyXSk7CiAgICAgICAgICBzdGFydFByb21pc2VfcmVzb2x2ZShzdGFydFJlc3VsdCk7CiAgICAgICAgfQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShUcmFuc2Zvcm1TdHJlYW0ucHJvdG90eXBlLCAicmVhZGFibGUiLCB7CiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgaWYgKElzVHJhbnNmb3JtU3RyZWFtKHRoaXMpID09PSBmYWxzZSkgewogICAgICAgICAgICAgIHRocm93IHN0cmVhbUJyYW5kQ2hlY2tFeGNlcHRpb24kMigncmVhZGFibGUnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVhZGFibGU7CiAgICAgICAgICB9LAogICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShUcmFuc2Zvcm1TdHJlYW0ucHJvdG90eXBlLCAid3JpdGFibGUiLCB7CiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgaWYgKElzVHJhbnNmb3JtU3RyZWFtKHRoaXMpID09PSBmYWxzZSkgewogICAgICAgICAgICAgIHRocm93IHN0cmVhbUJyYW5kQ2hlY2tFeGNlcHRpb24kMignd3JpdGFibGUnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpcy5fd3JpdGFibGU7CiAgICAgICAgICB9LAogICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBUcmFuc2Zvcm1TdHJlYW07CiAgICAgIH0oKTsKICAgICAgZnVuY3Rpb24gSW5pdGlhbGl6ZVRyYW5zZm9ybVN0cmVhbShzdHJlYW0sIHN0YXJ0UHJvbWlzZSwgd3JpdGFibGVIaWdoV2F0ZXJNYXJrLCB3cml0YWJsZVNpemVBbGdvcml0aG0sIHJlYWRhYmxlSGlnaFdhdGVyTWFyaywgcmVhZGFibGVTaXplQWxnb3JpdGhtKSB7CiAgICAgICAgZnVuY3Rpb24gc3RhcnRBbGdvcml0aG0oKSB7CiAgICAgICAgICByZXR1cm4gc3RhcnRQcm9taXNlOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB3cml0ZUFsZ29yaXRobShjaHVuaykgewogICAgICAgICAgcmV0dXJuIFRyYW5zZm9ybVN0cmVhbURlZmF1bHRTaW5rV3JpdGVBbGdvcml0aG0oc3RyZWFtLCBjaHVuayk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGFib3J0QWxnb3JpdGhtKHJlYXNvbikgewogICAgICAgICAgcmV0dXJuIFRyYW5zZm9ybVN0cmVhbURlZmF1bHRTaW5rQWJvcnRBbGdvcml0aG0oc3RyZWFtLCByZWFzb24pOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBjbG9zZUFsZ29yaXRobSgpIHsKICAgICAgICAgIHJldHVybiBUcmFuc2Zvcm1TdHJlYW1EZWZhdWx0U2lua0Nsb3NlQWxnb3JpdGhtKHN0cmVhbSk7CiAgICAgICAgfQogICAgICAgIHN0cmVhbS5fd3JpdGFibGUgPSBDcmVhdGVXcml0YWJsZVN0cmVhbShzdGFydEFsZ29yaXRobSwgd3JpdGVBbGdvcml0aG0sIGNsb3NlQWxnb3JpdGhtLCBhYm9ydEFsZ29yaXRobSwgd3JpdGFibGVIaWdoV2F0ZXJNYXJrLCB3cml0YWJsZVNpemVBbGdvcml0aG0pOwogICAgICAgIGZ1bmN0aW9uIHB1bGxBbGdvcml0aG0oKSB7CiAgICAgICAgICByZXR1cm4gVHJhbnNmb3JtU3RyZWFtRGVmYXVsdFNvdXJjZVB1bGxBbGdvcml0aG0oc3RyZWFtKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gY2FuY2VsQWxnb3JpdGhtKHJlYXNvbikgewogICAgICAgICAgVHJhbnNmb3JtU3RyZWFtRXJyb3JXcml0YWJsZUFuZFVuYmxvY2tXcml0ZShzdHJlYW0sIHJlYXNvbik7CiAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlc29sdmVkV2l0aCh1bmRlZmluZWQpOwogICAgICAgIH0KICAgICAgICBzdHJlYW0uX3JlYWRhYmxlID0gQ3JlYXRlUmVhZGFibGVTdHJlYW0oc3RhcnRBbGdvcml0aG0sIHB1bGxBbGdvcml0aG0sIGNhbmNlbEFsZ29yaXRobSwgcmVhZGFibGVIaWdoV2F0ZXJNYXJrLCByZWFkYWJsZVNpemVBbGdvcml0aG0pOwogICAgICAgIHN0cmVhbS5fYmFja3ByZXNzdXJlID0gdW5kZWZpbmVkOwogICAgICAgIHN0cmVhbS5fYmFja3ByZXNzdXJlQ2hhbmdlUHJvbWlzZSA9IHVuZGVmaW5lZDsKICAgICAgICBzdHJlYW0uX2JhY2twcmVzc3VyZUNoYW5nZVByb21pc2VfcmVzb2x2ZSA9IHVuZGVmaW5lZDsKICAgICAgICBUcmFuc2Zvcm1TdHJlYW1TZXRCYWNrcHJlc3N1cmUoc3RyZWFtLCB0cnVlKTsKICAgICAgICBzdHJlYW0uX3RyYW5zZm9ybVN0cmVhbUNvbnRyb2xsZXIgPSB1bmRlZmluZWQ7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gSXNUcmFuc2Zvcm1TdHJlYW0oeCkgewogICAgICAgIGlmICghdHlwZUlzT2JqZWN0KHgpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmICghT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHgsICdfdHJhbnNmb3JtU3RyZWFtQ29udHJvbGxlcicpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFRyYW5zZm9ybVN0cmVhbUVycm9yKHN0cmVhbSwgZSkgewogICAgICAgIFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJFcnJvcihzdHJlYW0uX3JlYWRhYmxlLl9yZWFkYWJsZVN0cmVhbUNvbnRyb2xsZXIsIGUpOwogICAgICAgIFRyYW5zZm9ybVN0cmVhbUVycm9yV3JpdGFibGVBbmRVbmJsb2NrV3JpdGUoc3RyZWFtLCBlKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBUcmFuc2Zvcm1TdHJlYW1FcnJvcldyaXRhYmxlQW5kVW5ibG9ja1dyaXRlKHN0cmVhbSwgZSkgewogICAgICAgIFRyYW5zZm9ybVN0cmVhbURlZmF1bHRDb250cm9sbGVyQ2xlYXJBbGdvcml0aG1zKHN0cmVhbS5fdHJhbnNmb3JtU3RyZWFtQ29udHJvbGxlcik7CiAgICAgICAgV3JpdGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckVycm9ySWZOZWVkZWQoc3RyZWFtLl93cml0YWJsZS5fd3JpdGFibGVTdHJlYW1Db250cm9sbGVyLCBlKTsKICAgICAgICBpZiAoc3RyZWFtLl9iYWNrcHJlc3N1cmUgPT09IHRydWUpIHsKICAgICAgICAgIFRyYW5zZm9ybVN0cmVhbVNldEJhY2twcmVzc3VyZShzdHJlYW0sIGZhbHNlKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gVHJhbnNmb3JtU3RyZWFtU2V0QmFja3ByZXNzdXJlKHN0cmVhbSwgYmFja3ByZXNzdXJlKSB7CiAgICAgICAgaWYgKHN0cmVhbS5fYmFja3ByZXNzdXJlQ2hhbmdlUHJvbWlzZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBzdHJlYW0uX2JhY2twcmVzc3VyZUNoYW5nZVByb21pc2VfcmVzb2x2ZSgpOwogICAgICAgIH0KICAgICAgICBzdHJlYW0uX2JhY2twcmVzc3VyZUNoYW5nZVByb21pc2UgPSBuZXdQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgICBzdHJlYW0uX2JhY2twcmVzc3VyZUNoYW5nZVByb21pc2VfcmVzb2x2ZSA9IHJlc29sdmU7CiAgICAgICAgfSk7CiAgICAgICAgc3RyZWFtLl9iYWNrcHJlc3N1cmUgPSBiYWNrcHJlc3N1cmU7CiAgICAgIH0KICAgICAgdmFyIFRyYW5zZm9ybVN0cmVhbURlZmF1bHRDb250cm9sbGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIFRyYW5zZm9ybVN0cmVhbURlZmF1bHRDb250cm9sbGVyKCkgewogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVHJhbnNmb3JtU3RyZWFtRGVmYXVsdENvbnRyb2xsZXIgaW5zdGFuY2VzIGNhbm5vdCBiZSBjcmVhdGVkIGRpcmVjdGx5Jyk7CiAgICAgICAgfQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShUcmFuc2Zvcm1TdHJlYW1EZWZhdWx0Q29udHJvbGxlci5wcm90b3R5cGUsICJkZXNpcmVkU2l6ZSIsIHsKICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICBpZiAoSXNUcmFuc2Zvcm1TdHJlYW1EZWZhdWx0Q29udHJvbGxlcih0aGlzKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICB0aHJvdyBkZWZhdWx0Q29udHJvbGxlckJyYW5kQ2hlY2tFeGNlcHRpb24kMSgnZGVzaXJlZFNpemUnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgcmVhZGFibGVDb250cm9sbGVyID0gdGhpcy5fY29udHJvbGxlZFRyYW5zZm9ybVN0cmVhbS5fcmVhZGFibGUuX3JlYWRhYmxlU3RyZWFtQ29udHJvbGxlcjsKICAgICAgICAgICAgcmV0dXJuIFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJHZXREZXNpcmVkU2l6ZShyZWFkYWJsZUNvbnRyb2xsZXIpOwogICAgICAgICAgfSwKICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICB9KTsKICAgICAgICBUcmFuc2Zvcm1TdHJlYW1EZWZhdWx0Q29udHJvbGxlci5wcm90b3R5cGUuZW5xdWV1ZSA9IGZ1bmN0aW9uIChjaHVuaykgewogICAgICAgICAgaWYgKElzVHJhbnNmb3JtU3RyZWFtRGVmYXVsdENvbnRyb2xsZXIodGhpcykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRocm93IGRlZmF1bHRDb250cm9sbGVyQnJhbmRDaGVja0V4Y2VwdGlvbiQxKCdlbnF1ZXVlJyk7CiAgICAgICAgICB9CiAgICAgICAgICBUcmFuc2Zvcm1TdHJlYW1EZWZhdWx0Q29udHJvbGxlckVucXVldWUodGhpcywgY2h1bmspOwogICAgICAgIH07CiAgICAgICAgVHJhbnNmb3JtU3RyZWFtRGVmYXVsdENvbnRyb2xsZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgaWYgKElzVHJhbnNmb3JtU3RyZWFtRGVmYXVsdENvbnRyb2xsZXIodGhpcykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRocm93IGRlZmF1bHRDb250cm9sbGVyQnJhbmRDaGVja0V4Y2VwdGlvbiQxKCdlcnJvcicpOwogICAgICAgICAgfQogICAgICAgICAgVHJhbnNmb3JtU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJFcnJvcih0aGlzLCByZWFzb24pOwogICAgICAgIH07CiAgICAgICAgVHJhbnNmb3JtU3RyZWFtRGVmYXVsdENvbnRyb2xsZXIucHJvdG90eXBlLnRlcm1pbmF0ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmIChJc1RyYW5zZm9ybVN0cmVhbURlZmF1bHRDb250cm9sbGVyKHRoaXMpID09PSBmYWxzZSkgewogICAgICAgICAgICB0aHJvdyBkZWZhdWx0Q29udHJvbGxlckJyYW5kQ2hlY2tFeGNlcHRpb24kMSgndGVybWluYXRlJyk7CiAgICAgICAgICB9CiAgICAgICAgICBUcmFuc2Zvcm1TdHJlYW1EZWZhdWx0Q29udHJvbGxlclRlcm1pbmF0ZSh0aGlzKTsKICAgICAgICB9OwogICAgICAgIHJldHVybiBUcmFuc2Zvcm1TdHJlYW1EZWZhdWx0Q29udHJvbGxlcjsKICAgICAgfSgpOwogICAgICBmdW5jdGlvbiBJc1RyYW5zZm9ybVN0cmVhbURlZmF1bHRDb250cm9sbGVyKHgpIHsKICAgICAgICBpZiAoIXR5cGVJc09iamVjdCh4KSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh4LCAnX2NvbnRyb2xsZWRUcmFuc2Zvcm1TdHJlYW0nKSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBmdW5jdGlvbiBTZXRVcFRyYW5zZm9ybVN0cmVhbURlZmF1bHRDb250cm9sbGVyKHN0cmVhbSwgY29udHJvbGxlciwgdHJhbnNmb3JtQWxnb3JpdGhtLCBmbHVzaEFsZ29yaXRobSkgewogICAgICAgIGNvbnRyb2xsZXIuX2NvbnRyb2xsZWRUcmFuc2Zvcm1TdHJlYW0gPSBzdHJlYW07CiAgICAgICAgc3RyZWFtLl90cmFuc2Zvcm1TdHJlYW1Db250cm9sbGVyID0gY29udHJvbGxlcjsKICAgICAgICBjb250cm9sbGVyLl90cmFuc2Zvcm1BbGdvcml0aG0gPSB0cmFuc2Zvcm1BbGdvcml0aG07CiAgICAgICAgY29udHJvbGxlci5fZmx1c2hBbGdvcml0aG0gPSBmbHVzaEFsZ29yaXRobTsKICAgICAgfQogICAgICBmdW5jdGlvbiBTZXRVcFRyYW5zZm9ybVN0cmVhbURlZmF1bHRDb250cm9sbGVyRnJvbVRyYW5zZm9ybWVyKHN0cmVhbSwgdHJhbnNmb3JtZXIpIHsKICAgICAgICB2YXIgY29udHJvbGxlciA9IE9iamVjdC5jcmVhdGUoVHJhbnNmb3JtU3RyZWFtRGVmYXVsdENvbnRyb2xsZXIucHJvdG90eXBlKTsKICAgICAgICB2YXIgdHJhbnNmb3JtQWxnb3JpdGhtID0gZnVuY3Rpb24gdHJhbnNmb3JtQWxnb3JpdGhtKGNodW5rKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBUcmFuc2Zvcm1TdHJlYW1EZWZhdWx0Q29udHJvbGxlckVucXVldWUoY29udHJvbGxlciwgY2h1bmspOwogICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlc29sdmVkV2l0aCh1bmRlZmluZWQpOwogICAgICAgICAgfSBjYXRjaCAodHJhbnNmb3JtUmVzdWx0RSkgewogICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlamVjdGVkV2l0aCh0cmFuc2Zvcm1SZXN1bHRFKTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIHZhciB0cmFuc2Zvcm1NZXRob2QgPSB0cmFuc2Zvcm1lci50cmFuc2Zvcm07CiAgICAgICAgaWYgKHRyYW5zZm9ybU1ldGhvZCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBpZiAodHlwZW9mIHRyYW5zZm9ybU1ldGhvZCAhPT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCd0cmFuc2Zvcm0gaXMgbm90IGEgbWV0aG9kJyk7CiAgICAgICAgICB9CiAgICAgICAgICB0cmFuc2Zvcm1BbGdvcml0aG0gPSBmdW5jdGlvbiB0cmFuc2Zvcm1BbGdvcml0aG0oY2h1bmspIHsKICAgICAgICAgICAgcmV0dXJuIFByb21pc2VDYWxsKHRyYW5zZm9ybU1ldGhvZCwgdHJhbnNmb3JtZXIsIFsKICAgICAgICAgICAgY2h1bmssCiAgICAgICAgICAgIGNvbnRyb2xsZXJdCiAgICAgICAgICAgICk7CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICB2YXIgZmx1c2hBbGdvcml0aG0gPSBDcmVhdGVBbGdvcml0aG1Gcm9tVW5kZXJseWluZ01ldGhvZCh0cmFuc2Zvcm1lciwgJ2ZsdXNoJywgMCwgW2NvbnRyb2xsZXJdKTsKICAgICAgICBTZXRVcFRyYW5zZm9ybVN0cmVhbURlZmF1bHRDb250cm9sbGVyKHN0cmVhbSwgY29udHJvbGxlciwgdHJhbnNmb3JtQWxnb3JpdGhtLCBmbHVzaEFsZ29yaXRobSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gVHJhbnNmb3JtU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJDbGVhckFsZ29yaXRobXMoY29udHJvbGxlcikgewogICAgICAgIGNvbnRyb2xsZXIuX3RyYW5zZm9ybUFsZ29yaXRobSA9IHVuZGVmaW5lZDsKICAgICAgICBjb250cm9sbGVyLl9mbHVzaEFsZ29yaXRobSA9IHVuZGVmaW5lZDsKICAgICAgfQogICAgICBmdW5jdGlvbiBUcmFuc2Zvcm1TdHJlYW1EZWZhdWx0Q29udHJvbGxlckVucXVldWUoY29udHJvbGxlciwgY2h1bmspIHsKICAgICAgICB2YXIgc3RyZWFtID0gY29udHJvbGxlci5fY29udHJvbGxlZFRyYW5zZm9ybVN0cmVhbTsKICAgICAgICB2YXIgcmVhZGFibGVDb250cm9sbGVyID0gc3RyZWFtLl9yZWFkYWJsZS5fcmVhZGFibGVTdHJlYW1Db250cm9sbGVyOwogICAgICAgIGlmIChSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyQ2FuQ2xvc2VPckVucXVldWUocmVhZGFibGVDb250cm9sbGVyKSA9PT0gZmFsc2UpIHsKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1JlYWRhYmxlIHNpZGUgaXMgbm90IGluIGEgc3RhdGUgdGhhdCBwZXJtaXRzIGVucXVldWUnKTsKICAgICAgICB9CiAgICAgICAgdHJ5IHsKICAgICAgICAgIFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJFbnF1ZXVlKHJlYWRhYmxlQ29udHJvbGxlciwgY2h1bmspOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIFRyYW5zZm9ybVN0cmVhbUVycm9yV3JpdGFibGVBbmRVbmJsb2NrV3JpdGUoc3RyZWFtLCBlKTsKICAgICAgICAgIHRocm93IHN0cmVhbS5fcmVhZGFibGUuX3N0b3JlZEVycm9yOwogICAgICAgIH0KICAgICAgICB2YXIgYmFja3ByZXNzdXJlID0gUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlckhhc0JhY2twcmVzc3VyZShyZWFkYWJsZUNvbnRyb2xsZXIpOwogICAgICAgIGlmIChiYWNrcHJlc3N1cmUgIT09IHN0cmVhbS5fYmFja3ByZXNzdXJlKSB7CiAgICAgICAgICBUcmFuc2Zvcm1TdHJlYW1TZXRCYWNrcHJlc3N1cmUoc3RyZWFtLCB0cnVlKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gVHJhbnNmb3JtU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJFcnJvcihjb250cm9sbGVyLCBlKSB7CiAgICAgICAgVHJhbnNmb3JtU3RyZWFtRXJyb3IoY29udHJvbGxlci5fY29udHJvbGxlZFRyYW5zZm9ybVN0cmVhbSwgZSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gVHJhbnNmb3JtU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJQZXJmb3JtVHJhbnNmb3JtKGNvbnRyb2xsZXIsIGNodW5rKSB7CiAgICAgICAgdmFyIHRyYW5zZm9ybVByb21pc2UgPSBjb250cm9sbGVyLl90cmFuc2Zvcm1BbGdvcml0aG0oY2h1bmspOwogICAgICAgIHJldHVybiB0cmFuc2Zvcm1Qcm9taXNlV2l0aCh0cmFuc2Zvcm1Qcm9taXNlLCB1bmRlZmluZWQsIGZ1bmN0aW9uIChyKSB7CiAgICAgICAgICBUcmFuc2Zvcm1TdHJlYW1FcnJvcihjb250cm9sbGVyLl9jb250cm9sbGVkVHJhbnNmb3JtU3RyZWFtLCByKTsKICAgICAgICAgIHRocm93IHI7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gVHJhbnNmb3JtU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJUZXJtaW5hdGUoY29udHJvbGxlcikgewogICAgICAgIHZhciBzdHJlYW0gPSBjb250cm9sbGVyLl9jb250cm9sbGVkVHJhbnNmb3JtU3RyZWFtOwogICAgICAgIHZhciByZWFkYWJsZUNvbnRyb2xsZXIgPSBzdHJlYW0uX3JlYWRhYmxlLl9yZWFkYWJsZVN0cmVhbUNvbnRyb2xsZXI7CiAgICAgICAgaWYgKFJlYWRhYmxlU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJDYW5DbG9zZU9yRW5xdWV1ZShyZWFkYWJsZUNvbnRyb2xsZXIpID09PSB0cnVlKSB7CiAgICAgICAgICBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyQ2xvc2UocmVhZGFibGVDb250cm9sbGVyKTsKICAgICAgICB9CiAgICAgICAgdmFyIGVycm9yID0gbmV3IFR5cGVFcnJvcignVHJhbnNmb3JtU3RyZWFtIHRlcm1pbmF0ZWQnKTsKICAgICAgICBUcmFuc2Zvcm1TdHJlYW1FcnJvcldyaXRhYmxlQW5kVW5ibG9ja1dyaXRlKHN0cmVhbSwgZXJyb3IpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFRyYW5zZm9ybVN0cmVhbURlZmF1bHRTaW5rV3JpdGVBbGdvcml0aG0oc3RyZWFtLCBjaHVuaykgewogICAgICAgIHZhciBjb250cm9sbGVyID0gc3RyZWFtLl90cmFuc2Zvcm1TdHJlYW1Db250cm9sbGVyOwogICAgICAgIGlmIChzdHJlYW0uX2JhY2twcmVzc3VyZSA9PT0gdHJ1ZSkgewogICAgICAgICAgdmFyIGJhY2twcmVzc3VyZUNoYW5nZVByb21pc2UgPSBzdHJlYW0uX2JhY2twcmVzc3VyZUNoYW5nZVByb21pc2U7CiAgICAgICAgICByZXR1cm4gdHJhbnNmb3JtUHJvbWlzZVdpdGgoYmFja3ByZXNzdXJlQ2hhbmdlUHJvbWlzZSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgd3JpdGFibGUgPSBzdHJlYW0uX3dyaXRhYmxlOwogICAgICAgICAgICB2YXIgc3RhdGUgPSB3cml0YWJsZS5fc3RhdGU7CiAgICAgICAgICAgIGlmIChzdGF0ZSA9PT0gJ2Vycm9yaW5nJykgewogICAgICAgICAgICAgIHRocm93IHdyaXRhYmxlLl9zdG9yZWRFcnJvcjsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gVHJhbnNmb3JtU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJQZXJmb3JtVHJhbnNmb3JtKGNvbnRyb2xsZXIsIGNodW5rKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gVHJhbnNmb3JtU3RyZWFtRGVmYXVsdENvbnRyb2xsZXJQZXJmb3JtVHJhbnNmb3JtKGNvbnRyb2xsZXIsIGNodW5rKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBUcmFuc2Zvcm1TdHJlYW1EZWZhdWx0U2lua0Fib3J0QWxnb3JpdGhtKHN0cmVhbSwgcmVhc29uKSB7CiAgICAgICAgVHJhbnNmb3JtU3RyZWFtRXJyb3Ioc3RyZWFtLCByZWFzb24pOwogICAgICAgIHJldHVybiBwcm9taXNlUmVzb2x2ZWRXaXRoKHVuZGVmaW5lZCk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gVHJhbnNmb3JtU3RyZWFtRGVmYXVsdFNpbmtDbG9zZUFsZ29yaXRobShzdHJlYW0pIHsKICAgICAgICB2YXIgcmVhZGFibGUgPSBzdHJlYW0uX3JlYWRhYmxlOwogICAgICAgIHZhciBjb250cm9sbGVyID0gc3RyZWFtLl90cmFuc2Zvcm1TdHJlYW1Db250cm9sbGVyOwogICAgICAgIHZhciBmbHVzaFByb21pc2UgPSBjb250cm9sbGVyLl9mbHVzaEFsZ29yaXRobSgpOwogICAgICAgIFRyYW5zZm9ybVN0cmVhbURlZmF1bHRDb250cm9sbGVyQ2xlYXJBbGdvcml0aG1zKGNvbnRyb2xsZXIpOwogICAgICAgIHJldHVybiB0cmFuc2Zvcm1Qcm9taXNlV2l0aChmbHVzaFByb21pc2UsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmIChyZWFkYWJsZS5fc3RhdGUgPT09ICdlcnJvcmVkJykgewogICAgICAgICAgICB0aHJvdyByZWFkYWJsZS5fc3RvcmVkRXJyb3I7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgcmVhZGFibGVDb250cm9sbGVyID0gcmVhZGFibGUuX3JlYWRhYmxlU3RyZWFtQ29udHJvbGxlcjsKICAgICAgICAgIGlmIChSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyQ2FuQ2xvc2VPckVucXVldWUocmVhZGFibGVDb250cm9sbGVyKSA9PT0gdHJ1ZSkgewogICAgICAgICAgICBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyQ2xvc2UocmVhZGFibGVDb250cm9sbGVyKTsKICAgICAgICAgIH0KICAgICAgICB9LCBmdW5jdGlvbiAocikgewogICAgICAgICAgVHJhbnNmb3JtU3RyZWFtRXJyb3Ioc3RyZWFtLCByKTsKICAgICAgICAgIHRocm93IHJlYWRhYmxlLl9zdG9yZWRFcnJvcjsKICAgICAgICB9KTsKICAgICAgfQogICAgICBmdW5jdGlvbiBUcmFuc2Zvcm1TdHJlYW1EZWZhdWx0U291cmNlUHVsbEFsZ29yaXRobShzdHJlYW0pIHsKICAgICAgICBUcmFuc2Zvcm1TdHJlYW1TZXRCYWNrcHJlc3N1cmUoc3RyZWFtLCBmYWxzZSk7CiAgICAgICAgcmV0dXJuIHN0cmVhbS5fYmFja3ByZXNzdXJlQ2hhbmdlUHJvbWlzZTsKICAgICAgfQogICAgICBmdW5jdGlvbiBkZWZhdWx0Q29udHJvbGxlckJyYW5kQ2hlY2tFeGNlcHRpb24kMShuYW1lKSB7CiAgICAgICAgcmV0dXJuIG5ldyBUeXBlRXJyb3IoIlRyYW5zZm9ybVN0cmVhbURlZmF1bHRDb250cm9sbGVyLnByb3RvdHlwZS4iICsgbmFtZSArICIgY2FuIG9ubHkgYmUgdXNlZCBvbiBhIFRyYW5zZm9ybVN0cmVhbURlZmF1bHRDb250cm9sbGVyIik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gc3RyZWFtQnJhbmRDaGVja0V4Y2VwdGlvbiQyKG5hbWUpIHsKICAgICAgICByZXR1cm4gbmV3IFR5cGVFcnJvcigiVHJhbnNmb3JtU3RyZWFtLnByb3RvdHlwZS4iICsgbmFtZSArICIgY2FuIG9ubHkgYmUgdXNlZCBvbiBhIFRyYW5zZm9ybVN0cmVhbSIpOwogICAgICB9CiAgICAgIGV4cG9ydHMuQnl0ZUxlbmd0aFF1ZXVpbmdTdHJhdGVneSA9IEJ5dGVMZW5ndGhRdWV1aW5nU3RyYXRlZ3k7CiAgICAgIGV4cG9ydHMuQ291bnRRdWV1aW5nU3RyYXRlZ3kgPSBDb3VudFF1ZXVpbmdTdHJhdGVneTsKICAgICAgZXhwb3J0cy5SZWFkYWJsZVN0cmVhbSA9IFJlYWRhYmxlU3RyZWFtOwogICAgICBleHBvcnRzLlRyYW5zZm9ybVN0cmVhbSA9IFRyYW5zZm9ybVN0cmVhbTsKICAgICAgZXhwb3J0cy5Xcml0YWJsZVN0cmVhbSA9IFdyaXRhYmxlU3RyZWFtOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pOwogICAgfSk7CgogICAgLyoqKi99KSwgKAogIC8qIDE0MCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIF9fd19wZGZqc19yZXF1aXJlX18oMTQxKTsKICAgIF9fd19wZGZqc19yZXF1aXJlX18oMTA5KTsKICAgIF9fd19wZGZqc19yZXF1aXJlX18oNzcpOwogICAgX193X3BkZmpzX3JlcXVpcmVfXygxMTEpOwogICAgdmFyIHBhdGggPSBfX3dfcGRmanNfcmVxdWlyZV9fKDQyKTsKICAgIG1vZHVsZS5leHBvcnRzID0gcGF0aC5NYXA7CgogICAgLyoqKi99KSwgKAogIC8qIDE0MSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgY29sbGVjdGlvbiA9IF9fd19wZGZqc19yZXF1aXJlX18oMTQyKTsKICAgIHZhciBjb2xsZWN0aW9uU3Ryb25nID0gX193X3BkZmpzX3JlcXVpcmVfXygxNDYpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBjb2xsZWN0aW9uKCdNYXAnLCBmdW5jdGlvbiAoaW5pdCkgewogICAgICByZXR1cm4gZnVuY3Rpb24gTWFwKCkgewogICAgICAgIHJldHVybiBpbml0KHRoaXMsIGFyZ3VtZW50cy5sZW5ndGggPyBhcmd1bWVudHNbMF0gOiB1bmRlZmluZWQpOwogICAgICB9OwogICAgfSwgY29sbGVjdGlvblN0cm9uZyk7CgogICAgLyoqKi99KSwgKAogIC8qIDE0MiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgJCA9IF9fd19wZGZqc19yZXF1aXJlX18oOSk7CiAgICB2YXIgZ2xvYmFsID0gX193X3BkZmpzX3JlcXVpcmVfXygxMCk7CiAgICB2YXIgaXNGb3JjZWQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUxKTsKICAgIHZhciByZWRlZmluZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjgpOwogICAgdmFyIEludGVybmFsTWV0YWRhdGFNb2R1bGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE0Myk7CiAgICB2YXIgaXRlcmF0ZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTE5KTsKICAgIHZhciBhbkluc3RhbmNlID0gX193X3BkZmpzX3JlcXVpcmVfXygxMTgpOwogICAgdmFyIGlzT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygyMSk7CiAgICB2YXIgZmFpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEzKTsKICAgIHZhciBjaGVja0NvcnJlY3RuZXNzT2ZJdGVyYXRpb24gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDk3KTsKICAgIHZhciBzZXRUb1N0cmluZ1RhZyA9IF9fd19wZGZqc19yZXF1aXJlX18oODUpOwogICAgdmFyIGluaGVyaXRJZlJlcXVpcmVkID0gX193X3BkZmpzX3JlcXVpcmVfXygxNDUpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoQ09OU1RSVUNUT1JfTkFNRSwgd3JhcHBlciwgY29tbW9uKSB7CiAgICAgIHZhciBJU19NQVAgPSBDT05TVFJVQ1RPUl9OQU1FLmluZGV4T2YoJ01hcCcpICE9PSAtMTsKICAgICAgdmFyIElTX1dFQUsgPSBDT05TVFJVQ1RPUl9OQU1FLmluZGV4T2YoJ1dlYWsnKSAhPT0gLTE7CiAgICAgIHZhciBBRERFUiA9IElTX01BUCA/ICdzZXQnIDogJ2FkZCc7CiAgICAgIHZhciBOYXRpdmVDb25zdHJ1Y3RvciA9IGdsb2JhbFtDT05TVFJVQ1RPUl9OQU1FXTsKICAgICAgdmFyIE5hdGl2ZVByb3RvdHlwZSA9IE5hdGl2ZUNvbnN0cnVjdG9yICYmIE5hdGl2ZUNvbnN0cnVjdG9yLnByb3RvdHlwZTsKICAgICAgdmFyIENvbnN0cnVjdG9yID0gTmF0aXZlQ29uc3RydWN0b3I7CiAgICAgIHZhciBleHBvcnRlZCA9IHt9OwogICAgICB2YXIgZml4TWV0aG9kID0gZnVuY3Rpb24gZml4TWV0aG9kKEtFWSkgewogICAgICAgIHZhciBuYXRpdmVNZXRob2QgPSBOYXRpdmVQcm90b3R5cGVbS0VZXTsKICAgICAgICByZWRlZmluZShOYXRpdmVQcm90b3R5cGUsIEtFWSwgS0VZID09ICdhZGQnID8gZnVuY3Rpb24gYWRkKHZhbHVlKSB7CiAgICAgICAgICBuYXRpdmVNZXRob2QuY2FsbCh0aGlzLCB2YWx1ZSA9PT0gMCA/IDAgOiB2YWx1ZSk7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9IDogS0VZID09ICdkZWxldGUnID8gZnVuY3Rpb24gKGtleSkgewogICAgICAgICAgcmV0dXJuIElTX1dFQUsgJiYgIWlzT2JqZWN0KGtleSkgPyBmYWxzZSA6IG5hdGl2ZU1ldGhvZC5jYWxsKHRoaXMsIGtleSA9PT0gMCA/IDAgOiBrZXkpOwogICAgICAgIH0gOiBLRVkgPT0gJ2dldCcgPyBmdW5jdGlvbiBnZXQoa2V5KSB7CiAgICAgICAgICByZXR1cm4gSVNfV0VBSyAmJiAhaXNPYmplY3Qoa2V5KSA/IHVuZGVmaW5lZCA6IG5hdGl2ZU1ldGhvZC5jYWxsKHRoaXMsIGtleSA9PT0gMCA/IDAgOiBrZXkpOwogICAgICAgIH0gOiBLRVkgPT0gJ2hhcycgPyBmdW5jdGlvbiBoYXMoa2V5KSB7CiAgICAgICAgICByZXR1cm4gSVNfV0VBSyAmJiAhaXNPYmplY3Qoa2V5KSA/IGZhbHNlIDogbmF0aXZlTWV0aG9kLmNhbGwodGhpcywga2V5ID09PSAwID8gMCA6IGtleSk7CiAgICAgICAgfSA6IGZ1bmN0aW9uIHNldChrZXksIHZhbHVlKSB7CiAgICAgICAgICBuYXRpdmVNZXRob2QuY2FsbCh0aGlzLCBrZXkgPT09IDAgPyAwIDoga2V5LCB2YWx1ZSk7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9KTsKICAgICAgfTsKICAgICAgaWYgKGlzRm9yY2VkKENPTlNUUlVDVE9SX05BTUUsIHR5cGVvZiBOYXRpdmVDb25zdHJ1Y3RvciAhPSAnZnVuY3Rpb24nIHx8ICEoSVNfV0VBSyB8fCBOYXRpdmVQcm90b3R5cGUuZm9yRWFjaCAmJiAhZmFpbHMoZnVuY3Rpb24gKCkgewogICAgICAgIG5ldyBOYXRpdmVDb25zdHJ1Y3RvcigpLmVudHJpZXMoKS5uZXh0KCk7CiAgICAgIH0pKSkpIHsKICAgICAgICBDb25zdHJ1Y3RvciA9IGNvbW1vbi5nZXRDb25zdHJ1Y3Rvcih3cmFwcGVyLCBDT05TVFJVQ1RPUl9OQU1FLCBJU19NQVAsIEFEREVSKTsKICAgICAgICBJbnRlcm5hbE1ldGFkYXRhTW9kdWxlLlJFUVVJUkVEID0gdHJ1ZTsKICAgICAgfSBlbHNlIGlmIChpc0ZvcmNlZChDT05TVFJVQ1RPUl9OQU1FLCB0cnVlKSkgewogICAgICAgIHZhciBpbnN0YW5jZSA9IG5ldyBDb25zdHJ1Y3RvcigpOwogICAgICAgIHZhciBIQVNOVF9DSEFJTklORyA9IGluc3RhbmNlW0FEREVSXShJU19XRUFLID8ge30gOiAtMCwgMSkgIT0gaW5zdGFuY2U7CiAgICAgICAgdmFyIFRIUk9XU19PTl9QUklNSVRJVkVTID0gZmFpbHMoZnVuY3Rpb24gKCkgewogICAgICAgICAgaW5zdGFuY2UuaGFzKDEpOwogICAgICAgIH0pOwogICAgICAgIHZhciBBQ0NFUFRfSVRFUkFCTEVTID0gY2hlY2tDb3JyZWN0bmVzc09mSXRlcmF0aW9uKGZ1bmN0aW9uIChpdGVyYWJsZSkgewogICAgICAgICAgbmV3IE5hdGl2ZUNvbnN0cnVjdG9yKGl0ZXJhYmxlKTsKICAgICAgICB9KTsKICAgICAgICB2YXIgQlVHR1lfWkVSTyA9ICFJU19XRUFLICYmIGZhaWxzKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciAkaW5zdGFuY2UgPSBuZXcgTmF0aXZlQ29uc3RydWN0b3IoKTsKICAgICAgICAgIHZhciBpbmRleCA9IDU7CiAgICAgICAgICB3aGlsZSAoaW5kZXgtLSkKICAgICAgICAgICRpbnN0YW5jZVtBRERFUl0oaW5kZXgsIGluZGV4KTsKICAgICAgICAgIHJldHVybiAhJGluc3RhbmNlLmhhcygtMCk7CiAgICAgICAgfSk7CiAgICAgICAgaWYgKCFBQ0NFUFRfSVRFUkFCTEVTKSB7CiAgICAgICAgICBDb25zdHJ1Y3RvciA9IHdyYXBwZXIoZnVuY3Rpb24gKGR1bW15LCBpdGVyYWJsZSkgewogICAgICAgICAgICBhbkluc3RhbmNlKGR1bW15LCBDb25zdHJ1Y3RvciwgQ09OU1RSVUNUT1JfTkFNRSk7CiAgICAgICAgICAgIHZhciB0aGF0ID0gaW5oZXJpdElmUmVxdWlyZWQobmV3IE5hdGl2ZUNvbnN0cnVjdG9yKCksIGR1bW15LCBDb25zdHJ1Y3Rvcik7CiAgICAgICAgICAgIGlmIChpdGVyYWJsZSAhPSB1bmRlZmluZWQpCiAgICAgICAgICAgIGl0ZXJhdGUoaXRlcmFibGUsIHRoYXRbQURERVJdLCB0aGF0LCBJU19NQVApOwogICAgICAgICAgICByZXR1cm4gdGhhdDsKICAgICAgICAgIH0pOwogICAgICAgICAgQ29uc3RydWN0b3IucHJvdG90eXBlID0gTmF0aXZlUHJvdG90eXBlOwogICAgICAgICAgTmF0aXZlUHJvdG90eXBlLmNvbnN0cnVjdG9yID0gQ29uc3RydWN0b3I7CiAgICAgICAgfQogICAgICAgIGlmIChUSFJPV1NfT05fUFJJTUlUSVZFUyB8fCBCVUdHWV9aRVJPKSB7CiAgICAgICAgICBmaXhNZXRob2QoJ2RlbGV0ZScpOwogICAgICAgICAgZml4TWV0aG9kKCdoYXMnKTsKICAgICAgICAgIElTX01BUCAmJiBmaXhNZXRob2QoJ2dldCcpOwogICAgICAgIH0KICAgICAgICBpZiAoQlVHR1lfWkVSTyB8fCBIQVNOVF9DSEFJTklORykKICAgICAgICBmaXhNZXRob2QoQURERVIpOwogICAgICAgIGlmIChJU19XRUFLICYmIE5hdGl2ZVByb3RvdHlwZS5jbGVhcikKICAgICAgICBkZWxldGUgTmF0aXZlUHJvdG90eXBlLmNsZWFyOwogICAgICB9CiAgICAgIGV4cG9ydGVkW0NPTlNUUlVDVE9SX05BTUVdID0gQ29uc3RydWN0b3I7CiAgICAgICQoewogICAgICAgIGdsb2JhbDogdHJ1ZSwKICAgICAgICBmb3JjZWQ6IENvbnN0cnVjdG9yICE9IE5hdGl2ZUNvbnN0cnVjdG9yCiAgICAgIH0sIGV4cG9ydGVkKTsKICAgICAgc2V0VG9TdHJpbmdUYWcoQ29uc3RydWN0b3IsIENPTlNUUlVDVE9SX05BTUUpOwogICAgICBpZiAoIUlTX1dFQUspCiAgICAgIGNvbW1vbi5zZXRTdHJvbmcoQ29uc3RydWN0b3IsIENPTlNUUlVDVE9SX05BTUUsIElTX01BUCk7CiAgICAgIHJldHVybiBDb25zdHJ1Y3RvcjsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDE0MyAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBoaWRkZW5LZXlzID0gX193X3BkZmpzX3JlcXVpcmVfXygzOCk7CiAgICB2YXIgaXNPYmplY3QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIxKTsKICAgIHZhciBoYXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIyKTsKICAgIHZhciBkZWZpbmVQcm9wZXJ0eSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjYpLmY7CiAgICB2YXIgdWlkID0gX193X3BkZmpzX3JlcXVpcmVfXygzNyk7CiAgICB2YXIgRlJFRVpJTkcgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE0NCk7CiAgICB2YXIgTUVUQURBVEEgPSB1aWQoJ21ldGEnKTsKICAgIHZhciBpZCA9IDA7CiAgICB2YXIgaXNFeHRlbnNpYmxlID0gT2JqZWN0LmlzRXh0ZW5zaWJsZSB8fCBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfTsKICAgIHZhciBzZXRNZXRhZGF0YSA9IGZ1bmN0aW9uIHNldE1ldGFkYXRhKGl0KSB7CiAgICAgIGRlZmluZVByb3BlcnR5KGl0LCBNRVRBREFUQSwgewogICAgICAgIHZhbHVlOiB7CiAgICAgICAgICBvYmplY3RJRDogJ08nICsgKytpZCwKICAgICAgICAgIHdlYWtEYXRhOiB7fQogICAgICAgIH0KICAgICAgfSk7CiAgICB9OwogICAgdmFyIGZhc3RLZXkgPSBmdW5jdGlvbiBmYXN0S2V5KGl0LCBjcmVhdGUpIHsKICAgICAgaWYgKCFpc09iamVjdChpdCkpCiAgICAgIHJldHVybiB0eXBlb2YgaXQgPT0gJ3N5bWJvbCcgPyBpdCA6ICh0eXBlb2YgaXQgPT0gJ3N0cmluZycgPyAnUycgOiAnUCcpICsgaXQ7CiAgICAgIGlmICghaGFzKGl0LCBNRVRBREFUQSkpIHsKICAgICAgICBpZiAoIWlzRXh0ZW5zaWJsZShpdCkpCiAgICAgICAgcmV0dXJuICdGJzsKICAgICAgICBpZiAoIWNyZWF0ZSkKICAgICAgICByZXR1cm4gJ0UnOwogICAgICAgIHNldE1ldGFkYXRhKGl0KTsKICAgICAgfQogICAgICByZXR1cm4gaXRbTUVUQURBVEFdLm9iamVjdElEOwogICAgfTsKICAgIHZhciBnZXRXZWFrRGF0YSA9IGZ1bmN0aW9uIGdldFdlYWtEYXRhKGl0LCBjcmVhdGUpIHsKICAgICAgaWYgKCFoYXMoaXQsIE1FVEFEQVRBKSkgewogICAgICAgIGlmICghaXNFeHRlbnNpYmxlKGl0KSkKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoIWNyZWF0ZSkKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgc2V0TWV0YWRhdGEoaXQpOwogICAgICB9CiAgICAgIHJldHVybiBpdFtNRVRBREFUQV0ud2Vha0RhdGE7CiAgICB9OwogICAgdmFyIG9uRnJlZXplID0gZnVuY3Rpb24gb25GcmVlemUoaXQpIHsKICAgICAgaWYgKEZSRUVaSU5HICYmIG1ldGEuUkVRVUlSRUQgJiYgaXNFeHRlbnNpYmxlKGl0KSAmJiAhaGFzKGl0LCBNRVRBREFUQSkpCiAgICAgIHNldE1ldGFkYXRhKGl0KTsKICAgICAgcmV0dXJuIGl0OwogICAgfTsKICAgIHZhciBtZXRhID0gbW9kdWxlLmV4cG9ydHMgPSB7CiAgICAgIFJFUVVJUkVEOiBmYWxzZSwKICAgICAgZmFzdEtleTogZmFzdEtleSwKICAgICAgZ2V0V2Vha0RhdGE6IGdldFdlYWtEYXRhLAogICAgICBvbkZyZWV6ZTogb25GcmVlemUKICAgIH07CiAgICBoaWRkZW5LZXlzW01FVEFEQVRBXSA9IHRydWU7CgogICAgLyoqKi99KSwgKAogIC8qIDE0NCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBmYWlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTMpOwogICAgbW9kdWxlLmV4cG9ydHMgPSAhZmFpbHMoZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gT2JqZWN0LmlzRXh0ZW5zaWJsZShPYmplY3QucHJldmVudEV4dGVuc2lvbnMoe30pKTsKICAgIH0pOwoKICAgIC8qKiovfSksICgKICAvKiAxNDUgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgaXNPYmplY3QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIxKTsKICAgIHZhciBzZXRQcm90b3R5cGVPZiA9IF9fd19wZGZqc19yZXF1aXJlX18oODcpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoJHRoaXMsIGR1bW15LCBXcmFwcGVyKSB7CiAgICAgIHZhciBOZXdUYXJnZXQsIE5ld1RhcmdldFByb3RvdHlwZTsKICAgICAgaWYgKHNldFByb3RvdHlwZU9mICYmIHR5cGVvZiAoTmV3VGFyZ2V0ID0gZHVtbXkuY29uc3RydWN0b3IpID09ICdmdW5jdGlvbicgJiYgTmV3VGFyZ2V0ICE9PSBXcmFwcGVyICYmIGlzT2JqZWN0KE5ld1RhcmdldFByb3RvdHlwZSA9IE5ld1RhcmdldC5wcm90b3R5cGUpICYmIE5ld1RhcmdldFByb3RvdHlwZSAhPT0gV3JhcHBlci5wcm90b3R5cGUpCiAgICAgIHNldFByb3RvdHlwZU9mKCR0aGlzLCBOZXdUYXJnZXRQcm90b3R5cGUpOwogICAgICByZXR1cm4gJHRoaXM7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAxNDYgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGRlZmluZVByb3BlcnR5ID0gX193X3BkZmpzX3JlcXVpcmVfXygyNikuZjsKICAgIHZhciBjcmVhdGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDcxKTsKICAgIHZhciByZWRlZmluZUFsbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTE2KTsKICAgIHZhciBiaW5kID0gX193X3BkZmpzX3JlcXVpcmVfXyg2Mik7CiAgICB2YXIgYW5JbnN0YW5jZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTE4KTsKICAgIHZhciBpdGVyYXRlID0gX193X3BkZmpzX3JlcXVpcmVfXygxMTkpOwogICAgdmFyIGRlZmluZUl0ZXJhdG9yID0gX193X3BkZmpzX3JlcXVpcmVfXyg3OSk7CiAgICB2YXIgc2V0U3BlY2llcyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTE3KTsKICAgIHZhciBERVNDUklQVE9SUyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTIpOwogICAgdmFyIGZhc3RLZXkgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE0MykuZmFzdEtleTsKICAgIHZhciBJbnRlcm5hbFN0YXRlTW9kdWxlID0gX193X3BkZmpzX3JlcXVpcmVfXygzMik7CiAgICB2YXIgc2V0SW50ZXJuYWxTdGF0ZSA9IEludGVybmFsU3RhdGVNb2R1bGUuc2V0OwogICAgdmFyIGludGVybmFsU3RhdGVHZXR0ZXJGb3IgPSBJbnRlcm5hbFN0YXRlTW9kdWxlLmdldHRlckZvcjsKICAgIG1vZHVsZS5leHBvcnRzID0gewogICAgICBnZXRDb25zdHJ1Y3RvcjogZnVuY3Rpb24gZ2V0Q29uc3RydWN0b3Iod3JhcHBlciwgQ09OU1RSVUNUT1JfTkFNRSwgSVNfTUFQLCBBRERFUikgewogICAgICAgIHZhciBDID0gd3JhcHBlcihmdW5jdGlvbiAodGhhdCwgaXRlcmFibGUpIHsKICAgICAgICAgIGFuSW5zdGFuY2UodGhhdCwgQywgQ09OU1RSVUNUT1JfTkFNRSk7CiAgICAgICAgICBzZXRJbnRlcm5hbFN0YXRlKHRoYXQsIHsKICAgICAgICAgICAgdHlwZTogQ09OU1RSVUNUT1JfTkFNRSwKICAgICAgICAgICAgaW5kZXg6IGNyZWF0ZShudWxsKSwKICAgICAgICAgICAgZmlyc3Q6IHVuZGVmaW5lZCwKICAgICAgICAgICAgbGFzdDogdW5kZWZpbmVkLAogICAgICAgICAgICBzaXplOiAwCiAgICAgICAgICB9KTsKICAgICAgICAgIGlmICghREVTQ1JJUFRPUlMpCiAgICAgICAgICB0aGF0LnNpemUgPSAwOwogICAgICAgICAgaWYgKGl0ZXJhYmxlICE9IHVuZGVmaW5lZCkKICAgICAgICAgIGl0ZXJhdGUoaXRlcmFibGUsIHRoYXRbQURERVJdLCB0aGF0LCBJU19NQVApOwogICAgICAgIH0pOwogICAgICAgIHZhciBnZXRJbnRlcm5hbFN0YXRlID0gaW50ZXJuYWxTdGF0ZUdldHRlckZvcihDT05TVFJVQ1RPUl9OQU1FKTsKICAgICAgICB2YXIgZGVmaW5lID0gZnVuY3Rpb24gZGVmaW5lKHRoYXQsIGtleSwgdmFsdWUpIHsKICAgICAgICAgIHZhciBzdGF0ZSA9IGdldEludGVybmFsU3RhdGUodGhhdCk7CiAgICAgICAgICB2YXIgZW50cnkgPSBnZXRFbnRyeSh0aGF0LCBrZXkpOwogICAgICAgICAgdmFyIHByZXZpb3VzLCBpbmRleDsKICAgICAgICAgIGlmIChlbnRyeSkgewogICAgICAgICAgICBlbnRyeS52YWx1ZSA9IHZhbHVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3RhdGUubGFzdCA9IGVudHJ5ID0gewogICAgICAgICAgICAgIGluZGV4OiBpbmRleCA9IGZhc3RLZXkoa2V5LCB0cnVlKSwKICAgICAgICAgICAgICBrZXk6IGtleSwKICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgICAgICAgcHJldmlvdXM6IHByZXZpb3VzID0gc3RhdGUubGFzdCwKICAgICAgICAgICAgICBuZXh0OiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgcmVtb3ZlZDogZmFsc2UKICAgICAgICAgICAgfTsKICAgICAgICAgICAgaWYgKCFzdGF0ZS5maXJzdCkKICAgICAgICAgICAgc3RhdGUuZmlyc3QgPSBlbnRyeTsKICAgICAgICAgICAgaWYgKHByZXZpb3VzKQogICAgICAgICAgICBwcmV2aW91cy5uZXh0ID0gZW50cnk7CiAgICAgICAgICAgIGlmIChERVNDUklQVE9SUykKICAgICAgICAgICAgc3RhdGUuc2l6ZSsrO2Vsc2UKCiAgICAgICAgICAgIHRoYXQuc2l6ZSsrOwogICAgICAgICAgICBpZiAoaW5kZXggIT09ICdGJykKICAgICAgICAgICAgc3RhdGUuaW5kZXhbaW5kZXhdID0gZW50cnk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdGhhdDsKICAgICAgICB9OwogICAgICAgIHZhciBnZXRFbnRyeSA9IGZ1bmN0aW9uIGdldEVudHJ5KHRoYXQsIGtleSkgewogICAgICAgICAgdmFyIHN0YXRlID0gZ2V0SW50ZXJuYWxTdGF0ZSh0aGF0KTsKICAgICAgICAgIHZhciBpbmRleCA9IGZhc3RLZXkoa2V5KTsKICAgICAgICAgIHZhciBlbnRyeTsKICAgICAgICAgIGlmIChpbmRleCAhPT0gJ0YnKQogICAgICAgICAgcmV0dXJuIHN0YXRlLmluZGV4W2luZGV4XTsKICAgICAgICAgIGZvciAoZW50cnkgPSBzdGF0ZS5maXJzdDsgZW50cnk7IGVudHJ5ID0gZW50cnkubmV4dCkgewogICAgICAgICAgICBpZiAoZW50cnkua2V5ID09IGtleSkKICAgICAgICAgICAgcmV0dXJuIGVudHJ5OwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgcmVkZWZpbmVBbGwoQy5wcm90b3R5cGUsIHsKICAgICAgICAgIGNsZWFyOiBmdW5jdGlvbiBjbGVhcigpIHsKICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzOwogICAgICAgICAgICB2YXIgc3RhdGUgPSBnZXRJbnRlcm5hbFN0YXRlKHRoYXQpOwogICAgICAgICAgICB2YXIgZGF0YSA9IHN0YXRlLmluZGV4OwogICAgICAgICAgICB2YXIgZW50cnkgPSBzdGF0ZS5maXJzdDsKICAgICAgICAgICAgd2hpbGUgKGVudHJ5KSB7CiAgICAgICAgICAgICAgZW50cnkucmVtb3ZlZCA9IHRydWU7CiAgICAgICAgICAgICAgaWYgKGVudHJ5LnByZXZpb3VzKQogICAgICAgICAgICAgIGVudHJ5LnByZXZpb3VzID0gZW50cnkucHJldmlvdXMubmV4dCA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgICBkZWxldGUgZGF0YVtlbnRyeS5pbmRleF07CiAgICAgICAgICAgICAgZW50cnkgPSBlbnRyeS5uZXh0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXRlLmZpcnN0ID0gc3RhdGUubGFzdCA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgaWYgKERFU0NSSVBUT1JTKQogICAgICAgICAgICBzdGF0ZS5zaXplID0gMDtlbHNlCgogICAgICAgICAgICB0aGF0LnNpemUgPSAwOwogICAgICAgICAgfSwKICAgICAgICAgICdkZWxldGUnOiBmdW5jdGlvbiBfZGVsZXRlKGtleSkgewogICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IGdldEludGVybmFsU3RhdGUodGhhdCk7CiAgICAgICAgICAgIHZhciBlbnRyeSA9IGdldEVudHJ5KHRoYXQsIGtleSk7CiAgICAgICAgICAgIGlmIChlbnRyeSkgewogICAgICAgICAgICAgIHZhciBuZXh0ID0gZW50cnkubmV4dDsKICAgICAgICAgICAgICB2YXIgcHJldiA9IGVudHJ5LnByZXZpb3VzOwogICAgICAgICAgICAgIGRlbGV0ZSBzdGF0ZS5pbmRleFtlbnRyeS5pbmRleF07CiAgICAgICAgICAgICAgZW50cnkucmVtb3ZlZCA9IHRydWU7CiAgICAgICAgICAgICAgaWYgKHByZXYpCiAgICAgICAgICAgICAgcHJldi5uZXh0ID0gbmV4dDsKICAgICAgICAgICAgICBpZiAobmV4dCkKICAgICAgICAgICAgICBuZXh0LnByZXZpb3VzID0gcHJldjsKICAgICAgICAgICAgICBpZiAoc3RhdGUuZmlyc3QgPT0gZW50cnkpCiAgICAgICAgICAgICAgc3RhdGUuZmlyc3QgPSBuZXh0OwogICAgICAgICAgICAgIGlmIChzdGF0ZS5sYXN0ID09IGVudHJ5KQogICAgICAgICAgICAgIHN0YXRlLmxhc3QgPSBwcmV2OwogICAgICAgICAgICAgIGlmIChERVNDUklQVE9SUykKICAgICAgICAgICAgICBzdGF0ZS5zaXplLS07ZWxzZQoKICAgICAgICAgICAgICB0aGF0LnNpemUtLTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gISFlbnRyeTsKICAgICAgICAgIH0sCiAgICAgICAgICBmb3JFYWNoOiBmdW5jdGlvbiBmb3JFYWNoKGNhbGxiYWNrZm4pIHsKICAgICAgICAgICAgdmFyIHN0YXRlID0gZ2V0SW50ZXJuYWxTdGF0ZSh0aGlzKTsKICAgICAgICAgICAgdmFyIGJvdW5kRnVuY3Rpb24gPSBiaW5kKGNhbGxiYWNrZm4sIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkLCAzKTsKICAgICAgICAgICAgdmFyIGVudHJ5OwogICAgICAgICAgICB3aGlsZSAoZW50cnkgPSBlbnRyeSA/IGVudHJ5Lm5leHQgOiBzdGF0ZS5maXJzdCkgewogICAgICAgICAgICAgIGJvdW5kRnVuY3Rpb24oZW50cnkudmFsdWUsIGVudHJ5LmtleSwgdGhpcyk7CiAgICAgICAgICAgICAgd2hpbGUgKGVudHJ5ICYmIGVudHJ5LnJlbW92ZWQpCiAgICAgICAgICAgICAgZW50cnkgPSBlbnRyeS5wcmV2aW91czsKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgIGhhczogZnVuY3Rpb24gaGFzKGtleSkgewogICAgICAgICAgICByZXR1cm4gISFnZXRFbnRyeSh0aGlzLCBrZXkpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHJlZGVmaW5lQWxsKEMucHJvdG90eXBlLCBJU19NQVAgPyB7CiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldChrZXkpIHsKICAgICAgICAgICAgdmFyIGVudHJ5ID0gZ2V0RW50cnkodGhpcywga2V5KTsKICAgICAgICAgICAgcmV0dXJuIGVudHJ5ICYmIGVudHJ5LnZhbHVlOwogICAgICAgICAgfSwKICAgICAgICAgIHNldDogZnVuY3Rpb24gc2V0KGtleSwgdmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuIGRlZmluZSh0aGlzLCBrZXkgPT09IDAgPyAwIDoga2V5LCB2YWx1ZSk7CiAgICAgICAgICB9CiAgICAgICAgfSA6IHsKICAgICAgICAgIGFkZDogZnVuY3Rpb24gYWRkKHZhbHVlKSB7CiAgICAgICAgICAgIHJldHVybiBkZWZpbmUodGhpcywgdmFsdWUgPSB2YWx1ZSA9PT0gMCA/IDAgOiB2YWx1ZSwgdmFsdWUpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGlmIChERVNDUklQVE9SUykKICAgICAgICBkZWZpbmVQcm9wZXJ0eShDLnByb3RvdHlwZSwgJ3NpemUnLCB7CiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIGdldEludGVybmFsU3RhdGUodGhpcykuc2l6ZTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gQzsKICAgICAgfSwKICAgICAgc2V0U3Ryb25nOiBmdW5jdGlvbiBzZXRTdHJvbmcoQywgQ09OU1RSVUNUT1JfTkFNRSwgSVNfTUFQKSB7CiAgICAgICAgdmFyIElURVJBVE9SX05BTUUgPSBDT05TVFJVQ1RPUl9OQU1FICsgJyBJdGVyYXRvcic7CiAgICAgICAgdmFyIGdldEludGVybmFsQ29sbGVjdGlvblN0YXRlID0gaW50ZXJuYWxTdGF0ZUdldHRlckZvcihDT05TVFJVQ1RPUl9OQU1FKTsKICAgICAgICB2YXIgZ2V0SW50ZXJuYWxJdGVyYXRvclN0YXRlID0gaW50ZXJuYWxTdGF0ZUdldHRlckZvcihJVEVSQVRPUl9OQU1FKTsKICAgICAgICBkZWZpbmVJdGVyYXRvcihDLCBDT05TVFJVQ1RPUl9OQU1FLCBmdW5jdGlvbiAoaXRlcmF0ZWQsIGtpbmQpIHsKICAgICAgICAgIHNldEludGVybmFsU3RhdGUodGhpcywgewogICAgICAgICAgICB0eXBlOiBJVEVSQVRPUl9OQU1FLAogICAgICAgICAgICB0YXJnZXQ6IGl0ZXJhdGVkLAogICAgICAgICAgICBzdGF0ZTogZ2V0SW50ZXJuYWxDb2xsZWN0aW9uU3RhdGUoaXRlcmF0ZWQpLAogICAgICAgICAgICBraW5kOiBraW5kLAogICAgICAgICAgICBsYXN0OiB1bmRlZmluZWQKICAgICAgICAgIH0pOwogICAgICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBzdGF0ZSA9IGdldEludGVybmFsSXRlcmF0b3JTdGF0ZSh0aGlzKTsKICAgICAgICAgIHZhciBraW5kID0gc3RhdGUua2luZDsKICAgICAgICAgIHZhciBlbnRyeSA9IHN0YXRlLmxhc3Q7CiAgICAgICAgICB3aGlsZSAoZW50cnkgJiYgZW50cnkucmVtb3ZlZCkKICAgICAgICAgIGVudHJ5ID0gZW50cnkucHJldmlvdXM7CiAgICAgICAgICBpZiAoIXN0YXRlLnRhcmdldCB8fCAhKHN0YXRlLmxhc3QgPSBlbnRyeSA9IGVudHJ5ID8gZW50cnkubmV4dCA6IHN0YXRlLnN0YXRlLmZpcnN0KSkgewogICAgICAgICAgICBzdGF0ZS50YXJnZXQgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgdmFsdWU6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICBkb25lOiB0cnVlCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoa2luZCA9PSAna2V5cycpCiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICB2YWx1ZTogZW50cnkua2V5LAogICAgICAgICAgICBkb25lOiBmYWxzZQogICAgICAgICAgfTsKICAgICAgICAgIGlmIChraW5kID09ICd2YWx1ZXMnKQogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdmFsdWU6IGVudHJ5LnZhbHVlLAogICAgICAgICAgICBkb25lOiBmYWxzZQogICAgICAgICAgfTsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHZhbHVlOiBbCiAgICAgICAgICAgIGVudHJ5LmtleSwKICAgICAgICAgICAgZW50cnkudmFsdWVdLAoKICAgICAgICAgICAgZG9uZTogZmFsc2UKICAgICAgICAgIH07CiAgICAgICAgfSwgSVNfTUFQID8gJ2VudHJpZXMnIDogJ3ZhbHVlcycsICFJU19NQVAsIHRydWUpOwogICAgICAgIHNldFNwZWNpZXMoQ09OU1RSVUNUT1JfTkFNRSk7CiAgICAgIH0KICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDE0NyAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIF9fd19wZGZqc19yZXF1aXJlX18oMTQ4KTsKICAgIF9fd19wZGZqc19yZXF1aXJlX18oMTA5KTsKICAgIF9fd19wZGZqc19yZXF1aXJlX18oNzcpOwogICAgX193X3BkZmpzX3JlcXVpcmVfXygxMTEpOwogICAgdmFyIHBhdGggPSBfX3dfcGRmanNfcmVxdWlyZV9fKDQyKTsKICAgIG1vZHVsZS5leHBvcnRzID0gcGF0aC5TZXQ7CgogICAgLyoqKi99KSwgKAogIC8qIDE0OCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgY29sbGVjdGlvbiA9IF9fd19wZGZqc19yZXF1aXJlX18oMTQyKTsKICAgIHZhciBjb2xsZWN0aW9uU3Ryb25nID0gX193X3BkZmpzX3JlcXVpcmVfXygxNDYpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBjb2xsZWN0aW9uKCdTZXQnLCBmdW5jdGlvbiAoaW5pdCkgewogICAgICByZXR1cm4gZnVuY3Rpb24gU2V0KCkgewogICAgICAgIHJldHVybiBpbml0KHRoaXMsIGFyZ3VtZW50cy5sZW5ndGggPyBhcmd1bWVudHNbMF0gOiB1bmRlZmluZWQpOwogICAgICB9OwogICAgfSwgY29sbGVjdGlvblN0cm9uZyk7CgogICAgLyoqKi99KSwgKAogIC8qIDE0OSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIF9fd19wZGZqc19yZXF1aXJlX18oMTA5KTsKICAgIF9fd19wZGZqc19yZXF1aXJlX18oMTUwKTsKICAgIF9fd19wZGZqc19yZXF1aXJlX18oMTExKTsKICAgIHZhciBwYXRoID0gX193X3BkZmpzX3JlcXVpcmVfXyg0Mik7CiAgICBtb2R1bGUuZXhwb3J0cyA9IHBhdGguV2Vha01hcDsKCiAgICAvKioqL30pLCAoCiAgLyogMTUwICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBnbG9iYWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEwKTsKICAgIHZhciByZWRlZmluZUFsbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTE2KTsKICAgIHZhciBJbnRlcm5hbE1ldGFkYXRhTW9kdWxlID0gX193X3BkZmpzX3JlcXVpcmVfXygxNDMpOwogICAgdmFyIGNvbGxlY3Rpb24gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE0Mik7CiAgICB2YXIgY29sbGVjdGlvbldlYWsgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE1MSk7CiAgICB2YXIgaXNPYmplY3QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIxKTsKICAgIHZhciBlbmZvcmNlSXRlcm5hbFN0YXRlID0gX193X3BkZmpzX3JlcXVpcmVfXygzMikuZW5mb3JjZTsKICAgIHZhciBOQVRJVkVfV0VBS19NQVAgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDMzKTsKICAgIHZhciBJU19JRTExID0gIWdsb2JhbC5BY3RpdmVYT2JqZWN0ICYmICdBY3RpdmVYT2JqZWN0JyBpbiBnbG9iYWw7CiAgICB2YXIgaXNFeHRlbnNpYmxlID0gT2JqZWN0LmlzRXh0ZW5zaWJsZTsKICAgIHZhciBJbnRlcm5hbFdlYWtNYXA7CiAgICB2YXIgd3JhcHBlciA9IGZ1bmN0aW9uIHdyYXBwZXIoaW5pdCkgewogICAgICByZXR1cm4gZnVuY3Rpb24gV2Vha01hcCgpIHsKICAgICAgICByZXR1cm4gaW5pdCh0aGlzLCBhcmd1bWVudHMubGVuZ3RoID8gYXJndW1lbnRzWzBdIDogdW5kZWZpbmVkKTsKICAgICAgfTsKICAgIH07CiAgICB2YXIgJFdlYWtNYXAgPSBtb2R1bGUuZXhwb3J0cyA9IGNvbGxlY3Rpb24oJ1dlYWtNYXAnLCB3cmFwcGVyLCBjb2xsZWN0aW9uV2Vhayk7CiAgICBpZiAoTkFUSVZFX1dFQUtfTUFQICYmIElTX0lFMTEpIHsKICAgICAgSW50ZXJuYWxXZWFrTWFwID0gY29sbGVjdGlvbldlYWsuZ2V0Q29uc3RydWN0b3Iod3JhcHBlciwgJ1dlYWtNYXAnLCB0cnVlKTsKICAgICAgSW50ZXJuYWxNZXRhZGF0YU1vZHVsZS5SRVFVSVJFRCA9IHRydWU7CiAgICAgIHZhciBXZWFrTWFwUHJvdG90eXBlID0gJFdlYWtNYXAucHJvdG90eXBlOwogICAgICB2YXIgbmF0aXZlRGVsZXRlID0gV2Vha01hcFByb3RvdHlwZVsnZGVsZXRlJ107CiAgICAgIHZhciBuYXRpdmVIYXMgPSBXZWFrTWFwUHJvdG90eXBlLmhhczsKICAgICAgdmFyIG5hdGl2ZUdldCA9IFdlYWtNYXBQcm90b3R5cGUuZ2V0OwogICAgICB2YXIgbmF0aXZlU2V0ID0gV2Vha01hcFByb3RvdHlwZS5zZXQ7CiAgICAgIHJlZGVmaW5lQWxsKFdlYWtNYXBQcm90b3R5cGUsIHsKICAgICAgICAnZGVsZXRlJzogZnVuY3Rpb24gX2RlbGV0ZShrZXkpIHsKICAgICAgICAgIGlmIChpc09iamVjdChrZXkpICYmICFpc0V4dGVuc2libGUoa2V5KSkgewogICAgICAgICAgICB2YXIgc3RhdGUgPSBlbmZvcmNlSXRlcm5hbFN0YXRlKHRoaXMpOwogICAgICAgICAgICBpZiAoIXN0YXRlLmZyb3plbikKICAgICAgICAgICAgc3RhdGUuZnJvemVuID0gbmV3IEludGVybmFsV2Vha01hcCgpOwogICAgICAgICAgICByZXR1cm4gbmF0aXZlRGVsZXRlLmNhbGwodGhpcywga2V5KSB8fCBzdGF0ZS5mcm96ZW5bJ2RlbGV0ZSddKGtleSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbmF0aXZlRGVsZXRlLmNhbGwodGhpcywga2V5KTsKICAgICAgICB9LAogICAgICAgIGhhczogZnVuY3Rpb24gaGFzKGtleSkgewogICAgICAgICAgaWYgKGlzT2JqZWN0KGtleSkgJiYgIWlzRXh0ZW5zaWJsZShrZXkpKSB7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IGVuZm9yY2VJdGVybmFsU3RhdGUodGhpcyk7CiAgICAgICAgICAgIGlmICghc3RhdGUuZnJvemVuKQogICAgICAgICAgICBzdGF0ZS5mcm96ZW4gPSBuZXcgSW50ZXJuYWxXZWFrTWFwKCk7CiAgICAgICAgICAgIHJldHVybiBuYXRpdmVIYXMuY2FsbCh0aGlzLCBrZXkpIHx8IHN0YXRlLmZyb3plbi5oYXMoa2V5KTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBuYXRpdmVIYXMuY2FsbCh0aGlzLCBrZXkpOwogICAgICAgIH0sCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoa2V5KSB7CiAgICAgICAgICBpZiAoaXNPYmplY3Qoa2V5KSAmJiAhaXNFeHRlbnNpYmxlKGtleSkpIHsKICAgICAgICAgICAgdmFyIHN0YXRlID0gZW5mb3JjZUl0ZXJuYWxTdGF0ZSh0aGlzKTsKICAgICAgICAgICAgaWYgKCFzdGF0ZS5mcm96ZW4pCiAgICAgICAgICAgIHN0YXRlLmZyb3plbiA9IG5ldyBJbnRlcm5hbFdlYWtNYXAoKTsKICAgICAgICAgICAgcmV0dXJuIG5hdGl2ZUhhcy5jYWxsKHRoaXMsIGtleSkgPyBuYXRpdmVHZXQuY2FsbCh0aGlzLCBrZXkpIDogc3RhdGUuZnJvemVuLmdldChrZXkpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG5hdGl2ZUdldC5jYWxsKHRoaXMsIGtleSk7CiAgICAgICAgfSwKICAgICAgICBzZXQ6IGZ1bmN0aW9uIHNldChrZXksIHZhbHVlKSB7CiAgICAgICAgICBpZiAoaXNPYmplY3Qoa2V5KSAmJiAhaXNFeHRlbnNpYmxlKGtleSkpIHsKICAgICAgICAgICAgdmFyIHN0YXRlID0gZW5mb3JjZUl0ZXJuYWxTdGF0ZSh0aGlzKTsKICAgICAgICAgICAgaWYgKCFzdGF0ZS5mcm96ZW4pCiAgICAgICAgICAgIHN0YXRlLmZyb3plbiA9IG5ldyBJbnRlcm5hbFdlYWtNYXAoKTsKICAgICAgICAgICAgbmF0aXZlSGFzLmNhbGwodGhpcywga2V5KSA/IG5hdGl2ZVNldC5jYWxsKHRoaXMsIGtleSwgdmFsdWUpIDogc3RhdGUuZnJvemVuLnNldChrZXksIHZhbHVlKTsKICAgICAgICAgIH0gZWxzZQogICAgICAgICAgbmF0aXZlU2V0LmNhbGwodGhpcywga2V5LCB2YWx1ZSk7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKICAgIC8qKiovfSksICgKICAvKiAxNTEgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIHJlZGVmaW5lQWxsID0gX193X3BkZmpzX3JlcXVpcmVfXygxMTYpOwogICAgdmFyIGdldFdlYWtEYXRhID0gX193X3BkZmpzX3JlcXVpcmVfXygxNDMpLmdldFdlYWtEYXRhOwogICAgdmFyIGFuT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygyNyk7CiAgICB2YXIgaXNPYmplY3QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIxKTsKICAgIHZhciBhbkluc3RhbmNlID0gX193X3BkZmpzX3JlcXVpcmVfXygxMTgpOwogICAgdmFyIGl0ZXJhdGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDExOSk7CiAgICB2YXIgQXJyYXlJdGVyYXRpb25Nb2R1bGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE1Mik7CiAgICB2YXIgJGhhcyA9IF9fd19wZGZqc19yZXF1aXJlX18oMjIpOwogICAgdmFyIEludGVybmFsU3RhdGVNb2R1bGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDMyKTsKICAgIHZhciBzZXRJbnRlcm5hbFN0YXRlID0gSW50ZXJuYWxTdGF0ZU1vZHVsZS5zZXQ7CiAgICB2YXIgaW50ZXJuYWxTdGF0ZUdldHRlckZvciA9IEludGVybmFsU3RhdGVNb2R1bGUuZ2V0dGVyRm9yOwogICAgdmFyIGZpbmQgPSBBcnJheUl0ZXJhdGlvbk1vZHVsZS5maW5kOwogICAgdmFyIGZpbmRJbmRleCA9IEFycmF5SXRlcmF0aW9uTW9kdWxlLmZpbmRJbmRleDsKICAgIHZhciBpZCA9IDA7CiAgICB2YXIgdW5jYXVnaHRGcm96ZW5TdG9yZSA9IGZ1bmN0aW9uIHVuY2F1Z2h0RnJvemVuU3RvcmUoc3RvcmUpIHsKICAgICAgcmV0dXJuIHN0b3JlLmZyb3plbiB8fCAoc3RvcmUuZnJvemVuID0gbmV3IFVuY2F1Z2h0RnJvemVuU3RvcmUoKSk7CiAgICB9OwogICAgdmFyIFVuY2F1Z2h0RnJvemVuU3RvcmUgPSBmdW5jdGlvbiBVbmNhdWdodEZyb3plblN0b3JlKCkgewogICAgICB0aGlzLmVudHJpZXMgPSBbXTsKICAgIH07CiAgICB2YXIgZmluZFVuY2F1Z2h0RnJvemVuID0gZnVuY3Rpb24gZmluZFVuY2F1Z2h0RnJvemVuKHN0b3JlLCBrZXkpIHsKICAgICAgcmV0dXJuIGZpbmQoc3RvcmUuZW50cmllcywgZnVuY3Rpb24gKGl0KSB7CiAgICAgICAgcmV0dXJuIGl0WzBdID09PSBrZXk7CiAgICAgIH0pOwogICAgfTsKICAgIFVuY2F1Z2h0RnJvemVuU3RvcmUucHJvdG90eXBlID0gewogICAgICBnZXQ6IGZ1bmN0aW9uIGdldChrZXkpIHsKICAgICAgICB2YXIgZW50cnkgPSBmaW5kVW5jYXVnaHRGcm96ZW4odGhpcywga2V5KTsKICAgICAgICBpZiAoZW50cnkpCiAgICAgICAgcmV0dXJuIGVudHJ5WzFdOwogICAgICB9LAogICAgICBoYXM6IGZ1bmN0aW9uIGhhcyhrZXkpIHsKICAgICAgICByZXR1cm4gISFmaW5kVW5jYXVnaHRGcm96ZW4odGhpcywga2V5KTsKICAgICAgfSwKICAgICAgc2V0OiBmdW5jdGlvbiBzZXQoa2V5LCB2YWx1ZSkgewogICAgICAgIHZhciBlbnRyeSA9IGZpbmRVbmNhdWdodEZyb3plbih0aGlzLCBrZXkpOwogICAgICAgIGlmIChlbnRyeSkKICAgICAgICBlbnRyeVsxXSA9IHZhbHVlO2Vsc2UKCiAgICAgICAgdGhpcy5lbnRyaWVzLnB1c2goWwogICAgICAgIGtleSwKICAgICAgICB2YWx1ZV0KICAgICAgICApOwogICAgICB9LAogICAgICAnZGVsZXRlJzogZnVuY3Rpb24gX2RlbGV0ZShrZXkpIHsKICAgICAgICB2YXIgaW5kZXggPSBmaW5kSW5kZXgodGhpcy5lbnRyaWVzLCBmdW5jdGlvbiAoaXQpIHsKICAgICAgICAgIHJldHVybiBpdFswXSA9PT0ga2V5OwogICAgICAgIH0pOwogICAgICAgIGlmICh+aW5kZXgpCiAgICAgICAgdGhpcy5lbnRyaWVzLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgcmV0dXJuICEhfmluZGV4OwogICAgICB9CiAgICB9OwogICAgbW9kdWxlLmV4cG9ydHMgPSB7CiAgICAgIGdldENvbnN0cnVjdG9yOiBmdW5jdGlvbiBnZXRDb25zdHJ1Y3Rvcih3cmFwcGVyLCBDT05TVFJVQ1RPUl9OQU1FLCBJU19NQVAsIEFEREVSKSB7CiAgICAgICAgdmFyIEMgPSB3cmFwcGVyKGZ1bmN0aW9uICh0aGF0LCBpdGVyYWJsZSkgewogICAgICAgICAgYW5JbnN0YW5jZSh0aGF0LCBDLCBDT05TVFJVQ1RPUl9OQU1FKTsKICAgICAgICAgIHNldEludGVybmFsU3RhdGUodGhhdCwgewogICAgICAgICAgICB0eXBlOiBDT05TVFJVQ1RPUl9OQU1FLAogICAgICAgICAgICBpZDogaWQrKywKICAgICAgICAgICAgZnJvemVuOiB1bmRlZmluZWQKICAgICAgICAgIH0pOwogICAgICAgICAgaWYgKGl0ZXJhYmxlICE9IHVuZGVmaW5lZCkKICAgICAgICAgIGl0ZXJhdGUoaXRlcmFibGUsIHRoYXRbQURERVJdLCB0aGF0LCBJU19NQVApOwogICAgICAgIH0pOwogICAgICAgIHZhciBnZXRJbnRlcm5hbFN0YXRlID0gaW50ZXJuYWxTdGF0ZUdldHRlckZvcihDT05TVFJVQ1RPUl9OQU1FKTsKICAgICAgICB2YXIgZGVmaW5lID0gZnVuY3Rpb24gZGVmaW5lKHRoYXQsIGtleSwgdmFsdWUpIHsKICAgICAgICAgIHZhciBzdGF0ZSA9IGdldEludGVybmFsU3RhdGUodGhhdCk7CiAgICAgICAgICB2YXIgZGF0YSA9IGdldFdlYWtEYXRhKGFuT2JqZWN0KGtleSksIHRydWUpOwogICAgICAgICAgaWYgKGRhdGEgPT09IHRydWUpCiAgICAgICAgICB1bmNhdWdodEZyb3plblN0b3JlKHN0YXRlKS5zZXQoa2V5LCB2YWx1ZSk7ZWxzZQoKICAgICAgICAgIGRhdGFbc3RhdGUuaWRdID0gdmFsdWU7CiAgICAgICAgICByZXR1cm4gdGhhdDsKICAgICAgICB9OwogICAgICAgIHJlZGVmaW5lQWxsKEMucHJvdG90eXBlLCB7CiAgICAgICAgICAnZGVsZXRlJzogZnVuY3Rpb24gX2RlbGV0ZShrZXkpIHsKICAgICAgICAgICAgdmFyIHN0YXRlID0gZ2V0SW50ZXJuYWxTdGF0ZSh0aGlzKTsKICAgICAgICAgICAgaWYgKCFpc09iamVjdChrZXkpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHZhciBkYXRhID0gZ2V0V2Vha0RhdGEoa2V5KTsKICAgICAgICAgICAgaWYgKGRhdGEgPT09IHRydWUpCiAgICAgICAgICAgIHJldHVybiB1bmNhdWdodEZyb3plblN0b3JlKHN0YXRlKVsnZGVsZXRlJ10oa2V5KTsKICAgICAgICAgICAgcmV0dXJuIGRhdGEgJiYgJGhhcyhkYXRhLCBzdGF0ZS5pZCkgJiYgZGVsZXRlIGRhdGFbc3RhdGUuaWRdOwogICAgICAgICAgfSwKICAgICAgICAgIGhhczogZnVuY3Rpb24gaGFzKGtleSkgewogICAgICAgICAgICB2YXIgc3RhdGUgPSBnZXRJbnRlcm5hbFN0YXRlKHRoaXMpOwogICAgICAgICAgICBpZiAoIWlzT2JqZWN0KGtleSkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgdmFyIGRhdGEgPSBnZXRXZWFrRGF0YShrZXkpOwogICAgICAgICAgICBpZiAoZGF0YSA9PT0gdHJ1ZSkKICAgICAgICAgICAgcmV0dXJuIHVuY2F1Z2h0RnJvemVuU3RvcmUoc3RhdGUpLmhhcyhrZXkpOwogICAgICAgICAgICByZXR1cm4gZGF0YSAmJiAkaGFzKGRhdGEsIHN0YXRlLmlkKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZWRlZmluZUFsbChDLnByb3RvdHlwZSwgSVNfTUFQID8gewogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoa2V5KSB7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IGdldEludGVybmFsU3RhdGUodGhpcyk7CiAgICAgICAgICAgIGlmIChpc09iamVjdChrZXkpKSB7CiAgICAgICAgICAgICAgdmFyIGRhdGEgPSBnZXRXZWFrRGF0YShrZXkpOwogICAgICAgICAgICAgIGlmIChkYXRhID09PSB0cnVlKQogICAgICAgICAgICAgIHJldHVybiB1bmNhdWdodEZyb3plblN0b3JlKHN0YXRlKS5nZXQoa2V5KTsKICAgICAgICAgICAgICByZXR1cm4gZGF0YSA/IGRhdGFbc3RhdGUuaWRdIDogdW5kZWZpbmVkOwogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgc2V0OiBmdW5jdGlvbiBzZXQoa2V5LCB2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gZGVmaW5lKHRoaXMsIGtleSwgdmFsdWUpOwogICAgICAgICAgfQogICAgICAgIH0gOiB7CiAgICAgICAgICBhZGQ6IGZ1bmN0aW9uIGFkZCh2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gZGVmaW5lKHRoaXMsIHZhbHVlLCB0cnVlKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gQzsKICAgICAgfQogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogMTUyICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGJpbmQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDYyKTsKICAgIHZhciBJbmRleGVkT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygxNyk7CiAgICB2YXIgdG9PYmplY3QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDgzKTsKICAgIHZhciB0b0xlbmd0aCA9IF9fd19wZGZqc19yZXF1aXJlX18oNDYpOwogICAgdmFyIGFycmF5U3BlY2llc0NyZWF0ZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTUzKTsKICAgIHZhciBwdXNoID0gW10ucHVzaDsKICAgIHZhciBjcmVhdGVNZXRob2QgPSBmdW5jdGlvbiBjcmVhdGVNZXRob2QoVFlQRSkgewogICAgICB2YXIgSVNfTUFQID0gVFlQRSA9PSAxOwogICAgICB2YXIgSVNfRklMVEVSID0gVFlQRSA9PSAyOwogICAgICB2YXIgSVNfU09NRSA9IFRZUEUgPT0gMzsKICAgICAgdmFyIElTX0VWRVJZID0gVFlQRSA9PSA0OwogICAgICB2YXIgSVNfRklORF9JTkRFWCA9IFRZUEUgPT0gNjsKICAgICAgdmFyIE5PX0hPTEVTID0gVFlQRSA9PSA1IHx8IElTX0ZJTkRfSU5ERVg7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoJHRoaXMsIGNhbGxiYWNrZm4sIHRoYXQsIHNwZWNpZmljQ3JlYXRlKSB7CiAgICAgICAgdmFyIE8gPSB0b09iamVjdCgkdGhpcyk7CiAgICAgICAgdmFyIHNlbGYgPSBJbmRleGVkT2JqZWN0KE8pOwogICAgICAgIHZhciBib3VuZEZ1bmN0aW9uID0gYmluZChjYWxsYmFja2ZuLCB0aGF0LCAzKTsKICAgICAgICB2YXIgbGVuZ3RoID0gdG9MZW5ndGgoc2VsZi5sZW5ndGgpOwogICAgICAgIHZhciBpbmRleCA9IDA7CiAgICAgICAgdmFyIGNyZWF0ZSA9IHNwZWNpZmljQ3JlYXRlIHx8IGFycmF5U3BlY2llc0NyZWF0ZTsKICAgICAgICB2YXIgdGFyZ2V0ID0gSVNfTUFQID8gY3JlYXRlKCR0aGlzLCBsZW5ndGgpIDogSVNfRklMVEVSID8gY3JlYXRlKCR0aGlzLCAwKSA6IHVuZGVmaW5lZDsKICAgICAgICB2YXIgdmFsdWUsIHJlc3VsdDsKICAgICAgICBmb3IgKDsgbGVuZ3RoID4gaW5kZXg7IGluZGV4KyspCiAgICAgICAgaWYgKE5PX0hPTEVTIHx8IGluZGV4IGluIHNlbGYpIHsKICAgICAgICAgIHZhbHVlID0gc2VsZltpbmRleF07CiAgICAgICAgICByZXN1bHQgPSBib3VuZEZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgTyk7CiAgICAgICAgICBpZiAoVFlQRSkgewogICAgICAgICAgICBpZiAoSVNfTUFQKQogICAgICAgICAgICB0YXJnZXRbaW5kZXhdID0gcmVzdWx0O2Vsc2UKICAgICAgICAgICAgaWYgKHJlc3VsdCkKICAgICAgICAgICAgc3dpdGNoIChUWVBFKSB7CiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgIHJldHVybiBpbmRleDsKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBwdXNoLmNhbGwodGFyZ2V0LCB2YWx1ZSk7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICBpZiAoSVNfRVZFUlkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIElTX0ZJTkRfSU5ERVggPyAtMSA6IElTX1NPTUUgfHwgSVNfRVZFUlkgPyBJU19FVkVSWSA6IHRhcmdldDsKICAgICAgfTsKICAgIH07CiAgICBtb2R1bGUuZXhwb3J0cyA9IHsKICAgICAgZm9yRWFjaDogY3JlYXRlTWV0aG9kKDApLAogICAgICBtYXA6IGNyZWF0ZU1ldGhvZCgxKSwKICAgICAgZmlsdGVyOiBjcmVhdGVNZXRob2QoMiksCiAgICAgIHNvbWU6IGNyZWF0ZU1ldGhvZCgzKSwKICAgICAgZXZlcnk6IGNyZWF0ZU1ldGhvZCg0KSwKICAgICAgZmluZDogY3JlYXRlTWV0aG9kKDUpLAogICAgICBmaW5kSW5kZXg6IGNyZWF0ZU1ldGhvZCg2KQogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogMTUzICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGlzT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygyMSk7CiAgICB2YXIgaXNBcnJheSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTU0KTsKICAgIHZhciB3ZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDU3KTsKICAgIHZhciBTUEVDSUVTID0gd2VsbEtub3duU3ltYm9sKCdzcGVjaWVzJyk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChvcmlnaW5hbEFycmF5LCBsZW5ndGgpIHsKICAgICAgdmFyIEM7CiAgICAgIGlmIChpc0FycmF5KG9yaWdpbmFsQXJyYXkpKSB7CiAgICAgICAgQyA9IG9yaWdpbmFsQXJyYXkuY29uc3RydWN0b3I7CiAgICAgICAgaWYgKHR5cGVvZiBDID09ICdmdW5jdGlvbicgJiYgKEMgPT09IEFycmF5IHx8IGlzQXJyYXkoQy5wcm90b3R5cGUpKSkKICAgICAgICBDID0gdW5kZWZpbmVkO2Vsc2UKICAgICAgICBpZiAoaXNPYmplY3QoQykpIHsKICAgICAgICAgIEMgPSBDW1NQRUNJRVNdOwogICAgICAgICAgaWYgKEMgPT09IG51bGwpCiAgICAgICAgICBDID0gdW5kZWZpbmVkOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gbmV3IChDID09PSB1bmRlZmluZWQgPyBBcnJheSA6IEMpKGxlbmd0aCA9PT0gMCA/IDAgOiBsZW5ndGgpOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogMTU0ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGNsYXNzb2YgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE4KTsKICAgIG1vZHVsZS5leHBvcnRzID0gQXJyYXkuaXNBcnJheSB8fCBmdW5jdGlvbiBpc0FycmF5KGFyZykgewogICAgICByZXR1cm4gY2xhc3NvZihhcmcpID09ICdBcnJheSc7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAxNTUgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDEwOSk7CiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDE1Nik7CiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDExMSk7CiAgICB2YXIgcGF0aCA9IF9fd19wZGZqc19yZXF1aXJlX18oNDIpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBwYXRoLldlYWtTZXQ7CgogICAgLyoqKi99KSwgKAogIC8qIDE1NiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgY29sbGVjdGlvbiA9IF9fd19wZGZqc19yZXF1aXJlX18oMTQyKTsKICAgIHZhciBjb2xsZWN0aW9uV2VhayA9IF9fd19wZGZqc19yZXF1aXJlX18oMTUxKTsKICAgIGNvbGxlY3Rpb24oJ1dlYWtTZXQnLCBmdW5jdGlvbiAoaW5pdCkgewogICAgICByZXR1cm4gZnVuY3Rpb24gV2Vha1NldCgpIHsKICAgICAgICByZXR1cm4gaW5pdCh0aGlzLCBhcmd1bWVudHMubGVuZ3RoID8gYXJndW1lbnRzWzBdIDogdW5kZWZpbmVkKTsKICAgICAgfTsKICAgIH0sIGNvbGxlY3Rpb25XZWFrKTsKCiAgICAvKioqL30pLCAoCiAgLyogMTU3ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgX193X3BkZmpzX3JlcXVpcmVfXygxNTgpOwogICAgdmFyIGVudHJ5VW5iaW5kID0gX193X3BkZmpzX3JlcXVpcmVfXyg2MSk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGVudHJ5VW5iaW5kKCdTdHJpbmcnLCAnY29kZVBvaW50QXQnKTsKCiAgICAvKioqL30pLCAoCiAgLyogMTU4ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciAkID0gX193X3BkZmpzX3JlcXVpcmVfXyg5KTsKICAgIHZhciBjb2RlQXQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDc4KS5jb2RlQXQ7CiAgICAkKHsKICAgICAgdGFyZ2V0OiAnU3RyaW5nJywKICAgICAgcHJvdG86IHRydWUKICAgIH0sIHsKICAgICAgY29kZVBvaW50QXQ6IGZ1bmN0aW9uIGNvZGVQb2ludEF0KHBvcykgewogICAgICAgIHJldHVybiBjb2RlQXQodGhpcywgcG9zKTsKICAgICAgfQogICAgfSk7CgogICAgLyoqKi99KSwgKAogIC8qIDE1OSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIF9fd19wZGZqc19yZXF1aXJlX18oMTYwKTsKICAgIHZhciBwYXRoID0gX193X3BkZmpzX3JlcXVpcmVfXyg0Mik7CiAgICBtb2R1bGUuZXhwb3J0cyA9IHBhdGguU3RyaW5nLmZyb21Db2RlUG9pbnQ7CgogICAgLyoqKi99KSwgKAogIC8qIDE2MCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciAkID0gX193X3BkZmpzX3JlcXVpcmVfXyg5KTsKICAgIHZhciB0b0Fic29sdXRlSW5kZXggPSBfX3dfcGRmanNfcmVxdWlyZV9fKDQ4KTsKICAgIHZhciBmcm9tQ2hhckNvZGUgPSBTdHJpbmcuZnJvbUNoYXJDb2RlOwogICAgdmFyIG5hdGl2ZUZyb21Db2RlUG9pbnQgPSBTdHJpbmcuZnJvbUNvZGVQb2ludDsKICAgIHZhciBJTkNPUlJFQ1RfTEVOR1RIID0gISFuYXRpdmVGcm9tQ29kZVBvaW50ICYmIG5hdGl2ZUZyb21Db2RlUG9pbnQubGVuZ3RoICE9IDE7CiAgICAkKHsKICAgICAgdGFyZ2V0OiAnU3RyaW5nJywKICAgICAgc3RhdDogdHJ1ZSwKICAgICAgZm9yY2VkOiBJTkNPUlJFQ1RfTEVOR1RICiAgICB9LCB7CiAgICAgIGZyb21Db2RlUG9pbnQ6IGZ1bmN0aW9uIGZyb21Db2RlUG9pbnQoeCkgewogICAgICAgIHZhciBlbGVtZW50cyA9IFtdOwogICAgICAgIHZhciBsZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoOwogICAgICAgIHZhciBpID0gMDsKICAgICAgICB2YXIgY29kZTsKICAgICAgICB3aGlsZSAobGVuZ3RoID4gaSkgewogICAgICAgICAgY29kZSA9ICthcmd1bWVudHNbaSsrXTsKICAgICAgICAgIGlmICh0b0Fic29sdXRlSW5kZXgoY29kZSwgMHgxMEZGRkYpICE9PSBjb2RlKQogICAgICAgICAgdGhyb3cgUmFuZ2VFcnJvcihjb2RlICsgJyBpcyBub3QgYSB2YWxpZCBjb2RlIHBvaW50Jyk7CiAgICAgICAgICBlbGVtZW50cy5wdXNoKGNvZGUgPCAweDEwMDAwID8gZnJvbUNoYXJDb2RlKGNvZGUpIDogZnJvbUNoYXJDb2RlKCgoY29kZSAtPSAweDEwMDAwKSA+PiAxMCkgKyAweEQ4MDAsIGNvZGUgJSAweDQwMCArIDB4REMwMCkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZWxlbWVudHMuam9pbignJyk7CiAgICAgIH0KICAgIH0pOwoKICAgIC8qKiovfSksICgKICAvKiAxNjEgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDE2Mik7CiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDEwOSk7CiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDE2NCk7CiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDE2OCk7CiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDE2OSk7CiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDE3MCk7CiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDE3MSk7CiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDE3Mik7CiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDE3Myk7CiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDE3NCk7CiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDE3NSk7CiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDE3Nik7CiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDE3Nyk7CiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDE3OCk7CiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDE3OSk7CiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDE4MCk7CiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDE4MSk7CiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDE4Mik7CiAgICBfX3dfcGRmanNfcmVxdWlyZV9fKDE4Myk7CiAgICB2YXIgcGF0aCA9IF9fd19wZGZqc19yZXF1aXJlX18oNDIpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBwYXRoLlN5bWJvbDsKCiAgICAvKioqL30pLCAoCiAgLyogMTYyICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciAkID0gX193X3BkZmpzX3JlcXVpcmVfXyg5KTsKICAgIHZhciBmYWlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTMpOwogICAgdmFyIGlzQXJyYXkgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE1NCk7CiAgICB2YXIgaXNPYmplY3QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIxKTsKICAgIHZhciB0b09iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oODMpOwogICAgdmFyIHRvTGVuZ3RoID0gX193X3BkZmpzX3JlcXVpcmVfXyg0Nik7CiAgICB2YXIgY3JlYXRlUHJvcGVydHkgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDkzKTsKICAgIHZhciBhcnJheVNwZWNpZXNDcmVhdGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE1Myk7CiAgICB2YXIgYXJyYXlNZXRob2RIYXNTcGVjaWVzU3VwcG9ydCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTYzKTsKICAgIHZhciB3ZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDU3KTsKICAgIHZhciBWOF9WRVJTSU9OID0gX193X3BkZmpzX3JlcXVpcmVfXygxMjkpOwogICAgdmFyIElTX0NPTkNBVF9TUFJFQURBQkxFID0gd2VsbEtub3duU3ltYm9sKCdpc0NvbmNhdFNwcmVhZGFibGUnKTsKICAgIHZhciBNQVhfU0FGRV9JTlRFR0VSID0gMHgxRkZGRkZGRkZGRkZGRjsKICAgIHZhciBNQVhJTVVNX0FMTE9XRURfSU5ERVhfRVhDRUVERUQgPSAnTWF4aW11bSBhbGxvd2VkIGluZGV4IGV4Y2VlZGVkJzsKICAgIHZhciBJU19DT05DQVRfU1BSRUFEQUJMRV9TVVBQT1JUID0gVjhfVkVSU0lPTiA+PSA1MSB8fCAhZmFpbHMoZnVuY3Rpb24gKCkgewogICAgICB2YXIgYXJyYXkgPSBbXTsKICAgICAgYXJyYXlbSVNfQ09OQ0FUX1NQUkVBREFCTEVdID0gZmFsc2U7CiAgICAgIHJldHVybiBhcnJheS5jb25jYXQoKVswXSAhPT0gYXJyYXk7CiAgICB9KTsKICAgIHZhciBTUEVDSUVTX1NVUFBPUlQgPSBhcnJheU1ldGhvZEhhc1NwZWNpZXNTdXBwb3J0KCdjb25jYXQnKTsKICAgIHZhciBpc0NvbmNhdFNwcmVhZGFibGUgPSBmdW5jdGlvbiBpc0NvbmNhdFNwcmVhZGFibGUoTykgewogICAgICBpZiAoIWlzT2JqZWN0KE8pKQogICAgICByZXR1cm4gZmFsc2U7CiAgICAgIHZhciBzcHJlYWRhYmxlID0gT1tJU19DT05DQVRfU1BSRUFEQUJMRV07CiAgICAgIHJldHVybiBzcHJlYWRhYmxlICE9PSB1bmRlZmluZWQgPyAhIXNwcmVhZGFibGUgOiBpc0FycmF5KE8pOwogICAgfTsKICAgIHZhciBGT1JDRUQgPSAhSVNfQ09OQ0FUX1NQUkVBREFCTEVfU1VQUE9SVCB8fCAhU1BFQ0lFU19TVVBQT1JUOwogICAgJCh7CiAgICAgIHRhcmdldDogJ0FycmF5JywKICAgICAgcHJvdG86IHRydWUsCiAgICAgIGZvcmNlZDogRk9SQ0VECiAgICB9LCB7CiAgICAgIGNvbmNhdDogZnVuY3Rpb24gY29uY2F0KGFyZykgewogICAgICAgIHZhciBPID0gdG9PYmplY3QodGhpcyk7CiAgICAgICAgdmFyIEEgPSBhcnJheVNwZWNpZXNDcmVhdGUoTywgMCk7CiAgICAgICAgdmFyIG4gPSAwOwogICAgICAgIHZhciBpLCBrLCBsZW5ndGgsIGxlbiwgRTsKICAgICAgICBmb3IgKGkgPSAtMSwgbGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBFID0gaSA9PT0gLTEgPyBPIDogYXJndW1lbnRzW2ldOwogICAgICAgICAgaWYgKGlzQ29uY2F0U3ByZWFkYWJsZShFKSkgewogICAgICAgICAgICBsZW4gPSB0b0xlbmd0aChFLmxlbmd0aCk7CiAgICAgICAgICAgIGlmIChuICsgbGVuID4gTUFYX1NBRkVfSU5URUdFUikKICAgICAgICAgICAgdGhyb3cgVHlwZUVycm9yKE1BWElNVU1fQUxMT1dFRF9JTkRFWF9FWENFRURFRCk7CiAgICAgICAgICAgIGZvciAoayA9IDA7IGsgPCBsZW47IGsrKywgbisrKQogICAgICAgICAgICBpZiAoayBpbiBFKQogICAgICAgICAgICBjcmVhdGVQcm9wZXJ0eShBLCBuLCBFW2tdKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChuID49IE1BWF9TQUZFX0lOVEVHRVIpCiAgICAgICAgICAgIHRocm93IFR5cGVFcnJvcihNQVhJTVVNX0FMTE9XRURfSU5ERVhfRVhDRUVERUQpOwogICAgICAgICAgICBjcmVhdGVQcm9wZXJ0eShBLCBuKyssIEUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBBLmxlbmd0aCA9IG47CiAgICAgICAgcmV0dXJuIEE7CiAgICAgIH0KICAgIH0pOwoKICAgIC8qKiovfSksICgKICAvKiAxNjMgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgZmFpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEzKTsKICAgIHZhciB3ZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDU3KTsKICAgIHZhciBWOF9WRVJTSU9OID0gX193X3BkZmpzX3JlcXVpcmVfXygxMjkpOwogICAgdmFyIFNQRUNJRVMgPSB3ZWxsS25vd25TeW1ib2woJ3NwZWNpZXMnKTsKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKE1FVEhPRF9OQU1FKSB7CiAgICAgIHJldHVybiBWOF9WRVJTSU9OID49IDUxIHx8ICFmYWlscyhmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGFycmF5ID0gW107CiAgICAgICAgdmFyIGNvbnN0cnVjdG9yID0gYXJyYXkuY29uc3RydWN0b3IgPSB7fTsKICAgICAgICBjb25zdHJ1Y3RvcltTUEVDSUVTXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiB7IGZvbzogMSB9OwogICAgICAgIH07CiAgICAgICAgcmV0dXJuIGFycmF5W01FVEhPRF9OQU1FXShCb29sZWFuKS5mb28gIT09IDE7CiAgICAgIH0pOwogICAgfTsKCiAgICAvKioqL30pLCAoCiAgLyogMTY0ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciAkID0gX193X3BkZmpzX3JlcXVpcmVfXyg5KTsKICAgIHZhciBnbG9iYWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEwKTsKICAgIHZhciBnZXRCdWlsdEluID0gX193X3BkZmpzX3JlcXVpcmVfXyg0MSk7CiAgICB2YXIgSVNfUFVSRSA9IF9fd19wZGZqc19yZXF1aXJlX18oMzYpOwogICAgdmFyIERFU0NSSVBUT1JTID0gX193X3BkZmpzX3JlcXVpcmVfXygxMik7CiAgICB2YXIgTkFUSVZFX1NZTUJPTCA9IF9fd19wZGZqc19yZXF1aXJlX18oNTgpOwogICAgdmFyIFVTRV9TWU1CT0xfQVNfVUlEID0gX193X3BkZmpzX3JlcXVpcmVfXyg1OSk7CiAgICB2YXIgZmFpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEzKTsKICAgIHZhciBoYXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIyKTsKICAgIHZhciBpc0FycmF5ID0gX193X3BkZmpzX3JlcXVpcmVfXygxNTQpOwogICAgdmFyIGlzT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygyMSk7CiAgICB2YXIgYW5PYmplY3QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDI3KTsKICAgIHZhciB0b09iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oODMpOwogICAgdmFyIHRvSW5kZXhlZE9iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTYpOwogICAgdmFyIHRvUHJpbWl0aXZlID0gX193X3BkZmpzX3JlcXVpcmVfXygyMCk7CiAgICB2YXIgY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yID0gX193X3BkZmpzX3JlcXVpcmVfXygxNSk7CiAgICB2YXIgbmF0aXZlT2JqZWN0Q3JlYXRlID0gX193X3BkZmpzX3JlcXVpcmVfXyg3MSk7CiAgICB2YXIgb2JqZWN0S2V5cyA9IF9fd19wZGZqc19yZXF1aXJlX18oNzMpOwogICAgdmFyIGdldE93blByb3BlcnR5TmFtZXNNb2R1bGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDQzKTsKICAgIHZhciBnZXRPd25Qcm9wZXJ0eU5hbWVzRXh0ZXJuYWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE2NSk7CiAgICB2YXIgZ2V0T3duUHJvcGVydHlTeW1ib2xzTW9kdWxlID0gX193X3BkZmpzX3JlcXVpcmVfXyg1MCk7CiAgICB2YXIgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yTW9kdWxlID0gX193X3BkZmpzX3JlcXVpcmVfXygxMSk7CiAgICB2YXIgZGVmaW5lUHJvcGVydHlNb2R1bGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDI2KTsKICAgIHZhciBwcm9wZXJ0eUlzRW51bWVyYWJsZU1vZHVsZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTQpOwogICAgdmFyIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjUpOwogICAgdmFyIHJlZGVmaW5lID0gX193X3BkZmpzX3JlcXVpcmVfXygyOCk7CiAgICB2YXIgc2hhcmVkID0gX193X3BkZmpzX3JlcXVpcmVfXygzNSk7CiAgICB2YXIgc2hhcmVkS2V5ID0gX193X3BkZmpzX3JlcXVpcmVfXygzNCk7CiAgICB2YXIgaGlkZGVuS2V5cyA9IF9fd19wZGZqc19yZXF1aXJlX18oMzgpOwogICAgdmFyIHVpZCA9IF9fd19wZGZqc19yZXF1aXJlX18oMzcpOwogICAgdmFyIHdlbGxLbm93blN5bWJvbCA9IF9fd19wZGZqc19yZXF1aXJlX18oNTcpOwogICAgdmFyIHdyYXBwZWRXZWxsS25vd25TeW1ib2xNb2R1bGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE2Nik7CiAgICB2YXIgZGVmaW5lV2VsbEtub3duU3ltYm9sID0gX193X3BkZmpzX3JlcXVpcmVfXygxNjcpOwogICAgdmFyIHNldFRvU3RyaW5nVGFnID0gX193X3BkZmpzX3JlcXVpcmVfXyg4NSk7CiAgICB2YXIgSW50ZXJuYWxTdGF0ZU1vZHVsZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMzIpOwogICAgdmFyICRmb3JFYWNoID0gX193X3BkZmpzX3JlcXVpcmVfXygxNTIpLmZvckVhY2g7CiAgICB2YXIgSElEREVOID0gc2hhcmVkS2V5KCdoaWRkZW4nKTsKICAgIHZhciBTWU1CT0wgPSAnU3ltYm9sJzsKICAgIHZhciBQUk9UT1RZUEUgPSAncHJvdG90eXBlJzsKICAgIHZhciBUT19QUklNSVRJVkUgPSB3ZWxsS25vd25TeW1ib2woJ3RvUHJpbWl0aXZlJyk7CiAgICB2YXIgc2V0SW50ZXJuYWxTdGF0ZSA9IEludGVybmFsU3RhdGVNb2R1bGUuc2V0OwogICAgdmFyIGdldEludGVybmFsU3RhdGUgPSBJbnRlcm5hbFN0YXRlTW9kdWxlLmdldHRlckZvcihTWU1CT0wpOwogICAgdmFyIE9iamVjdFByb3RvdHlwZSA9IE9iamVjdFtQUk9UT1RZUEVdOwogICAgdmFyICRTeW1ib2wgPSBnbG9iYWwuU3ltYm9sOwogICAgdmFyICRzdHJpbmdpZnkgPSBnZXRCdWlsdEluKCdKU09OJywgJ3N0cmluZ2lmeScpOwogICAgdmFyIG5hdGl2ZUdldE93blByb3BlcnR5RGVzY3JpcHRvciA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvck1vZHVsZS5mOwogICAgdmFyIG5hdGl2ZURlZmluZVByb3BlcnR5ID0gZGVmaW5lUHJvcGVydHlNb2R1bGUuZjsKICAgIHZhciBuYXRpdmVHZXRPd25Qcm9wZXJ0eU5hbWVzID0gZ2V0T3duUHJvcGVydHlOYW1lc0V4dGVybmFsLmY7CiAgICB2YXIgbmF0aXZlUHJvcGVydHlJc0VudW1lcmFibGUgPSBwcm9wZXJ0eUlzRW51bWVyYWJsZU1vZHVsZS5mOwogICAgdmFyIEFsbFN5bWJvbHMgPSBzaGFyZWQoJ3N5bWJvbHMnKTsKICAgIHZhciBPYmplY3RQcm90b3R5cGVTeW1ib2xzID0gc2hhcmVkKCdvcC1zeW1ib2xzJyk7CiAgICB2YXIgU3RyaW5nVG9TeW1ib2xSZWdpc3RyeSA9IHNoYXJlZCgnc3RyaW5nLXRvLXN5bWJvbC1yZWdpc3RyeScpOwogICAgdmFyIFN5bWJvbFRvU3RyaW5nUmVnaXN0cnkgPSBzaGFyZWQoJ3N5bWJvbC10by1zdHJpbmctcmVnaXN0cnknKTsKICAgIHZhciBXZWxsS25vd25TeW1ib2xzU3RvcmUgPSBzaGFyZWQoJ3drcycpOwogICAgdmFyIFFPYmplY3QgPSBnbG9iYWwuUU9iamVjdDsKICAgIHZhciBVU0VfU0VUVEVSID0gIVFPYmplY3QgfHwgIVFPYmplY3RbUFJPVE9UWVBFXSB8fCAhUU9iamVjdFtQUk9UT1RZUEVdLmZpbmRDaGlsZDsKICAgIHZhciBzZXRTeW1ib2xEZXNjcmlwdG9yID0gREVTQ1JJUFRPUlMgJiYgZmFpbHMoZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gbmF0aXZlT2JqZWN0Q3JlYXRlKG5hdGl2ZURlZmluZVByb3BlcnR5KHt9LCAnYScsIHsKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiBuYXRpdmVEZWZpbmVQcm9wZXJ0eSh0aGlzLCAnYScsIHsgdmFsdWU6IDcgfSkuYTsKICAgICAgICB9CiAgICAgIH0pKS5hICE9IDc7CiAgICB9KSA/IGZ1bmN0aW9uIChPLCBQLCBBdHRyaWJ1dGVzKSB7CiAgICAgIHZhciBPYmplY3RQcm90b3R5cGVEZXNjcmlwdG9yID0gbmF0aXZlR2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE9iamVjdFByb3RvdHlwZSwgUCk7CiAgICAgIGlmIChPYmplY3RQcm90b3R5cGVEZXNjcmlwdG9yKQogICAgICBkZWxldGUgT2JqZWN0UHJvdG90eXBlW1BdOwogICAgICBuYXRpdmVEZWZpbmVQcm9wZXJ0eShPLCBQLCBBdHRyaWJ1dGVzKTsKICAgICAgaWYgKE9iamVjdFByb3RvdHlwZURlc2NyaXB0b3IgJiYgTyAhPT0gT2JqZWN0UHJvdG90eXBlKSB7CiAgICAgICAgbmF0aXZlRGVmaW5lUHJvcGVydHkoT2JqZWN0UHJvdG90eXBlLCBQLCBPYmplY3RQcm90b3R5cGVEZXNjcmlwdG9yKTsKICAgICAgfQogICAgfSA6IG5hdGl2ZURlZmluZVByb3BlcnR5OwogICAgdmFyIHdyYXAgPSBmdW5jdGlvbiB3cmFwKHRhZywgZGVzY3JpcHRpb24pIHsKICAgICAgdmFyIHN5bWJvbCA9IEFsbFN5bWJvbHNbdGFnXSA9IG5hdGl2ZU9iamVjdENyZWF0ZSgkU3ltYm9sW1BST1RPVFlQRV0pOwogICAgICBzZXRJbnRlcm5hbFN0YXRlKHN5bWJvbCwgewogICAgICAgIHR5cGU6IFNZTUJPTCwKICAgICAgICB0YWc6IHRhZywKICAgICAgICBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24KICAgICAgfSk7CiAgICAgIGlmICghREVTQ1JJUFRPUlMpCiAgICAgIHN5bWJvbC5kZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uOwogICAgICByZXR1cm4gc3ltYm9sOwogICAgfTsKICAgIHZhciBpc1N5bWJvbCA9IFVTRV9TWU1CT0xfQVNfVUlEID8gZnVuY3Rpb24gKGl0KSB7CiAgICAgIHJldHVybiB0eXBlb2YgaXQgPT0gJ3N5bWJvbCc7CiAgICB9IDogZnVuY3Rpb24gKGl0KSB7CiAgICAgIHJldHVybiBPYmplY3QoaXQpIGluc3RhbmNlb2YgJFN5bWJvbDsKICAgIH07CiAgICB2YXIgJGRlZmluZVByb3BlcnR5ID0gZnVuY3Rpb24gZGVmaW5lUHJvcGVydHkoTywgUCwgQXR0cmlidXRlcykgewogICAgICBpZiAoTyA9PT0gT2JqZWN0UHJvdG90eXBlKQogICAgICAkZGVmaW5lUHJvcGVydHkoT2JqZWN0UHJvdG90eXBlU3ltYm9scywgUCwgQXR0cmlidXRlcyk7CiAgICAgIGFuT2JqZWN0KE8pOwogICAgICB2YXIga2V5ID0gdG9QcmltaXRpdmUoUCwgdHJ1ZSk7CiAgICAgIGFuT2JqZWN0KEF0dHJpYnV0ZXMpOwogICAgICBpZiAoaGFzKEFsbFN5bWJvbHMsIGtleSkpIHsKICAgICAgICBpZiAoIUF0dHJpYnV0ZXMuZW51bWVyYWJsZSkgewogICAgICAgICAgaWYgKCFoYXMoTywgSElEREVOKSkKICAgICAgICAgIG5hdGl2ZURlZmluZVByb3BlcnR5KE8sIEhJRERFTiwgY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yKDEsIHt9KSk7CiAgICAgICAgICBPW0hJRERFTl1ba2V5XSA9IHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChoYXMoTywgSElEREVOKSAmJiBPW0hJRERFTl1ba2V5XSkKICAgICAgICAgIE9bSElEREVOXVtrZXldID0gZmFsc2U7CiAgICAgICAgICBBdHRyaWJ1dGVzID0gbmF0aXZlT2JqZWN0Q3JlYXRlKEF0dHJpYnV0ZXMsIHsgZW51bWVyYWJsZTogY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yKDAsIGZhbHNlKSB9KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNldFN5bWJvbERlc2NyaXB0b3IoTywga2V5LCBBdHRyaWJ1dGVzKTsKICAgICAgfQogICAgICByZXR1cm4gbmF0aXZlRGVmaW5lUHJvcGVydHkoTywga2V5LCBBdHRyaWJ1dGVzKTsKICAgIH07CiAgICB2YXIgJGRlZmluZVByb3BlcnRpZXMgPSBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKE8sIFByb3BlcnRpZXMpIHsKICAgICAgYW5PYmplY3QoTyk7CiAgICAgIHZhciBwcm9wZXJ0aWVzID0gdG9JbmRleGVkT2JqZWN0KFByb3BlcnRpZXMpOwogICAgICB2YXIga2V5cyA9IG9iamVjdEtleXMocHJvcGVydGllcykuY29uY2F0KCRnZXRPd25Qcm9wZXJ0eVN5bWJvbHMocHJvcGVydGllcykpOwogICAgICAkZm9yRWFjaChrZXlzLCBmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgaWYgKCFERVNDUklQVE9SUyB8fCAkcHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChwcm9wZXJ0aWVzLCBrZXkpKQogICAgICAgICRkZWZpbmVQcm9wZXJ0eShPLCBrZXksIHByb3BlcnRpZXNba2V5XSk7CiAgICAgIH0pOwogICAgICByZXR1cm4gTzsKICAgIH07CiAgICB2YXIgJGNyZWF0ZSA9IGZ1bmN0aW9uIGNyZWF0ZShPLCBQcm9wZXJ0aWVzKSB7CiAgICAgIHJldHVybiBQcm9wZXJ0aWVzID09PSB1bmRlZmluZWQgPyBuYXRpdmVPYmplY3RDcmVhdGUoTykgOiAkZGVmaW5lUHJvcGVydGllcyhuYXRpdmVPYmplY3RDcmVhdGUoTyksIFByb3BlcnRpZXMpOwogICAgfTsKICAgIHZhciAkcHJvcGVydHlJc0VudW1lcmFibGUgPSBmdW5jdGlvbiBwcm9wZXJ0eUlzRW51bWVyYWJsZShWKSB7CiAgICAgIHZhciBQID0gdG9QcmltaXRpdmUoViwgdHJ1ZSk7CiAgICAgIHZhciBlbnVtZXJhYmxlID0gbmF0aXZlUHJvcGVydHlJc0VudW1lcmFibGUuY2FsbCh0aGlzLCBQKTsKICAgICAgaWYgKHRoaXMgPT09IE9iamVjdFByb3RvdHlwZSAmJiBoYXMoQWxsU3ltYm9scywgUCkgJiYgIWhhcyhPYmplY3RQcm90b3R5cGVTeW1ib2xzLCBQKSkKICAgICAgcmV0dXJuIGZhbHNlOwogICAgICByZXR1cm4gZW51bWVyYWJsZSB8fCAhaGFzKHRoaXMsIFApIHx8ICFoYXMoQWxsU3ltYm9scywgUCkgfHwgaGFzKHRoaXMsIEhJRERFTikgJiYgdGhpc1tISURERU5dW1BdID8gZW51bWVyYWJsZSA6IHRydWU7CiAgICB9OwogICAgdmFyICRnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPSBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTywgUCkgewogICAgICB2YXIgaXQgPSB0b0luZGV4ZWRPYmplY3QoTyk7CiAgICAgIHZhciBrZXkgPSB0b1ByaW1pdGl2ZShQLCB0cnVlKTsKICAgICAgaWYgKGl0ID09PSBPYmplY3RQcm90b3R5cGUgJiYgaGFzKEFsbFN5bWJvbHMsIGtleSkgJiYgIWhhcyhPYmplY3RQcm90b3R5cGVTeW1ib2xzLCBrZXkpKQogICAgICByZXR1cm47CiAgICAgIHZhciBkZXNjcmlwdG9yID0gbmF0aXZlR2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGl0LCBrZXkpOwogICAgICBpZiAoZGVzY3JpcHRvciAmJiBoYXMoQWxsU3ltYm9scywga2V5KSAmJiAhKGhhcyhpdCwgSElEREVOKSAmJiBpdFtISURERU5dW2tleV0pKSB7CiAgICAgICAgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gdHJ1ZTsKICAgICAgfQogICAgICByZXR1cm4gZGVzY3JpcHRvcjsKICAgIH07CiAgICB2YXIgJGdldE93blByb3BlcnR5TmFtZXMgPSBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eU5hbWVzKE8pIHsKICAgICAgdmFyIG5hbWVzID0gbmF0aXZlR2V0T3duUHJvcGVydHlOYW1lcyh0b0luZGV4ZWRPYmplY3QoTykpOwogICAgICB2YXIgcmVzdWx0ID0gW107CiAgICAgICRmb3JFYWNoKG5hbWVzLCBmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgaWYgKCFoYXMoQWxsU3ltYm9scywga2V5KSAmJiAhaGFzKGhpZGRlbktleXMsIGtleSkpCiAgICAgICAgcmVzdWx0LnB1c2goa2V5KTsKICAgICAgfSk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9OwogICAgdmFyICRnZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPSBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eVN5bWJvbHMoTykgewogICAgICB2YXIgSVNfT0JKRUNUX1BST1RPVFlQRSA9IE8gPT09IE9iamVjdFByb3RvdHlwZTsKICAgICAgdmFyIG5hbWVzID0gbmF0aXZlR2V0T3duUHJvcGVydHlOYW1lcyhJU19PQkpFQ1RfUFJPVE9UWVBFID8gT2JqZWN0UHJvdG90eXBlU3ltYm9scyA6IHRvSW5kZXhlZE9iamVjdChPKSk7CiAgICAgIHZhciByZXN1bHQgPSBbXTsKICAgICAgJGZvckVhY2gobmFtZXMsIGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBpZiAoaGFzKEFsbFN5bWJvbHMsIGtleSkgJiYgKCFJU19PQkpFQ1RfUFJPVE9UWVBFIHx8IGhhcyhPYmplY3RQcm90b3R5cGUsIGtleSkpKSB7CiAgICAgICAgICByZXN1bHQucHVzaChBbGxTeW1ib2xzW2tleV0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9OwogICAgaWYgKCFOQVRJVkVfU1lNQk9MKSB7CiAgICAgICRTeW1ib2wgPSBmdW5jdGlvbiBTeW1ib2woKSB7CiAgICAgICAgaWYgKHRoaXMgaW5zdGFuY2VvZiAkU3ltYm9sKQogICAgICAgIHRocm93IFR5cGVFcnJvcignU3ltYm9sIGlzIG5vdCBhIGNvbnN0cnVjdG9yJyk7CiAgICAgICAgdmFyIGRlc2NyaXB0aW9uID0gIWFyZ3VtZW50cy5sZW5ndGggfHwgYXJndW1lbnRzWzBdID09PSB1bmRlZmluZWQgPyB1bmRlZmluZWQgOiBTdHJpbmcoYXJndW1lbnRzWzBdKTsKICAgICAgICB2YXIgdGFnID0gdWlkKGRlc2NyaXB0aW9uKTsKICAgICAgICB2YXIgX3NldHRlciA9IGZ1bmN0aW9uIHNldHRlcih2YWx1ZSkgewogICAgICAgICAgaWYgKHRoaXMgPT09IE9iamVjdFByb3RvdHlwZSkKICAgICAgICAgIF9zZXR0ZXIuY2FsbChPYmplY3RQcm90b3R5cGVTeW1ib2xzLCB2YWx1ZSk7CiAgICAgICAgICBpZiAoaGFzKHRoaXMsIEhJRERFTikgJiYgaGFzKHRoaXNbSElEREVOXSwgdGFnKSkKICAgICAgICAgIHRoaXNbSElEREVOXVt0YWddID0gZmFsc2U7CiAgICAgICAgICBzZXRTeW1ib2xEZXNjcmlwdG9yKHRoaXMsIHRhZywgY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yKDEsIHZhbHVlKSk7CiAgICAgICAgfTsKICAgICAgICBpZiAoREVTQ1JJUFRPUlMgJiYgVVNFX1NFVFRFUikKICAgICAgICBzZXRTeW1ib2xEZXNjcmlwdG9yKE9iamVjdFByb3RvdHlwZSwgdGFnLCB7CiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgICBzZXQ6IF9zZXR0ZXIKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gd3JhcCh0YWcsIGRlc2NyaXB0aW9uKTsKICAgICAgfTsKICAgICAgcmVkZWZpbmUoJFN5bWJvbFtQUk9UT1RZUEVdLCAndG9TdHJpbmcnLCBmdW5jdGlvbiB0b1N0cmluZygpIHsKICAgICAgICByZXR1cm4gZ2V0SW50ZXJuYWxTdGF0ZSh0aGlzKS50YWc7CiAgICAgIH0pOwogICAgICByZWRlZmluZSgkU3ltYm9sLCAnd2l0aG91dFNldHRlcicsIGZ1bmN0aW9uIChkZXNjcmlwdGlvbikgewogICAgICAgIHJldHVybiB3cmFwKHVpZChkZXNjcmlwdGlvbiksIGRlc2NyaXB0aW9uKTsKICAgICAgfSk7CiAgICAgIHByb3BlcnR5SXNFbnVtZXJhYmxlTW9kdWxlLmYgPSAkcHJvcGVydHlJc0VudW1lcmFibGU7CiAgICAgIGRlZmluZVByb3BlcnR5TW9kdWxlLmYgPSAkZGVmaW5lUHJvcGVydHk7CiAgICAgIGdldE93blByb3BlcnR5RGVzY3JpcHRvck1vZHVsZS5mID0gJGdldE93blByb3BlcnR5RGVzY3JpcHRvcjsKICAgICAgZ2V0T3duUHJvcGVydHlOYW1lc01vZHVsZS5mID0gZ2V0T3duUHJvcGVydHlOYW1lc0V4dGVybmFsLmYgPSAkZ2V0T3duUHJvcGVydHlOYW1lczsKICAgICAgZ2V0T3duUHJvcGVydHlTeW1ib2xzTW9kdWxlLmYgPSAkZ2V0T3duUHJvcGVydHlTeW1ib2xzOwogICAgICB3cmFwcGVkV2VsbEtub3duU3ltYm9sTW9kdWxlLmYgPSBmdW5jdGlvbiAobmFtZSkgewogICAgICAgIHJldHVybiB3cmFwKHdlbGxLbm93blN5bWJvbChuYW1lKSwgbmFtZSk7CiAgICAgIH07CiAgICAgIGlmIChERVNDUklQVE9SUykgewogICAgICAgIG5hdGl2ZURlZmluZVByb3BlcnR5KCRTeW1ib2xbUFJPVE9UWVBFXSwgJ2Rlc2NyaXB0aW9uJywgewogICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBkZXNjcmlwdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIGdldEludGVybmFsU3RhdGUodGhpcykuZGVzY3JpcHRpb247CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgaWYgKCFJU19QVVJFKSB7CiAgICAgICAgICByZWRlZmluZShPYmplY3RQcm90b3R5cGUsICdwcm9wZXJ0eUlzRW51bWVyYWJsZScsICRwcm9wZXJ0eUlzRW51bWVyYWJsZSwgeyB1bnNhZmU6IHRydWUgfSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAkKHsKICAgICAgZ2xvYmFsOiB0cnVlLAogICAgICB3cmFwOiB0cnVlLAogICAgICBmb3JjZWQ6ICFOQVRJVkVfU1lNQk9MLAogICAgICBzaGFtOiAhTkFUSVZFX1NZTUJPTAogICAgfSwgeyBTeW1ib2w6ICRTeW1ib2wgfSk7CiAgICAkZm9yRWFjaChvYmplY3RLZXlzKFdlbGxLbm93blN5bWJvbHNTdG9yZSksIGZ1bmN0aW9uIChuYW1lKSB7CiAgICAgIGRlZmluZVdlbGxLbm93blN5bWJvbChuYW1lKTsKICAgIH0pOwogICAgJCh7CiAgICAgIHRhcmdldDogU1lNQk9MLAogICAgICBzdGF0OiB0cnVlLAogICAgICBmb3JjZWQ6ICFOQVRJVkVfU1lNQk9MCiAgICB9LCB7CiAgICAgICdmb3InOiBmdW5jdGlvbiBfZm9yKGtleSkgewogICAgICAgIHZhciBzdHJpbmcgPSBTdHJpbmcoa2V5KTsKICAgICAgICBpZiAoaGFzKFN0cmluZ1RvU3ltYm9sUmVnaXN0cnksIHN0cmluZykpCiAgICAgICAgcmV0dXJuIFN0cmluZ1RvU3ltYm9sUmVnaXN0cnlbc3RyaW5nXTsKICAgICAgICB2YXIgc3ltYm9sID0gJFN5bWJvbChzdHJpbmcpOwogICAgICAgIFN0cmluZ1RvU3ltYm9sUmVnaXN0cnlbc3RyaW5nXSA9IHN5bWJvbDsKICAgICAgICBTeW1ib2xUb1N0cmluZ1JlZ2lzdHJ5W3N5bWJvbF0gPSBzdHJpbmc7CiAgICAgICAgcmV0dXJuIHN5bWJvbDsKICAgICAgfSwKICAgICAga2V5Rm9yOiBmdW5jdGlvbiBrZXlGb3Ioc3ltKSB7CiAgICAgICAgaWYgKCFpc1N5bWJvbChzeW0pKQogICAgICAgIHRocm93IFR5cGVFcnJvcihzeW0gKyAnIGlzIG5vdCBhIHN5bWJvbCcpOwogICAgICAgIGlmIChoYXMoU3ltYm9sVG9TdHJpbmdSZWdpc3RyeSwgc3ltKSkKICAgICAgICByZXR1cm4gU3ltYm9sVG9TdHJpbmdSZWdpc3RyeVtzeW1dOwogICAgICB9LAogICAgICB1c2VTZXR0ZXI6IGZ1bmN0aW9uIHVzZVNldHRlcigpIHsKICAgICAgICBVU0VfU0VUVEVSID0gdHJ1ZTsKICAgICAgfSwKICAgICAgdXNlU2ltcGxlOiBmdW5jdGlvbiB1c2VTaW1wbGUoKSB7CiAgICAgICAgVVNFX1NFVFRFUiA9IGZhbHNlOwogICAgICB9CiAgICB9KTsKICAgICQoewogICAgICB0YXJnZXQ6ICdPYmplY3QnLAogICAgICBzdGF0OiB0cnVlLAogICAgICBmb3JjZWQ6ICFOQVRJVkVfU1lNQk9MLAogICAgICBzaGFtOiAhREVTQ1JJUFRPUlMKICAgIH0sIHsKICAgICAgY3JlYXRlOiAkY3JlYXRlLAogICAgICBkZWZpbmVQcm9wZXJ0eTogJGRlZmluZVByb3BlcnR5LAogICAgICBkZWZpbmVQcm9wZXJ0aWVzOiAkZGVmaW5lUHJvcGVydGllcywKICAgICAgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOiAkZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yCiAgICB9KTsKICAgICQoewogICAgICB0YXJnZXQ6ICdPYmplY3QnLAogICAgICBzdGF0OiB0cnVlLAogICAgICBmb3JjZWQ6ICFOQVRJVkVfU1lNQk9MCiAgICB9LCB7CiAgICAgIGdldE93blByb3BlcnR5TmFtZXM6ICRnZXRPd25Qcm9wZXJ0eU5hbWVzLAogICAgICBnZXRPd25Qcm9wZXJ0eVN5bWJvbHM6ICRnZXRPd25Qcm9wZXJ0eVN5bWJvbHMKICAgIH0pOwogICAgJCh7CiAgICAgIHRhcmdldDogJ09iamVjdCcsCiAgICAgIHN0YXQ6IHRydWUsCiAgICAgIGZvcmNlZDogZmFpbHMoZnVuY3Rpb24gKCkgewogICAgICAgIGdldE93blByb3BlcnR5U3ltYm9sc01vZHVsZS5mKDEpOwogICAgICB9KQogICAgfSwgewogICAgICBnZXRPd25Qcm9wZXJ0eVN5bWJvbHM6IGZ1bmN0aW9uIGdldE93blByb3BlcnR5U3ltYm9scyhpdCkgewogICAgICAgIHJldHVybiBnZXRPd25Qcm9wZXJ0eVN5bWJvbHNNb2R1bGUuZih0b09iamVjdChpdCkpOwogICAgICB9CiAgICB9KTsKICAgIGlmICgkc3RyaW5naWZ5KSB7CiAgICAgIHZhciBGT1JDRURfSlNPTl9TVFJJTkdJRlkgPSAhTkFUSVZFX1NZTUJPTCB8fCBmYWlscyhmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHN5bWJvbCA9ICRTeW1ib2woKTsKICAgICAgICByZXR1cm4gJHN0cmluZ2lmeShbc3ltYm9sXSkgIT0gJ1tudWxsXScgfHwgJHN0cmluZ2lmeSh7IGE6IHN5bWJvbCB9KSAhPSAne30nIHx8ICRzdHJpbmdpZnkoT2JqZWN0KHN5bWJvbCkpICE9ICd7fSc7CiAgICAgIH0pOwogICAgICAkKHsKICAgICAgICB0YXJnZXQ6ICdKU09OJywKICAgICAgICBzdGF0OiB0cnVlLAogICAgICAgIGZvcmNlZDogRk9SQ0VEX0pTT05fU1RSSU5HSUZZCiAgICAgIH0sIHsKICAgICAgICBzdHJpbmdpZnk6IGZ1bmN0aW9uIHN0cmluZ2lmeShpdCwgcmVwbGFjZXIsIHNwYWNlKSB7CiAgICAgICAgICB2YXIgYXJncyA9IFtpdF07CiAgICAgICAgICB2YXIgaW5kZXggPSAxOwogICAgICAgICAgdmFyICRyZXBsYWNlcjsKICAgICAgICAgIHdoaWxlIChhcmd1bWVudHMubGVuZ3RoID4gaW5kZXgpCiAgICAgICAgICBhcmdzLnB1c2goYXJndW1lbnRzW2luZGV4KytdKTsKICAgICAgICAgICRyZXBsYWNlciA9IHJlcGxhY2VyOwogICAgICAgICAgaWYgKCFpc09iamVjdChyZXBsYWNlcikgJiYgaXQgPT09IHVuZGVmaW5lZCB8fCBpc1N5bWJvbChpdCkpCiAgICAgICAgICByZXR1cm47CiAgICAgICAgICBpZiAoIWlzQXJyYXkocmVwbGFjZXIpKQogICAgICAgICAgcmVwbGFjZXIgPSBmdW5jdGlvbiByZXBsYWNlcihrZXksIHZhbHVlKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgJHJlcGxhY2VyID09ICdmdW5jdGlvbicpCiAgICAgICAgICAgIHZhbHVlID0gJHJlcGxhY2VyLmNhbGwodGhpcywga2V5LCB2YWx1ZSk7CiAgICAgICAgICAgIGlmICghaXNTeW1ib2wodmFsdWUpKQogICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICB9OwogICAgICAgICAgYXJnc1sxXSA9IHJlcGxhY2VyOwogICAgICAgICAgcmV0dXJuICRzdHJpbmdpZnkuYXBwbHkobnVsbCwgYXJncyk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIGlmICghJFN5bWJvbFtQUk9UT1RZUEVdW1RPX1BSSU1JVElWRV0pIHsKICAgICAgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5KCRTeW1ib2xbUFJPVE9UWVBFXSwgVE9fUFJJTUlUSVZFLCAkU3ltYm9sW1BST1RPVFlQRV0udmFsdWVPZik7CiAgICB9CiAgICBzZXRUb1N0cmluZ1RhZygkU3ltYm9sLCBTWU1CT0wpOwogICAgaGlkZGVuS2V5c1tISURERU5dID0gdHJ1ZTsKCiAgICAvKioqL30pLCAoCiAgLyogMTY1ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIHRvSW5kZXhlZE9iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTYpOwogICAgdmFyIG5hdGl2ZUdldE93blByb3BlcnR5TmFtZXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDQzKS5mOwogICAgdmFyIHRvU3RyaW5nID0ge30udG9TdHJpbmc7CiAgICB2YXIgd2luZG93TmFtZXMgPSB0eXBlb2Ygd2luZG93ID09ICdvYmplY3QnICYmIHdpbmRvdyAmJiBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyA/IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHdpbmRvdykgOiBbXTsKICAgIHZhciBnZXRXaW5kb3dOYW1lcyA9IGZ1bmN0aW9uIGdldFdpbmRvd05hbWVzKGl0KSB7CiAgICAgIHRyeSB7CiAgICAgICAgcmV0dXJuIG5hdGl2ZUdldE93blByb3BlcnR5TmFtZXMoaXQpOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIHJldHVybiB3aW5kb3dOYW1lcy5zbGljZSgpOwogICAgICB9CiAgICB9OwogICAgbW9kdWxlLmV4cG9ydHMuZiA9IGZ1bmN0aW9uIGdldE93blByb3BlcnR5TmFtZXMoaXQpIHsKICAgICAgcmV0dXJuIHdpbmRvd05hbWVzICYmIHRvU3RyaW5nLmNhbGwoaXQpID09ICdbb2JqZWN0IFdpbmRvd10nID8gZ2V0V2luZG93TmFtZXMoaXQpIDogbmF0aXZlR2V0T3duUHJvcGVydHlOYW1lcyh0b0luZGV4ZWRPYmplY3QoaXQpKTsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDE2NiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciB3ZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDU3KTsKICAgIGV4cG9ydHMuZiA9IHdlbGxLbm93blN5bWJvbDsKCiAgICAvKioqL30pLCAoCiAgLyogMTY3ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIHBhdGggPSBfX3dfcGRmanNfcmVxdWlyZV9fKDQyKTsKICAgIHZhciBoYXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIyKTsKICAgIHZhciB3cmFwcGVkV2VsbEtub3duU3ltYm9sTW9kdWxlID0gX193X3BkZmpzX3JlcXVpcmVfXygxNjYpOwogICAgdmFyIGRlZmluZVByb3BlcnR5ID0gX193X3BkZmpzX3JlcXVpcmVfXygyNikuZjsKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKE5BTUUpIHsKICAgICAgdmFyIFN5bWJvbCA9IHBhdGguU3ltYm9sIHx8IChwYXRoLlN5bWJvbCA9IHt9KTsKICAgICAgaWYgKCFoYXMoU3ltYm9sLCBOQU1FKSkKICAgICAgZGVmaW5lUHJvcGVydHkoU3ltYm9sLCBOQU1FLCB7IHZhbHVlOiB3cmFwcGVkV2VsbEtub3duU3ltYm9sTW9kdWxlLmYoTkFNRSkgfSk7CiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAxNjggKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgZGVmaW5lV2VsbEtub3duU3ltYm9sID0gX193X3BkZmpzX3JlcXVpcmVfXygxNjcpOwogICAgZGVmaW5lV2VsbEtub3duU3ltYm9sKCdhc3luY0l0ZXJhdG9yJyk7CgogICAgLyoqKi99KSwgKAogIC8qIDE2OSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgJCA9IF9fd19wZGZqc19yZXF1aXJlX18oOSk7CiAgICB2YXIgREVTQ1JJUFRPUlMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEyKTsKICAgIHZhciBnbG9iYWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEwKTsKICAgIHZhciBoYXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIyKTsKICAgIHZhciBpc09iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oMjEpOwogICAgdmFyIGRlZmluZVByb3BlcnR5ID0gX193X3BkZmpzX3JlcXVpcmVfXygyNikuZjsKICAgIHZhciBjb3B5Q29uc3RydWN0b3JQcm9wZXJ0aWVzID0gX193X3BkZmpzX3JlcXVpcmVfXygzOSk7CiAgICB2YXIgTmF0aXZlU3ltYm9sID0gZ2xvYmFsLlN5bWJvbDsKICAgIGlmIChERVNDUklQVE9SUyAmJiB0eXBlb2YgTmF0aXZlU3ltYm9sID09ICdmdW5jdGlvbicgJiYgKCEoJ2Rlc2NyaXB0aW9uJyBpbiBOYXRpdmVTeW1ib2wucHJvdG90eXBlKSB8fCBOYXRpdmVTeW1ib2woKS5kZXNjcmlwdGlvbiAhPT0gdW5kZWZpbmVkKSkgewogICAgICB2YXIgRW1wdHlTdHJpbmdEZXNjcmlwdGlvblN0b3JlID0ge307CiAgICAgIHZhciBTeW1ib2xXcmFwcGVyID0gZnVuY3Rpb24gU3ltYm9sKCkgewogICAgICAgIHZhciBkZXNjcmlwdGlvbiA9IGFyZ3VtZW50cy5sZW5ndGggPCAxIHx8IGFyZ3VtZW50c1swXSA9PT0gdW5kZWZpbmVkID8gdW5kZWZpbmVkIDogU3RyaW5nKGFyZ3VtZW50c1swXSk7CiAgICAgICAgdmFyIHJlc3VsdCA9IHRoaXMgaW5zdGFuY2VvZiBTeW1ib2xXcmFwcGVyID8gbmV3IE5hdGl2ZVN5bWJvbChkZXNjcmlwdGlvbikgOiBkZXNjcmlwdGlvbiA9PT0gdW5kZWZpbmVkID8gTmF0aXZlU3ltYm9sKCkgOiBOYXRpdmVTeW1ib2woZGVzY3JpcHRpb24pOwogICAgICAgIGlmIChkZXNjcmlwdGlvbiA9PT0gJycpCiAgICAgICAgRW1wdHlTdHJpbmdEZXNjcmlwdGlvblN0b3JlW3Jlc3VsdF0gPSB0cnVlOwogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH07CiAgICAgIGNvcHlDb25zdHJ1Y3RvclByb3BlcnRpZXMoU3ltYm9sV3JhcHBlciwgTmF0aXZlU3ltYm9sKTsKICAgICAgdmFyIHN5bWJvbFByb3RvdHlwZSA9IFN5bWJvbFdyYXBwZXIucHJvdG90eXBlID0gTmF0aXZlU3ltYm9sLnByb3RvdHlwZTsKICAgICAgc3ltYm9sUHJvdG90eXBlLmNvbnN0cnVjdG9yID0gU3ltYm9sV3JhcHBlcjsKICAgICAgdmFyIHN5bWJvbFRvU3RyaW5nID0gc3ltYm9sUHJvdG90eXBlLnRvU3RyaW5nOwogICAgICB2YXIgbmF0aXZlID0gU3RyaW5nKE5hdGl2ZVN5bWJvbCgndGVzdCcpKSA9PSAnU3ltYm9sKHRlc3QpJzsKICAgICAgdmFyIHJlZ2V4cCA9IC9eU3ltYm9sXCgoLiopXClbXildKyQvOwogICAgICBkZWZpbmVQcm9wZXJ0eShzeW1ib2xQcm90b3R5cGUsICdkZXNjcmlwdGlvbicsIHsKICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBkZXNjcmlwdGlvbigpIHsKICAgICAgICAgIHZhciBzeW1ib2wgPSBpc09iamVjdCh0aGlzKSA/IHRoaXMudmFsdWVPZigpIDogdGhpczsKICAgICAgICAgIHZhciBzdHJpbmcgPSBzeW1ib2xUb1N0cmluZy5jYWxsKHN5bWJvbCk7CiAgICAgICAgICBpZiAoaGFzKEVtcHR5U3RyaW5nRGVzY3JpcHRpb25TdG9yZSwgc3ltYm9sKSkKICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICAgIHZhciBkZXNjID0gbmF0aXZlID8gc3RyaW5nLnNsaWNlKDcsIC0xKSA6IHN0cmluZy5yZXBsYWNlKHJlZ2V4cCwgJyQxJyk7CiAgICAgICAgICByZXR1cm4gZGVzYyA9PT0gJycgPyB1bmRlZmluZWQgOiBkZXNjOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgICQoewogICAgICAgIGdsb2JhbDogdHJ1ZSwKICAgICAgICBmb3JjZWQ6IHRydWUKICAgICAgfSwgeyBTeW1ib2w6IFN5bWJvbFdyYXBwZXIgfSk7CiAgICB9CgogICAgLyoqKi99KSwgKAogIC8qIDE3MCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBkZWZpbmVXZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE2Nyk7CiAgICBkZWZpbmVXZWxsS25vd25TeW1ib2woJ2hhc0luc3RhbmNlJyk7CgogICAgLyoqKi99KSwgKAogIC8qIDE3MSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBkZWZpbmVXZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE2Nyk7CiAgICBkZWZpbmVXZWxsS25vd25TeW1ib2woJ2lzQ29uY2F0U3ByZWFkYWJsZScpOwoKICAgIC8qKiovfSksICgKICAvKiAxNzIgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgZGVmaW5lV2VsbEtub3duU3ltYm9sID0gX193X3BkZmpzX3JlcXVpcmVfXygxNjcpOwogICAgZGVmaW5lV2VsbEtub3duU3ltYm9sKCdpdGVyYXRvcicpOwoKICAgIC8qKiovfSksICgKICAvKiAxNzMgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgZGVmaW5lV2VsbEtub3duU3ltYm9sID0gX193X3BkZmpzX3JlcXVpcmVfXygxNjcpOwogICAgZGVmaW5lV2VsbEtub3duU3ltYm9sKCdtYXRjaCcpOwoKICAgIC8qKiovfSksICgKICAvKiAxNzQgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgZGVmaW5lV2VsbEtub3duU3ltYm9sID0gX193X3BkZmpzX3JlcXVpcmVfXygxNjcpOwogICAgZGVmaW5lV2VsbEtub3duU3ltYm9sKCdtYXRjaEFsbCcpOwoKICAgIC8qKiovfSksICgKICAvKiAxNzUgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgZGVmaW5lV2VsbEtub3duU3ltYm9sID0gX193X3BkZmpzX3JlcXVpcmVfXygxNjcpOwogICAgZGVmaW5lV2VsbEtub3duU3ltYm9sKCdyZXBsYWNlJyk7CgogICAgLyoqKi99KSwgKAogIC8qIDE3NiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBkZWZpbmVXZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE2Nyk7CiAgICBkZWZpbmVXZWxsS25vd25TeW1ib2woJ3NlYXJjaCcpOwoKICAgIC8qKiovfSksICgKICAvKiAxNzcgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgZGVmaW5lV2VsbEtub3duU3ltYm9sID0gX193X3BkZmpzX3JlcXVpcmVfXygxNjcpOwogICAgZGVmaW5lV2VsbEtub3duU3ltYm9sKCdzcGVjaWVzJyk7CgogICAgLyoqKi99KSwgKAogIC8qIDE3OCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBkZWZpbmVXZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE2Nyk7CiAgICBkZWZpbmVXZWxsS25vd25TeW1ib2woJ3NwbGl0Jyk7CgogICAgLyoqKi99KSwgKAogIC8qIDE3OSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBkZWZpbmVXZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE2Nyk7CiAgICBkZWZpbmVXZWxsS25vd25TeW1ib2woJ3RvUHJpbWl0aXZlJyk7CgogICAgLyoqKi99KSwgKAogIC8qIDE4MCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBkZWZpbmVXZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE2Nyk7CiAgICBkZWZpbmVXZWxsS25vd25TeW1ib2woJ3RvU3RyaW5nVGFnJyk7CgogICAgLyoqKi99KSwgKAogIC8qIDE4MSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBkZWZpbmVXZWxsS25vd25TeW1ib2wgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE2Nyk7CiAgICBkZWZpbmVXZWxsS25vd25TeW1ib2woJ3Vuc2NvcGFibGVzJyk7CgogICAgLyoqKi99KSwgKAogIC8qIDE4MiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBzZXRUb1N0cmluZ1RhZyA9IF9fd19wZGZqc19yZXF1aXJlX18oODUpOwogICAgc2V0VG9TdHJpbmdUYWcoTWF0aCwgJ01hdGgnLCB0cnVlKTsKCiAgICAvKioqL30pLCAoCiAgLyogMTgzICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIGdsb2JhbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTApOwogICAgdmFyIHNldFRvU3RyaW5nVGFnID0gX193X3BkZmpzX3JlcXVpcmVfXyg4NSk7CiAgICBzZXRUb1N0cmluZ1RhZyhnbG9iYWwuSlNPTiwgJ0pTT04nLCB0cnVlKTsKCiAgICAvKioqL30pLCAoCiAgLyogMTg0ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgX193X3BkZmpzX3JlcXVpcmVfXygxODUpOwogICAgdmFyIGVudHJ5VW5iaW5kID0gX193X3BkZmpzX3JlcXVpcmVfXyg2MSk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGVudHJ5VW5iaW5kKCdTdHJpbmcnLCAncGFkU3RhcnQnKTsKCiAgICAvKioqL30pLCAoCiAgLyogMTg1ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciAkID0gX193X3BkZmpzX3JlcXVpcmVfXyg5KTsKICAgIHZhciAkcGFkU3RhcnQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE4Nikuc3RhcnQ7CiAgICB2YXIgV0VCS0lUX0JVRyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTg4KTsKICAgICQoewogICAgICB0YXJnZXQ6ICdTdHJpbmcnLAogICAgICBwcm90bzogdHJ1ZSwKICAgICAgZm9yY2VkOiBXRUJLSVRfQlVHCiAgICB9LCB7CiAgICAgIHBhZFN0YXJ0OiBmdW5jdGlvbiBwYWRTdGFydChtYXhMZW5ndGgpIHsKICAgICAgICByZXR1cm4gJHBhZFN0YXJ0KHRoaXMsIG1heExlbmd0aCwgYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQpOwogICAgICB9CiAgICB9KTsKCiAgICAvKioqL30pLCAoCiAgLyogMTg2ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgdmFyIHRvTGVuZ3RoID0gX193X3BkZmpzX3JlcXVpcmVfXyg0Nik7CiAgICB2YXIgcmVwZWF0ID0gX193X3BkZmpzX3JlcXVpcmVfXygxODcpOwogICAgdmFyIHJlcXVpcmVPYmplY3RDb2VyY2libGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE5KTsKICAgIHZhciBjZWlsID0gTWF0aC5jZWlsOwogICAgdmFyIGNyZWF0ZU1ldGhvZCA9IGZ1bmN0aW9uIGNyZWF0ZU1ldGhvZChJU19FTkQpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uICgkdGhpcywgbWF4TGVuZ3RoLCBmaWxsU3RyaW5nKSB7CiAgICAgICAgdmFyIFMgPSBTdHJpbmcocmVxdWlyZU9iamVjdENvZXJjaWJsZSgkdGhpcykpOwogICAgICAgIHZhciBzdHJpbmdMZW5ndGggPSBTLmxlbmd0aDsKICAgICAgICB2YXIgZmlsbFN0ciA9IGZpbGxTdHJpbmcgPT09IHVuZGVmaW5lZCA/ICcgJyA6IFN0cmluZyhmaWxsU3RyaW5nKTsKICAgICAgICB2YXIgaW50TWF4TGVuZ3RoID0gdG9MZW5ndGgobWF4TGVuZ3RoKTsKICAgICAgICB2YXIgZmlsbExlbiwgc3RyaW5nRmlsbGVyOwogICAgICAgIGlmIChpbnRNYXhMZW5ndGggPD0gc3RyaW5nTGVuZ3RoIHx8IGZpbGxTdHIgPT0gJycpCiAgICAgICAgcmV0dXJuIFM7CiAgICAgICAgZmlsbExlbiA9IGludE1heExlbmd0aCAtIHN0cmluZ0xlbmd0aDsKICAgICAgICBzdHJpbmdGaWxsZXIgPSByZXBlYXQuY2FsbChmaWxsU3RyLCBjZWlsKGZpbGxMZW4gLyBmaWxsU3RyLmxlbmd0aCkpOwogICAgICAgIGlmIChzdHJpbmdGaWxsZXIubGVuZ3RoID4gZmlsbExlbikKICAgICAgICBzdHJpbmdGaWxsZXIgPSBzdHJpbmdGaWxsZXIuc2xpY2UoMCwgZmlsbExlbik7CiAgICAgICAgcmV0dXJuIElTX0VORCA/IFMgKyBzdHJpbmdGaWxsZXIgOiBzdHJpbmdGaWxsZXIgKyBTOwogICAgICB9OwogICAgfTsKICAgIG1vZHVsZS5leHBvcnRzID0gewogICAgICBzdGFydDogY3JlYXRlTWV0aG9kKGZhbHNlKSwKICAgICAgZW5kOiBjcmVhdGVNZXRob2QodHJ1ZSkKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDE4NyAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgdG9JbnRlZ2VyID0gX193X3BkZmpzX3JlcXVpcmVfXyg0Nyk7CiAgICB2YXIgcmVxdWlyZU9iamVjdENvZXJjaWJsZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTkpOwogICAgbW9kdWxlLmV4cG9ydHMgPSAnJy5yZXBlYXQgfHwgZnVuY3Rpb24gcmVwZWF0KGNvdW50KSB7CiAgICAgIHZhciBzdHIgPSBTdHJpbmcocmVxdWlyZU9iamVjdENvZXJjaWJsZSh0aGlzKSk7CiAgICAgIHZhciByZXN1bHQgPSAnJzsKICAgICAgdmFyIG4gPSB0b0ludGVnZXIoY291bnQpOwogICAgICBpZiAobiA8IDAgfHwgbiA9PSBJbmZpbml0eSkKICAgICAgdGhyb3cgUmFuZ2VFcnJvcignV3JvbmcgbnVtYmVyIG9mIHJlcGV0aXRpb25zJyk7CiAgICAgIGZvciAoOyBuID4gMDsgKG4gPj4+PSAxKSAmJiAoc3RyICs9IHN0cikpCiAgICAgIGlmIChuICYgMSkKICAgICAgcmVzdWx0ICs9IHN0cjsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH07CgogICAgLyoqKi99KSwgKAogIC8qIDE4OCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciB1c2VyQWdlbnQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEyMyk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IC9WZXJzaW9uXC8xMFwuXGQrKFwuXGQrKT8oIE1vYmlsZVwvXHcrKT8gU2FmYXJpXC8vLnRlc3QodXNlckFnZW50KTsKCiAgICAvKioqL30pLCAoCiAgLyogMTg5ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgX193X3BkZmpzX3JlcXVpcmVfXygxOTApOwogICAgdmFyIGVudHJ5VW5iaW5kID0gX193X3BkZmpzX3JlcXVpcmVfXyg2MSk7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGVudHJ5VW5iaW5kKCdTdHJpbmcnLCAncGFkRW5kJyk7CgogICAgLyoqKi99KSwgKAogIC8qIDE5MCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgJCA9IF9fd19wZGZqc19yZXF1aXJlX18oOSk7CiAgICB2YXIgJHBhZEVuZCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTg2KS5lbmQ7CiAgICB2YXIgV0VCS0lUX0JVRyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTg4KTsKICAgICQoewogICAgICB0YXJnZXQ6ICdTdHJpbmcnLAogICAgICBwcm90bzogdHJ1ZSwKICAgICAgZm9yY2VkOiBXRUJLSVRfQlVHCiAgICB9LCB7CiAgICAgIHBhZEVuZDogZnVuY3Rpb24gcGFkRW5kKG1heExlbmd0aCkgewogICAgICAgIHJldHVybiAkcGFkRW5kKHRoaXMsIG1heExlbmd0aCwgYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQpOwogICAgICB9CiAgICB9KTsKCiAgICAvKioqL30pLCAoCiAgLyogMTkxICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgX193X3BkZmpzX3JlcXVpcmVfXygxOTIpOwogICAgdmFyIHBhdGggPSBfX3dfcGRmanNfcmVxdWlyZV9fKDQyKTsKICAgIG1vZHVsZS5leHBvcnRzID0gcGF0aC5PYmplY3QudmFsdWVzOwoKICAgIC8qKiovfSksICgKICAvKiAxOTIgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgJCA9IF9fd19wZGZqc19yZXF1aXJlX18oOSk7CiAgICB2YXIgJHZhbHVlcyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTkzKS52YWx1ZXM7CiAgICAkKHsKICAgICAgdGFyZ2V0OiAnT2JqZWN0JywKICAgICAgc3RhdDogdHJ1ZQogICAgfSwgewogICAgICB2YWx1ZXM6IGZ1bmN0aW9uIHZhbHVlcyhPKSB7CiAgICAgICAgcmV0dXJuICR2YWx1ZXMoTyk7CiAgICAgIH0KICAgIH0pOwoKICAgIC8qKiovfSksICgKICAvKiAxOTMgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgREVTQ1JJUFRPUlMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEyKTsKICAgIHZhciBvYmplY3RLZXlzID0gX193X3BkZmpzX3JlcXVpcmVfXyg3Myk7CiAgICB2YXIgdG9JbmRleGVkT2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygxNik7CiAgICB2YXIgcHJvcGVydHlJc0VudW1lcmFibGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE0KS5mOwogICAgdmFyIGNyZWF0ZU1ldGhvZCA9IGZ1bmN0aW9uIGNyZWF0ZU1ldGhvZChUT19FTlRSSUVTKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoaXQpIHsKICAgICAgICB2YXIgTyA9IHRvSW5kZXhlZE9iamVjdChpdCk7CiAgICAgICAgdmFyIGtleXMgPSBvYmplY3RLZXlzKE8pOwogICAgICAgIHZhciBsZW5ndGggPSBrZXlzLmxlbmd0aDsKICAgICAgICB2YXIgaSA9IDA7CiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOwogICAgICAgIHZhciBrZXk7CiAgICAgICAgd2hpbGUgKGxlbmd0aCA+IGkpIHsKICAgICAgICAgIGtleSA9IGtleXNbaSsrXTsKICAgICAgICAgIGlmICghREVTQ1JJUFRPUlMgfHwgcHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChPLCBrZXkpKSB7CiAgICAgICAgICAgIHJlc3VsdC5wdXNoKFRPX0VOVFJJRVMgPyBbCiAgICAgICAgICAgIGtleSwKICAgICAgICAgICAgT1trZXldXSA6CiAgICAgICAgICAgIE9ba2V5XSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH07CiAgICB9OwogICAgbW9kdWxlLmV4cG9ydHMgPSB7CiAgICAgIGVudHJpZXM6IGNyZWF0ZU1ldGhvZCh0cnVlKSwKICAgICAgdmFsdWVzOiBjcmVhdGVNZXRob2QoZmFsc2UpCiAgICB9OwoKICAgIC8qKiovfSksICgKICAvKiAxOTQgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgoKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgICAgdmFsdWU6IHRydWUKICAgIH0pOwogICAgZXhwb3J0cy5jbGVhclByaW1pdGl2ZUNhY2hlcyA9IGNsZWFyUHJpbWl0aXZlQ2FjaGVzOwogICAgZXhwb3J0cy5pc0VPRiA9IGlzRU9GOwogICAgZXhwb3J0cy5pc0NtZCA9IGlzQ21kOwogICAgZXhwb3J0cy5pc0RpY3QgPSBpc0RpY3Q7CiAgICBleHBvcnRzLmlzTmFtZSA9IGlzTmFtZTsKICAgIGV4cG9ydHMuaXNSZWYgPSBpc1JlZjsKICAgIGV4cG9ydHMuaXNSZWZzRXF1YWwgPSBpc1JlZnNFcXVhbDsKICAgIGV4cG9ydHMuaXNTdHJlYW0gPSBpc1N0cmVhbTsKICAgIGV4cG9ydHMuUmVmU2V0Q2FjaGUgPSBleHBvcnRzLlJlZlNldCA9IGV4cG9ydHMuUmVmID0gZXhwb3J0cy5OYW1lID0gZXhwb3J0cy5EaWN0ID0gZXhwb3J0cy5DbWQgPSBleHBvcnRzLkVPRiA9IHZvaWQgMDsKCiAgICB2YXIgX3JlZ2VuZXJhdG9yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfX3dfcGRmanNfcmVxdWlyZV9fKDIpKTsKCiAgICB2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUpOwoKICAgIGZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7cmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgImRlZmF1bHQiOiBvYmogfTt9CgogICAgZnVuY3Rpb24gX3R5cGVvZihvYmopIHsiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2YiO2lmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7X3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7cmV0dXJuIHR5cGVvZiBvYmo7fTt9IGVsc2Uge190eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikge3JldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmo7fTt9cmV0dXJuIF90eXBlb2Yob2JqKTt9CgogICAgZnVuY3Rpb24gYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBrZXksIGFyZykge3RyeSB7dmFyIGluZm8gPSBnZW5ba2V5XShhcmcpO3ZhciB2YWx1ZSA9IGluZm8udmFsdWU7fSBjYXRjaCAoZXJyb3IpIHtyZWplY3QoZXJyb3IpO3JldHVybjt9aWYgKGluZm8uZG9uZSkge3Jlc29sdmUodmFsdWUpO30gZWxzZSB7UHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKF9uZXh0LCBfdGhyb3cpO319CgogICAgZnVuY3Rpb24gX2FzeW5jVG9HZW5lcmF0b3IoZm4pIHtyZXR1cm4gZnVuY3Rpb24gKCkge3ZhciBzZWxmID0gdGhpcyxhcmdzID0gYXJndW1lbnRzO3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7dmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpO2Z1bmN0aW9uIF9uZXh0KHZhbHVlKSB7YXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAibmV4dCIsIHZhbHVlKTt9ZnVuY3Rpb24gX3Rocm93KGVycikge2FzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyKTt9X25leHQodW5kZWZpbmVkKTt9KTt9O30KCiAgICB2YXIgRU9GID0ge307CiAgICBleHBvcnRzLkVPRiA9IEVPRjsKCiAgICB2YXIgTmFtZSA9IGZ1bmN0aW9uIE5hbWVDbG9zdXJlKCkgewogICAgICB2YXIgbmFtZUNhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKCiAgICAgIGZ1bmN0aW9uIE5hbWUobmFtZSkgewogICAgICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICAgIH0KCiAgICAgIE5hbWUucHJvdG90eXBlID0ge307CgogICAgICBOYW1lLmdldCA9IGZ1bmN0aW9uIE5hbWVfZ2V0KG5hbWUpIHsKICAgICAgICB2YXIgbmFtZVZhbHVlID0gbmFtZUNhY2hlW25hbWVdOwogICAgICAgIHJldHVybiBuYW1lVmFsdWUgPyBuYW1lVmFsdWUgOiBuYW1lQ2FjaGVbbmFtZV0gPSBuZXcgTmFtZShuYW1lKTsKICAgICAgfTsKCiAgICAgIE5hbWUuX2NsZWFyQ2FjaGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgbmFtZUNhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgfTsKCiAgICAgIHJldHVybiBOYW1lOwogICAgfSgpOwoKICAgIGV4cG9ydHMuTmFtZSA9IE5hbWU7CgogICAgdmFyIENtZCA9IGZ1bmN0aW9uIENtZENsb3N1cmUoKSB7CiAgICAgIHZhciBjbWRDYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CgogICAgICBmdW5jdGlvbiBDbWQoY21kKSB7CiAgICAgICAgdGhpcy5jbWQgPSBjbWQ7CiAgICAgIH0KCiAgICAgIENtZC5wcm90b3R5cGUgPSB7fTsKCiAgICAgIENtZC5nZXQgPSBmdW5jdGlvbiBDbWRfZ2V0KGNtZCkgewogICAgICAgIHZhciBjbWRWYWx1ZSA9IGNtZENhY2hlW2NtZF07CiAgICAgICAgcmV0dXJuIGNtZFZhbHVlID8gY21kVmFsdWUgOiBjbWRDYWNoZVtjbWRdID0gbmV3IENtZChjbWQpOwogICAgICB9OwoKICAgICAgQ21kLl9jbGVhckNhY2hlID0gZnVuY3Rpb24gKCkgewogICAgICAgIGNtZENhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgfTsKCiAgICAgIHJldHVybiBDbWQ7CiAgICB9KCk7CgogICAgZXhwb3J0cy5DbWQgPSBDbWQ7CgogICAgdmFyIERpY3QgPSBmdW5jdGlvbiBEaWN0Q2xvc3VyZSgpIHsKICAgICAgdmFyIG5vblNlcmlhbGl6YWJsZSA9IGZ1bmN0aW9uIG5vblNlcmlhbGl6YWJsZUNsb3N1cmUoKSB7CiAgICAgICAgcmV0dXJuIG5vblNlcmlhbGl6YWJsZTsKICAgICAgfTsKCiAgICAgIGZ1bmN0aW9uIERpY3QoeHJlZikgewogICAgICAgIHRoaXMuX21hcCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgdGhpcy54cmVmID0geHJlZjsKICAgICAgICB0aGlzLm9iaklkID0gbnVsbDsKICAgICAgICB0aGlzLnN1cHByZXNzRW5jcnlwdGlvbiA9IGZhbHNlOwogICAgICAgIHRoaXMuX19ub25TZXJpYWxpemFibGVfXyA9IG5vblNlcmlhbGl6YWJsZTsKICAgICAgfQoKICAgICAgRGljdC5wcm90b3R5cGUgPSB7CiAgICAgICAgYXNzaWduWHJlZjogZnVuY3Rpb24gRGljdF9hc3NpZ25YcmVmKG5ld1hyZWYpIHsKICAgICAgICAgIHRoaXMueHJlZiA9IG5ld1hyZWY7CiAgICAgICAgfSwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldChrZXkxLCBrZXkyLCBrZXkzKSB7CiAgICAgICAgICB2YXIgdmFsdWUgPSB0aGlzLl9tYXBba2V5MV07CgogICAgICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQgJiYga2V5MiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHZhbHVlID0gdGhpcy5fbWFwW2tleTJdOwoKICAgICAgICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQgJiYga2V5MyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgdmFsdWUgPSB0aGlzLl9tYXBba2V5M107CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBSZWYgJiYgdGhpcy54cmVmKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnhyZWYuZmV0Y2godmFsdWUsIHRoaXMuc3VwcHJlc3NFbmNyeXB0aW9uKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgfSwKICAgICAgICBnZXRBc3luYzogZnVuY3Rpb24gZ2V0QXN5bmMoa2V5MSwga2V5Miwga2V5MykgewogICAgICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoLyojX19QVVJFX18qL19yZWdlbmVyYXRvclsiZGVmYXVsdCJdLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICAgICAgdmFyIHZhbHVlOwogICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yWyJkZWZhdWx0Il0ud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IF90aGlzLl9tYXBba2V5MV07CgogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkICYmIGtleTIgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBfdGhpcy5fbWFwW2tleTJdOwoKICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkICYmIGtleTMgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IF90aGlzLl9tYXBba2V5M107CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAoISh2YWx1ZSBpbnN0YW5jZW9mIFJlZiAmJiBfdGhpcy54cmVmKSkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIF90aGlzLnhyZWYuZmV0Y2hBc3luYyh2YWx1ZSwgX3RoaXMuc3VwcHJlc3NFbmNyeXB0aW9uKSk7CgogICAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgdmFsdWUpOwoKICAgICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBfY2FsbGVlKTsKICAgICAgICAgIH0pKSgpOwogICAgICAgIH0sCiAgICAgICAgZ2V0QXJyYXk6IGZ1bmN0aW9uIGdldEFycmF5KGtleTEsIGtleTIsIGtleTMpIHsKICAgICAgICAgIHZhciB2YWx1ZSA9IHRoaXMuZ2V0KGtleTEsIGtleTIsIGtleTMpOwoKICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheSh2YWx1ZSkgfHwgIXRoaXMueHJlZikgewogICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICB9CgogICAgICAgICAgdmFsdWUgPSB2YWx1ZS5zbGljZSgpOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IHZhbHVlLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgaWYgKCEodmFsdWVbaV0gaW5zdGFuY2VvZiBSZWYpKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhbHVlW2ldID0gdGhpcy54cmVmLmZldGNoKHZhbHVlW2ldLCB0aGlzLnN1cHByZXNzRW5jcnlwdGlvbik7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgIH0sCiAgICAgICAgZ2V0UmF3OiBmdW5jdGlvbiBEaWN0X2dldFJhdyhrZXkpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9tYXBba2V5XTsKICAgICAgICB9LAogICAgICAgIGdldEtleXM6IGZ1bmN0aW9uIERpY3RfZ2V0S2V5cygpIHsKICAgICAgICAgIHJldHVybiBPYmplY3Qua2V5cyh0aGlzLl9tYXApOwogICAgICAgIH0sCiAgICAgICAgc2V0OiBmdW5jdGlvbiBEaWN0X3NldChrZXksIHZhbHVlKSB7CiAgICAgICAgICB0aGlzLl9tYXBba2V5XSA9IHZhbHVlOwogICAgICAgIH0sCiAgICAgICAgaGFzOiBmdW5jdGlvbiBEaWN0X2hhcyhrZXkpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9tYXBba2V5XSAhPT0gdW5kZWZpbmVkOwogICAgICAgIH0sCiAgICAgICAgZm9yRWFjaDogZnVuY3Rpb24gRGljdF9mb3JFYWNoKGNhbGxiYWNrKSB7CiAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gdGhpcy5fbWFwKSB7CiAgICAgICAgICAgIGNhbGxiYWNrKGtleSwgdGhpcy5nZXQoa2V5KSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OwogICAgICBEaWN0LmVtcHR5ID0gbmV3IERpY3QobnVsbCk7CgogICAgICBEaWN0Lm1lcmdlID0gZnVuY3Rpb24gKHhyZWYsIGRpY3RBcnJheSkgewogICAgICAgIHZhciBtZXJnZWREaWN0ID0gbmV3IERpY3QoeHJlZik7CgogICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGRpY3RBcnJheS5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICB2YXIgZGljdCA9IGRpY3RBcnJheVtpXTsKCiAgICAgICAgICBpZiAoIWlzRGljdChkaWN0KSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3IgKHZhciBrZXlOYW1lIGluIGRpY3QuX21hcCkgewogICAgICAgICAgICBpZiAobWVyZ2VkRGljdC5fbWFwW2tleU5hbWVdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbWVyZ2VkRGljdC5fbWFwW2tleU5hbWVdID0gZGljdC5fbWFwW2tleU5hbWVdOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG1lcmdlZERpY3Q7CiAgICAgIH07CgogICAgICByZXR1cm4gRGljdDsKICAgIH0oKTsKCiAgICBleHBvcnRzLkRpY3QgPSBEaWN0OwoKICAgIHZhciBSZWYgPSBmdW5jdGlvbiBSZWZDbG9zdXJlKCkgewogICAgICB2YXIgcmVmQ2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwoKICAgICAgZnVuY3Rpb24gUmVmKG51bSwgZ2VuKSB7CiAgICAgICAgdGhpcy5udW0gPSBudW07CiAgICAgICAgdGhpcy5nZW4gPSBnZW47CiAgICAgIH0KCiAgICAgIFJlZi5wcm90b3R5cGUgPSB7CiAgICAgICAgdG9TdHJpbmc6IGZ1bmN0aW9uIFJlZl90b1N0cmluZygpIHsKICAgICAgICAgIGlmICh0aGlzLmdlbiA9PT0gMCkgewogICAgICAgICAgICByZXR1cm4gIiIuY29uY2F0KHRoaXMubnVtLCAiUiIpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiAiIi5jb25jYXQodGhpcy5udW0sICJSIikuY29uY2F0KHRoaXMuZ2VuKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBSZWYuZ2V0ID0gZnVuY3Rpb24gKG51bSwgZ2VuKSB7CiAgICAgICAgdmFyIGtleSA9IGdlbiA9PT0gMCA/ICIiLmNvbmNhdChudW0sICJSIikgOiAiIi5jb25jYXQobnVtLCAiUiIpLmNvbmNhdChnZW4pOwogICAgICAgIHZhciByZWZWYWx1ZSA9IHJlZkNhY2hlW2tleV07CiAgICAgICAgcmV0dXJuIHJlZlZhbHVlID8gcmVmVmFsdWUgOiByZWZDYWNoZVtrZXldID0gbmV3IFJlZihudW0sIGdlbik7CiAgICAgIH07CgogICAgICBSZWYuX2NsZWFyQ2FjaGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmVmQ2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICB9OwoKICAgICAgcmV0dXJuIFJlZjsKICAgIH0oKTsKCiAgICBleHBvcnRzLlJlZiA9IFJlZjsKCiAgICB2YXIgUmVmU2V0ID0gZnVuY3Rpb24gUmVmU2V0Q2xvc3VyZSgpIHsKICAgICAgZnVuY3Rpb24gUmVmU2V0KCkgewogICAgICAgIHRoaXMuZGljdCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIH0KCiAgICAgIFJlZlNldC5wcm90b3R5cGUgPSB7CiAgICAgICAgaGFzOiBmdW5jdGlvbiBSZWZTZXRfaGFzKHJlZikgewogICAgICAgICAgcmV0dXJuIHJlZi50b1N0cmluZygpIGluIHRoaXMuZGljdDsKICAgICAgICB9LAogICAgICAgIHB1dDogZnVuY3Rpb24gUmVmU2V0X3B1dChyZWYpIHsKICAgICAgICAgIHRoaXMuZGljdFtyZWYudG9TdHJpbmcoKV0gPSB0cnVlOwogICAgICAgIH0sCiAgICAgICAgcmVtb3ZlOiBmdW5jdGlvbiBSZWZTZXRfcmVtb3ZlKHJlZikgewogICAgICAgICAgZGVsZXRlIHRoaXMuZGljdFtyZWYudG9TdHJpbmcoKV07CiAgICAgICAgfQogICAgICB9OwogICAgICByZXR1cm4gUmVmU2V0OwogICAgfSgpOwoKICAgIGV4cG9ydHMuUmVmU2V0ID0gUmVmU2V0OwoKICAgIHZhciBSZWZTZXRDYWNoZSA9IGZ1bmN0aW9uIFJlZlNldENhY2hlQ2xvc3VyZSgpIHsKICAgICAgZnVuY3Rpb24gUmVmU2V0Q2FjaGUoKSB7CiAgICAgICAgdGhpcy5kaWN0ID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgfQoKICAgICAgUmVmU2V0Q2FjaGUucHJvdG90eXBlID0gewogICAgICAgIGdldDogZnVuY3Rpb24gUmVmU2V0Q2FjaGVfZ2V0KHJlZikgewogICAgICAgICAgcmV0dXJuIHRoaXMuZGljdFtyZWYudG9TdHJpbmcoKV07CiAgICAgICAgfSwKICAgICAgICBoYXM6IGZ1bmN0aW9uIFJlZlNldENhY2hlX2hhcyhyZWYpIHsKICAgICAgICAgIHJldHVybiByZWYudG9TdHJpbmcoKSBpbiB0aGlzLmRpY3Q7CiAgICAgICAgfSwKICAgICAgICBwdXQ6IGZ1bmN0aW9uIFJlZlNldENhY2hlX3B1dChyZWYsIG9iaikgewogICAgICAgICAgdGhpcy5kaWN0W3JlZi50b1N0cmluZygpXSA9IG9iajsKICAgICAgICB9LAogICAgICAgIHB1dEFsaWFzOiBmdW5jdGlvbiBSZWZTZXRDYWNoZV9wdXRBbGlhcyhyZWYsIGFsaWFzUmVmKSB7CiAgICAgICAgICB0aGlzLmRpY3RbcmVmLnRvU3RyaW5nKCldID0gdGhpcy5nZXQoYWxpYXNSZWYpOwogICAgICAgIH0sCiAgICAgICAgZm9yRWFjaDogZnVuY3Rpb24gUmVmU2V0Q2FjaGVfZm9yRWFjaChjYWxsYmFjaykgewogICAgICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLmRpY3QpIHsKICAgICAgICAgICAgY2FsbGJhY2sodGhpcy5kaWN0W2ldKTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGNsZWFyOiBmdW5jdGlvbiBSZWZTZXRDYWNoZV9jbGVhcigpIHsKICAgICAgICAgIHRoaXMuZGljdCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgfQogICAgICB9OwogICAgICByZXR1cm4gUmVmU2V0Q2FjaGU7CiAgICB9KCk7CgogICAgZXhwb3J0cy5SZWZTZXRDYWNoZSA9IFJlZlNldENhY2hlOwoKICAgIGZ1bmN0aW9uIGlzRU9GKHYpIHsKICAgICAgcmV0dXJuIHYgPT09IEVPRjsKICAgIH0KCiAgICBmdW5jdGlvbiBpc05hbWUodiwgbmFtZSkgewogICAgICByZXR1cm4gdiBpbnN0YW5jZW9mIE5hbWUgJiYgKG5hbWUgPT09IHVuZGVmaW5lZCB8fCB2Lm5hbWUgPT09IG5hbWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzQ21kKHYsIGNtZCkgewogICAgICByZXR1cm4gdiBpbnN0YW5jZW9mIENtZCAmJiAoY21kID09PSB1bmRlZmluZWQgfHwgdi5jbWQgPT09IGNtZCk7CiAgICB9CgogICAgZnVuY3Rpb24gaXNEaWN0KHYsIHR5cGUpIHsKICAgICAgcmV0dXJuIHYgaW5zdGFuY2VvZiBEaWN0ICYmICh0eXBlID09PSB1bmRlZmluZWQgfHwgaXNOYW1lKHYuZ2V0KCJUeXBlIiksIHR5cGUpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBpc1JlZih2KSB7CiAgICAgIHJldHVybiB2IGluc3RhbmNlb2YgUmVmOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzUmVmc0VxdWFsKHYxLCB2MikgewogICAgICByZXR1cm4gdjEubnVtID09PSB2Mi5udW0gJiYgdjEuZ2VuID09PSB2Mi5nZW47CiAgICB9CgogICAgZnVuY3Rpb24gaXNTdHJlYW0odikgewogICAgICByZXR1cm4gX3R5cGVvZih2KSA9PT0gIm9iamVjdCIgJiYgdiAhPT0gbnVsbCAmJiB2LmdldEJ5dGVzICE9PSB1bmRlZmluZWQ7CiAgICB9CgogICAgZnVuY3Rpb24gY2xlYXJQcmltaXRpdmVDYWNoZXMoKSB7CiAgICAgIENtZC5fY2xlYXJDYWNoZSgpOwoKICAgICAgTmFtZS5fY2xlYXJDYWNoZSgpOwoKICAgICAgUmVmLl9jbGVhckNhY2hlKCk7CiAgICB9CgogICAgLyoqKi99KSwgKAogIC8qIDE5NSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCgogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICB2YWx1ZTogdHJ1ZQogICAgfSk7CiAgICBleHBvcnRzLk5ldHdvcmtQZGZNYW5hZ2VyID0gZXhwb3J0cy5Mb2NhbFBkZk1hbmFnZXIgPSB2b2lkIDA7CgogICAgdmFyIF9yZWdlbmVyYXRvciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX193X3BkZmpzX3JlcXVpcmVfXygyKSk7CgogICAgdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXyg1KTsKCiAgICB2YXIgX2NodW5rZWRfc3RyZWFtID0gX193X3BkZmpzX3JlcXVpcmVfXygxOTYpOwoKICAgIHZhciBfY29yZV91dGlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTk3KTsKCiAgICB2YXIgX2RvY3VtZW50ID0gX193X3BkZmpzX3JlcXVpcmVfXygxOTgpOwoKICAgIHZhciBfc3RyZWFtID0gX193X3BkZmpzX3JlcXVpcmVfXygyMDEpOwoKICAgIGZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7cmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgImRlZmF1bHQiOiBvYmogfTt9CgogICAgZnVuY3Rpb24gX3R5cGVvZihvYmopIHsiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2YiO2lmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7X3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7cmV0dXJuIHR5cGVvZiBvYmo7fTt9IGVsc2Uge190eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikge3JldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmo7fTt9cmV0dXJuIF90eXBlb2Yob2JqKTt9CgogICAgZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkge2lmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHtyZXR1cm4gY2FsbDt9cmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7fQoKICAgIGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7X2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHtyZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pO307cmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTt9CgogICAgZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7aWYgKHNlbGYgPT09IHZvaWQgMCkge3Rocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7fXJldHVybiBzZWxmO30KCiAgICBmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHtpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkge3Rocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7fXN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTtpZiAoc3VwZXJDbGFzcykgX3NldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKTt9CgogICAgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHtfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHtvLl9fcHJvdG9fXyA9IHA7cmV0dXJuIG87fTtyZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApO30KCiAgICBmdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7dHJ5IHt2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7dmFyIHZhbHVlID0gaW5mby52YWx1ZTt9IGNhdGNoIChlcnJvcikge3JlamVjdChlcnJvcik7cmV0dXJuO31pZiAoaW5mby5kb25lKSB7cmVzb2x2ZSh2YWx1ZSk7fSBlbHNlIHtQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oX25leHQsIF90aHJvdyk7fX0KCiAgICBmdW5jdGlvbiBfYXN5bmNUb0dlbmVyYXRvcihmbikge3JldHVybiBmdW5jdGlvbiAoKSB7dmFyIHNlbGYgPSB0aGlzLGFyZ3MgPSBhcmd1bWVudHM7cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHt2YXIgZ2VuID0gZm4uYXBwbHkoc2VsZiwgYXJncyk7ZnVuY3Rpb24gX25leHQodmFsdWUpIHthc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJuZXh0IiwgdmFsdWUpO31mdW5jdGlvbiBfdGhyb3coZXJyKSB7YXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAidGhyb3ciLCBlcnIpO31fbmV4dCh1bmRlZmluZWQpO30pO307fQoKICAgIGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHtpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpO319CgogICAgZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykge2ZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHt2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldO2Rlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTtkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7aWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7T2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpO319CgogICAgZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykge2lmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpO2lmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTtyZXR1cm4gQ29uc3RydWN0b3I7fQoKICAgIHZhciBCYXNlUGRmTWFuYWdlciA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgIGZ1bmN0aW9uIEJhc2VQZGZNYW5hZ2VyKCkgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBCYXNlUGRmTWFuYWdlcik7CgogICAgICAgIGlmICh0aGlzLmNvbnN0cnVjdG9yID09PSBCYXNlUGRmTWFuYWdlcikgewogICAgICAgICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgiQ2Fubm90IGluaXRpYWxpemUgQmFzZVBkZk1hbmFnZXIuIik7CiAgICAgICAgfQogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoQmFzZVBkZk1hbmFnZXIsIFt7CiAgICAgICAga2V5OiAib25Mb2FkZWRTdHJlYW0iLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBvbkxvYWRlZFN0cmVhbSgpIHsKICAgICAgICAgICgwLCBfdXRpbC51bnJlYWNoYWJsZSkoIkFic3RyYWN0IG1ldGhvZCBgb25Mb2FkZWRTdHJlYW1gIGNhbGxlZCIpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImVuc3VyZURvYyIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGVuc3VyZURvYyhwcm9wLCBhcmdzKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5lbnN1cmUodGhpcy5wZGZEb2N1bWVudCwgcHJvcCwgYXJncyk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZW5zdXJlWFJlZiIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGVuc3VyZVhSZWYocHJvcCwgYXJncykgewogICAgICAgICAgcmV0dXJuIHRoaXMuZW5zdXJlKHRoaXMucGRmRG9jdW1lbnQueHJlZiwgcHJvcCwgYXJncyk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZW5zdXJlQ2F0YWxvZyIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGVuc3VyZUNhdGFsb2cocHJvcCwgYXJncykgewogICAgICAgICAgcmV0dXJuIHRoaXMuZW5zdXJlKHRoaXMucGRmRG9jdW1lbnQuY2F0YWxvZywgcHJvcCwgYXJncyk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0UGFnZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldFBhZ2UocGFnZUluZGV4KSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5wZGZEb2N1bWVudC5nZXRQYWdlKHBhZ2VJbmRleCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZm9udEZhbGxiYWNrIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZm9udEZhbGxiYWNrKGlkLCBoYW5kbGVyKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5wZGZEb2N1bWVudC5mb250RmFsbGJhY2soaWQsIGhhbmRsZXIpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImNsZWFudXAiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjbGVhbnVwKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMucGRmRG9jdW1lbnQuY2xlYW51cCgpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImVuc3VyZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBfZW5zdXJlID0gX2FzeW5jVG9HZW5lcmF0b3IoLyojX19QVVJFX18qL19yZWdlbmVyYXRvclsiZGVmYXVsdCJdLm1hcmsoZnVuY3Rpb24gX2NhbGxlZShvYmosIHByb3AsIGFyZ3MpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclsiZGVmYXVsdCJdLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgiQWJzdHJhY3QgbWV0aG9kIGBlbnN1cmVgIGNhbGxlZCIpOwoKICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBfY2FsbGVlKTsKICAgICAgICAgIH0pKTsKCiAgICAgICAgICBmdW5jdGlvbiBlbnN1cmUoX3gsIF94MiwgX3gzKSB7CiAgICAgICAgICAgIHJldHVybiBfZW5zdXJlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGVuc3VyZTsKICAgICAgICB9KCkKICAgICAgfSwgewogICAgICAgIGtleTogInJlcXVlc3RSYW5nZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlcXVlc3RSYW5nZShiZWdpbiwgZW5kKSB7CiAgICAgICAgICAoMCwgX3V0aWwudW5yZWFjaGFibGUpKCJBYnN0cmFjdCBtZXRob2QgYHJlcXVlc3RSYW5nZWAgY2FsbGVkIik7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAicmVxdWVzdExvYWRlZFN0cmVhbSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlcXVlc3RMb2FkZWRTdHJlYW0oKSB7CiAgICAgICAgICAoMCwgX3V0aWwudW5yZWFjaGFibGUpKCJBYnN0cmFjdCBtZXRob2QgYHJlcXVlc3RMb2FkZWRTdHJlYW1gIGNhbGxlZCIpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInNlbmRQcm9ncmVzc2l2ZURhdGEiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZW5kUHJvZ3Jlc3NpdmVEYXRhKGNodW5rKSB7CiAgICAgICAgICAoMCwgX3V0aWwudW5yZWFjaGFibGUpKCJBYnN0cmFjdCBtZXRob2QgYHNlbmRQcm9ncmVzc2l2ZURhdGFgIGNhbGxlZCIpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInVwZGF0ZVBhc3N3b3JkIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gdXBkYXRlUGFzc3dvcmQocGFzc3dvcmQpIHsKICAgICAgICAgIHRoaXMuX3Bhc3N3b3JkID0gcGFzc3dvcmQ7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAidGVybWluYXRlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gdGVybWluYXRlKHJlYXNvbikgewogICAgICAgICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgiQWJzdHJhY3QgbWV0aG9kIGB0ZXJtaW5hdGVgIGNhbGxlZCIpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImRvY0lkIiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9kb2NJZDsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJwYXNzd29yZCIsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fcGFzc3dvcmQ7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZG9jQmFzZVVybCIsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICB2YXIgZG9jQmFzZVVybCA9IG51bGw7CgogICAgICAgICAgaWYgKHRoaXMuX2RvY0Jhc2VVcmwpIHsKICAgICAgICAgICAgdmFyIGFic29sdXRlVXJsID0gKDAsIF91dGlsLmNyZWF0ZVZhbGlkQWJzb2x1dGVVcmwpKHRoaXMuX2RvY0Jhc2VVcmwpOwoKICAgICAgICAgICAgaWYgKGFic29sdXRlVXJsKSB7CiAgICAgICAgICAgICAgZG9jQmFzZVVybCA9IGFic29sdXRlVXJsLmhyZWY7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJJbnZhbGlkIGFic29sdXRlIGRvY0Jhc2VVcmw6IFwiIi5jb25jYXQodGhpcy5fZG9jQmFzZVVybCwgIlwiLiIpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAiZG9jQmFzZVVybCIsIGRvY0Jhc2VVcmwpOwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIEJhc2VQZGZNYW5hZ2VyOwogICAgfSgpOwoKICAgIHZhciBMb2NhbFBkZk1hbmFnZXIgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9CYXNlUGRmTWFuYWdlcikgewogICAgICBfaW5oZXJpdHMoTG9jYWxQZGZNYW5hZ2VyLCBfQmFzZVBkZk1hbmFnZXIpOwoKICAgICAgZnVuY3Rpb24gTG9jYWxQZGZNYW5hZ2VyKGRvY0lkLCBkYXRhLCBwYXNzd29yZCwgZXZhbHVhdG9yT3B0aW9ucywgZG9jQmFzZVVybCkgewogICAgICAgIHZhciBfdGhpczsKCiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIExvY2FsUGRmTWFuYWdlcik7CgogICAgICAgIF90aGlzID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKExvY2FsUGRmTWFuYWdlcikuY2FsbCh0aGlzKSk7CiAgICAgICAgX3RoaXMuX2RvY0lkID0gZG9jSWQ7CiAgICAgICAgX3RoaXMuX3Bhc3N3b3JkID0gcGFzc3dvcmQ7CiAgICAgICAgX3RoaXMuX2RvY0Jhc2VVcmwgPSBkb2NCYXNlVXJsOwogICAgICAgIF90aGlzLmV2YWx1YXRvck9wdGlvbnMgPSBldmFsdWF0b3JPcHRpb25zOwogICAgICAgIHZhciBzdHJlYW0gPSBuZXcgX3N0cmVhbS5TdHJlYW0oZGF0YSk7CiAgICAgICAgX3RoaXMucGRmRG9jdW1lbnQgPSBuZXcgX2RvY3VtZW50LlBERkRvY3VtZW50KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCBzdHJlYW0pOwogICAgICAgIF90aGlzLl9sb2FkZWRTdHJlYW1Qcm9taXNlID0gUHJvbWlzZS5yZXNvbHZlKHN0cmVhbSk7CiAgICAgICAgcmV0dXJuIF90aGlzOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoTG9jYWxQZGZNYW5hZ2VyLCBbewogICAgICAgIGtleTogImVuc3VyZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBfZW5zdXJlMiA9IF9hc3luY1RvR2VuZXJhdG9yKC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JbImRlZmF1bHQiXS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKG9iaiwgcHJvcCwgYXJncykgewogICAgICAgICAgICB2YXIgdmFsdWU7CiAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JbImRlZmF1bHQiXS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IG9ialtwcm9wXTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCEodHlwZW9mIHZhbHVlID09PSAiZnVuY3Rpb24iKSkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAzOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgdmFsdWUuYXBwbHkob2JqLCBhcmdzKSk7CgogICAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIHZhbHVlKTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIF9jYWxsZWUyKTsKICAgICAgICAgIH0pKTsKCiAgICAgICAgICBmdW5jdGlvbiBlbnN1cmUoX3g0LCBfeDUsIF94NikgewogICAgICAgICAgICByZXR1cm4gX2Vuc3VyZTIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gZW5zdXJlOwogICAgICAgIH0oKQogICAgICB9LCB7CiAgICAgICAga2V5OiAicmVxdWVzdFJhbmdlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcmVxdWVzdFJhbmdlKGJlZ2luLCBlbmQpIHsKICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJyZXF1ZXN0TG9hZGVkU3RyZWFtIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcmVxdWVzdExvYWRlZFN0cmVhbSgpIHt9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJvbkxvYWRlZFN0cmVhbSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIG9uTG9hZGVkU3RyZWFtKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX2xvYWRlZFN0cmVhbVByb21pc2U7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAidGVybWluYXRlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gdGVybWluYXRlKHJlYXNvbikge30KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIExvY2FsUGRmTWFuYWdlcjsKICAgIH0oQmFzZVBkZk1hbmFnZXIpOwoKICAgIGV4cG9ydHMuTG9jYWxQZGZNYW5hZ2VyID0gTG9jYWxQZGZNYW5hZ2VyOwoKICAgIHZhciBOZXR3b3JrUGRmTWFuYWdlciA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0Jhc2VQZGZNYW5hZ2VyMikgewogICAgICBfaW5oZXJpdHMoTmV0d29ya1BkZk1hbmFnZXIsIF9CYXNlUGRmTWFuYWdlcjIpOwoKICAgICAgZnVuY3Rpb24gTmV0d29ya1BkZk1hbmFnZXIoZG9jSWQsIHBkZk5ldHdvcmtTdHJlYW0sIGFyZ3MsIGV2YWx1YXRvck9wdGlvbnMsIGRvY0Jhc2VVcmwpIHsKICAgICAgICB2YXIgX3RoaXMyOwoKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgTmV0d29ya1BkZk1hbmFnZXIpOwoKICAgICAgICBfdGhpczIgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoTmV0d29ya1BkZk1hbmFnZXIpLmNhbGwodGhpcykpOwogICAgICAgIF90aGlzMi5fZG9jSWQgPSBkb2NJZDsKICAgICAgICBfdGhpczIuX3Bhc3N3b3JkID0gYXJncy5wYXNzd29yZDsKICAgICAgICBfdGhpczIuX2RvY0Jhc2VVcmwgPSBkb2NCYXNlVXJsOwogICAgICAgIF90aGlzMi5tc2dIYW5kbGVyID0gYXJncy5tc2dIYW5kbGVyOwogICAgICAgIF90aGlzMi5ldmFsdWF0b3JPcHRpb25zID0gZXZhbHVhdG9yT3B0aW9uczsKICAgICAgICBfdGhpczIuc3RyZWFtTWFuYWdlciA9IG5ldyBfY2h1bmtlZF9zdHJlYW0uQ2h1bmtlZFN0cmVhbU1hbmFnZXIocGRmTmV0d29ya1N0cmVhbSwgewogICAgICAgICAgbXNnSGFuZGxlcjogYXJncy5tc2dIYW5kbGVyLAogICAgICAgICAgbGVuZ3RoOiBhcmdzLmxlbmd0aCwKICAgICAgICAgIGRpc2FibGVBdXRvRmV0Y2g6IGFyZ3MuZGlzYWJsZUF1dG9GZXRjaCwKICAgICAgICAgIHJhbmdlQ2h1bmtTaXplOiBhcmdzLnJhbmdlQ2h1bmtTaXplCiAgICAgICAgfSk7CiAgICAgICAgX3RoaXMyLnBkZkRvY3VtZW50ID0gbmV3IF9kb2N1bWVudC5QREZEb2N1bWVudChfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzMiksIF90aGlzMi5zdHJlYW1NYW5hZ2VyLmdldFN0cmVhbSgpKTsKICAgICAgICByZXR1cm4gX3RoaXMyOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoTmV0d29ya1BkZk1hbmFnZXIsIFt7CiAgICAgICAga2V5OiAiZW5zdXJlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIF9lbnN1cmUzID0gX2FzeW5jVG9HZW5lcmF0b3IoLyojX19QVVJFX18qL19yZWdlbmVyYXRvclsiZGVmYXVsdCJdLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMob2JqLCBwcm9wLCBhcmdzKSB7CiAgICAgICAgICAgIHZhciB2YWx1ZTsKICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclsiZGVmYXVsdCJdLndyYXAoZnVuY3Rpb24gX2NhbGxlZTMkKF9jb250ZXh0MykgewogICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5wcmV2ID0gMDsKICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IG9ialtwcm9wXTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCEodHlwZW9mIHZhbHVlID09PSAiZnVuY3Rpb24iKSkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSA0OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIiwgdmFsdWUuYXBwbHkob2JqLCBhcmdzKSk7CgogICAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIHZhbHVlKTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDMucHJldiA9IDc7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLnQwID0gX2NvbnRleHQzWyJjYXRjaCJdKDApOwoKICAgICAgICAgICAgICAgICAgICBpZiAoX2NvbnRleHQzLnQwIGluc3RhbmNlb2YgX2NvcmVfdXRpbHMuTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHRocm93IF9jb250ZXh0My50MDsKCiAgICAgICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAxMzsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5yZXF1ZXN0UmFuZ2UoX2NvbnRleHQzLnQwLmJlZ2luLCBfY29udGV4dDMudDAuZW5kKTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIHRoaXMuZW5zdXJlKG9iaiwgcHJvcCwgYXJncykpOwoKICAgICAgICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIF9jYWxsZWUzLCB0aGlzLCBbWzAsIDddXSk7CiAgICAgICAgICB9KSk7CgogICAgICAgICAgZnVuY3Rpb24gZW5zdXJlKF94NywgX3g4LCBfeDkpIHsKICAgICAgICAgICAgcmV0dXJuIF9lbnN1cmUzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGVuc3VyZTsKICAgICAgICB9KCkKICAgICAgfSwgewogICAgICAgIGtleTogInJlcXVlc3RSYW5nZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlcXVlc3RSYW5nZShiZWdpbiwgZW5kKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5zdHJlYW1NYW5hZ2VyLnJlcXVlc3RSYW5nZShiZWdpbiwgZW5kKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJyZXF1ZXN0TG9hZGVkU3RyZWFtIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcmVxdWVzdExvYWRlZFN0cmVhbSgpIHsKICAgICAgICAgIHRoaXMuc3RyZWFtTWFuYWdlci5yZXF1ZXN0QWxsQ2h1bmtzKCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAic2VuZFByb2dyZXNzaXZlRGF0YSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNlbmRQcm9ncmVzc2l2ZURhdGEoY2h1bmspIHsKICAgICAgICAgIHRoaXMuc3RyZWFtTWFuYWdlci5vblJlY2VpdmVEYXRhKHsKICAgICAgICAgICAgY2h1bms6IGNodW5rCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJvbkxvYWRlZFN0cmVhbSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIG9uTG9hZGVkU3RyZWFtKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuc3RyZWFtTWFuYWdlci5vbkxvYWRlZFN0cmVhbSgpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInRlcm1pbmF0ZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHRlcm1pbmF0ZShyZWFzb24pIHsKICAgICAgICAgIHRoaXMuc3RyZWFtTWFuYWdlci5hYm9ydChyZWFzb24pOwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIE5ldHdvcmtQZGZNYW5hZ2VyOwogICAgfShCYXNlUGRmTWFuYWdlcik7CgogICAgZXhwb3J0cy5OZXR3b3JrUGRmTWFuYWdlciA9IE5ldHdvcmtQZGZNYW5hZ2VyOwoKICAgIC8qKiovfSksICgKICAvKiAxOTYgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgoKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgICAgdmFsdWU6IHRydWUKICAgIH0pOwogICAgZXhwb3J0cy5DaHVua2VkU3RyZWFtTWFuYWdlciA9IGV4cG9ydHMuQ2h1bmtlZFN0cmVhbSA9IHZvaWQgMDsKCiAgICB2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUpOwoKICAgIHZhciBfY29yZV91dGlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTk3KTsKCiAgICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7aWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTt9fQoKICAgIGZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHtmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7dmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTtkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7ZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlO2lmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlO09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTt9fQoKICAgIGZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHtpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTtpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7cmV0dXJuIENvbnN0cnVjdG9yO30KCiAgICB2YXIgQ2h1bmtlZFN0cmVhbSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgIGZ1bmN0aW9uIENodW5rZWRTdHJlYW0obGVuZ3RoLCBjaHVua1NpemUsIG1hbmFnZXIpIHsKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQ2h1bmtlZFN0cmVhbSk7CgogICAgICAgIHRoaXMuYnl0ZXMgPSBuZXcgVWludDhBcnJheShsZW5ndGgpOwogICAgICAgIHRoaXMuc3RhcnQgPSAwOwogICAgICAgIHRoaXMucG9zID0gMDsKICAgICAgICB0aGlzLmVuZCA9IGxlbmd0aDsKICAgICAgICB0aGlzLmNodW5rU2l6ZSA9IGNodW5rU2l6ZTsKICAgICAgICB0aGlzLmxvYWRlZENodW5rcyA9IFtdOwogICAgICAgIHRoaXMubnVtQ2h1bmtzTG9hZGVkID0gMDsKICAgICAgICB0aGlzLm51bUNodW5rcyA9IE1hdGguY2VpbChsZW5ndGggLyBjaHVua1NpemUpOwogICAgICAgIHRoaXMubWFuYWdlciA9IG1hbmFnZXI7CiAgICAgICAgdGhpcy5wcm9ncmVzc2l2ZURhdGFMZW5ndGggPSAwOwogICAgICAgIHRoaXMubGFzdFN1Y2Nlc3NmdWxFbnN1cmVCeXRlQ2h1bmsgPSAtMTsKICAgICAgfQoKICAgICAgX2NyZWF0ZUNsYXNzKENodW5rZWRTdHJlYW0sIFt7CiAgICAgICAga2V5OiAiZ2V0TWlzc2luZ0NodW5rcyIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldE1pc3NpbmdDaHVua3MoKSB7CiAgICAgICAgICB2YXIgY2h1bmtzID0gW107CgogICAgICAgICAgZm9yICh2YXIgY2h1bmsgPSAwLCBuID0gdGhpcy5udW1DaHVua3M7IGNodW5rIDwgbjsgKytjaHVuaykgewogICAgICAgICAgICBpZiAoIXRoaXMubG9hZGVkQ2h1bmtzW2NodW5rXSkgewogICAgICAgICAgICAgIGNodW5rcy5wdXNoKGNodW5rKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBjaHVua3M7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0QmFzZVN0cmVhbXMiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRCYXNlU3RyZWFtcygpIHsKICAgICAgICAgIHJldHVybiBbdGhpc107CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiYWxsQ2h1bmtzTG9hZGVkIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gYWxsQ2h1bmtzTG9hZGVkKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMubnVtQ2h1bmtzTG9hZGVkID09PSB0aGlzLm51bUNodW5rczsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJvblJlY2VpdmVEYXRhIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gb25SZWNlaXZlRGF0YShiZWdpbiwgY2h1bmspIHsKICAgICAgICAgIHZhciBjaHVua1NpemUgPSB0aGlzLmNodW5rU2l6ZTsKCiAgICAgICAgICBpZiAoYmVnaW4gJSBjaHVua1NpemUgIT09IDApIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJCYWQgYmVnaW4gb2Zmc2V0OiAiLmNvbmNhdChiZWdpbikpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBlbmQgPSBiZWdpbiArIGNodW5rLmJ5dGVMZW5ndGg7CgogICAgICAgICAgaWYgKGVuZCAlIGNodW5rU2l6ZSAhPT0gMCAmJiBlbmQgIT09IHRoaXMuYnl0ZXMubGVuZ3RoKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQmFkIGVuZCBvZmZzZXQ6ICIuY29uY2F0KGVuZCkpOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuYnl0ZXMuc2V0KG5ldyBVaW50OEFycmF5KGNodW5rKSwgYmVnaW4pOwogICAgICAgICAgdmFyIGJlZ2luQ2h1bmsgPSBNYXRoLmZsb29yKGJlZ2luIC8gY2h1bmtTaXplKTsKICAgICAgICAgIHZhciBlbmRDaHVuayA9IE1hdGguZmxvb3IoKGVuZCAtIDEpIC8gY2h1bmtTaXplKSArIDE7CgogICAgICAgICAgZm9yICh2YXIgY3VyQ2h1bmsgPSBiZWdpbkNodW5rOyBjdXJDaHVuayA8IGVuZENodW5rOyArK2N1ckNodW5rKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5sb2FkZWRDaHVua3NbY3VyQ2h1bmtdKSB7CiAgICAgICAgICAgICAgdGhpcy5sb2FkZWRDaHVua3NbY3VyQ2h1bmtdID0gdHJ1ZTsKICAgICAgICAgICAgICArK3RoaXMubnVtQ2h1bmtzTG9hZGVkOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAib25SZWNlaXZlUHJvZ3Jlc3NpdmVEYXRhIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gb25SZWNlaXZlUHJvZ3Jlc3NpdmVEYXRhKGRhdGEpIHsKICAgICAgICAgIHZhciBwb3NpdGlvbiA9IHRoaXMucHJvZ3Jlc3NpdmVEYXRhTGVuZ3RoOwogICAgICAgICAgdmFyIGJlZ2luQ2h1bmsgPSBNYXRoLmZsb29yKHBvc2l0aW9uIC8gdGhpcy5jaHVua1NpemUpOwogICAgICAgICAgdGhpcy5ieXRlcy5zZXQobmV3IFVpbnQ4QXJyYXkoZGF0YSksIHBvc2l0aW9uKTsKICAgICAgICAgIHBvc2l0aW9uICs9IGRhdGEuYnl0ZUxlbmd0aDsKICAgICAgICAgIHRoaXMucHJvZ3Jlc3NpdmVEYXRhTGVuZ3RoID0gcG9zaXRpb247CiAgICAgICAgICB2YXIgZW5kQ2h1bmsgPSBwb3NpdGlvbiA+PSB0aGlzLmVuZCA/IHRoaXMubnVtQ2h1bmtzIDogTWF0aC5mbG9vcihwb3NpdGlvbiAvIHRoaXMuY2h1bmtTaXplKTsKCiAgICAgICAgICBmb3IgKHZhciBjdXJDaHVuayA9IGJlZ2luQ2h1bms7IGN1ckNodW5rIDwgZW5kQ2h1bms7ICsrY3VyQ2h1bmspIHsKICAgICAgICAgICAgaWYgKCF0aGlzLmxvYWRlZENodW5rc1tjdXJDaHVua10pIHsKICAgICAgICAgICAgICB0aGlzLmxvYWRlZENodW5rc1tjdXJDaHVua10gPSB0cnVlOwogICAgICAgICAgICAgICsrdGhpcy5udW1DaHVua3NMb2FkZWQ7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJlbnN1cmVCeXRlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZW5zdXJlQnl0ZShwb3MpIHsKICAgICAgICAgIGlmIChwb3MgPCB0aGlzLnByb2dyZXNzaXZlRGF0YUxlbmd0aCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGNodW5rID0gTWF0aC5mbG9vcihwb3MgLyB0aGlzLmNodW5rU2l6ZSk7CgogICAgICAgICAgaWYgKGNodW5rID09PSB0aGlzLmxhc3RTdWNjZXNzZnVsRW5zdXJlQnl0ZUNodW5rKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIXRoaXMubG9hZGVkQ2h1bmtzW2NodW5rXSkgewogICAgICAgICAgICB0aHJvdyBuZXcgX2NvcmVfdXRpbHMuTWlzc2luZ0RhdGFFeGNlcHRpb24ocG9zLCBwb3MgKyAxKTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLmxhc3RTdWNjZXNzZnVsRW5zdXJlQnl0ZUNodW5rID0gY2h1bms7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZW5zdXJlUmFuZ2UiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBlbnN1cmVSYW5nZShiZWdpbiwgZW5kKSB7CiAgICAgICAgICBpZiAoYmVnaW4gPj0gZW5kKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZW5kIDw9IHRoaXMucHJvZ3Jlc3NpdmVEYXRhTGVuZ3RoKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgY2h1bmtTaXplID0gdGhpcy5jaHVua1NpemU7CiAgICAgICAgICB2YXIgYmVnaW5DaHVuayA9IE1hdGguZmxvb3IoYmVnaW4gLyBjaHVua1NpemUpOwogICAgICAgICAgdmFyIGVuZENodW5rID0gTWF0aC5mbG9vcigoZW5kIC0gMSkgLyBjaHVua1NpemUpICsgMTsKCiAgICAgICAgICBmb3IgKHZhciBjaHVuayA9IGJlZ2luQ2h1bms7IGNodW5rIDwgZW5kQ2h1bms7ICsrY2h1bmspIHsKICAgICAgICAgICAgaWYgKCF0aGlzLmxvYWRlZENodW5rc1tjaHVua10pIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgX2NvcmVfdXRpbHMuTWlzc2luZ0RhdGFFeGNlcHRpb24oYmVnaW4sIGVuZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJuZXh0RW1wdHlDaHVuayIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIG5leHRFbXB0eUNodW5rKGJlZ2luQ2h1bmspIHsKICAgICAgICAgIHZhciBudW1DaHVua3MgPSB0aGlzLm51bUNodW5rczsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bUNodW5rczsgKytpKSB7CiAgICAgICAgICAgIHZhciBjaHVuayA9IChiZWdpbkNodW5rICsgaSkgJSBudW1DaHVua3M7CgogICAgICAgICAgICBpZiAoIXRoaXMubG9hZGVkQ2h1bmtzW2NodW5rXSkgewogICAgICAgICAgICAgIHJldHVybiBjaHVuazsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImhhc0NodW5rIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaGFzQ2h1bmsoY2h1bmspIHsKICAgICAgICAgIHJldHVybiAhIXRoaXMubG9hZGVkQ2h1bmtzW2NodW5rXTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJnZXRCeXRlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Qnl0ZSgpIHsKICAgICAgICAgIHZhciBwb3MgPSB0aGlzLnBvczsKCiAgICAgICAgICBpZiAocG9zID49IHRoaXMuZW5kKSB7CiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAocG9zID49IHRoaXMucHJvZ3Jlc3NpdmVEYXRhTGVuZ3RoKSB7CiAgICAgICAgICAgIHRoaXMuZW5zdXJlQnl0ZShwb3MpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB0aGlzLmJ5dGVzW3RoaXMucG9zKytdOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImdldFVpbnQxNiIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldFVpbnQxNigpIHsKICAgICAgICAgIHZhciBiMCA9IHRoaXMuZ2V0Qnl0ZSgpOwogICAgICAgICAgdmFyIGIxID0gdGhpcy5nZXRCeXRlKCk7CgogICAgICAgICAgaWYgKGIwID09PSAtMSB8fCBiMSA9PT0gLTEpIHsKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiAoYjAgPDwgOCkgKyBiMTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJnZXRJbnQzMiIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldEludDMyKCkgewogICAgICAgICAgdmFyIGIwID0gdGhpcy5nZXRCeXRlKCk7CiAgICAgICAgICB2YXIgYjEgPSB0aGlzLmdldEJ5dGUoKTsKICAgICAgICAgIHZhciBiMiA9IHRoaXMuZ2V0Qnl0ZSgpOwogICAgICAgICAgdmFyIGIzID0gdGhpcy5nZXRCeXRlKCk7CiAgICAgICAgICByZXR1cm4gKGIwIDw8IDI0KSArIChiMSA8PCAxNikgKyAoYjIgPDwgOCkgKyBiMzsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJnZXRCeXRlcyIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldEJ5dGVzKGxlbmd0aCkgewogICAgICAgICAgdmFyIGZvcmNlQ2xhbXBlZCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CiAgICAgICAgICB2YXIgYnl0ZXMgPSB0aGlzLmJ5dGVzOwogICAgICAgICAgdmFyIHBvcyA9IHRoaXMucG9zOwogICAgICAgICAgdmFyIHN0ckVuZCA9IHRoaXMuZW5kOwoKICAgICAgICAgIGlmICghbGVuZ3RoKSB7CiAgICAgICAgICAgIGlmIChzdHJFbmQgPiB0aGlzLnByb2dyZXNzaXZlRGF0YUxlbmd0aCkgewogICAgICAgICAgICAgIHRoaXMuZW5zdXJlUmFuZ2UocG9zLCBzdHJFbmQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgX3N1YmFycmF5ID0gYnl0ZXMuc3ViYXJyYXkocG9zLCBzdHJFbmQpOwoKICAgICAgICAgICAgcmV0dXJuIGZvcmNlQ2xhbXBlZCA/IG5ldyBVaW50OENsYW1wZWRBcnJheShfc3ViYXJyYXkpIDogX3N1YmFycmF5OwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBlbmQgPSBwb3MgKyBsZW5ndGg7CgogICAgICAgICAgaWYgKGVuZCA+IHN0ckVuZCkgewogICAgICAgICAgICBlbmQgPSBzdHJFbmQ7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGVuZCA+IHRoaXMucHJvZ3Jlc3NpdmVEYXRhTGVuZ3RoKSB7CiAgICAgICAgICAgIHRoaXMuZW5zdXJlUmFuZ2UocG9zLCBlbmQpOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMucG9zID0gZW5kOwogICAgICAgICAgdmFyIHN1YmFycmF5ID0gYnl0ZXMuc3ViYXJyYXkocG9zLCBlbmQpOwogICAgICAgICAgcmV0dXJuIGZvcmNlQ2xhbXBlZCA/IG5ldyBVaW50OENsYW1wZWRBcnJheShzdWJhcnJheSkgOiBzdWJhcnJheTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJwZWVrQnl0ZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHBlZWtCeXRlKCkgewogICAgICAgICAgdmFyIHBlZWtlZEJ5dGUgPSB0aGlzLmdldEJ5dGUoKTsKCiAgICAgICAgICBpZiAocGVla2VkQnl0ZSAhPT0gLTEpIHsKICAgICAgICAgICAgdGhpcy5wb3MtLTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gcGVla2VkQnl0ZTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJwZWVrQnl0ZXMiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBwZWVrQnl0ZXMobGVuZ3RoKSB7CiAgICAgICAgICB2YXIgZm9yY2VDbGFtcGVkID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBmYWxzZTsKICAgICAgICAgIHZhciBieXRlcyA9IHRoaXMuZ2V0Qnl0ZXMobGVuZ3RoLCBmb3JjZUNsYW1wZWQpOwogICAgICAgICAgdGhpcy5wb3MgLT0gYnl0ZXMubGVuZ3RoOwogICAgICAgICAgcmV0dXJuIGJ5dGVzOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImdldEJ5dGVSYW5nZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldEJ5dGVSYW5nZShiZWdpbiwgZW5kKSB7CiAgICAgICAgICBpZiAoYmVnaW4gPCAwKSB7CiAgICAgICAgICAgIGJlZ2luID0gMDsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZW5kID4gdGhpcy5lbmQpIHsKICAgICAgICAgICAgZW5kID0gdGhpcy5lbmQ7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGVuZCA+IHRoaXMucHJvZ3Jlc3NpdmVEYXRhTGVuZ3RoKSB7CiAgICAgICAgICAgIHRoaXMuZW5zdXJlUmFuZ2UoYmVnaW4sIGVuZCk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHRoaXMuYnl0ZXMuc3ViYXJyYXkoYmVnaW4sIGVuZCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAic2tpcCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNraXAobikgewogICAgICAgICAgaWYgKCFuKSB7CiAgICAgICAgICAgIG4gPSAxOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMucG9zICs9IG47CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAicmVzZXQiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiByZXNldCgpIHsKICAgICAgICAgIHRoaXMucG9zID0gdGhpcy5zdGFydDsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJtb3ZlU3RhcnQiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBtb3ZlU3RhcnQoKSB7CiAgICAgICAgICB0aGlzLnN0YXJ0ID0gdGhpcy5wb3M7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAibWFrZVN1YlN0cmVhbSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIG1ha2VTdWJTdHJlYW0oc3RhcnQsIGxlbmd0aCwgZGljdCkgewogICAgICAgICAgaWYgKGxlbmd0aCkgewogICAgICAgICAgICBpZiAoc3RhcnQgKyBsZW5ndGggPiB0aGlzLnByb2dyZXNzaXZlRGF0YUxlbmd0aCkgewogICAgICAgICAgICAgIHRoaXMuZW5zdXJlUmFuZ2Uoc3RhcnQsIHN0YXJ0ICsgbGVuZ3RoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHN0YXJ0ID49IHRoaXMucHJvZ3Jlc3NpdmVEYXRhTGVuZ3RoKSB7CiAgICAgICAgICAgICAgdGhpcy5lbnN1cmVCeXRlKHN0YXJ0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIENodW5rZWRTdHJlYW1TdWJzdHJlYW0oKSB7fQoKICAgICAgICAgIENodW5rZWRTdHJlYW1TdWJzdHJlYW0ucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSh0aGlzKTsKCiAgICAgICAgICBDaHVua2VkU3RyZWFtU3Vic3RyZWFtLnByb3RvdHlwZS5nZXRNaXNzaW5nQ2h1bmtzID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgY2h1bmtTaXplID0gdGhpcy5jaHVua1NpemU7CiAgICAgICAgICAgIHZhciBiZWdpbkNodW5rID0gTWF0aC5mbG9vcih0aGlzLnN0YXJ0IC8gY2h1bmtTaXplKTsKICAgICAgICAgICAgdmFyIGVuZENodW5rID0gTWF0aC5mbG9vcigodGhpcy5lbmQgLSAxKSAvIGNodW5rU2l6ZSkgKyAxOwogICAgICAgICAgICB2YXIgbWlzc2luZ0NodW5rcyA9IFtdOwoKICAgICAgICAgICAgZm9yICh2YXIgY2h1bmsgPSBiZWdpbkNodW5rOyBjaHVuayA8IGVuZENodW5rOyArK2NodW5rKSB7CiAgICAgICAgICAgICAgaWYgKCF0aGlzLmxvYWRlZENodW5rc1tjaHVua10pIHsKICAgICAgICAgICAgICAgIG1pc3NpbmdDaHVua3MucHVzaChjaHVuayk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gbWlzc2luZ0NodW5rczsKICAgICAgICAgIH07CgogICAgICAgICAgQ2h1bmtlZFN0cmVhbVN1YnN0cmVhbS5wcm90b3R5cGUuYWxsQ2h1bmtzTG9hZGVkID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAodGhpcy5udW1DaHVua3NMb2FkZWQgPT09IHRoaXMubnVtQ2h1bmtzKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldE1pc3NpbmdDaHVua3MoKS5sZW5ndGggPT09IDA7CiAgICAgICAgICB9OwoKICAgICAgICAgIHZhciBzdWJTdHJlYW0gPSBuZXcgQ2h1bmtlZFN0cmVhbVN1YnN0cmVhbSgpOwogICAgICAgICAgc3ViU3RyZWFtLnBvcyA9IHN1YlN0cmVhbS5zdGFydCA9IHN0YXJ0OwogICAgICAgICAgc3ViU3RyZWFtLmVuZCA9IHN0YXJ0ICsgbGVuZ3RoIHx8IHRoaXMuZW5kOwogICAgICAgICAgc3ViU3RyZWFtLmRpY3QgPSBkaWN0OwogICAgICAgICAgcmV0dXJuIHN1YlN0cmVhbTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJsZW5ndGgiLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuZW5kIC0gdGhpcy5zdGFydDsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJpc0VtcHR5IiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLmxlbmd0aCA9PT0gMDsKICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBDaHVua2VkU3RyZWFtOwogICAgfSgpOwoKICAgIGV4cG9ydHMuQ2h1bmtlZFN0cmVhbSA9IENodW5rZWRTdHJlYW07CgogICAgdmFyIENodW5rZWRTdHJlYW1NYW5hZ2VyID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gQ2h1bmtlZFN0cmVhbU1hbmFnZXIocGRmTmV0d29ya1N0cmVhbSwgYXJncykgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBDaHVua2VkU3RyZWFtTWFuYWdlcik7CgogICAgICAgIHRoaXMubGVuZ3RoID0gYXJncy5sZW5ndGg7CiAgICAgICAgdGhpcy5jaHVua1NpemUgPSBhcmdzLnJhbmdlQ2h1bmtTaXplOwogICAgICAgIHRoaXMuc3RyZWFtID0gbmV3IENodW5rZWRTdHJlYW0odGhpcy5sZW5ndGgsIHRoaXMuY2h1bmtTaXplLCB0aGlzKTsKICAgICAgICB0aGlzLnBkZk5ldHdvcmtTdHJlYW0gPSBwZGZOZXR3b3JrU3RyZWFtOwogICAgICAgIHRoaXMuZGlzYWJsZUF1dG9GZXRjaCA9IGFyZ3MuZGlzYWJsZUF1dG9GZXRjaDsKICAgICAgICB0aGlzLm1zZ0hhbmRsZXIgPSBhcmdzLm1zZ0hhbmRsZXI7CiAgICAgICAgdGhpcy5jdXJyUmVxdWVzdElkID0gMDsKICAgICAgICB0aGlzLmNodW5rc05lZWRlZEJ5UmVxdWVzdCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgdGhpcy5yZXF1ZXN0c0J5Q2h1bmsgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgIHRoaXMucHJvbWlzZXNCeVJlcXVlc3QgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgIHRoaXMucHJvZ3Jlc3NpdmVEYXRhTGVuZ3RoID0gMDsKICAgICAgICB0aGlzLmFib3J0ZWQgPSBmYWxzZTsKICAgICAgICB0aGlzLl9sb2FkZWRTdHJlYW1DYXBhYmlsaXR5ID0gKDAsIF91dGlsLmNyZWF0ZVByb21pc2VDYXBhYmlsaXR5KSgpOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoQ2h1bmtlZFN0cmVhbU1hbmFnZXIsIFt7CiAgICAgICAga2V5OiAib25Mb2FkZWRTdHJlYW0iLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBvbkxvYWRlZFN0cmVhbSgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9sb2FkZWRTdHJlYW1DYXBhYmlsaXR5LnByb21pc2U7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAic2VuZFJlcXVlc3QiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZW5kUmVxdWVzdChiZWdpbiwgZW5kKSB7CiAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgICAgIHZhciByYW5nZVJlYWRlciA9IHRoaXMucGRmTmV0d29ya1N0cmVhbS5nZXRSYW5nZVJlYWRlcihiZWdpbiwgZW5kKTsKCiAgICAgICAgICBpZiAoIXJhbmdlUmVhZGVyLmlzU3RyZWFtaW5nU3VwcG9ydGVkKSB7CiAgICAgICAgICAgIHJhbmdlUmVhZGVyLm9uUHJvZ3Jlc3MgPSB0aGlzLm9uUHJvZ3Jlc3MuYmluZCh0aGlzKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgY2h1bmtzID0gW10sCiAgICAgICAgICAgIGxvYWRlZCA9IDA7CiAgICAgICAgICB2YXIgcHJvbWlzZSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgICAgdmFyIHJlYWRDaHVuayA9IGZ1bmN0aW9uIHJlYWRDaHVuayhjaHVuaykgewogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZiAoIWNodW5rLmRvbmUpIHsKICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBjaHVuay52YWx1ZTsKICAgICAgICAgICAgICAgICAgY2h1bmtzLnB1c2goZGF0YSk7CiAgICAgICAgICAgICAgICAgIGxvYWRlZCArPSAoMCwgX3V0aWwuYXJyYXlCeXRlTGVuZ3RoKShkYXRhKTsKCiAgICAgICAgICAgICAgICAgIGlmIChyYW5nZVJlYWRlci5pc1N0cmVhbWluZ1N1cHBvcnRlZCkgewogICAgICAgICAgICAgICAgICAgIF90aGlzLm9uUHJvZ3Jlc3MoewogICAgICAgICAgICAgICAgICAgICAgbG9hZGVkOiBsb2FkZWQKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgcmFuZ2VSZWFkZXIucmVhZCgpLnRoZW4ocmVhZENodW5rLCByZWplY3QpOwogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdmFyIGNodW5rRGF0YSA9ICgwLCBfdXRpbC5hcnJheXNUb0J5dGVzKShjaHVua3MpOwogICAgICAgICAgICAgICAgY2h1bmtzID0gbnVsbDsKICAgICAgICAgICAgICAgIHJlc29sdmUoY2h1bmtEYXRhKTsKICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICByZWplY3QoZSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgcmFuZ2VSZWFkZXIucmVhZCgpLnRoZW4ocmVhZENodW5rLCByZWplY3QpOwogICAgICAgICAgfSk7CiAgICAgICAgICBwcm9taXNlLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgaWYgKF90aGlzLmFib3J0ZWQpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF90aGlzLm9uUmVjZWl2ZURhdGEoewogICAgICAgICAgICAgIGNodW5rOiBkYXRhLAogICAgICAgICAgICAgIGJlZ2luOiBiZWdpbgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInJlcXVlc3RBbGxDaHVua3MiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiByZXF1ZXN0QWxsQ2h1bmtzKCkgewogICAgICAgICAgdmFyIG1pc3NpbmdDaHVua3MgPSB0aGlzLnN0cmVhbS5nZXRNaXNzaW5nQ2h1bmtzKCk7CgogICAgICAgICAgdGhpcy5fcmVxdWVzdENodW5rcyhtaXNzaW5nQ2h1bmtzKTsKCiAgICAgICAgICByZXR1cm4gdGhpcy5fbG9hZGVkU3RyZWFtQ2FwYWJpbGl0eS5wcm9taXNlOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIl9yZXF1ZXN0Q2h1bmtzIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX3JlcXVlc3RDaHVua3MoY2h1bmtzKSB7CiAgICAgICAgICB2YXIgcmVxdWVzdElkID0gdGhpcy5jdXJyUmVxdWVzdElkKys7CiAgICAgICAgICB2YXIgY2h1bmtzTmVlZGVkID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICAgIHRoaXMuY2h1bmtzTmVlZGVkQnlSZXF1ZXN0W3JlcXVlc3RJZF0gPSBjaHVua3NOZWVkZWQ7CiAgICAgICAgICB2YXIgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IHRydWU7CiAgICAgICAgICB2YXIgX2RpZEl0ZXJhdG9yRXJyb3IgPSBmYWxzZTsKICAgICAgICAgIHZhciBfaXRlcmF0b3JFcnJvciA9IHVuZGVmaW5lZDsKCiAgICAgICAgICB0cnkgewogICAgICAgICAgICBmb3IgKHZhciBfaXRlcmF0b3IgPSBjaHVua3NbU3ltYm9sLml0ZXJhdG9yXSgpLCBfc3RlcDsgIShfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gKF9zdGVwID0gX2l0ZXJhdG9yLm5leHQoKSkuZG9uZSk7IF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSB0cnVlKSB7CiAgICAgICAgICAgICAgdmFyIF9jaHVuayA9IF9zdGVwLnZhbHVlOwoKICAgICAgICAgICAgICBpZiAoIXRoaXMuc3RyZWFtLmhhc0NodW5rKF9jaHVuaykpIHsKICAgICAgICAgICAgICAgIGNodW5rc05lZWRlZFtfY2h1bmtdID0gdHJ1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvciA9IHRydWU7CiAgICAgICAgICAgIF9pdGVyYXRvckVycm9yID0gZXJyOwogICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gJiYgX2l0ZXJhdG9yWyJyZXR1cm4iXSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBfaXRlcmF0b3JbInJldHVybiJdKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgIGlmIChfZGlkSXRlcmF0b3JFcnJvcikgewogICAgICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3I7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCgwLCBfdXRpbC5pc0VtcHR5T2JqKShjaHVua3NOZWVkZWQpKSB7CiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgY2FwYWJpbGl0eSA9ICgwLCBfdXRpbC5jcmVhdGVQcm9taXNlQ2FwYWJpbGl0eSkoKTsKICAgICAgICAgIHRoaXMucHJvbWlzZXNCeVJlcXVlc3RbcmVxdWVzdElkXSA9IGNhcGFiaWxpdHk7CiAgICAgICAgICB2YXIgY2h1bmtzVG9SZXF1ZXN0ID0gW107CgogICAgICAgICAgZm9yICh2YXIgY2h1bmsgaW4gY2h1bmtzTmVlZGVkKSB7CiAgICAgICAgICAgIGNodW5rID0gY2h1bmsgfCAwOwoKICAgICAgICAgICAgaWYgKCEoY2h1bmsgaW4gdGhpcy5yZXF1ZXN0c0J5Q2h1bmspKSB7CiAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0c0J5Q2h1bmtbY2h1bmtdID0gW107CiAgICAgICAgICAgICAgY2h1bmtzVG9SZXF1ZXN0LnB1c2goY2h1bmspOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLnJlcXVlc3RzQnlDaHVua1tjaHVua10ucHVzaChyZXF1ZXN0SWQpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghY2h1bmtzVG9SZXF1ZXN0Lmxlbmd0aCkgewogICAgICAgICAgICByZXR1cm4gY2FwYWJpbGl0eS5wcm9taXNlOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBncm91cGVkQ2h1bmtzVG9SZXF1ZXN0ID0gdGhpcy5ncm91cENodW5rcyhjaHVua3NUb1JlcXVlc3QpOwogICAgICAgICAgdmFyIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yID0gdHJ1ZTsKICAgICAgICAgIHZhciBfZGlkSXRlcmF0b3JFcnJvcjIgPSBmYWxzZTsKICAgICAgICAgIHZhciBfaXRlcmF0b3JFcnJvcjIgPSB1bmRlZmluZWQ7CgogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZm9yICh2YXIgX2l0ZXJhdG9yMiA9IGdyb3VwZWRDaHVua3NUb1JlcXVlc3RbU3ltYm9sLml0ZXJhdG9yXSgpLCBfc3RlcDI7ICEoX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIgPSAoX3N0ZXAyID0gX2l0ZXJhdG9yMi5uZXh0KCkpLmRvbmUpOyBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiA9IHRydWUpIHsKICAgICAgICAgICAgICB2YXIgZ3JvdXBlZENodW5rID0gX3N0ZXAyLnZhbHVlOwogICAgICAgICAgICAgIHZhciBiZWdpbiA9IGdyb3VwZWRDaHVuay5iZWdpbkNodW5rICogdGhpcy5jaHVua1NpemU7CiAgICAgICAgICAgICAgdmFyIGVuZCA9IE1hdGgubWluKGdyb3VwZWRDaHVuay5lbmRDaHVuayAqIHRoaXMuY2h1bmtTaXplLCB0aGlzLmxlbmd0aCk7CiAgICAgICAgICAgICAgdGhpcy5zZW5kUmVxdWVzdChiZWdpbiwgZW5kKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgIF9kaWRJdGVyYXRvckVycm9yMiA9IHRydWU7CiAgICAgICAgICAgIF9pdGVyYXRvckVycm9yMiA9IGVycjsKICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgaWYgKCFfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiAmJiBfaXRlcmF0b3IyWyJyZXR1cm4iXSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBfaXRlcmF0b3IyWyJyZXR1cm4iXSgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICBpZiAoX2RpZEl0ZXJhdG9yRXJyb3IyKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBfaXRlcmF0b3JFcnJvcjI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGNhcGFiaWxpdHkucHJvbWlzZTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJnZXRTdHJlYW0iLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRTdHJlYW0oKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5zdHJlYW07CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAicmVxdWVzdFJhbmdlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcmVxdWVzdFJhbmdlKGJlZ2luLCBlbmQpIHsKICAgICAgICAgIGVuZCA9IE1hdGgubWluKGVuZCwgdGhpcy5sZW5ndGgpOwogICAgICAgICAgdmFyIGJlZ2luQ2h1bmsgPSB0aGlzLmdldEJlZ2luQ2h1bmsoYmVnaW4pOwogICAgICAgICAgdmFyIGVuZENodW5rID0gdGhpcy5nZXRFbmRDaHVuayhlbmQpOwogICAgICAgICAgdmFyIGNodW5rcyA9IFtdOwoKICAgICAgICAgIGZvciAodmFyIGNodW5rID0gYmVnaW5DaHVuazsgY2h1bmsgPCBlbmRDaHVuazsgKytjaHVuaykgewogICAgICAgICAgICBjaHVua3MucHVzaChjaHVuayk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHRoaXMuX3JlcXVlc3RDaHVua3MoY2h1bmtzKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJyZXF1ZXN0UmFuZ2VzIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcmVxdWVzdFJhbmdlcygpIHsKICAgICAgICAgIHZhciByYW5nZXMgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IFtdOwogICAgICAgICAgdmFyIGNodW5rc1RvUmVxdWVzdCA9IFtdOwogICAgICAgICAgdmFyIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24zID0gdHJ1ZTsKICAgICAgICAgIHZhciBfZGlkSXRlcmF0b3JFcnJvcjMgPSBmYWxzZTsKICAgICAgICAgIHZhciBfaXRlcmF0b3JFcnJvcjMgPSB1bmRlZmluZWQ7CgogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZm9yICh2YXIgX2l0ZXJhdG9yMyA9IHJhbmdlc1tTeW1ib2wuaXRlcmF0b3JdKCksIF9zdGVwMzsgIShfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMyA9IChfc3RlcDMgPSBfaXRlcmF0b3IzLm5leHQoKSkuZG9uZSk7IF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24zID0gdHJ1ZSkgewogICAgICAgICAgICAgIHZhciByYW5nZSA9IF9zdGVwMy52YWx1ZTsKICAgICAgICAgICAgICB2YXIgYmVnaW5DaHVuayA9IHRoaXMuZ2V0QmVnaW5DaHVuayhyYW5nZS5iZWdpbik7CiAgICAgICAgICAgICAgdmFyIGVuZENodW5rID0gdGhpcy5nZXRFbmRDaHVuayhyYW5nZS5lbmQpOwoKICAgICAgICAgICAgICBmb3IgKHZhciBjaHVuayA9IGJlZ2luQ2h1bms7IGNodW5rIDwgZW5kQ2h1bms7ICsrY2h1bmspIHsKICAgICAgICAgICAgICAgIGlmICghY2h1bmtzVG9SZXF1ZXN0LmluY2x1ZGVzKGNodW5rKSkgewogICAgICAgICAgICAgICAgICBjaHVua3NUb1JlcXVlc3QucHVzaChjaHVuayk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgX2RpZEl0ZXJhdG9yRXJyb3IzID0gdHJ1ZTsKICAgICAgICAgICAgX2l0ZXJhdG9yRXJyb3IzID0gZXJyOwogICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24zICYmIF9pdGVyYXRvcjNbInJldHVybiJdICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIF9pdGVyYXRvcjNbInJldHVybiJdKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgIGlmIChfZGlkSXRlcmF0b3JFcnJvcjMpIHsKICAgICAgICAgICAgICAgIHRocm93IF9pdGVyYXRvckVycm9yMzsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBjaHVua3NUb1JlcXVlc3Quc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICByZXR1cm4gYSAtIGI7CiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0Q2h1bmtzKGNodW5rc1RvUmVxdWVzdCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ3JvdXBDaHVua3MiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBncm91cENodW5rcyhjaHVua3MpIHsKICAgICAgICAgIHZhciBncm91cGVkQ2h1bmtzID0gW107CiAgICAgICAgICB2YXIgYmVnaW5DaHVuayA9IC0xOwogICAgICAgICAgdmFyIHByZXZDaHVuayA9IC0xOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGNodW5rcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7CiAgICAgICAgICAgIHZhciBjaHVuayA9IGNodW5rc1tpXTsKCiAgICAgICAgICAgIGlmIChiZWdpbkNodW5rIDwgMCkgewogICAgICAgICAgICAgIGJlZ2luQ2h1bmsgPSBjaHVuazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHByZXZDaHVuayA+PSAwICYmIHByZXZDaHVuayArIDEgIT09IGNodW5rKSB7CiAgICAgICAgICAgICAgZ3JvdXBlZENodW5rcy5wdXNoKHsKICAgICAgICAgICAgICAgIGJlZ2luQ2h1bms6IGJlZ2luQ2h1bmssCiAgICAgICAgICAgICAgICBlbmRDaHVuazogcHJldkNodW5rICsgMQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGJlZ2luQ2h1bmsgPSBjaHVuazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGkgKyAxID09PSBjaHVua3MubGVuZ3RoKSB7CiAgICAgICAgICAgICAgZ3JvdXBlZENodW5rcy5wdXNoKHsKICAgICAgICAgICAgICAgIGJlZ2luQ2h1bms6IGJlZ2luQ2h1bmssCiAgICAgICAgICAgICAgICBlbmRDaHVuazogY2h1bmsgKyAxCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHByZXZDaHVuayA9IGNodW5rOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBncm91cGVkQ2h1bmtzOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIm9uUHJvZ3Jlc3MiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBvblByb2dyZXNzKGFyZ3MpIHsKICAgICAgICAgIHRoaXMubXNnSGFuZGxlci5zZW5kKCJEb2NQcm9ncmVzcyIsIHsKICAgICAgICAgICAgbG9hZGVkOiB0aGlzLnN0cmVhbS5udW1DaHVua3NMb2FkZWQgKiB0aGlzLmNodW5rU2l6ZSArIGFyZ3MubG9hZGVkLAogICAgICAgICAgICB0b3RhbDogdGhpcy5sZW5ndGgKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIm9uUmVjZWl2ZURhdGEiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBvblJlY2VpdmVEYXRhKGFyZ3MpIHsKICAgICAgICAgIHZhciBjaHVuayA9IGFyZ3MuY2h1bms7CiAgICAgICAgICB2YXIgaXNQcm9ncmVzc2l2ZSA9IGFyZ3MuYmVnaW4gPT09IHVuZGVmaW5lZDsKICAgICAgICAgIHZhciBiZWdpbiA9IGlzUHJvZ3Jlc3NpdmUgPyB0aGlzLnByb2dyZXNzaXZlRGF0YUxlbmd0aCA6IGFyZ3MuYmVnaW47CiAgICAgICAgICB2YXIgZW5kID0gYmVnaW4gKyBjaHVuay5ieXRlTGVuZ3RoOwogICAgICAgICAgdmFyIGJlZ2luQ2h1bmsgPSBNYXRoLmZsb29yKGJlZ2luIC8gdGhpcy5jaHVua1NpemUpOwogICAgICAgICAgdmFyIGVuZENodW5rID0gZW5kIDwgdGhpcy5sZW5ndGggPyBNYXRoLmZsb29yKGVuZCAvIHRoaXMuY2h1bmtTaXplKSA6IE1hdGguY2VpbChlbmQgLyB0aGlzLmNodW5rU2l6ZSk7CgogICAgICAgICAgaWYgKGlzUHJvZ3Jlc3NpdmUpIHsKICAgICAgICAgICAgdGhpcy5zdHJlYW0ub25SZWNlaXZlUHJvZ3Jlc3NpdmVEYXRhKGNodW5rKTsKICAgICAgICAgICAgdGhpcy5wcm9ncmVzc2l2ZURhdGFMZW5ndGggPSBlbmQ7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnN0cmVhbS5vblJlY2VpdmVEYXRhKGJlZ2luLCBjaHVuayk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRoaXMuc3RyZWFtLmFsbENodW5rc0xvYWRlZCgpKSB7CiAgICAgICAgICAgIHRoaXMuX2xvYWRlZFN0cmVhbUNhcGFiaWxpdHkucmVzb2x2ZSh0aGlzLnN0cmVhbSk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGxvYWRlZFJlcXVlc3RzID0gW107CgogICAgICAgICAgZm9yICh2YXIgX2NodW5rMiA9IGJlZ2luQ2h1bms7IF9jaHVuazIgPCBlbmRDaHVuazsgKytfY2h1bmsyKSB7CiAgICAgICAgICAgIHZhciByZXF1ZXN0SWRzID0gdGhpcy5yZXF1ZXN0c0J5Q2h1bmtbX2NodW5rMl0gfHwgW107CiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnJlcXVlc3RzQnlDaHVua1tfY2h1bmsyXTsKICAgICAgICAgICAgdmFyIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb240ID0gdHJ1ZTsKICAgICAgICAgICAgdmFyIF9kaWRJdGVyYXRvckVycm9yNCA9IGZhbHNlOwogICAgICAgICAgICB2YXIgX2l0ZXJhdG9yRXJyb3I0ID0gdW5kZWZpbmVkOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBmb3IgKHZhciBfaXRlcmF0b3I0ID0gcmVxdWVzdElkc1tTeW1ib2wuaXRlcmF0b3JdKCksIF9zdGVwNDsgIShfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uNCA9IChfc3RlcDQgPSBfaXRlcmF0b3I0Lm5leHQoKSkuZG9uZSk7IF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb240ID0gdHJ1ZSkgewogICAgICAgICAgICAgICAgdmFyIHJlcXVlc3RJZCA9IF9zdGVwNC52YWx1ZTsKICAgICAgICAgICAgICAgIHZhciBjaHVua3NOZWVkZWQgPSB0aGlzLmNodW5rc05lZWRlZEJ5UmVxdWVzdFtyZXF1ZXN0SWRdOwoKICAgICAgICAgICAgICAgIGlmIChfY2h1bmsyIGluIGNodW5rc05lZWRlZCkgewogICAgICAgICAgICAgICAgICBkZWxldGUgY2h1bmtzTmVlZGVkW19jaHVuazJdOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICghKDAsIF91dGlsLmlzRW1wdHlPYmopKGNodW5rc05lZWRlZCkpIHsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbG9hZGVkUmVxdWVzdHMucHVzaChyZXF1ZXN0SWQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgX2RpZEl0ZXJhdG9yRXJyb3I0ID0gdHJ1ZTsKICAgICAgICAgICAgICBfaXRlcmF0b3JFcnJvcjQgPSBlcnI7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICghX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjQgJiYgX2l0ZXJhdG9yNFsicmV0dXJuIl0gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICBfaXRlcmF0b3I0WyJyZXR1cm4iXSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBpZiAoX2RpZEl0ZXJhdG9yRXJyb3I0KSB7CiAgICAgICAgICAgICAgICAgIHRocm93IF9pdGVyYXRvckVycm9yNDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIXRoaXMuZGlzYWJsZUF1dG9GZXRjaCAmJiAoMCwgX3V0aWwuaXNFbXB0eU9iaikodGhpcy5yZXF1ZXN0c0J5Q2h1bmspKSB7CiAgICAgICAgICAgIHZhciBuZXh0RW1wdHlDaHVuazsKCiAgICAgICAgICAgIGlmICh0aGlzLnN0cmVhbS5udW1DaHVua3NMb2FkZWQgPT09IDEpIHsKICAgICAgICAgICAgICB2YXIgbGFzdENodW5rID0gdGhpcy5zdHJlYW0ubnVtQ2h1bmtzIC0gMTsKCiAgICAgICAgICAgICAgaWYgKCF0aGlzLnN0cmVhbS5oYXNDaHVuayhsYXN0Q2h1bmspKSB7CiAgICAgICAgICAgICAgICBuZXh0RW1wdHlDaHVuayA9IGxhc3RDaHVuazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbmV4dEVtcHR5Q2h1bmsgPSB0aGlzLnN0cmVhbS5uZXh0RW1wdHlDaHVuayhlbmRDaHVuayk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKG5leHRFbXB0eUNodW5rKSkgewogICAgICAgICAgICAgIHRoaXMuX3JlcXVlc3RDaHVua3MoW25leHRFbXB0eUNodW5rXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9sb2FkZWRSZXF1ZXN0cyA9IGxvYWRlZFJlcXVlc3RzOyBfaSA8IF9sb2FkZWRSZXF1ZXN0cy5sZW5ndGg7IF9pKyspIHsKICAgICAgICAgICAgdmFyIF9yZXF1ZXN0SWQgPSBfbG9hZGVkUmVxdWVzdHNbX2ldOwogICAgICAgICAgICB2YXIgY2FwYWJpbGl0eSA9IHRoaXMucHJvbWlzZXNCeVJlcXVlc3RbX3JlcXVlc3RJZF07CiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnByb21pc2VzQnlSZXF1ZXN0W19yZXF1ZXN0SWRdOwogICAgICAgICAgICBjYXBhYmlsaXR5LnJlc29sdmUoKTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLm1zZ0hhbmRsZXIuc2VuZCgiRG9jUHJvZ3Jlc3MiLCB7CiAgICAgICAgICAgIGxvYWRlZDogdGhpcy5zdHJlYW0ubnVtQ2h1bmtzTG9hZGVkICogdGhpcy5jaHVua1NpemUsCiAgICAgICAgICAgIHRvdGFsOiB0aGlzLmxlbmd0aAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAib25FcnJvciIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIG9uRXJyb3IoZXJyKSB7CiAgICAgICAgICB0aGlzLl9sb2FkZWRTdHJlYW1DYXBhYmlsaXR5LnJlamVjdChlcnIpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImdldEJlZ2luQ2h1bmsiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRCZWdpbkNodW5rKGJlZ2luKSB7CiAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihiZWdpbiAvIHRoaXMuY2h1bmtTaXplKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJnZXRFbmRDaHVuayIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldEVuZENodW5rKGVuZCkgewogICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoKGVuZCAtIDEpIC8gdGhpcy5jaHVua1NpemUpICsgMTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJhYm9ydCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGFib3J0KHJlYXNvbikgewogICAgICAgICAgdGhpcy5hYm9ydGVkID0gdHJ1ZTsKCiAgICAgICAgICBpZiAodGhpcy5wZGZOZXR3b3JrU3RyZWFtKSB7CiAgICAgICAgICAgIHRoaXMucGRmTmV0d29ya1N0cmVhbS5jYW5jZWxBbGxSZXF1ZXN0cyhyZWFzb24pOwogICAgICAgICAgfQoKICAgICAgICAgIGZvciAodmFyIHJlcXVlc3RJZCBpbiB0aGlzLnByb21pc2VzQnlSZXF1ZXN0KSB7CiAgICAgICAgICAgIHRoaXMucHJvbWlzZXNCeVJlcXVlc3RbcmVxdWVzdElkXS5yZWplY3QocmVhc29uKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBDaHVua2VkU3RyZWFtTWFuYWdlcjsKICAgIH0oKTsKCiAgICBleHBvcnRzLkNodW5rZWRTdHJlYW1NYW5hZ2VyID0gQ2h1bmtlZFN0cmVhbU1hbmFnZXI7CgogICAgLyoqKi99KSwgKAogIC8qIDE5NyAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCgogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICB2YWx1ZTogdHJ1ZQogICAgfSk7CiAgICBleHBvcnRzLmdldExvb2t1cFRhYmxlRmFjdG9yeSA9IGdldExvb2t1cFRhYmxlRmFjdG9yeTsKICAgIGV4cG9ydHMuZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eSA9IGdldEluaGVyaXRhYmxlUHJvcGVydHk7CiAgICBleHBvcnRzLnRvUm9tYW5OdW1lcmFscyA9IHRvUm9tYW5OdW1lcmFsczsKICAgIGV4cG9ydHMubG9nMiA9IGxvZzI7CiAgICBleHBvcnRzLnJlYWRJbnQ4ID0gcmVhZEludDg7CiAgICBleHBvcnRzLnJlYWRVaW50MTYgPSByZWFkVWludDE2OwogICAgZXhwb3J0cy5yZWFkVWludDMyID0gcmVhZFVpbnQzMjsKICAgIGV4cG9ydHMuaXNXaGl0ZVNwYWNlID0gaXNXaGl0ZVNwYWNlOwogICAgZXhwb3J0cy5YUmVmUGFyc2VFeGNlcHRpb24gPSBleHBvcnRzLlhSZWZFbnRyeUV4Y2VwdGlvbiA9IGV4cG9ydHMuTWlzc2luZ0RhdGFFeGNlcHRpb24gPSB2b2lkIDA7CgogICAgdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXyg1KTsKCiAgICBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyJAYmFiZWwvaGVscGVycyAtIHR5cGVvZiI7aWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIpIHtfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHtyZXR1cm4gdHlwZW9mIG9iajt9O30gZWxzZSB7X3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7cmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajt9O31yZXR1cm4gX3R5cGVvZihvYmopO30KCiAgICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7aWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTt9fQoKICAgIGZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHtpZiAoY2FsbCAmJiAoX3R5cGVvZihjYWxsKSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7cmV0dXJuIGNhbGw7fXJldHVybiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpO30KCiAgICBmdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHtpZiAoc2VsZiA9PT0gdm9pZCAwKSB7dGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTt9cmV0dXJuIHNlbGY7fQoKICAgIGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7X2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHtyZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pO307cmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTt9CgogICAgZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7aWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpO31zdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7aWYgKHN1cGVyQ2xhc3MpIF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7fQoKICAgIGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7X3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7by5fX3Byb3RvX18gPSBwO3JldHVybiBvO307cmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTt9CgogICAgZnVuY3Rpb24gZ2V0TG9va3VwVGFibGVGYWN0b3J5KGluaXRpYWxpemVyKSB7CiAgICAgIHZhciBsb29rdXA7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKGluaXRpYWxpemVyKSB7CiAgICAgICAgICBsb29rdXAgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgICAgaW5pdGlhbGl6ZXIobG9va3VwKTsKICAgICAgICAgIGluaXRpYWxpemVyID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIHJldHVybiBsb29rdXA7CiAgICAgIH07CiAgICB9CgogICAgdmFyIE1pc3NpbmdEYXRhRXhjZXB0aW9uID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQmFzZUV4Y2VwdGlvbikgewogICAgICBfaW5oZXJpdHMoTWlzc2luZ0RhdGFFeGNlcHRpb24sIF9CYXNlRXhjZXB0aW9uKTsKCiAgICAgIGZ1bmN0aW9uIE1pc3NpbmdEYXRhRXhjZXB0aW9uKGJlZ2luLCBlbmQpIHsKICAgICAgICB2YXIgX3RoaXM7CgogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBNaXNzaW5nRGF0YUV4Y2VwdGlvbik7CgogICAgICAgIF90aGlzID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKE1pc3NpbmdEYXRhRXhjZXB0aW9uKS5jYWxsKHRoaXMsICJNaXNzaW5nIGRhdGEgWyIuY29uY2F0KGJlZ2luLCAiLCAiKS5jb25jYXQoZW5kLCAiKSIpKSk7CiAgICAgICAgX3RoaXMuYmVnaW4gPSBiZWdpbjsKICAgICAgICBfdGhpcy5lbmQgPSBlbmQ7CiAgICAgICAgcmV0dXJuIF90aGlzOwogICAgICB9CgogICAgICByZXR1cm4gTWlzc2luZ0RhdGFFeGNlcHRpb247CiAgICB9KF91dGlsLkJhc2VFeGNlcHRpb24pOwoKICAgIGV4cG9ydHMuTWlzc2luZ0RhdGFFeGNlcHRpb24gPSBNaXNzaW5nRGF0YUV4Y2VwdGlvbjsKCiAgICB2YXIgWFJlZkVudHJ5RXhjZXB0aW9uID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQmFzZUV4Y2VwdGlvbjIpIHsKICAgICAgX2luaGVyaXRzKFhSZWZFbnRyeUV4Y2VwdGlvbiwgX0Jhc2VFeGNlcHRpb24yKTsKCiAgICAgIGZ1bmN0aW9uIFhSZWZFbnRyeUV4Y2VwdGlvbigpIHsKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgWFJlZkVudHJ5RXhjZXB0aW9uKTsKCiAgICAgICAgcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihYUmVmRW50cnlFeGNlcHRpb24pLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpOwogICAgICB9CgogICAgICByZXR1cm4gWFJlZkVudHJ5RXhjZXB0aW9uOwogICAgfShfdXRpbC5CYXNlRXhjZXB0aW9uKTsKCiAgICBleHBvcnRzLlhSZWZFbnRyeUV4Y2VwdGlvbiA9IFhSZWZFbnRyeUV4Y2VwdGlvbjsKCiAgICB2YXIgWFJlZlBhcnNlRXhjZXB0aW9uID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQmFzZUV4Y2VwdGlvbjMpIHsKICAgICAgX2luaGVyaXRzKFhSZWZQYXJzZUV4Y2VwdGlvbiwgX0Jhc2VFeGNlcHRpb24zKTsKCiAgICAgIGZ1bmN0aW9uIFhSZWZQYXJzZUV4Y2VwdGlvbigpIHsKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgWFJlZlBhcnNlRXhjZXB0aW9uKTsKCiAgICAgICAgcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihYUmVmUGFyc2VFeGNlcHRpb24pLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpOwogICAgICB9CgogICAgICByZXR1cm4gWFJlZlBhcnNlRXhjZXB0aW9uOwogICAgfShfdXRpbC5CYXNlRXhjZXB0aW9uKTsKCiAgICBleHBvcnRzLlhSZWZQYXJzZUV4Y2VwdGlvbiA9IFhSZWZQYXJzZUV4Y2VwdGlvbjsKCiAgICBmdW5jdGlvbiBnZXRJbmhlcml0YWJsZVByb3BlcnR5KF9yZWYpIHsKICAgICAgdmFyIGRpY3QgPSBfcmVmLmRpY3QsCiAgICAgICAga2V5ID0gX3JlZi5rZXksCiAgICAgICAgX3JlZiRnZXRBcnJheSA9IF9yZWYuZ2V0QXJyYXksCiAgICAgICAgZ2V0QXJyYXkgPSBfcmVmJGdldEFycmF5ID09PSB2b2lkIDAgPyBmYWxzZSA6IF9yZWYkZ2V0QXJyYXksCiAgICAgICAgX3JlZiRzdG9wV2hlbkZvdW5kID0gX3JlZi5zdG9wV2hlbkZvdW5kLAogICAgICAgIHN0b3BXaGVuRm91bmQgPSBfcmVmJHN0b3BXaGVuRm91bmQgPT09IHZvaWQgMCA/IHRydWUgOiBfcmVmJHN0b3BXaGVuRm91bmQ7CiAgICAgIHZhciBMT09QX0xJTUlUID0gMTAwOwogICAgICB2YXIgbG9vcENvdW50ID0gMDsKICAgICAgdmFyIHZhbHVlczsKCiAgICAgIHdoaWxlIChkaWN0KSB7CiAgICAgICAgdmFyIHZhbHVlID0gZ2V0QXJyYXkgPyBkaWN0LmdldEFycmF5KGtleSkgOiBkaWN0LmdldChrZXkpOwoKICAgICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgaWYgKHN0b3BXaGVuRm91bmQpIHsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghdmFsdWVzKSB7CiAgICAgICAgICAgIHZhbHVlcyA9IFtdOwogICAgICAgICAgfQoKICAgICAgICAgIHZhbHVlcy5wdXNoKHZhbHVlKTsKICAgICAgICB9CgogICAgICAgIGlmICgrK2xvb3BDb3VudCA+IExPT1BfTElNSVQpIHsKICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eTogbWF4aW11bSBsb29wIGNvdW50IGV4Y2VlZGVkIGZvciBcIiIuY29uY2F0KGtleSwgIlwiIikpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBkaWN0ID0gZGljdC5nZXQoIlBhcmVudCIpOwogICAgICB9CgogICAgICByZXR1cm4gdmFsdWVzOwogICAgfQoKICAgIHZhciBST01BTl9OVU1CRVJfTUFQID0gWyIiLCAiQyIsICJDQyIsICJDQ0MiLCAiQ0QiLCAiRCIsICJEQyIsICJEQ0MiLCAiRENDQyIsICJDTSIsICIiLCAiWCIsICJYWCIsICJYWFgiLCAiWEwiLCAiTCIsICJMWCIsICJMWFgiLCAiTFhYWCIsICJYQyIsICIiLCAiSSIsICJJSSIsICJJSUkiLCAiSVYiLCAiViIsICJWSSIsICJWSUkiLCAiVklJSSIsICJJWCJdOwoKICAgIGZ1bmN0aW9uIHRvUm9tYW5OdW1lcmFscyhudW1iZXIpIHsKICAgICAgdmFyIGxvd2VyQ2FzZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CiAgICAgICgwLCBfdXRpbC5hc3NlcnQpKE51bWJlci5pc0ludGVnZXIobnVtYmVyKSAmJiBudW1iZXIgPiAwLCAiVGhlIG51bWJlciBzaG91bGQgYmUgYSBwb3NpdGl2ZSBpbnRlZ2VyLiIpOwogICAgICB2YXIgcm9tYW5CdWYgPSBbXTsKICAgICAgdmFyIHBvczsKCiAgICAgIHdoaWxlIChudW1iZXIgPj0gMTAwMCkgewogICAgICAgIG51bWJlciAtPSAxMDAwOwogICAgICAgIHJvbWFuQnVmLnB1c2goIk0iKTsKICAgICAgfQoKICAgICAgcG9zID0gbnVtYmVyIC8gMTAwIHwgMDsKICAgICAgbnVtYmVyICU9IDEwMDsKICAgICAgcm9tYW5CdWYucHVzaChST01BTl9OVU1CRVJfTUFQW3Bvc10pOwogICAgICBwb3MgPSBudW1iZXIgLyAxMCB8IDA7CiAgICAgIG51bWJlciAlPSAxMDsKICAgICAgcm9tYW5CdWYucHVzaChST01BTl9OVU1CRVJfTUFQWzEwICsgcG9zXSk7CiAgICAgIHJvbWFuQnVmLnB1c2goUk9NQU5fTlVNQkVSX01BUFsyMCArIG51bWJlcl0pOwogICAgICB2YXIgcm9tYW5TdHIgPSByb21hbkJ1Zi5qb2luKCIiKTsKICAgICAgcmV0dXJuIGxvd2VyQ2FzZSA/IHJvbWFuU3RyLnRvTG93ZXJDYXNlKCkgOiByb21hblN0cjsKICAgIH0KCiAgICBmdW5jdGlvbiBsb2cyKHgpIHsKICAgICAgaWYgKHggPD0gMCkgewogICAgICAgIHJldHVybiAwOwogICAgICB9CgogICAgICByZXR1cm4gTWF0aC5jZWlsKE1hdGgubG9nMih4KSk7CiAgICB9CgogICAgZnVuY3Rpb24gcmVhZEludDgoZGF0YSwgb2Zmc2V0KSB7CiAgICAgIHJldHVybiBkYXRhW29mZnNldF0gPDwgMjQgPj4gMjQ7CiAgICB9CgogICAgZnVuY3Rpb24gcmVhZFVpbnQxNihkYXRhLCBvZmZzZXQpIHsKICAgICAgcmV0dXJuIGRhdGFbb2Zmc2V0XSA8PCA4IHwgZGF0YVtvZmZzZXQgKyAxXTsKICAgIH0KCiAgICBmdW5jdGlvbiByZWFkVWludDMyKGRhdGEsIG9mZnNldCkgewogICAgICByZXR1cm4gKGRhdGFbb2Zmc2V0XSA8PCAyNCB8IGRhdGFbb2Zmc2V0ICsgMV0gPDwgMTYgfCBkYXRhW29mZnNldCArIDJdIDw8IDggfCBkYXRhW29mZnNldCArIDNdKSA+Pj4gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBpc1doaXRlU3BhY2UoY2gpIHsKICAgICAgcmV0dXJuIGNoID09PSAweDIwIHx8IGNoID09PSAweDA5IHx8IGNoID09PSAweDBkIHx8IGNoID09PSAweDBhOwogICAgfQoKICAgIC8qKiovfSksICgKICAvKiAxOTggKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgoKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgICAgdmFsdWU6IHRydWUKICAgIH0pOwogICAgZXhwb3J0cy5QREZEb2N1bWVudCA9IGV4cG9ydHMuUGFnZSA9IHZvaWQgMDsKCiAgICB2YXIgX3JlZ2VuZXJhdG9yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfX3dfcGRmanNfcmVxdWlyZV9fKDIpKTsKCiAgICB2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUpOwoKICAgIHZhciBfb2JqID0gX193X3BkZmpzX3JlcXVpcmVfXygxOTkpOwoKICAgIHZhciBfcHJpbWl0aXZlcyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTk0KTsKCiAgICB2YXIgX2NvcmVfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE5Nyk7CgogICAgdmFyIF9zdHJlYW0yID0gX193X3BkZmpzX3JlcXVpcmVfXygyMDEpOwoKICAgIHZhciBfYW5ub3RhdGlvbiA9IF9fd19wZGZqc19yZXF1aXJlX18oMjEzKTsKCiAgICB2YXIgX2NyeXB0byA9IF9fd19wZGZqc19yZXF1aXJlX18oMjExKTsKCiAgICB2YXIgX3BhcnNlciA9IF9fd19wZGZqc19yZXF1aXJlX18oMjAwKTsKCiAgICB2YXIgX29wZXJhdG9yX2xpc3QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIxNCk7CgogICAgdmFyIF9ldmFsdWF0b3IgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIxNSk7CgogICAgdmFyIF9mdW5jdGlvbiA9IF9fd19wZGZqc19yZXF1aXJlX18oMjI5KTsKCiAgICBmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikge3JldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9O30KCiAgICBmdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7dHJ5IHt2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7dmFyIHZhbHVlID0gaW5mby52YWx1ZTt9IGNhdGNoIChlcnJvcikge3JlamVjdChlcnJvcik7cmV0dXJuO31pZiAoaW5mby5kb25lKSB7cmVzb2x2ZSh2YWx1ZSk7fSBlbHNlIHtQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oX25leHQsIF90aHJvdyk7fX0KCiAgICBmdW5jdGlvbiBfYXN5bmNUb0dlbmVyYXRvcihmbikge3JldHVybiBmdW5jdGlvbiAoKSB7dmFyIHNlbGYgPSB0aGlzLGFyZ3MgPSBhcmd1bWVudHM7cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHt2YXIgZ2VuID0gZm4uYXBwbHkoc2VsZiwgYXJncyk7ZnVuY3Rpb24gX25leHQodmFsdWUpIHthc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJuZXh0IiwgdmFsdWUpO31mdW5jdGlvbiBfdGhyb3coZXJyKSB7YXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAidGhyb3ciLCBlcnIpO31fbmV4dCh1bmRlZmluZWQpO30pO307fQoKICAgIGZ1bmN0aW9uIF9zbGljZWRUb0FycmF5KGFyciwgaSkge3JldHVybiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB8fCBfbm9uSXRlcmFibGVSZXN0KCk7fQoKICAgIGZ1bmN0aW9uIF9ub25JdGVyYWJsZVJlc3QoKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZSIpO30KCiAgICBmdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB7aWYgKCEoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChhcnIpIHx8IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChhcnIpID09PSAiW29iamVjdCBBcmd1bWVudHNdIikpIHtyZXR1cm47fXZhciBfYXJyID0gW107dmFyIF9uID0gdHJ1ZTt2YXIgX2QgPSBmYWxzZTt2YXIgX2UgPSB1bmRlZmluZWQ7dHJ5IHtmb3IgKHZhciBfaSA9IGFycltTeW1ib2wuaXRlcmF0b3JdKCksIF9zOyAhKF9uID0gKF9zID0gX2kubmV4dCgpKS5kb25lKTsgX24gPSB0cnVlKSB7X2Fyci5wdXNoKF9zLnZhbHVlKTtpZiAoaSAmJiBfYXJyLmxlbmd0aCA9PT0gaSkgYnJlYWs7fX0gY2F0Y2ggKGVycikge19kID0gdHJ1ZTtfZSA9IGVycjt9IGZpbmFsbHkge3RyeSB7aWYgKCFfbiAmJiBfaVsicmV0dXJuIl0gIT0gbnVsbCkgX2lbInJldHVybiJdKCk7fSBmaW5hbGx5IHtpZiAoX2QpIHRocm93IF9lO319cmV0dXJuIF9hcnI7fQoKICAgIGZ1bmN0aW9uIF9hcnJheVdpdGhIb2xlcyhhcnIpIHtpZiAoQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm4gYXJyO30KCiAgICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7aWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTt9fQoKICAgIGZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHtmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7dmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTtkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7ZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlO2lmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlO09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTt9fQoKICAgIGZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHtpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTtpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7cmV0dXJuIENvbnN0cnVjdG9yO30KCiAgICB2YXIgREVGQVVMVF9VU0VSX1VOSVQgPSAxLjA7CiAgICB2YXIgTEVUVEVSX1NJWkVfTUVESUFCT1ggPSBbMCwgMCwgNjEyLCA3OTJdOwoKICAgIGZ1bmN0aW9uIGlzQW5ub3RhdGlvblJlbmRlcmFibGUoYW5ub3RhdGlvbiwgaW50ZW50KSB7CiAgICAgIHJldHVybiBpbnRlbnQgPT09ICJkaXNwbGF5IiAmJiBhbm5vdGF0aW9uLnZpZXdhYmxlIHx8IGludGVudCA9PT0gInByaW50IiAmJiBhbm5vdGF0aW9uLnByaW50YWJsZTsKICAgIH0KCiAgICB2YXIgUGFnZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgIGZ1bmN0aW9uIFBhZ2UoX3JlZikgewogICAgICAgIHZhciBwZGZNYW5hZ2VyID0gX3JlZi5wZGZNYW5hZ2VyLAogICAgICAgICAgeHJlZiA9IF9yZWYueHJlZiwKICAgICAgICAgIHBhZ2VJbmRleCA9IF9yZWYucGFnZUluZGV4LAogICAgICAgICAgcGFnZURpY3QgPSBfcmVmLnBhZ2VEaWN0LAogICAgICAgICAgcmVmID0gX3JlZi5yZWYsCiAgICAgICAgICBmb250Q2FjaGUgPSBfcmVmLmZvbnRDYWNoZSwKICAgICAgICAgIGJ1aWx0SW5DTWFwQ2FjaGUgPSBfcmVmLmJ1aWx0SW5DTWFwQ2FjaGUsCiAgICAgICAgICBwZGZGdW5jdGlvbkZhY3RvcnkgPSBfcmVmLnBkZkZ1bmN0aW9uRmFjdG9yeTsKCiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFBhZ2UpOwoKICAgICAgICB0aGlzLnBkZk1hbmFnZXIgPSBwZGZNYW5hZ2VyOwogICAgICAgIHRoaXMucGFnZUluZGV4ID0gcGFnZUluZGV4OwogICAgICAgIHRoaXMucGFnZURpY3QgPSBwYWdlRGljdDsKICAgICAgICB0aGlzLnhyZWYgPSB4cmVmOwogICAgICAgIHRoaXMucmVmID0gcmVmOwogICAgICAgIHRoaXMuZm9udENhY2hlID0gZm9udENhY2hlOwogICAgICAgIHRoaXMuYnVpbHRJbkNNYXBDYWNoZSA9IGJ1aWx0SW5DTWFwQ2FjaGU7CiAgICAgICAgdGhpcy5wZGZGdW5jdGlvbkZhY3RvcnkgPSBwZGZGdW5jdGlvbkZhY3Rvcnk7CiAgICAgICAgdGhpcy5ldmFsdWF0b3JPcHRpb25zID0gcGRmTWFuYWdlci5ldmFsdWF0b3JPcHRpb25zOwogICAgICAgIHRoaXMucmVzb3VyY2VzUHJvbWlzZSA9IG51bGw7CiAgICAgICAgdmFyIGlkQ291bnRlcnMgPSB7CiAgICAgICAgICBvYmo6IDAKICAgICAgICB9OwogICAgICAgIHRoaXMuaWRGYWN0b3J5ID0gewogICAgICAgICAgY3JlYXRlT2JqSWQ6IGZ1bmN0aW9uIGNyZWF0ZU9iaklkKCkgewogICAgICAgICAgICByZXR1cm4gInAiLmNvbmNhdChwYWdlSW5kZXgsICJfIikuY29uY2F0KCsraWRDb3VudGVycy5vYmopOwogICAgICAgICAgfSwKICAgICAgICAgIGdldERvY0lkOiBmdW5jdGlvbiBnZXREb2NJZCgpIHsKICAgICAgICAgICAgcmV0dXJuICJnXyIuY29uY2F0KHBkZk1hbmFnZXIuZG9jSWQpOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhQYWdlLCBbewogICAgICAgIGtleTogIl9nZXRJbmhlcml0YWJsZVByb3BlcnR5IiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX2dldEluaGVyaXRhYmxlUHJvcGVydHkoa2V5KSB7CiAgICAgICAgICB2YXIgZ2V0QXJyYXkgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwogICAgICAgICAgdmFyIHZhbHVlID0gKDAsIF9jb3JlX3V0aWxzLmdldEluaGVyaXRhYmxlUHJvcGVydHkpKHsKICAgICAgICAgICAgZGljdDogdGhpcy5wYWdlRGljdCwKICAgICAgICAgICAga2V5OiBrZXksCiAgICAgICAgICAgIGdldEFycmF5OiBnZXRBcnJheSwKICAgICAgICAgICAgc3RvcFdoZW5Gb3VuZDogZmFsc2UKICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDEgfHwgISgwLCBfcHJpbWl0aXZlcy5pc0RpY3QpKHZhbHVlWzBdKSkgewogICAgICAgICAgICByZXR1cm4gdmFsdWVbMF07CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIF9wcmltaXRpdmVzLkRpY3QubWVyZ2UodGhpcy54cmVmLCB2YWx1ZSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiX2dldEJvdW5kaW5nQm94IiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX2dldEJvdW5kaW5nQm94KG5hbWUpIHsKICAgICAgICAgIHZhciBib3ggPSB0aGlzLl9nZXRJbmhlcml0YWJsZVByb3BlcnR5KG5hbWUsIHRydWUpOwoKICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGJveCkgJiYgYm94Lmxlbmd0aCA9PT0gNCkgewogICAgICAgICAgICBpZiAoYm94WzJdIC0gYm94WzBdICE9PSAwICYmIGJveFszXSAtIGJveFsxXSAhPT0gMCkgewogICAgICAgICAgICAgIHJldHVybiBib3g7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiRW1wdHkgLyIuY29uY2F0KG5hbWUsICIgZW50cnkuIikpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImdldENvbnRlbnRTdHJlYW0iLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRDb250ZW50U3RyZWFtKCkgewogICAgICAgICAgdmFyIGNvbnRlbnQgPSB0aGlzLmNvbnRlbnQ7CiAgICAgICAgICB2YXIgc3RyZWFtOwoKICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGNvbnRlbnQpKSB7CiAgICAgICAgICAgIHZhciB4cmVmID0gdGhpcy54cmVmOwogICAgICAgICAgICB2YXIgc3RyZWFtcyA9IFtdOwogICAgICAgICAgICB2YXIgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IHRydWU7CiAgICAgICAgICAgIHZhciBfZGlkSXRlcmF0b3JFcnJvciA9IGZhbHNlOwogICAgICAgICAgICB2YXIgX2l0ZXJhdG9yRXJyb3IgPSB1bmRlZmluZWQ7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGZvciAodmFyIF9pdGVyYXRvciA9IGNvbnRlbnRbU3ltYm9sLml0ZXJhdG9yXSgpLCBfc3RlcDsgIShfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gKF9zdGVwID0gX2l0ZXJhdG9yLm5leHQoKSkuZG9uZSk7IF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSB0cnVlKSB7CiAgICAgICAgICAgICAgICB2YXIgX3N0cmVhbSA9IF9zdGVwLnZhbHVlOwogICAgICAgICAgICAgICAgc3RyZWFtcy5wdXNoKHhyZWYuZmV0Y2hJZlJlZihfc3RyZWFtKSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvciA9IHRydWU7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yRXJyb3IgPSBlcnI7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICghX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiAmJiBfaXRlcmF0b3JbInJldHVybiJdICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yWyJyZXR1cm4iXSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBpZiAoX2RpZEl0ZXJhdG9yRXJyb3IpIHsKICAgICAgICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3I7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBzdHJlYW0gPSBuZXcgX3N0cmVhbTIuU3RyZWFtc1NlcXVlbmNlU3RyZWFtKHN0cmVhbXMpOwogICAgICAgICAgfSBlbHNlIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNTdHJlYW0pKGNvbnRlbnQpKSB7CiAgICAgICAgICAgIHN0cmVhbSA9IGNvbnRlbnQ7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdHJlYW0gPSBuZXcgX3N0cmVhbTIuTnVsbFN0cmVhbSgpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBzdHJlYW07CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAibG9hZFJlc291cmNlcyIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGxvYWRSZXNvdXJjZXMoa2V5cykgewogICAgICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgICAgICBpZiAoIXRoaXMucmVzb3VyY2VzUHJvbWlzZSkgewogICAgICAgICAgICB0aGlzLnJlc291cmNlc1Byb21pc2UgPSB0aGlzLnBkZk1hbmFnZXIuZW5zdXJlKHRoaXMsICJyZXNvdXJjZXMiKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gdGhpcy5yZXNvdXJjZXNQcm9taXNlLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgb2JqZWN0TG9hZGVyID0gbmV3IF9vYmouT2JqZWN0TG9hZGVyKF90aGlzLnJlc291cmNlcywga2V5cywgX3RoaXMueHJlZik7CiAgICAgICAgICAgIHJldHVybiBvYmplY3RMb2FkZXIubG9hZCgpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0T3BlcmF0b3JMaXN0IiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0T3BlcmF0b3JMaXN0KF9yZWYyKSB7CiAgICAgICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgICAgICB2YXIgaGFuZGxlciA9IF9yZWYyLmhhbmRsZXIsCiAgICAgICAgICAgIHNpbmsgPSBfcmVmMi5zaW5rLAogICAgICAgICAgICB0YXNrID0gX3JlZjIudGFzaywKICAgICAgICAgICAgaW50ZW50ID0gX3JlZjIuaW50ZW50LAogICAgICAgICAgICByZW5kZXJJbnRlcmFjdGl2ZUZvcm1zID0gX3JlZjIucmVuZGVySW50ZXJhY3RpdmVGb3JtczsKICAgICAgICAgIHZhciBjb250ZW50U3RyZWFtUHJvbWlzZSA9IHRoaXMucGRmTWFuYWdlci5lbnN1cmUodGhpcywgImdldENvbnRlbnRTdHJlYW0iKTsKICAgICAgICAgIHZhciByZXNvdXJjZXNQcm9taXNlID0gdGhpcy5sb2FkUmVzb3VyY2VzKFsiRXh0R1N0YXRlIiwgIkNvbG9yU3BhY2UiLCAiUGF0dGVybiIsICJTaGFkaW5nIiwgIlhPYmplY3QiLCAiRm9udCJdKTsKICAgICAgICAgIHZhciBwYXJ0aWFsRXZhbHVhdG9yID0gbmV3IF9ldmFsdWF0b3IuUGFydGlhbEV2YWx1YXRvcih7CiAgICAgICAgICAgIHhyZWY6IHRoaXMueHJlZiwKICAgICAgICAgICAgaGFuZGxlcjogaGFuZGxlciwKICAgICAgICAgICAgcGFnZUluZGV4OiB0aGlzLnBhZ2VJbmRleCwKICAgICAgICAgICAgaWRGYWN0b3J5OiB0aGlzLmlkRmFjdG9yeSwKICAgICAgICAgICAgZm9udENhY2hlOiB0aGlzLmZvbnRDYWNoZSwKICAgICAgICAgICAgYnVpbHRJbkNNYXBDYWNoZTogdGhpcy5idWlsdEluQ01hcENhY2hlLAogICAgICAgICAgICBvcHRpb25zOiB0aGlzLmV2YWx1YXRvck9wdGlvbnMsCiAgICAgICAgICAgIHBkZkZ1bmN0aW9uRmFjdG9yeTogdGhpcy5wZGZGdW5jdGlvbkZhY3RvcnkKICAgICAgICAgIH0pOwogICAgICAgICAgdmFyIGRhdGFQcm9taXNlcyA9IFByb21pc2UuYWxsKFtjb250ZW50U3RyZWFtUHJvbWlzZSwgcmVzb3VyY2VzUHJvbWlzZV0pOwogICAgICAgICAgdmFyIHBhZ2VMaXN0UHJvbWlzZSA9IGRhdGFQcm9taXNlcy50aGVuKGZ1bmN0aW9uIChfcmVmMykgewogICAgICAgICAgICB2YXIgX3JlZjQgPSBfc2xpY2VkVG9BcnJheShfcmVmMywgMSksCiAgICAgICAgICAgICAgY29udGVudFN0cmVhbSA9IF9yZWY0WzBdOwoKICAgICAgICAgICAgdmFyIG9wTGlzdCA9IG5ldyBfb3BlcmF0b3JfbGlzdC5PcGVyYXRvckxpc3QoaW50ZW50LCBzaW5rLCBfdGhpczIucGFnZUluZGV4KTsKICAgICAgICAgICAgaGFuZGxlci5zZW5kKCJTdGFydFJlbmRlclBhZ2UiLCB7CiAgICAgICAgICAgICAgdHJhbnNwYXJlbmN5OiBwYXJ0aWFsRXZhbHVhdG9yLmhhc0JsZW5kTW9kZXMoX3RoaXMyLnJlc291cmNlcyksCiAgICAgICAgICAgICAgcGFnZUluZGV4OiBfdGhpczIucGFnZUluZGV4LAogICAgICAgICAgICAgIGludGVudDogaW50ZW50CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gcGFydGlhbEV2YWx1YXRvci5nZXRPcGVyYXRvckxpc3QoewogICAgICAgICAgICAgIHN0cmVhbTogY29udGVudFN0cmVhbSwKICAgICAgICAgICAgICB0YXNrOiB0YXNrLAogICAgICAgICAgICAgIHJlc291cmNlczogX3RoaXMyLnJlc291cmNlcywKICAgICAgICAgICAgICBvcGVyYXRvckxpc3Q6IG9wTGlzdAogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4gb3BMaXN0OwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKFtwYWdlTGlzdFByb21pc2UsIHRoaXMuX3BhcnNlZEFubm90YXRpb25zXSkudGhlbihmdW5jdGlvbiAoX3JlZjUpIHsKICAgICAgICAgICAgdmFyIF9yZWY2ID0gX3NsaWNlZFRvQXJyYXkoX3JlZjUsIDIpLAogICAgICAgICAgICAgIHBhZ2VPcExpc3QgPSBfcmVmNlswXSwKICAgICAgICAgICAgICBhbm5vdGF0aW9ucyA9IF9yZWY2WzFdOwoKICAgICAgICAgICAgaWYgKGFubm90YXRpb25zLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgIHBhZ2VPcExpc3QuZmx1c2godHJ1ZSk7CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGxlbmd0aDogcGFnZU9wTGlzdC50b3RhbExlbmd0aAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBvcExpc3RQcm9taXNlcyA9IFtdOwogICAgICAgICAgICB2YXIgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIgPSB0cnVlOwogICAgICAgICAgICB2YXIgX2RpZEl0ZXJhdG9yRXJyb3IyID0gZmFsc2U7CiAgICAgICAgICAgIHZhciBfaXRlcmF0b3JFcnJvcjIgPSB1bmRlZmluZWQ7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGZvciAodmFyIF9pdGVyYXRvcjIgPSBhbm5vdGF0aW9uc1tTeW1ib2wuaXRlcmF0b3JdKCksIF9zdGVwMjsgIShfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiA9IChfc3RlcDIgPSBfaXRlcmF0b3IyLm5leHQoKSkuZG9uZSk7IF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yID0gdHJ1ZSkgewogICAgICAgICAgICAgICAgdmFyIGFubm90YXRpb24gPSBfc3RlcDIudmFsdWU7CgogICAgICAgICAgICAgICAgaWYgKGlzQW5ub3RhdGlvblJlbmRlcmFibGUoYW5ub3RhdGlvbiwgaW50ZW50KSkgewogICAgICAgICAgICAgICAgICBvcExpc3RQcm9taXNlcy5wdXNoKGFubm90YXRpb24uZ2V0T3BlcmF0b3JMaXN0KHBhcnRpYWxFdmFsdWF0b3IsIHRhc2ssIHJlbmRlckludGVyYWN0aXZlRm9ybXMpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgIF9kaWRJdGVyYXRvckVycm9yMiA9IHRydWU7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yRXJyb3IyID0gZXJyOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yICYmIF9pdGVyYXRvcjJbInJldHVybiJdICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yMlsicmV0dXJuIl0oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgaWYgKF9kaWRJdGVyYXRvckVycm9yMikgewogICAgICAgICAgICAgICAgICB0aHJvdyBfaXRlcmF0b3JFcnJvcjI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwob3BMaXN0UHJvbWlzZXMpLnRoZW4oZnVuY3Rpb24gKG9wTGlzdHMpIHsKICAgICAgICAgICAgICBwYWdlT3BMaXN0LmFkZE9wKF91dGlsLk9QUy5iZWdpbkFubm90YXRpb25zLCBbXSk7CiAgICAgICAgICAgICAgdmFyIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24zID0gdHJ1ZTsKICAgICAgICAgICAgICB2YXIgX2RpZEl0ZXJhdG9yRXJyb3IzID0gZmFsc2U7CiAgICAgICAgICAgICAgdmFyIF9pdGVyYXRvckVycm9yMyA9IHVuZGVmaW5lZDsKCiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGZvciAodmFyIF9pdGVyYXRvcjMgPSBvcExpc3RzW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3N0ZXAzOyAhKF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24zID0gKF9zdGVwMyA9IF9pdGVyYXRvcjMubmV4dCgpKS5kb25lKTsgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjMgPSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgIHZhciBvcExpc3QgPSBfc3RlcDMudmFsdWU7CiAgICAgICAgICAgICAgICAgIHBhZ2VPcExpc3QuYWRkT3BMaXN0KG9wTGlzdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvcjMgPSB0cnVlOwogICAgICAgICAgICAgICAgX2l0ZXJhdG9yRXJyb3IzID0gZXJyOwogICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24zICYmIF9pdGVyYXRvcjNbInJldHVybiJdICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBfaXRlcmF0b3IzWyJyZXR1cm4iXSgpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICBpZiAoX2RpZEl0ZXJhdG9yRXJyb3IzKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3IzOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBwYWdlT3BMaXN0LmFkZE9wKF91dGlsLk9QUy5lbmRBbm5vdGF0aW9ucywgW10pOwogICAgICAgICAgICAgIHBhZ2VPcExpc3QuZmx1c2godHJ1ZSk7CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGxlbmd0aDogcGFnZU9wTGlzdC50b3RhbExlbmd0aAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZXh0cmFjdFRleHRDb250ZW50IiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZXh0cmFjdFRleHRDb250ZW50KF9yZWY3KSB7CiAgICAgICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgICAgICB2YXIgaGFuZGxlciA9IF9yZWY3LmhhbmRsZXIsCiAgICAgICAgICAgIHRhc2sgPSBfcmVmNy50YXNrLAogICAgICAgICAgICBub3JtYWxpemVXaGl0ZXNwYWNlID0gX3JlZjcubm9ybWFsaXplV2hpdGVzcGFjZSwKICAgICAgICAgICAgc2luayA9IF9yZWY3LnNpbmssCiAgICAgICAgICAgIGNvbWJpbmVUZXh0SXRlbXMgPSBfcmVmNy5jb21iaW5lVGV4dEl0ZW1zOwogICAgICAgICAgdmFyIGNvbnRlbnRTdHJlYW1Qcm9taXNlID0gdGhpcy5wZGZNYW5hZ2VyLmVuc3VyZSh0aGlzLCAiZ2V0Q29udGVudFN0cmVhbSIpOwogICAgICAgICAgdmFyIHJlc291cmNlc1Byb21pc2UgPSB0aGlzLmxvYWRSZXNvdXJjZXMoWyJFeHRHU3RhdGUiLCAiWE9iamVjdCIsICJGb250Il0pOwogICAgICAgICAgdmFyIGRhdGFQcm9taXNlcyA9IFByb21pc2UuYWxsKFtjb250ZW50U3RyZWFtUHJvbWlzZSwgcmVzb3VyY2VzUHJvbWlzZV0pOwogICAgICAgICAgcmV0dXJuIGRhdGFQcm9taXNlcy50aGVuKGZ1bmN0aW9uIChfcmVmOCkgewogICAgICAgICAgICB2YXIgX3JlZjkgPSBfc2xpY2VkVG9BcnJheShfcmVmOCwgMSksCiAgICAgICAgICAgICAgY29udGVudFN0cmVhbSA9IF9yZWY5WzBdOwoKICAgICAgICAgICAgdmFyIHBhcnRpYWxFdmFsdWF0b3IgPSBuZXcgX2V2YWx1YXRvci5QYXJ0aWFsRXZhbHVhdG9yKHsKICAgICAgICAgICAgICB4cmVmOiBfdGhpczMueHJlZiwKICAgICAgICAgICAgICBoYW5kbGVyOiBoYW5kbGVyLAogICAgICAgICAgICAgIHBhZ2VJbmRleDogX3RoaXMzLnBhZ2VJbmRleCwKICAgICAgICAgICAgICBpZEZhY3Rvcnk6IF90aGlzMy5pZEZhY3RvcnksCiAgICAgICAgICAgICAgZm9udENhY2hlOiBfdGhpczMuZm9udENhY2hlLAogICAgICAgICAgICAgIGJ1aWx0SW5DTWFwQ2FjaGU6IF90aGlzMy5idWlsdEluQ01hcENhY2hlLAogICAgICAgICAgICAgIG9wdGlvbnM6IF90aGlzMy5ldmFsdWF0b3JPcHRpb25zLAogICAgICAgICAgICAgIHBkZkZ1bmN0aW9uRmFjdG9yeTogX3RoaXMzLnBkZkZ1bmN0aW9uRmFjdG9yeQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIHBhcnRpYWxFdmFsdWF0b3IuZ2V0VGV4dENvbnRlbnQoewogICAgICAgICAgICAgIHN0cmVhbTogY29udGVudFN0cmVhbSwKICAgICAgICAgICAgICB0YXNrOiB0YXNrLAogICAgICAgICAgICAgIHJlc291cmNlczogX3RoaXMzLnJlc291cmNlcywKICAgICAgICAgICAgICBub3JtYWxpemVXaGl0ZXNwYWNlOiBub3JtYWxpemVXaGl0ZXNwYWNlLAogICAgICAgICAgICAgIGNvbWJpbmVUZXh0SXRlbXM6IGNvbWJpbmVUZXh0SXRlbXMsCiAgICAgICAgICAgICAgc2luazogc2luawogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImdldEFubm90YXRpb25zRGF0YSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldEFubm90YXRpb25zRGF0YShpbnRlbnQpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9wYXJzZWRBbm5vdGF0aW9ucy50aGVuKGZ1bmN0aW9uIChhbm5vdGF0aW9ucykgewogICAgICAgICAgICB2YXIgYW5ub3RhdGlvbnNEYXRhID0gW107CgogICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBhbm5vdGF0aW9ucy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgICAgaWYgKCFpbnRlbnQgfHwgaXNBbm5vdGF0aW9uUmVuZGVyYWJsZShhbm5vdGF0aW9uc1tpXSwgaW50ZW50KSkgewogICAgICAgICAgICAgICAgYW5ub3RhdGlvbnNEYXRhLnB1c2goYW5ub3RhdGlvbnNbaV0uZGF0YSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gYW5ub3RhdGlvbnNEYXRhOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiY29udGVudCIsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5wYWdlRGljdC5nZXQoIkNvbnRlbnRzIik7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAicmVzb3VyY2VzIiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAicmVzb3VyY2VzIiwgdGhpcy5fZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eSgiUmVzb3VyY2VzIikgfHwgX3ByaW1pdGl2ZXMuRGljdC5lbXB0eSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAibWVkaWFCb3giLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJtZWRpYUJveCIsIHRoaXMuX2dldEJvdW5kaW5nQm94KCJNZWRpYUJveCIpIHx8IExFVFRFUl9TSVpFX01FRElBQk9YKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJjcm9wQm94IiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAiY3JvcEJveCIsIHRoaXMuX2dldEJvdW5kaW5nQm94KCJDcm9wQm94IikgfHwgdGhpcy5tZWRpYUJveCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAidXNlclVuaXQiLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgdmFyIG9iaiA9IHRoaXMucGFnZURpY3QuZ2V0KCJVc2VyVW5pdCIpOwoKICAgICAgICAgIGlmICghKDAsIF91dGlsLmlzTnVtKShvYmopIHx8IG9iaiA8PSAwKSB7CiAgICAgICAgICAgIG9iaiA9IERFRkFVTFRfVVNFUl9VTklUOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAidXNlclVuaXQiLCBvYmopOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInZpZXciLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgdmFyIGNyb3BCb3ggPSB0aGlzLmNyb3BCb3gsCiAgICAgICAgICAgIG1lZGlhQm94ID0gdGhpcy5tZWRpYUJveDsKICAgICAgICAgIHZhciB2aWV3OwoKICAgICAgICAgIGlmIChjcm9wQm94ID09PSBtZWRpYUJveCB8fCAoMCwgX3V0aWwuaXNBcnJheUVxdWFsKShjcm9wQm94LCBtZWRpYUJveCkpIHsKICAgICAgICAgICAgdmlldyA9IG1lZGlhQm94OwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIGJveCA9IF91dGlsLlV0aWwuaW50ZXJzZWN0KGNyb3BCb3gsIG1lZGlhQm94KTsKCiAgICAgICAgICAgIGlmIChib3ggJiYgYm94WzJdIC0gYm94WzBdICE9PSAwICYmIGJveFszXSAtIGJveFsxXSAhPT0gMCkgewogICAgICAgICAgICAgIHZpZXcgPSBib3g7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJFbXB0eSAvQ3JvcEJveCBhbmQgL01lZGlhQm94IGludGVyc2VjdGlvbi4iKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAidmlldyIsIHZpZXcgfHwgbWVkaWFCb3gpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInJvdGF0ZSIsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICB2YXIgcm90YXRlID0gdGhpcy5fZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eSgiUm90YXRlIikgfHwgMDsKCiAgICAgICAgICBpZiAocm90YXRlICUgOTAgIT09IDApIHsKICAgICAgICAgICAgcm90YXRlID0gMDsKICAgICAgICAgIH0gZWxzZSBpZiAocm90YXRlID49IDM2MCkgewogICAgICAgICAgICByb3RhdGUgPSByb3RhdGUgJSAzNjA7CiAgICAgICAgICB9IGVsc2UgaWYgKHJvdGF0ZSA8IDApIHsKICAgICAgICAgICAgcm90YXRlID0gKHJvdGF0ZSAlIDM2MCArIDM2MCkgJSAzNjA7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJyb3RhdGUiLCByb3RhdGUpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImFubm90YXRpb25zIiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAiYW5ub3RhdGlvbnMiLCB0aGlzLl9nZXRJbmhlcml0YWJsZVByb3BlcnR5KCJBbm5vdHMiKSB8fCBbXSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiX3BhcnNlZEFubm90YXRpb25zIiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgICAgIHZhciBwYXJzZWRBbm5vdGF0aW9ucyA9IHRoaXMucGRmTWFuYWdlci5lbnN1cmUodGhpcywgImFubm90YXRpb25zIikudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBhbm5vdGF0aW9uUmVmcyA9IF90aGlzNC5hbm5vdGF0aW9uczsKICAgICAgICAgICAgdmFyIGFubm90YXRpb25Qcm9taXNlcyA9IFtdOwoKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gYW5ub3RhdGlvblJlZnMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICAgIGFubm90YXRpb25Qcm9taXNlcy5wdXNoKF9hbm5vdGF0aW9uLkFubm90YXRpb25GYWN0b3J5LmNyZWF0ZShfdGhpczQueHJlZiwgYW5ub3RhdGlvblJlZnNbaV0sIF90aGlzNC5wZGZNYW5hZ2VyLCBfdGhpczQuaWRGYWN0b3J5KSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLmFsbChhbm5vdGF0aW9uUHJvbWlzZXMpLnRoZW4oZnVuY3Rpb24gKGFubm90YXRpb25zKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGFubm90YXRpb25zLmZpbHRlcihmdW5jdGlvbiBpc0RlZmluZWQoYW5ub3RhdGlvbikgewogICAgICAgICAgICAgICAgcmV0dXJuICEhYW5ub3RhdGlvbjsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiX3BhcnNlZEFubm90YXRpb25zOiBcIiIuY29uY2F0KHJlYXNvbiwgIlwiLiIpKTsKICAgICAgICAgICAgICByZXR1cm4gW107CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgIl9wYXJzZWRBbm5vdGF0aW9ucyIsIHBhcnNlZEFubm90YXRpb25zKTsKICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBQYWdlOwogICAgfSgpOwoKICAgIGV4cG9ydHMuUGFnZSA9IFBhZ2U7CiAgICB2YXIgUERGX0hFQURFUl9TSUdOQVRVUkUgPSBuZXcgVWludDhBcnJheShbMHgyNSwgMHg1MCwgMHg0NCwgMHg0NiwgMHgyZF0pOwogICAgdmFyIFNUQVJUWFJFRl9TSUdOQVRVUkUgPSBuZXcgVWludDhBcnJheShbMHg3MywgMHg3NCwgMHg2MSwgMHg3MiwgMHg3NCwgMHg3OCwgMHg3MiwgMHg2NSwgMHg2Nl0pOwogICAgdmFyIEVORE9CSl9TSUdOQVRVUkUgPSBuZXcgVWludDhBcnJheShbMHg2NSwgMHg2ZSwgMHg2NCwgMHg2ZiwgMHg2MiwgMHg2YV0pOwogICAgdmFyIEZJTkdFUlBSSU5UX0ZJUlNUX0JZVEVTID0gMTAyNDsKICAgIHZhciBFTVBUWV9GSU5HRVJQUklOVCA9ICJceDAwXHgwMFx4MDBceDAwXHgwMFx4MDBceDAwXHgwMFx4MDBceDAwXHgwMFx4MDBceDAwXHgwMFx4MDBceDAwIjsKICAgIHZhciBQREZfSEVBREVSX1ZFUlNJT05fUkVHRVhQID0gL15bMS05XVwuWzAtOV0kLzsKCiAgICBmdW5jdGlvbiBmaW5kKHN0cmVhbSwgc2lnbmF0dXJlKSB7CiAgICAgIHZhciBsaW1pdCA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogMTAyNDsKICAgICAgdmFyIGJhY2t3YXJkcyA9IGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzNdIDogZmFsc2U7CiAgICAgIHZhciBzaWduYXR1cmVMZW5ndGggPSBzaWduYXR1cmUubGVuZ3RoOwogICAgICB2YXIgc2NhbkJ5dGVzID0gc3RyZWFtLnBlZWtCeXRlcyhsaW1pdCk7CiAgICAgIHZhciBzY2FuTGVuZ3RoID0gc2NhbkJ5dGVzLmxlbmd0aCAtIHNpZ25hdHVyZUxlbmd0aDsKCiAgICAgIGlmIChzY2FuTGVuZ3RoIDw9IDApIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIGlmIChiYWNrd2FyZHMpIHsKICAgICAgICB2YXIgc2lnbmF0dXJlRW5kID0gc2lnbmF0dXJlTGVuZ3RoIC0gMTsKICAgICAgICB2YXIgcG9zID0gc2NhbkJ5dGVzLmxlbmd0aCAtIDE7CgogICAgICAgIHdoaWxlIChwb3MgPj0gc2lnbmF0dXJlRW5kKSB7CiAgICAgICAgICB2YXIgaiA9IDA7CgogICAgICAgICAgd2hpbGUgKGogPCBzaWduYXR1cmVMZW5ndGggJiYgc2NhbkJ5dGVzW3BvcyAtIGpdID09PSBzaWduYXR1cmVbc2lnbmF0dXJlRW5kIC0gal0pIHsKICAgICAgICAgICAgaisrOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChqID49IHNpZ25hdHVyZUxlbmd0aCkgewogICAgICAgICAgICBzdHJlYW0ucG9zICs9IHBvcyAtIHNpZ25hdHVyZUVuZDsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgcG9zLS07CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHZhciBfcG9zID0gMDsKCiAgICAgICAgd2hpbGUgKF9wb3MgPD0gc2Nhbkxlbmd0aCkgewogICAgICAgICAgdmFyIF9qID0gMDsKCiAgICAgICAgICB3aGlsZSAoX2ogPCBzaWduYXR1cmVMZW5ndGggJiYgc2NhbkJ5dGVzW19wb3MgKyBfal0gPT09IHNpZ25hdHVyZVtfal0pIHsKICAgICAgICAgICAgX2orKzsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoX2ogPj0gc2lnbmF0dXJlTGVuZ3RoKSB7CiAgICAgICAgICAgIHN0cmVhbS5wb3MgKz0gX3BvczsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgX3BvcysrOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHZhciBQREZEb2N1bWVudCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgIGZ1bmN0aW9uIFBERkRvY3VtZW50KHBkZk1hbmFnZXIsIGFyZykgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBQREZEb2N1bWVudCk7CgogICAgICAgIHZhciBzdHJlYW07CgogICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNTdHJlYW0pKGFyZykpIHsKICAgICAgICAgIHN0cmVhbSA9IGFyZzsKICAgICAgICB9IGVsc2UgaWYgKCgwLCBfdXRpbC5pc0FycmF5QnVmZmVyKShhcmcpKSB7CiAgICAgICAgICBzdHJlYW0gPSBuZXcgX3N0cmVhbTIuU3RyZWFtKGFyZyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiUERGRG9jdW1lbnQ6IFVua25vd24gYXJndW1lbnQgdHlwZSIpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHN0cmVhbS5sZW5ndGggPD0gMCkgewogICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkludmFsaWRQREZFeGNlcHRpb24oIlRoZSBQREYgZmlsZSBpcyBlbXB0eSwgaS5lLiBpdHMgc2l6ZSBpcyB6ZXJvIGJ5dGVzLiIpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5wZGZNYW5hZ2VyID0gcGRmTWFuYWdlcjsKICAgICAgICB0aGlzLnN0cmVhbSA9IHN0cmVhbTsKICAgICAgICB0aGlzLnhyZWYgPSBuZXcgX29iai5YUmVmKHN0cmVhbSwgcGRmTWFuYWdlcik7CiAgICAgICAgdGhpcy5wZGZGdW5jdGlvbkZhY3RvcnkgPSBuZXcgX2Z1bmN0aW9uLlBERkZ1bmN0aW9uRmFjdG9yeSh7CiAgICAgICAgICB4cmVmOiB0aGlzLnhyZWYsCiAgICAgICAgICBpc0V2YWxTdXBwb3J0ZWQ6IHBkZk1hbmFnZXIuZXZhbHVhdG9yT3B0aW9ucy5pc0V2YWxTdXBwb3J0ZWQKICAgICAgICB9KTsKICAgICAgICB0aGlzLl9wYWdlUHJvbWlzZXMgPSBbXTsKICAgICAgfQoKICAgICAgX2NyZWF0ZUNsYXNzKFBERkRvY3VtZW50LCBbewogICAgICAgIGtleTogInBhcnNlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcGFyc2UocmVjb3ZlcnlNb2RlKSB7CiAgICAgICAgICB0aGlzLnNldHVwKHJlY292ZXJ5TW9kZSk7CiAgICAgICAgICB2YXIgdmVyc2lvbiA9IHRoaXMuY2F0YWxvZy5jYXREaWN0LmdldCgiVmVyc2lvbiIpOwoKICAgICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNOYW1lKSh2ZXJzaW9uKSkgewogICAgICAgICAgICB0aGlzLnBkZkZvcm1hdFZlcnNpb24gPSB2ZXJzaW9uLm5hbWU7CiAgICAgICAgICB9CgogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdGhpcy5hY3JvRm9ybSA9IHRoaXMuY2F0YWxvZy5jYXREaWN0LmdldCgiQWNyb0Zvcm0iKTsKCiAgICAgICAgICAgIGlmICh0aGlzLmFjcm9Gb3JtKSB7CiAgICAgICAgICAgICAgdGhpcy54ZmEgPSB0aGlzLmFjcm9Gb3JtLmdldCgiWEZBIik7CiAgICAgICAgICAgICAgdmFyIGZpZWxkcyA9IHRoaXMuYWNyb0Zvcm0uZ2V0KCJGaWVsZHMiKTsKCiAgICAgICAgICAgICAgaWYgKCghQXJyYXkuaXNBcnJheShmaWVsZHMpIHx8IGZpZWxkcy5sZW5ndGggPT09IDApICYmICF0aGlzLnhmYSkgewogICAgICAgICAgICAgICAgdGhpcy5hY3JvRm9ybSA9IG51bGw7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgICBpZiAoZXggaW5zdGFuY2VvZiBfY29yZV91dGlscy5NaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgICAgICAgIHRocm93IGV4OwogICAgICAgICAgICB9CgogICAgICAgICAgICAoMCwgX3V0aWwuaW5mbykoIkNhbm5vdCBmZXRjaCBBY3JvRm9ybSBlbnRyeTsgYXNzdW1pbmcgbm8gQWNyb0Zvcm1zIGFyZSBwcmVzZW50Iik7CiAgICAgICAgICAgIHRoaXMuYWNyb0Zvcm0gPSBudWxsOwogICAgICAgICAgfQoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHZhciBjb2xsZWN0aW9uID0gdGhpcy5jYXRhbG9nLmNhdERpY3QuZ2V0KCJDb2xsZWN0aW9uIik7CgogICAgICAgICAgICBpZiAoKDAsIF9wcmltaXRpdmVzLmlzRGljdCkoY29sbGVjdGlvbikgJiYgY29sbGVjdGlvbi5nZXRLZXlzKCkubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIHRoaXMuY29sbGVjdGlvbiA9IGNvbGxlY3Rpb247CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgICAgIGlmIChleCBpbnN0YW5jZW9mIF9jb3JlX3V0aWxzLk1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgdGhyb3cgZXg7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICgwLCBfdXRpbC5pbmZvKSgiQ2Fubm90IGZldGNoIENvbGxlY3Rpb24gZGljdGlvbmFyeS4iKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJjaGVja0hlYWRlciIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNoZWNrSGVhZGVyKCkgewogICAgICAgICAgdmFyIHN0cmVhbSA9IHRoaXMuc3RyZWFtOwogICAgICAgICAgc3RyZWFtLnJlc2V0KCk7CgogICAgICAgICAgaWYgKCFmaW5kKHN0cmVhbSwgUERGX0hFQURFUl9TSUdOQVRVUkUpKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBzdHJlYW0ubW92ZVN0YXJ0KCk7CiAgICAgICAgICB2YXIgTUFYX1BERl9WRVJTSU9OX0xFTkdUSCA9IDEyOwogICAgICAgICAgdmFyIHZlcnNpb24gPSAiIiwKICAgICAgICAgICAgY2g7CgogICAgICAgICAgd2hpbGUgKChjaCA9IHN0cmVhbS5nZXRCeXRlKCkpID4gMHgyMCkgewogICAgICAgICAgICBpZiAodmVyc2lvbi5sZW5ndGggPj0gTUFYX1BERl9WRVJTSU9OX0xFTkdUSCkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2ZXJzaW9uICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghdGhpcy5wZGZGb3JtYXRWZXJzaW9uKSB7CiAgICAgICAgICAgIHRoaXMucGRmRm9ybWF0VmVyc2lvbiA9IHZlcnNpb24uc3Vic3RyaW5nKDUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInBhcnNlU3RhcnRYUmVmIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcGFyc2VTdGFydFhSZWYoKSB7CiAgICAgICAgICB0aGlzLnhyZWYuc2V0U3RhcnRYUmVmKHRoaXMuc3RhcnRYUmVmKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJzZXR1cCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNldHVwKHJlY292ZXJ5TW9kZSkgewogICAgICAgICAgdGhpcy54cmVmLnBhcnNlKHJlY292ZXJ5TW9kZSk7CiAgICAgICAgICB0aGlzLmNhdGFsb2cgPSBuZXcgX29iai5DYXRhbG9nKHRoaXMucGRmTWFuYWdlciwgdGhpcy54cmVmKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJfZ2V0TGluZWFyaXphdGlvblBhZ2UiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2V0TGluZWFyaXphdGlvblBhZ2UocGFnZUluZGV4KSB7CiAgICAgICAgICB2YXIgY2F0YWxvZyA9IHRoaXMuY2F0YWxvZywKICAgICAgICAgICAgbGluZWFyaXphdGlvbiA9IHRoaXMubGluZWFyaXphdGlvbjsKICAgICAgICAgICgwLCBfdXRpbC5hc3NlcnQpKGxpbmVhcml6YXRpb24gJiYgbGluZWFyaXphdGlvbi5wYWdlRmlyc3QgPT09IHBhZ2VJbmRleCk7CgogICAgICAgICAgdmFyIHJlZiA9IF9wcmltaXRpdmVzLlJlZi5nZXQobGluZWFyaXphdGlvbi5vYmplY3ROdW1iZXJGaXJzdCwgMCk7CgogICAgICAgICAgcmV0dXJuIHRoaXMueHJlZi5mZXRjaEFzeW5jKHJlZikudGhlbihmdW5jdGlvbiAob2JqKSB7CiAgICAgICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNEaWN0KShvYmosICJQYWdlIikgfHwgKDAsIF9wcmltaXRpdmVzLmlzRGljdCkob2JqKSAmJiAhb2JqLmhhcygiVHlwZSIpICYmIG9iai5oYXMoIkNvbnRlbnRzIikpIHsKICAgICAgICAgICAgICBpZiAocmVmICYmICFjYXRhbG9nLnBhZ2VLaWRzQ291bnRDYWNoZS5oYXMocmVmKSkgewogICAgICAgICAgICAgICAgY2F0YWxvZy5wYWdlS2lkc0NvdW50Q2FjaGUucHV0KHJlZiwgMSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gW29iaiwgcmVmXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJUaGUgTGluZWFyaXphdGlvbiBkaWN0aW9uYXJ5IGRvZXNuJ3QgcG9pbnQgIiArICJ0byBhIHZhbGlkIFBhZ2UgZGljdGlvbmFyeS4iKTsKICAgICAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgICAgKDAsIF91dGlsLmluZm8pKHJlYXNvbik7CiAgICAgICAgICAgIHJldHVybiBjYXRhbG9nLmdldFBhZ2VEaWN0KHBhZ2VJbmRleCk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJnZXRQYWdlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UGFnZShwYWdlSW5kZXgpIHsKICAgICAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgICAgIGlmICh0aGlzLl9wYWdlUHJvbWlzZXNbcGFnZUluZGV4XSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wYWdlUHJvbWlzZXNbcGFnZUluZGV4XTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgY2F0YWxvZyA9IHRoaXMuY2F0YWxvZywKICAgICAgICAgICAgbGluZWFyaXphdGlvbiA9IHRoaXMubGluZWFyaXphdGlvbjsKICAgICAgICAgIHZhciBwcm9taXNlID0gbGluZWFyaXphdGlvbiAmJiBsaW5lYXJpemF0aW9uLnBhZ2VGaXJzdCA9PT0gcGFnZUluZGV4ID8gdGhpcy5fZ2V0TGluZWFyaXphdGlvblBhZ2UocGFnZUluZGV4KSA6IGNhdGFsb2cuZ2V0UGFnZURpY3QocGFnZUluZGV4KTsKICAgICAgICAgIHJldHVybiB0aGlzLl9wYWdlUHJvbWlzZXNbcGFnZUluZGV4XSA9IHByb21pc2UudGhlbihmdW5jdGlvbiAoX3JlZjEwKSB7CiAgICAgICAgICAgIHZhciBfcmVmMTEgPSBfc2xpY2VkVG9BcnJheShfcmVmMTAsIDIpLAogICAgICAgICAgICAgIHBhZ2VEaWN0ID0gX3JlZjExWzBdLAogICAgICAgICAgICAgIHJlZiA9IF9yZWYxMVsxXTsKCiAgICAgICAgICAgIHJldHVybiBuZXcgUGFnZSh7CiAgICAgICAgICAgICAgcGRmTWFuYWdlcjogX3RoaXM1LnBkZk1hbmFnZXIsCiAgICAgICAgICAgICAgeHJlZjogX3RoaXM1LnhyZWYsCiAgICAgICAgICAgICAgcGFnZUluZGV4OiBwYWdlSW5kZXgsCiAgICAgICAgICAgICAgcGFnZURpY3Q6IHBhZ2VEaWN0LAogICAgICAgICAgICAgIHJlZjogcmVmLAogICAgICAgICAgICAgIGZvbnRDYWNoZTogY2F0YWxvZy5mb250Q2FjaGUsCiAgICAgICAgICAgICAgYnVpbHRJbkNNYXBDYWNoZTogY2F0YWxvZy5idWlsdEluQ01hcENhY2hlLAogICAgICAgICAgICAgIHBkZkZ1bmN0aW9uRmFjdG9yeTogX3RoaXM1LnBkZkZ1bmN0aW9uRmFjdG9yeQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImNoZWNrRmlyc3RQYWdlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY2hlY2tGaXJzdFBhZ2UoKSB7CiAgICAgICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgICAgICByZXR1cm4gdGhpcy5nZXRQYWdlKDApWyJjYXRjaCJdKC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBfcmVmMTIgPSBfYXN5bmNUb0dlbmVyYXRvcigvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yWyJkZWZhdWx0Il0ubWFyayhmdW5jdGlvbiBfY2FsbGVlKHJlYXNvbikgewogICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JbImRlZmF1bHQiXS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgaWYgKCEocmVhc29uIGluc3RhbmNlb2YgX2NvcmVfdXRpbHMuWFJlZkVudHJ5RXhjZXB0aW9uKSkgewogICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgX3RoaXM2Ll9wYWdlUHJvbWlzZXMubGVuZ3RoID0gMDsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA0OwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzNi5jbGVhbnVwKCk7CgogICAgICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBfY29yZV91dGlscy5YUmVmUGFyc2VFeGNlcHRpb24oKTsKCiAgICAgICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwgX2NhbGxlZSk7CiAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoX3gpIHsKICAgICAgICAgICAgICByZXR1cm4gX3JlZjEyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgIH07CiAgICAgICAgICB9KCkpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImZvbnRGYWxsYmFjayIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGZvbnRGYWxsYmFjayhpZCwgaGFuZGxlcikgewogICAgICAgICAgcmV0dXJuIHRoaXMuY2F0YWxvZy5mb250RmFsbGJhY2soaWQsIGhhbmRsZXIpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImNsZWFudXAiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgX2NsZWFudXAgPSBfYXN5bmNUb0dlbmVyYXRvcigvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yWyJkZWZhdWx0Il0ubWFyayhmdW5jdGlvbiBfY2FsbGVlMigpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclsiZGVmYXVsdCJdLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCB0aGlzLmNhdGFsb2cgPyB0aGlzLmNhdGFsb2cuY2xlYW51cCgpIDogKDAsIF9wcmltaXRpdmVzLmNsZWFyUHJpbWl0aXZlQ2FjaGVzKSgpKTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIF9jYWxsZWUyLCB0aGlzKTsKICAgICAgICAgIH0pKTsKCiAgICAgICAgICBmdW5jdGlvbiBjbGVhbnVwKCkgewogICAgICAgICAgICByZXR1cm4gX2NsZWFudXAuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gY2xlYW51cDsKICAgICAgICB9KCkKICAgICAgfSwgewogICAgICAgIGtleTogImxpbmVhcml6YXRpb24iLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgdmFyIGxpbmVhcml6YXRpb24gPSBudWxsOwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGxpbmVhcml6YXRpb24gPSBfcGFyc2VyLkxpbmVhcml6YXRpb24uY3JlYXRlKHRoaXMuc3RyZWFtKTsKICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICBpZiAoZXJyIGluc3RhbmNlb2YgX2NvcmVfdXRpbHMuTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICAgICAgICB0aHJvdyBlcnI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICgwLCBfdXRpbC5pbmZvKShlcnIpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAibGluZWFyaXphdGlvbiIsIGxpbmVhcml6YXRpb24pOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInN0YXJ0WFJlZiIsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICB2YXIgc3RyZWFtID0gdGhpcy5zdHJlYW07CiAgICAgICAgICB2YXIgc3RhcnRYUmVmID0gMDsKCiAgICAgICAgICBpZiAodGhpcy5saW5lYXJpemF0aW9uKSB7CiAgICAgICAgICAgIHN0cmVhbS5yZXNldCgpOwoKICAgICAgICAgICAgaWYgKGZpbmQoc3RyZWFtLCBFTkRPQkpfU0lHTkFUVVJFKSkgewogICAgICAgICAgICAgIHN0YXJ0WFJlZiA9IHN0cmVhbS5wb3MgKyA2IC0gc3RyZWFtLnN0YXJ0OwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgc3RlcCA9IDEwMjQ7CiAgICAgICAgICAgIHZhciBzdGFydFhSZWZMZW5ndGggPSBTVEFSVFhSRUZfU0lHTkFUVVJFLmxlbmd0aDsKICAgICAgICAgICAgdmFyIGZvdW5kID0gZmFsc2UsCiAgICAgICAgICAgICAgcG9zID0gc3RyZWFtLmVuZDsKCiAgICAgICAgICAgIHdoaWxlICghZm91bmQgJiYgcG9zID4gMCkgewogICAgICAgICAgICAgIHBvcyAtPSBzdGVwIC0gc3RhcnRYUmVmTGVuZ3RoOwoKICAgICAgICAgICAgICBpZiAocG9zIDwgMCkgewogICAgICAgICAgICAgICAgcG9zID0gMDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHN0cmVhbS5wb3MgPSBwb3M7CiAgICAgICAgICAgICAgZm91bmQgPSBmaW5kKHN0cmVhbSwgU1RBUlRYUkVGX1NJR05BVFVSRSwgc3RlcCwgdHJ1ZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmb3VuZCkgewogICAgICAgICAgICAgIHN0cmVhbS5za2lwKDkpOwogICAgICAgICAgICAgIHZhciBjaDsKCiAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgY2ggPSBzdHJlYW0uZ2V0Qnl0ZSgpOwogICAgICAgICAgICAgIH0gd2hpbGUgKCgwLCBfY29yZV91dGlscy5pc1doaXRlU3BhY2UpKGNoKSk7CgogICAgICAgICAgICAgIHZhciBzdHIgPSAiIjsKCiAgICAgICAgICAgICAgd2hpbGUgKGNoID49IDB4MjAgJiYgY2ggPD0gMHgzOSkgewogICAgICAgICAgICAgICAgc3RyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpOwogICAgICAgICAgICAgICAgY2ggPSBzdHJlYW0uZ2V0Qnl0ZSgpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgc3RhcnRYUmVmID0gcGFyc2VJbnQoc3RyLCAxMCk7CgogICAgICAgICAgICAgIGlmIChpc05hTihzdGFydFhSZWYpKSB7CiAgICAgICAgICAgICAgICBzdGFydFhSZWYgPSAwOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAic3RhcnRYUmVmIiwgc3RhcnRYUmVmKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJudW1QYWdlcyIsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICB2YXIgbGluZWFyaXphdGlvbiA9IHRoaXMubGluZWFyaXphdGlvbjsKICAgICAgICAgIHZhciBudW0gPSBsaW5lYXJpemF0aW9uID8gbGluZWFyaXphdGlvbi5udW1QYWdlcyA6IHRoaXMuY2F0YWxvZy5udW1QYWdlczsKICAgICAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAibnVtUGFnZXMiLCBudW0pOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImRvY3VtZW50SW5mbyIsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICB2YXIgRG9jdW1lbnRJbmZvVmFsaWRhdG9ycyA9IHsKICAgICAgICAgICAgVGl0bGU6IF91dGlsLmlzU3RyaW5nLAogICAgICAgICAgICBBdXRob3I6IF91dGlsLmlzU3RyaW5nLAogICAgICAgICAgICBTdWJqZWN0OiBfdXRpbC5pc1N0cmluZywKICAgICAgICAgICAgS2V5d29yZHM6IF91dGlsLmlzU3RyaW5nLAogICAgICAgICAgICBDcmVhdG9yOiBfdXRpbC5pc1N0cmluZywKICAgICAgICAgICAgUHJvZHVjZXI6IF91dGlsLmlzU3RyaW5nLAogICAgICAgICAgICBDcmVhdGlvbkRhdGU6IF91dGlsLmlzU3RyaW5nLAogICAgICAgICAgICBNb2REYXRlOiBfdXRpbC5pc1N0cmluZywKICAgICAgICAgICAgVHJhcHBlZDogX3ByaW1pdGl2ZXMuaXNOYW1lCiAgICAgICAgICB9OwogICAgICAgICAgdmFyIHZlcnNpb24gPSB0aGlzLnBkZkZvcm1hdFZlcnNpb247CgogICAgICAgICAgaWYgKHR5cGVvZiB2ZXJzaW9uICE9PSAic3RyaW5nIiB8fCAhUERGX0hFQURFUl9WRVJTSU9OX1JFR0VYUC50ZXN0KHZlcnNpb24pKSB7CiAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiSW52YWxpZCBQREYgaGVhZGVyIHZlcnNpb24gbnVtYmVyOiAiLmNvbmNhdCh2ZXJzaW9uKSk7CiAgICAgICAgICAgIHZlcnNpb24gPSBudWxsOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBkb2NJbmZvID0gewogICAgICAgICAgICBQREZGb3JtYXRWZXJzaW9uOiB2ZXJzaW9uLAogICAgICAgICAgICBJc0xpbmVhcml6ZWQ6ICEhdGhpcy5saW5lYXJpemF0aW9uLAogICAgICAgICAgICBJc0Fjcm9Gb3JtUHJlc2VudDogISF0aGlzLmFjcm9Gb3JtLAogICAgICAgICAgICBJc1hGQVByZXNlbnQ6ICEhdGhpcy54ZmEsCiAgICAgICAgICAgIElzQ29sbGVjdGlvblByZXNlbnQ6ICEhdGhpcy5jb2xsZWN0aW9uCiAgICAgICAgICB9OwogICAgICAgICAgdmFyIGluZm9EaWN0OwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGluZm9EaWN0ID0gdGhpcy54cmVmLnRyYWlsZXIuZ2V0KCJJbmZvIik7CiAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgaWYgKGVyciBpbnN0YW5jZW9mIF9jb3JlX3V0aWxzLk1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgdGhyb3cgZXJyOwogICAgICAgICAgICB9CgogICAgICAgICAgICAoMCwgX3V0aWwuaW5mbykoIlRoZSBkb2N1bWVudCBpbmZvcm1hdGlvbiBkaWN0aW9uYXJ5IGlzIGludmFsaWQuIik7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc0RpY3QpKGluZm9EaWN0KSkgewogICAgICAgICAgICB2YXIgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjQgPSB0cnVlOwogICAgICAgICAgICB2YXIgX2RpZEl0ZXJhdG9yRXJyb3I0ID0gZmFsc2U7CiAgICAgICAgICAgIHZhciBfaXRlcmF0b3JFcnJvcjQgPSB1bmRlZmluZWQ7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGZvciAodmFyIF9pdGVyYXRvcjQgPSBpbmZvRGljdC5nZXRLZXlzKClbU3ltYm9sLml0ZXJhdG9yXSgpLCBfc3RlcDQ7ICEoX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjQgPSAoX3N0ZXA0ID0gX2l0ZXJhdG9yNC5uZXh0KCkpLmRvbmUpOyBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uNCA9IHRydWUpIHsKICAgICAgICAgICAgICAgIHZhciBrZXkgPSBfc3RlcDQudmFsdWU7CiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBpbmZvRGljdC5nZXQoa2V5KTsKCiAgICAgICAgICAgICAgICBpZiAoRG9jdW1lbnRJbmZvVmFsaWRhdG9yc1trZXldKSB7CiAgICAgICAgICAgICAgICAgIGlmIChEb2N1bWVudEluZm9WYWxpZGF0b3JzW2tleV0odmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgZG9jSW5mb1trZXldID0gdHlwZW9mIHZhbHVlICE9PSAic3RyaW5nIiA/IHZhbHVlIDogKDAsIF91dGlsLnN0cmluZ1RvUERGU3RyaW5nKSh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgKDAsIF91dGlsLmluZm8pKCJCYWQgdmFsdWUgaW4gZG9jdW1lbnQgaW5mbyBmb3IgXCIiLmNvbmNhdChrZXksICJcIi4iKSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGtleSA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgICAgICAgdmFyIGN1c3RvbVZhbHVlID0gdm9pZCAwOwoKICAgICAgICAgICAgICAgICAgaWYgKCgwLCBfdXRpbC5pc1N0cmluZykodmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgY3VzdG9tVmFsdWUgPSAoMCwgX3V0aWwuc3RyaW5nVG9QREZTdHJpbmcpKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNOYW1lKSh2YWx1ZSkgfHwgKDAsIF91dGlsLmlzTnVtKSh2YWx1ZSkgfHwgKDAsIF91dGlsLmlzQm9vbCkodmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgY3VzdG9tVmFsdWUgPSB2YWx1ZTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAoMCwgX3V0aWwuaW5mbykoIlVuc3VwcG9ydGVkIHZhbHVlIGluIGRvY3VtZW50IGluZm8gZm9yIChjdXN0b20pIFwiIi5jb25jYXQoa2V5LCAiXCIuIikpOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBpZiAoIWRvY0luZm9bIkN1c3RvbSJdKSB7CiAgICAgICAgICAgICAgICAgICAgZG9jSW5mb1siQ3VzdG9tIl0gPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBkb2NJbmZvWyJDdXN0b20iXVtrZXldID0gY3VzdG9tVmFsdWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvcjQgPSB0cnVlOwogICAgICAgICAgICAgIF9pdGVyYXRvckVycm9yNCA9IGVycjsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYgKCFfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uNCAmJiBfaXRlcmF0b3I0WyJyZXR1cm4iXSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgIF9pdGVyYXRvcjRbInJldHVybiJdKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIGlmIChfZGlkSXRlcmF0b3JFcnJvcjQpIHsKICAgICAgICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3I0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAiZG9jdW1lbnRJbmZvIiwgZG9jSW5mbyk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZmluZ2VycHJpbnQiLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgdmFyIGhhc2g7CiAgICAgICAgICB2YXIgaWRBcnJheSA9IHRoaXMueHJlZi50cmFpbGVyLmdldCgiSUQiKTsKCiAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShpZEFycmF5KSAmJiBpZEFycmF5WzBdICYmICgwLCBfdXRpbC5pc1N0cmluZykoaWRBcnJheVswXSkgJiYgaWRBcnJheVswXSAhPT0gRU1QVFlfRklOR0VSUFJJTlQpIHsKICAgICAgICAgICAgaGFzaCA9ICgwLCBfdXRpbC5zdHJpbmdUb0J5dGVzKShpZEFycmF5WzBdKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGhhc2ggPSAoMCwgX2NyeXB0by5jYWxjdWxhdGVNRDUpKHRoaXMuc3RyZWFtLmdldEJ5dGVSYW5nZSgwLCBGSU5HRVJQUklOVF9GSVJTVF9CWVRFUyksIDAsIEZJTkdFUlBSSU5UX0ZJUlNUX0JZVEVTKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZmluZ2VycHJpbnRCdWYgPSBbXTsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBoYXNoLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgdmFyIGhleCA9IGhhc2hbaV0udG9TdHJpbmcoMTYpOwogICAgICAgICAgICBmaW5nZXJwcmludEJ1Zi5wdXNoKGhleC5wYWRTdGFydCgyLCAiMCIpKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgImZpbmdlcnByaW50IiwgZmluZ2VycHJpbnRCdWYuam9pbigiIikpOwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIFBERkRvY3VtZW50OwogICAgfSgpOwoKICAgIGV4cG9ydHMuUERGRG9jdW1lbnQgPSBQREZEb2N1bWVudDsKCiAgICAvKioqL30pLCAoCiAgLyogMTk5ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgIHZhbHVlOiB0cnVlCiAgICB9KTsKICAgIGV4cG9ydHMuRmlsZVNwZWMgPSBleHBvcnRzLlhSZWYgPSBleHBvcnRzLk9iamVjdExvYWRlciA9IGV4cG9ydHMuQ2F0YWxvZyA9IHZvaWQgMDsKCiAgICB2YXIgX3JlZ2VuZXJhdG9yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfX3dfcGRmanNfcmVxdWlyZV9fKDIpKTsKCiAgICB2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUpOwoKICAgIHZhciBfcHJpbWl0aXZlcyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTk0KTsKCiAgICB2YXIgX3BhcnNlciA9IF9fd19wZGZqc19yZXF1aXJlX18oMjAwKTsKCiAgICB2YXIgX2NvcmVfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE5Nyk7CgogICAgdmFyIF9jcnlwdG8gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIxMSk7CgogICAgdmFyIF9jb2xvcnNwYWNlID0gX193X3BkZmpzX3JlcXVpcmVfXygyMTIpOwoKICAgIGZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7cmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgImRlZmF1bHQiOiBvYmogfTt9CgogICAgZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkge2lmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHtyZXR1cm4gY2FsbDt9cmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7fQoKICAgIGZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikge2lmIChzZWxmID09PSB2b2lkIDApIHt0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpO31yZXR1cm4gc2VsZjt9CgogICAgZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHtfZ2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3QuZ2V0UHJvdG90eXBlT2YgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2Yobykge3JldHVybiBvLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2Yobyk7fTtyZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pO30KCiAgICBmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHtpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkge3Rocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7fXN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTtpZiAoc3VwZXJDbGFzcykgX3NldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKTt9CgogICAgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHtfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHtvLl9fcHJvdG9fXyA9IHA7cmV0dXJuIG87fTtyZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApO30KCiAgICBmdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7dHJ5IHt2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7dmFyIHZhbHVlID0gaW5mby52YWx1ZTt9IGNhdGNoIChlcnJvcikge3JlamVjdChlcnJvcik7cmV0dXJuO31pZiAoaW5mby5kb25lKSB7cmVzb2x2ZSh2YWx1ZSk7fSBlbHNlIHtQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oX25leHQsIF90aHJvdyk7fX0KCiAgICBmdW5jdGlvbiBfYXN5bmNUb0dlbmVyYXRvcihmbikge3JldHVybiBmdW5jdGlvbiAoKSB7dmFyIHNlbGYgPSB0aGlzLGFyZ3MgPSBhcmd1bWVudHM7cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHt2YXIgZ2VuID0gZm4uYXBwbHkoc2VsZiwgYXJncyk7ZnVuY3Rpb24gX25leHQodmFsdWUpIHthc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJuZXh0IiwgdmFsdWUpO31mdW5jdGlvbiBfdGhyb3coZXJyKSB7YXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAidGhyb3ciLCBlcnIpO31fbmV4dCh1bmRlZmluZWQpO30pO307fQoKICAgIGZ1bmN0aW9uIF9zbGljZWRUb0FycmF5KGFyciwgaSkge3JldHVybiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB8fCBfbm9uSXRlcmFibGVSZXN0KCk7fQoKICAgIGZ1bmN0aW9uIF9ub25JdGVyYWJsZVJlc3QoKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZSIpO30KCiAgICBmdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB7aWYgKCEoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChhcnIpIHx8IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChhcnIpID09PSAiW29iamVjdCBBcmd1bWVudHNdIikpIHtyZXR1cm47fXZhciBfYXJyID0gW107dmFyIF9uID0gdHJ1ZTt2YXIgX2QgPSBmYWxzZTt2YXIgX2UgPSB1bmRlZmluZWQ7dHJ5IHtmb3IgKHZhciBfaSA9IGFycltTeW1ib2wuaXRlcmF0b3JdKCksIF9zOyAhKF9uID0gKF9zID0gX2kubmV4dCgpKS5kb25lKTsgX24gPSB0cnVlKSB7X2Fyci5wdXNoKF9zLnZhbHVlKTtpZiAoaSAmJiBfYXJyLmxlbmd0aCA9PT0gaSkgYnJlYWs7fX0gY2F0Y2ggKGVycikge19kID0gdHJ1ZTtfZSA9IGVycjt9IGZpbmFsbHkge3RyeSB7aWYgKCFfbiAmJiBfaVsicmV0dXJuIl0gIT0gbnVsbCkgX2lbInJldHVybiJdKCk7fSBmaW5hbGx5IHtpZiAoX2QpIHRocm93IF9lO319cmV0dXJuIF9hcnI7fQoKICAgIGZ1bmN0aW9uIF9hcnJheVdpdGhIb2xlcyhhcnIpIHtpZiAoQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm4gYXJyO30KCiAgICBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyJAYmFiZWwvaGVscGVycyAtIHR5cGVvZiI7aWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIpIHtfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHtyZXR1cm4gdHlwZW9mIG9iajt9O30gZWxzZSB7X3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7cmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajt9O31yZXR1cm4gX3R5cGVvZihvYmopO30KCiAgICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7aWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTt9fQoKICAgIGZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHtmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7dmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTtkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7ZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlO2lmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlO09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTt9fQoKICAgIGZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHtpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTtpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7cmV0dXJuIENvbnN0cnVjdG9yO30KCiAgICBmdW5jdGlvbiBmZXRjaERlc3RpbmF0aW9uKGRlc3QpIHsKICAgICAgcmV0dXJuICgwLCBfcHJpbWl0aXZlcy5pc0RpY3QpKGRlc3QpID8gZGVzdC5nZXQoIkQiKSA6IGRlc3Q7CiAgICB9CgogICAgdmFyIENhdGFsb2cgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBDYXRhbG9nKHBkZk1hbmFnZXIsIHhyZWYpIHsKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQ2F0YWxvZyk7CgogICAgICAgIHRoaXMucGRmTWFuYWdlciA9IHBkZk1hbmFnZXI7CiAgICAgICAgdGhpcy54cmVmID0geHJlZjsKICAgICAgICB0aGlzLmNhdERpY3QgPSB4cmVmLmdldENhdGFsb2dPYmooKTsKCiAgICAgICAgaWYgKCEoMCwgX3ByaW1pdGl2ZXMuaXNEaWN0KSh0aGlzLmNhdERpY3QpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkNhdGFsb2cgb2JqZWN0IGlzIG5vdCBhIGRpY3Rpb25hcnkuIik7CiAgICAgICAgfQoKICAgICAgICB0aGlzLmZvbnRDYWNoZSA9IG5ldyBfcHJpbWl0aXZlcy5SZWZTZXRDYWNoZSgpOwogICAgICAgIHRoaXMuYnVpbHRJbkNNYXBDYWNoZSA9IG5ldyBNYXAoKTsKICAgICAgICB0aGlzLnBhZ2VLaWRzQ291bnRDYWNoZSA9IG5ldyBfcHJpbWl0aXZlcy5SZWZTZXRDYWNoZSgpOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoQ2F0YWxvZywgW3sKICAgICAgICBrZXk6ICJfcmVhZERvY3VtZW50T3V0bGluZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9yZWFkRG9jdW1lbnRPdXRsaW5lKCkgewogICAgICAgICAgdmFyIG9iaiA9IHRoaXMuY2F0RGljdC5nZXQoIk91dGxpbmVzIik7CgogICAgICAgICAgaWYgKCEoMCwgX3ByaW1pdGl2ZXMuaXNEaWN0KShvYmopKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQoKICAgICAgICAgIG9iaiA9IG9iai5nZXRSYXcoIkZpcnN0Iik7CgogICAgICAgICAgaWYgKCEoMCwgX3ByaW1pdGl2ZXMuaXNSZWYpKG9iaikpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHJvb3QgPSB7CiAgICAgICAgICAgIGl0ZW1zOiBbXQogICAgICAgICAgfTsKICAgICAgICAgIHZhciBxdWV1ZSA9IFt7CiAgICAgICAgICAgIG9iajogb2JqLAogICAgICAgICAgICBwYXJlbnQ6IHJvb3QKICAgICAgICAgIH1dOwogICAgICAgICAgdmFyIHByb2Nlc3NlZCA9IG5ldyBfcHJpbWl0aXZlcy5SZWZTZXQoKTsKICAgICAgICAgIHByb2Nlc3NlZC5wdXQob2JqKTsKICAgICAgICAgIHZhciB4cmVmID0gdGhpcy54cmVmLAogICAgICAgICAgICBibGFja0NvbG9yID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KDMpOwoKICAgICAgICAgIHdoaWxlIChxdWV1ZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHZhciBpID0gcXVldWUuc2hpZnQoKTsKICAgICAgICAgICAgdmFyIG91dGxpbmVEaWN0ID0geHJlZi5mZXRjaElmUmVmKGkub2JqKTsKCiAgICAgICAgICAgIGlmIChvdXRsaW5lRGljdCA9PT0gbnVsbCkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIW91dGxpbmVEaWN0LmhhcygiVGl0bGUiKSkgewogICAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiSW52YWxpZCBvdXRsaW5lIGl0ZW0gZW5jb3VudGVyZWQuIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBkYXRhID0gewogICAgICAgICAgICAgIHVybDogbnVsbCwKICAgICAgICAgICAgICBkZXN0OiBudWxsCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIENhdGFsb2cucGFyc2VEZXN0RGljdGlvbmFyeSh7CiAgICAgICAgICAgICAgZGVzdERpY3Q6IG91dGxpbmVEaWN0LAogICAgICAgICAgICAgIHJlc3VsdE9iajogZGF0YSwKICAgICAgICAgICAgICBkb2NCYXNlVXJsOiB0aGlzLnBkZk1hbmFnZXIuZG9jQmFzZVVybAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyIHRpdGxlID0gb3V0bGluZURpY3QuZ2V0KCJUaXRsZSIpOwogICAgICAgICAgICB2YXIgZmxhZ3MgPSBvdXRsaW5lRGljdC5nZXQoIkYiKSB8fCAwOwogICAgICAgICAgICB2YXIgY29sb3IgPSBvdXRsaW5lRGljdC5nZXRBcnJheSgiQyIpOwogICAgICAgICAgICB2YXIgY291bnQgPSBvdXRsaW5lRGljdC5nZXQoIkNvdW50Iik7CiAgICAgICAgICAgIHZhciByZ2JDb2xvciA9IGJsYWNrQ29sb3I7CgogICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShjb2xvcikgJiYgY29sb3IubGVuZ3RoID09PSAzICYmIChjb2xvclswXSAhPT0gMCB8fCBjb2xvclsxXSAhPT0gMCB8fCBjb2xvclsyXSAhPT0gMCkpIHsKICAgICAgICAgICAgICByZ2JDb2xvciA9IF9jb2xvcnNwYWNlLkNvbG9yU3BhY2Uuc2luZ2xldG9ucy5yZ2IuZ2V0UmdiKGNvbG9yLCAwKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIG91dGxpbmVJdGVtID0gewogICAgICAgICAgICAgIGRlc3Q6IGRhdGEuZGVzdCwKICAgICAgICAgICAgICB1cmw6IGRhdGEudXJsLAogICAgICAgICAgICAgIHVuc2FmZVVybDogZGF0YS51bnNhZmVVcmwsCiAgICAgICAgICAgICAgbmV3V2luZG93OiBkYXRhLm5ld1dpbmRvdywKICAgICAgICAgICAgICB0aXRsZTogKDAsIF91dGlsLnN0cmluZ1RvUERGU3RyaW5nKSh0aXRsZSksCiAgICAgICAgICAgICAgY29sb3I6IHJnYkNvbG9yLAogICAgICAgICAgICAgIGNvdW50OiBOdW1iZXIuaXNJbnRlZ2VyKGNvdW50KSA/IGNvdW50IDogdW5kZWZpbmVkLAogICAgICAgICAgICAgIGJvbGQ6ICEhKGZsYWdzICYgMiksCiAgICAgICAgICAgICAgaXRhbGljOiAhIShmbGFncyAmIDEpLAogICAgICAgICAgICAgIGl0ZW1zOiBbXQogICAgICAgICAgICB9OwogICAgICAgICAgICBpLnBhcmVudC5pdGVtcy5wdXNoKG91dGxpbmVJdGVtKTsKICAgICAgICAgICAgb2JqID0gb3V0bGluZURpY3QuZ2V0UmF3KCJGaXJzdCIpOwoKICAgICAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc1JlZikob2JqKSAmJiAhcHJvY2Vzc2VkLmhhcyhvYmopKSB7CiAgICAgICAgICAgICAgcXVldWUucHVzaCh7CiAgICAgICAgICAgICAgICBvYmo6IG9iaiwKICAgICAgICAgICAgICAgIHBhcmVudDogb3V0bGluZUl0ZW0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBwcm9jZXNzZWQucHV0KG9iaik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG9iaiA9IG91dGxpbmVEaWN0LmdldFJhdygiTmV4dCIpOwoKICAgICAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc1JlZikob2JqKSAmJiAhcHJvY2Vzc2VkLmhhcyhvYmopKSB7CiAgICAgICAgICAgICAgcXVldWUucHVzaCh7CiAgICAgICAgICAgICAgICBvYmo6IG9iaiwKICAgICAgICAgICAgICAgIHBhcmVudDogaS5wYXJlbnQKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBwcm9jZXNzZWQucHV0KG9iaik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gcm9vdC5pdGVtcy5sZW5ndGggPiAwID8gcm9vdC5pdGVtcyA6IG51bGw7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiX3JlYWRQZXJtaXNzaW9ucyIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9yZWFkUGVybWlzc2lvbnMoKSB7CiAgICAgICAgICB2YXIgZW5jcnlwdCA9IHRoaXMueHJlZi50cmFpbGVyLmdldCgiRW5jcnlwdCIpOwoKICAgICAgICAgIGlmICghKDAsIF9wcmltaXRpdmVzLmlzRGljdCkoZW5jcnlwdCkpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGZsYWdzID0gZW5jcnlwdC5nZXQoIlAiKTsKCiAgICAgICAgICBpZiAoISgwLCBfdXRpbC5pc051bSkoZmxhZ3MpKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQoKICAgICAgICAgIGZsYWdzICs9IE1hdGgucG93KDIsIDMyKTsKICAgICAgICAgIHZhciBwZXJtaXNzaW9ucyA9IFtdOwoKICAgICAgICAgIGZvciAodmFyIGtleSBpbiBfdXRpbC5QZXJtaXNzaW9uRmxhZykgewogICAgICAgICAgICB2YXIgdmFsdWUgPSBfdXRpbC5QZXJtaXNzaW9uRmxhZ1trZXldOwoKICAgICAgICAgICAgaWYgKGZsYWdzICYgdmFsdWUpIHsKICAgICAgICAgICAgICBwZXJtaXNzaW9ucy5wdXNoKHZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBwZXJtaXNzaW9uczsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJnZXREZXN0aW5hdGlvbiIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldERlc3RpbmF0aW9uKGRlc3RpbmF0aW9uSWQpIHsKICAgICAgICAgIHZhciBvYmogPSB0aGlzLl9yZWFkRGVzdHMoKTsKCiAgICAgICAgICBpZiAob2JqIGluc3RhbmNlb2YgTmFtZVRyZWUgfHwgb2JqIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkgewogICAgICAgICAgICByZXR1cm4gZmV0Y2hEZXN0aW5hdGlvbihvYmouZ2V0KGRlc3RpbmF0aW9uSWQpIHx8IG51bGwpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIl9yZWFkRGVzdHMiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfcmVhZERlc3RzKCkgewogICAgICAgICAgdmFyIG9iaiA9IHRoaXMuY2F0RGljdC5nZXQoIk5hbWVzIik7CgogICAgICAgICAgaWYgKG9iaiAmJiBvYmouaGFzKCJEZXN0cyIpKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgTmFtZVRyZWUob2JqLmdldFJhdygiRGVzdHMiKSwgdGhpcy54cmVmKTsKICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5jYXREaWN0LmhhcygiRGVzdHMiKSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jYXREaWN0LmdldCgiRGVzdHMiKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIl9yZWFkUGFnZUxhYmVscyIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9yZWFkUGFnZUxhYmVscygpIHsKICAgICAgICAgIHZhciBvYmogPSB0aGlzLmNhdERpY3QuZ2V0UmF3KCJQYWdlTGFiZWxzIik7CgogICAgICAgICAgaWYgKCFvYmopIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHBhZ2VMYWJlbHMgPSBuZXcgQXJyYXkodGhpcy5udW1QYWdlcyk7CiAgICAgICAgICB2YXIgc3R5bGUgPSBudWxsLAogICAgICAgICAgICBwcmVmaXggPSAiIjsKICAgICAgICAgIHZhciBudW1iZXJUcmVlID0gbmV3IE51bWJlclRyZWUob2JqLCB0aGlzLnhyZWYpOwogICAgICAgICAgdmFyIG51bXMgPSBudW1iZXJUcmVlLmdldEFsbCgpOwogICAgICAgICAgdmFyIGN1cnJlbnRMYWJlbCA9ICIiLAogICAgICAgICAgICBjdXJyZW50SW5kZXggPSAxOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IHRoaXMubnVtUGFnZXM7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgIGlmIChpIGluIG51bXMpIHsKICAgICAgICAgICAgICB2YXIgbGFiZWxEaWN0ID0gbnVtc1tpXTsKCiAgICAgICAgICAgICAgaWYgKCEoMCwgX3ByaW1pdGl2ZXMuaXNEaWN0KShsYWJlbERpY3QpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIlBhZ2VMYWJlbCBpcyBub3QgYSBkaWN0aW9uYXJ5LiIpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGxhYmVsRGljdC5oYXMoIlR5cGUiKSAmJiAhKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkobGFiZWxEaWN0LmdldCgiVHlwZSIpLCAiUGFnZUxhYmVsIikpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiSW52YWxpZCB0eXBlIGluIFBhZ2VMYWJlbCBkaWN0aW9uYXJ5LiIpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGxhYmVsRGljdC5oYXMoIlMiKSkgewogICAgICAgICAgICAgICAgdmFyIHMgPSBsYWJlbERpY3QuZ2V0KCJTIik7CgogICAgICAgICAgICAgICAgaWYgKCEoMCwgX3ByaW1pdGl2ZXMuaXNOYW1lKShzKSkgewogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkludmFsaWQgc3R5bGUgaW4gUGFnZUxhYmVsIGRpY3Rpb25hcnkuIik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgc3R5bGUgPSBzLm5hbWU7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHN0eWxlID0gbnVsbDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChsYWJlbERpY3QuaGFzKCJQIikpIHsKICAgICAgICAgICAgICAgIHZhciBwID0gbGFiZWxEaWN0LmdldCgiUCIpOwoKICAgICAgICAgICAgICAgIGlmICghKDAsIF91dGlsLmlzU3RyaW5nKShwKSkgewogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkludmFsaWQgcHJlZml4IGluIFBhZ2VMYWJlbCBkaWN0aW9uYXJ5LiIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHByZWZpeCA9ICgwLCBfdXRpbC5zdHJpbmdUb1BERlN0cmluZykocCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHByZWZpeCA9ICIiOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGxhYmVsRGljdC5oYXMoIlN0IikpIHsKICAgICAgICAgICAgICAgIHZhciBzdCA9IGxhYmVsRGljdC5nZXQoIlN0Iik7CgogICAgICAgICAgICAgICAgaWYgKCEoTnVtYmVyLmlzSW50ZWdlcihzdCkgJiYgc3QgPj0gMSkpIHsKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJJbnZhbGlkIHN0YXJ0IGluIFBhZ2VMYWJlbCBkaWN0aW9uYXJ5LiIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGN1cnJlbnRJbmRleCA9IHN0OwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjdXJyZW50SW5kZXggPSAxOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgc3dpdGNoIChzdHlsZSkgewogICAgICAgICAgICAgIGNhc2UgIkQiOgogICAgICAgICAgICAgICAgY3VycmVudExhYmVsID0gY3VycmVudEluZGV4OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgIlIiOgogICAgICAgICAgICAgIGNhc2UgInIiOgogICAgICAgICAgICAgICAgY3VycmVudExhYmVsID0gKDAsIF9jb3JlX3V0aWxzLnRvUm9tYW5OdW1lcmFscykoY3VycmVudEluZGV4LCBzdHlsZSA9PT0gInIiKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICJBIjoKICAgICAgICAgICAgICBjYXNlICJhIjoKICAgICAgICAgICAgICAgIHZhciBMSU1JVCA9IDI2OwogICAgICAgICAgICAgICAgdmFyIEFfVVBQRVJfQ0FTRSA9IDB4NDEsCiAgICAgICAgICAgICAgICAgIEFfTE9XRVJfQ0FTRSA9IDB4NjE7CiAgICAgICAgICAgICAgICB2YXIgYmFzZUNoYXJDb2RlID0gc3R5bGUgPT09ICJhIiA/IEFfTE9XRVJfQ0FTRSA6IEFfVVBQRVJfQ0FTRTsKICAgICAgICAgICAgICAgIHZhciBsZXR0ZXJJbmRleCA9IGN1cnJlbnRJbmRleCAtIDE7CiAgICAgICAgICAgICAgICB2YXIgY2hhcmFjdGVyID0gU3RyaW5nLmZyb21DaGFyQ29kZShiYXNlQ2hhckNvZGUgKyBsZXR0ZXJJbmRleCAlIExJTUlUKTsKICAgICAgICAgICAgICAgIHZhciBjaGFyQnVmID0gW107CgogICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDAsIGpqID0gbGV0dGVySW5kZXggLyBMSU1JVCB8IDA7IGogPD0gamo7IGorKykgewogICAgICAgICAgICAgICAgICBjaGFyQnVmLnB1c2goY2hhcmFjdGVyKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjdXJyZW50TGFiZWwgPSBjaGFyQnVmLmpvaW4oIiIpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBpZiAoc3R5bGUpIHsKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJJbnZhbGlkIHN0eWxlIFwiIi5jb25jYXQoc3R5bGUsICJcIiBpbiBQYWdlTGFiZWwgZGljdGlvbmFyeS4iKSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY3VycmVudExhYmVsID0gIiI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHBhZ2VMYWJlbHNbaV0gPSBwcmVmaXggKyBjdXJyZW50TGFiZWw7CiAgICAgICAgICAgIGN1cnJlbnRJbmRleCsrOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBwYWdlTGFiZWxzOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImZvbnRGYWxsYmFjayIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGZvbnRGYWxsYmFjayhpZCwgaGFuZGxlcikgewogICAgICAgICAgdmFyIHByb21pc2VzID0gW107CiAgICAgICAgICB0aGlzLmZvbnRDYWNoZS5mb3JFYWNoKGZ1bmN0aW9uIChwcm9taXNlKSB7CiAgICAgICAgICAgIHByb21pc2VzLnB1c2gocHJvbWlzZSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiBQcm9taXNlLmFsbChwcm9taXNlcykudGhlbihmdW5jdGlvbiAodHJhbnNsYXRlZEZvbnRzKSB7CiAgICAgICAgICAgIHZhciBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gdHJ1ZTsKICAgICAgICAgICAgdmFyIF9kaWRJdGVyYXRvckVycm9yID0gZmFsc2U7CiAgICAgICAgICAgIHZhciBfaXRlcmF0b3JFcnJvciA9IHVuZGVmaW5lZDsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgX2l0ZXJhdG9yID0gdHJhbnNsYXRlZEZvbnRzW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3N0ZXA7ICEoX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IChfc3RlcCA9IF9pdGVyYXRvci5uZXh0KCkpLmRvbmUpOyBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gdHJ1ZSkgewogICAgICAgICAgICAgICAgdmFyIHRyYW5zbGF0ZWRGb250ID0gX3N0ZXAudmFsdWU7CgogICAgICAgICAgICAgICAgaWYgKHRyYW5zbGF0ZWRGb250LmxvYWRlZE5hbWUgPT09IGlkKSB7CiAgICAgICAgICAgICAgICAgIHRyYW5zbGF0ZWRGb250LmZhbGxiYWNrKGhhbmRsZXIpOwogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvciA9IHRydWU7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yRXJyb3IgPSBlcnI7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICghX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiAmJiBfaXRlcmF0b3JbInJldHVybiJdICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yWyJyZXR1cm4iXSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBpZiAoX2RpZEl0ZXJhdG9yRXJyb3IpIHsKICAgICAgICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3I7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJjbGVhbnVwIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY2xlYW51cCgpIHsKICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAgICAgKDAsIF9wcmltaXRpdmVzLmNsZWFyUHJpbWl0aXZlQ2FjaGVzKSgpOwogICAgICAgICAgdGhpcy5wYWdlS2lkc0NvdW50Q2FjaGUuY2xlYXIoKTsKICAgICAgICAgIHZhciBwcm9taXNlcyA9IFtdOwogICAgICAgICAgdGhpcy5mb250Q2FjaGUuZm9yRWFjaChmdW5jdGlvbiAocHJvbWlzZSkgewogICAgICAgICAgICBwcm9taXNlcy5wdXNoKHByb21pc2UpOwogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwocHJvbWlzZXMpLnRoZW4oZnVuY3Rpb24gKHRyYW5zbGF0ZWRGb250cykgewogICAgICAgICAgICB2YXIgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIgPSB0cnVlOwogICAgICAgICAgICB2YXIgX2RpZEl0ZXJhdG9yRXJyb3IyID0gZmFsc2U7CiAgICAgICAgICAgIHZhciBfaXRlcmF0b3JFcnJvcjIgPSB1bmRlZmluZWQ7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGZvciAodmFyIF9pdGVyYXRvcjIgPSB0cmFuc2xhdGVkRm9udHNbU3ltYm9sLml0ZXJhdG9yXSgpLCBfc3RlcDI7ICEoX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIgPSAoX3N0ZXAyID0gX2l0ZXJhdG9yMi5uZXh0KCkpLmRvbmUpOyBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiA9IHRydWUpIHsKICAgICAgICAgICAgICAgIHZhciBkaWN0ID0gX3N0ZXAyLnZhbHVlLmRpY3Q7CiAgICAgICAgICAgICAgICBkZWxldGUgZGljdC50cmFuc2xhdGVkOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgX2RpZEl0ZXJhdG9yRXJyb3IyID0gdHJ1ZTsKICAgICAgICAgICAgICBfaXRlcmF0b3JFcnJvcjIgPSBlcnI7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICghX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIgJiYgX2l0ZXJhdG9yMlsicmV0dXJuIl0gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICBfaXRlcmF0b3IyWyJyZXR1cm4iXSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBpZiAoX2RpZEl0ZXJhdG9yRXJyb3IyKSB7CiAgICAgICAgICAgICAgICAgIHRocm93IF9pdGVyYXRvckVycm9yMjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF90aGlzLmZvbnRDYWNoZS5jbGVhcigpOwoKICAgICAgICAgICAgX3RoaXMuYnVpbHRJbkNNYXBDYWNoZS5jbGVhcigpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0UGFnZURpY3QiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRQYWdlRGljdChwYWdlSW5kZXgpIHsKICAgICAgICAgIHZhciBjYXBhYmlsaXR5ID0gKDAsIF91dGlsLmNyZWF0ZVByb21pc2VDYXBhYmlsaXR5KSgpOwogICAgICAgICAgdmFyIG5vZGVzVG9WaXNpdCA9IFt0aGlzLmNhdERpY3QuZ2V0UmF3KCJQYWdlcyIpXTsKICAgICAgICAgIHZhciB2aXNpdGVkTm9kZXMgPSBuZXcgX3ByaW1pdGl2ZXMuUmVmU2V0KCk7CiAgICAgICAgICB2YXIgeHJlZiA9IHRoaXMueHJlZiwKICAgICAgICAgICAgcGFnZUtpZHNDb3VudENhY2hlID0gdGhpcy5wYWdlS2lkc0NvdW50Q2FjaGU7CiAgICAgICAgICB2YXIgY291bnQsCiAgICAgICAgICAgIGN1cnJlbnRQYWdlSW5kZXggPSAwOwoKICAgICAgICAgIGZ1bmN0aW9uIG5leHQoKSB7CiAgICAgICAgICAgIHZhciBfbG9vcCA9IGZ1bmN0aW9uIF9sb29wKCkgewogICAgICAgICAgICAgIHZhciBjdXJyZW50Tm9kZSA9IG5vZGVzVG9WaXNpdC5wb3AoKTsKCiAgICAgICAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc1JlZikoY3VycmVudE5vZGUpKSB7CiAgICAgICAgICAgICAgICBjb3VudCA9IHBhZ2VLaWRzQ291bnRDYWNoZS5nZXQoY3VycmVudE5vZGUpOwoKICAgICAgICAgICAgICAgIGlmIChjb3VudCA+IDAgJiYgY3VycmVudFBhZ2VJbmRleCArIGNvdW50IDwgcGFnZUluZGV4KSB7CiAgICAgICAgICAgICAgICAgIGN1cnJlbnRQYWdlSW5kZXggKz0gY291bnQ7CiAgICAgICAgICAgICAgICAgIHJldHVybiAiY29udGludWUiOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh2aXNpdGVkTm9kZXMuaGFzKGN1cnJlbnROb2RlKSkgewogICAgICAgICAgICAgICAgICBjYXBhYmlsaXR5LnJlamVjdChuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIlBhZ2VzIHRyZWUgY29udGFpbnMgY2lyY3VsYXIgcmVmZXJlbmNlLiIpKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICB2OiB2b2lkIDAKICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2aXNpdGVkTm9kZXMucHV0KGN1cnJlbnROb2RlKTsKICAgICAgICAgICAgICAgIHhyZWYuZmV0Y2hBc3luYyhjdXJyZW50Tm9kZSkudGhlbihmdW5jdGlvbiAob2JqKSB7CiAgICAgICAgICAgICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNEaWN0KShvYmosICJQYWdlIikgfHwgKDAsIF9wcmltaXRpdmVzLmlzRGljdCkob2JqKSAmJiAhb2JqLmhhcygiS2lkcyIpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBhZ2VJbmRleCA9PT0gY3VycmVudFBhZ2VJbmRleCkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnROb2RlICYmICFwYWdlS2lkc0NvdW50Q2FjaGUuaGFzKGN1cnJlbnROb2RlKSkgewogICAgICAgICAgICAgICAgICAgICAgICBwYWdlS2lkc0NvdW50Q2FjaGUucHV0KGN1cnJlbnROb2RlLCAxKTsKICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICBjYXBhYmlsaXR5LnJlc29sdmUoW29iaiwgY3VycmVudE5vZGVdKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgY3VycmVudFBhZ2VJbmRleCsrOwogICAgICAgICAgICAgICAgICAgICAgbmV4dCgpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBub2Rlc1RvVmlzaXQucHVzaChvYmopOwogICAgICAgICAgICAgICAgICBuZXh0KCk7CiAgICAgICAgICAgICAgICB9LCBjYXBhYmlsaXR5LnJlamVjdCk7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICB2OiB2b2lkIDAKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoISgwLCBfcHJpbWl0aXZlcy5pc0RpY3QpKGN1cnJlbnROb2RlKSkgewogICAgICAgICAgICAgICAgY2FwYWJpbGl0eS5yZWplY3QobmV3IF91dGlsLkZvcm1hdEVycm9yKCJQYWdlIGRpY3Rpb25hcnkga2lkIHJlZmVyZW5jZSBwb2ludHMgdG8gd3JvbmcgdHlwZSBvZiBvYmplY3QuIikpOwogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgdjogdm9pZCAwCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY291bnQgPSBjdXJyZW50Tm9kZS5nZXQoIkNvdW50Iik7CgogICAgICAgICAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKGNvdW50KSAmJiBjb3VudCA+PSAwKSB7CiAgICAgICAgICAgICAgICB2YXIgb2JqSWQgPSBjdXJyZW50Tm9kZS5vYmpJZDsKCiAgICAgICAgICAgICAgICBpZiAob2JqSWQgJiYgIXBhZ2VLaWRzQ291bnRDYWNoZS5oYXMob2JqSWQpKSB7CiAgICAgICAgICAgICAgICAgIHBhZ2VLaWRzQ291bnRDYWNoZS5wdXQob2JqSWQsIGNvdW50KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoY3VycmVudFBhZ2VJbmRleCArIGNvdW50IDw9IHBhZ2VJbmRleCkgewogICAgICAgICAgICAgICAgICBjdXJyZW50UGFnZUluZGV4ICs9IGNvdW50OwogICAgICAgICAgICAgICAgICByZXR1cm4gImNvbnRpbnVlIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBraWRzID0gY3VycmVudE5vZGUuZ2V0KCJLaWRzIik7CgogICAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShraWRzKSkgewogICAgICAgICAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc05hbWUpKGN1cnJlbnROb2RlLmdldCgiVHlwZSIpLCAiUGFnZSIpIHx8ICFjdXJyZW50Tm9kZS5oYXMoIlR5cGUiKSAmJiBjdXJyZW50Tm9kZS5oYXMoIkNvbnRlbnRzIikpIHsKICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRQYWdlSW5kZXggPT09IHBhZ2VJbmRleCkgewogICAgICAgICAgICAgICAgICAgIGNhcGFiaWxpdHkucmVzb2x2ZShbY3VycmVudE5vZGUsIG51bGxdKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgdjogdm9pZCAwCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgY3VycmVudFBhZ2VJbmRleCsrOwogICAgICAgICAgICAgICAgICByZXR1cm4gImNvbnRpbnVlIjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjYXBhYmlsaXR5LnJlamVjdChuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIlBhZ2UgZGljdGlvbmFyeSBraWRzIG9iamVjdCBpcyBub3QgYW4gYXJyYXkuIikpOwogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgdjogdm9pZCAwCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZm9yICh2YXIgbGFzdCA9IGtpZHMubGVuZ3RoIC0gMTsgbGFzdCA+PSAwOyBsYXN0LS0pIHsKICAgICAgICAgICAgICAgIG5vZGVzVG9WaXNpdC5wdXNoKGtpZHNbbGFzdF0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHdoaWxlIChub2Rlc1RvVmlzaXQubGVuZ3RoKSB7CiAgICAgICAgICAgICAgdmFyIF9yZXQgPSBfbG9vcCgpOwoKICAgICAgICAgICAgICBzd2l0Y2ggKF9yZXQpIHsKICAgICAgICAgICAgICAgIGNhc2UgImNvbnRpbnVlIjoKICAgICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgaWYgKF90eXBlb2YoX3JldCkgPT09ICJvYmplY3QiKSByZXR1cm4gX3JldC52OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgY2FwYWJpbGl0eS5yZWplY3QobmV3IEVycm9yKCJQYWdlIGluZGV4ICIuY29uY2F0KHBhZ2VJbmRleCwgIiBub3QgZm91bmQuIikpKTsKICAgICAgICAgIH0KCiAgICAgICAgICBuZXh0KCk7CiAgICAgICAgICByZXR1cm4gY2FwYWJpbGl0eS5wcm9taXNlOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImdldFBhZ2VJbmRleCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldFBhZ2VJbmRleChwYWdlUmVmKSB7CiAgICAgICAgICB2YXIgeHJlZiA9IHRoaXMueHJlZjsKCiAgICAgICAgICBmdW5jdGlvbiBwYWdlc0JlZm9yZVJlZihraWRSZWYpIHsKICAgICAgICAgICAgdmFyIHRvdGFsID0gMCwKICAgICAgICAgICAgICBwYXJlbnRSZWY7CiAgICAgICAgICAgIHJldHVybiB4cmVmLmZldGNoQXN5bmMoa2lkUmVmKS50aGVuKGZ1bmN0aW9uIChub2RlKSB7CiAgICAgICAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc1JlZnNFcXVhbCkoa2lkUmVmLCBwYWdlUmVmKSAmJiAhKDAsIF9wcmltaXRpdmVzLmlzRGljdCkobm9kZSwgIlBhZ2UiKSAmJiAhKCgwLCBfcHJpbWl0aXZlcy5pc0RpY3QpKG5vZGUpICYmICFub2RlLmhhcygiVHlwZSIpICYmIG5vZGUuaGFzKCJDb250ZW50cyIpKSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJUaGUgcmVmZXJlbmNlIGRvZXMgbm90IHBvaW50IHRvIGEgL1BhZ2UgZGljdGlvbmFyeS4iKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICghbm9kZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoISgwLCBfcHJpbWl0aXZlcy5pc0RpY3QpKG5vZGUpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIk5vZGUgbXVzdCBiZSBhIGRpY3Rpb25hcnkuIik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBwYXJlbnRSZWYgPSBub2RlLmdldFJhdygiUGFyZW50Iik7CiAgICAgICAgICAgICAgcmV0dXJuIG5vZGUuZ2V0QXN5bmMoIlBhcmVudCIpOwogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChwYXJlbnQpIHsKICAgICAgICAgICAgICBpZiAoIXBhcmVudCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoISgwLCBfcHJpbWl0aXZlcy5pc0RpY3QpKHBhcmVudCkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiUGFyZW50IG11c3QgYmUgYSBkaWN0aW9uYXJ5LiIpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudC5nZXRBc3luYygiS2lkcyIpOwogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChraWRzKSB7CiAgICAgICAgICAgICAgaWYgKCFraWRzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBraWRQcm9taXNlcyA9IFtdOwogICAgICAgICAgICAgIHZhciBmb3VuZCA9IGZhbHNlOwoKICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBraWRzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgICAgIHZhciBraWQgPSBraWRzW2ldOwoKICAgICAgICAgICAgICAgIGlmICghKDAsIF9wcmltaXRpdmVzLmlzUmVmKShraWQpKSB7CiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiS2lkIG11c3QgYmUgYSByZWZlcmVuY2UuIik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc1JlZnNFcXVhbCkoa2lkLCBraWRSZWYpKSB7CiAgICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAga2lkUHJvbWlzZXMucHVzaCh4cmVmLmZldGNoQXN5bmMoa2lkKS50aGVuKGZ1bmN0aW9uIChraWQpIHsKICAgICAgICAgICAgICAgICAgaWYgKCEoMCwgX3ByaW1pdGl2ZXMuaXNEaWN0KShraWQpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJLaWQgbm9kZSBtdXN0IGJlIGEgZGljdGlvbmFyeS4iKTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgaWYgKGtpZC5oYXMoIkNvdW50IikpIHsKICAgICAgICAgICAgICAgICAgICB0b3RhbCArPSBraWQuZ2V0KCJDb3VudCIpOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRvdGFsKys7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICghZm91bmQpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiS2lkIHJlZmVyZW5jZSBub3QgZm91bmQgaW4gcGFyZW50J3Mga2lkcy4iKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLmFsbChraWRQcm9taXNlcykudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gW3RvdGFsLCBwYXJlbnRSZWZdOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgdG90YWwgPSAwOwoKICAgICAgICAgIGZ1bmN0aW9uIG5leHQocmVmKSB7CiAgICAgICAgICAgIHJldHVybiBwYWdlc0JlZm9yZVJlZihyZWYpLnRoZW4oZnVuY3Rpb24gKGFyZ3MpIHsKICAgICAgICAgICAgICBpZiAoIWFyZ3MpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0b3RhbDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBfYXJncyA9IF9zbGljZWRUb0FycmF5KGFyZ3MsIDIpLAogICAgICAgICAgICAgICAgY291bnQgPSBfYXJnc1swXSwKICAgICAgICAgICAgICAgIHBhcmVudFJlZiA9IF9hcmdzWzFdOwoKICAgICAgICAgICAgICB0b3RhbCArPSBjb3VudDsKICAgICAgICAgICAgICByZXR1cm4gbmV4dChwYXJlbnRSZWYpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gbmV4dChwYWdlUmVmKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJtZXRhZGF0YSIsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICB2YXIgc3RyZWFtUmVmID0gdGhpcy5jYXREaWN0LmdldFJhdygiTWV0YWRhdGEiKTsKCiAgICAgICAgICBpZiAoISgwLCBfcHJpbWl0aXZlcy5pc1JlZikoc3RyZWFtUmVmKSkgewogICAgICAgICAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgIm1ldGFkYXRhIiwgbnVsbCk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHN1cHByZXNzRW5jcnlwdGlvbiA9ICEodGhpcy54cmVmLmVuY3J5cHQgJiYgdGhpcy54cmVmLmVuY3J5cHQuZW5jcnlwdE1ldGFkYXRhKTsKICAgICAgICAgIHZhciBzdHJlYW0gPSB0aGlzLnhyZWYuZmV0Y2goc3RyZWFtUmVmLCBzdXBwcmVzc0VuY3J5cHRpb24pOwogICAgICAgICAgdmFyIG1ldGFkYXRhOwoKICAgICAgICAgIGlmIChzdHJlYW0gJiYgKDAsIF9wcmltaXRpdmVzLmlzRGljdCkoc3RyZWFtLmRpY3QpKSB7CiAgICAgICAgICAgIHZhciB0eXBlID0gc3RyZWFtLmRpY3QuZ2V0KCJUeXBlIik7CiAgICAgICAgICAgIHZhciBzdWJ0eXBlID0gc3RyZWFtLmRpY3QuZ2V0KCJTdWJ0eXBlIik7CgogICAgICAgICAgICBpZiAoKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkodHlwZSwgIk1ldGFkYXRhIikgJiYgKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkoc3VidHlwZSwgIlhNTCIpKSB7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIG1ldGFkYXRhID0gKDAsIF91dGlsLnN0cmluZ1RvVVRGOFN0cmluZykoKDAsIF91dGlsLmJ5dGVzVG9TdHJpbmcpKHN0cmVhbS5nZXRCeXRlcygpKSk7CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBfY29yZV91dGlscy5NaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgICAgICAgICAgICB0aHJvdyBlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICgwLCBfdXRpbC5pbmZvKSgiU2tpcHBpbmcgaW52YWxpZCBtZXRhZGF0YS4iKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgIm1ldGFkYXRhIiwgbWV0YWRhdGEpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInRvcGxldmVsUGFnZXNEaWN0IiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHZhciBwYWdlc09iaiA9IHRoaXMuY2F0RGljdC5nZXQoIlBhZ2VzIik7CgogICAgICAgICAgaWYgKCEoMCwgX3ByaW1pdGl2ZXMuaXNEaWN0KShwYWdlc09iaikpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJJbnZhbGlkIHRvcC1sZXZlbCBwYWdlcyBkaWN0aW9uYXJ5LiIpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAidG9wbGV2ZWxQYWdlc0RpY3QiLCBwYWdlc09iaik7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZG9jdW1lbnRPdXRsaW5lIiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHZhciBvYmogPSBudWxsOwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIG9iaiA9IHRoaXMuX3JlYWREb2N1bWVudE91dGxpbmUoKTsKICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgICAgIGlmIChleCBpbnN0YW5jZW9mIF9jb3JlX3V0aWxzLk1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgdGhyb3cgZXg7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiVW5hYmxlIHRvIHJlYWQgZG9jdW1lbnQgb3V0bGluZS4iKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgImRvY3VtZW50T3V0bGluZSIsIG9iaik7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAicGVybWlzc2lvbnMiLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgdmFyIHBlcm1pc3Npb25zID0gbnVsbDsKCiAgICAgICAgICB0cnkgewogICAgICAgICAgICBwZXJtaXNzaW9ucyA9IHRoaXMuX3JlYWRQZXJtaXNzaW9ucygpOwogICAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgICAgaWYgKGV4IGluc3RhbmNlb2YgX2NvcmVfdXRpbHMuTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICAgICAgICB0aHJvdyBleDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJVbmFibGUgdG8gcmVhZCBwZXJtaXNzaW9ucy4iKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgInBlcm1pc3Npb25zIiwgcGVybWlzc2lvbnMpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIm51bVBhZ2VzIiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHZhciBvYmogPSB0aGlzLnRvcGxldmVsUGFnZXNEaWN0LmdldCgiQ291bnQiKTsKCiAgICAgICAgICBpZiAoIU51bWJlci5pc0ludGVnZXIob2JqKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIlBhZ2UgY291bnQgaW4gdG9wLWxldmVsIHBhZ2VzIGRpY3Rpb25hcnkgaXMgbm90IGFuIGludGVnZXIuIik7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJudW1QYWdlcyIsIG9iaik7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZGVzdGluYXRpb25zIiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHZhciBvYmogPSB0aGlzLl9yZWFkRGVzdHMoKSwKICAgICAgICAgICAgZGVzdHMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwoKICAgICAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBOYW1lVHJlZSkgewogICAgICAgICAgICB2YXIgbmFtZXMgPSBvYmouZ2V0QWxsKCk7CgogICAgICAgICAgICBmb3IgKHZhciBuYW1lIGluIG5hbWVzKSB7CiAgICAgICAgICAgICAgZGVzdHNbbmFtZV0gPSBmZXRjaERlc3RpbmF0aW9uKG5hbWVzW25hbWVdKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIGlmIChvYmogaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0KSB7CiAgICAgICAgICAgIG9iai5mb3JFYWNoKGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CiAgICAgICAgICAgICAgaWYgKHZhbHVlKSB7CiAgICAgICAgICAgICAgICBkZXN0c1trZXldID0gZmV0Y2hEZXN0aW5hdGlvbih2YWx1ZSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgImRlc3RpbmF0aW9ucyIsIGRlc3RzKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJwYWdlTGFiZWxzIiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHZhciBvYmogPSBudWxsOwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIG9iaiA9IHRoaXMuX3JlYWRQYWdlTGFiZWxzKCk7CiAgICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgICBpZiAoZXggaW5zdGFuY2VvZiBfY29yZV91dGlscy5NaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgICAgICAgIHRocm93IGV4OwogICAgICAgICAgICB9CgogICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIlVuYWJsZSB0byByZWFkIHBhZ2UgbGFiZWxzLiIpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAicGFnZUxhYmVscyIsIG9iaik7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAicGFnZUxheW91dCIsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICB2YXIgb2JqID0gdGhpcy5jYXREaWN0LmdldCgiUGFnZUxheW91dCIpOwogICAgICAgICAgdmFyIHBhZ2VMYXlvdXQgPSAiIjsKCiAgICAgICAgICBpZiAoKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkob2JqKSkgewogICAgICAgICAgICBzd2l0Y2ggKG9iai5uYW1lKSB7CiAgICAgICAgICAgICAgY2FzZSAiU2luZ2xlUGFnZSI6CiAgICAgICAgICAgICAgY2FzZSAiT25lQ29sdW1uIjoKICAgICAgICAgICAgICBjYXNlICJUd29Db2x1bW5MZWZ0IjoKICAgICAgICAgICAgICBjYXNlICJUd29Db2x1bW5SaWdodCI6CiAgICAgICAgICAgICAgY2FzZSAiVHdvUGFnZUxlZnQiOgogICAgICAgICAgICAgIGNhc2UgIlR3b1BhZ2VSaWdodCI6CiAgICAgICAgICAgICAgICBwYWdlTGF5b3V0ID0gb2JqLm5hbWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgInBhZ2VMYXlvdXQiLCBwYWdlTGF5b3V0KTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJwYWdlTW9kZSIsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICB2YXIgb2JqID0gdGhpcy5jYXREaWN0LmdldCgiUGFnZU1vZGUiKTsKICAgICAgICAgIHZhciBwYWdlTW9kZSA9ICJVc2VOb25lIjsKCiAgICAgICAgICBpZiAoKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkob2JqKSkgewogICAgICAgICAgICBzd2l0Y2ggKG9iai5uYW1lKSB7CiAgICAgICAgICAgICAgY2FzZSAiVXNlTm9uZSI6CiAgICAgICAgICAgICAgY2FzZSAiVXNlT3V0bGluZXMiOgogICAgICAgICAgICAgIGNhc2UgIlVzZVRodW1icyI6CiAgICAgICAgICAgICAgY2FzZSAiRnVsbFNjcmVlbiI6CiAgICAgICAgICAgICAgY2FzZSAiVXNlT0MiOgogICAgICAgICAgICAgIGNhc2UgIlVzZUF0dGFjaG1lbnRzIjoKICAgICAgICAgICAgICAgIHBhZ2VNb2RlID0gb2JqLm5hbWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgInBhZ2VNb2RlIiwgcGFnZU1vZGUpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInZpZXdlclByZWZlcmVuY2VzIiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgICAgIHZhciBWaWV3ZXJQcmVmZXJlbmNlc1ZhbGlkYXRvcnMgPSB7CiAgICAgICAgICAgIEhpZGVUb29sYmFyOiBfdXRpbC5pc0Jvb2wsCiAgICAgICAgICAgIEhpZGVNZW51YmFyOiBfdXRpbC5pc0Jvb2wsCiAgICAgICAgICAgIEhpZGVXaW5kb3dVSTogX3V0aWwuaXNCb29sLAogICAgICAgICAgICBGaXRXaW5kb3c6IF91dGlsLmlzQm9vbCwKICAgICAgICAgICAgQ2VudGVyV2luZG93OiBfdXRpbC5pc0Jvb2wsCiAgICAgICAgICAgIERpc3BsYXlEb2NUaXRsZTogX3V0aWwuaXNCb29sLAogICAgICAgICAgICBOb25GdWxsU2NyZWVuUGFnZU1vZGU6IF9wcmltaXRpdmVzLmlzTmFtZSwKICAgICAgICAgICAgRGlyZWN0aW9uOiBfcHJpbWl0aXZlcy5pc05hbWUsCiAgICAgICAgICAgIFZpZXdBcmVhOiBfcHJpbWl0aXZlcy5pc05hbWUsCiAgICAgICAgICAgIFZpZXdDbGlwOiBfcHJpbWl0aXZlcy5pc05hbWUsCiAgICAgICAgICAgIFByaW50QXJlYTogX3ByaW1pdGl2ZXMuaXNOYW1lLAogICAgICAgICAgICBQcmludENsaXA6IF9wcmltaXRpdmVzLmlzTmFtZSwKICAgICAgICAgICAgUHJpbnRTY2FsaW5nOiBfcHJpbWl0aXZlcy5pc05hbWUsCiAgICAgICAgICAgIER1cGxleDogX3ByaW1pdGl2ZXMuaXNOYW1lLAogICAgICAgICAgICBQaWNrVHJheUJ5UERGU2l6ZTogX3V0aWwuaXNCb29sLAogICAgICAgICAgICBQcmludFBhZ2VSYW5nZTogQXJyYXkuaXNBcnJheSwKICAgICAgICAgICAgTnVtQ29waWVzOiBOdW1iZXIuaXNJbnRlZ2VyCiAgICAgICAgICB9OwogICAgICAgICAgdmFyIG9iaiA9IHRoaXMuY2F0RGljdC5nZXQoIlZpZXdlclByZWZlcmVuY2VzIik7CiAgICAgICAgICB2YXIgcHJlZnMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwoKICAgICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNEaWN0KShvYmopKSB7CiAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBWaWV3ZXJQcmVmZXJlbmNlc1ZhbGlkYXRvcnMpIHsKICAgICAgICAgICAgICBpZiAoIW9iai5oYXMoa2V5KSkgewogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBvYmouZ2V0KGtleSk7CgogICAgICAgICAgICAgIGlmICghVmlld2VyUHJlZmVyZW5jZXNWYWxpZGF0b3JzW2tleV0odmFsdWUpKSB7CiAgICAgICAgICAgICAgICAoMCwgX3V0aWwuaW5mbykoIkJhZCB2YWx1ZSBpbiBWaWV3ZXJQcmVmZXJlbmNlcyBmb3IgXCIiLmNvbmNhdChrZXksICJcIi4iKSk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBwcmVmVmFsdWUgPSB2b2lkIDA7CgogICAgICAgICAgICAgIHN3aXRjaCAoa2V5KSB7CiAgICAgICAgICAgICAgICBjYXNlICJOb25GdWxsU2NyZWVuUGFnZU1vZGUiOgogICAgICAgICAgICAgICAgICBzd2l0Y2ggKHZhbHVlLm5hbWUpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlICJVc2VOb25lIjoKICAgICAgICAgICAgICAgICAgICBjYXNlICJVc2VPdXRsaW5lcyI6CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiVXNlVGh1bWJzIjoKICAgICAgICAgICAgICAgICAgICBjYXNlICJVc2VPQyI6CiAgICAgICAgICAgICAgICAgICAgICBwcmVmVmFsdWUgPSB2YWx1ZS5uYW1lOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICBwcmVmVmFsdWUgPSAiVXNlTm9uZSI7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIGNhc2UgIkRpcmVjdGlvbiI6CiAgICAgICAgICAgICAgICAgIHN3aXRjaCAodmFsdWUubmFtZSkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgIkwyUiI6CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiUjJMIjoKICAgICAgICAgICAgICAgICAgICAgIHByZWZWYWx1ZSA9IHZhbHVlLm5hbWU7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgIHByZWZWYWx1ZSA9ICJMMlIiOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlICJWaWV3QXJlYSI6CiAgICAgICAgICAgICAgICBjYXNlICJWaWV3Q2xpcCI6CiAgICAgICAgICAgICAgICBjYXNlICJQcmludEFyZWEiOgogICAgICAgICAgICAgICAgY2FzZSAiUHJpbnRDbGlwIjoKICAgICAgICAgICAgICAgICAgc3dpdGNoICh2YWx1ZS5uYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiTWVkaWFCb3giOgogICAgICAgICAgICAgICAgICAgIGNhc2UgIkNyb3BCb3giOgogICAgICAgICAgICAgICAgICAgIGNhc2UgIkJsZWVkQm94IjoKICAgICAgICAgICAgICAgICAgICBjYXNlICJUcmltQm94IjoKICAgICAgICAgICAgICAgICAgICBjYXNlICJBcnRCb3giOgogICAgICAgICAgICAgICAgICAgICAgcHJlZlZhbHVlID0gdmFsdWUubmFtZTsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgcHJlZlZhbHVlID0gIkNyb3BCb3giOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlICJQcmludFNjYWxpbmciOgogICAgICAgICAgICAgICAgICBzd2l0Y2ggKHZhbHVlLm5hbWUpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlICJOb25lIjoKICAgICAgICAgICAgICAgICAgICBjYXNlICJBcHBEZWZhdWx0IjoKICAgICAgICAgICAgICAgICAgICAgIHByZWZWYWx1ZSA9IHZhbHVlLm5hbWU7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgIHByZWZWYWx1ZSA9ICJBcHBEZWZhdWx0IjsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSAiRHVwbGV4IjoKICAgICAgICAgICAgICAgICAgc3dpdGNoICh2YWx1ZS5uYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiU2ltcGxleCI6CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiRHVwbGV4RmxpcFNob3J0RWRnZSI6CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiRHVwbGV4RmxpcExvbmdFZGdlIjoKICAgICAgICAgICAgICAgICAgICAgIHByZWZWYWx1ZSA9IHZhbHVlLm5hbWU7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgIHByZWZWYWx1ZSA9ICJOb25lIjsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSAiUHJpbnRQYWdlUmFuZ2UiOgogICAgICAgICAgICAgICAgICB2YXIgbGVuZ3RoID0gdmFsdWUubGVuZ3RoOwoKICAgICAgICAgICAgICAgICAgaWYgKGxlbmd0aCAlIDIgIT09IDApIHsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgdmFyIGlzVmFsaWQgPSB2YWx1ZS5ldmVyeShmdW5jdGlvbiAocGFnZSwgaSwgYXJyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE51bWJlci5pc0ludGVnZXIocGFnZSkgJiYgcGFnZSA+IDAgJiYgKGkgPT09IDAgfHwgcGFnZSA+PSBhcnJbaSAtIDFdKSAmJiBwYWdlIDw9IF90aGlzMi5udW1QYWdlczsKICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICBpZiAoaXNWYWxpZCkgewogICAgICAgICAgICAgICAgICAgIHByZWZWYWx1ZSA9IHZhbHVlOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlICJOdW1Db3BpZXMiOgogICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgcHJlZlZhbHVlID0gdmFsdWU7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICgwLCBfdXRpbC5hc3NlcnQpKHR5cGVvZiB2YWx1ZSA9PT0gImJvb2xlYW4iKTsKICAgICAgICAgICAgICAgICAgcHJlZlZhbHVlID0gdmFsdWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAocHJlZlZhbHVlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHByZWZzW2tleV0gPSBwcmVmVmFsdWU7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICgwLCBfdXRpbC5pbmZvKSgiQmFkIHZhbHVlIGluIFZpZXdlclByZWZlcmVuY2VzIGZvciBcIiIuY29uY2F0KGtleSwgIlwiLiIpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgInZpZXdlclByZWZlcmVuY2VzIiwgcHJlZnMpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIm9wZW5BY3Rpb24iLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgdmFyIG9iaiA9IHRoaXMuY2F0RGljdC5nZXQoIk9wZW5BY3Rpb24iKTsKICAgICAgICAgIHZhciBvcGVuQWN0aW9uID0gbnVsbDsKCiAgICAgICAgICBpZiAoKDAsIF9wcmltaXRpdmVzLmlzRGljdCkob2JqKSkgewogICAgICAgICAgICB2YXIgZGVzdERpY3QgPSBuZXcgX3ByaW1pdGl2ZXMuRGljdCh0aGlzLnhyZWYpOwogICAgICAgICAgICBkZXN0RGljdC5zZXQoIkEiLCBvYmopOwogICAgICAgICAgICB2YXIgcmVzdWx0T2JqID0gewogICAgICAgICAgICAgIHVybDogbnVsbCwKICAgICAgICAgICAgICBkZXN0OiBudWxsLAogICAgICAgICAgICAgIGFjdGlvbjogbnVsbAogICAgICAgICAgICB9OwogICAgICAgICAgICBDYXRhbG9nLnBhcnNlRGVzdERpY3Rpb25hcnkoewogICAgICAgICAgICAgIGRlc3REaWN0OiBkZXN0RGljdCwKICAgICAgICAgICAgICByZXN1bHRPYmo6IHJlc3VsdE9iagogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHJlc3VsdE9iai5kZXN0KSkgewogICAgICAgICAgICAgIGlmICghb3BlbkFjdGlvbikgewogICAgICAgICAgICAgICAgb3BlbkFjdGlvbiA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBvcGVuQWN0aW9uLmRlc3QgPSByZXN1bHRPYmouZGVzdDsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXN1bHRPYmouYWN0aW9uKSB7CiAgICAgICAgICAgICAgaWYgKCFvcGVuQWN0aW9uKSB7CiAgICAgICAgICAgICAgICBvcGVuQWN0aW9uID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIG9wZW5BY3Rpb24uYWN0aW9uID0gcmVzdWx0T2JqLmFjdGlvbjsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHsKICAgICAgICAgICAgaWYgKCFvcGVuQWN0aW9uKSB7CiAgICAgICAgICAgICAgb3BlbkFjdGlvbiA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG9wZW5BY3Rpb24uZGVzdCA9IG9iajsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgIm9wZW5BY3Rpb24iLCBvcGVuQWN0aW9uKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJhdHRhY2htZW50cyIsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICB2YXIgb2JqID0gdGhpcy5jYXREaWN0LmdldCgiTmFtZXMiKTsKICAgICAgICAgIHZhciBhdHRhY2htZW50cyA9IG51bGw7CgogICAgICAgICAgaWYgKG9iaiAmJiBvYmouaGFzKCJFbWJlZGRlZEZpbGVzIikpIHsKICAgICAgICAgICAgdmFyIG5hbWVUcmVlID0gbmV3IE5hbWVUcmVlKG9iai5nZXRSYXcoIkVtYmVkZGVkRmlsZXMiKSwgdGhpcy54cmVmKTsKICAgICAgICAgICAgdmFyIG5hbWVzID0gbmFtZVRyZWUuZ2V0QWxsKCk7CgogICAgICAgICAgICBmb3IgKHZhciBuYW1lIGluIG5hbWVzKSB7CiAgICAgICAgICAgICAgdmFyIGZzID0gbmV3IEZpbGVTcGVjKG5hbWVzW25hbWVdLCB0aGlzLnhyZWYpOwoKICAgICAgICAgICAgICBpZiAoIWF0dGFjaG1lbnRzKSB7CiAgICAgICAgICAgICAgICBhdHRhY2htZW50cyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBhdHRhY2htZW50c1soMCwgX3V0aWwuc3RyaW5nVG9QREZTdHJpbmcpKG5hbWUpXSA9IGZzLnNlcmlhbGl6YWJsZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAiYXR0YWNobWVudHMiLCBhdHRhY2htZW50cyk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiamF2YVNjcmlwdCIsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICB2YXIgb2JqID0gdGhpcy5jYXREaWN0LmdldCgiTmFtZXMiKTsKICAgICAgICAgIHZhciBqYXZhU2NyaXB0ID0gbnVsbDsKCiAgICAgICAgICBmdW5jdGlvbiBhcHBlbmRJZkphdmFTY3JpcHREaWN0KGpzRGljdCkgewogICAgICAgICAgICB2YXIgdHlwZSA9IGpzRGljdC5nZXQoIlMiKTsKCiAgICAgICAgICAgIGlmICghKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkodHlwZSwgIkphdmFTY3JpcHQiKSkgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGpzID0ganNEaWN0LmdldCgiSlMiKTsKCiAgICAgICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNTdHJlYW0pKGpzKSkgewogICAgICAgICAgICAgIGpzID0gKDAsIF91dGlsLmJ5dGVzVG9TdHJpbmcpKGpzLmdldEJ5dGVzKCkpOwogICAgICAgICAgICB9IGVsc2UgaWYgKCEoMCwgX3V0aWwuaXNTdHJpbmcpKGpzKSkgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCFqYXZhU2NyaXB0KSB7CiAgICAgICAgICAgICAgamF2YVNjcmlwdCA9IFtdOwogICAgICAgICAgICB9CgogICAgICAgICAgICBqYXZhU2NyaXB0LnB1c2goKDAsIF91dGlsLnN0cmluZ1RvUERGU3RyaW5nKShqcykpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChvYmogJiYgb2JqLmhhcygiSmF2YVNjcmlwdCIpKSB7CiAgICAgICAgICAgIHZhciBuYW1lVHJlZSA9IG5ldyBOYW1lVHJlZShvYmouZ2V0UmF3KCJKYXZhU2NyaXB0IiksIHRoaXMueHJlZik7CiAgICAgICAgICAgIHZhciBuYW1lcyA9IG5hbWVUcmVlLmdldEFsbCgpOwoKICAgICAgICAgICAgZm9yICh2YXIgbmFtZSBpbiBuYW1lcykgewogICAgICAgICAgICAgIHZhciBqc0RpY3QgPSBuYW1lc1tuYW1lXTsKCiAgICAgICAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc0RpY3QpKGpzRGljdCkpIHsKICAgICAgICAgICAgICAgIGFwcGVuZElmSmF2YVNjcmlwdERpY3QoanNEaWN0KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgb3BlbkFjdGlvbiA9IHRoaXMuY2F0RGljdC5nZXQoIk9wZW5BY3Rpb24iKTsKCiAgICAgICAgICBpZiAoKDAsIF9wcmltaXRpdmVzLmlzRGljdCkob3BlbkFjdGlvbikgJiYgKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkob3BlbkFjdGlvbi5nZXQoIlMiKSwgIkphdmFTY3JpcHQiKSkgewogICAgICAgICAgICBhcHBlbmRJZkphdmFTY3JpcHREaWN0KG9wZW5BY3Rpb24pOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAiamF2YVNjcmlwdCIsIGphdmFTY3JpcHQpOwogICAgICAgIH0KICAgICAgfV0sIFt7CiAgICAgICAga2V5OiAicGFyc2VEZXN0RGljdGlvbmFyeSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHBhcnNlRGVzdERpY3Rpb25hcnkocGFyYW1zKSB7CiAgICAgICAgICBmdW5jdGlvbiBhZGREZWZhdWx0UHJvdG9jb2xUb1VybCh1cmwpIHsKICAgICAgICAgICAgcmV0dXJuIHVybC5zdGFydHNXaXRoKCJ3d3cuIikgPyAiaHR0cDovLyIuY29uY2F0KHVybCkgOiB1cmw7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gdHJ5Q29udmVydFVybEVuY29kaW5nKHVybCkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHJldHVybiAoMCwgX3V0aWwuc3RyaW5nVG9VVEY4U3RyaW5nKSh1cmwpOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHVybDsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHZhciBkZXN0RGljdCA9IHBhcmFtcy5kZXN0RGljdDsKCiAgICAgICAgICBpZiAoISgwLCBfcHJpbWl0aXZlcy5pc0RpY3QpKGRlc3REaWN0KSkgewogICAgICAgICAgICAoMCwgX3V0aWwud2FybikoInBhcnNlRGVzdERpY3Rpb25hcnk6IGBkZXN0RGljdGAgbXVzdCBiZSBhIGRpY3Rpb25hcnkuIik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcmVzdWx0T2JqID0gcGFyYW1zLnJlc3VsdE9iajsKCiAgICAgICAgICBpZiAoX3R5cGVvZihyZXN1bHRPYmopICE9PSAib2JqZWN0IikgewogICAgICAgICAgICAoMCwgX3V0aWwud2FybikoInBhcnNlRGVzdERpY3Rpb25hcnk6IGByZXN1bHRPYmpgIG11c3QgYmUgYW4gb2JqZWN0LiIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGRvY0Jhc2VVcmwgPSBwYXJhbXMuZG9jQmFzZVVybCB8fCBudWxsOwogICAgICAgICAgdmFyIGFjdGlvbiA9IGRlc3REaWN0LmdldCgiQSIpLAogICAgICAgICAgICB1cmwsCiAgICAgICAgICAgIGRlc3Q7CgogICAgICAgICAgaWYgKCEoMCwgX3ByaW1pdGl2ZXMuaXNEaWN0KShhY3Rpb24pICYmIGRlc3REaWN0LmhhcygiRGVzdCIpKSB7CiAgICAgICAgICAgIGFjdGlvbiA9IGRlc3REaWN0LmdldCgiRGVzdCIpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNEaWN0KShhY3Rpb24pKSB7CiAgICAgICAgICAgIHZhciBhY3Rpb25UeXBlID0gYWN0aW9uLmdldCgiUyIpOwoKICAgICAgICAgICAgaWYgKCEoMCwgX3ByaW1pdGl2ZXMuaXNOYW1lKShhY3Rpb25UeXBlKSkgewogICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgicGFyc2VEZXN0RGljdGlvbmFyeTogSW52YWxpZCB0eXBlIGluIEFjdGlvbiBkaWN0aW9uYXJ5LiIpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGFjdGlvbk5hbWUgPSBhY3Rpb25UeXBlLm5hbWU7CgogICAgICAgICAgICBzd2l0Y2ggKGFjdGlvbk5hbWUpIHsKICAgICAgICAgICAgICBjYXNlICJVUkkiOgogICAgICAgICAgICAgICAgdXJsID0gYWN0aW9uLmdldCgiVVJJIik7CgogICAgICAgICAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc05hbWUpKHVybCkpIHsKICAgICAgICAgICAgICAgICAgdXJsID0gIi8iICsgdXJsLm5hbWU7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCgwLCBfdXRpbC5pc1N0cmluZykodXJsKSkgewogICAgICAgICAgICAgICAgICB1cmwgPSBhZGREZWZhdWx0UHJvdG9jb2xUb1VybCh1cmwpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICJHb1RvIjoKICAgICAgICAgICAgICAgIGRlc3QgPSBhY3Rpb24uZ2V0KCJEIik7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAiTGF1bmNoIjoKICAgICAgICAgICAgICBjYXNlICJHb1RvUiI6CiAgICAgICAgICAgICAgICB2YXIgdXJsRGljdCA9IGFjdGlvbi5nZXQoIkYiKTsKCiAgICAgICAgICAgICAgICBpZiAoKDAsIF9wcmltaXRpdmVzLmlzRGljdCkodXJsRGljdCkpIHsKICAgICAgICAgICAgICAgICAgdXJsID0gdXJsRGljdC5nZXQoIkYiKSB8fCBudWxsOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICgoMCwgX3V0aWwuaXNTdHJpbmcpKHVybERpY3QpKSB7CiAgICAgICAgICAgICAgICAgIHVybCA9IHVybERpY3Q7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdmFyIHJlbW90ZURlc3QgPSBhY3Rpb24uZ2V0KCJEIik7CgogICAgICAgICAgICAgICAgaWYgKHJlbW90ZURlc3QpIHsKICAgICAgICAgICAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc05hbWUpKHJlbW90ZURlc3QpKSB7CiAgICAgICAgICAgICAgICAgICAgcmVtb3RlRGVzdCA9IHJlbW90ZURlc3QubmFtZTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgaWYgKCgwLCBfdXRpbC5pc1N0cmluZykodXJsKSkgewogICAgICAgICAgICAgICAgICAgIHZhciBiYXNlVXJsID0gdXJsLnNwbGl0KCIjIilbMF07CgogICAgICAgICAgICAgICAgICAgIGlmICgoMCwgX3V0aWwuaXNTdHJpbmcpKHJlbW90ZURlc3QpKSB7CiAgICAgICAgICAgICAgICAgICAgICB1cmwgPSBiYXNlVXJsICsgIiMiICsgcmVtb3RlRGVzdDsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkocmVtb3RlRGVzdCkpIHsKICAgICAgICAgICAgICAgICAgICAgIHVybCA9IGJhc2VVcmwgKyAiIyIgKyBKU09OLnN0cmluZ2lmeShyZW1vdGVEZXN0KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgbmV3V2luZG93ID0gYWN0aW9uLmdldCgiTmV3V2luZG93Iik7CgogICAgICAgICAgICAgICAgaWYgKCgwLCBfdXRpbC5pc0Jvb2wpKG5ld1dpbmRvdykpIHsKICAgICAgICAgICAgICAgICAgcmVzdWx0T2JqLm5ld1dpbmRvdyA9IG5ld1dpbmRvdzsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAiTmFtZWQiOgogICAgICAgICAgICAgICAgdmFyIG5hbWVkQWN0aW9uID0gYWN0aW9uLmdldCgiTiIpOwoKICAgICAgICAgICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNOYW1lKShuYW1lZEFjdGlvbikpIHsKICAgICAgICAgICAgICAgICAgcmVzdWx0T2JqLmFjdGlvbiA9IG5hbWVkQWN0aW9uLm5hbWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgIkphdmFTY3JpcHQiOgogICAgICAgICAgICAgICAgdmFyIGpzQWN0aW9uID0gYWN0aW9uLmdldCgiSlMiKTsKICAgICAgICAgICAgICAgIHZhciBqczsKCiAgICAgICAgICAgICAgICBpZiAoKDAsIF9wcmltaXRpdmVzLmlzU3RyZWFtKShqc0FjdGlvbikpIHsKICAgICAgICAgICAgICAgICAganMgPSAoMCwgX3V0aWwuYnl0ZXNUb1N0cmluZykoanNBY3Rpb24uZ2V0Qnl0ZXMoKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCgwLCBfdXRpbC5pc1N0cmluZykoanNBY3Rpb24pKSB7CiAgICAgICAgICAgICAgICAgIGpzID0ganNBY3Rpb247CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGpzKSB7CiAgICAgICAgICAgICAgICAgIHZhciBVUkxfT1BFTl9NRVRIT0RTID0gWyJhcHAubGF1bmNoVVJMIiwgIndpbmRvdy5vcGVuIl07CiAgICAgICAgICAgICAgICAgIHZhciByZWdleCA9IG5ldyBSZWdFeHAoIl5cXHMqKCIgKyBVUkxfT1BFTl9NRVRIT0RTLmpvaW4oInwiKS5zcGxpdCgiLiIpLmpvaW4oIlxcLiIpICsgIilcXCgoPzonfFwiKShbXidcIl0qKSg/Oid8XCIpKD86LFxccyooXFx3KylcXCl8XFwpKSIsICJpIik7CiAgICAgICAgICAgICAgICAgIHZhciBqc1VybCA9IHJlZ2V4LmV4ZWMoKDAsIF91dGlsLnN0cmluZ1RvUERGU3RyaW5nKShqcykpOwoKICAgICAgICAgICAgICAgICAgaWYgKGpzVXJsICYmIGpzVXJsWzJdKSB7CiAgICAgICAgICAgICAgICAgICAgdXJsID0ganNVcmxbMl07CgogICAgICAgICAgICAgICAgICAgIGlmIChqc1VybFszXSA9PT0gInRydWUiICYmIGpzVXJsWzFdID09PSAiYXBwLmxhdW5jaFVSTCIpIHsKICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdE9iai5uZXdXaW5kb3cgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgicGFyc2VEZXN0RGljdGlvbmFyeTogdW5zdXBwb3J0ZWQgYWN0aW9uIHR5cGUgXCIiLmNvbmNhdChhY3Rpb25OYW1lLCAiXCIuIikpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAoZGVzdERpY3QuaGFzKCJEZXN0IikpIHsKICAgICAgICAgICAgZGVzdCA9IGRlc3REaWN0LmdldCgiRGVzdCIpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICgoMCwgX3V0aWwuaXNTdHJpbmcpKHVybCkpIHsKICAgICAgICAgICAgdXJsID0gdHJ5Q29udmVydFVybEVuY29kaW5nKHVybCk7CiAgICAgICAgICAgIHZhciBhYnNvbHV0ZVVybCA9ICgwLCBfdXRpbC5jcmVhdGVWYWxpZEFic29sdXRlVXJsKSh1cmwsIGRvY0Jhc2VVcmwpOwoKICAgICAgICAgICAgaWYgKGFic29sdXRlVXJsKSB7CiAgICAgICAgICAgICAgcmVzdWx0T2JqLnVybCA9IGFic29sdXRlVXJsLmhyZWY7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJlc3VsdE9iai51bnNhZmVVcmwgPSB1cmw7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGRlc3QpIHsKICAgICAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc05hbWUpKGRlc3QpKSB7CiAgICAgICAgICAgICAgZGVzdCA9IGRlc3QubmFtZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCgwLCBfdXRpbC5pc1N0cmluZykoZGVzdCkgfHwgQXJyYXkuaXNBcnJheShkZXN0KSkgewogICAgICAgICAgICAgIHJlc3VsdE9iai5kZXN0ID0gZGVzdDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIENhdGFsb2c7CiAgICB9KCk7CgogICAgZXhwb3J0cy5DYXRhbG9nID0gQ2F0YWxvZzsKCiAgICB2YXIgWFJlZiA9IGZ1bmN0aW9uIFhSZWZDbG9zdXJlKCkgewogICAgICBmdW5jdGlvbiBYUmVmKHN0cmVhbSwgcGRmTWFuYWdlcikgewogICAgICAgIHRoaXMuc3RyZWFtID0gc3RyZWFtOwogICAgICAgIHRoaXMucGRmTWFuYWdlciA9IHBkZk1hbmFnZXI7CiAgICAgICAgdGhpcy5lbnRyaWVzID0gW107CiAgICAgICAgdGhpcy54cmVmc3RtcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgdGhpcy5fY2FjaGVNYXAgPSBuZXcgTWFwKCk7CiAgICAgICAgdGhpcy5zdGF0cyA9IHsKICAgICAgICAgIHN0cmVhbVR5cGVzOiBPYmplY3QuY3JlYXRlKG51bGwpLAogICAgICAgICAgZm9udFR5cGVzOiBPYmplY3QuY3JlYXRlKG51bGwpCiAgICAgICAgfTsKICAgICAgfQoKICAgICAgWFJlZi5wcm90b3R5cGUgPSB7CiAgICAgICAgc2V0U3RhcnRYUmVmOiBmdW5jdGlvbiBYUmVmX3NldFN0YXJ0WFJlZihzdGFydFhSZWYpIHsKICAgICAgICAgIHRoaXMuc3RhcnRYUmVmUXVldWUgPSBbc3RhcnRYUmVmXTsKICAgICAgICB9LAogICAgICAgIHBhcnNlOiBmdW5jdGlvbiBYUmVmX3BhcnNlKHJlY292ZXJ5TW9kZSkgewogICAgICAgICAgdmFyIHRyYWlsZXJEaWN0OwoKICAgICAgICAgIGlmICghcmVjb3ZlcnlNb2RlKSB7CiAgICAgICAgICAgIHRyYWlsZXJEaWN0ID0gdGhpcy5yZWFkWFJlZigpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJJbmRleGluZyBhbGwgUERGIG9iamVjdHMiKTsKICAgICAgICAgICAgdHJhaWxlckRpY3QgPSB0aGlzLmluZGV4T2JqZWN0cygpOwogICAgICAgICAgfQoKICAgICAgICAgIHRyYWlsZXJEaWN0LmFzc2lnblhyZWYodGhpcyk7CiAgICAgICAgICB0aGlzLnRyYWlsZXIgPSB0cmFpbGVyRGljdDsKICAgICAgICAgIHZhciBlbmNyeXB0OwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGVuY3J5cHQgPSB0cmFpbGVyRGljdC5nZXQoIkVuY3J5cHQiKTsKICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgICAgIGlmIChleCBpbnN0YW5jZW9mIF9jb3JlX3V0aWxzLk1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgdGhyb3cgZXg7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiWFJlZi5wYXJzZSAtIEludmFsaWQgXCJFbmNyeXB0XCIgcmVmZXJlbmNlOiBcIiIuY29uY2F0KGV4LCAiXCIuIikpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNEaWN0KShlbmNyeXB0KSkgewogICAgICAgICAgICB2YXIgaWRzID0gdHJhaWxlckRpY3QuZ2V0KCJJRCIpOwogICAgICAgICAgICB2YXIgZmlsZUlkID0gaWRzICYmIGlkcy5sZW5ndGggPyBpZHNbMF0gOiAiIjsKICAgICAgICAgICAgZW5jcnlwdC5zdXBwcmVzc0VuY3J5cHRpb24gPSB0cnVlOwogICAgICAgICAgICB0aGlzLmVuY3J5cHQgPSBuZXcgX2NyeXB0by5DaXBoZXJUcmFuc2Zvcm1GYWN0b3J5KGVuY3J5cHQsIGZpbGVJZCwgdGhpcy5wZGZNYW5hZ2VyLnBhc3N3b3JkKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcm9vdDsKCiAgICAgICAgICB0cnkgewogICAgICAgICAgICByb290ID0gdHJhaWxlckRpY3QuZ2V0KCJSb290Iik7CiAgICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgICBpZiAoZXggaW5zdGFuY2VvZiBfY29yZV91dGlscy5NaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgICAgICAgIHRocm93IGV4OwogICAgICAgICAgICB9CgogICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIlhSZWYucGFyc2UgLSBJbnZhbGlkIFwiUm9vdFwiIHJlZmVyZW5jZTogXCIiLmNvbmNhdChleCwgIlwiLiIpKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoKDAsIF9wcmltaXRpdmVzLmlzRGljdCkocm9vdCkgJiYgcm9vdC5oYXMoIlBhZ2VzIikpIHsKICAgICAgICAgICAgdGhpcy5yb290ID0gcm9vdDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICghcmVjb3ZlcnlNb2RlKSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IF9jb3JlX3V0aWxzLlhSZWZQYXJzZUV4Y2VwdGlvbigpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkludmFsaWQgcm9vdCByZWZlcmVuY2UiKTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHByb2Nlc3NYUmVmVGFibGU6IGZ1bmN0aW9uIFhSZWZfcHJvY2Vzc1hSZWZUYWJsZShwYXJzZXIpIHsKICAgICAgICAgIGlmICghKCJ0YWJsZVN0YXRlIiBpbiB0aGlzKSkgewogICAgICAgICAgICB0aGlzLnRhYmxlU3RhdGUgPSB7CiAgICAgICAgICAgICAgZW50cnlOdW06IDAsCiAgICAgICAgICAgICAgc3RyZWFtUG9zOiBwYXJzZXIubGV4ZXIuc3RyZWFtLnBvcywKICAgICAgICAgICAgICBwYXJzZXJCdWYxOiBwYXJzZXIuYnVmMSwKICAgICAgICAgICAgICBwYXJzZXJCdWYyOiBwYXJzZXIuYnVmMgogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBvYmogPSB0aGlzLnJlYWRYUmVmVGFibGUocGFyc2VyKTsKCiAgICAgICAgICBpZiAoISgwLCBfcHJpbWl0aXZlcy5pc0NtZCkob2JqLCAidHJhaWxlciIpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiSW52YWxpZCBYUmVmIHRhYmxlOiBjb3VsZCBub3QgZmluZCB0cmFpbGVyIGRpY3Rpb25hcnkiKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZGljdCA9IHBhcnNlci5nZXRPYmooKTsKCiAgICAgICAgICBpZiAoISgwLCBfcHJpbWl0aXZlcy5pc0RpY3QpKGRpY3QpICYmIGRpY3QuZGljdCkgewogICAgICAgICAgICBkaWN0ID0gZGljdC5kaWN0OwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghKDAsIF9wcmltaXRpdmVzLmlzRGljdCkoZGljdCkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJJbnZhbGlkIFhSZWYgdGFibGU6IGNvdWxkIG5vdCBwYXJzZSB0cmFpbGVyIGRpY3Rpb25hcnkiKTsKICAgICAgICAgIH0KCiAgICAgICAgICBkZWxldGUgdGhpcy50YWJsZVN0YXRlOwogICAgICAgICAgcmV0dXJuIGRpY3Q7CiAgICAgICAgfSwKICAgICAgICByZWFkWFJlZlRhYmxlOiBmdW5jdGlvbiBYUmVmX3JlYWRYUmVmVGFibGUocGFyc2VyKSB7CiAgICAgICAgICB2YXIgc3RyZWFtID0gcGFyc2VyLmxleGVyLnN0cmVhbTsKICAgICAgICAgIHZhciB0YWJsZVN0YXRlID0gdGhpcy50YWJsZVN0YXRlOwogICAgICAgICAgc3RyZWFtLnBvcyA9IHRhYmxlU3RhdGUuc3RyZWFtUG9zOwogICAgICAgICAgcGFyc2VyLmJ1ZjEgPSB0YWJsZVN0YXRlLnBhcnNlckJ1ZjE7CiAgICAgICAgICBwYXJzZXIuYnVmMiA9IHRhYmxlU3RhdGUucGFyc2VyQnVmMjsKICAgICAgICAgIHZhciBvYmo7CgogICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgaWYgKCEoImZpcnN0RW50cnlOdW0iIGluIHRhYmxlU3RhdGUpIHx8ICEoImVudHJ5Q291bnQiIGluIHRhYmxlU3RhdGUpKSB7CiAgICAgICAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc0NtZCkob2JqID0gcGFyc2VyLmdldE9iaigpLCAidHJhaWxlciIpKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHRhYmxlU3RhdGUuZmlyc3RFbnRyeU51bSA9IG9iajsKICAgICAgICAgICAgICB0YWJsZVN0YXRlLmVudHJ5Q291bnQgPSBwYXJzZXIuZ2V0T2JqKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBmaXJzdCA9IHRhYmxlU3RhdGUuZmlyc3RFbnRyeU51bTsKICAgICAgICAgICAgdmFyIGNvdW50ID0gdGFibGVTdGF0ZS5lbnRyeUNvdW50OwoKICAgICAgICAgICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGZpcnN0KSB8fCAhTnVtYmVyLmlzSW50ZWdlcihjb3VudCkpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkludmFsaWQgWFJlZiB0YWJsZTogd3JvbmcgdHlwZXMgaW4gc3Vic2VjdGlvbiBoZWFkZXIiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9yICh2YXIgaSA9IHRhYmxlU3RhdGUuZW50cnlOdW07IGkgPCBjb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAgdGFibGVTdGF0ZS5zdHJlYW1Qb3MgPSBzdHJlYW0ucG9zOwogICAgICAgICAgICAgIHRhYmxlU3RhdGUuZW50cnlOdW0gPSBpOwogICAgICAgICAgICAgIHRhYmxlU3RhdGUucGFyc2VyQnVmMSA9IHBhcnNlci5idWYxOwogICAgICAgICAgICAgIHRhYmxlU3RhdGUucGFyc2VyQnVmMiA9IHBhcnNlci5idWYyOwogICAgICAgICAgICAgIHZhciBlbnRyeSA9IHt9OwogICAgICAgICAgICAgIGVudHJ5Lm9mZnNldCA9IHBhcnNlci5nZXRPYmooKTsKICAgICAgICAgICAgICBlbnRyeS5nZW4gPSBwYXJzZXIuZ2V0T2JqKCk7CiAgICAgICAgICAgICAgdmFyIHR5cGUgPSBwYXJzZXIuZ2V0T2JqKCk7CgogICAgICAgICAgICAgIGlmICh0eXBlIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuQ21kKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKHR5cGUuY21kKSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgImYiOgogICAgICAgICAgICAgICAgICAgIGVudHJ5LmZyZWUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgY2FzZSAibiI6CiAgICAgICAgICAgICAgICAgICAgZW50cnkudW5jb21wcmVzc2VkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihlbnRyeS5vZmZzZXQpIHx8ICFOdW1iZXIuaXNJbnRlZ2VyKGVudHJ5LmdlbikgfHwgIShlbnRyeS5mcmVlIHx8IGVudHJ5LnVuY29tcHJlc3NlZCkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiSW52YWxpZCBlbnRyeSBpbiBYUmVmIHN1YnNlY3Rpb246ICIuY29uY2F0KGZpcnN0LCAiLCAiKS5jb25jYXQoY291bnQpKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChpID09PSAwICYmIGVudHJ5LmZyZWUgJiYgZmlyc3QgPT09IDEpIHsKICAgICAgICAgICAgICAgIGZpcnN0ID0gMDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICghdGhpcy5lbnRyaWVzW2kgKyBmaXJzdF0pIHsKICAgICAgICAgICAgICAgIHRoaXMuZW50cmllc1tpICsgZmlyc3RdID0gZW50cnk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICB0YWJsZVN0YXRlLmVudHJ5TnVtID0gMDsKICAgICAgICAgICAgdGFibGVTdGF0ZS5zdHJlYW1Qb3MgPSBzdHJlYW0ucG9zOwogICAgICAgICAgICB0YWJsZVN0YXRlLnBhcnNlckJ1ZjEgPSBwYXJzZXIuYnVmMTsKICAgICAgICAgICAgdGFibGVTdGF0ZS5wYXJzZXJCdWYyID0gcGFyc2VyLmJ1ZjI7CiAgICAgICAgICAgIGRlbGV0ZSB0YWJsZVN0YXRlLmZpcnN0RW50cnlOdW07CiAgICAgICAgICAgIGRlbGV0ZSB0YWJsZVN0YXRlLmVudHJ5Q291bnQ7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRoaXMuZW50cmllc1swXSAmJiAhdGhpcy5lbnRyaWVzWzBdLmZyZWUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJJbnZhbGlkIFhSZWYgdGFibGU6IHVuZXhwZWN0ZWQgZmlyc3Qgb2JqZWN0Iik7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIG9iajsKICAgICAgICB9LAogICAgICAgIHByb2Nlc3NYUmVmU3RyZWFtOiBmdW5jdGlvbiBYUmVmX3Byb2Nlc3NYUmVmU3RyZWFtKHN0cmVhbSkgewogICAgICAgICAgaWYgKCEoInN0cmVhbVN0YXRlIiBpbiB0aGlzKSkgewogICAgICAgICAgICB2YXIgc3RyZWFtUGFyYW1ldGVycyA9IHN0cmVhbS5kaWN0OwogICAgICAgICAgICB2YXIgYnl0ZVdpZHRocyA9IHN0cmVhbVBhcmFtZXRlcnMuZ2V0KCJXIik7CiAgICAgICAgICAgIHZhciByYW5nZSA9IHN0cmVhbVBhcmFtZXRlcnMuZ2V0KCJJbmRleCIpOwoKICAgICAgICAgICAgaWYgKCFyYW5nZSkgewogICAgICAgICAgICAgIHJhbmdlID0gWzAsIHN0cmVhbVBhcmFtZXRlcnMuZ2V0KCJTaXplIildOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLnN0cmVhbVN0YXRlID0gewogICAgICAgICAgICAgIGVudHJ5UmFuZ2VzOiByYW5nZSwKICAgICAgICAgICAgICBieXRlV2lkdGhzOiBieXRlV2lkdGhzLAogICAgICAgICAgICAgIGVudHJ5TnVtOiAwLAogICAgICAgICAgICAgIHN0cmVhbVBvczogc3RyZWFtLnBvcwogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMucmVhZFhSZWZTdHJlYW0oc3RyZWFtKTsKICAgICAgICAgIGRlbGV0ZSB0aGlzLnN0cmVhbVN0YXRlOwogICAgICAgICAgcmV0dXJuIHN0cmVhbS5kaWN0OwogICAgICAgIH0sCiAgICAgICAgcmVhZFhSZWZTdHJlYW06IGZ1bmN0aW9uIFhSZWZfcmVhZFhSZWZTdHJlYW0oc3RyZWFtKSB7CiAgICAgICAgICB2YXIgaSwgajsKICAgICAgICAgIHZhciBzdHJlYW1TdGF0ZSA9IHRoaXMuc3RyZWFtU3RhdGU7CiAgICAgICAgICBzdHJlYW0ucG9zID0gc3RyZWFtU3RhdGUuc3RyZWFtUG9zOwogICAgICAgICAgdmFyIGJ5dGVXaWR0aHMgPSBzdHJlYW1TdGF0ZS5ieXRlV2lkdGhzOwogICAgICAgICAgdmFyIHR5cGVGaWVsZFdpZHRoID0gYnl0ZVdpZHRoc1swXTsKICAgICAgICAgIHZhciBvZmZzZXRGaWVsZFdpZHRoID0gYnl0ZVdpZHRoc1sxXTsKICAgICAgICAgIHZhciBnZW5lcmF0aW9uRmllbGRXaWR0aCA9IGJ5dGVXaWR0aHNbMl07CiAgICAgICAgICB2YXIgZW50cnlSYW5nZXMgPSBzdHJlYW1TdGF0ZS5lbnRyeVJhbmdlczsKCiAgICAgICAgICB3aGlsZSAoZW50cnlSYW5nZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICB2YXIgZmlyc3QgPSBlbnRyeVJhbmdlc1swXTsKICAgICAgICAgICAgdmFyIG4gPSBlbnRyeVJhbmdlc1sxXTsKCiAgICAgICAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihmaXJzdCkgfHwgIU51bWJlci5pc0ludGVnZXIobikpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkludmFsaWQgWFJlZiByYW5nZSBmaWVsZHM6ICIuY29uY2F0KGZpcnN0LCAiLCAiKS5jb25jYXQobikpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIU51bWJlci5pc0ludGVnZXIodHlwZUZpZWxkV2lkdGgpIHx8ICFOdW1iZXIuaXNJbnRlZ2VyKG9mZnNldEZpZWxkV2lkdGgpIHx8ICFOdW1iZXIuaXNJbnRlZ2VyKGdlbmVyYXRpb25GaWVsZFdpZHRoKSkgewogICAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiSW52YWxpZCBYUmVmIGVudHJ5IGZpZWxkcyBsZW5ndGg6ICIuY29uY2F0KGZpcnN0LCAiLCAiKS5jb25jYXQobikpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmb3IgKGkgPSBzdHJlYW1TdGF0ZS5lbnRyeU51bTsgaSA8IG47ICsraSkgewogICAgICAgICAgICAgIHN0cmVhbVN0YXRlLmVudHJ5TnVtID0gaTsKICAgICAgICAgICAgICBzdHJlYW1TdGF0ZS5zdHJlYW1Qb3MgPSBzdHJlYW0ucG9zOwogICAgICAgICAgICAgIHZhciB0eXBlID0gMCwKICAgICAgICAgICAgICAgIG9mZnNldCA9IDAsCiAgICAgICAgICAgICAgICBnZW5lcmF0aW9uID0gMDsKCiAgICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IHR5cGVGaWVsZFdpZHRoOyArK2opIHsKICAgICAgICAgICAgICAgIHR5cGUgPSB0eXBlIDw8IDggfCBzdHJlYW0uZ2V0Qnl0ZSgpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHR5cGVGaWVsZFdpZHRoID09PSAwKSB7CiAgICAgICAgICAgICAgICB0eXBlID0gMTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBvZmZzZXRGaWVsZFdpZHRoOyArK2opIHsKICAgICAgICAgICAgICAgIG9mZnNldCA9IG9mZnNldCA8PCA4IHwgc3RyZWFtLmdldEJ5dGUoKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBnZW5lcmF0aW9uRmllbGRXaWR0aDsgKytqKSB7CiAgICAgICAgICAgICAgICBnZW5lcmF0aW9uID0gZ2VuZXJhdGlvbiA8PCA4IHwgc3RyZWFtLmdldEJ5dGUoKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBlbnRyeSA9IHt9OwogICAgICAgICAgICAgIGVudHJ5Lm9mZnNldCA9IG9mZnNldDsKICAgICAgICAgICAgICBlbnRyeS5nZW4gPSBnZW5lcmF0aW9uOwoKICAgICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgZW50cnkuZnJlZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgZW50cnkudW5jb21wcmVzc2VkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkludmFsaWQgWFJlZiBlbnRyeSB0eXBlOiAiLmNvbmNhdCh0eXBlKSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoIXRoaXMuZW50cmllc1tmaXJzdCArIGldKSB7CiAgICAgICAgICAgICAgICB0aGlzLmVudHJpZXNbZmlyc3QgKyBpXSA9IGVudHJ5OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgc3RyZWFtU3RhdGUuZW50cnlOdW0gPSAwOwogICAgICAgICAgICBzdHJlYW1TdGF0ZS5zdHJlYW1Qb3MgPSBzdHJlYW0ucG9zOwogICAgICAgICAgICBlbnRyeVJhbmdlcy5zcGxpY2UoMCwgMik7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBpbmRleE9iamVjdHM6IGZ1bmN0aW9uIFhSZWZfaW5kZXhPYmplY3RzKCkgewogICAgICAgICAgdmFyIFRBQiA9IDB4OSwKICAgICAgICAgICAgTEYgPSAweGEsCiAgICAgICAgICAgIENSID0gMHhkLAogICAgICAgICAgICBTUEFDRSA9IDB4MjA7CiAgICAgICAgICB2YXIgUEVSQ0VOVCA9IDB4MjUsCiAgICAgICAgICAgIExUID0gMHgzYzsKCiAgICAgICAgICBmdW5jdGlvbiByZWFkVG9rZW4oZGF0YSwgb2Zmc2V0KSB7CiAgICAgICAgICAgIHZhciB0b2tlbiA9ICIiLAogICAgICAgICAgICAgIGNoID0gZGF0YVtvZmZzZXRdOwoKICAgICAgICAgICAgd2hpbGUgKGNoICE9PSBMRiAmJiBjaCAhPT0gQ1IgJiYgY2ggIT09IExUKSB7CiAgICAgICAgICAgICAgaWYgKCsrb2Zmc2V0ID49IGRhdGEubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHRva2VuICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpOwogICAgICAgICAgICAgIGNoID0gZGF0YVtvZmZzZXRdOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdG9rZW47CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gc2tpcFVudGlsKGRhdGEsIG9mZnNldCwgd2hhdCkgewogICAgICAgICAgICB2YXIgbGVuZ3RoID0gd2hhdC5sZW5ndGgsCiAgICAgICAgICAgICAgZGF0YUxlbmd0aCA9IGRhdGEubGVuZ3RoOwogICAgICAgICAgICB2YXIgc2tpcHBlZCA9IDA7CgogICAgICAgICAgICB3aGlsZSAob2Zmc2V0IDwgZGF0YUxlbmd0aCkgewogICAgICAgICAgICAgIHZhciBpID0gMDsKCiAgICAgICAgICAgICAgd2hpbGUgKGkgPCBsZW5ndGggJiYgZGF0YVtvZmZzZXQgKyBpXSA9PT0gd2hhdFtpXSkgewogICAgICAgICAgICAgICAgKytpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGkgPj0gbGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIG9mZnNldCsrOwogICAgICAgICAgICAgIHNraXBwZWQrKzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHNraXBwZWQ7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIG9ialJlZ0V4cCA9IC9eKFxkKylccysoXGQrKVxzK29ialxiLzsKICAgICAgICAgIHZhciBlbmRvYmpSZWdFeHAgPSAvXGJlbmRvYmpbXGJcc10kLzsKICAgICAgICAgIHZhciBuZXN0ZWRPYmpSZWdFeHAgPSAvXHMrKFxkK1xzK1xkK1xzK29ialtcYlxzPF0pJC87CiAgICAgICAgICB2YXIgQ0hFQ0tfQ09OVEVOVF9MRU5HVEggPSAyNTsKICAgICAgICAgIHZhciB0cmFpbGVyQnl0ZXMgPSBuZXcgVWludDhBcnJheShbMTE2LCAxMTQsIDk3LCAxMDUsIDEwOCwgMTAxLCAxMTRdKTsKICAgICAgICAgIHZhciBzdGFydHhyZWZCeXRlcyA9IG5ldyBVaW50OEFycmF5KFsxMTUsIDExNiwgOTcsIDExNCwgMTE2LCAxMjAsIDExNCwgMTAxLCAxMDJdKTsKICAgICAgICAgIHZhciBvYmpCeXRlcyA9IG5ldyBVaW50OEFycmF5KFsxMTEsIDk4LCAxMDZdKTsKICAgICAgICAgIHZhciB4cmVmQnl0ZXMgPSBuZXcgVWludDhBcnJheShbNDcsIDg4LCA4MiwgMTAxLCAxMDJdKTsKICAgICAgICAgIHRoaXMuZW50cmllcy5sZW5ndGggPSAwOwogICAgICAgICAgdmFyIHN0cmVhbSA9IHRoaXMuc3RyZWFtOwogICAgICAgICAgc3RyZWFtLnBvcyA9IDA7CiAgICAgICAgICB2YXIgYnVmZmVyID0gc3RyZWFtLmdldEJ5dGVzKCk7CiAgICAgICAgICB2YXIgcG9zaXRpb24gPSBzdHJlYW0uc3RhcnQsCiAgICAgICAgICAgIGxlbmd0aCA9IGJ1ZmZlci5sZW5ndGg7CiAgICAgICAgICB2YXIgdHJhaWxlcnMgPSBbXSwKICAgICAgICAgICAgeHJlZlN0bXMgPSBbXTsKCiAgICAgICAgICB3aGlsZSAocG9zaXRpb24gPCBsZW5ndGgpIHsKICAgICAgICAgICAgdmFyIGNoID0gYnVmZmVyW3Bvc2l0aW9uXTsKCiAgICAgICAgICAgIGlmIChjaCA9PT0gVEFCIHx8IGNoID09PSBMRiB8fCBjaCA9PT0gQ1IgfHwgY2ggPT09IFNQQUNFKSB7CiAgICAgICAgICAgICAgKytwb3NpdGlvbjsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGNoID09PSBQRVJDRU5UKSB7CiAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgKytwb3NpdGlvbjsKCiAgICAgICAgICAgICAgICBpZiAocG9zaXRpb24gPj0gbGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGNoID0gYnVmZmVyW3Bvc2l0aW9uXTsKICAgICAgICAgICAgICB9IHdoaWxlIChjaCAhPT0gTEYgJiYgY2ggIT09IENSKTsKCiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciB0b2tlbiA9IHJlYWRUb2tlbihidWZmZXIsIHBvc2l0aW9uKTsKICAgICAgICAgICAgdmFyIG07CgogICAgICAgICAgICBpZiAodG9rZW4uc3RhcnRzV2l0aCgieHJlZiIpICYmICh0b2tlbi5sZW5ndGggPT09IDQgfHwgL1xzLy50ZXN0KHRva2VuWzRdKSkpIHsKICAgICAgICAgICAgICBwb3NpdGlvbiArPSBza2lwVW50aWwoYnVmZmVyLCBwb3NpdGlvbiwgdHJhaWxlckJ5dGVzKTsKICAgICAgICAgICAgICB0cmFpbGVycy5wdXNoKHBvc2l0aW9uKTsKICAgICAgICAgICAgICBwb3NpdGlvbiArPSBza2lwVW50aWwoYnVmZmVyLCBwb3NpdGlvbiwgc3RhcnR4cmVmQnl0ZXMpOwogICAgICAgICAgICB9IGVsc2UgaWYgKG0gPSBvYmpSZWdFeHAuZXhlYyh0b2tlbikpIHsKICAgICAgICAgICAgICB2YXIgbnVtID0gbVsxXSB8IDAsCiAgICAgICAgICAgICAgICBnZW4gPSBtWzJdIHwgMDsKCiAgICAgICAgICAgICAgaWYgKCF0aGlzLmVudHJpZXNbbnVtXSB8fCB0aGlzLmVudHJpZXNbbnVtXS5nZW4gPT09IGdlbikgewogICAgICAgICAgICAgICAgdGhpcy5lbnRyaWVzW251bV0gPSB7CiAgICAgICAgICAgICAgICAgIG9mZnNldDogcG9zaXRpb24gLSBzdHJlYW0uc3RhcnQsCiAgICAgICAgICAgICAgICAgIGdlbjogZ2VuLAogICAgICAgICAgICAgICAgICB1bmNvbXByZXNzZWQ6IHRydWUKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgY29udGVudExlbmd0aCA9IHZvaWQgMCwKICAgICAgICAgICAgICAgIHN0YXJ0UG9zID0gcG9zaXRpb24gKyB0b2tlbi5sZW5ndGg7CgogICAgICAgICAgICAgIHdoaWxlIChzdGFydFBvcyA8IGJ1ZmZlci5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIHZhciBlbmRQb3MgPSBzdGFydFBvcyArIHNraXBVbnRpbChidWZmZXIsIHN0YXJ0UG9zLCBvYmpCeXRlcykgKyA0OwogICAgICAgICAgICAgICAgY29udGVudExlbmd0aCA9IGVuZFBvcyAtIHBvc2l0aW9uOwogICAgICAgICAgICAgICAgdmFyIGNoZWNrUG9zID0gTWF0aC5tYXgoZW5kUG9zIC0gQ0hFQ0tfQ09OVEVOVF9MRU5HVEgsIHN0YXJ0UG9zKTsKICAgICAgICAgICAgICAgIHZhciB0b2tlblN0ciA9ICgwLCBfdXRpbC5ieXRlc1RvU3RyaW5nKShidWZmZXIuc3ViYXJyYXkoY2hlY2tQb3MsIGVuZFBvcykpOwoKICAgICAgICAgICAgICAgIGlmIChlbmRvYmpSZWdFeHAudGVzdCh0b2tlblN0cikpIHsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICB2YXIgb2JqVG9rZW4gPSBuZXN0ZWRPYmpSZWdFeHAuZXhlYyh0b2tlblN0cik7CgogICAgICAgICAgICAgICAgICBpZiAob2JqVG9rZW4gJiYgb2JqVG9rZW5bMV0pIHsKICAgICAgICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoJ2luZGV4T2JqZWN0czogRm91bmQgbmV3ICJvYmoiIGluc2lkZSBvZiBhbm90aGVyICJvYmoiLCAnICsgJ2NhdXNlZCBieSBtaXNzaW5nICJlbmRvYmoiIC0tIHRyeWluZyB0byByZWNvdmVyLicpOwogICAgICAgICAgICAgICAgICAgIGNvbnRlbnRMZW5ndGggLT0gb2JqVG9rZW5bMV0ubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgc3RhcnRQb3MgPSBlbmRQb3M7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgY29udGVudCA9IGJ1ZmZlci5zdWJhcnJheShwb3NpdGlvbiwgcG9zaXRpb24gKyBjb250ZW50TGVuZ3RoKTsKICAgICAgICAgICAgICB2YXIgeHJlZlRhZ09mZnNldCA9IHNraXBVbnRpbChjb250ZW50LCAwLCB4cmVmQnl0ZXMpOwoKICAgICAgICAgICAgICBpZiAoeHJlZlRhZ09mZnNldCA8IGNvbnRlbnRMZW5ndGggJiYgY29udGVudFt4cmVmVGFnT2Zmc2V0ICsgNV0gPCA2NCkgewogICAgICAgICAgICAgICAgeHJlZlN0bXMucHVzaChwb3NpdGlvbiAtIHN0cmVhbS5zdGFydCk7CiAgICAgICAgICAgICAgICB0aGlzLnhyZWZzdG1zW3Bvc2l0aW9uIC0gc3RyZWFtLnN0YXJ0XSA9IDE7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBwb3NpdGlvbiArPSBjb250ZW50TGVuZ3RoOwogICAgICAgICAgICB9IGVsc2UgaWYgKHRva2VuLnN0YXJ0c1dpdGgoInRyYWlsZXIiKSAmJiAodG9rZW4ubGVuZ3RoID09PSA3IHx8IC9ccy8udGVzdCh0b2tlbls3XSkpKSB7CiAgICAgICAgICAgICAgdHJhaWxlcnMucHVzaChwb3NpdGlvbik7CiAgICAgICAgICAgICAgcG9zaXRpb24gKz0gc2tpcFVudGlsKGJ1ZmZlciwgcG9zaXRpb24sIHN0YXJ0eHJlZkJ5dGVzKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBwb3NpdGlvbiArPSB0b2tlbi5sZW5ndGggKyAxOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGksIGlpOwoKICAgICAgICAgIGZvciAoaSA9IDAsIGlpID0geHJlZlN0bXMubGVuZ3RoOyBpIDwgaWk7ICsraSkgewogICAgICAgICAgICB0aGlzLnN0YXJ0WFJlZlF1ZXVlLnB1c2goeHJlZlN0bXNbaV0pOwogICAgICAgICAgICB0aGlzLnJlYWRYUmVmKHRydWUpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciB0cmFpbGVyRGljdDsKCiAgICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IHRyYWlsZXJzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHsKICAgICAgICAgICAgc3RyZWFtLnBvcyA9IHRyYWlsZXJzW2ldOwogICAgICAgICAgICB2YXIgcGFyc2VyID0gbmV3IF9wYXJzZXIuUGFyc2VyKHsKICAgICAgICAgICAgICBsZXhlcjogbmV3IF9wYXJzZXIuTGV4ZXIoc3RyZWFtKSwKICAgICAgICAgICAgICB4cmVmOiB0aGlzLAogICAgICAgICAgICAgIGFsbG93U3RyZWFtczogdHJ1ZSwKICAgICAgICAgICAgICByZWNvdmVyeU1vZGU6IHRydWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciBvYmogPSBwYXJzZXIuZ2V0T2JqKCk7CgogICAgICAgICAgICBpZiAoISgwLCBfcHJpbWl0aXZlcy5pc0NtZCkob2JqLCAidHJhaWxlciIpKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBkaWN0ID0gcGFyc2VyLmdldE9iaigpOwoKICAgICAgICAgICAgaWYgKCEoMCwgX3ByaW1pdGl2ZXMuaXNEaWN0KShkaWN0KSkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcm9vdERpY3QgPSB2b2lkIDA7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHJvb3REaWN0ID0gZGljdC5nZXQoIlJvb3QiKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgICAgICBpZiAoZXggaW5zdGFuY2VvZiBfY29yZV91dGlscy5NaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgICAgICAgICAgdGhyb3cgZXg7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCEoMCwgX3ByaW1pdGl2ZXMuaXNEaWN0KShyb290RGljdCkgfHwgIXJvb3REaWN0LmhhcygiUGFnZXMiKSkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZGljdC5oYXMoIklEIikpIHsKICAgICAgICAgICAgICByZXR1cm4gZGljdDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdHJhaWxlckRpY3QgPSBkaWN0OwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0cmFpbGVyRGljdCkgewogICAgICAgICAgICByZXR1cm4gdHJhaWxlckRpY3Q7CiAgICAgICAgICB9CgogICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkludmFsaWRQREZFeGNlcHRpb24oIkludmFsaWQgUERGIHN0cnVjdHVyZS4iKTsKICAgICAgICB9LAogICAgICAgIHJlYWRYUmVmOiBmdW5jdGlvbiBYUmVmX3JlYWRYUmVmKHJlY292ZXJ5TW9kZSkgewogICAgICAgICAgdmFyIHN0cmVhbSA9IHRoaXMuc3RyZWFtOwogICAgICAgICAgdmFyIHN0YXJ0WFJlZlBhcnNlZENhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKCiAgICAgICAgICB0cnkgewogICAgICAgICAgICB3aGlsZSAodGhpcy5zdGFydFhSZWZRdWV1ZS5sZW5ndGgpIHsKICAgICAgICAgICAgICB2YXIgc3RhcnRYUmVmID0gdGhpcy5zdGFydFhSZWZRdWV1ZVswXTsKCiAgICAgICAgICAgICAgaWYgKHN0YXJ0WFJlZlBhcnNlZENhY2hlW3N0YXJ0WFJlZl0pIHsKICAgICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgicmVhZFhSZWYgLSBza2lwcGluZyBYUmVmIHRhYmxlIHNpbmNlIGl0IHdhcyBhbHJlYWR5IHBhcnNlZC4iKTsKICAgICAgICAgICAgICAgIHRoaXMuc3RhcnRYUmVmUXVldWUuc2hpZnQoKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgc3RhcnRYUmVmUGFyc2VkQ2FjaGVbc3RhcnRYUmVmXSA9IHRydWU7CiAgICAgICAgICAgICAgc3RyZWFtLnBvcyA9IHN0YXJ0WFJlZiArIHN0cmVhbS5zdGFydDsKICAgICAgICAgICAgICB2YXIgcGFyc2VyID0gbmV3IF9wYXJzZXIuUGFyc2VyKHsKICAgICAgICAgICAgICAgIGxleGVyOiBuZXcgX3BhcnNlci5MZXhlcihzdHJlYW0pLAogICAgICAgICAgICAgICAgeHJlZjogdGhpcywKICAgICAgICAgICAgICAgIGFsbG93U3RyZWFtczogdHJ1ZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHZhciBvYmogPSBwYXJzZXIuZ2V0T2JqKCk7CiAgICAgICAgICAgICAgdmFyIGRpY3Q7CgogICAgICAgICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNDbWQpKG9iaiwgInhyZWYiKSkgewogICAgICAgICAgICAgICAgZGljdCA9IHRoaXMucHJvY2Vzc1hSZWZUYWJsZShwYXJzZXIpOwoKICAgICAgICAgICAgICAgIGlmICghdGhpcy50b3BEaWN0KSB7CiAgICAgICAgICAgICAgICAgIHRoaXMudG9wRGljdCA9IGRpY3Q7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgb2JqID0gZGljdC5nZXQoIlhSZWZTdG0iKTsKCiAgICAgICAgICAgICAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihvYmopKSB7CiAgICAgICAgICAgICAgICAgIHZhciBwb3MgPSBvYmo7CgogICAgICAgICAgICAgICAgICBpZiAoIShwb3MgaW4gdGhpcy54cmVmc3RtcykpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnhyZWZzdG1zW3Bvc10gPSAxOwogICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhcnRYUmVmUXVldWUucHVzaChwb3MpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChOdW1iZXIuaXNJbnRlZ2VyKG9iaikpIHsKICAgICAgICAgICAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihwYXJzZXIuZ2V0T2JqKCkpIHx8ICEoMCwgX3ByaW1pdGl2ZXMuaXNDbWQpKHBhcnNlci5nZXRPYmooKSwgIm9iaiIpIHx8ICEoMCwgX3ByaW1pdGl2ZXMuaXNTdHJlYW0pKG9iaiA9IHBhcnNlci5nZXRPYmooKSkpIHsKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJJbnZhbGlkIFhSZWYgc3RyZWFtIik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZGljdCA9IHRoaXMucHJvY2Vzc1hSZWZTdHJlYW0ob2JqKTsKCiAgICAgICAgICAgICAgICBpZiAoIXRoaXMudG9wRGljdCkgewogICAgICAgICAgICAgICAgICB0aGlzLnRvcERpY3QgPSBkaWN0OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICghZGljdCkgewogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkZhaWxlZCB0byByZWFkIFhSZWYgc3RyZWFtIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiSW52YWxpZCBYUmVmIHN0cmVhbSBoZWFkZXIiKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIG9iaiA9IGRpY3QuZ2V0KCJQcmV2Iik7CgogICAgICAgICAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKG9iaikpIHsKICAgICAgICAgICAgICAgIHRoaXMuc3RhcnRYUmVmUXVldWUucHVzaChvYmopOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoKDAsIF9wcmltaXRpdmVzLmlzUmVmKShvYmopKSB7CiAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0WFJlZlF1ZXVlLnB1c2gob2JqLm51bSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB0aGlzLnN0YXJ0WFJlZlF1ZXVlLnNoaWZ0KCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB0aGlzLnRvcERpY3Q7CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgX2NvcmVfdXRpbHMuTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICAgICAgICB0aHJvdyBlOwogICAgICAgICAgICB9CgogICAgICAgICAgICAoMCwgX3V0aWwuaW5mbykoIih3aGlsZSByZWFkaW5nIFhSZWYpOiAiICsgZSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHJlY292ZXJ5TW9kZSkgewogICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgICAgfQoKICAgICAgICAgIHRocm93IG5ldyBfY29yZV91dGlscy5YUmVmUGFyc2VFeGNlcHRpb24oKTsKICAgICAgICB9LAogICAgICAgIGdldEVudHJ5OiBmdW5jdGlvbiBYUmVmX2dldEVudHJ5KGkpIHsKICAgICAgICAgIHZhciB4cmVmRW50cnkgPSB0aGlzLmVudHJpZXNbaV07CgogICAgICAgICAgaWYgKHhyZWZFbnRyeSAmJiAheHJlZkVudHJ5LmZyZWUgJiYgeHJlZkVudHJ5Lm9mZnNldCkgewogICAgICAgICAgICByZXR1cm4geHJlZkVudHJ5OwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0sCiAgICAgICAgZmV0Y2hJZlJlZjogZnVuY3Rpb24gWFJlZl9mZXRjaElmUmVmKG9iaiwgc3VwcHJlc3NFbmNyeXB0aW9uKSB7CiAgICAgICAgICBpZiAob2JqIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuUmVmKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmZldGNoKG9iaiwgc3VwcHJlc3NFbmNyeXB0aW9uKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gb2JqOwogICAgICAgIH0sCiAgICAgICAgZmV0Y2g6IGZ1bmN0aW9uIFhSZWZfZmV0Y2gocmVmLCBzdXBwcmVzc0VuY3J5cHRpb24pIHsKICAgICAgICAgIGlmICghKHJlZiBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLlJlZikpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJyZWYgb2JqZWN0IGlzIG5vdCBhIHJlZmVyZW5jZSIpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBudW0gPSByZWYubnVtOwoKICAgICAgICAgIHZhciBjYWNoZUVudHJ5ID0gdGhpcy5fY2FjaGVNYXAuZ2V0KG51bSk7CgogICAgICAgICAgaWYgKGNhY2hlRW50cnkgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBpZiAoY2FjaGVFbnRyeSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QgJiYgIWNhY2hlRW50cnkub2JqSWQpIHsKICAgICAgICAgICAgICBjYWNoZUVudHJ5Lm9iaklkID0gcmVmLnRvU3RyaW5nKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBjYWNoZUVudHJ5OwogICAgICAgICAgfQoKICAgICAgICAgIHZhciB4cmVmRW50cnkgPSB0aGlzLmdldEVudHJ5KG51bSk7CgogICAgICAgICAgaWYgKHhyZWZFbnRyeSA9PT0gbnVsbCkgewogICAgICAgICAgICB0aGlzLl9jYWNoZU1hcC5zZXQobnVtLCB4cmVmRW50cnkpOwoKICAgICAgICAgICAgcmV0dXJuIHhyZWZFbnRyeTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoeHJlZkVudHJ5LnVuY29tcHJlc3NlZCkgewogICAgICAgICAgICB4cmVmRW50cnkgPSB0aGlzLmZldGNoVW5jb21wcmVzc2VkKHJlZiwgeHJlZkVudHJ5LCBzdXBwcmVzc0VuY3J5cHRpb24pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgeHJlZkVudHJ5ID0gdGhpcy5mZXRjaENvbXByZXNzZWQocmVmLCB4cmVmRW50cnksIHN1cHByZXNzRW5jcnlwdGlvbik7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc0RpY3QpKHhyZWZFbnRyeSkpIHsKICAgICAgICAgICAgeHJlZkVudHJ5Lm9iaklkID0gcmVmLnRvU3RyaW5nKCk7CiAgICAgICAgICB9IGVsc2UgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc1N0cmVhbSkoeHJlZkVudHJ5KSkgewogICAgICAgICAgICB4cmVmRW50cnkuZGljdC5vYmpJZCA9IHJlZi50b1N0cmluZygpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB4cmVmRW50cnk7CiAgICAgICAgfSwKICAgICAgICBmZXRjaFVuY29tcHJlc3NlZDogZnVuY3Rpb24gZmV0Y2hVbmNvbXByZXNzZWQocmVmLCB4cmVmRW50cnkpIHsKICAgICAgICAgIHZhciBzdXBwcmVzc0VuY3J5cHRpb24gPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IGZhbHNlOwogICAgICAgICAgdmFyIGdlbiA9IHJlZi5nZW47CiAgICAgICAgICB2YXIgbnVtID0gcmVmLm51bTsKCiAgICAgICAgICBpZiAoeHJlZkVudHJ5LmdlbiAhPT0gZ2VuKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBfY29yZV91dGlscy5YUmVmRW50cnlFeGNlcHRpb24oIkluY29uc2lzdGVudCBnZW5lcmF0aW9uIGluIFhSZWY6ICIuY29uY2F0KHJlZikpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBzdHJlYW0gPSB0aGlzLnN0cmVhbS5tYWtlU3ViU3RyZWFtKHhyZWZFbnRyeS5vZmZzZXQgKyB0aGlzLnN0cmVhbS5zdGFydCk7CiAgICAgICAgICB2YXIgcGFyc2VyID0gbmV3IF9wYXJzZXIuUGFyc2VyKHsKICAgICAgICAgICAgbGV4ZXI6IG5ldyBfcGFyc2VyLkxleGVyKHN0cmVhbSksCiAgICAgICAgICAgIHhyZWY6IHRoaXMsCiAgICAgICAgICAgIGFsbG93U3RyZWFtczogdHJ1ZQogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgb2JqMSA9IHBhcnNlci5nZXRPYmooKTsKICAgICAgICAgIHZhciBvYmoyID0gcGFyc2VyLmdldE9iaigpOwogICAgICAgICAgdmFyIG9iajMgPSBwYXJzZXIuZ2V0T2JqKCk7CgogICAgICAgICAgaWYgKG9iajEgIT09IG51bSB8fCBvYmoyICE9PSBnZW4gfHwgIShvYmozIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuQ21kKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgX2NvcmVfdXRpbHMuWFJlZkVudHJ5RXhjZXB0aW9uKCJCYWQgKHVuY29tcHJlc3NlZCkgWFJlZiBlbnRyeTogIi5jb25jYXQocmVmKSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKG9iajMuY21kICE9PSAib2JqIikgewogICAgICAgICAgICBpZiAob2JqMy5jbWQuc3RhcnRzV2l0aCgib2JqIikpIHsKICAgICAgICAgICAgICBudW0gPSBwYXJzZUludChvYmozLmNtZC5zdWJzdHJpbmcoMyksIDEwKTsKCiAgICAgICAgICAgICAgaWYgKCFOdW1iZXIuaXNOYU4obnVtKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIG51bTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRocm93IG5ldyBfY29yZV91dGlscy5YUmVmRW50cnlFeGNlcHRpb24oIkJhZCAodW5jb21wcmVzc2VkKSBYUmVmIGVudHJ5OiAiLmNvbmNhdChyZWYpKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodGhpcy5lbmNyeXB0ICYmICFzdXBwcmVzc0VuY3J5cHRpb24pIHsKICAgICAgICAgICAgeHJlZkVudHJ5ID0gcGFyc2VyLmdldE9iaih0aGlzLmVuY3J5cHQuY3JlYXRlQ2lwaGVyVHJhbnNmb3JtKG51bSwgZ2VuKSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB4cmVmRW50cnkgPSBwYXJzZXIuZ2V0T2JqKCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCEoMCwgX3ByaW1pdGl2ZXMuaXNTdHJlYW0pKHhyZWZFbnRyeSkpIHsKICAgICAgICAgICAgdGhpcy5fY2FjaGVNYXAuc2V0KG51bSwgeHJlZkVudHJ5KTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4geHJlZkVudHJ5OwogICAgICAgIH0sCiAgICAgICAgZmV0Y2hDb21wcmVzc2VkOiBmdW5jdGlvbiBmZXRjaENvbXByZXNzZWQocmVmLCB4cmVmRW50cnkpIHsKICAgICAgICAgIHZhciBzdXBwcmVzc0VuY3J5cHRpb24gPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IGZhbHNlOwogICAgICAgICAgdmFyIHRhYmxlT2Zmc2V0ID0geHJlZkVudHJ5Lm9mZnNldDsKICAgICAgICAgIHZhciBzdHJlYW0gPSB0aGlzLmZldGNoKF9wcmltaXRpdmVzLlJlZi5nZXQodGFibGVPZmZzZXQsIDApKTsKCiAgICAgICAgICBpZiAoISgwLCBfcHJpbWl0aXZlcy5pc1N0cmVhbSkoc3RyZWFtKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoImJhZCBPYmpTdG0gc3RyZWFtIik7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGZpcnN0ID0gc3RyZWFtLmRpY3QuZ2V0KCJGaXJzdCIpOwogICAgICAgICAgdmFyIG4gPSBzdHJlYW0uZGljdC5nZXQoIk4iKTsKCiAgICAgICAgICBpZiAoIU51bWJlci5pc0ludGVnZXIoZmlyc3QpIHx8ICFOdW1iZXIuaXNJbnRlZ2VyKG4pKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiaW52YWxpZCBmaXJzdCBhbmQgbiBwYXJhbWV0ZXJzIGZvciBPYmpTdG0gc3RyZWFtIik7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHBhcnNlciA9IG5ldyBfcGFyc2VyLlBhcnNlcih7CiAgICAgICAgICAgIGxleGVyOiBuZXcgX3BhcnNlci5MZXhlcihzdHJlYW0pLAogICAgICAgICAgICB4cmVmOiB0aGlzLAogICAgICAgICAgICBhbGxvd1N0cmVhbXM6IHRydWUKICAgICAgICAgIH0pOwogICAgICAgICAgdmFyIG51bXMgPSBuZXcgQXJyYXkobik7CgogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyArK2kpIHsKICAgICAgICAgICAgdmFyIG51bSA9IHBhcnNlci5nZXRPYmooKTsKCiAgICAgICAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihudW0pKSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJpbnZhbGlkIG9iamVjdCBudW1iZXIgaW4gdGhlIE9ialN0bSBzdHJlYW06ICIuY29uY2F0KG51bSkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgb2Zmc2V0ID0gcGFyc2VyLmdldE9iaigpOwoKICAgICAgICAgICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKG9mZnNldCkpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoImludmFsaWQgb2JqZWN0IG9mZnNldCBpbiB0aGUgT2JqU3RtIHN0cmVhbTogIi5jb25jYXQob2Zmc2V0KSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG51bXNbaV0gPSBudW07CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGVudHJpZXMgPSBuZXcgQXJyYXkobik7CgogICAgICAgICAgZm9yICh2YXIgX2kyID0gMDsgX2kyIDwgbjsgKytfaTIpIHsKICAgICAgICAgICAgdmFyIG9iaiA9IHBhcnNlci5nZXRPYmooKTsKICAgICAgICAgICAgZW50cmllc1tfaTJdID0gb2JqOwoKICAgICAgICAgICAgaWYgKHBhcnNlci5idWYxIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuQ21kICYmIHBhcnNlci5idWYxLmNtZCA9PT0gImVuZG9iaiIpIHsKICAgICAgICAgICAgICBwYXJzZXIuc2hpZnQoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc1N0cmVhbSkob2JqKSkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgX251bSA9IG51bXNbX2kyXSwKICAgICAgICAgICAgICBlbnRyeSA9IHRoaXMuZW50cmllc1tfbnVtXTsKCiAgICAgICAgICAgIGlmIChlbnRyeSAmJiBlbnRyeS5vZmZzZXQgPT09IHRhYmxlT2Zmc2V0ICYmIGVudHJ5LmdlbiA9PT0gX2kyKSB7CiAgICAgICAgICAgICAgdGhpcy5fY2FjaGVNYXAuc2V0KF9udW0sIG9iaik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB4cmVmRW50cnkgPSBlbnRyaWVzW3hyZWZFbnRyeS5nZW5dOwoKICAgICAgICAgIGlmICh4cmVmRW50cnkgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICB0aHJvdyBuZXcgX2NvcmVfdXRpbHMuWFJlZkVudHJ5RXhjZXB0aW9uKCJCYWQgKGNvbXByZXNzZWQpIFhSZWYgZW50cnk6ICIuY29uY2F0KHJlZikpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB4cmVmRW50cnk7CiAgICAgICAgfSwKICAgICAgICBmZXRjaElmUmVmQXN5bmM6IGZ1bmN0aW9uIGZldGNoSWZSZWZBc3luYyhvYmosIHN1cHByZXNzRW5jcnlwdGlvbikgewogICAgICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JbImRlZmF1bHQiXS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JbImRlZmF1bHQiXS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLlJlZikpIHsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBfdGhpczMuZmV0Y2hBc3luYyhvYmosIHN1cHByZXNzRW5jcnlwdGlvbikpOwoKICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIG9iaik7CgogICAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIF9jYWxsZWUpOwogICAgICAgICAgfSkpKCk7CiAgICAgICAgfSwKICAgICAgICBmZXRjaEFzeW5jOiBmdW5jdGlvbiBmZXRjaEFzeW5jKHJlZiwgc3VwcHJlc3NFbmNyeXB0aW9uKSB7CiAgICAgICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoLyojX19QVVJFX18qL19yZWdlbmVyYXRvclsiZGVmYXVsdCJdLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JbImRlZmF1bHQiXS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIucHJldiA9IDA7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIF90aGlzNC5mZXRjaChyZWYsIHN1cHByZXNzRW5jcnlwdGlvbikpOwoKICAgICAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5wcmV2ID0gNDsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIudDAgPSBfY29udGV4dDJbImNhdGNoIl0oMCk7CgogICAgICAgICAgICAgICAgICAgIGlmIChfY29udGV4dDIudDAgaW5zdGFuY2VvZiBfY29yZV91dGlscy5NaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA4OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBfY29udGV4dDIudDA7CgogICAgICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxMDsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXM0LnBkZk1hbmFnZXIucmVxdWVzdFJhbmdlKF9jb250ZXh0Mi50MC5iZWdpbiwgX2NvbnRleHQyLnQwLmVuZCk7CgogICAgICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCBfdGhpczQuZmV0Y2hBc3luYyhyZWYsIHN1cHByZXNzRW5jcnlwdGlvbikpOwoKICAgICAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIF9jYWxsZWUyLCBudWxsLCBbWzAsIDRdXSk7CiAgICAgICAgICB9KSkoKTsKICAgICAgICB9LAogICAgICAgIGdldENhdGFsb2dPYmo6IGZ1bmN0aW9uIFhSZWZfZ2V0Q2F0YWxvZ09iaigpIHsKICAgICAgICAgIHJldHVybiB0aGlzLnJvb3Q7CiAgICAgICAgfQogICAgICB9OwogICAgICByZXR1cm4gWFJlZjsKICAgIH0oKTsKCiAgICBleHBvcnRzLlhSZWYgPSBYUmVmOwoKICAgIHZhciBOYW1lT3JOdW1iZXJUcmVlID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gTmFtZU9yTnVtYmVyVHJlZShyb290LCB4cmVmLCB0eXBlKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIE5hbWVPck51bWJlclRyZWUpOwoKICAgICAgICBpZiAodGhpcy5jb25zdHJ1Y3RvciA9PT0gTmFtZU9yTnVtYmVyVHJlZSkgewogICAgICAgICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgiQ2Fubm90IGluaXRpYWxpemUgTmFtZU9yTnVtYmVyVHJlZS4iKTsKICAgICAgICB9CgogICAgICAgIHRoaXMucm9vdCA9IHJvb3Q7CiAgICAgICAgdGhpcy54cmVmID0geHJlZjsKICAgICAgICB0aGlzLl90eXBlID0gdHlwZTsKICAgICAgfQoKICAgICAgX2NyZWF0ZUNsYXNzKE5hbWVPck51bWJlclRyZWUsIFt7CiAgICAgICAga2V5OiAiZ2V0QWxsIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0QWxsKCkgewogICAgICAgICAgdmFyIGRpY3QgPSBPYmplY3QuY3JlYXRlKG51bGwpOwoKICAgICAgICAgIGlmICghdGhpcy5yb290KSB7CiAgICAgICAgICAgIHJldHVybiBkaWN0OwogICAgICAgICAgfQoKICAgICAgICAgIHZhciB4cmVmID0gdGhpcy54cmVmOwogICAgICAgICAgdmFyIHByb2Nlc3NlZCA9IG5ldyBfcHJpbWl0aXZlcy5SZWZTZXQoKTsKICAgICAgICAgIHByb2Nlc3NlZC5wdXQodGhpcy5yb290KTsKICAgICAgICAgIHZhciBxdWV1ZSA9IFt0aGlzLnJvb3RdOwoKICAgICAgICAgIHdoaWxlIChxdWV1ZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHZhciBvYmogPSB4cmVmLmZldGNoSWZSZWYocXVldWUuc2hpZnQoKSk7CgogICAgICAgICAgICBpZiAoISgwLCBfcHJpbWl0aXZlcy5pc0RpY3QpKG9iaikpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKG9iai5oYXMoIktpZHMiKSkgewogICAgICAgICAgICAgIHZhciBraWRzID0gb2JqLmdldCgiS2lkcyIpOwoKICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBraWRzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgICAgIHZhciBraWQgPSBraWRzW2ldOwoKICAgICAgICAgICAgICAgIGlmIChwcm9jZXNzZWQuaGFzKGtpZCkpIHsKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJEdXBsaWNhdGUgZW50cnkgaW4gXCIiLmNvbmNhdCh0aGlzLl90eXBlLCAiXCIgdHJlZS4iKSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcXVldWUucHVzaChraWQpOwogICAgICAgICAgICAgICAgcHJvY2Vzc2VkLnB1dChraWQpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBlbnRyaWVzID0gb2JqLmdldCh0aGlzLl90eXBlKTsKCiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGVudHJpZXMpKSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgX2kzID0gMCwgX2lpID0gZW50cmllcy5sZW5ndGg7IF9pMyA8IF9paTsgX2kzICs9IDIpIHsKICAgICAgICAgICAgICAgIGRpY3RbeHJlZi5mZXRjaElmUmVmKGVudHJpZXNbX2kzXSldID0geHJlZi5mZXRjaElmUmVmKGVudHJpZXNbX2kzICsgMV0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBkaWN0OwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImdldCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldChrZXkpIHsKICAgICAgICAgIGlmICghdGhpcy5yb290KSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciB4cmVmID0gdGhpcy54cmVmOwogICAgICAgICAgdmFyIGtpZHNPckVudHJpZXMgPSB4cmVmLmZldGNoSWZSZWYodGhpcy5yb290KTsKICAgICAgICAgIHZhciBsb29wQ291bnQgPSAwOwogICAgICAgICAgdmFyIE1BWF9MRVZFTFMgPSAxMDsKCiAgICAgICAgICB3aGlsZSAoa2lkc09yRW50cmllcy5oYXMoIktpZHMiKSkgewogICAgICAgICAgICBpZiAoKytsb29wQ291bnQgPiBNQVhfTEVWRUxTKSB7CiAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJTZWFyY2ggZGVwdGggbGltaXQgcmVhY2hlZCBmb3IgXCIiLmNvbmNhdCh0aGlzLl90eXBlLCAiXCIgdHJlZS4iKSk7CiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBraWRzID0ga2lkc09yRW50cmllcy5nZXQoIktpZHMiKTsKCiAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShraWRzKSkgewogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgbCA9IDAsCiAgICAgICAgICAgICAgciA9IGtpZHMubGVuZ3RoIC0gMTsKCiAgICAgICAgICAgIHdoaWxlIChsIDw9IHIpIHsKICAgICAgICAgICAgICB2YXIgbSA9IGwgKyByID4+IDE7CiAgICAgICAgICAgICAgdmFyIGtpZCA9IHhyZWYuZmV0Y2hJZlJlZihraWRzW21dKTsKICAgICAgICAgICAgICB2YXIgbGltaXRzID0ga2lkLmdldCgiTGltaXRzIik7CgogICAgICAgICAgICAgIGlmIChrZXkgPCB4cmVmLmZldGNoSWZSZWYobGltaXRzWzBdKSkgewogICAgICAgICAgICAgICAgciA9IG0gLSAxOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoa2V5ID4geHJlZi5mZXRjaElmUmVmKGxpbWl0c1sxXSkpIHsKICAgICAgICAgICAgICAgIGwgPSBtICsgMTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAga2lkc09yRW50cmllcyA9IHhyZWYuZmV0Y2hJZlJlZihraWRzW21dKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGwgPiByKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZW50cmllcyA9IGtpZHNPckVudHJpZXMuZ2V0KHRoaXMuX3R5cGUpOwoKICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGVudHJpZXMpKSB7CiAgICAgICAgICAgIHZhciBfbCA9IDAsCiAgICAgICAgICAgICAgX3IgPSBlbnRyaWVzLmxlbmd0aCAtIDI7CgogICAgICAgICAgICB3aGlsZSAoX2wgPD0gX3IpIHsKICAgICAgICAgICAgICB2YXIgdG1wID0gX2wgKyBfciA+PiAxLAogICAgICAgICAgICAgICAgX20gPSB0bXAgKyAodG1wICYgMSk7CgogICAgICAgICAgICAgIHZhciBjdXJyZW50S2V5ID0geHJlZi5mZXRjaElmUmVmKGVudHJpZXNbX21dKTsKCiAgICAgICAgICAgICAgaWYgKGtleSA8IGN1cnJlbnRLZXkpIHsKICAgICAgICAgICAgICAgIF9yID0gX20gLSAyOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoa2V5ID4gY3VycmVudEtleSkgewogICAgICAgICAgICAgICAgX2wgPSBfbSArIDI7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiB4cmVmLmZldGNoSWZSZWYoZW50cmllc1tfbSArIDFdKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICgwLCBfdXRpbC5pbmZvKSgiRmFsbGluZyBiYWNrIHRvIGFuIGV4aGF1c3RpdmUgc2VhcmNoLCBmb3Iga2V5IFwiIi5jb25jYXQoa2V5LCAiXCIsICIpICsgImluIFwiIi5jb25jYXQodGhpcy5fdHlwZSwgIlwiIHRyZWUuIikpOwoKICAgICAgICAgICAgZm9yICh2YXIgX20yID0gMCwgbW0gPSBlbnRyaWVzLmxlbmd0aDsgX20yIDwgbW07IF9tMiArPSAyKSB7CiAgICAgICAgICAgICAgdmFyIF9jdXJyZW50S2V5ID0geHJlZi5mZXRjaElmUmVmKGVudHJpZXNbX20yXSk7CgogICAgICAgICAgICAgIGlmIChfY3VycmVudEtleSA9PT0ga2V5KSB7CiAgICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIlRoZSBcIiIuY29uY2F0KGtleSwgIlwiIGtleSB3YXMgZm91bmQgYXQgYW4gaW5jb3JyZWN0LCAiKSArICJpLmUuIG91dC1vZi1vcmRlciwgcG9zaXRpb24gaW4gXCIiLmNvbmNhdCh0aGlzLl90eXBlLCAiXCIgdHJlZS4iKSk7CiAgICAgICAgICAgICAgICByZXR1cm4geHJlZi5mZXRjaElmUmVmKGVudHJpZXNbX20yICsgMV0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIE5hbWVPck51bWJlclRyZWU7CiAgICB9KCk7CgogICAgdmFyIE5hbWVUcmVlID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfTmFtZU9yTnVtYmVyVHJlZSkgewogICAgICBfaW5oZXJpdHMoTmFtZVRyZWUsIF9OYW1lT3JOdW1iZXJUcmVlKTsKCiAgICAgIGZ1bmN0aW9uIE5hbWVUcmVlKHJvb3QsIHhyZWYpIHsKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgTmFtZVRyZWUpOwoKICAgICAgICByZXR1cm4gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKE5hbWVUcmVlKS5jYWxsKHRoaXMsIHJvb3QsIHhyZWYsICJOYW1lcyIpKTsKICAgICAgfQoKICAgICAgcmV0dXJuIE5hbWVUcmVlOwogICAgfShOYW1lT3JOdW1iZXJUcmVlKTsKCiAgICB2YXIgTnVtYmVyVHJlZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX05hbWVPck51bWJlclRyZWUyKSB7CiAgICAgIF9pbmhlcml0cyhOdW1iZXJUcmVlLCBfTmFtZU9yTnVtYmVyVHJlZTIpOwoKICAgICAgZnVuY3Rpb24gTnVtYmVyVHJlZShyb290LCB4cmVmKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIE51bWJlclRyZWUpOwoKICAgICAgICByZXR1cm4gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKE51bWJlclRyZWUpLmNhbGwodGhpcywgcm9vdCwgeHJlZiwgIk51bXMiKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBOdW1iZXJUcmVlOwogICAgfShOYW1lT3JOdW1iZXJUcmVlKTsKCiAgICB2YXIgRmlsZVNwZWMgPSBmdW5jdGlvbiBGaWxlU3BlY0Nsb3N1cmUoKSB7CiAgICAgIGZ1bmN0aW9uIEZpbGVTcGVjKHJvb3QsIHhyZWYpIHsKICAgICAgICBpZiAoIXJvb3QgfHwgISgwLCBfcHJpbWl0aXZlcy5pc0RpY3QpKHJvb3QpKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB0aGlzLnhyZWYgPSB4cmVmOwogICAgICAgIHRoaXMucm9vdCA9IHJvb3Q7CgogICAgICAgIGlmIChyb290LmhhcygiRlMiKSkgewogICAgICAgICAgdGhpcy5mcyA9IHJvb3QuZ2V0KCJGUyIpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5kZXNjcmlwdGlvbiA9IHJvb3QuaGFzKCJEZXNjIikgPyAoMCwgX3V0aWwuc3RyaW5nVG9QREZTdHJpbmcpKHJvb3QuZ2V0KCJEZXNjIikpIDogIiI7CgogICAgICAgIGlmIChyb290LmhhcygiUkYiKSkgewogICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJSZWxhdGVkIGZpbGUgc3BlY2lmaWNhdGlvbnMgYXJlIG5vdCBzdXBwb3J0ZWQiKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuY29udGVudEF2YWlsYWJsZSA9IHRydWU7CgogICAgICAgIGlmICghcm9vdC5oYXMoIkVGIikpIHsKICAgICAgICAgIHRoaXMuY29udGVudEF2YWlsYWJsZSA9IGZhbHNlOwogICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJOb24tZW1iZWRkZWQgZmlsZSBzcGVjaWZpY2F0aW9ucyBhcmUgbm90IHN1cHBvcnRlZCIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZnVuY3Rpb24gcGlja1BsYXRmb3JtSXRlbShkaWN0KSB7CiAgICAgICAgaWYgKGRpY3QuaGFzKCJVRiIpKSB7CiAgICAgICAgICByZXR1cm4gZGljdC5nZXQoIlVGIik7CiAgICAgICAgfSBlbHNlIGlmIChkaWN0LmhhcygiRiIpKSB7CiAgICAgICAgICByZXR1cm4gZGljdC5nZXQoIkYiKTsKICAgICAgICB9IGVsc2UgaWYgKGRpY3QuaGFzKCJVbml4IikpIHsKICAgICAgICAgIHJldHVybiBkaWN0LmdldCgiVW5peCIpOwogICAgICAgIH0gZWxzZSBpZiAoZGljdC5oYXMoIk1hYyIpKSB7CiAgICAgICAgICByZXR1cm4gZGljdC5nZXQoIk1hYyIpOwogICAgICAgIH0gZWxzZSBpZiAoZGljdC5oYXMoIkRPUyIpKSB7CiAgICAgICAgICByZXR1cm4gZGljdC5nZXQoIkRPUyIpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIEZpbGVTcGVjLnByb3RvdHlwZSA9IHsKICAgICAgICBnZXQgZmlsZW5hbWUoKSB7CiAgICAgICAgICBpZiAoIXRoaXMuX2ZpbGVuYW1lICYmIHRoaXMucm9vdCkgewogICAgICAgICAgICB2YXIgZmlsZW5hbWUgPSBwaWNrUGxhdGZvcm1JdGVtKHRoaXMucm9vdCkgfHwgInVubmFtZWQiOwogICAgICAgICAgICB0aGlzLl9maWxlbmFtZSA9ICgwLCBfdXRpbC5zdHJpbmdUb1BERlN0cmluZykoZmlsZW5hbWUpLnJlcGxhY2UoL1xcXFwvZywgIlxcIikucmVwbGFjZSgvXFxcLy9nLCAiLyIpLnJlcGxhY2UoL1xcL2csICIvIik7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHRoaXMuX2ZpbGVuYW1lOwogICAgICAgIH0sCgogICAgICAgIGdldCBjb250ZW50KCkgewogICAgICAgICAgaWYgKCF0aGlzLmNvbnRlbnRBdmFpbGFibGUpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCF0aGlzLmNvbnRlbnRSZWYgJiYgdGhpcy5yb290KSB7CiAgICAgICAgICAgIHRoaXMuY29udGVudFJlZiA9IHBpY2tQbGF0Zm9ybUl0ZW0odGhpcy5yb290LmdldCgiRUYiKSk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGNvbnRlbnQgPSBudWxsOwoKICAgICAgICAgIGlmICh0aGlzLmNvbnRlbnRSZWYpIHsKICAgICAgICAgICAgdmFyIHhyZWYgPSB0aGlzLnhyZWY7CiAgICAgICAgICAgIHZhciBmaWxlT2JqID0geHJlZi5mZXRjaElmUmVmKHRoaXMuY29udGVudFJlZik7CgogICAgICAgICAgICBpZiAoZmlsZU9iaiAmJiAoMCwgX3ByaW1pdGl2ZXMuaXNTdHJlYW0pKGZpbGVPYmopKSB7CiAgICAgICAgICAgICAgY29udGVudCA9IGZpbGVPYmouZ2V0Qnl0ZXMoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIkVtYmVkZGVkIGZpbGUgc3BlY2lmaWNhdGlvbiBwb2ludHMgdG8gbm9uLWV4aXN0aW5nL2ludmFsaWQgIiArICJjb250ZW50Iik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiRW1iZWRkZWQgZmlsZSBzcGVjaWZpY2F0aW9uIGRvZXMgbm90IGhhdmUgYSBjb250ZW50Iik7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGNvbnRlbnQ7CiAgICAgICAgfSwKCiAgICAgICAgZ2V0IHNlcmlhbGl6YWJsZSgpIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGZpbGVuYW1lOiB0aGlzLmZpbGVuYW1lLAogICAgICAgICAgICBjb250ZW50OiB0aGlzLmNvbnRlbnQKICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgfTsKICAgICAgcmV0dXJuIEZpbGVTcGVjOwogICAgfSgpOwoKICAgIGV4cG9ydHMuRmlsZVNwZWMgPSBGaWxlU3BlYzsKCiAgICB2YXIgT2JqZWN0TG9hZGVyID0gZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBtYXlIYXZlQ2hpbGRyZW4odmFsdWUpIHsKICAgICAgICByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5SZWYgfHwgdmFsdWUgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0IHx8IEFycmF5LmlzQXJyYXkodmFsdWUpIHx8ICgwLCBfcHJpbWl0aXZlcy5pc1N0cmVhbSkodmFsdWUpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBhZGRDaGlsZHJlbihub2RlLCBub2Rlc1RvVmlzaXQpIHsKICAgICAgICBpZiAobm9kZSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QgfHwgKDAsIF9wcmltaXRpdmVzLmlzU3RyZWFtKShub2RlKSkgewogICAgICAgICAgdmFyIGRpY3QgPSBub2RlIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCA/IG5vZGUgOiBub2RlLmRpY3Q7CiAgICAgICAgICB2YXIgZGljdEtleXMgPSBkaWN0LmdldEtleXMoKTsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBkaWN0S2V5cy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgIHZhciByYXdWYWx1ZSA9IGRpY3QuZ2V0UmF3KGRpY3RLZXlzW2ldKTsKCiAgICAgICAgICAgIGlmIChtYXlIYXZlQ2hpbGRyZW4ocmF3VmFsdWUpKSB7CiAgICAgICAgICAgICAgbm9kZXNUb1Zpc2l0LnB1c2gocmF3VmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG5vZGUpKSB7CiAgICAgICAgICBmb3IgKHZhciBfaTQgPSAwLCBfaWkyID0gbm9kZS5sZW5ndGg7IF9pNCA8IF9paTI7IF9pNCsrKSB7CiAgICAgICAgICAgIHZhciB2YWx1ZSA9IG5vZGVbX2k0XTsKCiAgICAgICAgICAgIGlmIChtYXlIYXZlQ2hpbGRyZW4odmFsdWUpKSB7CiAgICAgICAgICAgICAgbm9kZXNUb1Zpc2l0LnB1c2godmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBPYmplY3RMb2FkZXIoZGljdCwga2V5cywgeHJlZikgewogICAgICAgIHRoaXMuZGljdCA9IGRpY3Q7CiAgICAgICAgdGhpcy5rZXlzID0ga2V5czsKICAgICAgICB0aGlzLnhyZWYgPSB4cmVmOwogICAgICAgIHRoaXMucmVmU2V0ID0gbnVsbDsKICAgICAgfQoKICAgICAgT2JqZWN0TG9hZGVyLnByb3RvdHlwZSA9IHsKICAgICAgICBsb2FkOiBmdW5jdGlvbiBsb2FkKCkgewogICAgICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CgogICAgICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JbImRlZmF1bHQiXS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKCkgewogICAgICAgICAgICB2YXIga2V5cywgZGljdCwgbm9kZXNUb1Zpc2l0LCBpLCBpaSwgcmF3VmFsdWU7CiAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JbImRlZmF1bHQiXS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICBpZiAoISghX3RoaXM1LnhyZWYuc3RyZWFtLmFsbENodW5rc0xvYWRlZCB8fCBfdGhpczUueHJlZi5zdHJlYW0uYWxsQ2h1bmtzTG9hZGVkKCkpKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDI7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iLCB1bmRlZmluZWQpOwoKICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgIGtleXMgPSBfdGhpczUua2V5cywgZGljdCA9IF90aGlzNS5kaWN0OwogICAgICAgICAgICAgICAgICAgIF90aGlzNS5yZWZTZXQgPSBuZXcgX3ByaW1pdGl2ZXMuUmVmU2V0KCk7CiAgICAgICAgICAgICAgICAgICAgbm9kZXNUb1Zpc2l0ID0gW107CgogICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDAsIGlpID0ga2V5cy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICByYXdWYWx1ZSA9IGRpY3QuZ2V0UmF3KGtleXNbaV0pOwoKICAgICAgICAgICAgICAgICAgICAgIGlmIChyYXdWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGVzVG9WaXNpdC5wdXNoKHJhd1ZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iLCBfdGhpczUuX3dhbGsobm9kZXNUb1Zpc2l0KSk7CgogICAgICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBfY2FsbGVlMyk7CiAgICAgICAgICB9KSkoKTsKICAgICAgICB9LAogICAgICAgIF93YWxrOiBmdW5jdGlvbiBfd2Fsayhub2Rlc1RvVmlzaXQpIHsKICAgICAgICAgIHZhciBfdGhpczYgPSB0aGlzOwoKICAgICAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvcigvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yWyJkZWZhdWx0Il0ubWFyayhmdW5jdGlvbiBfY2FsbGVlNCgpIHsKICAgICAgICAgICAgdmFyIG5vZGVzVG9SZXZpc2l0LCBwZW5kaW5nUmVxdWVzdHMsIGN1cnJlbnROb2RlLCBiYXNlU3RyZWFtcywgZm91bmRNaXNzaW5nRGF0YSwgaSwgaWksIHN0cmVhbSwgX2k1LCBfaWkzLCBub2RlOwoKICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclsiZGVmYXVsdCJdLndyYXAoZnVuY3Rpb24gX2NhbGxlZTQkKF9jb250ZXh0NCkgewogICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIG5vZGVzVG9SZXZpc2l0ID0gW107CiAgICAgICAgICAgICAgICAgICAgcGVuZGluZ1JlcXVlc3RzID0gW107CgogICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgaWYgKCFub2Rlc1RvVmlzaXQubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDIyOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBjdXJyZW50Tm9kZSA9IG5vZGVzVG9WaXNpdC5wb3AoKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCEoY3VycmVudE5vZGUgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5SZWYpKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDE4OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAoIV90aGlzNi5yZWZTZXQuaGFzKGN1cnJlbnROb2RlKSkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSA3OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgiY29udGludWUiLCAyKTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQucHJldiA9IDc7CgogICAgICAgICAgICAgICAgICAgIF90aGlzNi5yZWZTZXQucHV0KGN1cnJlbnROb2RlKTsKCiAgICAgICAgICAgICAgICAgICAgY3VycmVudE5vZGUgPSBfdGhpczYueHJlZi5mZXRjaChjdXJyZW50Tm9kZSk7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxODsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0LnByZXYgPSAxMjsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQudDAgPSBfY29udGV4dDRbImNhdGNoIl0oNyk7CgogICAgICAgICAgICAgICAgICAgIGlmIChfY29udGV4dDQudDAgaW5zdGFuY2VvZiBfY29yZV91dGlscy5NaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxNjsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgX2NvbnRleHQ0LnQwOwoKICAgICAgICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICAgICAgICBub2Rlc1RvUmV2aXNpdC5wdXNoKGN1cnJlbnROb2RlKTsKICAgICAgICAgICAgICAgICAgICBwZW5kaW5nUmVxdWVzdHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICBiZWdpbjogX2NvbnRleHQ0LnQwLmJlZ2luLAogICAgICAgICAgICAgICAgICAgICAgZW5kOiBfY29udGV4dDQudDAuZW5kCiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICBjYXNlIDE4OgogICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZSAmJiBjdXJyZW50Tm9kZS5nZXRCYXNlU3RyZWFtcykgewogICAgICAgICAgICAgICAgICAgICAgYmFzZVN0cmVhbXMgPSBjdXJyZW50Tm9kZS5nZXRCYXNlU3RyZWFtcygpOwogICAgICAgICAgICAgICAgICAgICAgZm91bmRNaXNzaW5nRGF0YSA9IGZhbHNlOwoKICAgICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDAsIGlpID0gYmFzZVN0cmVhbXMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICBzdHJlYW0gPSBiYXNlU3RyZWFtc1tpXTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdHJlYW0uYWxsQ2h1bmtzTG9hZGVkICYmICFzdHJlYW0uYWxsQ2h1bmtzTG9hZGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBmb3VuZE1pc3NpbmdEYXRhID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICBwZW5kaW5nUmVxdWVzdHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWdpbjogc3RyZWFtLnN0YXJ0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kOiBzdHJlYW0uZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICBpZiAoZm91bmRNaXNzaW5nRGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICBub2Rlc1RvUmV2aXNpdC5wdXNoKGN1cnJlbnROb2RlKTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGFkZENoaWxkcmVuKGN1cnJlbnROb2RlLCBub2Rlc1RvVmlzaXQpOwogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgMjI6CiAgICAgICAgICAgICAgICAgICAgaWYgKCFwZW5kaW5nUmVxdWVzdHMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDI3OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDI1OwogICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpczYueHJlZi5zdHJlYW0ubWFuYWdlci5yZXF1ZXN0UmFuZ2VzKHBlbmRpbmdSZXF1ZXN0cyk7CgogICAgICAgICAgICAgICAgICBjYXNlIDI1OgogICAgICAgICAgICAgICAgICAgIGZvciAoX2k1ID0gMCwgX2lpMyA9IG5vZGVzVG9SZXZpc2l0Lmxlbmd0aDsgX2k1IDwgX2lpMzsgX2k1KyspIHsKICAgICAgICAgICAgICAgICAgICAgIG5vZGUgPSBub2Rlc1RvUmV2aXNpdFtfaTVdOwoKICAgICAgICAgICAgICAgICAgICAgIGlmIChub2RlIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuUmVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzNi5yZWZTZXQucmVtb3ZlKG5vZGUpOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIF90aGlzNi5fd2Fsayhub2Rlc1RvUmV2aXNpdCkpOwoKICAgICAgICAgICAgICAgICAgY2FzZSAyNzoKICAgICAgICAgICAgICAgICAgICBfdGhpczYucmVmU2V0ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgdW5kZWZpbmVkKTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgMjk6CiAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBfY2FsbGVlNCwgbnVsbCwgW1s3LCAxMl1dKTsKICAgICAgICAgIH0pKSgpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgcmV0dXJuIE9iamVjdExvYWRlcjsKICAgIH0oKTsKCiAgICBleHBvcnRzLk9iamVjdExvYWRlciA9IE9iamVjdExvYWRlcjsKCiAgICAvKioqL30pLCAoCiAgLyogMjAwICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgIHZhbHVlOiB0cnVlCiAgICB9KTsKICAgIGV4cG9ydHMuUGFyc2VyID0gZXhwb3J0cy5MaW5lYXJpemF0aW9uID0gZXhwb3J0cy5MZXhlciA9IHZvaWQgMDsKCiAgICB2YXIgX3N0cmVhbSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjAxKTsKCiAgICB2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUpOwoKICAgIHZhciBfcHJpbWl0aXZlcyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTk0KTsKCiAgICB2YXIgX2NvcmVfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE5Nyk7CgogICAgdmFyIF9jY2l0dF9zdHJlYW0gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIwMik7CgogICAgdmFyIF9qYmlnMl9zdHJlYW0gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIwNCk7CgogICAgdmFyIF9qcGVnX3N0cmVhbSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjA3KTsKCiAgICB2YXIgX2pweF9zdHJlYW0gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIwOSk7CgogICAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3Rvcikge2lmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7fX0KCiAgICBmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7Zm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykge3ZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07ZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlO2Rlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTtpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTtPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7fX0KCiAgICBmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7aWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7aWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpO3JldHVybiBDb25zdHJ1Y3Rvcjt9CgogICAgdmFyIE1BWF9MRU5HVEhfVE9fQ0FDSEUgPSAxMDAwOwogICAgdmFyIE1BWF9BRExFUjMyX0xFTkdUSCA9IDU1NTI7CgogICAgZnVuY3Rpb24gY29tcHV0ZUFkbGVyMzIoYnl0ZXMpIHsKICAgICAgdmFyIGJ5dGVzTGVuZ3RoID0gYnl0ZXMubGVuZ3RoOwogICAgICB2YXIgYSA9IDEsCiAgICAgICAgYiA9IDA7CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJ5dGVzTGVuZ3RoOyArK2kpIHsKICAgICAgICBhICs9IGJ5dGVzW2ldICYgMHhmZjsKICAgICAgICBiICs9IGE7CiAgICAgIH0KCiAgICAgIHJldHVybiBiICUgNjU1MjEgPDwgMTYgfCBhICUgNjU1MjE7CiAgICB9CgogICAgdmFyIFBhcnNlciA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgIGZ1bmN0aW9uIFBhcnNlcihfcmVmKSB7CiAgICAgICAgdmFyIGxleGVyID0gX3JlZi5sZXhlciwKICAgICAgICAgIHhyZWYgPSBfcmVmLnhyZWYsCiAgICAgICAgICBfcmVmJGFsbG93U3RyZWFtcyA9IF9yZWYuYWxsb3dTdHJlYW1zLAogICAgICAgICAgYWxsb3dTdHJlYW1zID0gX3JlZiRhbGxvd1N0cmVhbXMgPT09IHZvaWQgMCA/IGZhbHNlIDogX3JlZiRhbGxvd1N0cmVhbXMsCiAgICAgICAgICBfcmVmJHJlY292ZXJ5TW9kZSA9IF9yZWYucmVjb3ZlcnlNb2RlLAogICAgICAgICAgcmVjb3ZlcnlNb2RlID0gX3JlZiRyZWNvdmVyeU1vZGUgPT09IHZvaWQgMCA/IGZhbHNlIDogX3JlZiRyZWNvdmVyeU1vZGU7CgogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBQYXJzZXIpOwoKICAgICAgICB0aGlzLmxleGVyID0gbGV4ZXI7CiAgICAgICAgdGhpcy54cmVmID0geHJlZjsKICAgICAgICB0aGlzLmFsbG93U3RyZWFtcyA9IGFsbG93U3RyZWFtczsKICAgICAgICB0aGlzLnJlY292ZXJ5TW9kZSA9IHJlY292ZXJ5TW9kZTsKICAgICAgICB0aGlzLmltYWdlQ2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgIHRoaXMucmVmaWxsKCk7CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhQYXJzZXIsIFt7CiAgICAgICAga2V5OiAicmVmaWxsIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcmVmaWxsKCkgewogICAgICAgICAgdGhpcy5idWYxID0gdGhpcy5sZXhlci5nZXRPYmooKTsKICAgICAgICAgIHRoaXMuYnVmMiA9IHRoaXMubGV4ZXIuZ2V0T2JqKCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAic2hpZnQiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzaGlmdCgpIHsKICAgICAgICAgIGlmICh0aGlzLmJ1ZjIgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5DbWQgJiYgdGhpcy5idWYyLmNtZCA9PT0gIklEIikgewogICAgICAgICAgICB0aGlzLmJ1ZjEgPSB0aGlzLmJ1ZjI7CiAgICAgICAgICAgIHRoaXMuYnVmMiA9IG51bGw7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmJ1ZjEgPSB0aGlzLmJ1ZjI7CiAgICAgICAgICAgIHRoaXMuYnVmMiA9IHRoaXMubGV4ZXIuZ2V0T2JqKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAidHJ5U2hpZnQiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiB0cnlTaGlmdCgpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHRoaXMuc2hpZnQoKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgX2NvcmVfdXRpbHMuTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICAgICAgICB0aHJvdyBlOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0T2JqIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0T2JqKCkgewogICAgICAgICAgdmFyIGNpcGhlclRyYW5zZm9ybSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogbnVsbDsKICAgICAgICAgIHZhciBidWYxID0gdGhpcy5idWYxOwogICAgICAgICAgdGhpcy5zaGlmdCgpOwoKICAgICAgICAgIGlmIChidWYxIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuQ21kKSB7CiAgICAgICAgICAgIHN3aXRjaCAoYnVmMS5jbWQpIHsKICAgICAgICAgICAgICBjYXNlICJCSSI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5tYWtlSW5saW5lSW1hZ2UoY2lwaGVyVHJhbnNmb3JtKTsKCiAgICAgICAgICAgICAgY2FzZSAiWyI6CiAgICAgICAgICAgICAgICB2YXIgYXJyYXkgPSBbXTsKCiAgICAgICAgICAgICAgICB3aGlsZSAoISgwLCBfcHJpbWl0aXZlcy5pc0NtZCkodGhpcy5idWYxLCAiXSIpICYmICEoMCwgX3ByaW1pdGl2ZXMuaXNFT0YpKHRoaXMuYnVmMSkpIHsKICAgICAgICAgICAgICAgICAgYXJyYXkucHVzaCh0aGlzLmdldE9iaihjaXBoZXJUcmFuc2Zvcm0pKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoKDAsIF9wcmltaXRpdmVzLmlzRU9GKSh0aGlzLmJ1ZjEpKSB7CiAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5yZWNvdmVyeU1vZGUpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkVuZCBvZiBmaWxlIGluc2lkZSBhcnJheSIpOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICByZXR1cm4gYXJyYXk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy5zaGlmdCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIGFycmF5OwoKICAgICAgICAgICAgICBjYXNlICI8PCI6CiAgICAgICAgICAgICAgICB2YXIgZGljdCA9IG5ldyBfcHJpbWl0aXZlcy5EaWN0KHRoaXMueHJlZik7CgogICAgICAgICAgICAgICAgd2hpbGUgKCEoMCwgX3ByaW1pdGl2ZXMuaXNDbWQpKHRoaXMuYnVmMSwgIj4+IikgJiYgISgwLCBfcHJpbWl0aXZlcy5pc0VPRikodGhpcy5idWYxKSkgewogICAgICAgICAgICAgICAgICBpZiAoISgwLCBfcHJpbWl0aXZlcy5pc05hbWUpKHRoaXMuYnVmMSkpIHsKICAgICAgICAgICAgICAgICAgICAoMCwgX3V0aWwuaW5mbykoIk1hbGZvcm1lZCBkaWN0aW9uYXJ5OiBrZXkgbXVzdCBiZSBhIG5hbWUgb2JqZWN0Iik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaGlmdCgpOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB2YXIga2V5ID0gdGhpcy5idWYxLm5hbWU7CiAgICAgICAgICAgICAgICAgIHRoaXMuc2hpZnQoKTsKCiAgICAgICAgICAgICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNFT0YpKHRoaXMuYnVmMSkpIHsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgZGljdC5zZXQoa2V5LCB0aGlzLmdldE9iaihjaXBoZXJUcmFuc2Zvcm0pKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoKDAsIF9wcmltaXRpdmVzLmlzRU9GKSh0aGlzLmJ1ZjEpKSB7CiAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5yZWNvdmVyeU1vZGUpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkVuZCBvZiBmaWxlIGluc2lkZSBkaWN0aW9uYXJ5Iik7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIHJldHVybiBkaWN0OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNDbWQpKHRoaXMuYnVmMiwgInN0cmVhbSIpKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmFsbG93U3RyZWFtcyA/IHRoaXMubWFrZVN0cmVhbShkaWN0LCBjaXBoZXJUcmFuc2Zvcm0pIDogZGljdDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZGljdDsKCiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiBidWYxOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIoYnVmMSkpIHsKICAgICAgICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIodGhpcy5idWYxKSAmJiAoMCwgX3ByaW1pdGl2ZXMuaXNDbWQpKHRoaXMuYnVmMiwgIlIiKSkgewogICAgICAgICAgICAgIHZhciByZWYgPSBfcHJpbWl0aXZlcy5SZWYuZ2V0KGJ1ZjEsIHRoaXMuYnVmMSk7CgogICAgICAgICAgICAgIHRoaXMuc2hpZnQoKTsKICAgICAgICAgICAgICB0aGlzLnNoaWZ0KCk7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGJ1ZjE7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHR5cGVvZiBidWYxID09PSAic3RyaW5nIikgewogICAgICAgICAgICBpZiAoY2lwaGVyVHJhbnNmb3JtKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGNpcGhlclRyYW5zZm9ybS5kZWNyeXB0U3RyaW5nKGJ1ZjEpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gYnVmMTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gYnVmMTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJmaW5kRGVmYXVsdElubGluZVN0cmVhbUVuZCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGZpbmREZWZhdWx0SW5saW5lU3RyZWFtRW5kKHN0cmVhbSkgewogICAgICAgICAgdmFyIEUgPSAweDQ1LAogICAgICAgICAgICBJID0gMHg0OSwKICAgICAgICAgICAgU1BBQ0UgPSAweDIwLAogICAgICAgICAgICBMRiA9IDB4YSwKICAgICAgICAgICAgQ1IgPSAweGQ7CiAgICAgICAgICB2YXIgbiA9IDEwLAogICAgICAgICAgICBOVUwgPSAweDA7CiAgICAgICAgICB2YXIgc3RhcnRQb3MgPSBzdHJlYW0ucG9zOwogICAgICAgICAgdmFyIHN0YXRlID0gMCwKICAgICAgICAgICAgY2gsCiAgICAgICAgICAgIG1heWJlRUlQb3M7CgogICAgICAgICAgd2hpbGUgKChjaCA9IHN0cmVhbS5nZXRCeXRlKCkpICE9PSAtMSkgewogICAgICAgICAgICBpZiAoc3RhdGUgPT09IDApIHsKICAgICAgICAgICAgICBzdGF0ZSA9IGNoID09PSBFID8gMSA6IDA7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdGUgPT09IDEpIHsKICAgICAgICAgICAgICBzdGF0ZSA9IGNoID09PSBJID8gMiA6IDA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgKDAsIF91dGlsLmFzc2VydCkoc3RhdGUgPT09IDIpOwoKICAgICAgICAgICAgICBpZiAoY2ggPT09IFNQQUNFIHx8IGNoID09PSBMRiB8fCBjaCA9PT0gQ1IpIHsKICAgICAgICAgICAgICAgIG1heWJlRUlQb3MgPSBzdHJlYW0ucG9zOwogICAgICAgICAgICAgICAgdmFyIGZvbGxvd2luZ0J5dGVzID0gc3RyZWFtLnBlZWtCeXRlcyhuKTsKCiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBmb2xsb3dpbmdCeXRlcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgICAgICAgIGNoID0gZm9sbG93aW5nQnl0ZXNbaV07CgogICAgICAgICAgICAgICAgICBpZiAoY2ggPT09IE5VTCAmJiBmb2xsb3dpbmdCeXRlc1tpICsgMV0gIT09IE5VTCkgewogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBpZiAoY2ggIT09IExGICYmIGNoICE9PSBDUiAmJiAoY2ggPCBTUEFDRSB8fCBjaCA+IDB4N2YpKSB7CiAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSAwOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHN0YXRlID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzdGF0ZSA9IDA7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGNoID09PSAtMSkgewogICAgICAgICAgICAoMCwgX3V0aWwud2FybikoImZpbmREZWZhdWx0SW5saW5lU3RyZWFtRW5kOiAiICsgIlJlYWNoZWQgdGhlIGVuZCBvZiB0aGUgc3RyZWFtIHdpdGhvdXQgZmluZGluZyBhIHZhbGlkIEVJIG1hcmtlciIpOwoKICAgICAgICAgICAgaWYgKG1heWJlRUlQb3MpIHsKICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoJy4uLiB0cnlpbmcgdG8gcmVjb3ZlciBieSB1c2luZyB0aGUgbGFzdCAiRUkiIG9jY3VycmVuY2UuJyk7CiAgICAgICAgICAgICAgc3RyZWFtLnNraXAoLShzdHJlYW0ucG9zIC0gbWF5YmVFSVBvcykpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGVuZE9mZnNldCA9IDQ7CiAgICAgICAgICBzdHJlYW0uc2tpcCgtZW5kT2Zmc2V0KTsKICAgICAgICAgIGNoID0gc3RyZWFtLnBlZWtCeXRlKCk7CiAgICAgICAgICBzdHJlYW0uc2tpcChlbmRPZmZzZXQpOwoKICAgICAgICAgIGlmICghKDAsIF9jb3JlX3V0aWxzLmlzV2hpdGVTcGFjZSkoY2gpKSB7CiAgICAgICAgICAgIGVuZE9mZnNldC0tOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBzdHJlYW0ucG9zIC0gZW5kT2Zmc2V0IC0gc3RhcnRQb3M7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZmluZERDVERlY29kZUlubGluZVN0cmVhbUVuZCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGZpbmREQ1REZWNvZGVJbmxpbmVTdHJlYW1FbmQoc3RyZWFtKSB7CiAgICAgICAgICB2YXIgc3RhcnRQb3MgPSBzdHJlYW0ucG9zOwogICAgICAgICAgdmFyIGZvdW5kRU9JID0gZmFsc2UsCiAgICAgICAgICAgIGIsCiAgICAgICAgICAgIG1hcmtlckxlbmd0aDsKCiAgICAgICAgICB3aGlsZSAoKGIgPSBzdHJlYW0uZ2V0Qnl0ZSgpKSAhPT0gLTEpIHsKICAgICAgICAgICAgaWYgKGIgIT09IDB4ZmYpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc3dpdGNoIChzdHJlYW0uZ2V0Qnl0ZSgpKSB7CiAgICAgICAgICAgICAgY2FzZSAweDAwOgogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMHhmZjoKICAgICAgICAgICAgICAgIHN0cmVhbS5za2lwKC0xKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDB4ZDk6CiAgICAgICAgICAgICAgICBmb3VuZEVPSSA9IHRydWU7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAweGMwOgogICAgICAgICAgICAgIGNhc2UgMHhjMToKICAgICAgICAgICAgICBjYXNlIDB4YzI6CiAgICAgICAgICAgICAgY2FzZSAweGMzOgogICAgICAgICAgICAgIGNhc2UgMHhjNToKICAgICAgICAgICAgICBjYXNlIDB4YzY6CiAgICAgICAgICAgICAgY2FzZSAweGM3OgogICAgICAgICAgICAgIGNhc2UgMHhjOToKICAgICAgICAgICAgICBjYXNlIDB4Y2E6CiAgICAgICAgICAgICAgY2FzZSAweGNiOgogICAgICAgICAgICAgIGNhc2UgMHhjZDoKICAgICAgICAgICAgICBjYXNlIDB4Y2U6CiAgICAgICAgICAgICAgY2FzZSAweGNmOgogICAgICAgICAgICAgIGNhc2UgMHhjNDoKICAgICAgICAgICAgICBjYXNlIDB4Y2M6CiAgICAgICAgICAgICAgY2FzZSAweGRhOgogICAgICAgICAgICAgIGNhc2UgMHhkYjoKICAgICAgICAgICAgICBjYXNlIDB4ZGM6CiAgICAgICAgICAgICAgY2FzZSAweGRkOgogICAgICAgICAgICAgIGNhc2UgMHhkZToKICAgICAgICAgICAgICBjYXNlIDB4ZGY6CiAgICAgICAgICAgICAgY2FzZSAweGUwOgogICAgICAgICAgICAgIGNhc2UgMHhlMToKICAgICAgICAgICAgICBjYXNlIDB4ZTI6CiAgICAgICAgICAgICAgY2FzZSAweGUzOgogICAgICAgICAgICAgIGNhc2UgMHhlNDoKICAgICAgICAgICAgICBjYXNlIDB4ZTU6CiAgICAgICAgICAgICAgY2FzZSAweGU2OgogICAgICAgICAgICAgIGNhc2UgMHhlNzoKICAgICAgICAgICAgICBjYXNlIDB4ZTg6CiAgICAgICAgICAgICAgY2FzZSAweGU5OgogICAgICAgICAgICAgIGNhc2UgMHhlYToKICAgICAgICAgICAgICBjYXNlIDB4ZWI6CiAgICAgICAgICAgICAgY2FzZSAweGVjOgogICAgICAgICAgICAgIGNhc2UgMHhlZDoKICAgICAgICAgICAgICBjYXNlIDB4ZWU6CiAgICAgICAgICAgICAgY2FzZSAweGVmOgogICAgICAgICAgICAgIGNhc2UgMHhmZToKICAgICAgICAgICAgICAgIG1hcmtlckxlbmd0aCA9IHN0cmVhbS5nZXRVaW50MTYoKTsKCiAgICAgICAgICAgICAgICBpZiAobWFya2VyTGVuZ3RoID4gMikgewogICAgICAgICAgICAgICAgICBzdHJlYW0uc2tpcChtYXJrZXJMZW5ndGggLSAyKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5za2lwKC0yKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGZvdW5kRU9JKSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgbGVuZ3RoID0gc3RyZWFtLnBvcyAtIHN0YXJ0UG9zOwoKICAgICAgICAgIGlmIChiID09PSAtMSkgewogICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIklubGluZSBEQ1REZWNvZGUgaW1hZ2Ugc3RyZWFtOiAiICsgIkVPSSBtYXJrZXIgbm90IGZvdW5kLCBzZWFyY2hpbmcgZm9yIC9FSS8gaW5zdGVhZC4iKTsKICAgICAgICAgICAgc3RyZWFtLnNraXAoLWxlbmd0aCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbmREZWZhdWx0SW5saW5lU3RyZWFtRW5kKHN0cmVhbSk7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbmxpbmVTdHJlYW1Ta2lwRUkoc3RyZWFtKTsKICAgICAgICAgIHJldHVybiBsZW5ndGg7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZmluZEFTQ0lJODVEZWNvZGVJbmxpbmVTdHJlYW1FbmQiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBmaW5kQVNDSUk4NURlY29kZUlubGluZVN0cmVhbUVuZChzdHJlYW0pIHsKICAgICAgICAgIHZhciBUSUxERSA9IDB4N2UsCiAgICAgICAgICAgIEdUID0gMHgzZTsKICAgICAgICAgIHZhciBzdGFydFBvcyA9IHN0cmVhbS5wb3M7CiAgICAgICAgICB2YXIgY2g7CgogICAgICAgICAgd2hpbGUgKChjaCA9IHN0cmVhbS5nZXRCeXRlKCkpICE9PSAtMSkgewogICAgICAgICAgICBpZiAoY2ggPT09IFRJTERFKSB7CiAgICAgICAgICAgICAgdmFyIHRpbGRlUG9zID0gc3RyZWFtLnBvczsKICAgICAgICAgICAgICBjaCA9IHN0cmVhbS5wZWVrQnl0ZSgpOwoKICAgICAgICAgICAgICB3aGlsZSAoKDAsIF9jb3JlX3V0aWxzLmlzV2hpdGVTcGFjZSkoY2gpKSB7CiAgICAgICAgICAgICAgICBzdHJlYW0uc2tpcCgpOwogICAgICAgICAgICAgICAgY2ggPSBzdHJlYW0ucGVla0J5dGUoKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChjaCA9PT0gR1QpIHsKICAgICAgICAgICAgICAgIHN0cmVhbS5za2lwKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChzdHJlYW0ucG9zID4gdGlsZGVQb3MpIHsKICAgICAgICAgICAgICAgIHZhciBtYXliZUVJID0gc3RyZWFtLnBlZWtCeXRlcygyKTsKCiAgICAgICAgICAgICAgICBpZiAobWF5YmVFSVswXSA9PT0gMHg0NSAmJiBtYXliZUVJWzFdID09PSAweDQ5KSB7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHZhciBsZW5ndGggPSBzdHJlYW0ucG9zIC0gc3RhcnRQb3M7CgogICAgICAgICAgaWYgKGNoID09PSAtMSkgewogICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIklubGluZSBBU0NJSTg1RGVjb2RlIGltYWdlIHN0cmVhbTogIiArICJFT0QgbWFya2VyIG5vdCBmb3VuZCwgc2VhcmNoaW5nIGZvciAvRUkvIGluc3RlYWQuIik7CiAgICAgICAgICAgIHN0cmVhbS5za2lwKC1sZW5ndGgpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5maW5kRGVmYXVsdElubGluZVN0cmVhbUVuZChzdHJlYW0pOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuaW5saW5lU3RyZWFtU2tpcEVJKHN0cmVhbSk7CiAgICAgICAgICByZXR1cm4gbGVuZ3RoOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImZpbmRBU0NJSUhleERlY29kZUlubGluZVN0cmVhbUVuZCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGZpbmRBU0NJSUhleERlY29kZUlubGluZVN0cmVhbUVuZChzdHJlYW0pIHsKICAgICAgICAgIHZhciBHVCA9IDB4M2U7CiAgICAgICAgICB2YXIgc3RhcnRQb3MgPSBzdHJlYW0ucG9zOwogICAgICAgICAgdmFyIGNoOwoKICAgICAgICAgIHdoaWxlICgoY2ggPSBzdHJlYW0uZ2V0Qnl0ZSgpKSAhPT0gLTEpIHsKICAgICAgICAgICAgaWYgKGNoID09PSBHVCkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGxlbmd0aCA9IHN0cmVhbS5wb3MgLSBzdGFydFBvczsKCiAgICAgICAgICBpZiAoY2ggPT09IC0xKSB7CiAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiSW5saW5lIEFTQ0lJSGV4RGVjb2RlIGltYWdlIHN0cmVhbTogIiArICJFT0QgbWFya2VyIG5vdCBmb3VuZCwgc2VhcmNoaW5nIGZvciAvRUkvIGluc3RlYWQuIik7CiAgICAgICAgICAgIHN0cmVhbS5za2lwKC1sZW5ndGgpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5maW5kRGVmYXVsdElubGluZVN0cmVhbUVuZChzdHJlYW0pOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuaW5saW5lU3RyZWFtU2tpcEVJKHN0cmVhbSk7CiAgICAgICAgICByZXR1cm4gbGVuZ3RoOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImlubGluZVN0cmVhbVNraXBFSSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGlubGluZVN0cmVhbVNraXBFSShzdHJlYW0pIHsKICAgICAgICAgIHZhciBFID0gMHg0NSwKICAgICAgICAgICAgSSA9IDB4NDk7CiAgICAgICAgICB2YXIgc3RhdGUgPSAwLAogICAgICAgICAgICBjaDsKCiAgICAgICAgICB3aGlsZSAoKGNoID0gc3RyZWFtLmdldEJ5dGUoKSkgIT09IC0xKSB7CiAgICAgICAgICAgIGlmIChzdGF0ZSA9PT0gMCkgewogICAgICAgICAgICAgIHN0YXRlID0gY2ggPT09IEUgPyAxIDogMDsKICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0ZSA9PT0gMSkgewogICAgICAgICAgICAgIHN0YXRlID0gY2ggPT09IEkgPyAyIDogMDsKICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0ZSA9PT0gMikgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAibWFrZUlubGluZUltYWdlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gbWFrZUlubGluZUltYWdlKGNpcGhlclRyYW5zZm9ybSkgewogICAgICAgICAgdmFyIGxleGVyID0gdGhpcy5sZXhlcjsKICAgICAgICAgIHZhciBzdHJlYW0gPSBsZXhlci5zdHJlYW07CiAgICAgICAgICB2YXIgZGljdCA9IG5ldyBfcHJpbWl0aXZlcy5EaWN0KHRoaXMueHJlZik7CiAgICAgICAgICB2YXIgZGljdExlbmd0aDsKCiAgICAgICAgICB3aGlsZSAoISgwLCBfcHJpbWl0aXZlcy5pc0NtZCkodGhpcy5idWYxLCAiSUQiKSAmJiAhKDAsIF9wcmltaXRpdmVzLmlzRU9GKSh0aGlzLmJ1ZjEpKSB7CiAgICAgICAgICAgIGlmICghKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkodGhpcy5idWYxKSkgewogICAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiRGljdGlvbmFyeSBrZXkgbXVzdCBiZSBhIG5hbWUgb2JqZWN0Iik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBrZXkgPSB0aGlzLmJ1ZjEubmFtZTsKICAgICAgICAgICAgdGhpcy5zaGlmdCgpOwoKICAgICAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc0VPRikodGhpcy5idWYxKSkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBkaWN0LnNldChrZXksIHRoaXMuZ2V0T2JqKGNpcGhlclRyYW5zZm9ybSkpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChsZXhlci5iZWdpbklubGluZUltYWdlUG9zICE9PSAtMSkgewogICAgICAgICAgICBkaWN0TGVuZ3RoID0gc3RyZWFtLnBvcyAtIGxleGVyLmJlZ2luSW5saW5lSW1hZ2VQb3M7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGZpbHRlciA9IGRpY3QuZ2V0KCJGaWx0ZXIiLCAiRiIpOwogICAgICAgICAgdmFyIGZpbHRlck5hbWU7CgogICAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc05hbWUpKGZpbHRlcikpIHsKICAgICAgICAgICAgZmlsdGVyTmFtZSA9IGZpbHRlci5uYW1lOwogICAgICAgICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGZpbHRlcikpIHsKICAgICAgICAgICAgdmFyIGZpbHRlclplcm8gPSB0aGlzLnhyZWYuZmV0Y2hJZlJlZihmaWx0ZXJbMF0pOwoKICAgICAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc05hbWUpKGZpbHRlclplcm8pKSB7CiAgICAgICAgICAgICAgZmlsdGVyTmFtZSA9IGZpbHRlclplcm8ubmFtZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHZhciBzdGFydFBvcyA9IHN0cmVhbS5wb3M7CiAgICAgICAgICB2YXIgbGVuZ3RoOwoKICAgICAgICAgIGlmIChmaWx0ZXJOYW1lID09PSAiRENURGVjb2RlIiB8fCBmaWx0ZXJOYW1lID09PSAiRENUIikgewogICAgICAgICAgICBsZW5ndGggPSB0aGlzLmZpbmREQ1REZWNvZGVJbmxpbmVTdHJlYW1FbmQoc3RyZWFtKTsKICAgICAgICAgIH0gZWxzZSBpZiAoZmlsdGVyTmFtZSA9PT0gIkFTQ0lJODVEZWNvZGUiIHx8IGZpbHRlck5hbWUgPT09ICJBODUiKSB7CiAgICAgICAgICAgIGxlbmd0aCA9IHRoaXMuZmluZEFTQ0lJODVEZWNvZGVJbmxpbmVTdHJlYW1FbmQoc3RyZWFtKTsKICAgICAgICAgIH0gZWxzZSBpZiAoZmlsdGVyTmFtZSA9PT0gIkFTQ0lJSGV4RGVjb2RlIiB8fCBmaWx0ZXJOYW1lID09PSAiQUh4IikgewogICAgICAgICAgICBsZW5ndGggPSB0aGlzLmZpbmRBU0NJSUhleERlY29kZUlubGluZVN0cmVhbUVuZChzdHJlYW0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbGVuZ3RoID0gdGhpcy5maW5kRGVmYXVsdElubGluZVN0cmVhbUVuZChzdHJlYW0pOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBpbWFnZVN0cmVhbSA9IHN0cmVhbS5tYWtlU3ViU3RyZWFtKHN0YXJ0UG9zLCBsZW5ndGgsIGRpY3QpOwogICAgICAgICAgdmFyIGNhY2hlS2V5OwoKICAgICAgICAgIGlmIChsZW5ndGggPCBNQVhfTEVOR1RIX1RPX0NBQ0hFICYmIGRpY3RMZW5ndGggPCBNQVhfQURMRVIzMl9MRU5HVEgpIHsKICAgICAgICAgICAgdmFyIGltYWdlQnl0ZXMgPSBpbWFnZVN0cmVhbS5nZXRCeXRlcygpOwogICAgICAgICAgICBpbWFnZVN0cmVhbS5yZXNldCgpOwogICAgICAgICAgICB2YXIgaW5pdGlhbFN0cmVhbVBvcyA9IHN0cmVhbS5wb3M7CiAgICAgICAgICAgIHN0cmVhbS5wb3MgPSBsZXhlci5iZWdpbklubGluZUltYWdlUG9zOwogICAgICAgICAgICB2YXIgZGljdEJ5dGVzID0gc3RyZWFtLmdldEJ5dGVzKGRpY3RMZW5ndGgpOwogICAgICAgICAgICBzdHJlYW0ucG9zID0gaW5pdGlhbFN0cmVhbVBvczsKICAgICAgICAgICAgY2FjaGVLZXkgPSBjb21wdXRlQWRsZXIzMihpbWFnZUJ5dGVzKSArICJfIiArIGNvbXB1dGVBZGxlcjMyKGRpY3RCeXRlcyk7CiAgICAgICAgICAgIHZhciBjYWNoZUVudHJ5ID0gdGhpcy5pbWFnZUNhY2hlW2NhY2hlS2V5XTsKCiAgICAgICAgICAgIGlmIChjYWNoZUVudHJ5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICB0aGlzLmJ1ZjIgPSBfcHJpbWl0aXZlcy5DbWQuZ2V0KCJFSSIpOwogICAgICAgICAgICAgIHRoaXMuc2hpZnQoKTsKICAgICAgICAgICAgICBjYWNoZUVudHJ5LnJlc2V0KCk7CiAgICAgICAgICAgICAgcmV0dXJuIGNhY2hlRW50cnk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoY2lwaGVyVHJhbnNmb3JtKSB7CiAgICAgICAgICAgIGltYWdlU3RyZWFtID0gY2lwaGVyVHJhbnNmb3JtLmNyZWF0ZVN0cmVhbShpbWFnZVN0cmVhbSwgbGVuZ3RoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpbWFnZVN0cmVhbSA9IHRoaXMuZmlsdGVyKGltYWdlU3RyZWFtLCBkaWN0LCBsZW5ndGgpOwogICAgICAgICAgaW1hZ2VTdHJlYW0uZGljdCA9IGRpY3Q7CgogICAgICAgICAgaWYgKGNhY2hlS2V5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgaW1hZ2VTdHJlYW0uY2FjaGVLZXkgPSAiaW5saW5lXyIuY29uY2F0KGxlbmd0aCwgIl8iKS5jb25jYXQoY2FjaGVLZXkpOwogICAgICAgICAgICB0aGlzLmltYWdlQ2FjaGVbY2FjaGVLZXldID0gaW1hZ2VTdHJlYW07CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5idWYyID0gX3ByaW1pdGl2ZXMuQ21kLmdldCgiRUkiKTsKICAgICAgICAgIHRoaXMuc2hpZnQoKTsKICAgICAgICAgIHJldHVybiBpbWFnZVN0cmVhbTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJfZmluZFN0cmVhbUxlbmd0aCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9maW5kU3RyZWFtTGVuZ3RoKHN0YXJ0UG9zLCBzaWduYXR1cmUpIHsKICAgICAgICAgIHZhciBzdHJlYW0gPSB0aGlzLmxleGVyLnN0cmVhbTsKICAgICAgICAgIHN0cmVhbS5wb3MgPSBzdGFydFBvczsKICAgICAgICAgIHZhciBTQ0FOX0JMT0NLX0xFTkdUSCA9IDIwNDg7CiAgICAgICAgICB2YXIgc2lnbmF0dXJlTGVuZ3RoID0gc2lnbmF0dXJlLmxlbmd0aDsKCiAgICAgICAgICB3aGlsZSAoc3RyZWFtLnBvcyA8IHN0cmVhbS5lbmQpIHsKICAgICAgICAgICAgdmFyIHNjYW5CeXRlcyA9IHN0cmVhbS5wZWVrQnl0ZXMoU0NBTl9CTE9DS19MRU5HVEgpOwogICAgICAgICAgICB2YXIgc2Nhbkxlbmd0aCA9IHNjYW5CeXRlcy5sZW5ndGggLSBzaWduYXR1cmVMZW5ndGg7CgogICAgICAgICAgICBpZiAoc2Nhbkxlbmd0aCA8PSAwKSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBwb3MgPSAwOwoKICAgICAgICAgICAgd2hpbGUgKHBvcyA8IHNjYW5MZW5ndGgpIHsKICAgICAgICAgICAgICB2YXIgaiA9IDA7CgogICAgICAgICAgICAgIHdoaWxlIChqIDwgc2lnbmF0dXJlTGVuZ3RoICYmIHNjYW5CeXRlc1twb3MgKyBqXSA9PT0gc2lnbmF0dXJlW2pdKSB7CiAgICAgICAgICAgICAgICBqKys7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoaiA+PSBzaWduYXR1cmVMZW5ndGgpIHsKICAgICAgICAgICAgICAgIHN0cmVhbS5wb3MgKz0gcG9zOwogICAgICAgICAgICAgICAgcmV0dXJuIHN0cmVhbS5wb3MgLSBzdGFydFBvczsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHBvcysrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzdHJlYW0ucG9zICs9IHNjYW5MZW5ndGg7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIm1ha2VTdHJlYW0iLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBtYWtlU3RyZWFtKGRpY3QsIGNpcGhlclRyYW5zZm9ybSkgewogICAgICAgICAgdmFyIGxleGVyID0gdGhpcy5sZXhlcjsKICAgICAgICAgIHZhciBzdHJlYW0gPSBsZXhlci5zdHJlYW07CiAgICAgICAgICBsZXhlci5za2lwVG9OZXh0TGluZSgpOwogICAgICAgICAgdmFyIHN0YXJ0UG9zID0gc3RyZWFtLnBvcyAtIDE7CiAgICAgICAgICB2YXIgbGVuZ3RoID0gZGljdC5nZXQoIkxlbmd0aCIpOwoKICAgICAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihsZW5ndGgpKSB7CiAgICAgICAgICAgICgwLCBfdXRpbC5pbmZvKSgiQmFkIGxlbmd0aCBcIiIuY29uY2F0KGxlbmd0aCwgIlwiIGluIHN0cmVhbSIpKTsKICAgICAgICAgICAgbGVuZ3RoID0gMDsKICAgICAgICAgIH0KCiAgICAgICAgICBzdHJlYW0ucG9zID0gc3RhcnRQb3MgKyBsZW5ndGg7CiAgICAgICAgICBsZXhlci5uZXh0Q2hhcigpOwoKICAgICAgICAgIGlmICh0aGlzLnRyeVNoaWZ0KCkgJiYgKDAsIF9wcmltaXRpdmVzLmlzQ21kKSh0aGlzLmJ1ZjIsICJlbmRzdHJlYW0iKSkgewogICAgICAgICAgICB0aGlzLnNoaWZ0KCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgRU5EU1RSRUFNX1NJR05BVFVSRSA9IG5ldyBVaW50OEFycmF5KFsweDY1LCAweDZFLCAweDY0LCAweDczLCAweDc0LCAweDcyLCAweDY1LCAweDYxLCAweDZEXSk7CgogICAgICAgICAgICB2YXIgYWN0dWFsTGVuZ3RoID0gdGhpcy5fZmluZFN0cmVhbUxlbmd0aChzdGFydFBvcywgRU5EU1RSRUFNX1NJR05BVFVSRSk7CgogICAgICAgICAgICBpZiAoYWN0dWFsTGVuZ3RoIDwgMCkgewogICAgICAgICAgICAgIHZhciBNQVhfVFJVTkNBVElPTiA9IDE7CgogICAgICAgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDw9IE1BWF9UUlVOQ0FUSU9OOyBpKyspIHsKICAgICAgICAgICAgICAgIHZhciBlbmQgPSBFTkRTVFJFQU1fU0lHTkFUVVJFLmxlbmd0aCAtIGk7CiAgICAgICAgICAgICAgICB2YXIgVFJVTkNBVEVEX1NJR05BVFVSRSA9IEVORFNUUkVBTV9TSUdOQVRVUkUuc2xpY2UoMCwgZW5kKTsKCiAgICAgICAgICAgICAgICB2YXIgbWF5YmVMZW5ndGggPSB0aGlzLl9maW5kU3RyZWFtTGVuZ3RoKHN0YXJ0UG9zLCBUUlVOQ0FURURfU0lHTkFUVVJFKTsKCiAgICAgICAgICAgICAgICBpZiAobWF5YmVMZW5ndGggPj0gMCkgewogICAgICAgICAgICAgICAgICB2YXIgbGFzdEJ5dGUgPSBzdHJlYW0ucGVla0J5dGVzKGVuZCArIDEpW2VuZF07CgogICAgICAgICAgICAgICAgICBpZiAoISgwLCBfY29yZV91dGlscy5pc1doaXRlU3BhY2UpKGxhc3RCeXRlKSkgewogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAoMCwgX3V0aWwuaW5mbykoIkZvdW5kIFwiIi5jb25jYXQoKDAsIF91dGlsLmJ5dGVzVG9TdHJpbmcpKFRSVU5DQVRFRF9TSUdOQVRVUkUpLCAiXCIgd2hlbiAiKSArICJzZWFyY2hpbmcgZm9yIGVuZHN0cmVhbSBjb21tYW5kLiIpOwogICAgICAgICAgICAgICAgICBhY3R1YWxMZW5ndGggPSBtYXliZUxlbmd0aDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoYWN0dWFsTGVuZ3RoIDwgMCkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJNaXNzaW5nIGVuZHN0cmVhbSBjb21tYW5kLiIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgbGVuZ3RoID0gYWN0dWFsTGVuZ3RoOwogICAgICAgICAgICBsZXhlci5uZXh0Q2hhcigpOwogICAgICAgICAgICB0aGlzLnNoaWZ0KCk7CiAgICAgICAgICAgIHRoaXMuc2hpZnQoKTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnNoaWZ0KCk7CiAgICAgICAgICBzdHJlYW0gPSBzdHJlYW0ubWFrZVN1YlN0cmVhbShzdGFydFBvcywgbGVuZ3RoLCBkaWN0KTsKCiAgICAgICAgICBpZiAoY2lwaGVyVHJhbnNmb3JtKSB7CiAgICAgICAgICAgIHN0cmVhbSA9IGNpcGhlclRyYW5zZm9ybS5jcmVhdGVTdHJlYW0oc3RyZWFtLCBsZW5ndGgpOwogICAgICAgICAgfQoKICAgICAgICAgIHN0cmVhbSA9IHRoaXMuZmlsdGVyKHN0cmVhbSwgZGljdCwgbGVuZ3RoKTsKICAgICAgICAgIHN0cmVhbS5kaWN0ID0gZGljdDsKICAgICAgICAgIHJldHVybiBzdHJlYW07CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZmlsdGVyIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZmlsdGVyKHN0cmVhbSwgZGljdCwgbGVuZ3RoKSB7CiAgICAgICAgICB2YXIgZmlsdGVyID0gZGljdC5nZXQoIkZpbHRlciIsICJGIik7CiAgICAgICAgICB2YXIgcGFyYW1zID0gZGljdC5nZXQoIkRlY29kZVBhcm1zIiwgIkRQIik7CgogICAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc05hbWUpKGZpbHRlcikpIHsKICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkocGFyYW1zKSkgewogICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiL0RlY29kZVBhcm1zIHNob3VsZCBub3QgY29udGFpbiBhbiBBcnJheSwgIiArICJ3aGVuIC9GaWx0ZXIgY29udGFpbnMgYSBOYW1lLiIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdGhpcy5tYWtlRmlsdGVyKHN0cmVhbSwgZmlsdGVyLm5hbWUsIGxlbmd0aCwgcGFyYW1zKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgbWF5YmVMZW5ndGggPSBsZW5ndGg7CgogICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZmlsdGVyKSkgewogICAgICAgICAgICB2YXIgZmlsdGVyQXJyYXkgPSBmaWx0ZXI7CiAgICAgICAgICAgIHZhciBwYXJhbXNBcnJheSA9IHBhcmFtczsKCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGZpbHRlckFycmF5Lmxlbmd0aDsgaSA8IGlpOyArK2kpIHsKICAgICAgICAgICAgICBmaWx0ZXIgPSB0aGlzLnhyZWYuZmV0Y2hJZlJlZihmaWx0ZXJBcnJheVtpXSk7CgogICAgICAgICAgICAgIGlmICghKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkoZmlsdGVyKSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJCYWQgZmlsdGVyIG5hbWUgXCIiLmNvbmNhdChmaWx0ZXIsICJcIiIpKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHBhcmFtcyA9IG51bGw7CgogICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHBhcmFtc0FycmF5KSAmJiBpIGluIHBhcmFtc0FycmF5KSB7CiAgICAgICAgICAgICAgICBwYXJhbXMgPSB0aGlzLnhyZWYuZmV0Y2hJZlJlZihwYXJhbXNBcnJheVtpXSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzdHJlYW0gPSB0aGlzLm1ha2VGaWx0ZXIoc3RyZWFtLCBmaWx0ZXIubmFtZSwgbWF5YmVMZW5ndGgsIHBhcmFtcyk7CiAgICAgICAgICAgICAgbWF5YmVMZW5ndGggPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHN0cmVhbTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJtYWtlRmlsdGVyIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gbWFrZUZpbHRlcihzdHJlYW0sIG5hbWUsIG1heWJlTGVuZ3RoLCBwYXJhbXMpIHsKICAgICAgICAgIGlmIChtYXliZUxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIkVtcHR5IFwiIi5jb25jYXQobmFtZSwgIlwiIHN0cmVhbS4iKSk7CiAgICAgICAgICAgIHJldHVybiBuZXcgX3N0cmVhbS5OdWxsU3RyZWFtKCk7CiAgICAgICAgICB9CgogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdmFyIHhyZWZTdHJlYW1TdGF0cyA9IHRoaXMueHJlZi5zdGF0cy5zdHJlYW1UeXBlczsKCiAgICAgICAgICAgIGlmIChuYW1lID09PSAiRmxhdGVEZWNvZGUiIHx8IG5hbWUgPT09ICJGbCIpIHsKICAgICAgICAgICAgICB4cmVmU3RyZWFtU3RhdHNbX3V0aWwuU3RyZWFtVHlwZS5GTEFURV0gPSB0cnVlOwoKICAgICAgICAgICAgICBpZiAocGFyYW1zKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IF9zdHJlYW0uUHJlZGljdG9yU3RyZWFtKG5ldyBfc3RyZWFtLkZsYXRlU3RyZWFtKHN0cmVhbSwgbWF5YmVMZW5ndGgpLCBtYXliZUxlbmd0aCwgcGFyYW1zKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBuZXcgX3N0cmVhbS5GbGF0ZVN0cmVhbShzdHJlYW0sIG1heWJlTGVuZ3RoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKG5hbWUgPT09ICJMWldEZWNvZGUiIHx8IG5hbWUgPT09ICJMWlciKSB7CiAgICAgICAgICAgICAgeHJlZlN0cmVhbVN0YXRzW191dGlsLlN0cmVhbVR5cGUuTFpXXSA9IHRydWU7CiAgICAgICAgICAgICAgdmFyIGVhcmx5Q2hhbmdlID0gMTsKCiAgICAgICAgICAgICAgaWYgKHBhcmFtcykgewogICAgICAgICAgICAgICAgaWYgKHBhcmFtcy5oYXMoIkVhcmx5Q2hhbmdlIikpIHsKICAgICAgICAgICAgICAgICAgZWFybHlDaGFuZ2UgPSBwYXJhbXMuZ2V0KCJFYXJseUNoYW5nZSIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgX3N0cmVhbS5QcmVkaWN0b3JTdHJlYW0obmV3IF9zdHJlYW0uTFpXU3RyZWFtKHN0cmVhbSwgbWF5YmVMZW5ndGgsIGVhcmx5Q2hhbmdlKSwgbWF5YmVMZW5ndGgsIHBhcmFtcyk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gbmV3IF9zdHJlYW0uTFpXU3RyZWFtKHN0cmVhbSwgbWF5YmVMZW5ndGgsIGVhcmx5Q2hhbmdlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKG5hbWUgPT09ICJEQ1REZWNvZGUiIHx8IG5hbWUgPT09ICJEQ1QiKSB7CiAgICAgICAgICAgICAgeHJlZlN0cmVhbVN0YXRzW191dGlsLlN0cmVhbVR5cGUuRENUXSA9IHRydWU7CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBfanBlZ19zdHJlYW0uSnBlZ1N0cmVhbShzdHJlYW0sIG1heWJlTGVuZ3RoLCBzdHJlYW0uZGljdCwgcGFyYW1zKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKG5hbWUgPT09ICJKUFhEZWNvZGUiIHx8IG5hbWUgPT09ICJKUFgiKSB7CiAgICAgICAgICAgICAgeHJlZlN0cmVhbVN0YXRzW191dGlsLlN0cmVhbVR5cGUuSlBYXSA9IHRydWU7CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBfanB4X3N0cmVhbS5KcHhTdHJlYW0oc3RyZWFtLCBtYXliZUxlbmd0aCwgc3RyZWFtLmRpY3QsIHBhcmFtcyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChuYW1lID09PSAiQVNDSUk4NURlY29kZSIgfHwgbmFtZSA9PT0gIkE4NSIpIHsKICAgICAgICAgICAgICB4cmVmU3RyZWFtU3RhdHNbX3V0aWwuU3RyZWFtVHlwZS5BODVdID0gdHJ1ZTsKICAgICAgICAgICAgICByZXR1cm4gbmV3IF9zdHJlYW0uQXNjaWk4NVN0cmVhbShzdHJlYW0sIG1heWJlTGVuZ3RoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKG5hbWUgPT09ICJBU0NJSUhleERlY29kZSIgfHwgbmFtZSA9PT0gIkFIeCIpIHsKICAgICAgICAgICAgICB4cmVmU3RyZWFtU3RhdHNbX3V0aWwuU3RyZWFtVHlwZS5BSFhdID0gdHJ1ZTsKICAgICAgICAgICAgICByZXR1cm4gbmV3IF9zdHJlYW0uQXNjaWlIZXhTdHJlYW0oc3RyZWFtLCBtYXliZUxlbmd0aCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChuYW1lID09PSAiQ0NJVFRGYXhEZWNvZGUiIHx8IG5hbWUgPT09ICJDQ0YiKSB7CiAgICAgICAgICAgICAgeHJlZlN0cmVhbVN0YXRzW191dGlsLlN0cmVhbVR5cGUuQ0NGXSA9IHRydWU7CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBfY2NpdHRfc3RyZWFtLkNDSVRURmF4U3RyZWFtKHN0cmVhbSwgbWF5YmVMZW5ndGgsIHBhcmFtcyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChuYW1lID09PSAiUnVuTGVuZ3RoRGVjb2RlIiB8fCBuYW1lID09PSAiUkwiKSB7CiAgICAgICAgICAgICAgeHJlZlN0cmVhbVN0YXRzW191dGlsLlN0cmVhbVR5cGUuUkxYXSA9IHRydWU7CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBfc3RyZWFtLlJ1bkxlbmd0aFN0cmVhbShzdHJlYW0sIG1heWJlTGVuZ3RoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKG5hbWUgPT09ICJKQklHMkRlY29kZSIpIHsKICAgICAgICAgICAgICB4cmVmU3RyZWFtU3RhdHNbX3V0aWwuU3RyZWFtVHlwZS5KQklHXSA9IHRydWU7CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBfamJpZzJfc3RyZWFtLkpiaWcyU3RyZWFtKHN0cmVhbSwgbWF5YmVMZW5ndGgsIHN0cmVhbS5kaWN0LCBwYXJhbXMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIkZpbHRlciBcIiIuY29uY2F0KG5hbWUsICJcIiBpcyBub3Qgc3VwcG9ydGVkLiIpKTsKICAgICAgICAgICAgcmV0dXJuIHN0cmVhbTsKICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgICAgIGlmIChleCBpbnN0YW5jZW9mIF9jb3JlX3V0aWxzLk1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgdGhyb3cgZXg7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiSW52YWxpZCBzdHJlYW06IFwiIi5jb25jYXQoZXgsICJcIiIpKTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBfc3RyZWFtLk51bGxTdHJlYW0oKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBQYXJzZXI7CiAgICB9KCk7CgogICAgZXhwb3J0cy5QYXJzZXIgPSBQYXJzZXI7CiAgICB2YXIgc3BlY2lhbENoYXJzID0gWzEsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDEsIDEsIDAsIDEsIDEsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDEsIDAsIDAsIDAsIDAsIDIsIDAsIDAsIDIsIDIsIDAsIDAsIDAsIDAsIDAsIDIsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDIsIDAsIDIsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDIsIDAsIDIsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDIsIDAsIDIsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDBdOwoKICAgIGZ1bmN0aW9uIHRvSGV4RGlnaXQoY2gpIHsKICAgICAgaWYgKGNoID49IDB4MzAgJiYgY2ggPD0gMHgzOSkgewogICAgICAgIHJldHVybiBjaCAmIDB4MGY7CiAgICAgIH0KCiAgICAgIGlmIChjaCA+PSAweDQxICYmIGNoIDw9IDB4NDYgfHwgY2ggPj0gMHg2MSAmJiBjaCA8PSAweDY2KSB7CiAgICAgICAgcmV0dXJuIChjaCAmIDB4MGYpICsgOTsKICAgICAgfQoKICAgICAgcmV0dXJuIC0xOwogICAgfQoKICAgIHZhciBMZXhlciA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgIGZ1bmN0aW9uIExleGVyKHN0cmVhbSkgewogICAgICAgIHZhciBrbm93bkNvbW1hbmRzID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBudWxsOwoKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgTGV4ZXIpOwoKICAgICAgICB0aGlzLnN0cmVhbSA9IHN0cmVhbTsKICAgICAgICB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgdGhpcy5zdHJCdWYgPSBbXTsKICAgICAgICB0aGlzLmtub3duQ29tbWFuZHMgPSBrbm93bkNvbW1hbmRzOwogICAgICAgIHRoaXMuX2hleFN0cmluZ051bVdhcm4gPSAwOwogICAgICAgIHRoaXMuYmVnaW5JbmxpbmVJbWFnZVBvcyA9IC0xOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoTGV4ZXIsIFt7CiAgICAgICAga2V5OiAibmV4dENoYXIiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBuZXh0Q2hhcigpIHsKICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRDaGFyID0gdGhpcy5zdHJlYW0uZ2V0Qnl0ZSgpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInBlZWtDaGFyIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcGVla0NoYXIoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5zdHJlYW0ucGVla0J5dGUoKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJnZXROdW1iZXIiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXROdW1iZXIoKSB7CiAgICAgICAgICB2YXIgY2ggPSB0aGlzLmN1cnJlbnRDaGFyOwogICAgICAgICAgdmFyIGVOb3RhdGlvbiA9IGZhbHNlOwogICAgICAgICAgdmFyIGRpdmlkZUJ5ID0gMDsKICAgICAgICAgIHZhciBzaWduID0gMDsKCiAgICAgICAgICBpZiAoY2ggPT09IDB4MmQpIHsKICAgICAgICAgICAgc2lnbiA9IC0xOwogICAgICAgICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKCiAgICAgICAgICAgIGlmIChjaCA9PT0gMHgyZCkgewogICAgICAgICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKGNoID09PSAweDJiKSB7CiAgICAgICAgICAgIHNpZ24gPSAxOwogICAgICAgICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoY2ggPT09IDB4MGEgfHwgY2ggPT09IDB4MGQpIHsKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgICB9IHdoaWxlIChjaCA9PT0gMHgwYSB8fCBjaCA9PT0gMHgwZCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGNoID09PSAweDJlKSB7CiAgICAgICAgICAgIGRpdmlkZUJ5ID0gMTA7CiAgICAgICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChjaCA8IDB4MzAgfHwgY2ggPiAweDM5KSB7CiAgICAgICAgICAgIGlmIChkaXZpZGVCeSA9PT0gMTAgJiYgc2lnbiA9PT0gMCAmJiAoKDAsIF9jb3JlX3V0aWxzLmlzV2hpdGVTcGFjZSkoY2gpIHx8IGNoID09PSAtMSkpIHsKICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIkxleGVyLmdldE51bWJlciAtIHRyZWF0aW5nIGEgc2luZ2xlIGRlY2ltYWwgcG9pbnQgYXMgemVyby4iKTsKICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJJbnZhbGlkIG51bWJlcjogIi5jb25jYXQoU3RyaW5nLmZyb21DaGFyQ29kZShjaCksICIgKGNoYXJDb2RlICIpLmNvbmNhdChjaCwgIikiKSk7CiAgICAgICAgICB9CgogICAgICAgICAgc2lnbiA9IHNpZ24gfHwgMTsKICAgICAgICAgIHZhciBiYXNlVmFsdWUgPSBjaCAtIDB4MzA7CiAgICAgICAgICB2YXIgcG93ZXJWYWx1ZSA9IDA7CiAgICAgICAgICB2YXIgcG93ZXJWYWx1ZVNpZ24gPSAxOwoKICAgICAgICAgIHdoaWxlICgoY2ggPSB0aGlzLm5leHRDaGFyKCkpID49IDApIHsKICAgICAgICAgICAgaWYgKGNoID49IDB4MzAgJiYgY2ggPD0gMHgzOSkgewogICAgICAgICAgICAgIHZhciBjdXJyZW50RGlnaXQgPSBjaCAtIDB4MzA7CgogICAgICAgICAgICAgIGlmIChlTm90YXRpb24pIHsKICAgICAgICAgICAgICAgIHBvd2VyVmFsdWUgPSBwb3dlclZhbHVlICogMTAgKyBjdXJyZW50RGlnaXQ7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChkaXZpZGVCeSAhPT0gMCkgewogICAgICAgICAgICAgICAgICBkaXZpZGVCeSAqPSAxMDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBiYXNlVmFsdWUgPSBiYXNlVmFsdWUgKiAxMCArIGN1cnJlbnREaWdpdDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoY2ggPT09IDB4MmUpIHsKICAgICAgICAgICAgICBpZiAoZGl2aWRlQnkgPT09IDApIHsKICAgICAgICAgICAgICAgIGRpdmlkZUJ5ID0gMTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKGNoID09PSAweDJkKSB7CiAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJCYWRseSBmb3JtYXR0ZWQgbnVtYmVyOiBtaW51cyBzaWduIGluIHRoZSBtaWRkbGUiKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChjaCA9PT0gMHg0NSB8fCBjaCA9PT0gMHg2NSkgewogICAgICAgICAgICAgIGNoID0gdGhpcy5wZWVrQ2hhcigpOwoKICAgICAgICAgICAgICBpZiAoY2ggPT09IDB4MmIgfHwgY2ggPT09IDB4MmQpIHsKICAgICAgICAgICAgICAgIHBvd2VyVmFsdWVTaWduID0gY2ggPT09IDB4MmQgPyAtMSA6IDE7CiAgICAgICAgICAgICAgICB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChjaCA8IDB4MzAgfHwgY2ggPiAweDM5KSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGVOb3RhdGlvbiA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZGl2aWRlQnkgIT09IDApIHsKICAgICAgICAgICAgYmFzZVZhbHVlIC89IGRpdmlkZUJ5OwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChlTm90YXRpb24pIHsKICAgICAgICAgICAgYmFzZVZhbHVlICo9IE1hdGgucG93KDEwLCBwb3dlclZhbHVlU2lnbiAqIHBvd2VyVmFsdWUpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBzaWduICogYmFzZVZhbHVlOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImdldFN0cmluZyIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldFN0cmluZygpIHsKICAgICAgICAgIHZhciBudW1QYXJlbiA9IDE7CiAgICAgICAgICB2YXIgZG9uZSA9IGZhbHNlOwogICAgICAgICAgdmFyIHN0ckJ1ZiA9IHRoaXMuc3RyQnVmOwogICAgICAgICAgc3RyQnVmLmxlbmd0aCA9IDA7CiAgICAgICAgICB2YXIgY2ggPSB0aGlzLm5leHRDaGFyKCk7CgogICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgdmFyIGNoYXJCdWZmZXJlZCA9IGZhbHNlOwoKICAgICAgICAgICAgc3dpdGNoIChjaCB8IDApIHsKICAgICAgICAgICAgICBjYXNlIC0xOgogICAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJVbnRlcm1pbmF0ZWQgc3RyaW5nIik7CiAgICAgICAgICAgICAgICBkb25lID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDB4Mjg6CiAgICAgICAgICAgICAgICArK251bVBhcmVuOwogICAgICAgICAgICAgICAgc3RyQnVmLnB1c2goIigiKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDB4Mjk6CiAgICAgICAgICAgICAgICBpZiAoLS1udW1QYXJlbiA9PT0gMCkgewogICAgICAgICAgICAgICAgICB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgICAgICAgICAgIGRvbmUgPSB0cnVlOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgc3RyQnVmLnB1c2goIikiKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAweDVjOgogICAgICAgICAgICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CgogICAgICAgICAgICAgICAgc3dpdGNoIChjaCkgewogICAgICAgICAgICAgICAgICBjYXNlIC0xOgogICAgICAgICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiVW50ZXJtaW5hdGVkIHN0cmluZyIpOwogICAgICAgICAgICAgICAgICAgIGRvbmUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgY2FzZSAweDZlOgogICAgICAgICAgICAgICAgICAgIHN0ckJ1Zi5wdXNoKCJcbiIpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgY2FzZSAweDcyOgogICAgICAgICAgICAgICAgICAgIHN0ckJ1Zi5wdXNoKCJcciIpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgY2FzZSAweDc0OgogICAgICAgICAgICAgICAgICAgIHN0ckJ1Zi5wdXNoKCJcdCIpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgY2FzZSAweDYyOgogICAgICAgICAgICAgICAgICAgIHN0ckJ1Zi5wdXNoKCJcYiIpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgY2FzZSAweDY2OgogICAgICAgICAgICAgICAgICAgIHN0ckJ1Zi5wdXNoKCJcZiIpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgY2FzZSAweDVjOgogICAgICAgICAgICAgICAgICBjYXNlIDB4Mjg6CiAgICAgICAgICAgICAgICAgIGNhc2UgMHgyOToKICAgICAgICAgICAgICAgICAgICBzdHJCdWYucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKGNoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlIDB4MzA6CiAgICAgICAgICAgICAgICAgIGNhc2UgMHgzMToKICAgICAgICAgICAgICAgICAgY2FzZSAweDMyOgogICAgICAgICAgICAgICAgICBjYXNlIDB4MzM6CiAgICAgICAgICAgICAgICAgIGNhc2UgMHgzNDoKICAgICAgICAgICAgICAgICAgY2FzZSAweDM1OgogICAgICAgICAgICAgICAgICBjYXNlIDB4MzY6CiAgICAgICAgICAgICAgICAgIGNhc2UgMHgzNzoKICAgICAgICAgICAgICAgICAgICB2YXIgeCA9IGNoICYgMHgwZjsKICAgICAgICAgICAgICAgICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKICAgICAgICAgICAgICAgICAgICBjaGFyQnVmZmVyZWQgPSB0cnVlOwoKICAgICAgICAgICAgICAgICAgICBpZiAoY2ggPj0gMHgzMCAmJiBjaCA8PSAweDM3KSB7CiAgICAgICAgICAgICAgICAgICAgICB4ID0gKHggPDwgMykgKyAoY2ggJiAweDBmKTsKICAgICAgICAgICAgICAgICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwoKICAgICAgICAgICAgICAgICAgICAgIGlmIChjaCA+PSAweDMwICYmIGNoIDw9IDB4MzcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2hhckJ1ZmZlcmVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIHggPSAoeCA8PCAzKSArIChjaCAmIDB4MGYpOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgc3RyQnVmLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZSh4KSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlIDB4MGQ6CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucGVla0NoYXIoKSA9PT0gMHgwYSkgewogICAgICAgICAgICAgICAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlIDB4MGE6CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHN0ckJ1Zi5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHN0ckJ1Zi5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZG9uZSkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIWNoYXJCdWZmZXJlZCkgewogICAgICAgICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHN0ckJ1Zi5qb2luKCIiKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJnZXROYW1lIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0TmFtZSgpIHsKICAgICAgICAgIHZhciBjaCwgcHJldmlvdXNDaDsKICAgICAgICAgIHZhciBzdHJCdWYgPSB0aGlzLnN0ckJ1ZjsKICAgICAgICAgIHN0ckJ1Zi5sZW5ndGggPSAwOwoKICAgICAgICAgIHdoaWxlICgoY2ggPSB0aGlzLm5leHRDaGFyKCkpID49IDAgJiYgIXNwZWNpYWxDaGFyc1tjaF0pIHsKICAgICAgICAgICAgaWYgKGNoID09PSAweDIzKSB7CiAgICAgICAgICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CgogICAgICAgICAgICAgIGlmIChzcGVjaWFsQ2hhcnNbY2hdKSB7CiAgICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIkxleGVyX2dldE5hbWU6ICIgKyAiTlVNQkVSIFNJR04gKCMpIHNob3VsZCBiZSBmb2xsb3dlZCBieSBhIGhleGFkZWNpbWFsIG51bWJlci4iKTsKICAgICAgICAgICAgICAgIHN0ckJ1Zi5wdXNoKCIjIik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciB4ID0gdG9IZXhEaWdpdChjaCk7CgogICAgICAgICAgICAgIGlmICh4ICE9PSAtMSkgewogICAgICAgICAgICAgICAgcHJldmlvdXNDaCA9IGNoOwogICAgICAgICAgICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgICAgICAgICB2YXIgeDIgPSB0b0hleERpZ2l0KGNoKTsKCiAgICAgICAgICAgICAgICBpZiAoeDIgPT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiTGV4ZXJfZ2V0TmFtZTogSWxsZWdhbCBkaWdpdCAoIi5jb25jYXQoU3RyaW5nLmZyb21DaGFyQ29kZShjaCksICIpICIpICsgImluIGhleGFkZWNpbWFsIG51bWJlci4iKTsKICAgICAgICAgICAgICAgICAgc3RyQnVmLnB1c2goIiMiLCBTdHJpbmcuZnJvbUNoYXJDb2RlKHByZXZpb3VzQ2gpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChzcGVjaWFsQ2hhcnNbY2hdKSB7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIHN0ckJ1Zi5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpKTsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgc3RyQnVmLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZSh4IDw8IDQgfCB4MikpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzdHJCdWYucHVzaCgiIyIsIFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgc3RyQnVmLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZShjaCkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHN0ckJ1Zi5sZW5ndGggPiAxMjcpIHsKICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJOYW1lIHRva2VuIGlzIGxvbmdlciB0aGFuIGFsbG93ZWQgYnkgdGhlIHNwZWM6ICIuY29uY2F0KHN0ckJ1Zi5sZW5ndGgpKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gX3ByaW1pdGl2ZXMuTmFtZS5nZXQoc3RyQnVmLmpvaW4oIiIpKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJfaGV4U3RyaW5nV2FybiIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9oZXhTdHJpbmdXYXJuKGNoKSB7CiAgICAgICAgICB2YXIgTUFYX0hFWF9TVFJJTkdfTlVNX1dBUk4gPSA1OwoKICAgICAgICAgIGlmICh0aGlzLl9oZXhTdHJpbmdOdW1XYXJuKysgPT09IE1BWF9IRVhfU1RSSU5HX05VTV9XQVJOKSB7CiAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiZ2V0SGV4U3RyaW5nIC0gaWdub3JpbmcgYWRkaXRpb25hbCBpbnZhbGlkIGNoYXJhY3RlcnMuIik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodGhpcy5faGV4U3RyaW5nTnVtV2FybiA+IE1BWF9IRVhfU1RSSU5HX05VTV9XQVJOKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICAoMCwgX3V0aWwud2FybikoImdldEhleFN0cmluZyAtIGlnbm9yaW5nIGludmFsaWQgY2hhcmFjdGVyOiAiLmNvbmNhdChjaCkpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImdldEhleFN0cmluZyIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldEhleFN0cmluZygpIHsKICAgICAgICAgIHZhciBzdHJCdWYgPSB0aGlzLnN0ckJ1ZjsKICAgICAgICAgIHN0ckJ1Zi5sZW5ndGggPSAwOwogICAgICAgICAgdmFyIGNoID0gdGhpcy5jdXJyZW50Q2hhcjsKICAgICAgICAgIHZhciBpc0ZpcnN0SGV4ID0gdHJ1ZTsKICAgICAgICAgIHZhciBmaXJzdERpZ2l0LCBzZWNvbmREaWdpdDsKICAgICAgICAgIHRoaXMuX2hleFN0cmluZ051bVdhcm4gPSAwOwoKICAgICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgIGlmIChjaCA8IDApIHsKICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIlVudGVybWluYXRlZCBoZXggc3RyaW5nIik7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoY2ggPT09IDB4M2UpIHsKICAgICAgICAgICAgICB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3BlY2lhbENoYXJzW2NoXSA9PT0gMSkgewogICAgICAgICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGlmIChpc0ZpcnN0SGV4KSB7CiAgICAgICAgICAgICAgICBmaXJzdERpZ2l0ID0gdG9IZXhEaWdpdChjaCk7CgogICAgICAgICAgICAgICAgaWYgKGZpcnN0RGlnaXQgPT09IC0xKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuX2hleFN0cmluZ1dhcm4oY2gpOwoKICAgICAgICAgICAgICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzZWNvbmREaWdpdCA9IHRvSGV4RGlnaXQoY2gpOwoKICAgICAgICAgICAgICAgIGlmIChzZWNvbmREaWdpdCA9PT0gLTEpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5faGV4U3RyaW5nV2FybihjaCk7CgogICAgICAgICAgICAgICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgc3RyQnVmLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZShmaXJzdERpZ2l0IDw8IDQgfCBzZWNvbmREaWdpdCkpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaXNGaXJzdEhleCA9ICFpc0ZpcnN0SGV4OwogICAgICAgICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHN0ckJ1Zi5qb2luKCIiKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJnZXRPYmoiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRPYmooKSB7CiAgICAgICAgICB2YXIgY29tbWVudCA9IGZhbHNlOwogICAgICAgICAgdmFyIGNoID0gdGhpcy5jdXJyZW50Q2hhcjsKCiAgICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgICBpZiAoY2ggPCAwKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF9wcmltaXRpdmVzLkVPRjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGNvbW1lbnQpIHsKICAgICAgICAgICAgICBpZiAoY2ggPT09IDB4MGEgfHwgY2ggPT09IDB4MGQpIHsKICAgICAgICAgICAgICAgIGNvbW1lbnQgPSBmYWxzZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoY2ggPT09IDB4MjUpIHsKICAgICAgICAgICAgICBjb21tZW50ID0gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIGlmIChzcGVjaWFsQ2hhcnNbY2hdICE9PSAxKSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgfQoKICAgICAgICAgIHN3aXRjaCAoY2ggfCAwKSB7CiAgICAgICAgICAgIGNhc2UgMHgzMDoKICAgICAgICAgICAgY2FzZSAweDMxOgogICAgICAgICAgICBjYXNlIDB4MzI6CiAgICAgICAgICAgIGNhc2UgMHgzMzoKICAgICAgICAgICAgY2FzZSAweDM0OgogICAgICAgICAgICBjYXNlIDB4MzU6CiAgICAgICAgICAgIGNhc2UgMHgzNjoKICAgICAgICAgICAgY2FzZSAweDM3OgogICAgICAgICAgICBjYXNlIDB4Mzg6CiAgICAgICAgICAgIGNhc2UgMHgzOToKICAgICAgICAgICAgY2FzZSAweDJiOgogICAgICAgICAgICBjYXNlIDB4MmQ6CiAgICAgICAgICAgIGNhc2UgMHgyZToKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXROdW1iZXIoKTsKCiAgICAgICAgICAgIGNhc2UgMHgyODoKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRTdHJpbmcoKTsKCiAgICAgICAgICAgIGNhc2UgMHgyZjoKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXROYW1lKCk7CgogICAgICAgICAgICBjYXNlIDB4NWI6CiAgICAgICAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgICAgIHJldHVybiBfcHJpbWl0aXZlcy5DbWQuZ2V0KCJbIik7CgogICAgICAgICAgICBjYXNlIDB4NWQ6CiAgICAgICAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgICAgIHJldHVybiBfcHJpbWl0aXZlcy5DbWQuZ2V0KCJdIik7CgogICAgICAgICAgICBjYXNlIDB4M2M6CiAgICAgICAgICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CgogICAgICAgICAgICAgIGlmIChjaCA9PT0gMHgzYykgewogICAgICAgICAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9wcmltaXRpdmVzLkNtZC5nZXQoIjw8Iik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRIZXhTdHJpbmcoKTsKCiAgICAgICAgICAgIGNhc2UgMHgzZToKICAgICAgICAgICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKCiAgICAgICAgICAgICAgaWYgKGNoID09PSAweDNlKSB7CiAgICAgICAgICAgICAgICB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gX3ByaW1pdGl2ZXMuQ21kLmdldCgiPj4iKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBfcHJpbWl0aXZlcy5DbWQuZ2V0KCI+Iik7CgogICAgICAgICAgICBjYXNlIDB4N2I6CiAgICAgICAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgICAgIHJldHVybiBfcHJpbWl0aXZlcy5DbWQuZ2V0KCJ7Iik7CgogICAgICAgICAgICBjYXNlIDB4N2Q6CiAgICAgICAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgICAgIHJldHVybiBfcHJpbWl0aXZlcy5DbWQuZ2V0KCJ9Iik7CgogICAgICAgICAgICBjYXNlIDB4Mjk6CiAgICAgICAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiSWxsZWdhbCBjaGFyYWN0ZXI6ICIuY29uY2F0KGNoKSk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHN0ciA9IFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpOwogICAgICAgICAgdmFyIGtub3duQ29tbWFuZHMgPSB0aGlzLmtub3duQ29tbWFuZHM7CiAgICAgICAgICB2YXIga25vd25Db21tYW5kRm91bmQgPSBrbm93bkNvbW1hbmRzICYmIGtub3duQ29tbWFuZHNbc3RyXSAhPT0gdW5kZWZpbmVkOwoKICAgICAgICAgIHdoaWxlICgoY2ggPSB0aGlzLm5leHRDaGFyKCkpID49IDAgJiYgIXNwZWNpYWxDaGFyc1tjaF0pIHsKICAgICAgICAgICAgdmFyIHBvc3NpYmxlQ29tbWFuZCA9IHN0ciArIFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpOwoKICAgICAgICAgICAgaWYgKGtub3duQ29tbWFuZEZvdW5kICYmIGtub3duQ29tbWFuZHNbcG9zc2libGVDb21tYW5kXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChzdHIubGVuZ3RoID09PSAxMjgpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkNvbW1hbmQgdG9rZW4gdG9vIGxvbmc6ICIuY29uY2F0KHN0ci5sZW5ndGgpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc3RyID0gcG9zc2libGVDb21tYW5kOwogICAgICAgICAgICBrbm93bkNvbW1hbmRGb3VuZCA9IGtub3duQ29tbWFuZHMgJiYga25vd25Db21tYW5kc1tzdHJdICE9PSB1bmRlZmluZWQ7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHN0ciA9PT0gInRydWUiKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChzdHIgPT09ICJmYWxzZSIpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChzdHIgPT09ICJudWxsIikgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoc3RyID09PSAiQkkiKSB7CiAgICAgICAgICAgIHRoaXMuYmVnaW5JbmxpbmVJbWFnZVBvcyA9IHRoaXMuc3RyZWFtLnBvczsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gX3ByaW1pdGl2ZXMuQ21kLmdldChzdHIpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInNraXBUb05leHRMaW5lIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gc2tpcFRvTmV4dExpbmUoKSB7CiAgICAgICAgICB2YXIgY2ggPSB0aGlzLmN1cnJlbnRDaGFyOwoKICAgICAgICAgIHdoaWxlIChjaCA+PSAwKSB7CiAgICAgICAgICAgIGlmIChjaCA9PT0gMHgwZCkgewogICAgICAgICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwoKICAgICAgICAgICAgICBpZiAoY2ggPT09IDB4MGEpIHsKICAgICAgICAgICAgICAgIHRoaXMubmV4dENoYXIoKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9IGVsc2UgaWYgKGNoID09PSAweDBhKSB7CiAgICAgICAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBMZXhlcjsKICAgIH0oKTsKCiAgICBleHBvcnRzLkxleGVyID0gTGV4ZXI7CgogICAgdmFyIExpbmVhcml6YXRpb24gPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBMaW5lYXJpemF0aW9uKCkgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBMaW5lYXJpemF0aW9uKTsKICAgICAgfQoKICAgICAgX2NyZWF0ZUNsYXNzKExpbmVhcml6YXRpb24sIG51bGwsIFt7CiAgICAgICAga2V5OiAiY3JlYXRlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlKHN0cmVhbSkgewogICAgICAgICAgZnVuY3Rpb24gZ2V0SW50KGxpbkRpY3QsIG5hbWUpIHsKICAgICAgICAgICAgdmFyIGFsbG93WmVyb1ZhbHVlID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiBmYWxzZTsKICAgICAgICAgICAgdmFyIG9iaiA9IGxpbkRpY3QuZ2V0KG5hbWUpOwoKICAgICAgICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIob2JqKSAmJiAoYWxsb3daZXJvVmFsdWUgPyBvYmogPj0gMCA6IG9iaiA+IDApKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG9iajsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUaGUgXCIiLmNvbmNhdChuYW1lLCAiXCIgcGFyYW1ldGVyIGluIHRoZSBsaW5lYXJpemF0aW9uICIpICsgImRpY3Rpb25hcnkgaXMgaW52YWxpZC4iKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBnZXRIaW50cyhsaW5EaWN0KSB7CiAgICAgICAgICAgIHZhciBoaW50cyA9IGxpbkRpY3QuZ2V0KCJIIik7CiAgICAgICAgICAgIHZhciBoaW50c0xlbmd0aDsKCiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGhpbnRzKSAmJiAoKGhpbnRzTGVuZ3RoID0gaGludHMubGVuZ3RoKSA9PT0gMiB8fCBoaW50c0xlbmd0aCA9PT0gNCkpIHsKICAgICAgICAgICAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgaGludHNMZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgICAgICAgIHZhciBoaW50ID0gaGludHNbaW5kZXhdOwoKICAgICAgICAgICAgICAgIGlmICghKE51bWJlci5pc0ludGVnZXIoaGludCkgJiYgaGludCA+IDApKSB7CiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiSGludCAoIi5jb25jYXQoaW5kZXgsICIpIGluIHRoZSBsaW5lYXJpemF0aW9uIGRpY3Rpb25hcnkgaXMgaW52YWxpZC4iKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gaGludHM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiSGludCBhcnJheSBpbiB0aGUgbGluZWFyaXphdGlvbiBkaWN0aW9uYXJ5IGlzIGludmFsaWQuIik7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHBhcnNlciA9IG5ldyBQYXJzZXIoewogICAgICAgICAgICBsZXhlcjogbmV3IExleGVyKHN0cmVhbSksCiAgICAgICAgICAgIHhyZWY6IG51bGwKICAgICAgICAgIH0pOwogICAgICAgICAgdmFyIG9iajEgPSBwYXJzZXIuZ2V0T2JqKCk7CiAgICAgICAgICB2YXIgb2JqMiA9IHBhcnNlci5nZXRPYmooKTsKICAgICAgICAgIHZhciBvYmozID0gcGFyc2VyLmdldE9iaigpOwogICAgICAgICAgdmFyIGxpbkRpY3QgPSBwYXJzZXIuZ2V0T2JqKCk7CiAgICAgICAgICB2YXIgb2JqLCBsZW5ndGg7CgogICAgICAgICAgaWYgKCEoTnVtYmVyLmlzSW50ZWdlcihvYmoxKSAmJiBOdW1iZXIuaXNJbnRlZ2VyKG9iajIpICYmICgwLCBfcHJpbWl0aXZlcy5pc0NtZCkob2JqMywgIm9iaiIpICYmICgwLCBfcHJpbWl0aXZlcy5pc0RpY3QpKGxpbkRpY3QpICYmICgwLCBfdXRpbC5pc051bSkob2JqID0gbGluRGljdC5nZXQoIkxpbmVhcml6ZWQiKSkgJiYgb2JqID4gMCkpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9IGVsc2UgaWYgKChsZW5ndGggPSBnZXRJbnQobGluRGljdCwgIkwiKSkgIT09IHN0cmVhbS5sZW5ndGgpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgIkwiIHBhcmFtZXRlciBpbiB0aGUgbGluZWFyaXphdGlvbiBkaWN0aW9uYXJ5ICcgKyAiZG9lcyBub3QgZXF1YWwgdGhlIHN0cmVhbSBsZW5ndGguIik7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgbGVuZ3RoOiBsZW5ndGgsCiAgICAgICAgICAgIGhpbnRzOiBnZXRIaW50cyhsaW5EaWN0KSwKICAgICAgICAgICAgb2JqZWN0TnVtYmVyRmlyc3Q6IGdldEludChsaW5EaWN0LCAiTyIpLAogICAgICAgICAgICBlbmRGaXJzdDogZ2V0SW50KGxpbkRpY3QsICJFIiksCiAgICAgICAgICAgIG51bVBhZ2VzOiBnZXRJbnQobGluRGljdCwgIk4iKSwKICAgICAgICAgICAgbWFpblhSZWZFbnRyaWVzT2Zmc2V0OiBnZXRJbnQobGluRGljdCwgIlQiKSwKICAgICAgICAgICAgcGFnZUZpcnN0OiBsaW5EaWN0LmhhcygiUCIpID8gZ2V0SW50KGxpbkRpY3QsICJQIiwgdHJ1ZSkgOiAwCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIExpbmVhcml6YXRpb247CiAgICB9KCk7CgogICAgZXhwb3J0cy5MaW5lYXJpemF0aW9uID0gTGluZWFyaXphdGlvbjsKCiAgICAvKioqL30pLCAoCiAgLyogMjAxICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgIHZhbHVlOiB0cnVlCiAgICB9KTsKICAgIGV4cG9ydHMuTFpXU3RyZWFtID0gZXhwb3J0cy5TdHJpbmdTdHJlYW0gPSBleHBvcnRzLlN0cmVhbXNTZXF1ZW5jZVN0cmVhbSA9IGV4cG9ydHMuU3RyZWFtID0gZXhwb3J0cy5SdW5MZW5ndGhTdHJlYW0gPSBleHBvcnRzLlByZWRpY3RvclN0cmVhbSA9IGV4cG9ydHMuTnVsbFN0cmVhbSA9IGV4cG9ydHMuRmxhdGVTdHJlYW0gPSBleHBvcnRzLkRlY29kZVN0cmVhbSA9IGV4cG9ydHMuRGVjcnlwdFN0cmVhbSA9IGV4cG9ydHMuQXNjaWlIZXhTdHJlYW0gPSBleHBvcnRzLkFzY2lpODVTdHJlYW0gPSB2b2lkIDA7CgogICAgdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXyg1KTsKCiAgICB2YXIgX3ByaW1pdGl2ZXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE5NCk7CgogICAgdmFyIF9jb3JlX3V0aWxzID0gX193X3BkZmpzX3JlcXVpcmVfXygxOTcpOwoKICAgIGZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheShhcnIpIHtyZXR1cm4gX2FycmF5V2l0aG91dEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheShhcnIpIHx8IF9ub25JdGVyYWJsZVNwcmVhZCgpO30KCiAgICBmdW5jdGlvbiBfbm9uSXRlcmFibGVTcHJlYWQoKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIHNwcmVhZCBub24taXRlcmFibGUgaW5zdGFuY2UiKTt9CgogICAgZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7aWYgKFN5bWJvbC5pdGVyYXRvciBpbiBPYmplY3QoaXRlcikgfHwgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGl0ZXIpID09PSAiW29iamVjdCBBcmd1bWVudHNdIikgcmV0dXJuIEFycmF5LmZyb20oaXRlcik7fQoKICAgIGZ1bmN0aW9uIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHtpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7Zm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkoYXJyLmxlbmd0aCk7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHthcnIyW2ldID0gYXJyW2ldO31yZXR1cm4gYXJyMjt9fQoKICAgIHZhciBTdHJlYW0gPSBmdW5jdGlvbiBTdHJlYW1DbG9zdXJlKCkgewogICAgICBmdW5jdGlvbiBTdHJlYW0oYXJyYXlCdWZmZXIsIHN0YXJ0LCBsZW5ndGgsIGRpY3QpIHsKICAgICAgICB0aGlzLmJ5dGVzID0gYXJyYXlCdWZmZXIgaW5zdGFuY2VvZiBVaW50OEFycmF5ID8gYXJyYXlCdWZmZXIgOiBuZXcgVWludDhBcnJheShhcnJheUJ1ZmZlcik7CiAgICAgICAgdGhpcy5zdGFydCA9IHN0YXJ0IHx8IDA7CiAgICAgICAgdGhpcy5wb3MgPSB0aGlzLnN0YXJ0OwogICAgICAgIHRoaXMuZW5kID0gc3RhcnQgKyBsZW5ndGggfHwgdGhpcy5ieXRlcy5sZW5ndGg7CiAgICAgICAgdGhpcy5kaWN0ID0gZGljdDsKICAgICAgfQoKICAgICAgU3RyZWFtLnByb3RvdHlwZSA9IHsKICAgICAgICBnZXQgbGVuZ3RoKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuZW5kIC0gdGhpcy5zdGFydDsKICAgICAgICB9LAoKICAgICAgICBnZXQgaXNFbXB0eSgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLmxlbmd0aCA9PT0gMDsKICAgICAgICB9LAoKICAgICAgICBnZXRCeXRlOiBmdW5jdGlvbiBTdHJlYW1fZ2V0Qnl0ZSgpIHsKICAgICAgICAgIGlmICh0aGlzLnBvcyA+PSB0aGlzLmVuZCkgewogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHRoaXMuYnl0ZXNbdGhpcy5wb3MrK107CiAgICAgICAgfSwKICAgICAgICBnZXRVaW50MTY6IGZ1bmN0aW9uIFN0cmVhbV9nZXRVaW50MTYoKSB7CiAgICAgICAgICB2YXIgYjAgPSB0aGlzLmdldEJ5dGUoKTsKICAgICAgICAgIHZhciBiMSA9IHRoaXMuZ2V0Qnl0ZSgpOwoKICAgICAgICAgIGlmIChiMCA9PT0gLTEgfHwgYjEgPT09IC0xKSB7CiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gKGIwIDw8IDgpICsgYjE7CiAgICAgICAgfSwKICAgICAgICBnZXRJbnQzMjogZnVuY3Rpb24gU3RyZWFtX2dldEludDMyKCkgewogICAgICAgICAgdmFyIGIwID0gdGhpcy5nZXRCeXRlKCk7CiAgICAgICAgICB2YXIgYjEgPSB0aGlzLmdldEJ5dGUoKTsKICAgICAgICAgIHZhciBiMiA9IHRoaXMuZ2V0Qnl0ZSgpOwogICAgICAgICAgdmFyIGIzID0gdGhpcy5nZXRCeXRlKCk7CiAgICAgICAgICByZXR1cm4gKGIwIDw8IDI0KSArIChiMSA8PCAxNikgKyAoYjIgPDwgOCkgKyBiMzsKICAgICAgICB9LAogICAgICAgIGdldEJ5dGVzOiBmdW5jdGlvbiBnZXRCeXRlcyhsZW5ndGgpIHsKICAgICAgICAgIHZhciBmb3JjZUNsYW1wZWQgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwogICAgICAgICAgdmFyIGJ5dGVzID0gdGhpcy5ieXRlczsKICAgICAgICAgIHZhciBwb3MgPSB0aGlzLnBvczsKICAgICAgICAgIHZhciBzdHJFbmQgPSB0aGlzLmVuZDsKCiAgICAgICAgICBpZiAoIWxlbmd0aCkgewogICAgICAgICAgICB2YXIgX3N1YmFycmF5ID0gYnl0ZXMuc3ViYXJyYXkocG9zLCBzdHJFbmQpOwoKICAgICAgICAgICAgcmV0dXJuIGZvcmNlQ2xhbXBlZCA/IG5ldyBVaW50OENsYW1wZWRBcnJheShfc3ViYXJyYXkpIDogX3N1YmFycmF5OwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBlbmQgPSBwb3MgKyBsZW5ndGg7CgogICAgICAgICAgaWYgKGVuZCA+IHN0ckVuZCkgewogICAgICAgICAgICBlbmQgPSBzdHJFbmQ7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5wb3MgPSBlbmQ7CiAgICAgICAgICB2YXIgc3ViYXJyYXkgPSBieXRlcy5zdWJhcnJheShwb3MsIGVuZCk7CiAgICAgICAgICByZXR1cm4gZm9yY2VDbGFtcGVkID8gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHN1YmFycmF5KSA6IHN1YmFycmF5OwogICAgICAgIH0sCiAgICAgICAgcGVla0J5dGU6IGZ1bmN0aW9uIFN0cmVhbV9wZWVrQnl0ZSgpIHsKICAgICAgICAgIHZhciBwZWVrZWRCeXRlID0gdGhpcy5nZXRCeXRlKCk7CgogICAgICAgICAgaWYgKHBlZWtlZEJ5dGUgIT09IC0xKSB7CiAgICAgICAgICAgIHRoaXMucG9zLS07CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHBlZWtlZEJ5dGU7CiAgICAgICAgfSwKICAgICAgICBwZWVrQnl0ZXM6IGZ1bmN0aW9uIHBlZWtCeXRlcyhsZW5ndGgpIHsKICAgICAgICAgIHZhciBmb3JjZUNsYW1wZWQgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwogICAgICAgICAgdmFyIGJ5dGVzID0gdGhpcy5nZXRCeXRlcyhsZW5ndGgsIGZvcmNlQ2xhbXBlZCk7CiAgICAgICAgICB0aGlzLnBvcyAtPSBieXRlcy5sZW5ndGg7CiAgICAgICAgICByZXR1cm4gYnl0ZXM7CiAgICAgICAgfSwKICAgICAgICBnZXRCeXRlUmFuZ2U6IGZ1bmN0aW9uIGdldEJ5dGVSYW5nZShiZWdpbiwgZW5kKSB7CiAgICAgICAgICBpZiAoYmVnaW4gPCAwKSB7CiAgICAgICAgICAgIGJlZ2luID0gMDsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZW5kID4gdGhpcy5lbmQpIHsKICAgICAgICAgICAgZW5kID0gdGhpcy5lbmQ7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHRoaXMuYnl0ZXMuc3ViYXJyYXkoYmVnaW4sIGVuZCk7CiAgICAgICAgfSwKICAgICAgICBza2lwOiBmdW5jdGlvbiBTdHJlYW1fc2tpcChuKSB7CiAgICAgICAgICBpZiAoIW4pIHsKICAgICAgICAgICAgbiA9IDE7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5wb3MgKz0gbjsKICAgICAgICB9LAogICAgICAgIHJlc2V0OiBmdW5jdGlvbiBTdHJlYW1fcmVzZXQoKSB7CiAgICAgICAgICB0aGlzLnBvcyA9IHRoaXMuc3RhcnQ7CiAgICAgICAgfSwKICAgICAgICBtb3ZlU3RhcnQ6IGZ1bmN0aW9uIFN0cmVhbV9tb3ZlU3RhcnQoKSB7CiAgICAgICAgICB0aGlzLnN0YXJ0ID0gdGhpcy5wb3M7CiAgICAgICAgfSwKICAgICAgICBtYWtlU3ViU3RyZWFtOiBmdW5jdGlvbiBTdHJlYW1fbWFrZVN1YlN0cmVhbShzdGFydCwgbGVuZ3RoLCBkaWN0KSB7CiAgICAgICAgICByZXR1cm4gbmV3IFN0cmVhbSh0aGlzLmJ5dGVzLmJ1ZmZlciwgc3RhcnQsIGxlbmd0aCwgZGljdCk7CiAgICAgICAgfQogICAgICB9OwogICAgICByZXR1cm4gU3RyZWFtOwogICAgfSgpOwoKICAgIGV4cG9ydHMuU3RyZWFtID0gU3RyZWFtOwoKICAgIHZhciBTdHJpbmdTdHJlYW0gPSBmdW5jdGlvbiBTdHJpbmdTdHJlYW1DbG9zdXJlKCkgewogICAgICBmdW5jdGlvbiBTdHJpbmdTdHJlYW0oc3RyKSB7CiAgICAgICAgdmFyIGJ5dGVzID0gKDAsIF91dGlsLnN0cmluZ1RvQnl0ZXMpKHN0cik7CiAgICAgICAgU3RyZWFtLmNhbGwodGhpcywgYnl0ZXMpOwogICAgICB9CgogICAgICBTdHJpbmdTdHJlYW0ucHJvdG90eXBlID0gU3RyZWFtLnByb3RvdHlwZTsKICAgICAgcmV0dXJuIFN0cmluZ1N0cmVhbTsKICAgIH0oKTsKCiAgICBleHBvcnRzLlN0cmluZ1N0cmVhbSA9IFN0cmluZ1N0cmVhbTsKCiAgICB2YXIgRGVjb2RlU3RyZWFtID0gZnVuY3Rpb24gRGVjb2RlU3RyZWFtQ2xvc3VyZSgpIHsKICAgICAgdmFyIGVtcHR5QnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkoMCk7CgogICAgICBmdW5jdGlvbiBEZWNvZGVTdHJlYW0obWF5YmVNaW5CdWZmZXJMZW5ndGgpIHsKICAgICAgICB0aGlzLl9yYXdNaW5CdWZmZXJMZW5ndGggPSBtYXliZU1pbkJ1ZmZlckxlbmd0aCB8fCAwOwogICAgICAgIHRoaXMucG9zID0gMDsKICAgICAgICB0aGlzLmJ1ZmZlckxlbmd0aCA9IDA7CiAgICAgICAgdGhpcy5lb2YgPSBmYWxzZTsKICAgICAgICB0aGlzLmJ1ZmZlciA9IGVtcHR5QnVmZmVyOwogICAgICAgIHRoaXMubWluQnVmZmVyTGVuZ3RoID0gNTEyOwoKICAgICAgICBpZiAobWF5YmVNaW5CdWZmZXJMZW5ndGgpIHsKICAgICAgICAgIHdoaWxlICh0aGlzLm1pbkJ1ZmZlckxlbmd0aCA8IG1heWJlTWluQnVmZmVyTGVuZ3RoKSB7CiAgICAgICAgICAgIHRoaXMubWluQnVmZmVyTGVuZ3RoICo9IDI7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBEZWNvZGVTdHJlYW0ucHJvdG90eXBlID0gewogICAgICAgIGdldCBpc0VtcHR5KCkgewogICAgICAgICAgd2hpbGUgKCF0aGlzLmVvZiAmJiB0aGlzLmJ1ZmZlckxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICB0aGlzLnJlYWRCbG9jaygpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB0aGlzLmJ1ZmZlckxlbmd0aCA9PT0gMDsKICAgICAgICB9LAoKICAgICAgICBlbnN1cmVCdWZmZXI6IGZ1bmN0aW9uIERlY29kZVN0cmVhbV9lbnN1cmVCdWZmZXIocmVxdWVzdGVkKSB7CiAgICAgICAgICB2YXIgYnVmZmVyID0gdGhpcy5idWZmZXI7CgogICAgICAgICAgaWYgKHJlcXVlc3RlZCA8PSBidWZmZXIuYnl0ZUxlbmd0aCkgewogICAgICAgICAgICByZXR1cm4gYnVmZmVyOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBzaXplID0gdGhpcy5taW5CdWZmZXJMZW5ndGg7CgogICAgICAgICAgd2hpbGUgKHNpemUgPCByZXF1ZXN0ZWQpIHsKICAgICAgICAgICAgc2l6ZSAqPSAyOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBidWZmZXIyID0gbmV3IFVpbnQ4QXJyYXkoc2l6ZSk7CiAgICAgICAgICBidWZmZXIyLnNldChidWZmZXIpOwogICAgICAgICAgcmV0dXJuIHRoaXMuYnVmZmVyID0gYnVmZmVyMjsKICAgICAgICB9LAogICAgICAgIGdldEJ5dGU6IGZ1bmN0aW9uIERlY29kZVN0cmVhbV9nZXRCeXRlKCkgewogICAgICAgICAgdmFyIHBvcyA9IHRoaXMucG9zOwoKICAgICAgICAgIHdoaWxlICh0aGlzLmJ1ZmZlckxlbmd0aCA8PSBwb3MpIHsKICAgICAgICAgICAgaWYgKHRoaXMuZW9mKSB7CiAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLnJlYWRCbG9jaygpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB0aGlzLmJ1ZmZlclt0aGlzLnBvcysrXTsKICAgICAgICB9LAogICAgICAgIGdldFVpbnQxNjogZnVuY3Rpb24gRGVjb2RlU3RyZWFtX2dldFVpbnQxNigpIHsKICAgICAgICAgIHZhciBiMCA9IHRoaXMuZ2V0Qnl0ZSgpOwogICAgICAgICAgdmFyIGIxID0gdGhpcy5nZXRCeXRlKCk7CgogICAgICAgICAgaWYgKGIwID09PSAtMSB8fCBiMSA9PT0gLTEpIHsKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiAoYjAgPDwgOCkgKyBiMTsKICAgICAgICB9LAogICAgICAgIGdldEludDMyOiBmdW5jdGlvbiBEZWNvZGVTdHJlYW1fZ2V0SW50MzIoKSB7CiAgICAgICAgICB2YXIgYjAgPSB0aGlzLmdldEJ5dGUoKTsKICAgICAgICAgIHZhciBiMSA9IHRoaXMuZ2V0Qnl0ZSgpOwogICAgICAgICAgdmFyIGIyID0gdGhpcy5nZXRCeXRlKCk7CiAgICAgICAgICB2YXIgYjMgPSB0aGlzLmdldEJ5dGUoKTsKICAgICAgICAgIHJldHVybiAoYjAgPDwgMjQpICsgKGIxIDw8IDE2KSArIChiMiA8PCA4KSArIGIzOwogICAgICAgIH0sCiAgICAgICAgZ2V0Qnl0ZXM6IGZ1bmN0aW9uIGdldEJ5dGVzKGxlbmd0aCkgewogICAgICAgICAgdmFyIGZvcmNlQ2xhbXBlZCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CiAgICAgICAgICB2YXIgZW5kLAogICAgICAgICAgICBwb3MgPSB0aGlzLnBvczsKCiAgICAgICAgICBpZiAobGVuZ3RoKSB7CiAgICAgICAgICAgIHRoaXMuZW5zdXJlQnVmZmVyKHBvcyArIGxlbmd0aCk7CiAgICAgICAgICAgIGVuZCA9IHBvcyArIGxlbmd0aDsKCiAgICAgICAgICAgIHdoaWxlICghdGhpcy5lb2YgJiYgdGhpcy5idWZmZXJMZW5ndGggPCBlbmQpIHsKICAgICAgICAgICAgICB0aGlzLnJlYWRCbG9jaygpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgYnVmRW5kID0gdGhpcy5idWZmZXJMZW5ndGg7CgogICAgICAgICAgICBpZiAoZW5kID4gYnVmRW5kKSB7CiAgICAgICAgICAgICAgZW5kID0gYnVmRW5kOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB3aGlsZSAoIXRoaXMuZW9mKSB7CiAgICAgICAgICAgICAgdGhpcy5yZWFkQmxvY2soKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZW5kID0gdGhpcy5idWZmZXJMZW5ndGg7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5wb3MgPSBlbmQ7CiAgICAgICAgICB2YXIgc3ViYXJyYXkgPSB0aGlzLmJ1ZmZlci5zdWJhcnJheShwb3MsIGVuZCk7CiAgICAgICAgICByZXR1cm4gZm9yY2VDbGFtcGVkICYmICEoc3ViYXJyYXkgaW5zdGFuY2VvZiBVaW50OENsYW1wZWRBcnJheSkgPyBuZXcgVWludDhDbGFtcGVkQXJyYXkoc3ViYXJyYXkpIDogc3ViYXJyYXk7CiAgICAgICAgfSwKICAgICAgICBwZWVrQnl0ZTogZnVuY3Rpb24gRGVjb2RlU3RyZWFtX3BlZWtCeXRlKCkgewogICAgICAgICAgdmFyIHBlZWtlZEJ5dGUgPSB0aGlzLmdldEJ5dGUoKTsKCiAgICAgICAgICBpZiAocGVla2VkQnl0ZSAhPT0gLTEpIHsKICAgICAgICAgICAgdGhpcy5wb3MtLTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gcGVla2VkQnl0ZTsKICAgICAgICB9LAogICAgICAgIHBlZWtCeXRlczogZnVuY3Rpb24gcGVla0J5dGVzKGxlbmd0aCkgewogICAgICAgICAgdmFyIGZvcmNlQ2xhbXBlZCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CiAgICAgICAgICB2YXIgYnl0ZXMgPSB0aGlzLmdldEJ5dGVzKGxlbmd0aCwgZm9yY2VDbGFtcGVkKTsKICAgICAgICAgIHRoaXMucG9zIC09IGJ5dGVzLmxlbmd0aDsKICAgICAgICAgIHJldHVybiBieXRlczsKICAgICAgICB9LAogICAgICAgIG1ha2VTdWJTdHJlYW06IGZ1bmN0aW9uIERlY29kZVN0cmVhbV9tYWtlU3ViU3RyZWFtKHN0YXJ0LCBsZW5ndGgsIGRpY3QpIHsKICAgICAgICAgIHZhciBlbmQgPSBzdGFydCArIGxlbmd0aDsKCiAgICAgICAgICB3aGlsZSAodGhpcy5idWZmZXJMZW5ndGggPD0gZW5kICYmICF0aGlzLmVvZikgewogICAgICAgICAgICB0aGlzLnJlYWRCbG9jaygpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBuZXcgU3RyZWFtKHRoaXMuYnVmZmVyLCBzdGFydCwgbGVuZ3RoLCBkaWN0KTsKICAgICAgICB9LAogICAgICAgIGdldEJ5dGVSYW5nZTogZnVuY3Rpb24gZ2V0Qnl0ZVJhbmdlKGJlZ2luLCBlbmQpIHsKICAgICAgICAgICgwLCBfdXRpbC51bnJlYWNoYWJsZSkoIlNob3VsZCBub3QgY2FsbCBEZWNvZGVTdHJlYW0uZ2V0Qnl0ZVJhbmdlIik7CiAgICAgICAgfSwKICAgICAgICBza2lwOiBmdW5jdGlvbiBEZWNvZGVTdHJlYW1fc2tpcChuKSB7CiAgICAgICAgICBpZiAoIW4pIHsKICAgICAgICAgICAgbiA9IDE7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5wb3MgKz0gbjsKICAgICAgICB9LAogICAgICAgIHJlc2V0OiBmdW5jdGlvbiBEZWNvZGVTdHJlYW1fcmVzZXQoKSB7CiAgICAgICAgICB0aGlzLnBvcyA9IDA7CiAgICAgICAgfSwKICAgICAgICBnZXRCYXNlU3RyZWFtczogZnVuY3Rpb24gRGVjb2RlU3RyZWFtX2dldEJhc2VTdHJlYW1zKCkgewogICAgICAgICAgaWYgKHRoaXMuc3RyICYmIHRoaXMuc3RyLmdldEJhc2VTdHJlYW1zKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnN0ci5nZXRCYXNlU3RyZWFtcygpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBbXTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHJldHVybiBEZWNvZGVTdHJlYW07CiAgICB9KCk7CgogICAgZXhwb3J0cy5EZWNvZGVTdHJlYW0gPSBEZWNvZGVTdHJlYW07CgogICAgdmFyIFN0cmVhbXNTZXF1ZW5jZVN0cmVhbSA9IGZ1bmN0aW9uIFN0cmVhbXNTZXF1ZW5jZVN0cmVhbUNsb3N1cmUoKSB7CiAgICAgIGZ1bmN0aW9uIFN0cmVhbXNTZXF1ZW5jZVN0cmVhbShzdHJlYW1zKSB7CiAgICAgICAgdGhpcy5zdHJlYW1zID0gc3RyZWFtczsKICAgICAgICB2YXIgbWF5YmVMZW5ndGggPSAwOwoKICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBzdHJlYW1zLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgIHZhciBzdHJlYW0gPSBzdHJlYW1zW2ldOwoKICAgICAgICAgIGlmIChzdHJlYW0gaW5zdGFuY2VvZiBEZWNvZGVTdHJlYW0pIHsKICAgICAgICAgICAgbWF5YmVMZW5ndGggKz0gc3RyZWFtLl9yYXdNaW5CdWZmZXJMZW5ndGg7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBtYXliZUxlbmd0aCArPSBzdHJlYW0ubGVuZ3RoOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgRGVjb2RlU3RyZWFtLmNhbGwodGhpcywgbWF5YmVMZW5ndGgpOwogICAgICB9CgogICAgICBTdHJlYW1zU2VxdWVuY2VTdHJlYW0ucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShEZWNvZGVTdHJlYW0ucHJvdG90eXBlKTsKCiAgICAgIFN0cmVhbXNTZXF1ZW5jZVN0cmVhbS5wcm90b3R5cGUucmVhZEJsb2NrID0gZnVuY3Rpb24gc3RyZWFtU2VxdWVuY2VTdHJlYW1SZWFkQmxvY2soKSB7CiAgICAgICAgdmFyIHN0cmVhbXMgPSB0aGlzLnN0cmVhbXM7CgogICAgICAgIGlmIChzdHJlYW1zLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIHN0cmVhbSA9IHN0cmVhbXMuc2hpZnQoKTsKICAgICAgICB2YXIgY2h1bmsgPSBzdHJlYW0uZ2V0Qnl0ZXMoKTsKICAgICAgICB2YXIgYnVmZmVyTGVuZ3RoID0gdGhpcy5idWZmZXJMZW5ndGg7CiAgICAgICAgdmFyIG5ld0xlbmd0aCA9IGJ1ZmZlckxlbmd0aCArIGNodW5rLmxlbmd0aDsKICAgICAgICB2YXIgYnVmZmVyID0gdGhpcy5lbnN1cmVCdWZmZXIobmV3TGVuZ3RoKTsKICAgICAgICBidWZmZXIuc2V0KGNodW5rLCBidWZmZXJMZW5ndGgpOwogICAgICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gbmV3TGVuZ3RoOwogICAgICB9OwoKICAgICAgU3RyZWFtc1NlcXVlbmNlU3RyZWFtLnByb3RvdHlwZS5nZXRCYXNlU3RyZWFtcyA9IGZ1bmN0aW9uIFN0cmVhbXNTZXF1ZW5jZVN0cmVhbV9nZXRCYXNlU3RyZWFtcygpIHsKICAgICAgICB2YXIgYmFzZVN0cmVhbXMgPSBbXTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gdGhpcy5zdHJlYW1zLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgIHZhciBzdHJlYW0gPSB0aGlzLnN0cmVhbXNbaV07CgogICAgICAgICAgaWYgKHN0cmVhbS5nZXRCYXNlU3RyZWFtcykgewogICAgICAgICAgICBiYXNlU3RyZWFtcy5wdXNoLmFwcGx5KGJhc2VTdHJlYW1zLCBfdG9Db25zdW1hYmxlQXJyYXkoc3RyZWFtLmdldEJhc2VTdHJlYW1zKCkpKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBiYXNlU3RyZWFtczsKICAgICAgfTsKCiAgICAgIHJldHVybiBTdHJlYW1zU2VxdWVuY2VTdHJlYW07CiAgICB9KCk7CgogICAgZXhwb3J0cy5TdHJlYW1zU2VxdWVuY2VTdHJlYW0gPSBTdHJlYW1zU2VxdWVuY2VTdHJlYW07CgogICAgdmFyIEZsYXRlU3RyZWFtID0gZnVuY3Rpb24gRmxhdGVTdHJlYW1DbG9zdXJlKCkgewogICAgICB2YXIgY29kZUxlbkNvZGVNYXAgPSBuZXcgSW50MzJBcnJheShbMTYsIDE3LCAxOCwgMCwgOCwgNywgOSwgNiwgMTAsIDUsIDExLCA0LCAxMiwgMywgMTMsIDIsIDE0LCAxLCAxNV0pOwogICAgICB2YXIgbGVuZ3RoRGVjb2RlID0gbmV3IEludDMyQXJyYXkoWzB4MDAwMDMsIDB4MDAwMDQsIDB4MDAwMDUsIDB4MDAwMDYsIDB4MDAwMDcsIDB4MDAwMDgsIDB4MDAwMDksIDB4MDAwMGEsIDB4MTAwMGIsIDB4MTAwMGQsIDB4MTAwMGYsIDB4MTAwMTEsIDB4MjAwMTMsIDB4MjAwMTcsIDB4MjAwMWIsIDB4MjAwMWYsIDB4MzAwMjMsIDB4MzAwMmIsIDB4MzAwMzMsIDB4MzAwM2IsIDB4NDAwNDMsIDB4NDAwNTMsIDB4NDAwNjMsIDB4NDAwNzMsIDB4NTAwODMsIDB4NTAwYTMsIDB4NTAwYzMsIDB4NTAwZTMsIDB4MDAxMDIsIDB4MDAxMDIsIDB4MDAxMDJdKTsKICAgICAgdmFyIGRpc3REZWNvZGUgPSBuZXcgSW50MzJBcnJheShbMHgwMDAwMSwgMHgwMDAwMiwgMHgwMDAwMywgMHgwMDAwNCwgMHgxMDAwNSwgMHgxMDAwNywgMHgyMDAwOSwgMHgyMDAwZCwgMHgzMDAxMSwgMHgzMDAxOSwgMHg0MDAyMSwgMHg0MDAzMSwgMHg1MDA0MSwgMHg1MDA2MSwgMHg2MDA4MSwgMHg2MDBjMSwgMHg3MDEwMSwgMHg3MDE4MSwgMHg4MDIwMSwgMHg4MDMwMSwgMHg5MDQwMSwgMHg5MDYwMSwgMHhhMDgwMSwgMHhhMGMwMSwgMHhiMTAwMSwgMHhiMTgwMSwgMHhjMjAwMSwgMHhjMzAwMSwgMHhkNDAwMSwgMHhkNjAwMV0pOwogICAgICB2YXIgZml4ZWRMaXRDb2RlVGFiID0gW25ldyBJbnQzMkFycmF5KFsweDcwMTAwLCAweDgwMDUwLCAweDgwMDEwLCAweDgwMTE4LCAweDcwMTEwLCAweDgwMDcwLCAweDgwMDMwLCAweDkwMGMwLCAweDcwMTA4LCAweDgwMDYwLCAweDgwMDIwLCAweDkwMGEwLCAweDgwMDAwLCAweDgwMDgwLCAweDgwMDQwLCAweDkwMGUwLCAweDcwMTA0LCAweDgwMDU4LCAweDgwMDE4LCAweDkwMDkwLCAweDcwMTE0LCAweDgwMDc4LCAweDgwMDM4LCAweDkwMGQwLCAweDcwMTBjLCAweDgwMDY4LCAweDgwMDI4LCAweDkwMGIwLCAweDgwMDA4LCAweDgwMDg4LCAweDgwMDQ4LCAweDkwMGYwLCAweDcwMTAyLCAweDgwMDU0LCAweDgwMDE0LCAweDgwMTFjLCAweDcwMTEyLCAweDgwMDc0LCAweDgwMDM0LCAweDkwMGM4LCAweDcwMTBhLCAweDgwMDY0LCAweDgwMDI0LCAweDkwMGE4LCAweDgwMDA0LCAweDgwMDg0LCAweDgwMDQ0LCAweDkwMGU4LCAweDcwMTA2LCAweDgwMDVjLCAweDgwMDFjLCAweDkwMDk4LCAweDcwMTE2LCAweDgwMDdjLCAweDgwMDNjLCAweDkwMGQ4LCAweDcwMTBlLCAweDgwMDZjLCAweDgwMDJjLCAweDkwMGI4LCAweDgwMDBjLCAweDgwMDhjLCAweDgwMDRjLCAweDkwMGY4LCAweDcwMTAxLCAweDgwMDUyLCAweDgwMDEyLCAweDgwMTFhLCAweDcwMTExLCAweDgwMDcyLCAweDgwMDMyLCAweDkwMGM0LCAweDcwMTA5LCAweDgwMDYyLCAweDgwMDIyLCAweDkwMGE0LCAweDgwMDAyLCAweDgwMDgyLCAweDgwMDQyLCAweDkwMGU0LCAweDcwMTA1LCAweDgwMDVhLCAweDgwMDFhLCAweDkwMDk0LCAweDcwMTE1LCAweDgwMDdhLCAweDgwMDNhLCAweDkwMGQ0LCAweDcwMTBkLCAweDgwMDZhLCAweDgwMDJhLCAweDkwMGI0LCAweDgwMDBhLCAweDgwMDhhLCAweDgwMDRhLCAweDkwMGY0LCAweDcwMTAzLCAweDgwMDU2LCAweDgwMDE2LCAweDgwMTFlLCAweDcwMTEzLCAweDgwMDc2LCAweDgwMDM2LCAweDkwMGNjLCAweDcwMTBiLCAweDgwMDY2LCAweDgwMDI2LCAweDkwMGFjLCAweDgwMDA2LCAweDgwMDg2LCAweDgwMDQ2LCAweDkwMGVjLCAweDcwMTA3LCAweDgwMDVlLCAweDgwMDFlLCAweDkwMDljLCAweDcwMTE3LCAweDgwMDdlLCAweDgwMDNlLCAweDkwMGRjLCAweDcwMTBmLCAweDgwMDZlLCAweDgwMDJlLCAweDkwMGJjLCAweDgwMDBlLCAweDgwMDhlLCAweDgwMDRlLCAweDkwMGZjLCAweDcwMTAwLCAweDgwMDUxLCAweDgwMDExLCAweDgwMTE5LCAweDcwMTEwLCAweDgwMDcxLCAweDgwMDMxLCAweDkwMGMyLCAweDcwMTA4LCAweDgwMDYxLCAweDgwMDIxLCAweDkwMGEyLCAweDgwMDAxLCAweDgwMDgxLCAweDgwMDQxLCAweDkwMGUyLCAweDcwMTA0LCAweDgwMDU5LCAweDgwMDE5LCAweDkwMDkyLCAweDcwMTE0LCAweDgwMDc5LCAweDgwMDM5LCAweDkwMGQyLCAweDcwMTBjLCAweDgwMDY5LCAweDgwMDI5LCAweDkwMGIyLCAweDgwMDA5LCAweDgwMDg5LCAweDgwMDQ5LCAweDkwMGYyLCAweDcwMTAyLCAweDgwMDU1LCAweDgwMDE1LCAweDgwMTFkLCAweDcwMTEyLCAweDgwMDc1LCAweDgwMDM1LCAweDkwMGNhLCAweDcwMTBhLCAweDgwMDY1LCAweDgwMDI1LCAweDkwMGFhLCAweDgwMDA1LCAweDgwMDg1LCAweDgwMDQ1LCAweDkwMGVhLCAweDcwMTA2LCAweDgwMDVkLCAweDgwMDFkLCAweDkwMDlhLCAweDcwMTE2LCAweDgwMDdkLCAweDgwMDNkLCAweDkwMGRhLCAweDcwMTBlLCAweDgwMDZkLCAweDgwMDJkLCAweDkwMGJhLCAweDgwMDBkLCAweDgwMDhkLCAweDgwMDRkLCAweDkwMGZhLCAweDcwMTAxLCAweDgwMDUzLCAweDgwMDEzLCAweDgwMTFiLCAweDcwMTExLCAweDgwMDczLCAweDgwMDMzLCAweDkwMGM2LCAweDcwMTA5LCAweDgwMDYzLCAweDgwMDIzLCAweDkwMGE2LCAweDgwMDAzLCAweDgwMDgzLCAweDgwMDQzLCAweDkwMGU2LCAweDcwMTA1LCAweDgwMDViLCAweDgwMDFiLCAweDkwMDk2LCAweDcwMTE1LCAweDgwMDdiLCAweDgwMDNiLCAweDkwMGQ2LCAweDcwMTBkLCAweDgwMDZiLCAweDgwMDJiLCAweDkwMGI2LCAweDgwMDBiLCAweDgwMDhiLCAweDgwMDRiLCAweDkwMGY2LCAweDcwMTAzLCAweDgwMDU3LCAweDgwMDE3LCAweDgwMTFmLCAweDcwMTEzLCAweDgwMDc3LCAweDgwMDM3LCAweDkwMGNlLCAweDcwMTBiLCAweDgwMDY3LCAweDgwMDI3LCAweDkwMGFlLCAweDgwMDA3LCAweDgwMDg3LCAweDgwMDQ3LCAweDkwMGVlLCAweDcwMTA3LCAweDgwMDVmLCAweDgwMDFmLCAweDkwMDllLCAweDcwMTE3LCAweDgwMDdmLCAweDgwMDNmLCAweDkwMGRlLCAweDcwMTBmLCAweDgwMDZmLCAweDgwMDJmLCAweDkwMGJlLCAweDgwMDBmLCAweDgwMDhmLCAweDgwMDRmLCAweDkwMGZlLCAweDcwMTAwLCAweDgwMDUwLCAweDgwMDEwLCAweDgwMTE4LCAweDcwMTEwLCAweDgwMDcwLCAweDgwMDMwLCAweDkwMGMxLCAweDcwMTA4LCAweDgwMDYwLCAweDgwMDIwLCAweDkwMGExLCAweDgwMDAwLCAweDgwMDgwLCAweDgwMDQwLCAweDkwMGUxLCAweDcwMTA0LCAweDgwMDU4LCAweDgwMDE4LCAweDkwMDkxLCAweDcwMTE0LCAweDgwMDc4LCAweDgwMDM4LCAweDkwMGQxLCAweDcwMTBjLCAweDgwMDY4LCAweDgwMDI4LCAweDkwMGIxLCAweDgwMDA4LCAweDgwMDg4LCAweDgwMDQ4LCAweDkwMGYxLCAweDcwMTAyLCAweDgwMDU0LCAweDgwMDE0LCAweDgwMTFjLCAweDcwMTEyLCAweDgwMDc0LCAweDgwMDM0LCAweDkwMGM5LCAweDcwMTBhLCAweDgwMDY0LCAweDgwMDI0LCAweDkwMGE5LCAweDgwMDA0LCAweDgwMDg0LCAweDgwMDQ0LCAweDkwMGU5LCAweDcwMTA2LCAweDgwMDVjLCAweDgwMDFjLCAweDkwMDk5LCAweDcwMTE2LCAweDgwMDdjLCAweDgwMDNjLCAweDkwMGQ5LCAweDcwMTBlLCAweDgwMDZjLCAweDgwMDJjLCAweDkwMGI5LCAweDgwMDBjLCAweDgwMDhjLCAweDgwMDRjLCAweDkwMGY5LCAweDcwMTAxLCAweDgwMDUyLCAweDgwMDEyLCAweDgwMTFhLCAweDcwMTExLCAweDgwMDcyLCAweDgwMDMyLCAweDkwMGM1LCAweDcwMTA5LCAweDgwMDYyLCAweDgwMDIyLCAweDkwMGE1LCAweDgwMDAyLCAweDgwMDgyLCAweDgwMDQyLCAweDkwMGU1LCAweDcwMTA1LCAweDgwMDVhLCAweDgwMDFhLCAweDkwMDk1LCAweDcwMTE1LCAweDgwMDdhLCAweDgwMDNhLCAweDkwMGQ1LCAweDcwMTBkLCAweDgwMDZhLCAweDgwMDJhLCAweDkwMGI1LCAweDgwMDBhLCAweDgwMDhhLCAweDgwMDRhLCAweDkwMGY1LCAweDcwMTAzLCAweDgwMDU2LCAweDgwMDE2LCAweDgwMTFlLCAweDcwMTEzLCAweDgwMDc2LCAweDgwMDM2LCAweDkwMGNkLCAweDcwMTBiLCAweDgwMDY2LCAweDgwMDI2LCAweDkwMGFkLCAweDgwMDA2LCAweDgwMDg2LCAweDgwMDQ2LCAweDkwMGVkLCAweDcwMTA3LCAweDgwMDVlLCAweDgwMDFlLCAweDkwMDlkLCAweDcwMTE3LCAweDgwMDdlLCAweDgwMDNlLCAweDkwMGRkLCAweDcwMTBmLCAweDgwMDZlLCAweDgwMDJlLCAweDkwMGJkLCAweDgwMDBlLCAweDgwMDhlLCAweDgwMDRlLCAweDkwMGZkLCAweDcwMTAwLCAweDgwMDUxLCAweDgwMDExLCAweDgwMTE5LCAweDcwMTEwLCAweDgwMDcxLCAweDgwMDMxLCAweDkwMGMzLCAweDcwMTA4LCAweDgwMDYxLCAweDgwMDIxLCAweDkwMGEzLCAweDgwMDAxLCAweDgwMDgxLCAweDgwMDQxLCAweDkwMGUzLCAweDcwMTA0LCAweDgwMDU5LCAweDgwMDE5LCAweDkwMDkzLCAweDcwMTE0LCAweDgwMDc5LCAweDgwMDM5LCAweDkwMGQzLCAweDcwMTBjLCAweDgwMDY5LCAweDgwMDI5LCAweDkwMGIzLCAweDgwMDA5LCAweDgwMDg5LCAweDgwMDQ5LCAweDkwMGYzLCAweDcwMTAyLCAweDgwMDU1LCAweDgwMDE1LCAweDgwMTFkLCAweDcwMTEyLCAweDgwMDc1LCAweDgwMDM1LCAweDkwMGNiLCAweDcwMTBhLCAweDgwMDY1LCAweDgwMDI1LCAweDkwMGFiLCAweDgwMDA1LCAweDgwMDg1LCAweDgwMDQ1LCAweDkwMGViLCAweDcwMTA2LCAweDgwMDVkLCAweDgwMDFkLCAweDkwMDliLCAweDcwMTE2LCAweDgwMDdkLCAweDgwMDNkLCAweDkwMGRiLCAweDcwMTBlLCAweDgwMDZkLCAweDgwMDJkLCAweDkwMGJiLCAweDgwMDBkLCAweDgwMDhkLCAweDgwMDRkLCAweDkwMGZiLCAweDcwMTAxLCAweDgwMDUzLCAweDgwMDEzLCAweDgwMTFiLCAweDcwMTExLCAweDgwMDczLCAweDgwMDMzLCAweDkwMGM3LCAweDcwMTA5LCAweDgwMDYzLCAweDgwMDIzLCAweDkwMGE3LCAweDgwMDAzLCAweDgwMDgzLCAweDgwMDQzLCAweDkwMGU3LCAweDcwMTA1LCAweDgwMDViLCAweDgwMDFiLCAweDkwMDk3LCAweDcwMTE1LCAweDgwMDdiLCAweDgwMDNiLCAweDkwMGQ3LCAweDcwMTBkLCAweDgwMDZiLCAweDgwMDJiLCAweDkwMGI3LCAweDgwMDBiLCAweDgwMDhiLCAweDgwMDRiLCAweDkwMGY3LCAweDcwMTAzLCAweDgwMDU3LCAweDgwMDE3LCAweDgwMTFmLCAweDcwMTEzLCAweDgwMDc3LCAweDgwMDM3LCAweDkwMGNmLCAweDcwMTBiLCAweDgwMDY3LCAweDgwMDI3LCAweDkwMGFmLCAweDgwMDA3LCAweDgwMDg3LCAweDgwMDQ3LCAweDkwMGVmLCAweDcwMTA3LCAweDgwMDVmLCAweDgwMDFmLCAweDkwMDlmLCAweDcwMTE3LCAweDgwMDdmLCAweDgwMDNmLCAweDkwMGRmLCAweDcwMTBmLCAweDgwMDZmLCAweDgwMDJmLCAweDkwMGJmLCAweDgwMDBmLCAweDgwMDhmLCAweDgwMDRmLCAweDkwMGZmXSksIDldOwogICAgICB2YXIgZml4ZWREaXN0Q29kZVRhYiA9IFtuZXcgSW50MzJBcnJheShbMHg1MDAwMCwgMHg1MDAxMCwgMHg1MDAwOCwgMHg1MDAxOCwgMHg1MDAwNCwgMHg1MDAxNCwgMHg1MDAwYywgMHg1MDAxYywgMHg1MDAwMiwgMHg1MDAxMiwgMHg1MDAwYSwgMHg1MDAxYSwgMHg1MDAwNiwgMHg1MDAxNiwgMHg1MDAwZSwgMHgwMDAwMCwgMHg1MDAwMSwgMHg1MDAxMSwgMHg1MDAwOSwgMHg1MDAxOSwgMHg1MDAwNSwgMHg1MDAxNSwgMHg1MDAwZCwgMHg1MDAxZCwgMHg1MDAwMywgMHg1MDAxMywgMHg1MDAwYiwgMHg1MDAxYiwgMHg1MDAwNywgMHg1MDAxNywgMHg1MDAwZiwgMHgwMDAwMF0pLCA1XTsKCiAgICAgIGZ1bmN0aW9uIEZsYXRlU3RyZWFtKHN0ciwgbWF5YmVMZW5ndGgpIHsKICAgICAgICB0aGlzLnN0ciA9IHN0cjsKICAgICAgICB0aGlzLmRpY3QgPSBzdHIuZGljdDsKICAgICAgICB2YXIgY21mID0gc3RyLmdldEJ5dGUoKTsKICAgICAgICB2YXIgZmxnID0gc3RyLmdldEJ5dGUoKTsKCiAgICAgICAgaWYgKGNtZiA9PT0gLTEgfHwgZmxnID09PSAtMSkgewogICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJJbnZhbGlkIGhlYWRlciBpbiBmbGF0ZSBzdHJlYW06ICIuY29uY2F0KGNtZiwgIiwgIikuY29uY2F0KGZsZykpOwogICAgICAgIH0KCiAgICAgICAgaWYgKChjbWYgJiAweDBmKSAhPT0gMHgwOCkgewogICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJVbmtub3duIGNvbXByZXNzaW9uIG1ldGhvZCBpbiBmbGF0ZSBzdHJlYW06ICIuY29uY2F0KGNtZiwgIiwgIikuY29uY2F0KGZsZykpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCgoY21mIDw8IDgpICsgZmxnKSAlIDMxICE9PSAwKSB7CiAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkJhZCBGQ0hFQ0sgaW4gZmxhdGUgc3RyZWFtOiAiLmNvbmNhdChjbWYsICIsICIpLmNvbmNhdChmbGcpKTsKICAgICAgICB9CgogICAgICAgIGlmIChmbGcgJiAweDIwKSB7CiAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkZESUNUIGJpdCBzZXQgaW4gZmxhdGUgc3RyZWFtOiAiLmNvbmNhdChjbWYsICIsICIpLmNvbmNhdChmbGcpKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuY29kZVNpemUgPSAwOwogICAgICAgIHRoaXMuY29kZUJ1ZiA9IDA7CiAgICAgICAgRGVjb2RlU3RyZWFtLmNhbGwodGhpcywgbWF5YmVMZW5ndGgpOwogICAgICB9CgogICAgICBGbGF0ZVN0cmVhbS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKERlY29kZVN0cmVhbS5wcm90b3R5cGUpOwoKICAgICAgRmxhdGVTdHJlYW0ucHJvdG90eXBlLmdldEJpdHMgPSBmdW5jdGlvbiBGbGF0ZVN0cmVhbV9nZXRCaXRzKGJpdHMpIHsKICAgICAgICB2YXIgc3RyID0gdGhpcy5zdHI7CiAgICAgICAgdmFyIGNvZGVTaXplID0gdGhpcy5jb2RlU2l6ZTsKICAgICAgICB2YXIgY29kZUJ1ZiA9IHRoaXMuY29kZUJ1ZjsKICAgICAgICB2YXIgYjsKCiAgICAgICAgd2hpbGUgKGNvZGVTaXplIDwgYml0cykgewogICAgICAgICAgaWYgKChiID0gc3RyLmdldEJ5dGUoKSkgPT09IC0xKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiQmFkIGVuY29kaW5nIGluIGZsYXRlIHN0cmVhbSIpOwogICAgICAgICAgfQoKICAgICAgICAgIGNvZGVCdWYgfD0gYiA8PCBjb2RlU2l6ZTsKICAgICAgICAgIGNvZGVTaXplICs9IDg7CiAgICAgICAgfQoKICAgICAgICBiID0gY29kZUJ1ZiAmICgxIDw8IGJpdHMpIC0gMTsKICAgICAgICB0aGlzLmNvZGVCdWYgPSBjb2RlQnVmID4+IGJpdHM7CiAgICAgICAgdGhpcy5jb2RlU2l6ZSA9IGNvZGVTaXplIC09IGJpdHM7CiAgICAgICAgcmV0dXJuIGI7CiAgICAgIH07CgogICAgICBGbGF0ZVN0cmVhbS5wcm90b3R5cGUuZ2V0Q29kZSA9IGZ1bmN0aW9uIEZsYXRlU3RyZWFtX2dldENvZGUodGFibGUpIHsKICAgICAgICB2YXIgc3RyID0gdGhpcy5zdHI7CiAgICAgICAgdmFyIGNvZGVzID0gdGFibGVbMF07CiAgICAgICAgdmFyIG1heExlbiA9IHRhYmxlWzFdOwogICAgICAgIHZhciBjb2RlU2l6ZSA9IHRoaXMuY29kZVNpemU7CiAgICAgICAgdmFyIGNvZGVCdWYgPSB0aGlzLmNvZGVCdWY7CiAgICAgICAgdmFyIGI7CgogICAgICAgIHdoaWxlIChjb2RlU2l6ZSA8IG1heExlbikgewogICAgICAgICAgaWYgKChiID0gc3RyLmdldEJ5dGUoKSkgPT09IC0xKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGNvZGVCdWYgfD0gYiA8PCBjb2RlU2l6ZTsKICAgICAgICAgIGNvZGVTaXplICs9IDg7CiAgICAgICAgfQoKICAgICAgICB2YXIgY29kZSA9IGNvZGVzW2NvZGVCdWYgJiAoMSA8PCBtYXhMZW4pIC0gMV07CiAgICAgICAgdmFyIGNvZGVMZW4gPSBjb2RlID4+IDE2OwogICAgICAgIHZhciBjb2RlVmFsID0gY29kZSAmIDB4ZmZmZjsKCiAgICAgICAgaWYgKGNvZGVMZW4gPCAxIHx8IGNvZGVTaXplIDwgY29kZUxlbikgewogICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJCYWQgZW5jb2RpbmcgaW4gZmxhdGUgc3RyZWFtIik7CiAgICAgICAgfQoKICAgICAgICB0aGlzLmNvZGVCdWYgPSBjb2RlQnVmID4+IGNvZGVMZW47CiAgICAgICAgdGhpcy5jb2RlU2l6ZSA9IGNvZGVTaXplIC0gY29kZUxlbjsKICAgICAgICByZXR1cm4gY29kZVZhbDsKICAgICAgfTsKCiAgICAgIEZsYXRlU3RyZWFtLnByb3RvdHlwZS5nZW5lcmF0ZUh1ZmZtYW5UYWJsZSA9IGZ1bmN0aW9uIGZsYXRlU3RyZWFtR2VuZXJhdGVIdWZmbWFuVGFibGUobGVuZ3RocykgewogICAgICAgIHZhciBuID0gbGVuZ3Rocy5sZW5ndGg7CiAgICAgICAgdmFyIG1heExlbiA9IDA7CiAgICAgICAgdmFyIGk7CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBuOyArK2kpIHsKICAgICAgICAgIGlmIChsZW5ndGhzW2ldID4gbWF4TGVuKSB7CiAgICAgICAgICAgIG1heExlbiA9IGxlbmd0aHNbaV07CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YXIgc2l6ZSA9IDEgPDwgbWF4TGVuOwogICAgICAgIHZhciBjb2RlcyA9IG5ldyBJbnQzMkFycmF5KHNpemUpOwoKICAgICAgICBmb3IgKHZhciBsZW4gPSAxLCBjb2RlID0gMCwgc2tpcCA9IDI7IGxlbiA8PSBtYXhMZW47ICsrbGVuLCBjb2RlIDw8PSAxLCBza2lwIDw8PSAxKSB7CiAgICAgICAgICBmb3IgKHZhciB2YWwgPSAwOyB2YWwgPCBuOyArK3ZhbCkgewogICAgICAgICAgICBpZiAobGVuZ3Roc1t2YWxdID09PSBsZW4pIHsKICAgICAgICAgICAgICB2YXIgY29kZTIgPSAwOwogICAgICAgICAgICAgIHZhciB0ID0gY29kZTsKCiAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICBjb2RlMiA9IGNvZGUyIDw8IDEgfCB0ICYgMTsKICAgICAgICAgICAgICAgIHQgPj49IDE7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBmb3IgKGkgPSBjb2RlMjsgaSA8IHNpemU7IGkgKz0gc2tpcCkgewogICAgICAgICAgICAgICAgY29kZXNbaV0gPSBsZW4gPDwgMTYgfCB2YWw7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICArK2NvZGU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBbY29kZXMsIG1heExlbl07CiAgICAgIH07CgogICAgICBGbGF0ZVN0cmVhbS5wcm90b3R5cGUucmVhZEJsb2NrID0gZnVuY3Rpb24gRmxhdGVTdHJlYW1fcmVhZEJsb2NrKCkgewogICAgICAgIHZhciBidWZmZXIsIGxlbjsKICAgICAgICB2YXIgc3RyID0gdGhpcy5zdHI7CiAgICAgICAgdmFyIGhkciA9IHRoaXMuZ2V0Qml0cygzKTsKCiAgICAgICAgaWYgKGhkciAmIDEpIHsKICAgICAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGhkciA+Pj0gMTsKCiAgICAgICAgaWYgKGhkciA9PT0gMCkgewogICAgICAgICAgdmFyIGI7CgogICAgICAgICAgaWYgKChiID0gc3RyLmdldEJ5dGUoKSkgPT09IC0xKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiQmFkIGJsb2NrIGhlYWRlciBpbiBmbGF0ZSBzdHJlYW0iKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgYmxvY2tMZW4gPSBiOwoKICAgICAgICAgIGlmICgoYiA9IHN0ci5nZXRCeXRlKCkpID09PSAtMSkgewogICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkJhZCBibG9jayBoZWFkZXIgaW4gZmxhdGUgc3RyZWFtIik7CiAgICAgICAgICB9CgogICAgICAgICAgYmxvY2tMZW4gfD0gYiA8PCA4OwoKICAgICAgICAgIGlmICgoYiA9IHN0ci5nZXRCeXRlKCkpID09PSAtMSkgewogICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkJhZCBibG9jayBoZWFkZXIgaW4gZmxhdGUgc3RyZWFtIik7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGNoZWNrID0gYjsKCiAgICAgICAgICBpZiAoKGIgPSBzdHIuZ2V0Qnl0ZSgpKSA9PT0gLTEpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJCYWQgYmxvY2sgaGVhZGVyIGluIGZsYXRlIHN0cmVhbSIpOwogICAgICAgICAgfQoKICAgICAgICAgIGNoZWNrIHw9IGIgPDwgODsKCiAgICAgICAgICBpZiAoY2hlY2sgIT09ICh+YmxvY2tMZW4gJiAweGZmZmYpICYmIChibG9ja0xlbiAhPT0gMCB8fCBjaGVjayAhPT0gMCkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJCYWQgdW5jb21wcmVzc2VkIGJsb2NrIGxlbmd0aCBpbiBmbGF0ZSBzdHJlYW0iKTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLmNvZGVCdWYgPSAwOwogICAgICAgICAgdGhpcy5jb2RlU2l6ZSA9IDA7CiAgICAgICAgICB2YXIgYnVmZmVyTGVuZ3RoID0gdGhpcy5idWZmZXJMZW5ndGgsCiAgICAgICAgICAgIGVuZCA9IGJ1ZmZlckxlbmd0aCArIGJsb2NrTGVuOwogICAgICAgICAgYnVmZmVyID0gdGhpcy5lbnN1cmVCdWZmZXIoZW5kKTsKICAgICAgICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gZW5kOwoKICAgICAgICAgIGlmIChibG9ja0xlbiA9PT0gMCkgewogICAgICAgICAgICBpZiAoc3RyLnBlZWtCeXRlKCkgPT09IC0xKSB7CiAgICAgICAgICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgYmxvY2sgPSBzdHIuZ2V0Qnl0ZXMoYmxvY2tMZW4pOwogICAgICAgICAgICBidWZmZXIuc2V0KGJsb2NrLCBidWZmZXJMZW5ndGgpOwoKICAgICAgICAgICAgaWYgKGJsb2NrLmxlbmd0aCA8IGJsb2NrTGVuKSB7CiAgICAgICAgICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIGxpdENvZGVUYWJsZTsKICAgICAgICB2YXIgZGlzdENvZGVUYWJsZTsKCiAgICAgICAgaWYgKGhkciA9PT0gMSkgewogICAgICAgICAgbGl0Q29kZVRhYmxlID0gZml4ZWRMaXRDb2RlVGFiOwogICAgICAgICAgZGlzdENvZGVUYWJsZSA9IGZpeGVkRGlzdENvZGVUYWI7CiAgICAgICAgfSBlbHNlIGlmIChoZHIgPT09IDIpIHsKICAgICAgICAgIHZhciBudW1MaXRDb2RlcyA9IHRoaXMuZ2V0Qml0cyg1KSArIDI1NzsKICAgICAgICAgIHZhciBudW1EaXN0Q29kZXMgPSB0aGlzLmdldEJpdHMoNSkgKyAxOwogICAgICAgICAgdmFyIG51bUNvZGVMZW5Db2RlcyA9IHRoaXMuZ2V0Qml0cyg0KSArIDQ7CiAgICAgICAgICB2YXIgY29kZUxlbkNvZGVMZW5ndGhzID0gbmV3IFVpbnQ4QXJyYXkoY29kZUxlbkNvZGVNYXAubGVuZ3RoKTsKICAgICAgICAgIHZhciBpOwoKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBudW1Db2RlTGVuQ29kZXM7ICsraSkgewogICAgICAgICAgICBjb2RlTGVuQ29kZUxlbmd0aHNbY29kZUxlbkNvZGVNYXBbaV1dID0gdGhpcy5nZXRCaXRzKDMpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBjb2RlTGVuQ29kZVRhYiA9IHRoaXMuZ2VuZXJhdGVIdWZmbWFuVGFibGUoY29kZUxlbkNvZGVMZW5ndGhzKTsKICAgICAgICAgIGxlbiA9IDA7CiAgICAgICAgICBpID0gMDsKICAgICAgICAgIHZhciBjb2RlcyA9IG51bUxpdENvZGVzICsgbnVtRGlzdENvZGVzOwogICAgICAgICAgdmFyIGNvZGVMZW5ndGhzID0gbmV3IFVpbnQ4QXJyYXkoY29kZXMpOwogICAgICAgICAgdmFyIGJpdHNMZW5ndGgsIGJpdHNPZmZzZXQsIHdoYXQ7CgogICAgICAgICAgd2hpbGUgKGkgPCBjb2RlcykgewogICAgICAgICAgICB2YXIgY29kZSA9IHRoaXMuZ2V0Q29kZShjb2RlTGVuQ29kZVRhYik7CgogICAgICAgICAgICBpZiAoY29kZSA9PT0gMTYpIHsKICAgICAgICAgICAgICBiaXRzTGVuZ3RoID0gMjsKICAgICAgICAgICAgICBiaXRzT2Zmc2V0ID0gMzsKICAgICAgICAgICAgICB3aGF0ID0gbGVuOwogICAgICAgICAgICB9IGVsc2UgaWYgKGNvZGUgPT09IDE3KSB7CiAgICAgICAgICAgICAgYml0c0xlbmd0aCA9IDM7CiAgICAgICAgICAgICAgYml0c09mZnNldCA9IDM7CiAgICAgICAgICAgICAgd2hhdCA9IGxlbiA9IDA7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoY29kZSA9PT0gMTgpIHsKICAgICAgICAgICAgICBiaXRzTGVuZ3RoID0gNzsKICAgICAgICAgICAgICBiaXRzT2Zmc2V0ID0gMTE7CiAgICAgICAgICAgICAgd2hhdCA9IGxlbiA9IDA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgY29kZUxlbmd0aHNbaSsrXSA9IGxlbiA9IGNvZGU7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciByZXBlYXRMZW5ndGggPSB0aGlzLmdldEJpdHMoYml0c0xlbmd0aCkgKyBiaXRzT2Zmc2V0OwoKICAgICAgICAgICAgd2hpbGUgKHJlcGVhdExlbmd0aC0tID4gMCkgewogICAgICAgICAgICAgIGNvZGVMZW5ndGhzW2krK10gPSB3aGF0OwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgbGl0Q29kZVRhYmxlID0gdGhpcy5nZW5lcmF0ZUh1ZmZtYW5UYWJsZShjb2RlTGVuZ3Rocy5zdWJhcnJheSgwLCBudW1MaXRDb2RlcykpOwogICAgICAgICAgZGlzdENvZGVUYWJsZSA9IHRoaXMuZ2VuZXJhdGVIdWZmbWFuVGFibGUoY29kZUxlbmd0aHMuc3ViYXJyYXkobnVtTGl0Q29kZXMsIGNvZGVzKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiVW5rbm93biBibG9jayB0eXBlIGluIGZsYXRlIHN0cmVhbSIpOwogICAgICAgIH0KCiAgICAgICAgYnVmZmVyID0gdGhpcy5idWZmZXI7CiAgICAgICAgdmFyIGxpbWl0ID0gYnVmZmVyID8gYnVmZmVyLmxlbmd0aCA6IDA7CiAgICAgICAgdmFyIHBvcyA9IHRoaXMuYnVmZmVyTGVuZ3RoOwoKICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgdmFyIGNvZGUxID0gdGhpcy5nZXRDb2RlKGxpdENvZGVUYWJsZSk7CgogICAgICAgICAgaWYgKGNvZGUxIDwgMjU2KSB7CiAgICAgICAgICAgIGlmIChwb3MgKyAxID49IGxpbWl0KSB7CiAgICAgICAgICAgICAgYnVmZmVyID0gdGhpcy5lbnN1cmVCdWZmZXIocG9zICsgMSk7CiAgICAgICAgICAgICAgbGltaXQgPSBidWZmZXIubGVuZ3RoOwogICAgICAgICAgICB9CgogICAgICAgICAgICBidWZmZXJbcG9zKytdID0gY29kZTE7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChjb2RlMSA9PT0gMjU2KSB7CiAgICAgICAgICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gcG9zOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgY29kZTEgLT0gMjU3OwogICAgICAgICAgY29kZTEgPSBsZW5ndGhEZWNvZGVbY29kZTFdOwogICAgICAgICAgdmFyIGNvZGUyID0gY29kZTEgPj4gMTY7CgogICAgICAgICAgaWYgKGNvZGUyID4gMCkgewogICAgICAgICAgICBjb2RlMiA9IHRoaXMuZ2V0Qml0cyhjb2RlMik7CiAgICAgICAgICB9CgogICAgICAgICAgbGVuID0gKGNvZGUxICYgMHhmZmZmKSArIGNvZGUyOwogICAgICAgICAgY29kZTEgPSB0aGlzLmdldENvZGUoZGlzdENvZGVUYWJsZSk7CiAgICAgICAgICBjb2RlMSA9IGRpc3REZWNvZGVbY29kZTFdOwogICAgICAgICAgY29kZTIgPSBjb2RlMSA+PiAxNjsKCiAgICAgICAgICBpZiAoY29kZTIgPiAwKSB7CiAgICAgICAgICAgIGNvZGUyID0gdGhpcy5nZXRCaXRzKGNvZGUyKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZGlzdCA9IChjb2RlMSAmIDB4ZmZmZikgKyBjb2RlMjsKCiAgICAgICAgICBpZiAocG9zICsgbGVuID49IGxpbWl0KSB7CiAgICAgICAgICAgIGJ1ZmZlciA9IHRoaXMuZW5zdXJlQnVmZmVyKHBvcyArIGxlbik7CiAgICAgICAgICAgIGxpbWl0ID0gYnVmZmVyLmxlbmd0aDsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3IgKHZhciBrID0gMDsgayA8IGxlbjsgKytrLCArK3BvcykgewogICAgICAgICAgICBidWZmZXJbcG9zXSA9IGJ1ZmZlcltwb3MgLSBkaXN0XTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07CgogICAgICByZXR1cm4gRmxhdGVTdHJlYW07CiAgICB9KCk7CgogICAgZXhwb3J0cy5GbGF0ZVN0cmVhbSA9IEZsYXRlU3RyZWFtOwoKICAgIHZhciBQcmVkaWN0b3JTdHJlYW0gPSBmdW5jdGlvbiBQcmVkaWN0b3JTdHJlYW1DbG9zdXJlKCkgewogICAgICBmdW5jdGlvbiBQcmVkaWN0b3JTdHJlYW0oc3RyLCBtYXliZUxlbmd0aCwgcGFyYW1zKSB7CiAgICAgICAgaWYgKCEoMCwgX3ByaW1pdGl2ZXMuaXNEaWN0KShwYXJhbXMpKSB7CiAgICAgICAgICByZXR1cm4gc3RyOwogICAgICAgIH0KCiAgICAgICAgdmFyIHByZWRpY3RvciA9IHRoaXMucHJlZGljdG9yID0gcGFyYW1zLmdldCgiUHJlZGljdG9yIikgfHwgMTsKCiAgICAgICAgaWYgKHByZWRpY3RvciA8PSAxKSB7CiAgICAgICAgICByZXR1cm4gc3RyOwogICAgICAgIH0KCiAgICAgICAgaWYgKHByZWRpY3RvciAhPT0gMiAmJiAocHJlZGljdG9yIDwgMTAgfHwgcHJlZGljdG9yID4gMTUpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIlVuc3VwcG9ydGVkIHByZWRpY3RvcjogIi5jb25jYXQocHJlZGljdG9yKSk7CiAgICAgICAgfQoKICAgICAgICBpZiAocHJlZGljdG9yID09PSAyKSB7CiAgICAgICAgICB0aGlzLnJlYWRCbG9jayA9IHRoaXMucmVhZEJsb2NrVGlmZjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5yZWFkQmxvY2sgPSB0aGlzLnJlYWRCbG9ja1BuZzsKICAgICAgICB9CgogICAgICAgIHRoaXMuc3RyID0gc3RyOwogICAgICAgIHRoaXMuZGljdCA9IHN0ci5kaWN0OwogICAgICAgIHZhciBjb2xvcnMgPSB0aGlzLmNvbG9ycyA9IHBhcmFtcy5nZXQoIkNvbG9ycyIpIHx8IDE7CiAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHMgPSBwYXJhbXMuZ2V0KCJCaXRzUGVyQ29tcG9uZW50IikgfHwgODsKICAgICAgICB2YXIgY29sdW1ucyA9IHRoaXMuY29sdW1ucyA9IHBhcmFtcy5nZXQoIkNvbHVtbnMiKSB8fCAxOwogICAgICAgIHRoaXMucGl4Qnl0ZXMgPSBjb2xvcnMgKiBiaXRzICsgNyA+PiAzOwogICAgICAgIHRoaXMucm93Qnl0ZXMgPSBjb2x1bW5zICogY29sb3JzICogYml0cyArIDcgPj4gMzsKICAgICAgICBEZWNvZGVTdHJlYW0uY2FsbCh0aGlzLCBtYXliZUxlbmd0aCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIFByZWRpY3RvclN0cmVhbS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKERlY29kZVN0cmVhbS5wcm90b3R5cGUpOwoKICAgICAgUHJlZGljdG9yU3RyZWFtLnByb3RvdHlwZS5yZWFkQmxvY2tUaWZmID0gZnVuY3Rpb24gcHJlZGljdG9yU3RyZWFtUmVhZEJsb2NrVGlmZigpIHsKICAgICAgICB2YXIgcm93Qnl0ZXMgPSB0aGlzLnJvd0J5dGVzOwogICAgICAgIHZhciBidWZmZXJMZW5ndGggPSB0aGlzLmJ1ZmZlckxlbmd0aDsKICAgICAgICB2YXIgYnVmZmVyID0gdGhpcy5lbnN1cmVCdWZmZXIoYnVmZmVyTGVuZ3RoICsgcm93Qnl0ZXMpOwogICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwogICAgICAgIHZhciBjb2xvcnMgPSB0aGlzLmNvbG9yczsKICAgICAgICB2YXIgcmF3Qnl0ZXMgPSB0aGlzLnN0ci5nZXRCeXRlcyhyb3dCeXRlcyk7CiAgICAgICAgdGhpcy5lb2YgPSAhcmF3Qnl0ZXMubGVuZ3RoOwoKICAgICAgICBpZiAodGhpcy5lb2YpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBpbmJ1ZiA9IDAsCiAgICAgICAgICBvdXRidWYgPSAwOwogICAgICAgIHZhciBpbmJpdHMgPSAwLAogICAgICAgICAgb3V0Yml0cyA9IDA7CiAgICAgICAgdmFyIHBvcyA9IGJ1ZmZlckxlbmd0aDsKICAgICAgICB2YXIgaTsKCiAgICAgICAgaWYgKGJpdHMgPT09IDEgJiYgY29sb3JzID09PSAxKSB7CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcm93Qnl0ZXM7ICsraSkgewogICAgICAgICAgICB2YXIgYyA9IHJhd0J5dGVzW2ldIF4gaW5idWY7CiAgICAgICAgICAgIGMgXj0gYyA+PiAxOwogICAgICAgICAgICBjIF49IGMgPj4gMjsKICAgICAgICAgICAgYyBePSBjID4+IDQ7CiAgICAgICAgICAgIGluYnVmID0gKGMgJiAxKSA8PCA3OwogICAgICAgICAgICBidWZmZXJbcG9zKytdID0gYzsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGJpdHMgPT09IDgpIHsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjb2xvcnM7ICsraSkgewogICAgICAgICAgICBidWZmZXJbcG9zKytdID0gcmF3Qnl0ZXNbaV07CiAgICAgICAgICB9CgogICAgICAgICAgZm9yICg7IGkgPCByb3dCeXRlczsgKytpKSB7CiAgICAgICAgICAgIGJ1ZmZlcltwb3NdID0gYnVmZmVyW3BvcyAtIGNvbG9yc10gKyByYXdCeXRlc1tpXTsKICAgICAgICAgICAgcG9zKys7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChiaXRzID09PSAxNikgewogICAgICAgICAgdmFyIGJ5dGVzUGVyUGl4ZWwgPSBjb2xvcnMgKiAyOwoKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBieXRlc1BlclBpeGVsOyArK2kpIHsKICAgICAgICAgICAgYnVmZmVyW3BvcysrXSA9IHJhd0J5dGVzW2ldOwogICAgICAgICAgfQoKICAgICAgICAgIGZvciAoOyBpIDwgcm93Qnl0ZXM7IGkgKz0gMikgewogICAgICAgICAgICB2YXIgc3VtID0gKChyYXdCeXRlc1tpXSAmIDB4ZmYpIDw8IDgpICsgKHJhd0J5dGVzW2kgKyAxXSAmIDB4ZmYpICsgKChidWZmZXJbcG9zIC0gYnl0ZXNQZXJQaXhlbF0gJiAweGZmKSA8PCA4KSArIChidWZmZXJbcG9zIC0gYnl0ZXNQZXJQaXhlbCArIDFdICYgMHhmZik7CiAgICAgICAgICAgIGJ1ZmZlcltwb3MrK10gPSBzdW0gPj4gOCAmIDB4ZmY7CiAgICAgICAgICAgIGJ1ZmZlcltwb3MrK10gPSBzdW0gJiAweGZmOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgY29tcEFycmF5ID0gbmV3IFVpbnQ4QXJyYXkoY29sb3JzICsgMSk7CiAgICAgICAgICB2YXIgYml0TWFzayA9ICgxIDw8IGJpdHMpIC0gMTsKICAgICAgICAgIHZhciBqID0gMCwKICAgICAgICAgICAgayA9IGJ1ZmZlckxlbmd0aDsKICAgICAgICAgIHZhciBjb2x1bW5zID0gdGhpcy5jb2x1bW5zOwoKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjb2x1bW5zOyArK2kpIHsKICAgICAgICAgICAgZm9yICh2YXIga2sgPSAwOyBrayA8IGNvbG9yczsgKytraykgewogICAgICAgICAgICAgIGlmIChpbmJpdHMgPCBiaXRzKSB7CiAgICAgICAgICAgICAgICBpbmJ1ZiA9IGluYnVmIDw8IDggfCByYXdCeXRlc1tqKytdICYgMHhmZjsKICAgICAgICAgICAgICAgIGluYml0cyArPSA4OwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY29tcEFycmF5W2trXSA9IGNvbXBBcnJheVtra10gKyAoaW5idWYgPj4gaW5iaXRzIC0gYml0cykgJiBiaXRNYXNrOwogICAgICAgICAgICAgIGluYml0cyAtPSBiaXRzOwogICAgICAgICAgICAgIG91dGJ1ZiA9IG91dGJ1ZiA8PCBiaXRzIHwgY29tcEFycmF5W2trXTsKICAgICAgICAgICAgICBvdXRiaXRzICs9IGJpdHM7CgogICAgICAgICAgICAgIGlmIChvdXRiaXRzID49IDgpIHsKICAgICAgICAgICAgICAgIGJ1ZmZlcltrKytdID0gb3V0YnVmID4+IG91dGJpdHMgLSA4ICYgMHhmZjsKICAgICAgICAgICAgICAgIG91dGJpdHMgLT0gODsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAob3V0Yml0cyA+IDApIHsKICAgICAgICAgICAgYnVmZmVyW2srK10gPSAob3V0YnVmIDw8IDggLSBvdXRiaXRzKSArIChpbmJ1ZiAmICgxIDw8IDggLSBvdXRiaXRzKSAtIDEpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy5idWZmZXJMZW5ndGggKz0gcm93Qnl0ZXM7CiAgICAgIH07CgogICAgICBQcmVkaWN0b3JTdHJlYW0ucHJvdG90eXBlLnJlYWRCbG9ja1BuZyA9IGZ1bmN0aW9uIHByZWRpY3RvclN0cmVhbVJlYWRCbG9ja1BuZygpIHsKICAgICAgICB2YXIgcm93Qnl0ZXMgPSB0aGlzLnJvd0J5dGVzOwogICAgICAgIHZhciBwaXhCeXRlcyA9IHRoaXMucGl4Qnl0ZXM7CiAgICAgICAgdmFyIHByZWRpY3RvciA9IHRoaXMuc3RyLmdldEJ5dGUoKTsKICAgICAgICB2YXIgcmF3Qnl0ZXMgPSB0aGlzLnN0ci5nZXRCeXRlcyhyb3dCeXRlcyk7CiAgICAgICAgdGhpcy5lb2YgPSAhcmF3Qnl0ZXMubGVuZ3RoOwoKICAgICAgICBpZiAodGhpcy5lb2YpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBidWZmZXJMZW5ndGggPSB0aGlzLmJ1ZmZlckxlbmd0aDsKICAgICAgICB2YXIgYnVmZmVyID0gdGhpcy5lbnN1cmVCdWZmZXIoYnVmZmVyTGVuZ3RoICsgcm93Qnl0ZXMpOwogICAgICAgIHZhciBwcmV2Um93ID0gYnVmZmVyLnN1YmFycmF5KGJ1ZmZlckxlbmd0aCAtIHJvd0J5dGVzLCBidWZmZXJMZW5ndGgpOwoKICAgICAgICBpZiAocHJldlJvdy5sZW5ndGggPT09IDApIHsKICAgICAgICAgIHByZXZSb3cgPSBuZXcgVWludDhBcnJheShyb3dCeXRlcyk7CiAgICAgICAgfQoKICAgICAgICB2YXIgaSwKICAgICAgICAgIGogPSBidWZmZXJMZW5ndGgsCiAgICAgICAgICB1cCwKICAgICAgICAgIGM7CgogICAgICAgIHN3aXRjaCAocHJlZGljdG9yKSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCByb3dCeXRlczsgKytpKSB7CiAgICAgICAgICAgICAgYnVmZmVyW2orK10gPSByYXdCeXRlc1tpXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcGl4Qnl0ZXM7ICsraSkgewogICAgICAgICAgICAgIGJ1ZmZlcltqKytdID0gcmF3Qnl0ZXNbaV07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvciAoOyBpIDwgcm93Qnl0ZXM7ICsraSkgewogICAgICAgICAgICAgIGJ1ZmZlcltqXSA9IGJ1ZmZlcltqIC0gcGl4Qnl0ZXNdICsgcmF3Qnl0ZXNbaV0gJiAweGZmOwogICAgICAgICAgICAgIGorKzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcm93Qnl0ZXM7ICsraSkgewogICAgICAgICAgICAgIGJ1ZmZlcltqKytdID0gcHJldlJvd1tpXSArIHJhd0J5dGVzW2ldICYgMHhmZjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcGl4Qnl0ZXM7ICsraSkgewogICAgICAgICAgICAgIGJ1ZmZlcltqKytdID0gKHByZXZSb3dbaV0gPj4gMSkgKyByYXdCeXRlc1tpXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9yICg7IGkgPCByb3dCeXRlczsgKytpKSB7CiAgICAgICAgICAgICAgYnVmZmVyW2pdID0gKHByZXZSb3dbaV0gKyBidWZmZXJbaiAtIHBpeEJ5dGVzXSA+PiAxKSArIHJhd0J5dGVzW2ldICYgMHhmZjsKICAgICAgICAgICAgICBqKys7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHBpeEJ5dGVzOyArK2kpIHsKICAgICAgICAgICAgICB1cCA9IHByZXZSb3dbaV07CiAgICAgICAgICAgICAgYyA9IHJhd0J5dGVzW2ldOwogICAgICAgICAgICAgIGJ1ZmZlcltqKytdID0gdXAgKyBjOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmb3IgKDsgaSA8IHJvd0J5dGVzOyArK2kpIHsKICAgICAgICAgICAgICB1cCA9IHByZXZSb3dbaV07CiAgICAgICAgICAgICAgdmFyIHVwTGVmdCA9IHByZXZSb3dbaSAtIHBpeEJ5dGVzXTsKICAgICAgICAgICAgICB2YXIgbGVmdCA9IGJ1ZmZlcltqIC0gcGl4Qnl0ZXNdOwogICAgICAgICAgICAgIHZhciBwID0gbGVmdCArIHVwIC0gdXBMZWZ0OwogICAgICAgICAgICAgIHZhciBwYSA9IHAgLSBsZWZ0OwoKICAgICAgICAgICAgICBpZiAocGEgPCAwKSB7CiAgICAgICAgICAgICAgICBwYSA9IC1wYTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBwYiA9IHAgLSB1cDsKCiAgICAgICAgICAgICAgaWYgKHBiIDwgMCkgewogICAgICAgICAgICAgICAgcGIgPSAtcGI7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgcGMgPSBwIC0gdXBMZWZ0OwoKICAgICAgICAgICAgICBpZiAocGMgPCAwKSB7CiAgICAgICAgICAgICAgICBwYyA9IC1wYzsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGMgPSByYXdCeXRlc1tpXTsKCiAgICAgICAgICAgICAgaWYgKHBhIDw9IHBiICYmIHBhIDw9IHBjKSB7CiAgICAgICAgICAgICAgICBidWZmZXJbaisrXSA9IGxlZnQgKyBjOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocGIgPD0gcGMpIHsKICAgICAgICAgICAgICAgIGJ1ZmZlcltqKytdID0gdXAgKyBjOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBidWZmZXJbaisrXSA9IHVwTGVmdCArIGM7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIlVuc3VwcG9ydGVkIHByZWRpY3RvcjogIi5jb25jYXQocHJlZGljdG9yKSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLmJ1ZmZlckxlbmd0aCArPSByb3dCeXRlczsKICAgICAgfTsKCiAgICAgIHJldHVybiBQcmVkaWN0b3JTdHJlYW07CiAgICB9KCk7CgogICAgZXhwb3J0cy5QcmVkaWN0b3JTdHJlYW0gPSBQcmVkaWN0b3JTdHJlYW07CgogICAgdmFyIERlY3J5cHRTdHJlYW0gPSBmdW5jdGlvbiBEZWNyeXB0U3RyZWFtQ2xvc3VyZSgpIHsKICAgICAgZnVuY3Rpb24gRGVjcnlwdFN0cmVhbShzdHIsIG1heWJlTGVuZ3RoLCBkZWNyeXB0KSB7CiAgICAgICAgdGhpcy5zdHIgPSBzdHI7CiAgICAgICAgdGhpcy5kaWN0ID0gc3RyLmRpY3Q7CiAgICAgICAgdGhpcy5kZWNyeXB0ID0gZGVjcnlwdDsKICAgICAgICB0aGlzLm5leHRDaHVuayA9IG51bGw7CiAgICAgICAgdGhpcy5pbml0aWFsaXplZCA9IGZhbHNlOwogICAgICAgIERlY29kZVN0cmVhbS5jYWxsKHRoaXMsIG1heWJlTGVuZ3RoKTsKICAgICAgfQoKICAgICAgdmFyIGNodW5rU2l6ZSA9IDUxMjsKICAgICAgRGVjcnlwdFN0cmVhbS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKERlY29kZVN0cmVhbS5wcm90b3R5cGUpOwoKICAgICAgRGVjcnlwdFN0cmVhbS5wcm90b3R5cGUucmVhZEJsb2NrID0gZnVuY3Rpb24gRGVjcnlwdFN0cmVhbV9yZWFkQmxvY2soKSB7CiAgICAgICAgdmFyIGNodW5rOwoKICAgICAgICBpZiAodGhpcy5pbml0aWFsaXplZCkgewogICAgICAgICAgY2h1bmsgPSB0aGlzLm5leHRDaHVuazsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY2h1bmsgPSB0aGlzLnN0ci5nZXRCeXRlcyhjaHVua1NpemUpOwogICAgICAgICAgdGhpcy5pbml0aWFsaXplZCA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBpZiAoIWNodW5rIHx8IGNodW5rLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5uZXh0Q2h1bmsgPSB0aGlzLnN0ci5nZXRCeXRlcyhjaHVua1NpemUpOwogICAgICAgIHZhciBoYXNNb3JlRGF0YSA9IHRoaXMubmV4dENodW5rICYmIHRoaXMubmV4dENodW5rLmxlbmd0aCA+IDA7CiAgICAgICAgdmFyIGRlY3J5cHQgPSB0aGlzLmRlY3J5cHQ7CiAgICAgICAgY2h1bmsgPSBkZWNyeXB0KGNodW5rLCAhaGFzTW9yZURhdGEpOwogICAgICAgIHZhciBidWZmZXJMZW5ndGggPSB0aGlzLmJ1ZmZlckxlbmd0aDsKICAgICAgICB2YXIgaSwKICAgICAgICAgIG4gPSBjaHVuay5sZW5ndGg7CiAgICAgICAgdmFyIGJ1ZmZlciA9IHRoaXMuZW5zdXJlQnVmZmVyKGJ1ZmZlckxlbmd0aCArIG4pOwoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICBidWZmZXJbYnVmZmVyTGVuZ3RoKytdID0gY2h1bmtbaV07CiAgICAgICAgfQoKICAgICAgICB0aGlzLmJ1ZmZlckxlbmd0aCA9IGJ1ZmZlckxlbmd0aDsKICAgICAgfTsKCiAgICAgIHJldHVybiBEZWNyeXB0U3RyZWFtOwogICAgfSgpOwoKICAgIGV4cG9ydHMuRGVjcnlwdFN0cmVhbSA9IERlY3J5cHRTdHJlYW07CgogICAgdmFyIEFzY2lpODVTdHJlYW0gPSBmdW5jdGlvbiBBc2NpaTg1U3RyZWFtQ2xvc3VyZSgpIHsKICAgICAgZnVuY3Rpb24gQXNjaWk4NVN0cmVhbShzdHIsIG1heWJlTGVuZ3RoKSB7CiAgICAgICAgdGhpcy5zdHIgPSBzdHI7CiAgICAgICAgdGhpcy5kaWN0ID0gc3RyLmRpY3Q7CiAgICAgICAgdGhpcy5pbnB1dCA9IG5ldyBVaW50OEFycmF5KDUpOwoKICAgICAgICBpZiAobWF5YmVMZW5ndGgpIHsKICAgICAgICAgIG1heWJlTGVuZ3RoID0gMC44ICogbWF5YmVMZW5ndGg7CiAgICAgICAgfQoKICAgICAgICBEZWNvZGVTdHJlYW0uY2FsbCh0aGlzLCBtYXliZUxlbmd0aCk7CiAgICAgIH0KCiAgICAgIEFzY2lpODVTdHJlYW0ucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShEZWNvZGVTdHJlYW0ucHJvdG90eXBlKTsKCiAgICAgIEFzY2lpODVTdHJlYW0ucHJvdG90eXBlLnJlYWRCbG9jayA9IGZ1bmN0aW9uIEFzY2lpODVTdHJlYW1fcmVhZEJsb2NrKCkgewogICAgICAgIHZhciBUSUxEQV9DSEFSID0gMHg3ZTsKICAgICAgICB2YXIgWl9MT1dFUl9DSEFSID0gMHg3YTsKICAgICAgICB2YXIgRU9GID0gLTE7CiAgICAgICAgdmFyIHN0ciA9IHRoaXMuc3RyOwogICAgICAgIHZhciBjID0gc3RyLmdldEJ5dGUoKTsKCiAgICAgICAgd2hpbGUgKCgwLCBfY29yZV91dGlscy5pc1doaXRlU3BhY2UpKGMpKSB7CiAgICAgICAgICBjID0gc3RyLmdldEJ5dGUoKTsKICAgICAgICB9CgogICAgICAgIGlmIChjID09PSBFT0YgfHwgYyA9PT0gVElMREFfQ0hBUikgewogICAgICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIGJ1ZmZlckxlbmd0aCA9IHRoaXMuYnVmZmVyTGVuZ3RoLAogICAgICAgICAgYnVmZmVyOwogICAgICAgIHZhciBpOwoKICAgICAgICBpZiAoYyA9PT0gWl9MT1dFUl9DSEFSKSB7CiAgICAgICAgICBidWZmZXIgPSB0aGlzLmVuc3VyZUJ1ZmZlcihidWZmZXJMZW5ndGggKyA0KTsKCiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgNDsgKytpKSB7CiAgICAgICAgICAgIGJ1ZmZlcltidWZmZXJMZW5ndGggKyBpXSA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5idWZmZXJMZW5ndGggKz0gNDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIGlucHV0ID0gdGhpcy5pbnB1dDsKICAgICAgICAgIGlucHV0WzBdID0gYzsKCiAgICAgICAgICBmb3IgKGkgPSAxOyBpIDwgNTsgKytpKSB7CiAgICAgICAgICAgIGMgPSBzdHIuZ2V0Qnl0ZSgpOwoKICAgICAgICAgICAgd2hpbGUgKCgwLCBfY29yZV91dGlscy5pc1doaXRlU3BhY2UpKGMpKSB7CiAgICAgICAgICAgICAgYyA9IHN0ci5nZXRCeXRlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlucHV0W2ldID0gYzsKCiAgICAgICAgICAgIGlmIChjID09PSBFT0YgfHwgYyA9PT0gVElMREFfQ0hBUikgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgYnVmZmVyID0gdGhpcy5lbnN1cmVCdWZmZXIoYnVmZmVyTGVuZ3RoICsgaSAtIDEpOwogICAgICAgICAgdGhpcy5idWZmZXJMZW5ndGggKz0gaSAtIDE7CgogICAgICAgICAgaWYgKGkgPCA1KSB7CiAgICAgICAgICAgIGZvciAoOyBpIDwgNTsgKytpKSB7CiAgICAgICAgICAgICAgaW5wdXRbaV0gPSAweDIxICsgODQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgdCA9IDA7CgogICAgICAgICAgZm9yIChpID0gMDsgaSA8IDU7ICsraSkgewogICAgICAgICAgICB0ID0gdCAqIDg1ICsgKGlucHV0W2ldIC0gMHgyMSk7CiAgICAgICAgICB9CgogICAgICAgICAgZm9yIChpID0gMzsgaSA+PSAwOyAtLWkpIHsKICAgICAgICAgICAgYnVmZmVyW2J1ZmZlckxlbmd0aCArIGldID0gdCAmIDB4ZmY7CiAgICAgICAgICAgIHQgPj49IDg7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OwoKICAgICAgcmV0dXJuIEFzY2lpODVTdHJlYW07CiAgICB9KCk7CgogICAgZXhwb3J0cy5Bc2NpaTg1U3RyZWFtID0gQXNjaWk4NVN0cmVhbTsKCiAgICB2YXIgQXNjaWlIZXhTdHJlYW0gPSBmdW5jdGlvbiBBc2NpaUhleFN0cmVhbUNsb3N1cmUoKSB7CiAgICAgIGZ1bmN0aW9uIEFzY2lpSGV4U3RyZWFtKHN0ciwgbWF5YmVMZW5ndGgpIHsKICAgICAgICB0aGlzLnN0ciA9IHN0cjsKICAgICAgICB0aGlzLmRpY3QgPSBzdHIuZGljdDsKICAgICAgICB0aGlzLmZpcnN0RGlnaXQgPSAtMTsKCiAgICAgICAgaWYgKG1heWJlTGVuZ3RoKSB7CiAgICAgICAgICBtYXliZUxlbmd0aCA9IDAuNSAqIG1heWJlTGVuZ3RoOwogICAgICAgIH0KCiAgICAgICAgRGVjb2RlU3RyZWFtLmNhbGwodGhpcywgbWF5YmVMZW5ndGgpOwogICAgICB9CgogICAgICBBc2NpaUhleFN0cmVhbS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKERlY29kZVN0cmVhbS5wcm90b3R5cGUpOwoKICAgICAgQXNjaWlIZXhTdHJlYW0ucHJvdG90eXBlLnJlYWRCbG9jayA9IGZ1bmN0aW9uIEFzY2lpSGV4U3RyZWFtX3JlYWRCbG9jaygpIHsKICAgICAgICB2YXIgVVBTVFJFQU1fQkxPQ0tfU0laRSA9IDgwMDA7CiAgICAgICAgdmFyIGJ5dGVzID0gdGhpcy5zdHIuZ2V0Qnl0ZXMoVVBTVFJFQU1fQkxPQ0tfU0laRSk7CgogICAgICAgIGlmICghYnl0ZXMubGVuZ3RoKSB7CiAgICAgICAgICB0aGlzLmVvZiA9IHRydWU7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgbWF4RGVjb2RlTGVuZ3RoID0gYnl0ZXMubGVuZ3RoICsgMSA+PiAxOwogICAgICAgIHZhciBidWZmZXIgPSB0aGlzLmVuc3VyZUJ1ZmZlcih0aGlzLmJ1ZmZlckxlbmd0aCArIG1heERlY29kZUxlbmd0aCk7CiAgICAgICAgdmFyIGJ1ZmZlckxlbmd0aCA9IHRoaXMuYnVmZmVyTGVuZ3RoOwogICAgICAgIHZhciBmaXJzdERpZ2l0ID0gdGhpcy5maXJzdERpZ2l0OwoKICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBieXRlcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICB2YXIgY2ggPSBieXRlc1tpXSwKICAgICAgICAgICAgZGlnaXQ7CgogICAgICAgICAgaWYgKGNoID49IDB4MzAgJiYgY2ggPD0gMHgzOSkgewogICAgICAgICAgICBkaWdpdCA9IGNoICYgMHgwZjsKICAgICAgICAgIH0gZWxzZSBpZiAoY2ggPj0gMHg0MSAmJiBjaCA8PSAweDQ2IHx8IGNoID49IDB4NjEgJiYgY2ggPD0gMHg2NikgewogICAgICAgICAgICBkaWdpdCA9IChjaCAmIDB4MGYpICsgOTsKICAgICAgICAgIH0gZWxzZSBpZiAoY2ggPT09IDB4M2UpIHsKICAgICAgICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChmaXJzdERpZ2l0IDwgMCkgewogICAgICAgICAgICBmaXJzdERpZ2l0ID0gZGlnaXQ7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBidWZmZXJbYnVmZmVyTGVuZ3RoKytdID0gZmlyc3REaWdpdCA8PCA0IHwgZGlnaXQ7CiAgICAgICAgICAgIGZpcnN0RGlnaXQgPSAtMTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChmaXJzdERpZ2l0ID49IDAgJiYgdGhpcy5lb2YpIHsKICAgICAgICAgIGJ1ZmZlcltidWZmZXJMZW5ndGgrK10gPSBmaXJzdERpZ2l0IDw8IDQ7CiAgICAgICAgICBmaXJzdERpZ2l0ID0gLTE7CiAgICAgICAgfQoKICAgICAgICB0aGlzLmZpcnN0RGlnaXQgPSBmaXJzdERpZ2l0OwogICAgICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gYnVmZmVyTGVuZ3RoOwogICAgICB9OwoKICAgICAgcmV0dXJuIEFzY2lpSGV4U3RyZWFtOwogICAgfSgpOwoKICAgIGV4cG9ydHMuQXNjaWlIZXhTdHJlYW0gPSBBc2NpaUhleFN0cmVhbTsKCiAgICB2YXIgUnVuTGVuZ3RoU3RyZWFtID0gZnVuY3Rpb24gUnVuTGVuZ3RoU3RyZWFtQ2xvc3VyZSgpIHsKICAgICAgZnVuY3Rpb24gUnVuTGVuZ3RoU3RyZWFtKHN0ciwgbWF5YmVMZW5ndGgpIHsKICAgICAgICB0aGlzLnN0ciA9IHN0cjsKICAgICAgICB0aGlzLmRpY3QgPSBzdHIuZGljdDsKICAgICAgICBEZWNvZGVTdHJlYW0uY2FsbCh0aGlzLCBtYXliZUxlbmd0aCk7CiAgICAgIH0KCiAgICAgIFJ1bkxlbmd0aFN0cmVhbS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKERlY29kZVN0cmVhbS5wcm90b3R5cGUpOwoKICAgICAgUnVuTGVuZ3RoU3RyZWFtLnByb3RvdHlwZS5yZWFkQmxvY2sgPSBmdW5jdGlvbiBSdW5MZW5ndGhTdHJlYW1fcmVhZEJsb2NrKCkgewogICAgICAgIHZhciByZXBlYXRIZWFkZXIgPSB0aGlzLnN0ci5nZXRCeXRlcygyKTsKCiAgICAgICAgaWYgKCFyZXBlYXRIZWFkZXIgfHwgcmVwZWF0SGVhZGVyLmxlbmd0aCA8IDIgfHwgcmVwZWF0SGVhZGVyWzBdID09PSAxMjgpIHsKICAgICAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBidWZmZXI7CiAgICAgICAgdmFyIGJ1ZmZlckxlbmd0aCA9IHRoaXMuYnVmZmVyTGVuZ3RoOwogICAgICAgIHZhciBuID0gcmVwZWF0SGVhZGVyWzBdOwoKICAgICAgICBpZiAobiA8IDEyOCkgewogICAgICAgICAgYnVmZmVyID0gdGhpcy5lbnN1cmVCdWZmZXIoYnVmZmVyTGVuZ3RoICsgbiArIDEpOwogICAgICAgICAgYnVmZmVyW2J1ZmZlckxlbmd0aCsrXSA9IHJlcGVhdEhlYWRlclsxXTsKCiAgICAgICAgICBpZiAobiA+IDApIHsKICAgICAgICAgICAgdmFyIHNvdXJjZSA9IHRoaXMuc3RyLmdldEJ5dGVzKG4pOwogICAgICAgICAgICBidWZmZXIuc2V0KHNvdXJjZSwgYnVmZmVyTGVuZ3RoKTsKICAgICAgICAgICAgYnVmZmVyTGVuZ3RoICs9IG47CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG4gPSAyNTcgLSBuOwogICAgICAgICAgdmFyIGIgPSByZXBlYXRIZWFkZXJbMV07CiAgICAgICAgICBidWZmZXIgPSB0aGlzLmVuc3VyZUJ1ZmZlcihidWZmZXJMZW5ndGggKyBuICsgMSk7CgogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyBpKyspIHsKICAgICAgICAgICAgYnVmZmVyW2J1ZmZlckxlbmd0aCsrXSA9IGI7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0aGlzLmJ1ZmZlckxlbmd0aCA9IGJ1ZmZlckxlbmd0aDsKICAgICAgfTsKCiAgICAgIHJldHVybiBSdW5MZW5ndGhTdHJlYW07CiAgICB9KCk7CgogICAgZXhwb3J0cy5SdW5MZW5ndGhTdHJlYW0gPSBSdW5MZW5ndGhTdHJlYW07CgogICAgdmFyIExaV1N0cmVhbSA9IGZ1bmN0aW9uIExaV1N0cmVhbUNsb3N1cmUoKSB7CiAgICAgIGZ1bmN0aW9uIExaV1N0cmVhbShzdHIsIG1heWJlTGVuZ3RoLCBlYXJseUNoYW5nZSkgewogICAgICAgIHRoaXMuc3RyID0gc3RyOwogICAgICAgIHRoaXMuZGljdCA9IHN0ci5kaWN0OwogICAgICAgIHRoaXMuY2FjaGVkRGF0YSA9IDA7CiAgICAgICAgdGhpcy5iaXRzQ2FjaGVkID0gMDsKICAgICAgICB2YXIgbWF4THp3RGljdGlvbmFyeVNpemUgPSA0MDk2OwogICAgICAgIHZhciBsendTdGF0ZSA9IHsKICAgICAgICAgIGVhcmx5Q2hhbmdlOiBlYXJseUNoYW5nZSwKICAgICAgICAgIGNvZGVMZW5ndGg6IDksCiAgICAgICAgICBuZXh0Q29kZTogMjU4LAogICAgICAgICAgZGljdGlvbmFyeVZhbHVlczogbmV3IFVpbnQ4QXJyYXkobWF4THp3RGljdGlvbmFyeVNpemUpLAogICAgICAgICAgZGljdGlvbmFyeUxlbmd0aHM6IG5ldyBVaW50MTZBcnJheShtYXhMendEaWN0aW9uYXJ5U2l6ZSksCiAgICAgICAgICBkaWN0aW9uYXJ5UHJldkNvZGVzOiBuZXcgVWludDE2QXJyYXkobWF4THp3RGljdGlvbmFyeVNpemUpLAogICAgICAgICAgY3VycmVudFNlcXVlbmNlOiBuZXcgVWludDhBcnJheShtYXhMendEaWN0aW9uYXJ5U2l6ZSksCiAgICAgICAgICBjdXJyZW50U2VxdWVuY2VMZW5ndGg6IDAKICAgICAgICB9OwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDI1NjsgKytpKSB7CiAgICAgICAgICBsendTdGF0ZS5kaWN0aW9uYXJ5VmFsdWVzW2ldID0gaTsKICAgICAgICAgIGx6d1N0YXRlLmRpY3Rpb25hcnlMZW5ndGhzW2ldID0gMTsKICAgICAgICB9CgogICAgICAgIHRoaXMubHp3U3RhdGUgPSBsendTdGF0ZTsKICAgICAgICBEZWNvZGVTdHJlYW0uY2FsbCh0aGlzLCBtYXliZUxlbmd0aCk7CiAgICAgIH0KCiAgICAgIExaV1N0cmVhbS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKERlY29kZVN0cmVhbS5wcm90b3R5cGUpOwoKICAgICAgTFpXU3RyZWFtLnByb3RvdHlwZS5yZWFkQml0cyA9IGZ1bmN0aW9uIExaV1N0cmVhbV9yZWFkQml0cyhuKSB7CiAgICAgICAgdmFyIGJpdHNDYWNoZWQgPSB0aGlzLmJpdHNDYWNoZWQ7CiAgICAgICAgdmFyIGNhY2hlZERhdGEgPSB0aGlzLmNhY2hlZERhdGE7CgogICAgICAgIHdoaWxlIChiaXRzQ2FjaGVkIDwgbikgewogICAgICAgICAgdmFyIGMgPSB0aGlzLnN0ci5nZXRCeXRlKCk7CgogICAgICAgICAgaWYgKGMgPT09IC0xKSB7CiAgICAgICAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgY2FjaGVkRGF0YSA9IGNhY2hlZERhdGEgPDwgOCB8IGM7CiAgICAgICAgICBiaXRzQ2FjaGVkICs9IDg7CiAgICAgICAgfQoKICAgICAgICB0aGlzLmJpdHNDYWNoZWQgPSBiaXRzQ2FjaGVkIC09IG47CiAgICAgICAgdGhpcy5jYWNoZWREYXRhID0gY2FjaGVkRGF0YTsKICAgICAgICB0aGlzLmxhc3RDb2RlID0gbnVsbDsKICAgICAgICByZXR1cm4gY2FjaGVkRGF0YSA+Pj4gYml0c0NhY2hlZCAmICgxIDw8IG4pIC0gMTsKICAgICAgfTsKCiAgICAgIExaV1N0cmVhbS5wcm90b3R5cGUucmVhZEJsb2NrID0gZnVuY3Rpb24gTFpXU3RyZWFtX3JlYWRCbG9jaygpIHsKICAgICAgICB2YXIgYmxvY2tTaXplID0gNTEyOwogICAgICAgIHZhciBlc3RpbWF0ZWREZWNvZGVkU2l6ZSA9IGJsb2NrU2l6ZSAqIDIsCiAgICAgICAgICBkZWNvZGVkU2l6ZURlbHRhID0gYmxvY2tTaXplOwogICAgICAgIHZhciBpLCBqLCBxOwogICAgICAgIHZhciBsendTdGF0ZSA9IHRoaXMubHp3U3RhdGU7CgogICAgICAgIGlmICghbHp3U3RhdGUpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBlYXJseUNoYW5nZSA9IGx6d1N0YXRlLmVhcmx5Q2hhbmdlOwogICAgICAgIHZhciBuZXh0Q29kZSA9IGx6d1N0YXRlLm5leHRDb2RlOwogICAgICAgIHZhciBkaWN0aW9uYXJ5VmFsdWVzID0gbHp3U3RhdGUuZGljdGlvbmFyeVZhbHVlczsKICAgICAgICB2YXIgZGljdGlvbmFyeUxlbmd0aHMgPSBsendTdGF0ZS5kaWN0aW9uYXJ5TGVuZ3RoczsKICAgICAgICB2YXIgZGljdGlvbmFyeVByZXZDb2RlcyA9IGx6d1N0YXRlLmRpY3Rpb25hcnlQcmV2Q29kZXM7CiAgICAgICAgdmFyIGNvZGVMZW5ndGggPSBsendTdGF0ZS5jb2RlTGVuZ3RoOwogICAgICAgIHZhciBwcmV2Q29kZSA9IGx6d1N0YXRlLnByZXZDb2RlOwogICAgICAgIHZhciBjdXJyZW50U2VxdWVuY2UgPSBsendTdGF0ZS5jdXJyZW50U2VxdWVuY2U7CiAgICAgICAgdmFyIGN1cnJlbnRTZXF1ZW5jZUxlbmd0aCA9IGx6d1N0YXRlLmN1cnJlbnRTZXF1ZW5jZUxlbmd0aDsKICAgICAgICB2YXIgZGVjb2RlZExlbmd0aCA9IDA7CiAgICAgICAgdmFyIGN1cnJlbnRCdWZmZXJMZW5ndGggPSB0aGlzLmJ1ZmZlckxlbmd0aDsKICAgICAgICB2YXIgYnVmZmVyID0gdGhpcy5lbnN1cmVCdWZmZXIodGhpcy5idWZmZXJMZW5ndGggKyBlc3RpbWF0ZWREZWNvZGVkU2l6ZSk7CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBibG9ja1NpemU7IGkrKykgewogICAgICAgICAgdmFyIGNvZGUgPSB0aGlzLnJlYWRCaXRzKGNvZGVMZW5ndGgpOwogICAgICAgICAgdmFyIGhhc1ByZXYgPSBjdXJyZW50U2VxdWVuY2VMZW5ndGggPiAwOwoKICAgICAgICAgIGlmIChjb2RlIDwgMjU2KSB7CiAgICAgICAgICAgIGN1cnJlbnRTZXF1ZW5jZVswXSA9IGNvZGU7CiAgICAgICAgICAgIGN1cnJlbnRTZXF1ZW5jZUxlbmd0aCA9IDE7CiAgICAgICAgICB9IGVsc2UgaWYgKGNvZGUgPj0gMjU4KSB7CiAgICAgICAgICAgIGlmIChjb2RlIDwgbmV4dENvZGUpIHsKICAgICAgICAgICAgICBjdXJyZW50U2VxdWVuY2VMZW5ndGggPSBkaWN0aW9uYXJ5TGVuZ3Roc1tjb2RlXTsKCiAgICAgICAgICAgICAgZm9yIChqID0gY3VycmVudFNlcXVlbmNlTGVuZ3RoIC0gMSwgcSA9IGNvZGU7IGogPj0gMDsgai0tKSB7CiAgICAgICAgICAgICAgICBjdXJyZW50U2VxdWVuY2Vbal0gPSBkaWN0aW9uYXJ5VmFsdWVzW3FdOwogICAgICAgICAgICAgICAgcSA9IGRpY3Rpb25hcnlQcmV2Q29kZXNbcV07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGN1cnJlbnRTZXF1ZW5jZVtjdXJyZW50U2VxdWVuY2VMZW5ndGgrK10gPSBjdXJyZW50U2VxdWVuY2VbMF07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAoY29kZSA9PT0gMjU2KSB7CiAgICAgICAgICAgIGNvZGVMZW5ndGggPSA5OwogICAgICAgICAgICBuZXh0Q29kZSA9IDI1ODsKICAgICAgICAgICAgY3VycmVudFNlcXVlbmNlTGVuZ3RoID0gMDsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmVvZiA9IHRydWU7CiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmx6d1N0YXRlOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoaGFzUHJldikgewogICAgICAgICAgICBkaWN0aW9uYXJ5UHJldkNvZGVzW25leHRDb2RlXSA9IHByZXZDb2RlOwogICAgICAgICAgICBkaWN0aW9uYXJ5TGVuZ3Roc1tuZXh0Q29kZV0gPSBkaWN0aW9uYXJ5TGVuZ3Roc1twcmV2Q29kZV0gKyAxOwogICAgICAgICAgICBkaWN0aW9uYXJ5VmFsdWVzW25leHRDb2RlXSA9IGN1cnJlbnRTZXF1ZW5jZVswXTsKICAgICAgICAgICAgbmV4dENvZGUrKzsKICAgICAgICAgICAgY29kZUxlbmd0aCA9IG5leHRDb2RlICsgZWFybHlDaGFuZ2UgJiBuZXh0Q29kZSArIGVhcmx5Q2hhbmdlIC0gMSA/IGNvZGVMZW5ndGggOiBNYXRoLm1pbihNYXRoLmxvZyhuZXh0Q29kZSArIGVhcmx5Q2hhbmdlKSAvIDAuNjkzMTQ3MTgwNTU5OTQ1MyArIDEsIDEyKSB8IDA7CiAgICAgICAgICB9CgogICAgICAgICAgcHJldkNvZGUgPSBjb2RlOwogICAgICAgICAgZGVjb2RlZExlbmd0aCArPSBjdXJyZW50U2VxdWVuY2VMZW5ndGg7CgogICAgICAgICAgaWYgKGVzdGltYXRlZERlY29kZWRTaXplIDwgZGVjb2RlZExlbmd0aCkgewogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgZXN0aW1hdGVkRGVjb2RlZFNpemUgKz0gZGVjb2RlZFNpemVEZWx0YTsKICAgICAgICAgICAgfSB3aGlsZSAoZXN0aW1hdGVkRGVjb2RlZFNpemUgPCBkZWNvZGVkTGVuZ3RoKTsKCiAgICAgICAgICAgIGJ1ZmZlciA9IHRoaXMuZW5zdXJlQnVmZmVyKHRoaXMuYnVmZmVyTGVuZ3RoICsgZXN0aW1hdGVkRGVjb2RlZFNpemUpOwogICAgICAgICAgfQoKICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBjdXJyZW50U2VxdWVuY2VMZW5ndGg7IGorKykgewogICAgICAgICAgICBidWZmZXJbY3VycmVudEJ1ZmZlckxlbmd0aCsrXSA9IGN1cnJlbnRTZXF1ZW5jZVtqXTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGx6d1N0YXRlLm5leHRDb2RlID0gbmV4dENvZGU7CiAgICAgICAgbHp3U3RhdGUuY29kZUxlbmd0aCA9IGNvZGVMZW5ndGg7CiAgICAgICAgbHp3U3RhdGUucHJldkNvZGUgPSBwcmV2Q29kZTsKICAgICAgICBsendTdGF0ZS5jdXJyZW50U2VxdWVuY2VMZW5ndGggPSBjdXJyZW50U2VxdWVuY2VMZW5ndGg7CiAgICAgICAgdGhpcy5idWZmZXJMZW5ndGggPSBjdXJyZW50QnVmZmVyTGVuZ3RoOwogICAgICB9OwoKICAgICAgcmV0dXJuIExaV1N0cmVhbTsKICAgIH0oKTsKCiAgICBleHBvcnRzLkxaV1N0cmVhbSA9IExaV1N0cmVhbTsKCiAgICB2YXIgTnVsbFN0cmVhbSA9IGZ1bmN0aW9uIE51bGxTdHJlYW1DbG9zdXJlKCkgewogICAgICBmdW5jdGlvbiBOdWxsU3RyZWFtKCkgewogICAgICAgIFN0cmVhbS5jYWxsKHRoaXMsIG5ldyBVaW50OEFycmF5KDApKTsKICAgICAgfQoKICAgICAgTnVsbFN0cmVhbS5wcm90b3R5cGUgPSBTdHJlYW0ucHJvdG90eXBlOwogICAgICByZXR1cm4gTnVsbFN0cmVhbTsKICAgIH0oKTsKCiAgICBleHBvcnRzLk51bGxTdHJlYW0gPSBOdWxsU3RyZWFtOwoKICAgIC8qKiovfSksICgKICAvKiAyMDIgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgoKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgICAgdmFsdWU6IHRydWUKICAgIH0pOwogICAgZXhwb3J0cy5DQ0lUVEZheFN0cmVhbSA9IHZvaWQgMDsKCiAgICB2YXIgX3ByaW1pdGl2ZXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE5NCk7CgogICAgdmFyIF9jY2l0dCA9IF9fd19wZGZqc19yZXF1aXJlX18oMjAzKTsKCiAgICB2YXIgX3N0cmVhbSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjAxKTsKCiAgICB2YXIgQ0NJVFRGYXhTdHJlYW0gPSBmdW5jdGlvbiBDQ0lUVEZheFN0cmVhbUNsb3N1cmUoKSB7CiAgICAgIGZ1bmN0aW9uIENDSVRURmF4U3RyZWFtKHN0ciwgbWF5YmVMZW5ndGgsIHBhcmFtcykgewogICAgICAgIHRoaXMuc3RyID0gc3RyOwogICAgICAgIHRoaXMuZGljdCA9IHN0ci5kaWN0OwoKICAgICAgICBpZiAoISgwLCBfcHJpbWl0aXZlcy5pc0RpY3QpKHBhcmFtcykpIHsKICAgICAgICAgIHBhcmFtcyA9IF9wcmltaXRpdmVzLkRpY3QuZW1wdHk7CiAgICAgICAgfQoKICAgICAgICB2YXIgc291cmNlID0gewogICAgICAgICAgbmV4dDogZnVuY3Rpb24gbmV4dCgpIHsKICAgICAgICAgICAgcmV0dXJuIHN0ci5nZXRCeXRlKCk7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICB0aGlzLmNjaXR0RmF4RGVjb2RlciA9IG5ldyBfY2NpdHQuQ0NJVFRGYXhEZWNvZGVyKHNvdXJjZSwgewogICAgICAgICAgSzogcGFyYW1zLmdldCgiSyIpLAogICAgICAgICAgRW5kT2ZMaW5lOiBwYXJhbXMuZ2V0KCJFbmRPZkxpbmUiKSwKICAgICAgICAgIEVuY29kZWRCeXRlQWxpZ246IHBhcmFtcy5nZXQoIkVuY29kZWRCeXRlQWxpZ24iKSwKICAgICAgICAgIENvbHVtbnM6IHBhcmFtcy5nZXQoIkNvbHVtbnMiKSwKICAgICAgICAgIFJvd3M6IHBhcmFtcy5nZXQoIlJvd3MiKSwKICAgICAgICAgIEVuZE9mQmxvY2s6IHBhcmFtcy5nZXQoIkVuZE9mQmxvY2siKSwKICAgICAgICAgIEJsYWNrSXMxOiBwYXJhbXMuZ2V0KCJCbGFja0lzMSIpCiAgICAgICAgfSk7CgogICAgICAgIF9zdHJlYW0uRGVjb2RlU3RyZWFtLmNhbGwodGhpcywgbWF5YmVMZW5ndGgpOwogICAgICB9CgogICAgICBDQ0lUVEZheFN0cmVhbS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKF9zdHJlYW0uRGVjb2RlU3RyZWFtLnByb3RvdHlwZSk7CgogICAgICBDQ0lUVEZheFN0cmVhbS5wcm90b3R5cGUucmVhZEJsb2NrID0gZnVuY3Rpb24gKCkgewogICAgICAgIHdoaWxlICghdGhpcy5lb2YpIHsKICAgICAgICAgIHZhciBjID0gdGhpcy5jY2l0dEZheERlY29kZXIucmVhZE5leHRDaGFyKCk7CgogICAgICAgICAgaWYgKGMgPT09IC0xKSB7CiAgICAgICAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuZW5zdXJlQnVmZmVyKHRoaXMuYnVmZmVyTGVuZ3RoICsgMSk7CiAgICAgICAgICB0aGlzLmJ1ZmZlclt0aGlzLmJ1ZmZlckxlbmd0aCsrXSA9IGM7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgcmV0dXJuIENDSVRURmF4U3RyZWFtOwogICAgfSgpOwoKICAgIGV4cG9ydHMuQ0NJVFRGYXhTdHJlYW0gPSBDQ0lUVEZheFN0cmVhbTsKCiAgICAvKioqL30pLCAoCiAgLyogMjAzICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgIHZhbHVlOiB0cnVlCiAgICB9KTsKICAgIGV4cG9ydHMuQ0NJVFRGYXhEZWNvZGVyID0gdm9pZCAwOwoKICAgIHZhciBfdXRpbCA9IF9fd19wZGZqc19yZXF1aXJlX18oNSk7CgogICAgdmFyIENDSVRURmF4RGVjb2RlciA9IGZ1bmN0aW9uIENDSVRURmF4RGVjb2RlcigpIHsKICAgICAgdmFyIGNjaXR0RU9MID0gLTI7CiAgICAgIHZhciBjY2l0dEVPRiA9IC0xOwogICAgICB2YXIgdHdvRGltUGFzcyA9IDA7CiAgICAgIHZhciB0d29EaW1Ib3JpeiA9IDE7CiAgICAgIHZhciB0d29EaW1WZXJ0MCA9IDI7CiAgICAgIHZhciB0d29EaW1WZXJ0UjEgPSAzOwogICAgICB2YXIgdHdvRGltVmVydEwxID0gNDsKICAgICAgdmFyIHR3b0RpbVZlcnRSMiA9IDU7CiAgICAgIHZhciB0d29EaW1WZXJ0TDIgPSA2OwogICAgICB2YXIgdHdvRGltVmVydFIzID0gNzsKICAgICAgdmFyIHR3b0RpbVZlcnRMMyA9IDg7CiAgICAgIHZhciB0d29EaW1UYWJsZSA9IFtbLTEsIC0xXSwgWy0xLCAtMV0sIFs3LCB0d29EaW1WZXJ0TDNdLCBbNywgdHdvRGltVmVydFIzXSwgWzYsIHR3b0RpbVZlcnRMMl0sIFs2LCB0d29EaW1WZXJ0TDJdLCBbNiwgdHdvRGltVmVydFIyXSwgWzYsIHR3b0RpbVZlcnRSMl0sIFs0LCB0d29EaW1QYXNzXSwgWzQsIHR3b0RpbVBhc3NdLCBbNCwgdHdvRGltUGFzc10sIFs0LCB0d29EaW1QYXNzXSwgWzQsIHR3b0RpbVBhc3NdLCBbNCwgdHdvRGltUGFzc10sIFs0LCB0d29EaW1QYXNzXSwgWzQsIHR3b0RpbVBhc3NdLCBbMywgdHdvRGltSG9yaXpdLCBbMywgdHdvRGltSG9yaXpdLCBbMywgdHdvRGltSG9yaXpdLCBbMywgdHdvRGltSG9yaXpdLCBbMywgdHdvRGltSG9yaXpdLCBbMywgdHdvRGltSG9yaXpdLCBbMywgdHdvRGltSG9yaXpdLCBbMywgdHdvRGltSG9yaXpdLCBbMywgdHdvRGltSG9yaXpdLCBbMywgdHdvRGltSG9yaXpdLCBbMywgdHdvRGltSG9yaXpdLCBbMywgdHdvRGltSG9yaXpdLCBbMywgdHdvRGltSG9yaXpdLCBbMywgdHdvRGltSG9yaXpdLCBbMywgdHdvRGltSG9yaXpdLCBbMywgdHdvRGltSG9yaXpdLCBbMywgdHdvRGltVmVydEwxXSwgWzMsIHR3b0RpbVZlcnRMMV0sIFszLCB0d29EaW1WZXJ0TDFdLCBbMywgdHdvRGltVmVydEwxXSwgWzMsIHR3b0RpbVZlcnRMMV0sIFszLCB0d29EaW1WZXJ0TDFdLCBbMywgdHdvRGltVmVydEwxXSwgWzMsIHR3b0RpbVZlcnRMMV0sIFszLCB0d29EaW1WZXJ0TDFdLCBbMywgdHdvRGltVmVydEwxXSwgWzMsIHR3b0RpbVZlcnRMMV0sIFszLCB0d29EaW1WZXJ0TDFdLCBbMywgdHdvRGltVmVydEwxXSwgWzMsIHR3b0RpbVZlcnRMMV0sIFszLCB0d29EaW1WZXJ0TDFdLCBbMywgdHdvRGltVmVydEwxXSwgWzMsIHR3b0RpbVZlcnRSMV0sIFszLCB0d29EaW1WZXJ0UjFdLCBbMywgdHdvRGltVmVydFIxXSwgWzMsIHR3b0RpbVZlcnRSMV0sIFszLCB0d29EaW1WZXJ0UjFdLCBbMywgdHdvRGltVmVydFIxXSwgWzMsIHR3b0RpbVZlcnRSMV0sIFszLCB0d29EaW1WZXJ0UjFdLCBbMywgdHdvRGltVmVydFIxXSwgWzMsIHR3b0RpbVZlcnRSMV0sIFszLCB0d29EaW1WZXJ0UjFdLCBbMywgdHdvRGltVmVydFIxXSwgWzMsIHR3b0RpbVZlcnRSMV0sIFszLCB0d29EaW1WZXJ0UjFdLCBbMywgdHdvRGltVmVydFIxXSwgWzMsIHR3b0RpbVZlcnRSMV0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF1dOwogICAgICB2YXIgd2hpdGVUYWJsZTEgPSBbWy0xLCAtMV0sIFsxMiwgY2NpdHRFT0xdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFsxMSwgMTc5Ml0sIFsxMSwgMTc5Ml0sIFsxMiwgMTk4NF0sIFsxMiwgMjA0OF0sIFsxMiwgMjExMl0sIFsxMiwgMjE3Nl0sIFsxMiwgMjI0MF0sIFsxMiwgMjMwNF0sIFsxMSwgMTg1Nl0sIFsxMSwgMTg1Nl0sIFsxMSwgMTkyMF0sIFsxMSwgMTkyMF0sIFsxMiwgMjM2OF0sIFsxMiwgMjQzMl0sIFsxMiwgMjQ5Nl0sIFsxMiwgMjU2MF1dOwogICAgICB2YXIgd2hpdGVUYWJsZTIgPSBbWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFs4LCAyOV0sIFs4LCAyOV0sIFs4LCAzMF0sIFs4LCAzMF0sIFs4LCA0NV0sIFs4LCA0NV0sIFs4LCA0Nl0sIFs4LCA0Nl0sIFs3LCAyMl0sIFs3LCAyMl0sIFs3LCAyMl0sIFs3LCAyMl0sIFs3LCAyM10sIFs3LCAyM10sIFs3LCAyM10sIFs3LCAyM10sIFs4LCA0N10sIFs4LCA0N10sIFs4LCA0OF0sIFs4LCA0OF0sIFs2LCAxM10sIFs2LCAxM10sIFs2LCAxM10sIFs2LCAxM10sIFs2LCAxM10sIFs2LCAxM10sIFs2LCAxM10sIFs2LCAxM10sIFs3LCAyMF0sIFs3LCAyMF0sIFs3LCAyMF0sIFs3LCAyMF0sIFs4LCAzM10sIFs4LCAzM10sIFs4LCAzNF0sIFs4LCAzNF0sIFs4LCAzNV0sIFs4LCAzNV0sIFs4LCAzNl0sIFs4LCAzNl0sIFs4LCAzN10sIFs4LCAzN10sIFs4LCAzOF0sIFs4LCAzOF0sIFs3LCAxOV0sIFs3LCAxOV0sIFs3LCAxOV0sIFs3LCAxOV0sIFs4LCAzMV0sIFs4LCAzMV0sIFs4LCAzMl0sIFs4LCAzMl0sIFs2LCAxXSwgWzYsIDFdLCBbNiwgMV0sIFs2LCAxXSwgWzYsIDFdLCBbNiwgMV0sIFs2LCAxXSwgWzYsIDFdLCBbNiwgMTJdLCBbNiwgMTJdLCBbNiwgMTJdLCBbNiwgMTJdLCBbNiwgMTJdLCBbNiwgMTJdLCBbNiwgMTJdLCBbNiwgMTJdLCBbOCwgNTNdLCBbOCwgNTNdLCBbOCwgNTRdLCBbOCwgNTRdLCBbNywgMjZdLCBbNywgMjZdLCBbNywgMjZdLCBbNywgMjZdLCBbOCwgMzldLCBbOCwgMzldLCBbOCwgNDBdLCBbOCwgNDBdLCBbOCwgNDFdLCBbOCwgNDFdLCBbOCwgNDJdLCBbOCwgNDJdLCBbOCwgNDNdLCBbOCwgNDNdLCBbOCwgNDRdLCBbOCwgNDRdLCBbNywgMjFdLCBbNywgMjFdLCBbNywgMjFdLCBbNywgMjFdLCBbNywgMjhdLCBbNywgMjhdLCBbNywgMjhdLCBbNywgMjhdLCBbOCwgNjFdLCBbOCwgNjFdLCBbOCwgNjJdLCBbOCwgNjJdLCBbOCwgNjNdLCBbOCwgNjNdLCBbOCwgMF0sIFs4LCAwXSwgWzgsIDMyMF0sIFs4LCAzMjBdLCBbOCwgMzg0XSwgWzgsIDM4NF0sIFs1LCAxMF0sIFs1LCAxMF0sIFs1LCAxMF0sIFs1LCAxMF0sIFs1LCAxMF0sIFs1LCAxMF0sIFs1LCAxMF0sIFs1LCAxMF0sIFs1LCAxMF0sIFs1LCAxMF0sIFs1LCAxMF0sIFs1LCAxMF0sIFs1LCAxMF0sIFs1LCAxMF0sIFs1LCAxMF0sIFs1LCAxMF0sIFs1LCAxMV0sIFs1LCAxMV0sIFs1LCAxMV0sIFs1LCAxMV0sIFs1LCAxMV0sIFs1LCAxMV0sIFs1LCAxMV0sIFs1LCAxMV0sIFs1LCAxMV0sIFs1LCAxMV0sIFs1LCAxMV0sIFs1LCAxMV0sIFs1LCAxMV0sIFs1LCAxMV0sIFs1LCAxMV0sIFs1LCAxMV0sIFs3LCAyN10sIFs3LCAyN10sIFs3LCAyN10sIFs3LCAyN10sIFs4LCA1OV0sIFs4LCA1OV0sIFs4LCA2MF0sIFs4LCA2MF0sIFs5LCAxNDcyXSwgWzksIDE1MzZdLCBbOSwgMTYwMF0sIFs5LCAxNzI4XSwgWzcsIDE4XSwgWzcsIDE4XSwgWzcsIDE4XSwgWzcsIDE4XSwgWzcsIDI0XSwgWzcsIDI0XSwgWzcsIDI0XSwgWzcsIDI0XSwgWzgsIDQ5XSwgWzgsIDQ5XSwgWzgsIDUwXSwgWzgsIDUwXSwgWzgsIDUxXSwgWzgsIDUxXSwgWzgsIDUyXSwgWzgsIDUyXSwgWzcsIDI1XSwgWzcsIDI1XSwgWzcsIDI1XSwgWzcsIDI1XSwgWzgsIDU1XSwgWzgsIDU1XSwgWzgsIDU2XSwgWzgsIDU2XSwgWzgsIDU3XSwgWzgsIDU3XSwgWzgsIDU4XSwgWzgsIDU4XSwgWzYsIDE5Ml0sIFs2LCAxOTJdLCBbNiwgMTkyXSwgWzYsIDE5Ml0sIFs2LCAxOTJdLCBbNiwgMTkyXSwgWzYsIDE5Ml0sIFs2LCAxOTJdLCBbNiwgMTY2NF0sIFs2LCAxNjY0XSwgWzYsIDE2NjRdLCBbNiwgMTY2NF0sIFs2LCAxNjY0XSwgWzYsIDE2NjRdLCBbNiwgMTY2NF0sIFs2LCAxNjY0XSwgWzgsIDQ0OF0sIFs4LCA0NDhdLCBbOCwgNTEyXSwgWzgsIDUxMl0sIFs5LCA3MDRdLCBbOSwgNzY4XSwgWzgsIDY0MF0sIFs4LCA2NDBdLCBbOCwgNTc2XSwgWzgsIDU3Nl0sIFs5LCA4MzJdLCBbOSwgODk2XSwgWzksIDk2MF0sIFs5LCAxMDI0XSwgWzksIDEwODhdLCBbOSwgMTE1Ml0sIFs5LCAxMjE2XSwgWzksIDEyODBdLCBbOSwgMTM0NF0sIFs5LCAxNDA4XSwgWzcsIDI1Nl0sIFs3LCAyNTZdLCBbNywgMjU2XSwgWzcsIDI1Nl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzUsIDEyOF0sIFs1LCAxMjhdLCBbNSwgMTI4XSwgWzUsIDEyOF0sIFs1LCAxMjhdLCBbNSwgMTI4XSwgWzUsIDEyOF0sIFs1LCAxMjhdLCBbNSwgMTI4XSwgWzUsIDEyOF0sIFs1LCAxMjhdLCBbNSwgMTI4XSwgWzUsIDEyOF0sIFs1LCAxMjhdLCBbNSwgMTI4XSwgWzUsIDEyOF0sIFs1LCA4XSwgWzUsIDhdLCBbNSwgOF0sIFs1LCA4XSwgWzUsIDhdLCBbNSwgOF0sIFs1LCA4XSwgWzUsIDhdLCBbNSwgOF0sIFs1LCA4XSwgWzUsIDhdLCBbNSwgOF0sIFs1LCA4XSwgWzUsIDhdLCBbNSwgOF0sIFs1LCA4XSwgWzUsIDldLCBbNSwgOV0sIFs1LCA5XSwgWzUsIDldLCBbNSwgOV0sIFs1LCA5XSwgWzUsIDldLCBbNSwgOV0sIFs1LCA5XSwgWzUsIDldLCBbNSwgOV0sIFs1LCA5XSwgWzUsIDldLCBbNSwgOV0sIFs1LCA5XSwgWzUsIDldLCBbNiwgMTZdLCBbNiwgMTZdLCBbNiwgMTZdLCBbNiwgMTZdLCBbNiwgMTZdLCBbNiwgMTZdLCBbNiwgMTZdLCBbNiwgMTZdLCBbNiwgMTddLCBbNiwgMTddLCBbNiwgMTddLCBbNiwgMTddLCBbNiwgMTddLCBbNiwgMTddLCBbNiwgMTddLCBbNiwgMTddLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs2LCAxNF0sIFs2LCAxNF0sIFs2LCAxNF0sIFs2LCAxNF0sIFs2LCAxNF0sIFs2LCAxNF0sIFs2LCAxNF0sIFs2LCAxNF0sIFs2LCAxNV0sIFs2LCAxNV0sIFs2LCAxNV0sIFs2LCAxNV0sIFs2LCAxNV0sIFs2LCAxNV0sIFs2LCAxNV0sIFs2LCAxNV0sIFs1LCA2NF0sIFs1LCA2NF0sIFs1LCA2NF0sIFs1LCA2NF0sIFs1LCA2NF0sIFs1LCA2NF0sIFs1LCA2NF0sIFs1LCA2NF0sIFs1LCA2NF0sIFs1LCA2NF0sIFs1LCA2NF0sIFs1LCA2NF0sIFs1LCA2NF0sIFs1LCA2NF0sIFs1LCA2NF0sIFs1LCA2NF0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XV07CiAgICAgIHZhciBibGFja1RhYmxlMSA9IFtbLTEsIC0xXSwgWy0xLCAtMV0sIFsxMiwgY2NpdHRFT0xdLCBbMTIsIGNjaXR0RU9MXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFsxMSwgMTc5Ml0sIFsxMSwgMTc5Ml0sIFsxMSwgMTc5Ml0sIFsxMSwgMTc5Ml0sIFsxMiwgMTk4NF0sIFsxMiwgMTk4NF0sIFsxMiwgMjA0OF0sIFsxMiwgMjA0OF0sIFsxMiwgMjExMl0sIFsxMiwgMjExMl0sIFsxMiwgMjE3Nl0sIFsxMiwgMjE3Nl0sIFsxMiwgMjI0MF0sIFsxMiwgMjI0MF0sIFsxMiwgMjMwNF0sIFsxMiwgMjMwNF0sIFsxMSwgMTg1Nl0sIFsxMSwgMTg1Nl0sIFsxMSwgMTg1Nl0sIFsxMSwgMTg1Nl0sIFsxMSwgMTkyMF0sIFsxMSwgMTkyMF0sIFsxMSwgMTkyMF0sIFsxMSwgMTkyMF0sIFsxMiwgMjM2OF0sIFsxMiwgMjM2OF0sIFsxMiwgMjQzMl0sIFsxMiwgMjQzMl0sIFsxMiwgMjQ5Nl0sIFsxMiwgMjQ5Nl0sIFsxMiwgMjU2MF0sIFsxMiwgMjU2MF0sIFsxMCwgMThdLCBbMTAsIDE4XSwgWzEwLCAxOF0sIFsxMCwgMThdLCBbMTAsIDE4XSwgWzEwLCAxOF0sIFsxMCwgMThdLCBbMTAsIDE4XSwgWzEyLCA1Ml0sIFsxMiwgNTJdLCBbMTMsIDY0MF0sIFsxMywgNzA0XSwgWzEzLCA3NjhdLCBbMTMsIDgzMl0sIFsxMiwgNTVdLCBbMTIsIDU1XSwgWzEyLCA1Nl0sIFsxMiwgNTZdLCBbMTMsIDEyODBdLCBbMTMsIDEzNDRdLCBbMTMsIDE0MDhdLCBbMTMsIDE0NzJdLCBbMTIsIDU5XSwgWzEyLCA1OV0sIFsxMiwgNjBdLCBbMTIsIDYwXSwgWzEzLCAxNTM2XSwgWzEzLCAxNjAwXSwgWzExLCAyNF0sIFsxMSwgMjRdLCBbMTEsIDI0XSwgWzExLCAyNF0sIFsxMSwgMjVdLCBbMTEsIDI1XSwgWzExLCAyNV0sIFsxMSwgMjVdLCBbMTMsIDE2NjRdLCBbMTMsIDE3MjhdLCBbMTIsIDMyMF0sIFsxMiwgMzIwXSwgWzEyLCAzODRdLCBbMTIsIDM4NF0sIFsxMiwgNDQ4XSwgWzEyLCA0NDhdLCBbMTMsIDUxMl0sIFsxMywgNTc2XSwgWzEyLCA1M10sIFsxMiwgNTNdLCBbMTIsIDU0XSwgWzEyLCA1NF0sIFsxMywgODk2XSwgWzEzLCA5NjBdLCBbMTMsIDEwMjRdLCBbMTMsIDEwODhdLCBbMTMsIDExNTJdLCBbMTMsIDEyMTZdLCBbMTAsIDY0XSwgWzEwLCA2NF0sIFsxMCwgNjRdLCBbMTAsIDY0XSwgWzEwLCA2NF0sIFsxMCwgNjRdLCBbMTAsIDY0XSwgWzEwLCA2NF1dOwogICAgICB2YXIgYmxhY2tUYWJsZTIgPSBbWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzExLCAyM10sIFsxMSwgMjNdLCBbMTIsIDUwXSwgWzEyLCA1MV0sIFsxMiwgNDRdLCBbMTIsIDQ1XSwgWzEyLCA0Nl0sIFsxMiwgNDddLCBbMTIsIDU3XSwgWzEyLCA1OF0sIFsxMiwgNjFdLCBbMTIsIDI1Nl0sIFsxMCwgMTZdLCBbMTAsIDE2XSwgWzEwLCAxNl0sIFsxMCwgMTZdLCBbMTAsIDE3XSwgWzEwLCAxN10sIFsxMCwgMTddLCBbMTAsIDE3XSwgWzEyLCA0OF0sIFsxMiwgNDldLCBbMTIsIDYyXSwgWzEyLCA2M10sIFsxMiwgMzBdLCBbMTIsIDMxXSwgWzEyLCAzMl0sIFsxMiwgMzNdLCBbMTIsIDQwXSwgWzEyLCA0MV0sIFsxMSwgMjJdLCBbMTEsIDIyXSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzksIDE1XSwgWzksIDE1XSwgWzksIDE1XSwgWzksIDE1XSwgWzksIDE1XSwgWzksIDE1XSwgWzksIDE1XSwgWzksIDE1XSwgWzEyLCAxMjhdLCBbMTIsIDE5Ml0sIFsxMiwgMjZdLCBbMTIsIDI3XSwgWzEyLCAyOF0sIFsxMiwgMjldLCBbMTEsIDE5XSwgWzExLCAxOV0sIFsxMSwgMjBdLCBbMTEsIDIwXSwgWzEyLCAzNF0sIFsxMiwgMzVdLCBbMTIsIDM2XSwgWzEyLCAzN10sIFsxMiwgMzhdLCBbMTIsIDM5XSwgWzExLCAyMV0sIFsxMSwgMjFdLCBbMTIsIDQyXSwgWzEyLCA0M10sIFsxMCwgMF0sIFsxMCwgMF0sIFsxMCwgMF0sIFsxMCwgMF0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl1dOwogICAgICB2YXIgYmxhY2tUYWJsZTMgPSBbWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFs2LCA5XSwgWzYsIDhdLCBbNSwgN10sIFs1LCA3XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFszLCAxXSwgWzMsIDFdLCBbMywgMV0sIFszLCAxXSwgWzMsIDFdLCBbMywgMV0sIFszLCAxXSwgWzMsIDFdLCBbMywgNF0sIFszLCA0XSwgWzMsIDRdLCBbMywgNF0sIFszLCA0XSwgWzMsIDRdLCBbMywgNF0sIFszLCA0XSwgWzIsIDNdLCBbMiwgM10sIFsyLCAzXSwgWzIsIDNdLCBbMiwgM10sIFsyLCAzXSwgWzIsIDNdLCBbMiwgM10sIFsyLCAzXSwgWzIsIDNdLCBbMiwgM10sIFsyLCAzXSwgWzIsIDNdLCBbMiwgM10sIFsyLCAzXSwgWzIsIDNdLCBbMiwgMl0sIFsyLCAyXSwgWzIsIDJdLCBbMiwgMl0sIFsyLCAyXSwgWzIsIDJdLCBbMiwgMl0sIFsyLCAyXSwgWzIsIDJdLCBbMiwgMl0sIFsyLCAyXSwgWzIsIDJdLCBbMiwgMl0sIFsyLCAyXSwgWzIsIDJdLCBbMiwgMl1dOwoKICAgICAgZnVuY3Rpb24gQ0NJVFRGYXhEZWNvZGVyKHNvdXJjZSkgewogICAgICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTsKCiAgICAgICAgaWYgKCFzb3VyY2UgfHwgdHlwZW9mIHNvdXJjZS5uZXh0ICE9PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NDSVRURmF4RGVjb2RlciAtIGludmFsaWQgInNvdXJjZSIgcGFyYW1ldGVyLicpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7CiAgICAgICAgdGhpcy5lb2YgPSBmYWxzZTsKICAgICAgICB0aGlzLmVuY29kaW5nID0gb3B0aW9uc1siSyJdIHx8IDA7CiAgICAgICAgdGhpcy5lb2xpbmUgPSBvcHRpb25zWyJFbmRPZkxpbmUiXSB8fCBmYWxzZTsKICAgICAgICB0aGlzLmJ5dGVBbGlnbiA9IG9wdGlvbnNbIkVuY29kZWRCeXRlQWxpZ24iXSB8fCBmYWxzZTsKICAgICAgICB0aGlzLmNvbHVtbnMgPSBvcHRpb25zWyJDb2x1bW5zIl0gfHwgMTcyODsKICAgICAgICB0aGlzLnJvd3MgPSBvcHRpb25zWyJSb3dzIl0gfHwgMDsKICAgICAgICB2YXIgZW9ibG9jayA9IG9wdGlvbnNbIkVuZE9mQmxvY2siXTsKCiAgICAgICAgaWYgKGVvYmxvY2sgPT09IG51bGwgfHwgZW9ibG9jayA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBlb2Jsb2NrID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIHRoaXMuZW9ibG9jayA9IGVvYmxvY2s7CiAgICAgICAgdGhpcy5ibGFjayA9IG9wdGlvbnNbIkJsYWNrSXMxIl0gfHwgZmFsc2U7CiAgICAgICAgdGhpcy5jb2RpbmdMaW5lID0gbmV3IFVpbnQzMkFycmF5KHRoaXMuY29sdW1ucyArIDEpOwogICAgICAgIHRoaXMucmVmTGluZSA9IG5ldyBVaW50MzJBcnJheSh0aGlzLmNvbHVtbnMgKyAyKTsKICAgICAgICB0aGlzLmNvZGluZ0xpbmVbMF0gPSB0aGlzLmNvbHVtbnM7CiAgICAgICAgdGhpcy5jb2RpbmdQb3MgPSAwOwogICAgICAgIHRoaXMucm93ID0gMDsKICAgICAgICB0aGlzLm5leHRMaW5lMkQgPSB0aGlzLmVuY29kaW5nIDwgMDsKICAgICAgICB0aGlzLmlucHV0Qml0cyA9IDA7CiAgICAgICAgdGhpcy5pbnB1dEJ1ZiA9IDA7CiAgICAgICAgdGhpcy5vdXRwdXRCaXRzID0gMDsKICAgICAgICB0aGlzLnJvd3NEb25lID0gZmFsc2U7CiAgICAgICAgdmFyIGNvZGUxOwoKICAgICAgICB3aGlsZSAoKGNvZGUxID0gdGhpcy5fbG9va0JpdHMoMTIpKSA9PT0gMCkgewogICAgICAgICAgdGhpcy5fZWF0Qml0cygxKTsKICAgICAgICB9CgogICAgICAgIGlmIChjb2RlMSA9PT0gMSkgewogICAgICAgICAgdGhpcy5fZWF0Qml0cygxMik7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5lbmNvZGluZyA+IDApIHsKICAgICAgICAgIHRoaXMubmV4dExpbmUyRCA9ICF0aGlzLl9sb29rQml0cygxKTsKCiAgICAgICAgICB0aGlzLl9lYXRCaXRzKDEpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgQ0NJVFRGYXhEZWNvZGVyLnByb3RvdHlwZSA9IHsKICAgICAgICByZWFkTmV4dENoYXI6IGZ1bmN0aW9uIHJlYWROZXh0Q2hhcigpIHsKICAgICAgICAgIGlmICh0aGlzLmVvZikgewogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHJlZkxpbmUgPSB0aGlzLnJlZkxpbmU7CiAgICAgICAgICB2YXIgY29kaW5nTGluZSA9IHRoaXMuY29kaW5nTGluZTsKICAgICAgICAgIHZhciBjb2x1bW5zID0gdGhpcy5jb2x1bW5zOwogICAgICAgICAgdmFyIHJlZlBvcywgYmxhY2tQaXhlbHMsIGJpdHMsIGk7CgogICAgICAgICAgaWYgKHRoaXMub3V0cHV0Qml0cyA9PT0gMCkgewogICAgICAgICAgICBpZiAodGhpcy5yb3dzRG9uZSkgewogICAgICAgICAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMuZW9mKSB7CiAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLmVyciA9IGZhbHNlOwogICAgICAgICAgICB2YXIgY29kZTEsIGNvZGUyLCBjb2RlMzsKCiAgICAgICAgICAgIGlmICh0aGlzLm5leHRMaW5lMkQpIHsKICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBjb2RpbmdMaW5lW2ldIDwgY29sdW1uczsgKytpKSB7CiAgICAgICAgICAgICAgICByZWZMaW5lW2ldID0gY29kaW5nTGluZVtpXTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJlZkxpbmVbaSsrXSA9IGNvbHVtbnM7CiAgICAgICAgICAgICAgcmVmTGluZVtpXSA9IGNvbHVtbnM7CiAgICAgICAgICAgICAgY29kaW5nTGluZVswXSA9IDA7CiAgICAgICAgICAgICAgdGhpcy5jb2RpbmdQb3MgPSAwOwogICAgICAgICAgICAgIHJlZlBvcyA9IDA7CiAgICAgICAgICAgICAgYmxhY2tQaXhlbHMgPSAwOwoKICAgICAgICAgICAgICB3aGlsZSAoY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gPCBjb2x1bW5zKSB7CiAgICAgICAgICAgICAgICBjb2RlMSA9IHRoaXMuX2dldFR3b0RpbUNvZGUoKTsKCiAgICAgICAgICAgICAgICBzd2l0Y2ggKGNvZGUxKSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgdHdvRGltUGFzczoKICAgICAgICAgICAgICAgICAgICB0aGlzLl9hZGRQaXhlbHMocmVmTGluZVtyZWZQb3MgKyAxXSwgYmxhY2tQaXhlbHMpOwoKICAgICAgICAgICAgICAgICAgICBpZiAocmVmTGluZVtyZWZQb3MgKyAxXSA8IGNvbHVtbnMpIHsKICAgICAgICAgICAgICAgICAgICAgIHJlZlBvcyArPSAyOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlIHR3b0RpbUhvcml6OgogICAgICAgICAgICAgICAgICAgIGNvZGUxID0gY29kZTIgPSAwOwoKICAgICAgICAgICAgICAgICAgICBpZiAoYmxhY2tQaXhlbHMpIHsKICAgICAgICAgICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29kZTEgKz0gY29kZTMgPSB0aGlzLl9nZXRCbGFja0NvZGUoKTsKICAgICAgICAgICAgICAgICAgICAgIH0gd2hpbGUgKGNvZGUzID49IDY0KTsKCiAgICAgICAgICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUyICs9IGNvZGUzID0gdGhpcy5fZ2V0V2hpdGVDb2RlKCk7CiAgICAgICAgICAgICAgICAgICAgICB9IHdoaWxlIChjb2RlMyA+PSA2NCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29kZTEgKz0gY29kZTMgPSB0aGlzLl9nZXRXaGl0ZUNvZGUoKTsKICAgICAgICAgICAgICAgICAgICAgIH0gd2hpbGUgKGNvZGUzID49IDY0KTsKCiAgICAgICAgICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUyICs9IGNvZGUzID0gdGhpcy5fZ2V0QmxhY2tDb2RlKCk7CiAgICAgICAgICAgICAgICAgICAgICB9IHdoaWxlIChjb2RlMyA+PSA2NCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICB0aGlzLl9hZGRQaXhlbHMoY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gKyBjb2RlMSwgYmxhY2tQaXhlbHMpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gPCBjb2x1bW5zKSB7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9hZGRQaXhlbHMoY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gKyBjb2RlMiwgYmxhY2tQaXhlbHMgXiAxKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHdoaWxlIChyZWZMaW5lW3JlZlBvc10gPD0gY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gJiYgcmVmTGluZVtyZWZQb3NdIDwgY29sdW1ucykgewogICAgICAgICAgICAgICAgICAgICAgcmVmUG9zICs9IDI7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgdHdvRGltVmVydFIzOgogICAgICAgICAgICAgICAgICAgIHRoaXMuX2FkZFBpeGVscyhyZWZMaW5lW3JlZlBvc10gKyAzLCBibGFja1BpeGVscyk7CgogICAgICAgICAgICAgICAgICAgIGJsYWNrUGl4ZWxzIF49IDE7CgogICAgICAgICAgICAgICAgICAgIGlmIChjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSA8IGNvbHVtbnMpIHsKICAgICAgICAgICAgICAgICAgICAgICsrcmVmUG9zOwoKICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChyZWZMaW5lW3JlZlBvc10gPD0gY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gJiYgcmVmTGluZVtyZWZQb3NdIDwgY29sdW1ucykgewogICAgICAgICAgICAgICAgICAgICAgICByZWZQb3MgKz0gMjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgY2FzZSB0d29EaW1WZXJ0UjI6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYWRkUGl4ZWxzKHJlZkxpbmVbcmVmUG9zXSArIDIsIGJsYWNrUGl4ZWxzKTsKCiAgICAgICAgICAgICAgICAgICAgYmxhY2tQaXhlbHMgXj0gMTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdIDwgY29sdW1ucykgewogICAgICAgICAgICAgICAgICAgICAgKytyZWZQb3M7CgogICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHJlZkxpbmVbcmVmUG9zXSA8PSBjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSAmJiByZWZMaW5lW3JlZlBvc10gPCBjb2x1bW5zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlZlBvcyArPSAyOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlIHR3b0RpbVZlcnRSMToKICAgICAgICAgICAgICAgICAgICB0aGlzLl9hZGRQaXhlbHMocmVmTGluZVtyZWZQb3NdICsgMSwgYmxhY2tQaXhlbHMpOwoKICAgICAgICAgICAgICAgICAgICBibGFja1BpeGVscyBePSAxOwoKICAgICAgICAgICAgICAgICAgICBpZiAoY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gPCBjb2x1bW5zKSB7CiAgICAgICAgICAgICAgICAgICAgICArK3JlZlBvczsKCiAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAocmVmTGluZVtyZWZQb3NdIDw9IGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdICYmIHJlZkxpbmVbcmVmUG9zXSA8IGNvbHVtbnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVmUG9zICs9IDI7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgdHdvRGltVmVydDA6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYWRkUGl4ZWxzKHJlZkxpbmVbcmVmUG9zXSwgYmxhY2tQaXhlbHMpOwoKICAgICAgICAgICAgICAgICAgICBibGFja1BpeGVscyBePSAxOwoKICAgICAgICAgICAgICAgICAgICBpZiAoY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gPCBjb2x1bW5zKSB7CiAgICAgICAgICAgICAgICAgICAgICArK3JlZlBvczsKCiAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAocmVmTGluZVtyZWZQb3NdIDw9IGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdICYmIHJlZkxpbmVbcmVmUG9zXSA8IGNvbHVtbnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVmUG9zICs9IDI7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgdHdvRGltVmVydEwzOgogICAgICAgICAgICAgICAgICAgIHRoaXMuX2FkZFBpeGVsc05lZyhyZWZMaW5lW3JlZlBvc10gLSAzLCBibGFja1BpeGVscyk7CgogICAgICAgICAgICAgICAgICAgIGJsYWNrUGl4ZWxzIF49IDE7CgogICAgICAgICAgICAgICAgICAgIGlmIChjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSA8IGNvbHVtbnMpIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChyZWZQb3MgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC0tcmVmUG9zOwogICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgKytyZWZQb3M7CiAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHJlZkxpbmVbcmVmUG9zXSA8PSBjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSAmJiByZWZMaW5lW3JlZlBvc10gPCBjb2x1bW5zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlZlBvcyArPSAyOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlIHR3b0RpbVZlcnRMMjoKICAgICAgICAgICAgICAgICAgICB0aGlzLl9hZGRQaXhlbHNOZWcocmVmTGluZVtyZWZQb3NdIC0gMiwgYmxhY2tQaXhlbHMpOwoKICAgICAgICAgICAgICAgICAgICBibGFja1BpeGVscyBePSAxOwoKICAgICAgICAgICAgICAgICAgICBpZiAoY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gPCBjb2x1bW5zKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAocmVmUG9zID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAtLXJlZlBvczsKICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICsrcmVmUG9zOwogICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChyZWZMaW5lW3JlZlBvc10gPD0gY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gJiYgcmVmTGluZVtyZWZQb3NdIDwgY29sdW1ucykgewogICAgICAgICAgICAgICAgICAgICAgICByZWZQb3MgKz0gMjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgY2FzZSB0d29EaW1WZXJ0TDE6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYWRkUGl4ZWxzTmVnKHJlZkxpbmVbcmVmUG9zXSAtIDEsIGJsYWNrUGl4ZWxzKTsKCiAgICAgICAgICAgICAgICAgICAgYmxhY2tQaXhlbHMgXj0gMTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdIDwgY29sdW1ucykgewogICAgICAgICAgICAgICAgICAgICAgaWYgKHJlZlBvcyA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgLS1yZWZQb3M7CiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICArK3JlZlBvczsKICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAocmVmTGluZVtyZWZQb3NdIDw9IGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdICYmIHJlZkxpbmVbcmVmUG9zXSA8IGNvbHVtbnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVmUG9zICs9IDI7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgY2NpdHRFT0Y6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYWRkUGl4ZWxzKGNvbHVtbnMsIDApOwoKICAgICAgICAgICAgICAgICAgICB0aGlzLmVvZiA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICgwLCBfdXRpbC5pbmZvKSgiYmFkIDJkIGNvZGUiKTsKCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYWRkUGl4ZWxzKGNvbHVtbnMsIDApOwoKICAgICAgICAgICAgICAgICAgICB0aGlzLmVyciA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGNvZGluZ0xpbmVbMF0gPSAwOwogICAgICAgICAgICAgIHRoaXMuY29kaW5nUG9zID0gMDsKICAgICAgICAgICAgICBibGFja1BpeGVscyA9IDA7CgogICAgICAgICAgICAgIHdoaWxlIChjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSA8IGNvbHVtbnMpIHsKICAgICAgICAgICAgICAgIGNvZGUxID0gMDsKCiAgICAgICAgICAgICAgICBpZiAoYmxhY2tQaXhlbHMpIHsKICAgICAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgICAgIGNvZGUxICs9IGNvZGUzID0gdGhpcy5fZ2V0QmxhY2tDb2RlKCk7CiAgICAgICAgICAgICAgICAgIH0gd2hpbGUgKGNvZGUzID49IDY0KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgICAgICBjb2RlMSArPSBjb2RlMyA9IHRoaXMuX2dldFdoaXRlQ29kZSgpOwogICAgICAgICAgICAgICAgICB9IHdoaWxlIChjb2RlMyA+PSA2NCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy5fYWRkUGl4ZWxzKGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdICsgY29kZTEsIGJsYWNrUGl4ZWxzKTsKCiAgICAgICAgICAgICAgICBibGFja1BpeGVscyBePSAxOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGdvdEVPTCA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKHRoaXMuYnl0ZUFsaWduKSB7CiAgICAgICAgICAgICAgdGhpcy5pbnB1dEJpdHMgJj0gfjc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghdGhpcy5lb2Jsb2NrICYmIHRoaXMucm93ID09PSB0aGlzLnJvd3MgLSAxKSB7CiAgICAgICAgICAgICAgdGhpcy5yb3dzRG9uZSA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgY29kZTEgPSB0aGlzLl9sb29rQml0cygxMik7CgogICAgICAgICAgICAgIGlmICh0aGlzLmVvbGluZSkgewogICAgICAgICAgICAgICAgd2hpbGUgKGNvZGUxICE9PSBjY2l0dEVPRiAmJiBjb2RlMSAhPT0gMSkgewogICAgICAgICAgICAgICAgICB0aGlzLl9lYXRCaXRzKDEpOwoKICAgICAgICAgICAgICAgICAgY29kZTEgPSB0aGlzLl9sb29rQml0cygxMik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHdoaWxlIChjb2RlMSA9PT0gMCkgewogICAgICAgICAgICAgICAgICB0aGlzLl9lYXRCaXRzKDEpOwoKICAgICAgICAgICAgICAgICAgY29kZTEgPSB0aGlzLl9sb29rQml0cygxMik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoY29kZTEgPT09IDEpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2VhdEJpdHMoMTIpOwoKICAgICAgICAgICAgICAgIGdvdEVPTCA9IHRydWU7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChjb2RlMSA9PT0gY2NpdHRFT0YpIHsKICAgICAgICAgICAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghdGhpcy5lb2YgJiYgdGhpcy5lbmNvZGluZyA+IDAgJiYgIXRoaXMucm93c0RvbmUpIHsKICAgICAgICAgICAgICB0aGlzLm5leHRMaW5lMkQgPSAhdGhpcy5fbG9va0JpdHMoMSk7CgogICAgICAgICAgICAgIHRoaXMuX2VhdEJpdHMoMSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0aGlzLmVvYmxvY2sgJiYgZ290RU9MICYmIHRoaXMuYnl0ZUFsaWduKSB7CiAgICAgICAgICAgICAgY29kZTEgPSB0aGlzLl9sb29rQml0cygxMik7CgogICAgICAgICAgICAgIGlmIChjb2RlMSA9PT0gMSkgewogICAgICAgICAgICAgICAgdGhpcy5fZWF0Qml0cygxMik7CgogICAgICAgICAgICAgICAgaWYgKHRoaXMuZW5jb2RpbmcgPiAwKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuX2xvb2tCaXRzKDEpOwoKICAgICAgICAgICAgICAgICAgdGhpcy5fZWF0Qml0cygxKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAodGhpcy5lbmNvZGluZyA+PSAwKSB7CiAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCA0OyArK2kpIHsKICAgICAgICAgICAgICAgICAgICBjb2RlMSA9IHRoaXMuX2xvb2tCaXRzKDEyKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGNvZGUxICE9PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAoMCwgX3V0aWwuaW5mbykoImJhZCBydGMgY29kZTogIiArIGNvZGUxKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHRoaXMuX2VhdEJpdHMoMTIpOwoKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5lbmNvZGluZyA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2xvb2tCaXRzKDEpOwoKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2VhdEJpdHMoMSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmVyciAmJiB0aGlzLmVvbGluZSkgewogICAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgICAgICBjb2RlMSA9IHRoaXMuX2xvb2tCaXRzKDEzKTsKCiAgICAgICAgICAgICAgICBpZiAoY29kZTEgPT09IGNjaXR0RU9GKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChjb2RlMSA+PiAxID09PSAxKSB7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuX2VhdEJpdHMoMSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB0aGlzLl9lYXRCaXRzKDEyKTsKCiAgICAgICAgICAgICAgaWYgKHRoaXMuZW5jb2RpbmcgPiAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9lYXRCaXRzKDEpOwoKICAgICAgICAgICAgICAgIHRoaXMubmV4dExpbmUyRCA9ICEoY29kZTEgJiAxKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChjb2RpbmdMaW5lWzBdID4gMCkgewogICAgICAgICAgICAgIHRoaXMub3V0cHV0Qml0cyA9IGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3MgPSAwXTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLm91dHB1dEJpdHMgPSBjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zID0gMV07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMucm93Kys7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGM7CgogICAgICAgICAgaWYgKHRoaXMub3V0cHV0Qml0cyA+PSA4KSB7CiAgICAgICAgICAgIGMgPSB0aGlzLmNvZGluZ1BvcyAmIDEgPyAwIDogMHhmZjsKICAgICAgICAgICAgdGhpcy5vdXRwdXRCaXRzIC09IDg7CgogICAgICAgICAgICBpZiAodGhpcy5vdXRwdXRCaXRzID09PSAwICYmIGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdIDwgY29sdW1ucykgewogICAgICAgICAgICAgIHRoaXMuY29kaW5nUG9zKys7CiAgICAgICAgICAgICAgdGhpcy5vdXRwdXRCaXRzID0gY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gLSBjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zIC0gMV07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGJpdHMgPSA4OwogICAgICAgICAgICBjID0gMDsKCiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICBpZiAodGhpcy5vdXRwdXRCaXRzID4gYml0cykgewogICAgICAgICAgICAgICAgYyA8PD0gYml0czsKCiAgICAgICAgICAgICAgICBpZiAoISh0aGlzLmNvZGluZ1BvcyAmIDEpKSB7CiAgICAgICAgICAgICAgICAgIGMgfD0gMHhmZiA+PiA4IC0gYml0czsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLm91dHB1dEJpdHMgLT0gYml0czsKICAgICAgICAgICAgICAgIGJpdHMgPSAwOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjIDw8PSB0aGlzLm91dHB1dEJpdHM7CgogICAgICAgICAgICAgICAgaWYgKCEodGhpcy5jb2RpbmdQb3MgJiAxKSkgewogICAgICAgICAgICAgICAgICBjIHw9IDB4ZmYgPj4gOCAtIHRoaXMub3V0cHV0Qml0czsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBiaXRzIC09IHRoaXMub3V0cHV0Qml0czsKICAgICAgICAgICAgICAgIHRoaXMub3V0cHV0Qml0cyA9IDA7CgogICAgICAgICAgICAgICAgaWYgKGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdIDwgY29sdW1ucykgewogICAgICAgICAgICAgICAgICB0aGlzLmNvZGluZ1BvcysrOwogICAgICAgICAgICAgICAgICB0aGlzLm91dHB1dEJpdHMgPSBjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSAtIGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3MgLSAxXTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYml0cyA+IDApIHsKICAgICAgICAgICAgICAgICAgYyA8PD0gYml0czsKICAgICAgICAgICAgICAgICAgYml0cyA9IDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IHdoaWxlIChiaXRzKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodGhpcy5ibGFjaykgewogICAgICAgICAgICBjIF49IDB4ZmY7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGM7CiAgICAgICAgfSwKICAgICAgICBfYWRkUGl4ZWxzOiBmdW5jdGlvbiBfYWRkUGl4ZWxzKGExLCBibGFja1BpeGVscykgewogICAgICAgICAgdmFyIGNvZGluZ0xpbmUgPSB0aGlzLmNvZGluZ0xpbmU7CiAgICAgICAgICB2YXIgY29kaW5nUG9zID0gdGhpcy5jb2RpbmdQb3M7CgogICAgICAgICAgaWYgKGExID4gY29kaW5nTGluZVtjb2RpbmdQb3NdKSB7CiAgICAgICAgICAgIGlmIChhMSA+IHRoaXMuY29sdW1ucykgewogICAgICAgICAgICAgICgwLCBfdXRpbC5pbmZvKSgicm93IGlzIHdyb25nIGxlbmd0aCIpOwogICAgICAgICAgICAgIHRoaXMuZXJyID0gdHJ1ZTsKICAgICAgICAgICAgICBhMSA9IHRoaXMuY29sdW1uczsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGNvZGluZ1BvcyAmIDEgXiBibGFja1BpeGVscykgewogICAgICAgICAgICAgICsrY29kaW5nUG9zOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb2RpbmdMaW5lW2NvZGluZ1Bvc10gPSBhMTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLmNvZGluZ1BvcyA9IGNvZGluZ1BvczsKICAgICAgICB9LAogICAgICAgIF9hZGRQaXhlbHNOZWc6IGZ1bmN0aW9uIF9hZGRQaXhlbHNOZWcoYTEsIGJsYWNrUGl4ZWxzKSB7CiAgICAgICAgICB2YXIgY29kaW5nTGluZSA9IHRoaXMuY29kaW5nTGluZTsKICAgICAgICAgIHZhciBjb2RpbmdQb3MgPSB0aGlzLmNvZGluZ1BvczsKCiAgICAgICAgICBpZiAoYTEgPiBjb2RpbmdMaW5lW2NvZGluZ1Bvc10pIHsKICAgICAgICAgICAgaWYgKGExID4gdGhpcy5jb2x1bW5zKSB7CiAgICAgICAgICAgICAgKDAsIF91dGlsLmluZm8pKCJyb3cgaXMgd3JvbmcgbGVuZ3RoIik7CiAgICAgICAgICAgICAgdGhpcy5lcnIgPSB0cnVlOwogICAgICAgICAgICAgIGExID0gdGhpcy5jb2x1bW5zOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoY29kaW5nUG9zICYgMSBeIGJsYWNrUGl4ZWxzKSB7CiAgICAgICAgICAgICAgKytjb2RpbmdQb3M7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvZGluZ0xpbmVbY29kaW5nUG9zXSA9IGExOwogICAgICAgICAgfSBlbHNlIGlmIChhMSA8IGNvZGluZ0xpbmVbY29kaW5nUG9zXSkgewogICAgICAgICAgICBpZiAoYTEgPCAwKSB7CiAgICAgICAgICAgICAgKDAsIF91dGlsLmluZm8pKCJpbnZhbGlkIGNvZGUiKTsKICAgICAgICAgICAgICB0aGlzLmVyciA9IHRydWU7CiAgICAgICAgICAgICAgYTEgPSAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICB3aGlsZSAoY29kaW5nUG9zID4gMCAmJiBhMSA8IGNvZGluZ0xpbmVbY29kaW5nUG9zIC0gMV0pIHsKICAgICAgICAgICAgICAtLWNvZGluZ1BvczsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29kaW5nTGluZVtjb2RpbmdQb3NdID0gYTE7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5jb2RpbmdQb3MgPSBjb2RpbmdQb3M7CiAgICAgICAgfSwKICAgICAgICBfZmluZFRhYmxlQ29kZTogZnVuY3Rpb24gX2ZpbmRUYWJsZUNvZGUoc3RhcnQsIGVuZCwgdGFibGUsIGxpbWl0KSB7CiAgICAgICAgICB2YXIgbGltaXRWYWx1ZSA9IGxpbWl0IHx8IDA7CgogICAgICAgICAgZm9yICh2YXIgaSA9IHN0YXJ0OyBpIDw9IGVuZDsgKytpKSB7CiAgICAgICAgICAgIHZhciBjb2RlID0gdGhpcy5fbG9va0JpdHMoaSk7CgogICAgICAgICAgICBpZiAoY29kZSA9PT0gY2NpdHRFT0YpIHsKICAgICAgICAgICAgICByZXR1cm4gW3RydWUsIDEsIGZhbHNlXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGkgPCBlbmQpIHsKICAgICAgICAgICAgICBjb2RlIDw8PSBlbmQgLSBpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIWxpbWl0VmFsdWUgfHwgY29kZSA+PSBsaW1pdFZhbHVlKSB7CiAgICAgICAgICAgICAgdmFyIHAgPSB0YWJsZVtjb2RlIC0gbGltaXRWYWx1ZV07CgogICAgICAgICAgICAgIGlmIChwWzBdID09PSBpKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9lYXRCaXRzKGkpOwoKICAgICAgICAgICAgICAgIHJldHVybiBbdHJ1ZSwgcFsxXSwgdHJ1ZV07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIFtmYWxzZSwgMCwgZmFsc2VdOwogICAgICAgIH0sCiAgICAgICAgX2dldFR3b0RpbUNvZGU6IGZ1bmN0aW9uIF9nZXRUd29EaW1Db2RlKCkgewogICAgICAgICAgdmFyIGNvZGUgPSAwOwogICAgICAgICAgdmFyIHA7CgogICAgICAgICAgaWYgKHRoaXMuZW9ibG9jaykgewogICAgICAgICAgICBjb2RlID0gdGhpcy5fbG9va0JpdHMoNyk7CiAgICAgICAgICAgIHAgPSB0d29EaW1UYWJsZVtjb2RlXTsKCiAgICAgICAgICAgIGlmIChwICYmIHBbMF0gPiAwKSB7CiAgICAgICAgICAgICAgdGhpcy5fZWF0Qml0cyhwWzBdKTsKCiAgICAgICAgICAgICAgcmV0dXJuIHBbMV07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSB0aGlzLl9maW5kVGFibGVDb2RlKDEsIDcsIHR3b0RpbVRhYmxlKTsKCiAgICAgICAgICAgIGlmIChyZXN1bHRbMF0gJiYgcmVzdWx0WzJdKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdFsxXTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgICgwLCBfdXRpbC5pbmZvKSgiQmFkIHR3byBkaW0gY29kZSIpOwogICAgICAgICAgcmV0dXJuIGNjaXR0RU9GOwogICAgICAgIH0sCiAgICAgICAgX2dldFdoaXRlQ29kZTogZnVuY3Rpb24gX2dldFdoaXRlQ29kZSgpIHsKICAgICAgICAgIHZhciBjb2RlID0gMDsKICAgICAgICAgIHZhciBwOwoKICAgICAgICAgIGlmICh0aGlzLmVvYmxvY2spIHsKICAgICAgICAgICAgY29kZSA9IHRoaXMuX2xvb2tCaXRzKDEyKTsKCiAgICAgICAgICAgIGlmIChjb2RlID09PSBjY2l0dEVPRikgewogICAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoY29kZSA+PiA1ID09PSAwKSB7CiAgICAgICAgICAgICAgcCA9IHdoaXRlVGFibGUxW2NvZGVdOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHAgPSB3aGl0ZVRhYmxlMltjb2RlID4+IDNdOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocFswXSA+IDApIHsKICAgICAgICAgICAgICB0aGlzLl9lYXRCaXRzKHBbMF0pOwoKICAgICAgICAgICAgICByZXR1cm4gcFsxXTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHRoaXMuX2ZpbmRUYWJsZUNvZGUoMSwgOSwgd2hpdGVUYWJsZTIpOwoKICAgICAgICAgICAgaWYgKHJlc3VsdFswXSkgewogICAgICAgICAgICAgIHJldHVybiByZXN1bHRbMV07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMuX2ZpbmRUYWJsZUNvZGUoMTEsIDEyLCB3aGl0ZVRhYmxlMSk7CgogICAgICAgICAgICBpZiAocmVzdWx0WzBdKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdFsxXTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgICgwLCBfdXRpbC5pbmZvKSgiYmFkIHdoaXRlIGNvZGUiKTsKCiAgICAgICAgICB0aGlzLl9lYXRCaXRzKDEpOwoKICAgICAgICAgIHJldHVybiAxOwogICAgICAgIH0sCiAgICAgICAgX2dldEJsYWNrQ29kZTogZnVuY3Rpb24gX2dldEJsYWNrQ29kZSgpIHsKICAgICAgICAgIHZhciBjb2RlLCBwOwoKICAgICAgICAgIGlmICh0aGlzLmVvYmxvY2spIHsKICAgICAgICAgICAgY29kZSA9IHRoaXMuX2xvb2tCaXRzKDEzKTsKCiAgICAgICAgICAgIGlmIChjb2RlID09PSBjY2l0dEVPRikgewogICAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoY29kZSA+PiA3ID09PSAwKSB7CiAgICAgICAgICAgICAgcCA9IGJsYWNrVGFibGUxW2NvZGVdOwogICAgICAgICAgICB9IGVsc2UgaWYgKGNvZGUgPj4gOSA9PT0gMCAmJiBjb2RlID4+IDcgIT09IDApIHsKICAgICAgICAgICAgICBwID0gYmxhY2tUYWJsZTJbKGNvZGUgPj4gMSkgLSA2NF07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcCA9IGJsYWNrVGFibGUzW2NvZGUgPj4gN107CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChwWzBdID4gMCkgewogICAgICAgICAgICAgIHRoaXMuX2VhdEJpdHMocFswXSk7CgogICAgICAgICAgICAgIHJldHVybiBwWzFdOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgcmVzdWx0ID0gdGhpcy5fZmluZFRhYmxlQ29kZSgyLCA2LCBibGFja1RhYmxlMyk7CgogICAgICAgICAgICBpZiAocmVzdWx0WzBdKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdFsxXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmVzdWx0ID0gdGhpcy5fZmluZFRhYmxlQ29kZSg3LCAxMiwgYmxhY2tUYWJsZTIsIDY0KTsKCiAgICAgICAgICAgIGlmIChyZXN1bHRbMF0pIHsKICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0WzFdOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXN1bHQgPSB0aGlzLl9maW5kVGFibGVDb2RlKDEwLCAxMywgYmxhY2tUYWJsZTEpOwoKICAgICAgICAgICAgaWYgKHJlc3VsdFswXSkgewogICAgICAgICAgICAgIHJldHVybiByZXN1bHRbMV07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICAoMCwgX3V0aWwuaW5mbykoImJhZCBibGFjayBjb2RlIik7CgogICAgICAgICAgdGhpcy5fZWF0Qml0cygxKTsKCiAgICAgICAgICByZXR1cm4gMTsKICAgICAgICB9LAogICAgICAgIF9sb29rQml0czogZnVuY3Rpb24gX2xvb2tCaXRzKG4pIHsKICAgICAgICAgIHZhciBjOwoKICAgICAgICAgIHdoaWxlICh0aGlzLmlucHV0Qml0cyA8IG4pIHsKICAgICAgICAgICAgaWYgKChjID0gdGhpcy5zb3VyY2UubmV4dCgpKSA9PT0gLTEpIHsKICAgICAgICAgICAgICBpZiAodGhpcy5pbnB1dEJpdHMgPT09IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiBjY2l0dEVPRjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiB0aGlzLmlucHV0QnVmIDw8IG4gLSB0aGlzLmlucHV0Qml0cyAmIDB4ZmZmZiA+PiAxNiAtIG47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuaW5wdXRCdWYgPSB0aGlzLmlucHV0QnVmIDw8IDggfCBjOwogICAgICAgICAgICB0aGlzLmlucHV0Qml0cyArPSA4OwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB0aGlzLmlucHV0QnVmID4+IHRoaXMuaW5wdXRCaXRzIC0gbiAmIDB4ZmZmZiA+PiAxNiAtIG47CiAgICAgICAgfSwKICAgICAgICBfZWF0Qml0czogZnVuY3Rpb24gX2VhdEJpdHMobikgewogICAgICAgICAgaWYgKCh0aGlzLmlucHV0Qml0cyAtPSBuKSA8IDApIHsKICAgICAgICAgICAgdGhpcy5pbnB1dEJpdHMgPSAwOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTsKICAgICAgcmV0dXJuIENDSVRURmF4RGVjb2RlcjsKICAgIH0oKTsKCiAgICBleHBvcnRzLkNDSVRURmF4RGVjb2RlciA9IENDSVRURmF4RGVjb2RlcjsKCiAgICAvKioqL30pLCAoCiAgLyogMjA0ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgIHZhbHVlOiB0cnVlCiAgICB9KTsKICAgIGV4cG9ydHMuSmJpZzJTdHJlYW0gPSB2b2lkIDA7CgogICAgdmFyIF9wcmltaXRpdmVzID0gX193X3BkZmpzX3JlcXVpcmVfXygxOTQpOwoKICAgIHZhciBfc3RyZWFtID0gX193X3BkZmpzX3JlcXVpcmVfXygyMDEpOwoKICAgIHZhciBfamJpZyA9IF9fd19wZGZqc19yZXF1aXJlX18oMjA1KTsKCiAgICB2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUpOwoKICAgIHZhciBKYmlnMlN0cmVhbSA9IGZ1bmN0aW9uIEpiaWcyU3RyZWFtQ2xvc3VyZSgpIHsKICAgICAgZnVuY3Rpb24gSmJpZzJTdHJlYW0oc3RyZWFtLCBtYXliZUxlbmd0aCwgZGljdCwgcGFyYW1zKSB7CiAgICAgICAgdGhpcy5zdHJlYW0gPSBzdHJlYW07CiAgICAgICAgdGhpcy5tYXliZUxlbmd0aCA9IG1heWJlTGVuZ3RoOwogICAgICAgIHRoaXMuZGljdCA9IGRpY3Q7CiAgICAgICAgdGhpcy5wYXJhbXMgPSBwYXJhbXM7CgogICAgICAgIF9zdHJlYW0uRGVjb2RlU3RyZWFtLmNhbGwodGhpcywgbWF5YmVMZW5ndGgpOwogICAgICB9CgogICAgICBKYmlnMlN0cmVhbS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKF9zdHJlYW0uRGVjb2RlU3RyZWFtLnByb3RvdHlwZSk7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShKYmlnMlN0cmVhbS5wcm90b3R5cGUsICJieXRlcyIsIHsKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAiYnl0ZXMiLCB0aGlzLnN0cmVhbS5nZXRCeXRlcyh0aGlzLm1heWJlTGVuZ3RoKSk7CiAgICAgICAgfSwKICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgfSk7CgogICAgICBKYmlnMlN0cmVhbS5wcm90b3R5cGUuZW5zdXJlQnVmZmVyID0gZnVuY3Rpb24gKHJlcXVlc3RlZCkge307CgogICAgICBKYmlnMlN0cmVhbS5wcm90b3R5cGUucmVhZEJsb2NrID0gZnVuY3Rpb24gKCkgewogICAgICAgIGlmICh0aGlzLmVvZikgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIGpiaWcySW1hZ2UgPSBuZXcgX2piaWcuSmJpZzJJbWFnZSgpOwogICAgICAgIHZhciBjaHVua3MgPSBbXTsKCiAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc0RpY3QpKHRoaXMucGFyYW1zKSkgewogICAgICAgICAgdmFyIGdsb2JhbHNTdHJlYW0gPSB0aGlzLnBhcmFtcy5nZXQoIkpCSUcyR2xvYmFscyIpOwoKICAgICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNTdHJlYW0pKGdsb2JhbHNTdHJlYW0pKSB7CiAgICAgICAgICAgIHZhciBnbG9iYWxzID0gZ2xvYmFsc1N0cmVhbS5nZXRCeXRlcygpOwogICAgICAgICAgICBjaHVua3MucHVzaCh7CiAgICAgICAgICAgICAgZGF0YTogZ2xvYmFscywKICAgICAgICAgICAgICBzdGFydDogMCwKICAgICAgICAgICAgICBlbmQ6IGdsb2JhbHMubGVuZ3RoCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgY2h1bmtzLnB1c2goewogICAgICAgICAgZGF0YTogdGhpcy5ieXRlcywKICAgICAgICAgIHN0YXJ0OiAwLAogICAgICAgICAgZW5kOiB0aGlzLmJ5dGVzLmxlbmd0aAogICAgICAgIH0pOwogICAgICAgIHZhciBkYXRhID0gamJpZzJJbWFnZS5wYXJzZUNodW5rcyhjaHVua3MpOwogICAgICAgIHZhciBkYXRhTGVuZ3RoID0gZGF0YS5sZW5ndGg7CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YUxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBkYXRhW2ldIF49IDB4ZmY7CiAgICAgICAgfQoKICAgICAgICB0aGlzLmJ1ZmZlciA9IGRhdGE7CiAgICAgICAgdGhpcy5idWZmZXJMZW5ndGggPSBkYXRhTGVuZ3RoOwogICAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgfTsKCiAgICAgIHJldHVybiBKYmlnMlN0cmVhbTsKICAgIH0oKTsKCiAgICBleHBvcnRzLkpiaWcyU3RyZWFtID0gSmJpZzJTdHJlYW07CgogICAgLyoqKi99KSwgKAogIC8qIDIwNSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCgogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICB2YWx1ZTogdHJ1ZQogICAgfSk7CiAgICBleHBvcnRzLkpiaWcySW1hZ2UgPSB2b2lkIDA7CgogICAgdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXyg1KTsKCiAgICB2YXIgX2NvcmVfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE5Nyk7CgogICAgdmFyIF9hcml0aG1ldGljX2RlY29kZXIgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIwNik7CgogICAgdmFyIF9jY2l0dCA9IF9fd19wZGZqc19yZXF1aXJlX18oMjAzKTsKCiAgICBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyJAYmFiZWwvaGVscGVycyAtIHR5cGVvZiI7aWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIpIHtfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHtyZXR1cm4gdHlwZW9mIG9iajt9O30gZWxzZSB7X3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7cmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajt9O31yZXR1cm4gX3R5cGVvZihvYmopO30KCiAgICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7aWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTt9fQoKICAgIGZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHtpZiAoY2FsbCAmJiAoX3R5cGVvZihjYWxsKSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7cmV0dXJuIGNhbGw7fXJldHVybiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpO30KCiAgICBmdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHtpZiAoc2VsZiA9PT0gdm9pZCAwKSB7dGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTt9cmV0dXJuIHNlbGY7fQoKICAgIGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7X2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHtyZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pO307cmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTt9CgogICAgZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7aWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpO31zdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7aWYgKHN1cGVyQ2xhc3MpIF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7fQoKICAgIGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7X3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7by5fX3Byb3RvX18gPSBwO3JldHVybiBvO307cmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTt9CgogICAgdmFyIEpiaWcyRXJyb3IgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9CYXNlRXhjZXB0aW9uKSB7CiAgICAgIF9pbmhlcml0cyhKYmlnMkVycm9yLCBfQmFzZUV4Y2VwdGlvbik7CgogICAgICBmdW5jdGlvbiBKYmlnMkVycm9yKG1zZykgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBKYmlnMkVycm9yKTsKCiAgICAgICAgcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihKYmlnMkVycm9yKS5jYWxsKHRoaXMsICJKQklHMiBlcnJvcjogIi5jb25jYXQobXNnKSkpOwogICAgICB9CgogICAgICByZXR1cm4gSmJpZzJFcnJvcjsKICAgIH0oX3V0aWwuQmFzZUV4Y2VwdGlvbik7CgogICAgdmFyIEpiaWcySW1hZ2UgPSBmdW5jdGlvbiBKYmlnMkltYWdlQ2xvc3VyZSgpIHsKICAgICAgZnVuY3Rpb24gQ29udGV4dENhY2hlKCkge30KCiAgICAgIENvbnRleHRDYWNoZS5wcm90b3R5cGUgPSB7CiAgICAgICAgZ2V0Q29udGV4dHM6IGZ1bmN0aW9uIGdldENvbnRleHRzKGlkKSB7CiAgICAgICAgICBpZiAoaWQgaW4gdGhpcykgewogICAgICAgICAgICByZXR1cm4gdGhpc1tpZF07CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHRoaXNbaWRdID0gbmV3IEludDhBcnJheSgxIDw8IDE2KTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBmdW5jdGlvbiBEZWNvZGluZ0NvbnRleHQoZGF0YSwgc3RhcnQsIGVuZCkgewogICAgICAgIHRoaXMuZGF0YSA9IGRhdGE7CiAgICAgICAgdGhpcy5zdGFydCA9IHN0YXJ0OwogICAgICAgIHRoaXMuZW5kID0gZW5kOwogICAgICB9CgogICAgICBEZWNvZGluZ0NvbnRleHQucHJvdG90eXBlID0gewogICAgICAgIGdldCBkZWNvZGVyKCkgewogICAgICAgICAgdmFyIGRlY29kZXIgPSBuZXcgX2FyaXRobWV0aWNfZGVjb2Rlci5Bcml0aG1ldGljRGVjb2Rlcih0aGlzLmRhdGEsIHRoaXMuc3RhcnQsIHRoaXMuZW5kKTsKICAgICAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAiZGVjb2RlciIsIGRlY29kZXIpOwogICAgICAgIH0sCgogICAgICAgIGdldCBjb250ZXh0Q2FjaGUoKSB7CiAgICAgICAgICB2YXIgY2FjaGUgPSBuZXcgQ29udGV4dENhY2hlKCk7CiAgICAgICAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgImNvbnRleHRDYWNoZSIsIGNhY2hlKTsKICAgICAgICB9CgogICAgICB9OwoKICAgICAgZnVuY3Rpb24gZGVjb2RlSW50ZWdlcihjb250ZXh0Q2FjaGUsIHByb2NlZHVyZSwgZGVjb2RlcikgewogICAgICAgIHZhciBjb250ZXh0cyA9IGNvbnRleHRDYWNoZS5nZXRDb250ZXh0cyhwcm9jZWR1cmUpOwogICAgICAgIHZhciBwcmV2ID0gMTsKCiAgICAgICAgZnVuY3Rpb24gcmVhZEJpdHMobGVuZ3RoKSB7CiAgICAgICAgICB2YXIgdiA9IDA7CgogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YXIgYml0ID0gZGVjb2Rlci5yZWFkQml0KGNvbnRleHRzLCBwcmV2KTsKICAgICAgICAgICAgcHJldiA9IHByZXYgPCAyNTYgPyBwcmV2IDw8IDEgfCBiaXQgOiAocHJldiA8PCAxIHwgYml0KSAmIDUxMSB8IDI1NjsKICAgICAgICAgICAgdiA9IHYgPDwgMSB8IGJpdDsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gdiA+Pj4gMDsKICAgICAgICB9CgogICAgICAgIHZhciBzaWduID0gcmVhZEJpdHMoMSk7CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZEJpdHMoMSkgPyByZWFkQml0cygxKSA/IHJlYWRCaXRzKDEpID8gcmVhZEJpdHMoMSkgPyByZWFkQml0cygxKSA/IHJlYWRCaXRzKDMyKSArIDQ0MzYgOiByZWFkQml0cygxMikgKyAzNDAgOiByZWFkQml0cyg4KSArIDg0IDogcmVhZEJpdHMoNikgKyAyMCA6IHJlYWRCaXRzKDQpICsgNCA6IHJlYWRCaXRzKDIpOwoKICAgICAgICBpZiAoc2lnbiA9PT0gMCkgewogICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPiAwKSB7CiAgICAgICAgICByZXR1cm4gLXZhbHVlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGRlY29kZUlBSUQoY29udGV4dENhY2hlLCBkZWNvZGVyLCBjb2RlTGVuZ3RoKSB7CiAgICAgICAgdmFyIGNvbnRleHRzID0gY29udGV4dENhY2hlLmdldENvbnRleHRzKCJJQUlEIik7CiAgICAgICAgdmFyIHByZXYgPSAxOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvZGVMZW5ndGg7IGkrKykgewogICAgICAgICAgdmFyIGJpdCA9IGRlY29kZXIucmVhZEJpdChjb250ZXh0cywgcHJldik7CiAgICAgICAgICBwcmV2ID0gcHJldiA8PCAxIHwgYml0OwogICAgICAgIH0KCiAgICAgICAgaWYgKGNvZGVMZW5ndGggPCAzMSkgewogICAgICAgICAgcmV0dXJuIHByZXYgJiAoMSA8PCBjb2RlTGVuZ3RoKSAtIDE7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcHJldiAmIDB4N2ZmZmZmZmY7CiAgICAgIH0KCiAgICAgIHZhciBTZWdtZW50VHlwZXMgPSBbIlN5bWJvbERpY3Rpb25hcnkiLCBudWxsLCBudWxsLCBudWxsLCAiSW50ZXJtZWRpYXRlVGV4dFJlZ2lvbiIsIG51bGwsICJJbW1lZGlhdGVUZXh0UmVnaW9uIiwgIkltbWVkaWF0ZUxvc3NsZXNzVGV4dFJlZ2lvbiIsIG51bGwsIG51bGwsIG51bGwsIG51bGwsIG51bGwsIG51bGwsIG51bGwsIG51bGwsICJQYXR0ZXJuRGljdGlvbmFyeSIsIG51bGwsIG51bGwsIG51bGwsICJJbnRlcm1lZGlhdGVIYWxmdG9uZVJlZ2lvbiIsIG51bGwsICJJbW1lZGlhdGVIYWxmdG9uZVJlZ2lvbiIsICJJbW1lZGlhdGVMb3NzbGVzc0hhbGZ0b25lUmVnaW9uIiwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgIkludGVybWVkaWF0ZUdlbmVyaWNSZWdpb24iLCBudWxsLCAiSW1tZWRpYXRlR2VuZXJpY1JlZ2lvbiIsICJJbW1lZGlhdGVMb3NzbGVzc0dlbmVyaWNSZWdpb24iLCAiSW50ZXJtZWRpYXRlR2VuZXJpY1JlZmluZW1lbnRSZWdpb24iLCBudWxsLCAiSW1tZWRpYXRlR2VuZXJpY1JlZmluZW1lbnRSZWdpb24iLCAiSW1tZWRpYXRlTG9zc2xlc3NHZW5lcmljUmVmaW5lbWVudFJlZ2lvbiIsIG51bGwsIG51bGwsIG51bGwsIG51bGwsICJQYWdlSW5mb3JtYXRpb24iLCAiRW5kT2ZQYWdlIiwgIkVuZE9mU3RyaXBlIiwgIkVuZE9mRmlsZSIsICJQcm9maWxlcyIsICJUYWJsZXMiLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCAiRXh0ZW5zaW9uIl07CiAgICAgIHZhciBDb2RpbmdUZW1wbGF0ZXMgPSBbW3sKICAgICAgICB4OiAtMSwKICAgICAgICB5OiAtMgogICAgICB9LCB7CiAgICAgICAgeDogMCwKICAgICAgICB5OiAtMgogICAgICB9LCB7CiAgICAgICAgeDogMSwKICAgICAgICB5OiAtMgogICAgICB9LCB7CiAgICAgICAgeDogLTIsCiAgICAgICAgeTogLTEKICAgICAgfSwgewogICAgICAgIHg6IC0xLAogICAgICAgIHk6IC0xCiAgICAgIH0sIHsKICAgICAgICB4OiAwLAogICAgICAgIHk6IC0xCiAgICAgIH0sIHsKICAgICAgICB4OiAxLAogICAgICAgIHk6IC0xCiAgICAgIH0sIHsKICAgICAgICB4OiAyLAogICAgICAgIHk6IC0xCiAgICAgIH0sIHsKICAgICAgICB4OiAtNCwKICAgICAgICB5OiAwCiAgICAgIH0sIHsKICAgICAgICB4OiAtMywKICAgICAgICB5OiAwCiAgICAgIH0sIHsKICAgICAgICB4OiAtMiwKICAgICAgICB5OiAwCiAgICAgIH0sIHsKICAgICAgICB4OiAtMSwKICAgICAgICB5OiAwCiAgICAgIH1dLCBbewogICAgICAgIHg6IC0xLAogICAgICAgIHk6IC0yCiAgICAgIH0sIHsKICAgICAgICB4OiAwLAogICAgICAgIHk6IC0yCiAgICAgIH0sIHsKICAgICAgICB4OiAxLAogICAgICAgIHk6IC0yCiAgICAgIH0sIHsKICAgICAgICB4OiAyLAogICAgICAgIHk6IC0yCiAgICAgIH0sIHsKICAgICAgICB4OiAtMiwKICAgICAgICB5OiAtMQogICAgICB9LCB7CiAgICAgICAgeDogLTEsCiAgICAgICAgeTogLTEKICAgICAgfSwgewogICAgICAgIHg6IDAsCiAgICAgICAgeTogLTEKICAgICAgfSwgewogICAgICAgIHg6IDEsCiAgICAgICAgeTogLTEKICAgICAgfSwgewogICAgICAgIHg6IDIsCiAgICAgICAgeTogLTEKICAgICAgfSwgewogICAgICAgIHg6IC0zLAogICAgICAgIHk6IDAKICAgICAgfSwgewogICAgICAgIHg6IC0yLAogICAgICAgIHk6IDAKICAgICAgfSwgewogICAgICAgIHg6IC0xLAogICAgICAgIHk6IDAKICAgICAgfV0sIFt7CiAgICAgICAgeDogLTEsCiAgICAgICAgeTogLTIKICAgICAgfSwgewogICAgICAgIHg6IDAsCiAgICAgICAgeTogLTIKICAgICAgfSwgewogICAgICAgIHg6IDEsCiAgICAgICAgeTogLTIKICAgICAgfSwgewogICAgICAgIHg6IC0yLAogICAgICAgIHk6IC0xCiAgICAgIH0sIHsKICAgICAgICB4OiAtMSwKICAgICAgICB5OiAtMQogICAgICB9LCB7CiAgICAgICAgeDogMCwKICAgICAgICB5OiAtMQogICAgICB9LCB7CiAgICAgICAgeDogMSwKICAgICAgICB5OiAtMQogICAgICB9LCB7CiAgICAgICAgeDogLTIsCiAgICAgICAgeTogMAogICAgICB9LCB7CiAgICAgICAgeDogLTEsCiAgICAgICAgeTogMAogICAgICB9XSwgW3sKICAgICAgICB4OiAtMywKICAgICAgICB5OiAtMQogICAgICB9LCB7CiAgICAgICAgeDogLTIsCiAgICAgICAgeTogLTEKICAgICAgfSwgewogICAgICAgIHg6IC0xLAogICAgICAgIHk6IC0xCiAgICAgIH0sIHsKICAgICAgICB4OiAwLAogICAgICAgIHk6IC0xCiAgICAgIH0sIHsKICAgICAgICB4OiAxLAogICAgICAgIHk6IC0xCiAgICAgIH0sIHsKICAgICAgICB4OiAtNCwKICAgICAgICB5OiAwCiAgICAgIH0sIHsKICAgICAgICB4OiAtMywKICAgICAgICB5OiAwCiAgICAgIH0sIHsKICAgICAgICB4OiAtMiwKICAgICAgICB5OiAwCiAgICAgIH0sIHsKICAgICAgICB4OiAtMSwKICAgICAgICB5OiAwCiAgICAgIH1dXTsKICAgICAgdmFyIFJlZmluZW1lbnRUZW1wbGF0ZXMgPSBbewogICAgICAgIGNvZGluZzogW3sKICAgICAgICAgIHg6IDAsCiAgICAgICAgICB5OiAtMQogICAgICAgIH0sIHsKICAgICAgICAgIHg6IDEsCiAgICAgICAgICB5OiAtMQogICAgICAgIH0sIHsKICAgICAgICAgIHg6IC0xLAogICAgICAgICAgeTogMAogICAgICAgIH1dLAogICAgICAgIHJlZmVyZW5jZTogW3sKICAgICAgICAgIHg6IDAsCiAgICAgICAgICB5OiAtMQogICAgICAgIH0sIHsKICAgICAgICAgIHg6IDEsCiAgICAgICAgICB5OiAtMQogICAgICAgIH0sIHsKICAgICAgICAgIHg6IC0xLAogICAgICAgICAgeTogMAogICAgICAgIH0sIHsKICAgICAgICAgIHg6IDAsCiAgICAgICAgICB5OiAwCiAgICAgICAgfSwgewogICAgICAgICAgeDogMSwKICAgICAgICAgIHk6IDAKICAgICAgICB9LCB7CiAgICAgICAgICB4OiAtMSwKICAgICAgICAgIHk6IDEKICAgICAgICB9LCB7CiAgICAgICAgICB4OiAwLAogICAgICAgICAgeTogMQogICAgICAgIH0sIHsKICAgICAgICAgIHg6IDEsCiAgICAgICAgICB5OiAxCiAgICAgICAgfV0KICAgICAgfSwgewogICAgICAgIGNvZGluZzogW3sKICAgICAgICAgIHg6IC0xLAogICAgICAgICAgeTogLTEKICAgICAgICB9LCB7CiAgICAgICAgICB4OiAwLAogICAgICAgICAgeTogLTEKICAgICAgICB9LCB7CiAgICAgICAgICB4OiAxLAogICAgICAgICAgeTogLTEKICAgICAgICB9LCB7CiAgICAgICAgICB4OiAtMSwKICAgICAgICAgIHk6IDAKICAgICAgICB9XSwKICAgICAgICByZWZlcmVuY2U6IFt7CiAgICAgICAgICB4OiAwLAogICAgICAgICAgeTogLTEKICAgICAgICB9LCB7CiAgICAgICAgICB4OiAtMSwKICAgICAgICAgIHk6IDAKICAgICAgICB9LCB7CiAgICAgICAgICB4OiAwLAogICAgICAgICAgeTogMAogICAgICAgIH0sIHsKICAgICAgICAgIHg6IDEsCiAgICAgICAgICB5OiAwCiAgICAgICAgfSwgewogICAgICAgICAgeDogMCwKICAgICAgICAgIHk6IDEKICAgICAgICB9LCB7CiAgICAgICAgICB4OiAxLAogICAgICAgICAgeTogMQogICAgICAgIH1dCiAgICAgIH1dOwogICAgICB2YXIgUmV1c2VkQ29udGV4dHMgPSBbMHg5YjI1LCAweDA3OTUsIDB4MDBlNSwgMHgwMTk1XTsKICAgICAgdmFyIFJlZmluZW1lbnRSZXVzZWRDb250ZXh0cyA9IFsweDAwMjAsIDB4MDAwOF07CgogICAgICBmdW5jdGlvbiBkZWNvZGVCaXRtYXBUZW1wbGF0ZTAod2lkdGgsIGhlaWdodCwgZGVjb2RpbmdDb250ZXh0KSB7CiAgICAgICAgdmFyIGRlY29kZXIgPSBkZWNvZGluZ0NvbnRleHQuZGVjb2RlcjsKICAgICAgICB2YXIgY29udGV4dHMgPSBkZWNvZGluZ0NvbnRleHQuY29udGV4dENhY2hlLmdldENvbnRleHRzKCJHQiIpOwogICAgICAgIHZhciBjb250ZXh0TGFiZWwsCiAgICAgICAgICBpLAogICAgICAgICAgaiwKICAgICAgICAgIHBpeGVsLAogICAgICAgICAgcm93LAogICAgICAgICAgcm93MSwKICAgICAgICAgIHJvdzIsCiAgICAgICAgICBiaXRtYXAgPSBbXTsKICAgICAgICB2YXIgT0xEX1BJWEVMX01BU0sgPSAweDdiZjc7CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBoZWlnaHQ7IGkrKykgewogICAgICAgICAgcm93ID0gYml0bWFwW2ldID0gbmV3IFVpbnQ4QXJyYXkod2lkdGgpOwogICAgICAgICAgcm93MSA9IGkgPCAxID8gcm93IDogYml0bWFwW2kgLSAxXTsKICAgICAgICAgIHJvdzIgPSBpIDwgMiA/IHJvdyA6IGJpdG1hcFtpIC0gMl07CiAgICAgICAgICBjb250ZXh0TGFiZWwgPSByb3cyWzBdIDw8IDEzIHwgcm93MlsxXSA8PCAxMiB8IHJvdzJbMl0gPDwgMTEgfCByb3cxWzBdIDw8IDcgfCByb3cxWzFdIDw8IDYgfCByb3cxWzJdIDw8IDUgfCByb3cxWzNdIDw8IDQ7CgogICAgICAgICAgZm9yIChqID0gMDsgaiA8IHdpZHRoOyBqKyspIHsKICAgICAgICAgICAgcm93W2pdID0gcGl4ZWwgPSBkZWNvZGVyLnJlYWRCaXQoY29udGV4dHMsIGNvbnRleHRMYWJlbCk7CiAgICAgICAgICAgIGNvbnRleHRMYWJlbCA9IChjb250ZXh0TGFiZWwgJiBPTERfUElYRUxfTUFTSykgPDwgMSB8IChqICsgMyA8IHdpZHRoID8gcm93MltqICsgM10gPDwgMTEgOiAwKSB8IChqICsgNCA8IHdpZHRoID8gcm93MVtqICsgNF0gPDwgNCA6IDApIHwgcGl4ZWw7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYml0bWFwOwogICAgICB9CgogICAgICBmdW5jdGlvbiBkZWNvZGVCaXRtYXAobW1yLCB3aWR0aCwgaGVpZ2h0LCB0ZW1wbGF0ZUluZGV4LCBwcmVkaWN0aW9uLCBza2lwLCBhdCwgZGVjb2RpbmdDb250ZXh0KSB7CiAgICAgICAgaWYgKG1tcikgewogICAgICAgICAgdmFyIGlucHV0ID0gbmV3IFJlYWRlcihkZWNvZGluZ0NvbnRleHQuZGF0YSwgZGVjb2RpbmdDb250ZXh0LnN0YXJ0LCBkZWNvZGluZ0NvbnRleHQuZW5kKTsKICAgICAgICAgIHJldHVybiBkZWNvZGVNTVJCaXRtYXAoaW5wdXQsIHdpZHRoLCBoZWlnaHQsIGZhbHNlKTsKICAgICAgICB9CgogICAgICAgIGlmICh0ZW1wbGF0ZUluZGV4ID09PSAwICYmICFza2lwICYmICFwcmVkaWN0aW9uICYmIGF0Lmxlbmd0aCA9PT0gNCAmJiBhdFswXS54ID09PSAzICYmIGF0WzBdLnkgPT09IC0xICYmIGF0WzFdLnggPT09IC0zICYmIGF0WzFdLnkgPT09IC0xICYmIGF0WzJdLnggPT09IDIgJiYgYXRbMl0ueSA9PT0gLTIgJiYgYXRbM10ueCA9PT0gLTIgJiYgYXRbM10ueSA9PT0gLTIpIHsKICAgICAgICAgIHJldHVybiBkZWNvZGVCaXRtYXBUZW1wbGF0ZTAod2lkdGgsIGhlaWdodCwgZGVjb2RpbmdDb250ZXh0KTsKICAgICAgICB9CgogICAgICAgIHZhciB1c2Vza2lwID0gISFza2lwOwogICAgICAgIHZhciB0ZW1wbGF0ZSA9IENvZGluZ1RlbXBsYXRlc1t0ZW1wbGF0ZUluZGV4XS5jb25jYXQoYXQpOwogICAgICAgIHRlbXBsYXRlLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgIHJldHVybiBhLnkgLSBiLnkgfHwgYS54IC0gYi54OwogICAgICAgIH0pOwogICAgICAgIHZhciB0ZW1wbGF0ZUxlbmd0aCA9IHRlbXBsYXRlLmxlbmd0aDsKICAgICAgICB2YXIgdGVtcGxhdGVYID0gbmV3IEludDhBcnJheSh0ZW1wbGF0ZUxlbmd0aCk7CiAgICAgICAgdmFyIHRlbXBsYXRlWSA9IG5ldyBJbnQ4QXJyYXkodGVtcGxhdGVMZW5ndGgpOwogICAgICAgIHZhciBjaGFuZ2luZ1RlbXBsYXRlRW50cmllcyA9IFtdOwogICAgICAgIHZhciByZXVzZU1hc2sgPSAwLAogICAgICAgICAgbWluWCA9IDAsCiAgICAgICAgICBtYXhYID0gMCwKICAgICAgICAgIG1pblkgPSAwOwogICAgICAgIHZhciBjLCBrOwoKICAgICAgICBmb3IgKGsgPSAwOyBrIDwgdGVtcGxhdGVMZW5ndGg7IGsrKykgewogICAgICAgICAgdGVtcGxhdGVYW2tdID0gdGVtcGxhdGVba10ueDsKICAgICAgICAgIHRlbXBsYXRlWVtrXSA9IHRlbXBsYXRlW2tdLnk7CiAgICAgICAgICBtaW5YID0gTWF0aC5taW4obWluWCwgdGVtcGxhdGVba10ueCk7CiAgICAgICAgICBtYXhYID0gTWF0aC5tYXgobWF4WCwgdGVtcGxhdGVba10ueCk7CiAgICAgICAgICBtaW5ZID0gTWF0aC5taW4obWluWSwgdGVtcGxhdGVba10ueSk7CgogICAgICAgICAgaWYgKGsgPCB0ZW1wbGF0ZUxlbmd0aCAtIDEgJiYgdGVtcGxhdGVba10ueSA9PT0gdGVtcGxhdGVbayArIDFdLnkgJiYgdGVtcGxhdGVba10ueCA9PT0gdGVtcGxhdGVbayArIDFdLnggLSAxKSB7CiAgICAgICAgICAgIHJldXNlTWFzayB8PSAxIDw8IHRlbXBsYXRlTGVuZ3RoIC0gMSAtIGs7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjaGFuZ2luZ1RlbXBsYXRlRW50cmllcy5wdXNoKGspOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFyIGNoYW5naW5nRW50cmllc0xlbmd0aCA9IGNoYW5naW5nVGVtcGxhdGVFbnRyaWVzLmxlbmd0aDsKICAgICAgICB2YXIgY2hhbmdpbmdUZW1wbGF0ZVggPSBuZXcgSW50OEFycmF5KGNoYW5naW5nRW50cmllc0xlbmd0aCk7CiAgICAgICAgdmFyIGNoYW5naW5nVGVtcGxhdGVZID0gbmV3IEludDhBcnJheShjaGFuZ2luZ0VudHJpZXNMZW5ndGgpOwogICAgICAgIHZhciBjaGFuZ2luZ1RlbXBsYXRlQml0ID0gbmV3IFVpbnQxNkFycmF5KGNoYW5naW5nRW50cmllc0xlbmd0aCk7CgogICAgICAgIGZvciAoYyA9IDA7IGMgPCBjaGFuZ2luZ0VudHJpZXNMZW5ndGg7IGMrKykgewogICAgICAgICAgayA9IGNoYW5naW5nVGVtcGxhdGVFbnRyaWVzW2NdOwogICAgICAgICAgY2hhbmdpbmdUZW1wbGF0ZVhbY10gPSB0ZW1wbGF0ZVtrXS54OwogICAgICAgICAgY2hhbmdpbmdUZW1wbGF0ZVlbY10gPSB0ZW1wbGF0ZVtrXS55OwogICAgICAgICAgY2hhbmdpbmdUZW1wbGF0ZUJpdFtjXSA9IDEgPDwgdGVtcGxhdGVMZW5ndGggLSAxIC0gazsKICAgICAgICB9CgogICAgICAgIHZhciBzYmJfbGVmdCA9IC1taW5YOwogICAgICAgIHZhciBzYmJfdG9wID0gLW1pblk7CiAgICAgICAgdmFyIHNiYl9yaWdodCA9IHdpZHRoIC0gbWF4WDsKICAgICAgICB2YXIgcHNldWRvUGl4ZWxDb250ZXh0ID0gUmV1c2VkQ29udGV4dHNbdGVtcGxhdGVJbmRleF07CiAgICAgICAgdmFyIHJvdyA9IG5ldyBVaW50OEFycmF5KHdpZHRoKTsKICAgICAgICB2YXIgYml0bWFwID0gW107CiAgICAgICAgdmFyIGRlY29kZXIgPSBkZWNvZGluZ0NvbnRleHQuZGVjb2RlcjsKICAgICAgICB2YXIgY29udGV4dHMgPSBkZWNvZGluZ0NvbnRleHQuY29udGV4dENhY2hlLmdldENvbnRleHRzKCJHQiIpOwogICAgICAgIHZhciBsdHAgPSAwLAogICAgICAgICAgaiwKICAgICAgICAgIGkwLAogICAgICAgICAgajAsCiAgICAgICAgICBjb250ZXh0TGFiZWwgPSAwLAogICAgICAgICAgYml0LAogICAgICAgICAgc2hpZnQ7CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaGVpZ2h0OyBpKyspIHsKICAgICAgICAgIGlmIChwcmVkaWN0aW9uKSB7CiAgICAgICAgICAgIHZhciBzbHRwID0gZGVjb2Rlci5yZWFkQml0KGNvbnRleHRzLCBwc2V1ZG9QaXhlbENvbnRleHQpOwogICAgICAgICAgICBsdHAgXj0gc2x0cDsKCiAgICAgICAgICAgIGlmIChsdHApIHsKICAgICAgICAgICAgICBiaXRtYXAucHVzaChyb3cpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcm93ID0gbmV3IFVpbnQ4QXJyYXkocm93KTsKICAgICAgICAgIGJpdG1hcC5wdXNoKHJvdyk7CgogICAgICAgICAgZm9yIChqID0gMDsgaiA8IHdpZHRoOyBqKyspIHsKICAgICAgICAgICAgaWYgKHVzZXNraXAgJiYgc2tpcFtpXVtqXSkgewogICAgICAgICAgICAgIHJvd1tqXSA9IDA7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChqID49IHNiYl9sZWZ0ICYmIGogPCBzYmJfcmlnaHQgJiYgaSA+PSBzYmJfdG9wKSB7CiAgICAgICAgICAgICAgY29udGV4dExhYmVsID0gY29udGV4dExhYmVsIDw8IDEgJiByZXVzZU1hc2s7CgogICAgICAgICAgICAgIGZvciAoayA9IDA7IGsgPCBjaGFuZ2luZ0VudHJpZXNMZW5ndGg7IGsrKykgewogICAgICAgICAgICAgICAgaTAgPSBpICsgY2hhbmdpbmdUZW1wbGF0ZVlba107CiAgICAgICAgICAgICAgICBqMCA9IGogKyBjaGFuZ2luZ1RlbXBsYXRlWFtrXTsKICAgICAgICAgICAgICAgIGJpdCA9IGJpdG1hcFtpMF1bajBdOwoKICAgICAgICAgICAgICAgIGlmIChiaXQpIHsKICAgICAgICAgICAgICAgICAgYml0ID0gY2hhbmdpbmdUZW1wbGF0ZUJpdFtrXTsKICAgICAgICAgICAgICAgICAgY29udGV4dExhYmVsIHw9IGJpdDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgY29udGV4dExhYmVsID0gMDsKICAgICAgICAgICAgICBzaGlmdCA9IHRlbXBsYXRlTGVuZ3RoIC0gMTsKCiAgICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IHRlbXBsYXRlTGVuZ3RoOyBrKyssIHNoaWZ0LS0pIHsKICAgICAgICAgICAgICAgIGowID0gaiArIHRlbXBsYXRlWFtrXTsKCiAgICAgICAgICAgICAgICBpZiAoajAgPj0gMCAmJiBqMCA8IHdpZHRoKSB7CiAgICAgICAgICAgICAgICAgIGkwID0gaSArIHRlbXBsYXRlWVtrXTsKCiAgICAgICAgICAgICAgICAgIGlmIChpMCA+PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgYml0ID0gYml0bWFwW2kwXVtqMF07CgogICAgICAgICAgICAgICAgICAgIGlmIChiaXQpIHsKICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHRMYWJlbCB8PSBiaXQgPDwgc2hpZnQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcGl4ZWwgPSBkZWNvZGVyLnJlYWRCaXQoY29udGV4dHMsIGNvbnRleHRMYWJlbCk7CiAgICAgICAgICAgIHJvd1tqXSA9IHBpeGVsOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGJpdG1hcDsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZGVjb2RlUmVmaW5lbWVudCh3aWR0aCwgaGVpZ2h0LCB0ZW1wbGF0ZUluZGV4LCByZWZlcmVuY2VCaXRtYXAsIG9mZnNldFgsIG9mZnNldFksIHByZWRpY3Rpb24sIGF0LCBkZWNvZGluZ0NvbnRleHQpIHsKICAgICAgICB2YXIgY29kaW5nVGVtcGxhdGUgPSBSZWZpbmVtZW50VGVtcGxhdGVzW3RlbXBsYXRlSW5kZXhdLmNvZGluZzsKCiAgICAgICAgaWYgKHRlbXBsYXRlSW5kZXggPT09IDApIHsKICAgICAgICAgIGNvZGluZ1RlbXBsYXRlID0gY29kaW5nVGVtcGxhdGUuY29uY2F0KFthdFswXV0pOwogICAgICAgIH0KCiAgICAgICAgdmFyIGNvZGluZ1RlbXBsYXRlTGVuZ3RoID0gY29kaW5nVGVtcGxhdGUubGVuZ3RoOwogICAgICAgIHZhciBjb2RpbmdUZW1wbGF0ZVggPSBuZXcgSW50MzJBcnJheShjb2RpbmdUZW1wbGF0ZUxlbmd0aCk7CiAgICAgICAgdmFyIGNvZGluZ1RlbXBsYXRlWSA9IG5ldyBJbnQzMkFycmF5KGNvZGluZ1RlbXBsYXRlTGVuZ3RoKTsKICAgICAgICB2YXIgazsKCiAgICAgICAgZm9yIChrID0gMDsgayA8IGNvZGluZ1RlbXBsYXRlTGVuZ3RoOyBrKyspIHsKICAgICAgICAgIGNvZGluZ1RlbXBsYXRlWFtrXSA9IGNvZGluZ1RlbXBsYXRlW2tdLng7CiAgICAgICAgICBjb2RpbmdUZW1wbGF0ZVlba10gPSBjb2RpbmdUZW1wbGF0ZVtrXS55OwogICAgICAgIH0KCiAgICAgICAgdmFyIHJlZmVyZW5jZVRlbXBsYXRlID0gUmVmaW5lbWVudFRlbXBsYXRlc1t0ZW1wbGF0ZUluZGV4XS5yZWZlcmVuY2U7CgogICAgICAgIGlmICh0ZW1wbGF0ZUluZGV4ID09PSAwKSB7CiAgICAgICAgICByZWZlcmVuY2VUZW1wbGF0ZSA9IHJlZmVyZW5jZVRlbXBsYXRlLmNvbmNhdChbYXRbMV1dKTsKICAgICAgICB9CgogICAgICAgIHZhciByZWZlcmVuY2VUZW1wbGF0ZUxlbmd0aCA9IHJlZmVyZW5jZVRlbXBsYXRlLmxlbmd0aDsKICAgICAgICB2YXIgcmVmZXJlbmNlVGVtcGxhdGVYID0gbmV3IEludDMyQXJyYXkocmVmZXJlbmNlVGVtcGxhdGVMZW5ndGgpOwogICAgICAgIHZhciByZWZlcmVuY2VUZW1wbGF0ZVkgPSBuZXcgSW50MzJBcnJheShyZWZlcmVuY2VUZW1wbGF0ZUxlbmd0aCk7CgogICAgICAgIGZvciAoayA9IDA7IGsgPCByZWZlcmVuY2VUZW1wbGF0ZUxlbmd0aDsgaysrKSB7CiAgICAgICAgICByZWZlcmVuY2VUZW1wbGF0ZVhba10gPSByZWZlcmVuY2VUZW1wbGF0ZVtrXS54OwogICAgICAgICAgcmVmZXJlbmNlVGVtcGxhdGVZW2tdID0gcmVmZXJlbmNlVGVtcGxhdGVba10ueTsKICAgICAgICB9CgogICAgICAgIHZhciByZWZlcmVuY2VXaWR0aCA9IHJlZmVyZW5jZUJpdG1hcFswXS5sZW5ndGg7CiAgICAgICAgdmFyIHJlZmVyZW5jZUhlaWdodCA9IHJlZmVyZW5jZUJpdG1hcC5sZW5ndGg7CiAgICAgICAgdmFyIHBzZXVkb1BpeGVsQ29udGV4dCA9IFJlZmluZW1lbnRSZXVzZWRDb250ZXh0c1t0ZW1wbGF0ZUluZGV4XTsKICAgICAgICB2YXIgYml0bWFwID0gW107CiAgICAgICAgdmFyIGRlY29kZXIgPSBkZWNvZGluZ0NvbnRleHQuZGVjb2RlcjsKICAgICAgICB2YXIgY29udGV4dHMgPSBkZWNvZGluZ0NvbnRleHQuY29udGV4dENhY2hlLmdldENvbnRleHRzKCJHUiIpOwogICAgICAgIHZhciBsdHAgPSAwOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGhlaWdodDsgaSsrKSB7CiAgICAgICAgICBpZiAocHJlZGljdGlvbikgewogICAgICAgICAgICB2YXIgc2x0cCA9IGRlY29kZXIucmVhZEJpdChjb250ZXh0cywgcHNldWRvUGl4ZWxDb250ZXh0KTsKICAgICAgICAgICAgbHRwIF49IHNsdHA7CgogICAgICAgICAgICBpZiAobHRwKSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoInByZWRpY3Rpb24gaXMgbm90IHN1cHBvcnRlZCIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHJvdyA9IG5ldyBVaW50OEFycmF5KHdpZHRoKTsKICAgICAgICAgIGJpdG1hcC5wdXNoKHJvdyk7CgogICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB3aWR0aDsgaisrKSB7CiAgICAgICAgICAgIHZhciBpMCwgajA7CiAgICAgICAgICAgIHZhciBjb250ZXh0TGFiZWwgPSAwOwoKICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IGNvZGluZ1RlbXBsYXRlTGVuZ3RoOyBrKyspIHsKICAgICAgICAgICAgICBpMCA9IGkgKyBjb2RpbmdUZW1wbGF0ZVlba107CiAgICAgICAgICAgICAgajAgPSBqICsgY29kaW5nVGVtcGxhdGVYW2tdOwoKICAgICAgICAgICAgICBpZiAoaTAgPCAwIHx8IGowIDwgMCB8fCBqMCA+PSB3aWR0aCkgewogICAgICAgICAgICAgICAgY29udGV4dExhYmVsIDw8PSAxOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb250ZXh0TGFiZWwgPSBjb250ZXh0TGFiZWwgPDwgMSB8IGJpdG1hcFtpMF1bajBdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IHJlZmVyZW5jZVRlbXBsYXRlTGVuZ3RoOyBrKyspIHsKICAgICAgICAgICAgICBpMCA9IGkgKyByZWZlcmVuY2VUZW1wbGF0ZVlba10gLSBvZmZzZXRZOwogICAgICAgICAgICAgIGowID0gaiArIHJlZmVyZW5jZVRlbXBsYXRlWFtrXSAtIG9mZnNldFg7CgogICAgICAgICAgICAgIGlmIChpMCA8IDAgfHwgaTAgPj0gcmVmZXJlbmNlSGVpZ2h0IHx8IGowIDwgMCB8fCBqMCA+PSByZWZlcmVuY2VXaWR0aCkgewogICAgICAgICAgICAgICAgY29udGV4dExhYmVsIDw8PSAxOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb250ZXh0TGFiZWwgPSBjb250ZXh0TGFiZWwgPDwgMSB8IHJlZmVyZW5jZUJpdG1hcFtpMF1bajBdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHBpeGVsID0gZGVjb2Rlci5yZWFkQml0KGNvbnRleHRzLCBjb250ZXh0TGFiZWwpOwogICAgICAgICAgICByb3dbal0gPSBwaXhlbDsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBiaXRtYXA7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGRlY29kZVN5bWJvbERpY3Rpb25hcnkoaHVmZm1hbiwgcmVmaW5lbWVudCwgc3ltYm9scywgbnVtYmVyT2ZOZXdTeW1ib2xzLCBudW1iZXJPZkV4cG9ydGVkU3ltYm9scywgaHVmZm1hblRhYmxlcywgdGVtcGxhdGVJbmRleCwgYXQsIHJlZmluZW1lbnRUZW1wbGF0ZUluZGV4LCByZWZpbmVtZW50QXQsIGRlY29kaW5nQ29udGV4dCwgaHVmZm1hbklucHV0KSB7CiAgICAgICAgaWYgKGh1ZmZtYW4gJiYgcmVmaW5lbWVudCkgewogICAgICAgICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoInN5bWJvbCByZWZpbmVtZW50IHdpdGggSHVmZm1hbiBpcyBub3Qgc3VwcG9ydGVkIik7CiAgICAgICAgfQoKICAgICAgICB2YXIgbmV3U3ltYm9scyA9IFtdOwogICAgICAgIHZhciBjdXJyZW50SGVpZ2h0ID0gMDsKICAgICAgICB2YXIgc3ltYm9sQ29kZUxlbmd0aCA9ICgwLCBfY29yZV91dGlscy5sb2cyKShzeW1ib2xzLmxlbmd0aCArIG51bWJlck9mTmV3U3ltYm9scyk7CiAgICAgICAgdmFyIGRlY29kZXIgPSBkZWNvZGluZ0NvbnRleHQuZGVjb2RlcjsKICAgICAgICB2YXIgY29udGV4dENhY2hlID0gZGVjb2RpbmdDb250ZXh0LmNvbnRleHRDYWNoZTsKICAgICAgICB2YXIgdGFibGVCMSwgc3ltYm9sV2lkdGhzOwoKICAgICAgICBpZiAoaHVmZm1hbikgewogICAgICAgICAgdGFibGVCMSA9IGdldFN0YW5kYXJkVGFibGUoMSk7CiAgICAgICAgICBzeW1ib2xXaWR0aHMgPSBbXTsKICAgICAgICAgIHN5bWJvbENvZGVMZW5ndGggPSBNYXRoLm1heChzeW1ib2xDb2RlTGVuZ3RoLCAxKTsKICAgICAgICB9CgogICAgICAgIHdoaWxlIChuZXdTeW1ib2xzLmxlbmd0aCA8IG51bWJlck9mTmV3U3ltYm9scykgewogICAgICAgICAgdmFyIGRlbHRhSGVpZ2h0ID0gaHVmZm1hbiA/IGh1ZmZtYW5UYWJsZXMudGFibGVEZWx0YUhlaWdodC5kZWNvZGUoaHVmZm1hbklucHV0KSA6IGRlY29kZUludGVnZXIoY29udGV4dENhY2hlLCAiSUFESCIsIGRlY29kZXIpOwogICAgICAgICAgY3VycmVudEhlaWdodCArPSBkZWx0YUhlaWdodDsKICAgICAgICAgIHZhciBjdXJyZW50V2lkdGggPSAwLAogICAgICAgICAgICB0b3RhbFdpZHRoID0gMDsKICAgICAgICAgIHZhciBmaXJzdFN5bWJvbCA9IGh1ZmZtYW4gPyBzeW1ib2xXaWR0aHMubGVuZ3RoIDogMDsKCiAgICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgICB2YXIgZGVsdGFXaWR0aCA9IGh1ZmZtYW4gPyBodWZmbWFuVGFibGVzLnRhYmxlRGVsdGFXaWR0aC5kZWNvZGUoaHVmZm1hbklucHV0KSA6IGRlY29kZUludGVnZXIoY29udGV4dENhY2hlLCAiSUFEVyIsIGRlY29kZXIpOwoKICAgICAgICAgICAgaWYgKGRlbHRhV2lkdGggPT09IG51bGwpIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY3VycmVudFdpZHRoICs9IGRlbHRhV2lkdGg7CiAgICAgICAgICAgIHRvdGFsV2lkdGggKz0gY3VycmVudFdpZHRoOwogICAgICAgICAgICB2YXIgYml0bWFwOwoKICAgICAgICAgICAgaWYgKHJlZmluZW1lbnQpIHsKICAgICAgICAgICAgICB2YXIgbnVtYmVyT2ZJbnN0YW5jZXMgPSBkZWNvZGVJbnRlZ2VyKGNvbnRleHRDYWNoZSwgIklBQUkiLCBkZWNvZGVyKTsKCiAgICAgICAgICAgICAgaWYgKG51bWJlck9mSW5zdGFuY2VzID4gMSkgewogICAgICAgICAgICAgICAgYml0bWFwID0gZGVjb2RlVGV4dFJlZ2lvbihodWZmbWFuLCByZWZpbmVtZW50LCBjdXJyZW50V2lkdGgsIGN1cnJlbnRIZWlnaHQsIDAsIG51bWJlck9mSW5zdGFuY2VzLCAxLCBzeW1ib2xzLmNvbmNhdChuZXdTeW1ib2xzKSwgc3ltYm9sQ29kZUxlbmd0aCwgMCwgMCwgMSwgMCwgaHVmZm1hblRhYmxlcywgcmVmaW5lbWVudFRlbXBsYXRlSW5kZXgsIHJlZmluZW1lbnRBdCwgZGVjb2RpbmdDb250ZXh0LCAwLCBodWZmbWFuSW5wdXQpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB2YXIgc3ltYm9sSWQgPSBkZWNvZGVJQUlEKGNvbnRleHRDYWNoZSwgZGVjb2Rlciwgc3ltYm9sQ29kZUxlbmd0aCk7CiAgICAgICAgICAgICAgICB2YXIgcmR4ID0gZGVjb2RlSW50ZWdlcihjb250ZXh0Q2FjaGUsICJJQVJEWCIsIGRlY29kZXIpOwogICAgICAgICAgICAgICAgdmFyIHJkeSA9IGRlY29kZUludGVnZXIoY29udGV4dENhY2hlLCAiSUFSRFkiLCBkZWNvZGVyKTsKICAgICAgICAgICAgICAgIHZhciBzeW1ib2wgPSBzeW1ib2xJZCA8IHN5bWJvbHMubGVuZ3RoID8gc3ltYm9sc1tzeW1ib2xJZF0gOiBuZXdTeW1ib2xzW3N5bWJvbElkIC0gc3ltYm9scy5sZW5ndGhdOwogICAgICAgICAgICAgICAgYml0bWFwID0gZGVjb2RlUmVmaW5lbWVudChjdXJyZW50V2lkdGgsIGN1cnJlbnRIZWlnaHQsIHJlZmluZW1lbnRUZW1wbGF0ZUluZGV4LCBzeW1ib2wsIHJkeCwgcmR5LCBmYWxzZSwgcmVmaW5lbWVudEF0LCBkZWNvZGluZ0NvbnRleHQpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgbmV3U3ltYm9scy5wdXNoKGJpdG1hcCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaHVmZm1hbikgewogICAgICAgICAgICAgIHN5bWJvbFdpZHRocy5wdXNoKGN1cnJlbnRXaWR0aCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgYml0bWFwID0gZGVjb2RlQml0bWFwKGZhbHNlLCBjdXJyZW50V2lkdGgsIGN1cnJlbnRIZWlnaHQsIHRlbXBsYXRlSW5kZXgsIGZhbHNlLCBudWxsLCBhdCwgZGVjb2RpbmdDb250ZXh0KTsKICAgICAgICAgICAgICBuZXdTeW1ib2xzLnB1c2goYml0bWFwKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmIChodWZmbWFuICYmICFyZWZpbmVtZW50KSB7CiAgICAgICAgICAgIHZhciBiaXRtYXBTaXplID0gaHVmZm1hblRhYmxlcy50YWJsZUJpdG1hcFNpemUuZGVjb2RlKGh1ZmZtYW5JbnB1dCk7CiAgICAgICAgICAgIGh1ZmZtYW5JbnB1dC5ieXRlQWxpZ24oKTsKICAgICAgICAgICAgdmFyIGNvbGxlY3RpdmVCaXRtYXAgPSB2b2lkIDA7CgogICAgICAgICAgICBpZiAoYml0bWFwU2l6ZSA9PT0gMCkgewogICAgICAgICAgICAgIGNvbGxlY3RpdmVCaXRtYXAgPSByZWFkVW5jb21wcmVzc2VkQml0bWFwKGh1ZmZtYW5JbnB1dCwgdG90YWxXaWR0aCwgY3VycmVudEhlaWdodCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdmFyIG9yaWdpbmFsRW5kID0gaHVmZm1hbklucHV0LmVuZDsKICAgICAgICAgICAgICB2YXIgYml0bWFwRW5kID0gaHVmZm1hbklucHV0LnBvc2l0aW9uICsgYml0bWFwU2l6ZTsKICAgICAgICAgICAgICBodWZmbWFuSW5wdXQuZW5kID0gYml0bWFwRW5kOwogICAgICAgICAgICAgIGNvbGxlY3RpdmVCaXRtYXAgPSBkZWNvZGVNTVJCaXRtYXAoaHVmZm1hbklucHV0LCB0b3RhbFdpZHRoLCBjdXJyZW50SGVpZ2h0LCBmYWxzZSk7CiAgICAgICAgICAgICAgaHVmZm1hbklucHV0LmVuZCA9IG9yaWdpbmFsRW5kOwogICAgICAgICAgICAgIGh1ZmZtYW5JbnB1dC5wb3NpdGlvbiA9IGJpdG1hcEVuZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIG51bWJlck9mU3ltYm9sc0RlY29kZWQgPSBzeW1ib2xXaWR0aHMubGVuZ3RoOwoKICAgICAgICAgICAgaWYgKGZpcnN0U3ltYm9sID09PSBudW1iZXJPZlN5bWJvbHNEZWNvZGVkIC0gMSkgewogICAgICAgICAgICAgIG5ld1N5bWJvbHMucHVzaChjb2xsZWN0aXZlQml0bWFwKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB2YXIgX2kgPSB2b2lkIDAsCiAgICAgICAgICAgICAgICB5ID0gdm9pZCAwLAogICAgICAgICAgICAgICAgeE1pbiA9IDAsCiAgICAgICAgICAgICAgICB4TWF4ID0gdm9pZCAwLAogICAgICAgICAgICAgICAgYml0bWFwV2lkdGggPSB2b2lkIDAsCiAgICAgICAgICAgICAgICBzeW1ib2xCaXRtYXAgPSB2b2lkIDA7CgogICAgICAgICAgICAgIGZvciAoX2kgPSBmaXJzdFN5bWJvbDsgX2kgPCBudW1iZXJPZlN5bWJvbHNEZWNvZGVkOyBfaSsrKSB7CiAgICAgICAgICAgICAgICBiaXRtYXBXaWR0aCA9IHN5bWJvbFdpZHRoc1tfaV07CiAgICAgICAgICAgICAgICB4TWF4ID0geE1pbiArIGJpdG1hcFdpZHRoOwogICAgICAgICAgICAgICAgc3ltYm9sQml0bWFwID0gW107CgogICAgICAgICAgICAgICAgZm9yICh5ID0gMDsgeSA8IGN1cnJlbnRIZWlnaHQ7IHkrKykgewogICAgICAgICAgICAgICAgICBzeW1ib2xCaXRtYXAucHVzaChjb2xsZWN0aXZlQml0bWFwW3ldLnN1YmFycmF5KHhNaW4sIHhNYXgpKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBuZXdTeW1ib2xzLnB1c2goc3ltYm9sQml0bWFwKTsKICAgICAgICAgICAgICAgIHhNaW4gPSB4TWF4OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFyIGV4cG9ydGVkU3ltYm9scyA9IFtdOwogICAgICAgIHZhciBmbGFncyA9IFtdLAogICAgICAgICAgY3VycmVudEZsYWcgPSBmYWxzZTsKICAgICAgICB2YXIgdG90YWxTeW1ib2xzTGVuZ3RoID0gc3ltYm9scy5sZW5ndGggKyBudW1iZXJPZk5ld1N5bWJvbHM7CgogICAgICAgIHdoaWxlIChmbGFncy5sZW5ndGggPCB0b3RhbFN5bWJvbHNMZW5ndGgpIHsKICAgICAgICAgIHZhciBydW5MZW5ndGggPSBodWZmbWFuID8gdGFibGVCMS5kZWNvZGUoaHVmZm1hbklucHV0KSA6IGRlY29kZUludGVnZXIoY29udGV4dENhY2hlLCAiSUFFWCIsIGRlY29kZXIpOwoKICAgICAgICAgIHdoaWxlIChydW5MZW5ndGgtLSkgewogICAgICAgICAgICBmbGFncy5wdXNoKGN1cnJlbnRGbGFnKTsKICAgICAgICAgIH0KCiAgICAgICAgICBjdXJyZW50RmxhZyA9ICFjdXJyZW50RmxhZzsKICAgICAgICB9CgogICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IHN5bWJvbHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgaWYgKGZsYWdzW2ldKSB7CiAgICAgICAgICAgIGV4cG9ydGVkU3ltYm9scy5wdXNoKHN5bWJvbHNbaV0pOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBudW1iZXJPZk5ld1N5bWJvbHM7IGkrKywgaisrKSB7CiAgICAgICAgICBpZiAoZmxhZ3NbaV0pIHsKICAgICAgICAgICAgZXhwb3J0ZWRTeW1ib2xzLnB1c2gobmV3U3ltYm9sc1tqXSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZXhwb3J0ZWRTeW1ib2xzOwogICAgICB9CgogICAgICBmdW5jdGlvbiBkZWNvZGVUZXh0UmVnaW9uKGh1ZmZtYW4sIHJlZmluZW1lbnQsIHdpZHRoLCBoZWlnaHQsIGRlZmF1bHRQaXhlbFZhbHVlLCBudW1iZXJPZlN5bWJvbEluc3RhbmNlcywgc3RyaXBTaXplLCBpbnB1dFN5bWJvbHMsIHN5bWJvbENvZGVMZW5ndGgsIHRyYW5zcG9zZWQsIGRzT2Zmc2V0LCByZWZlcmVuY2VDb3JuZXIsIGNvbWJpbmF0aW9uT3BlcmF0b3IsIGh1ZmZtYW5UYWJsZXMsIHJlZmluZW1lbnRUZW1wbGF0ZUluZGV4LCByZWZpbmVtZW50QXQsIGRlY29kaW5nQ29udGV4dCwgbG9nU3RyaXBTaXplLCBodWZmbWFuSW5wdXQpIHsKICAgICAgICBpZiAoaHVmZm1hbiAmJiByZWZpbmVtZW50KSB7CiAgICAgICAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcigicmVmaW5lbWVudCB3aXRoIEh1ZmZtYW4gaXMgbm90IHN1cHBvcnRlZCIpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGJpdG1hcCA9IFtdOwogICAgICAgIHZhciBpLCByb3c7CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBoZWlnaHQ7IGkrKykgewogICAgICAgICAgcm93ID0gbmV3IFVpbnQ4QXJyYXkod2lkdGgpOwoKICAgICAgICAgIGlmIChkZWZhdWx0UGl4ZWxWYWx1ZSkgewogICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHdpZHRoOyBqKyspIHsKICAgICAgICAgICAgICByb3dbal0gPSBkZWZhdWx0UGl4ZWxWYWx1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGJpdG1hcC5wdXNoKHJvdyk7CiAgICAgICAgfQoKICAgICAgICB2YXIgZGVjb2RlciA9IGRlY29kaW5nQ29udGV4dC5kZWNvZGVyOwogICAgICAgIHZhciBjb250ZXh0Q2FjaGUgPSBkZWNvZGluZ0NvbnRleHQuY29udGV4dENhY2hlOwogICAgICAgIHZhciBzdHJpcFQgPSBodWZmbWFuID8gLWh1ZmZtYW5UYWJsZXMudGFibGVEZWx0YVQuZGVjb2RlKGh1ZmZtYW5JbnB1dCkgOiAtZGVjb2RlSW50ZWdlcihjb250ZXh0Q2FjaGUsICJJQURUIiwgZGVjb2Rlcik7CiAgICAgICAgdmFyIGZpcnN0UyA9IDA7CiAgICAgICAgaSA9IDA7CgogICAgICAgIHdoaWxlIChpIDwgbnVtYmVyT2ZTeW1ib2xJbnN0YW5jZXMpIHsKICAgICAgICAgIHZhciBkZWx0YVQgPSBodWZmbWFuID8gaHVmZm1hblRhYmxlcy50YWJsZURlbHRhVC5kZWNvZGUoaHVmZm1hbklucHV0KSA6IGRlY29kZUludGVnZXIoY29udGV4dENhY2hlLCAiSUFEVCIsIGRlY29kZXIpOwogICAgICAgICAgc3RyaXBUICs9IGRlbHRhVDsKICAgICAgICAgIHZhciBkZWx0YUZpcnN0UyA9IGh1ZmZtYW4gPyBodWZmbWFuVGFibGVzLnRhYmxlRmlyc3RTLmRlY29kZShodWZmbWFuSW5wdXQpIDogZGVjb2RlSW50ZWdlcihjb250ZXh0Q2FjaGUsICJJQUZTIiwgZGVjb2Rlcik7CiAgICAgICAgICBmaXJzdFMgKz0gZGVsdGFGaXJzdFM7CiAgICAgICAgICB2YXIgY3VycmVudFMgPSBmaXJzdFM7CgogICAgICAgICAgZG8gewogICAgICAgICAgICB2YXIgY3VycmVudFQgPSAwOwoKICAgICAgICAgICAgaWYgKHN0cmlwU2l6ZSA+IDEpIHsKICAgICAgICAgICAgICBjdXJyZW50VCA9IGh1ZmZtYW4gPyBodWZmbWFuSW5wdXQucmVhZEJpdHMobG9nU3RyaXBTaXplKSA6IGRlY29kZUludGVnZXIoY29udGV4dENhY2hlLCAiSUFJVCIsIGRlY29kZXIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgdCA9IHN0cmlwU2l6ZSAqIHN0cmlwVCArIGN1cnJlbnRUOwogICAgICAgICAgICB2YXIgc3ltYm9sSWQgPSBodWZmbWFuID8gaHVmZm1hblRhYmxlcy5zeW1ib2xJRFRhYmxlLmRlY29kZShodWZmbWFuSW5wdXQpIDogZGVjb2RlSUFJRChjb250ZXh0Q2FjaGUsIGRlY29kZXIsIHN5bWJvbENvZGVMZW5ndGgpOwogICAgICAgICAgICB2YXIgYXBwbHlSZWZpbmVtZW50ID0gcmVmaW5lbWVudCAmJiAoaHVmZm1hbiA/IGh1ZmZtYW5JbnB1dC5yZWFkQml0KCkgOiBkZWNvZGVJbnRlZ2VyKGNvbnRleHRDYWNoZSwgIklBUkkiLCBkZWNvZGVyKSk7CiAgICAgICAgICAgIHZhciBzeW1ib2xCaXRtYXAgPSBpbnB1dFN5bWJvbHNbc3ltYm9sSWRdOwogICAgICAgICAgICB2YXIgc3ltYm9sV2lkdGggPSBzeW1ib2xCaXRtYXBbMF0ubGVuZ3RoOwogICAgICAgICAgICB2YXIgc3ltYm9sSGVpZ2h0ID0gc3ltYm9sQml0bWFwLmxlbmd0aDsKCiAgICAgICAgICAgIGlmIChhcHBseVJlZmluZW1lbnQpIHsKICAgICAgICAgICAgICB2YXIgcmR3ID0gZGVjb2RlSW50ZWdlcihjb250ZXh0Q2FjaGUsICJJQVJEVyIsIGRlY29kZXIpOwogICAgICAgICAgICAgIHZhciByZGggPSBkZWNvZGVJbnRlZ2VyKGNvbnRleHRDYWNoZSwgIklBUkRIIiwgZGVjb2Rlcik7CiAgICAgICAgICAgICAgdmFyIHJkeCA9IGRlY29kZUludGVnZXIoY29udGV4dENhY2hlLCAiSUFSRFgiLCBkZWNvZGVyKTsKICAgICAgICAgICAgICB2YXIgcmR5ID0gZGVjb2RlSW50ZWdlcihjb250ZXh0Q2FjaGUsICJJQVJEWSIsIGRlY29kZXIpOwogICAgICAgICAgICAgIHN5bWJvbFdpZHRoICs9IHJkdzsKICAgICAgICAgICAgICBzeW1ib2xIZWlnaHQgKz0gcmRoOwogICAgICAgICAgICAgIHN5bWJvbEJpdG1hcCA9IGRlY29kZVJlZmluZW1lbnQoc3ltYm9sV2lkdGgsIHN5bWJvbEhlaWdodCwgcmVmaW5lbWVudFRlbXBsYXRlSW5kZXgsIHN5bWJvbEJpdG1hcCwgKHJkdyA+PiAxKSArIHJkeCwgKHJkaCA+PiAxKSArIHJkeSwgZmFsc2UsIHJlZmluZW1lbnRBdCwgZGVjb2RpbmdDb250ZXh0KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIG9mZnNldFQgPSB0IC0gKHJlZmVyZW5jZUNvcm5lciAmIDEgPyAwIDogc3ltYm9sSGVpZ2h0IC0gMSk7CiAgICAgICAgICAgIHZhciBvZmZzZXRTID0gY3VycmVudFMgLSAocmVmZXJlbmNlQ29ybmVyICYgMiA/IHN5bWJvbFdpZHRoIC0gMSA6IDApOwogICAgICAgICAgICB2YXIgczIsIHQyLCBzeW1ib2xSb3c7CgogICAgICAgICAgICBpZiAodHJhbnNwb3NlZCkgewogICAgICAgICAgICAgIGZvciAoczIgPSAwOyBzMiA8IHN5bWJvbEhlaWdodDsgczIrKykgewogICAgICAgICAgICAgICAgcm93ID0gYml0bWFwW29mZnNldFMgKyBzMl07CgogICAgICAgICAgICAgICAgaWYgKCFyb3cpIHsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgc3ltYm9sUm93ID0gc3ltYm9sQml0bWFwW3MyXTsKICAgICAgICAgICAgICAgIHZhciBtYXhXaWR0aCA9IE1hdGgubWluKHdpZHRoIC0gb2Zmc2V0VCwgc3ltYm9sV2lkdGgpOwoKICAgICAgICAgICAgICAgIHN3aXRjaCAoY29tYmluYXRpb25PcGVyYXRvcikgewogICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgZm9yICh0MiA9IDA7IHQyIDwgbWF4V2lkdGg7IHQyKyspIHsKICAgICAgICAgICAgICAgICAgICAgIHJvd1tvZmZzZXRUICsgdDJdIHw9IHN5bWJvbFJvd1t0Ml07CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICBmb3IgKHQyID0gMDsgdDIgPCBtYXhXaWR0aDsgdDIrKykgewogICAgICAgICAgICAgICAgICAgICAgcm93W29mZnNldFQgKyB0Ml0gXj0gc3ltYm9sUm93W3QyXTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcigib3BlcmF0b3IgIi5jb25jYXQoY29tYmluYXRpb25PcGVyYXRvciwgIiBpcyBub3Qgc3VwcG9ydGVkIikpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY3VycmVudFMgKz0gc3ltYm9sSGVpZ2h0IC0gMTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBmb3IgKHQyID0gMDsgdDIgPCBzeW1ib2xIZWlnaHQ7IHQyKyspIHsKICAgICAgICAgICAgICAgIHJvdyA9IGJpdG1hcFtvZmZzZXRUICsgdDJdOwoKICAgICAgICAgICAgICAgIGlmICghcm93KSB7CiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHN5bWJvbFJvdyA9IHN5bWJvbEJpdG1hcFt0Ml07CgogICAgICAgICAgICAgICAgc3dpdGNoIChjb21iaW5hdGlvbk9wZXJhdG9yKSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICBmb3IgKHMyID0gMDsgczIgPCBzeW1ib2xXaWR0aDsgczIrKykgewogICAgICAgICAgICAgICAgICAgICAgcm93W29mZnNldFMgKyBzMl0gfD0gc3ltYm9sUm93W3MyXTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgIGZvciAoczIgPSAwOyBzMiA8IHN5bWJvbFdpZHRoOyBzMisrKSB7CiAgICAgICAgICAgICAgICAgICAgICByb3dbb2Zmc2V0UyArIHMyXSBePSBzeW1ib2xSb3dbczJdOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKCJvcGVyYXRvciAiLmNvbmNhdChjb21iaW5hdGlvbk9wZXJhdG9yLCAiIGlzIG5vdCBzdXBwb3J0ZWQiKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjdXJyZW50UyArPSBzeW1ib2xXaWR0aCAtIDE7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGkrKzsKICAgICAgICAgICAgdmFyIGRlbHRhUyA9IGh1ZmZtYW4gPyBodWZmbWFuVGFibGVzLnRhYmxlRGVsdGFTLmRlY29kZShodWZmbWFuSW5wdXQpIDogZGVjb2RlSW50ZWdlcihjb250ZXh0Q2FjaGUsICJJQURTIiwgZGVjb2Rlcik7CgogICAgICAgICAgICBpZiAoZGVsdGFTID09PSBudWxsKSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGN1cnJlbnRTICs9IGRlbHRhUyArIGRzT2Zmc2V0OwogICAgICAgICAgfSB3aGlsZSAodHJ1ZSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYml0bWFwOwogICAgICB9CgogICAgICBmdW5jdGlvbiBkZWNvZGVQYXR0ZXJuRGljdGlvbmFyeShtbXIsIHBhdHRlcm5XaWR0aCwgcGF0dGVybkhlaWdodCwgbWF4UGF0dGVybkluZGV4LCB0ZW1wbGF0ZSwgZGVjb2RpbmdDb250ZXh0KSB7CiAgICAgICAgdmFyIGF0ID0gW107CgogICAgICAgIGlmICghbW1yKSB7CiAgICAgICAgICBhdC5wdXNoKHsKICAgICAgICAgICAgeDogLXBhdHRlcm5XaWR0aCwKICAgICAgICAgICAgeTogMAogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKHRlbXBsYXRlID09PSAwKSB7CiAgICAgICAgICAgIGF0LnB1c2goewogICAgICAgICAgICAgIHg6IC0zLAogICAgICAgICAgICAgIHk6IC0xCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBhdC5wdXNoKHsKICAgICAgICAgICAgICB4OiAyLAogICAgICAgICAgICAgIHk6IC0yCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBhdC5wdXNoKHsKICAgICAgICAgICAgICB4OiAtMiwKICAgICAgICAgICAgICB5OiAtMgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHZhciBjb2xsZWN0aXZlV2lkdGggPSAobWF4UGF0dGVybkluZGV4ICsgMSkgKiBwYXR0ZXJuV2lkdGg7CiAgICAgICAgdmFyIGNvbGxlY3RpdmVCaXRtYXAgPSBkZWNvZGVCaXRtYXAobW1yLCBjb2xsZWN0aXZlV2lkdGgsIHBhdHRlcm5IZWlnaHQsIHRlbXBsYXRlLCBmYWxzZSwgbnVsbCwgYXQsIGRlY29kaW5nQ29udGV4dCk7CiAgICAgICAgdmFyIHBhdHRlcm5zID0gW107CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDw9IG1heFBhdHRlcm5JbmRleDsgaSsrKSB7CiAgICAgICAgICB2YXIgcGF0dGVybkJpdG1hcCA9IFtdOwogICAgICAgICAgdmFyIHhNaW4gPSBwYXR0ZXJuV2lkdGggKiBpOwogICAgICAgICAgdmFyIHhNYXggPSB4TWluICsgcGF0dGVybldpZHRoOwoKICAgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgcGF0dGVybkhlaWdodDsgeSsrKSB7CiAgICAgICAgICAgIHBhdHRlcm5CaXRtYXAucHVzaChjb2xsZWN0aXZlQml0bWFwW3ldLnN1YmFycmF5KHhNaW4sIHhNYXgpKTsKICAgICAgICAgIH0KCiAgICAgICAgICBwYXR0ZXJucy5wdXNoKHBhdHRlcm5CaXRtYXApOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHBhdHRlcm5zOwogICAgICB9CgogICAgICBmdW5jdGlvbiBkZWNvZGVIYWxmdG9uZVJlZ2lvbihtbXIsIHBhdHRlcm5zLCB0ZW1wbGF0ZSwgcmVnaW9uV2lkdGgsIHJlZ2lvbkhlaWdodCwgZGVmYXVsdFBpeGVsVmFsdWUsIGVuYWJsZVNraXAsIGNvbWJpbmF0aW9uT3BlcmF0b3IsIGdyaWRXaWR0aCwgZ3JpZEhlaWdodCwgZ3JpZE9mZnNldFgsIGdyaWRPZmZzZXRZLCBncmlkVmVjdG9yWCwgZ3JpZFZlY3RvclksIGRlY29kaW5nQ29udGV4dCkgewogICAgICAgIHZhciBza2lwID0gbnVsbDsKCiAgICAgICAgaWYgKGVuYWJsZVNraXApIHsKICAgICAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKCJza2lwIGlzIG5vdCBzdXBwb3J0ZWQiKTsKICAgICAgICB9CgogICAgICAgIGlmIChjb21iaW5hdGlvbk9wZXJhdG9yICE9PSAwKSB7CiAgICAgICAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcigib3BlcmF0b3IgIiArIGNvbWJpbmF0aW9uT3BlcmF0b3IgKyAiIGlzIG5vdCBzdXBwb3J0ZWQgaW4gaGFsZnRvbmUgcmVnaW9uIik7CiAgICAgICAgfQoKICAgICAgICB2YXIgcmVnaW9uQml0bWFwID0gW107CiAgICAgICAgdmFyIGksIGosIHJvdzsKCiAgICAgICAgZm9yIChpID0gMDsgaSA8IHJlZ2lvbkhlaWdodDsgaSsrKSB7CiAgICAgICAgICByb3cgPSBuZXcgVWludDhBcnJheShyZWdpb25XaWR0aCk7CgogICAgICAgICAgaWYgKGRlZmF1bHRQaXhlbFZhbHVlKSB7CiAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCByZWdpb25XaWR0aDsgaisrKSB7CiAgICAgICAgICAgICAgcm93W2pdID0gZGVmYXVsdFBpeGVsVmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZWdpb25CaXRtYXAucHVzaChyb3cpOwogICAgICAgIH0KCiAgICAgICAgdmFyIG51bWJlck9mUGF0dGVybnMgPSBwYXR0ZXJucy5sZW5ndGg7CiAgICAgICAgdmFyIHBhdHRlcm4wID0gcGF0dGVybnNbMF07CiAgICAgICAgdmFyIHBhdHRlcm5XaWR0aCA9IHBhdHRlcm4wWzBdLmxlbmd0aCwKICAgICAgICAgIHBhdHRlcm5IZWlnaHQgPSBwYXR0ZXJuMC5sZW5ndGg7CiAgICAgICAgdmFyIGJpdHNQZXJWYWx1ZSA9ICgwLCBfY29yZV91dGlscy5sb2cyKShudW1iZXJPZlBhdHRlcm5zKTsKICAgICAgICB2YXIgYXQgPSBbXTsKCiAgICAgICAgaWYgKCFtbXIpIHsKICAgICAgICAgIGF0LnB1c2goewogICAgICAgICAgICB4OiB0ZW1wbGF0ZSA8PSAxID8gMyA6IDIsCiAgICAgICAgICAgIHk6IC0xCiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAodGVtcGxhdGUgPT09IDApIHsKICAgICAgICAgICAgYXQucHVzaCh7CiAgICAgICAgICAgICAgeDogLTMsCiAgICAgICAgICAgICAgeTogLTEKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGF0LnB1c2goewogICAgICAgICAgICAgIHg6IDIsCiAgICAgICAgICAgICAgeTogLTIKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGF0LnB1c2goewogICAgICAgICAgICAgIHg6IC0yLAogICAgICAgICAgICAgIHk6IC0yCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFyIGdyYXlTY2FsZUJpdFBsYW5lcyA9IFtdOwogICAgICAgIHZhciBtbXJJbnB1dCwgYml0bWFwOwoKICAgICAgICBpZiAobW1yKSB7CiAgICAgICAgICBtbXJJbnB1dCA9IG5ldyBSZWFkZXIoZGVjb2RpbmdDb250ZXh0LmRhdGEsIGRlY29kaW5nQ29udGV4dC5zdGFydCwgZGVjb2RpbmdDb250ZXh0LmVuZCk7CiAgICAgICAgfQoKICAgICAgICBmb3IgKGkgPSBiaXRzUGVyVmFsdWUgLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgaWYgKG1tcikgewogICAgICAgICAgICBiaXRtYXAgPSBkZWNvZGVNTVJCaXRtYXAobW1ySW5wdXQsIGdyaWRXaWR0aCwgZ3JpZEhlaWdodCwgdHJ1ZSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBiaXRtYXAgPSBkZWNvZGVCaXRtYXAoZmFsc2UsIGdyaWRXaWR0aCwgZ3JpZEhlaWdodCwgdGVtcGxhdGUsIGZhbHNlLCBza2lwLCBhdCwgZGVjb2RpbmdDb250ZXh0KTsKICAgICAgICAgIH0KCiAgICAgICAgICBncmF5U2NhbGVCaXRQbGFuZXNbaV0gPSBiaXRtYXA7CiAgICAgICAgfQoKICAgICAgICB2YXIgbWcsIG5nLCBiaXQsIHBhdHRlcm5JbmRleCwgcGF0dGVybkJpdG1hcCwgeCwgeSwgcGF0dGVyblJvdywgcmVnaW9uUm93OwoKICAgICAgICBmb3IgKG1nID0gMDsgbWcgPCBncmlkSGVpZ2h0OyBtZysrKSB7CiAgICAgICAgICBmb3IgKG5nID0gMDsgbmcgPCBncmlkV2lkdGg7IG5nKyspIHsKICAgICAgICAgICAgYml0ID0gMDsKICAgICAgICAgICAgcGF0dGVybkluZGV4ID0gMDsKCiAgICAgICAgICAgIGZvciAoaiA9IGJpdHNQZXJWYWx1ZSAtIDE7IGogPj0gMDsgai0tKSB7CiAgICAgICAgICAgICAgYml0ID0gZ3JheVNjYWxlQml0UGxhbmVzW2pdW21nXVtuZ10gXiBiaXQ7CiAgICAgICAgICAgICAgcGF0dGVybkluZGV4IHw9IGJpdCA8PCBqOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwYXR0ZXJuQml0bWFwID0gcGF0dGVybnNbcGF0dGVybkluZGV4XTsKICAgICAgICAgICAgeCA9IGdyaWRPZmZzZXRYICsgbWcgKiBncmlkVmVjdG9yWSArIG5nICogZ3JpZFZlY3RvclggPj4gODsKICAgICAgICAgICAgeSA9IGdyaWRPZmZzZXRZICsgbWcgKiBncmlkVmVjdG9yWCAtIG5nICogZ3JpZFZlY3RvclkgPj4gODsKCiAgICAgICAgICAgIGlmICh4ID49IDAgJiYgeCArIHBhdHRlcm5XaWR0aCA8PSByZWdpb25XaWR0aCAmJiB5ID49IDAgJiYgeSArIHBhdHRlcm5IZWlnaHQgPD0gcmVnaW9uSGVpZ2h0KSB7CiAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHBhdHRlcm5IZWlnaHQ7IGkrKykgewogICAgICAgICAgICAgICAgcmVnaW9uUm93ID0gcmVnaW9uQml0bWFwW3kgKyBpXTsKICAgICAgICAgICAgICAgIHBhdHRlcm5Sb3cgPSBwYXR0ZXJuQml0bWFwW2ldOwoKICAgICAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBwYXR0ZXJuV2lkdGg7IGorKykgewogICAgICAgICAgICAgICAgICByZWdpb25Sb3dbeCArIGpdIHw9IHBhdHRlcm5Sb3dbal07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHZhciByZWdpb25YID0gdm9pZCAwLAogICAgICAgICAgICAgICAgcmVnaW9uWSA9IHZvaWQgMDsKCiAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHBhdHRlcm5IZWlnaHQ7IGkrKykgewogICAgICAgICAgICAgICAgcmVnaW9uWSA9IHkgKyBpOwoKICAgICAgICAgICAgICAgIGlmIChyZWdpb25ZIDwgMCB8fCByZWdpb25ZID49IHJlZ2lvbkhlaWdodCkgewogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZWdpb25Sb3cgPSByZWdpb25CaXRtYXBbcmVnaW9uWV07CiAgICAgICAgICAgICAgICBwYXR0ZXJuUm93ID0gcGF0dGVybkJpdG1hcFtpXTsKCiAgICAgICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgcGF0dGVybldpZHRoOyBqKyspIHsKICAgICAgICAgICAgICAgICAgcmVnaW9uWCA9IHggKyBqOwoKICAgICAgICAgICAgICAgICAgaWYgKHJlZ2lvblggPj0gMCAmJiByZWdpb25YIDwgcmVnaW9uV2lkdGgpIHsKICAgICAgICAgICAgICAgICAgICByZWdpb25Sb3dbcmVnaW9uWF0gfD0gcGF0dGVyblJvd1tqXTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJlZ2lvbkJpdG1hcDsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gcmVhZFNlZ21lbnRIZWFkZXIoZGF0YSwgc3RhcnQpIHsKICAgICAgICB2YXIgc2VnbWVudEhlYWRlciA9IHt9OwogICAgICAgIHNlZ21lbnRIZWFkZXIubnVtYmVyID0gKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MzIpKGRhdGEsIHN0YXJ0KTsKICAgICAgICB2YXIgZmxhZ3MgPSBkYXRhW3N0YXJ0ICsgNF07CiAgICAgICAgdmFyIHNlZ21lbnRUeXBlID0gZmxhZ3MgJiAweDNmOwoKICAgICAgICBpZiAoIVNlZ21lbnRUeXBlc1tzZWdtZW50VHlwZV0pIHsKICAgICAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKCJpbnZhbGlkIHNlZ21lbnQgdHlwZTogIiArIHNlZ21lbnRUeXBlKTsKICAgICAgICB9CgogICAgICAgIHNlZ21lbnRIZWFkZXIudHlwZSA9IHNlZ21lbnRUeXBlOwogICAgICAgIHNlZ21lbnRIZWFkZXIudHlwZU5hbWUgPSBTZWdtZW50VHlwZXNbc2VnbWVudFR5cGVdOwogICAgICAgIHNlZ21lbnRIZWFkZXIuZGVmZXJyZWROb25SZXRhaW4gPSAhIShmbGFncyAmIDB4ODApOwogICAgICAgIHZhciBwYWdlQXNzb2NpYXRpb25GaWVsZFNpemUgPSAhIShmbGFncyAmIDB4NDApOwogICAgICAgIHZhciByZWZlcnJlZEZsYWdzID0gZGF0YVtzdGFydCArIDVdOwogICAgICAgIHZhciByZWZlcnJlZFRvQ291bnQgPSByZWZlcnJlZEZsYWdzID4+IDUgJiA3OwogICAgICAgIHZhciByZXRhaW5CaXRzID0gW3JlZmVycmVkRmxhZ3MgJiAzMV07CiAgICAgICAgdmFyIHBvc2l0aW9uID0gc3RhcnQgKyA2OwoKICAgICAgICBpZiAocmVmZXJyZWRGbGFncyA9PT0gNykgewogICAgICAgICAgcmVmZXJyZWRUb0NvdW50ID0gKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MzIpKGRhdGEsIHBvc2l0aW9uIC0gMSkgJiAweDFmZmZmZmZmOwogICAgICAgICAgcG9zaXRpb24gKz0gMzsKICAgICAgICAgIHZhciBieXRlcyA9IHJlZmVycmVkVG9Db3VudCArIDcgPj4gMzsKICAgICAgICAgIHJldGFpbkJpdHNbMF0gPSBkYXRhW3Bvc2l0aW9uKytdOwoKICAgICAgICAgIHdoaWxlICgtLWJ5dGVzID4gMCkgewogICAgICAgICAgICByZXRhaW5CaXRzLnB1c2goZGF0YVtwb3NpdGlvbisrXSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChyZWZlcnJlZEZsYWdzID09PSA1IHx8IHJlZmVycmVkRmxhZ3MgPT09IDYpIHsKICAgICAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKCJpbnZhbGlkIHJlZmVycmVkLXRvIGZsYWdzIik7CiAgICAgICAgfQoKICAgICAgICBzZWdtZW50SGVhZGVyLnJldGFpbkJpdHMgPSByZXRhaW5CaXRzOwogICAgICAgIHZhciByZWZlcnJlZFRvU2VnbWVudE51bWJlclNpemUgPSA0OwoKICAgICAgICBpZiAoc2VnbWVudEhlYWRlci5udW1iZXIgPD0gMjU2KSB7CiAgICAgICAgICByZWZlcnJlZFRvU2VnbWVudE51bWJlclNpemUgPSAxOwogICAgICAgIH0gZWxzZSBpZiAoc2VnbWVudEhlYWRlci5udW1iZXIgPD0gNjU1MzYpIHsKICAgICAgICAgIHJlZmVycmVkVG9TZWdtZW50TnVtYmVyU2l6ZSA9IDI7CiAgICAgICAgfQoKICAgICAgICB2YXIgcmVmZXJyZWRUbyA9IFtdOwogICAgICAgIHZhciBpLCBpaTsKCiAgICAgICAgZm9yIChpID0gMDsgaSA8IHJlZmVycmVkVG9Db3VudDsgaSsrKSB7CiAgICAgICAgICB2YXIgbnVtYmVyID0gdm9pZCAwOwoKICAgICAgICAgIGlmIChyZWZlcnJlZFRvU2VnbWVudE51bWJlclNpemUgPT09IDEpIHsKICAgICAgICAgICAgbnVtYmVyID0gZGF0YVtwb3NpdGlvbl07CiAgICAgICAgICB9IGVsc2UgaWYgKHJlZmVycmVkVG9TZWdtZW50TnVtYmVyU2l6ZSA9PT0gMikgewogICAgICAgICAgICBudW1iZXIgPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQxNikoZGF0YSwgcG9zaXRpb24pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbnVtYmVyID0gKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MzIpKGRhdGEsIHBvc2l0aW9uKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZWZlcnJlZFRvLnB1c2gobnVtYmVyKTsKICAgICAgICAgIHBvc2l0aW9uICs9IHJlZmVycmVkVG9TZWdtZW50TnVtYmVyU2l6ZTsKICAgICAgICB9CgogICAgICAgIHNlZ21lbnRIZWFkZXIucmVmZXJyZWRUbyA9IHJlZmVycmVkVG87CgogICAgICAgIGlmICghcGFnZUFzc29jaWF0aW9uRmllbGRTaXplKSB7CiAgICAgICAgICBzZWdtZW50SGVhZGVyLnBhZ2VBc3NvY2lhdGlvbiA9IGRhdGFbcG9zaXRpb24rK107CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNlZ21lbnRIZWFkZXIucGFnZUFzc29jaWF0aW9uID0gKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MzIpKGRhdGEsIHBvc2l0aW9uKTsKICAgICAgICAgIHBvc2l0aW9uICs9IDQ7CiAgICAgICAgfQoKICAgICAgICBzZWdtZW50SGVhZGVyLmxlbmd0aCA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDMyKShkYXRhLCBwb3NpdGlvbik7CiAgICAgICAgcG9zaXRpb24gKz0gNDsKCiAgICAgICAgaWYgKHNlZ21lbnRIZWFkZXIubGVuZ3RoID09PSAweGZmZmZmZmZmKSB7CiAgICAgICAgICBpZiAoc2VnbWVudFR5cGUgPT09IDM4KSB7CiAgICAgICAgICAgIHZhciBnZW5lcmljUmVnaW9uSW5mbyA9IHJlYWRSZWdpb25TZWdtZW50SW5mb3JtYXRpb24oZGF0YSwgcG9zaXRpb24pOwogICAgICAgICAgICB2YXIgZ2VuZXJpY1JlZ2lvblNlZ21lbnRGbGFncyA9IGRhdGFbcG9zaXRpb24gKyBSZWdpb25TZWdtZW50SW5mb3JtYXRpb25GaWVsZExlbmd0aF07CiAgICAgICAgICAgIHZhciBnZW5lcmljUmVnaW9uTW1yID0gISEoZ2VuZXJpY1JlZ2lvblNlZ21lbnRGbGFncyAmIDEpOwogICAgICAgICAgICB2YXIgc2VhcmNoUGF0dGVybkxlbmd0aCA9IDY7CiAgICAgICAgICAgIHZhciBzZWFyY2hQYXR0ZXJuID0gbmV3IFVpbnQ4QXJyYXkoc2VhcmNoUGF0dGVybkxlbmd0aCk7CgogICAgICAgICAgICBpZiAoIWdlbmVyaWNSZWdpb25NbXIpIHsKICAgICAgICAgICAgICBzZWFyY2hQYXR0ZXJuWzBdID0gMHhmZjsKICAgICAgICAgICAgICBzZWFyY2hQYXR0ZXJuWzFdID0gMHhhYzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc2VhcmNoUGF0dGVyblsyXSA9IGdlbmVyaWNSZWdpb25JbmZvLmhlaWdodCA+Pj4gMjQgJiAweGZmOwogICAgICAgICAgICBzZWFyY2hQYXR0ZXJuWzNdID0gZ2VuZXJpY1JlZ2lvbkluZm8uaGVpZ2h0ID4+IDE2ICYgMHhmZjsKICAgICAgICAgICAgc2VhcmNoUGF0dGVybls0XSA9IGdlbmVyaWNSZWdpb25JbmZvLmhlaWdodCA+PiA4ICYgMHhmZjsKICAgICAgICAgICAgc2VhcmNoUGF0dGVybls1XSA9IGdlbmVyaWNSZWdpb25JbmZvLmhlaWdodCAmIDB4ZmY7CgogICAgICAgICAgICBmb3IgKGkgPSBwb3NpdGlvbiwgaWkgPSBkYXRhLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgICB2YXIgaiA9IDA7CgogICAgICAgICAgICAgIHdoaWxlIChqIDwgc2VhcmNoUGF0dGVybkxlbmd0aCAmJiBzZWFyY2hQYXR0ZXJuW2pdID09PSBkYXRhW2kgKyBqXSkgewogICAgICAgICAgICAgICAgaisrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGogPT09IHNlYXJjaFBhdHRlcm5MZW5ndGgpIHsKICAgICAgICAgICAgICAgIHNlZ21lbnRIZWFkZXIubGVuZ3RoID0gaSArIHNlYXJjaFBhdHRlcm5MZW5ndGg7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChzZWdtZW50SGVhZGVyLmxlbmd0aCA9PT0gMHhmZmZmZmZmZikgewogICAgICAgICAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKCJzZWdtZW50IGVuZCB3YXMgbm90IGZvdW5kIik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKCJpbnZhbGlkIHVua25vd24gc2VnbWVudCBsZW5ndGgiKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHNlZ21lbnRIZWFkZXIuaGVhZGVyRW5kID0gcG9zaXRpb247CiAgICAgICAgcmV0dXJuIHNlZ21lbnRIZWFkZXI7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHJlYWRTZWdtZW50cyhoZWFkZXIsIGRhdGEsIHN0YXJ0LCBlbmQpIHsKICAgICAgICB2YXIgc2VnbWVudHMgPSBbXTsKICAgICAgICB2YXIgcG9zaXRpb24gPSBzdGFydDsKCiAgICAgICAgd2hpbGUgKHBvc2l0aW9uIDwgZW5kKSB7CiAgICAgICAgICB2YXIgc2VnbWVudEhlYWRlciA9IHJlYWRTZWdtZW50SGVhZGVyKGRhdGEsIHBvc2l0aW9uKTsKICAgICAgICAgIHBvc2l0aW9uID0gc2VnbWVudEhlYWRlci5oZWFkZXJFbmQ7CiAgICAgICAgICB2YXIgc2VnbWVudCA9IHsKICAgICAgICAgICAgaGVhZGVyOiBzZWdtZW50SGVhZGVyLAogICAgICAgICAgICBkYXRhOiBkYXRhCiAgICAgICAgICB9OwoKICAgICAgICAgIGlmICghaGVhZGVyLnJhbmRvbUFjY2VzcykgewogICAgICAgICAgICBzZWdtZW50LnN0YXJ0ID0gcG9zaXRpb247CiAgICAgICAgICAgIHBvc2l0aW9uICs9IHNlZ21lbnRIZWFkZXIubGVuZ3RoOwogICAgICAgICAgICBzZWdtZW50LmVuZCA9IHBvc2l0aW9uOwogICAgICAgICAgfQoKICAgICAgICAgIHNlZ21lbnRzLnB1c2goc2VnbWVudCk7CgogICAgICAgICAgaWYgKHNlZ21lbnRIZWFkZXIudHlwZSA9PT0gNTEpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoaGVhZGVyLnJhbmRvbUFjY2VzcykgewogICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gc2VnbWVudHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICBzZWdtZW50c1tpXS5zdGFydCA9IHBvc2l0aW9uOwogICAgICAgICAgICBwb3NpdGlvbiArPSBzZWdtZW50c1tpXS5oZWFkZXIubGVuZ3RoOwogICAgICAgICAgICBzZWdtZW50c1tpXS5lbmQgPSBwb3NpdGlvbjsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBzZWdtZW50czsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gcmVhZFJlZ2lvblNlZ21lbnRJbmZvcm1hdGlvbihkYXRhLCBzdGFydCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICB3aWR0aDogKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MzIpKGRhdGEsIHN0YXJ0KSwKICAgICAgICAgIGhlaWdodDogKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MzIpKGRhdGEsIHN0YXJ0ICsgNCksCiAgICAgICAgICB4OiAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgc3RhcnQgKyA4KSwKICAgICAgICAgIHk6ICgwLCBfY29yZV91dGlscy5yZWFkVWludDMyKShkYXRhLCBzdGFydCArIDEyKSwKICAgICAgICAgIGNvbWJpbmF0aW9uT3BlcmF0b3I6IGRhdGFbc3RhcnQgKyAxNl0gJiA3CiAgICAgICAgfTsKICAgICAgfQoKICAgICAgdmFyIFJlZ2lvblNlZ21lbnRJbmZvcm1hdGlvbkZpZWxkTGVuZ3RoID0gMTc7CgogICAgICBmdW5jdGlvbiBwcm9jZXNzU2VnbWVudChzZWdtZW50LCB2aXNpdG9yKSB7CiAgICAgICAgdmFyIGhlYWRlciA9IHNlZ21lbnQuaGVhZGVyOwogICAgICAgIHZhciBkYXRhID0gc2VnbWVudC5kYXRhLAogICAgICAgICAgcG9zaXRpb24gPSBzZWdtZW50LnN0YXJ0LAogICAgICAgICAgZW5kID0gc2VnbWVudC5lbmQ7CiAgICAgICAgdmFyIGFyZ3MsIGF0LCBpLCBhdExlbmd0aDsKCiAgICAgICAgc3dpdGNoIChoZWFkZXIudHlwZSkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICB2YXIgZGljdGlvbmFyeSA9IHt9OwogICAgICAgICAgICB2YXIgZGljdGlvbmFyeUZsYWdzID0gKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MTYpKGRhdGEsIHBvc2l0aW9uKTsKICAgICAgICAgICAgZGljdGlvbmFyeS5odWZmbWFuID0gISEoZGljdGlvbmFyeUZsYWdzICYgMSk7CiAgICAgICAgICAgIGRpY3Rpb25hcnkucmVmaW5lbWVudCA9ICEhKGRpY3Rpb25hcnlGbGFncyAmIDIpOwogICAgICAgICAgICBkaWN0aW9uYXJ5Lmh1ZmZtYW5ESFNlbGVjdG9yID0gZGljdGlvbmFyeUZsYWdzID4+IDIgJiAzOwogICAgICAgICAgICBkaWN0aW9uYXJ5Lmh1ZmZtYW5EV1NlbGVjdG9yID0gZGljdGlvbmFyeUZsYWdzID4+IDQgJiAzOwogICAgICAgICAgICBkaWN0aW9uYXJ5LmJpdG1hcFNpemVTZWxlY3RvciA9IGRpY3Rpb25hcnlGbGFncyA+PiA2ICYgMTsKICAgICAgICAgICAgZGljdGlvbmFyeS5hZ2dyZWdhdGlvbkluc3RhbmNlc1NlbGVjdG9yID0gZGljdGlvbmFyeUZsYWdzID4+IDcgJiAxOwogICAgICAgICAgICBkaWN0aW9uYXJ5LmJpdG1hcENvZGluZ0NvbnRleHRVc2VkID0gISEoZGljdGlvbmFyeUZsYWdzICYgMjU2KTsKICAgICAgICAgICAgZGljdGlvbmFyeS5iaXRtYXBDb2RpbmdDb250ZXh0UmV0YWluZWQgPSAhIShkaWN0aW9uYXJ5RmxhZ3MgJiA1MTIpOwogICAgICAgICAgICBkaWN0aW9uYXJ5LnRlbXBsYXRlID0gZGljdGlvbmFyeUZsYWdzID4+IDEwICYgMzsKICAgICAgICAgICAgZGljdGlvbmFyeS5yZWZpbmVtZW50VGVtcGxhdGUgPSBkaWN0aW9uYXJ5RmxhZ3MgPj4gMTIgJiAxOwogICAgICAgICAgICBwb3NpdGlvbiArPSAyOwoKICAgICAgICAgICAgaWYgKCFkaWN0aW9uYXJ5Lmh1ZmZtYW4pIHsKICAgICAgICAgICAgICBhdExlbmd0aCA9IGRpY3Rpb25hcnkudGVtcGxhdGUgPT09IDAgPyA0IDogMTsKICAgICAgICAgICAgICBhdCA9IFtdOwoKICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYXRMZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgYXQucHVzaCh7CiAgICAgICAgICAgICAgICAgIHg6ICgwLCBfY29yZV91dGlscy5yZWFkSW50OCkoZGF0YSwgcG9zaXRpb24pLAogICAgICAgICAgICAgICAgICB5OiAoMCwgX2NvcmVfdXRpbHMucmVhZEludDgpKGRhdGEsIHBvc2l0aW9uICsgMSkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcG9zaXRpb24gKz0gMjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGRpY3Rpb25hcnkuYXQgPSBhdDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGRpY3Rpb25hcnkucmVmaW5lbWVudCAmJiAhZGljdGlvbmFyeS5yZWZpbmVtZW50VGVtcGxhdGUpIHsKICAgICAgICAgICAgICBhdCA9IFtdOwoKICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgMjsgaSsrKSB7CiAgICAgICAgICAgICAgICBhdC5wdXNoKHsKICAgICAgICAgICAgICAgICAgeDogKDAsIF9jb3JlX3V0aWxzLnJlYWRJbnQ4KShkYXRhLCBwb3NpdGlvbiksCiAgICAgICAgICAgICAgICAgIHk6ICgwLCBfY29yZV91dGlscy5yZWFkSW50OCkoZGF0YSwgcG9zaXRpb24gKyAxKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBwb3NpdGlvbiArPSAyOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZGljdGlvbmFyeS5yZWZpbmVtZW50QXQgPSBhdDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZGljdGlvbmFyeS5udW1iZXJPZkV4cG9ydGVkU3ltYm9scyA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDMyKShkYXRhLCBwb3NpdGlvbik7CiAgICAgICAgICAgIHBvc2l0aW9uICs9IDQ7CiAgICAgICAgICAgIGRpY3Rpb25hcnkubnVtYmVyT2ZOZXdTeW1ib2xzID0gKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MzIpKGRhdGEsIHBvc2l0aW9uKTsKICAgICAgICAgICAgcG9zaXRpb24gKz0gNDsKICAgICAgICAgICAgYXJncyA9IFtkaWN0aW9uYXJ5LCBoZWFkZXIubnVtYmVyLCBoZWFkZXIucmVmZXJyZWRUbywgZGF0YSwgcG9zaXRpb24sIGVuZF07CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgdmFyIHRleHRSZWdpb24gPSB7fTsKICAgICAgICAgICAgdGV4dFJlZ2lvbi5pbmZvID0gcmVhZFJlZ2lvblNlZ21lbnRJbmZvcm1hdGlvbihkYXRhLCBwb3NpdGlvbik7CiAgICAgICAgICAgIHBvc2l0aW9uICs9IFJlZ2lvblNlZ21lbnRJbmZvcm1hdGlvbkZpZWxkTGVuZ3RoOwogICAgICAgICAgICB2YXIgdGV4dFJlZ2lvblNlZ21lbnRGbGFncyA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDE2KShkYXRhLCBwb3NpdGlvbik7CiAgICAgICAgICAgIHBvc2l0aW9uICs9IDI7CiAgICAgICAgICAgIHRleHRSZWdpb24uaHVmZm1hbiA9ICEhKHRleHRSZWdpb25TZWdtZW50RmxhZ3MgJiAxKTsKICAgICAgICAgICAgdGV4dFJlZ2lvbi5yZWZpbmVtZW50ID0gISEodGV4dFJlZ2lvblNlZ21lbnRGbGFncyAmIDIpOwogICAgICAgICAgICB0ZXh0UmVnaW9uLmxvZ1N0cmlwU2l6ZSA9IHRleHRSZWdpb25TZWdtZW50RmxhZ3MgPj4gMiAmIDM7CiAgICAgICAgICAgIHRleHRSZWdpb24uc3RyaXBTaXplID0gMSA8PCB0ZXh0UmVnaW9uLmxvZ1N0cmlwU2l6ZTsKICAgICAgICAgICAgdGV4dFJlZ2lvbi5yZWZlcmVuY2VDb3JuZXIgPSB0ZXh0UmVnaW9uU2VnbWVudEZsYWdzID4+IDQgJiAzOwogICAgICAgICAgICB0ZXh0UmVnaW9uLnRyYW5zcG9zZWQgPSAhISh0ZXh0UmVnaW9uU2VnbWVudEZsYWdzICYgNjQpOwogICAgICAgICAgICB0ZXh0UmVnaW9uLmNvbWJpbmF0aW9uT3BlcmF0b3IgPSB0ZXh0UmVnaW9uU2VnbWVudEZsYWdzID4+IDcgJiAzOwogICAgICAgICAgICB0ZXh0UmVnaW9uLmRlZmF1bHRQaXhlbFZhbHVlID0gdGV4dFJlZ2lvblNlZ21lbnRGbGFncyA+PiA5ICYgMTsKICAgICAgICAgICAgdGV4dFJlZ2lvbi5kc09mZnNldCA9IHRleHRSZWdpb25TZWdtZW50RmxhZ3MgPDwgMTcgPj4gMjc7CiAgICAgICAgICAgIHRleHRSZWdpb24ucmVmaW5lbWVudFRlbXBsYXRlID0gdGV4dFJlZ2lvblNlZ21lbnRGbGFncyA+PiAxNSAmIDE7CgogICAgICAgICAgICBpZiAodGV4dFJlZ2lvbi5odWZmbWFuKSB7CiAgICAgICAgICAgICAgdmFyIHRleHRSZWdpb25IdWZmbWFuRmxhZ3MgPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQxNikoZGF0YSwgcG9zaXRpb24pOwogICAgICAgICAgICAgIHBvc2l0aW9uICs9IDI7CiAgICAgICAgICAgICAgdGV4dFJlZ2lvbi5odWZmbWFuRlMgPSB0ZXh0UmVnaW9uSHVmZm1hbkZsYWdzICYgMzsKICAgICAgICAgICAgICB0ZXh0UmVnaW9uLmh1ZmZtYW5EUyA9IHRleHRSZWdpb25IdWZmbWFuRmxhZ3MgPj4gMiAmIDM7CiAgICAgICAgICAgICAgdGV4dFJlZ2lvbi5odWZmbWFuRFQgPSB0ZXh0UmVnaW9uSHVmZm1hbkZsYWdzID4+IDQgJiAzOwogICAgICAgICAgICAgIHRleHRSZWdpb24uaHVmZm1hblJlZmluZW1lbnREVyA9IHRleHRSZWdpb25IdWZmbWFuRmxhZ3MgPj4gNiAmIDM7CiAgICAgICAgICAgICAgdGV4dFJlZ2lvbi5odWZmbWFuUmVmaW5lbWVudERIID0gdGV4dFJlZ2lvbkh1ZmZtYW5GbGFncyA+PiA4ICYgMzsKICAgICAgICAgICAgICB0ZXh0UmVnaW9uLmh1ZmZtYW5SZWZpbmVtZW50RFggPSB0ZXh0UmVnaW9uSHVmZm1hbkZsYWdzID4+IDEwICYgMzsKICAgICAgICAgICAgICB0ZXh0UmVnaW9uLmh1ZmZtYW5SZWZpbmVtZW50RFkgPSB0ZXh0UmVnaW9uSHVmZm1hbkZsYWdzID4+IDEyICYgMzsKICAgICAgICAgICAgICB0ZXh0UmVnaW9uLmh1ZmZtYW5SZWZpbmVtZW50U2l6ZVNlbGVjdG9yID0gISEodGV4dFJlZ2lvbkh1ZmZtYW5GbGFncyAmIDB4NDAwMCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0ZXh0UmVnaW9uLnJlZmluZW1lbnQgJiYgIXRleHRSZWdpb24ucmVmaW5lbWVudFRlbXBsYXRlKSB7CiAgICAgICAgICAgICAgYXQgPSBbXTsKCiAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IDI7IGkrKykgewogICAgICAgICAgICAgICAgYXQucHVzaCh7CiAgICAgICAgICAgICAgICAgIHg6ICgwLCBfY29yZV91dGlscy5yZWFkSW50OCkoZGF0YSwgcG9zaXRpb24pLAogICAgICAgICAgICAgICAgICB5OiAoMCwgX2NvcmVfdXRpbHMucmVhZEludDgpKGRhdGEsIHBvc2l0aW9uICsgMSkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcG9zaXRpb24gKz0gMjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHRleHRSZWdpb24ucmVmaW5lbWVudEF0ID0gYXQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRleHRSZWdpb24ubnVtYmVyT2ZTeW1ib2xJbnN0YW5jZXMgPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgcG9zaXRpb24pOwogICAgICAgICAgICBwb3NpdGlvbiArPSA0OwogICAgICAgICAgICBhcmdzID0gW3RleHRSZWdpb24sIGhlYWRlci5yZWZlcnJlZFRvLCBkYXRhLCBwb3NpdGlvbiwgZW5kXTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgdmFyIHBhdHRlcm5EaWN0aW9uYXJ5ID0ge307CiAgICAgICAgICAgIHZhciBwYXR0ZXJuRGljdGlvbmFyeUZsYWdzID0gZGF0YVtwb3NpdGlvbisrXTsKICAgICAgICAgICAgcGF0dGVybkRpY3Rpb25hcnkubW1yID0gISEocGF0dGVybkRpY3Rpb25hcnlGbGFncyAmIDEpOwogICAgICAgICAgICBwYXR0ZXJuRGljdGlvbmFyeS50ZW1wbGF0ZSA9IHBhdHRlcm5EaWN0aW9uYXJ5RmxhZ3MgPj4gMSAmIDM7CiAgICAgICAgICAgIHBhdHRlcm5EaWN0aW9uYXJ5LnBhdHRlcm5XaWR0aCA9IGRhdGFbcG9zaXRpb24rK107CiAgICAgICAgICAgIHBhdHRlcm5EaWN0aW9uYXJ5LnBhdHRlcm5IZWlnaHQgPSBkYXRhW3Bvc2l0aW9uKytdOwogICAgICAgICAgICBwYXR0ZXJuRGljdGlvbmFyeS5tYXhQYXR0ZXJuSW5kZXggPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgcG9zaXRpb24pOwogICAgICAgICAgICBwb3NpdGlvbiArPSA0OwogICAgICAgICAgICBhcmdzID0gW3BhdHRlcm5EaWN0aW9uYXJ5LCBoZWFkZXIubnVtYmVyLCBkYXRhLCBwb3NpdGlvbiwgZW5kXTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAyMjoKICAgICAgICAgIGNhc2UgMjM6CiAgICAgICAgICAgIHZhciBoYWxmdG9uZVJlZ2lvbiA9IHt9OwogICAgICAgICAgICBoYWxmdG9uZVJlZ2lvbi5pbmZvID0gcmVhZFJlZ2lvblNlZ21lbnRJbmZvcm1hdGlvbihkYXRhLCBwb3NpdGlvbik7CiAgICAgICAgICAgIHBvc2l0aW9uICs9IFJlZ2lvblNlZ21lbnRJbmZvcm1hdGlvbkZpZWxkTGVuZ3RoOwogICAgICAgICAgICB2YXIgaGFsZnRvbmVSZWdpb25GbGFncyA9IGRhdGFbcG9zaXRpb24rK107CiAgICAgICAgICAgIGhhbGZ0b25lUmVnaW9uLm1tciA9ICEhKGhhbGZ0b25lUmVnaW9uRmxhZ3MgJiAxKTsKICAgICAgICAgICAgaGFsZnRvbmVSZWdpb24udGVtcGxhdGUgPSBoYWxmdG9uZVJlZ2lvbkZsYWdzID4+IDEgJiAzOwogICAgICAgICAgICBoYWxmdG9uZVJlZ2lvbi5lbmFibGVTa2lwID0gISEoaGFsZnRvbmVSZWdpb25GbGFncyAmIDgpOwogICAgICAgICAgICBoYWxmdG9uZVJlZ2lvbi5jb21iaW5hdGlvbk9wZXJhdG9yID0gaGFsZnRvbmVSZWdpb25GbGFncyA+PiA0ICYgNzsKICAgICAgICAgICAgaGFsZnRvbmVSZWdpb24uZGVmYXVsdFBpeGVsVmFsdWUgPSBoYWxmdG9uZVJlZ2lvbkZsYWdzID4+IDcgJiAxOwogICAgICAgICAgICBoYWxmdG9uZVJlZ2lvbi5ncmlkV2lkdGggPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgcG9zaXRpb24pOwogICAgICAgICAgICBwb3NpdGlvbiArPSA0OwogICAgICAgICAgICBoYWxmdG9uZVJlZ2lvbi5ncmlkSGVpZ2h0ID0gKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MzIpKGRhdGEsIHBvc2l0aW9uKTsKICAgICAgICAgICAgcG9zaXRpb24gKz0gNDsKICAgICAgICAgICAgaGFsZnRvbmVSZWdpb24uZ3JpZE9mZnNldFggPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgcG9zaXRpb24pICYgMHhmZmZmZmZmZjsKICAgICAgICAgICAgcG9zaXRpb24gKz0gNDsKICAgICAgICAgICAgaGFsZnRvbmVSZWdpb24uZ3JpZE9mZnNldFkgPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgcG9zaXRpb24pICYgMHhmZmZmZmZmZjsKICAgICAgICAgICAgcG9zaXRpb24gKz0gNDsKICAgICAgICAgICAgaGFsZnRvbmVSZWdpb24uZ3JpZFZlY3RvclggPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQxNikoZGF0YSwgcG9zaXRpb24pOwogICAgICAgICAgICBwb3NpdGlvbiArPSAyOwogICAgICAgICAgICBoYWxmdG9uZVJlZ2lvbi5ncmlkVmVjdG9yWSA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDE2KShkYXRhLCBwb3NpdGlvbik7CiAgICAgICAgICAgIHBvc2l0aW9uICs9IDI7CiAgICAgICAgICAgIGFyZ3MgPSBbaGFsZnRvbmVSZWdpb24sIGhlYWRlci5yZWZlcnJlZFRvLCBkYXRhLCBwb3NpdGlvbiwgZW5kXTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAzODoKICAgICAgICAgIGNhc2UgMzk6CiAgICAgICAgICAgIHZhciBnZW5lcmljUmVnaW9uID0ge307CiAgICAgICAgICAgIGdlbmVyaWNSZWdpb24uaW5mbyA9IHJlYWRSZWdpb25TZWdtZW50SW5mb3JtYXRpb24oZGF0YSwgcG9zaXRpb24pOwogICAgICAgICAgICBwb3NpdGlvbiArPSBSZWdpb25TZWdtZW50SW5mb3JtYXRpb25GaWVsZExlbmd0aDsKICAgICAgICAgICAgdmFyIGdlbmVyaWNSZWdpb25TZWdtZW50RmxhZ3MgPSBkYXRhW3Bvc2l0aW9uKytdOwogICAgICAgICAgICBnZW5lcmljUmVnaW9uLm1tciA9ICEhKGdlbmVyaWNSZWdpb25TZWdtZW50RmxhZ3MgJiAxKTsKICAgICAgICAgICAgZ2VuZXJpY1JlZ2lvbi50ZW1wbGF0ZSA9IGdlbmVyaWNSZWdpb25TZWdtZW50RmxhZ3MgPj4gMSAmIDM7CiAgICAgICAgICAgIGdlbmVyaWNSZWdpb24ucHJlZGljdGlvbiA9ICEhKGdlbmVyaWNSZWdpb25TZWdtZW50RmxhZ3MgJiA4KTsKCiAgICAgICAgICAgIGlmICghZ2VuZXJpY1JlZ2lvbi5tbXIpIHsKICAgICAgICAgICAgICBhdExlbmd0aCA9IGdlbmVyaWNSZWdpb24udGVtcGxhdGUgPT09IDAgPyA0IDogMTsKICAgICAgICAgICAgICBhdCA9IFtdOwoKICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYXRMZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgYXQucHVzaCh7CiAgICAgICAgICAgICAgICAgIHg6ICgwLCBfY29yZV91dGlscy5yZWFkSW50OCkoZGF0YSwgcG9zaXRpb24pLAogICAgICAgICAgICAgICAgICB5OiAoMCwgX2NvcmVfdXRpbHMucmVhZEludDgpKGRhdGEsIHBvc2l0aW9uICsgMSkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcG9zaXRpb24gKz0gMjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGdlbmVyaWNSZWdpb24uYXQgPSBhdDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYXJncyA9IFtnZW5lcmljUmVnaW9uLCBkYXRhLCBwb3NpdGlvbiwgZW5kXTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSA0ODoKICAgICAgICAgICAgdmFyIHBhZ2VJbmZvID0gewogICAgICAgICAgICAgIHdpZHRoOiAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgcG9zaXRpb24pLAogICAgICAgICAgICAgIGhlaWdodDogKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MzIpKGRhdGEsIHBvc2l0aW9uICsgNCksCiAgICAgICAgICAgICAgcmVzb2x1dGlvblg6ICgwLCBfY29yZV91dGlscy5yZWFkVWludDMyKShkYXRhLCBwb3NpdGlvbiArIDgpLAogICAgICAgICAgICAgIHJlc29sdXRpb25ZOiAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgcG9zaXRpb24gKyAxMikKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGlmIChwYWdlSW5mby5oZWlnaHQgPT09IDB4ZmZmZmZmZmYpIHsKICAgICAgICAgICAgICBkZWxldGUgcGFnZUluZm8uaGVpZ2h0OwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcGFnZVNlZ21lbnRGbGFncyA9IGRhdGFbcG9zaXRpb24gKyAxNl07CiAgICAgICAgICAgICgwLCBfY29yZV91dGlscy5yZWFkVWludDE2KShkYXRhLCBwb3NpdGlvbiArIDE3KTsKICAgICAgICAgICAgcGFnZUluZm8ubG9zc2xlc3MgPSAhIShwYWdlU2VnbWVudEZsYWdzICYgMSk7CiAgICAgICAgICAgIHBhZ2VJbmZvLnJlZmluZW1lbnQgPSAhIShwYWdlU2VnbWVudEZsYWdzICYgMik7CiAgICAgICAgICAgIHBhZ2VJbmZvLmRlZmF1bHRQaXhlbFZhbHVlID0gcGFnZVNlZ21lbnRGbGFncyA+PiAyICYgMTsKICAgICAgICAgICAgcGFnZUluZm8uY29tYmluYXRpb25PcGVyYXRvciA9IHBhZ2VTZWdtZW50RmxhZ3MgPj4gMyAmIDM7CiAgICAgICAgICAgIHBhZ2VJbmZvLnJlcXVpcmVzQnVmZmVyID0gISEocGFnZVNlZ21lbnRGbGFncyAmIDMyKTsKICAgICAgICAgICAgcGFnZUluZm8uY29tYmluYXRpb25PcGVyYXRvck92ZXJyaWRlID0gISEocGFnZVNlZ21lbnRGbGFncyAmIDY0KTsKICAgICAgICAgICAgYXJncyA9IFtwYWdlSW5mb107CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgNDk6CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgNTA6CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgNTE6CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgNTM6CiAgICAgICAgICAgIGFyZ3MgPSBbaGVhZGVyLm51bWJlciwgZGF0YSwgcG9zaXRpb24sIGVuZF07CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgNjI6CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKCJzZWdtZW50IHR5cGUgIi5jb25jYXQoaGVhZGVyLnR5cGVOYW1lLCAiKCIpLmNvbmNhdChoZWFkZXIudHlwZSwgIikiKSArICIgaXMgbm90IGltcGxlbWVudGVkIik7CiAgICAgICAgfQoKICAgICAgICB2YXIgY2FsbGJhY2tOYW1lID0gIm9uIiArIGhlYWRlci50eXBlTmFtZTsKCiAgICAgICAgaWYgKGNhbGxiYWNrTmFtZSBpbiB2aXNpdG9yKSB7CiAgICAgICAgICB2aXNpdG9yW2NhbGxiYWNrTmFtZV0uYXBwbHkodmlzaXRvciwgYXJncyk7CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBwcm9jZXNzU2VnbWVudHMoc2VnbWVudHMsIHZpc2l0b3IpIHsKICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBzZWdtZW50cy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICBwcm9jZXNzU2VnbWVudChzZWdtZW50c1tpXSwgdmlzaXRvcik7CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBwYXJzZUpiaWcyQ2h1bmtzKGNodW5rcykgewogICAgICAgIHZhciB2aXNpdG9yID0gbmV3IFNpbXBsZVNlZ21lbnRWaXNpdG9yKCk7CgogICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGNodW5rcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICB2YXIgY2h1bmsgPSBjaHVua3NbaV07CiAgICAgICAgICB2YXIgc2VnbWVudHMgPSByZWFkU2VnbWVudHMoe30sIGNodW5rLmRhdGEsIGNodW5rLnN0YXJ0LCBjaHVuay5lbmQpOwogICAgICAgICAgcHJvY2Vzc1NlZ21lbnRzKHNlZ21lbnRzLCB2aXNpdG9yKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB2aXNpdG9yLmJ1ZmZlcjsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gcGFyc2VKYmlnMihkYXRhKSB7CiAgICAgICAgdmFyIGVuZCA9IGRhdGEubGVuZ3RoOwogICAgICAgIHZhciBwb3NpdGlvbiA9IDA7CgogICAgICAgIGlmIChkYXRhW3Bvc2l0aW9uXSAhPT0gMHg5NyB8fCBkYXRhW3Bvc2l0aW9uICsgMV0gIT09IDB4NGEgfHwgZGF0YVtwb3NpdGlvbiArIDJdICE9PSAweDQyIHx8IGRhdGFbcG9zaXRpb24gKyAzXSAhPT0gMHgzMiB8fCBkYXRhW3Bvc2l0aW9uICsgNF0gIT09IDB4MGQgfHwgZGF0YVtwb3NpdGlvbiArIDVdICE9PSAweDBhIHx8IGRhdGFbcG9zaXRpb24gKyA2XSAhPT0gMHgxYSB8fCBkYXRhW3Bvc2l0aW9uICsgN10gIT09IDB4MGEpIHsKICAgICAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKCJwYXJzZUpiaWcyIC0gaW52YWxpZCBoZWFkZXIuIik7CiAgICAgICAgfQoKICAgICAgICB2YXIgaGVhZGVyID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICBwb3NpdGlvbiArPSA4OwogICAgICAgIHZhciBmbGFncyA9IGRhdGFbcG9zaXRpb24rK107CiAgICAgICAgaGVhZGVyLnJhbmRvbUFjY2VzcyA9ICEoZmxhZ3MgJiAxKTsKCiAgICAgICAgaWYgKCEoZmxhZ3MgJiAyKSkgewogICAgICAgICAgaGVhZGVyLm51bWJlck9mUGFnZXMgPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgcG9zaXRpb24pOwogICAgICAgICAgcG9zaXRpb24gKz0gNDsKICAgICAgICB9CgogICAgICAgIHZhciBzZWdtZW50cyA9IHJlYWRTZWdtZW50cyhoZWFkZXIsIGRhdGEsIHBvc2l0aW9uLCBlbmQpOwogICAgICAgIHZhciB2aXNpdG9yID0gbmV3IFNpbXBsZVNlZ21lbnRWaXNpdG9yKCk7CiAgICAgICAgcHJvY2Vzc1NlZ21lbnRzKHNlZ21lbnRzLCB2aXNpdG9yKTsKICAgICAgICB2YXIgX3Zpc2l0b3IkY3VycmVudFBhZ2VJID0gdmlzaXRvci5jdXJyZW50UGFnZUluZm8sCiAgICAgICAgICB3aWR0aCA9IF92aXNpdG9yJGN1cnJlbnRQYWdlSS53aWR0aCwKICAgICAgICAgIGhlaWdodCA9IF92aXNpdG9yJGN1cnJlbnRQYWdlSS5oZWlnaHQ7CiAgICAgICAgdmFyIGJpdFBhY2tlZCA9IHZpc2l0b3IuYnVmZmVyOwogICAgICAgIHZhciBpbWdEYXRhID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHdpZHRoICogaGVpZ2h0KTsKICAgICAgICB2YXIgcSA9IDAsCiAgICAgICAgICBrID0gMDsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBoZWlnaHQ7IGkrKykgewogICAgICAgICAgdmFyIG1hc2sgPSAwLAogICAgICAgICAgICBidWZmZXIgPSB2b2lkIDA7CgogICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB3aWR0aDsgaisrKSB7CiAgICAgICAgICAgIGlmICghbWFzaykgewogICAgICAgICAgICAgIG1hc2sgPSAxMjg7CiAgICAgICAgICAgICAgYnVmZmVyID0gYml0UGFja2VkW2srK107CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGltZ0RhdGFbcSsrXSA9IGJ1ZmZlciAmIG1hc2sgPyAwIDogMjU1OwogICAgICAgICAgICBtYXNrID4+PSAxOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGltZ0RhdGE6IGltZ0RhdGEsCiAgICAgICAgICB3aWR0aDogd2lkdGgsCiAgICAgICAgICBoZWlnaHQ6IGhlaWdodAogICAgICAgIH07CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIFNpbXBsZVNlZ21lbnRWaXNpdG9yKCkge30KCiAgICAgIFNpbXBsZVNlZ21lbnRWaXNpdG9yLnByb3RvdHlwZSA9IHsKICAgICAgICBvblBhZ2VJbmZvcm1hdGlvbjogZnVuY3Rpb24gU2ltcGxlU2VnbWVudFZpc2l0b3Jfb25QYWdlSW5mb3JtYXRpb24oaW5mbykgewogICAgICAgICAgdGhpcy5jdXJyZW50UGFnZUluZm8gPSBpbmZvOwogICAgICAgICAgdmFyIHJvd1NpemUgPSBpbmZvLndpZHRoICsgNyA+PiAzOwogICAgICAgICAgdmFyIGJ1ZmZlciA9IG5ldyBVaW50OENsYW1wZWRBcnJheShyb3dTaXplICogaW5mby5oZWlnaHQpOwoKICAgICAgICAgIGlmIChpbmZvLmRlZmF1bHRQaXhlbFZhbHVlKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGJ1ZmZlci5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgICAgYnVmZmVyW2ldID0gMHhmZjsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuYnVmZmVyID0gYnVmZmVyOwogICAgICAgIH0sCiAgICAgICAgZHJhd0JpdG1hcDogZnVuY3Rpb24gU2ltcGxlU2VnbWVudFZpc2l0b3JfZHJhd0JpdG1hcChyZWdpb25JbmZvLCBiaXRtYXApIHsKICAgICAgICAgIHZhciBwYWdlSW5mbyA9IHRoaXMuY3VycmVudFBhZ2VJbmZvOwogICAgICAgICAgdmFyIHdpZHRoID0gcmVnaW9uSW5mby53aWR0aCwKICAgICAgICAgICAgaGVpZ2h0ID0gcmVnaW9uSW5mby5oZWlnaHQ7CiAgICAgICAgICB2YXIgcm93U2l6ZSA9IHBhZ2VJbmZvLndpZHRoICsgNyA+PiAzOwogICAgICAgICAgdmFyIGNvbWJpbmF0aW9uT3BlcmF0b3IgPSBwYWdlSW5mby5jb21iaW5hdGlvbk9wZXJhdG9yT3ZlcnJpZGUgPyByZWdpb25JbmZvLmNvbWJpbmF0aW9uT3BlcmF0b3IgOiBwYWdlSW5mby5jb21iaW5hdGlvbk9wZXJhdG9yOwogICAgICAgICAgdmFyIGJ1ZmZlciA9IHRoaXMuYnVmZmVyOwogICAgICAgICAgdmFyIG1hc2swID0gMTI4ID4+IChyZWdpb25JbmZvLnggJiA3KTsKICAgICAgICAgIHZhciBvZmZzZXQwID0gcmVnaW9uSW5mby55ICogcm93U2l6ZSArIChyZWdpb25JbmZvLnggPj4gMyk7CiAgICAgICAgICB2YXIgaSwgaiwgbWFzaywgb2Zmc2V0OwoKICAgICAgICAgIHN3aXRjaCAoY29tYmluYXRpb25PcGVyYXRvcikgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGhlaWdodDsgaSsrKSB7CiAgICAgICAgICAgICAgICBtYXNrID0gbWFzazA7CiAgICAgICAgICAgICAgICBvZmZzZXQgPSBvZmZzZXQwOwoKICAgICAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCB3aWR0aDsgaisrKSB7CiAgICAgICAgICAgICAgICAgIGlmIChiaXRtYXBbaV1bal0pIHsKICAgICAgICAgICAgICAgICAgICBidWZmZXJbb2Zmc2V0XSB8PSBtYXNrOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBtYXNrID4+PSAxOwoKICAgICAgICAgICAgICAgICAgaWYgKCFtYXNrKSB7CiAgICAgICAgICAgICAgICAgICAgbWFzayA9IDEyODsKICAgICAgICAgICAgICAgICAgICBvZmZzZXQrKzsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG9mZnNldDAgKz0gcm93U2l6ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBoZWlnaHQ7IGkrKykgewogICAgICAgICAgICAgICAgbWFzayA9IG1hc2swOwogICAgICAgICAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0MDsKCiAgICAgICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgd2lkdGg7IGorKykgewogICAgICAgICAgICAgICAgICBpZiAoYml0bWFwW2ldW2pdKSB7CiAgICAgICAgICAgICAgICAgICAgYnVmZmVyW29mZnNldF0gXj0gbWFzazsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgbWFzayA+Pj0gMTsKCiAgICAgICAgICAgICAgICAgIGlmICghbWFzaykgewogICAgICAgICAgICAgICAgICAgIG1hc2sgPSAxMjg7CiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0Kys7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBvZmZzZXQwICs9IHJvd1NpemU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoIm9wZXJhdG9yICIuY29uY2F0KGNvbWJpbmF0aW9uT3BlcmF0b3IsICIgaXMgbm90IHN1cHBvcnRlZCIpKTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIG9uSW1tZWRpYXRlR2VuZXJpY1JlZ2lvbjogZnVuY3Rpb24gU2ltcGxlU2VnbWVudFZpc2l0b3Jfb25JbW1lZGlhdGVHZW5lcmljUmVnaW9uKHJlZ2lvbiwgZGF0YSwgc3RhcnQsIGVuZCkgewogICAgICAgICAgdmFyIHJlZ2lvbkluZm8gPSByZWdpb24uaW5mbzsKICAgICAgICAgIHZhciBkZWNvZGluZ0NvbnRleHQgPSBuZXcgRGVjb2RpbmdDb250ZXh0KGRhdGEsIHN0YXJ0LCBlbmQpOwogICAgICAgICAgdmFyIGJpdG1hcCA9IGRlY29kZUJpdG1hcChyZWdpb24ubW1yLCByZWdpb25JbmZvLndpZHRoLCByZWdpb25JbmZvLmhlaWdodCwgcmVnaW9uLnRlbXBsYXRlLCByZWdpb24ucHJlZGljdGlvbiwgbnVsbCwgcmVnaW9uLmF0LCBkZWNvZGluZ0NvbnRleHQpOwogICAgICAgICAgdGhpcy5kcmF3Qml0bWFwKHJlZ2lvbkluZm8sIGJpdG1hcCk7CiAgICAgICAgfSwKICAgICAgICBvbkltbWVkaWF0ZUxvc3NsZXNzR2VuZXJpY1JlZ2lvbjogZnVuY3Rpb24gU2ltcGxlU2VnbWVudFZpc2l0b3Jfb25JbW1lZGlhdGVMb3NzbGVzc0dlbmVyaWNSZWdpb24oKSB7CiAgICAgICAgICB0aGlzLm9uSW1tZWRpYXRlR2VuZXJpY1JlZ2lvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgIH0sCiAgICAgICAgb25TeW1ib2xEaWN0aW9uYXJ5OiBmdW5jdGlvbiBTaW1wbGVTZWdtZW50VmlzaXRvcl9vblN5bWJvbERpY3Rpb25hcnkoZGljdGlvbmFyeSwgY3VycmVudFNlZ21lbnQsIHJlZmVycmVkU2VnbWVudHMsIGRhdGEsIHN0YXJ0LCBlbmQpIHsKICAgICAgICAgIHZhciBodWZmbWFuVGFibGVzLCBodWZmbWFuSW5wdXQ7CgogICAgICAgICAgaWYgKGRpY3Rpb25hcnkuaHVmZm1hbikgewogICAgICAgICAgICBodWZmbWFuVGFibGVzID0gZ2V0U3ltYm9sRGljdGlvbmFyeUh1ZmZtYW5UYWJsZXMoZGljdGlvbmFyeSwgcmVmZXJyZWRTZWdtZW50cywgdGhpcy5jdXN0b21UYWJsZXMpOwogICAgICAgICAgICBodWZmbWFuSW5wdXQgPSBuZXcgUmVhZGVyKGRhdGEsIHN0YXJ0LCBlbmQpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBzeW1ib2xzID0gdGhpcy5zeW1ib2xzOwoKICAgICAgICAgIGlmICghc3ltYm9scykgewogICAgICAgICAgICB0aGlzLnN5bWJvbHMgPSBzeW1ib2xzID0ge307CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGlucHV0U3ltYm9scyA9IFtdOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IHJlZmVycmVkU2VnbWVudHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICB2YXIgcmVmZXJyZWRTeW1ib2xzID0gc3ltYm9sc1tyZWZlcnJlZFNlZ21lbnRzW2ldXTsKCiAgICAgICAgICAgIGlmIChyZWZlcnJlZFN5bWJvbHMpIHsKICAgICAgICAgICAgICBpbnB1dFN5bWJvbHMgPSBpbnB1dFN5bWJvbHMuY29uY2F0KHJlZmVycmVkU3ltYm9scyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZGVjb2RpbmdDb250ZXh0ID0gbmV3IERlY29kaW5nQ29udGV4dChkYXRhLCBzdGFydCwgZW5kKTsKICAgICAgICAgIHN5bWJvbHNbY3VycmVudFNlZ21lbnRdID0gZGVjb2RlU3ltYm9sRGljdGlvbmFyeShkaWN0aW9uYXJ5Lmh1ZmZtYW4sIGRpY3Rpb25hcnkucmVmaW5lbWVudCwgaW5wdXRTeW1ib2xzLCBkaWN0aW9uYXJ5Lm51bWJlck9mTmV3U3ltYm9scywgZGljdGlvbmFyeS5udW1iZXJPZkV4cG9ydGVkU3ltYm9scywgaHVmZm1hblRhYmxlcywgZGljdGlvbmFyeS50ZW1wbGF0ZSwgZGljdGlvbmFyeS5hdCwgZGljdGlvbmFyeS5yZWZpbmVtZW50VGVtcGxhdGUsIGRpY3Rpb25hcnkucmVmaW5lbWVudEF0LCBkZWNvZGluZ0NvbnRleHQsIGh1ZmZtYW5JbnB1dCk7CiAgICAgICAgfSwKICAgICAgICBvbkltbWVkaWF0ZVRleHRSZWdpb246IGZ1bmN0aW9uIFNpbXBsZVNlZ21lbnRWaXNpdG9yX29uSW1tZWRpYXRlVGV4dFJlZ2lvbihyZWdpb24sIHJlZmVycmVkU2VnbWVudHMsIGRhdGEsIHN0YXJ0LCBlbmQpIHsKICAgICAgICAgIHZhciByZWdpb25JbmZvID0gcmVnaW9uLmluZm87CiAgICAgICAgICB2YXIgaHVmZm1hblRhYmxlcywgaHVmZm1hbklucHV0OwogICAgICAgICAgdmFyIHN5bWJvbHMgPSB0aGlzLnN5bWJvbHM7CiAgICAgICAgICB2YXIgaW5wdXRTeW1ib2xzID0gW107CgogICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gcmVmZXJyZWRTZWdtZW50cy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgIHZhciByZWZlcnJlZFN5bWJvbHMgPSBzeW1ib2xzW3JlZmVycmVkU2VnbWVudHNbaV1dOwoKICAgICAgICAgICAgaWYgKHJlZmVycmVkU3ltYm9scykgewogICAgICAgICAgICAgIGlucHV0U3ltYm9scyA9IGlucHV0U3ltYm9scy5jb25jYXQocmVmZXJyZWRTeW1ib2xzKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHZhciBzeW1ib2xDb2RlTGVuZ3RoID0gKDAsIF9jb3JlX3V0aWxzLmxvZzIpKGlucHV0U3ltYm9scy5sZW5ndGgpOwoKICAgICAgICAgIGlmIChyZWdpb24uaHVmZm1hbikgewogICAgICAgICAgICBodWZmbWFuSW5wdXQgPSBuZXcgUmVhZGVyKGRhdGEsIHN0YXJ0LCBlbmQpOwogICAgICAgICAgICBodWZmbWFuVGFibGVzID0gZ2V0VGV4dFJlZ2lvbkh1ZmZtYW5UYWJsZXMocmVnaW9uLCByZWZlcnJlZFNlZ21lbnRzLCB0aGlzLmN1c3RvbVRhYmxlcywgaW5wdXRTeW1ib2xzLmxlbmd0aCwgaHVmZm1hbklucHV0KTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZGVjb2RpbmdDb250ZXh0ID0gbmV3IERlY29kaW5nQ29udGV4dChkYXRhLCBzdGFydCwgZW5kKTsKICAgICAgICAgIHZhciBiaXRtYXAgPSBkZWNvZGVUZXh0UmVnaW9uKHJlZ2lvbi5odWZmbWFuLCByZWdpb24ucmVmaW5lbWVudCwgcmVnaW9uSW5mby53aWR0aCwgcmVnaW9uSW5mby5oZWlnaHQsIHJlZ2lvbi5kZWZhdWx0UGl4ZWxWYWx1ZSwgcmVnaW9uLm51bWJlck9mU3ltYm9sSW5zdGFuY2VzLCByZWdpb24uc3RyaXBTaXplLCBpbnB1dFN5bWJvbHMsIHN5bWJvbENvZGVMZW5ndGgsIHJlZ2lvbi50cmFuc3Bvc2VkLCByZWdpb24uZHNPZmZzZXQsIHJlZ2lvbi5yZWZlcmVuY2VDb3JuZXIsIHJlZ2lvbi5jb21iaW5hdGlvbk9wZXJhdG9yLCBodWZmbWFuVGFibGVzLCByZWdpb24ucmVmaW5lbWVudFRlbXBsYXRlLCByZWdpb24ucmVmaW5lbWVudEF0LCBkZWNvZGluZ0NvbnRleHQsIHJlZ2lvbi5sb2dTdHJpcFNpemUsIGh1ZmZtYW5JbnB1dCk7CiAgICAgICAgICB0aGlzLmRyYXdCaXRtYXAocmVnaW9uSW5mbywgYml0bWFwKTsKICAgICAgICB9LAogICAgICAgIG9uSW1tZWRpYXRlTG9zc2xlc3NUZXh0UmVnaW9uOiBmdW5jdGlvbiBTaW1wbGVTZWdtZW50VmlzaXRvcl9vbkltbWVkaWF0ZUxvc3NsZXNzVGV4dFJlZ2lvbigpIHsKICAgICAgICAgIHRoaXMub25JbW1lZGlhdGVUZXh0UmVnaW9uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfSwKICAgICAgICBvblBhdHRlcm5EaWN0aW9uYXJ5OiBmdW5jdGlvbiBvblBhdHRlcm5EaWN0aW9uYXJ5KGRpY3Rpb25hcnksIGN1cnJlbnRTZWdtZW50LCBkYXRhLCBzdGFydCwgZW5kKSB7CiAgICAgICAgICB2YXIgcGF0dGVybnMgPSB0aGlzLnBhdHRlcm5zOwoKICAgICAgICAgIGlmICghcGF0dGVybnMpIHsKICAgICAgICAgICAgdGhpcy5wYXR0ZXJucyA9IHBhdHRlcm5zID0ge307CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGRlY29kaW5nQ29udGV4dCA9IG5ldyBEZWNvZGluZ0NvbnRleHQoZGF0YSwgc3RhcnQsIGVuZCk7CiAgICAgICAgICBwYXR0ZXJuc1tjdXJyZW50U2VnbWVudF0gPSBkZWNvZGVQYXR0ZXJuRGljdGlvbmFyeShkaWN0aW9uYXJ5Lm1tciwgZGljdGlvbmFyeS5wYXR0ZXJuV2lkdGgsIGRpY3Rpb25hcnkucGF0dGVybkhlaWdodCwgZGljdGlvbmFyeS5tYXhQYXR0ZXJuSW5kZXgsIGRpY3Rpb25hcnkudGVtcGxhdGUsIGRlY29kaW5nQ29udGV4dCk7CiAgICAgICAgfSwKICAgICAgICBvbkltbWVkaWF0ZUhhbGZ0b25lUmVnaW9uOiBmdW5jdGlvbiBvbkltbWVkaWF0ZUhhbGZ0b25lUmVnaW9uKHJlZ2lvbiwgcmVmZXJyZWRTZWdtZW50cywgZGF0YSwgc3RhcnQsIGVuZCkgewogICAgICAgICAgdmFyIHBhdHRlcm5zID0gdGhpcy5wYXR0ZXJuc1tyZWZlcnJlZFNlZ21lbnRzWzBdXTsKICAgICAgICAgIHZhciByZWdpb25JbmZvID0gcmVnaW9uLmluZm87CiAgICAgICAgICB2YXIgZGVjb2RpbmdDb250ZXh0ID0gbmV3IERlY29kaW5nQ29udGV4dChkYXRhLCBzdGFydCwgZW5kKTsKICAgICAgICAgIHZhciBiaXRtYXAgPSBkZWNvZGVIYWxmdG9uZVJlZ2lvbihyZWdpb24ubW1yLCBwYXR0ZXJucywgcmVnaW9uLnRlbXBsYXRlLCByZWdpb25JbmZvLndpZHRoLCByZWdpb25JbmZvLmhlaWdodCwgcmVnaW9uLmRlZmF1bHRQaXhlbFZhbHVlLCByZWdpb24uZW5hYmxlU2tpcCwgcmVnaW9uLmNvbWJpbmF0aW9uT3BlcmF0b3IsIHJlZ2lvbi5ncmlkV2lkdGgsIHJlZ2lvbi5ncmlkSGVpZ2h0LCByZWdpb24uZ3JpZE9mZnNldFgsIHJlZ2lvbi5ncmlkT2Zmc2V0WSwgcmVnaW9uLmdyaWRWZWN0b3JYLCByZWdpb24uZ3JpZFZlY3RvclksIGRlY29kaW5nQ29udGV4dCk7CiAgICAgICAgICB0aGlzLmRyYXdCaXRtYXAocmVnaW9uSW5mbywgYml0bWFwKTsKICAgICAgICB9LAogICAgICAgIG9uSW1tZWRpYXRlTG9zc2xlc3NIYWxmdG9uZVJlZ2lvbjogZnVuY3Rpb24gb25JbW1lZGlhdGVMb3NzbGVzc0hhbGZ0b25lUmVnaW9uKCkgewogICAgICAgICAgdGhpcy5vbkltbWVkaWF0ZUhhbGZ0b25lUmVnaW9uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfSwKICAgICAgICBvblRhYmxlczogZnVuY3Rpb24gb25UYWJsZXMoY3VycmVudFNlZ21lbnQsIGRhdGEsIHN0YXJ0LCBlbmQpIHsKICAgICAgICAgIHZhciBjdXN0b21UYWJsZXMgPSB0aGlzLmN1c3RvbVRhYmxlczsKCiAgICAgICAgICBpZiAoIWN1c3RvbVRhYmxlcykgewogICAgICAgICAgICB0aGlzLmN1c3RvbVRhYmxlcyA9IGN1c3RvbVRhYmxlcyA9IHt9OwogICAgICAgICAgfQoKICAgICAgICAgIGN1c3RvbVRhYmxlc1tjdXJyZW50U2VnbWVudF0gPSBkZWNvZGVUYWJsZXNTZWdtZW50KGRhdGEsIHN0YXJ0LCBlbmQpOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIGZ1bmN0aW9uIEh1ZmZtYW5MaW5lKGxpbmVEYXRhKSB7CiAgICAgICAgaWYgKGxpbmVEYXRhLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgdGhpcy5pc09PQiA9IHRydWU7CiAgICAgICAgICB0aGlzLnJhbmdlTG93ID0gMDsKICAgICAgICAgIHRoaXMucHJlZml4TGVuZ3RoID0gbGluZURhdGFbMF07CiAgICAgICAgICB0aGlzLnJhbmdlTGVuZ3RoID0gMDsKICAgICAgICAgIHRoaXMucHJlZml4Q29kZSA9IGxpbmVEYXRhWzFdOwogICAgICAgICAgdGhpcy5pc0xvd2VyUmFuZ2UgPSBmYWxzZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5pc09PQiA9IGZhbHNlOwogICAgICAgICAgdGhpcy5yYW5nZUxvdyA9IGxpbmVEYXRhWzBdOwogICAgICAgICAgdGhpcy5wcmVmaXhMZW5ndGggPSBsaW5lRGF0YVsxXTsKICAgICAgICAgIHRoaXMucmFuZ2VMZW5ndGggPSBsaW5lRGF0YVsyXTsKICAgICAgICAgIHRoaXMucHJlZml4Q29kZSA9IGxpbmVEYXRhWzNdOwogICAgICAgICAgdGhpcy5pc0xvd2VyUmFuZ2UgPSBsaW5lRGF0YVs0XSA9PT0gImxvd2VyIjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIEh1ZmZtYW5UcmVlTm9kZShsaW5lKSB7CiAgICAgICAgdGhpcy5jaGlsZHJlbiA9IFtdOwoKICAgICAgICBpZiAobGluZSkgewogICAgICAgICAgdGhpcy5pc0xlYWYgPSB0cnVlOwogICAgICAgICAgdGhpcy5yYW5nZUxlbmd0aCA9IGxpbmUucmFuZ2VMZW5ndGg7CiAgICAgICAgICB0aGlzLnJhbmdlTG93ID0gbGluZS5yYW5nZUxvdzsKICAgICAgICAgIHRoaXMuaXNMb3dlclJhbmdlID0gbGluZS5pc0xvd2VyUmFuZ2U7CiAgICAgICAgICB0aGlzLmlzT09CID0gbGluZS5pc09PQjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5pc0xlYWYgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIEh1ZmZtYW5UcmVlTm9kZS5wcm90b3R5cGUgPSB7CiAgICAgICAgYnVpbGRUcmVlOiBmdW5jdGlvbiBidWlsZFRyZWUobGluZSwgc2hpZnQpIHsKICAgICAgICAgIHZhciBiaXQgPSBsaW5lLnByZWZpeENvZGUgPj4gc2hpZnQgJiAxOwoKICAgICAgICAgIGlmIChzaGlmdCA8PSAwKSB7CiAgICAgICAgICAgIHRoaXMuY2hpbGRyZW5bYml0XSA9IG5ldyBIdWZmbWFuVHJlZU5vZGUobGluZSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgbm9kZSA9IHRoaXMuY2hpbGRyZW5bYml0XTsKCiAgICAgICAgICAgIGlmICghbm9kZSkgewogICAgICAgICAgICAgIHRoaXMuY2hpbGRyZW5bYml0XSA9IG5vZGUgPSBuZXcgSHVmZm1hblRyZWVOb2RlKG51bGwpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBub2RlLmJ1aWxkVHJlZShsaW5lLCBzaGlmdCAtIDEpOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgZGVjb2RlTm9kZTogZnVuY3Rpb24gZGVjb2RlTm9kZShyZWFkZXIpIHsKICAgICAgICAgIGlmICh0aGlzLmlzTGVhZikgewogICAgICAgICAgICBpZiAodGhpcy5pc09PQikgewogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgaHRPZmZzZXQgPSByZWFkZXIucmVhZEJpdHModGhpcy5yYW5nZUxlbmd0aCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnJhbmdlTG93ICsgKHRoaXMuaXNMb3dlclJhbmdlID8gLWh0T2Zmc2V0IDogaHRPZmZzZXQpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBub2RlID0gdGhpcy5jaGlsZHJlbltyZWFkZXIucmVhZEJpdCgpXTsKCiAgICAgICAgICBpZiAoIW5vZGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoImludmFsaWQgSHVmZm1hbiBkYXRhIik7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIG5vZGUuZGVjb2RlTm9kZShyZWFkZXIpOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIGZ1bmN0aW9uIEh1ZmZtYW5UYWJsZShsaW5lcywgcHJlZml4Q29kZXNEb25lKSB7CiAgICAgICAgaWYgKCFwcmVmaXhDb2Rlc0RvbmUpIHsKICAgICAgICAgIHRoaXMuYXNzaWduUHJlZml4Q29kZXMobGluZXMpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5yb290Tm9kZSA9IG5ldyBIdWZmbWFuVHJlZU5vZGUobnVsbCk7CgogICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGxpbmVzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgIHZhciBsaW5lID0gbGluZXNbaV07CgogICAgICAgICAgaWYgKGxpbmUucHJlZml4TGVuZ3RoID4gMCkgewogICAgICAgICAgICB0aGlzLnJvb3ROb2RlLmJ1aWxkVHJlZShsaW5lLCBsaW5lLnByZWZpeExlbmd0aCAtIDEpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgSHVmZm1hblRhYmxlLnByb3RvdHlwZSA9IHsKICAgICAgICBkZWNvZGU6IGZ1bmN0aW9uIGRlY29kZShyZWFkZXIpIHsKICAgICAgICAgIHJldHVybiB0aGlzLnJvb3ROb2RlLmRlY29kZU5vZGUocmVhZGVyKTsKICAgICAgICB9LAogICAgICAgIGFzc2lnblByZWZpeENvZGVzOiBmdW5jdGlvbiBhc3NpZ25QcmVmaXhDb2RlcyhsaW5lcykgewogICAgICAgICAgdmFyIGxpbmVzTGVuZ3RoID0gbGluZXMubGVuZ3RoOwogICAgICAgICAgdmFyIHByZWZpeExlbmd0aE1heCA9IDA7CgogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaW5lc0xlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHByZWZpeExlbmd0aE1heCA9IE1hdGgubWF4KHByZWZpeExlbmd0aE1heCwgbGluZXNbaV0ucHJlZml4TGVuZ3RoKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgaGlzdG9ncmFtID0gbmV3IFVpbnQzMkFycmF5KHByZWZpeExlbmd0aE1heCArIDEpOwoKICAgICAgICAgIGZvciAodmFyIF9pMiA9IDA7IF9pMiA8IGxpbmVzTGVuZ3RoOyBfaTIrKykgewogICAgICAgICAgICBoaXN0b2dyYW1bbGluZXNbX2kyXS5wcmVmaXhMZW5ndGhdKys7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGN1cnJlbnRMZW5ndGggPSAxLAogICAgICAgICAgICBmaXJzdENvZGUgPSAwLAogICAgICAgICAgICBjdXJyZW50Q29kZSwKICAgICAgICAgICAgY3VycmVudFRlbXAsCiAgICAgICAgICAgIGxpbmU7CiAgICAgICAgICBoaXN0b2dyYW1bMF0gPSAwOwoKICAgICAgICAgIHdoaWxlIChjdXJyZW50TGVuZ3RoIDw9IHByZWZpeExlbmd0aE1heCkgewogICAgICAgICAgICBmaXJzdENvZGUgPSBmaXJzdENvZGUgKyBoaXN0b2dyYW1bY3VycmVudExlbmd0aCAtIDFdIDw8IDE7CiAgICAgICAgICAgIGN1cnJlbnRDb2RlID0gZmlyc3RDb2RlOwogICAgICAgICAgICBjdXJyZW50VGVtcCA9IDA7CgogICAgICAgICAgICB3aGlsZSAoY3VycmVudFRlbXAgPCBsaW5lc0xlbmd0aCkgewogICAgICAgICAgICAgIGxpbmUgPSBsaW5lc1tjdXJyZW50VGVtcF07CgogICAgICAgICAgICAgIGlmIChsaW5lLnByZWZpeExlbmd0aCA9PT0gY3VycmVudExlbmd0aCkgewogICAgICAgICAgICAgICAgbGluZS5wcmVmaXhDb2RlID0gY3VycmVudENvZGU7CiAgICAgICAgICAgICAgICBjdXJyZW50Q29kZSsrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY3VycmVudFRlbXArKzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY3VycmVudExlbmd0aCsrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTsKCiAgICAgIGZ1bmN0aW9uIGRlY29kZVRhYmxlc1NlZ21lbnQoZGF0YSwgc3RhcnQsIGVuZCkgewogICAgICAgIHZhciBmbGFncyA9IGRhdGFbc3RhcnRdOwogICAgICAgIHZhciBsb3dlc3RWYWx1ZSA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDMyKShkYXRhLCBzdGFydCArIDEpICYgMHhmZmZmZmZmZjsKICAgICAgICB2YXIgaGlnaGVzdFZhbHVlID0gKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MzIpKGRhdGEsIHN0YXJ0ICsgNSkgJiAweGZmZmZmZmZmOwogICAgICAgIHZhciByZWFkZXIgPSBuZXcgUmVhZGVyKGRhdGEsIHN0YXJ0ICsgOSwgZW5kKTsKICAgICAgICB2YXIgcHJlZml4U2l6ZUJpdHMgPSAoZmxhZ3MgPj4gMSAmIDcpICsgMTsKICAgICAgICB2YXIgcmFuZ2VTaXplQml0cyA9IChmbGFncyA+PiA0ICYgNykgKyAxOwogICAgICAgIHZhciBsaW5lcyA9IFtdOwogICAgICAgIHZhciBwcmVmaXhMZW5ndGgsCiAgICAgICAgICByYW5nZUxlbmd0aCwKICAgICAgICAgIGN1cnJlbnRSYW5nZUxvdyA9IGxvd2VzdFZhbHVlOwoKICAgICAgICBkbyB7CiAgICAgICAgICBwcmVmaXhMZW5ndGggPSByZWFkZXIucmVhZEJpdHMocHJlZml4U2l6ZUJpdHMpOwogICAgICAgICAgcmFuZ2VMZW5ndGggPSByZWFkZXIucmVhZEJpdHMocmFuZ2VTaXplQml0cyk7CiAgICAgICAgICBsaW5lcy5wdXNoKG5ldyBIdWZmbWFuTGluZShbY3VycmVudFJhbmdlTG93LCBwcmVmaXhMZW5ndGgsIHJhbmdlTGVuZ3RoLCAwXSkpOwogICAgICAgICAgY3VycmVudFJhbmdlTG93ICs9IDEgPDwgcmFuZ2VMZW5ndGg7CiAgICAgICAgfSB3aGlsZSAoY3VycmVudFJhbmdlTG93IDwgaGlnaGVzdFZhbHVlKTsKCiAgICAgICAgcHJlZml4TGVuZ3RoID0gcmVhZGVyLnJlYWRCaXRzKHByZWZpeFNpemVCaXRzKTsKICAgICAgICBsaW5lcy5wdXNoKG5ldyBIdWZmbWFuTGluZShbbG93ZXN0VmFsdWUgLSAxLCBwcmVmaXhMZW5ndGgsIDMyLCAwLCAibG93ZXIiXSkpOwogICAgICAgIHByZWZpeExlbmd0aCA9IHJlYWRlci5yZWFkQml0cyhwcmVmaXhTaXplQml0cyk7CiAgICAgICAgbGluZXMucHVzaChuZXcgSHVmZm1hbkxpbmUoW2hpZ2hlc3RWYWx1ZSwgcHJlZml4TGVuZ3RoLCAzMiwgMF0pKTsKCiAgICAgICAgaWYgKGZsYWdzICYgMSkgewogICAgICAgICAgcHJlZml4TGVuZ3RoID0gcmVhZGVyLnJlYWRCaXRzKHByZWZpeFNpemVCaXRzKTsKICAgICAgICAgIGxpbmVzLnB1c2gobmV3IEh1ZmZtYW5MaW5lKFtwcmVmaXhMZW5ndGgsIDBdKSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbmV3IEh1ZmZtYW5UYWJsZShsaW5lcywgZmFsc2UpOwogICAgICB9CgogICAgICB2YXIgc3RhbmRhcmRUYWJsZXNDYWNoZSA9IHt9OwoKICAgICAgZnVuY3Rpb24gZ2V0U3RhbmRhcmRUYWJsZShudW1iZXIpIHsKICAgICAgICB2YXIgdGFibGUgPSBzdGFuZGFyZFRhYmxlc0NhY2hlW251bWJlcl07CgogICAgICAgIGlmICh0YWJsZSkgewogICAgICAgICAgcmV0dXJuIHRhYmxlOwogICAgICAgIH0KCiAgICAgICAgdmFyIGxpbmVzOwoKICAgICAgICBzd2l0Y2ggKG51bWJlcikgewogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICBsaW5lcyA9IFtbMCwgMSwgNCwgMHgwXSwgWzE2LCAyLCA4LCAweDJdLCBbMjcyLCAzLCAxNiwgMHg2XSwgWzY1ODA4LCAzLCAzMiwgMHg3XV07CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgbGluZXMgPSBbWzAsIDEsIDAsIDB4MF0sIFsxLCAyLCAwLCAweDJdLCBbMiwgMywgMCwgMHg2XSwgWzMsIDQsIDMsIDB4ZV0sIFsxMSwgNSwgNiwgMHgxZV0sIFs3NSwgNiwgMzIsIDB4M2VdLCBbNiwgMHgzZl1dOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIGxpbmVzID0gW1stMjU2LCA4LCA4LCAweGZlXSwgWzAsIDEsIDAsIDB4MF0sIFsxLCAyLCAwLCAweDJdLCBbMiwgMywgMCwgMHg2XSwgWzMsIDQsIDMsIDB4ZV0sIFsxMSwgNSwgNiwgMHgxZV0sIFstMjU3LCA4LCAzMiwgMHhmZiwgImxvd2VyIl0sIFs3NSwgNywgMzIsIDB4N2VdLCBbNiwgMHgzZV1dOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgIGxpbmVzID0gW1sxLCAxLCAwLCAweDBdLCBbMiwgMiwgMCwgMHgyXSwgWzMsIDMsIDAsIDB4Nl0sIFs0LCA0LCAzLCAweGVdLCBbMTIsIDUsIDYsIDB4MWVdLCBbNzYsIDUsIDMyLCAweDFmXV07CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgbGluZXMgPSBbWy0yNTUsIDcsIDgsIDB4N2VdLCBbMSwgMSwgMCwgMHgwXSwgWzIsIDIsIDAsIDB4Ml0sIFszLCAzLCAwLCAweDZdLCBbNCwgNCwgMywgMHhlXSwgWzEyLCA1LCA2LCAweDFlXSwgWy0yNTYsIDcsIDMyLCAweDdmLCAibG93ZXIiXSwgWzc2LCA2LCAzMiwgMHgzZV1dOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgIGxpbmVzID0gW1stMjA0OCwgNSwgMTAsIDB4MWNdLCBbLTEwMjQsIDQsIDksIDB4OF0sIFstNTEyLCA0LCA4LCAweDldLCBbLTI1NiwgNCwgNywgMHhhXSwgWy0xMjgsIDUsIDYsIDB4MWRdLCBbLTY0LCA1LCA1LCAweDFlXSwgWy0zMiwgNCwgNSwgMHhiXSwgWzAsIDIsIDcsIDB4MF0sIFsxMjgsIDMsIDcsIDB4Ml0sIFsyNTYsIDMsIDgsIDB4M10sIFs1MTIsIDQsIDksIDB4Y10sIFsxMDI0LCA0LCAxMCwgMHhkXSwgWy0yMDQ5LCA2LCAzMiwgMHgzZSwgImxvd2VyIl0sIFsyMDQ4LCA2LCAzMiwgMHgzZl1dOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgIGxpbmVzID0gW1stMTAyNCwgNCwgOSwgMHg4XSwgWy01MTIsIDMsIDgsIDB4MF0sIFstMjU2LCA0LCA3LCAweDldLCBbLTEyOCwgNSwgNiwgMHgxYV0sIFstNjQsIDUsIDUsIDB4MWJdLCBbLTMyLCA0LCA1LCAweGFdLCBbMCwgNCwgNSwgMHhiXSwgWzMyLCA1LCA1LCAweDFjXSwgWzY0LCA1LCA2LCAweDFkXSwgWzEyOCwgNCwgNywgMHhjXSwgWzI1NiwgMywgOCwgMHgxXSwgWzUxMiwgMywgOSwgMHgyXSwgWzEwMjQsIDMsIDEwLCAweDNdLCBbLTEwMjUsIDUsIDMyLCAweDFlLCAibG93ZXIiXSwgWzIwNDgsIDUsIDMyLCAweDFmXV07CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgbGluZXMgPSBbWy0xNSwgOCwgMywgMHhmY10sIFstNywgOSwgMSwgMHgxZmNdLCBbLTUsIDgsIDEsIDB4ZmRdLCBbLTMsIDksIDAsIDB4MWZkXSwgWy0yLCA3LCAwLCAweDdjXSwgWy0xLCA0LCAwLCAweGFdLCBbMCwgMiwgMSwgMHgwXSwgWzIsIDUsIDAsIDB4MWFdLCBbMywgNiwgMCwgMHgzYV0sIFs0LCAzLCA0LCAweDRdLCBbMjAsIDYsIDEsIDB4M2JdLCBbMjIsIDQsIDQsIDB4Yl0sIFszOCwgNCwgNSwgMHhjXSwgWzcwLCA1LCA2LCAweDFiXSwgWzEzNCwgNSwgNywgMHgxY10sIFsyNjIsIDYsIDcsIDB4M2NdLCBbMzkwLCA3LCA4LCAweDdkXSwgWzY0NiwgNiwgMTAsIDB4M2RdLCBbLTE2LCA5LCAzMiwgMHgxZmUsICJsb3dlciJdLCBbMTY3MCwgOSwgMzIsIDB4MWZmXSwgWzIsIDB4MV1dOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgIGxpbmVzID0gW1stMzEsIDgsIDQsIDB4ZmNdLCBbLTE1LCA5LCAyLCAweDFmY10sIFstMTEsIDgsIDIsIDB4ZmRdLCBbLTcsIDksIDEsIDB4MWZkXSwgWy01LCA3LCAxLCAweDdjXSwgWy0zLCA0LCAxLCAweGFdLCBbLTEsIDMsIDEsIDB4Ml0sIFsxLCAzLCAxLCAweDNdLCBbMywgNSwgMSwgMHgxYV0sIFs1LCA2LCAxLCAweDNhXSwgWzcsIDMsIDUsIDB4NF0sIFszOSwgNiwgMiwgMHgzYl0sIFs0MywgNCwgNSwgMHhiXSwgWzc1LCA0LCA2LCAweGNdLCBbMTM5LCA1LCA3LCAweDFiXSwgWzI2NywgNSwgOCwgMHgxY10sIFs1MjMsIDYsIDgsIDB4M2NdLCBbNzc5LCA3LCA5LCAweDdkXSwgWzEyOTEsIDYsIDExLCAweDNkXSwgWy0zMiwgOSwgMzIsIDB4MWZlLCAibG93ZXIiXSwgWzMzMzksIDksIDMyLCAweDFmZl0sIFsyLCAweDBdXTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgbGluZXMgPSBbWy0yMSwgNywgNCwgMHg3YV0sIFstNSwgOCwgMCwgMHhmY10sIFstNCwgNywgMCwgMHg3Yl0sIFstMywgNSwgMCwgMHgxOF0sIFstMiwgMiwgMiwgMHgwXSwgWzIsIDUsIDAsIDB4MTldLCBbMywgNiwgMCwgMHgzNl0sIFs0LCA3LCAwLCAweDdjXSwgWzUsIDgsIDAsIDB4ZmRdLCBbNiwgMiwgNiwgMHgxXSwgWzcwLCA1LCA1LCAweDFhXSwgWzEwMiwgNiwgNSwgMHgzN10sIFsxMzQsIDYsIDYsIDB4MzhdLCBbMTk4LCA2LCA3LCAweDM5XSwgWzMyNiwgNiwgOCwgMHgzYV0sIFs1ODIsIDYsIDksIDB4M2JdLCBbMTA5NCwgNiwgMTAsIDB4M2NdLCBbMjExOCwgNywgMTEsIDB4N2RdLCBbLTIyLCA4LCAzMiwgMHhmZSwgImxvd2VyIl0sIFs0MTY2LCA4LCAzMiwgMHhmZl0sIFsyLCAweDJdXTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgbGluZXMgPSBbWzEsIDEsIDAsIDB4MF0sIFsyLCAyLCAxLCAweDJdLCBbNCwgNCwgMCwgMHhjXSwgWzUsIDQsIDEsIDB4ZF0sIFs3LCA1LCAxLCAweDFjXSwgWzksIDUsIDIsIDB4MWRdLCBbMTMsIDYsIDIsIDB4M2NdLCBbMTcsIDcsIDIsIDB4N2FdLCBbMjEsIDcsIDMsIDB4N2JdLCBbMjksIDcsIDQsIDB4N2NdLCBbNDUsIDcsIDUsIDB4N2RdLCBbNzcsIDcsIDYsIDB4N2VdLCBbMTQxLCA3LCAzMiwgMHg3Zl1dOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICBsaW5lcyA9IFtbMSwgMSwgMCwgMHgwXSwgWzIsIDIsIDAsIDB4Ml0sIFszLCAzLCAxLCAweDZdLCBbNSwgNSwgMCwgMHgxY10sIFs2LCA1LCAxLCAweDFkXSwgWzgsIDYsIDEsIDB4M2NdLCBbMTAsIDcsIDAsIDB4N2FdLCBbMTEsIDcsIDEsIDB4N2JdLCBbMTMsIDcsIDIsIDB4N2NdLCBbMTcsIDcsIDMsIDB4N2RdLCBbMjUsIDcsIDQsIDB4N2VdLCBbNDEsIDgsIDUsIDB4ZmVdLCBbNzMsIDgsIDMyLCAweGZmXV07CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgIGxpbmVzID0gW1sxLCAxLCAwLCAweDBdLCBbMiwgMywgMCwgMHg0XSwgWzMsIDQsIDAsIDB4Y10sIFs0LCA1LCAwLCAweDFjXSwgWzUsIDQsIDEsIDB4ZF0sIFs3LCAzLCAzLCAweDVdLCBbMTUsIDYsIDEsIDB4M2FdLCBbMTcsIDYsIDIsIDB4M2JdLCBbMjEsIDYsIDMsIDB4M2NdLCBbMjksIDYsIDQsIDB4M2RdLCBbNDUsIDYsIDUsIDB4M2VdLCBbNzcsIDcsIDYsIDB4N2VdLCBbMTQxLCA3LCAzMiwgMHg3Zl1dOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICBsaW5lcyA9IFtbLTIsIDMsIDAsIDB4NF0sIFstMSwgMywgMCwgMHg1XSwgWzAsIDEsIDAsIDB4MF0sIFsxLCAzLCAwLCAweDZdLCBbMiwgMywgMCwgMHg3XV07CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgIGxpbmVzID0gW1stMjQsIDcsIDQsIDB4N2NdLCBbLTgsIDYsIDIsIDB4M2NdLCBbLTQsIDUsIDEsIDB4MWNdLCBbLTIsIDQsIDAsIDB4Y10sIFstMSwgMywgMCwgMHg0XSwgWzAsIDEsIDAsIDB4MF0sIFsxLCAzLCAwLCAweDVdLCBbMiwgNCwgMCwgMHhkXSwgWzMsIDUsIDEsIDB4MWRdLCBbNSwgNiwgMiwgMHgzZF0sIFs5LCA3LCA0LCAweDdkXSwgWy0yNSwgNywgMzIsIDB4N2UsICJsb3dlciJdLCBbMjUsIDcsIDMyLCAweDdmXV07CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKCJzdGFuZGFyZCB0YWJsZSBCLiIuY29uY2F0KG51bWJlciwgIiBkb2VzIG5vdCBleGlzdCIpKTsKICAgICAgICB9CgogICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGxpbmVzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgIGxpbmVzW2ldID0gbmV3IEh1ZmZtYW5MaW5lKGxpbmVzW2ldKTsKICAgICAgICB9CgogICAgICAgIHRhYmxlID0gbmV3IEh1ZmZtYW5UYWJsZShsaW5lcywgdHJ1ZSk7CiAgICAgICAgc3RhbmRhcmRUYWJsZXNDYWNoZVtudW1iZXJdID0gdGFibGU7CiAgICAgICAgcmV0dXJuIHRhYmxlOwogICAgICB9CgogICAgICBmdW5jdGlvbiBSZWFkZXIoZGF0YSwgc3RhcnQsIGVuZCkgewogICAgICAgIHRoaXMuZGF0YSA9IGRhdGE7CiAgICAgICAgdGhpcy5zdGFydCA9IHN0YXJ0OwogICAgICAgIHRoaXMuZW5kID0gZW5kOwogICAgICAgIHRoaXMucG9zaXRpb24gPSBzdGFydDsKICAgICAgICB0aGlzLnNoaWZ0ID0gLTE7CiAgICAgICAgdGhpcy5jdXJyZW50Qnl0ZSA9IDA7CiAgICAgIH0KCiAgICAgIFJlYWRlci5wcm90b3R5cGUgPSB7CiAgICAgICAgcmVhZEJpdDogZnVuY3Rpb24gcmVhZEJpdCgpIHsKICAgICAgICAgIGlmICh0aGlzLnNoaWZ0IDwgMCkgewogICAgICAgICAgICBpZiAodGhpcy5wb3NpdGlvbiA+PSB0aGlzLmVuZCkgewogICAgICAgICAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKCJlbmQgb2YgZGF0YSB3aGlsZSByZWFkaW5nIGJpdCIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLmN1cnJlbnRCeXRlID0gdGhpcy5kYXRhW3RoaXMucG9zaXRpb24rK107CiAgICAgICAgICAgIHRoaXMuc2hpZnQgPSA3OwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBiaXQgPSB0aGlzLmN1cnJlbnRCeXRlID4+IHRoaXMuc2hpZnQgJiAxOwogICAgICAgICAgdGhpcy5zaGlmdC0tOwogICAgICAgICAgcmV0dXJuIGJpdDsKICAgICAgICB9LAogICAgICAgIHJlYWRCaXRzOiBmdW5jdGlvbiByZWFkQml0cyhudW1CaXRzKSB7CiAgICAgICAgICB2YXIgcmVzdWx0ID0gMCwKICAgICAgICAgICAgaTsKCiAgICAgICAgICBmb3IgKGkgPSBudW1CaXRzIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgcmVzdWx0IHw9IHRoaXMucmVhZEJpdCgpIDw8IGk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9LAogICAgICAgIGJ5dGVBbGlnbjogZnVuY3Rpb24gYnl0ZUFsaWduKCkgewogICAgICAgICAgdGhpcy5zaGlmdCA9IC0xOwogICAgICAgIH0sCiAgICAgICAgbmV4dDogZnVuY3Rpb24gbmV4dCgpIHsKICAgICAgICAgIGlmICh0aGlzLnBvc2l0aW9uID49IHRoaXMuZW5kKSB7CiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gdGhpcy5kYXRhW3RoaXMucG9zaXRpb24rK107CiAgICAgICAgfQogICAgICB9OwoKICAgICAgZnVuY3Rpb24gZ2V0Q3VzdG9tSHVmZm1hblRhYmxlKGluZGV4LCByZWZlcnJlZFRvLCBjdXN0b21UYWJsZXMpIHsKICAgICAgICB2YXIgY3VycmVudEluZGV4ID0gMDsKCiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gcmVmZXJyZWRUby5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICB2YXIgdGFibGUgPSBjdXN0b21UYWJsZXNbcmVmZXJyZWRUb1tpXV07CgogICAgICAgICAgaWYgKHRhYmxlKSB7CiAgICAgICAgICAgIGlmIChpbmRleCA9PT0gY3VycmVudEluZGV4KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRhYmxlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjdXJyZW50SW5kZXgrKzsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKCJjYW4ndCBmaW5kIGN1c3RvbSBIdWZmbWFuIHRhYmxlIik7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGdldFRleHRSZWdpb25IdWZmbWFuVGFibGVzKHRleHRSZWdpb24sIHJlZmVycmVkVG8sIGN1c3RvbVRhYmxlcywgbnVtYmVyT2ZTeW1ib2xzLCByZWFkZXIpIHsKICAgICAgICB2YXIgY29kZXMgPSBbXTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPD0gMzQ7IGkrKykgewogICAgICAgICAgdmFyIGNvZGVMZW5ndGggPSByZWFkZXIucmVhZEJpdHMoNCk7CiAgICAgICAgICBjb2Rlcy5wdXNoKG5ldyBIdWZmbWFuTGluZShbaSwgY29kZUxlbmd0aCwgMCwgMF0pKTsKICAgICAgICB9CgogICAgICAgIHZhciBydW5Db2Rlc1RhYmxlID0gbmV3IEh1ZmZtYW5UYWJsZShjb2RlcywgZmFsc2UpOwogICAgICAgIGNvZGVzLmxlbmd0aCA9IDA7CgogICAgICAgIGZvciAodmFyIF9pMyA9IDA7IF9pMyA8IG51bWJlck9mU3ltYm9sczspIHsKICAgICAgICAgIHZhciBfY29kZUxlbmd0aCA9IHJ1bkNvZGVzVGFibGUuZGVjb2RlKHJlYWRlcik7CgogICAgICAgICAgaWYgKF9jb2RlTGVuZ3RoID49IDMyKSB7CiAgICAgICAgICAgIHZhciByZXBlYXRlZExlbmd0aCA9IHZvaWQgMCwKICAgICAgICAgICAgICBudW1iZXJPZlJlcGVhdHMgPSB2b2lkIDAsCiAgICAgICAgICAgICAgaiA9IHZvaWQgMDsKCiAgICAgICAgICAgIHN3aXRjaCAoX2NvZGVMZW5ndGgpIHsKICAgICAgICAgICAgICBjYXNlIDMyOgogICAgICAgICAgICAgICAgaWYgKF9pMyA9PT0gMCkgewogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcigibm8gcHJldmlvdXMgdmFsdWUgaW4gc3ltYm9sIElEIHRhYmxlIik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbnVtYmVyT2ZSZXBlYXRzID0gcmVhZGVyLnJlYWRCaXRzKDIpICsgMzsKICAgICAgICAgICAgICAgIHJlcGVhdGVkTGVuZ3RoID0gY29kZXNbX2kzIC0gMV0ucHJlZml4TGVuZ3RoOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMzM6CiAgICAgICAgICAgICAgICBudW1iZXJPZlJlcGVhdHMgPSByZWFkZXIucmVhZEJpdHMoMykgKyAzOwogICAgICAgICAgICAgICAgcmVwZWF0ZWRMZW5ndGggPSAwOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMzQ6CiAgICAgICAgICAgICAgICBudW1iZXJPZlJlcGVhdHMgPSByZWFkZXIucmVhZEJpdHMoNykgKyAxMTsKICAgICAgICAgICAgICAgIHJlcGVhdGVkTGVuZ3RoID0gMDsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoImludmFsaWQgY29kZSBsZW5ndGggaW4gc3ltYm9sIElEIHRhYmxlIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBudW1iZXJPZlJlcGVhdHM7IGorKykgewogICAgICAgICAgICAgIGNvZGVzLnB1c2gobmV3IEh1ZmZtYW5MaW5lKFtfaTMsIHJlcGVhdGVkTGVuZ3RoLCAwLCAwXSkpOwogICAgICAgICAgICAgIF9pMysrOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb2Rlcy5wdXNoKG5ldyBIdWZmbWFuTGluZShbX2kzLCBfY29kZUxlbmd0aCwgMCwgMF0pKTsKICAgICAgICAgICAgX2kzKys7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZWFkZXIuYnl0ZUFsaWduKCk7CiAgICAgICAgdmFyIHN5bWJvbElEVGFibGUgPSBuZXcgSHVmZm1hblRhYmxlKGNvZGVzLCBmYWxzZSk7CiAgICAgICAgdmFyIGN1c3RvbUluZGV4ID0gMCwKICAgICAgICAgIHRhYmxlRmlyc3RTLAogICAgICAgICAgdGFibGVEZWx0YVMsCiAgICAgICAgICB0YWJsZURlbHRhVDsKCiAgICAgICAgc3dpdGNoICh0ZXh0UmVnaW9uLmh1ZmZtYW5GUykgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICB0YWJsZUZpcnN0UyA9IGdldFN0YW5kYXJkVGFibGUodGV4dFJlZ2lvbi5odWZmbWFuRlMgKyA2KTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICB0YWJsZUZpcnN0UyA9IGdldEN1c3RvbUh1ZmZtYW5UYWJsZShjdXN0b21JbmRleCwgcmVmZXJyZWRUbywgY3VzdG9tVGFibGVzKTsKICAgICAgICAgICAgY3VzdG9tSW5kZXgrKzsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoImludmFsaWQgSHVmZm1hbiBGUyBzZWxlY3RvciIpOwogICAgICAgIH0KCiAgICAgICAgc3dpdGNoICh0ZXh0UmVnaW9uLmh1ZmZtYW5EUykgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICB0YWJsZURlbHRhUyA9IGdldFN0YW5kYXJkVGFibGUodGV4dFJlZ2lvbi5odWZmbWFuRFMgKyA4KTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICB0YWJsZURlbHRhUyA9IGdldEN1c3RvbUh1ZmZtYW5UYWJsZShjdXN0b21JbmRleCwgcmVmZXJyZWRUbywgY3VzdG9tVGFibGVzKTsKICAgICAgICAgICAgY3VzdG9tSW5kZXgrKzsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoImludmFsaWQgSHVmZm1hbiBEUyBzZWxlY3RvciIpOwogICAgICAgIH0KCiAgICAgICAgc3dpdGNoICh0ZXh0UmVnaW9uLmh1ZmZtYW5EVCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICB0YWJsZURlbHRhVCA9IGdldFN0YW5kYXJkVGFibGUodGV4dFJlZ2lvbi5odWZmbWFuRFQgKyAxMSk7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgdGFibGVEZWx0YVQgPSBnZXRDdXN0b21IdWZmbWFuVGFibGUoY3VzdG9tSW5kZXgsIHJlZmVycmVkVG8sIGN1c3RvbVRhYmxlcyk7CiAgICAgICAgICAgIGN1c3RvbUluZGV4Kys7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKCJpbnZhbGlkIEh1ZmZtYW4gRFQgc2VsZWN0b3IiKTsKICAgICAgICB9CgogICAgICAgIGlmICh0ZXh0UmVnaW9uLnJlZmluZW1lbnQpIHsKICAgICAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKCJyZWZpbmVtZW50IHdpdGggSHVmZm1hbiBpcyBub3Qgc3VwcG9ydGVkIik7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gewogICAgICAgICAgc3ltYm9sSURUYWJsZTogc3ltYm9sSURUYWJsZSwKICAgICAgICAgIHRhYmxlRmlyc3RTOiB0YWJsZUZpcnN0UywKICAgICAgICAgIHRhYmxlRGVsdGFTOiB0YWJsZURlbHRhUywKICAgICAgICAgIHRhYmxlRGVsdGFUOiB0YWJsZURlbHRhVAogICAgICAgIH07CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGdldFN5bWJvbERpY3Rpb25hcnlIdWZmbWFuVGFibGVzKGRpY3Rpb25hcnksIHJlZmVycmVkVG8sIGN1c3RvbVRhYmxlcykgewogICAgICAgIHZhciBjdXN0b21JbmRleCA9IDAsCiAgICAgICAgICB0YWJsZURlbHRhSGVpZ2h0LAogICAgICAgICAgdGFibGVEZWx0YVdpZHRoOwoKICAgICAgICBzd2l0Y2ggKGRpY3Rpb25hcnkuaHVmZm1hbkRIU2VsZWN0b3IpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgdGFibGVEZWx0YUhlaWdodCA9IGdldFN0YW5kYXJkVGFibGUoZGljdGlvbmFyeS5odWZmbWFuREhTZWxlY3RvciArIDQpOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIHRhYmxlRGVsdGFIZWlnaHQgPSBnZXRDdXN0b21IdWZmbWFuVGFibGUoY3VzdG9tSW5kZXgsIHJlZmVycmVkVG8sIGN1c3RvbVRhYmxlcyk7CiAgICAgICAgICAgIGN1c3RvbUluZGV4Kys7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKCJpbnZhbGlkIEh1ZmZtYW4gREggc2VsZWN0b3IiKTsKICAgICAgICB9CgogICAgICAgIHN3aXRjaCAoZGljdGlvbmFyeS5odWZmbWFuRFdTZWxlY3RvcikgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICB0YWJsZURlbHRhV2lkdGggPSBnZXRTdGFuZGFyZFRhYmxlKGRpY3Rpb25hcnkuaHVmZm1hbkRXU2VsZWN0b3IgKyAyKTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICB0YWJsZURlbHRhV2lkdGggPSBnZXRDdXN0b21IdWZmbWFuVGFibGUoY3VzdG9tSW5kZXgsIHJlZmVycmVkVG8sIGN1c3RvbVRhYmxlcyk7CiAgICAgICAgICAgIGN1c3RvbUluZGV4Kys7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKCJpbnZhbGlkIEh1ZmZtYW4gRFcgc2VsZWN0b3IiKTsKICAgICAgICB9CgogICAgICAgIHZhciB0YWJsZUJpdG1hcFNpemUsIHRhYmxlQWdncmVnYXRlSW5zdGFuY2VzOwoKICAgICAgICBpZiAoZGljdGlvbmFyeS5iaXRtYXBTaXplU2VsZWN0b3IpIHsKICAgICAgICAgIHRhYmxlQml0bWFwU2l6ZSA9IGdldEN1c3RvbUh1ZmZtYW5UYWJsZShjdXN0b21JbmRleCwgcmVmZXJyZWRUbywgY3VzdG9tVGFibGVzKTsKICAgICAgICAgIGN1c3RvbUluZGV4Kys7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRhYmxlQml0bWFwU2l6ZSA9IGdldFN0YW5kYXJkVGFibGUoMSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoZGljdGlvbmFyeS5hZ2dyZWdhdGlvbkluc3RhbmNlc1NlbGVjdG9yKSB7CiAgICAgICAgICB0YWJsZUFnZ3JlZ2F0ZUluc3RhbmNlcyA9IGdldEN1c3RvbUh1ZmZtYW5UYWJsZShjdXN0b21JbmRleCwgcmVmZXJyZWRUbywgY3VzdG9tVGFibGVzKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGFibGVBZ2dyZWdhdGVJbnN0YW5jZXMgPSBnZXRTdGFuZGFyZFRhYmxlKDEpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHRhYmxlRGVsdGFIZWlnaHQ6IHRhYmxlRGVsdGFIZWlnaHQsCiAgICAgICAgICB0YWJsZURlbHRhV2lkdGg6IHRhYmxlRGVsdGFXaWR0aCwKICAgICAgICAgIHRhYmxlQml0bWFwU2l6ZTogdGFibGVCaXRtYXBTaXplLAogICAgICAgICAgdGFibGVBZ2dyZWdhdGVJbnN0YW5jZXM6IHRhYmxlQWdncmVnYXRlSW5zdGFuY2VzCiAgICAgICAgfTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gcmVhZFVuY29tcHJlc3NlZEJpdG1hcChyZWFkZXIsIHdpZHRoLCBoZWlnaHQpIHsKICAgICAgICB2YXIgYml0bWFwID0gW107CgogICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgaGVpZ2h0OyB5KyspIHsKICAgICAgICAgIHZhciByb3cgPSBuZXcgVWludDhBcnJheSh3aWR0aCk7CiAgICAgICAgICBiaXRtYXAucHVzaChyb3cpOwoKICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgd2lkdGg7IHgrKykgewogICAgICAgICAgICByb3dbeF0gPSByZWFkZXIucmVhZEJpdCgpOwogICAgICAgICAgfQoKICAgICAgICAgIHJlYWRlci5ieXRlQWxpZ24oKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBiaXRtYXA7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGRlY29kZU1NUkJpdG1hcChpbnB1dCwgd2lkdGgsIGhlaWdodCwgZW5kT2ZCbG9jaykgewogICAgICAgIHZhciBwYXJhbXMgPSB7CiAgICAgICAgICBLOiAtMSwKICAgICAgICAgIENvbHVtbnM6IHdpZHRoLAogICAgICAgICAgUm93czogaGVpZ2h0LAogICAgICAgICAgQmxhY2tJczE6IHRydWUsCiAgICAgICAgICBFbmRPZkJsb2NrOiBlbmRPZkJsb2NrCiAgICAgICAgfTsKICAgICAgICB2YXIgZGVjb2RlciA9IG5ldyBfY2NpdHQuQ0NJVFRGYXhEZWNvZGVyKGlucHV0LCBwYXJhbXMpOwogICAgICAgIHZhciBiaXRtYXAgPSBbXTsKICAgICAgICB2YXIgY3VycmVudEJ5dGUsCiAgICAgICAgICBlb2YgPSBmYWxzZTsKCiAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCBoZWlnaHQ7IHkrKykgewogICAgICAgICAgdmFyIHJvdyA9IG5ldyBVaW50OEFycmF5KHdpZHRoKTsKICAgICAgICAgIGJpdG1hcC5wdXNoKHJvdyk7CiAgICAgICAgICB2YXIgc2hpZnQgPSAtMTsKCiAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IHdpZHRoOyB4KyspIHsKICAgICAgICAgICAgaWYgKHNoaWZ0IDwgMCkgewogICAgICAgICAgICAgIGN1cnJlbnRCeXRlID0gZGVjb2Rlci5yZWFkTmV4dENoYXIoKTsKCiAgICAgICAgICAgICAgaWYgKGN1cnJlbnRCeXRlID09PSAtMSkgewogICAgICAgICAgICAgICAgY3VycmVudEJ5dGUgPSAwOwogICAgICAgICAgICAgICAgZW9mID0gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHNoaWZ0ID0gNzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcm93W3hdID0gY3VycmVudEJ5dGUgPj4gc2hpZnQgJiAxOwogICAgICAgICAgICBzaGlmdC0tOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVuZE9mQmxvY2sgJiYgIWVvZikgewogICAgICAgICAgdmFyIGxvb2tGb3JFT0ZMaW1pdCA9IDU7CgogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsb29rRm9yRU9GTGltaXQ7IGkrKykgewogICAgICAgICAgICBpZiAoZGVjb2Rlci5yZWFkTmV4dENoYXIoKSA9PT0gLTEpIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGJpdG1hcDsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gSmJpZzJJbWFnZSgpIHt9CgogICAgICBKYmlnMkltYWdlLnByb3RvdHlwZSA9IHsKICAgICAgICBwYXJzZUNodW5rczogZnVuY3Rpb24gcGFyc2VDaHVua3MoY2h1bmtzKSB7CiAgICAgICAgICByZXR1cm4gcGFyc2VKYmlnMkNodW5rcyhjaHVua3MpOwogICAgICAgIH0sCiAgICAgICAgcGFyc2U6IGZ1bmN0aW9uIHBhcnNlKGRhdGEpIHsKICAgICAgICAgIHZhciBfcGFyc2VKYmlnID0gcGFyc2VKYmlnMihkYXRhKSwKICAgICAgICAgICAgaW1nRGF0YSA9IF9wYXJzZUpiaWcuaW1nRGF0YSwKICAgICAgICAgICAgd2lkdGggPSBfcGFyc2VKYmlnLndpZHRoLAogICAgICAgICAgICBoZWlnaHQgPSBfcGFyc2VKYmlnLmhlaWdodDsKCiAgICAgICAgICB0aGlzLndpZHRoID0gd2lkdGg7CiAgICAgICAgICB0aGlzLmhlaWdodCA9IGhlaWdodDsKICAgICAgICAgIHJldHVybiBpbWdEYXRhOwogICAgICAgIH0KICAgICAgfTsKICAgICAgcmV0dXJuIEpiaWcySW1hZ2U7CiAgICB9KCk7CgogICAgZXhwb3J0cy5KYmlnMkltYWdlID0gSmJpZzJJbWFnZTsKCiAgICAvKioqL30pLCAoCiAgLyogMjA2ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgIHZhbHVlOiB0cnVlCiAgICB9KTsKICAgIGV4cG9ydHMuQXJpdGhtZXRpY0RlY29kZXIgPSB2b2lkIDA7CgogICAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3Rvcikge2lmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7fX0KCiAgICBmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7Zm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykge3ZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07ZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlO2Rlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTtpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTtPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7fX0KCiAgICBmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7aWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7aWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpO3JldHVybiBDb25zdHJ1Y3Rvcjt9CgogICAgdmFyIFFlVGFibGUgPSBbewogICAgICBxZTogMHg1NjAxLAogICAgICBubXBzOiAxLAogICAgICBubHBzOiAxLAogICAgICBzd2l0Y2hGbGFnOiAxCiAgICB9LCB7CiAgICAgIHFlOiAweDM0MDEsCiAgICAgIG5tcHM6IDIsCiAgICAgIG5scHM6IDYsCiAgICAgIHN3aXRjaEZsYWc6IDAKICAgIH0sIHsKICAgICAgcWU6IDB4MTgwMSwKICAgICAgbm1wczogMywKICAgICAgbmxwczogOSwKICAgICAgc3dpdGNoRmxhZzogMAogICAgfSwgewogICAgICBxZTogMHgwYWMxLAogICAgICBubXBzOiA0LAogICAgICBubHBzOiAxMiwKICAgICAgc3dpdGNoRmxhZzogMAogICAgfSwgewogICAgICBxZTogMHgwNTIxLAogICAgICBubXBzOiA1LAogICAgICBubHBzOiAyOSwKICAgICAgc3dpdGNoRmxhZzogMAogICAgfSwgewogICAgICBxZTogMHgwMjIxLAogICAgICBubXBzOiAzOCwKICAgICAgbmxwczogMzMsCiAgICAgIHN3aXRjaEZsYWc6IDAKICAgIH0sIHsKICAgICAgcWU6IDB4NTYwMSwKICAgICAgbm1wczogNywKICAgICAgbmxwczogNiwKICAgICAgc3dpdGNoRmxhZzogMQogICAgfSwgewogICAgICBxZTogMHg1NDAxLAogICAgICBubXBzOiA4LAogICAgICBubHBzOiAxNCwKICAgICAgc3dpdGNoRmxhZzogMAogICAgfSwgewogICAgICBxZTogMHg0ODAxLAogICAgICBubXBzOiA5LAogICAgICBubHBzOiAxNCwKICAgICAgc3dpdGNoRmxhZzogMAogICAgfSwgewogICAgICBxZTogMHgzODAxLAogICAgICBubXBzOiAxMCwKICAgICAgbmxwczogMTQsCiAgICAgIHN3aXRjaEZsYWc6IDAKICAgIH0sIHsKICAgICAgcWU6IDB4MzAwMSwKICAgICAgbm1wczogMTEsCiAgICAgIG5scHM6IDE3LAogICAgICBzd2l0Y2hGbGFnOiAwCiAgICB9LCB7CiAgICAgIHFlOiAweDI0MDEsCiAgICAgIG5tcHM6IDEyLAogICAgICBubHBzOiAxOCwKICAgICAgc3dpdGNoRmxhZzogMAogICAgfSwgewogICAgICBxZTogMHgxYzAxLAogICAgICBubXBzOiAxMywKICAgICAgbmxwczogMjAsCiAgICAgIHN3aXRjaEZsYWc6IDAKICAgIH0sIHsKICAgICAgcWU6IDB4MTYwMSwKICAgICAgbm1wczogMjksCiAgICAgIG5scHM6IDIxLAogICAgICBzd2l0Y2hGbGFnOiAwCiAgICB9LCB7CiAgICAgIHFlOiAweDU2MDEsCiAgICAgIG5tcHM6IDE1LAogICAgICBubHBzOiAxNCwKICAgICAgc3dpdGNoRmxhZzogMQogICAgfSwgewogICAgICBxZTogMHg1NDAxLAogICAgICBubXBzOiAxNiwKICAgICAgbmxwczogMTQsCiAgICAgIHN3aXRjaEZsYWc6IDAKICAgIH0sIHsKICAgICAgcWU6IDB4NTEwMSwKICAgICAgbm1wczogMTcsCiAgICAgIG5scHM6IDE1LAogICAgICBzd2l0Y2hGbGFnOiAwCiAgICB9LCB7CiAgICAgIHFlOiAweDQ4MDEsCiAgICAgIG5tcHM6IDE4LAogICAgICBubHBzOiAxNiwKICAgICAgc3dpdGNoRmxhZzogMAogICAgfSwgewogICAgICBxZTogMHgzODAxLAogICAgICBubXBzOiAxOSwKICAgICAgbmxwczogMTcsCiAgICAgIHN3aXRjaEZsYWc6IDAKICAgIH0sIHsKICAgICAgcWU6IDB4MzQwMSwKICAgICAgbm1wczogMjAsCiAgICAgIG5scHM6IDE4LAogICAgICBzd2l0Y2hGbGFnOiAwCiAgICB9LCB7CiAgICAgIHFlOiAweDMwMDEsCiAgICAgIG5tcHM6IDIxLAogICAgICBubHBzOiAxOSwKICAgICAgc3dpdGNoRmxhZzogMAogICAgfSwgewogICAgICBxZTogMHgyODAxLAogICAgICBubXBzOiAyMiwKICAgICAgbmxwczogMTksCiAgICAgIHN3aXRjaEZsYWc6IDAKICAgIH0sIHsKICAgICAgcWU6IDB4MjQwMSwKICAgICAgbm1wczogMjMsCiAgICAgIG5scHM6IDIwLAogICAgICBzd2l0Y2hGbGFnOiAwCiAgICB9LCB7CiAgICAgIHFlOiAweDIyMDEsCiAgICAgIG5tcHM6IDI0LAogICAgICBubHBzOiAyMSwKICAgICAgc3dpdGNoRmxhZzogMAogICAgfSwgewogICAgICBxZTogMHgxYzAxLAogICAgICBubXBzOiAyNSwKICAgICAgbmxwczogMjIsCiAgICAgIHN3aXRjaEZsYWc6IDAKICAgIH0sIHsKICAgICAgcWU6IDB4MTgwMSwKICAgICAgbm1wczogMjYsCiAgICAgIG5scHM6IDIzLAogICAgICBzd2l0Y2hGbGFnOiAwCiAgICB9LCB7CiAgICAgIHFlOiAweDE2MDEsCiAgICAgIG5tcHM6IDI3LAogICAgICBubHBzOiAyNCwKICAgICAgc3dpdGNoRmxhZzogMAogICAgfSwgewogICAgICBxZTogMHgxNDAxLAogICAgICBubXBzOiAyOCwKICAgICAgbmxwczogMjUsCiAgICAgIHN3aXRjaEZsYWc6IDAKICAgIH0sIHsKICAgICAgcWU6IDB4MTIwMSwKICAgICAgbm1wczogMjksCiAgICAgIG5scHM6IDI2LAogICAgICBzd2l0Y2hGbGFnOiAwCiAgICB9LCB7CiAgICAgIHFlOiAweDExMDEsCiAgICAgIG5tcHM6IDMwLAogICAgICBubHBzOiAyNywKICAgICAgc3dpdGNoRmxhZzogMAogICAgfSwgewogICAgICBxZTogMHgwYWMxLAogICAgICBubXBzOiAzMSwKICAgICAgbmxwczogMjgsCiAgICAgIHN3aXRjaEZsYWc6IDAKICAgIH0sIHsKICAgICAgcWU6IDB4MDljMSwKICAgICAgbm1wczogMzIsCiAgICAgIG5scHM6IDI5LAogICAgICBzd2l0Y2hGbGFnOiAwCiAgICB9LCB7CiAgICAgIHFlOiAweDA4YTEsCiAgICAgIG5tcHM6IDMzLAogICAgICBubHBzOiAzMCwKICAgICAgc3dpdGNoRmxhZzogMAogICAgfSwgewogICAgICBxZTogMHgwNTIxLAogICAgICBubXBzOiAzNCwKICAgICAgbmxwczogMzEsCiAgICAgIHN3aXRjaEZsYWc6IDAKICAgIH0sIHsKICAgICAgcWU6IDB4MDQ0MSwKICAgICAgbm1wczogMzUsCiAgICAgIG5scHM6IDMyLAogICAgICBzd2l0Y2hGbGFnOiAwCiAgICB9LCB7CiAgICAgIHFlOiAweDAyYTEsCiAgICAgIG5tcHM6IDM2LAogICAgICBubHBzOiAzMywKICAgICAgc3dpdGNoRmxhZzogMAogICAgfSwgewogICAgICBxZTogMHgwMjIxLAogICAgICBubXBzOiAzNywKICAgICAgbmxwczogMzQsCiAgICAgIHN3aXRjaEZsYWc6IDAKICAgIH0sIHsKICAgICAgcWU6IDB4MDE0MSwKICAgICAgbm1wczogMzgsCiAgICAgIG5scHM6IDM1LAogICAgICBzd2l0Y2hGbGFnOiAwCiAgICB9LCB7CiAgICAgIHFlOiAweDAxMTEsCiAgICAgIG5tcHM6IDM5LAogICAgICBubHBzOiAzNiwKICAgICAgc3dpdGNoRmxhZzogMAogICAgfSwgewogICAgICBxZTogMHgwMDg1LAogICAgICBubXBzOiA0MCwKICAgICAgbmxwczogMzcsCiAgICAgIHN3aXRjaEZsYWc6IDAKICAgIH0sIHsKICAgICAgcWU6IDB4MDA0OSwKICAgICAgbm1wczogNDEsCiAgICAgIG5scHM6IDM4LAogICAgICBzd2l0Y2hGbGFnOiAwCiAgICB9LCB7CiAgICAgIHFlOiAweDAwMjUsCiAgICAgIG5tcHM6IDQyLAogICAgICBubHBzOiAzOSwKICAgICAgc3dpdGNoRmxhZzogMAogICAgfSwgewogICAgICBxZTogMHgwMDE1LAogICAgICBubXBzOiA0MywKICAgICAgbmxwczogNDAsCiAgICAgIHN3aXRjaEZsYWc6IDAKICAgIH0sIHsKICAgICAgcWU6IDB4MDAwOSwKICAgICAgbm1wczogNDQsCiAgICAgIG5scHM6IDQxLAogICAgICBzd2l0Y2hGbGFnOiAwCiAgICB9LCB7CiAgICAgIHFlOiAweDAwMDUsCiAgICAgIG5tcHM6IDQ1LAogICAgICBubHBzOiA0MiwKICAgICAgc3dpdGNoRmxhZzogMAogICAgfSwgewogICAgICBxZTogMHgwMDAxLAogICAgICBubXBzOiA0NSwKICAgICAgbmxwczogNDMsCiAgICAgIHN3aXRjaEZsYWc6IDAKICAgIH0sIHsKICAgICAgcWU6IDB4NTYwMSwKICAgICAgbm1wczogNDYsCiAgICAgIG5scHM6IDQ2LAogICAgICBzd2l0Y2hGbGFnOiAwCiAgICB9XTsKCiAgICB2YXIgQXJpdGhtZXRpY0RlY29kZXIgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBBcml0aG1ldGljRGVjb2RlcihkYXRhLCBzdGFydCwgZW5kKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEFyaXRobWV0aWNEZWNvZGVyKTsKCiAgICAgICAgdGhpcy5kYXRhID0gZGF0YTsKICAgICAgICB0aGlzLmJwID0gc3RhcnQ7CiAgICAgICAgdGhpcy5kYXRhRW5kID0gZW5kOwogICAgICAgIHRoaXMuY2hpZ2ggPSBkYXRhW3N0YXJ0XTsKICAgICAgICB0aGlzLmNsb3cgPSAwOwogICAgICAgIHRoaXMuYnl0ZUluKCk7CiAgICAgICAgdGhpcy5jaGlnaCA9IHRoaXMuY2hpZ2ggPDwgNyAmIDB4ZmZmZiB8IHRoaXMuY2xvdyA+PiA5ICYgMHg3ZjsKICAgICAgICB0aGlzLmNsb3cgPSB0aGlzLmNsb3cgPDwgNyAmIDB4ZmZmZjsKICAgICAgICB0aGlzLmN0IC09IDc7CiAgICAgICAgdGhpcy5hID0gMHg4MDAwOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoQXJpdGhtZXRpY0RlY29kZXIsIFt7CiAgICAgICAga2V5OiAiYnl0ZUluIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gYnl0ZUluKCkgewogICAgICAgICAgdmFyIGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgICAgICB2YXIgYnAgPSB0aGlzLmJwOwoKICAgICAgICAgIGlmIChkYXRhW2JwXSA9PT0gMHhmZikgewogICAgICAgICAgICBpZiAoZGF0YVticCArIDFdID4gMHg4ZikgewogICAgICAgICAgICAgIHRoaXMuY2xvdyArPSAweGZmMDA7CiAgICAgICAgICAgICAgdGhpcy5jdCA9IDg7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgYnArKzsKICAgICAgICAgICAgICB0aGlzLmNsb3cgKz0gZGF0YVticF0gPDwgOTsKICAgICAgICAgICAgICB0aGlzLmN0ID0gNzsKICAgICAgICAgICAgICB0aGlzLmJwID0gYnA7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGJwKys7CiAgICAgICAgICAgIHRoaXMuY2xvdyArPSBicCA8IHRoaXMuZGF0YUVuZCA/IGRhdGFbYnBdIDw8IDggOiAweGZmMDA7CiAgICAgICAgICAgIHRoaXMuY3QgPSA4OwogICAgICAgICAgICB0aGlzLmJwID0gYnA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRoaXMuY2xvdyA+IDB4ZmZmZikgewogICAgICAgICAgICB0aGlzLmNoaWdoICs9IHRoaXMuY2xvdyA+PiAxNjsKICAgICAgICAgICAgdGhpcy5jbG93ICY9IDB4ZmZmZjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJyZWFkQml0IiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcmVhZEJpdChjb250ZXh0cywgcG9zKSB7CiAgICAgICAgICB2YXIgY3hfaW5kZXggPSBjb250ZXh0c1twb3NdID4+IDEsCiAgICAgICAgICAgIGN4X21wcyA9IGNvbnRleHRzW3Bvc10gJiAxOwogICAgICAgICAgdmFyIHFlVGFibGVJY3ggPSBRZVRhYmxlW2N4X2luZGV4XTsKICAgICAgICAgIHZhciBxZUljeCA9IHFlVGFibGVJY3gucWU7CiAgICAgICAgICB2YXIgZDsKICAgICAgICAgIHZhciBhID0gdGhpcy5hIC0gcWVJY3g7CgogICAgICAgICAgaWYgKHRoaXMuY2hpZ2ggPCBxZUljeCkgewogICAgICAgICAgICBpZiAoYSA8IHFlSWN4KSB7CiAgICAgICAgICAgICAgYSA9IHFlSWN4OwogICAgICAgICAgICAgIGQgPSBjeF9tcHM7CiAgICAgICAgICAgICAgY3hfaW5kZXggPSBxZVRhYmxlSWN4Lm5tcHM7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgYSA9IHFlSWN4OwogICAgICAgICAgICAgIGQgPSAxIF4gY3hfbXBzOwoKICAgICAgICAgICAgICBpZiAocWVUYWJsZUljeC5zd2l0Y2hGbGFnID09PSAxKSB7CiAgICAgICAgICAgICAgICBjeF9tcHMgPSBkOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY3hfaW5kZXggPSBxZVRhYmxlSWN4Lm5scHM7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuY2hpZ2ggLT0gcWVJY3g7CgogICAgICAgICAgICBpZiAoKGEgJiAweDgwMDApICE9PSAwKSB7CiAgICAgICAgICAgICAgdGhpcy5hID0gYTsKICAgICAgICAgICAgICByZXR1cm4gY3hfbXBzOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoYSA8IHFlSWN4KSB7CiAgICAgICAgICAgICAgZCA9IDEgXiBjeF9tcHM7CgogICAgICAgICAgICAgIGlmIChxZVRhYmxlSWN4LnN3aXRjaEZsYWcgPT09IDEpIHsKICAgICAgICAgICAgICAgIGN4X21wcyA9IGQ7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjeF9pbmRleCA9IHFlVGFibGVJY3gubmxwczsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBkID0gY3hfbXBzOwogICAgICAgICAgICAgIGN4X2luZGV4ID0gcWVUYWJsZUljeC5ubXBzOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgZG8gewogICAgICAgICAgICBpZiAodGhpcy5jdCA9PT0gMCkgewogICAgICAgICAgICAgIHRoaXMuYnl0ZUluKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGEgPDw9IDE7CiAgICAgICAgICAgIHRoaXMuY2hpZ2ggPSB0aGlzLmNoaWdoIDw8IDEgJiAweGZmZmYgfCB0aGlzLmNsb3cgPj4gMTUgJiAxOwogICAgICAgICAgICB0aGlzLmNsb3cgPSB0aGlzLmNsb3cgPDwgMSAmIDB4ZmZmZjsKICAgICAgICAgICAgdGhpcy5jdC0tOwogICAgICAgICAgfSB3aGlsZSAoKGEgJiAweDgwMDApID09PSAwKTsKCiAgICAgICAgICB0aGlzLmEgPSBhOwogICAgICAgICAgY29udGV4dHNbcG9zXSA9IGN4X2luZGV4IDw8IDEgfCBjeF9tcHM7CiAgICAgICAgICByZXR1cm4gZDsKICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBBcml0aG1ldGljRGVjb2RlcjsKICAgIH0oKTsKCiAgICBleHBvcnRzLkFyaXRobWV0aWNEZWNvZGVyID0gQXJpdGhtZXRpY0RlY29kZXI7CgogICAgLyoqKi99KSwgKAogIC8qIDIwNyAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCgogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICB2YWx1ZTogdHJ1ZQogICAgfSk7CiAgICBleHBvcnRzLkpwZWdTdHJlYW0gPSB2b2lkIDA7CgogICAgdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXyg1KTsKCiAgICB2YXIgX3N0cmVhbSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjAxKTsKCiAgICB2YXIgX3ByaW1pdGl2ZXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE5NCk7CgogICAgdmFyIF9qcGcgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIwOCk7CgogICAgdmFyIEpwZWdTdHJlYW0gPSBmdW5jdGlvbiBKcGVnU3RyZWFtQ2xvc3VyZSgpIHsKICAgICAgZnVuY3Rpb24gSnBlZ1N0cmVhbShzdHJlYW0sIG1heWJlTGVuZ3RoLCBkaWN0LCBwYXJhbXMpIHsKICAgICAgICB2YXIgY2g7CgogICAgICAgIHdoaWxlICgoY2ggPSBzdHJlYW0uZ2V0Qnl0ZSgpKSAhPT0gLTEpIHsKICAgICAgICAgIGlmIChjaCA9PT0gMHhmZikgewogICAgICAgICAgICBzdHJlYW0uc2tpcCgtMSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy5zdHJlYW0gPSBzdHJlYW07CiAgICAgICAgdGhpcy5tYXliZUxlbmd0aCA9IG1heWJlTGVuZ3RoOwogICAgICAgIHRoaXMuZGljdCA9IGRpY3Q7CiAgICAgICAgdGhpcy5wYXJhbXMgPSBwYXJhbXM7CgogICAgICAgIF9zdHJlYW0uRGVjb2RlU3RyZWFtLmNhbGwodGhpcywgbWF5YmVMZW5ndGgpOwogICAgICB9CgogICAgICBKcGVnU3RyZWFtLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoX3N0cmVhbS5EZWNvZGVTdHJlYW0ucHJvdG90eXBlKTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEpwZWdTdHJlYW0ucHJvdG90eXBlLCAiYnl0ZXMiLCB7CiAgICAgICAgZ2V0OiBmdW5jdGlvbiBKcGVnU3RyZWFtX2J5dGVzKCkgewogICAgICAgICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJieXRlcyIsIHRoaXMuc3RyZWFtLmdldEJ5dGVzKHRoaXMubWF5YmVMZW5ndGgpKTsKICAgICAgICB9LAogICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICB9KTsKCiAgICAgIEpwZWdTdHJlYW0ucHJvdG90eXBlLmVuc3VyZUJ1ZmZlciA9IGZ1bmN0aW9uIChyZXF1ZXN0ZWQpIHt9OwoKICAgICAgSnBlZ1N0cmVhbS5wcm90b3R5cGUucmVhZEJsb2NrID0gZnVuY3Rpb24gKCkgewogICAgICAgIGlmICh0aGlzLmVvZikgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIGpwZWdPcHRpb25zID0gewogICAgICAgICAgZGVjb2RlVHJhbnNmb3JtOiB1bmRlZmluZWQsCiAgICAgICAgICBjb2xvclRyYW5zZm9ybTogdW5kZWZpbmVkCiAgICAgICAgfTsKICAgICAgICB2YXIgZGVjb2RlQXJyID0gdGhpcy5kaWN0LmdldEFycmF5KCJEZWNvZGUiLCAiRCIpOwoKICAgICAgICBpZiAodGhpcy5mb3JjZVJHQiAmJiBBcnJheS5pc0FycmF5KGRlY29kZUFycikpIHsKICAgICAgICAgIHZhciBiaXRzUGVyQ29tcG9uZW50ID0gdGhpcy5kaWN0LmdldCgiQml0c1BlckNvbXBvbmVudCIpIHx8IDg7CiAgICAgICAgICB2YXIgZGVjb2RlQXJyTGVuZ3RoID0gZGVjb2RlQXJyLmxlbmd0aDsKICAgICAgICAgIHZhciB0cmFuc2Zvcm0gPSBuZXcgSW50MzJBcnJheShkZWNvZGVBcnJMZW5ndGgpOwogICAgICAgICAgdmFyIHRyYW5zZm9ybU5lZWRlZCA9IGZhbHNlOwogICAgICAgICAgdmFyIG1heFZhbHVlID0gKDEgPDwgYml0c1BlckNvbXBvbmVudCkgLSAxOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGVjb2RlQXJyTGVuZ3RoOyBpICs9IDIpIHsKICAgICAgICAgICAgdHJhbnNmb3JtW2ldID0gKGRlY29kZUFycltpICsgMV0gLSBkZWNvZGVBcnJbaV0pICogMjU2IHwgMDsKICAgICAgICAgICAgdHJhbnNmb3JtW2kgKyAxXSA9IGRlY29kZUFycltpXSAqIG1heFZhbHVlIHwgMDsKCiAgICAgICAgICAgIGlmICh0cmFuc2Zvcm1baV0gIT09IDI1NiB8fCB0cmFuc2Zvcm1baSArIDFdICE9PSAwKSB7CiAgICAgICAgICAgICAgdHJhbnNmb3JtTmVlZGVkID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0cmFuc2Zvcm1OZWVkZWQpIHsKICAgICAgICAgICAganBlZ09wdGlvbnMuZGVjb2RlVHJhbnNmb3JtID0gdHJhbnNmb3JtOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc0RpY3QpKHRoaXMucGFyYW1zKSkgewogICAgICAgICAgdmFyIGNvbG9yVHJhbnNmb3JtID0gdGhpcy5wYXJhbXMuZ2V0KCJDb2xvclRyYW5zZm9ybSIpOwoKICAgICAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKGNvbG9yVHJhbnNmb3JtKSkgewogICAgICAgICAgICBqcGVnT3B0aW9ucy5jb2xvclRyYW5zZm9ybSA9IGNvbG9yVHJhbnNmb3JtOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFyIGpwZWdJbWFnZSA9IG5ldyBfanBnLkpwZWdJbWFnZShqcGVnT3B0aW9ucyk7CiAgICAgICAganBlZ0ltYWdlLnBhcnNlKHRoaXMuYnl0ZXMpOwogICAgICAgIHZhciBkYXRhID0ganBlZ0ltYWdlLmdldERhdGEoewogICAgICAgICAgd2lkdGg6IHRoaXMuZHJhd1dpZHRoLAogICAgICAgICAgaGVpZ2h0OiB0aGlzLmRyYXdIZWlnaHQsCiAgICAgICAgICBmb3JjZVJHQjogdGhpcy5mb3JjZVJHQiwKICAgICAgICAgIGlzU291cmNlUERGOiB0cnVlCiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5idWZmZXIgPSBkYXRhOwogICAgICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gZGF0YS5sZW5ndGg7CiAgICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgICB9OwoKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEpwZWdTdHJlYW0ucHJvdG90eXBlLCAibWF5YmVWYWxpZERpbWVuc2lvbnMiLCB7CiAgICAgICAgZ2V0OiBmdW5jdGlvbiBKcGVnU3RyZWFtX21heWJlVmFsaWREaW1lbnNpb25zKCkgewogICAgICAgICAgdmFyIGRpY3QgPSB0aGlzLmRpY3QsCiAgICAgICAgICAgIHN0cmVhbSA9IHRoaXMuc3RyZWFtOwogICAgICAgICAgdmFyIGRpY3RIZWlnaHQgPSBkaWN0LmdldCgiSGVpZ2h0IiwgIkgiKTsKICAgICAgICAgIHZhciBzdGFydFBvcyA9IHN0cmVhbS5wb3M7CiAgICAgICAgICB2YXIgdmFsaWREaW1lbnNpb25zID0gdHJ1ZSwKICAgICAgICAgICAgZm91bmRTT0YgPSBmYWxzZSwKICAgICAgICAgICAgYjsKCiAgICAgICAgICB3aGlsZSAoKGIgPSBzdHJlYW0uZ2V0Qnl0ZSgpKSAhPT0gLTEpIHsKICAgICAgICAgICAgaWYgKGIgIT09IDB4ZmYpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc3dpdGNoIChzdHJlYW0uZ2V0Qnl0ZSgpKSB7CiAgICAgICAgICAgICAgY2FzZSAweGMwOgogICAgICAgICAgICAgIGNhc2UgMHhjMToKICAgICAgICAgICAgICBjYXNlIDB4YzI6CiAgICAgICAgICAgICAgICBmb3VuZFNPRiA9IHRydWU7CiAgICAgICAgICAgICAgICBzdHJlYW0ucG9zICs9IDI7CiAgICAgICAgICAgICAgICBzdHJlYW0ucG9zICs9IDE7CiAgICAgICAgICAgICAgICB2YXIgc2NhbkxpbmVzID0gc3RyZWFtLmdldFVpbnQxNigpOwoKICAgICAgICAgICAgICAgIGlmIChzY2FuTGluZXMgPT09IGRpY3RIZWlnaHQpIHsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHNjYW5MaW5lcyA9PT0gMCkgewogICAgICAgICAgICAgICAgICB2YWxpZERpbWVuc2lvbnMgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHNjYW5MaW5lcyA+IGRpY3RIZWlnaHQgKiAxMCkgewogICAgICAgICAgICAgICAgICB2YWxpZERpbWVuc2lvbnMgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMHhjMzoKICAgICAgICAgICAgICBjYXNlIDB4YzU6CiAgICAgICAgICAgICAgY2FzZSAweGM2OgogICAgICAgICAgICAgIGNhc2UgMHhjNzoKICAgICAgICAgICAgICBjYXNlIDB4Yzk6CiAgICAgICAgICAgICAgY2FzZSAweGNhOgogICAgICAgICAgICAgIGNhc2UgMHhjYjoKICAgICAgICAgICAgICBjYXNlIDB4Y2Q6CiAgICAgICAgICAgICAgY2FzZSAweGNlOgogICAgICAgICAgICAgIGNhc2UgMHhjZjoKICAgICAgICAgICAgICAgIGZvdW5kU09GID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDB4YzQ6CiAgICAgICAgICAgICAgY2FzZSAweGNjOgogICAgICAgICAgICAgIGNhc2UgMHhkYToKICAgICAgICAgICAgICBjYXNlIDB4ZGI6CiAgICAgICAgICAgICAgY2FzZSAweGRjOgogICAgICAgICAgICAgIGNhc2UgMHhkZDoKICAgICAgICAgICAgICBjYXNlIDB4ZGU6CiAgICAgICAgICAgICAgY2FzZSAweGRmOgogICAgICAgICAgICAgIGNhc2UgMHhlMDoKICAgICAgICAgICAgICBjYXNlIDB4ZTE6CiAgICAgICAgICAgICAgY2FzZSAweGUyOgogICAgICAgICAgICAgIGNhc2UgMHhlMzoKICAgICAgICAgICAgICBjYXNlIDB4ZTQ6CiAgICAgICAgICAgICAgY2FzZSAweGU1OgogICAgICAgICAgICAgIGNhc2UgMHhlNjoKICAgICAgICAgICAgICBjYXNlIDB4ZTc6CiAgICAgICAgICAgICAgY2FzZSAweGU4OgogICAgICAgICAgICAgIGNhc2UgMHhlOToKICAgICAgICAgICAgICBjYXNlIDB4ZWE6CiAgICAgICAgICAgICAgY2FzZSAweGViOgogICAgICAgICAgICAgIGNhc2UgMHhlYzoKICAgICAgICAgICAgICBjYXNlIDB4ZWQ6CiAgICAgICAgICAgICAgY2FzZSAweGVlOgogICAgICAgICAgICAgIGNhc2UgMHhlZjoKICAgICAgICAgICAgICBjYXNlIDB4ZmU6CiAgICAgICAgICAgICAgICB2YXIgbWFya2VyTGVuZ3RoID0gc3RyZWFtLmdldFVpbnQxNigpOwoKICAgICAgICAgICAgICAgIGlmIChtYXJrZXJMZW5ndGggPiAyKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5za2lwKG1hcmtlckxlbmd0aCAtIDIpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLnNraXAoLTIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDB4ZmY6CiAgICAgICAgICAgICAgICBzdHJlYW0uc2tpcCgtMSk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAweGQ5OgogICAgICAgICAgICAgICAgZm91bmRTT0YgPSB0cnVlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmb3VuZFNPRikgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgc3RyZWFtLnBvcyA9IHN0YXJ0UG9zOwogICAgICAgICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJtYXliZVZhbGlkRGltZW5zaW9ucyIsIHZhbGlkRGltZW5zaW9ucyk7CiAgICAgICAgfSwKICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgfSk7CgogICAgICBKcGVnU3RyZWFtLnByb3RvdHlwZS5nZXRJUiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZm9yY2VEYXRhU2NoZW1hID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBmYWxzZTsKICAgICAgICByZXR1cm4gKDAsIF91dGlsLmNyZWF0ZU9iamVjdFVSTCkodGhpcy5ieXRlcywgImltYWdlL2pwZWciLCBmb3JjZURhdGFTY2hlbWEpOwogICAgICB9OwoKICAgICAgcmV0dXJuIEpwZWdTdHJlYW07CiAgICB9KCk7CgogICAgZXhwb3J0cy5KcGVnU3RyZWFtID0gSnBlZ1N0cmVhbTsKCiAgICAvKioqL30pLCAoCiAgLyogMjA4ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgIHZhbHVlOiB0cnVlCiAgICB9KTsKICAgIGV4cG9ydHMuSnBlZ0ltYWdlID0gdm9pZCAwOwoKICAgIHZhciBfdXRpbCA9IF9fd19wZGZqc19yZXF1aXJlX18oNSk7CgogICAgdmFyIF9jb3JlX3V0aWxzID0gX193X3BkZmpzX3JlcXVpcmVfXygxOTcpOwoKICAgIGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mIjtpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAic3ltYm9sIikge190eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikge3JldHVybiB0eXBlb2Ygb2JqO307fSBlbHNlIHtfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHtyZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqO307fXJldHVybiBfdHlwZW9mKG9iaik7fQoKICAgIGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHtpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpO319CgogICAgZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkge2lmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHtyZXR1cm4gY2FsbDt9cmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7fQoKICAgIGZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikge2lmIChzZWxmID09PSB2b2lkIDApIHt0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpO31yZXR1cm4gc2VsZjt9CgogICAgZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHtfZ2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3QuZ2V0UHJvdG90eXBlT2YgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2Yobykge3JldHVybiBvLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2Yobyk7fTtyZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pO30KCiAgICBmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHtpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkge3Rocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7fXN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTtpZiAoc3VwZXJDbGFzcykgX3NldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKTt9CgogICAgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHtfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHtvLl9fcHJvdG9fXyA9IHA7cmV0dXJuIG87fTtyZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApO30KCiAgICB2YXIgSnBlZ0Vycm9yID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQmFzZUV4Y2VwdGlvbikgewogICAgICBfaW5oZXJpdHMoSnBlZ0Vycm9yLCBfQmFzZUV4Y2VwdGlvbik7CgogICAgICBmdW5jdGlvbiBKcGVnRXJyb3IobXNnKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEpwZWdFcnJvcik7CgogICAgICAgIHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoSnBlZ0Vycm9yKS5jYWxsKHRoaXMsICJKUEVHIGVycm9yOiAiLmNvbmNhdChtc2cpKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBKcGVnRXJyb3I7CiAgICB9KF91dGlsLkJhc2VFeGNlcHRpb24pOwoKICAgIHZhciBETkxNYXJrZXJFcnJvciA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0Jhc2VFeGNlcHRpb24yKSB7CiAgICAgIF9pbmhlcml0cyhETkxNYXJrZXJFcnJvciwgX0Jhc2VFeGNlcHRpb24yKTsKCiAgICAgIGZ1bmN0aW9uIEROTE1hcmtlckVycm9yKG1lc3NhZ2UsIHNjYW5MaW5lcykgewogICAgICAgIHZhciBfdGhpczsKCiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEROTE1hcmtlckVycm9yKTsKCiAgICAgICAgX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoRE5MTWFya2VyRXJyb3IpLmNhbGwodGhpcywgbWVzc2FnZSkpOwogICAgICAgIF90aGlzLnNjYW5MaW5lcyA9IHNjYW5MaW5lczsKICAgICAgICByZXR1cm4gX3RoaXM7CiAgICAgIH0KCiAgICAgIHJldHVybiBETkxNYXJrZXJFcnJvcjsKICAgIH0oX3V0aWwuQmFzZUV4Y2VwdGlvbik7CgogICAgdmFyIEVPSU1hcmtlckVycm9yID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQmFzZUV4Y2VwdGlvbjMpIHsKICAgICAgX2luaGVyaXRzKEVPSU1hcmtlckVycm9yLCBfQmFzZUV4Y2VwdGlvbjMpOwoKICAgICAgZnVuY3Rpb24gRU9JTWFya2VyRXJyb3IoKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEVPSU1hcmtlckVycm9yKTsKCiAgICAgICAgcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihFT0lNYXJrZXJFcnJvcikuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBFT0lNYXJrZXJFcnJvcjsKICAgIH0oX3V0aWwuQmFzZUV4Y2VwdGlvbik7CgogICAgdmFyIEpwZWdJbWFnZSA9IGZ1bmN0aW9uIEpwZWdJbWFnZUNsb3N1cmUoKSB7CiAgICAgIHZhciBkY3RaaWdaYWcgPSBuZXcgVWludDhBcnJheShbMCwgMSwgOCwgMTYsIDksIDIsIDMsIDEwLCAxNywgMjQsIDMyLCAyNSwgMTgsIDExLCA0LCA1LCAxMiwgMTksIDI2LCAzMywgNDAsIDQ4LCA0MSwgMzQsIDI3LCAyMCwgMTMsIDYsIDcsIDE0LCAyMSwgMjgsIDM1LCA0MiwgNDksIDU2LCA1NywgNTAsIDQzLCAzNiwgMjksIDIyLCAxNSwgMjMsIDMwLCAzNywgNDQsIDUxLCA1OCwgNTksIDUyLCA0NSwgMzgsIDMxLCAzOSwgNDYsIDUzLCA2MCwgNjEsIDU0LCA0NywgNTUsIDYyLCA2M10pOwogICAgICB2YXIgZGN0Q29zMSA9IDQwMTc7CiAgICAgIHZhciBkY3RTaW4xID0gNzk5OwogICAgICB2YXIgZGN0Q29zMyA9IDM0MDY7CiAgICAgIHZhciBkY3RTaW4zID0gMjI3NjsKICAgICAgdmFyIGRjdENvczYgPSAxNTY3OwogICAgICB2YXIgZGN0U2luNiA9IDM3ODQ7CiAgICAgIHZhciBkY3RTcXJ0MiA9IDU3OTM7CiAgICAgIHZhciBkY3RTcXJ0MWQyID0gMjg5NjsKCiAgICAgIGZ1bmN0aW9uIEpwZWdJbWFnZSgpIHsKICAgICAgICB2YXIgX3JlZiA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge30sCiAgICAgICAgICBfcmVmJGRlY29kZVRyYW5zZm9ybSA9IF9yZWYuZGVjb2RlVHJhbnNmb3JtLAogICAgICAgICAgZGVjb2RlVHJhbnNmb3JtID0gX3JlZiRkZWNvZGVUcmFuc2Zvcm0gPT09IHZvaWQgMCA/IG51bGwgOiBfcmVmJGRlY29kZVRyYW5zZm9ybSwKICAgICAgICAgIF9yZWYkY29sb3JUcmFuc2Zvcm0gPSBfcmVmLmNvbG9yVHJhbnNmb3JtLAogICAgICAgICAgY29sb3JUcmFuc2Zvcm0gPSBfcmVmJGNvbG9yVHJhbnNmb3JtID09PSB2b2lkIDAgPyAtMSA6IF9yZWYkY29sb3JUcmFuc2Zvcm07CgogICAgICAgIHRoaXMuX2RlY29kZVRyYW5zZm9ybSA9IGRlY29kZVRyYW5zZm9ybTsKICAgICAgICB0aGlzLl9jb2xvclRyYW5zZm9ybSA9IGNvbG9yVHJhbnNmb3JtOwogICAgICB9CgogICAgICBmdW5jdGlvbiBidWlsZEh1ZmZtYW5UYWJsZShjb2RlTGVuZ3RocywgdmFsdWVzKSB7CiAgICAgICAgdmFyIGsgPSAwLAogICAgICAgICAgY29kZSA9IFtdLAogICAgICAgICAgaSwKICAgICAgICAgIGosCiAgICAgICAgICBsZW5ndGggPSAxNjsKCiAgICAgICAgd2hpbGUgKGxlbmd0aCA+IDAgJiYgIWNvZGVMZW5ndGhzW2xlbmd0aCAtIDFdKSB7CiAgICAgICAgICBsZW5ndGgtLTsKICAgICAgICB9CgogICAgICAgIGNvZGUucHVzaCh7CiAgICAgICAgICBjaGlsZHJlbjogW10sCiAgICAgICAgICBpbmRleDogMAogICAgICAgIH0pOwogICAgICAgIHZhciBwID0gY29kZVswXSwKICAgICAgICAgIHE7CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgICAgZm9yIChqID0gMDsgaiA8IGNvZGVMZW5ndGhzW2ldOyBqKyspIHsKICAgICAgICAgICAgcCA9IGNvZGUucG9wKCk7CiAgICAgICAgICAgIHAuY2hpbGRyZW5bcC5pbmRleF0gPSB2YWx1ZXNba107CgogICAgICAgICAgICB3aGlsZSAocC5pbmRleCA+IDApIHsKICAgICAgICAgICAgICBwID0gY29kZS5wb3AoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcC5pbmRleCsrOwogICAgICAgICAgICBjb2RlLnB1c2gocCk7CgogICAgICAgICAgICB3aGlsZSAoY29kZS5sZW5ndGggPD0gaSkgewogICAgICAgICAgICAgIGNvZGUucHVzaChxID0gewogICAgICAgICAgICAgICAgY2hpbGRyZW46IFtdLAogICAgICAgICAgICAgICAgaW5kZXg6IDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBwLmNoaWxkcmVuW3AuaW5kZXhdID0gcS5jaGlsZHJlbjsKICAgICAgICAgICAgICBwID0gcTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaysrOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChpICsgMSA8IGxlbmd0aCkgewogICAgICAgICAgICBjb2RlLnB1c2gocSA9IHsKICAgICAgICAgICAgICBjaGlsZHJlbjogW10sCiAgICAgICAgICAgICAgaW5kZXg6IDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHAuY2hpbGRyZW5bcC5pbmRleF0gPSBxLmNoaWxkcmVuOwogICAgICAgICAgICBwID0gcTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBjb2RlWzBdLmNoaWxkcmVuOwogICAgICB9CgogICAgICBmdW5jdGlvbiBnZXRCbG9ja0J1ZmZlck9mZnNldChjb21wb25lbnQsIHJvdywgY29sKSB7CiAgICAgICAgcmV0dXJuIDY0ICogKChjb21wb25lbnQuYmxvY2tzUGVyTGluZSArIDEpICogcm93ICsgY29sKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZGVjb2RlU2NhbihkYXRhLCBvZmZzZXQsIGZyYW1lLCBjb21wb25lbnRzLCByZXNldEludGVydmFsLCBzcGVjdHJhbFN0YXJ0LCBzcGVjdHJhbEVuZCwgc3VjY2Vzc2l2ZVByZXYsIHN1Y2Nlc3NpdmUpIHsKICAgICAgICB2YXIgcGFyc2VETkxNYXJrZXIgPSBhcmd1bWVudHMubGVuZ3RoID4gOSAmJiBhcmd1bWVudHNbOV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1s5XSA6IGZhbHNlOwogICAgICAgIHZhciBtY3VzUGVyTGluZSA9IGZyYW1lLm1jdXNQZXJMaW5lOwogICAgICAgIHZhciBwcm9ncmVzc2l2ZSA9IGZyYW1lLnByb2dyZXNzaXZlOwogICAgICAgIHZhciBzdGFydE9mZnNldCA9IG9mZnNldCwKICAgICAgICAgIGJpdHNEYXRhID0gMCwKICAgICAgICAgIGJpdHNDb3VudCA9IDA7CgogICAgICAgIGZ1bmN0aW9uIHJlYWRCaXQoKSB7CiAgICAgICAgICBpZiAoYml0c0NvdW50ID4gMCkgewogICAgICAgICAgICBiaXRzQ291bnQtLTsKICAgICAgICAgICAgcmV0dXJuIGJpdHNEYXRhID4+IGJpdHNDb3VudCAmIDE7CiAgICAgICAgICB9CgogICAgICAgICAgYml0c0RhdGEgPSBkYXRhW29mZnNldCsrXTsKCiAgICAgICAgICBpZiAoYml0c0RhdGEgPT09IDB4ZmYpIHsKICAgICAgICAgICAgdmFyIG5leHRCeXRlID0gZGF0YVtvZmZzZXQrK107CgogICAgICAgICAgICBpZiAobmV4dEJ5dGUpIHsKICAgICAgICAgICAgICBpZiAobmV4dEJ5dGUgPT09IDB4ZGMgJiYgcGFyc2VETkxNYXJrZXIpIHsKICAgICAgICAgICAgICAgIG9mZnNldCArPSAyOwogICAgICAgICAgICAgICAgdmFyIHNjYW5MaW5lcyA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDE2KShkYXRhLCBvZmZzZXQpOwogICAgICAgICAgICAgICAgb2Zmc2V0ICs9IDI7CgogICAgICAgICAgICAgICAgaWYgKHNjYW5MaW5lcyA+IDAgJiYgc2NhbkxpbmVzICE9PSBmcmFtZS5zY2FuTGluZXMpIHsKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEROTE1hcmtlckVycm9yKCJGb3VuZCBETkwgbWFya2VyICgweEZGREMpIHdoaWxlIHBhcnNpbmcgc2NhbiBkYXRhIiwgc2NhbkxpbmVzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5leHRCeXRlID09PSAweGQ5KSB7CiAgICAgICAgICAgICAgICBpZiAocGFyc2VETkxNYXJrZXIpIHsKICAgICAgICAgICAgICAgICAgdmFyIG1heWJlU2NhbkxpbmVzID0gYmxvY2tSb3cgKiA4OwoKICAgICAgICAgICAgICAgICAgaWYgKG1heWJlU2NhbkxpbmVzID4gMCAmJiBtYXliZVNjYW5MaW5lcyA8IGZyYW1lLnNjYW5MaW5lcyAvIDEwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEROTE1hcmtlckVycm9yKCJGb3VuZCBFT0kgbWFya2VyICgweEZGRDkpIHdoaWxlIHBhcnNpbmcgc2NhbiBkYXRhLCAiICsgInBvc3NpYmx5IGNhdXNlZCBieSBpbmNvcnJlY3QgYHNjYW5MaW5lc2AgcGFyYW1ldGVyIiwgbWF5YmVTY2FuTGluZXMpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVPSU1hcmtlckVycm9yKCJGb3VuZCBFT0kgbWFya2VyICgweEZGRDkpIHdoaWxlIHBhcnNpbmcgc2NhbiBkYXRhIik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB0aHJvdyBuZXcgSnBlZ0Vycm9yKCJ1bmV4cGVjdGVkIG1hcmtlciAiLmNvbmNhdCgoYml0c0RhdGEgPDwgOCB8IG5leHRCeXRlKS50b1N0cmluZygxNikpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGJpdHNDb3VudCA9IDc7CiAgICAgICAgICByZXR1cm4gYml0c0RhdGEgPj4+IDc7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBkZWNvZGVIdWZmbWFuKHRyZWUpIHsKICAgICAgICAgIHZhciBub2RlID0gdHJlZTsKCiAgICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgICBub2RlID0gbm9kZVtyZWFkQml0KCldOwoKICAgICAgICAgICAgc3dpdGNoIChfdHlwZW9mKG5vZGUpKSB7CiAgICAgICAgICAgICAgY2FzZSAibnVtYmVyIjoKICAgICAgICAgICAgICAgIHJldHVybiBub2RlOwoKICAgICAgICAgICAgICBjYXNlICJvYmplY3QiOgogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRocm93IG5ldyBKcGVnRXJyb3IoImludmFsaWQgaHVmZm1hbiBzZXF1ZW5jZSIpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gcmVjZWl2ZShsZW5ndGgpIHsKICAgICAgICAgIHZhciBuID0gMDsKCiAgICAgICAgICB3aGlsZSAobGVuZ3RoID4gMCkgewogICAgICAgICAgICBuID0gbiA8PCAxIHwgcmVhZEJpdCgpOwogICAgICAgICAgICBsZW5ndGgtLTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gbjsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHJlY2VpdmVBbmRFeHRlbmQobGVuZ3RoKSB7CiAgICAgICAgICBpZiAobGVuZ3RoID09PSAxKSB7CiAgICAgICAgICAgIHJldHVybiByZWFkQml0KCkgPT09IDEgPyAxIDogLTE7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIG4gPSByZWNlaXZlKGxlbmd0aCk7CgogICAgICAgICAgaWYgKG4gPj0gMSA8PCBsZW5ndGggLSAxKSB7CiAgICAgICAgICAgIHJldHVybiBuOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBuICsgKC0xIDw8IGxlbmd0aCkgKyAxOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZGVjb2RlQmFzZWxpbmUoY29tcG9uZW50LCBvZmZzZXQpIHsKICAgICAgICAgIHZhciB0ID0gZGVjb2RlSHVmZm1hbihjb21wb25lbnQuaHVmZm1hblRhYmxlREMpOwogICAgICAgICAgdmFyIGRpZmYgPSB0ID09PSAwID8gMCA6IHJlY2VpdmVBbmRFeHRlbmQodCk7CiAgICAgICAgICBjb21wb25lbnQuYmxvY2tEYXRhW29mZnNldF0gPSBjb21wb25lbnQucHJlZCArPSBkaWZmOwogICAgICAgICAgdmFyIGsgPSAxOwoKICAgICAgICAgIHdoaWxlIChrIDwgNjQpIHsKICAgICAgICAgICAgdmFyIHJzID0gZGVjb2RlSHVmZm1hbihjb21wb25lbnQuaHVmZm1hblRhYmxlQUMpOwogICAgICAgICAgICB2YXIgcyA9IHJzICYgMTUsCiAgICAgICAgICAgICAgciA9IHJzID4+IDQ7CgogICAgICAgICAgICBpZiAocyA9PT0gMCkgewogICAgICAgICAgICAgIGlmIChyIDwgMTUpIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgayArPSAxNjsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgayArPSByOwogICAgICAgICAgICB2YXIgeiA9IGRjdFppZ1phZ1trXTsKICAgICAgICAgICAgY29tcG9uZW50LmJsb2NrRGF0YVtvZmZzZXQgKyB6XSA9IHJlY2VpdmVBbmRFeHRlbmQocyk7CiAgICAgICAgICAgIGsrKzsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGRlY29kZURDRmlyc3QoY29tcG9uZW50LCBvZmZzZXQpIHsKICAgICAgICAgIHZhciB0ID0gZGVjb2RlSHVmZm1hbihjb21wb25lbnQuaHVmZm1hblRhYmxlREMpOwogICAgICAgICAgdmFyIGRpZmYgPSB0ID09PSAwID8gMCA6IHJlY2VpdmVBbmRFeHRlbmQodCkgPDwgc3VjY2Vzc2l2ZTsKICAgICAgICAgIGNvbXBvbmVudC5ibG9ja0RhdGFbb2Zmc2V0XSA9IGNvbXBvbmVudC5wcmVkICs9IGRpZmY7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBkZWNvZGVEQ1N1Y2Nlc3NpdmUoY29tcG9uZW50LCBvZmZzZXQpIHsKICAgICAgICAgIGNvbXBvbmVudC5ibG9ja0RhdGFbb2Zmc2V0XSB8PSByZWFkQml0KCkgPDwgc3VjY2Vzc2l2ZTsKICAgICAgICB9CgogICAgICAgIHZhciBlb2JydW4gPSAwOwoKICAgICAgICBmdW5jdGlvbiBkZWNvZGVBQ0ZpcnN0KGNvbXBvbmVudCwgb2Zmc2V0KSB7CiAgICAgICAgICBpZiAoZW9icnVuID4gMCkgewogICAgICAgICAgICBlb2JydW4tLTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBrID0gc3BlY3RyYWxTdGFydCwKICAgICAgICAgICAgZSA9IHNwZWN0cmFsRW5kOwoKICAgICAgICAgIHdoaWxlIChrIDw9IGUpIHsKICAgICAgICAgICAgdmFyIHJzID0gZGVjb2RlSHVmZm1hbihjb21wb25lbnQuaHVmZm1hblRhYmxlQUMpOwogICAgICAgICAgICB2YXIgcyA9IHJzICYgMTUsCiAgICAgICAgICAgICAgciA9IHJzID4+IDQ7CgogICAgICAgICAgICBpZiAocyA9PT0gMCkgewogICAgICAgICAgICAgIGlmIChyIDwgMTUpIHsKICAgICAgICAgICAgICAgIGVvYnJ1biA9IHJlY2VpdmUocikgKyAoMSA8PCByKSAtIDE7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGsgKz0gMTY7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGsgKz0gcjsKICAgICAgICAgICAgdmFyIHogPSBkY3RaaWdaYWdba107CiAgICAgICAgICAgIGNvbXBvbmVudC5ibG9ja0RhdGFbb2Zmc2V0ICsgel0gPSByZWNlaXZlQW5kRXh0ZW5kKHMpICogKDEgPDwgc3VjY2Vzc2l2ZSk7CiAgICAgICAgICAgIGsrKzsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHZhciBzdWNjZXNzaXZlQUNTdGF0ZSA9IDAsCiAgICAgICAgICBzdWNjZXNzaXZlQUNOZXh0VmFsdWU7CgogICAgICAgIGZ1bmN0aW9uIGRlY29kZUFDU3VjY2Vzc2l2ZShjb21wb25lbnQsIG9mZnNldCkgewogICAgICAgICAgdmFyIGsgPSBzcGVjdHJhbFN0YXJ0OwogICAgICAgICAgdmFyIGUgPSBzcGVjdHJhbEVuZDsKICAgICAgICAgIHZhciByID0gMDsKICAgICAgICAgIHZhciBzOwogICAgICAgICAgdmFyIHJzOwoKICAgICAgICAgIHdoaWxlIChrIDw9IGUpIHsKICAgICAgICAgICAgdmFyIG9mZnNldFogPSBvZmZzZXQgKyBkY3RaaWdaYWdba107CiAgICAgICAgICAgIHZhciBzaWduID0gY29tcG9uZW50LmJsb2NrRGF0YVtvZmZzZXRaXSA8IDAgPyAtMSA6IDE7CgogICAgICAgICAgICBzd2l0Y2ggKHN1Y2Nlc3NpdmVBQ1N0YXRlKSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgcnMgPSBkZWNvZGVIdWZmbWFuKGNvbXBvbmVudC5odWZmbWFuVGFibGVBQyk7CiAgICAgICAgICAgICAgICBzID0gcnMgJiAxNTsKICAgICAgICAgICAgICAgIHIgPSBycyA+PiA0OwoKICAgICAgICAgICAgICAgIGlmIChzID09PSAwKSB7CiAgICAgICAgICAgICAgICAgIGlmIChyIDwgMTUpIHsKICAgICAgICAgICAgICAgICAgICBlb2JydW4gPSByZWNlaXZlKHIpICsgKDEgPDwgcik7CiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc2l2ZUFDU3RhdGUgPSA0OwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHIgPSAxNjsKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzaXZlQUNTdGF0ZSA9IDE7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIGlmIChzICE9PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEpwZWdFcnJvcigiaW52YWxpZCBBQ24gZW5jb2RpbmciKTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgc3VjY2Vzc2l2ZUFDTmV4dFZhbHVlID0gcmVjZWl2ZUFuZEV4dGVuZChzKTsKICAgICAgICAgICAgICAgICAgc3VjY2Vzc2l2ZUFDU3RhdGUgPSByID8gMiA6IDM7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBpZiAoY29tcG9uZW50LmJsb2NrRGF0YVtvZmZzZXRaXSkgewogICAgICAgICAgICAgICAgICBjb21wb25lbnQuYmxvY2tEYXRhW29mZnNldFpdICs9IHNpZ24gKiAocmVhZEJpdCgpIDw8IHN1Y2Nlc3NpdmUpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgci0tOwoKICAgICAgICAgICAgICAgICAgaWYgKHIgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzaXZlQUNTdGF0ZSA9IHN1Y2Nlc3NpdmVBQ1N0YXRlID09PSAyID8gMyA6IDA7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgaWYgKGNvbXBvbmVudC5ibG9ja0RhdGFbb2Zmc2V0Wl0pIHsKICAgICAgICAgICAgICAgICAgY29tcG9uZW50LmJsb2NrRGF0YVtvZmZzZXRaXSArPSBzaWduICogKHJlYWRCaXQoKSA8PCBzdWNjZXNzaXZlKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIGNvbXBvbmVudC5ibG9ja0RhdGFbb2Zmc2V0Wl0gPSBzdWNjZXNzaXZlQUNOZXh0VmFsdWUgPDwgc3VjY2Vzc2l2ZTsKICAgICAgICAgICAgICAgICAgc3VjY2Vzc2l2ZUFDU3RhdGUgPSAwOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICBpZiAoY29tcG9uZW50LmJsb2NrRGF0YVtvZmZzZXRaXSkgewogICAgICAgICAgICAgICAgICBjb21wb25lbnQuYmxvY2tEYXRhW29mZnNldFpdICs9IHNpZ24gKiAocmVhZEJpdCgpIDw8IHN1Y2Nlc3NpdmUpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBrKys7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHN1Y2Nlc3NpdmVBQ1N0YXRlID09PSA0KSB7CiAgICAgICAgICAgIGVvYnJ1bi0tOwoKICAgICAgICAgICAgaWYgKGVvYnJ1biA9PT0gMCkgewogICAgICAgICAgICAgIHN1Y2Nlc3NpdmVBQ1N0YXRlID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFyIGJsb2NrUm93ID0gMDsKCiAgICAgICAgZnVuY3Rpb24gZGVjb2RlTWN1KGNvbXBvbmVudCwgZGVjb2RlLCBtY3UsIHJvdywgY29sKSB7CiAgICAgICAgICB2YXIgbWN1Um93ID0gbWN1IC8gbWN1c1BlckxpbmUgfCAwOwogICAgICAgICAgdmFyIG1jdUNvbCA9IG1jdSAlIG1jdXNQZXJMaW5lOwogICAgICAgICAgYmxvY2tSb3cgPSBtY3VSb3cgKiBjb21wb25lbnQudiArIHJvdzsKICAgICAgICAgIHZhciBibG9ja0NvbCA9IG1jdUNvbCAqIGNvbXBvbmVudC5oICsgY29sOwogICAgICAgICAgdmFyIG9mZnNldCA9IGdldEJsb2NrQnVmZmVyT2Zmc2V0KGNvbXBvbmVudCwgYmxvY2tSb3csIGJsb2NrQ29sKTsKICAgICAgICAgIGRlY29kZShjb21wb25lbnQsIG9mZnNldCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBkZWNvZGVCbG9jayhjb21wb25lbnQsIGRlY29kZSwgbWN1KSB7CiAgICAgICAgICBibG9ja1JvdyA9IG1jdSAvIGNvbXBvbmVudC5ibG9ja3NQZXJMaW5lIHwgMDsKICAgICAgICAgIHZhciBibG9ja0NvbCA9IG1jdSAlIGNvbXBvbmVudC5ibG9ja3NQZXJMaW5lOwogICAgICAgICAgdmFyIG9mZnNldCA9IGdldEJsb2NrQnVmZmVyT2Zmc2V0KGNvbXBvbmVudCwgYmxvY2tSb3csIGJsb2NrQ29sKTsKICAgICAgICAgIGRlY29kZShjb21wb25lbnQsIG9mZnNldCk7CiAgICAgICAgfQoKICAgICAgICB2YXIgY29tcG9uZW50c0xlbmd0aCA9IGNvbXBvbmVudHMubGVuZ3RoOwogICAgICAgIHZhciBjb21wb25lbnQsIGksIGosIGssIG47CiAgICAgICAgdmFyIGRlY29kZUZuOwoKICAgICAgICBpZiAocHJvZ3Jlc3NpdmUpIHsKICAgICAgICAgIGlmIChzcGVjdHJhbFN0YXJ0ID09PSAwKSB7CiAgICAgICAgICAgIGRlY29kZUZuID0gc3VjY2Vzc2l2ZVByZXYgPT09IDAgPyBkZWNvZGVEQ0ZpcnN0IDogZGVjb2RlRENTdWNjZXNzaXZlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZGVjb2RlRm4gPSBzdWNjZXNzaXZlUHJldiA9PT0gMCA/IGRlY29kZUFDRmlyc3QgOiBkZWNvZGVBQ1N1Y2Nlc3NpdmU7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRlY29kZUZuID0gZGVjb2RlQmFzZWxpbmU7CiAgICAgICAgfQoKICAgICAgICB2YXIgbWN1ID0gMCwKICAgICAgICAgIGZpbGVNYXJrZXI7CiAgICAgICAgdmFyIG1jdUV4cGVjdGVkOwoKICAgICAgICBpZiAoY29tcG9uZW50c0xlbmd0aCA9PT0gMSkgewogICAgICAgICAgbWN1RXhwZWN0ZWQgPSBjb21wb25lbnRzWzBdLmJsb2Nrc1BlckxpbmUgKiBjb21wb25lbnRzWzBdLmJsb2Nrc1BlckNvbHVtbjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbWN1RXhwZWN0ZWQgPSBtY3VzUGVyTGluZSAqIGZyYW1lLm1jdXNQZXJDb2x1bW47CiAgICAgICAgfQoKICAgICAgICB2YXIgaCwgdjsKCiAgICAgICAgd2hpbGUgKG1jdSA8IG1jdUV4cGVjdGVkKSB7CiAgICAgICAgICB2YXIgbWN1VG9SZWFkID0gcmVzZXRJbnRlcnZhbCA/IE1hdGgubWluKG1jdUV4cGVjdGVkIC0gbWN1LCByZXNldEludGVydmFsKSA6IG1jdUV4cGVjdGVkOwoKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjb21wb25lbnRzTGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29tcG9uZW50c1tpXS5wcmVkID0gMDsKICAgICAgICAgIH0KCiAgICAgICAgICBlb2JydW4gPSAwOwoKICAgICAgICAgIGlmIChjb21wb25lbnRzTGVuZ3RoID09PSAxKSB7CiAgICAgICAgICAgIGNvbXBvbmVudCA9IGNvbXBvbmVudHNbMF07CgogICAgICAgICAgICBmb3IgKG4gPSAwOyBuIDwgbWN1VG9SZWFkOyBuKyspIHsKICAgICAgICAgICAgICBkZWNvZGVCbG9jayhjb21wb25lbnQsIGRlY29kZUZuLCBtY3UpOwogICAgICAgICAgICAgIG1jdSsrOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmb3IgKG4gPSAwOyBuIDwgbWN1VG9SZWFkOyBuKyspIHsKICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY29tcG9uZW50c0xlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb21wb25lbnQgPSBjb21wb25lbnRzW2ldOwogICAgICAgICAgICAgICAgaCA9IGNvbXBvbmVudC5oOwogICAgICAgICAgICAgICAgdiA9IGNvbXBvbmVudC52OwoKICAgICAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCB2OyBqKyspIHsKICAgICAgICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IGg7IGsrKykgewogICAgICAgICAgICAgICAgICAgIGRlY29kZU1jdShjb21wb25lbnQsIGRlY29kZUZuLCBtY3UsIGosIGspOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBtY3UrKzsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGJpdHNDb3VudCA9IDA7CiAgICAgICAgICBmaWxlTWFya2VyID0gZmluZE5leHRGaWxlTWFya2VyKGRhdGEsIG9mZnNldCk7CgogICAgICAgICAgaWYgKCFmaWxlTWFya2VyKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfSBlbHNlIGlmIChmaWxlTWFya2VyLmludmFsaWQpIHsKICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJkZWNvZGVTY2FuIC0gdW5leHBlY3RlZCBNQ1UgZGF0YSwgY3VycmVudCBtYXJrZXIgaXM6ICIgKyBmaWxlTWFya2VyLmludmFsaWQpOwogICAgICAgICAgICBvZmZzZXQgPSBmaWxlTWFya2VyLm9mZnNldDsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgbWFya2VyID0gZmlsZU1hcmtlciAmJiBmaWxlTWFya2VyLm1hcmtlcjsKCiAgICAgICAgICBpZiAoIW1hcmtlciB8fCBtYXJrZXIgPD0gMHhmZjAwKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBKcGVnRXJyb3IoImRlY29kZVNjYW4gLSBhIHZhbGlkIG1hcmtlciB3YXMgbm90IGZvdW5kLiIpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChtYXJrZXIgPj0gMHhmZmQwICYmIG1hcmtlciA8PSAweGZmZDcpIHsKICAgICAgICAgICAgb2Zmc2V0ICs9IDI7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZpbGVNYXJrZXIgPSBmaW5kTmV4dEZpbGVNYXJrZXIoZGF0YSwgb2Zmc2V0KTsKCiAgICAgICAgaWYgKGZpbGVNYXJrZXIgJiYgZmlsZU1hcmtlci5pbnZhbGlkKSB7CiAgICAgICAgICAoMCwgX3V0aWwud2FybikoImRlY29kZVNjYW4gLSB1bmV4cGVjdGVkIFNjYW4gZGF0YSwgY3VycmVudCBtYXJrZXIgaXM6ICIgKyBmaWxlTWFya2VyLmludmFsaWQpOwogICAgICAgICAgb2Zmc2V0ID0gZmlsZU1hcmtlci5vZmZzZXQ7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gb2Zmc2V0IC0gc3RhcnRPZmZzZXQ7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHF1YW50aXplQW5kSW52ZXJzZShjb21wb25lbnQsIGJsb2NrQnVmZmVyT2Zmc2V0LCBwKSB7CiAgICAgICAgdmFyIHF0ID0gY29tcG9uZW50LnF1YW50aXphdGlvblRhYmxlLAogICAgICAgICAgYmxvY2tEYXRhID0gY29tcG9uZW50LmJsb2NrRGF0YTsKICAgICAgICB2YXIgdjAsIHYxLCB2MiwgdjMsIHY0LCB2NSwgdjYsIHY3OwogICAgICAgIHZhciBwMCwgcDEsIHAyLCBwMywgcDQsIHA1LCBwNiwgcDc7CiAgICAgICAgdmFyIHQ7CgogICAgICAgIGlmICghcXQpIHsKICAgICAgICAgIHRocm93IG5ldyBKcGVnRXJyb3IoIm1pc3NpbmcgcmVxdWlyZWQgUXVhbnRpemF0aW9uIFRhYmxlLiIpOwogICAgICAgIH0KCiAgICAgICAgZm9yICh2YXIgcm93ID0gMDsgcm93IDwgNjQ7IHJvdyArPSA4KSB7CiAgICAgICAgICBwMCA9IGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIHJvd107CiAgICAgICAgICBwMSA9IGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIHJvdyArIDFdOwogICAgICAgICAgcDIgPSBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyByb3cgKyAyXTsKICAgICAgICAgIHAzID0gYmxvY2tEYXRhW2Jsb2NrQnVmZmVyT2Zmc2V0ICsgcm93ICsgM107CiAgICAgICAgICBwNCA9IGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIHJvdyArIDRdOwogICAgICAgICAgcDUgPSBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyByb3cgKyA1XTsKICAgICAgICAgIHA2ID0gYmxvY2tEYXRhW2Jsb2NrQnVmZmVyT2Zmc2V0ICsgcm93ICsgNl07CiAgICAgICAgICBwNyA9IGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIHJvdyArIDddOwogICAgICAgICAgcDAgKj0gcXRbcm93XTsKCiAgICAgICAgICBpZiAoKHAxIHwgcDIgfCBwMyB8IHA0IHwgcDUgfCBwNiB8IHA3KSA9PT0gMCkgewogICAgICAgICAgICB0ID0gZGN0U3FydDIgKiBwMCArIDUxMiA+PiAxMDsKICAgICAgICAgICAgcFtyb3ddID0gdDsKICAgICAgICAgICAgcFtyb3cgKyAxXSA9IHQ7CiAgICAgICAgICAgIHBbcm93ICsgMl0gPSB0OwogICAgICAgICAgICBwW3JvdyArIDNdID0gdDsKICAgICAgICAgICAgcFtyb3cgKyA0XSA9IHQ7CiAgICAgICAgICAgIHBbcm93ICsgNV0gPSB0OwogICAgICAgICAgICBwW3JvdyArIDZdID0gdDsKICAgICAgICAgICAgcFtyb3cgKyA3XSA9IHQ7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIHAxICo9IHF0W3JvdyArIDFdOwogICAgICAgICAgcDIgKj0gcXRbcm93ICsgMl07CiAgICAgICAgICBwMyAqPSBxdFtyb3cgKyAzXTsKICAgICAgICAgIHA0ICo9IHF0W3JvdyArIDRdOwogICAgICAgICAgcDUgKj0gcXRbcm93ICsgNV07CiAgICAgICAgICBwNiAqPSBxdFtyb3cgKyA2XTsKICAgICAgICAgIHA3ICo9IHF0W3JvdyArIDddOwogICAgICAgICAgdjAgPSBkY3RTcXJ0MiAqIHAwICsgMTI4ID4+IDg7CiAgICAgICAgICB2MSA9IGRjdFNxcnQyICogcDQgKyAxMjggPj4gODsKICAgICAgICAgIHYyID0gcDI7CiAgICAgICAgICB2MyA9IHA2OwogICAgICAgICAgdjQgPSBkY3RTcXJ0MWQyICogKHAxIC0gcDcpICsgMTI4ID4+IDg7CiAgICAgICAgICB2NyA9IGRjdFNxcnQxZDIgKiAocDEgKyBwNykgKyAxMjggPj4gODsKICAgICAgICAgIHY1ID0gcDMgPDwgNDsKICAgICAgICAgIHY2ID0gcDUgPDwgNDsKICAgICAgICAgIHYwID0gdjAgKyB2MSArIDEgPj4gMTsKICAgICAgICAgIHYxID0gdjAgLSB2MTsKICAgICAgICAgIHQgPSB2MiAqIGRjdFNpbjYgKyB2MyAqIGRjdENvczYgKyAxMjggPj4gODsKICAgICAgICAgIHYyID0gdjIgKiBkY3RDb3M2IC0gdjMgKiBkY3RTaW42ICsgMTI4ID4+IDg7CiAgICAgICAgICB2MyA9IHQ7CiAgICAgICAgICB2NCA9IHY0ICsgdjYgKyAxID4+IDE7CiAgICAgICAgICB2NiA9IHY0IC0gdjY7CiAgICAgICAgICB2NyA9IHY3ICsgdjUgKyAxID4+IDE7CiAgICAgICAgICB2NSA9IHY3IC0gdjU7CiAgICAgICAgICB2MCA9IHYwICsgdjMgKyAxID4+IDE7CiAgICAgICAgICB2MyA9IHYwIC0gdjM7CiAgICAgICAgICB2MSA9IHYxICsgdjIgKyAxID4+IDE7CiAgICAgICAgICB2MiA9IHYxIC0gdjI7CiAgICAgICAgICB0ID0gdjQgKiBkY3RTaW4zICsgdjcgKiBkY3RDb3MzICsgMjA0OCA+PiAxMjsKICAgICAgICAgIHY0ID0gdjQgKiBkY3RDb3MzIC0gdjcgKiBkY3RTaW4zICsgMjA0OCA+PiAxMjsKICAgICAgICAgIHY3ID0gdDsKICAgICAgICAgIHQgPSB2NSAqIGRjdFNpbjEgKyB2NiAqIGRjdENvczEgKyAyMDQ4ID4+IDEyOwogICAgICAgICAgdjUgPSB2NSAqIGRjdENvczEgLSB2NiAqIGRjdFNpbjEgKyAyMDQ4ID4+IDEyOwogICAgICAgICAgdjYgPSB0OwogICAgICAgICAgcFtyb3ddID0gdjAgKyB2NzsKICAgICAgICAgIHBbcm93ICsgN10gPSB2MCAtIHY3OwogICAgICAgICAgcFtyb3cgKyAxXSA9IHYxICsgdjY7CiAgICAgICAgICBwW3JvdyArIDZdID0gdjEgLSB2NjsKICAgICAgICAgIHBbcm93ICsgMl0gPSB2MiArIHY1OwogICAgICAgICAgcFtyb3cgKyA1XSA9IHYyIC0gdjU7CiAgICAgICAgICBwW3JvdyArIDNdID0gdjMgKyB2NDsKICAgICAgICAgIHBbcm93ICsgNF0gPSB2MyAtIHY0OwogICAgICAgIH0KCiAgICAgICAgZm9yICh2YXIgY29sID0gMDsgY29sIDwgODsgKytjb2wpIHsKICAgICAgICAgIHAwID0gcFtjb2xdOwogICAgICAgICAgcDEgPSBwW2NvbCArIDhdOwogICAgICAgICAgcDIgPSBwW2NvbCArIDE2XTsKICAgICAgICAgIHAzID0gcFtjb2wgKyAyNF07CiAgICAgICAgICBwNCA9IHBbY29sICsgMzJdOwogICAgICAgICAgcDUgPSBwW2NvbCArIDQwXTsKICAgICAgICAgIHA2ID0gcFtjb2wgKyA0OF07CiAgICAgICAgICBwNyA9IHBbY29sICsgNTZdOwoKICAgICAgICAgIGlmICgocDEgfCBwMiB8IHAzIHwgcDQgfCBwNSB8IHA2IHwgcDcpID09PSAwKSB7CiAgICAgICAgICAgIHQgPSBkY3RTcXJ0MiAqIHAwICsgODE5MiA+PiAxNDsKCiAgICAgICAgICAgIGlmICh0IDwgLTIwNDApIHsKICAgICAgICAgICAgICB0ID0gMDsKICAgICAgICAgICAgfSBlbHNlIGlmICh0ID49IDIwMjQpIHsKICAgICAgICAgICAgICB0ID0gMjU1OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHQgPSB0ICsgMjA1NiA+PiA0OwogICAgICAgICAgICB9CgogICAgICAgICAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2xdID0gdDsKICAgICAgICAgICAgYmxvY2tEYXRhW2Jsb2NrQnVmZmVyT2Zmc2V0ICsgY29sICsgOF0gPSB0OwogICAgICAgICAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyAxNl0gPSB0OwogICAgICAgICAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyAyNF0gPSB0OwogICAgICAgICAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyAzMl0gPSB0OwogICAgICAgICAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyA0MF0gPSB0OwogICAgICAgICAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyA0OF0gPSB0OwogICAgICAgICAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyA1Nl0gPSB0OwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICB2MCA9IGRjdFNxcnQyICogcDAgKyAyMDQ4ID4+IDEyOwogICAgICAgICAgdjEgPSBkY3RTcXJ0MiAqIHA0ICsgMjA0OCA+PiAxMjsKICAgICAgICAgIHYyID0gcDI7CiAgICAgICAgICB2MyA9IHA2OwogICAgICAgICAgdjQgPSBkY3RTcXJ0MWQyICogKHAxIC0gcDcpICsgMjA0OCA+PiAxMjsKICAgICAgICAgIHY3ID0gZGN0U3FydDFkMiAqIChwMSArIHA3KSArIDIwNDggPj4gMTI7CiAgICAgICAgICB2NSA9IHAzOwogICAgICAgICAgdjYgPSBwNTsKICAgICAgICAgIHYwID0gKHYwICsgdjEgKyAxID4+IDEpICsgNDExMjsKICAgICAgICAgIHYxID0gdjAgLSB2MTsKICAgICAgICAgIHQgPSB2MiAqIGRjdFNpbjYgKyB2MyAqIGRjdENvczYgKyAyMDQ4ID4+IDEyOwogICAgICAgICAgdjIgPSB2MiAqIGRjdENvczYgLSB2MyAqIGRjdFNpbjYgKyAyMDQ4ID4+IDEyOwogICAgICAgICAgdjMgPSB0OwogICAgICAgICAgdjQgPSB2NCArIHY2ICsgMSA+PiAxOwogICAgICAgICAgdjYgPSB2NCAtIHY2OwogICAgICAgICAgdjcgPSB2NyArIHY1ICsgMSA+PiAxOwogICAgICAgICAgdjUgPSB2NyAtIHY1OwogICAgICAgICAgdjAgPSB2MCArIHYzICsgMSA+PiAxOwogICAgICAgICAgdjMgPSB2MCAtIHYzOwogICAgICAgICAgdjEgPSB2MSArIHYyICsgMSA+PiAxOwogICAgICAgICAgdjIgPSB2MSAtIHYyOwogICAgICAgICAgdCA9IHY0ICogZGN0U2luMyArIHY3ICogZGN0Q29zMyArIDIwNDggPj4gMTI7CiAgICAgICAgICB2NCA9IHY0ICogZGN0Q29zMyAtIHY3ICogZGN0U2luMyArIDIwNDggPj4gMTI7CiAgICAgICAgICB2NyA9IHQ7CiAgICAgICAgICB0ID0gdjUgKiBkY3RTaW4xICsgdjYgKiBkY3RDb3MxICsgMjA0OCA+PiAxMjsKICAgICAgICAgIHY1ID0gdjUgKiBkY3RDb3MxIC0gdjYgKiBkY3RTaW4xICsgMjA0OCA+PiAxMjsKICAgICAgICAgIHY2ID0gdDsKICAgICAgICAgIHAwID0gdjAgKyB2NzsKICAgICAgICAgIHA3ID0gdjAgLSB2NzsKICAgICAgICAgIHAxID0gdjEgKyB2NjsKICAgICAgICAgIHA2ID0gdjEgLSB2NjsKICAgICAgICAgIHAyID0gdjIgKyB2NTsKICAgICAgICAgIHA1ID0gdjIgLSB2NTsKICAgICAgICAgIHAzID0gdjMgKyB2NDsKICAgICAgICAgIHA0ID0gdjMgLSB2NDsKCiAgICAgICAgICBpZiAocDAgPCAxNikgewogICAgICAgICAgICBwMCA9IDA7CiAgICAgICAgICB9IGVsc2UgaWYgKHAwID49IDQwODApIHsKICAgICAgICAgICAgcDAgPSAyNTU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwMCA+Pj0gNDsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAocDEgPCAxNikgewogICAgICAgICAgICBwMSA9IDA7CiAgICAgICAgICB9IGVsc2UgaWYgKHAxID49IDQwODApIHsKICAgICAgICAgICAgcDEgPSAyNTU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwMSA+Pj0gNDsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAocDIgPCAxNikgewogICAgICAgICAgICBwMiA9IDA7CiAgICAgICAgICB9IGVsc2UgaWYgKHAyID49IDQwODApIHsKICAgICAgICAgICAgcDIgPSAyNTU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwMiA+Pj0gNDsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAocDMgPCAxNikgewogICAgICAgICAgICBwMyA9IDA7CiAgICAgICAgICB9IGVsc2UgaWYgKHAzID49IDQwODApIHsKICAgICAgICAgICAgcDMgPSAyNTU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwMyA+Pj0gNDsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAocDQgPCAxNikgewogICAgICAgICAgICBwNCA9IDA7CiAgICAgICAgICB9IGVsc2UgaWYgKHA0ID49IDQwODApIHsKICAgICAgICAgICAgcDQgPSAyNTU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwNCA+Pj0gNDsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAocDUgPCAxNikgewogICAgICAgICAgICBwNSA9IDA7CiAgICAgICAgICB9IGVsc2UgaWYgKHA1ID49IDQwODApIHsKICAgICAgICAgICAgcDUgPSAyNTU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwNSA+Pj0gNDsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAocDYgPCAxNikgewogICAgICAgICAgICBwNiA9IDA7CiAgICAgICAgICB9IGVsc2UgaWYgKHA2ID49IDQwODApIHsKICAgICAgICAgICAgcDYgPSAyNTU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwNiA+Pj0gNDsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAocDcgPCAxNikgewogICAgICAgICAgICBwNyA9IDA7CiAgICAgICAgICB9IGVsc2UgaWYgKHA3ID49IDQwODApIHsKICAgICAgICAgICAgcDcgPSAyNTU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwNyA+Pj0gNDsKICAgICAgICAgIH0KCiAgICAgICAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2xdID0gcDA7CiAgICAgICAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyA4XSA9IHAxOwogICAgICAgICAgYmxvY2tEYXRhW2Jsb2NrQnVmZmVyT2Zmc2V0ICsgY29sICsgMTZdID0gcDI7CiAgICAgICAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyAyNF0gPSBwMzsKICAgICAgICAgIGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIGNvbCArIDMyXSA9IHA0OwogICAgICAgICAgYmxvY2tEYXRhW2Jsb2NrQnVmZmVyT2Zmc2V0ICsgY29sICsgNDBdID0gcDU7CiAgICAgICAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyA0OF0gPSBwNjsKICAgICAgICAgIGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIGNvbCArIDU2XSA9IHA3OwogICAgICAgIH0KICAgICAgfQoKICAgICAgZnVuY3Rpb24gYnVpbGRDb21wb25lbnREYXRhKGZyYW1lLCBjb21wb25lbnQpIHsKICAgICAgICB2YXIgYmxvY2tzUGVyTGluZSA9IGNvbXBvbmVudC5ibG9ja3NQZXJMaW5lOwogICAgICAgIHZhciBibG9ja3NQZXJDb2x1bW4gPSBjb21wb25lbnQuYmxvY2tzUGVyQ29sdW1uOwogICAgICAgIHZhciBjb21wdXRhdGlvbkJ1ZmZlciA9IG5ldyBJbnQxNkFycmF5KDY0KTsKCiAgICAgICAgZm9yICh2YXIgYmxvY2tSb3cgPSAwOyBibG9ja1JvdyA8IGJsb2Nrc1BlckNvbHVtbjsgYmxvY2tSb3crKykgewogICAgICAgICAgZm9yICh2YXIgYmxvY2tDb2wgPSAwOyBibG9ja0NvbCA8IGJsb2Nrc1BlckxpbmU7IGJsb2NrQ29sKyspIHsKICAgICAgICAgICAgdmFyIG9mZnNldCA9IGdldEJsb2NrQnVmZmVyT2Zmc2V0KGNvbXBvbmVudCwgYmxvY2tSb3csIGJsb2NrQ29sKTsKICAgICAgICAgICAgcXVhbnRpemVBbmRJbnZlcnNlKGNvbXBvbmVudCwgb2Zmc2V0LCBjb21wdXRhdGlvbkJ1ZmZlcik7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gY29tcG9uZW50LmJsb2NrRGF0YTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZmluZE5leHRGaWxlTWFya2VyKGRhdGEsIGN1cnJlbnRQb3MpIHsKICAgICAgICB2YXIgc3RhcnRQb3MgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IGN1cnJlbnRQb3M7CiAgICAgICAgdmFyIG1heFBvcyA9IGRhdGEubGVuZ3RoIC0gMTsKICAgICAgICB2YXIgbmV3UG9zID0gc3RhcnRQb3MgPCBjdXJyZW50UG9zID8gc3RhcnRQb3MgOiBjdXJyZW50UG9zOwoKICAgICAgICBpZiAoY3VycmVudFBvcyA+PSBtYXhQb3MpIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgdmFyIGN1cnJlbnRNYXJrZXIgPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQxNikoZGF0YSwgY3VycmVudFBvcyk7CgogICAgICAgIGlmIChjdXJyZW50TWFya2VyID49IDB4ZmZjMCAmJiBjdXJyZW50TWFya2VyIDw9IDB4ZmZmZSkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgaW52YWxpZDogbnVsbCwKICAgICAgICAgICAgbWFya2VyOiBjdXJyZW50TWFya2VyLAogICAgICAgICAgICBvZmZzZXQ6IGN1cnJlbnRQb3MKICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICB2YXIgbmV3TWFya2VyID0gKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MTYpKGRhdGEsIG5ld1Bvcyk7CgogICAgICAgIHdoaWxlICghKG5ld01hcmtlciA+PSAweGZmYzAgJiYgbmV3TWFya2VyIDw9IDB4ZmZmZSkpIHsKICAgICAgICAgIGlmICgrK25ld1BvcyA+PSBtYXhQb3MpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgbmV3TWFya2VyID0gKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MTYpKGRhdGEsIG5ld1Bvcyk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gewogICAgICAgICAgaW52YWxpZDogY3VycmVudE1hcmtlci50b1N0cmluZygxNiksCiAgICAgICAgICBtYXJrZXI6IG5ld01hcmtlciwKICAgICAgICAgIG9mZnNldDogbmV3UG9zCiAgICAgICAgfTsKICAgICAgfQoKICAgICAgSnBlZ0ltYWdlLnByb3RvdHlwZSA9IHsKICAgICAgICBwYXJzZTogZnVuY3Rpb24gcGFyc2UoZGF0YSkgewogICAgICAgICAgdmFyIF9yZWYyID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fSwKICAgICAgICAgICAgX3JlZjIkZG5sU2NhbkxpbmVzID0gX3JlZjIuZG5sU2NhbkxpbmVzLAogICAgICAgICAgICBkbmxTY2FuTGluZXMgPSBfcmVmMiRkbmxTY2FuTGluZXMgPT09IHZvaWQgMCA/IG51bGwgOiBfcmVmMiRkbmxTY2FuTGluZXM7CgogICAgICAgICAgZnVuY3Rpb24gcmVhZERhdGFCbG9jaygpIHsKICAgICAgICAgICAgdmFyIGxlbmd0aCA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDE2KShkYXRhLCBvZmZzZXQpOwogICAgICAgICAgICBvZmZzZXQgKz0gMjsKICAgICAgICAgICAgdmFyIGVuZE9mZnNldCA9IG9mZnNldCArIGxlbmd0aCAtIDI7CiAgICAgICAgICAgIHZhciBmaWxlTWFya2VyID0gZmluZE5leHRGaWxlTWFya2VyKGRhdGEsIGVuZE9mZnNldCwgb2Zmc2V0KTsKCiAgICAgICAgICAgIGlmIChmaWxlTWFya2VyICYmIGZpbGVNYXJrZXIuaW52YWxpZCkgewogICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgicmVhZERhdGFCbG9jayAtIGluY29ycmVjdCBsZW5ndGgsIGN1cnJlbnQgbWFya2VyIGlzOiAiICsgZmlsZU1hcmtlci5pbnZhbGlkKTsKICAgICAgICAgICAgICBlbmRPZmZzZXQgPSBmaWxlTWFya2VyLm9mZnNldDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGFycmF5ID0gZGF0YS5zdWJhcnJheShvZmZzZXQsIGVuZE9mZnNldCk7CiAgICAgICAgICAgIG9mZnNldCArPSBhcnJheS5sZW5ndGg7CiAgICAgICAgICAgIHJldHVybiBhcnJheTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBwcmVwYXJlQ29tcG9uZW50cyhmcmFtZSkgewogICAgICAgICAgICB2YXIgbWN1c1BlckxpbmUgPSBNYXRoLmNlaWwoZnJhbWUuc2FtcGxlc1BlckxpbmUgLyA4IC8gZnJhbWUubWF4SCk7CiAgICAgICAgICAgIHZhciBtY3VzUGVyQ29sdW1uID0gTWF0aC5jZWlsKGZyYW1lLnNjYW5MaW5lcyAvIDggLyBmcmFtZS5tYXhWKTsKCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZnJhbWUuY29tcG9uZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIGNvbXBvbmVudCA9IGZyYW1lLmNvbXBvbmVudHNbaV07CiAgICAgICAgICAgICAgdmFyIGJsb2Nrc1BlckxpbmUgPSBNYXRoLmNlaWwoTWF0aC5jZWlsKGZyYW1lLnNhbXBsZXNQZXJMaW5lIC8gOCkgKiBjb21wb25lbnQuaCAvIGZyYW1lLm1heEgpOwogICAgICAgICAgICAgIHZhciBibG9ja3NQZXJDb2x1bW4gPSBNYXRoLmNlaWwoTWF0aC5jZWlsKGZyYW1lLnNjYW5MaW5lcyAvIDgpICogY29tcG9uZW50LnYgLyBmcmFtZS5tYXhWKTsKICAgICAgICAgICAgICB2YXIgYmxvY2tzUGVyTGluZUZvck1jdSA9IG1jdXNQZXJMaW5lICogY29tcG9uZW50Lmg7CiAgICAgICAgICAgICAgdmFyIGJsb2Nrc1BlckNvbHVtbkZvck1jdSA9IG1jdXNQZXJDb2x1bW4gKiBjb21wb25lbnQudjsKICAgICAgICAgICAgICB2YXIgYmxvY2tzQnVmZmVyU2l6ZSA9IDY0ICogYmxvY2tzUGVyQ29sdW1uRm9yTWN1ICogKGJsb2Nrc1BlckxpbmVGb3JNY3UgKyAxKTsKICAgICAgICAgICAgICBjb21wb25lbnQuYmxvY2tEYXRhID0gbmV3IEludDE2QXJyYXkoYmxvY2tzQnVmZmVyU2l6ZSk7CiAgICAgICAgICAgICAgY29tcG9uZW50LmJsb2Nrc1BlckxpbmUgPSBibG9ja3NQZXJMaW5lOwogICAgICAgICAgICAgIGNvbXBvbmVudC5ibG9ja3NQZXJDb2x1bW4gPSBibG9ja3NQZXJDb2x1bW47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZyYW1lLm1jdXNQZXJMaW5lID0gbWN1c1BlckxpbmU7CiAgICAgICAgICAgIGZyYW1lLm1jdXNQZXJDb2x1bW4gPSBtY3VzUGVyQ29sdW1uOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBvZmZzZXQgPSAwOwogICAgICAgICAgdmFyIGpmaWYgPSBudWxsOwogICAgICAgICAgdmFyIGFkb2JlID0gbnVsbDsKICAgICAgICAgIHZhciBmcmFtZSwgcmVzZXRJbnRlcnZhbDsKICAgICAgICAgIHZhciBudW1TT1NNYXJrZXJzID0gMDsKICAgICAgICAgIHZhciBxdWFudGl6YXRpb25UYWJsZXMgPSBbXTsKICAgICAgICAgIHZhciBodWZmbWFuVGFibGVzQUMgPSBbXSwKICAgICAgICAgICAgaHVmZm1hblRhYmxlc0RDID0gW107CiAgICAgICAgICB2YXIgZmlsZU1hcmtlciA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDE2KShkYXRhLCBvZmZzZXQpOwogICAgICAgICAgb2Zmc2V0ICs9IDI7CgogICAgICAgICAgaWYgKGZpbGVNYXJrZXIgIT09IDB4ZmZkOCkgewogICAgICAgICAgICB0aHJvdyBuZXcgSnBlZ0Vycm9yKCJTT0kgbm90IGZvdW5kIik7CiAgICAgICAgICB9CgogICAgICAgICAgZmlsZU1hcmtlciA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDE2KShkYXRhLCBvZmZzZXQpOwogICAgICAgICAgb2Zmc2V0ICs9IDI7CgogICAgICAgICAgbWFya2VyTG9vcDogd2hpbGUgKGZpbGVNYXJrZXIgIT09IDB4ZmZkOSkgewogICAgICAgICAgICB2YXIgaSwgaiwgbDsKCiAgICAgICAgICAgIHN3aXRjaCAoZmlsZU1hcmtlcikgewogICAgICAgICAgICAgIGNhc2UgMHhmZmUwOgogICAgICAgICAgICAgIGNhc2UgMHhmZmUxOgogICAgICAgICAgICAgIGNhc2UgMHhmZmUyOgogICAgICAgICAgICAgIGNhc2UgMHhmZmUzOgogICAgICAgICAgICAgIGNhc2UgMHhmZmU0OgogICAgICAgICAgICAgIGNhc2UgMHhmZmU1OgogICAgICAgICAgICAgIGNhc2UgMHhmZmU2OgogICAgICAgICAgICAgIGNhc2UgMHhmZmU3OgogICAgICAgICAgICAgIGNhc2UgMHhmZmU4OgogICAgICAgICAgICAgIGNhc2UgMHhmZmU5OgogICAgICAgICAgICAgIGNhc2UgMHhmZmVhOgogICAgICAgICAgICAgIGNhc2UgMHhmZmViOgogICAgICAgICAgICAgIGNhc2UgMHhmZmVjOgogICAgICAgICAgICAgIGNhc2UgMHhmZmVkOgogICAgICAgICAgICAgIGNhc2UgMHhmZmVlOgogICAgICAgICAgICAgIGNhc2UgMHhmZmVmOgogICAgICAgICAgICAgIGNhc2UgMHhmZmZlOgogICAgICAgICAgICAgICAgdmFyIGFwcERhdGEgPSByZWFkRGF0YUJsb2NrKCk7CgogICAgICAgICAgICAgICAgaWYgKGZpbGVNYXJrZXIgPT09IDB4ZmZlMCkgewogICAgICAgICAgICAgICAgICBpZiAoYXBwRGF0YVswXSA9PT0gMHg0YSAmJiBhcHBEYXRhWzFdID09PSAweDQ2ICYmIGFwcERhdGFbMl0gPT09IDB4NDkgJiYgYXBwRGF0YVszXSA9PT0gMHg0NiAmJiBhcHBEYXRhWzRdID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgamZpZiA9IHsKICAgICAgICAgICAgICAgICAgICAgIHZlcnNpb246IHsKICAgICAgICAgICAgICAgICAgICAgICAgbWFqb3I6IGFwcERhdGFbNV0sCiAgICAgICAgICAgICAgICAgICAgICAgIG1pbm9yOiBhcHBEYXRhWzZdCiAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgZGVuc2l0eVVuaXRzOiBhcHBEYXRhWzddLAogICAgICAgICAgICAgICAgICAgICAgeERlbnNpdHk6IGFwcERhdGFbOF0gPDwgOCB8IGFwcERhdGFbOV0sCiAgICAgICAgICAgICAgICAgICAgICB5RGVuc2l0eTogYXBwRGF0YVsxMF0gPDwgOCB8IGFwcERhdGFbMTFdLAogICAgICAgICAgICAgICAgICAgICAgdGh1bWJXaWR0aDogYXBwRGF0YVsxMl0sCiAgICAgICAgICAgICAgICAgICAgICB0aHVtYkhlaWdodDogYXBwRGF0YVsxM10sCiAgICAgICAgICAgICAgICAgICAgICB0aHVtYkRhdGE6IGFwcERhdGEuc3ViYXJyYXkoMTQsIDE0ICsgMyAqIGFwcERhdGFbMTJdICogYXBwRGF0YVsxM10pCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChmaWxlTWFya2VyID09PSAweGZmZWUpIHsKICAgICAgICAgICAgICAgICAgaWYgKGFwcERhdGFbMF0gPT09IDB4NDEgJiYgYXBwRGF0YVsxXSA9PT0gMHg2NCAmJiBhcHBEYXRhWzJdID09PSAweDZmICYmIGFwcERhdGFbM10gPT09IDB4NjIgJiYgYXBwRGF0YVs0XSA9PT0gMHg2NSkgewogICAgICAgICAgICAgICAgICAgIGFkb2JlID0gewogICAgICAgICAgICAgICAgICAgICAgdmVyc2lvbjogYXBwRGF0YVs1XSA8PCA4IHwgYXBwRGF0YVs2XSwKICAgICAgICAgICAgICAgICAgICAgIGZsYWdzMDogYXBwRGF0YVs3XSA8PCA4IHwgYXBwRGF0YVs4XSwKICAgICAgICAgICAgICAgICAgICAgIGZsYWdzMTogYXBwRGF0YVs5XSA8PCA4IHwgYXBwRGF0YVsxMF0sCiAgICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1Db2RlOiBhcHBEYXRhWzExXQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAweGZmZGI6CiAgICAgICAgICAgICAgICB2YXIgcXVhbnRpemF0aW9uVGFibGVzTGVuZ3RoID0gKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MTYpKGRhdGEsIG9mZnNldCk7CiAgICAgICAgICAgICAgICBvZmZzZXQgKz0gMjsKICAgICAgICAgICAgICAgIHZhciBxdWFudGl6YXRpb25UYWJsZXNFbmQgPSBxdWFudGl6YXRpb25UYWJsZXNMZW5ndGggKyBvZmZzZXQgLSAyOwogICAgICAgICAgICAgICAgdmFyIHo7CgogICAgICAgICAgICAgICAgd2hpbGUgKG9mZnNldCA8IHF1YW50aXphdGlvblRhYmxlc0VuZCkgewogICAgICAgICAgICAgICAgICB2YXIgcXVhbnRpemF0aW9uVGFibGVTcGVjID0gZGF0YVtvZmZzZXQrK107CiAgICAgICAgICAgICAgICAgIHZhciB0YWJsZURhdGEgPSBuZXcgVWludDE2QXJyYXkoNjQpOwoKICAgICAgICAgICAgICAgICAgaWYgKHF1YW50aXphdGlvblRhYmxlU3BlYyA+PiA0ID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IDY0OyBqKyspIHsKICAgICAgICAgICAgICAgICAgICAgIHogPSBkY3RaaWdaYWdbal07CiAgICAgICAgICAgICAgICAgICAgICB0YWJsZURhdGFbel0gPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocXVhbnRpemF0aW9uVGFibGVTcGVjID4+IDQgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgNjQ7IGorKykgewogICAgICAgICAgICAgICAgICAgICAgeiA9IGRjdFppZ1phZ1tqXTsKICAgICAgICAgICAgICAgICAgICAgIHRhYmxlRGF0YVt6XSA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDE2KShkYXRhLCBvZmZzZXQpOwogICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ICs9IDI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBKcGVnRXJyb3IoIkRRVCAtIGludmFsaWQgdGFibGUgc3BlYyIpOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBxdWFudGl6YXRpb25UYWJsZXNbcXVhbnRpemF0aW9uVGFibGVTcGVjICYgMTVdID0gdGFibGVEYXRhOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDB4ZmZjMDoKICAgICAgICAgICAgICBjYXNlIDB4ZmZjMToKICAgICAgICAgICAgICBjYXNlIDB4ZmZjMjoKICAgICAgICAgICAgICAgIGlmIChmcmFtZSkgewogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSnBlZ0Vycm9yKCJPbmx5IHNpbmdsZSBmcmFtZSBKUEVHcyBzdXBwb3J0ZWQiKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBvZmZzZXQgKz0gMjsKICAgICAgICAgICAgICAgIGZyYW1lID0ge307CiAgICAgICAgICAgICAgICBmcmFtZS5leHRlbmRlZCA9IGZpbGVNYXJrZXIgPT09IDB4ZmZjMTsKICAgICAgICAgICAgICAgIGZyYW1lLnByb2dyZXNzaXZlID0gZmlsZU1hcmtlciA9PT0gMHhmZmMyOwogICAgICAgICAgICAgICAgZnJhbWUucHJlY2lzaW9uID0gZGF0YVtvZmZzZXQrK107CiAgICAgICAgICAgICAgICB2YXIgc29mU2NhbkxpbmVzID0gKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MTYpKGRhdGEsIG9mZnNldCk7CiAgICAgICAgICAgICAgICBvZmZzZXQgKz0gMjsKICAgICAgICAgICAgICAgIGZyYW1lLnNjYW5MaW5lcyA9IGRubFNjYW5MaW5lcyB8fCBzb2ZTY2FuTGluZXM7CiAgICAgICAgICAgICAgICBmcmFtZS5zYW1wbGVzUGVyTGluZSA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDE2KShkYXRhLCBvZmZzZXQpOwogICAgICAgICAgICAgICAgb2Zmc2V0ICs9IDI7CiAgICAgICAgICAgICAgICBmcmFtZS5jb21wb25lbnRzID0gW107CiAgICAgICAgICAgICAgICBmcmFtZS5jb21wb25lbnRJZHMgPSB7fTsKICAgICAgICAgICAgICAgIHZhciBjb21wb25lbnRzQ291bnQgPSBkYXRhW29mZnNldCsrXSwKICAgICAgICAgICAgICAgICAgY29tcG9uZW50SWQ7CiAgICAgICAgICAgICAgICB2YXIgbWF4SCA9IDAsCiAgICAgICAgICAgICAgICAgIG1heFYgPSAwOwoKICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjb21wb25lbnRzQ291bnQ7IGkrKykgewogICAgICAgICAgICAgICAgICBjb21wb25lbnRJZCA9IGRhdGFbb2Zmc2V0XTsKICAgICAgICAgICAgICAgICAgdmFyIGggPSBkYXRhW29mZnNldCArIDFdID4+IDQ7CiAgICAgICAgICAgICAgICAgIHZhciB2ID0gZGF0YVtvZmZzZXQgKyAxXSAmIDE1OwoKICAgICAgICAgICAgICAgICAgaWYgKG1heEggPCBoKSB7CiAgICAgICAgICAgICAgICAgICAgbWF4SCA9IGg7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGlmIChtYXhWIDwgdikgewogICAgICAgICAgICAgICAgICAgIG1heFYgPSB2OwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB2YXIgcUlkID0gZGF0YVtvZmZzZXQgKyAyXTsKICAgICAgICAgICAgICAgICAgbCA9IGZyYW1lLmNvbXBvbmVudHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgaDogaCwKICAgICAgICAgICAgICAgICAgICB2OiB2LAogICAgICAgICAgICAgICAgICAgIHF1YW50aXphdGlvbklkOiBxSWQsCiAgICAgICAgICAgICAgICAgICAgcXVhbnRpemF0aW9uVGFibGU6IG51bGwKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIGZyYW1lLmNvbXBvbmVudElkc1tjb21wb25lbnRJZF0gPSBsIC0gMTsKICAgICAgICAgICAgICAgICAgb2Zmc2V0ICs9IDM7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnJhbWUubWF4SCA9IG1heEg7CiAgICAgICAgICAgICAgICBmcmFtZS5tYXhWID0gbWF4VjsKICAgICAgICAgICAgICAgIHByZXBhcmVDb21wb25lbnRzKGZyYW1lKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDB4ZmZjNDoKICAgICAgICAgICAgICAgIHZhciBodWZmbWFuTGVuZ3RoID0gKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MTYpKGRhdGEsIG9mZnNldCk7CiAgICAgICAgICAgICAgICBvZmZzZXQgKz0gMjsKCiAgICAgICAgICAgICAgICBmb3IgKGkgPSAyOyBpIDwgaHVmZm1hbkxlbmd0aDspIHsKICAgICAgICAgICAgICAgICAgdmFyIGh1ZmZtYW5UYWJsZVNwZWMgPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgICAgICAgICAgdmFyIGNvZGVMZW5ndGhzID0gbmV3IFVpbnQ4QXJyYXkoMTYpOwogICAgICAgICAgICAgICAgICB2YXIgY29kZUxlbmd0aFN1bSA9IDA7CgogICAgICAgICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgMTY7IGorKywgb2Zmc2V0KyspIHsKICAgICAgICAgICAgICAgICAgICBjb2RlTGVuZ3RoU3VtICs9IGNvZGVMZW5ndGhzW2pdID0gZGF0YVtvZmZzZXRdOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB2YXIgaHVmZm1hblZhbHVlcyA9IG5ldyBVaW50OEFycmF5KGNvZGVMZW5ndGhTdW0pOwoKICAgICAgICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IGNvZGVMZW5ndGhTdW07IGorKywgb2Zmc2V0KyspIHsKICAgICAgICAgICAgICAgICAgICBodWZmbWFuVmFsdWVzW2pdID0gZGF0YVtvZmZzZXRdOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBpICs9IDE3ICsgY29kZUxlbmd0aFN1bTsKICAgICAgICAgICAgICAgICAgKGh1ZmZtYW5UYWJsZVNwZWMgPj4gNCA9PT0gMCA/IGh1ZmZtYW5UYWJsZXNEQyA6IGh1ZmZtYW5UYWJsZXNBQylbaHVmZm1hblRhYmxlU3BlYyAmIDE1XSA9IGJ1aWxkSHVmZm1hblRhYmxlKGNvZGVMZW5ndGhzLCBodWZmbWFuVmFsdWVzKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAweGZmZGQ6CiAgICAgICAgICAgICAgICBvZmZzZXQgKz0gMjsKICAgICAgICAgICAgICAgIHJlc2V0SW50ZXJ2YWwgPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQxNikoZGF0YSwgb2Zmc2V0KTsKICAgICAgICAgICAgICAgIG9mZnNldCArPSAyOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMHhmZmRhOgogICAgICAgICAgICAgICAgdmFyIHBhcnNlRE5MTWFya2VyID0gKytudW1TT1NNYXJrZXJzID09PSAxICYmICFkbmxTY2FuTGluZXM7CiAgICAgICAgICAgICAgICBvZmZzZXQgKz0gMjsKICAgICAgICAgICAgICAgIHZhciBzZWxlY3RvcnNDb3VudCA9IGRhdGFbb2Zmc2V0KytdOwogICAgICAgICAgICAgICAgdmFyIGNvbXBvbmVudHMgPSBbXSwKICAgICAgICAgICAgICAgICAgY29tcG9uZW50OwoKICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzZWxlY3RvcnNDb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgIHZhciBjb21wb25lbnRJbmRleCA9IGZyYW1lLmNvbXBvbmVudElkc1tkYXRhW29mZnNldCsrXV07CiAgICAgICAgICAgICAgICAgIGNvbXBvbmVudCA9IGZyYW1lLmNvbXBvbmVudHNbY29tcG9uZW50SW5kZXhdOwogICAgICAgICAgICAgICAgICB2YXIgdGFibGVTcGVjID0gZGF0YVtvZmZzZXQrK107CiAgICAgICAgICAgICAgICAgIGNvbXBvbmVudC5odWZmbWFuVGFibGVEQyA9IGh1ZmZtYW5UYWJsZXNEQ1t0YWJsZVNwZWMgPj4gNF07CiAgICAgICAgICAgICAgICAgIGNvbXBvbmVudC5odWZmbWFuVGFibGVBQyA9IGh1ZmZtYW5UYWJsZXNBQ1t0YWJsZVNwZWMgJiAxNV07CiAgICAgICAgICAgICAgICAgIGNvbXBvbmVudHMucHVzaChjb21wb25lbnQpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHZhciBzcGVjdHJhbFN0YXJ0ID0gZGF0YVtvZmZzZXQrK107CiAgICAgICAgICAgICAgICB2YXIgc3BlY3RyYWxFbmQgPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzaXZlQXBwcm94aW1hdGlvbiA9IGRhdGFbb2Zmc2V0KytdOwoKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgIHZhciBwcm9jZXNzZWQgPSBkZWNvZGVTY2FuKGRhdGEsIG9mZnNldCwgZnJhbWUsIGNvbXBvbmVudHMsIHJlc2V0SW50ZXJ2YWwsIHNwZWN0cmFsU3RhcnQsIHNwZWN0cmFsRW5kLCBzdWNjZXNzaXZlQXBwcm94aW1hdGlvbiA+PiA0LCBzdWNjZXNzaXZlQXBwcm94aW1hdGlvbiAmIDE1LCBwYXJzZUROTE1hcmtlcik7CiAgICAgICAgICAgICAgICAgIG9mZnNldCArPSBwcm9jZXNzZWQ7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgICAgICAgICBpZiAoZXggaW5zdGFuY2VvZiBETkxNYXJrZXJFcnJvcikgewogICAgICAgICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiIi5jb25jYXQoZXgubWVzc2FnZSwgIiAtLSBhdHRlbXB0aW5nIHRvIHJlLXBhcnNlIHRoZSBKUEVHIGltYWdlLiIpKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZShkYXRhLCB7CiAgICAgICAgICAgICAgICAgICAgICBkbmxTY2FuTGluZXM6IGV4LnNjYW5MaW5lcwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV4IGluc3RhbmNlb2YgRU9JTWFya2VyRXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIiIuY29uY2F0KGV4Lm1lc3NhZ2UsICIgLS0gaWdub3JpbmcgdGhlIHJlc3Qgb2YgdGhlIGltYWdlIGRhdGEuIikpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrIG1hcmtlckxvb3A7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIHRocm93IGV4OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDB4ZmZkYzoKICAgICAgICAgICAgICAgIG9mZnNldCArPSA0OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMHhmZmZmOgogICAgICAgICAgICAgICAgaWYgKGRhdGFbb2Zmc2V0XSAhPT0gMHhmZikgewogICAgICAgICAgICAgICAgICBvZmZzZXQtLTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHZhciBuZXh0RmlsZU1hcmtlciA9IGZpbmROZXh0RmlsZU1hcmtlcihkYXRhLCBvZmZzZXQgLSAyLCBvZmZzZXQgLSAzKTsKCiAgICAgICAgICAgICAgICBpZiAobmV4dEZpbGVNYXJrZXIgJiYgbmV4dEZpbGVNYXJrZXIuaW52YWxpZCkgewogICAgICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIkpwZWdJbWFnZS5wYXJzZSAtIHVuZXhwZWN0ZWQgZGF0YSwgY3VycmVudCBtYXJrZXIgaXM6ICIgKyBuZXh0RmlsZU1hcmtlci5pbnZhbGlkKTsKICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gbmV4dEZpbGVNYXJrZXIub2Zmc2V0OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAob2Zmc2V0ID49IGRhdGEubGVuZ3RoIC0gMSkgewogICAgICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIkpwZWdJbWFnZS5wYXJzZSAtIHJlYWNoZWQgdGhlIGVuZCBvZiB0aGUgaW1hZ2UgZGF0YSAiICsgIndpdGhvdXQgZmluZGluZyBhbiBFT0kgbWFya2VyICgweEZGRDkpLiIpOwogICAgICAgICAgICAgICAgICBicmVhayBtYXJrZXJMb29wOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBKcGVnRXJyb3IoIkpwZWdJbWFnZS5wYXJzZSAtIHVua25vd24gbWFya2VyOiAiICsgZmlsZU1hcmtlci50b1N0cmluZygxNikpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmaWxlTWFya2VyID0gKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MTYpKGRhdGEsIG9mZnNldCk7CiAgICAgICAgICAgIG9mZnNldCArPSAyOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMud2lkdGggPSBmcmFtZS5zYW1wbGVzUGVyTGluZTsKICAgICAgICAgIHRoaXMuaGVpZ2h0ID0gZnJhbWUuc2NhbkxpbmVzOwogICAgICAgICAgdGhpcy5qZmlmID0gamZpZjsKICAgICAgICAgIHRoaXMuYWRvYmUgPSBhZG9iZTsKICAgICAgICAgIHRoaXMuY29tcG9uZW50cyA9IFtdOwoKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBmcmFtZS5jb21wb25lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNvbXBvbmVudCA9IGZyYW1lLmNvbXBvbmVudHNbaV07CiAgICAgICAgICAgIHZhciBxdWFudGl6YXRpb25UYWJsZSA9IHF1YW50aXphdGlvblRhYmxlc1tjb21wb25lbnQucXVhbnRpemF0aW9uSWRdOwoKICAgICAgICAgICAgaWYgKHF1YW50aXphdGlvblRhYmxlKSB7CiAgICAgICAgICAgICAgY29tcG9uZW50LnF1YW50aXphdGlvblRhYmxlID0gcXVhbnRpemF0aW9uVGFibGU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuY29tcG9uZW50cy5wdXNoKHsKICAgICAgICAgICAgICBvdXRwdXQ6IGJ1aWxkQ29tcG9uZW50RGF0YShmcmFtZSwgY29tcG9uZW50KSwKICAgICAgICAgICAgICBzY2FsZVg6IGNvbXBvbmVudC5oIC8gZnJhbWUubWF4SCwKICAgICAgICAgICAgICBzY2FsZVk6IGNvbXBvbmVudC52IC8gZnJhbWUubWF4ViwKICAgICAgICAgICAgICBibG9ja3NQZXJMaW5lOiBjb21wb25lbnQuYmxvY2tzUGVyTGluZSwKICAgICAgICAgICAgICBibG9ja3NQZXJDb2x1bW46IGNvbXBvbmVudC5ibG9ja3NQZXJDb2x1bW4KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5udW1Db21wb25lbnRzID0gdGhpcy5jb21wb25lbnRzLmxlbmd0aDsKICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgfSwKICAgICAgICBfZ2V0TGluZWFyaXplZEJsb2NrRGF0YTogZnVuY3Rpb24gX2dldExpbmVhcml6ZWRCbG9ja0RhdGEod2lkdGgsIGhlaWdodCkgewogICAgICAgICAgdmFyIGlzU291cmNlUERGID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiBmYWxzZTsKICAgICAgICAgIHZhciBzY2FsZVggPSB0aGlzLndpZHRoIC8gd2lkdGgsCiAgICAgICAgICAgIHNjYWxlWSA9IHRoaXMuaGVpZ2h0IC8gaGVpZ2h0OwogICAgICAgICAgdmFyIGNvbXBvbmVudCwgY29tcG9uZW50U2NhbGVYLCBjb21wb25lbnRTY2FsZVksIGJsb2Nrc1BlclNjYW5saW5lOwogICAgICAgICAgdmFyIHgsIHksIGksIGosIGs7CiAgICAgICAgICB2YXIgaW5kZXg7CiAgICAgICAgICB2YXIgb2Zmc2V0ID0gMDsKICAgICAgICAgIHZhciBvdXRwdXQ7CiAgICAgICAgICB2YXIgbnVtQ29tcG9uZW50cyA9IHRoaXMuY29tcG9uZW50cy5sZW5ndGg7CiAgICAgICAgICB2YXIgZGF0YUxlbmd0aCA9IHdpZHRoICogaGVpZ2h0ICogbnVtQ29tcG9uZW50czsKICAgICAgICAgIHZhciBkYXRhID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KGRhdGFMZW5ndGgpOwogICAgICAgICAgdmFyIHhTY2FsZUJsb2NrT2Zmc2V0ID0gbmV3IFVpbnQzMkFycmF5KHdpZHRoKTsKICAgICAgICAgIHZhciBtYXNrM0xTQiA9IDB4ZmZmZmZmZjg7CiAgICAgICAgICB2YXIgbGFzdENvbXBvbmVudFNjYWxlWDsKCiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbnVtQ29tcG9uZW50czsgaSsrKSB7CiAgICAgICAgICAgIGNvbXBvbmVudCA9IHRoaXMuY29tcG9uZW50c1tpXTsKICAgICAgICAgICAgY29tcG9uZW50U2NhbGVYID0gY29tcG9uZW50LnNjYWxlWCAqIHNjYWxlWDsKICAgICAgICAgICAgY29tcG9uZW50U2NhbGVZID0gY29tcG9uZW50LnNjYWxlWSAqIHNjYWxlWTsKICAgICAgICAgICAgb2Zmc2V0ID0gaTsKICAgICAgICAgICAgb3V0cHV0ID0gY29tcG9uZW50Lm91dHB1dDsKICAgICAgICAgICAgYmxvY2tzUGVyU2NhbmxpbmUgPSBjb21wb25lbnQuYmxvY2tzUGVyTGluZSArIDEgPDwgMzsKCiAgICAgICAgICAgIGlmIChjb21wb25lbnRTY2FsZVggIT09IGxhc3RDb21wb25lbnRTY2FsZVgpIHsKICAgICAgICAgICAgICBmb3IgKHggPSAwOyB4IDwgd2lkdGg7IHgrKykgewogICAgICAgICAgICAgICAgaiA9IDAgfCB4ICogY29tcG9uZW50U2NhbGVYOwogICAgICAgICAgICAgICAgeFNjYWxlQmxvY2tPZmZzZXRbeF0gPSAoaiAmIG1hc2szTFNCKSA8PCAzIHwgaiAmIDc7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBsYXN0Q29tcG9uZW50U2NhbGVYID0gY29tcG9uZW50U2NhbGVYOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmb3IgKHkgPSAwOyB5IDwgaGVpZ2h0OyB5KyspIHsKICAgICAgICAgICAgICBqID0gMCB8IHkgKiBjb21wb25lbnRTY2FsZVk7CiAgICAgICAgICAgICAgaW5kZXggPSBibG9ja3NQZXJTY2FubGluZSAqIChqICYgbWFzazNMU0IpIHwgKGogJiA3KSA8PCAzOwoKICAgICAgICAgICAgICBmb3IgKHggPSAwOyB4IDwgd2lkdGg7IHgrKykgewogICAgICAgICAgICAgICAgZGF0YVtvZmZzZXRdID0gb3V0cHV0W2luZGV4ICsgeFNjYWxlQmxvY2tPZmZzZXRbeF1dOwogICAgICAgICAgICAgICAgb2Zmc2V0ICs9IG51bUNvbXBvbmVudHM7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHRyYW5zZm9ybSA9IHRoaXMuX2RlY29kZVRyYW5zZm9ybTsKCiAgICAgICAgICBpZiAoIWlzU291cmNlUERGICYmIG51bUNvbXBvbmVudHMgPT09IDQgJiYgIXRyYW5zZm9ybSkgewogICAgICAgICAgICB0cmFuc2Zvcm0gPSBuZXcgSW50MzJBcnJheShbLTI1NiwgMjU1LCAtMjU2LCAyNTUsIC0yNTYsIDI1NSwgLTI1NiwgMjU1XSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRyYW5zZm9ybSkgewogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZGF0YUxlbmd0aDspIHsKICAgICAgICAgICAgICBmb3IgKGogPSAwLCBrID0gMDsgaiA8IG51bUNvbXBvbmVudHM7IGorKywgaSsrLCBrICs9IDIpIHsKICAgICAgICAgICAgICAgIGRhdGFbaV0gPSAoZGF0YVtpXSAqIHRyYW5zZm9ybVtrXSA+PiA4KSArIHRyYW5zZm9ybVtrICsgMV07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGRhdGE7CiAgICAgICAgfSwKCiAgICAgICAgZ2V0IF9pc0NvbG9yQ29udmVyc2lvbk5lZWRlZCgpIHsKICAgICAgICAgIGlmICh0aGlzLmFkb2JlKSB7CiAgICAgICAgICAgIHJldHVybiAhIXRoaXMuYWRvYmUudHJhbnNmb3JtQ29kZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodGhpcy5udW1Db21wb25lbnRzID09PSAzKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9jb2xvclRyYW5zZm9ybSA9PT0gMCkgewogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRoaXMuX2NvbG9yVHJhbnNmb3JtID09PSAxKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9LAoKICAgICAgICBfY29udmVydFljY1RvUmdiOiBmdW5jdGlvbiBjb252ZXJ0WWNjVG9SZ2IoZGF0YSkgewogICAgICAgICAgdmFyIFksIENiLCBDcjsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gZGF0YS5sZW5ndGg7IGkgPCBsZW5ndGg7IGkgKz0gMykgewogICAgICAgICAgICBZID0gZGF0YVtpXTsKICAgICAgICAgICAgQ2IgPSBkYXRhW2kgKyAxXTsKICAgICAgICAgICAgQ3IgPSBkYXRhW2kgKyAyXTsKICAgICAgICAgICAgZGF0YVtpXSA9IFkgLSAxNzkuNDU2ICsgMS40MDIgKiBDcjsKICAgICAgICAgICAgZGF0YVtpICsgMV0gPSBZICsgMTM1LjQ1OSAtIDAuMzQ0ICogQ2IgLSAwLjcxNCAqIENyOwogICAgICAgICAgICBkYXRhW2kgKyAyXSA9IFkgLSAyMjYuODE2ICsgMS43NzIgKiBDYjsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gZGF0YTsKICAgICAgICB9LAogICAgICAgIF9jb252ZXJ0WWNja1RvUmdiOiBmdW5jdGlvbiBjb252ZXJ0WWNja1RvUmdiKGRhdGEpIHsKICAgICAgICAgIHZhciBZLCBDYiwgQ3IsIGs7CiAgICAgICAgICB2YXIgb2Zmc2V0ID0gMDsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gZGF0YS5sZW5ndGg7IGkgPCBsZW5ndGg7IGkgKz0gNCkgewogICAgICAgICAgICBZID0gZGF0YVtpXTsKICAgICAgICAgICAgQ2IgPSBkYXRhW2kgKyAxXTsKICAgICAgICAgICAgQ3IgPSBkYXRhW2kgKyAyXTsKICAgICAgICAgICAgayA9IGRhdGFbaSArIDNdOwogICAgICAgICAgICBkYXRhW29mZnNldCsrXSA9IC0xMjIuNjcxOTU0MDY4OTQgKyBDYiAqICgtNi42MDYzNTY2OTQyMDM2NGUtNSAqIENiICsgMC4wMDA0MzcxMzA0NzU5MjYyMzIgKiBDciAtIDUuNDA4MDYxMDA2NDU5OWUtNSAqIFkgKyAwLjAwMDQ4NDQ5Nzk3MTIwMjgxICogayAtIDAuMTU0MzYyMTUxODcxMTI2KSArIENyICogKC0wLjAwMDk1Nzk2NDM3ODQ0NTc3MyAqIENyICsgMC4wMDA4MTcwNzY5MTEzNDY2MjUgKiBZIC0gMC4wMDQ3NzI3MTQwNTQwODc0NyAqIGsgKyAxLjUzMzgwMjUzMjIxNzM0KSArIFkgKiAoMC4wMDA5NjEyNTAxODQxMzA2ODggKiBZIC0gMC4wMDI2NjI1NzMzMjI4MzkzMyAqIGsgKyAwLjQ4MzU3MDg4NDUxMjY1KSArIGsgKiAoLTAuMDAwMzM2MTk3MTc3NjE4Mzk0ICogayArIDAuNDg0NzkxNTYxNDkwNzc2KTsKICAgICAgICAgICAgZGF0YVtvZmZzZXQrK10gPSAxMDcuMjY4MDM5Mzk3NzI0ICsgQ2IgKiAoMi4xOTkyNzEwNDUyNTc0MWUtNSAqIENiIC0gMC4wMDA2NDA5OTIwMTgyOTc5NDUgKiBDciArIDAuMDAwNjU5Mzk3MDAxMjQ1NTc3ICogWSArIDAuMDAwNDI2MTA1NjUyOTM4ODM3ICogayAtIDAuMTc2NDkxNzkyNDYyODc1KSArIENyICogKC0wLjAwMDc3ODI2OTk0MTUxMzY4MyAqIENyICsgMC4wMDEzMDg3MjI2MTQwODI3NSAqIFkgKyAwLjAwMDc3MDQ4MjYzMTgwMTEzMiAqIGsgLSAwLjE1MTA1MTQ5Mjc3NTU2MikgKyBZICogKDAuMDAxMjY5MzUzNjgxMTQ4NDMgKiBZIC0gMC4wMDI2NTA5MDE4OTAxMDg5OCAqIGsgKyAwLjI1ODAyOTEwMjA2ODQ1KSArIGsgKiAoLTAuMDAwMzE4OTEzMTE3NTg4MzI4ICogayAtIDAuMjEzNzQyNDAwMzIzNjY1KTsKICAgICAgICAgICAgZGF0YVtvZmZzZXQrK10gPSAtMjAuODEwMDEyNTQ2OTQ3ICsgQ2IgKiAoLTAuMDAwNTcwMTE1MTk2OTczNjc3ICogQ2IgLSAyLjYzNDA5MDUxMDA0NTg5ZS01ICogQ3IgKyAwLjAwMjA3NDEwODgxMTUwMTIgKiBZIC0gMC4wMDI4ODI2MDIzNjg1MzQ0MiAqIGsgKyAwLjgxNDI3Mjk2ODM1OTI5NSkgKyBDciAqICgtMS41MzQ5NjA1NzQ0MDk3NWUtNSAqIENyIC0gMC4wMDAxMzI2ODkwNDM5NjE0NDYgKiBZICsgMC4wMDA1NjA4MzM2OTEyNDI4MTIgKiBrIC0gMC4xOTUxNTIwMjc1MzQwNDkpICsgWSAqICgwLjAwMTc0NDE4MTMyOTI3NTgyICogWSAtIDAuMDAyNTUyNDMzMjE0MzkzNDcgKiBrICsgMC4xMTY5MzUwMjA0NjUxNDUpICsgayAqICgtMC4wMDAzNDM1MzE5OTY1MTA1NTUgKiBrICsgMC4yNDE2NTI2MDIzMjQwNyk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGRhdGEuc3ViYXJyYXkoMCwgb2Zmc2V0KTsKICAgICAgICB9LAogICAgICAgIF9jb252ZXJ0WWNja1RvQ215azogZnVuY3Rpb24gY29udmVydFljY2tUb0NteWsoZGF0YSkgewogICAgICAgICAgdmFyIFksIENiLCBDcjsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gZGF0YS5sZW5ndGg7IGkgPCBsZW5ndGg7IGkgKz0gNCkgewogICAgICAgICAgICBZID0gZGF0YVtpXTsKICAgICAgICAgICAgQ2IgPSBkYXRhW2kgKyAxXTsKICAgICAgICAgICAgQ3IgPSBkYXRhW2kgKyAyXTsKICAgICAgICAgICAgZGF0YVtpXSA9IDQzNC40NTYgLSBZIC0gMS40MDIgKiBDcjsKICAgICAgICAgICAgZGF0YVtpICsgMV0gPSAxMTkuNTQxIC0gWSArIDAuMzQ0ICogQ2IgKyAwLjcxNCAqIENyOwogICAgICAgICAgICBkYXRhW2kgKyAyXSA9IDQ4MS44MTYgLSBZIC0gMS43NzIgKiBDYjsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gZGF0YTsKICAgICAgICB9LAogICAgICAgIF9jb252ZXJ0Q215a1RvUmdiOiBmdW5jdGlvbiBjb252ZXJ0Q215a1RvUmdiKGRhdGEpIHsKICAgICAgICAgIHZhciBjLCBtLCB5LCBrOwogICAgICAgICAgdmFyIG9mZnNldCA9IDA7CgogICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGRhdGEubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpICs9IDQpIHsKICAgICAgICAgICAgYyA9IGRhdGFbaV07CiAgICAgICAgICAgIG0gPSBkYXRhW2kgKyAxXTsKICAgICAgICAgICAgeSA9IGRhdGFbaSArIDJdOwogICAgICAgICAgICBrID0gZGF0YVtpICsgM107CiAgICAgICAgICAgIGRhdGFbb2Zmc2V0KytdID0gMjU1ICsgYyAqICgtMC4wMDAwNjc0NzE0NzA3MzYwMjQ0MSAqIGMgKyAwLjAwMDgzNzkyNjIxMjEwMTM3MjcgKiBtICsgMC4wMDAyODk0NzE4MTg4NjQzMjk0ICogeSArIDAuMDAzMjY0MjMxMDU3NTM3ODA2ICogayAtIDEuMTE4NTYxMTg2NzIwMzkzNykgKyBtICogKDAuMDAwMDI2Mzc0MTA3NjE2MDg5NDA1ICogbSAtIDAuMDAwMDg2MjY5NDkxNTg2Mzg1NzIgKiB5IC0gMC4wMDAyNzQ4NzY5MDY3NDk5NDkxICogayAtIDAuMDIxNTU2ODg3OTQ5Nzg5NjcpICsgeSAqICgtMC4wMDAwMzg3ODA5OTIxMjg2OTM2MyAqIHkgLSAwLjAwMDMyNjc4MDgyNzk0ODUyODYgKiBrICsgMC4wNjg2NzQyMjM4NTk1MzQ1KSAtIGsgKiAoMC4wMDAzMzYxOTcxNzc2MTgzOTM3ICogayArIDAuNzQzMDY1OTE1MTM0MjI1NCk7CiAgICAgICAgICAgIGRhdGFbb2Zmc2V0KytdID0gMjU1ICsgYyAqICgwLjAwMDEzNTk2MzcyODEzNTg4ODQ4ICogYyArIDAuMDAwOTI0NTM3MTMyNTczNTg1ICogbSArIDAuMDAwMTA1NjczNTk2MTg2ODM1OTMgKiB5ICsgMC4wMDA0NzkxODY0Njg3NDM2NTEyICogayAtIDAuMzEwOTY4OTU4NzUxNTg3NSkgKyBtICogKC0wLjAwMDIzNTQ1MzQ2MTA4MzcwMzQ0ICogbSArIDAuMDAwMjcwMjg0NTI1MzUzNDcxNCAqIHkgKyAwLjAwMjAyMDAzMDg5NzczMDcxNTYgKiBrIC0gMC43NDg4MDUyMTY3MDE1NDk0KSArIHkgKiAoMC4wMDAwNjgzNDgxNTk5ODIzNTY2MiAqIHkgKyAwLjAwMDE1MTY4NDUyMzYzNDYwOTczICogayAtIDAuMDk3NTE5Mjc3NzQ3Mjg5MzMpIC0gayAqICgwLjAwMDMxODkxMzExNzU4ODMyODE0ICogayArIDAuNzM2NDg4MzgwNzczMzE2OCk7CiAgICAgICAgICAgIGRhdGFbb2Zmc2V0KytdID0gMjU1ICsgYyAqICgwLjAwMDAxMzU5ODY1MDQxMTM4NTMwNyAqIGMgKyAwLjAwMDEyNDIzOTU2MTc1NDkwODUxICogbSArIDAuMDAwNDc1MTk4NTA5NzU4MzU4OSAqIHkgLSAwLjAwMDAwMzY3MjkzMTc0NzY2MzA0MjIgKiBrIC0gMC4wNTU2MjE4Njk4MDI2NDAzNCkgKyBtICogKDAuMDAwMTYxNDEzODA1OTg3MjQ2NzYgKiBtICsgMC4wMDA5NjkyMjM5MTMwNzI1MTg2ICogeSArIDAuMDAwNzc4MjY5MjQ1MDAzNjI1MyAqIGsgLSAwLjQ0MDE1MjMyMzY3NTI2NDYzKSArIHkgKiAoNS4wNjg4ODI5MTQwNjg3NjllLTcgKiB5ICsgMC4wMDE3Nzc4MzY5MDExMzc1MDcxICogayAtIDAuNzU5MTQ1NDY0OTc0OTYwOSkgLSBrICogKDAuMDAwMzQzNTMxOTk2NTEwNTU1MyAqIGsgKyAwLjcwNjM3NzAxODYxNjAxNDQpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBkYXRhLnN1YmFycmF5KDAsIG9mZnNldCk7CiAgICAgICAgfSwKICAgICAgICBnZXREYXRhOiBmdW5jdGlvbiBnZXREYXRhKF9yZWYzKSB7CiAgICAgICAgICB2YXIgd2lkdGggPSBfcmVmMy53aWR0aCwKICAgICAgICAgICAgaGVpZ2h0ID0gX3JlZjMuaGVpZ2h0LAogICAgICAgICAgICBfcmVmMyRmb3JjZVJHQiA9IF9yZWYzLmZvcmNlUkdCLAogICAgICAgICAgICBmb3JjZVJHQiA9IF9yZWYzJGZvcmNlUkdCID09PSB2b2lkIDAgPyBmYWxzZSA6IF9yZWYzJGZvcmNlUkdCLAogICAgICAgICAgICBfcmVmMyRpc1NvdXJjZVBERiA9IF9yZWYzLmlzU291cmNlUERGLAogICAgICAgICAgICBpc1NvdXJjZVBERiA9IF9yZWYzJGlzU291cmNlUERGID09PSB2b2lkIDAgPyBmYWxzZSA6IF9yZWYzJGlzU291cmNlUERGOwoKICAgICAgICAgIGlmICh0aGlzLm51bUNvbXBvbmVudHMgPiA0KSB7CiAgICAgICAgICAgIHRocm93IG5ldyBKcGVnRXJyb3IoIlVuc3VwcG9ydGVkIGNvbG9yIG1vZGUiKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZGF0YSA9IHRoaXMuX2dldExpbmVhcml6ZWRCbG9ja0RhdGEod2lkdGgsIGhlaWdodCwgaXNTb3VyY2VQREYpOwoKICAgICAgICAgIGlmICh0aGlzLm51bUNvbXBvbmVudHMgPT09IDEgJiYgZm9yY2VSR0IpIHsKICAgICAgICAgICAgdmFyIGRhdGFMZW5ndGggPSBkYXRhLmxlbmd0aDsKICAgICAgICAgICAgdmFyIHJnYkRhdGEgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkoZGF0YUxlbmd0aCAqIDMpOwogICAgICAgICAgICB2YXIgb2Zmc2V0ID0gMDsKCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YUxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgdmFyIGdyYXlDb2xvciA9IGRhdGFbaV07CiAgICAgICAgICAgICAgcmdiRGF0YVtvZmZzZXQrK10gPSBncmF5Q29sb3I7CiAgICAgICAgICAgICAgcmdiRGF0YVtvZmZzZXQrK10gPSBncmF5Q29sb3I7CiAgICAgICAgICAgICAgcmdiRGF0YVtvZmZzZXQrK10gPSBncmF5Q29sb3I7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiByZ2JEYXRhOwogICAgICAgICAgfSBlbHNlIGlmICh0aGlzLm51bUNvbXBvbmVudHMgPT09IDMgJiYgdGhpcy5faXNDb2xvckNvbnZlcnNpb25OZWVkZWQpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnZlcnRZY2NUb1JnYihkYXRhKTsKICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5udW1Db21wb25lbnRzID09PSA0KSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9pc0NvbG9yQ29udmVyc2lvbk5lZWRlZCkgewogICAgICAgICAgICAgIGlmIChmb3JjZVJHQikgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnZlcnRZY2NrVG9SZ2IoZGF0YSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY29udmVydFljY2tUb0NteWsoZGF0YSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZm9yY2VSR0IpIHsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY29udmVydENteWtUb1JnYihkYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBkYXRhOwogICAgICAgIH0KICAgICAgfTsKICAgICAgcmV0dXJuIEpwZWdJbWFnZTsKICAgIH0oKTsKCiAgICBleHBvcnRzLkpwZWdJbWFnZSA9IEpwZWdJbWFnZTsKCiAgICAvKioqL30pLCAoCiAgLyogMjA5ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgIHZhbHVlOiB0cnVlCiAgICB9KTsKICAgIGV4cG9ydHMuSnB4U3RyZWFtID0gdm9pZCAwOwoKICAgIHZhciBfc3RyZWFtID0gX193X3BkZmpzX3JlcXVpcmVfXygyMDEpOwoKICAgIHZhciBfanB4ID0gX193X3BkZmpzX3JlcXVpcmVfXygyMTApOwoKICAgIHZhciBfdXRpbCA9IF9fd19wZGZqc19yZXF1aXJlX18oNSk7CgogICAgdmFyIEpweFN0cmVhbSA9IGZ1bmN0aW9uIEpweFN0cmVhbUNsb3N1cmUoKSB7CiAgICAgIGZ1bmN0aW9uIEpweFN0cmVhbShzdHJlYW0sIG1heWJlTGVuZ3RoLCBkaWN0LCBwYXJhbXMpIHsKICAgICAgICB0aGlzLnN0cmVhbSA9IHN0cmVhbTsKICAgICAgICB0aGlzLm1heWJlTGVuZ3RoID0gbWF5YmVMZW5ndGg7CiAgICAgICAgdGhpcy5kaWN0ID0gZGljdDsKICAgICAgICB0aGlzLnBhcmFtcyA9IHBhcmFtczsKCiAgICAgICAgX3N0cmVhbS5EZWNvZGVTdHJlYW0uY2FsbCh0aGlzLCBtYXliZUxlbmd0aCk7CiAgICAgIH0KCiAgICAgIEpweFN0cmVhbS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKF9zdHJlYW0uRGVjb2RlU3RyZWFtLnByb3RvdHlwZSk7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShKcHhTdHJlYW0ucHJvdG90eXBlLCAiYnl0ZXMiLCB7CiAgICAgICAgZ2V0OiBmdW5jdGlvbiBKcHhTdHJlYW1fYnl0ZXMoKSB7CiAgICAgICAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgImJ5dGVzIiwgdGhpcy5zdHJlYW0uZ2V0Qnl0ZXModGhpcy5tYXliZUxlbmd0aCkpOwogICAgICAgIH0sCiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgIH0pOwoKICAgICAgSnB4U3RyZWFtLnByb3RvdHlwZS5lbnN1cmVCdWZmZXIgPSBmdW5jdGlvbiAocmVxdWVzdGVkKSB7fTsKCiAgICAgIEpweFN0cmVhbS5wcm90b3R5cGUucmVhZEJsb2NrID0gZnVuY3Rpb24gKCkgewogICAgICAgIGlmICh0aGlzLmVvZikgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIGpweEltYWdlID0gbmV3IF9qcHguSnB4SW1hZ2UoKTsKICAgICAgICBqcHhJbWFnZS5wYXJzZSh0aGlzLmJ5dGVzKTsKICAgICAgICB2YXIgd2lkdGggPSBqcHhJbWFnZS53aWR0aDsKICAgICAgICB2YXIgaGVpZ2h0ID0ganB4SW1hZ2UuaGVpZ2h0OwogICAgICAgIHZhciBjb21wb25lbnRzQ291bnQgPSBqcHhJbWFnZS5jb21wb25lbnRzQ291bnQ7CiAgICAgICAgdmFyIHRpbGVDb3VudCA9IGpweEltYWdlLnRpbGVzLmxlbmd0aDsKCiAgICAgICAgaWYgKHRpbGVDb3VudCA9PT0gMSkgewogICAgICAgICAgdGhpcy5idWZmZXIgPSBqcHhJbWFnZS50aWxlc1swXS5pdGVtczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIGRhdGEgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkod2lkdGggKiBoZWlnaHQgKiBjb21wb25lbnRzQ291bnQpOwoKICAgICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgdGlsZUNvdW50OyBrKyspIHsKICAgICAgICAgICAgdmFyIHRpbGVDb21wb25lbnRzID0ganB4SW1hZ2UudGlsZXNba107CiAgICAgICAgICAgIHZhciB0aWxlV2lkdGggPSB0aWxlQ29tcG9uZW50cy53aWR0aDsKICAgICAgICAgICAgdmFyIHRpbGVIZWlnaHQgPSB0aWxlQ29tcG9uZW50cy5oZWlnaHQ7CiAgICAgICAgICAgIHZhciB0aWxlTGVmdCA9IHRpbGVDb21wb25lbnRzLmxlZnQ7CiAgICAgICAgICAgIHZhciB0aWxlVG9wID0gdGlsZUNvbXBvbmVudHMudG9wOwogICAgICAgICAgICB2YXIgc3JjID0gdGlsZUNvbXBvbmVudHMuaXRlbXM7CiAgICAgICAgICAgIHZhciBzcmNQb3NpdGlvbiA9IDA7CiAgICAgICAgICAgIHZhciBkYXRhUG9zaXRpb24gPSAod2lkdGggKiB0aWxlVG9wICsgdGlsZUxlZnQpICogY29tcG9uZW50c0NvdW50OwogICAgICAgICAgICB2YXIgaW1nUm93U2l6ZSA9IHdpZHRoICogY29tcG9uZW50c0NvdW50OwogICAgICAgICAgICB2YXIgdGlsZVJvd1NpemUgPSB0aWxlV2lkdGggKiBjb21wb25lbnRzQ291bnQ7CgogICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHRpbGVIZWlnaHQ7IGorKykgewogICAgICAgICAgICAgIHZhciByb3dCeXRlcyA9IHNyYy5zdWJhcnJheShzcmNQb3NpdGlvbiwgc3JjUG9zaXRpb24gKyB0aWxlUm93U2l6ZSk7CiAgICAgICAgICAgICAgZGF0YS5zZXQocm93Qnl0ZXMsIGRhdGFQb3NpdGlvbik7CiAgICAgICAgICAgICAgc3JjUG9zaXRpb24gKz0gdGlsZVJvd1NpemU7CiAgICAgICAgICAgICAgZGF0YVBvc2l0aW9uICs9IGltZ1Jvd1NpemU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLmJ1ZmZlciA9IGRhdGE7CiAgICAgICAgfQoKICAgICAgICB0aGlzLmJ1ZmZlckxlbmd0aCA9IHRoaXMuYnVmZmVyLmxlbmd0aDsKICAgICAgICB0aGlzLmVvZiA9IHRydWU7CiAgICAgIH07CgogICAgICByZXR1cm4gSnB4U3RyZWFtOwogICAgfSgpOwoKICAgIGV4cG9ydHMuSnB4U3RyZWFtID0gSnB4U3RyZWFtOwoKICAgIC8qKiovfSksICgKICAvKiAyMTAgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgoKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgICAgdmFsdWU6IHRydWUKICAgIH0pOwogICAgZXhwb3J0cy5KcHhJbWFnZSA9IHZvaWQgMDsKCiAgICB2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUpOwoKICAgIHZhciBfY29yZV91dGlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTk3KTsKCiAgICB2YXIgX2FyaXRobWV0aWNfZGVjb2RlciA9IF9fd19wZGZqc19yZXF1aXJlX18oMjA2KTsKCiAgICBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyJAYmFiZWwvaGVscGVycyAtIHR5cGVvZiI7aWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIpIHtfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHtyZXR1cm4gdHlwZW9mIG9iajt9O30gZWxzZSB7X3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7cmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajt9O31yZXR1cm4gX3R5cGVvZihvYmopO30KCiAgICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7aWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTt9fQoKICAgIGZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHtpZiAoY2FsbCAmJiAoX3R5cGVvZihjYWxsKSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7cmV0dXJuIGNhbGw7fXJldHVybiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpO30KCiAgICBmdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHtpZiAoc2VsZiA9PT0gdm9pZCAwKSB7dGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTt9cmV0dXJuIHNlbGY7fQoKICAgIGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7X2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHtyZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pO307cmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTt9CgogICAgZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7aWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpO31zdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7aWYgKHN1cGVyQ2xhc3MpIF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7fQoKICAgIGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7X3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7by5fX3Byb3RvX18gPSBwO3JldHVybiBvO307cmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTt9CgogICAgdmFyIEpweEVycm9yID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQmFzZUV4Y2VwdGlvbikgewogICAgICBfaW5oZXJpdHMoSnB4RXJyb3IsIF9CYXNlRXhjZXB0aW9uKTsKCiAgICAgIGZ1bmN0aW9uIEpweEVycm9yKG1zZykgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBKcHhFcnJvcik7CgogICAgICAgIHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoSnB4RXJyb3IpLmNhbGwodGhpcywgIkpQWCBlcnJvcjogIi5jb25jYXQobXNnKSkpOwogICAgICB9CgogICAgICByZXR1cm4gSnB4RXJyb3I7CiAgICB9KF91dGlsLkJhc2VFeGNlcHRpb24pOwoKICAgIHZhciBKcHhJbWFnZSA9IGZ1bmN0aW9uIEpweEltYWdlQ2xvc3VyZSgpIHsKICAgICAgdmFyIFN1YmJhbmRzR2FpbkxvZzIgPSB7CiAgICAgICAgTEw6IDAsCiAgICAgICAgTEg6IDEsCiAgICAgICAgSEw6IDEsCiAgICAgICAgSEg6IDIKICAgICAgfTsKCiAgICAgIGZ1bmN0aW9uIEpweEltYWdlKCkgewogICAgICAgIHRoaXMuZmFpbE9uQ29ycnVwdGVkSW1hZ2UgPSBmYWxzZTsKICAgICAgfQoKICAgICAgSnB4SW1hZ2UucHJvdG90eXBlID0gewogICAgICAgIHBhcnNlOiBmdW5jdGlvbiBKcHhJbWFnZV9wYXJzZShkYXRhKSB7CiAgICAgICAgICB2YXIgaGVhZCA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDE2KShkYXRhLCAwKTsKCiAgICAgICAgICBpZiAoaGVhZCA9PT0gMHhmZjRmKSB7CiAgICAgICAgICAgIHRoaXMucGFyc2VDb2Rlc3RyZWFtKGRhdGEsIDAsIGRhdGEubGVuZ3RoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBwb3NpdGlvbiA9IDAsCiAgICAgICAgICAgIGxlbmd0aCA9IGRhdGEubGVuZ3RoOwoKICAgICAgICAgIHdoaWxlIChwb3NpdGlvbiA8IGxlbmd0aCkgewogICAgICAgICAgICB2YXIgaGVhZGVyU2l6ZSA9IDg7CiAgICAgICAgICAgIHZhciBsYm94ID0gKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MzIpKGRhdGEsIHBvc2l0aW9uKTsKICAgICAgICAgICAgdmFyIHRib3ggPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgcG9zaXRpb24gKyA0KTsKICAgICAgICAgICAgcG9zaXRpb24gKz0gaGVhZGVyU2l6ZTsKCiAgICAgICAgICAgIGlmIChsYm94ID09PSAxKSB7CiAgICAgICAgICAgICAgbGJveCA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDMyKShkYXRhLCBwb3NpdGlvbikgKiA0Mjk0OTY3Mjk2ICsgKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MzIpKGRhdGEsIHBvc2l0aW9uICsgNCk7CiAgICAgICAgICAgICAgcG9zaXRpb24gKz0gODsKICAgICAgICAgICAgICBoZWFkZXJTaXplICs9IDg7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChsYm94ID09PSAwKSB7CiAgICAgICAgICAgICAgbGJveCA9IGxlbmd0aCAtIHBvc2l0aW9uICsgaGVhZGVyU2l6ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGxib3ggPCBoZWFkZXJTaXplKSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEpweEVycm9yKCJJbnZhbGlkIGJveCBmaWVsZCBzaXplIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBkYXRhTGVuZ3RoID0gbGJveCAtIGhlYWRlclNpemU7CiAgICAgICAgICAgIHZhciBqdW1wRGF0YUxlbmd0aCA9IHRydWU7CgogICAgICAgICAgICBzd2l0Y2ggKHRib3gpIHsKICAgICAgICAgICAgICBjYXNlIDB4NmE3MDMyNjg6CiAgICAgICAgICAgICAgICBqdW1wRGF0YUxlbmd0aCA9IGZhbHNlOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMHg2MzZmNmM3MjoKICAgICAgICAgICAgICAgIHZhciBtZXRob2QgPSBkYXRhW3Bvc2l0aW9uXTsKCiAgICAgICAgICAgICAgICBpZiAobWV0aG9kID09PSAxKSB7CiAgICAgICAgICAgICAgICAgIHZhciBjb2xvcnNwYWNlID0gKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MzIpKGRhdGEsIHBvc2l0aW9uICsgMyk7CgogICAgICAgICAgICAgICAgICBzd2l0Y2ggKGNvbG9yc3BhY2UpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgICAgICAgIGNhc2UgMTc6CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJVbmtub3duIGNvbG9yc3BhY2UgIiArIGNvbG9yc3BhY2UpOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWV0aG9kID09PSAyKSB7CiAgICAgICAgICAgICAgICAgICgwLCBfdXRpbC5pbmZvKSgiSUNDIHByb2ZpbGUgbm90IHN1cHBvcnRlZCIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDB4NmE3MDMyNjM6CiAgICAgICAgICAgICAgICB0aGlzLnBhcnNlQ29kZXN0cmVhbShkYXRhLCBwb3NpdGlvbiwgcG9zaXRpb24gKyBkYXRhTGVuZ3RoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDB4NmE1MDIwMjA6CiAgICAgICAgICAgICAgICBpZiAoKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MzIpKGRhdGEsIHBvc2l0aW9uKSAhPT0gMHgwZDBhODcwYSkgewogICAgICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIkludmFsaWQgSlAyIHNpZ25hdHVyZSIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDB4NmE1MDFhMWE6CiAgICAgICAgICAgICAgY2FzZSAweDY2NzQ3OTcwOgogICAgICAgICAgICAgIGNhc2UgMHg3MjcyNjU3MToKICAgICAgICAgICAgICBjYXNlIDB4NzI2NTczMjA6CiAgICAgICAgICAgICAgY2FzZSAweDY5Njg2NDcyOgogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB2YXIgaGVhZGVyVHlwZSA9IFN0cmluZy5mcm9tQ2hhckNvZGUodGJveCA+PiAyNCAmIDB4ZmYsIHRib3ggPj4gMTYgJiAweGZmLCB0Ym94ID4+IDggJiAweGZmLCB0Ym94ICYgMHhmZik7CiAgICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIlVuc3VwcG9ydGVkIGhlYWRlciB0eXBlICIgKyB0Ym94ICsgIiAoIiArIGhlYWRlclR5cGUgKyAiKSIpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChqdW1wRGF0YUxlbmd0aCkgewogICAgICAgICAgICAgIHBvc2l0aW9uICs9IGRhdGFMZW5ndGg7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHBhcnNlSW1hZ2VQcm9wZXJ0aWVzOiBmdW5jdGlvbiBKcHhJbWFnZV9wYXJzZUltYWdlUHJvcGVydGllcyhzdHJlYW0pIHsKICAgICAgICAgIHZhciBuZXdCeXRlID0gc3RyZWFtLmdldEJ5dGUoKTsKCiAgICAgICAgICB3aGlsZSAobmV3Qnl0ZSA+PSAwKSB7CiAgICAgICAgICAgIHZhciBvbGRCeXRlID0gbmV3Qnl0ZTsKICAgICAgICAgICAgbmV3Qnl0ZSA9IHN0cmVhbS5nZXRCeXRlKCk7CiAgICAgICAgICAgIHZhciBjb2RlID0gb2xkQnl0ZSA8PCA4IHwgbmV3Qnl0ZTsKCiAgICAgICAgICAgIGlmIChjb2RlID09PSAweGZmNTEpIHsKICAgICAgICAgICAgICBzdHJlYW0uc2tpcCg0KTsKICAgICAgICAgICAgICB2YXIgWHNpeiA9IHN0cmVhbS5nZXRJbnQzMigpID4+PiAwOwogICAgICAgICAgICAgIHZhciBZc2l6ID0gc3RyZWFtLmdldEludDMyKCkgPj4+IDA7CiAgICAgICAgICAgICAgdmFyIFhPc2l6ID0gc3RyZWFtLmdldEludDMyKCkgPj4+IDA7CiAgICAgICAgICAgICAgdmFyIFlPc2l6ID0gc3RyZWFtLmdldEludDMyKCkgPj4+IDA7CiAgICAgICAgICAgICAgc3RyZWFtLnNraXAoMTYpOwogICAgICAgICAgICAgIHZhciBDc2l6ID0gc3RyZWFtLmdldFVpbnQxNigpOwogICAgICAgICAgICAgIHRoaXMud2lkdGggPSBYc2l6IC0gWE9zaXo7CiAgICAgICAgICAgICAgdGhpcy5oZWlnaHQgPSBZc2l6IC0gWU9zaXo7CiAgICAgICAgICAgICAgdGhpcy5jb21wb25lbnRzQ291bnQgPSBDc2l6OwogICAgICAgICAgICAgIHRoaXMuYml0c1BlckNvbXBvbmVudCA9IDg7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgdGhyb3cgbmV3IEpweEVycm9yKCJObyBzaXplIG1hcmtlciBmb3VuZCBpbiBKUFggc3RyZWFtIik7CiAgICAgICAgfSwKICAgICAgICBwYXJzZUNvZGVzdHJlYW06IGZ1bmN0aW9uIEpweEltYWdlX3BhcnNlQ29kZXN0cmVhbShkYXRhLCBzdGFydCwgZW5kKSB7CiAgICAgICAgICB2YXIgY29udGV4dCA9IHt9OwogICAgICAgICAgdmFyIGRvTm90UmVjb3ZlciA9IGZhbHNlOwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHZhciBwb3NpdGlvbiA9IHN0YXJ0OwoKICAgICAgICAgICAgd2hpbGUgKHBvc2l0aW9uICsgMSA8IGVuZCkgewogICAgICAgICAgICAgIHZhciBjb2RlID0gKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MTYpKGRhdGEsIHBvc2l0aW9uKTsKICAgICAgICAgICAgICBwb3NpdGlvbiArPSAyOwogICAgICAgICAgICAgIHZhciBsZW5ndGggPSAwLAogICAgICAgICAgICAgICAgaiwKICAgICAgICAgICAgICAgIHNxY2QsCiAgICAgICAgICAgICAgICBzcHFjZHMsCiAgICAgICAgICAgICAgICBzcHFjZFNpemUsCiAgICAgICAgICAgICAgICBzY2FsYXJFeHBvdW5kZWQsCiAgICAgICAgICAgICAgICB0aWxlOwoKICAgICAgICAgICAgICBzd2l0Y2ggKGNvZGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgMHhmZjRmOgogICAgICAgICAgICAgICAgICBjb250ZXh0Lm1haW5IZWFkZXIgPSB0cnVlOwogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlIDB4ZmZkOToKICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSAweGZmNTE6CiAgICAgICAgICAgICAgICAgIGxlbmd0aCA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDE2KShkYXRhLCBwb3NpdGlvbik7CiAgICAgICAgICAgICAgICAgIHZhciBzaXogPSB7fTsKICAgICAgICAgICAgICAgICAgc2l6LlhzaXogPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgcG9zaXRpb24gKyA0KTsKICAgICAgICAgICAgICAgICAgc2l6LllzaXogPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgcG9zaXRpb24gKyA4KTsKICAgICAgICAgICAgICAgICAgc2l6LlhPc2l6ID0gKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MzIpKGRhdGEsIHBvc2l0aW9uICsgMTIpOwogICAgICAgICAgICAgICAgICBzaXouWU9zaXogPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgcG9zaXRpb24gKyAxNik7CiAgICAgICAgICAgICAgICAgIHNpei5YVHNpeiA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDMyKShkYXRhLCBwb3NpdGlvbiArIDIwKTsKICAgICAgICAgICAgICAgICAgc2l6LllUc2l6ID0gKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MzIpKGRhdGEsIHBvc2l0aW9uICsgMjQpOwogICAgICAgICAgICAgICAgICBzaXouWFRPc2l6ID0gKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MzIpKGRhdGEsIHBvc2l0aW9uICsgMjgpOwogICAgICAgICAgICAgICAgICBzaXouWVRPc2l6ID0gKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MzIpKGRhdGEsIHBvc2l0aW9uICsgMzIpOwogICAgICAgICAgICAgICAgICB2YXIgY29tcG9uZW50c0NvdW50ID0gKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MTYpKGRhdGEsIHBvc2l0aW9uICsgMzYpOwogICAgICAgICAgICAgICAgICBzaXouQ3NpeiA9IGNvbXBvbmVudHNDb3VudDsKICAgICAgICAgICAgICAgICAgdmFyIGNvbXBvbmVudHMgPSBbXTsKICAgICAgICAgICAgICAgICAgaiA9IHBvc2l0aW9uICsgMzg7CgogICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvbXBvbmVudHNDb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbXBvbmVudCA9IHsKICAgICAgICAgICAgICAgICAgICAgIHByZWNpc2lvbjogKGRhdGFbal0gJiAweDdmKSArIDEsCiAgICAgICAgICAgICAgICAgICAgICBpc1NpZ25lZDogISEoZGF0YVtqXSAmIDB4ODApLAogICAgICAgICAgICAgICAgICAgICAgWFJzaXo6IGRhdGFbaiArIDFdLAogICAgICAgICAgICAgICAgICAgICAgWVJzaXo6IGRhdGFbaiArIDJdCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBqICs9IDM7CiAgICAgICAgICAgICAgICAgICAgY2FsY3VsYXRlQ29tcG9uZW50RGltZW5zaW9ucyhjb21wb25lbnQsIHNpeik7CiAgICAgICAgICAgICAgICAgICAgY29tcG9uZW50cy5wdXNoKGNvbXBvbmVudCk7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGNvbnRleHQuU0laID0gc2l6OwogICAgICAgICAgICAgICAgICBjb250ZXh0LmNvbXBvbmVudHMgPSBjb21wb25lbnRzOwogICAgICAgICAgICAgICAgICBjYWxjdWxhdGVUaWxlR3JpZHMoY29udGV4dCwgY29tcG9uZW50cyk7CiAgICAgICAgICAgICAgICAgIGNvbnRleHQuUUNDID0gW107CiAgICAgICAgICAgICAgICAgIGNvbnRleHQuQ09DID0gW107CiAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIGNhc2UgMHhmZjVjOgogICAgICAgICAgICAgICAgICBsZW5ndGggPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQxNikoZGF0YSwgcG9zaXRpb24pOwogICAgICAgICAgICAgICAgICB2YXIgcWNkID0ge307CiAgICAgICAgICAgICAgICAgIGogPSBwb3NpdGlvbiArIDI7CiAgICAgICAgICAgICAgICAgIHNxY2QgPSBkYXRhW2orK107CgogICAgICAgICAgICAgICAgICBzd2l0Y2ggKHNxY2QgJiAweDFmKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgc3BxY2RTaXplID0gODsKICAgICAgICAgICAgICAgICAgICAgIHNjYWxhckV4cG91bmRlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgc3BxY2RTaXplID0gMTY7CiAgICAgICAgICAgICAgICAgICAgICBzY2FsYXJFeHBvdW5kZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgICBzcHFjZFNpemUgPSAxNjsKICAgICAgICAgICAgICAgICAgICAgIHNjYWxhckV4cG91bmRlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBTUWNkIHZhbHVlICIgKyBzcWNkKTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgcWNkLm5vUXVhbnRpemF0aW9uID0gc3BxY2RTaXplID09PSA4OwogICAgICAgICAgICAgICAgICBxY2Quc2NhbGFyRXhwb3VuZGVkID0gc2NhbGFyRXhwb3VuZGVkOwogICAgICAgICAgICAgICAgICBxY2QuZ3VhcmRCaXRzID0gc3FjZCA+PiA1OwogICAgICAgICAgICAgICAgICBzcHFjZHMgPSBbXTsKCiAgICAgICAgICAgICAgICAgIHdoaWxlIChqIDwgbGVuZ3RoICsgcG9zaXRpb24pIHsKICAgICAgICAgICAgICAgICAgICB2YXIgc3BxY2QgPSB7fTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHNwcWNkU2l6ZSA9PT0gOCkgewogICAgICAgICAgICAgICAgICAgICAgc3BxY2QuZXBzaWxvbiA9IGRhdGFbaisrXSA+PiAzOwogICAgICAgICAgICAgICAgICAgICAgc3BxY2QubXUgPSAwOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICBzcHFjZC5lcHNpbG9uID0gZGF0YVtqXSA+PiAzOwogICAgICAgICAgICAgICAgICAgICAgc3BxY2QubXUgPSAoZGF0YVtqXSAmIDB4NykgPDwgOCB8IGRhdGFbaiArIDFdOwogICAgICAgICAgICAgICAgICAgICAgaiArPSAyOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgc3BxY2RzLnB1c2goc3BxY2QpOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBxY2QuU1BxY2RzID0gc3BxY2RzOwoKICAgICAgICAgICAgICAgICAgaWYgKGNvbnRleHQubWFpbkhlYWRlcikgewogICAgICAgICAgICAgICAgICAgIGNvbnRleHQuUUNEID0gcWNkOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnRleHQuY3VycmVudFRpbGUuUUNEID0gcWNkOwogICAgICAgICAgICAgICAgICAgIGNvbnRleHQuY3VycmVudFRpbGUuUUNDID0gW107CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIGNhc2UgMHhmZjVkOgogICAgICAgICAgICAgICAgICBsZW5ndGggPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQxNikoZGF0YSwgcG9zaXRpb24pOwogICAgICAgICAgICAgICAgICB2YXIgcWNjID0ge307CiAgICAgICAgICAgICAgICAgIGogPSBwb3NpdGlvbiArIDI7CiAgICAgICAgICAgICAgICAgIHZhciBjcWNjOwoKICAgICAgICAgICAgICAgICAgaWYgKGNvbnRleHQuU0laLkNzaXogPCAyNTcpIHsKICAgICAgICAgICAgICAgICAgICBjcWNjID0gZGF0YVtqKytdOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNxY2MgPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQxNikoZGF0YSwgaik7CiAgICAgICAgICAgICAgICAgICAgaiArPSAyOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBzcWNkID0gZGF0YVtqKytdOwoKICAgICAgICAgICAgICAgICAgc3dpdGNoIChzcWNkICYgMHgxZikgewogICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgIHNwcWNkU2l6ZSA9IDg7CiAgICAgICAgICAgICAgICAgICAgICBzY2FsYXJFeHBvdW5kZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgICAgIHNwcWNkU2l6ZSA9IDE2OwogICAgICAgICAgICAgICAgICAgICAgc2NhbGFyRXhwb3VuZGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgICAgc3BxY2RTaXplID0gMTY7CiAgICAgICAgICAgICAgICAgICAgICBzY2FsYXJFeHBvdW5kZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgU1FjZCB2YWx1ZSAiICsgc3FjZCk7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIHFjYy5ub1F1YW50aXphdGlvbiA9IHNwcWNkU2l6ZSA9PT0gODsKICAgICAgICAgICAgICAgICAgcWNjLnNjYWxhckV4cG91bmRlZCA9IHNjYWxhckV4cG91bmRlZDsKICAgICAgICAgICAgICAgICAgcWNjLmd1YXJkQml0cyA9IHNxY2QgPj4gNTsKICAgICAgICAgICAgICAgICAgc3BxY2RzID0gW107CgogICAgICAgICAgICAgICAgICB3aGlsZSAoaiA8IGxlbmd0aCArIHBvc2l0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgc3BxY2QgPSB7fTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHNwcWNkU2l6ZSA9PT0gOCkgewogICAgICAgICAgICAgICAgICAgICAgc3BxY2QuZXBzaWxvbiA9IGRhdGFbaisrXSA+PiAzOwogICAgICAgICAgICAgICAgICAgICAgc3BxY2QubXUgPSAwOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICBzcHFjZC5lcHNpbG9uID0gZGF0YVtqXSA+PiAzOwogICAgICAgICAgICAgICAgICAgICAgc3BxY2QubXUgPSAoZGF0YVtqXSAmIDB4NykgPDwgOCB8IGRhdGFbaiArIDFdOwogICAgICAgICAgICAgICAgICAgICAgaiArPSAyOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgc3BxY2RzLnB1c2goc3BxY2QpOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBxY2MuU1BxY2RzID0gc3BxY2RzOwoKICAgICAgICAgICAgICAgICAgaWYgKGNvbnRleHQubWFpbkhlYWRlcikgewogICAgICAgICAgICAgICAgICAgIGNvbnRleHQuUUNDW2NxY2NdID0gcWNjOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnRleHQuY3VycmVudFRpbGUuUUNDW2NxY2NdID0gcWNjOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlIDB4ZmY1MjoKICAgICAgICAgICAgICAgICAgbGVuZ3RoID0gKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MTYpKGRhdGEsIHBvc2l0aW9uKTsKICAgICAgICAgICAgICAgICAgdmFyIGNvZCA9IHt9OwogICAgICAgICAgICAgICAgICBqID0gcG9zaXRpb24gKyAyOwogICAgICAgICAgICAgICAgICB2YXIgc2NvZCA9IGRhdGFbaisrXTsKICAgICAgICAgICAgICAgICAgY29kLmVudHJvcHlDb2RlcldpdGhDdXN0b21QcmVjaW5jdHMgPSAhIShzY29kICYgMSk7CiAgICAgICAgICAgICAgICAgIGNvZC5zb3BNYXJrZXJVc2VkID0gISEoc2NvZCAmIDIpOwogICAgICAgICAgICAgICAgICBjb2QuZXBoTWFya2VyVXNlZCA9ICEhKHNjb2QgJiA0KTsKICAgICAgICAgICAgICAgICAgY29kLnByb2dyZXNzaW9uT3JkZXIgPSBkYXRhW2orK107CiAgICAgICAgICAgICAgICAgIGNvZC5sYXllcnNDb3VudCA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDE2KShkYXRhLCBqKTsKICAgICAgICAgICAgICAgICAgaiArPSAyOwogICAgICAgICAgICAgICAgICBjb2QubXVsdGlwbGVDb21wb25lbnRUcmFuc2Zvcm0gPSBkYXRhW2orK107CiAgICAgICAgICAgICAgICAgIGNvZC5kZWNvbXBvc2l0aW9uTGV2ZWxzQ291bnQgPSBkYXRhW2orK107CiAgICAgICAgICAgICAgICAgIGNvZC54Y2IgPSAoZGF0YVtqKytdICYgMHhmKSArIDI7CiAgICAgICAgICAgICAgICAgIGNvZC55Y2IgPSAoZGF0YVtqKytdICYgMHhmKSArIDI7CiAgICAgICAgICAgICAgICAgIHZhciBibG9ja1N0eWxlID0gZGF0YVtqKytdOwogICAgICAgICAgICAgICAgICBjb2Quc2VsZWN0aXZlQXJpdGhtZXRpY0NvZGluZ0J5cGFzcyA9ICEhKGJsb2NrU3R5bGUgJiAxKTsKICAgICAgICAgICAgICAgICAgY29kLnJlc2V0Q29udGV4dFByb2JhYmlsaXRpZXMgPSAhIShibG9ja1N0eWxlICYgMik7CiAgICAgICAgICAgICAgICAgIGNvZC50ZXJtaW5hdGlvbk9uRWFjaENvZGluZ1Bhc3MgPSAhIShibG9ja1N0eWxlICYgNCk7CiAgICAgICAgICAgICAgICAgIGNvZC52ZXJ0aWNhbGx5U3RyaXBlID0gISEoYmxvY2tTdHlsZSAmIDgpOwogICAgICAgICAgICAgICAgICBjb2QucHJlZGljdGFibGVUZXJtaW5hdGlvbiA9ICEhKGJsb2NrU3R5bGUgJiAxNik7CiAgICAgICAgICAgICAgICAgIGNvZC5zZWdtZW50YXRpb25TeW1ib2xVc2VkID0gISEoYmxvY2tTdHlsZSAmIDMyKTsKICAgICAgICAgICAgICAgICAgY29kLnJldmVyc2libGVUcmFuc2Zvcm1hdGlvbiA9IGRhdGFbaisrXTsKCiAgICAgICAgICAgICAgICAgIGlmIChjb2QuZW50cm9weUNvZGVyV2l0aEN1c3RvbVByZWNpbmN0cykgewogICAgICAgICAgICAgICAgICAgIHZhciBwcmVjaW5jdHNTaXplcyA9IFtdOwoKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoaiA8IGxlbmd0aCArIHBvc2l0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJlY2luY3RzU2l6ZSA9IGRhdGFbaisrXTsKICAgICAgICAgICAgICAgICAgICAgIHByZWNpbmN0c1NpemVzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICBQUHg6IHByZWNpbmN0c1NpemUgJiAweGYsCiAgICAgICAgICAgICAgICAgICAgICAgIFBQeTogcHJlY2luY3RzU2l6ZSA+PiA0CiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGNvZC5wcmVjaW5jdHNTaXplcyA9IHByZWNpbmN0c1NpemVzOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB2YXIgdW5zdXBwb3J0ZWQgPSBbXTsKCiAgICAgICAgICAgICAgICAgIGlmIChjb2Quc2VsZWN0aXZlQXJpdGhtZXRpY0NvZGluZ0J5cGFzcykgewogICAgICAgICAgICAgICAgICAgIHVuc3VwcG9ydGVkLnB1c2goInNlbGVjdGl2ZUFyaXRobWV0aWNDb2RpbmdCeXBhc3MiKTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgaWYgKGNvZC5yZXNldENvbnRleHRQcm9iYWJpbGl0aWVzKSB7CiAgICAgICAgICAgICAgICAgICAgdW5zdXBwb3J0ZWQucHVzaCgicmVzZXRDb250ZXh0UHJvYmFiaWxpdGllcyIpOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBpZiAoY29kLnRlcm1pbmF0aW9uT25FYWNoQ29kaW5nUGFzcykgewogICAgICAgICAgICAgICAgICAgIHVuc3VwcG9ydGVkLnB1c2goInRlcm1pbmF0aW9uT25FYWNoQ29kaW5nUGFzcyIpOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBpZiAoY29kLnZlcnRpY2FsbHlTdHJpcGUpIHsKICAgICAgICAgICAgICAgICAgICB1bnN1cHBvcnRlZC5wdXNoKCJ2ZXJ0aWNhbGx5U3RyaXBlIik7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGlmIChjb2QucHJlZGljdGFibGVUZXJtaW5hdGlvbikgewogICAgICAgICAgICAgICAgICAgIHVuc3VwcG9ydGVkLnB1c2goInByZWRpY3RhYmxlVGVybWluYXRpb24iKTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgaWYgKHVuc3VwcG9ydGVkLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBkb05vdFJlY292ZXIgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5zdXBwb3J0ZWQgQ09EIG9wdGlvbnMgKCIgKyB1bnN1cHBvcnRlZC5qb2luKCIsICIpICsgIikiKTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgaWYgKGNvbnRleHQubWFpbkhlYWRlcikgewogICAgICAgICAgICAgICAgICAgIGNvbnRleHQuQ09EID0gY29kOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnRleHQuY3VycmVudFRpbGUuQ09EID0gY29kOwogICAgICAgICAgICAgICAgICAgIGNvbnRleHQuY3VycmVudFRpbGUuQ09DID0gW107CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIGNhc2UgMHhmZjkwOgogICAgICAgICAgICAgICAgICBsZW5ndGggPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQxNikoZGF0YSwgcG9zaXRpb24pOwogICAgICAgICAgICAgICAgICB0aWxlID0ge307CiAgICAgICAgICAgICAgICAgIHRpbGUuaW5kZXggPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQxNikoZGF0YSwgcG9zaXRpb24gKyAyKTsKICAgICAgICAgICAgICAgICAgdGlsZS5sZW5ndGggPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgcG9zaXRpb24gKyA0KTsKICAgICAgICAgICAgICAgICAgdGlsZS5kYXRhRW5kID0gdGlsZS5sZW5ndGggKyBwb3NpdGlvbiAtIDI7CiAgICAgICAgICAgICAgICAgIHRpbGUucGFydEluZGV4ID0gZGF0YVtwb3NpdGlvbiArIDhdOwogICAgICAgICAgICAgICAgICB0aWxlLnBhcnRzQ291bnQgPSBkYXRhW3Bvc2l0aW9uICsgOV07CiAgICAgICAgICAgICAgICAgIGNvbnRleHQubWFpbkhlYWRlciA9IGZhbHNlOwoKICAgICAgICAgICAgICAgICAgaWYgKHRpbGUucGFydEluZGV4ID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGlsZS5DT0QgPSBjb250ZXh0LkNPRDsKICAgICAgICAgICAgICAgICAgICB0aWxlLkNPQyA9IGNvbnRleHQuQ09DLnNsaWNlKDApOwogICAgICAgICAgICAgICAgICAgIHRpbGUuUUNEID0gY29udGV4dC5RQ0Q7CiAgICAgICAgICAgICAgICAgICAgdGlsZS5RQ0MgPSBjb250ZXh0LlFDQy5zbGljZSgwKTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgY29udGV4dC5jdXJyZW50VGlsZSA9IHRpbGU7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIGNhc2UgMHhmZjkzOgogICAgICAgICAgICAgICAgICB0aWxlID0gY29udGV4dC5jdXJyZW50VGlsZTsKCiAgICAgICAgICAgICAgICAgIGlmICh0aWxlLnBhcnRJbmRleCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIGluaXRpYWxpemVUaWxlKGNvbnRleHQsIHRpbGUuaW5kZXgpOwogICAgICAgICAgICAgICAgICAgIGJ1aWxkUGFja2V0cyhjb250ZXh0KTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgbGVuZ3RoID0gdGlsZS5kYXRhRW5kIC0gcG9zaXRpb247CiAgICAgICAgICAgICAgICAgIHBhcnNlVGlsZVBhY2tldHMoY29udGV4dCwgZGF0YSwgcG9zaXRpb24sIGxlbmd0aCk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIGNhc2UgMHhmZjU1OgogICAgICAgICAgICAgICAgY2FzZSAweGZmNTc6CiAgICAgICAgICAgICAgICBjYXNlIDB4ZmY1ODoKICAgICAgICAgICAgICAgIGNhc2UgMHhmZjY0OgogICAgICAgICAgICAgICAgICBsZW5ndGggPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQxNikoZGF0YSwgcG9zaXRpb24pOwogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlIDB4ZmY1MzoKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJDb2Rlc3RyZWFtIGNvZGUgMHhGRjUzIChDT0MpIGlzIG5vdCBpbXBsZW1lbnRlZCIpOwoKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5rbm93biBjb2Rlc3RyZWFtIGNvZGU6ICIgKyBjb2RlLnRvU3RyaW5nKDE2KSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBwb3NpdGlvbiArPSBsZW5ndGg7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgaWYgKGRvTm90UmVjb3ZlciB8fCB0aGlzLmZhaWxPbkNvcnJ1cHRlZEltYWdlKSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEpweEVycm9yKGUubWVzc2FnZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJKUFg6IFRyeWluZyB0byByZWNvdmVyIGZyb206ICIgKyBlLm1lc3NhZ2UpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy50aWxlcyA9IHRyYW5zZm9ybUNvbXBvbmVudHMoY29udGV4dCk7CiAgICAgICAgICB0aGlzLndpZHRoID0gY29udGV4dC5TSVouWHNpeiAtIGNvbnRleHQuU0laLlhPc2l6OwogICAgICAgICAgdGhpcy5oZWlnaHQgPSBjb250ZXh0LlNJWi5Zc2l6IC0gY29udGV4dC5TSVouWU9zaXo7CiAgICAgICAgICB0aGlzLmNvbXBvbmVudHNDb3VudCA9IGNvbnRleHQuU0laLkNzaXo7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgZnVuY3Rpb24gY2FsY3VsYXRlQ29tcG9uZW50RGltZW5zaW9ucyhjb21wb25lbnQsIHNpeikgewogICAgICAgIGNvbXBvbmVudC54MCA9IE1hdGguY2VpbChzaXouWE9zaXogLyBjb21wb25lbnQuWFJzaXopOwogICAgICAgIGNvbXBvbmVudC54MSA9IE1hdGguY2VpbChzaXouWHNpeiAvIGNvbXBvbmVudC5YUnNpeik7CiAgICAgICAgY29tcG9uZW50LnkwID0gTWF0aC5jZWlsKHNpei5ZT3NpeiAvIGNvbXBvbmVudC5ZUnNpeik7CiAgICAgICAgY29tcG9uZW50LnkxID0gTWF0aC5jZWlsKHNpei5Zc2l6IC8gY29tcG9uZW50LllSc2l6KTsKICAgICAgICBjb21wb25lbnQud2lkdGggPSBjb21wb25lbnQueDEgLSBjb21wb25lbnQueDA7CiAgICAgICAgY29tcG9uZW50LmhlaWdodCA9IGNvbXBvbmVudC55MSAtIGNvbXBvbmVudC55MDsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gY2FsY3VsYXRlVGlsZUdyaWRzKGNvbnRleHQsIGNvbXBvbmVudHMpIHsKICAgICAgICB2YXIgc2l6ID0gY29udGV4dC5TSVo7CiAgICAgICAgdmFyIHRpbGUsCiAgICAgICAgICB0aWxlcyA9IFtdOwogICAgICAgIHZhciBudW1YdGlsZXMgPSBNYXRoLmNlaWwoKHNpei5Yc2l6IC0gc2l6LlhUT3NpeikgLyBzaXouWFRzaXopOwogICAgICAgIHZhciBudW1ZdGlsZXMgPSBNYXRoLmNlaWwoKHNpei5Zc2l6IC0gc2l6LllUT3NpeikgLyBzaXouWVRzaXopOwoKICAgICAgICBmb3IgKHZhciBxID0gMDsgcSA8IG51bVl0aWxlczsgcSsrKSB7CiAgICAgICAgICBmb3IgKHZhciBwID0gMDsgcCA8IG51bVh0aWxlczsgcCsrKSB7CiAgICAgICAgICAgIHRpbGUgPSB7fTsKICAgICAgICAgICAgdGlsZS50eDAgPSBNYXRoLm1heChzaXouWFRPc2l6ICsgcCAqIHNpei5YVHNpeiwgc2l6LlhPc2l6KTsKICAgICAgICAgICAgdGlsZS50eTAgPSBNYXRoLm1heChzaXouWVRPc2l6ICsgcSAqIHNpei5ZVHNpeiwgc2l6LllPc2l6KTsKICAgICAgICAgICAgdGlsZS50eDEgPSBNYXRoLm1pbihzaXouWFRPc2l6ICsgKHAgKyAxKSAqIHNpei5YVHNpeiwgc2l6LlhzaXopOwogICAgICAgICAgICB0aWxlLnR5MSA9IE1hdGgubWluKHNpei5ZVE9zaXogKyAocSArIDEpICogc2l6LllUc2l6LCBzaXouWXNpeik7CiAgICAgICAgICAgIHRpbGUud2lkdGggPSB0aWxlLnR4MSAtIHRpbGUudHgwOwogICAgICAgICAgICB0aWxlLmhlaWdodCA9IHRpbGUudHkxIC0gdGlsZS50eTA7CiAgICAgICAgICAgIHRpbGUuY29tcG9uZW50cyA9IFtdOwogICAgICAgICAgICB0aWxlcy5wdXNoKHRpbGUpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgY29udGV4dC50aWxlcyA9IHRpbGVzOwogICAgICAgIHZhciBjb21wb25lbnRzQ291bnQgPSBzaXouQ3NpejsKCiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gY29tcG9uZW50c0NvdW50OyBpIDwgaWk7IGkrKykgewogICAgICAgICAgdmFyIGNvbXBvbmVudCA9IGNvbXBvbmVudHNbaV07CgogICAgICAgICAgZm9yICh2YXIgaiA9IDAsIGpqID0gdGlsZXMubGVuZ3RoOyBqIDwgamo7IGorKykgewogICAgICAgICAgICB2YXIgdGlsZUNvbXBvbmVudCA9IHt9OwogICAgICAgICAgICB0aWxlID0gdGlsZXNbal07CiAgICAgICAgICAgIHRpbGVDb21wb25lbnQudGN4MCA9IE1hdGguY2VpbCh0aWxlLnR4MCAvIGNvbXBvbmVudC5YUnNpeik7CiAgICAgICAgICAgIHRpbGVDb21wb25lbnQudGN5MCA9IE1hdGguY2VpbCh0aWxlLnR5MCAvIGNvbXBvbmVudC5ZUnNpeik7CiAgICAgICAgICAgIHRpbGVDb21wb25lbnQudGN4MSA9IE1hdGguY2VpbCh0aWxlLnR4MSAvIGNvbXBvbmVudC5YUnNpeik7CiAgICAgICAgICAgIHRpbGVDb21wb25lbnQudGN5MSA9IE1hdGguY2VpbCh0aWxlLnR5MSAvIGNvbXBvbmVudC5ZUnNpeik7CiAgICAgICAgICAgIHRpbGVDb21wb25lbnQud2lkdGggPSB0aWxlQ29tcG9uZW50LnRjeDEgLSB0aWxlQ29tcG9uZW50LnRjeDA7CiAgICAgICAgICAgIHRpbGVDb21wb25lbnQuaGVpZ2h0ID0gdGlsZUNvbXBvbmVudC50Y3kxIC0gdGlsZUNvbXBvbmVudC50Y3kwOwogICAgICAgICAgICB0aWxlLmNvbXBvbmVudHNbaV0gPSB0aWxlQ29tcG9uZW50OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgZnVuY3Rpb24gZ2V0QmxvY2tzRGltZW5zaW9ucyhjb250ZXh0LCBjb21wb25lbnQsIHIpIHsKICAgICAgICB2YXIgY29kT3JDb2MgPSBjb21wb25lbnQuY29kaW5nU3R5bGVQYXJhbWV0ZXJzOwogICAgICAgIHZhciByZXN1bHQgPSB7fTsKCiAgICAgICAgaWYgKCFjb2RPckNvYy5lbnRyb3B5Q29kZXJXaXRoQ3VzdG9tUHJlY2luY3RzKSB7CiAgICAgICAgICByZXN1bHQuUFB4ID0gMTU7CiAgICAgICAgICByZXN1bHQuUFB5ID0gMTU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJlc3VsdC5QUHggPSBjb2RPckNvYy5wcmVjaW5jdHNTaXplc1tyXS5QUHg7CiAgICAgICAgICByZXN1bHQuUFB5ID0gY29kT3JDb2MucHJlY2luY3RzU2l6ZXNbcl0uUFB5OwogICAgICAgIH0KCiAgICAgICAgcmVzdWx0LnhjYl8gPSByID4gMCA/IE1hdGgubWluKGNvZE9yQ29jLnhjYiwgcmVzdWx0LlBQeCAtIDEpIDogTWF0aC5taW4oY29kT3JDb2MueGNiLCByZXN1bHQuUFB4KTsKICAgICAgICByZXN1bHQueWNiXyA9IHIgPiAwID8gTWF0aC5taW4oY29kT3JDb2MueWNiLCByZXN1bHQuUFB5IC0gMSkgOiBNYXRoLm1pbihjb2RPckNvYy55Y2IsIHJlc3VsdC5QUHkpOwogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGJ1aWxkUHJlY2luY3RzKGNvbnRleHQsIHJlc29sdXRpb24sIGRpbWVuc2lvbnMpIHsKICAgICAgICB2YXIgcHJlY2luY3RXaWR0aCA9IDEgPDwgZGltZW5zaW9ucy5QUHg7CiAgICAgICAgdmFyIHByZWNpbmN0SGVpZ2h0ID0gMSA8PCBkaW1lbnNpb25zLlBQeTsKICAgICAgICB2YXIgaXNaZXJvUmVzID0gcmVzb2x1dGlvbi5yZXNMZXZlbCA9PT0gMDsKICAgICAgICB2YXIgcHJlY2luY3RXaWR0aEluU3ViYmFuZCA9IDEgPDwgZGltZW5zaW9ucy5QUHggKyAoaXNaZXJvUmVzID8gMCA6IC0xKTsKICAgICAgICB2YXIgcHJlY2luY3RIZWlnaHRJblN1YmJhbmQgPSAxIDw8IGRpbWVuc2lvbnMuUFB5ICsgKGlzWmVyb1JlcyA/IDAgOiAtMSk7CiAgICAgICAgdmFyIG51bXByZWNpbmN0c3dpZGUgPSByZXNvbHV0aW9uLnRyeDEgPiByZXNvbHV0aW9uLnRyeDAgPyBNYXRoLmNlaWwocmVzb2x1dGlvbi50cngxIC8gcHJlY2luY3RXaWR0aCkgLSBNYXRoLmZsb29yKHJlc29sdXRpb24udHJ4MCAvIHByZWNpbmN0V2lkdGgpIDogMDsKICAgICAgICB2YXIgbnVtcHJlY2luY3RzaGlnaCA9IHJlc29sdXRpb24udHJ5MSA+IHJlc29sdXRpb24udHJ5MCA/IE1hdGguY2VpbChyZXNvbHV0aW9uLnRyeTEgLyBwcmVjaW5jdEhlaWdodCkgLSBNYXRoLmZsb29yKHJlc29sdXRpb24udHJ5MCAvIHByZWNpbmN0SGVpZ2h0KSA6IDA7CiAgICAgICAgdmFyIG51bXByZWNpbmN0cyA9IG51bXByZWNpbmN0c3dpZGUgKiBudW1wcmVjaW5jdHNoaWdoOwogICAgICAgIHJlc29sdXRpb24ucHJlY2luY3RQYXJhbWV0ZXJzID0gewogICAgICAgICAgcHJlY2luY3RXaWR0aDogcHJlY2luY3RXaWR0aCwKICAgICAgICAgIHByZWNpbmN0SGVpZ2h0OiBwcmVjaW5jdEhlaWdodCwKICAgICAgICAgIG51bXByZWNpbmN0c3dpZGU6IG51bXByZWNpbmN0c3dpZGUsCiAgICAgICAgICBudW1wcmVjaW5jdHNoaWdoOiBudW1wcmVjaW5jdHNoaWdoLAogICAgICAgICAgbnVtcHJlY2luY3RzOiBudW1wcmVjaW5jdHMsCiAgICAgICAgICBwcmVjaW5jdFdpZHRoSW5TdWJiYW5kOiBwcmVjaW5jdFdpZHRoSW5TdWJiYW5kLAogICAgICAgICAgcHJlY2luY3RIZWlnaHRJblN1YmJhbmQ6IHByZWNpbmN0SGVpZ2h0SW5TdWJiYW5kCiAgICAgICAgfTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gYnVpbGRDb2RlYmxvY2tzKGNvbnRleHQsIHN1YmJhbmQsIGRpbWVuc2lvbnMpIHsKICAgICAgICB2YXIgeGNiXyA9IGRpbWVuc2lvbnMueGNiXzsKICAgICAgICB2YXIgeWNiXyA9IGRpbWVuc2lvbnMueWNiXzsKICAgICAgICB2YXIgY29kZWJsb2NrV2lkdGggPSAxIDw8IHhjYl87CiAgICAgICAgdmFyIGNvZGVibG9ja0hlaWdodCA9IDEgPDwgeWNiXzsKICAgICAgICB2YXIgY2J4MCA9IHN1YmJhbmQudGJ4MCA+PiB4Y2JfOwogICAgICAgIHZhciBjYnkwID0gc3ViYmFuZC50YnkwID4+IHljYl87CiAgICAgICAgdmFyIGNieDEgPSBzdWJiYW5kLnRieDEgKyBjb2RlYmxvY2tXaWR0aCAtIDEgPj4geGNiXzsKICAgICAgICB2YXIgY2J5MSA9IHN1YmJhbmQudGJ5MSArIGNvZGVibG9ja0hlaWdodCAtIDEgPj4geWNiXzsKICAgICAgICB2YXIgcHJlY2luY3RQYXJhbWV0ZXJzID0gc3ViYmFuZC5yZXNvbHV0aW9uLnByZWNpbmN0UGFyYW1ldGVyczsKICAgICAgICB2YXIgY29kZWJsb2NrcyA9IFtdOwogICAgICAgIHZhciBwcmVjaW5jdHMgPSBbXTsKICAgICAgICB2YXIgaSwgaiwgY29kZWJsb2NrLCBwcmVjaW5jdE51bWJlcjsKCiAgICAgICAgZm9yIChqID0gY2J5MDsgaiA8IGNieTE7IGorKykgewogICAgICAgICAgZm9yIChpID0gY2J4MDsgaSA8IGNieDE7IGkrKykgewogICAgICAgICAgICBjb2RlYmxvY2sgPSB7CiAgICAgICAgICAgICAgY2J4OiBpLAogICAgICAgICAgICAgIGNieTogaiwKICAgICAgICAgICAgICB0YngwOiBjb2RlYmxvY2tXaWR0aCAqIGksCiAgICAgICAgICAgICAgdGJ5MDogY29kZWJsb2NrSGVpZ2h0ICogaiwKICAgICAgICAgICAgICB0YngxOiBjb2RlYmxvY2tXaWR0aCAqIChpICsgMSksCiAgICAgICAgICAgICAgdGJ5MTogY29kZWJsb2NrSGVpZ2h0ICogKGogKyAxKQogICAgICAgICAgICB9OwogICAgICAgICAgICBjb2RlYmxvY2sudGJ4MF8gPSBNYXRoLm1heChzdWJiYW5kLnRieDAsIGNvZGVibG9jay50YngwKTsKICAgICAgICAgICAgY29kZWJsb2NrLnRieTBfID0gTWF0aC5tYXgoc3ViYmFuZC50YnkwLCBjb2RlYmxvY2sudGJ5MCk7CiAgICAgICAgICAgIGNvZGVibG9jay50YngxXyA9IE1hdGgubWluKHN1YmJhbmQudGJ4MSwgY29kZWJsb2NrLnRieDEpOwogICAgICAgICAgICBjb2RlYmxvY2sudGJ5MV8gPSBNYXRoLm1pbihzdWJiYW5kLnRieTEsIGNvZGVibG9jay50YnkxKTsKICAgICAgICAgICAgdmFyIHBpID0gTWF0aC5mbG9vcigoY29kZWJsb2NrLnRieDBfIC0gc3ViYmFuZC50YngwKSAvIHByZWNpbmN0UGFyYW1ldGVycy5wcmVjaW5jdFdpZHRoSW5TdWJiYW5kKTsKICAgICAgICAgICAgdmFyIHBqID0gTWF0aC5mbG9vcigoY29kZWJsb2NrLnRieTBfIC0gc3ViYmFuZC50YnkwKSAvIHByZWNpbmN0UGFyYW1ldGVycy5wcmVjaW5jdEhlaWdodEluU3ViYmFuZCk7CiAgICAgICAgICAgIHByZWNpbmN0TnVtYmVyID0gcGkgKyBwaiAqIHByZWNpbmN0UGFyYW1ldGVycy5udW1wcmVjaW5jdHN3aWRlOwogICAgICAgICAgICBjb2RlYmxvY2sucHJlY2luY3ROdW1iZXIgPSBwcmVjaW5jdE51bWJlcjsKICAgICAgICAgICAgY29kZWJsb2NrLnN1YmJhbmRUeXBlID0gc3ViYmFuZC50eXBlOwogICAgICAgICAgICBjb2RlYmxvY2suTGJsb2NrID0gMzsKCiAgICAgICAgICAgIGlmIChjb2RlYmxvY2sudGJ4MV8gPD0gY29kZWJsb2NrLnRieDBfIHx8IGNvZGVibG9jay50YnkxXyA8PSBjb2RlYmxvY2sudGJ5MF8pIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29kZWJsb2Nrcy5wdXNoKGNvZGVibG9jayk7CiAgICAgICAgICAgIHZhciBwcmVjaW5jdCA9IHByZWNpbmN0c1twcmVjaW5jdE51bWJlcl07CgogICAgICAgICAgICBpZiAocHJlY2luY3QgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIGlmIChpIDwgcHJlY2luY3QuY2J4TWluKSB7CiAgICAgICAgICAgICAgICBwcmVjaW5jdC5jYnhNaW4gPSBpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoaSA+IHByZWNpbmN0LmNieE1heCkgewogICAgICAgICAgICAgICAgcHJlY2luY3QuY2J4TWF4ID0gaTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChqIDwgcHJlY2luY3QuY2J5TWluKSB7CiAgICAgICAgICAgICAgICBwcmVjaW5jdC5jYnhNaW4gPSBqOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoaiA+IHByZWNpbmN0LmNieU1heCkgewogICAgICAgICAgICAgICAgcHJlY2luY3QuY2J5TWF4ID0gajsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcHJlY2luY3RzW3ByZWNpbmN0TnVtYmVyXSA9IHByZWNpbmN0ID0gewogICAgICAgICAgICAgICAgY2J4TWluOiBpLAogICAgICAgICAgICAgICAgY2J5TWluOiBqLAogICAgICAgICAgICAgICAgY2J4TWF4OiBpLAogICAgICAgICAgICAgICAgY2J5TWF4OiBqCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29kZWJsb2NrLnByZWNpbmN0ID0gcHJlY2luY3Q7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBzdWJiYW5kLmNvZGVibG9ja1BhcmFtZXRlcnMgPSB7CiAgICAgICAgICBjb2RlYmxvY2tXaWR0aDogeGNiXywKICAgICAgICAgIGNvZGVibG9ja0hlaWdodDogeWNiXywKICAgICAgICAgIG51bWNvZGVibG9ja3dpZGU6IGNieDEgLSBjYngwICsgMSwKICAgICAgICAgIG51bWNvZGVibG9ja2hpZ2g6IGNieTEgLSBjYnkwICsgMQogICAgICAgIH07CiAgICAgICAgc3ViYmFuZC5jb2RlYmxvY2tzID0gY29kZWJsb2NrczsKICAgICAgICBzdWJiYW5kLnByZWNpbmN0cyA9IHByZWNpbmN0czsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gY3JlYXRlUGFja2V0KHJlc29sdXRpb24sIHByZWNpbmN0TnVtYmVyLCBsYXllck51bWJlcikgewogICAgICAgIHZhciBwcmVjaW5jdENvZGVibG9ja3MgPSBbXTsKICAgICAgICB2YXIgc3ViYmFuZHMgPSByZXNvbHV0aW9uLnN1YmJhbmRzOwoKICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBzdWJiYW5kcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICB2YXIgc3ViYmFuZCA9IHN1YmJhbmRzW2ldOwogICAgICAgICAgdmFyIGNvZGVibG9ja3MgPSBzdWJiYW5kLmNvZGVibG9ja3M7CgogICAgICAgICAgZm9yICh2YXIgaiA9IDAsIGpqID0gY29kZWJsb2Nrcy5sZW5ndGg7IGogPCBqajsgaisrKSB7CiAgICAgICAgICAgIHZhciBjb2RlYmxvY2sgPSBjb2RlYmxvY2tzW2pdOwoKICAgICAgICAgICAgaWYgKGNvZGVibG9jay5wcmVjaW5jdE51bWJlciAhPT0gcHJlY2luY3ROdW1iZXIpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHJlY2luY3RDb2RlYmxvY2tzLnB1c2goY29kZWJsb2NrKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICBsYXllck51bWJlcjogbGF5ZXJOdW1iZXIsCiAgICAgICAgICBjb2RlYmxvY2tzOiBwcmVjaW5jdENvZGVibG9ja3MKICAgICAgICB9OwogICAgICB9CgogICAgICBmdW5jdGlvbiBMYXllclJlc29sdXRpb25Db21wb25lbnRQb3NpdGlvbkl0ZXJhdG9yKGNvbnRleHQpIHsKICAgICAgICB2YXIgc2l6ID0gY29udGV4dC5TSVo7CiAgICAgICAgdmFyIHRpbGVJbmRleCA9IGNvbnRleHQuY3VycmVudFRpbGUuaW5kZXg7CiAgICAgICAgdmFyIHRpbGUgPSBjb250ZXh0LnRpbGVzW3RpbGVJbmRleF07CiAgICAgICAgdmFyIGxheWVyc0NvdW50ID0gdGlsZS5jb2RpbmdTdHlsZURlZmF1bHRQYXJhbWV0ZXJzLmxheWVyc0NvdW50OwogICAgICAgIHZhciBjb21wb25lbnRzQ291bnQgPSBzaXouQ3NpejsKICAgICAgICB2YXIgbWF4RGVjb21wb3NpdGlvbkxldmVsc0NvdW50ID0gMDsKCiAgICAgICAgZm9yICh2YXIgcSA9IDA7IHEgPCBjb21wb25lbnRzQ291bnQ7IHErKykgewogICAgICAgICAgbWF4RGVjb21wb3NpdGlvbkxldmVsc0NvdW50ID0gTWF0aC5tYXgobWF4RGVjb21wb3NpdGlvbkxldmVsc0NvdW50LCB0aWxlLmNvbXBvbmVudHNbcV0uY29kaW5nU3R5bGVQYXJhbWV0ZXJzLmRlY29tcG9zaXRpb25MZXZlbHNDb3VudCk7CiAgICAgICAgfQoKICAgICAgICB2YXIgbCA9IDAsCiAgICAgICAgICByID0gMCwKICAgICAgICAgIGkgPSAwLAogICAgICAgICAgayA9IDA7CgogICAgICAgIHRoaXMubmV4dFBhY2tldCA9IGZ1bmN0aW9uIEpweEltYWdlX25leHRQYWNrZXQoKSB7CiAgICAgICAgICBmb3IgKDsgbCA8IGxheWVyc0NvdW50OyBsKyspIHsKICAgICAgICAgICAgZm9yICg7IHIgPD0gbWF4RGVjb21wb3NpdGlvbkxldmVsc0NvdW50OyByKyspIHsKICAgICAgICAgICAgICBmb3IgKDsgaSA8IGNvbXBvbmVudHNDb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAgICB2YXIgY29tcG9uZW50ID0gdGlsZS5jb21wb25lbnRzW2ldOwoKICAgICAgICAgICAgICAgIGlmIChyID4gY29tcG9uZW50LmNvZGluZ1N0eWxlUGFyYW1ldGVycy5kZWNvbXBvc2l0aW9uTGV2ZWxzQ291bnQpIHsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdmFyIHJlc29sdXRpb24gPSBjb21wb25lbnQucmVzb2x1dGlvbnNbcl07CiAgICAgICAgICAgICAgICB2YXIgbnVtcHJlY2luY3RzID0gcmVzb2x1dGlvbi5wcmVjaW5jdFBhcmFtZXRlcnMubnVtcHJlY2luY3RzOwoKICAgICAgICAgICAgICAgIGZvciAoOyBrIDwgbnVtcHJlY2luY3RzOykgewogICAgICAgICAgICAgICAgICB2YXIgcGFja2V0ID0gY3JlYXRlUGFja2V0KHJlc29sdXRpb24sIGssIGwpOwogICAgICAgICAgICAgICAgICBrKys7CiAgICAgICAgICAgICAgICAgIHJldHVybiBwYWNrZXQ7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgayA9IDA7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpID0gMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgciA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgdGhyb3cgbmV3IEpweEVycm9yKCJPdXQgb2YgcGFja2V0cyIpOwogICAgICAgIH07CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIFJlc29sdXRpb25MYXllckNvbXBvbmVudFBvc2l0aW9uSXRlcmF0b3IoY29udGV4dCkgewogICAgICAgIHZhciBzaXogPSBjb250ZXh0LlNJWjsKICAgICAgICB2YXIgdGlsZUluZGV4ID0gY29udGV4dC5jdXJyZW50VGlsZS5pbmRleDsKICAgICAgICB2YXIgdGlsZSA9IGNvbnRleHQudGlsZXNbdGlsZUluZGV4XTsKICAgICAgICB2YXIgbGF5ZXJzQ291bnQgPSB0aWxlLmNvZGluZ1N0eWxlRGVmYXVsdFBhcmFtZXRlcnMubGF5ZXJzQ291bnQ7CiAgICAgICAgdmFyIGNvbXBvbmVudHNDb3VudCA9IHNpei5Dc2l6OwogICAgICAgIHZhciBtYXhEZWNvbXBvc2l0aW9uTGV2ZWxzQ291bnQgPSAwOwoKICAgICAgICBmb3IgKHZhciBxID0gMDsgcSA8IGNvbXBvbmVudHNDb3VudDsgcSsrKSB7CiAgICAgICAgICBtYXhEZWNvbXBvc2l0aW9uTGV2ZWxzQ291bnQgPSBNYXRoLm1heChtYXhEZWNvbXBvc2l0aW9uTGV2ZWxzQ291bnQsIHRpbGUuY29tcG9uZW50c1txXS5jb2RpbmdTdHlsZVBhcmFtZXRlcnMuZGVjb21wb3NpdGlvbkxldmVsc0NvdW50KTsKICAgICAgICB9CgogICAgICAgIHZhciByID0gMCwKICAgICAgICAgIGwgPSAwLAogICAgICAgICAgaSA9IDAsCiAgICAgICAgICBrID0gMDsKCiAgICAgICAgdGhpcy5uZXh0UGFja2V0ID0gZnVuY3Rpb24gSnB4SW1hZ2VfbmV4dFBhY2tldCgpIHsKICAgICAgICAgIGZvciAoOyByIDw9IG1heERlY29tcG9zaXRpb25MZXZlbHNDb3VudDsgcisrKSB7CiAgICAgICAgICAgIGZvciAoOyBsIDwgbGF5ZXJzQ291bnQ7IGwrKykgewogICAgICAgICAgICAgIGZvciAoOyBpIDwgY29tcG9uZW50c0NvdW50OyBpKyspIHsKICAgICAgICAgICAgICAgIHZhciBjb21wb25lbnQgPSB0aWxlLmNvbXBvbmVudHNbaV07CgogICAgICAgICAgICAgICAgaWYgKHIgPiBjb21wb25lbnQuY29kaW5nU3R5bGVQYXJhbWV0ZXJzLmRlY29tcG9zaXRpb25MZXZlbHNDb3VudCkgewogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgcmVzb2x1dGlvbiA9IGNvbXBvbmVudC5yZXNvbHV0aW9uc1tyXTsKICAgICAgICAgICAgICAgIHZhciBudW1wcmVjaW5jdHMgPSByZXNvbHV0aW9uLnByZWNpbmN0UGFyYW1ldGVycy5udW1wcmVjaW5jdHM7CgogICAgICAgICAgICAgICAgZm9yICg7IGsgPCBudW1wcmVjaW5jdHM7KSB7CiAgICAgICAgICAgICAgICAgIHZhciBwYWNrZXQgPSBjcmVhdGVQYWNrZXQocmVzb2x1dGlvbiwgaywgbCk7CiAgICAgICAgICAgICAgICAgIGsrKzsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhY2tldDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBrID0gMDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGkgPSAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsID0gMDsKICAgICAgICAgIH0KCiAgICAgICAgICB0aHJvdyBuZXcgSnB4RXJyb3IoIk91dCBvZiBwYWNrZXRzIik7CiAgICAgICAgfTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gUmVzb2x1dGlvblBvc2l0aW9uQ29tcG9uZW50TGF5ZXJJdGVyYXRvcihjb250ZXh0KSB7CiAgICAgICAgdmFyIHNpeiA9IGNvbnRleHQuU0laOwogICAgICAgIHZhciB0aWxlSW5kZXggPSBjb250ZXh0LmN1cnJlbnRUaWxlLmluZGV4OwogICAgICAgIHZhciB0aWxlID0gY29udGV4dC50aWxlc1t0aWxlSW5kZXhdOwogICAgICAgIHZhciBsYXllcnNDb3VudCA9IHRpbGUuY29kaW5nU3R5bGVEZWZhdWx0UGFyYW1ldGVycy5sYXllcnNDb3VudDsKICAgICAgICB2YXIgY29tcG9uZW50c0NvdW50ID0gc2l6LkNzaXo7CiAgICAgICAgdmFyIGwsIHIsIGMsIHA7CiAgICAgICAgdmFyIG1heERlY29tcG9zaXRpb25MZXZlbHNDb3VudCA9IDA7CgogICAgICAgIGZvciAoYyA9IDA7IGMgPCBjb21wb25lbnRzQ291bnQ7IGMrKykgewogICAgICAgICAgdmFyIGNvbXBvbmVudCA9IHRpbGUuY29tcG9uZW50c1tjXTsKICAgICAgICAgIG1heERlY29tcG9zaXRpb25MZXZlbHNDb3VudCA9IE1hdGgubWF4KG1heERlY29tcG9zaXRpb25MZXZlbHNDb3VudCwgY29tcG9uZW50LmNvZGluZ1N0eWxlUGFyYW1ldGVycy5kZWNvbXBvc2l0aW9uTGV2ZWxzQ291bnQpOwogICAgICAgIH0KCiAgICAgICAgdmFyIG1heE51bVByZWNpbmN0c0luTGV2ZWwgPSBuZXcgSW50MzJBcnJheShtYXhEZWNvbXBvc2l0aW9uTGV2ZWxzQ291bnQgKyAxKTsKCiAgICAgICAgZm9yIChyID0gMDsgciA8PSBtYXhEZWNvbXBvc2l0aW9uTGV2ZWxzQ291bnQ7ICsrcikgewogICAgICAgICAgdmFyIG1heE51bVByZWNpbmN0cyA9IDA7CgogICAgICAgICAgZm9yIChjID0gMDsgYyA8IGNvbXBvbmVudHNDb3VudDsgKytjKSB7CiAgICAgICAgICAgIHZhciByZXNvbHV0aW9ucyA9IHRpbGUuY29tcG9uZW50c1tjXS5yZXNvbHV0aW9uczsKCiAgICAgICAgICAgIGlmIChyIDwgcmVzb2x1dGlvbnMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgbWF4TnVtUHJlY2luY3RzID0gTWF0aC5tYXgobWF4TnVtUHJlY2luY3RzLCByZXNvbHV0aW9uc1tyXS5wcmVjaW5jdFBhcmFtZXRlcnMubnVtcHJlY2luY3RzKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIG1heE51bVByZWNpbmN0c0luTGV2ZWxbcl0gPSBtYXhOdW1QcmVjaW5jdHM7CiAgICAgICAgfQoKICAgICAgICBsID0gMDsKICAgICAgICByID0gMDsKICAgICAgICBjID0gMDsKICAgICAgICBwID0gMDsKCiAgICAgICAgdGhpcy5uZXh0UGFja2V0ID0gZnVuY3Rpb24gSnB4SW1hZ2VfbmV4dFBhY2tldCgpIHsKICAgICAgICAgIGZvciAoOyByIDw9IG1heERlY29tcG9zaXRpb25MZXZlbHNDb3VudDsgcisrKSB7CiAgICAgICAgICAgIGZvciAoOyBwIDwgbWF4TnVtUHJlY2luY3RzSW5MZXZlbFtyXTsgcCsrKSB7CiAgICAgICAgICAgICAgZm9yICg7IGMgPCBjb21wb25lbnRzQ291bnQ7IGMrKykgewogICAgICAgICAgICAgICAgdmFyIGNvbXBvbmVudCA9IHRpbGUuY29tcG9uZW50c1tjXTsKCiAgICAgICAgICAgICAgICBpZiAociA+IGNvbXBvbmVudC5jb2RpbmdTdHlsZVBhcmFtZXRlcnMuZGVjb21wb3NpdGlvbkxldmVsc0NvdW50KSB7CiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHZhciByZXNvbHV0aW9uID0gY29tcG9uZW50LnJlc29sdXRpb25zW3JdOwogICAgICAgICAgICAgICAgdmFyIG51bXByZWNpbmN0cyA9IHJlc29sdXRpb24ucHJlY2luY3RQYXJhbWV0ZXJzLm51bXByZWNpbmN0czsKCiAgICAgICAgICAgICAgICBpZiAocCA+PSBudW1wcmVjaW5jdHMpIHsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZm9yICg7IGwgPCBsYXllcnNDb3VudDspIHsKICAgICAgICAgICAgICAgICAgdmFyIHBhY2tldCA9IGNyZWF0ZVBhY2tldChyZXNvbHV0aW9uLCBwLCBsKTsKICAgICAgICAgICAgICAgICAgbCsrOwogICAgICAgICAgICAgICAgICByZXR1cm4gcGFja2V0OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGwgPSAwOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYyA9IDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHAgPSAwOwogICAgICAgICAgfQoKICAgICAgICAgIHRocm93IG5ldyBKcHhFcnJvcigiT3V0IG9mIHBhY2tldHMiKTsKICAgICAgICB9OwogICAgICB9CgogICAgICBmdW5jdGlvbiBQb3NpdGlvbkNvbXBvbmVudFJlc29sdXRpb25MYXllckl0ZXJhdG9yKGNvbnRleHQpIHsKICAgICAgICB2YXIgc2l6ID0gY29udGV4dC5TSVo7CiAgICAgICAgdmFyIHRpbGVJbmRleCA9IGNvbnRleHQuY3VycmVudFRpbGUuaW5kZXg7CiAgICAgICAgdmFyIHRpbGUgPSBjb250ZXh0LnRpbGVzW3RpbGVJbmRleF07CiAgICAgICAgdmFyIGxheWVyc0NvdW50ID0gdGlsZS5jb2RpbmdTdHlsZURlZmF1bHRQYXJhbWV0ZXJzLmxheWVyc0NvdW50OwogICAgICAgIHZhciBjb21wb25lbnRzQ291bnQgPSBzaXouQ3NpejsKICAgICAgICB2YXIgcHJlY2luY3RzU2l6ZXMgPSBnZXRQcmVjaW5jdFNpemVzSW5JbWFnZVNjYWxlKHRpbGUpOwogICAgICAgIHZhciBwcmVjaW5jdHNJdGVyYXRpb25TaXplcyA9IHByZWNpbmN0c1NpemVzOwogICAgICAgIHZhciBsID0gMCwKICAgICAgICAgIHIgPSAwLAogICAgICAgICAgYyA9IDAsCiAgICAgICAgICBweCA9IDAsCiAgICAgICAgICBweSA9IDA7CgogICAgICAgIHRoaXMubmV4dFBhY2tldCA9IGZ1bmN0aW9uIEpweEltYWdlX25leHRQYWNrZXQoKSB7CiAgICAgICAgICBmb3IgKDsgcHkgPCBwcmVjaW5jdHNJdGVyYXRpb25TaXplcy5tYXhOdW1IaWdoOyBweSsrKSB7CiAgICAgICAgICAgIGZvciAoOyBweCA8IHByZWNpbmN0c0l0ZXJhdGlvblNpemVzLm1heE51bVdpZGU7IHB4KyspIHsKICAgICAgICAgICAgICBmb3IgKDsgYyA8IGNvbXBvbmVudHNDb3VudDsgYysrKSB7CiAgICAgICAgICAgICAgICB2YXIgY29tcG9uZW50ID0gdGlsZS5jb21wb25lbnRzW2NdOwogICAgICAgICAgICAgICAgdmFyIGRlY29tcG9zaXRpb25MZXZlbHNDb3VudCA9IGNvbXBvbmVudC5jb2RpbmdTdHlsZVBhcmFtZXRlcnMuZGVjb21wb3NpdGlvbkxldmVsc0NvdW50OwoKICAgICAgICAgICAgICAgIGZvciAoOyByIDw9IGRlY29tcG9zaXRpb25MZXZlbHNDb3VudDsgcisrKSB7CiAgICAgICAgICAgICAgICAgIHZhciByZXNvbHV0aW9uID0gY29tcG9uZW50LnJlc29sdXRpb25zW3JdOwogICAgICAgICAgICAgICAgICB2YXIgc2l6ZUluSW1hZ2VTY2FsZSA9IHByZWNpbmN0c1NpemVzLmNvbXBvbmVudHNbY10ucmVzb2x1dGlvbnNbcl07CiAgICAgICAgICAgICAgICAgIHZhciBrID0gZ2V0UHJlY2luY3RJbmRleElmRXhpc3QocHgsIHB5LCBzaXplSW5JbWFnZVNjYWxlLCBwcmVjaW5jdHNJdGVyYXRpb25TaXplcywgcmVzb2x1dGlvbik7CgogICAgICAgICAgICAgICAgICBpZiAoayA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBmb3IgKDsgbCA8IGxheWVyc0NvdW50OykgewogICAgICAgICAgICAgICAgICAgIHZhciBwYWNrZXQgPSBjcmVhdGVQYWNrZXQocmVzb2x1dGlvbiwgaywgbCk7CiAgICAgICAgICAgICAgICAgICAgbCsrOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBwYWNrZXQ7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGwgPSAwOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHIgPSAwOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYyA9IDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB4ID0gMDsKICAgICAgICAgIH0KCiAgICAgICAgICB0aHJvdyBuZXcgSnB4RXJyb3IoIk91dCBvZiBwYWNrZXRzIik7CiAgICAgICAgfTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gQ29tcG9uZW50UG9zaXRpb25SZXNvbHV0aW9uTGF5ZXJJdGVyYXRvcihjb250ZXh0KSB7CiAgICAgICAgdmFyIHNpeiA9IGNvbnRleHQuU0laOwogICAgICAgIHZhciB0aWxlSW5kZXggPSBjb250ZXh0LmN1cnJlbnRUaWxlLmluZGV4OwogICAgICAgIHZhciB0aWxlID0gY29udGV4dC50aWxlc1t0aWxlSW5kZXhdOwogICAgICAgIHZhciBsYXllcnNDb3VudCA9IHRpbGUuY29kaW5nU3R5bGVEZWZhdWx0UGFyYW1ldGVycy5sYXllcnNDb3VudDsKICAgICAgICB2YXIgY29tcG9uZW50c0NvdW50ID0gc2l6LkNzaXo7CiAgICAgICAgdmFyIHByZWNpbmN0c1NpemVzID0gZ2V0UHJlY2luY3RTaXplc0luSW1hZ2VTY2FsZSh0aWxlKTsKICAgICAgICB2YXIgbCA9IDAsCiAgICAgICAgICByID0gMCwKICAgICAgICAgIGMgPSAwLAogICAgICAgICAgcHggPSAwLAogICAgICAgICAgcHkgPSAwOwoKICAgICAgICB0aGlzLm5leHRQYWNrZXQgPSBmdW5jdGlvbiBKcHhJbWFnZV9uZXh0UGFja2V0KCkgewogICAgICAgICAgZm9yICg7IGMgPCBjb21wb25lbnRzQ291bnQ7ICsrYykgewogICAgICAgICAgICB2YXIgY29tcG9uZW50ID0gdGlsZS5jb21wb25lbnRzW2NdOwogICAgICAgICAgICB2YXIgcHJlY2luY3RzSXRlcmF0aW9uU2l6ZXMgPSBwcmVjaW5jdHNTaXplcy5jb21wb25lbnRzW2NdOwogICAgICAgICAgICB2YXIgZGVjb21wb3NpdGlvbkxldmVsc0NvdW50ID0gY29tcG9uZW50LmNvZGluZ1N0eWxlUGFyYW1ldGVycy5kZWNvbXBvc2l0aW9uTGV2ZWxzQ291bnQ7CgogICAgICAgICAgICBmb3IgKDsgcHkgPCBwcmVjaW5jdHNJdGVyYXRpb25TaXplcy5tYXhOdW1IaWdoOyBweSsrKSB7CiAgICAgICAgICAgICAgZm9yICg7IHB4IDwgcHJlY2luY3RzSXRlcmF0aW9uU2l6ZXMubWF4TnVtV2lkZTsgcHgrKykgewogICAgICAgICAgICAgICAgZm9yICg7IHIgPD0gZGVjb21wb3NpdGlvbkxldmVsc0NvdW50OyByKyspIHsKICAgICAgICAgICAgICAgICAgdmFyIHJlc29sdXRpb24gPSBjb21wb25lbnQucmVzb2x1dGlvbnNbcl07CiAgICAgICAgICAgICAgICAgIHZhciBzaXplSW5JbWFnZVNjYWxlID0gcHJlY2luY3RzSXRlcmF0aW9uU2l6ZXMucmVzb2x1dGlvbnNbcl07CiAgICAgICAgICAgICAgICAgIHZhciBrID0gZ2V0UHJlY2luY3RJbmRleElmRXhpc3QocHgsIHB5LCBzaXplSW5JbWFnZVNjYWxlLCBwcmVjaW5jdHNJdGVyYXRpb25TaXplcywgcmVzb2x1dGlvbik7CgogICAgICAgICAgICAgICAgICBpZiAoayA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBmb3IgKDsgbCA8IGxheWVyc0NvdW50OykgewogICAgICAgICAgICAgICAgICAgIHZhciBwYWNrZXQgPSBjcmVhdGVQYWNrZXQocmVzb2x1dGlvbiwgaywgbCk7CiAgICAgICAgICAgICAgICAgICAgbCsrOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBwYWNrZXQ7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGwgPSAwOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHIgPSAwOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcHggPSAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICBweSA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgdGhyb3cgbmV3IEpweEVycm9yKCJPdXQgb2YgcGFja2V0cyIpOwogICAgICAgIH07CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGdldFByZWNpbmN0SW5kZXhJZkV4aXN0KHB4SW5kZXgsIHB5SW5kZXgsIHNpemVJbkltYWdlU2NhbGUsIHByZWNpbmN0SXRlcmF0aW9uU2l6ZXMsIHJlc29sdXRpb24pIHsKICAgICAgICB2YXIgcG9zWCA9IHB4SW5kZXggKiBwcmVjaW5jdEl0ZXJhdGlvblNpemVzLm1pbldpZHRoOwogICAgICAgIHZhciBwb3NZID0gcHlJbmRleCAqIHByZWNpbmN0SXRlcmF0aW9uU2l6ZXMubWluSGVpZ2h0OwoKICAgICAgICBpZiAocG9zWCAlIHNpemVJbkltYWdlU2NhbGUud2lkdGggIT09IDAgfHwgcG9zWSAlIHNpemVJbkltYWdlU2NhbGUuaGVpZ2h0ICE9PSAwKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIHZhciBzdGFydFByZWNpbmN0Um93SW5kZXggPSBwb3NZIC8gc2l6ZUluSW1hZ2VTY2FsZS53aWR0aCAqIHJlc29sdXRpb24ucHJlY2luY3RQYXJhbWV0ZXJzLm51bXByZWNpbmN0c3dpZGU7CiAgICAgICAgcmV0dXJuIHBvc1ggLyBzaXplSW5JbWFnZVNjYWxlLmhlaWdodCArIHN0YXJ0UHJlY2luY3RSb3dJbmRleDsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZ2V0UHJlY2luY3RTaXplc0luSW1hZ2VTY2FsZSh0aWxlKSB7CiAgICAgICAgdmFyIGNvbXBvbmVudHNDb3VudCA9IHRpbGUuY29tcG9uZW50cy5sZW5ndGg7CiAgICAgICAgdmFyIG1pbldpZHRoID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgICB2YXIgbWluSGVpZ2h0ID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgICB2YXIgbWF4TnVtV2lkZSA9IDA7CiAgICAgICAgdmFyIG1heE51bUhpZ2ggPSAwOwogICAgICAgIHZhciBzaXplUGVyQ29tcG9uZW50ID0gbmV3IEFycmF5KGNvbXBvbmVudHNDb3VudCk7CgogICAgICAgIGZvciAodmFyIGMgPSAwOyBjIDwgY29tcG9uZW50c0NvdW50OyBjKyspIHsKICAgICAgICAgIHZhciBjb21wb25lbnQgPSB0aWxlLmNvbXBvbmVudHNbY107CiAgICAgICAgICB2YXIgZGVjb21wb3NpdGlvbkxldmVsc0NvdW50ID0gY29tcG9uZW50LmNvZGluZ1N0eWxlUGFyYW1ldGVycy5kZWNvbXBvc2l0aW9uTGV2ZWxzQ291bnQ7CiAgICAgICAgICB2YXIgc2l6ZVBlclJlc29sdXRpb24gPSBuZXcgQXJyYXkoZGVjb21wb3NpdGlvbkxldmVsc0NvdW50ICsgMSk7CiAgICAgICAgICB2YXIgbWluV2lkdGhDdXJyZW50Q29tcG9uZW50ID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgICAgIHZhciBtaW5IZWlnaHRDdXJyZW50Q29tcG9uZW50ID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgICAgIHZhciBtYXhOdW1XaWRlQ3VycmVudENvbXBvbmVudCA9IDA7CiAgICAgICAgICB2YXIgbWF4TnVtSGlnaEN1cnJlbnRDb21wb25lbnQgPSAwOwogICAgICAgICAgdmFyIHNjYWxlID0gMTsKCiAgICAgICAgICBmb3IgKHZhciByID0gZGVjb21wb3NpdGlvbkxldmVsc0NvdW50OyByID49IDA7IC0tcikgewogICAgICAgICAgICB2YXIgcmVzb2x1dGlvbiA9IGNvbXBvbmVudC5yZXNvbHV0aW9uc1tyXTsKICAgICAgICAgICAgdmFyIHdpZHRoQ3VycmVudFJlc29sdXRpb24gPSBzY2FsZSAqIHJlc29sdXRpb24ucHJlY2luY3RQYXJhbWV0ZXJzLnByZWNpbmN0V2lkdGg7CiAgICAgICAgICAgIHZhciBoZWlnaHRDdXJyZW50UmVzb2x1dGlvbiA9IHNjYWxlICogcmVzb2x1dGlvbi5wcmVjaW5jdFBhcmFtZXRlcnMucHJlY2luY3RIZWlnaHQ7CiAgICAgICAgICAgIG1pbldpZHRoQ3VycmVudENvbXBvbmVudCA9IE1hdGgubWluKG1pbldpZHRoQ3VycmVudENvbXBvbmVudCwgd2lkdGhDdXJyZW50UmVzb2x1dGlvbik7CiAgICAgICAgICAgIG1pbkhlaWdodEN1cnJlbnRDb21wb25lbnQgPSBNYXRoLm1pbihtaW5IZWlnaHRDdXJyZW50Q29tcG9uZW50LCBoZWlnaHRDdXJyZW50UmVzb2x1dGlvbik7CiAgICAgICAgICAgIG1heE51bVdpZGVDdXJyZW50Q29tcG9uZW50ID0gTWF0aC5tYXgobWF4TnVtV2lkZUN1cnJlbnRDb21wb25lbnQsIHJlc29sdXRpb24ucHJlY2luY3RQYXJhbWV0ZXJzLm51bXByZWNpbmN0c3dpZGUpOwogICAgICAgICAgICBtYXhOdW1IaWdoQ3VycmVudENvbXBvbmVudCA9IE1hdGgubWF4KG1heE51bUhpZ2hDdXJyZW50Q29tcG9uZW50LCByZXNvbHV0aW9uLnByZWNpbmN0UGFyYW1ldGVycy5udW1wcmVjaW5jdHNoaWdoKTsKICAgICAgICAgICAgc2l6ZVBlclJlc29sdXRpb25bcl0gPSB7CiAgICAgICAgICAgICAgd2lkdGg6IHdpZHRoQ3VycmVudFJlc29sdXRpb24sCiAgICAgICAgICAgICAgaGVpZ2h0OiBoZWlnaHRDdXJyZW50UmVzb2x1dGlvbgogICAgICAgICAgICB9OwogICAgICAgICAgICBzY2FsZSA8PD0gMTsKICAgICAgICAgIH0KCiAgICAgICAgICBtaW5XaWR0aCA9IE1hdGgubWluKG1pbldpZHRoLCBtaW5XaWR0aEN1cnJlbnRDb21wb25lbnQpOwogICAgICAgICAgbWluSGVpZ2h0ID0gTWF0aC5taW4obWluSGVpZ2h0LCBtaW5IZWlnaHRDdXJyZW50Q29tcG9uZW50KTsKICAgICAgICAgIG1heE51bVdpZGUgPSBNYXRoLm1heChtYXhOdW1XaWRlLCBtYXhOdW1XaWRlQ3VycmVudENvbXBvbmVudCk7CiAgICAgICAgICBtYXhOdW1IaWdoID0gTWF0aC5tYXgobWF4TnVtSGlnaCwgbWF4TnVtSGlnaEN1cnJlbnRDb21wb25lbnQpOwogICAgICAgICAgc2l6ZVBlckNvbXBvbmVudFtjXSA9IHsKICAgICAgICAgICAgcmVzb2x1dGlvbnM6IHNpemVQZXJSZXNvbHV0aW9uLAogICAgICAgICAgICBtaW5XaWR0aDogbWluV2lkdGhDdXJyZW50Q29tcG9uZW50LAogICAgICAgICAgICBtaW5IZWlnaHQ6IG1pbkhlaWdodEN1cnJlbnRDb21wb25lbnQsCiAgICAgICAgICAgIG1heE51bVdpZGU6IG1heE51bVdpZGVDdXJyZW50Q29tcG9uZW50LAogICAgICAgICAgICBtYXhOdW1IaWdoOiBtYXhOdW1IaWdoQ3VycmVudENvbXBvbmVudAogICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICBjb21wb25lbnRzOiBzaXplUGVyQ29tcG9uZW50LAogICAgICAgICAgbWluV2lkdGg6IG1pbldpZHRoLAogICAgICAgICAgbWluSGVpZ2h0OiBtaW5IZWlnaHQsCiAgICAgICAgICBtYXhOdW1XaWRlOiBtYXhOdW1XaWRlLAogICAgICAgICAgbWF4TnVtSGlnaDogbWF4TnVtSGlnaAogICAgICAgIH07CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGJ1aWxkUGFja2V0cyhjb250ZXh0KSB7CiAgICAgICAgdmFyIHNpeiA9IGNvbnRleHQuU0laOwogICAgICAgIHZhciB0aWxlSW5kZXggPSBjb250ZXh0LmN1cnJlbnRUaWxlLmluZGV4OwogICAgICAgIHZhciB0aWxlID0gY29udGV4dC50aWxlc1t0aWxlSW5kZXhdOwogICAgICAgIHZhciBjb21wb25lbnRzQ291bnQgPSBzaXouQ3NpejsKCiAgICAgICAgZm9yICh2YXIgYyA9IDA7IGMgPCBjb21wb25lbnRzQ291bnQ7IGMrKykgewogICAgICAgICAgdmFyIGNvbXBvbmVudCA9IHRpbGUuY29tcG9uZW50c1tjXTsKICAgICAgICAgIHZhciBkZWNvbXBvc2l0aW9uTGV2ZWxzQ291bnQgPSBjb21wb25lbnQuY29kaW5nU3R5bGVQYXJhbWV0ZXJzLmRlY29tcG9zaXRpb25MZXZlbHNDb3VudDsKICAgICAgICAgIHZhciByZXNvbHV0aW9ucyA9IFtdOwogICAgICAgICAgdmFyIHN1YmJhbmRzID0gW107CgogICAgICAgICAgZm9yICh2YXIgciA9IDA7IHIgPD0gZGVjb21wb3NpdGlvbkxldmVsc0NvdW50OyByKyspIHsKICAgICAgICAgICAgdmFyIGJsb2Nrc0RpbWVuc2lvbnMgPSBnZXRCbG9ja3NEaW1lbnNpb25zKGNvbnRleHQsIGNvbXBvbmVudCwgcik7CiAgICAgICAgICAgIHZhciByZXNvbHV0aW9uID0ge307CiAgICAgICAgICAgIHZhciBzY2FsZSA9IDEgPDwgZGVjb21wb3NpdGlvbkxldmVsc0NvdW50IC0gcjsKICAgICAgICAgICAgcmVzb2x1dGlvbi50cngwID0gTWF0aC5jZWlsKGNvbXBvbmVudC50Y3gwIC8gc2NhbGUpOwogICAgICAgICAgICByZXNvbHV0aW9uLnRyeTAgPSBNYXRoLmNlaWwoY29tcG9uZW50LnRjeTAgLyBzY2FsZSk7CiAgICAgICAgICAgIHJlc29sdXRpb24udHJ4MSA9IE1hdGguY2VpbChjb21wb25lbnQudGN4MSAvIHNjYWxlKTsKICAgICAgICAgICAgcmVzb2x1dGlvbi50cnkxID0gTWF0aC5jZWlsKGNvbXBvbmVudC50Y3kxIC8gc2NhbGUpOwogICAgICAgICAgICByZXNvbHV0aW9uLnJlc0xldmVsID0gcjsKICAgICAgICAgICAgYnVpbGRQcmVjaW5jdHMoY29udGV4dCwgcmVzb2x1dGlvbiwgYmxvY2tzRGltZW5zaW9ucyk7CiAgICAgICAgICAgIHJlc29sdXRpb25zLnB1c2gocmVzb2x1dGlvbik7CiAgICAgICAgICAgIHZhciBzdWJiYW5kOwoKICAgICAgICAgICAgaWYgKHIgPT09IDApIHsKICAgICAgICAgICAgICBzdWJiYW5kID0ge307CiAgICAgICAgICAgICAgc3ViYmFuZC50eXBlID0gIkxMIjsKICAgICAgICAgICAgICBzdWJiYW5kLnRieDAgPSBNYXRoLmNlaWwoY29tcG9uZW50LnRjeDAgLyBzY2FsZSk7CiAgICAgICAgICAgICAgc3ViYmFuZC50YnkwID0gTWF0aC5jZWlsKGNvbXBvbmVudC50Y3kwIC8gc2NhbGUpOwogICAgICAgICAgICAgIHN1YmJhbmQudGJ4MSA9IE1hdGguY2VpbChjb21wb25lbnQudGN4MSAvIHNjYWxlKTsKICAgICAgICAgICAgICBzdWJiYW5kLnRieTEgPSBNYXRoLmNlaWwoY29tcG9uZW50LnRjeTEgLyBzY2FsZSk7CiAgICAgICAgICAgICAgc3ViYmFuZC5yZXNvbHV0aW9uID0gcmVzb2x1dGlvbjsKICAgICAgICAgICAgICBidWlsZENvZGVibG9ja3MoY29udGV4dCwgc3ViYmFuZCwgYmxvY2tzRGltZW5zaW9ucyk7CiAgICAgICAgICAgICAgc3ViYmFuZHMucHVzaChzdWJiYW5kKTsKICAgICAgICAgICAgICByZXNvbHV0aW9uLnN1YmJhbmRzID0gW3N1YmJhbmRdOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHZhciBic2NhbGUgPSAxIDw8IGRlY29tcG9zaXRpb25MZXZlbHNDb3VudCAtIHIgKyAxOwogICAgICAgICAgICAgIHZhciByZXNvbHV0aW9uU3ViYmFuZHMgPSBbXTsKICAgICAgICAgICAgICBzdWJiYW5kID0ge307CiAgICAgICAgICAgICAgc3ViYmFuZC50eXBlID0gIkhMIjsKICAgICAgICAgICAgICBzdWJiYW5kLnRieDAgPSBNYXRoLmNlaWwoY29tcG9uZW50LnRjeDAgLyBic2NhbGUgLSAwLjUpOwogICAgICAgICAgICAgIHN1YmJhbmQudGJ5MCA9IE1hdGguY2VpbChjb21wb25lbnQudGN5MCAvIGJzY2FsZSk7CiAgICAgICAgICAgICAgc3ViYmFuZC50YngxID0gTWF0aC5jZWlsKGNvbXBvbmVudC50Y3gxIC8gYnNjYWxlIC0gMC41KTsKICAgICAgICAgICAgICBzdWJiYW5kLnRieTEgPSBNYXRoLmNlaWwoY29tcG9uZW50LnRjeTEgLyBic2NhbGUpOwogICAgICAgICAgICAgIHN1YmJhbmQucmVzb2x1dGlvbiA9IHJlc29sdXRpb247CiAgICAgICAgICAgICAgYnVpbGRDb2RlYmxvY2tzKGNvbnRleHQsIHN1YmJhbmQsIGJsb2Nrc0RpbWVuc2lvbnMpOwogICAgICAgICAgICAgIHN1YmJhbmRzLnB1c2goc3ViYmFuZCk7CiAgICAgICAgICAgICAgcmVzb2x1dGlvblN1YmJhbmRzLnB1c2goc3ViYmFuZCk7CiAgICAgICAgICAgICAgc3ViYmFuZCA9IHt9OwogICAgICAgICAgICAgIHN1YmJhbmQudHlwZSA9ICJMSCI7CiAgICAgICAgICAgICAgc3ViYmFuZC50YngwID0gTWF0aC5jZWlsKGNvbXBvbmVudC50Y3gwIC8gYnNjYWxlKTsKICAgICAgICAgICAgICBzdWJiYW5kLnRieTAgPSBNYXRoLmNlaWwoY29tcG9uZW50LnRjeTAgLyBic2NhbGUgLSAwLjUpOwogICAgICAgICAgICAgIHN1YmJhbmQudGJ4MSA9IE1hdGguY2VpbChjb21wb25lbnQudGN4MSAvIGJzY2FsZSk7CiAgICAgICAgICAgICAgc3ViYmFuZC50YnkxID0gTWF0aC5jZWlsKGNvbXBvbmVudC50Y3kxIC8gYnNjYWxlIC0gMC41KTsKICAgICAgICAgICAgICBzdWJiYW5kLnJlc29sdXRpb24gPSByZXNvbHV0aW9uOwogICAgICAgICAgICAgIGJ1aWxkQ29kZWJsb2Nrcyhjb250ZXh0LCBzdWJiYW5kLCBibG9ja3NEaW1lbnNpb25zKTsKICAgICAgICAgICAgICBzdWJiYW5kcy5wdXNoKHN1YmJhbmQpOwogICAgICAgICAgICAgIHJlc29sdXRpb25TdWJiYW5kcy5wdXNoKHN1YmJhbmQpOwogICAgICAgICAgICAgIHN1YmJhbmQgPSB7fTsKICAgICAgICAgICAgICBzdWJiYW5kLnR5cGUgPSAiSEgiOwogICAgICAgICAgICAgIHN1YmJhbmQudGJ4MCA9IE1hdGguY2VpbChjb21wb25lbnQudGN4MCAvIGJzY2FsZSAtIDAuNSk7CiAgICAgICAgICAgICAgc3ViYmFuZC50YnkwID0gTWF0aC5jZWlsKGNvbXBvbmVudC50Y3kwIC8gYnNjYWxlIC0gMC41KTsKICAgICAgICAgICAgICBzdWJiYW5kLnRieDEgPSBNYXRoLmNlaWwoY29tcG9uZW50LnRjeDEgLyBic2NhbGUgLSAwLjUpOwogICAgICAgICAgICAgIHN1YmJhbmQudGJ5MSA9IE1hdGguY2VpbChjb21wb25lbnQudGN5MSAvIGJzY2FsZSAtIDAuNSk7CiAgICAgICAgICAgICAgc3ViYmFuZC5yZXNvbHV0aW9uID0gcmVzb2x1dGlvbjsKICAgICAgICAgICAgICBidWlsZENvZGVibG9ja3MoY29udGV4dCwgc3ViYmFuZCwgYmxvY2tzRGltZW5zaW9ucyk7CiAgICAgICAgICAgICAgc3ViYmFuZHMucHVzaChzdWJiYW5kKTsKICAgICAgICAgICAgICByZXNvbHV0aW9uU3ViYmFuZHMucHVzaChzdWJiYW5kKTsKICAgICAgICAgICAgICByZXNvbHV0aW9uLnN1YmJhbmRzID0gcmVzb2x1dGlvblN1YmJhbmRzOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgY29tcG9uZW50LnJlc29sdXRpb25zID0gcmVzb2x1dGlvbnM7CiAgICAgICAgICBjb21wb25lbnQuc3ViYmFuZHMgPSBzdWJiYW5kczsKICAgICAgICB9CgogICAgICAgIHZhciBwcm9ncmVzc2lvbk9yZGVyID0gdGlsZS5jb2RpbmdTdHlsZURlZmF1bHRQYXJhbWV0ZXJzLnByb2dyZXNzaW9uT3JkZXI7CgogICAgICAgIHN3aXRjaCAocHJvZ3Jlc3Npb25PcmRlcikgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICB0aWxlLnBhY2tldHNJdGVyYXRvciA9IG5ldyBMYXllclJlc29sdXRpb25Db21wb25lbnRQb3NpdGlvbkl0ZXJhdG9yKGNvbnRleHQpOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIHRpbGUucGFja2V0c0l0ZXJhdG9yID0gbmV3IFJlc29sdXRpb25MYXllckNvbXBvbmVudFBvc2l0aW9uSXRlcmF0b3IoY29udGV4dCk7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgdGlsZS5wYWNrZXRzSXRlcmF0b3IgPSBuZXcgUmVzb2x1dGlvblBvc2l0aW9uQ29tcG9uZW50TGF5ZXJJdGVyYXRvcihjb250ZXh0KTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICB0aWxlLnBhY2tldHNJdGVyYXRvciA9IG5ldyBQb3NpdGlvbkNvbXBvbmVudFJlc29sdXRpb25MYXllckl0ZXJhdG9yKGNvbnRleHQpOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgIHRpbGUucGFja2V0c0l0ZXJhdG9yID0gbmV3IENvbXBvbmVudFBvc2l0aW9uUmVzb2x1dGlvbkxheWVySXRlcmF0b3IoY29udGV4dCk7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHRocm93IG5ldyBKcHhFcnJvcigiVW5zdXBwb3J0ZWQgcHJvZ3Jlc3Npb24gb3JkZXIgIi5jb25jYXQocHJvZ3Jlc3Npb25PcmRlcikpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZnVuY3Rpb24gcGFyc2VUaWxlUGFja2V0cyhjb250ZXh0LCBkYXRhLCBvZmZzZXQsIGRhdGFMZW5ndGgpIHsKICAgICAgICB2YXIgcG9zaXRpb24gPSAwOwogICAgICAgIHZhciBidWZmZXIsCiAgICAgICAgICBidWZmZXJTaXplID0gMCwKICAgICAgICAgIHNraXBOZXh0Qml0ID0gZmFsc2U7CgogICAgICAgIGZ1bmN0aW9uIHJlYWRCaXRzKGNvdW50KSB7CiAgICAgICAgICB3aGlsZSAoYnVmZmVyU2l6ZSA8IGNvdW50KSB7CiAgICAgICAgICAgIHZhciBiID0gZGF0YVtvZmZzZXQgKyBwb3NpdGlvbl07CiAgICAgICAgICAgIHBvc2l0aW9uKys7CgogICAgICAgICAgICBpZiAoc2tpcE5leHRCaXQpIHsKICAgICAgICAgICAgICBidWZmZXIgPSBidWZmZXIgPDwgNyB8IGI7CiAgICAgICAgICAgICAgYnVmZmVyU2l6ZSArPSA3OwogICAgICAgICAgICAgIHNraXBOZXh0Qml0ID0gZmFsc2U7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgYnVmZmVyID0gYnVmZmVyIDw8IDggfCBiOwogICAgICAgICAgICAgIGJ1ZmZlclNpemUgKz0gODsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGIgPT09IDB4ZmYpIHsKICAgICAgICAgICAgICBza2lwTmV4dEJpdCA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBidWZmZXJTaXplIC09IGNvdW50OwogICAgICAgICAgcmV0dXJuIGJ1ZmZlciA+Pj4gYnVmZmVyU2l6ZSAmICgxIDw8IGNvdW50KSAtIDE7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBza2lwTWFya2VySWZFcXVhbCh2YWx1ZSkgewogICAgICAgICAgaWYgKGRhdGFbb2Zmc2V0ICsgcG9zaXRpb24gLSAxXSA9PT0gMHhmZiAmJiBkYXRhW29mZnNldCArIHBvc2l0aW9uXSA9PT0gdmFsdWUpIHsKICAgICAgICAgICAgc2tpcEJ5dGVzKDEpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YVtvZmZzZXQgKyBwb3NpdGlvbl0gPT09IDB4ZmYgJiYgZGF0YVtvZmZzZXQgKyBwb3NpdGlvbiArIDFdID09PSB2YWx1ZSkgewogICAgICAgICAgICBza2lwQnl0ZXMoMik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHNraXBCeXRlcyhjb3VudCkgewogICAgICAgICAgcG9zaXRpb24gKz0gY291bnQ7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhbGlnblRvQnl0ZSgpIHsKICAgICAgICAgIGJ1ZmZlclNpemUgPSAwOwoKICAgICAgICAgIGlmIChza2lwTmV4dEJpdCkgewogICAgICAgICAgICBwb3NpdGlvbisrOwogICAgICAgICAgICBza2lwTmV4dEJpdCA9IGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gcmVhZENvZGluZ3Bhc3NlcygpIHsKICAgICAgICAgIGlmIChyZWFkQml0cygxKSA9PT0gMCkgewogICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAocmVhZEJpdHMoMSkgPT09IDApIHsKICAgICAgICAgICAgcmV0dXJuIDI7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHZhbHVlID0gcmVhZEJpdHMoMik7CgogICAgICAgICAgaWYgKHZhbHVlIDwgMykgewogICAgICAgICAgICByZXR1cm4gdmFsdWUgKyAzOwogICAgICAgICAgfQoKICAgICAgICAgIHZhbHVlID0gcmVhZEJpdHMoNSk7CgogICAgICAgICAgaWYgKHZhbHVlIDwgMzEpIHsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlICsgNjsKICAgICAgICAgIH0KCiAgICAgICAgICB2YWx1ZSA9IHJlYWRCaXRzKDcpOwogICAgICAgICAgcmV0dXJuIHZhbHVlICsgMzc7CiAgICAgICAgfQoKICAgICAgICB2YXIgdGlsZUluZGV4ID0gY29udGV4dC5jdXJyZW50VGlsZS5pbmRleDsKICAgICAgICB2YXIgdGlsZSA9IGNvbnRleHQudGlsZXNbdGlsZUluZGV4XTsKICAgICAgICB2YXIgc29wTWFya2VyVXNlZCA9IGNvbnRleHQuQ09ELnNvcE1hcmtlclVzZWQ7CiAgICAgICAgdmFyIGVwaE1hcmtlclVzZWQgPSBjb250ZXh0LkNPRC5lcGhNYXJrZXJVc2VkOwogICAgICAgIHZhciBwYWNrZXRzSXRlcmF0b3IgPSB0aWxlLnBhY2tldHNJdGVyYXRvcjsKCiAgICAgICAgd2hpbGUgKHBvc2l0aW9uIDwgZGF0YUxlbmd0aCkgewogICAgICAgICAgYWxpZ25Ub0J5dGUoKTsKCiAgICAgICAgICBpZiAoc29wTWFya2VyVXNlZCAmJiBza2lwTWFya2VySWZFcXVhbCgweDkxKSkgewogICAgICAgICAgICBza2lwQnl0ZXMoNCk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHBhY2tldCA9IHBhY2tldHNJdGVyYXRvci5uZXh0UGFja2V0KCk7CgogICAgICAgICAgaWYgKCFyZWFkQml0cygxKSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgbGF5ZXJOdW1iZXIgPSBwYWNrZXQubGF5ZXJOdW1iZXI7CiAgICAgICAgICB2YXIgcXVldWUgPSBbXSwKICAgICAgICAgICAgY29kZWJsb2NrOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IHBhY2tldC5jb2RlYmxvY2tzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgY29kZWJsb2NrID0gcGFja2V0LmNvZGVibG9ja3NbaV07CiAgICAgICAgICAgIHZhciBwcmVjaW5jdCA9IGNvZGVibG9jay5wcmVjaW5jdDsKICAgICAgICAgICAgdmFyIGNvZGVibG9ja0NvbHVtbiA9IGNvZGVibG9jay5jYnggLSBwcmVjaW5jdC5jYnhNaW47CiAgICAgICAgICAgIHZhciBjb2RlYmxvY2tSb3cgPSBjb2RlYmxvY2suY2J5IC0gcHJlY2luY3QuY2J5TWluOwogICAgICAgICAgICB2YXIgY29kZWJsb2NrSW5jbHVkZWQgPSBmYWxzZTsKICAgICAgICAgICAgdmFyIGZpcnN0VGltZUluY2x1c2lvbiA9IGZhbHNlOwogICAgICAgICAgICB2YXIgdmFsdWVSZWFkeTsKCiAgICAgICAgICAgIGlmIChjb2RlYmxvY2tbImluY2x1ZGVkIl0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIGNvZGVibG9ja0luY2x1ZGVkID0gISFyZWFkQml0cygxKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBwcmVjaW5jdCA9IGNvZGVibG9jay5wcmVjaW5jdDsKICAgICAgICAgICAgICB2YXIgaW5jbHVzaW9uVHJlZSwgemVyb0JpdFBsYW5lc1RyZWU7CgogICAgICAgICAgICAgIGlmIChwcmVjaW5jdFsiaW5jbHVzaW9uVHJlZSJdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGluY2x1c2lvblRyZWUgPSBwcmVjaW5jdC5pbmNsdXNpb25UcmVlOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB2YXIgd2lkdGggPSBwcmVjaW5jdC5jYnhNYXggLSBwcmVjaW5jdC5jYnhNaW4gKyAxOwogICAgICAgICAgICAgICAgdmFyIGhlaWdodCA9IHByZWNpbmN0LmNieU1heCAtIHByZWNpbmN0LmNieU1pbiArIDE7CiAgICAgICAgICAgICAgICBpbmNsdXNpb25UcmVlID0gbmV3IEluY2x1c2lvblRyZWUod2lkdGgsIGhlaWdodCwgbGF5ZXJOdW1iZXIpOwogICAgICAgICAgICAgICAgemVyb0JpdFBsYW5lc1RyZWUgPSBuZXcgVGFnVHJlZSh3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgICAgIHByZWNpbmN0LmluY2x1c2lvblRyZWUgPSBpbmNsdXNpb25UcmVlOwogICAgICAgICAgICAgICAgcHJlY2luY3QuemVyb0JpdFBsYW5lc1RyZWUgPSB6ZXJvQml0UGxhbmVzVHJlZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChpbmNsdXNpb25UcmVlLnJlc2V0KGNvZGVibG9ja0NvbHVtbiwgY29kZWJsb2NrUm93LCBsYXllck51bWJlcikpIHsKICAgICAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgICAgICAgIGlmIChyZWFkQml0cygxKSkgewogICAgICAgICAgICAgICAgICAgIHZhbHVlUmVhZHkgPSAhaW5jbHVzaW9uVHJlZS5uZXh0TGV2ZWwoKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlUmVhZHkpIHsKICAgICAgICAgICAgICAgICAgICAgIGNvZGVibG9jay5pbmNsdWRlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICBjb2RlYmxvY2tJbmNsdWRlZCA9IGZpcnN0VGltZUluY2x1c2lvbiA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaW5jbHVzaW9uVHJlZS5pbmNyZW1lbnRWYWx1ZShsYXllck51bWJlcik7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghY29kZWJsb2NrSW5jbHVkZWQpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGZpcnN0VGltZUluY2x1c2lvbikgewogICAgICAgICAgICAgIHplcm9CaXRQbGFuZXNUcmVlID0gcHJlY2luY3QuemVyb0JpdFBsYW5lc1RyZWU7CiAgICAgICAgICAgICAgemVyb0JpdFBsYW5lc1RyZWUucmVzZXQoY29kZWJsb2NrQ29sdW1uLCBjb2RlYmxvY2tSb3cpOwoKICAgICAgICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgICAgICAgaWYgKHJlYWRCaXRzKDEpKSB7CiAgICAgICAgICAgICAgICAgIHZhbHVlUmVhZHkgPSAhemVyb0JpdFBsYW5lc1RyZWUubmV4dExldmVsKCk7CgogICAgICAgICAgICAgICAgICBpZiAodmFsdWVSZWFkeSkgewogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICB6ZXJvQml0UGxhbmVzVHJlZS5pbmNyZW1lbnRWYWx1ZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY29kZWJsb2NrLnplcm9CaXRQbGFuZXMgPSB6ZXJvQml0UGxhbmVzVHJlZS52YWx1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGNvZGluZ3Bhc3NlcyA9IHJlYWRDb2RpbmdwYXNzZXMoKTsKCiAgICAgICAgICAgIHdoaWxlIChyZWFkQml0cygxKSkgewogICAgICAgICAgICAgIGNvZGVibG9jay5MYmxvY2srKzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGNvZGluZ3Bhc3Nlc0xvZzIgPSAoMCwgX2NvcmVfdXRpbHMubG9nMikoY29kaW5ncGFzc2VzKTsKICAgICAgICAgICAgdmFyIGJpdHMgPSAoY29kaW5ncGFzc2VzIDwgMSA8PCBjb2RpbmdwYXNzZXNMb2cyID8gY29kaW5ncGFzc2VzTG9nMiAtIDEgOiBjb2RpbmdwYXNzZXNMb2cyKSArIGNvZGVibG9jay5MYmxvY2s7CiAgICAgICAgICAgIHZhciBjb2RlZERhdGFMZW5ndGggPSByZWFkQml0cyhiaXRzKTsKICAgICAgICAgICAgcXVldWUucHVzaCh7CiAgICAgICAgICAgICAgY29kZWJsb2NrOiBjb2RlYmxvY2ssCiAgICAgICAgICAgICAgY29kaW5ncGFzc2VzOiBjb2RpbmdwYXNzZXMsCiAgICAgICAgICAgICAgZGF0YUxlbmd0aDogY29kZWREYXRhTGVuZ3RoCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIGFsaWduVG9CeXRlKCk7CgogICAgICAgICAgaWYgKGVwaE1hcmtlclVzZWQpIHsKICAgICAgICAgICAgc2tpcE1hcmtlcklmRXF1YWwoMHg5Mik7CiAgICAgICAgICB9CgogICAgICAgICAgd2hpbGUgKHF1ZXVlLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgdmFyIHBhY2tldEl0ZW0gPSBxdWV1ZS5zaGlmdCgpOwogICAgICAgICAgICBjb2RlYmxvY2sgPSBwYWNrZXRJdGVtLmNvZGVibG9jazsKCiAgICAgICAgICAgIGlmIChjb2RlYmxvY2tbImRhdGEiXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgY29kZWJsb2NrLmRhdGEgPSBbXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29kZWJsb2NrLmRhdGEucHVzaCh7CiAgICAgICAgICAgICAgZGF0YTogZGF0YSwKICAgICAgICAgICAgICBzdGFydDogb2Zmc2V0ICsgcG9zaXRpb24sCiAgICAgICAgICAgICAgZW5kOiBvZmZzZXQgKyBwb3NpdGlvbiArIHBhY2tldEl0ZW0uZGF0YUxlbmd0aCwKICAgICAgICAgICAgICBjb2RpbmdwYXNzZXM6IHBhY2tldEl0ZW0uY29kaW5ncGFzc2VzCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBwb3NpdGlvbiArPSBwYWNrZXRJdGVtLmRhdGFMZW5ndGg7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcG9zaXRpb247CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGNvcHlDb2VmZmljaWVudHMoY29lZmZpY2llbnRzLCBsZXZlbFdpZHRoLCBsZXZlbEhlaWdodCwgc3ViYmFuZCwgZGVsdGEsIG1iLCByZXZlcnNpYmxlLCBzZWdtZW50YXRpb25TeW1ib2xVc2VkKSB7CiAgICAgICAgdmFyIHgwID0gc3ViYmFuZC50YngwOwogICAgICAgIHZhciB5MCA9IHN1YmJhbmQudGJ5MDsKICAgICAgICB2YXIgd2lkdGggPSBzdWJiYW5kLnRieDEgLSBzdWJiYW5kLnRieDA7CiAgICAgICAgdmFyIGNvZGVibG9ja3MgPSBzdWJiYW5kLmNvZGVibG9ja3M7CiAgICAgICAgdmFyIHJpZ2h0ID0gc3ViYmFuZC50eXBlLmNoYXJBdCgwKSA9PT0gIkgiID8gMSA6IDA7CiAgICAgICAgdmFyIGJvdHRvbSA9IHN1YmJhbmQudHlwZS5jaGFyQXQoMSkgPT09ICJIIiA/IGxldmVsV2lkdGggOiAwOwoKICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBjb2RlYmxvY2tzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHsKICAgICAgICAgIHZhciBjb2RlYmxvY2sgPSBjb2RlYmxvY2tzW2ldOwogICAgICAgICAgdmFyIGJsb2NrV2lkdGggPSBjb2RlYmxvY2sudGJ4MV8gLSBjb2RlYmxvY2sudGJ4MF87CiAgICAgICAgICB2YXIgYmxvY2tIZWlnaHQgPSBjb2RlYmxvY2sudGJ5MV8gLSBjb2RlYmxvY2sudGJ5MF87CgogICAgICAgICAgaWYgKGJsb2NrV2lkdGggPT09IDAgfHwgYmxvY2tIZWlnaHQgPT09IDApIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGNvZGVibG9ja1siZGF0YSJdID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGJpdE1vZGVsLCBjdXJyZW50Q29kaW5ncGFzc1R5cGU7CiAgICAgICAgICBiaXRNb2RlbCA9IG5ldyBCaXRNb2RlbChibG9ja1dpZHRoLCBibG9ja0hlaWdodCwgY29kZWJsb2NrLnN1YmJhbmRUeXBlLCBjb2RlYmxvY2suemVyb0JpdFBsYW5lcywgbWIpOwogICAgICAgICAgY3VycmVudENvZGluZ3Bhc3NUeXBlID0gMjsKICAgICAgICAgIHZhciBkYXRhID0gY29kZWJsb2NrLmRhdGEsCiAgICAgICAgICAgIHRvdGFsTGVuZ3RoID0gMCwKICAgICAgICAgICAgY29kaW5ncGFzc2VzID0gMDsKICAgICAgICAgIHZhciBqLCBqaiwgZGF0YUl0ZW07CgogICAgICAgICAgZm9yIChqID0gMCwgamogPSBkYXRhLmxlbmd0aDsgaiA8IGpqOyBqKyspIHsKICAgICAgICAgICAgZGF0YUl0ZW0gPSBkYXRhW2pdOwogICAgICAgICAgICB0b3RhbExlbmd0aCArPSBkYXRhSXRlbS5lbmQgLSBkYXRhSXRlbS5zdGFydDsKICAgICAgICAgICAgY29kaW5ncGFzc2VzICs9IGRhdGFJdGVtLmNvZGluZ3Bhc3NlczsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZW5jb2RlZERhdGEgPSBuZXcgVWludDhBcnJheSh0b3RhbExlbmd0aCk7CiAgICAgICAgICB2YXIgcG9zaXRpb24gPSAwOwoKICAgICAgICAgIGZvciAoaiA9IDAsIGpqID0gZGF0YS5sZW5ndGg7IGogPCBqajsgaisrKSB7CiAgICAgICAgICAgIGRhdGFJdGVtID0gZGF0YVtqXTsKICAgICAgICAgICAgdmFyIGNodW5rID0gZGF0YUl0ZW0uZGF0YS5zdWJhcnJheShkYXRhSXRlbS5zdGFydCwgZGF0YUl0ZW0uZW5kKTsKICAgICAgICAgICAgZW5jb2RlZERhdGEuc2V0KGNodW5rLCBwb3NpdGlvbik7CiAgICAgICAgICAgIHBvc2l0aW9uICs9IGNodW5rLmxlbmd0aDsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZGVjb2RlciA9IG5ldyBfYXJpdGhtZXRpY19kZWNvZGVyLkFyaXRobWV0aWNEZWNvZGVyKGVuY29kZWREYXRhLCAwLCB0b3RhbExlbmd0aCk7CiAgICAgICAgICBiaXRNb2RlbC5zZXREZWNvZGVyKGRlY29kZXIpOwoKICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBjb2RpbmdwYXNzZXM7IGorKykgewogICAgICAgICAgICBzd2l0Y2ggKGN1cnJlbnRDb2RpbmdwYXNzVHlwZSkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGJpdE1vZGVsLnJ1blNpZ25pZmljYW5jZVByb3BhZ2F0aW9uUGFzcygpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgIGJpdE1vZGVsLnJ1bk1hZ25pdHVkZVJlZmluZW1lbnRQYXNzKCk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgYml0TW9kZWwucnVuQ2xlYW51cFBhc3MoKTsKCiAgICAgICAgICAgICAgICBpZiAoc2VnbWVudGF0aW9uU3ltYm9sVXNlZCkgewogICAgICAgICAgICAgICAgICBiaXRNb2RlbC5jaGVja1NlZ21lbnRhdGlvblN5bWJvbCgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjdXJyZW50Q29kaW5ncGFzc1R5cGUgPSAoY3VycmVudENvZGluZ3Bhc3NUeXBlICsgMSkgJSAzOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBvZmZzZXQgPSBjb2RlYmxvY2sudGJ4MF8gLSB4MCArIChjb2RlYmxvY2sudGJ5MF8gLSB5MCkgKiB3aWR0aDsKICAgICAgICAgIHZhciBzaWduID0gYml0TW9kZWwuY29lZmZpY2VudHNTaWduOwogICAgICAgICAgdmFyIG1hZ25pdHVkZSA9IGJpdE1vZGVsLmNvZWZmaWNlbnRzTWFnbml0dWRlOwogICAgICAgICAgdmFyIGJpdHNEZWNvZGVkID0gYml0TW9kZWwuYml0c0RlY29kZWQ7CiAgICAgICAgICB2YXIgbWFnbml0dWRlQ29ycmVjdGlvbiA9IHJldmVyc2libGUgPyAwIDogMC41OwogICAgICAgICAgdmFyIGssIG4sIG5iOwogICAgICAgICAgcG9zaXRpb24gPSAwOwogICAgICAgICAgdmFyIGludGVybGVhdmUgPSBzdWJiYW5kLnR5cGUgIT09ICJMTCI7CgogICAgICAgICAgZm9yIChqID0gMDsgaiA8IGJsb2NrSGVpZ2h0OyBqKyspIHsKICAgICAgICAgICAgdmFyIHJvdyA9IG9mZnNldCAvIHdpZHRoIHwgMDsKICAgICAgICAgICAgdmFyIGxldmVsT2Zmc2V0ID0gMiAqIHJvdyAqIChsZXZlbFdpZHRoIC0gd2lkdGgpICsgcmlnaHQgKyBib3R0b207CgogICAgICAgICAgICBmb3IgKGsgPSAwOyBrIDwgYmxvY2tXaWR0aDsgaysrKSB7CiAgICAgICAgICAgICAgbiA9IG1hZ25pdHVkZVtwb3NpdGlvbl07CgogICAgICAgICAgICAgIGlmIChuICE9PSAwKSB7CiAgICAgICAgICAgICAgICBuID0gKG4gKyBtYWduaXR1ZGVDb3JyZWN0aW9uKSAqIGRlbHRhOwoKICAgICAgICAgICAgICAgIGlmIChzaWduW3Bvc2l0aW9uXSAhPT0gMCkgewogICAgICAgICAgICAgICAgICBuID0gLW47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbmIgPSBiaXRzRGVjb2RlZFtwb3NpdGlvbl07CiAgICAgICAgICAgICAgICB2YXIgcG9zID0gaW50ZXJsZWF2ZSA/IGxldmVsT2Zmc2V0ICsgKG9mZnNldCA8PCAxKSA6IG9mZnNldDsKCiAgICAgICAgICAgICAgICBpZiAocmV2ZXJzaWJsZSAmJiBuYiA+PSBtYikgewogICAgICAgICAgICAgICAgICBjb2VmZmljaWVudHNbcG9zXSA9IG47CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBjb2VmZmljaWVudHNbcG9zXSA9IG4gKiAoMSA8PCBtYiAtIG5iKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIG9mZnNldCsrOwogICAgICAgICAgICAgIHBvc2l0aW9uKys7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG9mZnNldCArPSB3aWR0aCAtIGJsb2NrV2lkdGg7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiB0cmFuc2Zvcm1UaWxlKGNvbnRleHQsIHRpbGUsIGMpIHsKICAgICAgICB2YXIgY29tcG9uZW50ID0gdGlsZS5jb21wb25lbnRzW2NdOwogICAgICAgIHZhciBjb2RpbmdTdHlsZVBhcmFtZXRlcnMgPSBjb21wb25lbnQuY29kaW5nU3R5bGVQYXJhbWV0ZXJzOwogICAgICAgIHZhciBxdWFudGl6YXRpb25QYXJhbWV0ZXJzID0gY29tcG9uZW50LnF1YW50aXphdGlvblBhcmFtZXRlcnM7CiAgICAgICAgdmFyIGRlY29tcG9zaXRpb25MZXZlbHNDb3VudCA9IGNvZGluZ1N0eWxlUGFyYW1ldGVycy5kZWNvbXBvc2l0aW9uTGV2ZWxzQ291bnQ7CiAgICAgICAgdmFyIHNwcWNkcyA9IHF1YW50aXphdGlvblBhcmFtZXRlcnMuU1BxY2RzOwogICAgICAgIHZhciBzY2FsYXJFeHBvdW5kZWQgPSBxdWFudGl6YXRpb25QYXJhbWV0ZXJzLnNjYWxhckV4cG91bmRlZDsKICAgICAgICB2YXIgZ3VhcmRCaXRzID0gcXVhbnRpemF0aW9uUGFyYW1ldGVycy5ndWFyZEJpdHM7CiAgICAgICAgdmFyIHNlZ21lbnRhdGlvblN5bWJvbFVzZWQgPSBjb2RpbmdTdHlsZVBhcmFtZXRlcnMuc2VnbWVudGF0aW9uU3ltYm9sVXNlZDsKICAgICAgICB2YXIgcHJlY2lzaW9uID0gY29udGV4dC5jb21wb25lbnRzW2NdLnByZWNpc2lvbjsKICAgICAgICB2YXIgcmV2ZXJzaWJsZSA9IGNvZGluZ1N0eWxlUGFyYW1ldGVycy5yZXZlcnNpYmxlVHJhbnNmb3JtYXRpb247CiAgICAgICAgdmFyIHRyYW5zZm9ybSA9IHJldmVyc2libGUgPyBuZXcgUmV2ZXJzaWJsZVRyYW5zZm9ybSgpIDogbmV3IElycmV2ZXJzaWJsZVRyYW5zZm9ybSgpOwogICAgICAgIHZhciBzdWJiYW5kQ29lZmZpY2llbnRzID0gW107CiAgICAgICAgdmFyIGIgPSAwOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8PSBkZWNvbXBvc2l0aW9uTGV2ZWxzQ291bnQ7IGkrKykgewogICAgICAgICAgdmFyIHJlc29sdXRpb24gPSBjb21wb25lbnQucmVzb2x1dGlvbnNbaV07CiAgICAgICAgICB2YXIgd2lkdGggPSByZXNvbHV0aW9uLnRyeDEgLSByZXNvbHV0aW9uLnRyeDA7CiAgICAgICAgICB2YXIgaGVpZ2h0ID0gcmVzb2x1dGlvbi50cnkxIC0gcmVzb2x1dGlvbi50cnkwOwogICAgICAgICAgdmFyIGNvZWZmaWNpZW50cyA9IG5ldyBGbG9hdDMyQXJyYXkod2lkdGggKiBoZWlnaHQpOwoKICAgICAgICAgIGZvciAodmFyIGogPSAwLCBqaiA9IHJlc29sdXRpb24uc3ViYmFuZHMubGVuZ3RoOyBqIDwgamo7IGorKykgewogICAgICAgICAgICB2YXIgbXUsIGVwc2lsb247CgogICAgICAgICAgICBpZiAoIXNjYWxhckV4cG91bmRlZCkgewogICAgICAgICAgICAgIG11ID0gc3BxY2RzWzBdLm11OwogICAgICAgICAgICAgIGVwc2lsb24gPSBzcHFjZHNbMF0uZXBzaWxvbiArIChpID4gMCA/IDEgLSBpIDogMCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbXUgPSBzcHFjZHNbYl0ubXU7CiAgICAgICAgICAgICAgZXBzaWxvbiA9IHNwcWNkc1tiXS5lcHNpbG9uOwogICAgICAgICAgICAgIGIrKzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHN1YmJhbmQgPSByZXNvbHV0aW9uLnN1YmJhbmRzW2pdOwogICAgICAgICAgICB2YXIgZ2FpbkxvZzIgPSBTdWJiYW5kc0dhaW5Mb2cyW3N1YmJhbmQudHlwZV07CiAgICAgICAgICAgIHZhciBkZWx0YSA9IHJldmVyc2libGUgPyAxIDogTWF0aC5wb3coMiwgcHJlY2lzaW9uICsgZ2FpbkxvZzIgLSBlcHNpbG9uKSAqICgxICsgbXUgLyAyMDQ4KTsKICAgICAgICAgICAgdmFyIG1iID0gZ3VhcmRCaXRzICsgZXBzaWxvbiAtIDE7CiAgICAgICAgICAgIGNvcHlDb2VmZmljaWVudHMoY29lZmZpY2llbnRzLCB3aWR0aCwgaGVpZ2h0LCBzdWJiYW5kLCBkZWx0YSwgbWIsIHJldmVyc2libGUsIHNlZ21lbnRhdGlvblN5bWJvbFVzZWQpOwogICAgICAgICAgfQoKICAgICAgICAgIHN1YmJhbmRDb2VmZmljaWVudHMucHVzaCh7CiAgICAgICAgICAgIHdpZHRoOiB3aWR0aCwKICAgICAgICAgICAgaGVpZ2h0OiBoZWlnaHQsCiAgICAgICAgICAgIGl0ZW1zOiBjb2VmZmljaWVudHMKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgdmFyIHJlc3VsdCA9IHRyYW5zZm9ybS5jYWxjdWxhdGUoc3ViYmFuZENvZWZmaWNpZW50cywgY29tcG9uZW50LnRjeDAsIGNvbXBvbmVudC50Y3kwKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgbGVmdDogY29tcG9uZW50LnRjeDAsCiAgICAgICAgICB0b3A6IGNvbXBvbmVudC50Y3kwLAogICAgICAgICAgd2lkdGg6IHJlc3VsdC53aWR0aCwKICAgICAgICAgIGhlaWdodDogcmVzdWx0LmhlaWdodCwKICAgICAgICAgIGl0ZW1zOiByZXN1bHQuaXRlbXMKICAgICAgICB9OwogICAgICB9CgogICAgICBmdW5jdGlvbiB0cmFuc2Zvcm1Db21wb25lbnRzKGNvbnRleHQpIHsKICAgICAgICB2YXIgc2l6ID0gY29udGV4dC5TSVo7CiAgICAgICAgdmFyIGNvbXBvbmVudHMgPSBjb250ZXh0LmNvbXBvbmVudHM7CiAgICAgICAgdmFyIGNvbXBvbmVudHNDb3VudCA9IHNpei5Dc2l6OwogICAgICAgIHZhciByZXN1bHRJbWFnZXMgPSBbXTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gY29udGV4dC50aWxlcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICB2YXIgdGlsZSA9IGNvbnRleHQudGlsZXNbaV07CiAgICAgICAgICB2YXIgdHJhbnNmb3JtZWRUaWxlcyA9IFtdOwogICAgICAgICAgdmFyIGM7CgogICAgICAgICAgZm9yIChjID0gMDsgYyA8IGNvbXBvbmVudHNDb3VudDsgYysrKSB7CiAgICAgICAgICAgIHRyYW5zZm9ybWVkVGlsZXNbY10gPSB0cmFuc2Zvcm1UaWxlKGNvbnRleHQsIHRpbGUsIGMpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciB0aWxlMCA9IHRyYW5zZm9ybWVkVGlsZXNbMF07CiAgICAgICAgICB2YXIgb3V0ID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHRpbGUwLml0ZW1zLmxlbmd0aCAqIGNvbXBvbmVudHNDb3VudCk7CiAgICAgICAgICB2YXIgcmVzdWx0ID0gewogICAgICAgICAgICBsZWZ0OiB0aWxlMC5sZWZ0LAogICAgICAgICAgICB0b3A6IHRpbGUwLnRvcCwKICAgICAgICAgICAgd2lkdGg6IHRpbGUwLndpZHRoLAogICAgICAgICAgICBoZWlnaHQ6IHRpbGUwLmhlaWdodCwKICAgICAgICAgICAgaXRlbXM6IG91dAogICAgICAgICAgfTsKICAgICAgICAgIHZhciBzaGlmdCwgb2Zmc2V0OwogICAgICAgICAgdmFyIHBvcyA9IDAsCiAgICAgICAgICAgIGosCiAgICAgICAgICAgIGpqLAogICAgICAgICAgICB5MCwKICAgICAgICAgICAgeTEsCiAgICAgICAgICAgIHkyOwoKICAgICAgICAgIGlmICh0aWxlLmNvZGluZ1N0eWxlRGVmYXVsdFBhcmFtZXRlcnMubXVsdGlwbGVDb21wb25lbnRUcmFuc2Zvcm0pIHsKICAgICAgICAgICAgdmFyIGZvdXJDb21wb25lbnRzID0gY29tcG9uZW50c0NvdW50ID09PSA0OwogICAgICAgICAgICB2YXIgeTBpdGVtcyA9IHRyYW5zZm9ybWVkVGlsZXNbMF0uaXRlbXM7CiAgICAgICAgICAgIHZhciB5MWl0ZW1zID0gdHJhbnNmb3JtZWRUaWxlc1sxXS5pdGVtczsKICAgICAgICAgICAgdmFyIHkyaXRlbXMgPSB0cmFuc2Zvcm1lZFRpbGVzWzJdLml0ZW1zOwogICAgICAgICAgICB2YXIgeTNpdGVtcyA9IGZvdXJDb21wb25lbnRzID8gdHJhbnNmb3JtZWRUaWxlc1szXS5pdGVtcyA6IG51bGw7CiAgICAgICAgICAgIHNoaWZ0ID0gY29tcG9uZW50c1swXS5wcmVjaXNpb24gLSA4OwogICAgICAgICAgICBvZmZzZXQgPSAoMTI4IDw8IHNoaWZ0KSArIDAuNTsKICAgICAgICAgICAgdmFyIGNvbXBvbmVudDAgPSB0aWxlLmNvbXBvbmVudHNbMF07CiAgICAgICAgICAgIHZhciBhbHBoYTAxID0gY29tcG9uZW50c0NvdW50IC0gMzsKICAgICAgICAgICAgamogPSB5MGl0ZW1zLmxlbmd0aDsKCiAgICAgICAgICAgIGlmICghY29tcG9uZW50MC5jb2RpbmdTdHlsZVBhcmFtZXRlcnMucmV2ZXJzaWJsZVRyYW5zZm9ybWF0aW9uKSB7CiAgICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IGpqOyBqKyssIHBvcyArPSBhbHBoYTAxKSB7CiAgICAgICAgICAgICAgICB5MCA9IHkwaXRlbXNbal0gKyBvZmZzZXQ7CiAgICAgICAgICAgICAgICB5MSA9IHkxaXRlbXNbal07CiAgICAgICAgICAgICAgICB5MiA9IHkyaXRlbXNbal07CiAgICAgICAgICAgICAgICBvdXRbcG9zKytdID0geTAgKyAxLjQwMiAqIHkyID4+IHNoaWZ0OwogICAgICAgICAgICAgICAgb3V0W3BvcysrXSA9IHkwIC0gMC4zNDQxMyAqIHkxIC0gMC43MTQxNCAqIHkyID4+IHNoaWZ0OwogICAgICAgICAgICAgICAgb3V0W3BvcysrXSA9IHkwICsgMS43NzIgKiB5MSA+PiBzaGlmdDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IGpqOyBqKyssIHBvcyArPSBhbHBoYTAxKSB7CiAgICAgICAgICAgICAgICB5MCA9IHkwaXRlbXNbal0gKyBvZmZzZXQ7CiAgICAgICAgICAgICAgICB5MSA9IHkxaXRlbXNbal07CiAgICAgICAgICAgICAgICB5MiA9IHkyaXRlbXNbal07CiAgICAgICAgICAgICAgICB2YXIgZyA9IHkwIC0gKHkyICsgeTEgPj4gMik7CiAgICAgICAgICAgICAgICBvdXRbcG9zKytdID0gZyArIHkyID4+IHNoaWZ0OwogICAgICAgICAgICAgICAgb3V0W3BvcysrXSA9IGcgPj4gc2hpZnQ7CiAgICAgICAgICAgICAgICBvdXRbcG9zKytdID0gZyArIHkxID4+IHNoaWZ0OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGZvdXJDb21wb25lbnRzKSB7CiAgICAgICAgICAgICAgZm9yIChqID0gMCwgcG9zID0gMzsgaiA8IGpqOyBqKyssIHBvcyArPSA0KSB7CiAgICAgICAgICAgICAgICBvdXRbcG9zXSA9IHkzaXRlbXNbal0gKyBvZmZzZXQgPj4gc2hpZnQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmb3IgKGMgPSAwOyBjIDwgY29tcG9uZW50c0NvdW50OyBjKyspIHsKICAgICAgICAgICAgICB2YXIgaXRlbXMgPSB0cmFuc2Zvcm1lZFRpbGVzW2NdLml0ZW1zOwogICAgICAgICAgICAgIHNoaWZ0ID0gY29tcG9uZW50c1tjXS5wcmVjaXNpb24gLSA4OwogICAgICAgICAgICAgIG9mZnNldCA9ICgxMjggPDwgc2hpZnQpICsgMC41OwoKICAgICAgICAgICAgICBmb3IgKHBvcyA9IGMsIGogPSAwLCBqaiA9IGl0ZW1zLmxlbmd0aDsgaiA8IGpqOyBqKyspIHsKICAgICAgICAgICAgICAgIG91dFtwb3NdID0gaXRlbXNbal0gKyBvZmZzZXQgPj4gc2hpZnQ7CiAgICAgICAgICAgICAgICBwb3MgKz0gY29tcG9uZW50c0NvdW50OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJlc3VsdEltYWdlcy5wdXNoKHJlc3VsdCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmVzdWx0SW1hZ2VzOwogICAgICB9CgogICAgICBmdW5jdGlvbiBpbml0aWFsaXplVGlsZShjb250ZXh0LCB0aWxlSW5kZXgpIHsKICAgICAgICB2YXIgc2l6ID0gY29udGV4dC5TSVo7CiAgICAgICAgdmFyIGNvbXBvbmVudHNDb3VudCA9IHNpei5Dc2l6OwogICAgICAgIHZhciB0aWxlID0gY29udGV4dC50aWxlc1t0aWxlSW5kZXhdOwoKICAgICAgICBmb3IgKHZhciBjID0gMDsgYyA8IGNvbXBvbmVudHNDb3VudDsgYysrKSB7CiAgICAgICAgICB2YXIgY29tcG9uZW50ID0gdGlsZS5jb21wb25lbnRzW2NdOwogICAgICAgICAgdmFyIHFjZE9yUWNjID0gY29udGV4dC5jdXJyZW50VGlsZS5RQ0NbY10gIT09IHVuZGVmaW5lZCA/IGNvbnRleHQuY3VycmVudFRpbGUuUUNDW2NdIDogY29udGV4dC5jdXJyZW50VGlsZS5RQ0Q7CiAgICAgICAgICBjb21wb25lbnQucXVhbnRpemF0aW9uUGFyYW1ldGVycyA9IHFjZE9yUWNjOwogICAgICAgICAgdmFyIGNvZE9yQ29jID0gY29udGV4dC5jdXJyZW50VGlsZS5DT0NbY10gIT09IHVuZGVmaW5lZCA/IGNvbnRleHQuY3VycmVudFRpbGUuQ09DW2NdIDogY29udGV4dC5jdXJyZW50VGlsZS5DT0Q7CiAgICAgICAgICBjb21wb25lbnQuY29kaW5nU3R5bGVQYXJhbWV0ZXJzID0gY29kT3JDb2M7CiAgICAgICAgfQoKICAgICAgICB0aWxlLmNvZGluZ1N0eWxlRGVmYXVsdFBhcmFtZXRlcnMgPSBjb250ZXh0LmN1cnJlbnRUaWxlLkNPRDsKICAgICAgfQoKICAgICAgdmFyIFRhZ1RyZWUgPSBmdW5jdGlvbiBUYWdUcmVlQ2xvc3VyZSgpIHsKICAgICAgICBmdW5jdGlvbiBUYWdUcmVlKHdpZHRoLCBoZWlnaHQpIHsKICAgICAgICAgIHZhciBsZXZlbHNMZW5ndGggPSAoMCwgX2NvcmVfdXRpbHMubG9nMikoTWF0aC5tYXgod2lkdGgsIGhlaWdodCkpICsgMTsKICAgICAgICAgIHRoaXMubGV2ZWxzID0gW107CgogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZXZlbHNMZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YXIgbGV2ZWwgPSB7CiAgICAgICAgICAgICAgd2lkdGg6IHdpZHRoLAogICAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0LAogICAgICAgICAgICAgIGl0ZW1zOiBbXQogICAgICAgICAgICB9OwogICAgICAgICAgICB0aGlzLmxldmVscy5wdXNoKGxldmVsKTsKICAgICAgICAgICAgd2lkdGggPSBNYXRoLmNlaWwod2lkdGggLyAyKTsKICAgICAgICAgICAgaGVpZ2h0ID0gTWF0aC5jZWlsKGhlaWdodCAvIDIpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgVGFnVHJlZS5wcm90b3R5cGUgPSB7CiAgICAgICAgICByZXNldDogZnVuY3Rpb24gVGFnVHJlZV9yZXNldChpLCBqKSB7CiAgICAgICAgICAgIHZhciBjdXJyZW50TGV2ZWwgPSAwLAogICAgICAgICAgICAgIHZhbHVlID0gMCwKICAgICAgICAgICAgICBsZXZlbDsKCiAgICAgICAgICAgIHdoaWxlIChjdXJyZW50TGV2ZWwgPCB0aGlzLmxldmVscy5sZW5ndGgpIHsKICAgICAgICAgICAgICBsZXZlbCA9IHRoaXMubGV2ZWxzW2N1cnJlbnRMZXZlbF07CiAgICAgICAgICAgICAgdmFyIGluZGV4ID0gaSArIGogKiBsZXZlbC53aWR0aDsKCiAgICAgICAgICAgICAgaWYgKGxldmVsLml0ZW1zW2luZGV4XSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICB2YWx1ZSA9IGxldmVsLml0ZW1zW2luZGV4XTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgbGV2ZWwuaW5kZXggPSBpbmRleDsKICAgICAgICAgICAgICBpID4+PSAxOwogICAgICAgICAgICAgIGogPj49IDE7CiAgICAgICAgICAgICAgY3VycmVudExldmVsKys7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGN1cnJlbnRMZXZlbC0tOwogICAgICAgICAgICBsZXZlbCA9IHRoaXMubGV2ZWxzW2N1cnJlbnRMZXZlbF07CiAgICAgICAgICAgIGxldmVsLml0ZW1zW2xldmVsLmluZGV4XSA9IHZhbHVlOwogICAgICAgICAgICB0aGlzLmN1cnJlbnRMZXZlbCA9IGN1cnJlbnRMZXZlbDsKICAgICAgICAgICAgZGVsZXRlIHRoaXMudmFsdWU7CiAgICAgICAgICB9LAogICAgICAgICAgaW5jcmVtZW50VmFsdWU6IGZ1bmN0aW9uIFRhZ1RyZWVfaW5jcmVtZW50VmFsdWUoKSB7CiAgICAgICAgICAgIHZhciBsZXZlbCA9IHRoaXMubGV2ZWxzW3RoaXMuY3VycmVudExldmVsXTsKICAgICAgICAgICAgbGV2ZWwuaXRlbXNbbGV2ZWwuaW5kZXhdKys7CiAgICAgICAgICB9LAogICAgICAgICAgbmV4dExldmVsOiBmdW5jdGlvbiBUYWdUcmVlX25leHRMZXZlbCgpIHsKICAgICAgICAgICAgdmFyIGN1cnJlbnRMZXZlbCA9IHRoaXMuY3VycmVudExldmVsOwogICAgICAgICAgICB2YXIgbGV2ZWwgPSB0aGlzLmxldmVsc1tjdXJyZW50TGV2ZWxdOwogICAgICAgICAgICB2YXIgdmFsdWUgPSBsZXZlbC5pdGVtc1tsZXZlbC5pbmRleF07CiAgICAgICAgICAgIGN1cnJlbnRMZXZlbC0tOwoKICAgICAgICAgICAgaWYgKGN1cnJlbnRMZXZlbCA8IDApIHsKICAgICAgICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLmN1cnJlbnRMZXZlbCA9IGN1cnJlbnRMZXZlbDsKICAgICAgICAgICAgbGV2ZWwgPSB0aGlzLmxldmVsc1tjdXJyZW50TGV2ZWxdOwogICAgICAgICAgICBsZXZlbC5pdGVtc1tsZXZlbC5pbmRleF0gPSB2YWx1ZTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gVGFnVHJlZTsKICAgICAgfSgpOwoKICAgICAgdmFyIEluY2x1c2lvblRyZWUgPSBmdW5jdGlvbiBJbmNsdXNpb25UcmVlQ2xvc3VyZSgpIHsKICAgICAgICBmdW5jdGlvbiBJbmNsdXNpb25UcmVlKHdpZHRoLCBoZWlnaHQsIGRlZmF1bHRWYWx1ZSkgewogICAgICAgICAgdmFyIGxldmVsc0xlbmd0aCA9ICgwLCBfY29yZV91dGlscy5sb2cyKShNYXRoLm1heCh3aWR0aCwgaGVpZ2h0KSkgKyAxOwogICAgICAgICAgdGhpcy5sZXZlbHMgPSBbXTsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxldmVsc0xlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHZhciBpdGVtcyA9IG5ldyBVaW50OEFycmF5KHdpZHRoICogaGVpZ2h0KTsKCiAgICAgICAgICAgIGZvciAodmFyIGogPSAwLCBqaiA9IGl0ZW1zLmxlbmd0aDsgaiA8IGpqOyBqKyspIHsKICAgICAgICAgICAgICBpdGVtc1tqXSA9IGRlZmF1bHRWYWx1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGxldmVsID0gewogICAgICAgICAgICAgIHdpZHRoOiB3aWR0aCwKICAgICAgICAgICAgICBoZWlnaHQ6IGhlaWdodCwKICAgICAgICAgICAgICBpdGVtczogaXRlbXMKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdGhpcy5sZXZlbHMucHVzaChsZXZlbCk7CiAgICAgICAgICAgIHdpZHRoID0gTWF0aC5jZWlsKHdpZHRoIC8gMik7CiAgICAgICAgICAgIGhlaWdodCA9IE1hdGguY2VpbChoZWlnaHQgLyAyKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIEluY2x1c2lvblRyZWUucHJvdG90eXBlID0gewogICAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uIEluY2x1c2lvblRyZWVfcmVzZXQoaSwgaiwgc3RvcFZhbHVlKSB7CiAgICAgICAgICAgIHZhciBjdXJyZW50TGV2ZWwgPSAwOwoKICAgICAgICAgICAgd2hpbGUgKGN1cnJlbnRMZXZlbCA8IHRoaXMubGV2ZWxzLmxlbmd0aCkgewogICAgICAgICAgICAgIHZhciBsZXZlbCA9IHRoaXMubGV2ZWxzW2N1cnJlbnRMZXZlbF07CiAgICAgICAgICAgICAgdmFyIGluZGV4ID0gaSArIGogKiBsZXZlbC53aWR0aDsKICAgICAgICAgICAgICBsZXZlbC5pbmRleCA9IGluZGV4OwogICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGxldmVsLml0ZW1zW2luZGV4XTsKCiAgICAgICAgICAgICAgaWYgKHZhbHVlID09PSAweGZmKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICh2YWx1ZSA+IHN0b3BWYWx1ZSkgewogICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50TGV2ZWwgPSBjdXJyZW50TGV2ZWw7CiAgICAgICAgICAgICAgICB0aGlzLnByb3BhZ2F0ZVZhbHVlcygpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaSA+Pj0gMTsKICAgICAgICAgICAgICBqID4+PSAxOwogICAgICAgICAgICAgIGN1cnJlbnRMZXZlbCsrOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLmN1cnJlbnRMZXZlbCA9IGN1cnJlbnRMZXZlbCAtIDE7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfSwKICAgICAgICAgIGluY3JlbWVudFZhbHVlOiBmdW5jdGlvbiBJbmNsdXNpb25UcmVlX2luY3JlbWVudFZhbHVlKHN0b3BWYWx1ZSkgewogICAgICAgICAgICB2YXIgbGV2ZWwgPSB0aGlzLmxldmVsc1t0aGlzLmN1cnJlbnRMZXZlbF07CiAgICAgICAgICAgIGxldmVsLml0ZW1zW2xldmVsLmluZGV4XSA9IHN0b3BWYWx1ZSArIDE7CiAgICAgICAgICAgIHRoaXMucHJvcGFnYXRlVmFsdWVzKCk7CiAgICAgICAgICB9LAogICAgICAgICAgcHJvcGFnYXRlVmFsdWVzOiBmdW5jdGlvbiBJbmNsdXNpb25UcmVlX3Byb3BhZ2F0ZVZhbHVlcygpIHsKICAgICAgICAgICAgdmFyIGxldmVsSW5kZXggPSB0aGlzLmN1cnJlbnRMZXZlbDsKICAgICAgICAgICAgdmFyIGxldmVsID0gdGhpcy5sZXZlbHNbbGV2ZWxJbmRleF07CiAgICAgICAgICAgIHZhciBjdXJyZW50VmFsdWUgPSBsZXZlbC5pdGVtc1tsZXZlbC5pbmRleF07CgogICAgICAgICAgICB3aGlsZSAoLS1sZXZlbEluZGV4ID49IDApIHsKICAgICAgICAgICAgICBsZXZlbCA9IHRoaXMubGV2ZWxzW2xldmVsSW5kZXhdOwogICAgICAgICAgICAgIGxldmVsLml0ZW1zW2xldmVsLmluZGV4XSA9IGN1cnJlbnRWYWx1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgIG5leHRMZXZlbDogZnVuY3Rpb24gSW5jbHVzaW9uVHJlZV9uZXh0TGV2ZWwoKSB7CiAgICAgICAgICAgIHZhciBjdXJyZW50TGV2ZWwgPSB0aGlzLmN1cnJlbnRMZXZlbDsKICAgICAgICAgICAgdmFyIGxldmVsID0gdGhpcy5sZXZlbHNbY3VycmVudExldmVsXTsKICAgICAgICAgICAgdmFyIHZhbHVlID0gbGV2ZWwuaXRlbXNbbGV2ZWwuaW5kZXhdOwogICAgICAgICAgICBsZXZlbC5pdGVtc1tsZXZlbC5pbmRleF0gPSAweGZmOwogICAgICAgICAgICBjdXJyZW50TGV2ZWwtLTsKCiAgICAgICAgICAgIGlmIChjdXJyZW50TGV2ZWwgPCAwKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLmN1cnJlbnRMZXZlbCA9IGN1cnJlbnRMZXZlbDsKICAgICAgICAgICAgbGV2ZWwgPSB0aGlzLmxldmVsc1tjdXJyZW50TGV2ZWxdOwogICAgICAgICAgICBsZXZlbC5pdGVtc1tsZXZlbC5pbmRleF0gPSB2YWx1ZTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gSW5jbHVzaW9uVHJlZTsKICAgICAgfSgpOwoKICAgICAgdmFyIEJpdE1vZGVsID0gZnVuY3Rpb24gQml0TW9kZWxDbG9zdXJlKCkgewogICAgICAgIHZhciBVTklGT1JNX0NPTlRFWFQgPSAxNzsKICAgICAgICB2YXIgUlVOTEVOR1RIX0NPTlRFWFQgPSAxODsKICAgICAgICB2YXIgTExBbmRMSENvbnRleHRzTGFiZWwgPSBuZXcgVWludDhBcnJheShbMCwgNSwgOCwgMCwgMywgNywgOCwgMCwgNCwgNywgOCwgMCwgMCwgMCwgMCwgMCwgMSwgNiwgOCwgMCwgMywgNywgOCwgMCwgNCwgNywgOCwgMCwgMCwgMCwgMCwgMCwgMiwgNiwgOCwgMCwgMywgNywgOCwgMCwgNCwgNywgOCwgMCwgMCwgMCwgMCwgMCwgMiwgNiwgOCwgMCwgMywgNywgOCwgMCwgNCwgNywgOCwgMCwgMCwgMCwgMCwgMCwgMiwgNiwgOCwgMCwgMywgNywgOCwgMCwgNCwgNywgOF0pOwogICAgICAgIHZhciBITENvbnRleHRMYWJlbCA9IG5ldyBVaW50OEFycmF5KFswLCAzLCA0LCAwLCA1LCA3LCA3LCAwLCA4LCA4LCA4LCAwLCAwLCAwLCAwLCAwLCAxLCAzLCA0LCAwLCA2LCA3LCA3LCAwLCA4LCA4LCA4LCAwLCAwLCAwLCAwLCAwLCAyLCAzLCA0LCAwLCA2LCA3LCA3LCAwLCA4LCA4LCA4LCAwLCAwLCAwLCAwLCAwLCAyLCAzLCA0LCAwLCA2LCA3LCA3LCAwLCA4LCA4LCA4LCAwLCAwLCAwLCAwLCAwLCAyLCAzLCA0LCAwLCA2LCA3LCA3LCAwLCA4LCA4LCA4XSk7CiAgICAgICAgdmFyIEhIQ29udGV4dExhYmVsID0gbmV3IFVpbnQ4QXJyYXkoWzAsIDEsIDIsIDAsIDEsIDIsIDIsIDAsIDIsIDIsIDIsIDAsIDAsIDAsIDAsIDAsIDMsIDQsIDUsIDAsIDQsIDUsIDUsIDAsIDUsIDUsIDUsIDAsIDAsIDAsIDAsIDAsIDYsIDcsIDcsIDAsIDcsIDcsIDcsIDAsIDcsIDcsIDcsIDAsIDAsIDAsIDAsIDAsIDgsIDgsIDgsIDAsIDgsIDgsIDgsIDAsIDgsIDgsIDgsIDAsIDAsIDAsIDAsIDAsIDgsIDgsIDgsIDAsIDgsIDgsIDgsIDAsIDgsIDgsIDhdKTsKCiAgICAgICAgZnVuY3Rpb24gQml0TW9kZWwod2lkdGgsIGhlaWdodCwgc3ViYmFuZCwgemVyb0JpdFBsYW5lcywgbWIpIHsKICAgICAgICAgIHRoaXMud2lkdGggPSB3aWR0aDsKICAgICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwogICAgICAgICAgdmFyIGNvbnRleHRMYWJlbFRhYmxlOwoKICAgICAgICAgIGlmIChzdWJiYW5kID09PSAiSEgiKSB7CiAgICAgICAgICAgIGNvbnRleHRMYWJlbFRhYmxlID0gSEhDb250ZXh0TGFiZWw7CiAgICAgICAgICB9IGVsc2UgaWYgKHN1YmJhbmQgPT09ICJITCIpIHsKICAgICAgICAgICAgY29udGV4dExhYmVsVGFibGUgPSBITENvbnRleHRMYWJlbDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnRleHRMYWJlbFRhYmxlID0gTExBbmRMSENvbnRleHRzTGFiZWw7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5jb250ZXh0TGFiZWxUYWJsZSA9IGNvbnRleHRMYWJlbFRhYmxlOwogICAgICAgICAgdmFyIGNvZWZmaWNpZW50Q291bnQgPSB3aWR0aCAqIGhlaWdodDsKICAgICAgICAgIHRoaXMubmVpZ2hib3JzU2lnbmlmaWNhbmNlID0gbmV3IFVpbnQ4QXJyYXkoY29lZmZpY2llbnRDb3VudCk7CiAgICAgICAgICB0aGlzLmNvZWZmaWNlbnRzU2lnbiA9IG5ldyBVaW50OEFycmF5KGNvZWZmaWNpZW50Q291bnQpOwogICAgICAgICAgdmFyIGNvZWZmaWNlbnRzTWFnbml0dWRlOwoKICAgICAgICAgIGlmIChtYiA+IDE0KSB7CiAgICAgICAgICAgIGNvZWZmaWNlbnRzTWFnbml0dWRlID0gbmV3IFVpbnQzMkFycmF5KGNvZWZmaWNpZW50Q291bnQpOwogICAgICAgICAgfSBlbHNlIGlmIChtYiA+IDYpIHsKICAgICAgICAgICAgY29lZmZpY2VudHNNYWduaXR1ZGUgPSBuZXcgVWludDE2QXJyYXkoY29lZmZpY2llbnRDb3VudCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb2VmZmljZW50c01hZ25pdHVkZSA9IG5ldyBVaW50OEFycmF5KGNvZWZmaWNpZW50Q291bnQpOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuY29lZmZpY2VudHNNYWduaXR1ZGUgPSBjb2VmZmljZW50c01hZ25pdHVkZTsKICAgICAgICAgIHRoaXMucHJvY2Vzc2luZ0ZsYWdzID0gbmV3IFVpbnQ4QXJyYXkoY29lZmZpY2llbnRDb3VudCk7CiAgICAgICAgICB2YXIgYml0c0RlY29kZWQgPSBuZXcgVWludDhBcnJheShjb2VmZmljaWVudENvdW50KTsKCiAgICAgICAgICBpZiAoemVyb0JpdFBsYW5lcyAhPT0gMCkgewogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvZWZmaWNpZW50Q291bnQ7IGkrKykgewogICAgICAgICAgICAgIGJpdHNEZWNvZGVkW2ldID0gemVyb0JpdFBsYW5lczsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuYml0c0RlY29kZWQgPSBiaXRzRGVjb2RlZDsKICAgICAgICAgIHRoaXMucmVzZXQoKTsKICAgICAgICB9CgogICAgICAgIEJpdE1vZGVsLnByb3RvdHlwZSA9IHsKICAgICAgICAgIHNldERlY29kZXI6IGZ1bmN0aW9uIEJpdE1vZGVsX3NldERlY29kZXIoZGVjb2RlcikgewogICAgICAgICAgICB0aGlzLmRlY29kZXIgPSBkZWNvZGVyOwogICAgICAgICAgfSwKICAgICAgICAgIHJlc2V0OiBmdW5jdGlvbiBCaXRNb2RlbF9yZXNldCgpIHsKICAgICAgICAgICAgdGhpcy5jb250ZXh0cyA9IG5ldyBJbnQ4QXJyYXkoMTkpOwogICAgICAgICAgICB0aGlzLmNvbnRleHRzWzBdID0gNCA8PCAxIHwgMDsKICAgICAgICAgICAgdGhpcy5jb250ZXh0c1tVTklGT1JNX0NPTlRFWFRdID0gNDYgPDwgMSB8IDA7CiAgICAgICAgICAgIHRoaXMuY29udGV4dHNbUlVOTEVOR1RIX0NPTlRFWFRdID0gMyA8PCAxIHwgMDsKICAgICAgICAgIH0sCiAgICAgICAgICBzZXROZWlnaGJvcnNTaWduaWZpY2FuY2U6IGZ1bmN0aW9uIEJpdE1vZGVsX3NldE5laWdoYm9yc1NpZ25pZmljYW5jZShyb3csIGNvbHVtbiwgaW5kZXgpIHsKICAgICAgICAgICAgdmFyIG5laWdoYm9yc1NpZ25pZmljYW5jZSA9IHRoaXMubmVpZ2hib3JzU2lnbmlmaWNhbmNlOwogICAgICAgICAgICB2YXIgd2lkdGggPSB0aGlzLndpZHRoLAogICAgICAgICAgICAgIGhlaWdodCA9IHRoaXMuaGVpZ2h0OwogICAgICAgICAgICB2YXIgbGVmdCA9IGNvbHVtbiA+IDA7CiAgICAgICAgICAgIHZhciByaWdodCA9IGNvbHVtbiArIDEgPCB3aWR0aDsKICAgICAgICAgICAgdmFyIGk7CgogICAgICAgICAgICBpZiAocm93ID4gMCkgewogICAgICAgICAgICAgIGkgPSBpbmRleCAtIHdpZHRoOwoKICAgICAgICAgICAgICBpZiAobGVmdCkgewogICAgICAgICAgICAgICAgbmVpZ2hib3JzU2lnbmlmaWNhbmNlW2kgLSAxXSArPSAweDEwOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHJpZ2h0KSB7CiAgICAgICAgICAgICAgICBuZWlnaGJvcnNTaWduaWZpY2FuY2VbaSArIDFdICs9IDB4MTA7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBuZWlnaGJvcnNTaWduaWZpY2FuY2VbaV0gKz0gMHgwNDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHJvdyArIDEgPCBoZWlnaHQpIHsKICAgICAgICAgICAgICBpID0gaW5kZXggKyB3aWR0aDsKCiAgICAgICAgICAgICAgaWYgKGxlZnQpIHsKICAgICAgICAgICAgICAgIG5laWdoYm9yc1NpZ25pZmljYW5jZVtpIC0gMV0gKz0gMHgxMDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChyaWdodCkgewogICAgICAgICAgICAgICAgbmVpZ2hib3JzU2lnbmlmaWNhbmNlW2kgKyAxXSArPSAweDEwOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgbmVpZ2hib3JzU2lnbmlmaWNhbmNlW2ldICs9IDB4MDQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChsZWZ0KSB7CiAgICAgICAgICAgICAgbmVpZ2hib3JzU2lnbmlmaWNhbmNlW2luZGV4IC0gMV0gKz0gMHgwMTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHJpZ2h0KSB7CiAgICAgICAgICAgICAgbmVpZ2hib3JzU2lnbmlmaWNhbmNlW2luZGV4ICsgMV0gKz0gMHgwMTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbmVpZ2hib3JzU2lnbmlmaWNhbmNlW2luZGV4XSB8PSAweDgwOwogICAgICAgICAgfSwKICAgICAgICAgIHJ1blNpZ25pZmljYW5jZVByb3BhZ2F0aW9uUGFzczogZnVuY3Rpb24gQml0TW9kZWxfcnVuU2lnbmlmaWNhbmNlUHJvcGFnYXRpb25QYXNzKCkgewogICAgICAgICAgICB2YXIgZGVjb2RlciA9IHRoaXMuZGVjb2RlcjsKICAgICAgICAgICAgdmFyIHdpZHRoID0gdGhpcy53aWR0aCwKICAgICAgICAgICAgICBoZWlnaHQgPSB0aGlzLmhlaWdodDsKICAgICAgICAgICAgdmFyIGNvZWZmaWNlbnRzTWFnbml0dWRlID0gdGhpcy5jb2VmZmljZW50c01hZ25pdHVkZTsKICAgICAgICAgICAgdmFyIGNvZWZmaWNlbnRzU2lnbiA9IHRoaXMuY29lZmZpY2VudHNTaWduOwogICAgICAgICAgICB2YXIgbmVpZ2hib3JzU2lnbmlmaWNhbmNlID0gdGhpcy5uZWlnaGJvcnNTaWduaWZpY2FuY2U7CiAgICAgICAgICAgIHZhciBwcm9jZXNzaW5nRmxhZ3MgPSB0aGlzLnByb2Nlc3NpbmdGbGFnczsKICAgICAgICAgICAgdmFyIGNvbnRleHRzID0gdGhpcy5jb250ZXh0czsKICAgICAgICAgICAgdmFyIGxhYmVscyA9IHRoaXMuY29udGV4dExhYmVsVGFibGU7CiAgICAgICAgICAgIHZhciBiaXRzRGVjb2RlZCA9IHRoaXMuYml0c0RlY29kZWQ7CiAgICAgICAgICAgIHZhciBwcm9jZXNzZWRJbnZlcnNlTWFzayA9IH4xOwogICAgICAgICAgICB2YXIgcHJvY2Vzc2VkTWFzayA9IDE7CiAgICAgICAgICAgIHZhciBmaXJzdE1hZ25pdHVkZUJpdE1hc2sgPSAyOwoKICAgICAgICAgICAgZm9yICh2YXIgaTAgPSAwOyBpMCA8IGhlaWdodDsgaTAgKz0gNCkgewogICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgd2lkdGg7IGorKykgewogICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gaTAgKiB3aWR0aCArIGo7CgogICAgICAgICAgICAgICAgZm9yICh2YXIgaTEgPSAwOyBpMSA8IDQ7IGkxKyssIGluZGV4ICs9IHdpZHRoKSB7CiAgICAgICAgICAgICAgICAgIHZhciBpID0gaTAgKyBpMTsKCiAgICAgICAgICAgICAgICAgIGlmIChpID49IGhlaWdodCkgewogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBwcm9jZXNzaW5nRmxhZ3NbaW5kZXhdICY9IHByb2Nlc3NlZEludmVyc2VNYXNrOwoKICAgICAgICAgICAgICAgICAgaWYgKGNvZWZmaWNlbnRzTWFnbml0dWRlW2luZGV4XSB8fCAhbmVpZ2hib3JzU2lnbmlmaWNhbmNlW2luZGV4XSkgewogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB2YXIgY29udGV4dExhYmVsID0gbGFiZWxzW25laWdoYm9yc1NpZ25pZmljYW5jZVtpbmRleF1dOwogICAgICAgICAgICAgICAgICB2YXIgZGVjaXNpb24gPSBkZWNvZGVyLnJlYWRCaXQoY29udGV4dHMsIGNvbnRleHRMYWJlbCk7CgogICAgICAgICAgICAgICAgICBpZiAoZGVjaXNpb24pIHsKICAgICAgICAgICAgICAgICAgICB2YXIgc2lnbiA9IHRoaXMuZGVjb2RlU2lnbkJpdChpLCBqLCBpbmRleCk7CiAgICAgICAgICAgICAgICAgICAgY29lZmZpY2VudHNTaWduW2luZGV4XSA9IHNpZ247CiAgICAgICAgICAgICAgICAgICAgY29lZmZpY2VudHNNYWduaXR1ZGVbaW5kZXhdID0gMTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNldE5laWdoYm9yc1NpZ25pZmljYW5jZShpLCBqLCBpbmRleCk7CiAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc2luZ0ZsYWdzW2luZGV4XSB8PSBmaXJzdE1hZ25pdHVkZUJpdE1hc2s7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGJpdHNEZWNvZGVkW2luZGV4XSsrOwogICAgICAgICAgICAgICAgICBwcm9jZXNzaW5nRmxhZ3NbaW5kZXhdIHw9IHByb2Nlc3NlZE1hc2s7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgZGVjb2RlU2lnbkJpdDogZnVuY3Rpb24gQml0TW9kZWxfZGVjb2RlU2lnbkJpdChyb3csIGNvbHVtbiwgaW5kZXgpIHsKICAgICAgICAgICAgdmFyIHdpZHRoID0gdGhpcy53aWR0aCwKICAgICAgICAgICAgICBoZWlnaHQgPSB0aGlzLmhlaWdodDsKICAgICAgICAgICAgdmFyIGNvZWZmaWNlbnRzTWFnbml0dWRlID0gdGhpcy5jb2VmZmljZW50c01hZ25pdHVkZTsKICAgICAgICAgICAgdmFyIGNvZWZmaWNlbnRzU2lnbiA9IHRoaXMuY29lZmZpY2VudHNTaWduOwogICAgICAgICAgICB2YXIgY29udHJpYnV0aW9uLCBzaWduMCwgc2lnbjEsIHNpZ25pZmljYW5jZTE7CiAgICAgICAgICAgIHZhciBjb250ZXh0TGFiZWwsIGRlY29kZWQ7CiAgICAgICAgICAgIHNpZ25pZmljYW5jZTEgPSBjb2x1bW4gPiAwICYmIGNvZWZmaWNlbnRzTWFnbml0dWRlW2luZGV4IC0gMV0gIT09IDA7CgogICAgICAgICAgICBpZiAoY29sdW1uICsgMSA8IHdpZHRoICYmIGNvZWZmaWNlbnRzTWFnbml0dWRlW2luZGV4ICsgMV0gIT09IDApIHsKICAgICAgICAgICAgICBzaWduMSA9IGNvZWZmaWNlbnRzU2lnbltpbmRleCArIDFdOwoKICAgICAgICAgICAgICBpZiAoc2lnbmlmaWNhbmNlMSkgewogICAgICAgICAgICAgICAgc2lnbjAgPSBjb2VmZmljZW50c1NpZ25baW5kZXggLSAxXTsKICAgICAgICAgICAgICAgIGNvbnRyaWJ1dGlvbiA9IDEgLSBzaWduMSAtIHNpZ24wOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb250cmlidXRpb24gPSAxIC0gc2lnbjEgLSBzaWduMTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc2lnbmlmaWNhbmNlMSkgewogICAgICAgICAgICAgIHNpZ24wID0gY29lZmZpY2VudHNTaWduW2luZGV4IC0gMV07CiAgICAgICAgICAgICAgY29udHJpYnV0aW9uID0gMSAtIHNpZ24wIC0gc2lnbjA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgY29udHJpYnV0aW9uID0gMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGhvcml6b250YWxDb250cmlidXRpb24gPSAzICogY29udHJpYnV0aW9uOwogICAgICAgICAgICBzaWduaWZpY2FuY2UxID0gcm93ID4gMCAmJiBjb2VmZmljZW50c01hZ25pdHVkZVtpbmRleCAtIHdpZHRoXSAhPT0gMDsKCiAgICAgICAgICAgIGlmIChyb3cgKyAxIDwgaGVpZ2h0ICYmIGNvZWZmaWNlbnRzTWFnbml0dWRlW2luZGV4ICsgd2lkdGhdICE9PSAwKSB7CiAgICAgICAgICAgICAgc2lnbjEgPSBjb2VmZmljZW50c1NpZ25baW5kZXggKyB3aWR0aF07CgogICAgICAgICAgICAgIGlmIChzaWduaWZpY2FuY2UxKSB7CiAgICAgICAgICAgICAgICBzaWduMCA9IGNvZWZmaWNlbnRzU2lnbltpbmRleCAtIHdpZHRoXTsKICAgICAgICAgICAgICAgIGNvbnRyaWJ1dGlvbiA9IDEgLSBzaWduMSAtIHNpZ24wICsgaG9yaXpvbnRhbENvbnRyaWJ1dGlvbjsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29udHJpYnV0aW9uID0gMSAtIHNpZ24xIC0gc2lnbjEgKyBob3Jpem9udGFsQ29udHJpYnV0aW9uOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChzaWduaWZpY2FuY2UxKSB7CiAgICAgICAgICAgICAgc2lnbjAgPSBjb2VmZmljZW50c1NpZ25baW5kZXggLSB3aWR0aF07CiAgICAgICAgICAgICAgY29udHJpYnV0aW9uID0gMSAtIHNpZ24wIC0gc2lnbjAgKyBob3Jpem9udGFsQ29udHJpYnV0aW9uOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGNvbnRyaWJ1dGlvbiA9IGhvcml6b250YWxDb250cmlidXRpb247CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChjb250cmlidXRpb24gPj0gMCkgewogICAgICAgICAgICAgIGNvbnRleHRMYWJlbCA9IDkgKyBjb250cmlidXRpb247CiAgICAgICAgICAgICAgZGVjb2RlZCA9IHRoaXMuZGVjb2Rlci5yZWFkQml0KHRoaXMuY29udGV4dHMsIGNvbnRleHRMYWJlbCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgY29udGV4dExhYmVsID0gOSAtIGNvbnRyaWJ1dGlvbjsKICAgICAgICAgICAgICBkZWNvZGVkID0gdGhpcy5kZWNvZGVyLnJlYWRCaXQodGhpcy5jb250ZXh0cywgY29udGV4dExhYmVsKSBeIDE7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBkZWNvZGVkOwogICAgICAgICAgfSwKICAgICAgICAgIHJ1bk1hZ25pdHVkZVJlZmluZW1lbnRQYXNzOiBmdW5jdGlvbiBCaXRNb2RlbF9ydW5NYWduaXR1ZGVSZWZpbmVtZW50UGFzcygpIHsKICAgICAgICAgICAgdmFyIGRlY29kZXIgPSB0aGlzLmRlY29kZXI7CiAgICAgICAgICAgIHZhciB3aWR0aCA9IHRoaXMud2lkdGgsCiAgICAgICAgICAgICAgaGVpZ2h0ID0gdGhpcy5oZWlnaHQ7CiAgICAgICAgICAgIHZhciBjb2VmZmljZW50c01hZ25pdHVkZSA9IHRoaXMuY29lZmZpY2VudHNNYWduaXR1ZGU7CiAgICAgICAgICAgIHZhciBuZWlnaGJvcnNTaWduaWZpY2FuY2UgPSB0aGlzLm5laWdoYm9yc1NpZ25pZmljYW5jZTsKICAgICAgICAgICAgdmFyIGNvbnRleHRzID0gdGhpcy5jb250ZXh0czsKICAgICAgICAgICAgdmFyIGJpdHNEZWNvZGVkID0gdGhpcy5iaXRzRGVjb2RlZDsKICAgICAgICAgICAgdmFyIHByb2Nlc3NpbmdGbGFncyA9IHRoaXMucHJvY2Vzc2luZ0ZsYWdzOwogICAgICAgICAgICB2YXIgcHJvY2Vzc2VkTWFzayA9IDE7CiAgICAgICAgICAgIHZhciBmaXJzdE1hZ25pdHVkZUJpdE1hc2sgPSAyOwogICAgICAgICAgICB2YXIgbGVuZ3RoID0gd2lkdGggKiBoZWlnaHQ7CiAgICAgICAgICAgIHZhciB3aWR0aDQgPSB3aWR0aCAqIDQ7CgogICAgICAgICAgICBmb3IgKHZhciBpbmRleDAgPSAwLCBpbmRleE5leHQ7IGluZGV4MCA8IGxlbmd0aDsgaW5kZXgwID0gaW5kZXhOZXh0KSB7CiAgICAgICAgICAgICAgaW5kZXhOZXh0ID0gTWF0aC5taW4obGVuZ3RoLCBpbmRleDAgKyB3aWR0aDQpOwoKICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHdpZHRoOyBqKyspIHsKICAgICAgICAgICAgICAgIGZvciAodmFyIGluZGV4ID0gaW5kZXgwICsgajsgaW5kZXggPCBpbmRleE5leHQ7IGluZGV4ICs9IHdpZHRoKSB7CiAgICAgICAgICAgICAgICAgIGlmICghY29lZmZpY2VudHNNYWduaXR1ZGVbaW5kZXhdIHx8IChwcm9jZXNzaW5nRmxhZ3NbaW5kZXhdICYgcHJvY2Vzc2VkTWFzaykgIT09IDApIHsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgdmFyIGNvbnRleHRMYWJlbCA9IDE2OwoKICAgICAgICAgICAgICAgICAgaWYgKChwcm9jZXNzaW5nRmxhZ3NbaW5kZXhdICYgZmlyc3RNYWduaXR1ZGVCaXRNYXNrKSAhPT0gMCkgewogICAgICAgICAgICAgICAgICAgIHByb2Nlc3NpbmdGbGFnc1tpbmRleF0gXj0gZmlyc3RNYWduaXR1ZGVCaXRNYXNrOwogICAgICAgICAgICAgICAgICAgIHZhciBzaWduaWZpY2FuY2UgPSBuZWlnaGJvcnNTaWduaWZpY2FuY2VbaW5kZXhdICYgMTI3OwogICAgICAgICAgICAgICAgICAgIGNvbnRleHRMYWJlbCA9IHNpZ25pZmljYW5jZSA9PT0gMCA/IDE1IDogMTQ7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIHZhciBiaXQgPSBkZWNvZGVyLnJlYWRCaXQoY29udGV4dHMsIGNvbnRleHRMYWJlbCk7CiAgICAgICAgICAgICAgICAgIGNvZWZmaWNlbnRzTWFnbml0dWRlW2luZGV4XSA9IGNvZWZmaWNlbnRzTWFnbml0dWRlW2luZGV4XSA8PCAxIHwgYml0OwogICAgICAgICAgICAgICAgICBiaXRzRGVjb2RlZFtpbmRleF0rKzsKICAgICAgICAgICAgICAgICAgcHJvY2Vzc2luZ0ZsYWdzW2luZGV4XSB8PSBwcm9jZXNzZWRNYXNrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgIHJ1bkNsZWFudXBQYXNzOiBmdW5jdGlvbiBCaXRNb2RlbF9ydW5DbGVhbnVwUGFzcygpIHsKICAgICAgICAgICAgdmFyIGRlY29kZXIgPSB0aGlzLmRlY29kZXI7CiAgICAgICAgICAgIHZhciB3aWR0aCA9IHRoaXMud2lkdGgsCiAgICAgICAgICAgICAgaGVpZ2h0ID0gdGhpcy5oZWlnaHQ7CiAgICAgICAgICAgIHZhciBuZWlnaGJvcnNTaWduaWZpY2FuY2UgPSB0aGlzLm5laWdoYm9yc1NpZ25pZmljYW5jZTsKICAgICAgICAgICAgdmFyIGNvZWZmaWNlbnRzTWFnbml0dWRlID0gdGhpcy5jb2VmZmljZW50c01hZ25pdHVkZTsKICAgICAgICAgICAgdmFyIGNvZWZmaWNlbnRzU2lnbiA9IHRoaXMuY29lZmZpY2VudHNTaWduOwogICAgICAgICAgICB2YXIgY29udGV4dHMgPSB0aGlzLmNvbnRleHRzOwogICAgICAgICAgICB2YXIgbGFiZWxzID0gdGhpcy5jb250ZXh0TGFiZWxUYWJsZTsKICAgICAgICAgICAgdmFyIGJpdHNEZWNvZGVkID0gdGhpcy5iaXRzRGVjb2RlZDsKICAgICAgICAgICAgdmFyIHByb2Nlc3NpbmdGbGFncyA9IHRoaXMucHJvY2Vzc2luZ0ZsYWdzOwogICAgICAgICAgICB2YXIgcHJvY2Vzc2VkTWFzayA9IDE7CiAgICAgICAgICAgIHZhciBmaXJzdE1hZ25pdHVkZUJpdE1hc2sgPSAyOwogICAgICAgICAgICB2YXIgb25lUm93RG93biA9IHdpZHRoOwogICAgICAgICAgICB2YXIgdHdvUm93c0Rvd24gPSB3aWR0aCAqIDI7CiAgICAgICAgICAgIHZhciB0aHJlZVJvd3NEb3duID0gd2lkdGggKiAzOwogICAgICAgICAgICB2YXIgaU5leHQ7CgogICAgICAgICAgICBmb3IgKHZhciBpMCA9IDA7IGkwIDwgaGVpZ2h0OyBpMCA9IGlOZXh0KSB7CiAgICAgICAgICAgICAgaU5leHQgPSBNYXRoLm1pbihpMCArIDQsIGhlaWdodCk7CiAgICAgICAgICAgICAgdmFyIGluZGV4QmFzZSA9IGkwICogd2lkdGg7CiAgICAgICAgICAgICAgdmFyIGNoZWNrQWxsRW1wdHkgPSBpMCArIDMgPCBoZWlnaHQ7CgogICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgd2lkdGg7IGorKykgewogICAgICAgICAgICAgICAgdmFyIGluZGV4MCA9IGluZGV4QmFzZSArIGo7CiAgICAgICAgICAgICAgICB2YXIgYWxsRW1wdHkgPSBjaGVja0FsbEVtcHR5ICYmIHByb2Nlc3NpbmdGbGFnc1tpbmRleDBdID09PSAwICYmIHByb2Nlc3NpbmdGbGFnc1tpbmRleDAgKyBvbmVSb3dEb3duXSA9PT0gMCAmJiBwcm9jZXNzaW5nRmxhZ3NbaW5kZXgwICsgdHdvUm93c0Rvd25dID09PSAwICYmIHByb2Nlc3NpbmdGbGFnc1tpbmRleDAgKyB0aHJlZVJvd3NEb3duXSA9PT0gMCAmJiBuZWlnaGJvcnNTaWduaWZpY2FuY2VbaW5kZXgwXSA9PT0gMCAmJiBuZWlnaGJvcnNTaWduaWZpY2FuY2VbaW5kZXgwICsgb25lUm93RG93bl0gPT09IDAgJiYgbmVpZ2hib3JzU2lnbmlmaWNhbmNlW2luZGV4MCArIHR3b1Jvd3NEb3duXSA9PT0gMCAmJiBuZWlnaGJvcnNTaWduaWZpY2FuY2VbaW5kZXgwICsgdGhyZWVSb3dzRG93bl0gPT09IDA7CiAgICAgICAgICAgICAgICB2YXIgaTEgPSAwLAogICAgICAgICAgICAgICAgICBpbmRleCA9IGluZGV4MDsKICAgICAgICAgICAgICAgIHZhciBpID0gaTAsCiAgICAgICAgICAgICAgICAgIHNpZ247CgogICAgICAgICAgICAgICAgaWYgKGFsbEVtcHR5KSB7CiAgICAgICAgICAgICAgICAgIHZhciBoYXNTaWduaWZpY2FudENvZWZmaWNlbnQgPSBkZWNvZGVyLnJlYWRCaXQoY29udGV4dHMsIFJVTkxFTkdUSF9DT05URVhUKTsKCiAgICAgICAgICAgICAgICAgIGlmICghaGFzU2lnbmlmaWNhbnRDb2VmZmljZW50KSB7CiAgICAgICAgICAgICAgICAgICAgYml0c0RlY29kZWRbaW5kZXgwXSsrOwogICAgICAgICAgICAgICAgICAgIGJpdHNEZWNvZGVkW2luZGV4MCArIG9uZVJvd0Rvd25dKys7CiAgICAgICAgICAgICAgICAgICAgYml0c0RlY29kZWRbaW5kZXgwICsgdHdvUm93c0Rvd25dKys7CiAgICAgICAgICAgICAgICAgICAgYml0c0RlY29kZWRbaW5kZXgwICsgdGhyZWVSb3dzRG93bl0rKzsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgaTEgPSBkZWNvZGVyLnJlYWRCaXQoY29udGV4dHMsIFVOSUZPUk1fQ09OVEVYVCkgPDwgMSB8IGRlY29kZXIucmVhZEJpdChjb250ZXh0cywgVU5JRk9STV9DT05URVhUKTsKCiAgICAgICAgICAgICAgICAgIGlmIChpMSAhPT0gMCkgewogICAgICAgICAgICAgICAgICAgIGkgPSBpMCArIGkxOwogICAgICAgICAgICAgICAgICAgIGluZGV4ICs9IGkxICogd2lkdGg7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIHNpZ24gPSB0aGlzLmRlY29kZVNpZ25CaXQoaSwgaiwgaW5kZXgpOwogICAgICAgICAgICAgICAgICBjb2VmZmljZW50c1NpZ25baW5kZXhdID0gc2lnbjsKICAgICAgICAgICAgICAgICAgY29lZmZpY2VudHNNYWduaXR1ZGVbaW5kZXhdID0gMTsKICAgICAgICAgICAgICAgICAgdGhpcy5zZXROZWlnaGJvcnNTaWduaWZpY2FuY2UoaSwgaiwgaW5kZXgpOwogICAgICAgICAgICAgICAgICBwcm9jZXNzaW5nRmxhZ3NbaW5kZXhdIHw9IGZpcnN0TWFnbml0dWRlQml0TWFzazsKICAgICAgICAgICAgICAgICAgaW5kZXggPSBpbmRleDA7CgogICAgICAgICAgICAgICAgICBmb3IgKHZhciBpMiA9IGkwOyBpMiA8PSBpOyBpMisrLCBpbmRleCArPSB3aWR0aCkgewogICAgICAgICAgICAgICAgICAgIGJpdHNEZWNvZGVkW2luZGV4XSsrOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBpMSsrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZvciAoaSA9IGkwICsgaTE7IGkgPCBpTmV4dDsgaSsrLCBpbmRleCArPSB3aWR0aCkgewogICAgICAgICAgICAgICAgICBpZiAoY29lZmZpY2VudHNNYWduaXR1ZGVbaW5kZXhdIHx8IChwcm9jZXNzaW5nRmxhZ3NbaW5kZXhdICYgcHJvY2Vzc2VkTWFzaykgIT09IDApIHsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgdmFyIGNvbnRleHRMYWJlbCA9IGxhYmVsc1tuZWlnaGJvcnNTaWduaWZpY2FuY2VbaW5kZXhdXTsKICAgICAgICAgICAgICAgICAgdmFyIGRlY2lzaW9uID0gZGVjb2Rlci5yZWFkQml0KGNvbnRleHRzLCBjb250ZXh0TGFiZWwpOwoKICAgICAgICAgICAgICAgICAgaWYgKGRlY2lzaW9uID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgc2lnbiA9IHRoaXMuZGVjb2RlU2lnbkJpdChpLCBqLCBpbmRleCk7CiAgICAgICAgICAgICAgICAgICAgY29lZmZpY2VudHNTaWduW2luZGV4XSA9IHNpZ247CiAgICAgICAgICAgICAgICAgICAgY29lZmZpY2VudHNNYWduaXR1ZGVbaW5kZXhdID0gMTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNldE5laWdoYm9yc1NpZ25pZmljYW5jZShpLCBqLCBpbmRleCk7CiAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc2luZ0ZsYWdzW2luZGV4XSB8PSBmaXJzdE1hZ25pdHVkZUJpdE1hc2s7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGJpdHNEZWNvZGVkW2luZGV4XSsrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgIGNoZWNrU2VnbWVudGF0aW9uU3ltYm9sOiBmdW5jdGlvbiBCaXRNb2RlbF9jaGVja1NlZ21lbnRhdGlvblN5bWJvbCgpIHsKICAgICAgICAgICAgdmFyIGRlY29kZXIgPSB0aGlzLmRlY29kZXI7CiAgICAgICAgICAgIHZhciBjb250ZXh0cyA9IHRoaXMuY29udGV4dHM7CiAgICAgICAgICAgIHZhciBzeW1ib2wgPSBkZWNvZGVyLnJlYWRCaXQoY29udGV4dHMsIFVOSUZPUk1fQ09OVEVYVCkgPDwgMyB8IGRlY29kZXIucmVhZEJpdChjb250ZXh0cywgVU5JRk9STV9DT05URVhUKSA8PCAyIHwgZGVjb2Rlci5yZWFkQml0KGNvbnRleHRzLCBVTklGT1JNX0NPTlRFWFQpIDw8IDEgfCBkZWNvZGVyLnJlYWRCaXQoY29udGV4dHMsIFVOSUZPUk1fQ09OVEVYVCk7CgogICAgICAgICAgICBpZiAoc3ltYm9sICE9PSAweGEpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgSnB4RXJyb3IoIkludmFsaWQgc2VnbWVudGF0aW9uIHN5bWJvbCIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gQml0TW9kZWw7CiAgICAgIH0oKTsKCiAgICAgIHZhciBUcmFuc2Zvcm0gPSBmdW5jdGlvbiBUcmFuc2Zvcm1DbG9zdXJlKCkgewogICAgICAgIGZ1bmN0aW9uIFRyYW5zZm9ybSgpIHt9CgogICAgICAgIFRyYW5zZm9ybS5wcm90b3R5cGUuY2FsY3VsYXRlID0gZnVuY3Rpb24gdHJhbnNmb3JtQ2FsY3VsYXRlKHN1YmJhbmRzLCB1MCwgdjApIHsKICAgICAgICAgIHZhciBsbCA9IHN1YmJhbmRzWzBdOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAxLCBpaSA9IHN1YmJhbmRzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgbGwgPSB0aGlzLml0ZXJhdGUobGwsIHN1YmJhbmRzW2ldLCB1MCwgdjApOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBsbDsKICAgICAgICB9OwoKICAgICAgICBUcmFuc2Zvcm0ucHJvdG90eXBlLmV4dGVuZCA9IGZ1bmN0aW9uIGV4dGVuZChidWZmZXIsIG9mZnNldCwgc2l6ZSkgewogICAgICAgICAgdmFyIGkxID0gb2Zmc2V0IC0gMSwKICAgICAgICAgICAgajEgPSBvZmZzZXQgKyAxOwogICAgICAgICAgdmFyIGkyID0gb2Zmc2V0ICsgc2l6ZSAtIDIsCiAgICAgICAgICAgIGoyID0gb2Zmc2V0ICsgc2l6ZTsKICAgICAgICAgIGJ1ZmZlcltpMS0tXSA9IGJ1ZmZlcltqMSsrXTsKICAgICAgICAgIGJ1ZmZlcltqMisrXSA9IGJ1ZmZlcltpMi0tXTsKICAgICAgICAgIGJ1ZmZlcltpMS0tXSA9IGJ1ZmZlcltqMSsrXTsKICAgICAgICAgIGJ1ZmZlcltqMisrXSA9IGJ1ZmZlcltpMi0tXTsKICAgICAgICAgIGJ1ZmZlcltpMS0tXSA9IGJ1ZmZlcltqMSsrXTsKICAgICAgICAgIGJ1ZmZlcltqMisrXSA9IGJ1ZmZlcltpMi0tXTsKICAgICAgICAgIGJ1ZmZlcltpMV0gPSBidWZmZXJbajFdOwogICAgICAgICAgYnVmZmVyW2oyXSA9IGJ1ZmZlcltpMl07CiAgICAgICAgfTsKCiAgICAgICAgVHJhbnNmb3JtLnByb3RvdHlwZS5pdGVyYXRlID0gZnVuY3Rpb24gVHJhbnNmb3JtX2l0ZXJhdGUobGwsIGhsX2xoX2hoLCB1MCwgdjApIHsKICAgICAgICAgIHZhciBsbFdpZHRoID0gbGwud2lkdGgsCiAgICAgICAgICAgIGxsSGVpZ2h0ID0gbGwuaGVpZ2h0LAogICAgICAgICAgICBsbEl0ZW1zID0gbGwuaXRlbXM7CiAgICAgICAgICB2YXIgd2lkdGggPSBobF9saF9oaC53aWR0aDsKICAgICAgICAgIHZhciBoZWlnaHQgPSBobF9saF9oaC5oZWlnaHQ7CiAgICAgICAgICB2YXIgaXRlbXMgPSBobF9saF9oaC5pdGVtczsKICAgICAgICAgIHZhciBpLCBqLCBrLCBsLCB1LCB2OwoKICAgICAgICAgIGZvciAoayA9IDAsIGkgPSAwOyBpIDwgbGxIZWlnaHQ7IGkrKykgewogICAgICAgICAgICBsID0gaSAqIDIgKiB3aWR0aDsKCiAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBsbFdpZHRoOyBqKyssIGsrKywgbCArPSAyKSB7CiAgICAgICAgICAgICAgaXRlbXNbbF0gPSBsbEl0ZW1zW2tdOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgbGxJdGVtcyA9IGxsLml0ZW1zID0gbnVsbDsKICAgICAgICAgIHZhciBidWZmZXJQYWRkaW5nID0gNDsKICAgICAgICAgIHZhciByb3dCdWZmZXIgPSBuZXcgRmxvYXQzMkFycmF5KHdpZHRoICsgMiAqIGJ1ZmZlclBhZGRpbmcpOwoKICAgICAgICAgIGlmICh3aWR0aCA9PT0gMSkgewogICAgICAgICAgICBpZiAoKHUwICYgMSkgIT09IDApIHsKICAgICAgICAgICAgICBmb3IgKHYgPSAwLCBrID0gMDsgdiA8IGhlaWdodDsgdisrLCBrICs9IHdpZHRoKSB7CiAgICAgICAgICAgICAgICBpdGVtc1trXSAqPSAwLjU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmb3IgKHYgPSAwLCBrID0gMDsgdiA8IGhlaWdodDsgdisrLCBrICs9IHdpZHRoKSB7CiAgICAgICAgICAgICAgcm93QnVmZmVyLnNldChpdGVtcy5zdWJhcnJheShrLCBrICsgd2lkdGgpLCBidWZmZXJQYWRkaW5nKTsKICAgICAgICAgICAgICB0aGlzLmV4dGVuZChyb3dCdWZmZXIsIGJ1ZmZlclBhZGRpbmcsIHdpZHRoKTsKICAgICAgICAgICAgICB0aGlzLmZpbHRlcihyb3dCdWZmZXIsIGJ1ZmZlclBhZGRpbmcsIHdpZHRoKTsKICAgICAgICAgICAgICBpdGVtcy5zZXQocm93QnVmZmVyLnN1YmFycmF5KGJ1ZmZlclBhZGRpbmcsIGJ1ZmZlclBhZGRpbmcgKyB3aWR0aCksIGspOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIG51bUJ1ZmZlcnMgPSAxNjsKICAgICAgICAgIHZhciBjb2xCdWZmZXJzID0gW107CgogICAgICAgICAgZm9yIChpID0gMDsgaSA8IG51bUJ1ZmZlcnM7IGkrKykgewogICAgICAgICAgICBjb2xCdWZmZXJzLnB1c2gobmV3IEZsb2F0MzJBcnJheShoZWlnaHQgKyAyICogYnVmZmVyUGFkZGluZykpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBiLAogICAgICAgICAgICBjdXJyZW50QnVmZmVyID0gMDsKICAgICAgICAgIGxsID0gYnVmZmVyUGFkZGluZyArIGhlaWdodDsKCiAgICAgICAgICBpZiAoaGVpZ2h0ID09PSAxKSB7CiAgICAgICAgICAgIGlmICgodjAgJiAxKSAhPT0gMCkgewogICAgICAgICAgICAgIGZvciAodSA9IDA7IHUgPCB3aWR0aDsgdSsrKSB7CiAgICAgICAgICAgICAgICBpdGVtc1t1XSAqPSAwLjU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmb3IgKHUgPSAwOyB1IDwgd2lkdGg7IHUrKykgewogICAgICAgICAgICAgIGlmIChjdXJyZW50QnVmZmVyID09PSAwKSB7CiAgICAgICAgICAgICAgICBudW1CdWZmZXJzID0gTWF0aC5taW4od2lkdGggLSB1LCBudW1CdWZmZXJzKTsKCiAgICAgICAgICAgICAgICBmb3IgKGsgPSB1LCBsID0gYnVmZmVyUGFkZGluZzsgbCA8IGxsOyBrICs9IHdpZHRoLCBsKyspIHsKICAgICAgICAgICAgICAgICAgZm9yIChiID0gMDsgYiA8IG51bUJ1ZmZlcnM7IGIrKykgewogICAgICAgICAgICAgICAgICAgIGNvbEJ1ZmZlcnNbYl1bbF0gPSBpdGVtc1trICsgYl07CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjdXJyZW50QnVmZmVyID0gbnVtQnVmZmVyczsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGN1cnJlbnRCdWZmZXItLTsKICAgICAgICAgICAgICB2YXIgYnVmZmVyID0gY29sQnVmZmVyc1tjdXJyZW50QnVmZmVyXTsKICAgICAgICAgICAgICB0aGlzLmV4dGVuZChidWZmZXIsIGJ1ZmZlclBhZGRpbmcsIGhlaWdodCk7CiAgICAgICAgICAgICAgdGhpcy5maWx0ZXIoYnVmZmVyLCBidWZmZXJQYWRkaW5nLCBoZWlnaHQpOwoKICAgICAgICAgICAgICBpZiAoY3VycmVudEJ1ZmZlciA9PT0gMCkgewogICAgICAgICAgICAgICAgayA9IHUgLSBudW1CdWZmZXJzICsgMTsKCiAgICAgICAgICAgICAgICBmb3IgKGwgPSBidWZmZXJQYWRkaW5nOyBsIDwgbGw7IGsgKz0gd2lkdGgsIGwrKykgewogICAgICAgICAgICAgICAgICBmb3IgKGIgPSAwOyBiIDwgbnVtQnVmZmVyczsgYisrKSB7CiAgICAgICAgICAgICAgICAgICAgaXRlbXNbayArIGJdID0gY29sQnVmZmVyc1tiXVtsXTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHdpZHRoOiB3aWR0aCwKICAgICAgICAgICAgaGVpZ2h0OiBoZWlnaHQsCiAgICAgICAgICAgIGl0ZW1zOiBpdGVtcwogICAgICAgICAgfTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gVHJhbnNmb3JtOwogICAgICB9KCk7CgogICAgICB2YXIgSXJyZXZlcnNpYmxlVHJhbnNmb3JtID0gZnVuY3Rpb24gSXJyZXZlcnNpYmxlVHJhbnNmb3JtQ2xvc3VyZSgpIHsKICAgICAgICBmdW5jdGlvbiBJcnJldmVyc2libGVUcmFuc2Zvcm0oKSB7CiAgICAgICAgICBUcmFuc2Zvcm0uY2FsbCh0aGlzKTsKICAgICAgICB9CgogICAgICAgIElycmV2ZXJzaWJsZVRyYW5zZm9ybS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFRyYW5zZm9ybS5wcm90b3R5cGUpOwoKICAgICAgICBJcnJldmVyc2libGVUcmFuc2Zvcm0ucHJvdG90eXBlLmZpbHRlciA9IGZ1bmN0aW9uIGlycmV2ZXJzaWJsZVRyYW5zZm9ybUZpbHRlcih4LCBvZmZzZXQsIGxlbmd0aCkgewogICAgICAgICAgdmFyIGxlbiA9IGxlbmd0aCA+PiAxOwogICAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0IHwgMDsKICAgICAgICAgIHZhciBqLCBuLCBjdXJyZW50LCBuZXh0OwogICAgICAgICAgdmFyIGFscGhhID0gLTEuNTg2MTM0MzQyMDU5OTI0OwogICAgICAgICAgdmFyIGJldGEgPSAtMC4wNTI5ODAxMTg1NzI5NjE7CiAgICAgICAgICB2YXIgZ2FtbWEgPSAwLjg4MjkxMTA3NTUzMDkzNDsKICAgICAgICAgIHZhciBkZWx0YSA9IDAuNDQzNTA2ODUyMDQzOTcxOwogICAgICAgICAgdmFyIEsgPSAxLjIzMDE3NDEwNDkxNDAwMTsKICAgICAgICAgIHZhciBLXyA9IDEgLyBLOwogICAgICAgICAgaiA9IG9mZnNldCAtIDM7CgogICAgICAgICAgZm9yIChuID0gbGVuICsgNDsgbi0tOyBqICs9IDIpIHsKICAgICAgICAgICAgeFtqXSAqPSBLXzsKICAgICAgICAgIH0KCiAgICAgICAgICBqID0gb2Zmc2V0IC0gMjsKICAgICAgICAgIGN1cnJlbnQgPSBkZWx0YSAqIHhbaiAtIDFdOwoKICAgICAgICAgIGZvciAobiA9IGxlbiArIDM7IG4tLTsgaiArPSAyKSB7CiAgICAgICAgICAgIG5leHQgPSBkZWx0YSAqIHhbaiArIDFdOwogICAgICAgICAgICB4W2pdID0gSyAqIHhbal0gLSBjdXJyZW50IC0gbmV4dDsKCiAgICAgICAgICAgIGlmIChuLS0pIHsKICAgICAgICAgICAgICBqICs9IDI7CiAgICAgICAgICAgICAgY3VycmVudCA9IGRlbHRhICogeFtqICsgMV07CiAgICAgICAgICAgICAgeFtqXSA9IEsgKiB4W2pdIC0gY3VycmVudCAtIG5leHQ7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBqID0gb2Zmc2V0IC0gMTsKICAgICAgICAgIGN1cnJlbnQgPSBnYW1tYSAqIHhbaiAtIDFdOwoKICAgICAgICAgIGZvciAobiA9IGxlbiArIDI7IG4tLTsgaiArPSAyKSB7CiAgICAgICAgICAgIG5leHQgPSBnYW1tYSAqIHhbaiArIDFdOwogICAgICAgICAgICB4W2pdIC09IGN1cnJlbnQgKyBuZXh0OwoKICAgICAgICAgICAgaWYgKG4tLSkgewogICAgICAgICAgICAgIGogKz0gMjsKICAgICAgICAgICAgICBjdXJyZW50ID0gZ2FtbWEgKiB4W2ogKyAxXTsKICAgICAgICAgICAgICB4W2pdIC09IGN1cnJlbnQgKyBuZXh0OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaiA9IG9mZnNldDsKICAgICAgICAgIGN1cnJlbnQgPSBiZXRhICogeFtqIC0gMV07CgogICAgICAgICAgZm9yIChuID0gbGVuICsgMTsgbi0tOyBqICs9IDIpIHsKICAgICAgICAgICAgbmV4dCA9IGJldGEgKiB4W2ogKyAxXTsKICAgICAgICAgICAgeFtqXSAtPSBjdXJyZW50ICsgbmV4dDsKCiAgICAgICAgICAgIGlmIChuLS0pIHsKICAgICAgICAgICAgICBqICs9IDI7CiAgICAgICAgICAgICAgY3VycmVudCA9IGJldGEgKiB4W2ogKyAxXTsKICAgICAgICAgICAgICB4W2pdIC09IGN1cnJlbnQgKyBuZXh0OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGxlbiAhPT0gMCkgewogICAgICAgICAgICBqID0gb2Zmc2V0ICsgMTsKICAgICAgICAgICAgY3VycmVudCA9IGFscGhhICogeFtqIC0gMV07CgogICAgICAgICAgICBmb3IgKG4gPSBsZW47IG4tLTsgaiArPSAyKSB7CiAgICAgICAgICAgICAgbmV4dCA9IGFscGhhICogeFtqICsgMV07CiAgICAgICAgICAgICAgeFtqXSAtPSBjdXJyZW50ICsgbmV4dDsKCiAgICAgICAgICAgICAgaWYgKG4tLSkgewogICAgICAgICAgICAgICAgaiArPSAyOwogICAgICAgICAgICAgICAgY3VycmVudCA9IGFscGhhICogeFtqICsgMV07CiAgICAgICAgICAgICAgICB4W2pdIC09IGN1cnJlbnQgKyBuZXh0OwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICByZXR1cm4gSXJyZXZlcnNpYmxlVHJhbnNmb3JtOwogICAgICB9KCk7CgogICAgICB2YXIgUmV2ZXJzaWJsZVRyYW5zZm9ybSA9IGZ1bmN0aW9uIFJldmVyc2libGVUcmFuc2Zvcm1DbG9zdXJlKCkgewogICAgICAgIGZ1bmN0aW9uIFJldmVyc2libGVUcmFuc2Zvcm0oKSB7CiAgICAgICAgICBUcmFuc2Zvcm0uY2FsbCh0aGlzKTsKICAgICAgICB9CgogICAgICAgIFJldmVyc2libGVUcmFuc2Zvcm0ucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShUcmFuc2Zvcm0ucHJvdG90eXBlKTsKCiAgICAgICAgUmV2ZXJzaWJsZVRyYW5zZm9ybS5wcm90b3R5cGUuZmlsdGVyID0gZnVuY3Rpb24gcmV2ZXJzaWJsZVRyYW5zZm9ybUZpbHRlcih4LCBvZmZzZXQsIGxlbmd0aCkgewogICAgICAgICAgdmFyIGxlbiA9IGxlbmd0aCA+PiAxOwogICAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0IHwgMDsKICAgICAgICAgIHZhciBqLCBuOwoKICAgICAgICAgIGZvciAoaiA9IG9mZnNldCwgbiA9IGxlbiArIDE7IG4tLTsgaiArPSAyKSB7CiAgICAgICAgICAgIHhbal0gLT0geFtqIC0gMV0gKyB4W2ogKyAxXSArIDIgPj4gMjsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3IgKGogPSBvZmZzZXQgKyAxLCBuID0gbGVuOyBuLS07IGogKz0gMikgewogICAgICAgICAgICB4W2pdICs9IHhbaiAtIDFdICsgeFtqICsgMV0gPj4gMTsKICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICByZXR1cm4gUmV2ZXJzaWJsZVRyYW5zZm9ybTsKICAgICAgfSgpOwoKICAgICAgcmV0dXJuIEpweEltYWdlOwogICAgfSgpOwoKICAgIGV4cG9ydHMuSnB4SW1hZ2UgPSBKcHhJbWFnZTsKCiAgICAvKioqL30pLCAoCiAgLyogMjExICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgIHZhbHVlOiB0cnVlCiAgICB9KTsKICAgIGV4cG9ydHMuY2FsY3VsYXRlU0hBNTEyID0gZXhwb3J0cy5jYWxjdWxhdGVTSEEzODQgPSBleHBvcnRzLmNhbGN1bGF0ZVNIQTI1NiA9IGV4cG9ydHMuY2FsY3VsYXRlTUQ1ID0gZXhwb3J0cy5QREYyMCA9IGV4cG9ydHMuUERGMTcgPSBleHBvcnRzLkNpcGhlclRyYW5zZm9ybUZhY3RvcnkgPSBleHBvcnRzLkFSQ0ZvdXJDaXBoZXIgPSBleHBvcnRzLkFFUzI1NkNpcGhlciA9IGV4cG9ydHMuQUVTMTI4Q2lwaGVyID0gdm9pZCAwOwoKICAgIHZhciBfdXRpbCA9IF9fd19wZGZqc19yZXF1aXJlX18oNSk7CgogICAgdmFyIF9wcmltaXRpdmVzID0gX193X3BkZmpzX3JlcXVpcmVfXygxOTQpOwoKICAgIHZhciBfc3RyZWFtID0gX193X3BkZmpzX3JlcXVpcmVfXygyMDEpOwoKICAgIGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mIjtpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAic3ltYm9sIikge190eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikge3JldHVybiB0eXBlb2Ygb2JqO307fSBlbHNlIHtfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHtyZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqO307fXJldHVybiBfdHlwZW9mKG9iaik7fQoKICAgIGZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHtpZiAoY2FsbCAmJiAoX3R5cGVvZihjYWxsKSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7cmV0dXJuIGNhbGw7fXJldHVybiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpO30KCiAgICBmdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHtpZiAoc2VsZiA9PT0gdm9pZCAwKSB7dGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTt9cmV0dXJuIHNlbGY7fQoKICAgIGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7X2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHtyZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pO307cmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTt9CgogICAgZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7aWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpO31zdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7aWYgKHN1cGVyQ2xhc3MpIF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7fQoKICAgIGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7X3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7by5fX3Byb3RvX18gPSBwO3JldHVybiBvO307cmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTt9CgogICAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3Rvcikge2lmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7fX0KCiAgICBmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7Zm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykge3ZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07ZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlO2Rlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTtpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTtPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7fX0KCiAgICBmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7aWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7aWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpO3JldHVybiBDb25zdHJ1Y3Rvcjt9CgogICAgdmFyIEFSQ0ZvdXJDaXBoZXIgPSBmdW5jdGlvbiBBUkNGb3VyQ2lwaGVyQ2xvc3VyZSgpIHsKICAgICAgZnVuY3Rpb24gQVJDRm91ckNpcGhlcihrZXkpIHsKICAgICAgICB0aGlzLmEgPSAwOwogICAgICAgIHRoaXMuYiA9IDA7CiAgICAgICAgdmFyIHMgPSBuZXcgVWludDhBcnJheSgyNTYpOwogICAgICAgIHZhciBpLAogICAgICAgICAgaiA9IDAsCiAgICAgICAgICB0bXAsCiAgICAgICAgICBrZXlMZW5ndGggPSBrZXkubGVuZ3RoOwoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgMjU2OyArK2kpIHsKICAgICAgICAgIHNbaV0gPSBpOwogICAgICAgIH0KCiAgICAgICAgZm9yIChpID0gMDsgaSA8IDI1NjsgKytpKSB7CiAgICAgICAgICB0bXAgPSBzW2ldOwogICAgICAgICAgaiA9IGogKyB0bXAgKyBrZXlbaSAlIGtleUxlbmd0aF0gJiAweGZmOwogICAgICAgICAgc1tpXSA9IHNbal07CiAgICAgICAgICBzW2pdID0gdG1wOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5zID0gczsKICAgICAgfQoKICAgICAgQVJDRm91ckNpcGhlci5wcm90b3R5cGUgPSB7CiAgICAgICAgZW5jcnlwdEJsb2NrOiBmdW5jdGlvbiBBUkNGb3VyQ2lwaGVyX2VuY3J5cHRCbG9jayhkYXRhKSB7CiAgICAgICAgICB2YXIgaSwKICAgICAgICAgICAgbiA9IGRhdGEubGVuZ3RoLAogICAgICAgICAgICB0bXAsCiAgICAgICAgICAgIHRtcDI7CiAgICAgICAgICB2YXIgYSA9IHRoaXMuYSwKICAgICAgICAgICAgYiA9IHRoaXMuYiwKICAgICAgICAgICAgcyA9IHRoaXMuczsKICAgICAgICAgIHZhciBvdXRwdXQgPSBuZXcgVWludDhBcnJheShuKTsKCiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbjsgKytpKSB7CiAgICAgICAgICAgIGEgPSBhICsgMSAmIDB4ZmY7CiAgICAgICAgICAgIHRtcCA9IHNbYV07CiAgICAgICAgICAgIGIgPSBiICsgdG1wICYgMHhmZjsKICAgICAgICAgICAgdG1wMiA9IHNbYl07CiAgICAgICAgICAgIHNbYV0gPSB0bXAyOwogICAgICAgICAgICBzW2JdID0gdG1wOwogICAgICAgICAgICBvdXRwdXRbaV0gPSBkYXRhW2ldIF4gc1t0bXAgKyB0bXAyICYgMHhmZl07CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5hID0gYTsKICAgICAgICAgIHRoaXMuYiA9IGI7CiAgICAgICAgICByZXR1cm4gb3V0cHV0OwogICAgICAgIH0KICAgICAgfTsKICAgICAgQVJDRm91ckNpcGhlci5wcm90b3R5cGUuZGVjcnlwdEJsb2NrID0gQVJDRm91ckNpcGhlci5wcm90b3R5cGUuZW5jcnlwdEJsb2NrOwogICAgICByZXR1cm4gQVJDRm91ckNpcGhlcjsKICAgIH0oKTsKCiAgICBleHBvcnRzLkFSQ0ZvdXJDaXBoZXIgPSBBUkNGb3VyQ2lwaGVyOwoKICAgIHZhciBjYWxjdWxhdGVNRDUgPSBmdW5jdGlvbiBjYWxjdWxhdGVNRDVDbG9zdXJlKCkgewogICAgICB2YXIgciA9IG5ldyBVaW50OEFycmF5KFs3LCAxMiwgMTcsIDIyLCA3LCAxMiwgMTcsIDIyLCA3LCAxMiwgMTcsIDIyLCA3LCAxMiwgMTcsIDIyLCA1LCA5LCAxNCwgMjAsIDUsIDksIDE0LCAyMCwgNSwgOSwgMTQsIDIwLCA1LCA5LCAxNCwgMjAsIDQsIDExLCAxNiwgMjMsIDQsIDExLCAxNiwgMjMsIDQsIDExLCAxNiwgMjMsIDQsIDExLCAxNiwgMjMsIDYsIDEwLCAxNSwgMjEsIDYsIDEwLCAxNSwgMjEsIDYsIDEwLCAxNSwgMjEsIDYsIDEwLCAxNSwgMjFdKTsKICAgICAgdmFyIGsgPSBuZXcgSW50MzJBcnJheShbLTY4MDg3NjkzNiwgLTM4OTU2NDU4NiwgNjA2MTA1ODE5LCAtMTA0NDUyNTMzMCwgLTE3NjQxODg5NywgMTIwMDA4MDQyNiwgLTE0NzMyMzEzNDEsIC00NTcwNTk4MywgMTc3MDAzNTQxNiwgLTE5NTg0MTQ0MTcsIC00MjA2MywgLTE5OTA0MDQxNjIsIDE4MDQ2MDM2ODIsIC00MDM0MTEwMSwgLTE1MDIwMDIyOTAsIDEyMzY1MzUzMjksIC0xNjU3OTY1MTAsIC0xMDY5NTAxNjMyLCA2NDM3MTc3MTMsIC0zNzM4OTczMDIsIC03MDE1NTg2OTEsIDM4MDE2MDgzLCAtNjYwNDc4MzM1LCAtNDA1NTM3ODQ4LCA1Njg0NDY0MzgsIC0xMDE5ODAzNjkwLCAtMTg3MzYzOTYxLCAxMTYzNTMxNTAxLCAtMTQ0NDY4MTQ2NywgLTUxNDAzNzg0LCAxNzM1MzI4NDczLCAtMTkyNjYwNzczNCwgLTM3ODU1OCwgLTIwMjI1NzQ0NjMsIDE4MzkwMzA1NjIsIC0zNTMwOTU1NiwgLTE1MzA5OTIwNjAsIDEyNzI4OTMzNTMsIC0xNTU0OTc2MzIsIC0xMDk0NzMwNjQwLCA2ODEyNzkxNzQsIC0zNTg1MzcyMjIsIC03MjI1MjE5NzksIDc2MDI5MTg5LCAtNjQwMzY0NDg3LCAtNDIxODE1ODM1LCA1MzA3NDI1MjAsIC05OTUzMzg2NTEsIC0xOTg2MzA4NDQsIDExMjY4OTE0MTUsIC0xNDE2MzU0OTA1LCAtNTc0MzQwNTUsIDE3MDA0ODU1NzEsIC0xODk0OTg2NjA2LCAtMTA1MTUyMywgLTIwNTQ5MjI3OTksIDE4NzMzMTMzNTksIC0zMDYxMTc0NCwgLTE1NjAxOTgzODAsIDEzMDkxNTE2NDksIC0xNDU1MjMwNzAsIC0xMTIwMjEwMzc5LCA3MTg3ODcyNTksIC0zNDM0ODU1NTFdKTsKCiAgICAgIGZ1bmN0aW9uIGhhc2goZGF0YSwgb2Zmc2V0LCBsZW5ndGgpIHsKICAgICAgICB2YXIgaDAgPSAxNzMyNTg0MTkzLAogICAgICAgICAgaDEgPSAtMjcxNzMzODc5LAogICAgICAgICAgaDIgPSAtMTczMjU4NDE5NCwKICAgICAgICAgIGgzID0gMjcxNzMzODc4OwogICAgICAgIHZhciBwYWRkZWRMZW5ndGggPSBsZW5ndGggKyA3MiAmIH42MzsKICAgICAgICB2YXIgcGFkZGVkID0gbmV3IFVpbnQ4QXJyYXkocGFkZGVkTGVuZ3RoKTsKICAgICAgICB2YXIgaSwgaiwgbjsKCiAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7CiAgICAgICAgICBwYWRkZWRbaV0gPSBkYXRhW29mZnNldCsrXTsKICAgICAgICB9CgogICAgICAgIHBhZGRlZFtpKytdID0gMHg4MDsKICAgICAgICBuID0gcGFkZGVkTGVuZ3RoIC0gODsKCiAgICAgICAgd2hpbGUgKGkgPCBuKSB7CiAgICAgICAgICBwYWRkZWRbaSsrXSA9IDA7CiAgICAgICAgfQoKICAgICAgICBwYWRkZWRbaSsrXSA9IGxlbmd0aCA8PCAzICYgMHhmZjsKICAgICAgICBwYWRkZWRbaSsrXSA9IGxlbmd0aCA+PiA1ICYgMHhmZjsKICAgICAgICBwYWRkZWRbaSsrXSA9IGxlbmd0aCA+PiAxMyAmIDB4ZmY7CiAgICAgICAgcGFkZGVkW2krK10gPSBsZW5ndGggPj4gMjEgJiAweGZmOwogICAgICAgIHBhZGRlZFtpKytdID0gbGVuZ3RoID4+PiAyOSAmIDB4ZmY7CiAgICAgICAgcGFkZGVkW2krK10gPSAwOwogICAgICAgIHBhZGRlZFtpKytdID0gMDsKICAgICAgICBwYWRkZWRbaSsrXSA9IDA7CiAgICAgICAgdmFyIHcgPSBuZXcgSW50MzJBcnJheSgxNik7CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBwYWRkZWRMZW5ndGg7KSB7CiAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgMTY7ICsraiwgaSArPSA0KSB7CiAgICAgICAgICAgIHdbal0gPSBwYWRkZWRbaV0gfCBwYWRkZWRbaSArIDFdIDw8IDggfCBwYWRkZWRbaSArIDJdIDw8IDE2IHwgcGFkZGVkW2kgKyAzXSA8PCAyNDsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgYSA9IGgwLAogICAgICAgICAgICBiID0gaDEsCiAgICAgICAgICAgIGMgPSBoMiwKICAgICAgICAgICAgZCA9IGgzLAogICAgICAgICAgICBmLAogICAgICAgICAgICBnOwoKICAgICAgICAgIGZvciAoaiA9IDA7IGogPCA2NDsgKytqKSB7CiAgICAgICAgICAgIGlmIChqIDwgMTYpIHsKICAgICAgICAgICAgICBmID0gYiAmIGMgfCB+YiAmIGQ7CiAgICAgICAgICAgICAgZyA9IGo7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaiA8IDMyKSB7CiAgICAgICAgICAgICAgZiA9IGQgJiBiIHwgfmQgJiBjOwogICAgICAgICAgICAgIGcgPSA1ICogaiArIDEgJiAxNTsKICAgICAgICAgICAgfSBlbHNlIGlmIChqIDwgNDgpIHsKICAgICAgICAgICAgICBmID0gYiBeIGMgXiBkOwogICAgICAgICAgICAgIGcgPSAzICogaiArIDUgJiAxNTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBmID0gYyBeIChiIHwgfmQpOwogICAgICAgICAgICAgIGcgPSA3ICogaiAmIDE1OwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgdG1wID0gZCwKICAgICAgICAgICAgICByb3RhdGVBcmcgPSBhICsgZiArIGtbal0gKyB3W2ddIHwgMCwKICAgICAgICAgICAgICByb3RhdGUgPSByW2pdOwogICAgICAgICAgICBkID0gYzsKICAgICAgICAgICAgYyA9IGI7CiAgICAgICAgICAgIGIgPSBiICsgKHJvdGF0ZUFyZyA8PCByb3RhdGUgfCByb3RhdGVBcmcgPj4+IDMyIC0gcm90YXRlKSB8IDA7CiAgICAgICAgICAgIGEgPSB0bXA7CiAgICAgICAgICB9CgogICAgICAgICAgaDAgPSBoMCArIGEgfCAwOwogICAgICAgICAgaDEgPSBoMSArIGIgfCAwOwogICAgICAgICAgaDIgPSBoMiArIGMgfCAwOwogICAgICAgICAgaDMgPSBoMyArIGQgfCAwOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KFtoMCAmIDB4RkYsIGgwID4+IDggJiAweEZGLCBoMCA+PiAxNiAmIDB4RkYsIGgwID4+PiAyNCAmIDB4RkYsIGgxICYgMHhGRiwgaDEgPj4gOCAmIDB4RkYsIGgxID4+IDE2ICYgMHhGRiwgaDEgPj4+IDI0ICYgMHhGRiwgaDIgJiAweEZGLCBoMiA+PiA4ICYgMHhGRiwgaDIgPj4gMTYgJiAweEZGLCBoMiA+Pj4gMjQgJiAweEZGLCBoMyAmIDB4RkYsIGgzID4+IDggJiAweEZGLCBoMyA+PiAxNiAmIDB4RkYsIGgzID4+PiAyNCAmIDB4RkZdKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGhhc2g7CiAgICB9KCk7CgogICAgZXhwb3J0cy5jYWxjdWxhdGVNRDUgPSBjYWxjdWxhdGVNRDU7CgogICAgdmFyIFdvcmQ2NCA9IGZ1bmN0aW9uIFdvcmQ2NENsb3N1cmUoKSB7CiAgICAgIGZ1bmN0aW9uIFdvcmQ2NChoaWdoSW50ZWdlciwgbG93SW50ZWdlcikgewogICAgICAgIHRoaXMuaGlnaCA9IGhpZ2hJbnRlZ2VyIHwgMDsKICAgICAgICB0aGlzLmxvdyA9IGxvd0ludGVnZXIgfCAwOwogICAgICB9CgogICAgICBXb3JkNjQucHJvdG90eXBlID0gewogICAgICAgIGFuZDogZnVuY3Rpb24gV29yZDY0X2FuZCh3b3JkKSB7CiAgICAgICAgICB0aGlzLmhpZ2ggJj0gd29yZC5oaWdoOwogICAgICAgICAgdGhpcy5sb3cgJj0gd29yZC5sb3c7CiAgICAgICAgfSwKICAgICAgICB4b3I6IGZ1bmN0aW9uIFdvcmQ2NF94b3Iod29yZCkgewogICAgICAgICAgdGhpcy5oaWdoIF49IHdvcmQuaGlnaDsKICAgICAgICAgIHRoaXMubG93IF49IHdvcmQubG93OwogICAgICAgIH0sCiAgICAgICAgb3I6IGZ1bmN0aW9uIFdvcmQ2NF9vcih3b3JkKSB7CiAgICAgICAgICB0aGlzLmhpZ2ggfD0gd29yZC5oaWdoOwogICAgICAgICAgdGhpcy5sb3cgfD0gd29yZC5sb3c7CiAgICAgICAgfSwKICAgICAgICBzaGlmdFJpZ2h0OiBmdW5jdGlvbiBXb3JkNjRfc2hpZnRSaWdodChwbGFjZXMpIHsKICAgICAgICAgIGlmIChwbGFjZXMgPj0gMzIpIHsKICAgICAgICAgICAgdGhpcy5sb3cgPSB0aGlzLmhpZ2ggPj4+IHBsYWNlcyAtIDMyIHwgMDsKICAgICAgICAgICAgdGhpcy5oaWdoID0gMDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMubG93ID0gdGhpcy5sb3cgPj4+IHBsYWNlcyB8IHRoaXMuaGlnaCA8PCAzMiAtIHBsYWNlczsKICAgICAgICAgICAgdGhpcy5oaWdoID0gdGhpcy5oaWdoID4+PiBwbGFjZXMgfCAwOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgc2hpZnRMZWZ0OiBmdW5jdGlvbiBXb3JkNjRfc2hpZnRMZWZ0KHBsYWNlcykgewogICAgICAgICAgaWYgKHBsYWNlcyA+PSAzMikgewogICAgICAgICAgICB0aGlzLmhpZ2ggPSB0aGlzLmxvdyA8PCBwbGFjZXMgLSAzMjsKICAgICAgICAgICAgdGhpcy5sb3cgPSAwOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5oaWdoID0gdGhpcy5oaWdoIDw8IHBsYWNlcyB8IHRoaXMubG93ID4+PiAzMiAtIHBsYWNlczsKICAgICAgICAgICAgdGhpcy5sb3cgPSB0aGlzLmxvdyA8PCBwbGFjZXM7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICByb3RhdGVSaWdodDogZnVuY3Rpb24gV29yZDY0X3JvdGF0ZVJpZ2h0KHBsYWNlcykgewogICAgICAgICAgdmFyIGxvdywgaGlnaDsKCiAgICAgICAgICBpZiAocGxhY2VzICYgMzIpIHsKICAgICAgICAgICAgaGlnaCA9IHRoaXMubG93OwogICAgICAgICAgICBsb3cgPSB0aGlzLmhpZ2g7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsb3cgPSB0aGlzLmxvdzsKICAgICAgICAgICAgaGlnaCA9IHRoaXMuaGlnaDsKICAgICAgICAgIH0KCiAgICAgICAgICBwbGFjZXMgJj0gMzE7CiAgICAgICAgICB0aGlzLmxvdyA9IGxvdyA+Pj4gcGxhY2VzIHwgaGlnaCA8PCAzMiAtIHBsYWNlczsKICAgICAgICAgIHRoaXMuaGlnaCA9IGhpZ2ggPj4+IHBsYWNlcyB8IGxvdyA8PCAzMiAtIHBsYWNlczsKICAgICAgICB9LAogICAgICAgIG5vdDogZnVuY3Rpb24gV29yZDY0X25vdCgpIHsKICAgICAgICAgIHRoaXMuaGlnaCA9IH50aGlzLmhpZ2g7CiAgICAgICAgICB0aGlzLmxvdyA9IH50aGlzLmxvdzsKICAgICAgICB9LAogICAgICAgIGFkZDogZnVuY3Rpb24gV29yZDY0X2FkZCh3b3JkKSB7CiAgICAgICAgICB2YXIgbG93QWRkID0gKHRoaXMubG93ID4+PiAwKSArICh3b3JkLmxvdyA+Pj4gMCk7CiAgICAgICAgICB2YXIgaGlnaEFkZCA9ICh0aGlzLmhpZ2ggPj4+IDApICsgKHdvcmQuaGlnaCA+Pj4gMCk7CgogICAgICAgICAgaWYgKGxvd0FkZCA+IDB4ZmZmZmZmZmYpIHsKICAgICAgICAgICAgaGlnaEFkZCArPSAxOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMubG93ID0gbG93QWRkIHwgMDsKICAgICAgICAgIHRoaXMuaGlnaCA9IGhpZ2hBZGQgfCAwOwogICAgICAgIH0sCiAgICAgICAgY29weVRvOiBmdW5jdGlvbiBXb3JkNjRfY29weVRvKGJ5dGVzLCBvZmZzZXQpIHsKICAgICAgICAgIGJ5dGVzW29mZnNldF0gPSB0aGlzLmhpZ2ggPj4+IDI0ICYgMHhmZjsKICAgICAgICAgIGJ5dGVzW29mZnNldCArIDFdID0gdGhpcy5oaWdoID4+IDE2ICYgMHhmZjsKICAgICAgICAgIGJ5dGVzW29mZnNldCArIDJdID0gdGhpcy5oaWdoID4+IDggJiAweGZmOwogICAgICAgICAgYnl0ZXNbb2Zmc2V0ICsgM10gPSB0aGlzLmhpZ2ggJiAweGZmOwogICAgICAgICAgYnl0ZXNbb2Zmc2V0ICsgNF0gPSB0aGlzLmxvdyA+Pj4gMjQgJiAweGZmOwogICAgICAgICAgYnl0ZXNbb2Zmc2V0ICsgNV0gPSB0aGlzLmxvdyA+PiAxNiAmIDB4ZmY7CiAgICAgICAgICBieXRlc1tvZmZzZXQgKyA2XSA9IHRoaXMubG93ID4+IDggJiAweGZmOwogICAgICAgICAgYnl0ZXNbb2Zmc2V0ICsgN10gPSB0aGlzLmxvdyAmIDB4ZmY7CiAgICAgICAgfSwKICAgICAgICBhc3NpZ246IGZ1bmN0aW9uIFdvcmQ2NF9hc3NpZ24od29yZCkgewogICAgICAgICAgdGhpcy5oaWdoID0gd29yZC5oaWdoOwogICAgICAgICAgdGhpcy5sb3cgPSB3b3JkLmxvdzsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHJldHVybiBXb3JkNjQ7CiAgICB9KCk7CgogICAgdmFyIGNhbGN1bGF0ZVNIQTI1NiA9IGZ1bmN0aW9uIGNhbGN1bGF0ZVNIQTI1NkNsb3N1cmUoKSB7CiAgICAgIGZ1bmN0aW9uIHJvdHIoeCwgbikgewogICAgICAgIHJldHVybiB4ID4+PiBuIHwgeCA8PCAzMiAtIG47CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGNoKHgsIHksIHopIHsKICAgICAgICByZXR1cm4geCAmIHkgXiB+eCAmIHo7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIG1haih4LCB5LCB6KSB7CiAgICAgICAgcmV0dXJuIHggJiB5IF4geCAmIHogXiB5ICYgejsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gc2lnbWEoeCkgewogICAgICAgIHJldHVybiByb3RyKHgsIDIpIF4gcm90cih4LCAxMykgXiByb3RyKHgsIDIyKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gc2lnbWFQcmltZSh4KSB7CiAgICAgICAgcmV0dXJuIHJvdHIoeCwgNikgXiByb3RyKHgsIDExKSBeIHJvdHIoeCwgMjUpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBsaXR0bGVTaWdtYSh4KSB7CiAgICAgICAgcmV0dXJuIHJvdHIoeCwgNykgXiByb3RyKHgsIDE4KSBeIHggPj4+IDM7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGxpdHRsZVNpZ21hUHJpbWUoeCkgewogICAgICAgIHJldHVybiByb3RyKHgsIDE3KSBeIHJvdHIoeCwgMTkpIF4geCA+Pj4gMTA7CiAgICAgIH0KCiAgICAgIHZhciBrID0gWzB4NDI4YTJmOTgsIDB4NzEzNzQ0OTEsIDB4YjVjMGZiY2YsIDB4ZTliNWRiYTUsIDB4Mzk1NmMyNWIsIDB4NTlmMTExZjEsIDB4OTIzZjgyYTQsIDB4YWIxYzVlZDUsIDB4ZDgwN2FhOTgsIDB4MTI4MzViMDEsIDB4MjQzMTg1YmUsIDB4NTUwYzdkYzMsIDB4NzJiZTVkNzQsIDB4ODBkZWIxZmUsIDB4OWJkYzA2YTcsIDB4YzE5YmYxNzQsIDB4ZTQ5YjY5YzEsIDB4ZWZiZTQ3ODYsIDB4MGZjMTlkYzYsIDB4MjQwY2ExY2MsIDB4MmRlOTJjNmYsIDB4NGE3NDg0YWEsIDB4NWNiMGE5ZGMsIDB4NzZmOTg4ZGEsIDB4OTgzZTUxNTIsIDB4YTgzMWM2NmQsIDB4YjAwMzI3YzgsIDB4YmY1OTdmYzcsIDB4YzZlMDBiZjMsIDB4ZDVhNzkxNDcsIDB4MDZjYTYzNTEsIDB4MTQyOTI5NjcsIDB4MjdiNzBhODUsIDB4MmUxYjIxMzgsIDB4NGQyYzZkZmMsIDB4NTMzODBkMTMsIDB4NjUwYTczNTQsIDB4NzY2YTBhYmIsIDB4ODFjMmM5MmUsIDB4OTI3MjJjODUsIDB4YTJiZmU4YTEsIDB4YTgxYTY2NGIsIDB4YzI0YjhiNzAsIDB4Yzc2YzUxYTMsIDB4ZDE5MmU4MTksIDB4ZDY5OTA2MjQsIDB4ZjQwZTM1ODUsIDB4MTA2YWEwNzAsIDB4MTlhNGMxMTYsIDB4MWUzNzZjMDgsIDB4Mjc0ODc3NGMsIDB4MzRiMGJjYjUsIDB4MzkxYzBjYjMsIDB4NGVkOGFhNGEsIDB4NWI5Y2NhNGYsIDB4NjgyZTZmZjMsIDB4NzQ4ZjgyZWUsIDB4NzhhNTYzNmYsIDB4ODRjODc4MTQsIDB4OGNjNzAyMDgsIDB4OTBiZWZmZmEsIDB4YTQ1MDZjZWIsIDB4YmVmOWEzZjcsIDB4YzY3MTc4ZjJdOwoKICAgICAgZnVuY3Rpb24gaGFzaChkYXRhLCBvZmZzZXQsIGxlbmd0aCkgewogICAgICAgIHZhciBoMCA9IDB4NmEwOWU2NjcsCiAgICAgICAgICBoMSA9IDB4YmI2N2FlODUsCiAgICAgICAgICBoMiA9IDB4M2M2ZWYzNzIsCiAgICAgICAgICBoMyA9IDB4YTU0ZmY1M2EsCiAgICAgICAgICBoNCA9IDB4NTEwZTUyN2YsCiAgICAgICAgICBoNSA9IDB4OWIwNTY4OGMsCiAgICAgICAgICBoNiA9IDB4MWY4M2Q5YWIsCiAgICAgICAgICBoNyA9IDB4NWJlMGNkMTk7CiAgICAgICAgdmFyIHBhZGRlZExlbmd0aCA9IE1hdGguY2VpbCgobGVuZ3RoICsgOSkgLyA2NCkgKiA2NDsKICAgICAgICB2YXIgcGFkZGVkID0gbmV3IFVpbnQ4QXJyYXkocGFkZGVkTGVuZ3RoKTsKICAgICAgICB2YXIgaSwgaiwgbjsKCiAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7CiAgICAgICAgICBwYWRkZWRbaV0gPSBkYXRhW29mZnNldCsrXTsKICAgICAgICB9CgogICAgICAgIHBhZGRlZFtpKytdID0gMHg4MDsKICAgICAgICBuID0gcGFkZGVkTGVuZ3RoIC0gODsKCiAgICAgICAgd2hpbGUgKGkgPCBuKSB7CiAgICAgICAgICBwYWRkZWRbaSsrXSA9IDA7CiAgICAgICAgfQoKICAgICAgICBwYWRkZWRbaSsrXSA9IDA7CiAgICAgICAgcGFkZGVkW2krK10gPSAwOwogICAgICAgIHBhZGRlZFtpKytdID0gMDsKICAgICAgICBwYWRkZWRbaSsrXSA9IGxlbmd0aCA+Pj4gMjkgJiAweGZmOwogICAgICAgIHBhZGRlZFtpKytdID0gbGVuZ3RoID4+IDIxICYgMHhmZjsKICAgICAgICBwYWRkZWRbaSsrXSA9IGxlbmd0aCA+PiAxMyAmIDB4ZmY7CiAgICAgICAgcGFkZGVkW2krK10gPSBsZW5ndGggPj4gNSAmIDB4ZmY7CiAgICAgICAgcGFkZGVkW2krK10gPSBsZW5ndGggPDwgMyAmIDB4ZmY7CiAgICAgICAgdmFyIHcgPSBuZXcgVWludDMyQXJyYXkoNjQpOwoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcGFkZGVkTGVuZ3RoOykgewogICAgICAgICAgZm9yIChqID0gMDsgaiA8IDE2OyArK2opIHsKICAgICAgICAgICAgd1tqXSA9IHBhZGRlZFtpXSA8PCAyNCB8IHBhZGRlZFtpICsgMV0gPDwgMTYgfCBwYWRkZWRbaSArIDJdIDw8IDggfCBwYWRkZWRbaSArIDNdOwogICAgICAgICAgICBpICs9IDQ7CiAgICAgICAgICB9CgogICAgICAgICAgZm9yIChqID0gMTY7IGogPCA2NDsgKytqKSB7CiAgICAgICAgICAgIHdbal0gPSBsaXR0bGVTaWdtYVByaW1lKHdbaiAtIDJdKSArIHdbaiAtIDddICsgbGl0dGxlU2lnbWEod1tqIC0gMTVdKSArIHdbaiAtIDE2XSB8IDA7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGEgPSBoMCwKICAgICAgICAgICAgYiA9IGgxLAogICAgICAgICAgICBjID0gaDIsCiAgICAgICAgICAgIGQgPSBoMywKICAgICAgICAgICAgZSA9IGg0LAogICAgICAgICAgICBmID0gaDUsCiAgICAgICAgICAgIGcgPSBoNiwKICAgICAgICAgICAgaCA9IGg3LAogICAgICAgICAgICB0MSwKICAgICAgICAgICAgdDI7CgogICAgICAgICAgZm9yIChqID0gMDsgaiA8IDY0OyArK2opIHsKICAgICAgICAgICAgdDEgPSBoICsgc2lnbWFQcmltZShlKSArIGNoKGUsIGYsIGcpICsga1tqXSArIHdbal07CiAgICAgICAgICAgIHQyID0gc2lnbWEoYSkgKyBtYWooYSwgYiwgYyk7CiAgICAgICAgICAgIGggPSBnOwogICAgICAgICAgICBnID0gZjsKICAgICAgICAgICAgZiA9IGU7CiAgICAgICAgICAgIGUgPSBkICsgdDEgfCAwOwogICAgICAgICAgICBkID0gYzsKICAgICAgICAgICAgYyA9IGI7CiAgICAgICAgICAgIGIgPSBhOwogICAgICAgICAgICBhID0gdDEgKyB0MiB8IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaDAgPSBoMCArIGEgfCAwOwogICAgICAgICAgaDEgPSBoMSArIGIgfCAwOwogICAgICAgICAgaDIgPSBoMiArIGMgfCAwOwogICAgICAgICAgaDMgPSBoMyArIGQgfCAwOwogICAgICAgICAgaDQgPSBoNCArIGUgfCAwOwogICAgICAgICAgaDUgPSBoNSArIGYgfCAwOwogICAgICAgICAgaDYgPSBoNiArIGcgfCAwOwogICAgICAgICAgaDcgPSBoNyArIGggfCAwOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KFtoMCA+PiAyNCAmIDB4RkYsIGgwID4+IDE2ICYgMHhGRiwgaDAgPj4gOCAmIDB4RkYsIGgwICYgMHhGRiwgaDEgPj4gMjQgJiAweEZGLCBoMSA+PiAxNiAmIDB4RkYsIGgxID4+IDggJiAweEZGLCBoMSAmIDB4RkYsIGgyID4+IDI0ICYgMHhGRiwgaDIgPj4gMTYgJiAweEZGLCBoMiA+PiA4ICYgMHhGRiwgaDIgJiAweEZGLCBoMyA+PiAyNCAmIDB4RkYsIGgzID4+IDE2ICYgMHhGRiwgaDMgPj4gOCAmIDB4RkYsIGgzICYgMHhGRiwgaDQgPj4gMjQgJiAweEZGLCBoNCA+PiAxNiAmIDB4RkYsIGg0ID4+IDggJiAweEZGLCBoNCAmIDB4RkYsIGg1ID4+IDI0ICYgMHhGRiwgaDUgPj4gMTYgJiAweEZGLCBoNSA+PiA4ICYgMHhGRiwgaDUgJiAweEZGLCBoNiA+PiAyNCAmIDB4RkYsIGg2ID4+IDE2ICYgMHhGRiwgaDYgPj4gOCAmIDB4RkYsIGg2ICYgMHhGRiwgaDcgPj4gMjQgJiAweEZGLCBoNyA+PiAxNiAmIDB4RkYsIGg3ID4+IDggJiAweEZGLCBoNyAmIDB4RkZdKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGhhc2g7CiAgICB9KCk7CgogICAgZXhwb3J0cy5jYWxjdWxhdGVTSEEyNTYgPSBjYWxjdWxhdGVTSEEyNTY7CgogICAgdmFyIGNhbGN1bGF0ZVNIQTUxMiA9IGZ1bmN0aW9uIGNhbGN1bGF0ZVNIQTUxMkNsb3N1cmUoKSB7CiAgICAgIGZ1bmN0aW9uIGNoKHJlc3VsdCwgeCwgeSwgeiwgdG1wKSB7CiAgICAgICAgcmVzdWx0LmFzc2lnbih4KTsKICAgICAgICByZXN1bHQuYW5kKHkpOwogICAgICAgIHRtcC5hc3NpZ24oeCk7CiAgICAgICAgdG1wLm5vdCgpOwogICAgICAgIHRtcC5hbmQoeik7CiAgICAgICAgcmVzdWx0Lnhvcih0bXApOwogICAgICB9CgogICAgICBmdW5jdGlvbiBtYWoocmVzdWx0LCB4LCB5LCB6LCB0bXApIHsKICAgICAgICByZXN1bHQuYXNzaWduKHgpOwogICAgICAgIHJlc3VsdC5hbmQoeSk7CiAgICAgICAgdG1wLmFzc2lnbih4KTsKICAgICAgICB0bXAuYW5kKHopOwogICAgICAgIHJlc3VsdC54b3IodG1wKTsKICAgICAgICB0bXAuYXNzaWduKHkpOwogICAgICAgIHRtcC5hbmQoeik7CiAgICAgICAgcmVzdWx0Lnhvcih0bXApOwogICAgICB9CgogICAgICBmdW5jdGlvbiBzaWdtYShyZXN1bHQsIHgsIHRtcCkgewogICAgICAgIHJlc3VsdC5hc3NpZ24oeCk7CiAgICAgICAgcmVzdWx0LnJvdGF0ZVJpZ2h0KDI4KTsKICAgICAgICB0bXAuYXNzaWduKHgpOwogICAgICAgIHRtcC5yb3RhdGVSaWdodCgzNCk7CiAgICAgICAgcmVzdWx0Lnhvcih0bXApOwogICAgICAgIHRtcC5hc3NpZ24oeCk7CiAgICAgICAgdG1wLnJvdGF0ZVJpZ2h0KDM5KTsKICAgICAgICByZXN1bHQueG9yKHRtcCk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHNpZ21hUHJpbWUocmVzdWx0LCB4LCB0bXApIHsKICAgICAgICByZXN1bHQuYXNzaWduKHgpOwogICAgICAgIHJlc3VsdC5yb3RhdGVSaWdodCgxNCk7CiAgICAgICAgdG1wLmFzc2lnbih4KTsKICAgICAgICB0bXAucm90YXRlUmlnaHQoMTgpOwogICAgICAgIHJlc3VsdC54b3IodG1wKTsKICAgICAgICB0bXAuYXNzaWduKHgpOwogICAgICAgIHRtcC5yb3RhdGVSaWdodCg0MSk7CiAgICAgICAgcmVzdWx0Lnhvcih0bXApOwogICAgICB9CgogICAgICBmdW5jdGlvbiBsaXR0bGVTaWdtYShyZXN1bHQsIHgsIHRtcCkgewogICAgICAgIHJlc3VsdC5hc3NpZ24oeCk7CiAgICAgICAgcmVzdWx0LnJvdGF0ZVJpZ2h0KDEpOwogICAgICAgIHRtcC5hc3NpZ24oeCk7CiAgICAgICAgdG1wLnJvdGF0ZVJpZ2h0KDgpOwogICAgICAgIHJlc3VsdC54b3IodG1wKTsKICAgICAgICB0bXAuYXNzaWduKHgpOwogICAgICAgIHRtcC5zaGlmdFJpZ2h0KDcpOwogICAgICAgIHJlc3VsdC54b3IodG1wKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gbGl0dGxlU2lnbWFQcmltZShyZXN1bHQsIHgsIHRtcCkgewogICAgICAgIHJlc3VsdC5hc3NpZ24oeCk7CiAgICAgICAgcmVzdWx0LnJvdGF0ZVJpZ2h0KDE5KTsKICAgICAgICB0bXAuYXNzaWduKHgpOwogICAgICAgIHRtcC5yb3RhdGVSaWdodCg2MSk7CiAgICAgICAgcmVzdWx0Lnhvcih0bXApOwogICAgICAgIHRtcC5hc3NpZ24oeCk7CiAgICAgICAgdG1wLnNoaWZ0UmlnaHQoNik7CiAgICAgICAgcmVzdWx0Lnhvcih0bXApOwogICAgICB9CgogICAgICB2YXIgayA9IFtuZXcgV29yZDY0KDB4NDI4YTJmOTgsIDB4ZDcyOGFlMjIpLCBuZXcgV29yZDY0KDB4NzEzNzQ0OTEsIDB4MjNlZjY1Y2QpLCBuZXcgV29yZDY0KDB4YjVjMGZiY2YsIDB4ZWM0ZDNiMmYpLCBuZXcgV29yZDY0KDB4ZTliNWRiYTUsIDB4ODE4OWRiYmMpLCBuZXcgV29yZDY0KDB4Mzk1NmMyNWIsIDB4ZjM0OGI1MzgpLCBuZXcgV29yZDY0KDB4NTlmMTExZjEsIDB4YjYwNWQwMTkpLCBuZXcgV29yZDY0KDB4OTIzZjgyYTQsIDB4YWYxOTRmOWIpLCBuZXcgV29yZDY0KDB4YWIxYzVlZDUsIDB4ZGE2ZDgxMTgpLCBuZXcgV29yZDY0KDB4ZDgwN2FhOTgsIDB4YTMwMzAyNDIpLCBuZXcgV29yZDY0KDB4MTI4MzViMDEsIDB4NDU3MDZmYmUpLCBuZXcgV29yZDY0KDB4MjQzMTg1YmUsIDB4NGVlNGIyOGMpLCBuZXcgV29yZDY0KDB4NTUwYzdkYzMsIDB4ZDVmZmI0ZTIpLCBuZXcgV29yZDY0KDB4NzJiZTVkNzQsIDB4ZjI3Yjg5NmYpLCBuZXcgV29yZDY0KDB4ODBkZWIxZmUsIDB4M2IxNjk2YjEpLCBuZXcgV29yZDY0KDB4OWJkYzA2YTcsIDB4MjVjNzEyMzUpLCBuZXcgV29yZDY0KDB4YzE5YmYxNzQsIDB4Y2Y2OTI2OTQpLCBuZXcgV29yZDY0KDB4ZTQ5YjY5YzEsIDB4OWVmMTRhZDIpLCBuZXcgV29yZDY0KDB4ZWZiZTQ3ODYsIDB4Mzg0ZjI1ZTMpLCBuZXcgV29yZDY0KDB4MGZjMTlkYzYsIDB4OGI4Y2Q1YjUpLCBuZXcgV29yZDY0KDB4MjQwY2ExY2MsIDB4NzdhYzljNjUpLCBuZXcgV29yZDY0KDB4MmRlOTJjNmYsIDB4NTkyYjAyNzUpLCBuZXcgV29yZDY0KDB4NGE3NDg0YWEsIDB4NmVhNmU0ODMpLCBuZXcgV29yZDY0KDB4NWNiMGE5ZGMsIDB4YmQ0MWZiZDQpLCBuZXcgV29yZDY0KDB4NzZmOTg4ZGEsIDB4ODMxMTUzYjUpLCBuZXcgV29yZDY0KDB4OTgzZTUxNTIsIDB4ZWU2NmRmYWIpLCBuZXcgV29yZDY0KDB4YTgzMWM2NmQsIDB4MmRiNDMyMTApLCBuZXcgV29yZDY0KDB4YjAwMzI3YzgsIDB4OThmYjIxM2YpLCBuZXcgV29yZDY0KDB4YmY1OTdmYzcsIDB4YmVlZjBlZTQpLCBuZXcgV29yZDY0KDB4YzZlMDBiZjMsIDB4M2RhODhmYzIpLCBuZXcgV29yZDY0KDB4ZDVhNzkxNDcsIDB4OTMwYWE3MjUpLCBuZXcgV29yZDY0KDB4MDZjYTYzNTEsIDB4ZTAwMzgyNmYpLCBuZXcgV29yZDY0KDB4MTQyOTI5NjcsIDB4MGEwZTZlNzApLCBuZXcgV29yZDY0KDB4MjdiNzBhODUsIDB4NDZkMjJmZmMpLCBuZXcgV29yZDY0KDB4MmUxYjIxMzgsIDB4NWMyNmM5MjYpLCBuZXcgV29yZDY0KDB4NGQyYzZkZmMsIDB4NWFjNDJhZWQpLCBuZXcgV29yZDY0KDB4NTMzODBkMTMsIDB4OWQ5NWIzZGYpLCBuZXcgV29yZDY0KDB4NjUwYTczNTQsIDB4OGJhZjYzZGUpLCBuZXcgV29yZDY0KDB4NzY2YTBhYmIsIDB4M2M3N2IyYTgpLCBuZXcgV29yZDY0KDB4ODFjMmM5MmUsIDB4NDdlZGFlZTYpLCBuZXcgV29yZDY0KDB4OTI3MjJjODUsIDB4MTQ4MjM1M2IpLCBuZXcgV29yZDY0KDB4YTJiZmU4YTEsIDB4NGNmMTAzNjQpLCBuZXcgV29yZDY0KDB4YTgxYTY2NGIsIDB4YmM0MjMwMDEpLCBuZXcgV29yZDY0KDB4YzI0YjhiNzAsIDB4ZDBmODk3OTEpLCBuZXcgV29yZDY0KDB4Yzc2YzUxYTMsIDB4MDY1NGJlMzApLCBuZXcgV29yZDY0KDB4ZDE5MmU4MTksIDB4ZDZlZjUyMTgpLCBuZXcgV29yZDY0KDB4ZDY5OTA2MjQsIDB4NTU2NWE5MTApLCBuZXcgV29yZDY0KDB4ZjQwZTM1ODUsIDB4NTc3MTIwMmEpLCBuZXcgV29yZDY0KDB4MTA2YWEwNzAsIDB4MzJiYmQxYjgpLCBuZXcgV29yZDY0KDB4MTlhNGMxMTYsIDB4YjhkMmQwYzgpLCBuZXcgV29yZDY0KDB4MWUzNzZjMDgsIDB4NTE0MWFiNTMpLCBuZXcgV29yZDY0KDB4Mjc0ODc3NGMsIDB4ZGY4ZWViOTkpLCBuZXcgV29yZDY0KDB4MzRiMGJjYjUsIDB4ZTE5YjQ4YTgpLCBuZXcgV29yZDY0KDB4MzkxYzBjYjMsIDB4YzVjOTVhNjMpLCBuZXcgV29yZDY0KDB4NGVkOGFhNGEsIDB4ZTM0MThhY2IpLCBuZXcgV29yZDY0KDB4NWI5Y2NhNGYsIDB4Nzc2M2UzNzMpLCBuZXcgV29yZDY0KDB4NjgyZTZmZjMsIDB4ZDZiMmI4YTMpLCBuZXcgV29yZDY0KDB4NzQ4ZjgyZWUsIDB4NWRlZmIyZmMpLCBuZXcgV29yZDY0KDB4NzhhNTYzNmYsIDB4NDMxNzJmNjApLCBuZXcgV29yZDY0KDB4ODRjODc4MTQsIDB4YTFmMGFiNzIpLCBuZXcgV29yZDY0KDB4OGNjNzAyMDgsIDB4MWE2NDM5ZWMpLCBuZXcgV29yZDY0KDB4OTBiZWZmZmEsIDB4MjM2MzFlMjgpLCBuZXcgV29yZDY0KDB4YTQ1MDZjZWIsIDB4ZGU4MmJkZTkpLCBuZXcgV29yZDY0KDB4YmVmOWEzZjcsIDB4YjJjNjc5MTUpLCBuZXcgV29yZDY0KDB4YzY3MTc4ZjIsIDB4ZTM3MjUzMmIpLCBuZXcgV29yZDY0KDB4Y2EyNzNlY2UsIDB4ZWEyNjYxOWMpLCBuZXcgV29yZDY0KDB4ZDE4NmI4YzcsIDB4MjFjMGMyMDcpLCBuZXcgV29yZDY0KDB4ZWFkYTdkZDYsIDB4Y2RlMGViMWUpLCBuZXcgV29yZDY0KDB4ZjU3ZDRmN2YsIDB4ZWU2ZWQxNzgpLCBuZXcgV29yZDY0KDB4MDZmMDY3YWEsIDB4NzIxNzZmYmEpLCBuZXcgV29yZDY0KDB4MGE2MzdkYzUsIDB4YTJjODk4YTYpLCBuZXcgV29yZDY0KDB4MTEzZjk4MDQsIDB4YmVmOTBkYWUpLCBuZXcgV29yZDY0KDB4MWI3MTBiMzUsIDB4MTMxYzQ3MWIpLCBuZXcgV29yZDY0KDB4MjhkYjc3ZjUsIDB4MjMwNDdkODQpLCBuZXcgV29yZDY0KDB4MzJjYWFiN2IsIDB4NDBjNzI0OTMpLCBuZXcgV29yZDY0KDB4M2M5ZWJlMGEsIDB4MTVjOWJlYmMpLCBuZXcgV29yZDY0KDB4NDMxZDY3YzQsIDB4OWMxMDBkNGMpLCBuZXcgV29yZDY0KDB4NGNjNWQ0YmUsIDB4Y2IzZTQyYjYpLCBuZXcgV29yZDY0KDB4NTk3ZjI5OWMsIDB4ZmM2NTdlMmEpLCBuZXcgV29yZDY0KDB4NWZjYjZmYWIsIDB4M2FkNmZhZWMpLCBuZXcgV29yZDY0KDB4NmM0NDE5OGMsIDB4NGE0NzU4MTcpXTsKCiAgICAgIGZ1bmN0aW9uIGhhc2goZGF0YSwgb2Zmc2V0LCBsZW5ndGgsIG1vZGUzODQpIHsKICAgICAgICBtb2RlMzg0ID0gISFtb2RlMzg0OwogICAgICAgIHZhciBoMCwgaDEsIGgyLCBoMywgaDQsIGg1LCBoNiwgaDc7CgogICAgICAgIGlmICghbW9kZTM4NCkgewogICAgICAgICAgaDAgPSBuZXcgV29yZDY0KDB4NmEwOWU2NjcsIDB4ZjNiY2M5MDgpOwogICAgICAgICAgaDEgPSBuZXcgV29yZDY0KDB4YmI2N2FlODUsIDB4ODRjYWE3M2IpOwogICAgICAgICAgaDIgPSBuZXcgV29yZDY0KDB4M2M2ZWYzNzIsIDB4ZmU5NGY4MmIpOwogICAgICAgICAgaDMgPSBuZXcgV29yZDY0KDB4YTU0ZmY1M2EsIDB4NWYxZDM2ZjEpOwogICAgICAgICAgaDQgPSBuZXcgV29yZDY0KDB4NTEwZTUyN2YsIDB4YWRlNjgyZDEpOwogICAgICAgICAgaDUgPSBuZXcgV29yZDY0KDB4OWIwNTY4OGMsIDB4MmIzZTZjMWYpOwogICAgICAgICAgaDYgPSBuZXcgV29yZDY0KDB4MWY4M2Q5YWIsIDB4ZmI0MWJkNmIpOwogICAgICAgICAgaDcgPSBuZXcgV29yZDY0KDB4NWJlMGNkMTksIDB4MTM3ZTIxNzkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBoMCA9IG5ldyBXb3JkNjQoMHhjYmJiOWQ1ZCwgMHhjMTA1OWVkOCk7CiAgICAgICAgICBoMSA9IG5ldyBXb3JkNjQoMHg2MjlhMjkyYSwgMHgzNjdjZDUwNyk7CiAgICAgICAgICBoMiA9IG5ldyBXb3JkNjQoMHg5MTU5MDE1YSwgMHgzMDcwZGQxNyk7CiAgICAgICAgICBoMyA9IG5ldyBXb3JkNjQoMHgxNTJmZWNkOCwgMHhmNzBlNTkzOSk7CiAgICAgICAgICBoNCA9IG5ldyBXb3JkNjQoMHg2NzMzMjY2NywgMHhmZmMwMGIzMSk7CiAgICAgICAgICBoNSA9IG5ldyBXb3JkNjQoMHg4ZWI0NGE4NywgMHg2ODU4MTUxMSk7CiAgICAgICAgICBoNiA9IG5ldyBXb3JkNjQoMHhkYjBjMmUwZCwgMHg2NGY5OGZhNyk7CiAgICAgICAgICBoNyA9IG5ldyBXb3JkNjQoMHg0N2I1NDgxZCwgMHhiZWZhNGZhNCk7CiAgICAgICAgfQoKICAgICAgICB2YXIgcGFkZGVkTGVuZ3RoID0gTWF0aC5jZWlsKChsZW5ndGggKyAxNykgLyAxMjgpICogMTI4OwogICAgICAgIHZhciBwYWRkZWQgPSBuZXcgVWludDhBcnJheShwYWRkZWRMZW5ndGgpOwogICAgICAgIHZhciBpLCBqLCBuOwoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHsKICAgICAgICAgIHBhZGRlZFtpXSA9IGRhdGFbb2Zmc2V0KytdOwogICAgICAgIH0KCiAgICAgICAgcGFkZGVkW2krK10gPSAweDgwOwogICAgICAgIG4gPSBwYWRkZWRMZW5ndGggLSAxNjsKCiAgICAgICAgd2hpbGUgKGkgPCBuKSB7CiAgICAgICAgICBwYWRkZWRbaSsrXSA9IDA7CiAgICAgICAgfQoKICAgICAgICBwYWRkZWRbaSsrXSA9IDA7CiAgICAgICAgcGFkZGVkW2krK10gPSAwOwogICAgICAgIHBhZGRlZFtpKytdID0gMDsKICAgICAgICBwYWRkZWRbaSsrXSA9IDA7CiAgICAgICAgcGFkZGVkW2krK10gPSAwOwogICAgICAgIHBhZGRlZFtpKytdID0gMDsKICAgICAgICBwYWRkZWRbaSsrXSA9IDA7CiAgICAgICAgcGFkZGVkW2krK10gPSAwOwogICAgICAgIHBhZGRlZFtpKytdID0gMDsKICAgICAgICBwYWRkZWRbaSsrXSA9IDA7CiAgICAgICAgcGFkZGVkW2krK10gPSAwOwogICAgICAgIHBhZGRlZFtpKytdID0gbGVuZ3RoID4+PiAyOSAmIDB4ZmY7CiAgICAgICAgcGFkZGVkW2krK10gPSBsZW5ndGggPj4gMjEgJiAweGZmOwogICAgICAgIHBhZGRlZFtpKytdID0gbGVuZ3RoID4+IDEzICYgMHhmZjsKICAgICAgICBwYWRkZWRbaSsrXSA9IGxlbmd0aCA+PiA1ICYgMHhmZjsKICAgICAgICBwYWRkZWRbaSsrXSA9IGxlbmd0aCA8PCAzICYgMHhmZjsKICAgICAgICB2YXIgdyA9IG5ldyBBcnJheSg4MCk7CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCA4MDsgaSsrKSB7CiAgICAgICAgICB3W2ldID0gbmV3IFdvcmQ2NCgwLCAwKTsKICAgICAgICB9CgogICAgICAgIHZhciBhID0gbmV3IFdvcmQ2NCgwLCAwKSwKICAgICAgICAgIGIgPSBuZXcgV29yZDY0KDAsIDApLAogICAgICAgICAgYyA9IG5ldyBXb3JkNjQoMCwgMCk7CiAgICAgICAgdmFyIGQgPSBuZXcgV29yZDY0KDAsIDApLAogICAgICAgICAgZSA9IG5ldyBXb3JkNjQoMCwgMCksCiAgICAgICAgICBmID0gbmV3IFdvcmQ2NCgwLCAwKTsKICAgICAgICB2YXIgZyA9IG5ldyBXb3JkNjQoMCwgMCksCiAgICAgICAgICBoID0gbmV3IFdvcmQ2NCgwLCAwKTsKICAgICAgICB2YXIgdDEgPSBuZXcgV29yZDY0KDAsIDApLAogICAgICAgICAgdDIgPSBuZXcgV29yZDY0KDAsIDApOwogICAgICAgIHZhciB0bXAxID0gbmV3IFdvcmQ2NCgwLCAwKSwKICAgICAgICAgIHRtcDIgPSBuZXcgV29yZDY0KDAsIDApLAogICAgICAgICAgdG1wMzsKCiAgICAgICAgZm9yIChpID0gMDsgaSA8IHBhZGRlZExlbmd0aDspIHsKICAgICAgICAgIGZvciAoaiA9IDA7IGogPCAxNjsgKytqKSB7CiAgICAgICAgICAgIHdbal0uaGlnaCA9IHBhZGRlZFtpXSA8PCAyNCB8IHBhZGRlZFtpICsgMV0gPDwgMTYgfCBwYWRkZWRbaSArIDJdIDw8IDggfCBwYWRkZWRbaSArIDNdOwogICAgICAgICAgICB3W2pdLmxvdyA9IHBhZGRlZFtpICsgNF0gPDwgMjQgfCBwYWRkZWRbaSArIDVdIDw8IDE2IHwgcGFkZGVkW2kgKyA2XSA8PCA4IHwgcGFkZGVkW2kgKyA3XTsKICAgICAgICAgICAgaSArPSA4OwogICAgICAgICAgfQoKICAgICAgICAgIGZvciAoaiA9IDE2OyBqIDwgODA7ICsraikgewogICAgICAgICAgICB0bXAzID0gd1tqXTsKICAgICAgICAgICAgbGl0dGxlU2lnbWFQcmltZSh0bXAzLCB3W2ogLSAyXSwgdG1wMik7CiAgICAgICAgICAgIHRtcDMuYWRkKHdbaiAtIDddKTsKICAgICAgICAgICAgbGl0dGxlU2lnbWEodG1wMSwgd1tqIC0gMTVdLCB0bXAyKTsKICAgICAgICAgICAgdG1wMy5hZGQodG1wMSk7CiAgICAgICAgICAgIHRtcDMuYWRkKHdbaiAtIDE2XSk7CiAgICAgICAgICB9CgogICAgICAgICAgYS5hc3NpZ24oaDApOwogICAgICAgICAgYi5hc3NpZ24oaDEpOwogICAgICAgICAgYy5hc3NpZ24oaDIpOwogICAgICAgICAgZC5hc3NpZ24oaDMpOwogICAgICAgICAgZS5hc3NpZ24oaDQpOwogICAgICAgICAgZi5hc3NpZ24oaDUpOwogICAgICAgICAgZy5hc3NpZ24oaDYpOwogICAgICAgICAgaC5hc3NpZ24oaDcpOwoKICAgICAgICAgIGZvciAoaiA9IDA7IGogPCA4MDsgKytqKSB7CiAgICAgICAgICAgIHQxLmFzc2lnbihoKTsKICAgICAgICAgICAgc2lnbWFQcmltZSh0bXAxLCBlLCB0bXAyKTsKICAgICAgICAgICAgdDEuYWRkKHRtcDEpOwogICAgICAgICAgICBjaCh0bXAxLCBlLCBmLCBnLCB0bXAyKTsKICAgICAgICAgICAgdDEuYWRkKHRtcDEpOwogICAgICAgICAgICB0MS5hZGQoa1tqXSk7CiAgICAgICAgICAgIHQxLmFkZCh3W2pdKTsKICAgICAgICAgICAgc2lnbWEodDIsIGEsIHRtcDIpOwogICAgICAgICAgICBtYWoodG1wMSwgYSwgYiwgYywgdG1wMik7CiAgICAgICAgICAgIHQyLmFkZCh0bXAxKTsKICAgICAgICAgICAgdG1wMyA9IGg7CiAgICAgICAgICAgIGggPSBnOwogICAgICAgICAgICBnID0gZjsKICAgICAgICAgICAgZiA9IGU7CiAgICAgICAgICAgIGQuYWRkKHQxKTsKICAgICAgICAgICAgZSA9IGQ7CiAgICAgICAgICAgIGQgPSBjOwogICAgICAgICAgICBjID0gYjsKICAgICAgICAgICAgYiA9IGE7CiAgICAgICAgICAgIHRtcDMuYXNzaWduKHQxKTsKICAgICAgICAgICAgdG1wMy5hZGQodDIpOwogICAgICAgICAgICBhID0gdG1wMzsKICAgICAgICAgIH0KCiAgICAgICAgICBoMC5hZGQoYSk7CiAgICAgICAgICBoMS5hZGQoYik7CiAgICAgICAgICBoMi5hZGQoYyk7CiAgICAgICAgICBoMy5hZGQoZCk7CiAgICAgICAgICBoNC5hZGQoZSk7CiAgICAgICAgICBoNS5hZGQoZik7CiAgICAgICAgICBoNi5hZGQoZyk7CiAgICAgICAgICBoNy5hZGQoaCk7CiAgICAgICAgfQoKICAgICAgICB2YXIgcmVzdWx0OwoKICAgICAgICBpZiAoIW1vZGUzODQpIHsKICAgICAgICAgIHJlc3VsdCA9IG5ldyBVaW50OEFycmF5KDY0KTsKICAgICAgICAgIGgwLmNvcHlUbyhyZXN1bHQsIDApOwogICAgICAgICAgaDEuY29weVRvKHJlc3VsdCwgOCk7CiAgICAgICAgICBoMi5jb3B5VG8ocmVzdWx0LCAxNik7CiAgICAgICAgICBoMy5jb3B5VG8ocmVzdWx0LCAyNCk7CiAgICAgICAgICBoNC5jb3B5VG8ocmVzdWx0LCAzMik7CiAgICAgICAgICBoNS5jb3B5VG8ocmVzdWx0LCA0MCk7CiAgICAgICAgICBoNi5jb3B5VG8ocmVzdWx0LCA0OCk7CiAgICAgICAgICBoNy5jb3B5VG8ocmVzdWx0LCA1Nik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJlc3VsdCA9IG5ldyBVaW50OEFycmF5KDQ4KTsKICAgICAgICAgIGgwLmNvcHlUbyhyZXN1bHQsIDApOwogICAgICAgICAgaDEuY29weVRvKHJlc3VsdCwgOCk7CiAgICAgICAgICBoMi5jb3B5VG8ocmVzdWx0LCAxNik7CiAgICAgICAgICBoMy5jb3B5VG8ocmVzdWx0LCAyNCk7CiAgICAgICAgICBoNC5jb3B5VG8ocmVzdWx0LCAzMik7CiAgICAgICAgICBoNS5jb3B5VG8ocmVzdWx0LCA0MCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9CgogICAgICByZXR1cm4gaGFzaDsKICAgIH0oKTsKCiAgICBleHBvcnRzLmNhbGN1bGF0ZVNIQTUxMiA9IGNhbGN1bGF0ZVNIQTUxMjsKCiAgICB2YXIgY2FsY3VsYXRlU0hBMzg0ID0gZnVuY3Rpb24gY2FsY3VsYXRlU0hBMzg0Q2xvc3VyZSgpIHsKICAgICAgZnVuY3Rpb24gaGFzaChkYXRhLCBvZmZzZXQsIGxlbmd0aCkgewogICAgICAgIHJldHVybiBjYWxjdWxhdGVTSEE1MTIoZGF0YSwgb2Zmc2V0LCBsZW5ndGgsIHRydWUpOwogICAgICB9CgogICAgICByZXR1cm4gaGFzaDsKICAgIH0oKTsKCiAgICBleHBvcnRzLmNhbGN1bGF0ZVNIQTM4NCA9IGNhbGN1bGF0ZVNIQTM4NDsKCiAgICB2YXIgTnVsbENpcGhlciA9IGZ1bmN0aW9uIE51bGxDaXBoZXJDbG9zdXJlKCkgewogICAgICBmdW5jdGlvbiBOdWxsQ2lwaGVyKCkge30KCiAgICAgIE51bGxDaXBoZXIucHJvdG90eXBlID0gewogICAgICAgIGRlY3J5cHRCbG9jazogZnVuY3Rpb24gTnVsbENpcGhlcl9kZWNyeXB0QmxvY2soZGF0YSkgewogICAgICAgICAgcmV0dXJuIGRhdGE7CiAgICAgICAgfQogICAgICB9OwogICAgICByZXR1cm4gTnVsbENpcGhlcjsKICAgIH0oKTsKCiAgICB2YXIgQUVTQmFzZUNpcGhlciA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgIGZ1bmN0aW9uIEFFU0Jhc2VDaXBoZXIoKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEFFU0Jhc2VDaXBoZXIpOwoKICAgICAgICBpZiAodGhpcy5jb25zdHJ1Y3RvciA9PT0gQUVTQmFzZUNpcGhlcikgewogICAgICAgICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgiQ2Fubm90IGluaXRpYWxpemUgQUVTQmFzZUNpcGhlci4iKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuX3MgPSBuZXcgVWludDhBcnJheShbMHg2MywgMHg3YywgMHg3NywgMHg3YiwgMHhmMiwgMHg2YiwgMHg2ZiwgMHhjNSwgMHgzMCwgMHgwMSwgMHg2NywgMHgyYiwgMHhmZSwgMHhkNywgMHhhYiwgMHg3NiwgMHhjYSwgMHg4MiwgMHhjOSwgMHg3ZCwgMHhmYSwgMHg1OSwgMHg0NywgMHhmMCwgMHhhZCwgMHhkNCwgMHhhMiwgMHhhZiwgMHg5YywgMHhhNCwgMHg3MiwgMHhjMCwgMHhiNywgMHhmZCwgMHg5MywgMHgyNiwgMHgzNiwgMHgzZiwgMHhmNywgMHhjYywgMHgzNCwgMHhhNSwgMHhlNSwgMHhmMSwgMHg3MSwgMHhkOCwgMHgzMSwgMHgxNSwgMHgwNCwgMHhjNywgMHgyMywgMHhjMywgMHgxOCwgMHg5NiwgMHgwNSwgMHg5YSwgMHgwNywgMHgxMiwgMHg4MCwgMHhlMiwgMHhlYiwgMHgyNywgMHhiMiwgMHg3NSwgMHgwOSwgMHg4MywgMHgyYywgMHgxYSwgMHgxYiwgMHg2ZSwgMHg1YSwgMHhhMCwgMHg1MiwgMHgzYiwgMHhkNiwgMHhiMywgMHgyOSwgMHhlMywgMHgyZiwgMHg4NCwgMHg1MywgMHhkMSwgMHgwMCwgMHhlZCwgMHgyMCwgMHhmYywgMHhiMSwgMHg1YiwgMHg2YSwgMHhjYiwgMHhiZSwgMHgzOSwgMHg0YSwgMHg0YywgMHg1OCwgMHhjZiwgMHhkMCwgMHhlZiwgMHhhYSwgMHhmYiwgMHg0MywgMHg0ZCwgMHgzMywgMHg4NSwgMHg0NSwgMHhmOSwgMHgwMiwgMHg3ZiwgMHg1MCwgMHgzYywgMHg5ZiwgMHhhOCwgMHg1MSwgMHhhMywgMHg0MCwgMHg4ZiwgMHg5MiwgMHg5ZCwgMHgzOCwgMHhmNSwgMHhiYywgMHhiNiwgMHhkYSwgMHgyMSwgMHgxMCwgMHhmZiwgMHhmMywgMHhkMiwgMHhjZCwgMHgwYywgMHgxMywgMHhlYywgMHg1ZiwgMHg5NywgMHg0NCwgMHgxNywgMHhjNCwgMHhhNywgMHg3ZSwgMHgzZCwgMHg2NCwgMHg1ZCwgMHgxOSwgMHg3MywgMHg2MCwgMHg4MSwgMHg0ZiwgMHhkYywgMHgyMiwgMHgyYSwgMHg5MCwgMHg4OCwgMHg0NiwgMHhlZSwgMHhiOCwgMHgxNCwgMHhkZSwgMHg1ZSwgMHgwYiwgMHhkYiwgMHhlMCwgMHgzMiwgMHgzYSwgMHgwYSwgMHg0OSwgMHgwNiwgMHgyNCwgMHg1YywgMHhjMiwgMHhkMywgMHhhYywgMHg2MiwgMHg5MSwgMHg5NSwgMHhlNCwgMHg3OSwgMHhlNywgMHhjOCwgMHgzNywgMHg2ZCwgMHg4ZCwgMHhkNSwgMHg0ZSwgMHhhOSwgMHg2YywgMHg1NiwgMHhmNCwgMHhlYSwgMHg2NSwgMHg3YSwgMHhhZSwgMHgwOCwgMHhiYSwgMHg3OCwgMHgyNSwgMHgyZSwgMHgxYywgMHhhNiwgMHhiNCwgMHhjNiwgMHhlOCwgMHhkZCwgMHg3NCwgMHgxZiwgMHg0YiwgMHhiZCwgMHg4YiwgMHg4YSwgMHg3MCwgMHgzZSwgMHhiNSwgMHg2NiwgMHg0OCwgMHgwMywgMHhmNiwgMHgwZSwgMHg2MSwgMHgzNSwgMHg1NywgMHhiOSwgMHg4NiwgMHhjMSwgMHgxZCwgMHg5ZSwgMHhlMSwgMHhmOCwgMHg5OCwgMHgxMSwgMHg2OSwgMHhkOSwgMHg4ZSwgMHg5NCwgMHg5YiwgMHgxZSwgMHg4NywgMHhlOSwgMHhjZSwgMHg1NSwgMHgyOCwgMHhkZiwgMHg4YywgMHhhMSwgMHg4OSwgMHgwZCwgMHhiZiwgMHhlNiwgMHg0MiwgMHg2OCwgMHg0MSwgMHg5OSwgMHgyZCwgMHgwZiwgMHhiMCwgMHg1NCwgMHhiYiwgMHgxNl0pOwogICAgICAgIHRoaXMuX2ludl9zID0gbmV3IFVpbnQ4QXJyYXkoWzB4NTIsIDB4MDksIDB4NmEsIDB4ZDUsIDB4MzAsIDB4MzYsIDB4YTUsIDB4MzgsIDB4YmYsIDB4NDAsIDB4YTMsIDB4OWUsIDB4ODEsIDB4ZjMsIDB4ZDcsIDB4ZmIsIDB4N2MsIDB4ZTMsIDB4MzksIDB4ODIsIDB4OWIsIDB4MmYsIDB4ZmYsIDB4ODcsIDB4MzQsIDB4OGUsIDB4NDMsIDB4NDQsIDB4YzQsIDB4ZGUsIDB4ZTksIDB4Y2IsIDB4NTQsIDB4N2IsIDB4OTQsIDB4MzIsIDB4YTYsIDB4YzIsIDB4MjMsIDB4M2QsIDB4ZWUsIDB4NGMsIDB4OTUsIDB4MGIsIDB4NDIsIDB4ZmEsIDB4YzMsIDB4NGUsIDB4MDgsIDB4MmUsIDB4YTEsIDB4NjYsIDB4MjgsIDB4ZDksIDB4MjQsIDB4YjIsIDB4NzYsIDB4NWIsIDB4YTIsIDB4NDksIDB4NmQsIDB4OGIsIDB4ZDEsIDB4MjUsIDB4NzIsIDB4ZjgsIDB4ZjYsIDB4NjQsIDB4ODYsIDB4NjgsIDB4OTgsIDB4MTYsIDB4ZDQsIDB4YTQsIDB4NWMsIDB4Y2MsIDB4NWQsIDB4NjUsIDB4YjYsIDB4OTIsIDB4NmMsIDB4NzAsIDB4NDgsIDB4NTAsIDB4ZmQsIDB4ZWQsIDB4YjksIDB4ZGEsIDB4NWUsIDB4MTUsIDB4NDYsIDB4NTcsIDB4YTcsIDB4OGQsIDB4OWQsIDB4ODQsIDB4OTAsIDB4ZDgsIDB4YWIsIDB4MDAsIDB4OGMsIDB4YmMsIDB4ZDMsIDB4MGEsIDB4ZjcsIDB4ZTQsIDB4NTgsIDB4MDUsIDB4YjgsIDB4YjMsIDB4NDUsIDB4MDYsIDB4ZDAsIDB4MmMsIDB4MWUsIDB4OGYsIDB4Y2EsIDB4M2YsIDB4MGYsIDB4MDIsIDB4YzEsIDB4YWYsIDB4YmQsIDB4MDMsIDB4MDEsIDB4MTMsIDB4OGEsIDB4NmIsIDB4M2EsIDB4OTEsIDB4MTEsIDB4NDEsIDB4NGYsIDB4NjcsIDB4ZGMsIDB4ZWEsIDB4OTcsIDB4ZjIsIDB4Y2YsIDB4Y2UsIDB4ZjAsIDB4YjQsIDB4ZTYsIDB4NzMsIDB4OTYsIDB4YWMsIDB4NzQsIDB4MjIsIDB4ZTcsIDB4YWQsIDB4MzUsIDB4ODUsIDB4ZTIsIDB4ZjksIDB4MzcsIDB4ZTgsIDB4MWMsIDB4NzUsIDB4ZGYsIDB4NmUsIDB4NDcsIDB4ZjEsIDB4MWEsIDB4NzEsIDB4MWQsIDB4MjksIDB4YzUsIDB4ODksIDB4NmYsIDB4YjcsIDB4NjIsIDB4MGUsIDB4YWEsIDB4MTgsIDB4YmUsIDB4MWIsIDB4ZmMsIDB4NTYsIDB4M2UsIDB4NGIsIDB4YzYsIDB4ZDIsIDB4NzksIDB4MjAsIDB4OWEsIDB4ZGIsIDB4YzAsIDB4ZmUsIDB4NzgsIDB4Y2QsIDB4NWEsIDB4ZjQsIDB4MWYsIDB4ZGQsIDB4YTgsIDB4MzMsIDB4ODgsIDB4MDcsIDB4YzcsIDB4MzEsIDB4YjEsIDB4MTIsIDB4MTAsIDB4NTksIDB4MjcsIDB4ODAsIDB4ZWMsIDB4NWYsIDB4NjAsIDB4NTEsIDB4N2YsIDB4YTksIDB4MTksIDB4YjUsIDB4NGEsIDB4MGQsIDB4MmQsIDB4ZTUsIDB4N2EsIDB4OWYsIDB4OTMsIDB4YzksIDB4OWMsIDB4ZWYsIDB4YTAsIDB4ZTAsIDB4M2IsIDB4NGQsIDB4YWUsIDB4MmEsIDB4ZjUsIDB4YjAsIDB4YzgsIDB4ZWIsIDB4YmIsIDB4M2MsIDB4ODMsIDB4NTMsIDB4OTksIDB4NjEsIDB4MTcsIDB4MmIsIDB4MDQsIDB4N2UsIDB4YmEsIDB4NzcsIDB4ZDYsIDB4MjYsIDB4ZTEsIDB4NjksIDB4MTQsIDB4NjMsIDB4NTUsIDB4MjEsIDB4MGMsIDB4N2RdKTsKICAgICAgICB0aGlzLl9taXggPSBuZXcgVWludDMyQXJyYXkoWzB4MDAwMDAwMDAsIDB4MGUwOTBkMGIsIDB4MWMxMjFhMTYsIDB4MTIxYjE3MWQsIDB4MzgyNDM0MmMsIDB4MzYyZDM5MjcsIDB4MjQzNjJlM2EsIDB4MmEzZjIzMzEsIDB4NzA0ODY4NTgsIDB4N2U0MTY1NTMsIDB4NmM1YTcyNGUsIDB4NjI1MzdmNDUsIDB4NDg2YzVjNzQsIDB4NDY2NTUxN2YsIDB4NTQ3ZTQ2NjIsIDB4NWE3NzRiNjksIDB4ZTA5MGQwYjAsIDB4ZWU5OWRkYmIsIDB4ZmM4MmNhYTYsIDB4ZjI4YmM3YWQsIDB4ZDhiNGU0OWMsIDB4ZDZiZGU5OTcsIDB4YzRhNmZlOGEsIDB4Y2FhZmYzODEsIDB4OTBkOGI4ZTgsIDB4OWVkMWI1ZTMsIDB4OGNjYWEyZmUsIDB4ODJjM2FmZjUsIDB4YThmYzhjYzQsIDB4YTZmNTgxY2YsIDB4YjRlZTk2ZDIsIDB4YmFlNzliZDksIDB4ZGIzYmJiN2IsIDB4ZDUzMmI2NzAsIDB4YzcyOWExNmQsIDB4YzkyMGFjNjYsIDB4ZTMxZjhmNTcsIDB4ZWQxNjgyNWMsIDB4ZmYwZDk1NDEsIDB4ZjEwNDk4NGEsIDB4YWI3M2QzMjMsIDB4YTU3YWRlMjgsIDB4Yjc2MWM5MzUsIDB4Yjk2OGM0M2UsIDB4OTM1N2U3MGYsIDB4OWQ1ZWVhMDQsIDB4OGY0NWZkMTksIDB4ODE0Y2YwMTIsIDB4M2JhYjZiY2IsIDB4MzVhMjY2YzAsIDB4MjdiOTcxZGQsIDB4MjliMDdjZDYsIDB4MDM4ZjVmZTcsIDB4MGQ4NjUyZWMsIDB4MWY5ZDQ1ZjEsIDB4MTE5NDQ4ZmEsIDB4NGJlMzAzOTMsIDB4NDVlYTBlOTgsIDB4NTdmMTE5ODUsIDB4NTlmODE0OGUsIDB4NzNjNzM3YmYsIDB4N2RjZTNhYjQsIDB4NmZkNTJkYTksIDB4NjFkYzIwYTIsIDB4YWQ3NjZkZjYsIDB4YTM3ZjYwZmQsIDB4YjE2NDc3ZTAsIDB4YmY2ZDdhZWIsIDB4OTU1MjU5ZGEsIDB4OWI1YjU0ZDEsIDB4ODk0MDQzY2MsIDB4ODc0OTRlYzcsIDB4ZGQzZTA1YWUsIDB4ZDMzNzA4YTUsIDB4YzEyYzFmYjgsIDB4Y2YyNTEyYjMsIDB4ZTUxYTMxODIsIDB4ZWIxMzNjODksIDB4ZjkwODJiOTQsIDB4ZjcwMTI2OWYsIDB4NGRlNmJkNDYsIDB4NDNlZmIwNGQsIDB4NTFmNGE3NTAsIDB4NWZmZGFhNWIsIDB4NzVjMjg5NmEsIDB4N2JjYjg0NjEsIDB4NjlkMDkzN2MsIDB4NjdkOTllNzcsIDB4M2RhZWQ1MWUsIDB4MzNhN2Q4MTUsIDB4MjFiY2NmMDgsIDB4MmZiNWMyMDMsIDB4MDU4YWUxMzIsIDB4MGI4M2VjMzksIDB4MTk5OGZiMjQsIDB4MTc5MWY2MmYsIDB4NzY0ZGQ2OGQsIDB4Nzg0NGRiODYsIDB4NmE1ZmNjOWIsIDB4NjQ1NmMxOTAsIDB4NGU2OWUyYTEsIDB4NDA2MGVmYWEsIDB4NTI3YmY4YjcsIDB4NWM3MmY1YmMsIDB4MDYwNWJlZDUsIDB4MDgwY2IzZGUsIDB4MWExN2E0YzMsIDB4MTQxZWE5YzgsIDB4M2UyMThhZjksIDB4MzAyODg3ZjIsIDB4MjIzMzkwZWYsIDB4MmMzYTlkZTQsIDB4OTZkZDA2M2QsIDB4OThkNDBiMzYsIDB4OGFjZjFjMmIsIDB4ODRjNjExMjAsIDB4YWVmOTMyMTEsIDB4YTBmMDNmMWEsIDB4YjJlYjI4MDcsIDB4YmNlMjI1MGMsIDB4ZTY5NTZlNjUsIDB4ZTg5YzYzNmUsIDB4ZmE4Nzc0NzMsIDB4ZjQ4ZTc5NzgsIDB4ZGViMTVhNDksIDB4ZDBiODU3NDIsIDB4YzJhMzQwNWYsIDB4Y2NhYTRkNTQsIDB4NDFlY2RhZjcsIDB4NGZlNWQ3ZmMsIDB4NWRmZWMwZTEsIDB4NTNmN2NkZWEsIDB4NzljOGVlZGIsIDB4NzdjMWUzZDAsIDB4NjVkYWY0Y2QsIDB4NmJkM2Y5YzYsIDB4MzFhNGIyYWYsIDB4M2ZhZGJmYTQsIDB4MmRiNmE4YjksIDB4MjNiZmE1YjIsIDB4MDk4MDg2ODMsIDB4MDc4OThiODgsIDB4MTU5MjljOTUsIDB4MWI5YjkxOWUsIDB4YTE3YzBhNDcsIDB4YWY3NTA3NGMsIDB4YmQ2ZTEwNTEsIDB4YjM2NzFkNWEsIDB4OTk1ODNlNmIsIDB4OTc1MTMzNjAsIDB4ODU0YTI0N2QsIDB4OGI0MzI5NzYsIDB4ZDEzNDYyMWYsIDB4ZGYzZDZmMTQsIDB4Y2QyNjc4MDksIDB4YzMyZjc1MDIsIDB4ZTkxMDU2MzMsIDB4ZTcxOTViMzgsIDB4ZjUwMjRjMjUsIDB4ZmIwYjQxMmUsIDB4OWFkNzYxOGMsIDB4OTRkZTZjODcsIDB4ODZjNTdiOWEsIDB4ODhjYzc2OTEsIDB4YTJmMzU1YTAsIDB4YWNmYTU4YWIsIDB4YmVlMTRmYjYsIDB4YjBlODQyYmQsIDB4ZWE5ZjA5ZDQsIDB4ZTQ5NjA0ZGYsIDB4ZjY4ZDEzYzIsIDB4Zjg4NDFlYzksIDB4ZDJiYjNkZjgsIDB4ZGNiMjMwZjMsIDB4Y2VhOTI3ZWUsIDB4YzBhMDJhZTUsIDB4N2E0N2IxM2MsIDB4NzQ0ZWJjMzcsIDB4NjY1NWFiMmEsIDB4Njg1Y2E2MjEsIDB4NDI2Mzg1MTAsIDB4NGM2YTg4MWIsIDB4NWU3MTlmMDYsIDB4NTA3ODkyMGQsIDB4MGEwZmQ5NjQsIDB4MDQwNmQ0NmYsIDB4MTYxZGMzNzIsIDB4MTgxNGNlNzksIDB4MzIyYmVkNDgsIDB4M2MyMmUwNDMsIDB4MmUzOWY3NWUsIDB4MjAzMGZhNTUsIDB4ZWM5YWI3MDEsIDB4ZTI5M2JhMGEsIDB4ZjA4OGFkMTcsIDB4ZmU4MWEwMWMsIDB4ZDRiZTgzMmQsIDB4ZGFiNzhlMjYsIDB4YzhhYzk5M2IsIDB4YzZhNTk0MzAsIDB4OWNkMmRmNTksIDB4OTJkYmQyNTIsIDB4ODBjMGM1NGYsIDB4OGVjOWM4NDQsIDB4YTRmNmViNzUsIDB4YWFmZmU2N2UsIDB4YjhlNGYxNjMsIDB4YjZlZGZjNjgsIDB4MGMwYTY3YjEsIDB4MDIwMzZhYmEsIDB4MTAxODdkYTcsIDB4MWUxMTcwYWMsIDB4MzQyZTUzOWQsIDB4M2EyNzVlOTYsIDB4MjgzYzQ5OGIsIDB4MjYzNTQ0ODAsIDB4N2M0MjBmZTksIDB4NzI0YjAyZTIsIDB4NjA1MDE1ZmYsIDB4NmU1OTE4ZjQsIDB4NDQ2NjNiYzUsIDB4NGE2ZjM2Y2UsIDB4NTg3NDIxZDMsIDB4NTY3ZDJjZDgsIDB4MzdhMTBjN2EsIDB4MzlhODAxNzEsIDB4MmJiMzE2NmMsIDB4MjViYTFiNjcsIDB4MGY4NTM4NTYsIDB4MDE4YzM1NWQsIDB4MTM5NzIyNDAsIDB4MWQ5ZTJmNGIsIDB4NDdlOTY0MjIsIDB4NDllMDY5MjksIDB4NWJmYjdlMzQsIDB4NTVmMjczM2YsIDB4N2ZjZDUwMGUsIDB4NzFjNDVkMDUsIDB4NjNkZjRhMTgsIDB4NmRkNjQ3MTMsIDB4ZDczMWRjY2EsIDB4ZDkzOGQxYzEsIDB4Y2IyM2M2ZGMsIDB4YzUyYWNiZDcsIDB4ZWYxNWU4ZTYsIDB4ZTExY2U1ZWQsIDB4ZjMwN2YyZjAsIDB4ZmQwZWZmZmIsIDB4YTc3OWI0OTIsIDB4YTk3MGI5OTksIDB4YmI2YmFlODQsIDB4YjU2MmEzOGYsIDB4OWY1ZDgwYmUsIDB4OTE1NDhkYjUsIDB4ODM0ZjlhYTgsIDB4OGQ0Njk3YTNdKTsKICAgICAgICB0aGlzLl9taXhDb2wgPSBuZXcgVWludDhBcnJheSgyNTYpOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDI1NjsgaSsrKSB7CiAgICAgICAgICBpZiAoaSA8IDEyOCkgewogICAgICAgICAgICB0aGlzLl9taXhDb2xbaV0gPSBpIDw8IDE7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLl9taXhDb2xbaV0gPSBpIDw8IDEgXiAweDFiOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy5idWZmZXIgPSBuZXcgVWludDhBcnJheSgxNik7CiAgICAgICAgdGhpcy5idWZmZXJQb3NpdGlvbiA9IDA7CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhBRVNCYXNlQ2lwaGVyLCBbewogICAgICAgIGtleTogIl9leHBhbmRLZXkiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZXhwYW5kS2V5KGNpcGhlcktleSkgewogICAgICAgICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgiQ2Fubm90IGNhbGwgYF9leHBhbmRLZXlgIG9uIHRoZSBiYXNlIGNsYXNzIik7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiX2RlY3J5cHQiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZGVjcnlwdChpbnB1dCwga2V5KSB7CiAgICAgICAgICB2YXIgdCwgdSwgdjsKICAgICAgICAgIHZhciBzdGF0ZSA9IG5ldyBVaW50OEFycmF5KDE2KTsKICAgICAgICAgIHN0YXRlLnNldChpbnB1dCk7CgogICAgICAgICAgZm9yICh2YXIgaiA9IDAsIGsgPSB0aGlzLl9rZXlTaXplOyBqIDwgMTY7ICsraiwgKytrKSB7CiAgICAgICAgICAgIHN0YXRlW2pdIF49IGtleVtrXTsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3IgKHZhciBpID0gdGhpcy5fY3ljbGVzT2ZSZXBldGl0aW9uIC0gMTsgaSA+PSAxOyAtLWkpIHsKICAgICAgICAgICAgdCA9IHN0YXRlWzEzXTsKICAgICAgICAgICAgc3RhdGVbMTNdID0gc3RhdGVbOV07CiAgICAgICAgICAgIHN0YXRlWzldID0gc3RhdGVbNV07CiAgICAgICAgICAgIHN0YXRlWzVdID0gc3RhdGVbMV07CiAgICAgICAgICAgIHN0YXRlWzFdID0gdDsKICAgICAgICAgICAgdCA9IHN0YXRlWzE0XTsKICAgICAgICAgICAgdSA9IHN0YXRlWzEwXTsKICAgICAgICAgICAgc3RhdGVbMTRdID0gc3RhdGVbNl07CiAgICAgICAgICAgIHN0YXRlWzEwXSA9IHN0YXRlWzJdOwogICAgICAgICAgICBzdGF0ZVs2XSA9IHQ7CiAgICAgICAgICAgIHN0YXRlWzJdID0gdTsKICAgICAgICAgICAgdCA9IHN0YXRlWzE1XTsKICAgICAgICAgICAgdSA9IHN0YXRlWzExXTsKICAgICAgICAgICAgdiA9IHN0YXRlWzddOwogICAgICAgICAgICBzdGF0ZVsxNV0gPSBzdGF0ZVszXTsKICAgICAgICAgICAgc3RhdGVbMTFdID0gdDsKICAgICAgICAgICAgc3RhdGVbN10gPSB1OwogICAgICAgICAgICBzdGF0ZVszXSA9IHY7CgogICAgICAgICAgICBmb3IgKHZhciBfaiA9IDA7IF9qIDwgMTY7ICsrX2opIHsKICAgICAgICAgICAgICBzdGF0ZVtfal0gPSB0aGlzLl9pbnZfc1tzdGF0ZVtfal1dOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmb3IgKHZhciBfajIgPSAwLCBfayA9IGkgKiAxNjsgX2oyIDwgMTY7ICsrX2oyLCArK19rKSB7CiAgICAgICAgICAgICAgc3RhdGVbX2oyXSBePSBrZXlbX2tdOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmb3IgKHZhciBfajMgPSAwOyBfajMgPCAxNjsgX2ozICs9IDQpIHsKICAgICAgICAgICAgICB2YXIgczAgPSB0aGlzLl9taXhbc3RhdGVbX2ozXV07CiAgICAgICAgICAgICAgdmFyIHMxID0gdGhpcy5fbWl4W3N0YXRlW19qMyArIDFdXTsKICAgICAgICAgICAgICB2YXIgczIgPSB0aGlzLl9taXhbc3RhdGVbX2ozICsgMl1dOwogICAgICAgICAgICAgIHZhciBzMyA9IHRoaXMuX21peFtzdGF0ZVtfajMgKyAzXV07CiAgICAgICAgICAgICAgdCA9IHMwIF4gczEgPj4+IDggXiBzMSA8PCAyNCBeIHMyID4+PiAxNiBeIHMyIDw8IDE2IF4gczMgPj4+IDI0IF4gczMgPDwgODsKICAgICAgICAgICAgICBzdGF0ZVtfajNdID0gdCA+Pj4gMjQgJiAweGZmOwogICAgICAgICAgICAgIHN0YXRlW19qMyArIDFdID0gdCA+PiAxNiAmIDB4ZmY7CiAgICAgICAgICAgICAgc3RhdGVbX2ozICsgMl0gPSB0ID4+IDggJiAweGZmOwogICAgICAgICAgICAgIHN0YXRlW19qMyArIDNdID0gdCAmIDB4ZmY7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB0ID0gc3RhdGVbMTNdOwogICAgICAgICAgc3RhdGVbMTNdID0gc3RhdGVbOV07CiAgICAgICAgICBzdGF0ZVs5XSA9IHN0YXRlWzVdOwogICAgICAgICAgc3RhdGVbNV0gPSBzdGF0ZVsxXTsKICAgICAgICAgIHN0YXRlWzFdID0gdDsKICAgICAgICAgIHQgPSBzdGF0ZVsxNF07CiAgICAgICAgICB1ID0gc3RhdGVbMTBdOwogICAgICAgICAgc3RhdGVbMTRdID0gc3RhdGVbNl07CiAgICAgICAgICBzdGF0ZVsxMF0gPSBzdGF0ZVsyXTsKICAgICAgICAgIHN0YXRlWzZdID0gdDsKICAgICAgICAgIHN0YXRlWzJdID0gdTsKICAgICAgICAgIHQgPSBzdGF0ZVsxNV07CiAgICAgICAgICB1ID0gc3RhdGVbMTFdOwogICAgICAgICAgdiA9IHN0YXRlWzddOwogICAgICAgICAgc3RhdGVbMTVdID0gc3RhdGVbM107CiAgICAgICAgICBzdGF0ZVsxMV0gPSB0OwogICAgICAgICAgc3RhdGVbN10gPSB1OwogICAgICAgICAgc3RhdGVbM10gPSB2OwoKICAgICAgICAgIGZvciAodmFyIF9qNCA9IDA7IF9qNCA8IDE2OyArK19qNCkgewogICAgICAgICAgICBzdGF0ZVtfajRdID0gdGhpcy5faW52X3Nbc3RhdGVbX2o0XV07CiAgICAgICAgICAgIHN0YXRlW19qNF0gXj0ga2V5W19qNF07CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHN0YXRlOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIl9lbmNyeXB0IiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX2VuY3J5cHQoaW5wdXQsIGtleSkgewogICAgICAgICAgdmFyIHMgPSB0aGlzLl9zOwogICAgICAgICAgdmFyIHQsIHUsIHY7CiAgICAgICAgICB2YXIgc3RhdGUgPSBuZXcgVWludDhBcnJheSgxNik7CiAgICAgICAgICBzdGF0ZS5zZXQoaW5wdXQpOwoKICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgMTY7ICsraikgewogICAgICAgICAgICBzdGF0ZVtqXSBePSBrZXlbal07CiAgICAgICAgICB9CgogICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCB0aGlzLl9jeWNsZXNPZlJlcGV0aXRpb247IGkrKykgewogICAgICAgICAgICBmb3IgKHZhciBfajUgPSAwOyBfajUgPCAxNjsgKytfajUpIHsKICAgICAgICAgICAgICBzdGF0ZVtfajVdID0gc1tzdGF0ZVtfajVdXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdiA9IHN0YXRlWzFdOwogICAgICAgICAgICBzdGF0ZVsxXSA9IHN0YXRlWzVdOwogICAgICAgICAgICBzdGF0ZVs1XSA9IHN0YXRlWzldOwogICAgICAgICAgICBzdGF0ZVs5XSA9IHN0YXRlWzEzXTsKICAgICAgICAgICAgc3RhdGVbMTNdID0gdjsKICAgICAgICAgICAgdiA9IHN0YXRlWzJdOwogICAgICAgICAgICB1ID0gc3RhdGVbNl07CiAgICAgICAgICAgIHN0YXRlWzJdID0gc3RhdGVbMTBdOwogICAgICAgICAgICBzdGF0ZVs2XSA9IHN0YXRlWzE0XTsKICAgICAgICAgICAgc3RhdGVbMTBdID0gdjsKICAgICAgICAgICAgc3RhdGVbMTRdID0gdTsKICAgICAgICAgICAgdiA9IHN0YXRlWzNdOwogICAgICAgICAgICB1ID0gc3RhdGVbN107CiAgICAgICAgICAgIHQgPSBzdGF0ZVsxMV07CiAgICAgICAgICAgIHN0YXRlWzNdID0gc3RhdGVbMTVdOwogICAgICAgICAgICBzdGF0ZVs3XSA9IHY7CiAgICAgICAgICAgIHN0YXRlWzExXSA9IHU7CiAgICAgICAgICAgIHN0YXRlWzE1XSA9IHQ7CgogICAgICAgICAgICBmb3IgKHZhciBfajYgPSAwOyBfajYgPCAxNjsgX2o2ICs9IDQpIHsKICAgICAgICAgICAgICB2YXIgczAgPSBzdGF0ZVtfajYgKyAwXTsKICAgICAgICAgICAgICB2YXIgczEgPSBzdGF0ZVtfajYgKyAxXTsKICAgICAgICAgICAgICB2YXIgczIgPSBzdGF0ZVtfajYgKyAyXTsKICAgICAgICAgICAgICB2YXIgczMgPSBzdGF0ZVtfajYgKyAzXTsKICAgICAgICAgICAgICB0ID0gczAgXiBzMSBeIHMyIF4gczM7CiAgICAgICAgICAgICAgc3RhdGVbX2o2ICsgMF0gXj0gdCBeIHRoaXMuX21peENvbFtzMCBeIHMxXTsKICAgICAgICAgICAgICBzdGF0ZVtfajYgKyAxXSBePSB0IF4gdGhpcy5fbWl4Q29sW3MxIF4gczJdOwogICAgICAgICAgICAgIHN0YXRlW19qNiArIDJdIF49IHQgXiB0aGlzLl9taXhDb2xbczIgXiBzM107CiAgICAgICAgICAgICAgc3RhdGVbX2o2ICsgM10gXj0gdCBeIHRoaXMuX21peENvbFtzMyBeIHMwXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9yICh2YXIgX2o3ID0gMCwgayA9IGkgKiAxNjsgX2o3IDwgMTY7ICsrX2o3LCArK2spIHsKICAgICAgICAgICAgICBzdGF0ZVtfajddIF49IGtleVtrXTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGZvciAodmFyIF9qOCA9IDA7IF9qOCA8IDE2OyArK19qOCkgewogICAgICAgICAgICBzdGF0ZVtfajhdID0gc1tzdGF0ZVtfajhdXTsKICAgICAgICAgIH0KCiAgICAgICAgICB2ID0gc3RhdGVbMV07CiAgICAgICAgICBzdGF0ZVsxXSA9IHN0YXRlWzVdOwogICAgICAgICAgc3RhdGVbNV0gPSBzdGF0ZVs5XTsKICAgICAgICAgIHN0YXRlWzldID0gc3RhdGVbMTNdOwogICAgICAgICAgc3RhdGVbMTNdID0gdjsKICAgICAgICAgIHYgPSBzdGF0ZVsyXTsKICAgICAgICAgIHUgPSBzdGF0ZVs2XTsKICAgICAgICAgIHN0YXRlWzJdID0gc3RhdGVbMTBdOwogICAgICAgICAgc3RhdGVbNl0gPSBzdGF0ZVsxNF07CiAgICAgICAgICBzdGF0ZVsxMF0gPSB2OwogICAgICAgICAgc3RhdGVbMTRdID0gdTsKICAgICAgICAgIHYgPSBzdGF0ZVszXTsKICAgICAgICAgIHUgPSBzdGF0ZVs3XTsKICAgICAgICAgIHQgPSBzdGF0ZVsxMV07CiAgICAgICAgICBzdGF0ZVszXSA9IHN0YXRlWzE1XTsKICAgICAgICAgIHN0YXRlWzddID0gdjsKICAgICAgICAgIHN0YXRlWzExXSA9IHU7CiAgICAgICAgICBzdGF0ZVsxNV0gPSB0OwoKICAgICAgICAgIGZvciAodmFyIF9qOSA9IDAsIF9rMiA9IHRoaXMuX2tleVNpemU7IF9qOSA8IDE2OyArK19qOSwgKytfazIpIHsKICAgICAgICAgICAgc3RhdGVbX2o5XSBePSBrZXlbX2syXTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gc3RhdGU7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiX2RlY3J5cHRCbG9jazIiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZGVjcnlwdEJsb2NrMihkYXRhLCBmaW5hbGl6ZSkgewogICAgICAgICAgdmFyIHNvdXJjZUxlbmd0aCA9IGRhdGEubGVuZ3RoOwogICAgICAgICAgdmFyIGJ1ZmZlciA9IHRoaXMuYnVmZmVyLAogICAgICAgICAgICBidWZmZXJMZW5ndGggPSB0aGlzLmJ1ZmZlclBvc2l0aW9uOwogICAgICAgICAgdmFyIHJlc3VsdCA9IFtdOwogICAgICAgICAgdmFyIGl2ID0gdGhpcy5pdjsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNvdXJjZUxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgIGJ1ZmZlcltidWZmZXJMZW5ndGhdID0gZGF0YVtpXTsKICAgICAgICAgICAgKytidWZmZXJMZW5ndGg7CgogICAgICAgICAgICBpZiAoYnVmZmVyTGVuZ3RoIDwgMTYpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHBsYWluID0gdGhpcy5fZGVjcnlwdChidWZmZXIsIHRoaXMuX2tleSk7CgogICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IDE2OyArK2opIHsKICAgICAgICAgICAgICBwbGFpbltqXSBePSBpdltqXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaXYgPSBidWZmZXI7CiAgICAgICAgICAgIHJlc3VsdC5wdXNoKHBsYWluKTsKICAgICAgICAgICAgYnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkoMTYpOwogICAgICAgICAgICBidWZmZXJMZW5ndGggPSAwOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuYnVmZmVyID0gYnVmZmVyOwogICAgICAgICAgdGhpcy5idWZmZXJMZW5ndGggPSBidWZmZXJMZW5ndGg7CiAgICAgICAgICB0aGlzLml2ID0gaXY7CgogICAgICAgICAgaWYgKHJlc3VsdC5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KDApOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBvdXRwdXRMZW5ndGggPSAxNiAqIHJlc3VsdC5sZW5ndGg7CgogICAgICAgICAgaWYgKGZpbmFsaXplKSB7CiAgICAgICAgICAgIHZhciBsYXN0QmxvY2sgPSByZXN1bHRbcmVzdWx0Lmxlbmd0aCAtIDFdOwogICAgICAgICAgICB2YXIgcHNMZW4gPSBsYXN0QmxvY2tbMTVdOwoKICAgICAgICAgICAgaWYgKHBzTGVuIDw9IDE2KSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAxNSwgaWkgPSAxNiAtIHBzTGVuOyBfaSA+PSBpaTsgLS1faSkgewogICAgICAgICAgICAgICAgaWYgKGxhc3RCbG9ja1tfaV0gIT09IHBzTGVuKSB7CiAgICAgICAgICAgICAgICAgIHBzTGVuID0gMDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBvdXRwdXRMZW5ndGggLT0gcHNMZW47CiAgICAgICAgICAgICAgcmVzdWx0W3Jlc3VsdC5sZW5ndGggLSAxXSA9IGxhc3RCbG9jay5zdWJhcnJheSgwLCAxNiAtIHBzTGVuKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHZhciBvdXRwdXQgPSBuZXcgVWludDhBcnJheShvdXRwdXRMZW5ndGgpOwoKICAgICAgICAgIGZvciAodmFyIF9pMiA9IDAsIF9qMTAgPSAwLCBfaWkgPSByZXN1bHQubGVuZ3RoOyBfaTIgPCBfaWk7ICsrX2kyLCBfajEwICs9IDE2KSB7CiAgICAgICAgICAgIG91dHB1dC5zZXQocmVzdWx0W19pMl0sIF9qMTApOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBvdXRwdXQ7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZGVjcnlwdEJsb2NrIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZGVjcnlwdEJsb2NrKGRhdGEsIGZpbmFsaXplKSB7CiAgICAgICAgICB2YXIgaXYgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IG51bGw7CiAgICAgICAgICB2YXIgc291cmNlTGVuZ3RoID0gZGF0YS5sZW5ndGg7CiAgICAgICAgICB2YXIgYnVmZmVyID0gdGhpcy5idWZmZXI7CiAgICAgICAgICB2YXIgYnVmZmVyTGVuZ3RoID0gdGhpcy5idWZmZXJQb3NpdGlvbjsKCiAgICAgICAgICBpZiAoaXYpIHsKICAgICAgICAgICAgdGhpcy5pdiA9IGl2OwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGJ1ZmZlckxlbmd0aCA8IDE2ICYmIGkgPCBzb3VyY2VMZW5ndGg7ICsraSwgKytidWZmZXJMZW5ndGgpIHsKICAgICAgICAgICAgICBidWZmZXJbYnVmZmVyTGVuZ3RoXSA9IGRhdGFbaV07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChidWZmZXJMZW5ndGggPCAxNikgewogICAgICAgICAgICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gYnVmZmVyTGVuZ3RoOwogICAgICAgICAgICAgIHJldHVybiBuZXcgVWludDhBcnJheSgwKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5pdiA9IGJ1ZmZlcjsKICAgICAgICAgICAgZGF0YSA9IGRhdGEuc3ViYXJyYXkoMTYpOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuYnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkoMTYpOwogICAgICAgICAgdGhpcy5idWZmZXJMZW5ndGggPSAwOwogICAgICAgICAgdGhpcy5kZWNyeXB0QmxvY2sgPSB0aGlzLl9kZWNyeXB0QmxvY2syOwogICAgICAgICAgcmV0dXJuIHRoaXMuZGVjcnlwdEJsb2NrKGRhdGEsIGZpbmFsaXplKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJlbmNyeXB0IiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZW5jcnlwdChkYXRhLCBpdikgewogICAgICAgICAgdmFyIHNvdXJjZUxlbmd0aCA9IGRhdGEubGVuZ3RoOwogICAgICAgICAgdmFyIGJ1ZmZlciA9IHRoaXMuYnVmZmVyLAogICAgICAgICAgICBidWZmZXJMZW5ndGggPSB0aGlzLmJ1ZmZlclBvc2l0aW9uOwogICAgICAgICAgdmFyIHJlc3VsdCA9IFtdOwoKICAgICAgICAgIGlmICghaXYpIHsKICAgICAgICAgICAgaXYgPSBuZXcgVWludDhBcnJheSgxNik7CiAgICAgICAgICB9CgogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzb3VyY2VMZW5ndGg7ICsraSkgewogICAgICAgICAgICBidWZmZXJbYnVmZmVyTGVuZ3RoXSA9IGRhdGFbaV07CiAgICAgICAgICAgICsrYnVmZmVyTGVuZ3RoOwoKICAgICAgICAgICAgaWYgKGJ1ZmZlckxlbmd0aCA8IDE2KSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgMTY7ICsraikgewogICAgICAgICAgICAgIGJ1ZmZlcltqXSBePSBpdltqXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGNpcGhlciA9IHRoaXMuX2VuY3J5cHQoYnVmZmVyLCB0aGlzLl9rZXkpOwoKICAgICAgICAgICAgaXYgPSBjaXBoZXI7CiAgICAgICAgICAgIHJlc3VsdC5wdXNoKGNpcGhlcik7CiAgICAgICAgICAgIGJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KDE2KTsKICAgICAgICAgICAgYnVmZmVyTGVuZ3RoID0gMDsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLmJ1ZmZlciA9IGJ1ZmZlcjsKICAgICAgICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gYnVmZmVyTGVuZ3RoOwogICAgICAgICAgdGhpcy5pdiA9IGl2OwoKICAgICAgICAgIGlmIChyZXN1bHQubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgVWludDhBcnJheSgwKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgb3V0cHV0TGVuZ3RoID0gMTYgKiByZXN1bHQubGVuZ3RoOwogICAgICAgICAgdmFyIG91dHB1dCA9IG5ldyBVaW50OEFycmF5KG91dHB1dExlbmd0aCk7CgogICAgICAgICAgZm9yICh2YXIgX2kzID0gMCwgX2oxMSA9IDAsIGlpID0gcmVzdWx0Lmxlbmd0aDsgX2kzIDwgaWk7ICsrX2kzLCBfajExICs9IDE2KSB7CiAgICAgICAgICAgIG91dHB1dC5zZXQocmVzdWx0W19pM10sIF9qMTEpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBvdXRwdXQ7CiAgICAgICAgfQogICAgICB9XSk7CgogICAgICByZXR1cm4gQUVTQmFzZUNpcGhlcjsKICAgIH0oKTsKCiAgICB2YXIgQUVTMTI4Q2lwaGVyID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQUVTQmFzZUNpcGhlcikgewogICAgICBfaW5oZXJpdHMoQUVTMTI4Q2lwaGVyLCBfQUVTQmFzZUNpcGhlcik7CgogICAgICBmdW5jdGlvbiBBRVMxMjhDaXBoZXIoa2V5KSB7CiAgICAgICAgdmFyIF90aGlzOwoKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQUVTMTI4Q2lwaGVyKTsKCiAgICAgICAgX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoQUVTMTI4Q2lwaGVyKS5jYWxsKHRoaXMpKTsKICAgICAgICBfdGhpcy5fY3ljbGVzT2ZSZXBldGl0aW9uID0gMTA7CiAgICAgICAgX3RoaXMuX2tleVNpemUgPSAxNjA7CiAgICAgICAgX3RoaXMuX3Jjb24gPSBuZXcgVWludDhBcnJheShbMHg4ZCwgMHgwMSwgMHgwMiwgMHgwNCwgMHgwOCwgMHgxMCwgMHgyMCwgMHg0MCwgMHg4MCwgMHgxYiwgMHgzNiwgMHg2YywgMHhkOCwgMHhhYiwgMHg0ZCwgMHg5YSwgMHgyZiwgMHg1ZSwgMHhiYywgMHg2MywgMHhjNiwgMHg5NywgMHgzNSwgMHg2YSwgMHhkNCwgMHhiMywgMHg3ZCwgMHhmYSwgMHhlZiwgMHhjNSwgMHg5MSwgMHgzOSwgMHg3MiwgMHhlNCwgMHhkMywgMHhiZCwgMHg2MSwgMHhjMiwgMHg5ZiwgMHgyNSwgMHg0YSwgMHg5NCwgMHgzMywgMHg2NiwgMHhjYywgMHg4MywgMHgxZCwgMHgzYSwgMHg3NCwgMHhlOCwgMHhjYiwgMHg4ZCwgMHgwMSwgMHgwMiwgMHgwNCwgMHgwOCwgMHgxMCwgMHgyMCwgMHg0MCwgMHg4MCwgMHgxYiwgMHgzNiwgMHg2YywgMHhkOCwgMHhhYiwgMHg0ZCwgMHg5YSwgMHgyZiwgMHg1ZSwgMHhiYywgMHg2MywgMHhjNiwgMHg5NywgMHgzNSwgMHg2YSwgMHhkNCwgMHhiMywgMHg3ZCwgMHhmYSwgMHhlZiwgMHhjNSwgMHg5MSwgMHgzOSwgMHg3MiwgMHhlNCwgMHhkMywgMHhiZCwgMHg2MSwgMHhjMiwgMHg5ZiwgMHgyNSwgMHg0YSwgMHg5NCwgMHgzMywgMHg2NiwgMHhjYywgMHg4MywgMHgxZCwgMHgzYSwgMHg3NCwgMHhlOCwgMHhjYiwgMHg4ZCwgMHgwMSwgMHgwMiwgMHgwNCwgMHgwOCwgMHgxMCwgMHgyMCwgMHg0MCwgMHg4MCwgMHgxYiwgMHgzNiwgMHg2YywgMHhkOCwgMHhhYiwgMHg0ZCwgMHg5YSwgMHgyZiwgMHg1ZSwgMHhiYywgMHg2MywgMHhjNiwgMHg5NywgMHgzNSwgMHg2YSwgMHhkNCwgMHhiMywgMHg3ZCwgMHhmYSwgMHhlZiwgMHhjNSwgMHg5MSwgMHgzOSwgMHg3MiwgMHhlNCwgMHhkMywgMHhiZCwgMHg2MSwgMHhjMiwgMHg5ZiwgMHgyNSwgMHg0YSwgMHg5NCwgMHgzMywgMHg2NiwgMHhjYywgMHg4MywgMHgxZCwgMHgzYSwgMHg3NCwgMHhlOCwgMHhjYiwgMHg4ZCwgMHgwMSwgMHgwMiwgMHgwNCwgMHgwOCwgMHgxMCwgMHgyMCwgMHg0MCwgMHg4MCwgMHgxYiwgMHgzNiwgMHg2YywgMHhkOCwgMHhhYiwgMHg0ZCwgMHg5YSwgMHgyZiwgMHg1ZSwgMHhiYywgMHg2MywgMHhjNiwgMHg5NywgMHgzNSwgMHg2YSwgMHhkNCwgMHhiMywgMHg3ZCwgMHhmYSwgMHhlZiwgMHhjNSwgMHg5MSwgMHgzOSwgMHg3MiwgMHhlNCwgMHhkMywgMHhiZCwgMHg2MSwgMHhjMiwgMHg5ZiwgMHgyNSwgMHg0YSwgMHg5NCwgMHgzMywgMHg2NiwgMHhjYywgMHg4MywgMHgxZCwgMHgzYSwgMHg3NCwgMHhlOCwgMHhjYiwgMHg4ZCwgMHgwMSwgMHgwMiwgMHgwNCwgMHgwOCwgMHgxMCwgMHgyMCwgMHg0MCwgMHg4MCwgMHgxYiwgMHgzNiwgMHg2YywgMHhkOCwgMHhhYiwgMHg0ZCwgMHg5YSwgMHgyZiwgMHg1ZSwgMHhiYywgMHg2MywgMHhjNiwgMHg5NywgMHgzNSwgMHg2YSwgMHhkNCwgMHhiMywgMHg3ZCwgMHhmYSwgMHhlZiwgMHhjNSwgMHg5MSwgMHgzOSwgMHg3MiwgMHhlNCwgMHhkMywgMHhiZCwgMHg2MSwgMHhjMiwgMHg5ZiwgMHgyNSwgMHg0YSwgMHg5NCwgMHgzMywgMHg2NiwgMHhjYywgMHg4MywgMHgxZCwgMHgzYSwgMHg3NCwgMHhlOCwgMHhjYiwgMHg4ZF0pOwogICAgICAgIF90aGlzLl9rZXkgPSBfdGhpcy5fZXhwYW5kS2V5KGtleSk7CiAgICAgICAgcmV0dXJuIF90aGlzOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoQUVTMTI4Q2lwaGVyLCBbewogICAgICAgIGtleTogIl9leHBhbmRLZXkiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZXhwYW5kS2V5KGNpcGhlcktleSkgewogICAgICAgICAgdmFyIGIgPSAxNzY7CiAgICAgICAgICB2YXIgcyA9IHRoaXMuX3M7CiAgICAgICAgICB2YXIgcmNvbiA9IHRoaXMuX3Jjb247CiAgICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFVpbnQ4QXJyYXkoYik7CiAgICAgICAgICByZXN1bHQuc2V0KGNpcGhlcktleSk7CgogICAgICAgICAgZm9yICh2YXIgaiA9IDE2LCBpID0gMTsgaiA8IGI7ICsraSkgewogICAgICAgICAgICB2YXIgdDEgPSByZXN1bHRbaiAtIDNdOwogICAgICAgICAgICB2YXIgdDIgPSByZXN1bHRbaiAtIDJdOwogICAgICAgICAgICB2YXIgdDMgPSByZXN1bHRbaiAtIDFdOwogICAgICAgICAgICB2YXIgdDQgPSByZXN1bHRbaiAtIDRdOwogICAgICAgICAgICB0MSA9IHNbdDFdOwogICAgICAgICAgICB0MiA9IHNbdDJdOwogICAgICAgICAgICB0MyA9IHNbdDNdOwogICAgICAgICAgICB0NCA9IHNbdDRdOwogICAgICAgICAgICB0MSA9IHQxIF4gcmNvbltpXTsKCiAgICAgICAgICAgIGZvciAodmFyIG4gPSAwOyBuIDwgNDsgKytuKSB7CiAgICAgICAgICAgICAgcmVzdWx0W2pdID0gdDEgXj0gcmVzdWx0W2ogLSAxNl07CiAgICAgICAgICAgICAgaisrOwogICAgICAgICAgICAgIHJlc3VsdFtqXSA9IHQyIF49IHJlc3VsdFtqIC0gMTZdOwogICAgICAgICAgICAgIGorKzsKICAgICAgICAgICAgICByZXN1bHRbal0gPSB0MyBePSByZXN1bHRbaiAtIDE2XTsKICAgICAgICAgICAgICBqKys7CiAgICAgICAgICAgICAgcmVzdWx0W2pdID0gdDQgXj0gcmVzdWx0W2ogLSAxNl07CiAgICAgICAgICAgICAgaisrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBBRVMxMjhDaXBoZXI7CiAgICB9KEFFU0Jhc2VDaXBoZXIpOwoKICAgIGV4cG9ydHMuQUVTMTI4Q2lwaGVyID0gQUVTMTI4Q2lwaGVyOwoKICAgIHZhciBBRVMyNTZDaXBoZXIgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9BRVNCYXNlQ2lwaGVyMikgewogICAgICBfaW5oZXJpdHMoQUVTMjU2Q2lwaGVyLCBfQUVTQmFzZUNpcGhlcjIpOwoKICAgICAgZnVuY3Rpb24gQUVTMjU2Q2lwaGVyKGtleSkgewogICAgICAgIHZhciBfdGhpczI7CgogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBBRVMyNTZDaXBoZXIpOwoKICAgICAgICBfdGhpczIgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoQUVTMjU2Q2lwaGVyKS5jYWxsKHRoaXMpKTsKICAgICAgICBfdGhpczIuX2N5Y2xlc09mUmVwZXRpdGlvbiA9IDE0OwogICAgICAgIF90aGlzMi5fa2V5U2l6ZSA9IDIyNDsKICAgICAgICBfdGhpczIuX2tleSA9IF90aGlzMi5fZXhwYW5kS2V5KGtleSk7CiAgICAgICAgcmV0dXJuIF90aGlzMjsKICAgICAgfQoKICAgICAgX2NyZWF0ZUNsYXNzKEFFUzI1NkNpcGhlciwgW3sKICAgICAgICBrZXk6ICJfZXhwYW5kS2V5IiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX2V4cGFuZEtleShjaXBoZXJLZXkpIHsKICAgICAgICAgIHZhciBiID0gMjQwOwogICAgICAgICAgdmFyIHMgPSB0aGlzLl9zOwogICAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBVaW50OEFycmF5KGIpOwogICAgICAgICAgcmVzdWx0LnNldChjaXBoZXJLZXkpOwogICAgICAgICAgdmFyIHIgPSAxOwogICAgICAgICAgdmFyIHQxLCB0MiwgdDMsIHQ0OwoKICAgICAgICAgIGZvciAodmFyIGogPSAzMiwgaSA9IDE7IGogPCBiOyArK2kpIHsKICAgICAgICAgICAgaWYgKGogJSAzMiA9PT0gMTYpIHsKICAgICAgICAgICAgICB0MSA9IHNbdDFdOwogICAgICAgICAgICAgIHQyID0gc1t0Ml07CiAgICAgICAgICAgICAgdDMgPSBzW3QzXTsKICAgICAgICAgICAgICB0NCA9IHNbdDRdOwogICAgICAgICAgICB9IGVsc2UgaWYgKGogJSAzMiA9PT0gMCkgewogICAgICAgICAgICAgIHQxID0gcmVzdWx0W2ogLSAzXTsKICAgICAgICAgICAgICB0MiA9IHJlc3VsdFtqIC0gMl07CiAgICAgICAgICAgICAgdDMgPSByZXN1bHRbaiAtIDFdOwogICAgICAgICAgICAgIHQ0ID0gcmVzdWx0W2ogLSA0XTsKICAgICAgICAgICAgICB0MSA9IHNbdDFdOwogICAgICAgICAgICAgIHQyID0gc1t0Ml07CiAgICAgICAgICAgICAgdDMgPSBzW3QzXTsKICAgICAgICAgICAgICB0NCA9IHNbdDRdOwogICAgICAgICAgICAgIHQxID0gdDEgXiByOwoKICAgICAgICAgICAgICBpZiAoKHIgPDw9IDEpID49IDI1NikgewogICAgICAgICAgICAgICAgciA9IChyIF4gMHgxYikgJiAweGZmOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9yICh2YXIgbiA9IDA7IG4gPCA0OyArK24pIHsKICAgICAgICAgICAgICByZXN1bHRbal0gPSB0MSBePSByZXN1bHRbaiAtIDMyXTsKICAgICAgICAgICAgICBqKys7CiAgICAgICAgICAgICAgcmVzdWx0W2pdID0gdDIgXj0gcmVzdWx0W2ogLSAzMl07CiAgICAgICAgICAgICAgaisrOwogICAgICAgICAgICAgIHJlc3VsdFtqXSA9IHQzIF49IHJlc3VsdFtqIC0gMzJdOwogICAgICAgICAgICAgIGorKzsKICAgICAgICAgICAgICByZXN1bHRbal0gPSB0NCBePSByZXN1bHRbaiAtIDMyXTsKICAgICAgICAgICAgICBqKys7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIEFFUzI1NkNpcGhlcjsKICAgIH0oQUVTQmFzZUNpcGhlcik7CgogICAgZXhwb3J0cy5BRVMyNTZDaXBoZXIgPSBBRVMyNTZDaXBoZXI7CgogICAgdmFyIFBERjE3ID0gZnVuY3Rpb24gUERGMTdDbG9zdXJlKCkgewogICAgICBmdW5jdGlvbiBjb21wYXJlQnl0ZUFycmF5cyhhcnJheTEsIGFycmF5MikgewogICAgICAgIGlmIChhcnJheTEubGVuZ3RoICE9PSBhcnJheTIubGVuZ3RoKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5MS5sZW5ndGg7IGkrKykgewogICAgICAgICAgaWYgKGFycmF5MVtpXSAhPT0gYXJyYXkyW2ldKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CgogICAgICBmdW5jdGlvbiBQREYxNygpIHt9CgogICAgICBQREYxNy5wcm90b3R5cGUgPSB7CiAgICAgICAgY2hlY2tPd25lclBhc3N3b3JkOiBmdW5jdGlvbiBQREYxN19jaGVja093bmVyUGFzc3dvcmQocGFzc3dvcmQsIG93bmVyVmFsaWRhdGlvblNhbHQsIHVzZXJCeXRlcywgb3duZXJQYXNzd29yZCkgewogICAgICAgICAgdmFyIGhhc2hEYXRhID0gbmV3IFVpbnQ4QXJyYXkocGFzc3dvcmQubGVuZ3RoICsgNTYpOwogICAgICAgICAgaGFzaERhdGEuc2V0KHBhc3N3b3JkLCAwKTsKICAgICAgICAgIGhhc2hEYXRhLnNldChvd25lclZhbGlkYXRpb25TYWx0LCBwYXNzd29yZC5sZW5ndGgpOwogICAgICAgICAgaGFzaERhdGEuc2V0KHVzZXJCeXRlcywgcGFzc3dvcmQubGVuZ3RoICsgb3duZXJWYWxpZGF0aW9uU2FsdC5sZW5ndGgpOwogICAgICAgICAgdmFyIHJlc3VsdCA9IGNhbGN1bGF0ZVNIQTI1NihoYXNoRGF0YSwgMCwgaGFzaERhdGEubGVuZ3RoKTsKICAgICAgICAgIHJldHVybiBjb21wYXJlQnl0ZUFycmF5cyhyZXN1bHQsIG93bmVyUGFzc3dvcmQpOwogICAgICAgIH0sCiAgICAgICAgY2hlY2tVc2VyUGFzc3dvcmQ6IGZ1bmN0aW9uIFBERjE3X2NoZWNrVXNlclBhc3N3b3JkKHBhc3N3b3JkLCB1c2VyVmFsaWRhdGlvblNhbHQsIHVzZXJQYXNzd29yZCkgewogICAgICAgICAgdmFyIGhhc2hEYXRhID0gbmV3IFVpbnQ4QXJyYXkocGFzc3dvcmQubGVuZ3RoICsgOCk7CiAgICAgICAgICBoYXNoRGF0YS5zZXQocGFzc3dvcmQsIDApOwogICAgICAgICAgaGFzaERhdGEuc2V0KHVzZXJWYWxpZGF0aW9uU2FsdCwgcGFzc3dvcmQubGVuZ3RoKTsKICAgICAgICAgIHZhciByZXN1bHQgPSBjYWxjdWxhdGVTSEEyNTYoaGFzaERhdGEsIDAsIGhhc2hEYXRhLmxlbmd0aCk7CiAgICAgICAgICByZXR1cm4gY29tcGFyZUJ5dGVBcnJheXMocmVzdWx0LCB1c2VyUGFzc3dvcmQpOwogICAgICAgIH0sCiAgICAgICAgZ2V0T3duZXJLZXk6IGZ1bmN0aW9uIFBERjE3X2dldE93bmVyS2V5KHBhc3N3b3JkLCBvd25lcktleVNhbHQsIHVzZXJCeXRlcywgb3duZXJFbmNyeXB0aW9uKSB7CiAgICAgICAgICB2YXIgaGFzaERhdGEgPSBuZXcgVWludDhBcnJheShwYXNzd29yZC5sZW5ndGggKyA1Nik7CiAgICAgICAgICBoYXNoRGF0YS5zZXQocGFzc3dvcmQsIDApOwogICAgICAgICAgaGFzaERhdGEuc2V0KG93bmVyS2V5U2FsdCwgcGFzc3dvcmQubGVuZ3RoKTsKICAgICAgICAgIGhhc2hEYXRhLnNldCh1c2VyQnl0ZXMsIHBhc3N3b3JkLmxlbmd0aCArIG93bmVyS2V5U2FsdC5sZW5ndGgpOwogICAgICAgICAgdmFyIGtleSA9IGNhbGN1bGF0ZVNIQTI1NihoYXNoRGF0YSwgMCwgaGFzaERhdGEubGVuZ3RoKTsKICAgICAgICAgIHZhciBjaXBoZXIgPSBuZXcgQUVTMjU2Q2lwaGVyKGtleSk7CiAgICAgICAgICByZXR1cm4gY2lwaGVyLmRlY3J5cHRCbG9jayhvd25lckVuY3J5cHRpb24sIGZhbHNlLCBuZXcgVWludDhBcnJheSgxNikpOwogICAgICAgIH0sCiAgICAgICAgZ2V0VXNlcktleTogZnVuY3Rpb24gUERGMTdfZ2V0VXNlcktleShwYXNzd29yZCwgdXNlcktleVNhbHQsIHVzZXJFbmNyeXB0aW9uKSB7CiAgICAgICAgICB2YXIgaGFzaERhdGEgPSBuZXcgVWludDhBcnJheShwYXNzd29yZC5sZW5ndGggKyA4KTsKICAgICAgICAgIGhhc2hEYXRhLnNldChwYXNzd29yZCwgMCk7CiAgICAgICAgICBoYXNoRGF0YS5zZXQodXNlcktleVNhbHQsIHBhc3N3b3JkLmxlbmd0aCk7CiAgICAgICAgICB2YXIga2V5ID0gY2FsY3VsYXRlU0hBMjU2KGhhc2hEYXRhLCAwLCBoYXNoRGF0YS5sZW5ndGgpOwogICAgICAgICAgdmFyIGNpcGhlciA9IG5ldyBBRVMyNTZDaXBoZXIoa2V5KTsKICAgICAgICAgIHJldHVybiBjaXBoZXIuZGVjcnlwdEJsb2NrKHVzZXJFbmNyeXB0aW9uLCBmYWxzZSwgbmV3IFVpbnQ4QXJyYXkoMTYpKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHJldHVybiBQREYxNzsKICAgIH0oKTsKCiAgICBleHBvcnRzLlBERjE3ID0gUERGMTc7CgogICAgdmFyIFBERjIwID0gZnVuY3Rpb24gUERGMjBDbG9zdXJlKCkgewogICAgICBmdW5jdGlvbiBjb25jYXRBcnJheXMoYXJyYXkxLCBhcnJheTIpIHsKICAgICAgICB2YXIgdCA9IG5ldyBVaW50OEFycmF5KGFycmF5MS5sZW5ndGggKyBhcnJheTIubGVuZ3RoKTsKICAgICAgICB0LnNldChhcnJheTEsIDApOwogICAgICAgIHQuc2V0KGFycmF5MiwgYXJyYXkxLmxlbmd0aCk7CiAgICAgICAgcmV0dXJuIHQ7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVBERjIwSGFzaChwYXNzd29yZCwgaW5wdXQsIHVzZXJCeXRlcykgewogICAgICAgIHZhciBrID0gY2FsY3VsYXRlU0hBMjU2KGlucHV0LCAwLCBpbnB1dC5sZW5ndGgpLnN1YmFycmF5KDAsIDMyKTsKICAgICAgICB2YXIgZSA9IFswXTsKICAgICAgICB2YXIgaSA9IDA7CgogICAgICAgIHdoaWxlIChpIDwgNjQgfHwgZVtlLmxlbmd0aCAtIDFdID4gaSAtIDMyKSB7CiAgICAgICAgICB2YXIgYXJyYXlMZW5ndGggPSBwYXNzd29yZC5sZW5ndGggKyBrLmxlbmd0aCArIHVzZXJCeXRlcy5sZW5ndGg7CiAgICAgICAgICB2YXIgazEgPSBuZXcgVWludDhBcnJheShhcnJheUxlbmd0aCAqIDY0KTsKICAgICAgICAgIHZhciBhcnJheSA9IGNvbmNhdEFycmF5cyhwYXNzd29yZCwgayk7CiAgICAgICAgICBhcnJheSA9IGNvbmNhdEFycmF5cyhhcnJheSwgdXNlckJ5dGVzKTsKCiAgICAgICAgICBmb3IgKHZhciBqID0gMCwgcG9zID0gMDsgaiA8IDY0OyBqKyssIHBvcyArPSBhcnJheUxlbmd0aCkgewogICAgICAgICAgICBrMS5zZXQoYXJyYXksIHBvcyk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGNpcGhlciA9IG5ldyBBRVMxMjhDaXBoZXIoay5zdWJhcnJheSgwLCAxNikpOwogICAgICAgICAgZSA9IGNpcGhlci5lbmNyeXB0KGsxLCBrLnN1YmFycmF5KDE2LCAzMikpOwogICAgICAgICAgdmFyIHJlbWFpbmRlciA9IDA7CgogICAgICAgICAgZm9yICh2YXIgeiA9IDA7IHogPCAxNjsgeisrKSB7CiAgICAgICAgICAgIHJlbWFpbmRlciAqPSAyNTYgJSAzOwogICAgICAgICAgICByZW1haW5kZXIgJT0gMzsKICAgICAgICAgICAgcmVtYWluZGVyICs9IChlW3pdID4+PiAwKSAlIDM7CiAgICAgICAgICAgIHJlbWFpbmRlciAlPSAzOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChyZW1haW5kZXIgPT09IDApIHsKICAgICAgICAgICAgayA9IGNhbGN1bGF0ZVNIQTI1NihlLCAwLCBlLmxlbmd0aCk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlbWFpbmRlciA9PT0gMSkgewogICAgICAgICAgICBrID0gY2FsY3VsYXRlU0hBMzg0KGUsIDAsIGUubGVuZ3RoKTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVtYWluZGVyID09PSAyKSB7CiAgICAgICAgICAgIGsgPSBjYWxjdWxhdGVTSEE1MTIoZSwgMCwgZS5sZW5ndGgpOwogICAgICAgICAgfQoKICAgICAgICAgIGkrKzsKICAgICAgICB9CgogICAgICAgIHJldHVybiBrLnN1YmFycmF5KDAsIDMyKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gUERGMjAoKSB7fQoKICAgICAgZnVuY3Rpb24gY29tcGFyZUJ5dGVBcnJheXMoYXJyYXkxLCBhcnJheTIpIHsKICAgICAgICBpZiAoYXJyYXkxLmxlbmd0aCAhPT0gYXJyYXkyLmxlbmd0aCkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnJheTEubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlmIChhcnJheTFbaV0gIT09IGFycmF5MltpXSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgUERGMjAucHJvdG90eXBlID0gewogICAgICAgIGhhc2g6IGZ1bmN0aW9uIFBERjIwX2hhc2gocGFzc3dvcmQsIGNvbmNhdEJ5dGVzLCB1c2VyQnl0ZXMpIHsKICAgICAgICAgIHJldHVybiBjYWxjdWxhdGVQREYyMEhhc2gocGFzc3dvcmQsIGNvbmNhdEJ5dGVzLCB1c2VyQnl0ZXMpOwogICAgICAgIH0sCiAgICAgICAgY2hlY2tPd25lclBhc3N3b3JkOiBmdW5jdGlvbiBQREYyMF9jaGVja093bmVyUGFzc3dvcmQocGFzc3dvcmQsIG93bmVyVmFsaWRhdGlvblNhbHQsIHVzZXJCeXRlcywgb3duZXJQYXNzd29yZCkgewogICAgICAgICAgdmFyIGhhc2hEYXRhID0gbmV3IFVpbnQ4QXJyYXkocGFzc3dvcmQubGVuZ3RoICsgNTYpOwogICAgICAgICAgaGFzaERhdGEuc2V0KHBhc3N3b3JkLCAwKTsKICAgICAgICAgIGhhc2hEYXRhLnNldChvd25lclZhbGlkYXRpb25TYWx0LCBwYXNzd29yZC5sZW5ndGgpOwogICAgICAgICAgaGFzaERhdGEuc2V0KHVzZXJCeXRlcywgcGFzc3dvcmQubGVuZ3RoICsgb3duZXJWYWxpZGF0aW9uU2FsdC5sZW5ndGgpOwogICAgICAgICAgdmFyIHJlc3VsdCA9IGNhbGN1bGF0ZVBERjIwSGFzaChwYXNzd29yZCwgaGFzaERhdGEsIHVzZXJCeXRlcyk7CiAgICAgICAgICByZXR1cm4gY29tcGFyZUJ5dGVBcnJheXMocmVzdWx0LCBvd25lclBhc3N3b3JkKTsKICAgICAgICB9LAogICAgICAgIGNoZWNrVXNlclBhc3N3b3JkOiBmdW5jdGlvbiBQREYyMF9jaGVja1VzZXJQYXNzd29yZChwYXNzd29yZCwgdXNlclZhbGlkYXRpb25TYWx0LCB1c2VyUGFzc3dvcmQpIHsKICAgICAgICAgIHZhciBoYXNoRGF0YSA9IG5ldyBVaW50OEFycmF5KHBhc3N3b3JkLmxlbmd0aCArIDgpOwogICAgICAgICAgaGFzaERhdGEuc2V0KHBhc3N3b3JkLCAwKTsKICAgICAgICAgIGhhc2hEYXRhLnNldCh1c2VyVmFsaWRhdGlvblNhbHQsIHBhc3N3b3JkLmxlbmd0aCk7CiAgICAgICAgICB2YXIgcmVzdWx0ID0gY2FsY3VsYXRlUERGMjBIYXNoKHBhc3N3b3JkLCBoYXNoRGF0YSwgW10pOwogICAgICAgICAgcmV0dXJuIGNvbXBhcmVCeXRlQXJyYXlzKHJlc3VsdCwgdXNlclBhc3N3b3JkKTsKICAgICAgICB9LAogICAgICAgIGdldE93bmVyS2V5OiBmdW5jdGlvbiBQREYyMF9nZXRPd25lcktleShwYXNzd29yZCwgb3duZXJLZXlTYWx0LCB1c2VyQnl0ZXMsIG93bmVyRW5jcnlwdGlvbikgewogICAgICAgICAgdmFyIGhhc2hEYXRhID0gbmV3IFVpbnQ4QXJyYXkocGFzc3dvcmQubGVuZ3RoICsgNTYpOwogICAgICAgICAgaGFzaERhdGEuc2V0KHBhc3N3b3JkLCAwKTsKICAgICAgICAgIGhhc2hEYXRhLnNldChvd25lcktleVNhbHQsIHBhc3N3b3JkLmxlbmd0aCk7CiAgICAgICAgICBoYXNoRGF0YS5zZXQodXNlckJ5dGVzLCBwYXNzd29yZC5sZW5ndGggKyBvd25lcktleVNhbHQubGVuZ3RoKTsKICAgICAgICAgIHZhciBrZXkgPSBjYWxjdWxhdGVQREYyMEhhc2gocGFzc3dvcmQsIGhhc2hEYXRhLCB1c2VyQnl0ZXMpOwogICAgICAgICAgdmFyIGNpcGhlciA9IG5ldyBBRVMyNTZDaXBoZXIoa2V5KTsKICAgICAgICAgIHJldHVybiBjaXBoZXIuZGVjcnlwdEJsb2NrKG93bmVyRW5jcnlwdGlvbiwgZmFsc2UsIG5ldyBVaW50OEFycmF5KDE2KSk7CiAgICAgICAgfSwKICAgICAgICBnZXRVc2VyS2V5OiBmdW5jdGlvbiBQREYyMF9nZXRVc2VyS2V5KHBhc3N3b3JkLCB1c2VyS2V5U2FsdCwgdXNlckVuY3J5cHRpb24pIHsKICAgICAgICAgIHZhciBoYXNoRGF0YSA9IG5ldyBVaW50OEFycmF5KHBhc3N3b3JkLmxlbmd0aCArIDgpOwogICAgICAgICAgaGFzaERhdGEuc2V0KHBhc3N3b3JkLCAwKTsKICAgICAgICAgIGhhc2hEYXRhLnNldCh1c2VyS2V5U2FsdCwgcGFzc3dvcmQubGVuZ3RoKTsKICAgICAgICAgIHZhciBrZXkgPSBjYWxjdWxhdGVQREYyMEhhc2gocGFzc3dvcmQsIGhhc2hEYXRhLCBbXSk7CiAgICAgICAgICB2YXIgY2lwaGVyID0gbmV3IEFFUzI1NkNpcGhlcihrZXkpOwogICAgICAgICAgcmV0dXJuIGNpcGhlci5kZWNyeXB0QmxvY2sodXNlckVuY3J5cHRpb24sIGZhbHNlLCBuZXcgVWludDhBcnJheSgxNikpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgcmV0dXJuIFBERjIwOwogICAgfSgpOwoKICAgIGV4cG9ydHMuUERGMjAgPSBQREYyMDsKCiAgICB2YXIgQ2lwaGVyVHJhbnNmb3JtID0gZnVuY3Rpb24gQ2lwaGVyVHJhbnNmb3JtQ2xvc3VyZSgpIHsKICAgICAgZnVuY3Rpb24gQ2lwaGVyVHJhbnNmb3JtKHN0cmluZ0NpcGhlckNvbnN0cnVjdG9yLCBzdHJlYW1DaXBoZXJDb25zdHJ1Y3RvcikgewogICAgICAgIHRoaXMuU3RyaW5nQ2lwaGVyQ29uc3RydWN0b3IgPSBzdHJpbmdDaXBoZXJDb25zdHJ1Y3RvcjsKICAgICAgICB0aGlzLlN0cmVhbUNpcGhlckNvbnN0cnVjdG9yID0gc3RyZWFtQ2lwaGVyQ29uc3RydWN0b3I7CiAgICAgIH0KCiAgICAgIENpcGhlclRyYW5zZm9ybS5wcm90b3R5cGUgPSB7CiAgICAgICAgY3JlYXRlU3RyZWFtOiBmdW5jdGlvbiBDaXBoZXJUcmFuc2Zvcm1fY3JlYXRlU3RyZWFtKHN0cmVhbSwgbGVuZ3RoKSB7CiAgICAgICAgICB2YXIgY2lwaGVyID0gbmV3IHRoaXMuU3RyZWFtQ2lwaGVyQ29uc3RydWN0b3IoKTsKICAgICAgICAgIHJldHVybiBuZXcgX3N0cmVhbS5EZWNyeXB0U3RyZWFtKHN0cmVhbSwgbGVuZ3RoLCBmdW5jdGlvbiBjaXBoZXJUcmFuc2Zvcm1EZWNyeXB0U3RyZWFtKGRhdGEsIGZpbmFsaXplKSB7CiAgICAgICAgICAgIHJldHVybiBjaXBoZXIuZGVjcnlwdEJsb2NrKGRhdGEsIGZpbmFsaXplKTsKICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgZGVjcnlwdFN0cmluZzogZnVuY3Rpb24gQ2lwaGVyVHJhbnNmb3JtX2RlY3J5cHRTdHJpbmcocykgewogICAgICAgICAgdmFyIGNpcGhlciA9IG5ldyB0aGlzLlN0cmluZ0NpcGhlckNvbnN0cnVjdG9yKCk7CiAgICAgICAgICB2YXIgZGF0YSA9ICgwLCBfdXRpbC5zdHJpbmdUb0J5dGVzKShzKTsKICAgICAgICAgIGRhdGEgPSBjaXBoZXIuZGVjcnlwdEJsb2NrKGRhdGEsIHRydWUpOwogICAgICAgICAgcmV0dXJuICgwLCBfdXRpbC5ieXRlc1RvU3RyaW5nKShkYXRhKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHJldHVybiBDaXBoZXJUcmFuc2Zvcm07CiAgICB9KCk7CgogICAgdmFyIENpcGhlclRyYW5zZm9ybUZhY3RvcnkgPSBmdW5jdGlvbiBDaXBoZXJUcmFuc2Zvcm1GYWN0b3J5Q2xvc3VyZSgpIHsKICAgICAgdmFyIGRlZmF1bHRQYXNzd29yZEJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoWzB4MjgsIDB4QkYsIDB4NEUsIDB4NUUsIDB4NEUsIDB4NzUsIDB4OEEsIDB4NDEsIDB4NjQsIDB4MDAsIDB4NEUsIDB4NTYsIDB4RkYsIDB4RkEsIDB4MDEsIDB4MDgsIDB4MkUsIDB4MkUsIDB4MDAsIDB4QjYsIDB4RDAsIDB4NjgsIDB4M0UsIDB4ODAsIDB4MkYsIDB4MEMsIDB4QTksIDB4RkUsIDB4NjQsIDB4NTMsIDB4NjksIDB4N0FdKTsKCiAgICAgIGZ1bmN0aW9uIGNyZWF0ZUVuY3J5cHRpb25LZXkyMChyZXZpc2lvbiwgcGFzc3dvcmQsIG93bmVyUGFzc3dvcmQsIG93bmVyVmFsaWRhdGlvblNhbHQsIG93bmVyS2V5U2FsdCwgdUJ5dGVzLCB1c2VyUGFzc3dvcmQsIHVzZXJWYWxpZGF0aW9uU2FsdCwgdXNlcktleVNhbHQsIG93bmVyRW5jcnlwdGlvbiwgdXNlckVuY3J5cHRpb24sIHBlcm1zKSB7CiAgICAgICAgaWYgKHBhc3N3b3JkKSB7CiAgICAgICAgICB2YXIgcGFzc3dvcmRMZW5ndGggPSBNYXRoLm1pbigxMjcsIHBhc3N3b3JkLmxlbmd0aCk7CiAgICAgICAgICBwYXNzd29yZCA9IHBhc3N3b3JkLnN1YmFycmF5KDAsIHBhc3N3b3JkTGVuZ3RoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcGFzc3dvcmQgPSBbXTsKICAgICAgICB9CgogICAgICAgIHZhciBwZGZBbGdvcml0aG07CgogICAgICAgIGlmIChyZXZpc2lvbiA9PT0gNikgewogICAgICAgICAgcGRmQWxnb3JpdGhtID0gbmV3IFBERjIwKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHBkZkFsZ29yaXRobSA9IG5ldyBQREYxNygpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHBkZkFsZ29yaXRobS5jaGVja1VzZXJQYXNzd29yZChwYXNzd29yZCwgdXNlclZhbGlkYXRpb25TYWx0LCB1c2VyUGFzc3dvcmQpKSB7CiAgICAgICAgICByZXR1cm4gcGRmQWxnb3JpdGhtLmdldFVzZXJLZXkocGFzc3dvcmQsIHVzZXJLZXlTYWx0LCB1c2VyRW5jcnlwdGlvbik7CiAgICAgICAgfSBlbHNlIGlmIChwYXNzd29yZC5sZW5ndGggJiYgcGRmQWxnb3JpdGhtLmNoZWNrT3duZXJQYXNzd29yZChwYXNzd29yZCwgb3duZXJWYWxpZGF0aW9uU2FsdCwgdUJ5dGVzLCBvd25lclBhc3N3b3JkKSkgewogICAgICAgICAgcmV0dXJuIHBkZkFsZ29yaXRobS5nZXRPd25lcktleShwYXNzd29yZCwgb3duZXJLZXlTYWx0LCB1Qnl0ZXMsIG93bmVyRW5jcnlwdGlvbik7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gcHJlcGFyZUtleURhdGEoZmlsZUlkLCBwYXNzd29yZCwgb3duZXJQYXNzd29yZCwgdXNlclBhc3N3b3JkLCBmbGFncywgcmV2aXNpb24sIGtleUxlbmd0aCwgZW5jcnlwdE1ldGFkYXRhKSB7CiAgICAgICAgdmFyIGhhc2hEYXRhU2l6ZSA9IDQwICsgb3duZXJQYXNzd29yZC5sZW5ndGggKyBmaWxlSWQubGVuZ3RoOwogICAgICAgIHZhciBoYXNoRGF0YSA9IG5ldyBVaW50OEFycmF5KGhhc2hEYXRhU2l6ZSksCiAgICAgICAgICBpID0gMCwKICAgICAgICAgIGosCiAgICAgICAgICBuOwoKICAgICAgICBpZiAocGFzc3dvcmQpIHsKICAgICAgICAgIG4gPSBNYXRoLm1pbigzMiwgcGFzc3dvcmQubGVuZ3RoKTsKCiAgICAgICAgICBmb3IgKDsgaSA8IG47ICsraSkgewogICAgICAgICAgICBoYXNoRGF0YVtpXSA9IHBhc3N3b3JkW2ldOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaiA9IDA7CgogICAgICAgIHdoaWxlIChpIDwgMzIpIHsKICAgICAgICAgIGhhc2hEYXRhW2krK10gPSBkZWZhdWx0UGFzc3dvcmRCeXRlc1tqKytdOwogICAgICAgIH0KCiAgICAgICAgZm9yIChqID0gMCwgbiA9IG93bmVyUGFzc3dvcmQubGVuZ3RoOyBqIDwgbjsgKytqKSB7CiAgICAgICAgICBoYXNoRGF0YVtpKytdID0gb3duZXJQYXNzd29yZFtqXTsKICAgICAgICB9CgogICAgICAgIGhhc2hEYXRhW2krK10gPSBmbGFncyAmIDB4ZmY7CiAgICAgICAgaGFzaERhdGFbaSsrXSA9IGZsYWdzID4+IDggJiAweGZmOwogICAgICAgIGhhc2hEYXRhW2krK10gPSBmbGFncyA+PiAxNiAmIDB4ZmY7CiAgICAgICAgaGFzaERhdGFbaSsrXSA9IGZsYWdzID4+PiAyNCAmIDB4ZmY7CgogICAgICAgIGZvciAoaiA9IDAsIG4gPSBmaWxlSWQubGVuZ3RoOyBqIDwgbjsgKytqKSB7CiAgICAgICAgICBoYXNoRGF0YVtpKytdID0gZmlsZUlkW2pdOwogICAgICAgIH0KCiAgICAgICAgaWYgKHJldmlzaW9uID49IDQgJiYgIWVuY3J5cHRNZXRhZGF0YSkgewogICAgICAgICAgaGFzaERhdGFbaSsrXSA9IDB4ZmY7CiAgICAgICAgICBoYXNoRGF0YVtpKytdID0gMHhmZjsKICAgICAgICAgIGhhc2hEYXRhW2krK10gPSAweGZmOwogICAgICAgICAgaGFzaERhdGFbaSsrXSA9IDB4ZmY7CiAgICAgICAgfQoKICAgICAgICB2YXIgaGFzaCA9IGNhbGN1bGF0ZU1ENShoYXNoRGF0YSwgMCwgaSk7CiAgICAgICAgdmFyIGtleUxlbmd0aEluQnl0ZXMgPSBrZXlMZW5ndGggPj4gMzsKCiAgICAgICAgaWYgKHJldmlzaW9uID49IDMpIHsKICAgICAgICAgIGZvciAoaiA9IDA7IGogPCA1MDsgKytqKSB7CiAgICAgICAgICAgIGhhc2ggPSBjYWxjdWxhdGVNRDUoaGFzaCwgMCwga2V5TGVuZ3RoSW5CeXRlcyk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YXIgZW5jcnlwdGlvbktleSA9IGhhc2guc3ViYXJyYXkoMCwga2V5TGVuZ3RoSW5CeXRlcyk7CiAgICAgICAgdmFyIGNpcGhlciwgY2hlY2tEYXRhOwoKICAgICAgICBpZiAocmV2aXNpb24gPj0gMykgewogICAgICAgICAgZm9yIChpID0gMDsgaSA8IDMyOyArK2kpIHsKICAgICAgICAgICAgaGFzaERhdGFbaV0gPSBkZWZhdWx0UGFzc3dvcmRCeXRlc1tpXTsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3IgKGogPSAwLCBuID0gZmlsZUlkLmxlbmd0aDsgaiA8IG47ICsraikgewogICAgICAgICAgICBoYXNoRGF0YVtpKytdID0gZmlsZUlkW2pdOwogICAgICAgICAgfQoKICAgICAgICAgIGNpcGhlciA9IG5ldyBBUkNGb3VyQ2lwaGVyKGVuY3J5cHRpb25LZXkpOwogICAgICAgICAgY2hlY2tEYXRhID0gY2lwaGVyLmVuY3J5cHRCbG9jayhjYWxjdWxhdGVNRDUoaGFzaERhdGEsIDAsIGkpKTsKICAgICAgICAgIG4gPSBlbmNyeXB0aW9uS2V5Lmxlbmd0aDsKICAgICAgICAgIHZhciBkZXJpdmVkS2V5ID0gbmV3IFVpbnQ4QXJyYXkobiksCiAgICAgICAgICAgIGs7CgogICAgICAgICAgZm9yIChqID0gMTsgaiA8PSAxOTsgKytqKSB7CiAgICAgICAgICAgIGZvciAoayA9IDA7IGsgPCBuOyArK2spIHsKICAgICAgICAgICAgICBkZXJpdmVkS2V5W2tdID0gZW5jcnlwdGlvbktleVtrXSBeIGo7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNpcGhlciA9IG5ldyBBUkNGb3VyQ2lwaGVyKGRlcml2ZWRLZXkpOwogICAgICAgICAgICBjaGVja0RhdGEgPSBjaXBoZXIuZW5jcnlwdEJsb2NrKGNoZWNrRGF0YSk7CiAgICAgICAgICB9CgogICAgICAgICAgZm9yIChqID0gMCwgbiA9IGNoZWNrRGF0YS5sZW5ndGg7IGogPCBuOyArK2opIHsKICAgICAgICAgICAgaWYgKHVzZXJQYXNzd29yZFtqXSAhPT0gY2hlY2tEYXRhW2pdKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgY2lwaGVyID0gbmV3IEFSQ0ZvdXJDaXBoZXIoZW5jcnlwdGlvbktleSk7CiAgICAgICAgICBjaGVja0RhdGEgPSBjaXBoZXIuZW5jcnlwdEJsb2NrKGRlZmF1bHRQYXNzd29yZEJ5dGVzKTsKCiAgICAgICAgICBmb3IgKGogPSAwLCBuID0gY2hlY2tEYXRhLmxlbmd0aDsgaiA8IG47ICsraikgewogICAgICAgICAgICBpZiAodXNlclBhc3N3b3JkW2pdICE9PSBjaGVja0RhdGFbal0pIHsKICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGVuY3J5cHRpb25LZXk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGRlY29kZVVzZXJQYXNzd29yZChwYXNzd29yZCwgb3duZXJQYXNzd29yZCwgcmV2aXNpb24sIGtleUxlbmd0aCkgewogICAgICAgIHZhciBoYXNoRGF0YSA9IG5ldyBVaW50OEFycmF5KDMyKSwKICAgICAgICAgIGkgPSAwLAogICAgICAgICAgaiwKICAgICAgICAgIG47CiAgICAgICAgbiA9IE1hdGgubWluKDMyLCBwYXNzd29yZC5sZW5ndGgpOwoKICAgICAgICBmb3IgKDsgaSA8IG47ICsraSkgewogICAgICAgICAgaGFzaERhdGFbaV0gPSBwYXNzd29yZFtpXTsKICAgICAgICB9CgogICAgICAgIGogPSAwOwoKICAgICAgICB3aGlsZSAoaSA8IDMyKSB7CiAgICAgICAgICBoYXNoRGF0YVtpKytdID0gZGVmYXVsdFBhc3N3b3JkQnl0ZXNbaisrXTsKICAgICAgICB9CgogICAgICAgIHZhciBoYXNoID0gY2FsY3VsYXRlTUQ1KGhhc2hEYXRhLCAwLCBpKTsKICAgICAgICB2YXIga2V5TGVuZ3RoSW5CeXRlcyA9IGtleUxlbmd0aCA+PiAzOwoKICAgICAgICBpZiAocmV2aXNpb24gPj0gMykgewogICAgICAgICAgZm9yIChqID0gMDsgaiA8IDUwOyArK2opIHsKICAgICAgICAgICAgaGFzaCA9IGNhbGN1bGF0ZU1ENShoYXNoLCAwLCBoYXNoLmxlbmd0aCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YXIgY2lwaGVyLCB1c2VyUGFzc3dvcmQ7CgogICAgICAgIGlmIChyZXZpc2lvbiA+PSAzKSB7CiAgICAgICAgICB1c2VyUGFzc3dvcmQgPSBvd25lclBhc3N3b3JkOwogICAgICAgICAgdmFyIGRlcml2ZWRLZXkgPSBuZXcgVWludDhBcnJheShrZXlMZW5ndGhJbkJ5dGVzKSwKICAgICAgICAgICAgazsKCiAgICAgICAgICBmb3IgKGogPSAxOTsgaiA+PSAwOyBqLS0pIHsKICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IGtleUxlbmd0aEluQnl0ZXM7ICsraykgewogICAgICAgICAgICAgIGRlcml2ZWRLZXlba10gPSBoYXNoW2tdIF4gajsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY2lwaGVyID0gbmV3IEFSQ0ZvdXJDaXBoZXIoZGVyaXZlZEtleSk7CiAgICAgICAgICAgIHVzZXJQYXNzd29yZCA9IGNpcGhlci5lbmNyeXB0QmxvY2sodXNlclBhc3N3b3JkKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgY2lwaGVyID0gbmV3IEFSQ0ZvdXJDaXBoZXIoaGFzaC5zdWJhcnJheSgwLCBrZXlMZW5ndGhJbkJ5dGVzKSk7CiAgICAgICAgICB1c2VyUGFzc3dvcmQgPSBjaXBoZXIuZW5jcnlwdEJsb2NrKG93bmVyUGFzc3dvcmQpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHVzZXJQYXNzd29yZDsKICAgICAgfQoKICAgICAgdmFyIGlkZW50aXR5TmFtZSA9IF9wcmltaXRpdmVzLk5hbWUuZ2V0KCJJZGVudGl0eSIpOwoKICAgICAgZnVuY3Rpb24gQ2lwaGVyVHJhbnNmb3JtRmFjdG9yeShkaWN0LCBmaWxlSWQsIHBhc3N3b3JkKSB7CiAgICAgICAgdmFyIGZpbHRlciA9IGRpY3QuZ2V0KCJGaWx0ZXIiKTsKCiAgICAgICAgaWYgKCEoMCwgX3ByaW1pdGl2ZXMuaXNOYW1lKShmaWx0ZXIsICJTdGFuZGFyZCIpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoInVua25vd24gZW5jcnlwdGlvbiBtZXRob2QiKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuZGljdCA9IGRpY3Q7CiAgICAgICAgdmFyIGFsZ29yaXRobSA9IGRpY3QuZ2V0KCJWIik7CgogICAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihhbGdvcml0aG0pIHx8IGFsZ29yaXRobSAhPT0gMSAmJiBhbGdvcml0aG0gIT09IDIgJiYgYWxnb3JpdGhtICE9PSA0ICYmIGFsZ29yaXRobSAhPT0gNSkgewogICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJ1bnN1cHBvcnRlZCBlbmNyeXB0aW9uIGFsZ29yaXRobSIpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5hbGdvcml0aG0gPSBhbGdvcml0aG07CiAgICAgICAgdmFyIGtleUxlbmd0aCA9IGRpY3QuZ2V0KCJMZW5ndGgiKTsKCiAgICAgICAgaWYgKCFrZXlMZW5ndGgpIHsKICAgICAgICAgIGlmIChhbGdvcml0aG0gPD0gMykgewogICAgICAgICAgICBrZXlMZW5ndGggPSA0MDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciBjZkRpY3QgPSBkaWN0LmdldCgiQ0YiKTsKICAgICAgICAgICAgdmFyIHN0cmVhbUNyeXB0b05hbWUgPSBkaWN0LmdldCgiU3RtRiIpOwoKICAgICAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc0RpY3QpKGNmRGljdCkgJiYgKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkoc3RyZWFtQ3J5cHRvTmFtZSkpIHsKICAgICAgICAgICAgICBjZkRpY3Quc3VwcHJlc3NFbmNyeXB0aW9uID0gdHJ1ZTsKICAgICAgICAgICAgICB2YXIgaGFuZGxlckRpY3QgPSBjZkRpY3QuZ2V0KHN0cmVhbUNyeXB0b05hbWUubmFtZSk7CiAgICAgICAgICAgICAga2V5TGVuZ3RoID0gaGFuZGxlckRpY3QgJiYgaGFuZGxlckRpY3QuZ2V0KCJMZW5ndGgiKSB8fCAxMjg7CgogICAgICAgICAgICAgIGlmIChrZXlMZW5ndGggPCA0MCkgewogICAgICAgICAgICAgICAga2V5TGVuZ3RoIDw8PSAzOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGtleUxlbmd0aCkgfHwga2V5TGVuZ3RoIDwgNDAgfHwga2V5TGVuZ3RoICUgOCAhPT0gMCkgewogICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJpbnZhbGlkIGtleSBsZW5ndGgiKTsKICAgICAgICB9CgogICAgICAgIHZhciBvd25lclBhc3N3b3JkID0gKDAsIF91dGlsLnN0cmluZ1RvQnl0ZXMpKGRpY3QuZ2V0KCJPIikpLnN1YmFycmF5KDAsIDMyKTsKICAgICAgICB2YXIgdXNlclBhc3N3b3JkID0gKDAsIF91dGlsLnN0cmluZ1RvQnl0ZXMpKGRpY3QuZ2V0KCJVIikpLnN1YmFycmF5KDAsIDMyKTsKICAgICAgICB2YXIgZmxhZ3MgPSBkaWN0LmdldCgiUCIpOwogICAgICAgIHZhciByZXZpc2lvbiA9IGRpY3QuZ2V0KCJSIik7CiAgICAgICAgdmFyIGVuY3J5cHRNZXRhZGF0YSA9IChhbGdvcml0aG0gPT09IDQgfHwgYWxnb3JpdGhtID09PSA1KSAmJiBkaWN0LmdldCgiRW5jcnlwdE1ldGFkYXRhIikgIT09IGZhbHNlOwogICAgICAgIHRoaXMuZW5jcnlwdE1ldGFkYXRhID0gZW5jcnlwdE1ldGFkYXRhOwogICAgICAgIHZhciBmaWxlSWRCeXRlcyA9ICgwLCBfdXRpbC5zdHJpbmdUb0J5dGVzKShmaWxlSWQpOwogICAgICAgIHZhciBwYXNzd29yZEJ5dGVzOwoKICAgICAgICBpZiAocGFzc3dvcmQpIHsKICAgICAgICAgIGlmIChyZXZpc2lvbiA9PT0gNikgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHBhc3N3b3JkID0gKDAsIF91dGlsLnV0ZjhTdHJpbmdUb1N0cmluZykocGFzc3dvcmQpOwogICAgICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiQ2lwaGVyVHJhbnNmb3JtRmFjdG9yeTogIiArICJVbmFibGUgdG8gY29udmVydCBVVEY4IGVuY29kZWQgcGFzc3dvcmQuIik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBwYXNzd29yZEJ5dGVzID0gKDAsIF91dGlsLnN0cmluZ1RvQnl0ZXMpKHBhc3N3b3JkKTsKICAgICAgICB9CgogICAgICAgIHZhciBlbmNyeXB0aW9uS2V5OwoKICAgICAgICBpZiAoYWxnb3JpdGhtICE9PSA1KSB7CiAgICAgICAgICBlbmNyeXB0aW9uS2V5ID0gcHJlcGFyZUtleURhdGEoZmlsZUlkQnl0ZXMsIHBhc3N3b3JkQnl0ZXMsIG93bmVyUGFzc3dvcmQsIHVzZXJQYXNzd29yZCwgZmxhZ3MsIHJldmlzaW9uLCBrZXlMZW5ndGgsIGVuY3J5cHRNZXRhZGF0YSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBvd25lclZhbGlkYXRpb25TYWx0ID0gKDAsIF91dGlsLnN0cmluZ1RvQnl0ZXMpKGRpY3QuZ2V0KCJPIikpLnN1YmFycmF5KDMyLCA0MCk7CiAgICAgICAgICB2YXIgb3duZXJLZXlTYWx0ID0gKDAsIF91dGlsLnN0cmluZ1RvQnl0ZXMpKGRpY3QuZ2V0KCJPIikpLnN1YmFycmF5KDQwLCA0OCk7CiAgICAgICAgICB2YXIgdUJ5dGVzID0gKDAsIF91dGlsLnN0cmluZ1RvQnl0ZXMpKGRpY3QuZ2V0KCJVIikpLnN1YmFycmF5KDAsIDQ4KTsKICAgICAgICAgIHZhciB1c2VyVmFsaWRhdGlvblNhbHQgPSAoMCwgX3V0aWwuc3RyaW5nVG9CeXRlcykoZGljdC5nZXQoIlUiKSkuc3ViYXJyYXkoMzIsIDQwKTsKICAgICAgICAgIHZhciB1c2VyS2V5U2FsdCA9ICgwLCBfdXRpbC5zdHJpbmdUb0J5dGVzKShkaWN0LmdldCgiVSIpKS5zdWJhcnJheSg0MCwgNDgpOwogICAgICAgICAgdmFyIG93bmVyRW5jcnlwdGlvbiA9ICgwLCBfdXRpbC5zdHJpbmdUb0J5dGVzKShkaWN0LmdldCgiT0UiKSk7CiAgICAgICAgICB2YXIgdXNlckVuY3J5cHRpb24gPSAoMCwgX3V0aWwuc3RyaW5nVG9CeXRlcykoZGljdC5nZXQoIlVFIikpOwogICAgICAgICAgdmFyIHBlcm1zID0gKDAsIF91dGlsLnN0cmluZ1RvQnl0ZXMpKGRpY3QuZ2V0KCJQZXJtcyIpKTsKICAgICAgICAgIGVuY3J5cHRpb25LZXkgPSBjcmVhdGVFbmNyeXB0aW9uS2V5MjAocmV2aXNpb24sIHBhc3N3b3JkQnl0ZXMsIG93bmVyUGFzc3dvcmQsIG93bmVyVmFsaWRhdGlvblNhbHQsIG93bmVyS2V5U2FsdCwgdUJ5dGVzLCB1c2VyUGFzc3dvcmQsIHVzZXJWYWxpZGF0aW9uU2FsdCwgdXNlcktleVNhbHQsIG93bmVyRW5jcnlwdGlvbiwgdXNlckVuY3J5cHRpb24sIHBlcm1zKTsKICAgICAgICB9CgogICAgICAgIGlmICghZW5jcnlwdGlvbktleSAmJiAhcGFzc3dvcmQpIHsKICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5QYXNzd29yZEV4Y2VwdGlvbigiTm8gcGFzc3dvcmQgZ2l2ZW4iLCBfdXRpbC5QYXNzd29yZFJlc3BvbnNlcy5ORUVEX1BBU1NXT1JEKTsKICAgICAgICB9IGVsc2UgaWYgKCFlbmNyeXB0aW9uS2V5ICYmIHBhc3N3b3JkKSB7CiAgICAgICAgICB2YXIgZGVjb2RlZFBhc3N3b3JkID0gZGVjb2RlVXNlclBhc3N3b3JkKHBhc3N3b3JkQnl0ZXMsIG93bmVyUGFzc3dvcmQsIHJldmlzaW9uLCBrZXlMZW5ndGgpOwogICAgICAgICAgZW5jcnlwdGlvbktleSA9IHByZXBhcmVLZXlEYXRhKGZpbGVJZEJ5dGVzLCBkZWNvZGVkUGFzc3dvcmQsIG93bmVyUGFzc3dvcmQsIHVzZXJQYXNzd29yZCwgZmxhZ3MsIHJldmlzaW9uLCBrZXlMZW5ndGgsIGVuY3J5cHRNZXRhZGF0YSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIWVuY3J5cHRpb25LZXkpIHsKICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5QYXNzd29yZEV4Y2VwdGlvbigiSW5jb3JyZWN0IFBhc3N3b3JkIiwgX3V0aWwuUGFzc3dvcmRSZXNwb25zZXMuSU5DT1JSRUNUX1BBU1NXT1JEKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuZW5jcnlwdGlvbktleSA9IGVuY3J5cHRpb25LZXk7CgogICAgICAgIGlmIChhbGdvcml0aG0gPj0gNCkgewogICAgICAgICAgdmFyIGNmID0gZGljdC5nZXQoIkNGIik7CgogICAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc0RpY3QpKGNmKSkgewogICAgICAgICAgICBjZi5zdXBwcmVzc0VuY3J5cHRpb24gPSB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuY2YgPSBjZjsKICAgICAgICAgIHRoaXMuc3RtZiA9IGRpY3QuZ2V0KCJTdG1GIikgfHwgaWRlbnRpdHlOYW1lOwogICAgICAgICAgdGhpcy5zdHJmID0gZGljdC5nZXQoIlN0ckYiKSB8fCBpZGVudGl0eU5hbWU7CiAgICAgICAgICB0aGlzLmVmZiA9IGRpY3QuZ2V0KCJFRkYiKSB8fCB0aGlzLnN0bWY7CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBidWlsZE9iamVjdEtleShudW0sIGdlbiwgZW5jcnlwdGlvbktleSwgaXNBZXMpIHsKICAgICAgICB2YXIga2V5ID0gbmV3IFVpbnQ4QXJyYXkoZW5jcnlwdGlvbktleS5sZW5ndGggKyA5KSwKICAgICAgICAgIGksCiAgICAgICAgICBuOwoKICAgICAgICBmb3IgKGkgPSAwLCBuID0gZW5jcnlwdGlvbktleS5sZW5ndGg7IGkgPCBuOyArK2kpIHsKICAgICAgICAgIGtleVtpXSA9IGVuY3J5cHRpb25LZXlbaV07CiAgICAgICAgfQoKICAgICAgICBrZXlbaSsrXSA9IG51bSAmIDB4ZmY7CiAgICAgICAga2V5W2krK10gPSBudW0gPj4gOCAmIDB4ZmY7CiAgICAgICAga2V5W2krK10gPSBudW0gPj4gMTYgJiAweGZmOwogICAgICAgIGtleVtpKytdID0gZ2VuICYgMHhmZjsKICAgICAgICBrZXlbaSsrXSA9IGdlbiA+PiA4ICYgMHhmZjsKCiAgICAgICAgaWYgKGlzQWVzKSB7CiAgICAgICAgICBrZXlbaSsrXSA9IDB4NzM7CiAgICAgICAgICBrZXlbaSsrXSA9IDB4NDE7CiAgICAgICAgICBrZXlbaSsrXSA9IDB4NmM7CiAgICAgICAgICBrZXlbaSsrXSA9IDB4NTQ7CiAgICAgICAgfQoKICAgICAgICB2YXIgaGFzaCA9IGNhbGN1bGF0ZU1ENShrZXksIDAsIGkpOwogICAgICAgIHJldHVybiBoYXNoLnN1YmFycmF5KDAsIE1hdGgubWluKGVuY3J5cHRpb25LZXkubGVuZ3RoICsgNSwgMTYpKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gYnVpbGRDaXBoZXJDb25zdHJ1Y3RvcihjZiwgbmFtZSwgbnVtLCBnZW4sIGtleSkgewogICAgICAgIGlmICghKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkobmFtZSkpIHsKICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiSW52YWxpZCBjcnlwdCBmaWx0ZXIgbmFtZS4iKTsKICAgICAgICB9CgogICAgICAgIHZhciBjcnlwdEZpbHRlciA9IGNmLmdldChuYW1lLm5hbWUpOwogICAgICAgIHZhciBjZm07CgogICAgICAgIGlmIChjcnlwdEZpbHRlciAhPT0gbnVsbCAmJiBjcnlwdEZpbHRlciAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBjZm0gPSBjcnlwdEZpbHRlci5nZXQoIkNGTSIpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFjZm0gfHwgY2ZtLm5hbWUgPT09ICJOb25lIikgewogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGNpcGhlclRyYW5zZm9ybUZhY3RvcnlCdWlsZENpcGhlckNvbnN0cnVjdG9yTm9uZSgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBOdWxsQ2lwaGVyKCk7CiAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgaWYgKGNmbS5uYW1lID09PSAiVjIiKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gY2lwaGVyVHJhbnNmb3JtRmFjdG9yeUJ1aWxkQ2lwaGVyQ29uc3RydWN0b3JWMigpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBBUkNGb3VyQ2lwaGVyKGJ1aWxkT2JqZWN0S2V5KG51bSwgZ2VuLCBrZXksIGZhbHNlKSk7CiAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgaWYgKGNmbS5uYW1lID09PSAiQUVTVjIiKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gY2lwaGVyVHJhbnNmb3JtRmFjdG9yeUJ1aWxkQ2lwaGVyQ29uc3RydWN0b3JBRVNWMigpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBBRVMxMjhDaXBoZXIoYnVpbGRPYmplY3RLZXkobnVtLCBnZW4sIGtleSwgdHJ1ZSkpOwogICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIGlmIChjZm0ubmFtZSA9PT0gIkFFU1YzIikgewogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGNpcGhlclRyYW5zZm9ybUZhY3RvcnlCdWlsZENpcGhlckNvbnN0cnVjdG9yQUVTVjMoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgQUVTMjU2Q2lwaGVyKGtleSk7CiAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJVbmtub3duIGNyeXB0byBtZXRob2QiKTsKICAgICAgfQoKICAgICAgQ2lwaGVyVHJhbnNmb3JtRmFjdG9yeS5wcm90b3R5cGUgPSB7CiAgICAgICAgY3JlYXRlQ2lwaGVyVHJhbnNmb3JtOiBmdW5jdGlvbiBDaXBoZXJUcmFuc2Zvcm1GYWN0b3J5X2NyZWF0ZUNpcGhlclRyYW5zZm9ybShudW0sIGdlbikgewogICAgICAgICAgaWYgKHRoaXMuYWxnb3JpdGhtID09PSA0IHx8IHRoaXMuYWxnb3JpdGhtID09PSA1KSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgQ2lwaGVyVHJhbnNmb3JtKGJ1aWxkQ2lwaGVyQ29uc3RydWN0b3IodGhpcy5jZiwgdGhpcy5zdG1mLCBudW0sIGdlbiwgdGhpcy5lbmNyeXB0aW9uS2V5KSwgYnVpbGRDaXBoZXJDb25zdHJ1Y3Rvcih0aGlzLmNmLCB0aGlzLnN0cmYsIG51bSwgZ2VuLCB0aGlzLmVuY3J5cHRpb25LZXkpKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIga2V5ID0gYnVpbGRPYmplY3RLZXkobnVtLCBnZW4sIHRoaXMuZW5jcnlwdGlvbktleSwgZmFsc2UpOwoKICAgICAgICAgIHZhciBjaXBoZXJDb25zdHJ1Y3RvciA9IGZ1bmN0aW9uIGJ1aWxkQ2lwaGVyQ2lwaGVyQ29uc3RydWN0b3IoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgQVJDRm91ckNpcGhlcihrZXkpOwogICAgICAgICAgfTsKCiAgICAgICAgICByZXR1cm4gbmV3IENpcGhlclRyYW5zZm9ybShjaXBoZXJDb25zdHJ1Y3RvciwgY2lwaGVyQ29uc3RydWN0b3IpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgcmV0dXJuIENpcGhlclRyYW5zZm9ybUZhY3Rvcnk7CiAgICB9KCk7CgogICAgZXhwb3J0cy5DaXBoZXJUcmFuc2Zvcm1GYWN0b3J5ID0gQ2lwaGVyVHJhbnNmb3JtRmFjdG9yeTsKCiAgICAvKioqL30pLCAoCiAgLyogMjEyICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgIHZhbHVlOiB0cnVlCiAgICB9KTsKICAgIGV4cG9ydHMuQ29sb3JTcGFjZSA9IHZvaWQgMDsKCiAgICB2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUpOwoKICAgIHZhciBfcHJpbWl0aXZlcyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTk0KTsKCiAgICBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyJAYmFiZWwvaGVscGVycyAtIHR5cGVvZiI7aWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIpIHtfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHtyZXR1cm4gdHlwZW9mIG9iajt9O30gZWxzZSB7X3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7cmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajt9O31yZXR1cm4gX3R5cGVvZihvYmopO30KCiAgICBmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7aWYgKGNhbGwgJiYgKF90eXBlb2YoY2FsbCkgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSkge3JldHVybiBjYWxsO31yZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKTt9CgogICAgZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7aWYgKHNlbGYgPT09IHZvaWQgMCkge3Rocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7fXJldHVybiBzZWxmO30KCiAgICBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2Yobykge19nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZiA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7cmV0dXJuIG8uX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihvKTt9O3JldHVybiBfZ2V0UHJvdG90eXBlT2Yobyk7fQoKICAgIGZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykge2lmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTt9c3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pO2lmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpO30KCiAgICBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkge19zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkge28uX19wcm90b19fID0gcDtyZXR1cm4gbzt9O3JldHVybiBfc2V0UHJvdG90eXBlT2YobywgcCk7fQoKICAgIGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHtpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpO319CgogICAgZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykge2ZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHt2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldO2Rlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTtkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7aWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7T2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpO319CgogICAgZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykge2lmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpO2lmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTtyZXR1cm4gQ29uc3RydWN0b3I7fQoKICAgIGZ1bmN0aW9uIHJlc2l6ZVJnYkltYWdlKHNyYywgZGVzdCwgdzEsIGgxLCB3MiwgaDIsIGFscGhhMDEpIHsKICAgICAgdmFyIENPTVBPTkVOVFMgPSAzOwogICAgICBhbHBoYTAxID0gYWxwaGEwMSAhPT0gMSA/IDAgOiBhbHBoYTAxOwogICAgICB2YXIgeFJhdGlvID0gdzEgLyB3MjsKICAgICAgdmFyIHlSYXRpbyA9IGgxIC8gaDI7CiAgICAgIHZhciBuZXdJbmRleCA9IDAsCiAgICAgICAgb2xkSW5kZXg7CiAgICAgIHZhciB4U2NhbGVkID0gbmV3IFVpbnQxNkFycmF5KHcyKTsKICAgICAgdmFyIHcxU2NhbmxpbmUgPSB3MSAqIENPTVBPTkVOVFM7CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHcyOyBpKyspIHsKICAgICAgICB4U2NhbGVkW2ldID0gTWF0aC5mbG9vcihpICogeFJhdGlvKSAqIENPTVBPTkVOVFM7CiAgICAgIH0KCiAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBoMjsgX2krKykgewogICAgICAgIHZhciBweSA9IE1hdGguZmxvb3IoX2kgKiB5UmF0aW8pICogdzFTY2FubGluZTsKCiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB3MjsgaisrKSB7CiAgICAgICAgICBvbGRJbmRleCA9IHB5ICsgeFNjYWxlZFtqXTsKICAgICAgICAgIGRlc3RbbmV3SW5kZXgrK10gPSBzcmNbb2xkSW5kZXgrK107CiAgICAgICAgICBkZXN0W25ld0luZGV4KytdID0gc3JjW29sZEluZGV4KytdOwogICAgICAgICAgZGVzdFtuZXdJbmRleCsrXSA9IHNyY1tvbGRJbmRleCsrXTsKICAgICAgICAgIG5ld0luZGV4ICs9IGFscGhhMDE7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgdmFyIENvbG9yU3BhY2UgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBDb2xvclNwYWNlKG5hbWUsIG51bUNvbXBzKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIENvbG9yU3BhY2UpOwoKICAgICAgICBpZiAodGhpcy5jb25zdHJ1Y3RvciA9PT0gQ29sb3JTcGFjZSkgewogICAgICAgICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgiQ2Fubm90IGluaXRpYWxpemUgQ29sb3JTcGFjZS4iKTsKICAgICAgICB9CgogICAgICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICAgICAgdGhpcy5udW1Db21wcyA9IG51bUNvbXBzOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoQ29sb3JTcGFjZSwgW3sKICAgICAgICBrZXk6ICJnZXRSZ2IiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRSZ2Ioc3JjLCBzcmNPZmZzZXQpIHsKICAgICAgICAgIHZhciByZ2IgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkoMyk7CiAgICAgICAgICB0aGlzLmdldFJnYkl0ZW0oc3JjLCBzcmNPZmZzZXQsIHJnYiwgMCk7CiAgICAgICAgICByZXR1cm4gcmdiOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImdldFJnYkl0ZW0iLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRSZ2JJdGVtKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0KSB7CiAgICAgICAgICAoMCwgX3V0aWwudW5yZWFjaGFibGUpKCJTaG91bGQgbm90IGNhbGwgQ29sb3JTcGFjZS5nZXRSZ2JJdGVtIik7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0UmdiQnVmZmVyIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UmdiQnVmZmVyKHNyYywgc3JjT2Zmc2V0LCBjb3VudCwgZGVzdCwgZGVzdE9mZnNldCwgYml0cywgYWxwaGEwMSkgewogICAgICAgICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgiU2hvdWxkIG5vdCBjYWxsIENvbG9yU3BhY2UuZ2V0UmdiQnVmZmVyIik7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0T3V0cHV0TGVuZ3RoIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0T3V0cHV0TGVuZ3RoKGlucHV0TGVuZ3RoLCBhbHBoYTAxKSB7CiAgICAgICAgICAoMCwgX3V0aWwudW5yZWFjaGFibGUpKCJTaG91bGQgbm90IGNhbGwgQ29sb3JTcGFjZS5nZXRPdXRwdXRMZW5ndGgiKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJpc1Bhc3N0aHJvdWdoIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaXNQYXNzdGhyb3VnaChiaXRzKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiaXNEZWZhdWx0RGVjb2RlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaXNEZWZhdWx0RGVjb2RlKGRlY29kZU1hcCwgYnBjKSB7CiAgICAgICAgICByZXR1cm4gQ29sb3JTcGFjZS5pc0RlZmF1bHREZWNvZGUoZGVjb2RlTWFwLCB0aGlzLm51bUNvbXBzKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJmaWxsUmdiIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZmlsbFJnYihkZXN0LCBvcmlnaW5hbFdpZHRoLCBvcmlnaW5hbEhlaWdodCwgd2lkdGgsIGhlaWdodCwgYWN0dWFsSGVpZ2h0LCBicGMsIGNvbXBzLCBhbHBoYTAxKSB7CiAgICAgICAgICB2YXIgY291bnQgPSBvcmlnaW5hbFdpZHRoICogb3JpZ2luYWxIZWlnaHQ7CiAgICAgICAgICB2YXIgcmdiQnVmID0gbnVsbDsKICAgICAgICAgIHZhciBudW1Db21wb25lbnRDb2xvcnMgPSAxIDw8IGJwYzsKICAgICAgICAgIHZhciBuZWVkc1Jlc2l6aW5nID0gb3JpZ2luYWxIZWlnaHQgIT09IGhlaWdodCB8fCBvcmlnaW5hbFdpZHRoICE9PSB3aWR0aDsKCiAgICAgICAgICBpZiAodGhpcy5pc1Bhc3N0aHJvdWdoKGJwYykpIHsKICAgICAgICAgICAgcmdiQnVmID0gY29tcHM7CiAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMubnVtQ29tcHMgPT09IDEgJiYgY291bnQgPiBudW1Db21wb25lbnRDb2xvcnMgJiYgdGhpcy5uYW1lICE9PSAiRGV2aWNlR3JheSIgJiYgdGhpcy5uYW1lICE9PSAiRGV2aWNlUkdCIikgewogICAgICAgICAgICB2YXIgYWxsQ29sb3JzID0gYnBjIDw9IDggPyBuZXcgVWludDhBcnJheShudW1Db21wb25lbnRDb2xvcnMpIDogbmV3IFVpbnQxNkFycmF5KG51bUNvbXBvbmVudENvbG9ycyk7CgogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bUNvbXBvbmVudENvbG9yczsgaSsrKSB7CiAgICAgICAgICAgICAgYWxsQ29sb3JzW2ldID0gaTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGNvbG9yTWFwID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KG51bUNvbXBvbmVudENvbG9ycyAqIDMpOwogICAgICAgICAgICB0aGlzLmdldFJnYkJ1ZmZlcihhbGxDb2xvcnMsIDAsIG51bUNvbXBvbmVudENvbG9ycywgY29sb3JNYXAsIDAsIGJwYywgMCk7CgogICAgICAgICAgICBpZiAoIW5lZWRzUmVzaXppbmcpIHsKICAgICAgICAgICAgICB2YXIgZGVzdFBvcyA9IDA7CgogICAgICAgICAgICAgIGZvciAodmFyIF9pMiA9IDA7IF9pMiA8IGNvdW50OyArK19pMikgewogICAgICAgICAgICAgICAgdmFyIGtleSA9IGNvbXBzW19pMl0gKiAzOwogICAgICAgICAgICAgICAgZGVzdFtkZXN0UG9zKytdID0gY29sb3JNYXBba2V5XTsKICAgICAgICAgICAgICAgIGRlc3RbZGVzdFBvcysrXSA9IGNvbG9yTWFwW2tleSArIDFdOwogICAgICAgICAgICAgICAgZGVzdFtkZXN0UG9zKytdID0gY29sb3JNYXBba2V5ICsgMl07CiAgICAgICAgICAgICAgICBkZXN0UG9zICs9IGFscGhhMDE7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJnYkJ1ZiA9IG5ldyBVaW50OEFycmF5KGNvdW50ICogMyk7CiAgICAgICAgICAgICAgdmFyIHJnYlBvcyA9IDA7CgogICAgICAgICAgICAgIGZvciAodmFyIF9pMyA9IDA7IF9pMyA8IGNvdW50OyArK19pMykgewogICAgICAgICAgICAgICAgdmFyIF9rZXkgPSBjb21wc1tfaTNdICogMzsKCiAgICAgICAgICAgICAgICByZ2JCdWZbcmdiUG9zKytdID0gY29sb3JNYXBbX2tleV07CiAgICAgICAgICAgICAgICByZ2JCdWZbcmdiUG9zKytdID0gY29sb3JNYXBbX2tleSArIDFdOwogICAgICAgICAgICAgICAgcmdiQnVmW3JnYlBvcysrXSA9IGNvbG9yTWFwW19rZXkgKyAyXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICghbmVlZHNSZXNpemluZykgewogICAgICAgICAgICAgIHRoaXMuZ2V0UmdiQnVmZmVyKGNvbXBzLCAwLCB3aWR0aCAqIGFjdHVhbEhlaWdodCwgZGVzdCwgMCwgYnBjLCBhbHBoYTAxKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByZ2JCdWYgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkoY291bnQgKiAzKTsKICAgICAgICAgICAgICB0aGlzLmdldFJnYkJ1ZmZlcihjb21wcywgMCwgY291bnQsIHJnYkJ1ZiwgMCwgYnBjLCAwKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmIChyZ2JCdWYpIHsKICAgICAgICAgICAgaWYgKG5lZWRzUmVzaXppbmcpIHsKICAgICAgICAgICAgICByZXNpemVSZ2JJbWFnZShyZ2JCdWYsIGRlc3QsIG9yaWdpbmFsV2lkdGgsIG9yaWdpbmFsSGVpZ2h0LCB3aWR0aCwgaGVpZ2h0LCBhbHBoYTAxKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB2YXIgX2Rlc3RQb3MgPSAwLAogICAgICAgICAgICAgICAgX3JnYlBvcyA9IDA7CgogICAgICAgICAgICAgIGZvciAodmFyIF9pNCA9IDAsIGlpID0gd2lkdGggKiBhY3R1YWxIZWlnaHQ7IF9pNCA8IGlpOyBfaTQrKykgewogICAgICAgICAgICAgICAgZGVzdFtfZGVzdFBvcysrXSA9IHJnYkJ1ZltfcmdiUG9zKytdOwogICAgICAgICAgICAgICAgZGVzdFtfZGVzdFBvcysrXSA9IHJnYkJ1ZltfcmdiUG9zKytdOwogICAgICAgICAgICAgICAgZGVzdFtfZGVzdFBvcysrXSA9IHJnYkJ1ZltfcmdiUG9zKytdOwogICAgICAgICAgICAgICAgX2Rlc3RQb3MgKz0gYWxwaGEwMTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJ1c2VzWmVyb1RvT25lUmFuZ2UiLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJ1c2VzWmVyb1RvT25lUmFuZ2UiLCB0cnVlKTsKICAgICAgICB9CiAgICAgIH1dLCBbewogICAgICAgIGtleTogInBhcnNlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcGFyc2UoY3MsIHhyZWYsIHJlcywgcGRmRnVuY3Rpb25GYWN0b3J5KSB7CiAgICAgICAgICB2YXIgSVIgPSB0aGlzLnBhcnNlVG9JUihjcywgeHJlZiwgcmVzLCBwZGZGdW5jdGlvbkZhY3RvcnkpOwogICAgICAgICAgcmV0dXJuIHRoaXMuZnJvbUlSKElSKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJmcm9tSVIiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBmcm9tSVIoSVIpIHsKICAgICAgICAgIHZhciBuYW1lID0gQXJyYXkuaXNBcnJheShJUikgPyBJUlswXSA6IElSOwogICAgICAgICAgdmFyIHdoaXRlUG9pbnQsIGJsYWNrUG9pbnQsIGdhbW1hOwoKICAgICAgICAgIHN3aXRjaCAobmFtZSkgewogICAgICAgICAgICBjYXNlICJEZXZpY2VHcmF5Q1MiOgogICAgICAgICAgICAgIHJldHVybiB0aGlzLnNpbmdsZXRvbnMuZ3JheTsKCiAgICAgICAgICAgIGNhc2UgIkRldmljZVJnYkNTIjoKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zaW5nbGV0b25zLnJnYjsKCiAgICAgICAgICAgIGNhc2UgIkRldmljZUNteWtDUyI6CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2luZ2xldG9ucy5jbXlrOwoKICAgICAgICAgICAgY2FzZSAiQ2FsR3JheUNTIjoKICAgICAgICAgICAgICB3aGl0ZVBvaW50ID0gSVJbMV07CiAgICAgICAgICAgICAgYmxhY2tQb2ludCA9IElSWzJdOwogICAgICAgICAgICAgIGdhbW1hID0gSVJbM107CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBDYWxHcmF5Q1Mod2hpdGVQb2ludCwgYmxhY2tQb2ludCwgZ2FtbWEpOwoKICAgICAgICAgICAgY2FzZSAiQ2FsUkdCQ1MiOgogICAgICAgICAgICAgIHdoaXRlUG9pbnQgPSBJUlsxXTsKICAgICAgICAgICAgICBibGFja1BvaW50ID0gSVJbMl07CiAgICAgICAgICAgICAgZ2FtbWEgPSBJUlszXTsKICAgICAgICAgICAgICB2YXIgbWF0cml4ID0gSVJbNF07CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBDYWxSR0JDUyh3aGl0ZVBvaW50LCBibGFja1BvaW50LCBnYW1tYSwgbWF0cml4KTsKCiAgICAgICAgICAgIGNhc2UgIlBhdHRlcm5DUyI6CiAgICAgICAgICAgICAgdmFyIGJhc2VQYXR0ZXJuQ1MgPSBJUlsxXTsKCiAgICAgICAgICAgICAgaWYgKGJhc2VQYXR0ZXJuQ1MpIHsKICAgICAgICAgICAgICAgIGJhc2VQYXR0ZXJuQ1MgPSB0aGlzLmZyb21JUihiYXNlUGF0dGVybkNTKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBuZXcgUGF0dGVybkNTKGJhc2VQYXR0ZXJuQ1MpOwoKICAgICAgICAgICAgY2FzZSAiSW5kZXhlZENTIjoKICAgICAgICAgICAgICB2YXIgYmFzZUluZGV4ZWRDUyA9IElSWzFdOwogICAgICAgICAgICAgIHZhciBoaVZhbCA9IElSWzJdOwogICAgICAgICAgICAgIHZhciBsb29rdXAgPSBJUlszXTsKICAgICAgICAgICAgICByZXR1cm4gbmV3IEluZGV4ZWRDUyh0aGlzLmZyb21JUihiYXNlSW5kZXhlZENTKSwgaGlWYWwsIGxvb2t1cCk7CgogICAgICAgICAgICBjYXNlICJBbHRlcm5hdGVDUyI6CiAgICAgICAgICAgICAgdmFyIG51bUNvbXBzID0gSVJbMV07CiAgICAgICAgICAgICAgdmFyIGFsdCA9IElSWzJdOwogICAgICAgICAgICAgIHZhciB0aW50Rm4gPSBJUlszXTsKICAgICAgICAgICAgICByZXR1cm4gbmV3IEFsdGVybmF0ZUNTKG51bUNvbXBzLCB0aGlzLmZyb21JUihhbHQpLCB0aW50Rm4pOwoKICAgICAgICAgICAgY2FzZSAiTGFiQ1MiOgogICAgICAgICAgICAgIHdoaXRlUG9pbnQgPSBJUlsxXTsKICAgICAgICAgICAgICBibGFja1BvaW50ID0gSVJbMl07CiAgICAgICAgICAgICAgdmFyIHJhbmdlID0gSVJbM107CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBMYWJDUyh3aGl0ZVBvaW50LCBibGFja1BvaW50LCByYW5nZSk7CgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiVW5rbm93biBjb2xvcnNwYWNlIG5hbWU6ICIuY29uY2F0KG5hbWUpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJwYXJzZVRvSVIiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBwYXJzZVRvSVIoY3MsIHhyZWYpIHsKICAgICAgICAgIHZhciByZXMgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IG51bGw7CiAgICAgICAgICB2YXIgcGRmRnVuY3Rpb25GYWN0b3J5ID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgPyBhcmd1bWVudHNbM10gOiB1bmRlZmluZWQ7CiAgICAgICAgICBjcyA9IHhyZWYuZmV0Y2hJZlJlZihjcyk7CgogICAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc05hbWUpKGNzKSkgewogICAgICAgICAgICBzd2l0Y2ggKGNzLm5hbWUpIHsKICAgICAgICAgICAgICBjYXNlICJEZXZpY2VHcmF5IjoKICAgICAgICAgICAgICBjYXNlICJHIjoKICAgICAgICAgICAgICAgIHJldHVybiAiRGV2aWNlR3JheUNTIjsKCiAgICAgICAgICAgICAgY2FzZSAiRGV2aWNlUkdCIjoKICAgICAgICAgICAgICBjYXNlICJSR0IiOgogICAgICAgICAgICAgICAgcmV0dXJuICJEZXZpY2VSZ2JDUyI7CgogICAgICAgICAgICAgIGNhc2UgIkRldmljZUNNWUsiOgogICAgICAgICAgICAgIGNhc2UgIkNNWUsiOgogICAgICAgICAgICAgICAgcmV0dXJuICJEZXZpY2VDbXlrQ1MiOwoKICAgICAgICAgICAgICBjYXNlICJQYXR0ZXJuIjoKICAgICAgICAgICAgICAgIHJldHVybiBbIlBhdHRlcm5DUyIsIG51bGxdOwoKICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc0RpY3QpKHJlcykpIHsKICAgICAgICAgICAgICAgICAgdmFyIGNvbG9yU3BhY2VzID0gcmVzLmdldCgiQ29sb3JTcGFjZSIpOwoKICAgICAgICAgICAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc0RpY3QpKGNvbG9yU3BhY2VzKSkgewogICAgICAgICAgICAgICAgICAgIHZhciByZXNDUyA9IGNvbG9yU3BhY2VzLmdldChjcy5uYW1lKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc0NTKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkocmVzQ1MpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlVG9JUihyZXNDUywgeHJlZiwgcmVzLCBwZGZGdW5jdGlvbkZhY3RvcnkpOwogICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgIGNzID0gcmVzQ1M7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoInVucmVjb2duaXplZCBjb2xvcnNwYWNlICIuY29uY2F0KGNzLm5hbWUpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGNzKSkgewogICAgICAgICAgICB2YXIgbW9kZSA9IHhyZWYuZmV0Y2hJZlJlZihjc1swXSkubmFtZTsKICAgICAgICAgICAgdmFyIG51bUNvbXBzLCBwYXJhbXMsIGFsdCwgd2hpdGVQb2ludCwgYmxhY2tQb2ludCwgZ2FtbWE7CgogICAgICAgICAgICBzd2l0Y2ggKG1vZGUpIHsKICAgICAgICAgICAgICBjYXNlICJEZXZpY2VHcmF5IjoKICAgICAgICAgICAgICBjYXNlICJHIjoKICAgICAgICAgICAgICAgIHJldHVybiAiRGV2aWNlR3JheUNTIjsKCiAgICAgICAgICAgICAgY2FzZSAiRGV2aWNlUkdCIjoKICAgICAgICAgICAgICBjYXNlICJSR0IiOgogICAgICAgICAgICAgICAgcmV0dXJuICJEZXZpY2VSZ2JDUyI7CgogICAgICAgICAgICAgIGNhc2UgIkRldmljZUNNWUsiOgogICAgICAgICAgICAgIGNhc2UgIkNNWUsiOgogICAgICAgICAgICAgICAgcmV0dXJuICJEZXZpY2VDbXlrQ1MiOwoKICAgICAgICAgICAgICBjYXNlICJDYWxHcmF5IjoKICAgICAgICAgICAgICAgIHBhcmFtcyA9IHhyZWYuZmV0Y2hJZlJlZihjc1sxXSk7CiAgICAgICAgICAgICAgICB3aGl0ZVBvaW50ID0gcGFyYW1zLmdldEFycmF5KCJXaGl0ZVBvaW50Iik7CiAgICAgICAgICAgICAgICBibGFja1BvaW50ID0gcGFyYW1zLmdldEFycmF5KCJCbGFja1BvaW50Iik7CiAgICAgICAgICAgICAgICBnYW1tYSA9IHBhcmFtcy5nZXQoIkdhbW1hIik7CiAgICAgICAgICAgICAgICByZXR1cm4gWyJDYWxHcmF5Q1MiLCB3aGl0ZVBvaW50LCBibGFja1BvaW50LCBnYW1tYV07CgogICAgICAgICAgICAgIGNhc2UgIkNhbFJHQiI6CiAgICAgICAgICAgICAgICBwYXJhbXMgPSB4cmVmLmZldGNoSWZSZWYoY3NbMV0pOwogICAgICAgICAgICAgICAgd2hpdGVQb2ludCA9IHBhcmFtcy5nZXRBcnJheSgiV2hpdGVQb2ludCIpOwogICAgICAgICAgICAgICAgYmxhY2tQb2ludCA9IHBhcmFtcy5nZXRBcnJheSgiQmxhY2tQb2ludCIpOwogICAgICAgICAgICAgICAgZ2FtbWEgPSBwYXJhbXMuZ2V0QXJyYXkoIkdhbW1hIik7CiAgICAgICAgICAgICAgICB2YXIgbWF0cml4ID0gcGFyYW1zLmdldEFycmF5KCJNYXRyaXgiKTsKICAgICAgICAgICAgICAgIHJldHVybiBbIkNhbFJHQkNTIiwgd2hpdGVQb2ludCwgYmxhY2tQb2ludCwgZ2FtbWEsIG1hdHJpeF07CgogICAgICAgICAgICAgIGNhc2UgIklDQ0Jhc2VkIjoKICAgICAgICAgICAgICAgIHZhciBzdHJlYW0gPSB4cmVmLmZldGNoSWZSZWYoY3NbMV0pOwogICAgICAgICAgICAgICAgdmFyIGRpY3QgPSBzdHJlYW0uZGljdDsKICAgICAgICAgICAgICAgIG51bUNvbXBzID0gZGljdC5nZXQoIk4iKTsKICAgICAgICAgICAgICAgIGFsdCA9IGRpY3QuZ2V0KCJBbHRlcm5hdGUiKTsKCiAgICAgICAgICAgICAgICBpZiAoYWx0KSB7CiAgICAgICAgICAgICAgICAgIHZhciBhbHRJUiA9IHRoaXMucGFyc2VUb0lSKGFsdCwgeHJlZiwgcmVzLCBwZGZGdW5jdGlvbkZhY3RvcnkpOwogICAgICAgICAgICAgICAgICB2YXIgYWx0Q1MgPSB0aGlzLmZyb21JUihhbHRJUiwgcGRmRnVuY3Rpb25GYWN0b3J5KTsKCiAgICAgICAgICAgICAgICAgIGlmIChhbHRDUy5udW1Db21wcyA9PT0gbnVtQ29tcHMpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWx0SVI7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiSUNDQmFzZWQgY29sb3Igc3BhY2U6IElnbm9yaW5nIGluY29ycmVjdCAvQWx0ZXJuYXRlIGVudHJ5LiIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChudW1Db21wcyA9PT0gMSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gIkRldmljZUdyYXlDUyI7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG51bUNvbXBzID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiAiRGV2aWNlUmdiQ1MiOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChudW1Db21wcyA9PT0gNCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gIkRldmljZUNteWtDUyI7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgIlBhdHRlcm4iOgogICAgICAgICAgICAgICAgdmFyIGJhc2VQYXR0ZXJuQ1MgPSBjc1sxXSB8fCBudWxsOwoKICAgICAgICAgICAgICAgIGlmIChiYXNlUGF0dGVybkNTKSB7CiAgICAgICAgICAgICAgICAgIGJhc2VQYXR0ZXJuQ1MgPSB0aGlzLnBhcnNlVG9JUihiYXNlUGF0dGVybkNTLCB4cmVmLCByZXMsIHBkZkZ1bmN0aW9uRmFjdG9yeSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIFsiUGF0dGVybkNTIiwgYmFzZVBhdHRlcm5DU107CgogICAgICAgICAgICAgIGNhc2UgIkluZGV4ZWQiOgogICAgICAgICAgICAgIGNhc2UgIkkiOgogICAgICAgICAgICAgICAgdmFyIGJhc2VJbmRleGVkQ1MgPSB0aGlzLnBhcnNlVG9JUihjc1sxXSwgeHJlZiwgcmVzLCBwZGZGdW5jdGlvbkZhY3RvcnkpOwogICAgICAgICAgICAgICAgdmFyIGhpVmFsID0geHJlZi5mZXRjaElmUmVmKGNzWzJdKSArIDE7CiAgICAgICAgICAgICAgICB2YXIgbG9va3VwID0geHJlZi5mZXRjaElmUmVmKGNzWzNdKTsKCiAgICAgICAgICAgICAgICBpZiAoKDAsIF9wcmltaXRpdmVzLmlzU3RyZWFtKShsb29rdXApKSB7CiAgICAgICAgICAgICAgICAgIGxvb2t1cCA9IGxvb2t1cC5nZXRCeXRlcygpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBbIkluZGV4ZWRDUyIsIGJhc2VJbmRleGVkQ1MsIGhpVmFsLCBsb29rdXBdOwoKICAgICAgICAgICAgICBjYXNlICJTZXBhcmF0aW9uIjoKICAgICAgICAgICAgICBjYXNlICJEZXZpY2VOIjoKICAgICAgICAgICAgICAgIHZhciBuYW1lID0geHJlZi5mZXRjaElmUmVmKGNzWzFdKTsKICAgICAgICAgICAgICAgIG51bUNvbXBzID0gQXJyYXkuaXNBcnJheShuYW1lKSA/IG5hbWUubGVuZ3RoIDogMTsKICAgICAgICAgICAgICAgIGFsdCA9IHRoaXMucGFyc2VUb0lSKGNzWzJdLCB4cmVmLCByZXMsIHBkZkZ1bmN0aW9uRmFjdG9yeSk7CiAgICAgICAgICAgICAgICB2YXIgdGludEZuID0gcGRmRnVuY3Rpb25GYWN0b3J5LmNyZWF0ZSh4cmVmLmZldGNoSWZSZWYoY3NbM10pKTsKICAgICAgICAgICAgICAgIHJldHVybiBbIkFsdGVybmF0ZUNTIiwgbnVtQ29tcHMsIGFsdCwgdGludEZuXTsKCiAgICAgICAgICAgICAgY2FzZSAiTGFiIjoKICAgICAgICAgICAgICAgIHBhcmFtcyA9IHhyZWYuZmV0Y2hJZlJlZihjc1sxXSk7CiAgICAgICAgICAgICAgICB3aGl0ZVBvaW50ID0gcGFyYW1zLmdldEFycmF5KCJXaGl0ZVBvaW50Iik7CiAgICAgICAgICAgICAgICBibGFja1BvaW50ID0gcGFyYW1zLmdldEFycmF5KCJCbGFja1BvaW50Iik7CiAgICAgICAgICAgICAgICB2YXIgcmFuZ2UgPSBwYXJhbXMuZ2V0QXJyYXkoIlJhbmdlIik7CiAgICAgICAgICAgICAgICByZXR1cm4gWyJMYWJDUyIsIHdoaXRlUG9pbnQsIGJsYWNrUG9pbnQsIHJhbmdlXTsKCiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigidW5pbXBsZW1lbnRlZCBjb2xvciBzcGFjZSBvYmplY3QgXCIiLmNvbmNhdChtb2RlLCAiXCIiKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoInVucmVjb2duaXplZCBjb2xvciBzcGFjZSBvYmplY3Q6IFwiIi5jb25jYXQoY3MsICJcIiIpKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJpc0RlZmF1bHREZWNvZGUiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBpc0RlZmF1bHREZWNvZGUoZGVjb2RlLCBudW1Db21wcykgewogICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGRlY29kZSkpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKG51bUNvbXBzICogMiAhPT0gZGVjb2RlLmxlbmd0aCkgewogICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIlRoZSBkZWNvZGUgbWFwIGlzIG5vdCB0aGUgY29ycmVjdCBsZW5ndGgiKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gZGVjb2RlLmxlbmd0aDsgaSA8IGlpOyBpICs9IDIpIHsKICAgICAgICAgICAgaWYgKGRlY29kZVtpXSAhPT0gMCB8fCBkZWNvZGVbaSArIDFdICE9PSAxKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAic2luZ2xldG9ucyIsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgInNpbmdsZXRvbnMiLCB7CiAgICAgICAgICAgIGdldCBncmF5KCkgewogICAgICAgICAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAiZ3JheSIsIG5ldyBEZXZpY2VHcmF5Q1MoKSk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBnZXQgcmdiKCkgewogICAgICAgICAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAicmdiIiwgbmV3IERldmljZVJnYkNTKCkpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgZ2V0IGNteWsoKSB7CiAgICAgICAgICAgICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJjbXlrIiwgbmV3IERldmljZUNteWtDUygpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIENvbG9yU3BhY2U7CiAgICB9KCk7CgogICAgZXhwb3J0cy5Db2xvclNwYWNlID0gQ29sb3JTcGFjZTsKCiAgICB2YXIgQWx0ZXJuYXRlQ1MgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9Db2xvclNwYWNlKSB7CiAgICAgIF9pbmhlcml0cyhBbHRlcm5hdGVDUywgX0NvbG9yU3BhY2UpOwoKICAgICAgZnVuY3Rpb24gQWx0ZXJuYXRlQ1MobnVtQ29tcHMsIGJhc2UsIHRpbnRGbikgewogICAgICAgIHZhciBfdGhpczsKCiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEFsdGVybmF0ZUNTKTsKCiAgICAgICAgX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoQWx0ZXJuYXRlQ1MpLmNhbGwodGhpcywgIkFsdGVybmF0ZSIsIG51bUNvbXBzKSk7CiAgICAgICAgX3RoaXMuYmFzZSA9IGJhc2U7CiAgICAgICAgX3RoaXMudGludEZuID0gdGludEZuOwogICAgICAgIF90aGlzLnRtcEJ1ZiA9IG5ldyBGbG9hdDMyQXJyYXkoYmFzZS5udW1Db21wcyk7CiAgICAgICAgcmV0dXJuIF90aGlzOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoQWx0ZXJuYXRlQ1MsIFt7CiAgICAgICAga2V5OiAiZ2V0UmdiSXRlbSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldFJnYkl0ZW0oc3JjLCBzcmNPZmZzZXQsIGRlc3QsIGRlc3RPZmZzZXQpIHsKICAgICAgICAgIHZhciB0bXBCdWYgPSB0aGlzLnRtcEJ1ZjsKICAgICAgICAgIHRoaXMudGludEZuKHNyYywgc3JjT2Zmc2V0LCB0bXBCdWYsIDApOwogICAgICAgICAgdGhpcy5iYXNlLmdldFJnYkl0ZW0odG1wQnVmLCAwLCBkZXN0LCBkZXN0T2Zmc2V0KTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJnZXRSZ2JCdWZmZXIiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRSZ2JCdWZmZXIoc3JjLCBzcmNPZmZzZXQsIGNvdW50LCBkZXN0LCBkZXN0T2Zmc2V0LCBiaXRzLCBhbHBoYTAxKSB7CiAgICAgICAgICB2YXIgdGludEZuID0gdGhpcy50aW50Rm47CiAgICAgICAgICB2YXIgYmFzZSA9IHRoaXMuYmFzZTsKICAgICAgICAgIHZhciBzY2FsZSA9IDEgLyAoKDEgPDwgYml0cykgLSAxKTsKICAgICAgICAgIHZhciBiYXNlTnVtQ29tcHMgPSBiYXNlLm51bUNvbXBzOwogICAgICAgICAgdmFyIHVzZXNaZXJvVG9PbmVSYW5nZSA9IGJhc2UudXNlc1plcm9Ub09uZVJhbmdlOwogICAgICAgICAgdmFyIGlzUGFzc3Rocm91Z2ggPSAoYmFzZS5pc1Bhc3N0aHJvdWdoKDgpIHx8ICF1c2VzWmVyb1RvT25lUmFuZ2UpICYmIGFscGhhMDEgPT09IDA7CiAgICAgICAgICB2YXIgcG9zID0gaXNQYXNzdGhyb3VnaCA/IGRlc3RPZmZzZXQgOiAwOwogICAgICAgICAgdmFyIGJhc2VCdWYgPSBpc1Bhc3N0aHJvdWdoID8gZGVzdCA6IG5ldyBVaW50OENsYW1wZWRBcnJheShiYXNlTnVtQ29tcHMgKiBjb3VudCk7CiAgICAgICAgICB2YXIgbnVtQ29tcHMgPSB0aGlzLm51bUNvbXBzOwogICAgICAgICAgdmFyIHNjYWxlZCA9IG5ldyBGbG9hdDMyQXJyYXkobnVtQ29tcHMpOwogICAgICAgICAgdmFyIHRpbnRlZCA9IG5ldyBGbG9hdDMyQXJyYXkoYmFzZU51bUNvbXBzKTsKICAgICAgICAgIHZhciBpLCBqOwoKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CiAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBudW1Db21wczsgaisrKSB7CiAgICAgICAgICAgICAgc2NhbGVkW2pdID0gc3JjW3NyY09mZnNldCsrXSAqIHNjYWxlOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aW50Rm4oc2NhbGVkLCAwLCB0aW50ZWQsIDApOwoKICAgICAgICAgICAgaWYgKHVzZXNaZXJvVG9PbmVSYW5nZSkgewogICAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBiYXNlTnVtQ29tcHM7IGorKykgewogICAgICAgICAgICAgICAgYmFzZUJ1Zltwb3MrK10gPSB0aW50ZWRbal0gKiAyNTU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGJhc2UuZ2V0UmdiSXRlbSh0aW50ZWQsIDAsIGJhc2VCdWYsIHBvcyk7CiAgICAgICAgICAgICAgcG9zICs9IGJhc2VOdW1Db21wczsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmICghaXNQYXNzdGhyb3VnaCkgewogICAgICAgICAgICBiYXNlLmdldFJnYkJ1ZmZlcihiYXNlQnVmLCAwLCBjb3VudCwgZGVzdCwgZGVzdE9mZnNldCwgOCwgYWxwaGEwMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0T3V0cHV0TGVuZ3RoIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0T3V0cHV0TGVuZ3RoKGlucHV0TGVuZ3RoLCBhbHBoYTAxKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5iYXNlLmdldE91dHB1dExlbmd0aChpbnB1dExlbmd0aCAqIHRoaXMuYmFzZS5udW1Db21wcyAvIHRoaXMubnVtQ29tcHMsIGFscGhhMDEpOwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIEFsdGVybmF0ZUNTOwogICAgfShDb2xvclNwYWNlKTsKCiAgICB2YXIgUGF0dGVybkNTID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQ29sb3JTcGFjZTIpIHsKICAgICAgX2luaGVyaXRzKFBhdHRlcm5DUywgX0NvbG9yU3BhY2UyKTsKCiAgICAgIGZ1bmN0aW9uIFBhdHRlcm5DUyhiYXNlQ1MpIHsKICAgICAgICB2YXIgX3RoaXMyOwoKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUGF0dGVybkNTKTsKCiAgICAgICAgX3RoaXMyID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKFBhdHRlcm5DUykuY2FsbCh0aGlzLCAiUGF0dGVybiIsIG51bGwpKTsKICAgICAgICBfdGhpczIuYmFzZSA9IGJhc2VDUzsKICAgICAgICByZXR1cm4gX3RoaXMyOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoUGF0dGVybkNTLCBbewogICAgICAgIGtleTogImlzRGVmYXVsdERlY29kZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGlzRGVmYXVsdERlY29kZShkZWNvZGVNYXAsIGJwYykgewogICAgICAgICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgiU2hvdWxkIG5vdCBjYWxsIFBhdHRlcm5DUy5pc0RlZmF1bHREZWNvZGUiKTsKICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBQYXR0ZXJuQ1M7CiAgICB9KENvbG9yU3BhY2UpOwoKICAgIHZhciBJbmRleGVkQ1MgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9Db2xvclNwYWNlMykgewogICAgICBfaW5oZXJpdHMoSW5kZXhlZENTLCBfQ29sb3JTcGFjZTMpOwoKICAgICAgZnVuY3Rpb24gSW5kZXhlZENTKGJhc2UsIGhpZ2hWYWwsIGxvb2t1cCkgewogICAgICAgIHZhciBfdGhpczM7CgogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBJbmRleGVkQ1MpOwoKICAgICAgICBfdGhpczMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoSW5kZXhlZENTKS5jYWxsKHRoaXMsICJJbmRleGVkIiwgMSkpOwogICAgICAgIF90aGlzMy5iYXNlID0gYmFzZTsKICAgICAgICBfdGhpczMuaGlnaFZhbCA9IGhpZ2hWYWw7CiAgICAgICAgdmFyIGJhc2VOdW1Db21wcyA9IGJhc2UubnVtQ29tcHM7CiAgICAgICAgdmFyIGxlbmd0aCA9IGJhc2VOdW1Db21wcyAqIGhpZ2hWYWw7CgogICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNTdHJlYW0pKGxvb2t1cCkpIHsKICAgICAgICAgIF90aGlzMy5sb29rdXAgPSBuZXcgVWludDhBcnJheShsZW5ndGgpOwogICAgICAgICAgdmFyIGJ5dGVzID0gbG9va3VwLmdldEJ5dGVzKGxlbmd0aCk7CgogICAgICAgICAgX3RoaXMzLmxvb2t1cC5zZXQoYnl0ZXMpOwogICAgICAgIH0gZWxzZSBpZiAoKDAsIF91dGlsLmlzU3RyaW5nKShsb29rdXApKSB7CiAgICAgICAgICBfdGhpczMubG9va3VwID0gbmV3IFVpbnQ4QXJyYXkobGVuZ3RoKTsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgIF90aGlzMy5sb29rdXBbaV0gPSBsb29rdXAuY2hhckNvZGVBdChpKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGxvb2t1cCBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpIHsKICAgICAgICAgIF90aGlzMy5sb29rdXAgPSBsb29rdXA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiVW5yZWNvZ25pemVkIGxvb2t1cCB0YWJsZTogIi5jb25jYXQobG9va3VwKSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gX3RoaXMzOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoSW5kZXhlZENTLCBbewogICAgICAgIGtleTogImdldFJnYkl0ZW0iLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRSZ2JJdGVtKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0KSB7CiAgICAgICAgICB2YXIgbnVtQ29tcHMgPSB0aGlzLmJhc2UubnVtQ29tcHM7CiAgICAgICAgICB2YXIgc3RhcnQgPSBzcmNbc3JjT2Zmc2V0XSAqIG51bUNvbXBzOwogICAgICAgICAgdGhpcy5iYXNlLmdldFJnYkJ1ZmZlcih0aGlzLmxvb2t1cCwgc3RhcnQsIDEsIGRlc3QsIGRlc3RPZmZzZXQsIDgsIDApOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImdldFJnYkJ1ZmZlciIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldFJnYkJ1ZmZlcihzcmMsIHNyY09mZnNldCwgY291bnQsIGRlc3QsIGRlc3RPZmZzZXQsIGJpdHMsIGFscGhhMDEpIHsKICAgICAgICAgIHZhciBiYXNlID0gdGhpcy5iYXNlOwogICAgICAgICAgdmFyIG51bUNvbXBzID0gYmFzZS5udW1Db21wczsKICAgICAgICAgIHZhciBvdXRwdXREZWx0YSA9IGJhc2UuZ2V0T3V0cHV0TGVuZ3RoKG51bUNvbXBzLCBhbHBoYTAxKTsKICAgICAgICAgIHZhciBsb29rdXAgPSB0aGlzLmxvb2t1cDsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvdW50OyArK2kpIHsKICAgICAgICAgICAgdmFyIGxvb2t1cFBvcyA9IHNyY1tzcmNPZmZzZXQrK10gKiBudW1Db21wczsKICAgICAgICAgICAgYmFzZS5nZXRSZ2JCdWZmZXIobG9va3VwLCBsb29rdXBQb3MsIDEsIGRlc3QsIGRlc3RPZmZzZXQsIDgsIGFscGhhMDEpOwogICAgICAgICAgICBkZXN0T2Zmc2V0ICs9IG91dHB1dERlbHRhOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImdldE91dHB1dExlbmd0aCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldE91dHB1dExlbmd0aChpbnB1dExlbmd0aCwgYWxwaGEwMSkgewogICAgICAgICAgcmV0dXJuIHRoaXMuYmFzZS5nZXRPdXRwdXRMZW5ndGgoaW5wdXRMZW5ndGggKiB0aGlzLmJhc2UubnVtQ29tcHMsIGFscGhhMDEpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImlzRGVmYXVsdERlY29kZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGlzRGVmYXVsdERlY29kZShkZWNvZGVNYXAsIGJwYykgewogICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGRlY29kZU1hcCkpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGRlY29kZU1hcC5sZW5ndGggIT09IDIpIHsKICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJEZWNvZGUgbWFwIGxlbmd0aCBpcyBub3QgY29ycmVjdCIpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIU51bWJlci5pc0ludGVnZXIoYnBjKSB8fCBicGMgPCAxKSB7CiAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiQml0cyBwZXIgY29tcG9uZW50IGlzIG5vdCBjb3JyZWN0Iik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBkZWNvZGVNYXBbMF0gPT09IDAgJiYgZGVjb2RlTWFwWzFdID09PSAoMSA8PCBicGMpIC0gMTsKICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBJbmRleGVkQ1M7CiAgICB9KENvbG9yU3BhY2UpOwoKICAgIHZhciBEZXZpY2VHcmF5Q1MgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9Db2xvclNwYWNlNCkgewogICAgICBfaW5oZXJpdHMoRGV2aWNlR3JheUNTLCBfQ29sb3JTcGFjZTQpOwoKICAgICAgZnVuY3Rpb24gRGV2aWNlR3JheUNTKCkgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBEZXZpY2VHcmF5Q1MpOwoKICAgICAgICByZXR1cm4gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKERldmljZUdyYXlDUykuY2FsbCh0aGlzLCAiRGV2aWNlR3JheSIsIDEpKTsKICAgICAgfQoKICAgICAgX2NyZWF0ZUNsYXNzKERldmljZUdyYXlDUywgW3sKICAgICAgICBrZXk6ICJnZXRSZ2JJdGVtIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UmdiSXRlbShzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgICAgICAgdmFyIGMgPSBzcmNbc3JjT2Zmc2V0XSAqIDI1NTsKICAgICAgICAgIGRlc3RbZGVzdE9mZnNldF0gPSBkZXN0W2Rlc3RPZmZzZXQgKyAxXSA9IGRlc3RbZGVzdE9mZnNldCArIDJdID0gYzsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJnZXRSZ2JCdWZmZXIiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRSZ2JCdWZmZXIoc3JjLCBzcmNPZmZzZXQsIGNvdW50LCBkZXN0LCBkZXN0T2Zmc2V0LCBiaXRzLCBhbHBoYTAxKSB7CiAgICAgICAgICB2YXIgc2NhbGUgPSAyNTUgLyAoKDEgPDwgYml0cykgLSAxKTsKICAgICAgICAgIHZhciBqID0gc3JjT2Zmc2V0LAogICAgICAgICAgICBxID0gZGVzdE9mZnNldDsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvdW50OyArK2kpIHsKICAgICAgICAgICAgdmFyIGMgPSBzY2FsZSAqIHNyY1tqKytdOwogICAgICAgICAgICBkZXN0W3ErK10gPSBjOwogICAgICAgICAgICBkZXN0W3ErK10gPSBjOwogICAgICAgICAgICBkZXN0W3ErK10gPSBjOwogICAgICAgICAgICBxICs9IGFscGhhMDE7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0T3V0cHV0TGVuZ3RoIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0T3V0cHV0TGVuZ3RoKGlucHV0TGVuZ3RoLCBhbHBoYTAxKSB7CiAgICAgICAgICByZXR1cm4gaW5wdXRMZW5ndGggKiAoMyArIGFscGhhMDEpOwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIERldmljZUdyYXlDUzsKICAgIH0oQ29sb3JTcGFjZSk7CgogICAgdmFyIERldmljZVJnYkNTID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQ29sb3JTcGFjZTUpIHsKICAgICAgX2luaGVyaXRzKERldmljZVJnYkNTLCBfQ29sb3JTcGFjZTUpOwoKICAgICAgZnVuY3Rpb24gRGV2aWNlUmdiQ1MoKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIERldmljZVJnYkNTKTsKCiAgICAgICAgcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihEZXZpY2VSZ2JDUykuY2FsbCh0aGlzLCAiRGV2aWNlUkdCIiwgMykpOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoRGV2aWNlUmdiQ1MsIFt7CiAgICAgICAga2V5OiAiZ2V0UmdiSXRlbSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldFJnYkl0ZW0oc3JjLCBzcmNPZmZzZXQsIGRlc3QsIGRlc3RPZmZzZXQpIHsKICAgICAgICAgIGRlc3RbZGVzdE9mZnNldF0gPSBzcmNbc3JjT2Zmc2V0XSAqIDI1NTsKICAgICAgICAgIGRlc3RbZGVzdE9mZnNldCArIDFdID0gc3JjW3NyY09mZnNldCArIDFdICogMjU1OwogICAgICAgICAgZGVzdFtkZXN0T2Zmc2V0ICsgMl0gPSBzcmNbc3JjT2Zmc2V0ICsgMl0gKiAyNTU7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0UmdiQnVmZmVyIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UmdiQnVmZmVyKHNyYywgc3JjT2Zmc2V0LCBjb3VudCwgZGVzdCwgZGVzdE9mZnNldCwgYml0cywgYWxwaGEwMSkgewogICAgICAgICAgaWYgKGJpdHMgPT09IDggJiYgYWxwaGEwMSA9PT0gMCkgewogICAgICAgICAgICBkZXN0LnNldChzcmMuc3ViYXJyYXkoc3JjT2Zmc2V0LCBzcmNPZmZzZXQgKyBjb3VudCAqIDMpLCBkZXN0T2Zmc2V0KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBzY2FsZSA9IDI1NSAvICgoMSA8PCBiaXRzKSAtIDEpOwogICAgICAgICAgdmFyIGogPSBzcmNPZmZzZXQsCiAgICAgICAgICAgIHEgPSBkZXN0T2Zmc2V0OwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY291bnQ7ICsraSkgewogICAgICAgICAgICBkZXN0W3ErK10gPSBzY2FsZSAqIHNyY1tqKytdOwogICAgICAgICAgICBkZXN0W3ErK10gPSBzY2FsZSAqIHNyY1tqKytdOwogICAgICAgICAgICBkZXN0W3ErK10gPSBzY2FsZSAqIHNyY1tqKytdOwogICAgICAgICAgICBxICs9IGFscGhhMDE7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0T3V0cHV0TGVuZ3RoIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0T3V0cHV0TGVuZ3RoKGlucHV0TGVuZ3RoLCBhbHBoYTAxKSB7CiAgICAgICAgICByZXR1cm4gaW5wdXRMZW5ndGggKiAoMyArIGFscGhhMDEpIC8gMyB8IDA7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiaXNQYXNzdGhyb3VnaCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGlzUGFzc3Rocm91Z2goYml0cykgewogICAgICAgICAgcmV0dXJuIGJpdHMgPT09IDg7CiAgICAgICAgfQogICAgICB9XSk7CgogICAgICByZXR1cm4gRGV2aWNlUmdiQ1M7CiAgICB9KENvbG9yU3BhY2UpOwoKICAgIHZhciBEZXZpY2VDbXlrQ1MgPSBmdW5jdGlvbiBEZXZpY2VDbXlrQ1NDbG9zdXJlKCkgewogICAgICBmdW5jdGlvbiBjb252ZXJ0VG9SZ2Ioc3JjLCBzcmNPZmZzZXQsIHNyY1NjYWxlLCBkZXN0LCBkZXN0T2Zmc2V0KSB7CiAgICAgICAgdmFyIGMgPSBzcmNbc3JjT2Zmc2V0XSAqIHNyY1NjYWxlOwogICAgICAgIHZhciBtID0gc3JjW3NyY09mZnNldCArIDFdICogc3JjU2NhbGU7CiAgICAgICAgdmFyIHkgPSBzcmNbc3JjT2Zmc2V0ICsgMl0gKiBzcmNTY2FsZTsKICAgICAgICB2YXIgayA9IHNyY1tzcmNPZmZzZXQgKyAzXSAqIHNyY1NjYWxlOwogICAgICAgIGRlc3RbZGVzdE9mZnNldF0gPSAyNTUgKyBjICogKC00LjM4NzMzMjM4NDYwOTk4OCAqIGMgKyA1NC40ODYxNTE5NDE4OTE3NiAqIG0gKyAxOC44MjI5MDUwMjE2NTMwMiAqIHkgKyAyMTIuMjU2NjI0NTE2Mzk1ODUgKiBrICsgLTI4NS4yMzMxMDI2MTM3MDA0KSArIG0gKiAoMS43MTQ5NzYzNDc3MzYyMTM0ICogbSAtIDUuNjA5NjczNjkwNDA0NzMxNSAqIHkgKyAtMTcuODczODcwODYxNDE1NDQ0ICogayAtIDUuNDk3MDA2NDI3MTk2MzY2KSArIHkgKiAoLTIuNTIxNzM0MDEzMTY4MzAzMyAqIHkgLSAyMS4yNDg5MjMzMzczNTMwNzMgKiBrICsgMTcuNTExOTI3MDg0MTgxMykgKyBrICogKC0yMS44NjEyMjE0NzQ2MzYwNSAqIGsgLSAxODkuNDgxODA4MzU5MjI3NDcpOwogICAgICAgIGRlc3RbZGVzdE9mZnNldCArIDFdID0gMjU1ICsgYyAqICg4Ljg0MTA0MTQyMjAzNjE0OSAqIGMgKyA2MC4xMTgwMjcwNDU1OTczNjYgKiBtICsgNi44NzE0MjU1OTIwNDkwMDcgKiB5ICsgMzEuMTU5MTAwMTMwMDU1OTIyICogayArIC03OS4yOTcwODQ0ODE2NTQ4KSArIG0gKiAoLTE1LjMxMDM2MTMwNjk2NzgxNyAqIG0gKyAxNy41NzUyNTEyNjExMDk0ODIgKiB5ICsgMTMxLjM1MjUwOTEyNDkzOTc2ICogayAtIDE5MC45NDUzMzAyNTg4OTUxKSArIHkgKiAoNC40NDQzMzkxMDI4NTI3MzkgKiB5ICsgOS44NjMyODYxNDkzNDA1ICogayAtIDI0Ljg2NzQxNTgyNTU1ODc4KSArIGsgKiAoLTIwLjczNzMyNTQ3MTE4MTAzNCAqIGsgLSAxODcuODA0NTM3MDk3MTk1NzgpOwogICAgICAgIGRlc3RbZGVzdE9mZnNldCArIDJdID0gMjU1ICsgYyAqICgwLjg4NDI1MjI0MzAwMDMyOTYgKiBjICsgOC4wNzg2Nzc1MDMxMTI5MjggKiBtICsgMzAuODk5NzgzMDk3MDM3MjkgKiB5IC0gMC4yMzg4MzIzODY4OTE3ODkzNCAqIGsgKyAtMTQuMTgzNTc2Nzk5NjczMjg2KSArIG0gKiAoMTAuNDk1OTMyNzM0MzIwNzIgKiBtICsgNjMuMDIzNzg0OTQ3NTQwNTIgKiB5ICsgNTAuNjA2OTU3NjU2MzYwNzM0ICogayAtIDExMi4yMzg4NDI1MzcxOTI0OCkgKyB5ICogKDAuMDMyOTYwNDExMTQ4NzMyMTcgKiB5ICsgMTE1LjYwMzg0NDQ5NjQ2NjQxICogayArIC0xOTMuNTgyMDkzNTY4NjE1MDUpICsgayAqICgtMjIuMzM4MTY4MDczMDk4ODYgKiBrIC0gMTgwLjEyNjEzOTc0NzA4MzY3KTsKICAgICAgfQoKICAgICAgdmFyIERldmljZUNteWtDUyA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0NvbG9yU3BhY2U2KSB7CiAgICAgICAgX2luaGVyaXRzKERldmljZUNteWtDUywgX0NvbG9yU3BhY2U2KTsKCiAgICAgICAgZnVuY3Rpb24gRGV2aWNlQ215a0NTKCkgewogICAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIERldmljZUNteWtDUyk7CgogICAgICAgICAgcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihEZXZpY2VDbXlrQ1MpLmNhbGwodGhpcywgIkRldmljZUNNWUsiLCA0KSk7CiAgICAgICAgfQoKICAgICAgICBfY3JlYXRlQ2xhc3MoRGV2aWNlQ215a0NTLCBbewogICAgICAgICAga2V5OiAiZ2V0UmdiSXRlbSIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UmdiSXRlbShzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgICAgICAgICBjb252ZXJ0VG9SZ2Ioc3JjLCBzcmNPZmZzZXQsIDEsIGRlc3QsIGRlc3RPZmZzZXQpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogImdldFJnYkJ1ZmZlciIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UmdiQnVmZmVyKHNyYywgc3JjT2Zmc2V0LCBjb3VudCwgZGVzdCwgZGVzdE9mZnNldCwgYml0cywgYWxwaGEwMSkgewogICAgICAgICAgICB2YXIgc2NhbGUgPSAxIC8gKCgxIDw8IGJpdHMpIC0gMSk7CgogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgICAgICAgICAgICBjb252ZXJ0VG9SZ2Ioc3JjLCBzcmNPZmZzZXQsIHNjYWxlLCBkZXN0LCBkZXN0T2Zmc2V0KTsKICAgICAgICAgICAgICBzcmNPZmZzZXQgKz0gNDsKICAgICAgICAgICAgICBkZXN0T2Zmc2V0ICs9IDMgKyBhbHBoYTAxOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAiZ2V0T3V0cHV0TGVuZ3RoIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRPdXRwdXRMZW5ndGgoaW5wdXRMZW5ndGgsIGFscGhhMDEpIHsKICAgICAgICAgICAgcmV0dXJuIGlucHV0TGVuZ3RoIC8gNCAqICgzICsgYWxwaGEwMSkgfCAwOwogICAgICAgICAgfQogICAgICAgIH1dKTsKCiAgICAgICAgcmV0dXJuIERldmljZUNteWtDUzsKICAgICAgfShDb2xvclNwYWNlKTsKCiAgICAgIHJldHVybiBEZXZpY2VDbXlrQ1M7CiAgICB9KCk7CgogICAgdmFyIENhbEdyYXlDUyA9IGZ1bmN0aW9uIENhbEdyYXlDU0Nsb3N1cmUoKSB7CiAgICAgIGZ1bmN0aW9uIGNvbnZlcnRUb1JnYihjcywgc3JjLCBzcmNPZmZzZXQsIGRlc3QsIGRlc3RPZmZzZXQsIHNjYWxlKSB7CiAgICAgICAgdmFyIEEgPSBzcmNbc3JjT2Zmc2V0XSAqIHNjYWxlOwogICAgICAgIHZhciBBRyA9IE1hdGgucG93KEEsIGNzLkcpOwogICAgICAgIHZhciBMID0gY3MuWVcgKiBBRzsKICAgICAgICB2YXIgdmFsID0gTWF0aC5tYXgoMjk1LjggKiBNYXRoLnBvdyhMLCAwLjMzMzMzMzMzMzMzMzMzMzMzMykgLSA0MC44LCAwKTsKICAgICAgICBkZXN0W2Rlc3RPZmZzZXRdID0gdmFsOwogICAgICAgIGRlc3RbZGVzdE9mZnNldCArIDFdID0gdmFsOwogICAgICAgIGRlc3RbZGVzdE9mZnNldCArIDJdID0gdmFsOwogICAgICB9CgogICAgICB2YXIgQ2FsR3JheUNTID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQ29sb3JTcGFjZTcpIHsKICAgICAgICBfaW5oZXJpdHMoQ2FsR3JheUNTLCBfQ29sb3JTcGFjZTcpOwoKICAgICAgICBmdW5jdGlvbiBDYWxHcmF5Q1Mod2hpdGVQb2ludCwgYmxhY2tQb2ludCwgZ2FtbWEpIHsKICAgICAgICAgIHZhciBfdGhpczQ7CgogICAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIENhbEdyYXlDUyk7CgogICAgICAgICAgX3RoaXM0ID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKENhbEdyYXlDUykuY2FsbCh0aGlzLCAiQ2FsR3JheSIsIDEpKTsKCiAgICAgICAgICBpZiAoIXdoaXRlUG9pbnQpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJXaGl0ZVBvaW50IG1pc3NpbmcgLSByZXF1aXJlZCBmb3IgY29sb3Igc3BhY2UgQ2FsR3JheSIpOwogICAgICAgICAgfQoKICAgICAgICAgIGJsYWNrUG9pbnQgPSBibGFja1BvaW50IHx8IFswLCAwLCAwXTsKICAgICAgICAgIGdhbW1hID0gZ2FtbWEgfHwgMTsKICAgICAgICAgIF90aGlzNC5YVyA9IHdoaXRlUG9pbnRbMF07CiAgICAgICAgICBfdGhpczQuWVcgPSB3aGl0ZVBvaW50WzFdOwogICAgICAgICAgX3RoaXM0LlpXID0gd2hpdGVQb2ludFsyXTsKICAgICAgICAgIF90aGlzNC5YQiA9IGJsYWNrUG9pbnRbMF07CiAgICAgICAgICBfdGhpczQuWUIgPSBibGFja1BvaW50WzFdOwogICAgICAgICAgX3RoaXM0LlpCID0gYmxhY2tQb2ludFsyXTsKICAgICAgICAgIF90aGlzNC5HID0gZ2FtbWE7CgogICAgICAgICAgaWYgKF90aGlzNC5YVyA8IDAgfHwgX3RoaXM0LlpXIDwgMCB8fCBfdGhpczQuWVcgIT09IDEpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJJbnZhbGlkIFdoaXRlUG9pbnQgY29tcG9uZW50cyBmb3IgIi5jb25jYXQoX3RoaXM0Lm5hbWUpICsgIiwgbm8gZmFsbGJhY2sgYXZhaWxhYmxlIik7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKF90aGlzNC5YQiA8IDAgfHwgX3RoaXM0LllCIDwgMCB8fCBfdGhpczQuWkIgPCAwKSB7CiAgICAgICAgICAgICgwLCBfdXRpbC5pbmZvKSgiSW52YWxpZCBCbGFja1BvaW50IGZvciAiLmNvbmNhdChfdGhpczQubmFtZSwgIiwgZmFsbGluZyBiYWNrIHRvIGRlZmF1bHQuIikpOwogICAgICAgICAgICBfdGhpczQuWEIgPSBfdGhpczQuWUIgPSBfdGhpczQuWkIgPSAwOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChfdGhpczQuWEIgIT09IDAgfHwgX3RoaXM0LllCICE9PSAwIHx8IF90aGlzNC5aQiAhPT0gMCkgewogICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIiIuY29uY2F0KF90aGlzNC5uYW1lLCAiLCBCbGFja1BvaW50OiBYQjogIikuY29uY2F0KF90aGlzNC5YQiwgIiwgWUI6ICIpLmNvbmNhdChfdGhpczQuWUIsICIsICIpICsgIlpCOiAiLmNvbmNhdChfdGhpczQuWkIsICIsIG9ubHkgZGVmYXVsdCB2YWx1ZXMgYXJlIHN1cHBvcnRlZC4iKSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKF90aGlzNC5HIDwgMSkgewogICAgICAgICAgICAoMCwgX3V0aWwuaW5mbykoIkludmFsaWQgR2FtbWE6ICIuY29uY2F0KF90aGlzNC5HLCAiIGZvciAiKS5jb25jYXQoX3RoaXM0Lm5hbWUsICIsICIpICsgImZhbGxpbmcgYmFjayB0byBkZWZhdWx0LiIpOwogICAgICAgICAgICBfdGhpczQuRyA9IDE7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIF90aGlzNDsKICAgICAgICB9CgogICAgICAgIF9jcmVhdGVDbGFzcyhDYWxHcmF5Q1MsIFt7CiAgICAgICAgICBrZXk6ICJnZXRSZ2JJdGVtIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRSZ2JJdGVtKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0KSB7CiAgICAgICAgICAgIGNvbnZlcnRUb1JnYih0aGlzLCBzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCwgMSk7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAiZ2V0UmdiQnVmZmVyIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRSZ2JCdWZmZXIoc3JjLCBzcmNPZmZzZXQsIGNvdW50LCBkZXN0LCBkZXN0T2Zmc2V0LCBiaXRzLCBhbHBoYTAxKSB7CiAgICAgICAgICAgIHZhciBzY2FsZSA9IDEgLyAoKDEgPDwgYml0cykgLSAxKTsKCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY291bnQ7ICsraSkgewogICAgICAgICAgICAgIGNvbnZlcnRUb1JnYih0aGlzLCBzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCwgc2NhbGUpOwogICAgICAgICAgICAgIHNyY09mZnNldCArPSAxOwogICAgICAgICAgICAgIGRlc3RPZmZzZXQgKz0gMyArIGFscGhhMDE7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJnZXRPdXRwdXRMZW5ndGgiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldE91dHB1dExlbmd0aChpbnB1dExlbmd0aCwgYWxwaGEwMSkgewogICAgICAgICAgICByZXR1cm4gaW5wdXRMZW5ndGggKiAoMyArIGFscGhhMDEpOwogICAgICAgICAgfQogICAgICAgIH1dKTsKCiAgICAgICAgcmV0dXJuIENhbEdyYXlDUzsKICAgICAgfShDb2xvclNwYWNlKTsKCiAgICAgIHJldHVybiBDYWxHcmF5Q1M7CiAgICB9KCk7CgogICAgdmFyIENhbFJHQkNTID0gZnVuY3Rpb24gQ2FsUkdCQ1NDbG9zdXJlKCkgewogICAgICB2YXIgQlJBREZPUkRfU0NBTEVfTUFUUklYID0gbmV3IEZsb2F0MzJBcnJheShbMC44OTUxLCAwLjI2NjQsIC0wLjE2MTQsIC0wLjc1MDIsIDEuNzEzNSwgMC4wMzY3LCAwLjAzODksIC0wLjA2ODUsIDEuMDI5Nl0pOwogICAgICB2YXIgQlJBREZPUkRfU0NBTEVfSU5WRVJTRV9NQVRSSVggPSBuZXcgRmxvYXQzMkFycmF5KFswLjk4Njk5MjksIC0wLjE0NzA1NDMsIDAuMTU5OTYyNywgMC40MzIzMDUzLCAwLjUxODM2MDMsIDAuMDQ5MjkxMiwgLTAuMDA4NTI4NywgMC4wNDAwNDI4LCAwLjk2ODQ4NjddKTsKICAgICAgdmFyIFNSR0JfRDY1X1hZWl9UT19SR0JfTUFUUklYID0gbmV3IEZsb2F0MzJBcnJheShbMy4yNDA0NTQyLCAtMS41MzcxMzg1LCAtMC40OTg1MzE0LCAtMC45NjkyNjYwLCAxLjg3NjAxMDgsIDAuMDQxNTU2MCwgMC4wNTU2NDM0LCAtMC4yMDQwMjU5LCAxLjA1NzIyNTJdKTsKICAgICAgdmFyIEZMQVRfV0hJVEVQT0lOVF9NQVRSSVggPSBuZXcgRmxvYXQzMkFycmF5KFsxLCAxLCAxXSk7CiAgICAgIHZhciB0ZW1wTm9ybWFsaXplTWF0cml4ID0gbmV3IEZsb2F0MzJBcnJheSgzKTsKICAgICAgdmFyIHRlbXBDb252ZXJ0TWF0cml4MSA9IG5ldyBGbG9hdDMyQXJyYXkoMyk7CiAgICAgIHZhciB0ZW1wQ29udmVydE1hdHJpeDIgPSBuZXcgRmxvYXQzMkFycmF5KDMpOwogICAgICB2YXIgREVDT0RFX0xfQ09OU1RBTlQgPSBNYXRoLnBvdygoOCArIDE2KSAvIDExNiwgMykgLyA4LjA7CgogICAgICBmdW5jdGlvbiBtYXRyaXhQcm9kdWN0KGEsIGIsIHJlc3VsdCkgewogICAgICAgIHJlc3VsdFswXSA9IGFbMF0gKiBiWzBdICsgYVsxXSAqIGJbMV0gKyBhWzJdICogYlsyXTsKICAgICAgICByZXN1bHRbMV0gPSBhWzNdICogYlswXSArIGFbNF0gKiBiWzFdICsgYVs1XSAqIGJbMl07CiAgICAgICAgcmVzdWx0WzJdID0gYVs2XSAqIGJbMF0gKyBhWzddICogYlsxXSArIGFbOF0gKiBiWzJdOwogICAgICB9CgogICAgICBmdW5jdGlvbiBjb252ZXJ0VG9GbGF0KHNvdXJjZVdoaXRlUG9pbnQsIExNUywgcmVzdWx0KSB7CiAgICAgICAgcmVzdWx0WzBdID0gTE1TWzBdICogMSAvIHNvdXJjZVdoaXRlUG9pbnRbMF07CiAgICAgICAgcmVzdWx0WzFdID0gTE1TWzFdICogMSAvIHNvdXJjZVdoaXRlUG9pbnRbMV07CiAgICAgICAgcmVzdWx0WzJdID0gTE1TWzJdICogMSAvIHNvdXJjZVdoaXRlUG9pbnRbMl07CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGNvbnZlcnRUb0Q2NShzb3VyY2VXaGl0ZVBvaW50LCBMTVMsIHJlc3VsdCkgewogICAgICAgIHZhciBENjVYID0gMC45NTA0NzsKICAgICAgICB2YXIgRDY1WSA9IDE7CiAgICAgICAgdmFyIEQ2NVogPSAxLjA4ODgzOwogICAgICAgIHJlc3VsdFswXSA9IExNU1swXSAqIEQ2NVggLyBzb3VyY2VXaGl0ZVBvaW50WzBdOwogICAgICAgIHJlc3VsdFsxXSA9IExNU1sxXSAqIEQ2NVkgLyBzb3VyY2VXaGl0ZVBvaW50WzFdOwogICAgICAgIHJlc3VsdFsyXSA9IExNU1syXSAqIEQ2NVogLyBzb3VyY2VXaGl0ZVBvaW50WzJdOwogICAgICB9CgogICAgICBmdW5jdGlvbiBzUkdCVHJhbnNmZXJGdW5jdGlvbihjb2xvcikgewogICAgICAgIGlmIChjb2xvciA8PSAwLjAwMzEzMDgpIHsKICAgICAgICAgIHJldHVybiBhZGp1c3RUb1JhbmdlKDAsIDEsIDEyLjkyICogY29sb3IpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGFkanVzdFRvUmFuZ2UoMCwgMSwgKDEgKyAwLjA1NSkgKiBNYXRoLnBvdyhjb2xvciwgMSAvIDIuNCkgLSAwLjA1NSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGFkanVzdFRvUmFuZ2UobWluLCBtYXgsIHZhbHVlKSB7CiAgICAgICAgcmV0dXJuIE1hdGgubWF4KG1pbiwgTWF0aC5taW4obWF4LCB2YWx1ZSkpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBkZWNvZGVMKEwpIHsKICAgICAgICBpZiAoTCA8IDApIHsKICAgICAgICAgIHJldHVybiAtZGVjb2RlTCgtTCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoTCA+IDguMCkgewogICAgICAgICAgcmV0dXJuIE1hdGgucG93KChMICsgMTYpIC8gMTE2LCAzKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBMICogREVDT0RFX0xfQ09OU1RBTlQ7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGNvbXBlbnNhdGVCbGFja1BvaW50KHNvdXJjZUJsYWNrUG9pbnQsIFhZWl9GbGF0LCByZXN1bHQpIHsKICAgICAgICBpZiAoc291cmNlQmxhY2tQb2ludFswXSA9PT0gMCAmJiBzb3VyY2VCbGFja1BvaW50WzFdID09PSAwICYmIHNvdXJjZUJsYWNrUG9pbnRbMl0gPT09IDApIHsKICAgICAgICAgIHJlc3VsdFswXSA9IFhZWl9GbGF0WzBdOwogICAgICAgICAgcmVzdWx0WzFdID0gWFlaX0ZsYXRbMV07CiAgICAgICAgICByZXN1bHRbMl0gPSBYWVpfRmxhdFsyXTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciB6ZXJvRGVjb2RlTCA9IGRlY29kZUwoMCk7CiAgICAgICAgdmFyIFhfRFNUID0gemVyb0RlY29kZUw7CiAgICAgICAgdmFyIFhfU1JDID0gZGVjb2RlTChzb3VyY2VCbGFja1BvaW50WzBdKTsKICAgICAgICB2YXIgWV9EU1QgPSB6ZXJvRGVjb2RlTDsKICAgICAgICB2YXIgWV9TUkMgPSBkZWNvZGVMKHNvdXJjZUJsYWNrUG9pbnRbMV0pOwogICAgICAgIHZhciBaX0RTVCA9IHplcm9EZWNvZGVMOwogICAgICAgIHZhciBaX1NSQyA9IGRlY29kZUwoc291cmNlQmxhY2tQb2ludFsyXSk7CiAgICAgICAgdmFyIFhfU2NhbGUgPSAoMSAtIFhfRFNUKSAvICgxIC0gWF9TUkMpOwogICAgICAgIHZhciBYX09mZnNldCA9IDEgLSBYX1NjYWxlOwogICAgICAgIHZhciBZX1NjYWxlID0gKDEgLSBZX0RTVCkgLyAoMSAtIFlfU1JDKTsKICAgICAgICB2YXIgWV9PZmZzZXQgPSAxIC0gWV9TY2FsZTsKICAgICAgICB2YXIgWl9TY2FsZSA9ICgxIC0gWl9EU1QpIC8gKDEgLSBaX1NSQyk7CiAgICAgICAgdmFyIFpfT2Zmc2V0ID0gMSAtIFpfU2NhbGU7CiAgICAgICAgcmVzdWx0WzBdID0gWFlaX0ZsYXRbMF0gKiBYX1NjYWxlICsgWF9PZmZzZXQ7CiAgICAgICAgcmVzdWx0WzFdID0gWFlaX0ZsYXRbMV0gKiBZX1NjYWxlICsgWV9PZmZzZXQ7CiAgICAgICAgcmVzdWx0WzJdID0gWFlaX0ZsYXRbMl0gKiBaX1NjYWxlICsgWl9PZmZzZXQ7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIG5vcm1hbGl6ZVdoaXRlUG9pbnRUb0ZsYXQoc291cmNlV2hpdGVQb2ludCwgWFlaX0luLCByZXN1bHQpIHsKICAgICAgICBpZiAoc291cmNlV2hpdGVQb2ludFswXSA9PT0gMSAmJiBzb3VyY2VXaGl0ZVBvaW50WzJdID09PSAxKSB7CiAgICAgICAgICByZXN1bHRbMF0gPSBYWVpfSW5bMF07CiAgICAgICAgICByZXN1bHRbMV0gPSBYWVpfSW5bMV07CiAgICAgICAgICByZXN1bHRbMl0gPSBYWVpfSW5bMl07CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgTE1TID0gcmVzdWx0OwogICAgICAgIG1hdHJpeFByb2R1Y3QoQlJBREZPUkRfU0NBTEVfTUFUUklYLCBYWVpfSW4sIExNUyk7CiAgICAgICAgdmFyIExNU19GbGF0ID0gdGVtcE5vcm1hbGl6ZU1hdHJpeDsKICAgICAgICBjb252ZXJ0VG9GbGF0KHNvdXJjZVdoaXRlUG9pbnQsIExNUywgTE1TX0ZsYXQpOwogICAgICAgIG1hdHJpeFByb2R1Y3QoQlJBREZPUkRfU0NBTEVfSU5WRVJTRV9NQVRSSVgsIExNU19GbGF0LCByZXN1bHQpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBub3JtYWxpemVXaGl0ZVBvaW50VG9ENjUoc291cmNlV2hpdGVQb2ludCwgWFlaX0luLCByZXN1bHQpIHsKICAgICAgICB2YXIgTE1TID0gcmVzdWx0OwogICAgICAgIG1hdHJpeFByb2R1Y3QoQlJBREZPUkRfU0NBTEVfTUFUUklYLCBYWVpfSW4sIExNUyk7CiAgICAgICAgdmFyIExNU19ENjUgPSB0ZW1wTm9ybWFsaXplTWF0cml4OwogICAgICAgIGNvbnZlcnRUb0Q2NShzb3VyY2VXaGl0ZVBvaW50LCBMTVMsIExNU19ENjUpOwogICAgICAgIG1hdHJpeFByb2R1Y3QoQlJBREZPUkRfU0NBTEVfSU5WRVJTRV9NQVRSSVgsIExNU19ENjUsIHJlc3VsdCk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGNvbnZlcnRUb1JnYihjcywgc3JjLCBzcmNPZmZzZXQsIGRlc3QsIGRlc3RPZmZzZXQsIHNjYWxlKSB7CiAgICAgICAgdmFyIEEgPSBhZGp1c3RUb1JhbmdlKDAsIDEsIHNyY1tzcmNPZmZzZXRdICogc2NhbGUpOwogICAgICAgIHZhciBCID0gYWRqdXN0VG9SYW5nZSgwLCAxLCBzcmNbc3JjT2Zmc2V0ICsgMV0gKiBzY2FsZSk7CiAgICAgICAgdmFyIEMgPSBhZGp1c3RUb1JhbmdlKDAsIDEsIHNyY1tzcmNPZmZzZXQgKyAyXSAqIHNjYWxlKTsKICAgICAgICB2YXIgQUdSID0gTWF0aC5wb3coQSwgY3MuR1IpOwogICAgICAgIHZhciBCR0cgPSBNYXRoLnBvdyhCLCBjcy5HRyk7CiAgICAgICAgdmFyIENHQiA9IE1hdGgucG93KEMsIGNzLkdCKTsKICAgICAgICB2YXIgWCA9IGNzLk1YQSAqIEFHUiArIGNzLk1YQiAqIEJHRyArIGNzLk1YQyAqIENHQjsKICAgICAgICB2YXIgWSA9IGNzLk1ZQSAqIEFHUiArIGNzLk1ZQiAqIEJHRyArIGNzLk1ZQyAqIENHQjsKICAgICAgICB2YXIgWiA9IGNzLk1aQSAqIEFHUiArIGNzLk1aQiAqIEJHRyArIGNzLk1aQyAqIENHQjsKICAgICAgICB2YXIgWFlaID0gdGVtcENvbnZlcnRNYXRyaXgxOwogICAgICAgIFhZWlswXSA9IFg7CiAgICAgICAgWFlaWzFdID0gWTsKICAgICAgICBYWVpbMl0gPSBaOwogICAgICAgIHZhciBYWVpfRmxhdCA9IHRlbXBDb252ZXJ0TWF0cml4MjsKICAgICAgICBub3JtYWxpemVXaGl0ZVBvaW50VG9GbGF0KGNzLndoaXRlUG9pbnQsIFhZWiwgWFlaX0ZsYXQpOwogICAgICAgIHZhciBYWVpfQmxhY2sgPSB0ZW1wQ29udmVydE1hdHJpeDE7CiAgICAgICAgY29tcGVuc2F0ZUJsYWNrUG9pbnQoY3MuYmxhY2tQb2ludCwgWFlaX0ZsYXQsIFhZWl9CbGFjayk7CiAgICAgICAgdmFyIFhZWl9ENjUgPSB0ZW1wQ29udmVydE1hdHJpeDI7CiAgICAgICAgbm9ybWFsaXplV2hpdGVQb2ludFRvRDY1KEZMQVRfV0hJVEVQT0lOVF9NQVRSSVgsIFhZWl9CbGFjaywgWFlaX0Q2NSk7CiAgICAgICAgdmFyIFNSR0IgPSB0ZW1wQ29udmVydE1hdHJpeDE7CiAgICAgICAgbWF0cml4UHJvZHVjdChTUkdCX0Q2NV9YWVpfVE9fUkdCX01BVFJJWCwgWFlaX0Q2NSwgU1JHQik7CiAgICAgICAgZGVzdFtkZXN0T2Zmc2V0XSA9IHNSR0JUcmFuc2ZlckZ1bmN0aW9uKFNSR0JbMF0pICogMjU1OwogICAgICAgIGRlc3RbZGVzdE9mZnNldCArIDFdID0gc1JHQlRyYW5zZmVyRnVuY3Rpb24oU1JHQlsxXSkgKiAyNTU7CiAgICAgICAgZGVzdFtkZXN0T2Zmc2V0ICsgMl0gPSBzUkdCVHJhbnNmZXJGdW5jdGlvbihTUkdCWzJdKSAqIDI1NTsKICAgICAgfQoKICAgICAgdmFyIENhbFJHQkNTID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQ29sb3JTcGFjZTgpIHsKICAgICAgICBfaW5oZXJpdHMoQ2FsUkdCQ1MsIF9Db2xvclNwYWNlOCk7CgogICAgICAgIGZ1bmN0aW9uIENhbFJHQkNTKHdoaXRlUG9pbnQsIGJsYWNrUG9pbnQsIGdhbW1hLCBtYXRyaXgpIHsKICAgICAgICAgIHZhciBfdGhpczU7CgogICAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIENhbFJHQkNTKTsKCiAgICAgICAgICBfdGhpczUgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoQ2FsUkdCQ1MpLmNhbGwodGhpcywgIkNhbFJHQiIsIDMpKTsKCiAgICAgICAgICBpZiAoIXdoaXRlUG9pbnQpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJXaGl0ZVBvaW50IG1pc3NpbmcgLSByZXF1aXJlZCBmb3IgY29sb3Igc3BhY2UgQ2FsUkdCIik7CiAgICAgICAgICB9CgogICAgICAgICAgYmxhY2tQb2ludCA9IGJsYWNrUG9pbnQgfHwgbmV3IEZsb2F0MzJBcnJheSgzKTsKICAgICAgICAgIGdhbW1hID0gZ2FtbWEgfHwgbmV3IEZsb2F0MzJBcnJheShbMSwgMSwgMV0pOwogICAgICAgICAgbWF0cml4ID0gbWF0cml4IHx8IG5ldyBGbG9hdDMyQXJyYXkoWzEsIDAsIDAsIDAsIDEsIDAsIDAsIDAsIDFdKTsKICAgICAgICAgIHZhciBYVyA9IHdoaXRlUG9pbnRbMF07CiAgICAgICAgICB2YXIgWVcgPSB3aGl0ZVBvaW50WzFdOwogICAgICAgICAgdmFyIFpXID0gd2hpdGVQb2ludFsyXTsKICAgICAgICAgIF90aGlzNS53aGl0ZVBvaW50ID0gd2hpdGVQb2ludDsKICAgICAgICAgIHZhciBYQiA9IGJsYWNrUG9pbnRbMF07CiAgICAgICAgICB2YXIgWUIgPSBibGFja1BvaW50WzFdOwogICAgICAgICAgdmFyIFpCID0gYmxhY2tQb2ludFsyXTsKICAgICAgICAgIF90aGlzNS5ibGFja1BvaW50ID0gYmxhY2tQb2ludDsKICAgICAgICAgIF90aGlzNS5HUiA9IGdhbW1hWzBdOwogICAgICAgICAgX3RoaXM1LkdHID0gZ2FtbWFbMV07CiAgICAgICAgICBfdGhpczUuR0IgPSBnYW1tYVsyXTsKICAgICAgICAgIF90aGlzNS5NWEEgPSBtYXRyaXhbMF07CiAgICAgICAgICBfdGhpczUuTVlBID0gbWF0cml4WzFdOwogICAgICAgICAgX3RoaXM1Lk1aQSA9IG1hdHJpeFsyXTsKICAgICAgICAgIF90aGlzNS5NWEIgPSBtYXRyaXhbM107CiAgICAgICAgICBfdGhpczUuTVlCID0gbWF0cml4WzRdOwogICAgICAgICAgX3RoaXM1Lk1aQiA9IG1hdHJpeFs1XTsKICAgICAgICAgIF90aGlzNS5NWEMgPSBtYXRyaXhbNl07CiAgICAgICAgICBfdGhpczUuTVlDID0gbWF0cml4WzddOwogICAgICAgICAgX3RoaXM1Lk1aQyA9IG1hdHJpeFs4XTsKCiAgICAgICAgICBpZiAoWFcgPCAwIHx8IFpXIDwgMCB8fCBZVyAhPT0gMSkgewogICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkludmFsaWQgV2hpdGVQb2ludCBjb21wb25lbnRzIGZvciAiLmNvbmNhdChfdGhpczUubmFtZSkgKyAiLCBubyBmYWxsYmFjayBhdmFpbGFibGUiKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoWEIgPCAwIHx8IFlCIDwgMCB8fCBaQiA8IDApIHsKICAgICAgICAgICAgKDAsIF91dGlsLmluZm8pKCJJbnZhbGlkIEJsYWNrUG9pbnQgZm9yICIuY29uY2F0KF90aGlzNS5uYW1lLCAiIFsiKS5jb25jYXQoWEIsICIsICIpLmNvbmNhdChZQiwgIiwgIikuY29uY2F0KFpCLCAiXSwgIikgKyAiZmFsbGluZyBiYWNrIHRvIGRlZmF1bHQuIik7CiAgICAgICAgICAgIF90aGlzNS5ibGFja1BvaW50ID0gbmV3IEZsb2F0MzJBcnJheSgzKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoX3RoaXM1LkdSIDwgMCB8fCBfdGhpczUuR0cgPCAwIHx8IF90aGlzNS5HQiA8IDApIHsKICAgICAgICAgICAgKDAsIF91dGlsLmluZm8pKCJJbnZhbGlkIEdhbW1hIFsiLmNvbmNhdChfdGhpczUuR1IsICIsICIpLmNvbmNhdChfdGhpczUuR0csICIsICIpLmNvbmNhdChfdGhpczUuR0IsICJdIGZvciAiKSArICIiLmNvbmNhdChfdGhpczUubmFtZSwgIiwgZmFsbGluZyBiYWNrIHRvIGRlZmF1bHQuIikpOwogICAgICAgICAgICBfdGhpczUuR1IgPSBfdGhpczUuR0cgPSBfdGhpczUuR0IgPSAxOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBfdGhpczU7CiAgICAgICAgfQoKICAgICAgICBfY3JlYXRlQ2xhc3MoQ2FsUkdCQ1MsIFt7CiAgICAgICAgICBrZXk6ICJnZXRSZ2JJdGVtIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRSZ2JJdGVtKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0KSB7CiAgICAgICAgICAgIGNvbnZlcnRUb1JnYih0aGlzLCBzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCwgMSk7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAiZ2V0UmdiQnVmZmVyIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRSZ2JCdWZmZXIoc3JjLCBzcmNPZmZzZXQsIGNvdW50LCBkZXN0LCBkZXN0T2Zmc2V0LCBiaXRzLCBhbHBoYTAxKSB7CiAgICAgICAgICAgIHZhciBzY2FsZSA9IDEgLyAoKDEgPDwgYml0cykgLSAxKTsKCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY291bnQ7ICsraSkgewogICAgICAgICAgICAgIGNvbnZlcnRUb1JnYih0aGlzLCBzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCwgc2NhbGUpOwogICAgICAgICAgICAgIHNyY09mZnNldCArPSAzOwogICAgICAgICAgICAgIGRlc3RPZmZzZXQgKz0gMyArIGFscGhhMDE7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJnZXRPdXRwdXRMZW5ndGgiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldE91dHB1dExlbmd0aChpbnB1dExlbmd0aCwgYWxwaGEwMSkgewogICAgICAgICAgICByZXR1cm4gaW5wdXRMZW5ndGggKiAoMyArIGFscGhhMDEpIC8gMyB8IDA7CiAgICAgICAgICB9CiAgICAgICAgfV0pOwoKICAgICAgICByZXR1cm4gQ2FsUkdCQ1M7CiAgICAgIH0oQ29sb3JTcGFjZSk7CgogICAgICByZXR1cm4gQ2FsUkdCQ1M7CiAgICB9KCk7CgogICAgdmFyIExhYkNTID0gZnVuY3Rpb24gTGFiQ1NDbG9zdXJlKCkgewogICAgICBmdW5jdGlvbiBmbl9nKHgpIHsKICAgICAgICB2YXIgcmVzdWx0OwoKICAgICAgICBpZiAoeCA+PSA2IC8gMjkpIHsKICAgICAgICAgIHJlc3VsdCA9IHggKiB4ICogeDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmVzdWx0ID0gMTA4IC8gODQxICogKHggLSA0IC8gMjkpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZGVjb2RlKHZhbHVlLCBoaWdoMSwgbG93MiwgaGlnaDIpIHsKICAgICAgICByZXR1cm4gbG93MiArIHZhbHVlICogKGhpZ2gyIC0gbG93MikgLyBoaWdoMTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gY29udmVydFRvUmdiKGNzLCBzcmMsIHNyY09mZnNldCwgbWF4VmFsLCBkZXN0LCBkZXN0T2Zmc2V0KSB7CiAgICAgICAgdmFyIExzID0gc3JjW3NyY09mZnNldF07CiAgICAgICAgdmFyIGFzID0gc3JjW3NyY09mZnNldCArIDFdOwogICAgICAgIHZhciBicyA9IHNyY1tzcmNPZmZzZXQgKyAyXTsKCiAgICAgICAgaWYgKG1heFZhbCAhPT0gZmFsc2UpIHsKICAgICAgICAgIExzID0gZGVjb2RlKExzLCBtYXhWYWwsIDAsIDEwMCk7CiAgICAgICAgICBhcyA9IGRlY29kZShhcywgbWF4VmFsLCBjcy5hbWluLCBjcy5hbWF4KTsKICAgICAgICAgIGJzID0gZGVjb2RlKGJzLCBtYXhWYWwsIGNzLmJtaW4sIGNzLmJtYXgpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGFzID4gY3MuYW1heCkgewogICAgICAgICAgYXMgPSBjcy5hbWF4OwogICAgICAgIH0gZWxzZSBpZiAoYXMgPCBjcy5hbWluKSB7CiAgICAgICAgICBhcyA9IGNzLmFtaW47CiAgICAgICAgfQoKICAgICAgICBpZiAoYnMgPiBjcy5ibWF4KSB7CiAgICAgICAgICBicyA9IGNzLmJtYXg7CiAgICAgICAgfSBlbHNlIGlmIChicyA8IGNzLmJtaW4pIHsKICAgICAgICAgIGJzID0gY3MuYm1pbjsKICAgICAgICB9CgogICAgICAgIHZhciBNID0gKExzICsgMTYpIC8gMTE2OwogICAgICAgIHZhciBMID0gTSArIGFzIC8gNTAwOwogICAgICAgIHZhciBOID0gTSAtIGJzIC8gMjAwOwogICAgICAgIHZhciBYID0gY3MuWFcgKiBmbl9nKEwpOwogICAgICAgIHZhciBZID0gY3MuWVcgKiBmbl9nKE0pOwogICAgICAgIHZhciBaID0gY3MuWlcgKiBmbl9nKE4pOwogICAgICAgIHZhciByLCBnLCBiOwoKICAgICAgICBpZiAoY3MuWlcgPCAxKSB7CiAgICAgICAgICByID0gWCAqIDMuMTMzOSArIFkgKiAtMS42MTcgKyBaICogLTAuNDkwNjsKICAgICAgICAgIGcgPSBYICogLTAuOTc4NSArIFkgKiAxLjkxNiArIFogKiAwLjAzMzM7CiAgICAgICAgICBiID0gWCAqIDAuMDcyICsgWSAqIC0wLjIyOSArIFogKiAxLjQwNTc7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHIgPSBYICogMy4yNDA2ICsgWSAqIC0xLjUzNzIgKyBaICogLTAuNDk4NjsKICAgICAgICAgIGcgPSBYICogLTAuOTY4OSArIFkgKiAxLjg3NTggKyBaICogMC4wNDE1OwogICAgICAgICAgYiA9IFggKiAwLjA1NTcgKyBZICogLTAuMjA0ICsgWiAqIDEuMDU3OwogICAgICAgIH0KCiAgICAgICAgZGVzdFtkZXN0T2Zmc2V0XSA9IE1hdGguc3FydChyKSAqIDI1NTsKICAgICAgICBkZXN0W2Rlc3RPZmZzZXQgKyAxXSA9IE1hdGguc3FydChnKSAqIDI1NTsKICAgICAgICBkZXN0W2Rlc3RPZmZzZXQgKyAyXSA9IE1hdGguc3FydChiKSAqIDI1NTsKICAgICAgfQoKICAgICAgdmFyIExhYkNTID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQ29sb3JTcGFjZTkpIHsKICAgICAgICBfaW5oZXJpdHMoTGFiQ1MsIF9Db2xvclNwYWNlOSk7CgogICAgICAgIGZ1bmN0aW9uIExhYkNTKHdoaXRlUG9pbnQsIGJsYWNrUG9pbnQsIHJhbmdlKSB7CiAgICAgICAgICB2YXIgX3RoaXM2OwoKICAgICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBMYWJDUyk7CgogICAgICAgICAgX3RoaXM2ID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKExhYkNTKS5jYWxsKHRoaXMsICJMYWIiLCAzKSk7CgogICAgICAgICAgaWYgKCF3aGl0ZVBvaW50KSB7CiAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiV2hpdGVQb2ludCBtaXNzaW5nIC0gcmVxdWlyZWQgZm9yIGNvbG9yIHNwYWNlIExhYiIpOwogICAgICAgICAgfQoKICAgICAgICAgIGJsYWNrUG9pbnQgPSBibGFja1BvaW50IHx8IFswLCAwLCAwXTsKICAgICAgICAgIHJhbmdlID0gcmFuZ2UgfHwgWy0xMDAsIDEwMCwgLTEwMCwgMTAwXTsKICAgICAgICAgIF90aGlzNi5YVyA9IHdoaXRlUG9pbnRbMF07CiAgICAgICAgICBfdGhpczYuWVcgPSB3aGl0ZVBvaW50WzFdOwogICAgICAgICAgX3RoaXM2LlpXID0gd2hpdGVQb2ludFsyXTsKICAgICAgICAgIF90aGlzNi5hbWluID0gcmFuZ2VbMF07CiAgICAgICAgICBfdGhpczYuYW1heCA9IHJhbmdlWzFdOwogICAgICAgICAgX3RoaXM2LmJtaW4gPSByYW5nZVsyXTsKICAgICAgICAgIF90aGlzNi5ibWF4ID0gcmFuZ2VbM107CiAgICAgICAgICBfdGhpczYuWEIgPSBibGFja1BvaW50WzBdOwogICAgICAgICAgX3RoaXM2LllCID0gYmxhY2tQb2ludFsxXTsKICAgICAgICAgIF90aGlzNi5aQiA9IGJsYWNrUG9pbnRbMl07CgogICAgICAgICAgaWYgKF90aGlzNi5YVyA8IDAgfHwgX3RoaXM2LlpXIDwgMCB8fCBfdGhpczYuWVcgIT09IDEpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJJbnZhbGlkIFdoaXRlUG9pbnQgY29tcG9uZW50cywgbm8gZmFsbGJhY2sgYXZhaWxhYmxlIik7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKF90aGlzNi5YQiA8IDAgfHwgX3RoaXM2LllCIDwgMCB8fCBfdGhpczYuWkIgPCAwKSB7CiAgICAgICAgICAgICgwLCBfdXRpbC5pbmZvKSgiSW52YWxpZCBCbGFja1BvaW50LCBmYWxsaW5nIGJhY2sgdG8gZGVmYXVsdCIpOwogICAgICAgICAgICBfdGhpczYuWEIgPSBfdGhpczYuWUIgPSBfdGhpczYuWkIgPSAwOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChfdGhpczYuYW1pbiA+IF90aGlzNi5hbWF4IHx8IF90aGlzNi5ibWluID4gX3RoaXM2LmJtYXgpIHsKICAgICAgICAgICAgKDAsIF91dGlsLmluZm8pKCJJbnZhbGlkIFJhbmdlLCBmYWxsaW5nIGJhY2sgdG8gZGVmYXVsdHMiKTsKICAgICAgICAgICAgX3RoaXM2LmFtaW4gPSAtMTAwOwogICAgICAgICAgICBfdGhpczYuYW1heCA9IDEwMDsKICAgICAgICAgICAgX3RoaXM2LmJtaW4gPSAtMTAwOwogICAgICAgICAgICBfdGhpczYuYm1heCA9IDEwMDsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gX3RoaXM2OwogICAgICAgIH0KCiAgICAgICAgX2NyZWF0ZUNsYXNzKExhYkNTLCBbewogICAgICAgICAga2V5OiAiZ2V0UmdiSXRlbSIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UmdiSXRlbShzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgICAgICAgICBjb252ZXJ0VG9SZ2IodGhpcywgc3JjLCBzcmNPZmZzZXQsIGZhbHNlLCBkZXN0LCBkZXN0T2Zmc2V0KTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJnZXRSZ2JCdWZmZXIiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldFJnYkJ1ZmZlcihzcmMsIHNyY09mZnNldCwgY291bnQsIGRlc3QsIGRlc3RPZmZzZXQsIGJpdHMsIGFscGhhMDEpIHsKICAgICAgICAgICAgdmFyIG1heFZhbCA9ICgxIDw8IGJpdHMpIC0gMTsKCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY291bnQ7IGkrKykgewogICAgICAgICAgICAgIGNvbnZlcnRUb1JnYih0aGlzLCBzcmMsIHNyY09mZnNldCwgbWF4VmFsLCBkZXN0LCBkZXN0T2Zmc2V0KTsKICAgICAgICAgICAgICBzcmNPZmZzZXQgKz0gMzsKICAgICAgICAgICAgICBkZXN0T2Zmc2V0ICs9IDMgKyBhbHBoYTAxOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAiZ2V0T3V0cHV0TGVuZ3RoIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRPdXRwdXRMZW5ndGgoaW5wdXRMZW5ndGgsIGFscGhhMDEpIHsKICAgICAgICAgICAgcmV0dXJuIGlucHV0TGVuZ3RoICogKDMgKyBhbHBoYTAxKSAvIDMgfCAwOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogImlzRGVmYXVsdERlY29kZSIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaXNEZWZhdWx0RGVjb2RlKGRlY29kZU1hcCwgYnBjKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogInVzZXNaZXJvVG9PbmVSYW5nZSIsCiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJ1c2VzWmVyb1RvT25lUmFuZ2UiLCBmYWxzZSk7CiAgICAgICAgICB9CiAgICAgICAgfV0pOwoKICAgICAgICByZXR1cm4gTGFiQ1M7CiAgICAgIH0oQ29sb3JTcGFjZSk7CgogICAgICByZXR1cm4gTGFiQ1M7CiAgICB9KCk7CgogICAgLyoqKi99KSwgKAogIC8qIDIxMyAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCgogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICB2YWx1ZTogdHJ1ZQogICAgfSk7CiAgICBleHBvcnRzLmdldFF1YWRQb2ludHMgPSBnZXRRdWFkUG9pbnRzOwogICAgZXhwb3J0cy5NYXJrdXBBbm5vdGF0aW9uID0gZXhwb3J0cy5Bbm5vdGF0aW9uRmFjdG9yeSA9IGV4cG9ydHMuQW5ub3RhdGlvbkJvcmRlclN0eWxlID0gZXhwb3J0cy5Bbm5vdGF0aW9uID0gdm9pZCAwOwoKICAgIHZhciBfdXRpbCA9IF9fd19wZGZqc19yZXF1aXJlX18oNSk7CgogICAgdmFyIF9vYmogPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE5OSk7CgogICAgdmFyIF9wcmltaXRpdmVzID0gX193X3BkZmpzX3JlcXVpcmVfXygxOTQpOwoKICAgIHZhciBfY29sb3JzcGFjZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjEyKTsKCiAgICB2YXIgX2NvcmVfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE5Nyk7CgogICAgdmFyIF9vcGVyYXRvcl9saXN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygyMTQpOwoKICAgIHZhciBfc3RyZWFtID0gX193X3BkZmpzX3JlcXVpcmVfXygyMDEpOwoKICAgIGZ1bmN0aW9uIF9nZXQodGFyZ2V0LCBwcm9wZXJ0eSwgcmVjZWl2ZXIpIHtpZiAodHlwZW9mIFJlZmxlY3QgIT09ICJ1bmRlZmluZWQiICYmIFJlZmxlY3QuZ2V0KSB7X2dldCA9IFJlZmxlY3QuZ2V0O30gZWxzZSB7X2dldCA9IGZ1bmN0aW9uIF9nZXQodGFyZ2V0LCBwcm9wZXJ0eSwgcmVjZWl2ZXIpIHt2YXIgYmFzZSA9IF9zdXBlclByb3BCYXNlKHRhcmdldCwgcHJvcGVydHkpO2lmICghYmFzZSkgcmV0dXJuO3ZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihiYXNlLCBwcm9wZXJ0eSk7aWYgKGRlc2MuZ2V0KSB7cmV0dXJuIGRlc2MuZ2V0LmNhbGwocmVjZWl2ZXIpO31yZXR1cm4gZGVzYy52YWx1ZTt9O31yZXR1cm4gX2dldCh0YXJnZXQsIHByb3BlcnR5LCByZWNlaXZlciB8fCB0YXJnZXQpO30KCiAgICBmdW5jdGlvbiBfc3VwZXJQcm9wQmFzZShvYmplY3QsIHByb3BlcnR5KSB7d2hpbGUgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSkpIHtvYmplY3QgPSBfZ2V0UHJvdG90eXBlT2Yob2JqZWN0KTtpZiAob2JqZWN0ID09PSBudWxsKSBicmVhazt9cmV0dXJuIG9iamVjdDt9CgogICAgZnVuY3Rpb24gX3R5cGVvZihvYmopIHsiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2YiO2lmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7X3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7cmV0dXJuIHR5cGVvZiBvYmo7fTt9IGVsc2Uge190eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikge3JldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmo7fTt9cmV0dXJuIF90eXBlb2Yob2JqKTt9CgogICAgZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkge2lmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHtyZXR1cm4gY2FsbDt9cmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7fQoKICAgIGZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikge2lmIChzZWxmID09PSB2b2lkIDApIHt0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpO31yZXR1cm4gc2VsZjt9CgogICAgZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHtfZ2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3QuZ2V0UHJvdG90eXBlT2YgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2Yobykge3JldHVybiBvLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2Yobyk7fTtyZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pO30KCiAgICBmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHtpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkge3Rocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7fXN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTtpZiAoc3VwZXJDbGFzcykgX3NldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKTt9CgogICAgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHtfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHtvLl9fcHJvdG9fXyA9IHA7cmV0dXJuIG87fTtyZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApO30KCiAgICBmdW5jdGlvbiBfc2xpY2VkVG9BcnJheShhcnIsIGkpIHtyZXR1cm4gX2FycmF5V2l0aEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgfHwgX25vbkl0ZXJhYmxlUmVzdCgpO30KCiAgICBmdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0KCkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UiKTt9CgogICAgZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkge2lmICghKFN5bWJvbC5pdGVyYXRvciBpbiBPYmplY3QoYXJyKSB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYXJyKSA9PT0gIltvYmplY3QgQXJndW1lbnRzXSIpKSB7cmV0dXJuO312YXIgX2FyciA9IFtdO3ZhciBfbiA9IHRydWU7dmFyIF9kID0gZmFsc2U7dmFyIF9lID0gdW5kZWZpbmVkO3RyeSB7Zm9yICh2YXIgX2kgPSBhcnJbU3ltYm9sLml0ZXJhdG9yXSgpLCBfczsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkge19hcnIucHVzaChfcy52YWx1ZSk7aWYgKGkgJiYgX2Fyci5sZW5ndGggPT09IGkpIGJyZWFrO319IGNhdGNoIChlcnIpIHtfZCA9IHRydWU7X2UgPSBlcnI7fSBmaW5hbGx5IHt0cnkge2lmICghX24gJiYgX2lbInJldHVybiJdICE9IG51bGwpIF9pWyJyZXR1cm4iXSgpO30gZmluYWxseSB7aWYgKF9kKSB0aHJvdyBfZTt9fXJldHVybiBfYXJyO30KCiAgICBmdW5jdGlvbiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB7aWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjt9CgogICAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3Rvcikge2lmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7fX0KCiAgICBmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7Zm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykge3ZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07ZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlO2Rlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTtpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTtPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7fX0KCiAgICBmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7aWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7aWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpO3JldHVybiBDb25zdHJ1Y3Rvcjt9CgogICAgdmFyIEFubm90YXRpb25GYWN0b3J5ID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gQW5ub3RhdGlvbkZhY3RvcnkoKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEFubm90YXRpb25GYWN0b3J5KTsKICAgICAgfQoKICAgICAgX2NyZWF0ZUNsYXNzKEFubm90YXRpb25GYWN0b3J5LCBudWxsLCBbewogICAgICAgIGtleTogImNyZWF0ZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZSh4cmVmLCByZWYsIHBkZk1hbmFnZXIsIGlkRmFjdG9yeSkgewogICAgICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZW5zdXJlKHRoaXMsICJfY3JlYXRlIiwgW3hyZWYsIHJlZiwgcGRmTWFuYWdlciwgaWRGYWN0b3J5XSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiX2NyZWF0ZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9jcmVhdGUoeHJlZiwgcmVmLCBwZGZNYW5hZ2VyLCBpZEZhY3RvcnkpIHsKICAgICAgICAgIHZhciBkaWN0ID0geHJlZi5mZXRjaElmUmVmKHJlZik7CgogICAgICAgICAgaWYgKCEoMCwgX3ByaW1pdGl2ZXMuaXNEaWN0KShkaWN0KSkgewogICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBpZCA9ICgwLCBfcHJpbWl0aXZlcy5pc1JlZikocmVmKSA/IHJlZi50b1N0cmluZygpIDogImFubm90XyIuY29uY2F0KGlkRmFjdG9yeS5jcmVhdGVPYmpJZCgpKTsKICAgICAgICAgIHZhciBzdWJ0eXBlID0gZGljdC5nZXQoIlN1YnR5cGUiKTsKICAgICAgICAgIHN1YnR5cGUgPSAoMCwgX3ByaW1pdGl2ZXMuaXNOYW1lKShzdWJ0eXBlKSA/IHN1YnR5cGUubmFtZSA6IG51bGw7CiAgICAgICAgICB2YXIgcGFyYW1ldGVycyA9IHsKICAgICAgICAgICAgeHJlZjogeHJlZiwKICAgICAgICAgICAgZGljdDogZGljdCwKICAgICAgICAgICAgc3VidHlwZTogc3VidHlwZSwKICAgICAgICAgICAgaWQ6IGlkLAogICAgICAgICAgICBwZGZNYW5hZ2VyOiBwZGZNYW5hZ2VyCiAgICAgICAgICB9OwoKICAgICAgICAgIHN3aXRjaCAoc3VidHlwZSkgewogICAgICAgICAgICBjYXNlICJMaW5rIjoKICAgICAgICAgICAgICByZXR1cm4gbmV3IExpbmtBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwoKICAgICAgICAgICAgY2FzZSAiVGV4dCI6CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBUZXh0QW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKCiAgICAgICAgICAgIGNhc2UgIldpZGdldCI6CiAgICAgICAgICAgICAgdmFyIGZpZWxkVHlwZSA9ICgwLCBfY29yZV91dGlscy5nZXRJbmhlcml0YWJsZVByb3BlcnR5KSh7CiAgICAgICAgICAgICAgICBkaWN0OiBkaWN0LAogICAgICAgICAgICAgICAga2V5OiAiRlQiCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgZmllbGRUeXBlID0gKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkoZmllbGRUeXBlKSA/IGZpZWxkVHlwZS5uYW1lIDogbnVsbDsKCiAgICAgICAgICAgICAgc3dpdGNoIChmaWVsZFR5cGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgIlR4IjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBUZXh0V2lkZ2V0QW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKCiAgICAgICAgICAgICAgICBjYXNlICJCdG4iOgogICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEJ1dHRvbldpZGdldEFubm90YXRpb24ocGFyYW1ldGVycyk7CgogICAgICAgICAgICAgICAgY2FzZSAiQ2giOgogICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IENob2ljZVdpZGdldEFubm90YXRpb24ocGFyYW1ldGVycyk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoJ1VuaW1wbGVtZW50ZWQgd2lkZ2V0IGZpZWxkIHR5cGUgIicgKyBmaWVsZFR5cGUgKyAnIiwgJyArICJmYWxsaW5nIGJhY2sgdG8gYmFzZSBmaWVsZCB0eXBlLiIpOwogICAgICAgICAgICAgIHJldHVybiBuZXcgV2lkZ2V0QW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKCiAgICAgICAgICAgIGNhc2UgIlBvcHVwIjoKICAgICAgICAgICAgICByZXR1cm4gbmV3IFBvcHVwQW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKCiAgICAgICAgICAgIGNhc2UgIkZyZWVUZXh0IjoKICAgICAgICAgICAgICByZXR1cm4gbmV3IEZyZWVUZXh0QW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKCiAgICAgICAgICAgIGNhc2UgIkxpbmUiOgogICAgICAgICAgICAgIHJldHVybiBuZXcgTGluZUFubm90YXRpb24ocGFyYW1ldGVycyk7CgogICAgICAgICAgICBjYXNlICJTcXVhcmUiOgogICAgICAgICAgICAgIHJldHVybiBuZXcgU3F1YXJlQW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKCiAgICAgICAgICAgIGNhc2UgIkNpcmNsZSI6CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBDaXJjbGVBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwoKICAgICAgICAgICAgY2FzZSAiUG9seUxpbmUiOgogICAgICAgICAgICAgIHJldHVybiBuZXcgUG9seWxpbmVBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwoKICAgICAgICAgICAgY2FzZSAiUG9seWdvbiI6CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQb2x5Z29uQW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKCiAgICAgICAgICAgIGNhc2UgIkNhcmV0IjoKICAgICAgICAgICAgICByZXR1cm4gbmV3IENhcmV0QW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKCiAgICAgICAgICAgIGNhc2UgIkluayI6CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBJbmtBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwoKICAgICAgICAgICAgY2FzZSAiSGlnaGxpZ2h0IjoKICAgICAgICAgICAgICByZXR1cm4gbmV3IEhpZ2hsaWdodEFubm90YXRpb24ocGFyYW1ldGVycyk7CgogICAgICAgICAgICBjYXNlICJVbmRlcmxpbmUiOgogICAgICAgICAgICAgIHJldHVybiBuZXcgVW5kZXJsaW5lQW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKCiAgICAgICAgICAgIGNhc2UgIlNxdWlnZ2x5IjoKICAgICAgICAgICAgICByZXR1cm4gbmV3IFNxdWlnZ2x5QW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKCiAgICAgICAgICAgIGNhc2UgIlN0cmlrZU91dCI6CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTdHJpa2VPdXRBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwoKICAgICAgICAgICAgY2FzZSAiU3RhbXAiOgogICAgICAgICAgICAgIHJldHVybiBuZXcgU3RhbXBBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwoKICAgICAgICAgICAgY2FzZSAiRmlsZUF0dGFjaG1lbnQiOgogICAgICAgICAgICAgIHJldHVybiBuZXcgRmlsZUF0dGFjaG1lbnRBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICBpZiAoIXN1YnR5cGUpIHsKICAgICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiQW5ub3RhdGlvbiBpcyBtaXNzaW5nIHRoZSByZXF1aXJlZCAvU3VidHlwZS4iKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCdVbmltcGxlbWVudGVkIGFubm90YXRpb24gdHlwZSAiJyArIHN1YnR5cGUgKyAnIiwgJyArICJmYWxsaW5nIGJhY2sgdG8gYmFzZSBhbm5vdGF0aW9uLiIpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIEFubm90YXRpb25GYWN0b3J5OwogICAgfSgpOwoKICAgIGV4cG9ydHMuQW5ub3RhdGlvbkZhY3RvcnkgPSBBbm5vdGF0aW9uRmFjdG9yeTsKCiAgICBmdW5jdGlvbiBnZXRRdWFkUG9pbnRzKGRpY3QsIHJlY3QpIHsKICAgICAgaWYgKCFkaWN0LmhhcygiUXVhZFBvaW50cyIpKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIHZhciBxdWFkUG9pbnRzID0gZGljdC5nZXRBcnJheSgiUXVhZFBvaW50cyIpOwoKICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHF1YWRQb2ludHMpIHx8IHF1YWRQb2ludHMubGVuZ3RoICUgOCA+IDApIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgdmFyIHF1YWRQb2ludHNMaXN0cyA9IFtdOwoKICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gcXVhZFBvaW50cy5sZW5ndGggLyA4OyBpIDwgaWk7IGkrKykgewogICAgICAgIHF1YWRQb2ludHNMaXN0cy5wdXNoKFtdKTsKCiAgICAgICAgZm9yICh2YXIgaiA9IGkgKiA4LCBqaiA9IGkgKiA4ICsgODsgaiA8IGpqOyBqICs9IDIpIHsKICAgICAgICAgIHZhciB4ID0gcXVhZFBvaW50c1tqXTsKICAgICAgICAgIHZhciB5ID0gcXVhZFBvaW50c1tqICsgMV07CgogICAgICAgICAgaWYgKHggPCByZWN0WzBdIHx8IHggPiByZWN0WzJdIHx8IHkgPCByZWN0WzFdIHx8IHkgPiByZWN0WzNdKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQoKICAgICAgICAgIHF1YWRQb2ludHNMaXN0c1tpXS5wdXNoKHsKICAgICAgICAgICAgeDogeCwKICAgICAgICAgICAgeTogeQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gcXVhZFBvaW50c0xpc3RzOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFRyYW5zZm9ybU1hdHJpeChyZWN0LCBiYm94LCBtYXRyaXgpIHsKICAgICAgdmFyIF9VdGlsJGdldEF4aWFsQWxpZ25lZCA9IF91dGlsLlV0aWwuZ2V0QXhpYWxBbGlnbmVkQm91bmRpbmdCb3goYmJveCwgbWF0cml4KSwKICAgICAgICBfVXRpbCRnZXRBeGlhbEFsaWduZWQyID0gX3NsaWNlZFRvQXJyYXkoX1V0aWwkZ2V0QXhpYWxBbGlnbmVkLCA0KSwKICAgICAgICBtaW5YID0gX1V0aWwkZ2V0QXhpYWxBbGlnbmVkMlswXSwKICAgICAgICBtaW5ZID0gX1V0aWwkZ2V0QXhpYWxBbGlnbmVkMlsxXSwKICAgICAgICBtYXhYID0gX1V0aWwkZ2V0QXhpYWxBbGlnbmVkMlsyXSwKICAgICAgICBtYXhZID0gX1V0aWwkZ2V0QXhpYWxBbGlnbmVkMlszXTsKCiAgICAgIGlmIChtaW5YID09PSBtYXhYIHx8IG1pblkgPT09IG1heFkpIHsKICAgICAgICByZXR1cm4gWzEsIDAsIDAsIDEsIHJlY3RbMF0sIHJlY3RbMV1dOwogICAgICB9CgogICAgICB2YXIgeFJhdGlvID0gKHJlY3RbMl0gLSByZWN0WzBdKSAvIChtYXhYIC0gbWluWCk7CiAgICAgIHZhciB5UmF0aW8gPSAocmVjdFszXSAtIHJlY3RbMV0pIC8gKG1heFkgLSBtaW5ZKTsKICAgICAgcmV0dXJuIFt4UmF0aW8sIDAsIDAsIHlSYXRpbywgcmVjdFswXSAtIG1pblggKiB4UmF0aW8sIHJlY3RbMV0gLSBtaW5ZICogeVJhdGlvXTsKICAgIH0KCiAgICB2YXIgQW5ub3RhdGlvbiA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgIGZ1bmN0aW9uIEFubm90YXRpb24ocGFyYW1zKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEFubm90YXRpb24pOwoKICAgICAgICB2YXIgZGljdCA9IHBhcmFtcy5kaWN0OwogICAgICAgIHRoaXMuc2V0Q29udGVudHMoZGljdC5nZXQoIkNvbnRlbnRzIikpOwogICAgICAgIHRoaXMuc2V0TW9kaWZpY2F0aW9uRGF0ZShkaWN0LmdldCgiTSIpKTsKICAgICAgICB0aGlzLnNldEZsYWdzKGRpY3QuZ2V0KCJGIikpOwogICAgICAgIHRoaXMuc2V0UmVjdGFuZ2xlKGRpY3QuZ2V0QXJyYXkoIlJlY3QiKSk7CiAgICAgICAgdGhpcy5zZXRDb2xvcihkaWN0LmdldEFycmF5KCJDIikpOwogICAgICAgIHRoaXMuc2V0Qm9yZGVyU3R5bGUoZGljdCk7CiAgICAgICAgdGhpcy5zZXRBcHBlYXJhbmNlKGRpY3QpOwogICAgICAgIHRoaXMuZGF0YSA9IHsKICAgICAgICAgIGFubm90YXRpb25GbGFnczogdGhpcy5mbGFncywKICAgICAgICAgIGJvcmRlclN0eWxlOiB0aGlzLmJvcmRlclN0eWxlLAogICAgICAgICAgY29sb3I6IHRoaXMuY29sb3IsCiAgICAgICAgICBjb250ZW50czogdGhpcy5jb250ZW50cywKICAgICAgICAgIGhhc0FwcGVhcmFuY2U6ICEhdGhpcy5hcHBlYXJhbmNlLAogICAgICAgICAgaWQ6IHBhcmFtcy5pZCwKICAgICAgICAgIG1vZGlmaWNhdGlvbkRhdGU6IHRoaXMubW9kaWZpY2F0aW9uRGF0ZSwKICAgICAgICAgIHJlY3Q6IHRoaXMucmVjdGFuZ2xlLAogICAgICAgICAgc3VidHlwZTogcGFyYW1zLnN1YnR5cGUKICAgICAgICB9OwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoQW5ub3RhdGlvbiwgW3sKICAgICAgICBrZXk6ICJfaGFzRmxhZyIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9oYXNGbGFnKGZsYWdzLCBmbGFnKSB7CiAgICAgICAgICByZXR1cm4gISEoZmxhZ3MgJiBmbGFnKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJfaXNWaWV3YWJsZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9pc1ZpZXdhYmxlKGZsYWdzKSB7CiAgICAgICAgICByZXR1cm4gIXRoaXMuX2hhc0ZsYWcoZmxhZ3MsIF91dGlsLkFubm90YXRpb25GbGFnLklOVklTSUJMRSkgJiYgIXRoaXMuX2hhc0ZsYWcoZmxhZ3MsIF91dGlsLkFubm90YXRpb25GbGFnLkhJRERFTikgJiYgIXRoaXMuX2hhc0ZsYWcoZmxhZ3MsIF91dGlsLkFubm90YXRpb25GbGFnLk5PVklFVyk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiX2lzUHJpbnRhYmxlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX2lzUHJpbnRhYmxlKGZsYWdzKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5faGFzRmxhZyhmbGFncywgX3V0aWwuQW5ub3RhdGlvbkZsYWcuUFJJTlQpICYmICF0aGlzLl9oYXNGbGFnKGZsYWdzLCBfdXRpbC5Bbm5vdGF0aW9uRmxhZy5JTlZJU0lCTEUpICYmICF0aGlzLl9oYXNGbGFnKGZsYWdzLCBfdXRpbC5Bbm5vdGF0aW9uRmxhZy5ISURERU4pOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInNldENvbnRlbnRzIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gc2V0Q29udGVudHMoY29udGVudHMpIHsKICAgICAgICAgIHRoaXMuY29udGVudHMgPSAoMCwgX3V0aWwuc3RyaW5nVG9QREZTdHJpbmcpKGNvbnRlbnRzIHx8ICIiKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJzZXRNb2RpZmljYXRpb25EYXRlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gc2V0TW9kaWZpY2F0aW9uRGF0ZShtb2RpZmljYXRpb25EYXRlKSB7CiAgICAgICAgICB0aGlzLm1vZGlmaWNhdGlvbkRhdGUgPSAoMCwgX3V0aWwuaXNTdHJpbmcpKG1vZGlmaWNhdGlvbkRhdGUpID8gbW9kaWZpY2F0aW9uRGF0ZSA6IG51bGw7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAic2V0RmxhZ3MiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRGbGFncyhmbGFncykgewogICAgICAgICAgdGhpcy5mbGFncyA9IE51bWJlci5pc0ludGVnZXIoZmxhZ3MpICYmIGZsYWdzID4gMCA/IGZsYWdzIDogMDsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJoYXNGbGFnIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaGFzRmxhZyhmbGFnKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5faGFzRmxhZyh0aGlzLmZsYWdzLCBmbGFnKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJzZXRSZWN0YW5nbGUiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRSZWN0YW5nbGUocmVjdGFuZ2xlKSB7CiAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShyZWN0YW5nbGUpICYmIHJlY3RhbmdsZS5sZW5ndGggPT09IDQpIHsKICAgICAgICAgICAgdGhpcy5yZWN0YW5nbGUgPSBfdXRpbC5VdGlsLm5vcm1hbGl6ZVJlY3QocmVjdGFuZ2xlKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMucmVjdGFuZ2xlID0gWzAsIDAsIDAsIDBdOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInNldENvbG9yIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gc2V0Q29sb3IoY29sb3IpIHsKICAgICAgICAgIHZhciByZ2JDb2xvciA9IG5ldyBVaW50OENsYW1wZWRBcnJheSgzKTsKCiAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoY29sb3IpKSB7CiAgICAgICAgICAgIHRoaXMuY29sb3IgPSByZ2JDb2xvcjsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHN3aXRjaCAoY29sb3IubGVuZ3RoKSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICB0aGlzLmNvbG9yID0gbnVsbDsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICBfY29sb3JzcGFjZS5Db2xvclNwYWNlLnNpbmdsZXRvbnMuZ3JheS5nZXRSZ2JJdGVtKGNvbG9yLCAwLCByZ2JDb2xvciwgMCk7CgogICAgICAgICAgICAgIHRoaXMuY29sb3IgPSByZ2JDb2xvcjsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICBfY29sb3JzcGFjZS5Db2xvclNwYWNlLnNpbmdsZXRvbnMucmdiLmdldFJnYkl0ZW0oY29sb3IsIDAsIHJnYkNvbG9yLCAwKTsKCiAgICAgICAgICAgICAgdGhpcy5jb2xvciA9IHJnYkNvbG9yOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIF9jb2xvcnNwYWNlLkNvbG9yU3BhY2Uuc2luZ2xldG9ucy5jbXlrLmdldFJnYkl0ZW0oY29sb3IsIDAsIHJnYkNvbG9yLCAwKTsKCiAgICAgICAgICAgICAgdGhpcy5jb2xvciA9IHJnYkNvbG9yOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICB0aGlzLmNvbG9yID0gcmdiQ29sb3I7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAic2V0Qm9yZGVyU3R5bGUiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRCb3JkZXJTdHlsZShib3JkZXJTdHlsZSkgewogICAgICAgICAgdGhpcy5ib3JkZXJTdHlsZSA9IG5ldyBBbm5vdGF0aW9uQm9yZGVyU3R5bGUoKTsKCiAgICAgICAgICBpZiAoISgwLCBfcHJpbWl0aXZlcy5pc0RpY3QpKGJvcmRlclN0eWxlKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGJvcmRlclN0eWxlLmhhcygiQlMiKSkgewogICAgICAgICAgICB2YXIgZGljdCA9IGJvcmRlclN0eWxlLmdldCgiQlMiKTsKICAgICAgICAgICAgdmFyIGRpY3RUeXBlID0gZGljdC5nZXQoIlR5cGUiKTsKCiAgICAgICAgICAgIGlmICghZGljdFR5cGUgfHwgKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkoZGljdFR5cGUsICJCb3JkZXIiKSkgewogICAgICAgICAgICAgIHRoaXMuYm9yZGVyU3R5bGUuc2V0V2lkdGgoZGljdC5nZXQoIlciKSwgdGhpcy5yZWN0YW5nbGUpOwogICAgICAgICAgICAgIHRoaXMuYm9yZGVyU3R5bGUuc2V0U3R5bGUoZGljdC5nZXQoIlMiKSk7CiAgICAgICAgICAgICAgdGhpcy5ib3JkZXJTdHlsZS5zZXREYXNoQXJyYXkoZGljdC5nZXRBcnJheSgiRCIpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIGlmIChib3JkZXJTdHlsZS5oYXMoIkJvcmRlciIpKSB7CiAgICAgICAgICAgIHZhciBhcnJheSA9IGJvcmRlclN0eWxlLmdldEFycmF5KCJCb3JkZXIiKTsKCiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGFycmF5KSAmJiBhcnJheS5sZW5ndGggPj0gMykgewogICAgICAgICAgICAgIHRoaXMuYm9yZGVyU3R5bGUuc2V0SG9yaXpvbnRhbENvcm5lclJhZGl1cyhhcnJheVswXSk7CiAgICAgICAgICAgICAgdGhpcy5ib3JkZXJTdHlsZS5zZXRWZXJ0aWNhbENvcm5lclJhZGl1cyhhcnJheVsxXSk7CiAgICAgICAgICAgICAgdGhpcy5ib3JkZXJTdHlsZS5zZXRXaWR0aChhcnJheVsyXSwgdGhpcy5yZWN0YW5nbGUpOwoKICAgICAgICAgICAgICBpZiAoYXJyYXkubGVuZ3RoID09PSA0KSB7CiAgICAgICAgICAgICAgICB0aGlzLmJvcmRlclN0eWxlLnNldERhc2hBcnJheShhcnJheVszXSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmJvcmRlclN0eWxlLnNldFdpZHRoKDApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInNldEFwcGVhcmFuY2UiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRBcHBlYXJhbmNlKGRpY3QpIHsKICAgICAgICAgIHRoaXMuYXBwZWFyYW5jZSA9IG51bGw7CiAgICAgICAgICB2YXIgYXBwZWFyYW5jZVN0YXRlcyA9IGRpY3QuZ2V0KCJBUCIpOwoKICAgICAgICAgIGlmICghKDAsIF9wcmltaXRpdmVzLmlzRGljdCkoYXBwZWFyYW5jZVN0YXRlcykpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBub3JtYWxBcHBlYXJhbmNlU3RhdGUgPSBhcHBlYXJhbmNlU3RhdGVzLmdldCgiTiIpOwoKICAgICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNTdHJlYW0pKG5vcm1hbEFwcGVhcmFuY2VTdGF0ZSkpIHsKICAgICAgICAgICAgdGhpcy5hcHBlYXJhbmNlID0gbm9ybWFsQXBwZWFyYW5jZVN0YXRlOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCEoMCwgX3ByaW1pdGl2ZXMuaXNEaWN0KShub3JtYWxBcHBlYXJhbmNlU3RhdGUpKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgYXMgPSBkaWN0LmdldCgiQVMiKTsKCiAgICAgICAgICBpZiAoISgwLCBfcHJpbWl0aXZlcy5pc05hbWUpKGFzKSB8fCAhbm9ybWFsQXBwZWFyYW5jZVN0YXRlLmhhcyhhcy5uYW1lKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5hcHBlYXJhbmNlID0gbm9ybWFsQXBwZWFyYW5jZVN0YXRlLmdldChhcy5uYW1lKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJsb2FkUmVzb3VyY2VzIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gbG9hZFJlc291cmNlcyhrZXlzKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5hcHBlYXJhbmNlLmRpY3QuZ2V0QXN5bmMoIlJlc291cmNlcyIpLnRoZW4oZnVuY3Rpb24gKHJlc291cmNlcykgewogICAgICAgICAgICBpZiAoIXJlc291cmNlcykgewogICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBvYmplY3RMb2FkZXIgPSBuZXcgX29iai5PYmplY3RMb2FkZXIocmVzb3VyY2VzLCBrZXlzLCByZXNvdXJjZXMueHJlZik7CiAgICAgICAgICAgIHJldHVybiBvYmplY3RMb2FkZXIubG9hZCgpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiByZXNvdXJjZXM7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0T3BlcmF0b3JMaXN0IiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0T3BlcmF0b3JMaXN0KGV2YWx1YXRvciwgdGFzaywgcmVuZGVyRm9ybXMpIHsKICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAgICAgaWYgKCF0aGlzLmFwcGVhcmFuY2UpIHsKICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShuZXcgX29wZXJhdG9yX2xpc3QuT3BlcmF0b3JMaXN0KCkpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBkYXRhID0gdGhpcy5kYXRhOwogICAgICAgICAgdmFyIGFwcGVhcmFuY2VEaWN0ID0gdGhpcy5hcHBlYXJhbmNlLmRpY3Q7CiAgICAgICAgICB2YXIgcmVzb3VyY2VzUHJvbWlzZSA9IHRoaXMubG9hZFJlc291cmNlcyhbIkV4dEdTdGF0ZSIsICJDb2xvclNwYWNlIiwgIlBhdHRlcm4iLCAiU2hhZGluZyIsICJYT2JqZWN0IiwgIkZvbnQiXSk7CiAgICAgICAgICB2YXIgYmJveCA9IGFwcGVhcmFuY2VEaWN0LmdldEFycmF5KCJCQm94IikgfHwgWzAsIDAsIDEsIDFdOwogICAgICAgICAgdmFyIG1hdHJpeCA9IGFwcGVhcmFuY2VEaWN0LmdldEFycmF5KCJNYXRyaXgiKSB8fCBbMSwgMCwgMCwgMSwgMCwgMF07CiAgICAgICAgICB2YXIgdHJhbnNmb3JtID0gZ2V0VHJhbnNmb3JtTWF0cml4KGRhdGEucmVjdCwgYmJveCwgbWF0cml4KTsKICAgICAgICAgIHJldHVybiByZXNvdXJjZXNQcm9taXNlLnRoZW4oZnVuY3Rpb24gKHJlc291cmNlcykgewogICAgICAgICAgICB2YXIgb3BMaXN0ID0gbmV3IF9vcGVyYXRvcl9saXN0Lk9wZXJhdG9yTGlzdCgpOwogICAgICAgICAgICBvcExpc3QuYWRkT3AoX3V0aWwuT1BTLmJlZ2luQW5ub3RhdGlvbiwgW2RhdGEucmVjdCwgdHJhbnNmb3JtLCBtYXRyaXhdKTsKICAgICAgICAgICAgcmV0dXJuIGV2YWx1YXRvci5nZXRPcGVyYXRvckxpc3QoewogICAgICAgICAgICAgIHN0cmVhbTogX3RoaXMuYXBwZWFyYW5jZSwKICAgICAgICAgICAgICB0YXNrOiB0YXNrLAogICAgICAgICAgICAgIHJlc291cmNlczogcmVzb3VyY2VzLAogICAgICAgICAgICAgIG9wZXJhdG9yTGlzdDogb3BMaXN0CiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIG9wTGlzdC5hZGRPcChfdXRpbC5PUFMuZW5kQW5ub3RhdGlvbiwgW10pOwoKICAgICAgICAgICAgICBfdGhpcy5hcHBlYXJhbmNlLnJlc2V0KCk7CgogICAgICAgICAgICAgIHJldHVybiBvcExpc3Q7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAidmlld2FibGUiLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgaWYgKHRoaXMuZmxhZ3MgPT09IDApIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHRoaXMuX2lzVmlld2FibGUodGhpcy5mbGFncyk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAicHJpbnRhYmxlIiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIGlmICh0aGlzLmZsYWdzID09PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gdGhpcy5faXNQcmludGFibGUodGhpcy5mbGFncyk7CiAgICAgICAgfQogICAgICB9XSk7CgogICAgICByZXR1cm4gQW5ub3RhdGlvbjsKICAgIH0oKTsKCiAgICBleHBvcnRzLkFubm90YXRpb24gPSBBbm5vdGF0aW9uOwoKICAgIHZhciBBbm5vdGF0aW9uQm9yZGVyU3R5bGUgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBBbm5vdGF0aW9uQm9yZGVyU3R5bGUoKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEFubm90YXRpb25Cb3JkZXJTdHlsZSk7CgogICAgICAgIHRoaXMud2lkdGggPSAxOwogICAgICAgIHRoaXMuc3R5bGUgPSBfdXRpbC5Bbm5vdGF0aW9uQm9yZGVyU3R5bGVUeXBlLlNPTElEOwogICAgICAgIHRoaXMuZGFzaEFycmF5ID0gWzNdOwogICAgICAgIHRoaXMuaG9yaXpvbnRhbENvcm5lclJhZGl1cyA9IDA7CiAgICAgICAgdGhpcy52ZXJ0aWNhbENvcm5lclJhZGl1cyA9IDA7CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhBbm5vdGF0aW9uQm9yZGVyU3R5bGUsIFt7CiAgICAgICAga2V5OiAic2V0V2lkdGgiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRXaWR0aCh3aWR0aCkgewogICAgICAgICAgdmFyIHJlY3QgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IFswLCAwLCAwLCAwXTsKCiAgICAgICAgICBpZiAoKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkod2lkdGgpKSB7CiAgICAgICAgICAgIHRoaXMud2lkdGggPSAwOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIod2lkdGgpKSB7CiAgICAgICAgICAgIGlmICh3aWR0aCA+IDApIHsKICAgICAgICAgICAgICB2YXIgbWF4V2lkdGggPSAocmVjdFsyXSAtIHJlY3RbMF0pIC8gMjsKICAgICAgICAgICAgICB2YXIgbWF4SGVpZ2h0ID0gKHJlY3RbM10gLSByZWN0WzFdKSAvIDI7CgogICAgICAgICAgICAgIGlmIChtYXhXaWR0aCA+IDAgJiYgbWF4SGVpZ2h0ID4gMCAmJiAod2lkdGggPiBtYXhXaWR0aCB8fCB3aWR0aCA+IG1heEhlaWdodCkpIHsKICAgICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiQW5ub3RhdGlvbkJvcmRlclN0eWxlLnNldFdpZHRoIC0gaWdub3Jpbmcgd2lkdGg6ICIuY29uY2F0KHdpZHRoKSk7CiAgICAgICAgICAgICAgICB3aWR0aCA9IDE7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLndpZHRoID0gd2lkdGg7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAic2V0U3R5bGUiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRTdHlsZShzdHlsZSkgewogICAgICAgICAgaWYgKCEoMCwgX3ByaW1pdGl2ZXMuaXNOYW1lKShzdHlsZSkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHN3aXRjaCAoc3R5bGUubmFtZSkgewogICAgICAgICAgICBjYXNlICJTIjoKICAgICAgICAgICAgICB0aGlzLnN0eWxlID0gX3V0aWwuQW5ub3RhdGlvbkJvcmRlclN0eWxlVHlwZS5TT0xJRDsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgIkQiOgogICAgICAgICAgICAgIHRoaXMuc3R5bGUgPSBfdXRpbC5Bbm5vdGF0aW9uQm9yZGVyU3R5bGVUeXBlLkRBU0hFRDsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgIkIiOgogICAgICAgICAgICAgIHRoaXMuc3R5bGUgPSBfdXRpbC5Bbm5vdGF0aW9uQm9yZGVyU3R5bGVUeXBlLkJFVkVMRUQ7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICJJIjoKICAgICAgICAgICAgICB0aGlzLnN0eWxlID0gX3V0aWwuQW5ub3RhdGlvbkJvcmRlclN0eWxlVHlwZS5JTlNFVDsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgIlUiOgogICAgICAgICAgICAgIHRoaXMuc3R5bGUgPSBfdXRpbC5Bbm5vdGF0aW9uQm9yZGVyU3R5bGVUeXBlLlVOREVSTElORTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAic2V0RGFzaEFycmF5IiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gc2V0RGFzaEFycmF5KGRhc2hBcnJheSkgewogICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZGFzaEFycmF5KSAmJiBkYXNoQXJyYXkubGVuZ3RoID4gMCkgewogICAgICAgICAgICB2YXIgaXNWYWxpZCA9IHRydWU7CiAgICAgICAgICAgIHZhciBhbGxaZXJvcyA9IHRydWU7CiAgICAgICAgICAgIHZhciBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gdHJ1ZTsKICAgICAgICAgICAgdmFyIF9kaWRJdGVyYXRvckVycm9yID0gZmFsc2U7CiAgICAgICAgICAgIHZhciBfaXRlcmF0b3JFcnJvciA9IHVuZGVmaW5lZDsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgX2l0ZXJhdG9yID0gZGFzaEFycmF5W1N5bWJvbC5pdGVyYXRvcl0oKSwgX3N0ZXA7ICEoX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IChfc3RlcCA9IF9pdGVyYXRvci5uZXh0KCkpLmRvbmUpOyBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gdHJ1ZSkgewogICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBfc3RlcC52YWx1ZTsKICAgICAgICAgICAgICAgIHZhciB2YWxpZE51bWJlciA9ICtlbGVtZW50ID49IDA7CgogICAgICAgICAgICAgICAgaWYgKCF2YWxpZE51bWJlcikgewogICAgICAgICAgICAgICAgICBpc1ZhbGlkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlbGVtZW50ID4gMCkgewogICAgICAgICAgICAgICAgICBhbGxaZXJvcyA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgX2RpZEl0ZXJhdG9yRXJyb3IgPSB0cnVlOwogICAgICAgICAgICAgIF9pdGVyYXRvckVycm9yID0gZXJyOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gJiYgX2l0ZXJhdG9yWyJyZXR1cm4iXSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgIF9pdGVyYXRvclsicmV0dXJuIl0oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgaWYgKF9kaWRJdGVyYXRvckVycm9yKSB7CiAgICAgICAgICAgICAgICAgIHRocm93IF9pdGVyYXRvckVycm9yOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGlzVmFsaWQgJiYgIWFsbFplcm9zKSB7CiAgICAgICAgICAgICAgdGhpcy5kYXNoQXJyYXkgPSBkYXNoQXJyYXk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy53aWR0aCA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAoZGFzaEFycmF5KSB7CiAgICAgICAgICAgIHRoaXMud2lkdGggPSAwOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInNldEhvcml6b250YWxDb3JuZXJSYWRpdXMiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRIb3Jpem9udGFsQ29ybmVyUmFkaXVzKHJhZGl1cykgewogICAgICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIocmFkaXVzKSkgewogICAgICAgICAgICB0aGlzLmhvcml6b250YWxDb3JuZXJSYWRpdXMgPSByYWRpdXM7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAic2V0VmVydGljYWxDb3JuZXJSYWRpdXMiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRWZXJ0aWNhbENvcm5lclJhZGl1cyhyYWRpdXMpIHsKICAgICAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKHJhZGl1cykpIHsKICAgICAgICAgICAgdGhpcy52ZXJ0aWNhbENvcm5lclJhZGl1cyA9IHJhZGl1czsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBBbm5vdGF0aW9uQm9yZGVyU3R5bGU7CiAgICB9KCk7CgogICAgZXhwb3J0cy5Bbm5vdGF0aW9uQm9yZGVyU3R5bGUgPSBBbm5vdGF0aW9uQm9yZGVyU3R5bGU7CgogICAgdmFyIE1hcmt1cEFubm90YXRpb24gPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9Bbm5vdGF0aW9uKSB7CiAgICAgIF9pbmhlcml0cyhNYXJrdXBBbm5vdGF0aW9uLCBfQW5ub3RhdGlvbik7CgogICAgICBmdW5jdGlvbiBNYXJrdXBBbm5vdGF0aW9uKHBhcmFtZXRlcnMpIHsKICAgICAgICB2YXIgX3RoaXMyOwoKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgTWFya3VwQW5ub3RhdGlvbik7CgogICAgICAgIF90aGlzMiA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihNYXJrdXBBbm5vdGF0aW9uKS5jYWxsKHRoaXMsIHBhcmFtZXRlcnMpKTsKICAgICAgICB2YXIgZGljdCA9IHBhcmFtZXRlcnMuZGljdDsKCiAgICAgICAgaWYgKGRpY3QuaGFzKCJJUlQiKSkgewogICAgICAgICAgdmFyIHJhd0lSVCA9IGRpY3QuZ2V0UmF3KCJJUlQiKTsKICAgICAgICAgIF90aGlzMi5kYXRhLmluUmVwbHlUbyA9ICgwLCBfcHJpbWl0aXZlcy5pc1JlZikocmF3SVJUKSA/IHJhd0lSVC50b1N0cmluZygpIDogbnVsbDsKICAgICAgICAgIHZhciBydCA9IGRpY3QuZ2V0KCJSVCIpOwogICAgICAgICAgX3RoaXMyLmRhdGEucmVwbHlUeXBlID0gKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkocnQpID8gcnQubmFtZSA6IF91dGlsLkFubm90YXRpb25SZXBseVR5cGUuUkVQTFk7CiAgICAgICAgfQoKICAgICAgICBpZiAoX3RoaXMyLmRhdGEucmVwbHlUeXBlID09PSBfdXRpbC5Bbm5vdGF0aW9uUmVwbHlUeXBlLkdST1VQKSB7CiAgICAgICAgICB2YXIgcGFyZW50ID0gZGljdC5nZXQoIklSVCIpOwogICAgICAgICAgX3RoaXMyLmRhdGEudGl0bGUgPSAoMCwgX3V0aWwuc3RyaW5nVG9QREZTdHJpbmcpKHBhcmVudC5nZXQoIlQiKSB8fCAiIik7CgogICAgICAgICAgX3RoaXMyLnNldENvbnRlbnRzKHBhcmVudC5nZXQoIkNvbnRlbnRzIikpOwoKICAgICAgICAgIF90aGlzMi5kYXRhLmNvbnRlbnRzID0gX3RoaXMyLmNvbnRlbnRzOwoKICAgICAgICAgIGlmICghcGFyZW50LmhhcygiQ3JlYXRpb25EYXRlIikpIHsKICAgICAgICAgICAgX3RoaXMyLmRhdGEuY3JlYXRpb25EYXRlID0gbnVsbDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF90aGlzMi5zZXRDcmVhdGlvbkRhdGUocGFyZW50LmdldCgiQ3JlYXRpb25EYXRlIikpOwoKICAgICAgICAgICAgX3RoaXMyLmRhdGEuY3JlYXRpb25EYXRlID0gX3RoaXMyLmNyZWF0aW9uRGF0ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIXBhcmVudC5oYXMoIk0iKSkgewogICAgICAgICAgICBfdGhpczIuZGF0YS5tb2RpZmljYXRpb25EYXRlID0gbnVsbDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF90aGlzMi5zZXRNb2RpZmljYXRpb25EYXRlKHBhcmVudC5nZXQoIk0iKSk7CgogICAgICAgICAgICBfdGhpczIuZGF0YS5tb2RpZmljYXRpb25EYXRlID0gX3RoaXMyLm1vZGlmaWNhdGlvbkRhdGU7CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMyLmRhdGEuaGFzUG9wdXAgPSBwYXJlbnQuaGFzKCJQb3B1cCIpOwoKICAgICAgICAgIGlmICghcGFyZW50LmhhcygiQyIpKSB7CiAgICAgICAgICAgIF90aGlzMi5kYXRhLmNvbG9yID0gbnVsbDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF90aGlzMi5zZXRDb2xvcihwYXJlbnQuZ2V0QXJyYXkoIkMiKSk7CgogICAgICAgICAgICBfdGhpczIuZGF0YS5jb2xvciA9IF90aGlzMi5jb2xvcjsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgX3RoaXMyLmRhdGEudGl0bGUgPSAoMCwgX3V0aWwuc3RyaW5nVG9QREZTdHJpbmcpKGRpY3QuZ2V0KCJUIikgfHwgIiIpOwoKICAgICAgICAgIF90aGlzMi5zZXRDcmVhdGlvbkRhdGUoZGljdC5nZXQoIkNyZWF0aW9uRGF0ZSIpKTsKCiAgICAgICAgICBfdGhpczIuZGF0YS5jcmVhdGlvbkRhdGUgPSBfdGhpczIuY3JlYXRpb25EYXRlOwogICAgICAgICAgX3RoaXMyLmRhdGEuaGFzUG9wdXAgPSBkaWN0LmhhcygiUG9wdXAiKTsKCiAgICAgICAgICBpZiAoIWRpY3QuaGFzKCJDIikpIHsKICAgICAgICAgICAgX3RoaXMyLmRhdGEuY29sb3IgPSBudWxsOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIF90aGlzMjsKICAgICAgfQoKICAgICAgX2NyZWF0ZUNsYXNzKE1hcmt1cEFubm90YXRpb24sIFt7CiAgICAgICAga2V5OiAic2V0Q3JlYXRpb25EYXRlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gc2V0Q3JlYXRpb25EYXRlKGNyZWF0aW9uRGF0ZSkgewogICAgICAgICAgdGhpcy5jcmVhdGlvbkRhdGUgPSAoMCwgX3V0aWwuaXNTdHJpbmcpKGNyZWF0aW9uRGF0ZSkgPyBjcmVhdGlvbkRhdGUgOiBudWxsOwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIE1hcmt1cEFubm90YXRpb247CiAgICB9KEFubm90YXRpb24pOwoKICAgIGV4cG9ydHMuTWFya3VwQW5ub3RhdGlvbiA9IE1hcmt1cEFubm90YXRpb247CgogICAgdmFyIFdpZGdldEFubm90YXRpb24gPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9Bbm5vdGF0aW9uMikgewogICAgICBfaW5oZXJpdHMoV2lkZ2V0QW5ub3RhdGlvbiwgX0Fubm90YXRpb24yKTsKCiAgICAgIGZ1bmN0aW9uIFdpZGdldEFubm90YXRpb24ocGFyYW1zKSB7CiAgICAgICAgdmFyIF90aGlzMzsKCiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFdpZGdldEFubm90YXRpb24pOwoKICAgICAgICBfdGhpczMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoV2lkZ2V0QW5ub3RhdGlvbikuY2FsbCh0aGlzLCBwYXJhbXMpKTsKICAgICAgICB2YXIgZGljdCA9IHBhcmFtcy5kaWN0OwogICAgICAgIHZhciBkYXRhID0gX3RoaXMzLmRhdGE7CiAgICAgICAgZGF0YS5hbm5vdGF0aW9uVHlwZSA9IF91dGlsLkFubm90YXRpb25UeXBlLldJREdFVDsKICAgICAgICBkYXRhLmZpZWxkTmFtZSA9IF90aGlzMy5fY29uc3RydWN0RmllbGROYW1lKGRpY3QpOwogICAgICAgIGRhdGEuZmllbGRWYWx1ZSA9ICgwLCBfY29yZV91dGlscy5nZXRJbmhlcml0YWJsZVByb3BlcnR5KSh7CiAgICAgICAgICBkaWN0OiBkaWN0LAogICAgICAgICAga2V5OiAiViIsCiAgICAgICAgICBnZXRBcnJheTogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIGRhdGEuYWx0ZXJuYXRpdmVUZXh0ID0gKDAsIF91dGlsLnN0cmluZ1RvUERGU3RyaW5nKShkaWN0LmdldCgiVFUiKSB8fCAiIik7CiAgICAgICAgZGF0YS5kZWZhdWx0QXBwZWFyYW5jZSA9ICgwLCBfY29yZV91dGlscy5nZXRJbmhlcml0YWJsZVByb3BlcnR5KSh7CiAgICAgICAgICBkaWN0OiBkaWN0LAogICAgICAgICAga2V5OiAiREEiCiAgICAgICAgfSkgfHwgIiI7CiAgICAgICAgdmFyIGZpZWxkVHlwZSA9ICgwLCBfY29yZV91dGlscy5nZXRJbmhlcml0YWJsZVByb3BlcnR5KSh7CiAgICAgICAgICBkaWN0OiBkaWN0LAogICAgICAgICAga2V5OiAiRlQiCiAgICAgICAgfSk7CiAgICAgICAgZGF0YS5maWVsZFR5cGUgPSAoMCwgX3ByaW1pdGl2ZXMuaXNOYW1lKShmaWVsZFR5cGUpID8gZmllbGRUeXBlLm5hbWUgOiBudWxsOwogICAgICAgIF90aGlzMy5maWVsZFJlc291cmNlcyA9ICgwLCBfY29yZV91dGlscy5nZXRJbmhlcml0YWJsZVByb3BlcnR5KSh7CiAgICAgICAgICBkaWN0OiBkaWN0LAogICAgICAgICAga2V5OiAiRFIiCiAgICAgICAgfSkgfHwgX3ByaW1pdGl2ZXMuRGljdC5lbXB0eTsKICAgICAgICBkYXRhLmZpZWxkRmxhZ3MgPSAoMCwgX2NvcmVfdXRpbHMuZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eSkoewogICAgICAgICAgZGljdDogZGljdCwKICAgICAgICAgIGtleTogIkZmIgogICAgICAgIH0pOwoKICAgICAgICBpZiAoIU51bWJlci5pc0ludGVnZXIoZGF0YS5maWVsZEZsYWdzKSB8fCBkYXRhLmZpZWxkRmxhZ3MgPCAwKSB7CiAgICAgICAgICBkYXRhLmZpZWxkRmxhZ3MgPSAwOwogICAgICAgIH0KCiAgICAgICAgZGF0YS5yZWFkT25seSA9IF90aGlzMy5oYXNGaWVsZEZsYWcoX3V0aWwuQW5ub3RhdGlvbkZpZWxkRmxhZy5SRUFET05MWSk7CgogICAgICAgIGlmIChkYXRhLmZpZWxkVHlwZSA9PT0gIlNpZyIpIHsKICAgICAgICAgIGRhdGEuZmllbGRWYWx1ZSA9IG51bGw7CgogICAgICAgICAgX3RoaXMzLnNldEZsYWdzKF91dGlsLkFubm90YXRpb25GbGFnLkhJRERFTik7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gX3RoaXMzOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoV2lkZ2V0QW5ub3RhdGlvbiwgW3sKICAgICAgICBrZXk6ICJfY29uc3RydWN0RmllbGROYW1lIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX2NvbnN0cnVjdEZpZWxkTmFtZShkaWN0KSB7CiAgICAgICAgICBpZiAoIWRpY3QuaGFzKCJUIikgJiYgIWRpY3QuaGFzKCJQYXJlbnQiKSkgewogICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIlVua25vd24gZmllbGQgbmFtZSwgZmFsbGluZyBiYWNrIHRvIGVtcHR5IGZpZWxkIG5hbWUuIik7CiAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWRpY3QuaGFzKCJQYXJlbnQiKSkgewogICAgICAgICAgICByZXR1cm4gKDAsIF91dGlsLnN0cmluZ1RvUERGU3RyaW5nKShkaWN0LmdldCgiVCIpKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZmllbGROYW1lID0gW107CgogICAgICAgICAgaWYgKGRpY3QuaGFzKCJUIikpIHsKICAgICAgICAgICAgZmllbGROYW1lLnVuc2hpZnQoKDAsIF91dGlsLnN0cmluZ1RvUERGU3RyaW5nKShkaWN0LmdldCgiVCIpKSk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGxvb3BEaWN0ID0gZGljdDsKCiAgICAgICAgICB3aGlsZSAobG9vcERpY3QuaGFzKCJQYXJlbnQiKSkgewogICAgICAgICAgICBsb29wRGljdCA9IGxvb3BEaWN0LmdldCgiUGFyZW50Iik7CgogICAgICAgICAgICBpZiAoISgwLCBfcHJpbWl0aXZlcy5pc0RpY3QpKGxvb3BEaWN0KSkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobG9vcERpY3QuaGFzKCJUIikpIHsKICAgICAgICAgICAgICBmaWVsZE5hbWUudW5zaGlmdCgoMCwgX3V0aWwuc3RyaW5nVG9QREZTdHJpbmcpKGxvb3BEaWN0LmdldCgiVCIpKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gZmllbGROYW1lLmpvaW4oIi4iKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJoYXNGaWVsZEZsYWciLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBoYXNGaWVsZEZsYWcoZmxhZykgewogICAgICAgICAgcmV0dXJuICEhKHRoaXMuZGF0YS5maWVsZEZsYWdzICYgZmxhZyk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0T3BlcmF0b3JMaXN0IiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0T3BlcmF0b3JMaXN0KGV2YWx1YXRvciwgdGFzaywgcmVuZGVyRm9ybXMpIHsKICAgICAgICAgIGlmIChyZW5kZXJGb3JtcykgewogICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG5ldyBfb3BlcmF0b3JfbGlzdC5PcGVyYXRvckxpc3QoKSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIF9nZXQoX2dldFByb3RvdHlwZU9mKFdpZGdldEFubm90YXRpb24ucHJvdG90eXBlKSwgImdldE9wZXJhdG9yTGlzdCIsIHRoaXMpLmNhbGwodGhpcywgZXZhbHVhdG9yLCB0YXNrLCByZW5kZXJGb3Jtcyk7CiAgICAgICAgfQogICAgICB9XSk7CgogICAgICByZXR1cm4gV2lkZ2V0QW5ub3RhdGlvbjsKICAgIH0oQW5ub3RhdGlvbik7CgogICAgdmFyIFRleHRXaWRnZXRBbm5vdGF0aW9uID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfV2lkZ2V0QW5ub3RhdGlvbikgewogICAgICBfaW5oZXJpdHMoVGV4dFdpZGdldEFubm90YXRpb24sIF9XaWRnZXRBbm5vdGF0aW9uKTsKCiAgICAgIGZ1bmN0aW9uIFRleHRXaWRnZXRBbm5vdGF0aW9uKHBhcmFtcykgewogICAgICAgIHZhciBfdGhpczQ7CgogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBUZXh0V2lkZ2V0QW5ub3RhdGlvbik7CgogICAgICAgIF90aGlzNCA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihUZXh0V2lkZ2V0QW5ub3RhdGlvbikuY2FsbCh0aGlzLCBwYXJhbXMpKTsKICAgICAgICB2YXIgZGljdCA9IHBhcmFtcy5kaWN0OwogICAgICAgIF90aGlzNC5kYXRhLmZpZWxkVmFsdWUgPSAoMCwgX3V0aWwuc3RyaW5nVG9QREZTdHJpbmcpKF90aGlzNC5kYXRhLmZpZWxkVmFsdWUgfHwgIiIpOwogICAgICAgIHZhciBhbGlnbm1lbnQgPSAoMCwgX2NvcmVfdXRpbHMuZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eSkoewogICAgICAgICAgZGljdDogZGljdCwKICAgICAgICAgIGtleTogIlEiCiAgICAgICAgfSk7CgogICAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihhbGlnbm1lbnQpIHx8IGFsaWdubWVudCA8IDAgfHwgYWxpZ25tZW50ID4gMikgewogICAgICAgICAgYWxpZ25tZW50ID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIF90aGlzNC5kYXRhLnRleHRBbGlnbm1lbnQgPSBhbGlnbm1lbnQ7CiAgICAgICAgdmFyIG1heGltdW1MZW5ndGggPSAoMCwgX2NvcmVfdXRpbHMuZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eSkoewogICAgICAgICAgZGljdDogZGljdCwKICAgICAgICAgIGtleTogIk1heExlbiIKICAgICAgICB9KTsKCiAgICAgICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKG1heGltdW1MZW5ndGgpIHx8IG1heGltdW1MZW5ndGggPCAwKSB7CiAgICAgICAgICBtYXhpbXVtTGVuZ3RoID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIF90aGlzNC5kYXRhLm1heExlbiA9IG1heGltdW1MZW5ndGg7CiAgICAgICAgX3RoaXM0LmRhdGEubXVsdGlMaW5lID0gX3RoaXM0Lmhhc0ZpZWxkRmxhZyhfdXRpbC5Bbm5vdGF0aW9uRmllbGRGbGFnLk1VTFRJTElORSk7CiAgICAgICAgX3RoaXM0LmRhdGEuY29tYiA9IF90aGlzNC5oYXNGaWVsZEZsYWcoX3V0aWwuQW5ub3RhdGlvbkZpZWxkRmxhZy5DT01CKSAmJiAhX3RoaXM0Lmhhc0ZpZWxkRmxhZyhfdXRpbC5Bbm5vdGF0aW9uRmllbGRGbGFnLk1VTFRJTElORSkgJiYgIV90aGlzNC5oYXNGaWVsZEZsYWcoX3V0aWwuQW5ub3RhdGlvbkZpZWxkRmxhZy5QQVNTV09SRCkgJiYgIV90aGlzNC5oYXNGaWVsZEZsYWcoX3V0aWwuQW5ub3RhdGlvbkZpZWxkRmxhZy5GSUxFU0VMRUNUKSAmJiBfdGhpczQuZGF0YS5tYXhMZW4gIT09IG51bGw7CiAgICAgICAgcmV0dXJuIF90aGlzNDsKICAgICAgfQoKICAgICAgX2NyZWF0ZUNsYXNzKFRleHRXaWRnZXRBbm5vdGF0aW9uLCBbewogICAgICAgIGtleTogImdldE9wZXJhdG9yTGlzdCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldE9wZXJhdG9yTGlzdChldmFsdWF0b3IsIHRhc2ssIHJlbmRlckZvcm1zKSB7CiAgICAgICAgICBpZiAocmVuZGVyRm9ybXMgfHwgdGhpcy5hcHBlYXJhbmNlKSB7CiAgICAgICAgICAgIHJldHVybiBfZ2V0KF9nZXRQcm90b3R5cGVPZihUZXh0V2lkZ2V0QW5ub3RhdGlvbi5wcm90b3R5cGUpLCAiZ2V0T3BlcmF0b3JMaXN0IiwgdGhpcykuY2FsbCh0aGlzLCBldmFsdWF0b3IsIHRhc2ssIHJlbmRlckZvcm1zKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgb3BlcmF0b3JMaXN0ID0gbmV3IF9vcGVyYXRvcl9saXN0Lk9wZXJhdG9yTGlzdCgpOwoKICAgICAgICAgIGlmICghdGhpcy5kYXRhLmRlZmF1bHRBcHBlYXJhbmNlKSB7CiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUob3BlcmF0b3JMaXN0KTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgc3RyZWFtID0gbmV3IF9zdHJlYW0uU3RyZWFtKCgwLCBfdXRpbC5zdHJpbmdUb0J5dGVzKSh0aGlzLmRhdGEuZGVmYXVsdEFwcGVhcmFuY2UpKTsKICAgICAgICAgIHJldHVybiBldmFsdWF0b3IuZ2V0T3BlcmF0b3JMaXN0KHsKICAgICAgICAgICAgc3RyZWFtOiBzdHJlYW0sCiAgICAgICAgICAgIHRhc2s6IHRhc2ssCiAgICAgICAgICAgIHJlc291cmNlczogdGhpcy5maWVsZFJlc291cmNlcywKICAgICAgICAgICAgb3BlcmF0b3JMaXN0OiBvcGVyYXRvckxpc3QKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gb3BlcmF0b3JMaXN0OwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9XSk7CgogICAgICByZXR1cm4gVGV4dFdpZGdldEFubm90YXRpb247CiAgICB9KFdpZGdldEFubm90YXRpb24pOwoKICAgIHZhciBCdXR0b25XaWRnZXRBbm5vdGF0aW9uID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfV2lkZ2V0QW5ub3RhdGlvbjIpIHsKICAgICAgX2luaGVyaXRzKEJ1dHRvbldpZGdldEFubm90YXRpb24sIF9XaWRnZXRBbm5vdGF0aW9uMik7CgogICAgICBmdW5jdGlvbiBCdXR0b25XaWRnZXRBbm5vdGF0aW9uKHBhcmFtcykgewogICAgICAgIHZhciBfdGhpczU7CgogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBCdXR0b25XaWRnZXRBbm5vdGF0aW9uKTsKCiAgICAgICAgX3RoaXM1ID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKEJ1dHRvbldpZGdldEFubm90YXRpb24pLmNhbGwodGhpcywgcGFyYW1zKSk7CiAgICAgICAgX3RoaXM1LmRhdGEuY2hlY2tCb3ggPSAhX3RoaXM1Lmhhc0ZpZWxkRmxhZyhfdXRpbC5Bbm5vdGF0aW9uRmllbGRGbGFnLlJBRElPKSAmJiAhX3RoaXM1Lmhhc0ZpZWxkRmxhZyhfdXRpbC5Bbm5vdGF0aW9uRmllbGRGbGFnLlBVU0hCVVRUT04pOwogICAgICAgIF90aGlzNS5kYXRhLnJhZGlvQnV0dG9uID0gX3RoaXM1Lmhhc0ZpZWxkRmxhZyhfdXRpbC5Bbm5vdGF0aW9uRmllbGRGbGFnLlJBRElPKSAmJiAhX3RoaXM1Lmhhc0ZpZWxkRmxhZyhfdXRpbC5Bbm5vdGF0aW9uRmllbGRGbGFnLlBVU0hCVVRUT04pOwogICAgICAgIF90aGlzNS5kYXRhLnB1c2hCdXR0b24gPSBfdGhpczUuaGFzRmllbGRGbGFnKF91dGlsLkFubm90YXRpb25GaWVsZEZsYWcuUFVTSEJVVFRPTik7CgogICAgICAgIGlmIChfdGhpczUuZGF0YS5jaGVja0JveCkgewogICAgICAgICAgX3RoaXM1Ll9wcm9jZXNzQ2hlY2tCb3gocGFyYW1zKTsKICAgICAgICB9IGVsc2UgaWYgKF90aGlzNS5kYXRhLnJhZGlvQnV0dG9uKSB7CiAgICAgICAgICBfdGhpczUuX3Byb2Nlc3NSYWRpb0J1dHRvbihwYXJhbXMpOwogICAgICAgIH0gZWxzZSBpZiAoX3RoaXM1LmRhdGEucHVzaEJ1dHRvbikgewogICAgICAgICAgX3RoaXM1Ll9wcm9jZXNzUHVzaEJ1dHRvbihwYXJhbXMpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAoMCwgX3V0aWwud2FybikoIkludmFsaWQgZmllbGQgZmxhZ3MgZm9yIGJ1dHRvbiB3aWRnZXQgYW5ub3RhdGlvbiIpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIF90aGlzNTsKICAgICAgfQoKICAgICAgX2NyZWF0ZUNsYXNzKEJ1dHRvbldpZGdldEFubm90YXRpb24sIFt7CiAgICAgICAga2V5OiAiX3Byb2Nlc3NDaGVja0JveCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9wcm9jZXNzQ2hlY2tCb3gocGFyYW1zKSB7CiAgICAgICAgICBpZiAoKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkodGhpcy5kYXRhLmZpZWxkVmFsdWUpKSB7CiAgICAgICAgICAgIHRoaXMuZGF0YS5maWVsZFZhbHVlID0gdGhpcy5kYXRhLmZpZWxkVmFsdWUubmFtZTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgY3VzdG9tQXBwZWFyYW5jZSA9IHBhcmFtcy5kaWN0LmdldCgiQVAiKTsKCiAgICAgICAgICBpZiAoISgwLCBfcHJpbWl0aXZlcy5pc0RpY3QpKGN1c3RvbUFwcGVhcmFuY2UpKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZXhwb3J0VmFsdWVPcHRpb25zRGljdCA9IGN1c3RvbUFwcGVhcmFuY2UuZ2V0KCJEIik7CgogICAgICAgICAgaWYgKCEoMCwgX3ByaW1pdGl2ZXMuaXNEaWN0KShleHBvcnRWYWx1ZU9wdGlvbnNEaWN0KSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGV4cG9ydFZhbHVlcyA9IGV4cG9ydFZhbHVlT3B0aW9uc0RpY3QuZ2V0S2V5cygpOwogICAgICAgICAgdmFyIGhhc0NvcnJlY3RPcHRpb25Db3VudCA9IGV4cG9ydFZhbHVlcy5sZW5ndGggPT09IDI7CgogICAgICAgICAgaWYgKCFoYXNDb3JyZWN0T3B0aW9uQ291bnQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuZGF0YS5leHBvcnRWYWx1ZSA9IGV4cG9ydFZhbHVlc1swXSA9PT0gIk9mZiIgPyBleHBvcnRWYWx1ZXNbMV0gOiBleHBvcnRWYWx1ZXNbMF07CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiX3Byb2Nlc3NSYWRpb0J1dHRvbiIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9wcm9jZXNzUmFkaW9CdXR0b24ocGFyYW1zKSB7CiAgICAgICAgICB0aGlzLmRhdGEuZmllbGRWYWx1ZSA9IHRoaXMuZGF0YS5idXR0b25WYWx1ZSA9IG51bGw7CiAgICAgICAgICB2YXIgZmllbGRQYXJlbnQgPSBwYXJhbXMuZGljdC5nZXQoIlBhcmVudCIpOwoKICAgICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNEaWN0KShmaWVsZFBhcmVudCkgJiYgZmllbGRQYXJlbnQuaGFzKCJWIikpIHsKICAgICAgICAgICAgdmFyIGZpZWxkUGFyZW50VmFsdWUgPSBmaWVsZFBhcmVudC5nZXQoIlYiKTsKCiAgICAgICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNOYW1lKShmaWVsZFBhcmVudFZhbHVlKSkgewogICAgICAgICAgICAgIHRoaXMuZGF0YS5maWVsZFZhbHVlID0gZmllbGRQYXJlbnRWYWx1ZS5uYW1lOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGFwcGVhcmFuY2VTdGF0ZXMgPSBwYXJhbXMuZGljdC5nZXQoIkFQIik7CgogICAgICAgICAgaWYgKCEoMCwgX3ByaW1pdGl2ZXMuaXNEaWN0KShhcHBlYXJhbmNlU3RhdGVzKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIG5vcm1hbEFwcGVhcmFuY2VTdGF0ZSA9IGFwcGVhcmFuY2VTdGF0ZXMuZ2V0KCJOIik7CgogICAgICAgICAgaWYgKCEoMCwgX3ByaW1pdGl2ZXMuaXNEaWN0KShub3JtYWxBcHBlYXJhbmNlU3RhdGUpKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIgPSB0cnVlOwogICAgICAgICAgdmFyIF9kaWRJdGVyYXRvckVycm9yMiA9IGZhbHNlOwogICAgICAgICAgdmFyIF9pdGVyYXRvckVycm9yMiA9IHVuZGVmaW5lZDsKCiAgICAgICAgICB0cnkgewogICAgICAgICAgICBmb3IgKHZhciBfaXRlcmF0b3IyID0gbm9ybWFsQXBwZWFyYW5jZVN0YXRlLmdldEtleXMoKVtTeW1ib2wuaXRlcmF0b3JdKCksIF9zdGVwMjsgIShfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiA9IChfc3RlcDIgPSBfaXRlcmF0b3IyLm5leHQoKSkuZG9uZSk7IF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yID0gdHJ1ZSkgewogICAgICAgICAgICAgIHZhciBrZXkgPSBfc3RlcDIudmFsdWU7CgogICAgICAgICAgICAgIGlmIChrZXkgIT09ICJPZmYiKSB7CiAgICAgICAgICAgICAgICB0aGlzLmRhdGEuYnV0dG9uVmFsdWUgPSBrZXk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvcjIgPSB0cnVlOwogICAgICAgICAgICBfaXRlcmF0b3JFcnJvcjIgPSBlcnI7CiAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGlmICghX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIgJiYgX2l0ZXJhdG9yMlsicmV0dXJuIl0gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgX2l0ZXJhdG9yMlsicmV0dXJuIl0oKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgaWYgKF9kaWRJdGVyYXRvckVycm9yMikgewogICAgICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3IyOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIl9wcm9jZXNzUHVzaEJ1dHRvbiIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9wcm9jZXNzUHVzaEJ1dHRvbihwYXJhbXMpIHsKICAgICAgICAgIGlmICghcGFyYW1zLmRpY3QuaGFzKCJBIikpIHsKICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJQdXNoIGJ1dHRvbnMgd2l0aG91dCBhY3Rpb24gZGljdGlvbmFyaWVzIGFyZSBub3Qgc3VwcG9ydGVkIik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBfb2JqLkNhdGFsb2cucGFyc2VEZXN0RGljdGlvbmFyeSh7CiAgICAgICAgICAgIGRlc3REaWN0OiBwYXJhbXMuZGljdCwKICAgICAgICAgICAgcmVzdWx0T2JqOiB0aGlzLmRhdGEsCiAgICAgICAgICAgIGRvY0Jhc2VVcmw6IHBhcmFtcy5wZGZNYW5hZ2VyLmRvY0Jhc2VVcmwKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIEJ1dHRvbldpZGdldEFubm90YXRpb247CiAgICB9KFdpZGdldEFubm90YXRpb24pOwoKICAgIHZhciBDaG9pY2VXaWRnZXRBbm5vdGF0aW9uID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfV2lkZ2V0QW5ub3RhdGlvbjMpIHsKICAgICAgX2luaGVyaXRzKENob2ljZVdpZGdldEFubm90YXRpb24sIF9XaWRnZXRBbm5vdGF0aW9uMyk7CgogICAgICBmdW5jdGlvbiBDaG9pY2VXaWRnZXRBbm5vdGF0aW9uKHBhcmFtcykgewogICAgICAgIHZhciBfdGhpczY7CgogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBDaG9pY2VXaWRnZXRBbm5vdGF0aW9uKTsKCiAgICAgICAgX3RoaXM2ID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKENob2ljZVdpZGdldEFubm90YXRpb24pLmNhbGwodGhpcywgcGFyYW1zKSk7CiAgICAgICAgX3RoaXM2LmRhdGEub3B0aW9ucyA9IFtdOwogICAgICAgIHZhciBvcHRpb25zID0gKDAsIF9jb3JlX3V0aWxzLmdldEluaGVyaXRhYmxlUHJvcGVydHkpKHsKICAgICAgICAgIGRpY3Q6IHBhcmFtcy5kaWN0LAogICAgICAgICAga2V5OiAiT3B0IgogICAgICAgIH0pOwoKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShvcHRpb25zKSkgewogICAgICAgICAgdmFyIHhyZWYgPSBwYXJhbXMueHJlZjsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBvcHRpb25zLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgdmFyIG9wdGlvbiA9IHhyZWYuZmV0Y2hJZlJlZihvcHRpb25zW2ldKTsKICAgICAgICAgICAgdmFyIGlzT3B0aW9uQXJyYXkgPSBBcnJheS5pc0FycmF5KG9wdGlvbik7CiAgICAgICAgICAgIF90aGlzNi5kYXRhLm9wdGlvbnNbaV0gPSB7CiAgICAgICAgICAgICAgZXhwb3J0VmFsdWU6IGlzT3B0aW9uQXJyYXkgPyB4cmVmLmZldGNoSWZSZWYob3B0aW9uWzBdKSA6IG9wdGlvbiwKICAgICAgICAgICAgICBkaXNwbGF5VmFsdWU6ICgwLCBfdXRpbC5zdHJpbmdUb1BERlN0cmluZykoaXNPcHRpb25BcnJheSA/IHhyZWYuZmV0Y2hJZlJlZihvcHRpb25bMV0pIDogb3B0aW9uKQogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KF90aGlzNi5kYXRhLmZpZWxkVmFsdWUpKSB7CiAgICAgICAgICBfdGhpczYuZGF0YS5maWVsZFZhbHVlID0gW190aGlzNi5kYXRhLmZpZWxkVmFsdWVdOwogICAgICAgIH0KCiAgICAgICAgX3RoaXM2LmRhdGEuY29tYm8gPSBfdGhpczYuaGFzRmllbGRGbGFnKF91dGlsLkFubm90YXRpb25GaWVsZEZsYWcuQ09NQk8pOwogICAgICAgIF90aGlzNi5kYXRhLm11bHRpU2VsZWN0ID0gX3RoaXM2Lmhhc0ZpZWxkRmxhZyhfdXRpbC5Bbm5vdGF0aW9uRmllbGRGbGFnLk1VTFRJU0VMRUNUKTsKICAgICAgICByZXR1cm4gX3RoaXM2OwogICAgICB9CgogICAgICByZXR1cm4gQ2hvaWNlV2lkZ2V0QW5ub3RhdGlvbjsKICAgIH0oV2lkZ2V0QW5ub3RhdGlvbik7CgogICAgdmFyIFRleHRBbm5vdGF0aW9uID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfTWFya3VwQW5ub3RhdGlvbikgewogICAgICBfaW5oZXJpdHMoVGV4dEFubm90YXRpb24sIF9NYXJrdXBBbm5vdGF0aW9uKTsKCiAgICAgIGZ1bmN0aW9uIFRleHRBbm5vdGF0aW9uKHBhcmFtZXRlcnMpIHsKICAgICAgICB2YXIgX3RoaXM3OwoKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgVGV4dEFubm90YXRpb24pOwoKICAgICAgICB2YXIgREVGQVVMVF9JQ09OX1NJWkUgPSAyMjsKICAgICAgICBfdGhpczcgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoVGV4dEFubm90YXRpb24pLmNhbGwodGhpcywgcGFyYW1ldGVycykpOwogICAgICAgIHZhciBkaWN0ID0gcGFyYW1ldGVycy5kaWN0OwogICAgICAgIF90aGlzNy5kYXRhLmFubm90YXRpb25UeXBlID0gX3V0aWwuQW5ub3RhdGlvblR5cGUuVEVYVDsKCiAgICAgICAgaWYgKF90aGlzNy5kYXRhLmhhc0FwcGVhcmFuY2UpIHsKICAgICAgICAgIF90aGlzNy5kYXRhLm5hbWUgPSAiTm9JY29uIjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX3RoaXM3LmRhdGEucmVjdFsxXSA9IF90aGlzNy5kYXRhLnJlY3RbM10gLSBERUZBVUxUX0lDT05fU0laRTsKICAgICAgICAgIF90aGlzNy5kYXRhLnJlY3RbMl0gPSBfdGhpczcuZGF0YS5yZWN0WzBdICsgREVGQVVMVF9JQ09OX1NJWkU7CiAgICAgICAgICBfdGhpczcuZGF0YS5uYW1lID0gZGljdC5oYXMoIk5hbWUiKSA/IGRpY3QuZ2V0KCJOYW1lIikubmFtZSA6ICJOb3RlIjsKICAgICAgICB9CgogICAgICAgIGlmIChkaWN0LmhhcygiU3RhdGUiKSkgewogICAgICAgICAgX3RoaXM3LmRhdGEuc3RhdGUgPSBkaWN0LmdldCgiU3RhdGUiKSB8fCBudWxsOwogICAgICAgICAgX3RoaXM3LmRhdGEuc3RhdGVNb2RlbCA9IGRpY3QuZ2V0KCJTdGF0ZU1vZGVsIikgfHwgbnVsbDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX3RoaXM3LmRhdGEuc3RhdGUgPSBudWxsOwogICAgICAgICAgX3RoaXM3LmRhdGEuc3RhdGVNb2RlbCA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gX3RoaXM3OwogICAgICB9CgogICAgICByZXR1cm4gVGV4dEFubm90YXRpb247CiAgICB9KE1hcmt1cEFubm90YXRpb24pOwoKICAgIHZhciBMaW5rQW5ub3RhdGlvbiA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0Fubm90YXRpb24zKSB7CiAgICAgIF9pbmhlcml0cyhMaW5rQW5ub3RhdGlvbiwgX0Fubm90YXRpb24zKTsKCiAgICAgIGZ1bmN0aW9uIExpbmtBbm5vdGF0aW9uKHBhcmFtcykgewogICAgICAgIHZhciBfdGhpczg7CgogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBMaW5rQW5ub3RhdGlvbik7CgogICAgICAgIF90aGlzOCA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihMaW5rQW5ub3RhdGlvbikuY2FsbCh0aGlzLCBwYXJhbXMpKTsKICAgICAgICBfdGhpczguZGF0YS5hbm5vdGF0aW9uVHlwZSA9IF91dGlsLkFubm90YXRpb25UeXBlLkxJTks7CiAgICAgICAgdmFyIHF1YWRQb2ludHMgPSBnZXRRdWFkUG9pbnRzKHBhcmFtcy5kaWN0LCBfdGhpczgucmVjdGFuZ2xlKTsKCiAgICAgICAgaWYgKHF1YWRQb2ludHMpIHsKICAgICAgICAgIF90aGlzOC5kYXRhLnF1YWRQb2ludHMgPSBxdWFkUG9pbnRzOwogICAgICAgIH0KCiAgICAgICAgX29iai5DYXRhbG9nLnBhcnNlRGVzdERpY3Rpb25hcnkoewogICAgICAgICAgZGVzdERpY3Q6IHBhcmFtcy5kaWN0LAogICAgICAgICAgcmVzdWx0T2JqOiBfdGhpczguZGF0YSwKICAgICAgICAgIGRvY0Jhc2VVcmw6IHBhcmFtcy5wZGZNYW5hZ2VyLmRvY0Jhc2VVcmwKICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIF90aGlzODsKICAgICAgfQoKICAgICAgcmV0dXJuIExpbmtBbm5vdGF0aW9uOwogICAgfShBbm5vdGF0aW9uKTsKCiAgICB2YXIgUG9wdXBBbm5vdGF0aW9uID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQW5ub3RhdGlvbjQpIHsKICAgICAgX2luaGVyaXRzKFBvcHVwQW5ub3RhdGlvbiwgX0Fubm90YXRpb240KTsKCiAgICAgIGZ1bmN0aW9uIFBvcHVwQW5ub3RhdGlvbihwYXJhbWV0ZXJzKSB7CiAgICAgICAgdmFyIF90aGlzOTsKCiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFBvcHVwQW5ub3RhdGlvbik7CgogICAgICAgIF90aGlzOSA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihQb3B1cEFubm90YXRpb24pLmNhbGwodGhpcywgcGFyYW1ldGVycykpOwogICAgICAgIF90aGlzOS5kYXRhLmFubm90YXRpb25UeXBlID0gX3V0aWwuQW5ub3RhdGlvblR5cGUuUE9QVVA7CiAgICAgICAgdmFyIHBhcmVudEl0ZW0gPSBwYXJhbWV0ZXJzLmRpY3QuZ2V0KCJQYXJlbnQiKTsKCiAgICAgICAgaWYgKCFwYXJlbnRJdGVtKSB7CiAgICAgICAgICAoMCwgX3V0aWwud2FybikoIlBvcHVwIGFubm90YXRpb24gaGFzIGEgbWlzc2luZyBvciBpbnZhbGlkIHBhcmVudCBhbm5vdGF0aW9uLiIpOwogICAgICAgICAgcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKF90aGlzOSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgcGFyZW50U3VidHlwZSA9IHBhcmVudEl0ZW0uZ2V0KCJTdWJ0eXBlIik7CiAgICAgICAgX3RoaXM5LmRhdGEucGFyZW50VHlwZSA9ICgwLCBfcHJpbWl0aXZlcy5pc05hbWUpKHBhcmVudFN1YnR5cGUpID8gcGFyZW50U3VidHlwZS5uYW1lIDogbnVsbDsKICAgICAgICB2YXIgcmF3UGFyZW50ID0gcGFyYW1ldGVycy5kaWN0LmdldFJhdygiUGFyZW50Iik7CiAgICAgICAgX3RoaXM5LmRhdGEucGFyZW50SWQgPSAoMCwgX3ByaW1pdGl2ZXMuaXNSZWYpKHJhd1BhcmVudCkgPyByYXdQYXJlbnQudG9TdHJpbmcoKSA6IG51bGw7CiAgICAgICAgdmFyIHJ0ID0gcGFyZW50SXRlbS5nZXQoIlJUIik7CgogICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNOYW1lKShydCwgX3V0aWwuQW5ub3RhdGlvblJlcGx5VHlwZS5HUk9VUCkpIHsKICAgICAgICAgIHBhcmVudEl0ZW0gPSBwYXJlbnRJdGVtLmdldCgiSVJUIik7CiAgICAgICAgfQoKICAgICAgICBpZiAoIXBhcmVudEl0ZW0uaGFzKCJNIikpIHsKICAgICAgICAgIF90aGlzOS5kYXRhLm1vZGlmaWNhdGlvbkRhdGUgPSBudWxsOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBfdGhpczkuc2V0TW9kaWZpY2F0aW9uRGF0ZShwYXJlbnRJdGVtLmdldCgiTSIpKTsKCiAgICAgICAgICBfdGhpczkuZGF0YS5tb2RpZmljYXRpb25EYXRlID0gX3RoaXM5Lm1vZGlmaWNhdGlvbkRhdGU7CiAgICAgICAgfQoKICAgICAgICBpZiAoIXBhcmVudEl0ZW0uaGFzKCJDIikpIHsKICAgICAgICAgIF90aGlzOS5kYXRhLmNvbG9yID0gbnVsbDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX3RoaXM5LnNldENvbG9yKHBhcmVudEl0ZW0uZ2V0QXJyYXkoIkMiKSk7CgogICAgICAgICAgX3RoaXM5LmRhdGEuY29sb3IgPSBfdGhpczkuY29sb3I7CiAgICAgICAgfQoKICAgICAgICBpZiAoIV90aGlzOS52aWV3YWJsZSkgewogICAgICAgICAgdmFyIHBhcmVudEZsYWdzID0gcGFyZW50SXRlbS5nZXQoIkYiKTsKCiAgICAgICAgICBpZiAoX3RoaXM5Ll9pc1ZpZXdhYmxlKHBhcmVudEZsYWdzKSkgewogICAgICAgICAgICBfdGhpczkuc2V0RmxhZ3MocGFyZW50RmxhZ3MpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgX3RoaXM5LmRhdGEudGl0bGUgPSAoMCwgX3V0aWwuc3RyaW5nVG9QREZTdHJpbmcpKHBhcmVudEl0ZW0uZ2V0KCJUIikgfHwgIiIpOwogICAgICAgIF90aGlzOS5kYXRhLmNvbnRlbnRzID0gKDAsIF91dGlsLnN0cmluZ1RvUERGU3RyaW5nKShwYXJlbnRJdGVtLmdldCgiQ29udGVudHMiKSB8fCAiIik7CiAgICAgICAgcmV0dXJuIF90aGlzOTsKICAgICAgfQoKICAgICAgcmV0dXJuIFBvcHVwQW5ub3RhdGlvbjsKICAgIH0oQW5ub3RhdGlvbik7CgogICAgdmFyIEZyZWVUZXh0QW5ub3RhdGlvbiA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX01hcmt1cEFubm90YXRpb24yKSB7CiAgICAgIF9pbmhlcml0cyhGcmVlVGV4dEFubm90YXRpb24sIF9NYXJrdXBBbm5vdGF0aW9uMik7CgogICAgICBmdW5jdGlvbiBGcmVlVGV4dEFubm90YXRpb24ocGFyYW1ldGVycykgewogICAgICAgIHZhciBfdGhpczEwOwoKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRnJlZVRleHRBbm5vdGF0aW9uKTsKCiAgICAgICAgX3RoaXMxMCA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihGcmVlVGV4dEFubm90YXRpb24pLmNhbGwodGhpcywgcGFyYW1ldGVycykpOwogICAgICAgIF90aGlzMTAuZGF0YS5hbm5vdGF0aW9uVHlwZSA9IF91dGlsLkFubm90YXRpb25UeXBlLkZSRUVURVhUOwogICAgICAgIHJldHVybiBfdGhpczEwOwogICAgICB9CgogICAgICByZXR1cm4gRnJlZVRleHRBbm5vdGF0aW9uOwogICAgfShNYXJrdXBBbm5vdGF0aW9uKTsKCiAgICB2YXIgTGluZUFubm90YXRpb24gPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9NYXJrdXBBbm5vdGF0aW9uMykgewogICAgICBfaW5oZXJpdHMoTGluZUFubm90YXRpb24sIF9NYXJrdXBBbm5vdGF0aW9uMyk7CgogICAgICBmdW5jdGlvbiBMaW5lQW5ub3RhdGlvbihwYXJhbWV0ZXJzKSB7CiAgICAgICAgdmFyIF90aGlzMTE7CgogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBMaW5lQW5ub3RhdGlvbik7CgogICAgICAgIF90aGlzMTEgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoTGluZUFubm90YXRpb24pLmNhbGwodGhpcywgcGFyYW1ldGVycykpOwogICAgICAgIF90aGlzMTEuZGF0YS5hbm5vdGF0aW9uVHlwZSA9IF91dGlsLkFubm90YXRpb25UeXBlLkxJTkU7CiAgICAgICAgX3RoaXMxMS5kYXRhLmxpbmVDb29yZGluYXRlcyA9IF91dGlsLlV0aWwubm9ybWFsaXplUmVjdChwYXJhbWV0ZXJzLmRpY3QuZ2V0QXJyYXkoIkwiKSk7CiAgICAgICAgcmV0dXJuIF90aGlzMTE7CiAgICAgIH0KCiAgICAgIHJldHVybiBMaW5lQW5ub3RhdGlvbjsKICAgIH0oTWFya3VwQW5ub3RhdGlvbik7CgogICAgdmFyIFNxdWFyZUFubm90YXRpb24gPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9NYXJrdXBBbm5vdGF0aW9uNCkgewogICAgICBfaW5oZXJpdHMoU3F1YXJlQW5ub3RhdGlvbiwgX01hcmt1cEFubm90YXRpb240KTsKCiAgICAgIGZ1bmN0aW9uIFNxdWFyZUFubm90YXRpb24ocGFyYW1ldGVycykgewogICAgICAgIHZhciBfdGhpczEyOwoKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgU3F1YXJlQW5ub3RhdGlvbik7CgogICAgICAgIF90aGlzMTIgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoU3F1YXJlQW5ub3RhdGlvbikuY2FsbCh0aGlzLCBwYXJhbWV0ZXJzKSk7CiAgICAgICAgX3RoaXMxMi5kYXRhLmFubm90YXRpb25UeXBlID0gX3V0aWwuQW5ub3RhdGlvblR5cGUuU1FVQVJFOwogICAgICAgIHJldHVybiBfdGhpczEyOwogICAgICB9CgogICAgICByZXR1cm4gU3F1YXJlQW5ub3RhdGlvbjsKICAgIH0oTWFya3VwQW5ub3RhdGlvbik7CgogICAgdmFyIENpcmNsZUFubm90YXRpb24gPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9NYXJrdXBBbm5vdGF0aW9uNSkgewogICAgICBfaW5oZXJpdHMoQ2lyY2xlQW5ub3RhdGlvbiwgX01hcmt1cEFubm90YXRpb241KTsKCiAgICAgIGZ1bmN0aW9uIENpcmNsZUFubm90YXRpb24ocGFyYW1ldGVycykgewogICAgICAgIHZhciBfdGhpczEzOwoKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQ2lyY2xlQW5ub3RhdGlvbik7CgogICAgICAgIF90aGlzMTMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoQ2lyY2xlQW5ub3RhdGlvbikuY2FsbCh0aGlzLCBwYXJhbWV0ZXJzKSk7CiAgICAgICAgX3RoaXMxMy5kYXRhLmFubm90YXRpb25UeXBlID0gX3V0aWwuQW5ub3RhdGlvblR5cGUuQ0lSQ0xFOwogICAgICAgIHJldHVybiBfdGhpczEzOwogICAgICB9CgogICAgICByZXR1cm4gQ2lyY2xlQW5ub3RhdGlvbjsKICAgIH0oTWFya3VwQW5ub3RhdGlvbik7CgogICAgdmFyIFBvbHlsaW5lQW5ub3RhdGlvbiA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX01hcmt1cEFubm90YXRpb242KSB7CiAgICAgIF9pbmhlcml0cyhQb2x5bGluZUFubm90YXRpb24sIF9NYXJrdXBBbm5vdGF0aW9uNik7CgogICAgICBmdW5jdGlvbiBQb2x5bGluZUFubm90YXRpb24ocGFyYW1ldGVycykgewogICAgICAgIHZhciBfdGhpczE0OwoKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUG9seWxpbmVBbm5vdGF0aW9uKTsKCiAgICAgICAgX3RoaXMxNCA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihQb2x5bGluZUFubm90YXRpb24pLmNhbGwodGhpcywgcGFyYW1ldGVycykpOwogICAgICAgIF90aGlzMTQuZGF0YS5hbm5vdGF0aW9uVHlwZSA9IF91dGlsLkFubm90YXRpb25UeXBlLlBPTFlMSU5FOwogICAgICAgIHZhciByYXdWZXJ0aWNlcyA9IHBhcmFtZXRlcnMuZGljdC5nZXRBcnJheSgiVmVydGljZXMiKTsKICAgICAgICBfdGhpczE0LmRhdGEudmVydGljZXMgPSBbXTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gcmF3VmVydGljZXMubGVuZ3RoOyBpIDwgaWk7IGkgKz0gMikgewogICAgICAgICAgX3RoaXMxNC5kYXRhLnZlcnRpY2VzLnB1c2goewogICAgICAgICAgICB4OiByYXdWZXJ0aWNlc1tpXSwKICAgICAgICAgICAgeTogcmF3VmVydGljZXNbaSArIDFdCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBfdGhpczE0OwogICAgICB9CgogICAgICByZXR1cm4gUG9seWxpbmVBbm5vdGF0aW9uOwogICAgfShNYXJrdXBBbm5vdGF0aW9uKTsKCiAgICB2YXIgUG9seWdvbkFubm90YXRpb24gPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9Qb2x5bGluZUFubm90YXRpb24pIHsKICAgICAgX2luaGVyaXRzKFBvbHlnb25Bbm5vdGF0aW9uLCBfUG9seWxpbmVBbm5vdGF0aW9uKTsKCiAgICAgIGZ1bmN0aW9uIFBvbHlnb25Bbm5vdGF0aW9uKHBhcmFtZXRlcnMpIHsKICAgICAgICB2YXIgX3RoaXMxNTsKCiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFBvbHlnb25Bbm5vdGF0aW9uKTsKCiAgICAgICAgX3RoaXMxNSA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihQb2x5Z29uQW5ub3RhdGlvbikuY2FsbCh0aGlzLCBwYXJhbWV0ZXJzKSk7CiAgICAgICAgX3RoaXMxNS5kYXRhLmFubm90YXRpb25UeXBlID0gX3V0aWwuQW5ub3RhdGlvblR5cGUuUE9MWUdPTjsKICAgICAgICByZXR1cm4gX3RoaXMxNTsKICAgICAgfQoKICAgICAgcmV0dXJuIFBvbHlnb25Bbm5vdGF0aW9uOwogICAgfShQb2x5bGluZUFubm90YXRpb24pOwoKICAgIHZhciBDYXJldEFubm90YXRpb24gPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9NYXJrdXBBbm5vdGF0aW9uNykgewogICAgICBfaW5oZXJpdHMoQ2FyZXRBbm5vdGF0aW9uLCBfTWFya3VwQW5ub3RhdGlvbjcpOwoKICAgICAgZnVuY3Rpb24gQ2FyZXRBbm5vdGF0aW9uKHBhcmFtZXRlcnMpIHsKICAgICAgICB2YXIgX3RoaXMxNjsKCiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIENhcmV0QW5ub3RhdGlvbik7CgogICAgICAgIF90aGlzMTYgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoQ2FyZXRBbm5vdGF0aW9uKS5jYWxsKHRoaXMsIHBhcmFtZXRlcnMpKTsKICAgICAgICBfdGhpczE2LmRhdGEuYW5ub3RhdGlvblR5cGUgPSBfdXRpbC5Bbm5vdGF0aW9uVHlwZS5DQVJFVDsKICAgICAgICByZXR1cm4gX3RoaXMxNjsKICAgICAgfQoKICAgICAgcmV0dXJuIENhcmV0QW5ub3RhdGlvbjsKICAgIH0oTWFya3VwQW5ub3RhdGlvbik7CgogICAgdmFyIElua0Fubm90YXRpb24gPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9NYXJrdXBBbm5vdGF0aW9uOCkgewogICAgICBfaW5oZXJpdHMoSW5rQW5ub3RhdGlvbiwgX01hcmt1cEFubm90YXRpb244KTsKCiAgICAgIGZ1bmN0aW9uIElua0Fubm90YXRpb24ocGFyYW1ldGVycykgewogICAgICAgIHZhciBfdGhpczE3OwoKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgSW5rQW5ub3RhdGlvbik7CgogICAgICAgIF90aGlzMTcgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoSW5rQW5ub3RhdGlvbikuY2FsbCh0aGlzLCBwYXJhbWV0ZXJzKSk7CiAgICAgICAgX3RoaXMxNy5kYXRhLmFubm90YXRpb25UeXBlID0gX3V0aWwuQW5ub3RhdGlvblR5cGUuSU5LOwogICAgICAgIHZhciB4cmVmID0gcGFyYW1ldGVycy54cmVmOwogICAgICAgIHZhciBvcmlnaW5hbElua0xpc3RzID0gcGFyYW1ldGVycy5kaWN0LmdldEFycmF5KCJJbmtMaXN0Iik7CiAgICAgICAgX3RoaXMxNy5kYXRhLmlua0xpc3RzID0gW107CgogICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IG9yaWdpbmFsSW5rTGlzdHMubGVuZ3RoOyBpIDwgaWk7ICsraSkgewogICAgICAgICAgX3RoaXMxNy5kYXRhLmlua0xpc3RzLnB1c2goW10pOwoKICAgICAgICAgIGZvciAodmFyIGogPSAwLCBqaiA9IG9yaWdpbmFsSW5rTGlzdHNbaV0ubGVuZ3RoOyBqIDwgamo7IGogKz0gMikgewogICAgICAgICAgICBfdGhpczE3LmRhdGEuaW5rTGlzdHNbaV0ucHVzaCh7CiAgICAgICAgICAgICAgeDogeHJlZi5mZXRjaElmUmVmKG9yaWdpbmFsSW5rTGlzdHNbaV1bal0pLAogICAgICAgICAgICAgIHk6IHhyZWYuZmV0Y2hJZlJlZihvcmlnaW5hbElua0xpc3RzW2ldW2ogKyAxXSkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gX3RoaXMxNzsKICAgICAgfQoKICAgICAgcmV0dXJuIElua0Fubm90YXRpb247CiAgICB9KE1hcmt1cEFubm90YXRpb24pOwoKICAgIHZhciBIaWdobGlnaHRBbm5vdGF0aW9uID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfTWFya3VwQW5ub3RhdGlvbjkpIHsKICAgICAgX2luaGVyaXRzKEhpZ2hsaWdodEFubm90YXRpb24sIF9NYXJrdXBBbm5vdGF0aW9uOSk7CgogICAgICBmdW5jdGlvbiBIaWdobGlnaHRBbm5vdGF0aW9uKHBhcmFtZXRlcnMpIHsKICAgICAgICB2YXIgX3RoaXMxODsKCiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEhpZ2hsaWdodEFubm90YXRpb24pOwoKICAgICAgICBfdGhpczE4ID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKEhpZ2hsaWdodEFubm90YXRpb24pLmNhbGwodGhpcywgcGFyYW1ldGVycykpOwogICAgICAgIF90aGlzMTguZGF0YS5hbm5vdGF0aW9uVHlwZSA9IF91dGlsLkFubm90YXRpb25UeXBlLkhJR0hMSUdIVDsKICAgICAgICB2YXIgcXVhZFBvaW50cyA9IGdldFF1YWRQb2ludHMocGFyYW1ldGVycy5kaWN0LCBfdGhpczE4LnJlY3RhbmdsZSk7CgogICAgICAgIGlmIChxdWFkUG9pbnRzKSB7CiAgICAgICAgICBfdGhpczE4LmRhdGEucXVhZFBvaW50cyA9IHF1YWRQb2ludHM7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gX3RoaXMxODsKICAgICAgfQoKICAgICAgcmV0dXJuIEhpZ2hsaWdodEFubm90YXRpb247CiAgICB9KE1hcmt1cEFubm90YXRpb24pOwoKICAgIHZhciBVbmRlcmxpbmVBbm5vdGF0aW9uID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfTWFya3VwQW5ub3RhdGlvbjEwKSB7CiAgICAgIF9pbmhlcml0cyhVbmRlcmxpbmVBbm5vdGF0aW9uLCBfTWFya3VwQW5ub3RhdGlvbjEwKTsKCiAgICAgIGZ1bmN0aW9uIFVuZGVybGluZUFubm90YXRpb24ocGFyYW1ldGVycykgewogICAgICAgIHZhciBfdGhpczE5OwoKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgVW5kZXJsaW5lQW5ub3RhdGlvbik7CgogICAgICAgIF90aGlzMTkgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoVW5kZXJsaW5lQW5ub3RhdGlvbikuY2FsbCh0aGlzLCBwYXJhbWV0ZXJzKSk7CiAgICAgICAgX3RoaXMxOS5kYXRhLmFubm90YXRpb25UeXBlID0gX3V0aWwuQW5ub3RhdGlvblR5cGUuVU5ERVJMSU5FOwogICAgICAgIHZhciBxdWFkUG9pbnRzID0gZ2V0UXVhZFBvaW50cyhwYXJhbWV0ZXJzLmRpY3QsIF90aGlzMTkucmVjdGFuZ2xlKTsKCiAgICAgICAgaWYgKHF1YWRQb2ludHMpIHsKICAgICAgICAgIF90aGlzMTkuZGF0YS5xdWFkUG9pbnRzID0gcXVhZFBvaW50czsKICAgICAgICB9CgogICAgICAgIHJldHVybiBfdGhpczE5OwogICAgICB9CgogICAgICByZXR1cm4gVW5kZXJsaW5lQW5ub3RhdGlvbjsKICAgIH0oTWFya3VwQW5ub3RhdGlvbik7CgogICAgdmFyIFNxdWlnZ2x5QW5ub3RhdGlvbiA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX01hcmt1cEFubm90YXRpb24xMSkgewogICAgICBfaW5oZXJpdHMoU3F1aWdnbHlBbm5vdGF0aW9uLCBfTWFya3VwQW5ub3RhdGlvbjExKTsKCiAgICAgIGZ1bmN0aW9uIFNxdWlnZ2x5QW5ub3RhdGlvbihwYXJhbWV0ZXJzKSB7CiAgICAgICAgdmFyIF90aGlzMjA7CgogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBTcXVpZ2dseUFubm90YXRpb24pOwoKICAgICAgICBfdGhpczIwID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKFNxdWlnZ2x5QW5ub3RhdGlvbikuY2FsbCh0aGlzLCBwYXJhbWV0ZXJzKSk7CiAgICAgICAgX3RoaXMyMC5kYXRhLmFubm90YXRpb25UeXBlID0gX3V0aWwuQW5ub3RhdGlvblR5cGUuU1FVSUdHTFk7CiAgICAgICAgdmFyIHF1YWRQb2ludHMgPSBnZXRRdWFkUG9pbnRzKHBhcmFtZXRlcnMuZGljdCwgX3RoaXMyMC5yZWN0YW5nbGUpOwoKICAgICAgICBpZiAocXVhZFBvaW50cykgewogICAgICAgICAgX3RoaXMyMC5kYXRhLnF1YWRQb2ludHMgPSBxdWFkUG9pbnRzOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIF90aGlzMjA7CiAgICAgIH0KCiAgICAgIHJldHVybiBTcXVpZ2dseUFubm90YXRpb247CiAgICB9KE1hcmt1cEFubm90YXRpb24pOwoKICAgIHZhciBTdHJpa2VPdXRBbm5vdGF0aW9uID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfTWFya3VwQW5ub3RhdGlvbjEyKSB7CiAgICAgIF9pbmhlcml0cyhTdHJpa2VPdXRBbm5vdGF0aW9uLCBfTWFya3VwQW5ub3RhdGlvbjEyKTsKCiAgICAgIGZ1bmN0aW9uIFN0cmlrZU91dEFubm90YXRpb24ocGFyYW1ldGVycykgewogICAgICAgIHZhciBfdGhpczIxOwoKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgU3RyaWtlT3V0QW5ub3RhdGlvbik7CgogICAgICAgIF90aGlzMjEgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoU3RyaWtlT3V0QW5ub3RhdGlvbikuY2FsbCh0aGlzLCBwYXJhbWV0ZXJzKSk7CiAgICAgICAgX3RoaXMyMS5kYXRhLmFubm90YXRpb25UeXBlID0gX3V0aWwuQW5ub3RhdGlvblR5cGUuU1RSSUtFT1VUOwogICAgICAgIHZhciBxdWFkUG9pbnRzID0gZ2V0UXVhZFBvaW50cyhwYXJhbWV0ZXJzLmRpY3QsIF90aGlzMjEucmVjdGFuZ2xlKTsKCiAgICAgICAgaWYgKHF1YWRQb2ludHMpIHsKICAgICAgICAgIF90aGlzMjEuZGF0YS5xdWFkUG9pbnRzID0gcXVhZFBvaW50czsKICAgICAgICB9CgogICAgICAgIHJldHVybiBfdGhpczIxOwogICAgICB9CgogICAgICByZXR1cm4gU3RyaWtlT3V0QW5ub3RhdGlvbjsKICAgIH0oTWFya3VwQW5ub3RhdGlvbik7CgogICAgdmFyIFN0YW1wQW5ub3RhdGlvbiA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX01hcmt1cEFubm90YXRpb24xMykgewogICAgICBfaW5oZXJpdHMoU3RhbXBBbm5vdGF0aW9uLCBfTWFya3VwQW5ub3RhdGlvbjEzKTsKCiAgICAgIGZ1bmN0aW9uIFN0YW1wQW5ub3RhdGlvbihwYXJhbWV0ZXJzKSB7CiAgICAgICAgdmFyIF90aGlzMjI7CgogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBTdGFtcEFubm90YXRpb24pOwoKICAgICAgICBfdGhpczIyID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKFN0YW1wQW5ub3RhdGlvbikuY2FsbCh0aGlzLCBwYXJhbWV0ZXJzKSk7CiAgICAgICAgX3RoaXMyMi5kYXRhLmFubm90YXRpb25UeXBlID0gX3V0aWwuQW5ub3RhdGlvblR5cGUuU1RBTVA7CiAgICAgICAgcmV0dXJuIF90aGlzMjI7CiAgICAgIH0KCiAgICAgIHJldHVybiBTdGFtcEFubm90YXRpb247CiAgICB9KE1hcmt1cEFubm90YXRpb24pOwoKICAgIHZhciBGaWxlQXR0YWNobWVudEFubm90YXRpb24gPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9NYXJrdXBBbm5vdGF0aW9uMTQpIHsKICAgICAgX2luaGVyaXRzKEZpbGVBdHRhY2htZW50QW5ub3RhdGlvbiwgX01hcmt1cEFubm90YXRpb24xNCk7CgogICAgICBmdW5jdGlvbiBGaWxlQXR0YWNobWVudEFubm90YXRpb24ocGFyYW1ldGVycykgewogICAgICAgIHZhciBfdGhpczIzOwoKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRmlsZUF0dGFjaG1lbnRBbm5vdGF0aW9uKTsKCiAgICAgICAgX3RoaXMyMyA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihGaWxlQXR0YWNobWVudEFubm90YXRpb24pLmNhbGwodGhpcywgcGFyYW1ldGVycykpOwogICAgICAgIHZhciBmaWxlID0gbmV3IF9vYmouRmlsZVNwZWMocGFyYW1ldGVycy5kaWN0LmdldCgiRlMiKSwgcGFyYW1ldGVycy54cmVmKTsKICAgICAgICBfdGhpczIzLmRhdGEuYW5ub3RhdGlvblR5cGUgPSBfdXRpbC5Bbm5vdGF0aW9uVHlwZS5GSUxFQVRUQUNITUVOVDsKICAgICAgICBfdGhpczIzLmRhdGEuZmlsZSA9IGZpbGUuc2VyaWFsaXphYmxlOwogICAgICAgIHJldHVybiBfdGhpczIzOwogICAgICB9CgogICAgICByZXR1cm4gRmlsZUF0dGFjaG1lbnRBbm5vdGF0aW9uOwogICAgfShNYXJrdXBBbm5vdGF0aW9uKTsKCiAgICAvKioqL30pLCAoCiAgLyogMjE0ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgIHZhbHVlOiB0cnVlCiAgICB9KTsKICAgIGV4cG9ydHMuT3BlcmF0b3JMaXN0ID0gdm9pZCAwOwoKICAgIHZhciBfdXRpbCA9IF9fd19wZGZqc19yZXF1aXJlX18oNSk7CgogICAgdmFyIFF1ZXVlT3B0aW1pemVyID0gZnVuY3Rpb24gUXVldWVPcHRpbWl6ZXJDbG9zdXJlKCkgewogICAgICBmdW5jdGlvbiBhZGRTdGF0ZShwYXJlbnRTdGF0ZSwgcGF0dGVybiwgY2hlY2tGbiwgaXRlcmF0ZUZuLCBwcm9jZXNzRm4pIHsKICAgICAgICB2YXIgc3RhdGUgPSBwYXJlbnRTdGF0ZTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gcGF0dGVybi5sZW5ndGggLSAxOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgdmFyIGl0ZW0gPSBwYXR0ZXJuW2ldOwogICAgICAgICAgc3RhdGUgPSBzdGF0ZVtpdGVtXSB8fCAoc3RhdGVbaXRlbV0gPSBbXSk7CiAgICAgICAgfQoKICAgICAgICBzdGF0ZVtwYXR0ZXJuW3BhdHRlcm4ubGVuZ3RoIC0gMV1dID0gewogICAgICAgICAgY2hlY2tGbjogY2hlY2tGbiwKICAgICAgICAgIGl0ZXJhdGVGbjogaXRlcmF0ZUZuLAogICAgICAgICAgcHJvY2Vzc0ZuOiBwcm9jZXNzRm4KICAgICAgICB9OwogICAgICB9CgogICAgICBmdW5jdGlvbiBoYW5kbGVQYWludFNvbGlkQ29sb3JJbWFnZU1hc2soaUZpcnN0U2F2ZSwgY291bnQsIGZuQXJyYXksIGFyZ3NBcnJheSkgewogICAgICAgIHZhciBpRmlyc3RQSU1YTyA9IGlGaXJzdFNhdmUgKyAyOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgICAgICAgIHZhciBhcmcgPSBhcmdzQXJyYXlbaUZpcnN0UElNWE8gKyA0ICogaV07CiAgICAgICAgICB2YXIgaW1hZ2VNYXNrID0gYXJnLmxlbmd0aCA9PT0gMSAmJiBhcmdbMF07CgogICAgICAgICAgaWYgKGltYWdlTWFzayAmJiBpbWFnZU1hc2sud2lkdGggPT09IDEgJiYgaW1hZ2VNYXNrLmhlaWdodCA9PT0gMSAmJiAoIWltYWdlTWFzay5kYXRhLmxlbmd0aCB8fCBpbWFnZU1hc2suZGF0YS5sZW5ndGggPT09IDEgJiYgaW1hZ2VNYXNrLmRhdGFbMF0gPT09IDApKSB7CiAgICAgICAgICAgIGZuQXJyYXlbaUZpcnN0UElNWE8gKyA0ICogaV0gPSBfdXRpbC5PUFMucGFpbnRTb2xpZENvbG9ySW1hZ2VNYXNrOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICAgIHJldHVybiBjb3VudCAtIGk7CiAgICAgIH0KCiAgICAgIHZhciBJbml0aWFsU3RhdGUgPSBbXTsKICAgICAgYWRkU3RhdGUoSW5pdGlhbFN0YXRlLCBbX3V0aWwuT1BTLnNhdmUsIF91dGlsLk9QUy50cmFuc2Zvcm0sIF91dGlsLk9QUy5wYWludElubGluZUltYWdlWE9iamVjdCwgX3V0aWwuT1BTLnJlc3RvcmVdLCBudWxsLCBmdW5jdGlvbiBpdGVyYXRlSW5saW5lSW1hZ2VHcm91cChjb250ZXh0LCBpKSB7CiAgICAgICAgdmFyIGZuQXJyYXkgPSBjb250ZXh0LmZuQXJyYXk7CiAgICAgICAgdmFyIGlGaXJzdFNhdmUgPSBjb250ZXh0LmlDdXJyIC0gMzsKICAgICAgICB2YXIgcG9zID0gKGkgLSBpRmlyc3RTYXZlKSAlIDQ7CgogICAgICAgIHN3aXRjaCAocG9zKSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIHJldHVybiBmbkFycmF5W2ldID09PSBfdXRpbC5PUFMuc2F2ZTsKCiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIHJldHVybiBmbkFycmF5W2ldID09PSBfdXRpbC5PUFMudHJhbnNmb3JtOwoKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgcmV0dXJuIGZuQXJyYXlbaV0gPT09IF91dGlsLk9QUy5wYWludElubGluZUltYWdlWE9iamVjdDsKCiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIHJldHVybiBmbkFycmF5W2ldID09PSBfdXRpbC5PUFMucmVzdG9yZTsKICAgICAgICB9CgogICAgICAgIHRocm93IG5ldyBFcnJvcigiaXRlcmF0ZUlubGluZUltYWdlR3JvdXAgLSBpbnZhbGlkIHBvczogIi5jb25jYXQocG9zKSk7CiAgICAgIH0sIGZ1bmN0aW9uIGZvdW5kSW5saW5lSW1hZ2VHcm91cChjb250ZXh0LCBpKSB7CiAgICAgICAgdmFyIE1JTl9JTUFHRVNfSU5fSU5MSU5FX0lNQUdFU19CTE9DSyA9IDEwOwogICAgICAgIHZhciBNQVhfSU1BR0VTX0lOX0lOTElORV9JTUFHRVNfQkxPQ0sgPSAyMDA7CiAgICAgICAgdmFyIE1BWF9XSURUSCA9IDEwMDA7CiAgICAgICAgdmFyIElNQUdFX1BBRERJTkcgPSAxOwogICAgICAgIHZhciBmbkFycmF5ID0gY29udGV4dC5mbkFycmF5LAogICAgICAgICAgYXJnc0FycmF5ID0gY29udGV4dC5hcmdzQXJyYXk7CiAgICAgICAgdmFyIGN1cnIgPSBjb250ZXh0LmlDdXJyOwogICAgICAgIHZhciBpRmlyc3RTYXZlID0gY3VyciAtIDM7CiAgICAgICAgdmFyIGlGaXJzdFRyYW5zZm9ybSA9IGN1cnIgLSAyOwogICAgICAgIHZhciBpRmlyc3RQSUlYTyA9IGN1cnIgLSAxOwogICAgICAgIHZhciBjb3VudCA9IE1hdGgubWluKE1hdGguZmxvb3IoKGkgLSBpRmlyc3RTYXZlKSAvIDQpLCBNQVhfSU1BR0VTX0lOX0lOTElORV9JTUFHRVNfQkxPQ0spOwoKICAgICAgICBpZiAoY291bnQgPCBNSU5fSU1BR0VTX0lOX0lOTElORV9JTUFHRVNfQkxPQ0spIHsKICAgICAgICAgIHJldHVybiBpIC0gKGkgLSBpRmlyc3RTYXZlKSAlIDQ7CiAgICAgICAgfQoKICAgICAgICB2YXIgbWF4WCA9IDA7CiAgICAgICAgdmFyIG1hcCA9IFtdLAogICAgICAgICAgbWF4TGluZUhlaWdodCA9IDA7CiAgICAgICAgdmFyIGN1cnJlbnRYID0gSU1BR0VfUEFERElORywKICAgICAgICAgIGN1cnJlbnRZID0gSU1BR0VfUEFERElORzsKICAgICAgICB2YXIgcTsKCiAgICAgICAgZm9yIChxID0gMDsgcSA8IGNvdW50OyBxKyspIHsKICAgICAgICAgIHZhciB0cmFuc2Zvcm0gPSBhcmdzQXJyYXlbaUZpcnN0VHJhbnNmb3JtICsgKHEgPDwgMildOwogICAgICAgICAgdmFyIGltZyA9IGFyZ3NBcnJheVtpRmlyc3RQSUlYTyArIChxIDw8IDIpXVswXTsKCiAgICAgICAgICBpZiAoY3VycmVudFggKyBpbWcud2lkdGggPiBNQVhfV0lEVEgpIHsKICAgICAgICAgICAgbWF4WCA9IE1hdGgubWF4KG1heFgsIGN1cnJlbnRYKTsKICAgICAgICAgICAgY3VycmVudFkgKz0gbWF4TGluZUhlaWdodCArIDIgKiBJTUFHRV9QQURESU5HOwogICAgICAgICAgICBjdXJyZW50WCA9IDA7CiAgICAgICAgICAgIG1heExpbmVIZWlnaHQgPSAwOwogICAgICAgICAgfQoKICAgICAgICAgIG1hcC5wdXNoKHsKICAgICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2Zvcm0sCiAgICAgICAgICAgIHg6IGN1cnJlbnRYLAogICAgICAgICAgICB5OiBjdXJyZW50WSwKICAgICAgICAgICAgdzogaW1nLndpZHRoLAogICAgICAgICAgICBoOiBpbWcuaGVpZ2h0CiAgICAgICAgICB9KTsKICAgICAgICAgIGN1cnJlbnRYICs9IGltZy53aWR0aCArIDIgKiBJTUFHRV9QQURESU5HOwogICAgICAgICAgbWF4TGluZUhlaWdodCA9IE1hdGgubWF4KG1heExpbmVIZWlnaHQsIGltZy5oZWlnaHQpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGltZ1dpZHRoID0gTWF0aC5tYXgobWF4WCwgY3VycmVudFgpICsgSU1BR0VfUEFERElORzsKICAgICAgICB2YXIgaW1nSGVpZ2h0ID0gY3VycmVudFkgKyBtYXhMaW5lSGVpZ2h0ICsgSU1BR0VfUEFERElORzsKICAgICAgICB2YXIgaW1nRGF0YSA9IG5ldyBVaW50OENsYW1wZWRBcnJheShpbWdXaWR0aCAqIGltZ0hlaWdodCAqIDQpOwogICAgICAgIHZhciBpbWdSb3dTaXplID0gaW1nV2lkdGggPDwgMjsKCiAgICAgICAgZm9yIChxID0gMDsgcSA8IGNvdW50OyBxKyspIHsKICAgICAgICAgIHZhciBkYXRhID0gYXJnc0FycmF5W2lGaXJzdFBJSVhPICsgKHEgPDwgMildWzBdLmRhdGE7CiAgICAgICAgICB2YXIgcm93U2l6ZSA9IG1hcFtxXS53IDw8IDI7CiAgICAgICAgICB2YXIgZGF0YU9mZnNldCA9IDA7CiAgICAgICAgICB2YXIgb2Zmc2V0ID0gbWFwW3FdLnggKyBtYXBbcV0ueSAqIGltZ1dpZHRoIDw8IDI7CiAgICAgICAgICBpbWdEYXRhLnNldChkYXRhLnN1YmFycmF5KDAsIHJvd1NpemUpLCBvZmZzZXQgLSBpbWdSb3dTaXplKTsKCiAgICAgICAgICBmb3IgKHZhciBrID0gMCwga2sgPSBtYXBbcV0uaDsgayA8IGtrOyBrKyspIHsKICAgICAgICAgICAgaW1nRGF0YS5zZXQoZGF0YS5zdWJhcnJheShkYXRhT2Zmc2V0LCBkYXRhT2Zmc2V0ICsgcm93U2l6ZSksIG9mZnNldCk7CiAgICAgICAgICAgIGRhdGFPZmZzZXQgKz0gcm93U2l6ZTsKICAgICAgICAgICAgb2Zmc2V0ICs9IGltZ1Jvd1NpemU7CiAgICAgICAgICB9CgogICAgICAgICAgaW1nRGF0YS5zZXQoZGF0YS5zdWJhcnJheShkYXRhT2Zmc2V0IC0gcm93U2l6ZSwgZGF0YU9mZnNldCksIG9mZnNldCk7CgogICAgICAgICAgd2hpbGUgKG9mZnNldCA+PSAwKSB7CiAgICAgICAgICAgIGRhdGFbb2Zmc2V0IC0gNF0gPSBkYXRhW29mZnNldF07CiAgICAgICAgICAgIGRhdGFbb2Zmc2V0IC0gM10gPSBkYXRhW29mZnNldCArIDFdOwogICAgICAgICAgICBkYXRhW29mZnNldCAtIDJdID0gZGF0YVtvZmZzZXQgKyAyXTsKICAgICAgICAgICAgZGF0YVtvZmZzZXQgLSAxXSA9IGRhdGFbb2Zmc2V0ICsgM107CiAgICAgICAgICAgIGRhdGFbb2Zmc2V0ICsgcm93U2l6ZV0gPSBkYXRhW29mZnNldCArIHJvd1NpemUgLSA0XTsKICAgICAgICAgICAgZGF0YVtvZmZzZXQgKyByb3dTaXplICsgMV0gPSBkYXRhW29mZnNldCArIHJvd1NpemUgLSAzXTsKICAgICAgICAgICAgZGF0YVtvZmZzZXQgKyByb3dTaXplICsgMl0gPSBkYXRhW29mZnNldCArIHJvd1NpemUgLSAyXTsKICAgICAgICAgICAgZGF0YVtvZmZzZXQgKyByb3dTaXplICsgM10gPSBkYXRhW29mZnNldCArIHJvd1NpemUgLSAxXTsKICAgICAgICAgICAgb2Zmc2V0IC09IGltZ1Jvd1NpemU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmbkFycmF5LnNwbGljZShpRmlyc3RTYXZlLCBjb3VudCAqIDQsIF91dGlsLk9QUy5wYWludElubGluZUltYWdlWE9iamVjdEdyb3VwKTsKICAgICAgICBhcmdzQXJyYXkuc3BsaWNlKGlGaXJzdFNhdmUsIGNvdW50ICogNCwgW3sKICAgICAgICAgIHdpZHRoOiBpbWdXaWR0aCwKICAgICAgICAgIGhlaWdodDogaW1nSGVpZ2h0LAogICAgICAgICAga2luZDogX3V0aWwuSW1hZ2VLaW5kLlJHQkFfMzJCUFAsCiAgICAgICAgICBkYXRhOiBpbWdEYXRhCiAgICAgICAgfSwgbWFwXSk7CiAgICAgICAgcmV0dXJuIGlGaXJzdFNhdmUgKyAxOwogICAgICB9KTsKICAgICAgYWRkU3RhdGUoSW5pdGlhbFN0YXRlLCBbX3V0aWwuT1BTLnNhdmUsIF91dGlsLk9QUy50cmFuc2Zvcm0sIF91dGlsLk9QUy5wYWludEltYWdlTWFza1hPYmplY3QsIF91dGlsLk9QUy5yZXN0b3JlXSwgbnVsbCwgZnVuY3Rpb24gaXRlcmF0ZUltYWdlTWFza0dyb3VwKGNvbnRleHQsIGkpIHsKICAgICAgICB2YXIgZm5BcnJheSA9IGNvbnRleHQuZm5BcnJheTsKICAgICAgICB2YXIgaUZpcnN0U2F2ZSA9IGNvbnRleHQuaUN1cnIgLSAzOwogICAgICAgIHZhciBwb3MgPSAoaSAtIGlGaXJzdFNhdmUpICUgNDsKCiAgICAgICAgc3dpdGNoIChwb3MpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgcmV0dXJuIGZuQXJyYXlbaV0gPT09IF91dGlsLk9QUy5zYXZlOwoKICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgcmV0dXJuIGZuQXJyYXlbaV0gPT09IF91dGlsLk9QUy50cmFuc2Zvcm07CgogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICByZXR1cm4gZm5BcnJheVtpXSA9PT0gX3V0aWwuT1BTLnBhaW50SW1hZ2VNYXNrWE9iamVjdDsKCiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIHJldHVybiBmbkFycmF5W2ldID09PSBfdXRpbC5PUFMucmVzdG9yZTsKICAgICAgICB9CgogICAgICAgIHRocm93IG5ldyBFcnJvcigiaXRlcmF0ZUltYWdlTWFza0dyb3VwIC0gaW52YWxpZCBwb3M6ICIuY29uY2F0KHBvcykpOwogICAgICB9LCBmdW5jdGlvbiBmb3VuZEltYWdlTWFza0dyb3VwKGNvbnRleHQsIGkpIHsKICAgICAgICB2YXIgTUlOX0lNQUdFU19JTl9NQVNLU19CTE9DSyA9IDEwOwogICAgICAgIHZhciBNQVhfSU1BR0VTX0lOX01BU0tTX0JMT0NLID0gMTAwOwogICAgICAgIHZhciBNQVhfU0FNRV9JTUFHRVNfSU5fTUFTS1NfQkxPQ0sgPSAxMDAwOwogICAgICAgIHZhciBmbkFycmF5ID0gY29udGV4dC5mbkFycmF5LAogICAgICAgICAgYXJnc0FycmF5ID0gY29udGV4dC5hcmdzQXJyYXk7CiAgICAgICAgdmFyIGN1cnIgPSBjb250ZXh0LmlDdXJyOwogICAgICAgIHZhciBpRmlyc3RTYXZlID0gY3VyciAtIDM7CiAgICAgICAgdmFyIGlGaXJzdFRyYW5zZm9ybSA9IGN1cnIgLSAyOwogICAgICAgIHZhciBpRmlyc3RQSU1YTyA9IGN1cnIgLSAxOwogICAgICAgIHZhciBjb3VudCA9IE1hdGguZmxvb3IoKGkgLSBpRmlyc3RTYXZlKSAvIDQpOwogICAgICAgIGNvdW50ID0gaGFuZGxlUGFpbnRTb2xpZENvbG9ySW1hZ2VNYXNrKGlGaXJzdFNhdmUsIGNvdW50LCBmbkFycmF5LCBhcmdzQXJyYXkpOwoKICAgICAgICBpZiAoY291bnQgPCBNSU5fSU1BR0VTX0lOX01BU0tTX0JMT0NLKSB7CiAgICAgICAgICByZXR1cm4gaSAtIChpIC0gaUZpcnN0U2F2ZSkgJSA0OwogICAgICAgIH0KCiAgICAgICAgdmFyIHE7CiAgICAgICAgdmFyIGlzU2FtZUltYWdlID0gZmFsc2U7CiAgICAgICAgdmFyIGlUcmFuc2Zvcm0sIHRyYW5zZm9ybUFyZ3M7CiAgICAgICAgdmFyIGZpcnN0UElNWE9BcmcwID0gYXJnc0FycmF5W2lGaXJzdFBJTVhPXVswXTsKCiAgICAgICAgaWYgKGFyZ3NBcnJheVtpRmlyc3RUcmFuc2Zvcm1dWzFdID09PSAwICYmIGFyZ3NBcnJheVtpRmlyc3RUcmFuc2Zvcm1dWzJdID09PSAwKSB7CiAgICAgICAgICBpc1NhbWVJbWFnZSA9IHRydWU7CiAgICAgICAgICB2YXIgZmlyc3RUcmFuc2Zvcm1BcmcwID0gYXJnc0FycmF5W2lGaXJzdFRyYW5zZm9ybV1bMF07CiAgICAgICAgICB2YXIgZmlyc3RUcmFuc2Zvcm1BcmczID0gYXJnc0FycmF5W2lGaXJzdFRyYW5zZm9ybV1bM107CiAgICAgICAgICBpVHJhbnNmb3JtID0gaUZpcnN0VHJhbnNmb3JtICsgNDsKICAgICAgICAgIHZhciBpUElNWE8gPSBpRmlyc3RQSU1YTyArIDQ7CgogICAgICAgICAgZm9yIChxID0gMTsgcSA8IGNvdW50OyBxKyssIGlUcmFuc2Zvcm0gKz0gNCwgaVBJTVhPICs9IDQpIHsKICAgICAgICAgICAgdHJhbnNmb3JtQXJncyA9IGFyZ3NBcnJheVtpVHJhbnNmb3JtXTsKCiAgICAgICAgICAgIGlmIChhcmdzQXJyYXlbaVBJTVhPXVswXSAhPT0gZmlyc3RQSU1YT0FyZzAgfHwgdHJhbnNmb3JtQXJnc1swXSAhPT0gZmlyc3RUcmFuc2Zvcm1BcmcwIHx8IHRyYW5zZm9ybUFyZ3NbMV0gIT09IDAgfHwgdHJhbnNmb3JtQXJnc1syXSAhPT0gMCB8fCB0cmFuc2Zvcm1BcmdzWzNdICE9PSBmaXJzdFRyYW5zZm9ybUFyZzMpIHsKICAgICAgICAgICAgICBpZiAocSA8IE1JTl9JTUFHRVNfSU5fTUFTS1NfQkxPQ0spIHsKICAgICAgICAgICAgICAgIGlzU2FtZUltYWdlID0gZmFsc2U7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvdW50ID0gcTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoaXNTYW1lSW1hZ2UpIHsKICAgICAgICAgIGNvdW50ID0gTWF0aC5taW4oY291bnQsIE1BWF9TQU1FX0lNQUdFU19JTl9NQVNLU19CTE9DSyk7CiAgICAgICAgICB2YXIgcG9zaXRpb25zID0gbmV3IEZsb2F0MzJBcnJheShjb3VudCAqIDIpOwogICAgICAgICAgaVRyYW5zZm9ybSA9IGlGaXJzdFRyYW5zZm9ybTsKCiAgICAgICAgICBmb3IgKHEgPSAwOyBxIDwgY291bnQ7IHErKywgaVRyYW5zZm9ybSArPSA0KSB7CiAgICAgICAgICAgIHRyYW5zZm9ybUFyZ3MgPSBhcmdzQXJyYXlbaVRyYW5zZm9ybV07CiAgICAgICAgICAgIHBvc2l0aW9uc1txIDw8IDFdID0gdHJhbnNmb3JtQXJnc1s0XTsKICAgICAgICAgICAgcG9zaXRpb25zWyhxIDw8IDEpICsgMV0gPSB0cmFuc2Zvcm1BcmdzWzVdOwogICAgICAgICAgfQoKICAgICAgICAgIGZuQXJyYXkuc3BsaWNlKGlGaXJzdFNhdmUsIGNvdW50ICogNCwgX3V0aWwuT1BTLnBhaW50SW1hZ2VNYXNrWE9iamVjdFJlcGVhdCk7CiAgICAgICAgICBhcmdzQXJyYXkuc3BsaWNlKGlGaXJzdFNhdmUsIGNvdW50ICogNCwgW2ZpcnN0UElNWE9BcmcwLCBmaXJzdFRyYW5zZm9ybUFyZzAsIGZpcnN0VHJhbnNmb3JtQXJnMywgcG9zaXRpb25zXSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvdW50ID0gTWF0aC5taW4oY291bnQsIE1BWF9JTUFHRVNfSU5fTUFTS1NfQkxPQ0spOwogICAgICAgICAgdmFyIGltYWdlcyA9IFtdOwoKICAgICAgICAgIGZvciAocSA9IDA7IHEgPCBjb3VudDsgcSsrKSB7CiAgICAgICAgICAgIHRyYW5zZm9ybUFyZ3MgPSBhcmdzQXJyYXlbaUZpcnN0VHJhbnNmb3JtICsgKHEgPDwgMildOwogICAgICAgICAgICB2YXIgbWFza1BhcmFtcyA9IGFyZ3NBcnJheVtpRmlyc3RQSU1YTyArIChxIDw8IDIpXVswXTsKICAgICAgICAgICAgaW1hZ2VzLnB1c2goewogICAgICAgICAgICAgIGRhdGE6IG1hc2tQYXJhbXMuZGF0YSwKICAgICAgICAgICAgICB3aWR0aDogbWFza1BhcmFtcy53aWR0aCwKICAgICAgICAgICAgICBoZWlnaHQ6IG1hc2tQYXJhbXMuaGVpZ2h0LAogICAgICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNmb3JtQXJncwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICBmbkFycmF5LnNwbGljZShpRmlyc3RTYXZlLCBjb3VudCAqIDQsIF91dGlsLk9QUy5wYWludEltYWdlTWFza1hPYmplY3RHcm91cCk7CiAgICAgICAgICBhcmdzQXJyYXkuc3BsaWNlKGlGaXJzdFNhdmUsIGNvdW50ICogNCwgW2ltYWdlc10pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGlGaXJzdFNhdmUgKyAxOwogICAgICB9KTsKICAgICAgYWRkU3RhdGUoSW5pdGlhbFN0YXRlLCBbX3V0aWwuT1BTLnNhdmUsIF91dGlsLk9QUy50cmFuc2Zvcm0sIF91dGlsLk9QUy5wYWludEltYWdlWE9iamVjdCwgX3V0aWwuT1BTLnJlc3RvcmVdLCBmdW5jdGlvbiAoY29udGV4dCkgewogICAgICAgIHZhciBhcmdzQXJyYXkgPSBjb250ZXh0LmFyZ3NBcnJheTsKICAgICAgICB2YXIgaUZpcnN0VHJhbnNmb3JtID0gY29udGV4dC5pQ3VyciAtIDI7CiAgICAgICAgcmV0dXJuIGFyZ3NBcnJheVtpRmlyc3RUcmFuc2Zvcm1dWzFdID09PSAwICYmIGFyZ3NBcnJheVtpRmlyc3RUcmFuc2Zvcm1dWzJdID09PSAwOwogICAgICB9LCBmdW5jdGlvbiBpdGVyYXRlSW1hZ2VHcm91cChjb250ZXh0LCBpKSB7CiAgICAgICAgdmFyIGZuQXJyYXkgPSBjb250ZXh0LmZuQXJyYXksCiAgICAgICAgICBhcmdzQXJyYXkgPSBjb250ZXh0LmFyZ3NBcnJheTsKICAgICAgICB2YXIgaUZpcnN0U2F2ZSA9IGNvbnRleHQuaUN1cnIgLSAzOwogICAgICAgIHZhciBwb3MgPSAoaSAtIGlGaXJzdFNhdmUpICUgNDsKCiAgICAgICAgc3dpdGNoIChwb3MpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgcmV0dXJuIGZuQXJyYXlbaV0gPT09IF91dGlsLk9QUy5zYXZlOwoKICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgaWYgKGZuQXJyYXlbaV0gIT09IF91dGlsLk9QUy50cmFuc2Zvcm0pIHsKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBpRmlyc3RUcmFuc2Zvcm0gPSBjb250ZXh0LmlDdXJyIC0gMjsKICAgICAgICAgICAgdmFyIGZpcnN0VHJhbnNmb3JtQXJnMCA9IGFyZ3NBcnJheVtpRmlyc3RUcmFuc2Zvcm1dWzBdOwogICAgICAgICAgICB2YXIgZmlyc3RUcmFuc2Zvcm1BcmczID0gYXJnc0FycmF5W2lGaXJzdFRyYW5zZm9ybV1bM107CgogICAgICAgICAgICBpZiAoYXJnc0FycmF5W2ldWzBdICE9PSBmaXJzdFRyYW5zZm9ybUFyZzAgfHwgYXJnc0FycmF5W2ldWzFdICE9PSAwIHx8IGFyZ3NBcnJheVtpXVsyXSAhPT0gMCB8fCBhcmdzQXJyYXlbaV1bM10gIT09IGZpcnN0VHJhbnNmb3JtQXJnMykgewogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHRydWU7CgogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICBpZiAoZm5BcnJheVtpXSAhPT0gX3V0aWwuT1BTLnBhaW50SW1hZ2VYT2JqZWN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgaUZpcnN0UElYTyA9IGNvbnRleHQuaUN1cnIgLSAxOwogICAgICAgICAgICB2YXIgZmlyc3RQSVhPQXJnMCA9IGFyZ3NBcnJheVtpRmlyc3RQSVhPXVswXTsKCiAgICAgICAgICAgIGlmIChhcmdzQXJyYXlbaV1bMF0gIT09IGZpcnN0UElYT0FyZzApIHsKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgcmV0dXJuIGZuQXJyYXlbaV0gPT09IF91dGlsLk9QUy5yZXN0b3JlOwogICAgICAgIH0KCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJpdGVyYXRlSW1hZ2VHcm91cCAtIGludmFsaWQgcG9zOiAiLmNvbmNhdChwb3MpKTsKICAgICAgfSwgZnVuY3Rpb24gKGNvbnRleHQsIGkpIHsKICAgICAgICB2YXIgTUlOX0lNQUdFU19JTl9CTE9DSyA9IDM7CiAgICAgICAgdmFyIE1BWF9JTUFHRVNfSU5fQkxPQ0sgPSAxMDAwOwogICAgICAgIHZhciBmbkFycmF5ID0gY29udGV4dC5mbkFycmF5LAogICAgICAgICAgYXJnc0FycmF5ID0gY29udGV4dC5hcmdzQXJyYXk7CiAgICAgICAgdmFyIGN1cnIgPSBjb250ZXh0LmlDdXJyOwogICAgICAgIHZhciBpRmlyc3RTYXZlID0gY3VyciAtIDM7CiAgICAgICAgdmFyIGlGaXJzdFRyYW5zZm9ybSA9IGN1cnIgLSAyOwogICAgICAgIHZhciBpRmlyc3RQSVhPID0gY3VyciAtIDE7CiAgICAgICAgdmFyIGZpcnN0UElYT0FyZzAgPSBhcmdzQXJyYXlbaUZpcnN0UElYT11bMF07CiAgICAgICAgdmFyIGZpcnN0VHJhbnNmb3JtQXJnMCA9IGFyZ3NBcnJheVtpRmlyc3RUcmFuc2Zvcm1dWzBdOwogICAgICAgIHZhciBmaXJzdFRyYW5zZm9ybUFyZzMgPSBhcmdzQXJyYXlbaUZpcnN0VHJhbnNmb3JtXVszXTsKICAgICAgICB2YXIgY291bnQgPSBNYXRoLm1pbihNYXRoLmZsb29yKChpIC0gaUZpcnN0U2F2ZSkgLyA0KSwgTUFYX0lNQUdFU19JTl9CTE9DSyk7CgogICAgICAgIGlmIChjb3VudCA8IE1JTl9JTUFHRVNfSU5fQkxPQ0spIHsKICAgICAgICAgIHJldHVybiBpIC0gKGkgLSBpRmlyc3RTYXZlKSAlIDQ7CiAgICAgICAgfQoKICAgICAgICB2YXIgcG9zaXRpb25zID0gbmV3IEZsb2F0MzJBcnJheShjb3VudCAqIDIpOwogICAgICAgIHZhciBpVHJhbnNmb3JtID0gaUZpcnN0VHJhbnNmb3JtOwoKICAgICAgICBmb3IgKHZhciBxID0gMDsgcSA8IGNvdW50OyBxKyssIGlUcmFuc2Zvcm0gKz0gNCkgewogICAgICAgICAgdmFyIHRyYW5zZm9ybUFyZ3MgPSBhcmdzQXJyYXlbaVRyYW5zZm9ybV07CiAgICAgICAgICBwb3NpdGlvbnNbcSA8PCAxXSA9IHRyYW5zZm9ybUFyZ3NbNF07CiAgICAgICAgICBwb3NpdGlvbnNbKHEgPDwgMSkgKyAxXSA9IHRyYW5zZm9ybUFyZ3NbNV07CiAgICAgICAgfQoKICAgICAgICB2YXIgYXJncyA9IFtmaXJzdFBJWE9BcmcwLCBmaXJzdFRyYW5zZm9ybUFyZzAsIGZpcnN0VHJhbnNmb3JtQXJnMywgcG9zaXRpb25zXTsKICAgICAgICBmbkFycmF5LnNwbGljZShpRmlyc3RTYXZlLCBjb3VudCAqIDQsIF91dGlsLk9QUy5wYWludEltYWdlWE9iamVjdFJlcGVhdCk7CiAgICAgICAgYXJnc0FycmF5LnNwbGljZShpRmlyc3RTYXZlLCBjb3VudCAqIDQsIGFyZ3MpOwogICAgICAgIHJldHVybiBpRmlyc3RTYXZlICsgMTsKICAgICAgfSk7CiAgICAgIGFkZFN0YXRlKEluaXRpYWxTdGF0ZSwgW191dGlsLk9QUy5iZWdpblRleHQsIF91dGlsLk9QUy5zZXRGb250LCBfdXRpbC5PUFMuc2V0VGV4dE1hdHJpeCwgX3V0aWwuT1BTLnNob3dUZXh0LCBfdXRpbC5PUFMuZW5kVGV4dF0sIG51bGwsIGZ1bmN0aW9uIGl0ZXJhdGVTaG93VGV4dEdyb3VwKGNvbnRleHQsIGkpIHsKICAgICAgICB2YXIgZm5BcnJheSA9IGNvbnRleHQuZm5BcnJheSwKICAgICAgICAgIGFyZ3NBcnJheSA9IGNvbnRleHQuYXJnc0FycmF5OwogICAgICAgIHZhciBpRmlyc3RTYXZlID0gY29udGV4dC5pQ3VyciAtIDQ7CiAgICAgICAgdmFyIHBvcyA9IChpIC0gaUZpcnN0U2F2ZSkgJSA1OwoKICAgICAgICBzd2l0Y2ggKHBvcykgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICByZXR1cm4gZm5BcnJheVtpXSA9PT0gX3V0aWwuT1BTLmJlZ2luVGV4dDsKCiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIHJldHVybiBmbkFycmF5W2ldID09PSBfdXRpbC5PUFMuc2V0Rm9udDsKCiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIHJldHVybiBmbkFycmF5W2ldID09PSBfdXRpbC5PUFMuc2V0VGV4dE1hdHJpeDsKCiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIGlmIChmbkFycmF5W2ldICE9PSBfdXRpbC5PUFMuc2hvd1RleHQpIHsKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBpRmlyc3RTZXRGb250ID0gY29udGV4dC5pQ3VyciAtIDM7CiAgICAgICAgICAgIHZhciBmaXJzdFNldEZvbnRBcmcwID0gYXJnc0FycmF5W2lGaXJzdFNldEZvbnRdWzBdOwogICAgICAgICAgICB2YXIgZmlyc3RTZXRGb250QXJnMSA9IGFyZ3NBcnJheVtpRmlyc3RTZXRGb250XVsxXTsKCiAgICAgICAgICAgIGlmIChhcmdzQXJyYXlbaV1bMF0gIT09IGZpcnN0U2V0Rm9udEFyZzAgfHwgYXJnc0FycmF5W2ldWzFdICE9PSBmaXJzdFNldEZvbnRBcmcxKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCiAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgIHJldHVybiBmbkFycmF5W2ldID09PSBfdXRpbC5PUFMuZW5kVGV4dDsKICAgICAgICB9CgogICAgICAgIHRocm93IG5ldyBFcnJvcigiaXRlcmF0ZVNob3dUZXh0R3JvdXAgLSBpbnZhbGlkIHBvczogIi5jb25jYXQocG9zKSk7CiAgICAgIH0sIGZ1bmN0aW9uIChjb250ZXh0LCBpKSB7CiAgICAgICAgdmFyIE1JTl9DSEFSU19JTl9CTE9DSyA9IDM7CiAgICAgICAgdmFyIE1BWF9DSEFSU19JTl9CTE9DSyA9IDEwMDA7CiAgICAgICAgdmFyIGZuQXJyYXkgPSBjb250ZXh0LmZuQXJyYXksCiAgICAgICAgICBhcmdzQXJyYXkgPSBjb250ZXh0LmFyZ3NBcnJheTsKICAgICAgICB2YXIgY3VyciA9IGNvbnRleHQuaUN1cnI7CiAgICAgICAgdmFyIGlGaXJzdEJlZ2luVGV4dCA9IGN1cnIgLSA0OwogICAgICAgIHZhciBpRmlyc3RTZXRGb250ID0gY3VyciAtIDM7CiAgICAgICAgdmFyIGlGaXJzdFNldFRleHRNYXRyaXggPSBjdXJyIC0gMjsKICAgICAgICB2YXIgaUZpcnN0U2hvd1RleHQgPSBjdXJyIC0gMTsKICAgICAgICB2YXIgaUZpcnN0RW5kVGV4dCA9IGN1cnI7CiAgICAgICAgdmFyIGZpcnN0U2V0Rm9udEFyZzAgPSBhcmdzQXJyYXlbaUZpcnN0U2V0Rm9udF1bMF07CiAgICAgICAgdmFyIGZpcnN0U2V0Rm9udEFyZzEgPSBhcmdzQXJyYXlbaUZpcnN0U2V0Rm9udF1bMV07CiAgICAgICAgdmFyIGNvdW50ID0gTWF0aC5taW4oTWF0aC5mbG9vcigoaSAtIGlGaXJzdEJlZ2luVGV4dCkgLyA1KSwgTUFYX0NIQVJTX0lOX0JMT0NLKTsKCiAgICAgICAgaWYgKGNvdW50IDwgTUlOX0NIQVJTX0lOX0JMT0NLKSB7CiAgICAgICAgICByZXR1cm4gaSAtIChpIC0gaUZpcnN0QmVnaW5UZXh0KSAlIDU7CiAgICAgICAgfQoKICAgICAgICB2YXIgaUZpcnN0ID0gaUZpcnN0QmVnaW5UZXh0OwoKICAgICAgICBpZiAoaUZpcnN0QmVnaW5UZXh0ID49IDQgJiYgZm5BcnJheVtpRmlyc3RCZWdpblRleHQgLSA0XSA9PT0gZm5BcnJheVtpRmlyc3RTZXRGb250XSAmJiBmbkFycmF5W2lGaXJzdEJlZ2luVGV4dCAtIDNdID09PSBmbkFycmF5W2lGaXJzdFNldFRleHRNYXRyaXhdICYmIGZuQXJyYXlbaUZpcnN0QmVnaW5UZXh0IC0gMl0gPT09IGZuQXJyYXlbaUZpcnN0U2hvd1RleHRdICYmIGZuQXJyYXlbaUZpcnN0QmVnaW5UZXh0IC0gMV0gPT09IGZuQXJyYXlbaUZpcnN0RW5kVGV4dF0gJiYgYXJnc0FycmF5W2lGaXJzdEJlZ2luVGV4dCAtIDRdWzBdID09PSBmaXJzdFNldEZvbnRBcmcwICYmIGFyZ3NBcnJheVtpRmlyc3RCZWdpblRleHQgLSA0XVsxXSA9PT0gZmlyc3RTZXRGb250QXJnMSkgewogICAgICAgICAgY291bnQrKzsKICAgICAgICAgIGlGaXJzdCAtPSA1OwogICAgICAgIH0KCiAgICAgICAgdmFyIGlFbmRUZXh0ID0gaUZpcnN0ICsgNDsKCiAgICAgICAgZm9yICh2YXIgcSA9IDE7IHEgPCBjb3VudDsgcSsrKSB7CiAgICAgICAgICBmbkFycmF5LnNwbGljZShpRW5kVGV4dCwgMyk7CiAgICAgICAgICBhcmdzQXJyYXkuc3BsaWNlKGlFbmRUZXh0LCAzKTsKICAgICAgICAgIGlFbmRUZXh0ICs9IDI7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gaUVuZFRleHQgKyAxOwogICAgICB9KTsKCiAgICAgIGZ1bmN0aW9uIFF1ZXVlT3B0aW1pemVyKHF1ZXVlKSB7CiAgICAgICAgdGhpcy5xdWV1ZSA9IHF1ZXVlOwogICAgICAgIHRoaXMuc3RhdGUgPSBudWxsOwogICAgICAgIHRoaXMuY29udGV4dCA9IHsKICAgICAgICAgIGlDdXJyOiAwLAogICAgICAgICAgZm5BcnJheTogcXVldWUuZm5BcnJheSwKICAgICAgICAgIGFyZ3NBcnJheTogcXVldWUuYXJnc0FycmF5CiAgICAgICAgfTsKICAgICAgICB0aGlzLm1hdGNoID0gbnVsbDsKICAgICAgICB0aGlzLmxhc3RQcm9jZXNzZWQgPSAwOwogICAgICB9CgogICAgICBRdWV1ZU9wdGltaXplci5wcm90b3R5cGUgPSB7CiAgICAgICAgX29wdGltaXplOiBmdW5jdGlvbiBfb3B0aW1pemUoKSB7CiAgICAgICAgICB2YXIgZm5BcnJheSA9IHRoaXMucXVldWUuZm5BcnJheTsKICAgICAgICAgIHZhciBpID0gdGhpcy5sYXN0UHJvY2Vzc2VkLAogICAgICAgICAgICBpaSA9IGZuQXJyYXkubGVuZ3RoOwogICAgICAgICAgdmFyIHN0YXRlID0gdGhpcy5zdGF0ZTsKICAgICAgICAgIHZhciBtYXRjaCA9IHRoaXMubWF0Y2g7CgogICAgICAgICAgaWYgKCFzdGF0ZSAmJiAhbWF0Y2ggJiYgaSArIDEgPT09IGlpICYmICFJbml0aWFsU3RhdGVbZm5BcnJheVtpXV0pIHsKICAgICAgICAgICAgdGhpcy5sYXN0UHJvY2Vzc2VkID0gaWk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgY29udGV4dCA9IHRoaXMuY29udGV4dDsKCiAgICAgICAgICB3aGlsZSAoaSA8IGlpKSB7CiAgICAgICAgICAgIGlmIChtYXRjaCkgewogICAgICAgICAgICAgIHZhciBpdGVyYXRlID0gKDAsIG1hdGNoLml0ZXJhdGVGbikoY29udGV4dCwgaSk7CgogICAgICAgICAgICAgIGlmIChpdGVyYXRlKSB7CiAgICAgICAgICAgICAgICBpKys7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGkgPSAoMCwgbWF0Y2gucHJvY2Vzc0ZuKShjb250ZXh0LCBpICsgMSk7CiAgICAgICAgICAgICAgaWkgPSBmbkFycmF5Lmxlbmd0aDsKICAgICAgICAgICAgICBtYXRjaCA9IG51bGw7CiAgICAgICAgICAgICAgc3RhdGUgPSBudWxsOwoKICAgICAgICAgICAgICBpZiAoaSA+PSBpaSkgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBzdGF0ZSA9IChzdGF0ZSB8fCBJbml0aWFsU3RhdGUpW2ZuQXJyYXlbaV1dOwoKICAgICAgICAgICAgaWYgKCFzdGF0ZSB8fCBBcnJheS5pc0FycmF5KHN0YXRlKSkgewogICAgICAgICAgICAgIGkrKzsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29udGV4dC5pQ3VyciA9IGk7CiAgICAgICAgICAgIGkrKzsKCiAgICAgICAgICAgIGlmIChzdGF0ZS5jaGVja0ZuICYmICEoMCwgc3RhdGUuY2hlY2tGbikoY29udGV4dCkpIHsKICAgICAgICAgICAgICBzdGF0ZSA9IG51bGw7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1hdGNoID0gc3RhdGU7CiAgICAgICAgICAgIHN0YXRlID0gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnN0YXRlID0gc3RhdGU7CiAgICAgICAgICB0aGlzLm1hdGNoID0gbWF0Y2g7CiAgICAgICAgICB0aGlzLmxhc3RQcm9jZXNzZWQgPSBpOwogICAgICAgIH0sCiAgICAgICAgcHVzaDogZnVuY3Rpb24gcHVzaChmbiwgYXJncykgewogICAgICAgICAgdGhpcy5xdWV1ZS5mbkFycmF5LnB1c2goZm4pOwogICAgICAgICAgdGhpcy5xdWV1ZS5hcmdzQXJyYXkucHVzaChhcmdzKTsKCiAgICAgICAgICB0aGlzLl9vcHRpbWl6ZSgpOwogICAgICAgIH0sCiAgICAgICAgZmx1c2g6IGZ1bmN0aW9uIGZsdXNoKCkgewogICAgICAgICAgd2hpbGUgKHRoaXMubWF0Y2gpIHsKICAgICAgICAgICAgdmFyIGxlbmd0aCA9IHRoaXMucXVldWUuZm5BcnJheS5sZW5ndGg7CiAgICAgICAgICAgIHRoaXMubGFzdFByb2Nlc3NlZCA9ICgwLCB0aGlzLm1hdGNoLnByb2Nlc3NGbikodGhpcy5jb250ZXh0LCBsZW5ndGgpOwogICAgICAgICAgICB0aGlzLm1hdGNoID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5zdGF0ZSA9IG51bGw7CgogICAgICAgICAgICB0aGlzLl9vcHRpbWl6ZSgpOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uIHJlc2V0KCkgewogICAgICAgICAgdGhpcy5zdGF0ZSA9IG51bGw7CiAgICAgICAgICB0aGlzLm1hdGNoID0gbnVsbDsKICAgICAgICAgIHRoaXMubGFzdFByb2Nlc3NlZCA9IDA7CiAgICAgICAgfQogICAgICB9OwogICAgICByZXR1cm4gUXVldWVPcHRpbWl6ZXI7CiAgICB9KCk7CgogICAgdmFyIE51bGxPcHRpbWl6ZXIgPSBmdW5jdGlvbiBOdWxsT3B0aW1pemVyQ2xvc3VyZSgpIHsKICAgICAgZnVuY3Rpb24gTnVsbE9wdGltaXplcihxdWV1ZSkgewogICAgICAgIHRoaXMucXVldWUgPSBxdWV1ZTsKICAgICAgfQoKICAgICAgTnVsbE9wdGltaXplci5wcm90b3R5cGUgPSB7CiAgICAgICAgcHVzaDogZnVuY3Rpb24gcHVzaChmbiwgYXJncykgewogICAgICAgICAgdGhpcy5xdWV1ZS5mbkFycmF5LnB1c2goZm4pOwogICAgICAgICAgdGhpcy5xdWV1ZS5hcmdzQXJyYXkucHVzaChhcmdzKTsKICAgICAgICB9LAogICAgICAgIGZsdXNoOiBmdW5jdGlvbiBmbHVzaCgpIHt9LAogICAgICAgIHJlc2V0OiBmdW5jdGlvbiByZXNldCgpIHt9CiAgICAgIH07CiAgICAgIHJldHVybiBOdWxsT3B0aW1pemVyOwogICAgfSgpOwoKICAgIHZhciBPcGVyYXRvckxpc3QgPSBmdW5jdGlvbiBPcGVyYXRvckxpc3RDbG9zdXJlKCkgewogICAgICB2YXIgQ0hVTktfU0laRSA9IDEwMDA7CiAgICAgIHZhciBDSFVOS19TSVpFX0FCT1VUID0gQ0hVTktfU0laRSAtIDU7CgogICAgICBmdW5jdGlvbiBPcGVyYXRvckxpc3QoaW50ZW50LCBzdHJlYW1TaW5rLCBwYWdlSW5kZXgpIHsKICAgICAgICB0aGlzLl9zdHJlYW1TaW5rID0gc3RyZWFtU2luazsKICAgICAgICB0aGlzLmZuQXJyYXkgPSBbXTsKICAgICAgICB0aGlzLmFyZ3NBcnJheSA9IFtdOwoKICAgICAgICBpZiAoc3RyZWFtU2luayAmJiBpbnRlbnQgIT09ICJvcGxpc3QiKSB7CiAgICAgICAgICB0aGlzLm9wdGltaXplciA9IG5ldyBRdWV1ZU9wdGltaXplcih0aGlzKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5vcHRpbWl6ZXIgPSBuZXcgTnVsbE9wdGltaXplcih0aGlzKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuZGVwZW5kZW5jaWVzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICB0aGlzLl90b3RhbExlbmd0aCA9IDA7CiAgICAgICAgdGhpcy5wYWdlSW5kZXggPSBwYWdlSW5kZXg7CiAgICAgICAgdGhpcy5pbnRlbnQgPSBpbnRlbnQ7CiAgICAgICAgdGhpcy53ZWlnaHQgPSAwOwogICAgICAgIHRoaXMuX3Jlc29sdmVkID0gc3RyZWFtU2luayA/IG51bGwgOiBQcm9taXNlLnJlc29sdmUoKTsKICAgICAgfQoKICAgICAgT3BlcmF0b3JMaXN0LnByb3RvdHlwZSA9IHsKICAgICAgICBnZXQgbGVuZ3RoKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuYXJnc0FycmF5Lmxlbmd0aDsKICAgICAgICB9LAoKICAgICAgICBnZXQgcmVhZHkoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fcmVzb2x2ZWQgfHwgdGhpcy5fc3RyZWFtU2luay5yZWFkeTsKICAgICAgICB9LAoKICAgICAgICBnZXQgdG90YWxMZW5ndGgoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fdG90YWxMZW5ndGggKyB0aGlzLmxlbmd0aDsKICAgICAgICB9LAoKICAgICAgICBhZGRPcDogZnVuY3Rpb24gYWRkT3AoZm4sIGFyZ3MpIHsKICAgICAgICAgIHRoaXMub3B0aW1pemVyLnB1c2goZm4sIGFyZ3MpOwogICAgICAgICAgdGhpcy53ZWlnaHQrKzsKCiAgICAgICAgICBpZiAodGhpcy5fc3RyZWFtU2luaykgewogICAgICAgICAgICBpZiAodGhpcy53ZWlnaHQgPj0gQ0hVTktfU0laRSkgewogICAgICAgICAgICAgIHRoaXMuZmx1c2goKTsKICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLndlaWdodCA+PSBDSFVOS19TSVpFX0FCT1VUICYmIChmbiA9PT0gX3V0aWwuT1BTLnJlc3RvcmUgfHwgZm4gPT09IF91dGlsLk9QUy5lbmRUZXh0KSkgewogICAgICAgICAgICAgIHRoaXMuZmx1c2goKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYWRkRGVwZW5kZW5jeTogZnVuY3Rpb24gYWRkRGVwZW5kZW5jeShkZXBlbmRlbmN5KSB7CiAgICAgICAgICBpZiAoZGVwZW5kZW5jeSBpbiB0aGlzLmRlcGVuZGVuY2llcykgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5kZXBlbmRlbmNpZXNbZGVwZW5kZW5jeV0gPSB0cnVlOwogICAgICAgICAgdGhpcy5hZGRPcChfdXRpbC5PUFMuZGVwZW5kZW5jeSwgW2RlcGVuZGVuY3ldKTsKICAgICAgICB9LAogICAgICAgIGFkZERlcGVuZGVuY2llczogZnVuY3Rpb24gYWRkRGVwZW5kZW5jaWVzKGRlcGVuZGVuY2llcykgewogICAgICAgICAgZm9yICh2YXIga2V5IGluIGRlcGVuZGVuY2llcykgewogICAgICAgICAgICB0aGlzLmFkZERlcGVuZGVuY3koa2V5KTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFkZE9wTGlzdDogZnVuY3Rpb24gYWRkT3BMaXN0KG9wTGlzdCkgewogICAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLmRlcGVuZGVuY2llcywgb3BMaXN0LmRlcGVuZGVuY2llcyk7CgogICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gb3BMaXN0Lmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgdGhpcy5hZGRPcChvcExpc3QuZm5BcnJheVtpXSwgb3BMaXN0LmFyZ3NBcnJheVtpXSk7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBnZXRJUjogZnVuY3Rpb24gZ2V0SVIoKSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBmbkFycmF5OiB0aGlzLmZuQXJyYXksCiAgICAgICAgICAgIGFyZ3NBcnJheTogdGhpcy5hcmdzQXJyYXksCiAgICAgICAgICAgIGxlbmd0aDogdGhpcy5sZW5ndGgKICAgICAgICAgIH07CiAgICAgICAgfSwKCiAgICAgICAgZ2V0IF90cmFuc2ZlcnMoKSB7CiAgICAgICAgICB2YXIgdHJhbnNmZXJzID0gW107CiAgICAgICAgICB2YXIgZm5BcnJheSA9IHRoaXMuZm5BcnJheSwKICAgICAgICAgICAgYXJnc0FycmF5ID0gdGhpcy5hcmdzQXJyYXksCiAgICAgICAgICAgIGxlbmd0aCA9IHRoaXMubGVuZ3RoOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc3dpdGNoIChmbkFycmF5W2ldKSB7CiAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMucGFpbnRJbmxpbmVJbWFnZVhPYmplY3Q6CiAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMucGFpbnRJbmxpbmVJbWFnZVhPYmplY3RHcm91cDoKICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5wYWludEltYWdlTWFza1hPYmplY3Q6CiAgICAgICAgICAgICAgICB2YXIgYXJnID0gYXJnc0FycmF5W2ldWzBdOwogICAgICAgICAgICAgICAgOwoKICAgICAgICAgICAgICAgIGlmICghYXJnLmNhY2hlZCkgewogICAgICAgICAgICAgICAgICB0cmFuc2ZlcnMucHVzaChhcmcuZGF0YS5idWZmZXIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHRyYW5zZmVyczsKICAgICAgICB9LAoKICAgICAgICBmbHVzaDogZnVuY3Rpb24gZmx1c2goKSB7CiAgICAgICAgICB2YXIgbGFzdENodW5rID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBmYWxzZTsKICAgICAgICAgIHRoaXMub3B0aW1pemVyLmZsdXNoKCk7CiAgICAgICAgICB2YXIgbGVuZ3RoID0gdGhpcy5sZW5ndGg7CiAgICAgICAgICB0aGlzLl90b3RhbExlbmd0aCArPSBsZW5ndGg7CgogICAgICAgICAgdGhpcy5fc3RyZWFtU2luay5lbnF1ZXVlKHsKICAgICAgICAgICAgZm5BcnJheTogdGhpcy5mbkFycmF5LAogICAgICAgICAgICBhcmdzQXJyYXk6IHRoaXMuYXJnc0FycmF5LAogICAgICAgICAgICBsYXN0Q2h1bms6IGxhc3RDaHVuaywKICAgICAgICAgICAgbGVuZ3RoOiBsZW5ndGgKICAgICAgICAgIH0sIDEsIHRoaXMuX3RyYW5zZmVycyk7CgogICAgICAgICAgdGhpcy5kZXBlbmRlbmNpZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgICAgdGhpcy5mbkFycmF5Lmxlbmd0aCA9IDA7CiAgICAgICAgICB0aGlzLmFyZ3NBcnJheS5sZW5ndGggPSAwOwogICAgICAgICAgdGhpcy53ZWlnaHQgPSAwOwogICAgICAgICAgdGhpcy5vcHRpbWl6ZXIucmVzZXQoKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHJldHVybiBPcGVyYXRvckxpc3Q7CiAgICB9KCk7CgogICAgZXhwb3J0cy5PcGVyYXRvckxpc3QgPSBPcGVyYXRvckxpc3Q7CgogICAgLyoqKi99KSwgKAogIC8qIDIxNSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCgogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICB2YWx1ZTogdHJ1ZQogICAgfSk7CiAgICBleHBvcnRzLlBhcnRpYWxFdmFsdWF0b3IgPSB2b2lkIDA7CgogICAgdmFyIF9yZWdlbmVyYXRvciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX193X3BkZmpzX3JlcXVpcmVfXygyKSk7CgogICAgdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXyg1KTsKCiAgICB2YXIgX2NtYXAgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIxNik7CgogICAgdmFyIF9wcmltaXRpdmVzID0gX193X3BkZmpzX3JlcXVpcmVfXygxOTQpOwoKICAgIHZhciBfZm9udHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIxNyk7CgogICAgdmFyIF9lbmNvZGluZ3MgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIyMCk7CgogICAgdmFyIF9jb3JlX3V0aWxzID0gX193X3BkZmpzX3JlcXVpcmVfXygxOTcpOwoKICAgIHZhciBfdW5pY29kZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjIzKTsKCiAgICB2YXIgX3N0YW5kYXJkX2ZvbnRzID0gX193X3BkZmpzX3JlcXVpcmVfXygyMjIpOwoKICAgIHZhciBfcGF0dGVybiA9IF9fd19wZGZqc19yZXF1aXJlX18oMjI2KTsKCiAgICB2YXIgX3BhcnNlciA9IF9fd19wZGZqc19yZXF1aXJlX18oMjAwKTsKCiAgICB2YXIgX2JpZGkgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIyNyk7CgogICAgdmFyIF9jb2xvcnNwYWNlID0gX193X3BkZmpzX3JlcXVpcmVfXygyMTIpOwoKICAgIHZhciBfc3RyZWFtID0gX193X3BkZmpzX3JlcXVpcmVfXygyMDEpOwoKICAgIHZhciBfZ2x5cGhsaXN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygyMjEpOwoKICAgIHZhciBfbWV0cmljcyA9IF9fd19wZGZqc19yZXF1aXJlX18oMjI4KTsKCiAgICB2YXIgX2Z1bmN0aW9uID0gX193X3BkZmpzX3JlcXVpcmVfXygyMjkpOwoKICAgIHZhciBfanBlZ19zdHJlYW0gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIwNyk7CgogICAgdmFyIF9tdXJtdXJoYXNoID0gX193X3BkZmpzX3JlcXVpcmVfXygyMzEpOwoKICAgIHZhciBfaW1hZ2VfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIzMik7CgogICAgdmFyIF9vcGVyYXRvcl9saXN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygyMTQpOwoKICAgIHZhciBfaW1hZ2UgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIzMyk7CgogICAgZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHtyZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyAiZGVmYXVsdCI6IG9iaiB9O30KCiAgICBmdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7dHJ5IHt2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7dmFyIHZhbHVlID0gaW5mby52YWx1ZTt9IGNhdGNoIChlcnJvcikge3JlamVjdChlcnJvcik7cmV0dXJuO31pZiAoaW5mby5kb25lKSB7cmVzb2x2ZSh2YWx1ZSk7fSBlbHNlIHtQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oX25leHQsIF90aHJvdyk7fX0KCiAgICBmdW5jdGlvbiBfYXN5bmNUb0dlbmVyYXRvcihmbikge3JldHVybiBmdW5jdGlvbiAoKSB7dmFyIHNlbGYgPSB0aGlzLGFyZ3MgPSBhcmd1bWVudHM7cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHt2YXIgZ2VuID0gZm4uYXBwbHkoc2VsZiwgYXJncyk7ZnVuY3Rpb24gX25leHQodmFsdWUpIHthc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJuZXh0IiwgdmFsdWUpO31mdW5jdGlvbiBfdGhyb3coZXJyKSB7YXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAidGhyb3ciLCBlcnIpO31fbmV4dCh1bmRlZmluZWQpO30pO307fQoKICAgIHZhciBQYXJ0aWFsRXZhbHVhdG9yID0gZnVuY3Rpb24gUGFydGlhbEV2YWx1YXRvckNsb3N1cmUoKSB7CiAgICAgIHZhciBEZWZhdWx0UGFydGlhbEV2YWx1YXRvck9wdGlvbnMgPSB7CiAgICAgICAgZm9yY2VEYXRhU2NoZW1hOiBmYWxzZSwKICAgICAgICBtYXhJbWFnZVNpemU6IC0xLAogICAgICAgIGRpc2FibGVGb250RmFjZTogZmFsc2UsCiAgICAgICAgbmF0aXZlSW1hZ2VEZWNvZGVyU3VwcG9ydDogX3V0aWwuTmF0aXZlSW1hZ2VEZWNvZGluZy5ERUNPREUsCiAgICAgICAgaWdub3JlRXJyb3JzOiBmYWxzZSwKICAgICAgICBpc0V2YWxTdXBwb3J0ZWQ6IHRydWUKICAgICAgfTsKCiAgICAgIGZ1bmN0aW9uIFBhcnRpYWxFdmFsdWF0b3IoX3JlZikgewogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAgIHZhciB4cmVmID0gX3JlZi54cmVmLAogICAgICAgICAgaGFuZGxlciA9IF9yZWYuaGFuZGxlciwKICAgICAgICAgIHBhZ2VJbmRleCA9IF9yZWYucGFnZUluZGV4LAogICAgICAgICAgaWRGYWN0b3J5ID0gX3JlZi5pZEZhY3RvcnksCiAgICAgICAgICBmb250Q2FjaGUgPSBfcmVmLmZvbnRDYWNoZSwKICAgICAgICAgIGJ1aWx0SW5DTWFwQ2FjaGUgPSBfcmVmLmJ1aWx0SW5DTWFwQ2FjaGUsCiAgICAgICAgICBfcmVmJG9wdGlvbnMgPSBfcmVmLm9wdGlvbnMsCiAgICAgICAgICBvcHRpb25zID0gX3JlZiRvcHRpb25zID09PSB2b2lkIDAgPyBudWxsIDogX3JlZiRvcHRpb25zLAogICAgICAgICAgcGRmRnVuY3Rpb25GYWN0b3J5ID0gX3JlZi5wZGZGdW5jdGlvbkZhY3Rvcnk7CiAgICAgICAgdGhpcy54cmVmID0geHJlZjsKICAgICAgICB0aGlzLmhhbmRsZXIgPSBoYW5kbGVyOwogICAgICAgIHRoaXMucGFnZUluZGV4ID0gcGFnZUluZGV4OwogICAgICAgIHRoaXMuaWRGYWN0b3J5ID0gaWRGYWN0b3J5OwogICAgICAgIHRoaXMuZm9udENhY2hlID0gZm9udENhY2hlOwogICAgICAgIHRoaXMuYnVpbHRJbkNNYXBDYWNoZSA9IGJ1aWx0SW5DTWFwQ2FjaGU7CiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucyB8fCBEZWZhdWx0UGFydGlhbEV2YWx1YXRvck9wdGlvbnM7CiAgICAgICAgdGhpcy5wZGZGdW5jdGlvbkZhY3RvcnkgPSBwZGZGdW5jdGlvbkZhY3Rvcnk7CiAgICAgICAgdGhpcy5wYXJzaW5nVHlwZTNGb250ID0gZmFsc2U7CgogICAgICAgIHRoaXMuZmV0Y2hCdWlsdEluQ01hcCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgX3JlZjIgPSBfYXN5bmNUb0dlbmVyYXRvcigvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yWyJkZWZhdWx0Il0ubWFyayhmdW5jdGlvbiBfY2FsbGVlKG5hbWUpIHsKICAgICAgICAgICAgdmFyIHJlYWRhYmxlU3RyZWFtLCByZWFkZXIsIGRhdGE7CiAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JbImRlZmF1bHQiXS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIGlmICghX3RoaXMuYnVpbHRJbkNNYXBDYWNoZS5oYXMobmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBfdGhpcy5idWlsdEluQ01hcENhY2hlLmdldChuYW1lKSk7CgogICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgcmVhZGFibGVTdHJlYW0gPSBfdGhpcy5oYW5kbGVyLnNlbmRXaXRoU3RyZWFtKCJGZXRjaEJ1aWx0SW5DTWFwIiwgewogICAgICAgICAgICAgICAgICAgICAgbmFtZTogbmFtZQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHJlYWRlciA9IHJlYWRhYmxlU3RyZWFtLmdldFJlYWRlcigpOwogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA2OwogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBwdW1wKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZWFkZXIucmVhZCgpLnRoZW4oZnVuY3Rpb24gKF9yZWYzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gX3JlZjMudmFsdWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb25lID0gX3JlZjMuZG9uZTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRvbmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUodmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgIHB1bXAoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSwgcmVqZWN0KTsKICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICBwdW1wKCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IF9jb250ZXh0LnNlbnQ7CgogICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmNvbXByZXNzaW9uVHlwZSAhPT0gX3V0aWwuQ01hcENvbXByZXNzaW9uVHlwZS5OT05FKSB7CiAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5idWlsdEluQ01hcENhY2hlLnNldChuYW1lLCBkYXRhKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIGRhdGEpOwoKICAgICAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBfY2FsbGVlKTsKICAgICAgICAgIH0pKTsKCiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKF94KSB7CiAgICAgICAgICAgIHJldHVybiBfcmVmMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgfTsKICAgICAgICB9KCk7CiAgICAgIH0KCiAgICAgIHZhciBUSU1FX1NMT1RfRFVSQVRJT05fTVMgPSAyMDsKICAgICAgdmFyIENIRUNLX1RJTUVfRVZFUlkgPSAxMDA7CgogICAgICBmdW5jdGlvbiBUaW1lU2xvdE1hbmFnZXIoKSB7CiAgICAgICAgdGhpcy5yZXNldCgpOwogICAgICB9CgogICAgICBUaW1lU2xvdE1hbmFnZXIucHJvdG90eXBlID0gewogICAgICAgIGNoZWNrOiBmdW5jdGlvbiBUaW1lU2xvdE1hbmFnZXJfY2hlY2soKSB7CiAgICAgICAgICBpZiAoKyt0aGlzLmNoZWNrZWQgPCBDSEVDS19USU1FX0VWRVJZKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLmNoZWNrZWQgPSAwOwogICAgICAgICAgcmV0dXJuIHRoaXMuZW5kVGltZSA8PSBEYXRlLm5vdygpOwogICAgICAgIH0sCiAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uIFRpbWVTbG90TWFuYWdlcl9yZXNldCgpIHsKICAgICAgICAgIHRoaXMuZW5kVGltZSA9IERhdGUubm93KCkgKyBUSU1FX1NMT1RfRFVSQVRJT05fTVM7CiAgICAgICAgICB0aGlzLmNoZWNrZWQgPSAwOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIGZ1bmN0aW9uIG5vcm1hbGl6ZUJsZW5kTW9kZSh2YWx1ZSkgewogICAgICAgIHZhciBwYXJzaW5nQXJyYXkgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwoKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHsKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IHZhbHVlLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgdmFyIG1heWJlQk0gPSBub3JtYWxpemVCbGVuZE1vZGUodmFsdWVbaV0sIHRydWUpOwoKICAgICAgICAgICAgaWYgKG1heWJlQk0pIHsKICAgICAgICAgICAgICByZXR1cm4gbWF5YmVCTTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiVW5zdXBwb3J0ZWQgYmxlbmQgbW9kZSBBcnJheTogIi5jb25jYXQodmFsdWUpKTsKICAgICAgICAgIHJldHVybiAic291cmNlLW92ZXIiOwogICAgICAgIH0KCiAgICAgICAgaWYgKCEoMCwgX3ByaW1pdGl2ZXMuaXNOYW1lKSh2YWx1ZSkpIHsKICAgICAgICAgIGlmIChwYXJzaW5nQXJyYXkpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuICJzb3VyY2Utb3ZlciI7CiAgICAgICAgfQoKICAgICAgICBzd2l0Y2ggKHZhbHVlLm5hbWUpIHsKICAgICAgICAgIGNhc2UgIk5vcm1hbCI6CiAgICAgICAgICBjYXNlICJDb21wYXRpYmxlIjoKICAgICAgICAgICAgcmV0dXJuICJzb3VyY2Utb3ZlciI7CgogICAgICAgICAgY2FzZSAiTXVsdGlwbHkiOgogICAgICAgICAgICByZXR1cm4gIm11bHRpcGx5IjsKCiAgICAgICAgICBjYXNlICJTY3JlZW4iOgogICAgICAgICAgICByZXR1cm4gInNjcmVlbiI7CgogICAgICAgICAgY2FzZSAiT3ZlcmxheSI6CiAgICAgICAgICAgIHJldHVybiAib3ZlcmxheSI7CgogICAgICAgICAgY2FzZSAiRGFya2VuIjoKICAgICAgICAgICAgcmV0dXJuICJkYXJrZW4iOwoKICAgICAgICAgIGNhc2UgIkxpZ2h0ZW4iOgogICAgICAgICAgICByZXR1cm4gImxpZ2h0ZW4iOwoKICAgICAgICAgIGNhc2UgIkNvbG9yRG9kZ2UiOgogICAgICAgICAgICByZXR1cm4gImNvbG9yLWRvZGdlIjsKCiAgICAgICAgICBjYXNlICJDb2xvckJ1cm4iOgogICAgICAgICAgICByZXR1cm4gImNvbG9yLWJ1cm4iOwoKICAgICAgICAgIGNhc2UgIkhhcmRMaWdodCI6CiAgICAgICAgICAgIHJldHVybiAiaGFyZC1saWdodCI7CgogICAgICAgICAgY2FzZSAiU29mdExpZ2h0IjoKICAgICAgICAgICAgcmV0dXJuICJzb2Z0LWxpZ2h0IjsKCiAgICAgICAgICBjYXNlICJEaWZmZXJlbmNlIjoKICAgICAgICAgICAgcmV0dXJuICJkaWZmZXJlbmNlIjsKCiAgICAgICAgICBjYXNlICJFeGNsdXNpb24iOgogICAgICAgICAgICByZXR1cm4gImV4Y2x1c2lvbiI7CgogICAgICAgICAgY2FzZSAiSHVlIjoKICAgICAgICAgICAgcmV0dXJuICJodWUiOwoKICAgICAgICAgIGNhc2UgIlNhdHVyYXRpb24iOgogICAgICAgICAgICByZXR1cm4gInNhdHVyYXRpb24iOwoKICAgICAgICAgIGNhc2UgIkNvbG9yIjoKICAgICAgICAgICAgcmV0dXJuICJjb2xvciI7CgogICAgICAgICAgY2FzZSAiTHVtaW5vc2l0eSI6CiAgICAgICAgICAgIHJldHVybiAibHVtaW5vc2l0eSI7CiAgICAgICAgfQoKICAgICAgICBpZiAocGFyc2luZ0FycmF5KSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgICgwLCBfdXRpbC53YXJuKSgiVW5zdXBwb3J0ZWQgYmxlbmQgbW9kZTogIi5jb25jYXQodmFsdWUubmFtZSkpOwogICAgICAgIHJldHVybiAic291cmNlLW92ZXIiOwogICAgICB9CgogICAgICB2YXIgZGVmZXJyZWQgPSBQcm9taXNlLnJlc29sdmUoKTsKICAgICAgdmFyIFRJTElOR19QQVRURVJOID0gMSwKICAgICAgICBTSEFESU5HX1BBVFRFUk4gPSAyOwogICAgICBQYXJ0aWFsRXZhbHVhdG9yLnByb3RvdHlwZSA9IHsKICAgICAgICBjbG9uZTogZnVuY3Rpb24gY2xvbmUoKSB7CiAgICAgICAgICB2YXIgbmV3T3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogRGVmYXVsdFBhcnRpYWxFdmFsdWF0b3JPcHRpb25zOwogICAgICAgICAgdmFyIG5ld0V2YWx1YXRvciA9IE9iamVjdC5jcmVhdGUodGhpcyk7CiAgICAgICAgICBuZXdFdmFsdWF0b3Iub3B0aW9ucyA9IG5ld09wdGlvbnM7CiAgICAgICAgICByZXR1cm4gbmV3RXZhbHVhdG9yOwogICAgICAgIH0sCiAgICAgICAgaGFzQmxlbmRNb2RlczogZnVuY3Rpb24gUGFydGlhbEV2YWx1YXRvcl9oYXNCbGVuZE1vZGVzKHJlc291cmNlcykgewogICAgICAgICAgaWYgKCEocmVzb3VyY2VzIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBwcm9jZXNzZWQgPSBPYmplY3QuY3JlYXRlKG51bGwpOwoKICAgICAgICAgIGlmIChyZXNvdXJjZXMub2JqSWQpIHsKICAgICAgICAgICAgcHJvY2Vzc2VkW3Jlc291cmNlcy5vYmpJZF0gPSB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBub2RlcyA9IFtyZXNvdXJjZXNdLAogICAgICAgICAgICB4cmVmID0gdGhpcy54cmVmOwoKICAgICAgICAgIHdoaWxlIChub2Rlcy5sZW5ndGgpIHsKICAgICAgICAgICAgdmFyIG5vZGUgPSBub2Rlcy5zaGlmdCgpOwogICAgICAgICAgICB2YXIgZ3JhcGhpY1N0YXRlcyA9IG5vZGUuZ2V0KCJFeHRHU3RhdGUiKTsKCiAgICAgICAgICAgIGlmIChncmFwaGljU3RhdGVzIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkgewogICAgICAgICAgICAgIHZhciBncmFwaGljU3RhdGVzS2V5cyA9IGdyYXBoaWNTdGF0ZXMuZ2V0S2V5cygpOwoKICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBncmFwaGljU3RhdGVzS2V5cy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgICAgICB2YXIga2V5ID0gZ3JhcGhpY1N0YXRlc0tleXNbaV07CiAgICAgICAgICAgICAgICB2YXIgZ3JhcGhpY1N0YXRlID0gZ3JhcGhpY1N0YXRlcy5nZXRSYXcoa2V5KTsKCiAgICAgICAgICAgICAgICBpZiAoZ3JhcGhpY1N0YXRlIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuUmVmKSB7CiAgICAgICAgICAgICAgICAgIGlmIChwcm9jZXNzZWRbZ3JhcGhpY1N0YXRlLnRvU3RyaW5nKCldKSB7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgZ3JhcGhpY1N0YXRlID0geHJlZi5mZXRjaChncmFwaGljU3RhdGUpOwogICAgICAgICAgICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgICAgICAgICAgIGlmIChleCBpbnN0YW5jZW9mIF9jb3JlX3V0aWxzLk1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBleDsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuaWdub3JlRXJyb3JzKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoZ3JhcGhpY1N0YXRlIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuUmVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NlZFtncmFwaGljU3RhdGUudG9TdHJpbmcoKV0gPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlci5zZW5kKCJVbnN1cHBvcnRlZEZlYXR1cmUiLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZlYXR1cmVJZDogX3V0aWwuVU5TVVBQT1JURURfRkVBVFVSRVMudW5rbm93bgogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoImhhc0JsZW5kTW9kZXMgLSBpZ25vcmluZyBFeHRHU3RhdGU6IFwiIi5jb25jYXQoZXgsICJcIi4iKSk7CiAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHRocm93IGV4OwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCEoZ3JhcGhpY1N0YXRlIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkpIHsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGdyYXBoaWNTdGF0ZS5vYmpJZCkgewogICAgICAgICAgICAgICAgICBwcm9jZXNzZWRbZ3JhcGhpY1N0YXRlLm9iaklkXSA9IHRydWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdmFyIGJtID0gZ3JhcGhpY1N0YXRlLmdldCgiQk0iKTsKCiAgICAgICAgICAgICAgICBpZiAoYm0gaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lKSB7CiAgICAgICAgICAgICAgICAgIGlmIChibS5uYW1lICE9PSAiTm9ybWFsIikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoYm0gIT09IHVuZGVmaW5lZCAmJiBBcnJheS5pc0FycmF5KGJtKSkgewogICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMCwgamogPSBibS5sZW5ndGg7IGogPCBqajsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGJtW2pdIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuTmFtZSAmJiBibVtqXS5uYW1lICE9PSAiTm9ybWFsIikgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgeE9iamVjdHMgPSBub2RlLmdldCgiWE9iamVjdCIpOwoKICAgICAgICAgICAgaWYgKCEoeE9iamVjdHMgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0KSkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgeE9iamVjdHNLZXlzID0geE9iamVjdHMuZ2V0S2V5cygpOwoKICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfaWkgPSB4T2JqZWN0c0tleXMubGVuZ3RoOyBfaSA8IF9paTsgX2krKykgewogICAgICAgICAgICAgIHZhciBfa2V5ID0geE9iamVjdHNLZXlzW19pXTsKICAgICAgICAgICAgICB2YXIgeE9iamVjdCA9IHhPYmplY3RzLmdldFJhdyhfa2V5KTsKCiAgICAgICAgICAgICAgaWYgKHhPYmplY3QgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5SZWYpIHsKICAgICAgICAgICAgICAgIGlmIChwcm9jZXNzZWRbeE9iamVjdC50b1N0cmluZygpXSkgewogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICB4T2JqZWN0ID0geHJlZi5mZXRjaCh4T2JqZWN0KTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgICAgICAgICAgIGlmIChleCBpbnN0YW5jZW9mIF9jb3JlX3V0aWxzLk1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXg7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuaWdub3JlRXJyb3JzKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHhPYmplY3QgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5SZWYpIHsKICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NlZFt4T2JqZWN0LnRvU3RyaW5nKCldID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlci5zZW5kKCJVbnN1cHBvcnRlZEZlYXR1cmUiLCB7CiAgICAgICAgICAgICAgICAgICAgICBmZWF0dXJlSWQ6IF91dGlsLlVOU1VQUE9SVEVEX0ZFQVRVUkVTLnVua25vd24KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoImhhc0JsZW5kTW9kZXMgLSBpZ25vcmluZyBYT2JqZWN0OiBcIiIuY29uY2F0KGV4LCAiXCIuIikpOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB0aHJvdyBleDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICghKDAsIF9wcmltaXRpdmVzLmlzU3RyZWFtKSh4T2JqZWN0KSkgewogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoeE9iamVjdC5kaWN0Lm9iaklkKSB7CiAgICAgICAgICAgICAgICBpZiAocHJvY2Vzc2VkW3hPYmplY3QuZGljdC5vYmpJZF0pIHsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcHJvY2Vzc2VkW3hPYmplY3QuZGljdC5vYmpJZF0gPSB0cnVlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIHhSZXNvdXJjZXMgPSB4T2JqZWN0LmRpY3QuZ2V0KCJSZXNvdXJjZXMiKTsKCiAgICAgICAgICAgICAgaWYgKHhSZXNvdXJjZXMgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0ICYmICgheFJlc291cmNlcy5vYmpJZCB8fCAhcHJvY2Vzc2VkW3hSZXNvdXJjZXMub2JqSWRdKSkgewogICAgICAgICAgICAgICAgbm9kZXMucHVzaCh4UmVzb3VyY2VzKTsKCiAgICAgICAgICAgICAgICBpZiAoeFJlc291cmNlcy5vYmpJZCkgewogICAgICAgICAgICAgICAgICBwcm9jZXNzZWRbeFJlc291cmNlcy5vYmpJZF0gPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9LAogICAgICAgIGJ1aWxkRm9ybVhPYmplY3Q6IGZ1bmN0aW9uIGJ1aWxkRm9ybVhPYmplY3QocmVzb3VyY2VzLCB4b2JqLCBzbWFzaywgb3BlcmF0b3JMaXN0LCB0YXNrLCBpbml0aWFsU3RhdGUpIHsKICAgICAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvcigvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yWyJkZWZhdWx0Il0ubWFyayhmdW5jdGlvbiBfY2FsbGVlMigpIHsKICAgICAgICAgICAgdmFyIGRpY3QsIG1hdHJpeCwgYmJveCwgZ3JvdXAsIGdyb3VwT3B0aW9ucywgZ3JvdXBTdWJ0eXBlLCBjb2xvclNwYWNlOwogICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yWyJkZWZhdWx0Il0ud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgZGljdCA9IHhvYmouZGljdDsKICAgICAgICAgICAgICAgICAgICBtYXRyaXggPSBkaWN0LmdldEFycmF5KCJNYXRyaXgiKTsKICAgICAgICAgICAgICAgICAgICBiYm94ID0gZGljdC5nZXRBcnJheSgiQkJveCIpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShiYm94KSAmJiBiYm94Lmxlbmd0aCA9PT0gNCkgewogICAgICAgICAgICAgICAgICAgICAgYmJveCA9IF91dGlsLlV0aWwubm9ybWFsaXplUmVjdChiYm94KTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgYmJveCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBncm91cCA9IGRpY3QuZ2V0KCJHcm91cCIpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoIWdyb3VwKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDE4OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBncm91cE9wdGlvbnMgPSB7CiAgICAgICAgICAgICAgICAgICAgICBtYXRyaXg6IG1hdHJpeCwKICAgICAgICAgICAgICAgICAgICAgIGJib3g6IGJib3gsCiAgICAgICAgICAgICAgICAgICAgICBzbWFzazogc21hc2ssCiAgICAgICAgICAgICAgICAgICAgICBpc29sYXRlZDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICBrbm9ja291dDogZmFsc2UKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGdyb3VwU3VidHlwZSA9IGdyb3VwLmdldCgiUyIpOwogICAgICAgICAgICAgICAgICAgIGNvbG9yU3BhY2UgPSBudWxsOwoKICAgICAgICAgICAgICAgICAgICBpZiAoISgwLCBfcHJpbWl0aXZlcy5pc05hbWUpKGdyb3VwU3VidHlwZSwgIlRyYW5zcGFyZW5jeSIpKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDE2OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBncm91cE9wdGlvbnMuaXNvbGF0ZWQgPSBncm91cC5nZXQoIkkiKSB8fCBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBncm91cE9wdGlvbnMua25vY2tvdXQgPSBncm91cC5nZXQoIksiKSB8fCBmYWxzZTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCFncm91cC5oYXMoIkNTIikpIHsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTY7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTU7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMi5wYXJzZUNvbG9yU3BhY2UoewogICAgICAgICAgICAgICAgICAgICAgY3M6IGdyb3VwLmdldCgiQ1MiKSwKICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlczogcmVzb3VyY2VzCiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgICAgICAgIGNvbG9yU3BhY2UgPSBfY29udGV4dDIuc2VudDsKCiAgICAgICAgICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICAgICAgICAgICAgaWYgKHNtYXNrICYmIHNtYXNrLmJhY2tkcm9wKSB7CiAgICAgICAgICAgICAgICAgICAgICBjb2xvclNwYWNlID0gY29sb3JTcGFjZSB8fCBfY29sb3JzcGFjZS5Db2xvclNwYWNlLnNpbmdsZXRvbnMucmdiOwogICAgICAgICAgICAgICAgICAgICAgc21hc2suYmFja2Ryb3AgPSBjb2xvclNwYWNlLmdldFJnYihzbWFzay5iYWNrZHJvcCwgMCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBvcGVyYXRvckxpc3QuYWRkT3AoX3V0aWwuT1BTLmJlZ2luR3JvdXAsIFtncm91cE9wdGlvbnNdKTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgMTg6CiAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3JMaXN0LmFkZE9wKF91dGlsLk9QUy5wYWludEZvcm1YT2JqZWN0QmVnaW4sIFttYXRyaXgsIGJib3hdKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgX3RoaXMyLmdldE9wZXJhdG9yTGlzdCh7CiAgICAgICAgICAgICAgICAgICAgICBzdHJlYW06IHhvYmosCiAgICAgICAgICAgICAgICAgICAgICB0YXNrOiB0YXNrLAogICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VzOiBkaWN0LmdldCgiUmVzb3VyY2VzIikgfHwgcmVzb3VyY2VzLAogICAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3JMaXN0OiBvcGVyYXRvckxpc3QsCiAgICAgICAgICAgICAgICAgICAgICBpbml0aWFsU3RhdGU6IGluaXRpYWxTdGF0ZQogICAgICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3JMaXN0LmFkZE9wKF91dGlsLk9QUy5wYWludEZvcm1YT2JqZWN0RW5kLCBbXSk7CgogICAgICAgICAgICAgICAgICAgICAgaWYgKGdyb3VwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChfdXRpbC5PUFMuZW5kR3JvdXAsIFtncm91cE9wdGlvbnNdKTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgICAgICBjYXNlIDIwOgogICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgX2NhbGxlZTIpOwogICAgICAgICAgfSkpKCk7CiAgICAgICAgfSwKICAgICAgICBidWlsZFBhaW50SW1hZ2VYT2JqZWN0OiBmdW5jdGlvbiBidWlsZFBhaW50SW1hZ2VYT2JqZWN0KF9yZWY0KSB7CiAgICAgICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgICAgICB2YXIgcmVzb3VyY2VzID0gX3JlZjQucmVzb3VyY2VzLAogICAgICAgICAgICBpbWFnZSA9IF9yZWY0LmltYWdlLAogICAgICAgICAgICBfcmVmNCRpc0lubGluZSA9IF9yZWY0LmlzSW5saW5lLAogICAgICAgICAgICBpc0lubGluZSA9IF9yZWY0JGlzSW5saW5lID09PSB2b2lkIDAgPyBmYWxzZSA6IF9yZWY0JGlzSW5saW5lLAogICAgICAgICAgICBvcGVyYXRvckxpc3QgPSBfcmVmNC5vcGVyYXRvckxpc3QsCiAgICAgICAgICAgIGNhY2hlS2V5ID0gX3JlZjQuY2FjaGVLZXksCiAgICAgICAgICAgIGltYWdlQ2FjaGUgPSBfcmVmNC5pbWFnZUNhY2hlLAogICAgICAgICAgICBfcmVmNCRmb3JjZURpc2FibGVOYXQgPSBfcmVmNC5mb3JjZURpc2FibGVOYXRpdmVJbWFnZURlY29kZXIsCiAgICAgICAgICAgIGZvcmNlRGlzYWJsZU5hdGl2ZUltYWdlRGVjb2RlciA9IF9yZWY0JGZvcmNlRGlzYWJsZU5hdCA9PT0gdm9pZCAwID8gZmFsc2UgOiBfcmVmNCRmb3JjZURpc2FibGVOYXQ7CiAgICAgICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoLyojX19QVVJFX18qL19yZWdlbmVyYXRvclsiZGVmYXVsdCJdLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoKSB7CiAgICAgICAgICAgIHZhciBkaWN0LCB3LCBoLCBtYXhJbWFnZVNpemUsIGltYWdlTWFzaywgaW1nRGF0YSwgYXJncywgd2lkdGgsIGhlaWdodCwgYml0U3RyaWRlTGVuZ3RoLCBpbWdBcnJheSwgZGVjb2RlLCBzb2Z0TWFzaywgbWFzaywgU01BTExfSU1BR0VfRElNRU5TSU9OUywgaW1hZ2VPYmosIG5hdGl2ZUltYWdlRGVjb2RlclN1cHBvcnQsIG9iaklkLCBuYXRpdmVJbWFnZURlY29kZXIsIGltZ1Byb21pc2U7CiAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JbImRlZmF1bHQiXS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICBkaWN0ID0gaW1hZ2UuZGljdDsKICAgICAgICAgICAgICAgICAgICB3ID0gZGljdC5nZXQoIldpZHRoIiwgIlciKTsKICAgICAgICAgICAgICAgICAgICBoID0gZGljdC5nZXQoIkhlaWdodCIsICJIIik7CgogICAgICAgICAgICAgICAgICAgIGlmICghKCEodyAmJiAoMCwgX3V0aWwuaXNOdW0pKHcpKSB8fCAhKGggJiYgKDAsIF91dGlsLmlzTnVtKShoKSkpKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDY7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiSW1hZ2UgZGltZW5zaW9ucyBhcmUgbWlzc2luZywgb3Igbm90IG51bWJlcnMuIik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIHVuZGVmaW5lZCk7CgogICAgICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICAgICAgbWF4SW1hZ2VTaXplID0gX3RoaXMzLm9wdGlvbnMubWF4SW1hZ2VTaXplOwoKICAgICAgICAgICAgICAgICAgICBpZiAoIShtYXhJbWFnZVNpemUgIT09IC0xICYmIHcgKiBoID4gbWF4SW1hZ2VTaXplKSkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAxMDsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJJbWFnZSBleGNlZWRlZCBtYXhpbXVtIGFsbG93ZWQgc2l6ZSBhbmQgd2FzIHJlbW92ZWQuIik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIHVuZGVmaW5lZCk7CgogICAgICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgICAgIGltYWdlTWFzayA9IGRpY3QuZ2V0KCJJbWFnZU1hc2siLCAiSU0iKSB8fCBmYWxzZTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCFpbWFnZU1hc2spIHsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMjM7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHdpZHRoID0gZGljdC5nZXQoIldpZHRoIiwgIlciKTsKICAgICAgICAgICAgICAgICAgICBoZWlnaHQgPSBkaWN0LmdldCgiSGVpZ2h0IiwgIkgiKTsKICAgICAgICAgICAgICAgICAgICBiaXRTdHJpZGVMZW5ndGggPSB3aWR0aCArIDcgPj4gMzsKICAgICAgICAgICAgICAgICAgICBpbWdBcnJheSA9IGltYWdlLmdldEJ5dGVzKGJpdFN0cmlkZUxlbmd0aCAqIGhlaWdodCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgZGVjb2RlID0gZGljdC5nZXRBcnJheSgiRGVjb2RlIiwgIkQiKTsKICAgICAgICAgICAgICAgICAgICBpbWdEYXRhID0gX2ltYWdlLlBERkltYWdlLmNyZWF0ZU1hc2soewogICAgICAgICAgICAgICAgICAgICAgaW1nQXJyYXk6IGltZ0FycmF5LAogICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHdpZHRoLAogICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBoZWlnaHQsCiAgICAgICAgICAgICAgICAgICAgICBpbWFnZUlzRnJvbURlY29kZVN0cmVhbTogaW1hZ2UgaW5zdGFuY2VvZiBfc3RyZWFtLkRlY29kZVN0cmVhbSwKICAgICAgICAgICAgICAgICAgICAgIGludmVyc2VEZWNvZGU6ICEhZGVjb2RlICYmIGRlY29kZVswXSA+IDAKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBpbWdEYXRhLmNhY2hlZCA9ICEhY2FjaGVLZXk7CiAgICAgICAgICAgICAgICAgICAgYXJncyA9IFtpbWdEYXRhXTsKICAgICAgICAgICAgICAgICAgICBvcGVyYXRvckxpc3QuYWRkT3AoX3V0aWwuT1BTLnBhaW50SW1hZ2VNYXNrWE9iamVjdCwgYXJncyk7CgogICAgICAgICAgICAgICAgICAgIGlmIChjYWNoZUtleSkgewogICAgICAgICAgICAgICAgICAgICAgaW1hZ2VDYWNoZVtjYWNoZUtleV0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZuOiBfdXRpbC5PUFMucGFpbnRJbWFnZU1hc2tYT2JqZWN0LAogICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiBhcmdzCiAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIHVuZGVmaW5lZCk7CgogICAgICAgICAgICAgICAgICBjYXNlIDIzOgogICAgICAgICAgICAgICAgICAgIHNvZnRNYXNrID0gZGljdC5nZXQoIlNNYXNrIiwgIlNNIikgfHwgZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgbWFzayA9IGRpY3QuZ2V0KCJNYXNrIikgfHwgZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgU01BTExfSU1BR0VfRElNRU5TSU9OUyA9IDIwMDsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCEoaXNJbmxpbmUgJiYgIXNvZnRNYXNrICYmICFtYXNrICYmICEoaW1hZ2UgaW5zdGFuY2VvZiBfanBlZ19zdHJlYW0uSnBlZ1N0cmVhbSkgJiYgdyArIGggPCBTTUFMTF9JTUFHRV9ESU1FTlNJT05TKSkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAzMTsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaW1hZ2VPYmogPSBuZXcgX2ltYWdlLlBERkltYWdlKHsKICAgICAgICAgICAgICAgICAgICAgIHhyZWY6IF90aGlzMy54cmVmLAogICAgICAgICAgICAgICAgICAgICAgcmVzOiByZXNvdXJjZXMsCiAgICAgICAgICAgICAgICAgICAgICBpbWFnZTogaW1hZ2UsCiAgICAgICAgICAgICAgICAgICAgICBpc0lubGluZTogaXNJbmxpbmUsCiAgICAgICAgICAgICAgICAgICAgICBwZGZGdW5jdGlvbkZhY3Rvcnk6IF90aGlzMy5wZGZGdW5jdGlvbkZhY3RvcnkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBpbWdEYXRhID0gaW1hZ2VPYmouY3JlYXRlSW1hZ2VEYXRhKHRydWUpOwogICAgICAgICAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChfdXRpbC5PUFMucGFpbnRJbmxpbmVJbWFnZVhPYmplY3QsIFtpbWdEYXRhXSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIHVuZGVmaW5lZCk7CgogICAgICAgICAgICAgICAgICBjYXNlIDMxOgogICAgICAgICAgICAgICAgICAgIG5hdGl2ZUltYWdlRGVjb2RlclN1cHBvcnQgPSBmb3JjZURpc2FibGVOYXRpdmVJbWFnZURlY29kZXIgPyBfdXRpbC5OYXRpdmVJbWFnZURlY29kaW5nLk5PTkUgOiBfdGhpczMub3B0aW9ucy5uYXRpdmVJbWFnZURlY29kZXJTdXBwb3J0OwogICAgICAgICAgICAgICAgICAgIG9iaklkID0gImltZ18iLmNvbmNhdChfdGhpczMuaWRGYWN0b3J5LmNyZWF0ZU9iaklkKCkpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMzLnBhcnNpbmdUeXBlM0ZvbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICgwLCBfdXRpbC5hc3NlcnQpKG5hdGl2ZUltYWdlRGVjb2RlclN1cHBvcnQgPT09IF91dGlsLk5hdGl2ZUltYWdlRGVjb2RpbmcuTk9ORSwgIlR5cGUzIGltYWdlIHJlc291cmNlcyBzaG91bGQgYmUgY29tcGxldGVseSBkZWNvZGVkIGluIHRoZSB3b3JrZXIuIik7CiAgICAgICAgICAgICAgICAgICAgICBvYmpJZCA9ICIiLmNvbmNhdChfdGhpczMuaWRGYWN0b3J5LmdldERvY0lkKCksICJfdHlwZTNyZXNfIikuY29uY2F0KG9iaklkKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmICghKG5hdGl2ZUltYWdlRGVjb2RlclN1cHBvcnQgIT09IF91dGlsLk5hdGl2ZUltYWdlRGVjb2RpbmcuTk9ORSAmJiAhc29mdE1hc2sgJiYgIW1hc2sgJiYgaW1hZ2UgaW5zdGFuY2VvZiBfanBlZ19zdHJlYW0uSnBlZ1N0cmVhbSAmJiBfaW1hZ2VfdXRpbHMuTmF0aXZlSW1hZ2VEZWNvZGVyLmlzU3VwcG9ydGVkKGltYWdlLCBfdGhpczMueHJlZiwgcmVzb3VyY2VzLCBfdGhpczMucGRmRnVuY3Rpb25GYWN0b3J5KSAmJiBpbWFnZS5tYXliZVZhbGlkRGltZW5zaW9ucykpIHsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMzY7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iLCBfdGhpczMuaGFuZGxlci5zZW5kV2l0aFByb21pc2UoIm9iaiIsIFtvYmpJZCwgX3RoaXMzLnBhZ2VJbmRleCwgIkpwZWdTdHJlYW0iLCBpbWFnZS5nZXRJUihfdGhpczMub3B0aW9ucy5mb3JjZURhdGFTY2hlbWEpXSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICBvcGVyYXRvckxpc3QuYWRkRGVwZW5kZW5jeShvYmpJZCk7CiAgICAgICAgICAgICAgICAgICAgICBhcmdzID0gW29iaklkLCB3LCBoXTsKICAgICAgICAgICAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChfdXRpbC5PUFMucGFpbnRKcGVnWE9iamVjdCwgYXJncyk7CgogICAgICAgICAgICAgICAgICAgICAgaWYgKGNhY2hlS2V5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlQ2FjaGVbY2FjaGVLZXldID0gewogICAgICAgICAgICAgICAgICAgICAgICAgIGZuOiBfdXRpbC5PUFMucGFpbnRKcGVnWE9iamVjdCwKICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiBhcmdzCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJOYXRpdmUgSlBFRyBkZWNvZGluZyBmYWlsZWQgLS0gdHJ5aW5nIHRvIHJlY292ZXI6ICIgKyAocmVhc29uICYmIHJlYXNvbi5tZXNzYWdlKSk7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMzLmJ1aWxkUGFpbnRJbWFnZVhPYmplY3QoewogICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZXM6IHJlc291cmNlcywKICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2U6IGltYWdlLAogICAgICAgICAgICAgICAgICAgICAgICBpc0lubGluZTogaXNJbmxpbmUsCiAgICAgICAgICAgICAgICAgICAgICAgIG9wZXJhdG9yTGlzdDogb3BlcmF0b3JMaXN0LAogICAgICAgICAgICAgICAgICAgICAgICBjYWNoZUtleTogY2FjaGVLZXksCiAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlQ2FjaGU6IGltYWdlQ2FjaGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmNlRGlzYWJsZU5hdGl2ZUltYWdlRGVjb2RlcjogdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICAgICAgY2FzZSAzNjoKICAgICAgICAgICAgICAgICAgICBuYXRpdmVJbWFnZURlY29kZXIgPSBudWxsOwoKICAgICAgICAgICAgICAgICAgICBpZiAobmF0aXZlSW1hZ2VEZWNvZGVyU3VwcG9ydCA9PT0gX3V0aWwuTmF0aXZlSW1hZ2VEZWNvZGluZy5ERUNPREUgJiYgKGltYWdlIGluc3RhbmNlb2YgX2pwZWdfc3RyZWFtLkpwZWdTdHJlYW0gfHwgbWFzayBpbnN0YW5jZW9mIF9qcGVnX3N0cmVhbS5KcGVnU3RyZWFtIHx8IHNvZnRNYXNrIGluc3RhbmNlb2YgX2pwZWdfc3RyZWFtLkpwZWdTdHJlYW0pKSB7CiAgICAgICAgICAgICAgICAgICAgICBuYXRpdmVJbWFnZURlY29kZXIgPSBuZXcgX2ltYWdlX3V0aWxzLk5hdGl2ZUltYWdlRGVjb2Rlcih7CiAgICAgICAgICAgICAgICAgICAgICAgIHhyZWY6IF90aGlzMy54cmVmLAogICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZXM6IHJlc291cmNlcywKICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlcjogX3RoaXMzLmhhbmRsZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmNlRGF0YVNjaGVtYTogX3RoaXMzLm9wdGlvbnMuZm9yY2VEYXRhU2NoZW1hLAogICAgICAgICAgICAgICAgICAgICAgICBwZGZGdW5jdGlvbkZhY3Rvcnk6IF90aGlzMy5wZGZGdW5jdGlvbkZhY3RvcnkKICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3JMaXN0LmFkZERlcGVuZGVuY3kob2JqSWQpOwogICAgICAgICAgICAgICAgICAgIGFyZ3MgPSBbb2JqSWQsIHcsIGhdOwogICAgICAgICAgICAgICAgICAgIGltZ1Byb21pc2UgPSBfaW1hZ2UuUERGSW1hZ2UuYnVpbGRJbWFnZSh7CiAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyOiBfdGhpczMuaGFuZGxlciwKICAgICAgICAgICAgICAgICAgICAgIHhyZWY6IF90aGlzMy54cmVmLAogICAgICAgICAgICAgICAgICAgICAgcmVzOiByZXNvdXJjZXMsCiAgICAgICAgICAgICAgICAgICAgICBpbWFnZTogaW1hZ2UsCiAgICAgICAgICAgICAgICAgICAgICBpc0lubGluZTogaXNJbmxpbmUsCiAgICAgICAgICAgICAgICAgICAgICBuYXRpdmVEZWNvZGVyOiBuYXRpdmVJbWFnZURlY29kZXIsCiAgICAgICAgICAgICAgICAgICAgICBwZGZGdW5jdGlvbkZhY3Rvcnk6IF90aGlzMy5wZGZGdW5jdGlvbkZhY3RvcnkKICAgICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChpbWFnZU9iaikgewogICAgICAgICAgICAgICAgICAgICAgdmFyIGltZ0RhdGEgPSBpbWFnZU9iai5jcmVhdGVJbWFnZURhdGEoZmFsc2UpOwoKICAgICAgICAgICAgICAgICAgICAgIGlmIChfdGhpczMucGFyc2luZ1R5cGUzRm9udCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMzLmhhbmRsZXIuc2VuZFdpdGhQcm9taXNlKCJjb21tb25vYmoiLCBbb2JqSWQsICJGb250VHlwZTNSZXMiLCBpbWdEYXRhXSwgW2ltZ0RhdGEuZGF0YS5idWZmZXJdKTsKICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICBfdGhpczMuaGFuZGxlci5zZW5kKCJvYmoiLCBbb2JqSWQsIF90aGlzMy5wYWdlSW5kZXgsICJJbWFnZSIsIGltZ0RhdGFdLCBbaW1nRGF0YS5kYXRhLmJ1ZmZlcl0pOwoKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJVbmFibGUgdG8gZGVjb2RlIGltYWdlOiAiICsgcmVhc29uKTsKCiAgICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMzLnBhcnNpbmdUeXBlM0ZvbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMy5oYW5kbGVyLnNlbmRXaXRoUHJvbWlzZSgiY29tbW9ub2JqIiwgW29iaklkLCAiRm9udFR5cGUzUmVzIiwgbnVsbF0pOwogICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgIF90aGlzMy5oYW5kbGVyLnNlbmQoIm9iaiIsIFtvYmpJZCwgX3RoaXMzLnBhZ2VJbmRleCwgIkltYWdlIiwgbnVsbF0pOwoKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgIGlmICghX3RoaXMzLnBhcnNpbmdUeXBlM0ZvbnQpIHsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNDQ7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNDQ7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGltZ1Byb21pc2U7CgogICAgICAgICAgICAgICAgICBjYXNlIDQ0OgogICAgICAgICAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChfdXRpbC5PUFMucGFpbnRJbWFnZVhPYmplY3QsIGFyZ3MpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoY2FjaGVLZXkpIHsKICAgICAgICAgICAgICAgICAgICAgIGltYWdlQ2FjaGVbY2FjaGVLZXldID0gewogICAgICAgICAgICAgICAgICAgICAgICBmbjogX3V0aWwuT1BTLnBhaW50SW1hZ2VYT2JqZWN0LAogICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiBhcmdzCiAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIHVuZGVmaW5lZCk7CgogICAgICAgICAgICAgICAgICBjYXNlIDQ3OgogICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgX2NhbGxlZTMpOwogICAgICAgICAgfSkpKCk7CiAgICAgICAgfSwKICAgICAgICBoYW5kbGVTTWFzazogZnVuY3Rpb24gUGFydGlhbEV2YWx1YXRvcl9oYW5kbGVTbWFzayhzbWFzaywgcmVzb3VyY2VzLCBvcGVyYXRvckxpc3QsIHRhc2ssIHN0YXRlTWFuYWdlcikgewogICAgICAgICAgdmFyIHNtYXNrQ29udGVudCA9IHNtYXNrLmdldCgiRyIpOwogICAgICAgICAgdmFyIHNtYXNrT3B0aW9ucyA9IHsKICAgICAgICAgICAgc3VidHlwZTogc21hc2suZ2V0KCJTIikubmFtZSwKICAgICAgICAgICAgYmFja2Ryb3A6IHNtYXNrLmdldCgiQkMiKQogICAgICAgICAgfTsKICAgICAgICAgIHZhciB0cmFuc2Zlck9iaiA9IHNtYXNrLmdldCgiVFIiKTsKCiAgICAgICAgICBpZiAoKDAsIF9mdW5jdGlvbi5pc1BERkZ1bmN0aW9uKSh0cmFuc2Zlck9iaikpIHsKICAgICAgICAgICAgdmFyIHRyYW5zZmVyRm4gPSB0aGlzLnBkZkZ1bmN0aW9uRmFjdG9yeS5jcmVhdGUodHJhbnNmZXJPYmopOwogICAgICAgICAgICB2YXIgdHJhbnNmZXJNYXAgPSBuZXcgVWludDhBcnJheSgyNTYpOwogICAgICAgICAgICB2YXIgdG1wID0gbmV3IEZsb2F0MzJBcnJheSgxKTsKCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMjU2OyBpKyspIHsKICAgICAgICAgICAgICB0bXBbMF0gPSBpIC8gMjU1OwogICAgICAgICAgICAgIHRyYW5zZmVyRm4odG1wLCAwLCB0bXAsIDApOwogICAgICAgICAgICAgIHRyYW5zZmVyTWFwW2ldID0gdG1wWzBdICogMjU1IHwgMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc21hc2tPcHRpb25zLnRyYW5zZmVyTWFwID0gdHJhbnNmZXJNYXA7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHRoaXMuYnVpbGRGb3JtWE9iamVjdChyZXNvdXJjZXMsIHNtYXNrQ29udGVudCwgc21hc2tPcHRpb25zLCBvcGVyYXRvckxpc3QsIHRhc2ssIHN0YXRlTWFuYWdlci5zdGF0ZS5jbG9uZSgpKTsKICAgICAgICB9LAogICAgICAgIGhhbmRsZVRpbGluZ1R5cGU6IGZ1bmN0aW9uIGhhbmRsZVRpbGluZ1R5cGUoZm4sIGFyZ3MsIHJlc291cmNlcywgcGF0dGVybiwgcGF0dGVybkRpY3QsIG9wZXJhdG9yTGlzdCwgdGFzaykgewogICAgICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICAgICAgdmFyIHRpbGluZ09wTGlzdCA9IG5ldyBfb3BlcmF0b3JfbGlzdC5PcGVyYXRvckxpc3QoKTsKICAgICAgICAgIHZhciByZXNvdXJjZXNBcnJheSA9IFtwYXR0ZXJuRGljdC5nZXQoIlJlc291cmNlcyIpLCByZXNvdXJjZXNdOwoKICAgICAgICAgIHZhciBwYXR0ZXJuUmVzb3VyY2VzID0gX3ByaW1pdGl2ZXMuRGljdC5tZXJnZSh0aGlzLnhyZWYsIHJlc291cmNlc0FycmF5KTsKCiAgICAgICAgICByZXR1cm4gdGhpcy5nZXRPcGVyYXRvckxpc3QoewogICAgICAgICAgICBzdHJlYW06IHBhdHRlcm4sCiAgICAgICAgICAgIHRhc2s6IHRhc2ssCiAgICAgICAgICAgIHJlc291cmNlczogcGF0dGVyblJlc291cmNlcywKICAgICAgICAgICAgb3BlcmF0b3JMaXN0OiB0aWxpbmdPcExpc3QKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gKDAsIF9wYXR0ZXJuLmdldFRpbGluZ1BhdHRlcm5JUikoewogICAgICAgICAgICAgIGZuQXJyYXk6IHRpbGluZ09wTGlzdC5mbkFycmF5LAogICAgICAgICAgICAgIGFyZ3NBcnJheTogdGlsaW5nT3BMaXN0LmFyZ3NBcnJheQogICAgICAgICAgICB9LCBwYXR0ZXJuRGljdCwgYXJncyk7CiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uICh0aWxpbmdQYXR0ZXJuSVIpIHsKICAgICAgICAgICAgb3BlcmF0b3JMaXN0LmFkZERlcGVuZGVuY2llcyh0aWxpbmdPcExpc3QuZGVwZW5kZW5jaWVzKTsKICAgICAgICAgICAgb3BlcmF0b3JMaXN0LmFkZE9wKGZuLCB0aWxpbmdQYXR0ZXJuSVIpOwogICAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgICBpZiAocmVhc29uIGluc3RhbmNlb2YgX3V0aWwuQWJvcnRFeGNlcHRpb24pIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChfdGhpczQub3B0aW9ucy5pZ25vcmVFcnJvcnMpIHsKICAgICAgICAgICAgICBfdGhpczQuaGFuZGxlci5zZW5kKCJVbnN1cHBvcnRlZEZlYXR1cmUiLCB7CiAgICAgICAgICAgICAgICBmZWF0dXJlSWQ6IF91dGlsLlVOU1VQUE9SVEVEX0ZFQVRVUkVTLnVua25vd24KICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJoYW5kbGVUaWxpbmdUeXBlIC0gaWdub3JpbmcgcGF0dGVybjogXCIiLmNvbmNhdChyZWFzb24sICJcIi4iKSk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aHJvdyByZWFzb247CiAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGhhbmRsZVNldEZvbnQ6IGZ1bmN0aW9uIFBhcnRpYWxFdmFsdWF0b3JfaGFuZGxlU2V0Rm9udChyZXNvdXJjZXMsIGZvbnRBcmdzLCBmb250UmVmLCBvcGVyYXRvckxpc3QsIHRhc2ssIHN0YXRlKSB7CiAgICAgICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICAgICAgICB2YXIgZm9udE5hbWU7CgogICAgICAgICAgaWYgKGZvbnRBcmdzKSB7CiAgICAgICAgICAgIGZvbnRBcmdzID0gZm9udEFyZ3Muc2xpY2UoKTsKICAgICAgICAgICAgZm9udE5hbWUgPSBmb250QXJnc1swXS5uYW1lOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB0aGlzLmxvYWRGb250KGZvbnROYW1lLCBmb250UmVmLCByZXNvdXJjZXMpLnRoZW4oZnVuY3Rpb24gKHRyYW5zbGF0ZWQpIHsKICAgICAgICAgICAgaWYgKCF0cmFuc2xhdGVkLmZvbnQuaXNUeXBlM0ZvbnQpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJhbnNsYXRlZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHRyYW5zbGF0ZWQubG9hZFR5cGUzRGF0YShfdGhpczUsIHJlc291cmNlcywgb3BlcmF0b3JMaXN0LCB0YXNrKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJhbnNsYXRlZDsKICAgICAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgICAgIF90aGlzNS5oYW5kbGVyLnNlbmQoIlVuc3VwcG9ydGVkRmVhdHVyZSIsIHsKICAgICAgICAgICAgICAgIGZlYXR1cmVJZDogX3V0aWwuVU5TVVBQT1JURURfRkVBVFVSRVMuZm9udAogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICByZXR1cm4gbmV3IFRyYW5zbGF0ZWRGb250KCJnX2ZvbnRfZXJyb3IiLCBuZXcgX2ZvbnRzLkVycm9yRm9udCgiVHlwZTMgZm9udCBsb2FkIGVycm9yOiAiICsgcmVhc29uKSwgdHJhbnNsYXRlZC5mb250KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uICh0cmFuc2xhdGVkKSB7CiAgICAgICAgICAgIHN0YXRlLmZvbnQgPSB0cmFuc2xhdGVkLmZvbnQ7CiAgICAgICAgICAgIHRyYW5zbGF0ZWQuc2VuZChfdGhpczUuaGFuZGxlcik7CiAgICAgICAgICAgIHJldHVybiB0cmFuc2xhdGVkLmxvYWRlZE5hbWU7CiAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGhhbmRsZVRleHQ6IGZ1bmN0aW9uIGhhbmRsZVRleHQoY2hhcnMsIHN0YXRlKSB7CiAgICAgICAgICB2YXIgZm9udCA9IHN0YXRlLmZvbnQ7CiAgICAgICAgICB2YXIgZ2x5cGhzID0gZm9udC5jaGFyc1RvR2x5cGhzKGNoYXJzKTsKCiAgICAgICAgICBpZiAoZm9udC5kYXRhKSB7CiAgICAgICAgICAgIHZhciBpc0FkZFRvUGF0aFNldCA9ICEhKHN0YXRlLnRleHRSZW5kZXJpbmdNb2RlICYgX3V0aWwuVGV4dFJlbmRlcmluZ01vZGUuQUREX1RPX1BBVEhfRkxBRyk7CgogICAgICAgICAgICBpZiAoaXNBZGRUb1BhdGhTZXQgfHwgc3RhdGUuZmlsbENvbG9yU3BhY2UubmFtZSA9PT0gIlBhdHRlcm4iIHx8IGZvbnQuZGlzYWJsZUZvbnRGYWNlIHx8IHRoaXMub3B0aW9ucy5kaXNhYmxlRm9udEZhY2UpIHsKICAgICAgICAgICAgICBQYXJ0aWFsRXZhbHVhdG9yLmJ1aWxkRm9udFBhdGhzKGZvbnQsIGdseXBocywgdGhpcy5oYW5kbGVyKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBnbHlwaHM7CiAgICAgICAgfSwKICAgICAgICBlbnN1cmVTdGF0ZUZvbnQ6IGZ1bmN0aW9uIGVuc3VyZVN0YXRlRm9udChzdGF0ZSkgewogICAgICAgICAgaWYgKHN0YXRlLmZvbnQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciByZWFzb24gPSBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIk1pc3Npbmcgc2V0Rm9udCAoVGYpIG9wZXJhdG9yIGJlZm9yZSB0ZXh0IHJlbmRlcmluZyBvcGVyYXRvci4iKTsKCiAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmlnbm9yZUVycm9ycykgewogICAgICAgICAgICB0aGlzLmhhbmRsZXIuc2VuZCgiVW5zdXBwb3J0ZWRGZWF0dXJlIiwgewogICAgICAgICAgICAgIGZlYXR1cmVJZDogX3V0aWwuVU5TVVBQT1JURURfRkVBVFVSRVMuZm9udAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJlbnN1cmVTdGF0ZUZvbnQ6IFwiIi5jb25jYXQocmVhc29uLCAiXCIuIikpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdGhyb3cgcmVhc29uOwogICAgICAgIH0sCiAgICAgICAgc2V0R1N0YXRlOiBmdW5jdGlvbiBQYXJ0aWFsRXZhbHVhdG9yX3NldEdTdGF0ZShyZXNvdXJjZXMsIGdTdGF0ZSwgb3BlcmF0b3JMaXN0LCB0YXNrLCBzdGF0ZU1hbmFnZXIpIHsKICAgICAgICAgIHZhciBfdGhpczYgPSB0aGlzOwoKICAgICAgICAgIHZhciBnU3RhdGVPYmogPSBbXTsKICAgICAgICAgIHZhciBnU3RhdGVLZXlzID0gZ1N0YXRlLmdldEtleXMoKTsKICAgICAgICAgIHZhciBwcm9taXNlID0gUHJvbWlzZS5yZXNvbHZlKCk7CgogICAgICAgICAgdmFyIF9sb29wID0gZnVuY3Rpb24gX2xvb3AoKSB7CiAgICAgICAgICAgIHZhciBrZXkgPSBnU3RhdGVLZXlzW2ldOwogICAgICAgICAgICB2YXIgdmFsdWUgPSBnU3RhdGUuZ2V0KGtleSk7CgogICAgICAgICAgICBzd2l0Y2ggKGtleSkgewogICAgICAgICAgICAgIGNhc2UgIlR5cGUiOgogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgIkxXIjoKICAgICAgICAgICAgICBjYXNlICJMQyI6CiAgICAgICAgICAgICAgY2FzZSAiTEoiOgogICAgICAgICAgICAgIGNhc2UgIk1MIjoKICAgICAgICAgICAgICBjYXNlICJEIjoKICAgICAgICAgICAgICBjYXNlICJSSSI6CiAgICAgICAgICAgICAgY2FzZSAiRkwiOgogICAgICAgICAgICAgIGNhc2UgIkNBIjoKICAgICAgICAgICAgICBjYXNlICJjYSI6CiAgICAgICAgICAgICAgICBnU3RhdGVPYmoucHVzaChba2V5LCB2YWx1ZV0pOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgIkZvbnQiOgogICAgICAgICAgICAgICAgcHJvbWlzZSA9IHByb21pc2UudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpczYuaGFuZGxlU2V0Rm9udChyZXNvdXJjZXMsIG51bGwsIHZhbHVlWzBdLCBvcGVyYXRvckxpc3QsIHRhc2ssIHN0YXRlTWFuYWdlci5zdGF0ZSkudGhlbihmdW5jdGlvbiAobG9hZGVkTmFtZSkgewogICAgICAgICAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGREZXBlbmRlbmN5KGxvYWRlZE5hbWUpOwogICAgICAgICAgICAgICAgICAgIGdTdGF0ZU9iai5wdXNoKFtrZXksIFtsb2FkZWROYW1lLCB2YWx1ZVsxXV1dKTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICJCTSI6CiAgICAgICAgICAgICAgICBnU3RhdGVPYmoucHVzaChba2V5LCBub3JtYWxpemVCbGVuZE1vZGUodmFsdWUpXSk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAiU01hc2siOgogICAgICAgICAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc05hbWUpKHZhbHVlLCAiTm9uZSIpKSB7CiAgICAgICAgICAgICAgICAgIGdTdGF0ZU9iai5wdXNoKFtrZXksIGZhbHNlXSk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNEaWN0KSh2YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgcHJvbWlzZSA9IHByb21pc2UudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzNi5oYW5kbGVTTWFzayh2YWx1ZSwgcmVzb3VyY2VzLCBvcGVyYXRvckxpc3QsIHRhc2ssIHN0YXRlTWFuYWdlcik7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICBnU3RhdGVPYmoucHVzaChba2V5LCB0cnVlXSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIlVuc3VwcG9ydGVkIFNNYXNrIHR5cGUiKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAiT1AiOgogICAgICAgICAgICAgIGNhc2UgIm9wIjoKICAgICAgICAgICAgICBjYXNlICJPUE0iOgogICAgICAgICAgICAgIGNhc2UgIkJHIjoKICAgICAgICAgICAgICBjYXNlICJCRzIiOgogICAgICAgICAgICAgIGNhc2UgIlVDUiI6CiAgICAgICAgICAgICAgY2FzZSAiVUNSMiI6CiAgICAgICAgICAgICAgY2FzZSAiVFIiOgogICAgICAgICAgICAgIGNhc2UgIlRSMiI6CiAgICAgICAgICAgICAgY2FzZSAiSFQiOgogICAgICAgICAgICAgIGNhc2UgIlNNIjoKICAgICAgICAgICAgICBjYXNlICJTQSI6CiAgICAgICAgICAgICAgY2FzZSAiQUlTIjoKICAgICAgICAgICAgICBjYXNlICJUSyI6CiAgICAgICAgICAgICAgICAoMCwgX3V0aWwuaW5mbykoImdyYXBoaWMgc3RhdGUgb3BlcmF0b3IgIiArIGtleSk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICgwLCBfdXRpbC5pbmZvKSgiVW5rbm93biBncmFwaGljIHN0YXRlIG9wZXJhdG9yICIgKyBrZXkpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CgogICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gZ1N0YXRlS2V5cy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgIF9sb29wKCk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHByb21pc2UudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmIChnU3RhdGVPYmoubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChfdXRpbC5PUFMuc2V0R1N0YXRlLCBbZ1N0YXRlT2JqXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgbG9hZEZvbnQ6IGZ1bmN0aW9uIFBhcnRpYWxFdmFsdWF0b3JfbG9hZEZvbnQoZm9udE5hbWUsIGZvbnQsIHJlc291cmNlcykgewogICAgICAgICAgdmFyIF90aGlzNyA9IHRoaXM7CgogICAgICAgICAgZnVuY3Rpb24gZXJyb3JGb250KCkgewogICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG5ldyBUcmFuc2xhdGVkRm9udCgiZ19mb250X2Vycm9yIiwgbmV3IF9mb250cy5FcnJvckZvbnQoIkZvbnQgIiArIGZvbnROYW1lICsgIiBpcyBub3QgYXZhaWxhYmxlIiksIGZvbnQpKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZm9udFJlZiwKICAgICAgICAgICAgeHJlZiA9IHRoaXMueHJlZjsKCiAgICAgICAgICBpZiAoZm9udCkgewogICAgICAgICAgICBpZiAoISgwLCBfcHJpbWl0aXZlcy5pc1JlZikoZm9udCkpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoJ1RoZSAiZm9udCIgb2JqZWN0IHNob3VsZCBiZSBhIHJlZmVyZW5jZS4nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9udFJlZiA9IGZvbnQ7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgZm9udFJlcyA9IHJlc291cmNlcy5nZXQoIkZvbnQiKTsKCiAgICAgICAgICAgIGlmIChmb250UmVzKSB7CiAgICAgICAgICAgICAgZm9udFJlZiA9IGZvbnRSZXMuZ2V0UmF3KGZvbnROYW1lKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmICghZm9udFJlZikgewogICAgICAgICAgICB2YXIgcGFydGlhbE1zZyA9ICJGb250IFwiIi5jb25jYXQoZm9udE5hbWUgfHwgZm9udCAmJiBmb250LnRvU3RyaW5nKCksICJcIiBpcyBub3QgYXZhaWxhYmxlIik7CgogICAgICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5pZ25vcmVFcnJvcnMgJiYgIXRoaXMucGFyc2luZ1R5cGUzRm9udCkgewogICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiIi5jb25jYXQocGFydGlhbE1zZywgIi4iKSk7CiAgICAgICAgICAgICAgcmV0dXJuIGVycm9yRm9udCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLmhhbmRsZXIuc2VuZCgiVW5zdXBwb3J0ZWRGZWF0dXJlIiwgewogICAgICAgICAgICAgIGZlYXR1cmVJZDogX3V0aWwuVU5TVVBQT1JURURfRkVBVFVSRVMuZm9udAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCIiLmNvbmNhdChwYXJ0aWFsTXNnLCAiIC0tIGF0dGVtcHRpbmcgdG8gZmFsbGJhY2sgdG8gYSBkZWZhdWx0IGZvbnQuIikpOwogICAgICAgICAgICBmb250UmVmID0gUGFydGlhbEV2YWx1YXRvci5nZXRGYWxsYmFja0ZvbnREaWN0KCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRoaXMuZm9udENhY2hlLmhhcyhmb250UmVmKSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5mb250Q2FjaGUuZ2V0KGZvbnRSZWYpOwogICAgICAgICAgfQoKICAgICAgICAgIGZvbnQgPSB4cmVmLmZldGNoSWZSZWYoZm9udFJlZik7CgogICAgICAgICAgaWYgKCEoMCwgX3ByaW1pdGl2ZXMuaXNEaWN0KShmb250KSkgewogICAgICAgICAgICByZXR1cm4gZXJyb3JGb250KCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGZvbnQudHJhbnNsYXRlZCkgewogICAgICAgICAgICByZXR1cm4gZm9udC50cmFuc2xhdGVkOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBmb250Q2FwYWJpbGl0eSA9ICgwLCBfdXRpbC5jcmVhdGVQcm9taXNlQ2FwYWJpbGl0eSkoKTsKICAgICAgICAgIHZhciBwcmVFdmFsdWF0ZWRGb250ID0gdGhpcy5wcmVFdmFsdWF0ZUZvbnQoZm9udCk7CiAgICAgICAgICB2YXIgZGVzY3JpcHRvciA9IHByZUV2YWx1YXRlZEZvbnQuZGVzY3JpcHRvciwKICAgICAgICAgICAgaGFzaCA9IHByZUV2YWx1YXRlZEZvbnQuaGFzaDsKICAgICAgICAgIHZhciBmb250UmVmSXNSZWYgPSAoMCwgX3ByaW1pdGl2ZXMuaXNSZWYpKGZvbnRSZWYpLAogICAgICAgICAgICBmb250SUQ7CgogICAgICAgICAgaWYgKGZvbnRSZWZJc1JlZikgewogICAgICAgICAgICBmb250SUQgPSBmb250UmVmLnRvU3RyaW5nKCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGhhc2ggJiYgKDAsIF9wcmltaXRpdmVzLmlzRGljdCkoZGVzY3JpcHRvcikpIHsKICAgICAgICAgICAgaWYgKCFkZXNjcmlwdG9yLmZvbnRBbGlhc2VzKSB7CiAgICAgICAgICAgICAgZGVzY3JpcHRvci5mb250QWxpYXNlcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBmb250QWxpYXNlcyA9IGRlc2NyaXB0b3IuZm9udEFsaWFzZXM7CgogICAgICAgICAgICBpZiAoZm9udEFsaWFzZXNbaGFzaF0pIHsKICAgICAgICAgICAgICB2YXIgYWxpYXNGb250UmVmID0gZm9udEFsaWFzZXNbaGFzaF0uYWxpYXNSZWY7CgogICAgICAgICAgICAgIGlmIChmb250UmVmSXNSZWYgJiYgYWxpYXNGb250UmVmICYmIHRoaXMuZm9udENhY2hlLmhhcyhhbGlhc0ZvbnRSZWYpKSB7CiAgICAgICAgICAgICAgICB0aGlzLmZvbnRDYWNoZS5wdXRBbGlhcyhmb250UmVmLCBhbGlhc0ZvbnRSZWYpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZm9udENhY2hlLmdldChmb250UmVmKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZm9udEFsaWFzZXNbaGFzaF0gPSB7CiAgICAgICAgICAgICAgICBmb250SUQ6IF9mb250cy5Gb250LmdldEZvbnRJRCgpCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGZvbnRSZWZJc1JlZikgewogICAgICAgICAgICAgIGZvbnRBbGlhc2VzW2hhc2hdLmFsaWFzUmVmID0gZm9udFJlZjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9udElEID0gZm9udEFsaWFzZXNbaGFzaF0uZm9udElEOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChmb250UmVmSXNSZWYpIHsKICAgICAgICAgICAgdGhpcy5mb250Q2FjaGUucHV0KGZvbnRSZWYsIGZvbnRDYXBhYmlsaXR5LnByb21pc2UpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKCFmb250SUQpIHsKICAgICAgICAgICAgICBmb250SUQgPSB0aGlzLmlkRmFjdG9yeS5jcmVhdGVPYmpJZCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLmZvbnRDYWNoZS5wdXQoImlkXyIuY29uY2F0KGZvbnRJRCksIGZvbnRDYXBhYmlsaXR5LnByb21pc2UpOwogICAgICAgICAgfQoKICAgICAgICAgICgwLCBfdXRpbC5hc3NlcnQpKGZvbnRJRCwgJ1RoZSAiZm9udElEIiBtdXN0IGJlIGRlZmluZWQuJyk7CiAgICAgICAgICBmb250LmxvYWRlZE5hbWUgPSAiIi5jb25jYXQodGhpcy5pZEZhY3RvcnkuZ2V0RG9jSWQoKSwgIl9mIikuY29uY2F0KGZvbnRJRCk7CiAgICAgICAgICBmb250LnRyYW5zbGF0ZWQgPSBmb250Q2FwYWJpbGl0eS5wcm9taXNlOwogICAgICAgICAgdmFyIHRyYW5zbGF0ZWRQcm9taXNlOwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHRyYW5zbGF0ZWRQcm9taXNlID0gdGhpcy50cmFuc2xhdGVGb250KHByZUV2YWx1YXRlZEZvbnQpOwogICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICB0cmFuc2xhdGVkUHJvbWlzZSA9IFByb21pc2UucmVqZWN0KGUpOwogICAgICAgICAgfQoKICAgICAgICAgIHRyYW5zbGF0ZWRQcm9taXNlLnRoZW4oZnVuY3Rpb24gKHRyYW5zbGF0ZWRGb250KSB7CiAgICAgICAgICAgIGlmICh0cmFuc2xhdGVkRm9udC5mb250VHlwZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgdmFyIHhyZWZGb250U3RhdHMgPSB4cmVmLnN0YXRzLmZvbnRUeXBlczsKICAgICAgICAgICAgICB4cmVmRm9udFN0YXRzW3RyYW5zbGF0ZWRGb250LmZvbnRUeXBlXSA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvbnRDYXBhYmlsaXR5LnJlc29sdmUobmV3IFRyYW5zbGF0ZWRGb250KGZvbnQubG9hZGVkTmFtZSwgdHJhbnNsYXRlZEZvbnQsIGZvbnQpKTsKICAgICAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgICAgX3RoaXM3LmhhbmRsZXIuc2VuZCgiVW5zdXBwb3J0ZWRGZWF0dXJlIiwgewogICAgICAgICAgICAgIGZlYXR1cmVJZDogX3V0aWwuVU5TVVBQT1JURURfRkVBVFVSRVMuZm9udAogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgdmFyIGZvbnRGaWxlMyA9IGRlc2NyaXB0b3IgJiYgZGVzY3JpcHRvci5nZXQoIkZvbnRGaWxlMyIpOwogICAgICAgICAgICAgIHZhciBzdWJ0eXBlID0gZm9udEZpbGUzICYmIGZvbnRGaWxlMy5nZXQoIlN1YnR5cGUiKTsKICAgICAgICAgICAgICB2YXIgZm9udFR5cGUgPSAoMCwgX2ZvbnRzLmdldEZvbnRUeXBlKShwcmVFdmFsdWF0ZWRGb250LnR5cGUsIHN1YnR5cGUgJiYgc3VidHlwZS5uYW1lKTsKICAgICAgICAgICAgICB2YXIgeHJlZkZvbnRTdGF0cyA9IHhyZWYuc3RhdHMuZm9udFR5cGVzOwogICAgICAgICAgICAgIHhyZWZGb250U3RhdHNbZm9udFR5cGVdID0gdHJ1ZTsKICAgICAgICAgICAgfSBjYXRjaCAoZXgpIHt9CgogICAgICAgICAgICBmb250Q2FwYWJpbGl0eS5yZXNvbHZlKG5ldyBUcmFuc2xhdGVkRm9udChmb250LmxvYWRlZE5hbWUsIG5ldyBfZm9udHMuRXJyb3JGb250KHJlYXNvbiBpbnN0YW5jZW9mIEVycm9yID8gcmVhc29uLm1lc3NhZ2UgOiByZWFzb24pLCBmb250KSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiBmb250Q2FwYWJpbGl0eS5wcm9taXNlOwogICAgICAgIH0sCiAgICAgICAgYnVpbGRQYXRoOiBmdW5jdGlvbiBidWlsZFBhdGgob3BlcmF0b3JMaXN0LCBmbiwgYXJncykgewogICAgICAgICAgdmFyIHBhcnNpbmdUZXh0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgJiYgYXJndW1lbnRzWzNdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbM10gOiBmYWxzZTsKICAgICAgICAgIHZhciBsYXN0SW5kZXggPSBvcGVyYXRvckxpc3QubGVuZ3RoIC0gMTsKCiAgICAgICAgICBpZiAoIWFyZ3MpIHsKICAgICAgICAgICAgYXJncyA9IFtdOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChsYXN0SW5kZXggPCAwIHx8IG9wZXJhdG9yTGlzdC5mbkFycmF5W2xhc3RJbmRleF0gIT09IF91dGlsLk9QUy5jb25zdHJ1Y3RQYXRoKSB7CiAgICAgICAgICAgIGlmIChwYXJzaW5nVGV4dCkgewogICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiRW5jb3VudGVyZWQgcGF0aCBvcGVyYXRvciBcIiIuY29uY2F0KGZuLCAiXCIgaW5zaWRlIG9mIGEgdGV4dCBvYmplY3QuIikpOwogICAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChfdXRpbC5PUFMuc2F2ZSwgbnVsbCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChfdXRpbC5PUFMuY29uc3RydWN0UGF0aCwgW1tmbl0sIGFyZ3NdKTsKCiAgICAgICAgICAgIGlmIChwYXJzaW5nVGV4dCkgewogICAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChfdXRpbC5PUFMucmVzdG9yZSwgbnVsbCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciBvcEFyZ3MgPSBvcGVyYXRvckxpc3QuYXJnc0FycmF5W2xhc3RJbmRleF07CiAgICAgICAgICAgIG9wQXJnc1swXS5wdXNoKGZuKTsKICAgICAgICAgICAgQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkob3BBcmdzWzFdLCBhcmdzKTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHBhcnNlQ29sb3JTcGFjZTogZnVuY3Rpb24gcGFyc2VDb2xvclNwYWNlKF9yZWY1KSB7CiAgICAgICAgICB2YXIgX3RoaXM4ID0gdGhpczsKCiAgICAgICAgICB2YXIgY3MgPSBfcmVmNS5jcywKICAgICAgICAgICAgcmVzb3VyY2VzID0gX3JlZjUucmVzb3VyY2VzOwogICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgICAgIHJlc29sdmUoX2NvbG9yc3BhY2UuQ29sb3JTcGFjZS5wYXJzZShjcywgX3RoaXM4LnhyZWYsIHJlc291cmNlcywgX3RoaXM4LnBkZkZ1bmN0aW9uRmFjdG9yeSkpOwogICAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgICBpZiAocmVhc29uIGluc3RhbmNlb2YgX3V0aWwuQWJvcnRFeGNlcHRpb24pIHsKICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKF90aGlzOC5vcHRpb25zLmlnbm9yZUVycm9ycykgewogICAgICAgICAgICAgIF90aGlzOC5oYW5kbGVyLnNlbmQoIlVuc3VwcG9ydGVkRmVhdHVyZSIsIHsKICAgICAgICAgICAgICAgIGZlYXR1cmVJZDogX3V0aWwuVU5TVVBQT1JURURfRkVBVFVSRVMudW5rbm93bgogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoInBhcnNlQ29sb3JTcGFjZSAtIGlnbm9yaW5nIENvbG9yU3BhY2U6IFwiIi5jb25jYXQocmVhc29uLCAiXCIuIikpOwogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aHJvdyByZWFzb247CiAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGhhbmRsZUNvbG9yTjogZnVuY3Rpb24gaGFuZGxlQ29sb3JOKG9wZXJhdG9yTGlzdCwgZm4sIGFyZ3MsIGNzLCBwYXR0ZXJucywgcmVzb3VyY2VzLCB0YXNrKSB7CiAgICAgICAgICB2YXIgX3RoaXM5ID0gdGhpczsKCiAgICAgICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoLyojX19QVVJFX18qL19yZWdlbmVyYXRvclsiZGVmYXVsdCJdLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTQoKSB7CiAgICAgICAgICAgIHZhciBwYXR0ZXJuTmFtZSwgcGF0dGVybiwgZGljdCwgdHlwZU51bSwgY29sb3IsIHNoYWRpbmcsIG1hdHJpeDsKICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclsiZGVmYXVsdCJdLndyYXAoZnVuY3Rpb24gX2NhbGxlZTQkKF9jb250ZXh0NCkgewogICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIHBhdHRlcm5OYW1lID0gYXJnc1thcmdzLmxlbmd0aCAtIDFdOwoKICAgICAgICAgICAgICAgICAgICBpZiAoISgoMCwgX3ByaW1pdGl2ZXMuaXNOYW1lKShwYXR0ZXJuTmFtZSkgJiYgKHBhdHRlcm4gPSBwYXR0ZXJucy5nZXQocGF0dGVybk5hbWUubmFtZSkpKSkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxNjsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgZGljdCA9ICgwLCBfcHJpbWl0aXZlcy5pc1N0cmVhbSkocGF0dGVybikgPyBwYXR0ZXJuLmRpY3QgOiBwYXR0ZXJuOwogICAgICAgICAgICAgICAgICAgIHR5cGVOdW0gPSBkaWN0LmdldCgiUGF0dGVyblR5cGUiKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCEodHlwZU51bSA9PT0gVElMSU5HX1BBVFRFUk4pKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDk7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGNvbG9yID0gY3MuYmFzZSA/IGNzLmJhc2UuZ2V0UmdiKGFyZ3MsIDApIDogbnVsbDsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgX3RoaXM5LmhhbmRsZVRpbGluZ1R5cGUoZm4sIGNvbG9yLCByZXNvdXJjZXMsIHBhdHRlcm4sIGRpY3QsIG9wZXJhdG9yTGlzdCwgdGFzaykpOwoKICAgICAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgICAgIGlmICghKHR5cGVOdW0gPT09IFNIQURJTkdfUEFUVEVSTikpIHsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTU7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHNoYWRpbmcgPSBkaWN0LmdldCgiU2hhZGluZyIpOwogICAgICAgICAgICAgICAgICAgIG1hdHJpeCA9IGRpY3QuZ2V0QXJyYXkoIk1hdHJpeCIpOwogICAgICAgICAgICAgICAgICAgIHBhdHRlcm4gPSBfcGF0dGVybi5QYXR0ZXJuLnBhcnNlU2hhZGluZyhzaGFkaW5nLCBtYXRyaXgsIF90aGlzOS54cmVmLCByZXNvdXJjZXMsIF90aGlzOS5oYW5kbGVyLCBfdGhpczkucGRmRnVuY3Rpb25GYWN0b3J5KTsKICAgICAgICAgICAgICAgICAgICBvcGVyYXRvckxpc3QuYWRkT3AoZm4sIHBhdHRlcm4uZ2V0SVIoKSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIHVuZGVmaW5lZCk7CgogICAgICAgICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiVW5rbm93biBQYXR0ZXJuVHlwZTogIi5jb25jYXQodHlwZU51bSkpOwoKICAgICAgICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIlVua25vd24gUGF0dGVybk5hbWU6ICIuY29uY2F0KHBhdHRlcm5OYW1lKSk7CgogICAgICAgICAgICAgICAgICBjYXNlIDE3OgogICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuc3RvcCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgX2NhbGxlZTQpOwogICAgICAgICAgfSkpKCk7CiAgICAgICAgfSwKICAgICAgICBnZXRPcGVyYXRvckxpc3Q6IGZ1bmN0aW9uIGdldE9wZXJhdG9yTGlzdChfcmVmNikgewogICAgICAgICAgdmFyIF90aGlzMTAgPSB0aGlzOwoKICAgICAgICAgIHZhciBzdHJlYW0gPSBfcmVmNi5zdHJlYW0sCiAgICAgICAgICAgIHRhc2sgPSBfcmVmNi50YXNrLAogICAgICAgICAgICByZXNvdXJjZXMgPSBfcmVmNi5yZXNvdXJjZXMsCiAgICAgICAgICAgIG9wZXJhdG9yTGlzdCA9IF9yZWY2Lm9wZXJhdG9yTGlzdCwKICAgICAgICAgICAgX3JlZjYkaW5pdGlhbFN0YXRlID0gX3JlZjYuaW5pdGlhbFN0YXRlLAogICAgICAgICAgICBpbml0aWFsU3RhdGUgPSBfcmVmNiRpbml0aWFsU3RhdGUgPT09IHZvaWQgMCA/IG51bGwgOiBfcmVmNiRpbml0aWFsU3RhdGU7CiAgICAgICAgICByZXNvdXJjZXMgPSByZXNvdXJjZXMgfHwgX3ByaW1pdGl2ZXMuRGljdC5lbXB0eTsKICAgICAgICAgIGluaXRpYWxTdGF0ZSA9IGluaXRpYWxTdGF0ZSB8fCBuZXcgRXZhbFN0YXRlKCk7CgogICAgICAgICAgaWYgKCFvcGVyYXRvckxpc3QpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdnZXRPcGVyYXRvckxpc3Q6IG1pc3NpbmcgIm9wZXJhdG9yTGlzdCIgcGFyYW1ldGVyJyk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgdmFyIHhyZWYgPSB0aGlzLnhyZWY7CiAgICAgICAgICB2YXIgcGFyc2luZ1RleHQgPSBmYWxzZTsKICAgICAgICAgIHZhciBpbWFnZUNhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKCiAgICAgICAgICB2YXIgeG9ianMgPSByZXNvdXJjZXMuZ2V0KCJYT2JqZWN0IikgfHwgX3ByaW1pdGl2ZXMuRGljdC5lbXB0eTsKCiAgICAgICAgICB2YXIgcGF0dGVybnMgPSByZXNvdXJjZXMuZ2V0KCJQYXR0ZXJuIikgfHwgX3ByaW1pdGl2ZXMuRGljdC5lbXB0eTsKCiAgICAgICAgICB2YXIgc3RhdGVNYW5hZ2VyID0gbmV3IFN0YXRlTWFuYWdlcihpbml0aWFsU3RhdGUpOwogICAgICAgICAgdmFyIHByZXByb2Nlc3NvciA9IG5ldyBFdmFsdWF0b3JQcmVwcm9jZXNzb3Ioc3RyZWFtLCB4cmVmLCBzdGF0ZU1hbmFnZXIpOwogICAgICAgICAgdmFyIHRpbWVTbG90TWFuYWdlciA9IG5ldyBUaW1lU2xvdE1hbmFnZXIoKTsKCiAgICAgICAgICBmdW5jdGlvbiBjbG9zZVBlbmRpbmdSZXN0b3JlT1BTKGFyZ3VtZW50KSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IHByZXByb2Nlc3Nvci5zYXZlZFN0YXRlc0RlcHRoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChfdXRpbC5PUFMucmVzdG9yZSwgW10pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIHByb21pc2VCb2R5KHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgICB2YXIgbmV4dCA9IGZ1bmN0aW9uIG5leHQocHJvbWlzZSkgewogICAgICAgICAgICAgIFByb21pc2UuYWxsKFtwcm9taXNlLCBvcGVyYXRvckxpc3QucmVhZHldKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgIHByb21pc2VCb2R5KHJlc29sdmUsIHJlamVjdCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgICAgICAgICByZWplY3QoZXgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sIHJlamVjdCk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICB0YXNrLmVuc3VyZU5vdFRlcm1pbmF0ZWQoKTsKICAgICAgICAgICAgdGltZVNsb3RNYW5hZ2VyLnJlc2V0KCk7CiAgICAgICAgICAgIHZhciBzdG9wLAogICAgICAgICAgICAgIG9wZXJhdGlvbiA9IHt9LAogICAgICAgICAgICAgIGksCiAgICAgICAgICAgICAgaWksCiAgICAgICAgICAgICAgY3M7CgogICAgICAgICAgICB3aGlsZSAoIShzdG9wID0gdGltZVNsb3RNYW5hZ2VyLmNoZWNrKCkpKSB7CiAgICAgICAgICAgICAgb3BlcmF0aW9uLmFyZ3MgPSBudWxsOwoKICAgICAgICAgICAgICBpZiAoIXByZXByb2Nlc3Nvci5yZWFkKG9wZXJhdGlvbikpIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBvcGVyYXRpb24uYXJnczsKICAgICAgICAgICAgICB2YXIgZm4gPSBvcGVyYXRpb24uZm47CgogICAgICAgICAgICAgIHN3aXRjaCAoZm4gfCAwKSB7CiAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5wYWludFhPYmplY3Q6CiAgICAgICAgICAgICAgICAgIHZhciBuYW1lID0gYXJnc1swXS5uYW1lOwoKICAgICAgICAgICAgICAgICAgaWYgKG5hbWUgJiYgaW1hZ2VDYWNoZVtuYW1lXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3JMaXN0LmFkZE9wKGltYWdlQ2FjaGVbbmFtZV0uZm4sIGltYWdlQ2FjaGVbbmFtZV0uYXJncyk7CiAgICAgICAgICAgICAgICAgICAgYXJncyA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIG5leHQobmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmVYT2JqZWN0LCByZWplY3RYT2JqZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFuYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIlhPYmplY3QgbXVzdCBiZSByZWZlcnJlZCB0byBieSBuYW1lLiIpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgdmFyIHhvYmogPSB4b2Jqcy5nZXQobmFtZSk7CgogICAgICAgICAgICAgICAgICAgIGlmICgheG9iaikgewogICAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3JMaXN0LmFkZE9wKGZuLCBhcmdzKTsKICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmVYT2JqZWN0KCk7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAoISgwLCBfcHJpbWl0aXZlcy5pc1N0cmVhbSkoeG9iaikpIHsKICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiWE9iamVjdCBzaG91bGQgYmUgYSBzdHJlYW0iKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHZhciB0eXBlID0geG9iai5kaWN0LmdldCgiU3VidHlwZSIpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoISgwLCBfcHJpbWl0aXZlcy5pc05hbWUpKHR5cGUpKSB7CiAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIlhPYmplY3Qgc2hvdWxkIGhhdmUgYSBOYW1lIHN1YnR5cGUiKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlLm5hbWUgPT09ICJGb3JtIikgewogICAgICAgICAgICAgICAgICAgICAgc3RhdGVNYW5hZ2VyLnNhdmUoKTsKICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYnVpbGRGb3JtWE9iamVjdChyZXNvdXJjZXMsIHhvYmosIG51bGwsIG9wZXJhdG9yTGlzdCwgdGFzaywgc3RhdGVNYW5hZ2VyLnN0YXRlLmNsb25lKCkpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZU1hbmFnZXIucmVzdG9yZSgpOwogICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlWE9iamVjdCgpOwogICAgICAgICAgICAgICAgICAgICAgfSwgcmVqZWN0WE9iamVjdCk7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlLm5hbWUgPT09ICJJbWFnZSIpIHsKICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYnVpbGRQYWludEltYWdlWE9iamVjdCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlczogcmVzb3VyY2VzLAogICAgICAgICAgICAgICAgICAgICAgICBpbWFnZTogeG9iaiwKICAgICAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3JMaXN0OiBvcGVyYXRvckxpc3QsCiAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlS2V5OiBuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICBpbWFnZUNhY2hlOiBpbWFnZUNhY2hlCiAgICAgICAgICAgICAgICAgICAgICB9KS50aGVuKHJlc29sdmVYT2JqZWN0LCByZWplY3RYT2JqZWN0KTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUubmFtZSA9PT0gIlBTIikgewogICAgICAgICAgICAgICAgICAgICAgKDAsIF91dGlsLmluZm8pKCJJZ25vcmVkIFhPYmplY3Qgc3VidHlwZSBQUyIpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIlVuaGFuZGxlZCBYT2JqZWN0IHN1YnR5cGUgIi5jb25jYXQodHlwZS5uYW1lKSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXNvbHZlWE9iamVjdCgpOwogICAgICAgICAgICAgICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlYXNvbiBpbnN0YW5jZW9mIF91dGlsLkFib3J0RXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZi5vcHRpb25zLmlnbm9yZUVycm9ycykgewogICAgICAgICAgICAgICAgICAgICAgc2VsZi5oYW5kbGVyLnNlbmQoIlVuc3VwcG9ydGVkRmVhdHVyZSIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmVhdHVyZUlkOiBfdXRpbC5VTlNVUFBPUlRFRF9GRUFUVVJFUy51bmtub3duCiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiZ2V0T3BlcmF0b3JMaXN0IC0gaWdub3JpbmcgWE9iamVjdDogXCIiLmNvbmNhdChyZWFzb24sICJcIi4iKSk7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICB0aHJvdyByZWFzb247CiAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNldEZvbnQ6CiAgICAgICAgICAgICAgICAgIHZhciBmb250U2l6ZSA9IGFyZ3NbMV07CiAgICAgICAgICAgICAgICAgIG5leHQoc2VsZi5oYW5kbGVTZXRGb250KHJlc291cmNlcywgYXJncywgbnVsbCwgb3BlcmF0b3JMaXN0LCB0YXNrLCBzdGF0ZU1hbmFnZXIuc3RhdGUpLnRoZW4oZnVuY3Rpb24gKGxvYWRlZE5hbWUpIHsKICAgICAgICAgICAgICAgICAgICBvcGVyYXRvckxpc3QuYWRkRGVwZW5kZW5jeShsb2FkZWROYW1lKTsKICAgICAgICAgICAgICAgICAgICBvcGVyYXRvckxpc3QuYWRkT3AoX3V0aWwuT1BTLnNldEZvbnQsIFtsb2FkZWROYW1lLCBmb250U2l6ZV0pOwogICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5iZWdpblRleHQ6CiAgICAgICAgICAgICAgICAgIHBhcnNpbmdUZXh0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMuZW5kVGV4dDoKICAgICAgICAgICAgICAgICAgcGFyc2luZ1RleHQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMuZW5kSW5saW5lSW1hZ2U6CiAgICAgICAgICAgICAgICAgIHZhciBjYWNoZUtleSA9IGFyZ3NbMF0uY2FjaGVLZXk7CgogICAgICAgICAgICAgICAgICBpZiAoY2FjaGVLZXkpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY2FjaGVFbnRyeSA9IGltYWdlQ2FjaGVbY2FjaGVLZXldOwoKICAgICAgICAgICAgICAgICAgICBpZiAoY2FjaGVFbnRyeSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICBvcGVyYXRvckxpc3QuYWRkT3AoY2FjaGVFbnRyeS5mbiwgY2FjaGVFbnRyeS5hcmdzKTsKICAgICAgICAgICAgICAgICAgICAgIGFyZ3MgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBuZXh0KHNlbGYuYnVpbGRQYWludEltYWdlWE9iamVjdCh7CiAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VzOiByZXNvdXJjZXMsCiAgICAgICAgICAgICAgICAgICAgaW1hZ2U6IGFyZ3NbMF0sCiAgICAgICAgICAgICAgICAgICAgaXNJbmxpbmU6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3JMaXN0OiBvcGVyYXRvckxpc3QsCiAgICAgICAgICAgICAgICAgICAgY2FjaGVLZXk6IGNhY2hlS2V5LAogICAgICAgICAgICAgICAgICAgIGltYWdlQ2FjaGU6IGltYWdlQ2FjaGUKICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2hvd1RleHQ6CiAgICAgICAgICAgICAgICAgIGlmICghc3RhdGVNYW5hZ2VyLnN0YXRlLmZvbnQpIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLmVuc3VyZVN0YXRlRm9udChzdGF0ZU1hbmFnZXIuc3RhdGUpOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBhcmdzWzBdID0gc2VsZi5oYW5kbGVUZXh0KGFyZ3NbMF0sIHN0YXRlTWFuYWdlci5zdGF0ZSk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNob3dTcGFjZWRUZXh0OgogICAgICAgICAgICAgICAgICBpZiAoIXN0YXRlTWFuYWdlci5zdGF0ZS5mb250KSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5lbnN1cmVTdGF0ZUZvbnQoc3RhdGVNYW5hZ2VyLnN0YXRlKTsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgdmFyIGFyciA9IGFyZ3NbMF07CiAgICAgICAgICAgICAgICAgIHZhciBjb21iaW5lZEdseXBocyA9IFtdOwogICAgICAgICAgICAgICAgICB2YXIgYXJyTGVuZ3RoID0gYXJyLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgdmFyIHN0YXRlID0gc3RhdGVNYW5hZ2VyLnN0YXRlOwoKICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGFyckxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGFyckl0ZW0gPSBhcnJbaV07CgogICAgICAgICAgICAgICAgICAgIGlmICgoMCwgX3V0aWwuaXNTdHJpbmcpKGFyckl0ZW0pKSB7CiAgICAgICAgICAgICAgICAgICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShjb21iaW5lZEdseXBocywgc2VsZi5oYW5kbGVUZXh0KGFyckl0ZW0sIHN0YXRlKSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgoMCwgX3V0aWwuaXNOdW0pKGFyckl0ZW0pKSB7CiAgICAgICAgICAgICAgICAgICAgICBjb21iaW5lZEdseXBocy5wdXNoKGFyckl0ZW0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgYXJnc1swXSA9IGNvbWJpbmVkR2x5cGhzOwogICAgICAgICAgICAgICAgICBmbiA9IF91dGlsLk9QUy5zaG93VGV4dDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMubmV4dExpbmVTaG93VGV4dDoKICAgICAgICAgICAgICAgICAgaWYgKCFzdGF0ZU1hbmFnZXIuc3RhdGUuZm9udCkgewogICAgICAgICAgICAgICAgICAgIHNlbGYuZW5zdXJlU3RhdGVGb250KHN0YXRlTWFuYWdlci5zdGF0ZSk7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChfdXRpbC5PUFMubmV4dExpbmUpOwogICAgICAgICAgICAgICAgICBhcmdzWzBdID0gc2VsZi5oYW5kbGVUZXh0KGFyZ3NbMF0sIHN0YXRlTWFuYWdlci5zdGF0ZSk7CiAgICAgICAgICAgICAgICAgIGZuID0gX3V0aWwuT1BTLnNob3dUZXh0OwogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5uZXh0TGluZVNldFNwYWNpbmdTaG93VGV4dDoKICAgICAgICAgICAgICAgICAgaWYgKCFzdGF0ZU1hbmFnZXIuc3RhdGUuZm9udCkgewogICAgICAgICAgICAgICAgICAgIHNlbGYuZW5zdXJlU3RhdGVGb250KHN0YXRlTWFuYWdlci5zdGF0ZSk7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChfdXRpbC5PUFMubmV4dExpbmUpOwogICAgICAgICAgICAgICAgICBvcGVyYXRvckxpc3QuYWRkT3AoX3V0aWwuT1BTLnNldFdvcmRTcGFjaW5nLCBbYXJncy5zaGlmdCgpXSk7CiAgICAgICAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChfdXRpbC5PUFMuc2V0Q2hhclNwYWNpbmcsIFthcmdzLnNoaWZ0KCldKTsKICAgICAgICAgICAgICAgICAgYXJnc1swXSA9IHNlbGYuaGFuZGxlVGV4dChhcmdzWzBdLCBzdGF0ZU1hbmFnZXIuc3RhdGUpOwogICAgICAgICAgICAgICAgICBmbiA9IF91dGlsLk9QUy5zaG93VGV4dDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0VGV4dFJlbmRlcmluZ01vZGU6CiAgICAgICAgICAgICAgICAgIHN0YXRlTWFuYWdlci5zdGF0ZS50ZXh0UmVuZGVyaW5nTW9kZSA9IGFyZ3NbMF07CiAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNldEZpbGxDb2xvclNwYWNlOgogICAgICAgICAgICAgICAgICBuZXh0KHNlbGYucGFyc2VDb2xvclNwYWNlKHsKICAgICAgICAgICAgICAgICAgICBjczogYXJnc1swXSwKICAgICAgICAgICAgICAgICAgICByZXNvdXJjZXM6IHJlc291cmNlcwogICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChjb2xvclNwYWNlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbG9yU3BhY2UpIHsKICAgICAgICAgICAgICAgICAgICAgIHN0YXRlTWFuYWdlci5zdGF0ZS5maWxsQ29sb3JTcGFjZSA9IGNvbG9yU3BhY2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5zZXRTdHJva2VDb2xvclNwYWNlOgogICAgICAgICAgICAgICAgICBuZXh0KHNlbGYucGFyc2VDb2xvclNwYWNlKHsKICAgICAgICAgICAgICAgICAgICBjczogYXJnc1swXSwKICAgICAgICAgICAgICAgICAgICByZXNvdXJjZXM6IHJlc291cmNlcwogICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChjb2xvclNwYWNlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbG9yU3BhY2UpIHsKICAgICAgICAgICAgICAgICAgICAgIHN0YXRlTWFuYWdlci5zdGF0ZS5zdHJva2VDb2xvclNwYWNlID0gY29sb3JTcGFjZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNldEZpbGxDb2xvcjoKICAgICAgICAgICAgICAgICAgY3MgPSBzdGF0ZU1hbmFnZXIuc3RhdGUuZmlsbENvbG9yU3BhY2U7CiAgICAgICAgICAgICAgICAgIGFyZ3MgPSBjcy5nZXRSZ2IoYXJncywgMCk7CiAgICAgICAgICAgICAgICAgIGZuID0gX3V0aWwuT1BTLnNldEZpbGxSR0JDb2xvcjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0U3Ryb2tlQ29sb3I6CiAgICAgICAgICAgICAgICAgIGNzID0gc3RhdGVNYW5hZ2VyLnN0YXRlLnN0cm9rZUNvbG9yU3BhY2U7CiAgICAgICAgICAgICAgICAgIGFyZ3MgPSBjcy5nZXRSZ2IoYXJncywgMCk7CiAgICAgICAgICAgICAgICAgIGZuID0gX3V0aWwuT1BTLnNldFN0cm9rZVJHQkNvbG9yOwogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5zZXRGaWxsR3JheToKICAgICAgICAgICAgICAgICAgc3RhdGVNYW5hZ2VyLnN0YXRlLmZpbGxDb2xvclNwYWNlID0gX2NvbG9yc3BhY2UuQ29sb3JTcGFjZS5zaW5nbGV0b25zLmdyYXk7CiAgICAgICAgICAgICAgICAgIGFyZ3MgPSBfY29sb3JzcGFjZS5Db2xvclNwYWNlLnNpbmdsZXRvbnMuZ3JheS5nZXRSZ2IoYXJncywgMCk7CiAgICAgICAgICAgICAgICAgIGZuID0gX3V0aWwuT1BTLnNldEZpbGxSR0JDb2xvcjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0U3Ryb2tlR3JheToKICAgICAgICAgICAgICAgICAgc3RhdGVNYW5hZ2VyLnN0YXRlLnN0cm9rZUNvbG9yU3BhY2UgPSBfY29sb3JzcGFjZS5Db2xvclNwYWNlLnNpbmdsZXRvbnMuZ3JheTsKICAgICAgICAgICAgICAgICAgYXJncyA9IF9jb2xvcnNwYWNlLkNvbG9yU3BhY2Uuc2luZ2xldG9ucy5ncmF5LmdldFJnYihhcmdzLCAwKTsKICAgICAgICAgICAgICAgICAgZm4gPSBfdXRpbC5PUFMuc2V0U3Ryb2tlUkdCQ29sb3I7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNldEZpbGxDTVlLQ29sb3I6CiAgICAgICAgICAgICAgICAgIHN0YXRlTWFuYWdlci5zdGF0ZS5maWxsQ29sb3JTcGFjZSA9IF9jb2xvcnNwYWNlLkNvbG9yU3BhY2Uuc2luZ2xldG9ucy5jbXlrOwogICAgICAgICAgICAgICAgICBhcmdzID0gX2NvbG9yc3BhY2UuQ29sb3JTcGFjZS5zaW5nbGV0b25zLmNteWsuZ2V0UmdiKGFyZ3MsIDApOwogICAgICAgICAgICAgICAgICBmbiA9IF91dGlsLk9QUy5zZXRGaWxsUkdCQ29sb3I7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNldFN0cm9rZUNNWUtDb2xvcjoKICAgICAgICAgICAgICAgICAgc3RhdGVNYW5hZ2VyLnN0YXRlLnN0cm9rZUNvbG9yU3BhY2UgPSBfY29sb3JzcGFjZS5Db2xvclNwYWNlLnNpbmdsZXRvbnMuY215azsKICAgICAgICAgICAgICAgICAgYXJncyA9IF9jb2xvcnNwYWNlLkNvbG9yU3BhY2Uuc2luZ2xldG9ucy5jbXlrLmdldFJnYihhcmdzLCAwKTsKICAgICAgICAgICAgICAgICAgZm4gPSBfdXRpbC5PUFMuc2V0U3Ryb2tlUkdCQ29sb3I7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNldEZpbGxSR0JDb2xvcjoKICAgICAgICAgICAgICAgICAgc3RhdGVNYW5hZ2VyLnN0YXRlLmZpbGxDb2xvclNwYWNlID0gX2NvbG9yc3BhY2UuQ29sb3JTcGFjZS5zaW5nbGV0b25zLnJnYjsKICAgICAgICAgICAgICAgICAgYXJncyA9IF9jb2xvcnNwYWNlLkNvbG9yU3BhY2Uuc2luZ2xldG9ucy5yZ2IuZ2V0UmdiKGFyZ3MsIDApOwogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5zZXRTdHJva2VSR0JDb2xvcjoKICAgICAgICAgICAgICAgICAgc3RhdGVNYW5hZ2VyLnN0YXRlLnN0cm9rZUNvbG9yU3BhY2UgPSBfY29sb3JzcGFjZS5Db2xvclNwYWNlLnNpbmdsZXRvbnMucmdiOwogICAgICAgICAgICAgICAgICBhcmdzID0gX2NvbG9yc3BhY2UuQ29sb3JTcGFjZS5zaW5nbGV0b25zLnJnYi5nZXRSZ2IoYXJncywgMCk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNldEZpbGxDb2xvck46CiAgICAgICAgICAgICAgICAgIGNzID0gc3RhdGVNYW5hZ2VyLnN0YXRlLmZpbGxDb2xvclNwYWNlOwoKICAgICAgICAgICAgICAgICAgaWYgKGNzLm5hbWUgPT09ICJQYXR0ZXJuIikgewogICAgICAgICAgICAgICAgICAgIG5leHQoc2VsZi5oYW5kbGVDb2xvck4ob3BlcmF0b3JMaXN0LCBfdXRpbC5PUFMuc2V0RmlsbENvbG9yTiwgYXJncywgY3MsIHBhdHRlcm5zLCByZXNvdXJjZXMsIHRhc2spKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGFyZ3MgPSBjcy5nZXRSZ2IoYXJncywgMCk7CiAgICAgICAgICAgICAgICAgIGZuID0gX3V0aWwuT1BTLnNldEZpbGxSR0JDb2xvcjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0U3Ryb2tlQ29sb3JOOgogICAgICAgICAgICAgICAgICBjcyA9IHN0YXRlTWFuYWdlci5zdGF0ZS5zdHJva2VDb2xvclNwYWNlOwoKICAgICAgICAgICAgICAgICAgaWYgKGNzLm5hbWUgPT09ICJQYXR0ZXJuIikgewogICAgICAgICAgICAgICAgICAgIG5leHQoc2VsZi5oYW5kbGVDb2xvck4ob3BlcmF0b3JMaXN0LCBfdXRpbC5PUFMuc2V0U3Ryb2tlQ29sb3JOLCBhcmdzLCBjcywgcGF0dGVybnMsIHJlc291cmNlcywgdGFzaykpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgYXJncyA9IGNzLmdldFJnYihhcmdzLCAwKTsKICAgICAgICAgICAgICAgICAgZm4gPSBfdXRpbC5PUFMuc2V0U3Ryb2tlUkdCQ29sb3I7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNoYWRpbmdGaWxsOgogICAgICAgICAgICAgICAgICB2YXIgc2hhZGluZ1JlcyA9IHJlc291cmNlcy5nZXQoIlNoYWRpbmciKTsKCiAgICAgICAgICAgICAgICAgIGlmICghc2hhZGluZ1JlcykgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiTm8gc2hhZGluZyByZXNvdXJjZSBmb3VuZCIpOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB2YXIgc2hhZGluZyA9IHNoYWRpbmdSZXMuZ2V0KGFyZ3NbMF0ubmFtZSk7CgogICAgICAgICAgICAgICAgICBpZiAoIXNoYWRpbmcpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIk5vIHNoYWRpbmcgb2JqZWN0IGZvdW5kIik7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIHZhciBzaGFkaW5nRmlsbCA9IF9wYXR0ZXJuLlBhdHRlcm4ucGFyc2VTaGFkaW5nKHNoYWRpbmcsIG51bGwsIHhyZWYsIHJlc291cmNlcywgc2VsZi5oYW5kbGVyLCBzZWxmLnBkZkZ1bmN0aW9uRmFjdG9yeSk7CgogICAgICAgICAgICAgICAgICB2YXIgcGF0dGVybklSID0gc2hhZGluZ0ZpbGwuZ2V0SVIoKTsKICAgICAgICAgICAgICAgICAgYXJncyA9IFtwYXR0ZXJuSVJdOwogICAgICAgICAgICAgICAgICBmbiA9IF91dGlsLk9QUy5zaGFkaW5nRmlsbDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0R1N0YXRlOgogICAgICAgICAgICAgICAgICB2YXIgZGljdE5hbWUgPSBhcmdzWzBdOwogICAgICAgICAgICAgICAgICB2YXIgZXh0R1N0YXRlID0gcmVzb3VyY2VzLmdldCgiRXh0R1N0YXRlIik7CgogICAgICAgICAgICAgICAgICBpZiAoISgwLCBfcHJpbWl0aXZlcy5pc0RpY3QpKGV4dEdTdGF0ZSkgfHwgIWV4dEdTdGF0ZS5oYXMoZGljdE5hbWUubmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgdmFyIGdTdGF0ZSA9IGV4dEdTdGF0ZS5nZXQoZGljdE5hbWUubmFtZSk7CiAgICAgICAgICAgICAgICAgIG5leHQoc2VsZi5zZXRHU3RhdGUocmVzb3VyY2VzLCBnU3RhdGUsIG9wZXJhdG9yTGlzdCwgdGFzaywgc3RhdGVNYW5hZ2VyKSk7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5tb3ZlVG86CiAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5saW5lVG86CiAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5jdXJ2ZVRvOgogICAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMuY3VydmVUbzI6CiAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5jdXJ2ZVRvMzoKICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLmNsb3NlUGF0aDoKICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnJlY3RhbmdsZToKICAgICAgICAgICAgICAgICAgc2VsZi5idWlsZFBhdGgob3BlcmF0b3JMaXN0LCBmbiwgYXJncywgcGFyc2luZ1RleHQpOwogICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5tYXJrUG9pbnQ6CiAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5tYXJrUG9pbnRQcm9wczoKICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLmJlZ2luTWFya2VkQ29udGVudDoKICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLmJlZ2luTWFya2VkQ29udGVudFByb3BzOgogICAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMuZW5kTWFya2VkQ29udGVudDoKICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLmJlZ2luQ29tcGF0OgogICAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMuZW5kQ29tcGF0OgogICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICBpZiAoYXJncyAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDAsIGlpID0gYXJncy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoYXJnc1tpXSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAoaSA8IGlpKSB7CiAgICAgICAgICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoImdldE9wZXJhdG9yTGlzdCAtIGlnbm9yaW5nIG9wZXJhdG9yOiAiICsgZm4pOwogICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgb3BlcmF0b3JMaXN0LmFkZE9wKGZuLCBhcmdzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHN0b3ApIHsKICAgICAgICAgICAgICBuZXh0KGRlZmVycmVkKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNsb3NlUGVuZGluZ1Jlc3RvcmVPUFMoKTsKICAgICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgICBpZiAocmVhc29uIGluc3RhbmNlb2YgX3V0aWwuQWJvcnRFeGNlcHRpb24pIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChfdGhpczEwLm9wdGlvbnMuaWdub3JlRXJyb3JzKSB7CiAgICAgICAgICAgICAgX3RoaXMxMC5oYW5kbGVyLnNlbmQoIlVuc3VwcG9ydGVkRmVhdHVyZSIsIHsKICAgICAgICAgICAgICAgIGZlYXR1cmVJZDogX3V0aWwuVU5TVVBQT1JURURfRkVBVFVSRVMudW5rbm93bgogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoImdldE9wZXJhdG9yTGlzdCAtIGlnbm9yaW5nIGVycm9ycyBkdXJpbmcgXCIiLmNvbmNhdCh0YXNrLm5hbWUsICJcIiAiKSArICJ0YXNrOiBcIiIuY29uY2F0KHJlYXNvbiwgIlwiLiIpKTsKICAgICAgICAgICAgICBjbG9zZVBlbmRpbmdSZXN0b3JlT1BTKCk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aHJvdyByZWFzb247CiAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGdldFRleHRDb250ZW50OiBmdW5jdGlvbiBnZXRUZXh0Q29udGVudChfcmVmNykgewogICAgICAgICAgdmFyIF90aGlzMTEgPSB0aGlzOwoKICAgICAgICAgIHZhciBzdHJlYW0gPSBfcmVmNy5zdHJlYW0sCiAgICAgICAgICAgIHRhc2sgPSBfcmVmNy50YXNrLAogICAgICAgICAgICByZXNvdXJjZXMgPSBfcmVmNy5yZXNvdXJjZXMsCiAgICAgICAgICAgIF9yZWY3JHN0YXRlTWFuYWdlciA9IF9yZWY3LnN0YXRlTWFuYWdlciwKICAgICAgICAgICAgc3RhdGVNYW5hZ2VyID0gX3JlZjckc3RhdGVNYW5hZ2VyID09PSB2b2lkIDAgPyBudWxsIDogX3JlZjckc3RhdGVNYW5hZ2VyLAogICAgICAgICAgICBfcmVmNyRub3JtYWxpemVXaGl0ZXMgPSBfcmVmNy5ub3JtYWxpemVXaGl0ZXNwYWNlLAogICAgICAgICAgICBub3JtYWxpemVXaGl0ZXNwYWNlID0gX3JlZjckbm9ybWFsaXplV2hpdGVzID09PSB2b2lkIDAgPyBmYWxzZSA6IF9yZWY3JG5vcm1hbGl6ZVdoaXRlcywKICAgICAgICAgICAgX3JlZjckY29tYmluZVRleHRJdGVtID0gX3JlZjcuY29tYmluZVRleHRJdGVtcywKICAgICAgICAgICAgY29tYmluZVRleHRJdGVtcyA9IF9yZWY3JGNvbWJpbmVUZXh0SXRlbSA9PT0gdm9pZCAwID8gZmFsc2UgOiBfcmVmNyRjb21iaW5lVGV4dEl0ZW0sCiAgICAgICAgICAgIHNpbmsgPSBfcmVmNy5zaW5rLAogICAgICAgICAgICBfcmVmNyRzZWVuU3R5bGVzID0gX3JlZjcuc2VlblN0eWxlcywKICAgICAgICAgICAgc2VlblN0eWxlcyA9IF9yZWY3JHNlZW5TdHlsZXMgPT09IHZvaWQgMCA/IE9iamVjdC5jcmVhdGUobnVsbCkgOiBfcmVmNyRzZWVuU3R5bGVzOwogICAgICAgICAgcmVzb3VyY2VzID0gcmVzb3VyY2VzIHx8IF9wcmltaXRpdmVzLkRpY3QuZW1wdHk7CiAgICAgICAgICBzdGF0ZU1hbmFnZXIgPSBzdGF0ZU1hbmFnZXIgfHwgbmV3IFN0YXRlTWFuYWdlcihuZXcgVGV4dFN0YXRlKCkpOwogICAgICAgICAgdmFyIFdoaXRlc3BhY2VSZWdleHAgPSAvXHMvZzsKICAgICAgICAgIHZhciB0ZXh0Q29udGVudCA9IHsKICAgICAgICAgICAgaXRlbXM6IFtdLAogICAgICAgICAgICBzdHlsZXM6IE9iamVjdC5jcmVhdGUobnVsbCkKICAgICAgICAgIH07CiAgICAgICAgICB2YXIgdGV4dENvbnRlbnRJdGVtID0gewogICAgICAgICAgICBpbml0aWFsaXplZDogZmFsc2UsCiAgICAgICAgICAgIHN0cjogW10sCiAgICAgICAgICAgIHdpZHRoOiAwLAogICAgICAgICAgICBoZWlnaHQ6IDAsCiAgICAgICAgICAgIHZlcnRpY2FsOiBmYWxzZSwKICAgICAgICAgICAgbGFzdEFkdmFuY2VXaWR0aDogMCwKICAgICAgICAgICAgbGFzdEFkdmFuY2VIZWlnaHQ6IDAsCiAgICAgICAgICAgIHRleHRBZHZhbmNlU2NhbGU6IDAsCiAgICAgICAgICAgIHNwYWNlV2lkdGg6IDAsCiAgICAgICAgICAgIGZha2VTcGFjZU1pbjogSW5maW5pdHksCiAgICAgICAgICAgIGZha2VNdWx0aVNwYWNlTWluOiBJbmZpbml0eSwKICAgICAgICAgICAgZmFrZU11bHRpU3BhY2VNYXg6IC0wLAogICAgICAgICAgICB0ZXh0UnVuQnJlYWtBbGxvd2VkOiBmYWxzZSwKICAgICAgICAgICAgdHJhbnNmb3JtOiBudWxsLAogICAgICAgICAgICBmb250TmFtZTogbnVsbAogICAgICAgICAgfTsKICAgICAgICAgIHZhciBTUEFDRV9GQUNUT1IgPSAwLjM7CiAgICAgICAgICB2YXIgTVVMVElfU1BBQ0VfRkFDVE9SID0gMS41OwogICAgICAgICAgdmFyIE1VTFRJX1NQQUNFX0ZBQ1RPUl9NQVggPSA0OwogICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgdmFyIHhyZWYgPSB0aGlzLnhyZWY7CiAgICAgICAgICB2YXIgeG9ianMgPSBudWxsOwogICAgICAgICAgdmFyIHNraXBFbXB0eVhPYmpzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICAgIHZhciBwcmVwcm9jZXNzb3IgPSBuZXcgRXZhbHVhdG9yUHJlcHJvY2Vzc29yKHN0cmVhbSwgeHJlZiwgc3RhdGVNYW5hZ2VyKTsKICAgICAgICAgIHZhciB0ZXh0U3RhdGU7CgogICAgICAgICAgZnVuY3Rpb24gZW5zdXJlVGV4dENvbnRlbnRJdGVtKCkgewogICAgICAgICAgICBpZiAodGV4dENvbnRlbnRJdGVtLmluaXRpYWxpemVkKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRleHRDb250ZW50SXRlbTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGZvbnQgPSB0ZXh0U3RhdGUuZm9udDsKCiAgICAgICAgICAgIGlmICghKGZvbnQubG9hZGVkTmFtZSBpbiBzZWVuU3R5bGVzKSkgewogICAgICAgICAgICAgIHNlZW5TdHlsZXNbZm9udC5sb2FkZWROYW1lXSA9IHRydWU7CiAgICAgICAgICAgICAgdGV4dENvbnRlbnQuc3R5bGVzW2ZvbnQubG9hZGVkTmFtZV0gPSB7CiAgICAgICAgICAgICAgICBmb250RmFtaWx5OiBmb250LmZhbGxiYWNrTmFtZSwKICAgICAgICAgICAgICAgIGFzY2VudDogZm9udC5hc2NlbnQsCiAgICAgICAgICAgICAgICBkZXNjZW50OiBmb250LmRlc2NlbnQsCiAgICAgICAgICAgICAgICB2ZXJ0aWNhbDogISFmb250LnZlcnRpY2FsCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGV4dENvbnRlbnRJdGVtLmZvbnROYW1lID0gZm9udC5sb2FkZWROYW1lOwogICAgICAgICAgICB2YXIgdHNtID0gW3RleHRTdGF0ZS5mb250U2l6ZSAqIHRleHRTdGF0ZS50ZXh0SFNjYWxlLCAwLCAwLCB0ZXh0U3RhdGUuZm9udFNpemUsIDAsIHRleHRTdGF0ZS50ZXh0UmlzZV07CgogICAgICAgICAgICBpZiAoZm9udC5pc1R5cGUzRm9udCAmJiB0ZXh0U3RhdGUuZm9udFNpemUgPD0gMSAmJiAhKDAsIF91dGlsLmlzQXJyYXlFcXVhbCkodGV4dFN0YXRlLmZvbnRNYXRyaXgsIF91dGlsLkZPTlRfSURFTlRJVFlfTUFUUklYKSkgewogICAgICAgICAgICAgIHZhciBnbHlwaEhlaWdodCA9IGZvbnQuYmJveFszXSAtIGZvbnQuYmJveFsxXTsKCiAgICAgICAgICAgICAgaWYgKGdseXBoSGVpZ2h0ID4gMCkgewogICAgICAgICAgICAgICAgdHNtWzNdICo9IGdseXBoSGVpZ2h0ICogdGV4dFN0YXRlLmZvbnRNYXRyaXhbM107CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgdHJtID0gX3V0aWwuVXRpbC50cmFuc2Zvcm0odGV4dFN0YXRlLmN0bSwgX3V0aWwuVXRpbC50cmFuc2Zvcm0odGV4dFN0YXRlLnRleHRNYXRyaXgsIHRzbSkpOwoKICAgICAgICAgICAgdGV4dENvbnRlbnRJdGVtLnRyYW5zZm9ybSA9IHRybTsKCiAgICAgICAgICAgIGlmICghZm9udC52ZXJ0aWNhbCkgewogICAgICAgICAgICAgIHRleHRDb250ZW50SXRlbS53aWR0aCA9IDA7CiAgICAgICAgICAgICAgdGV4dENvbnRlbnRJdGVtLmhlaWdodCA9IE1hdGguc3FydCh0cm1bMl0gKiB0cm1bMl0gKyB0cm1bM10gKiB0cm1bM10pOwogICAgICAgICAgICAgIHRleHRDb250ZW50SXRlbS52ZXJ0aWNhbCA9IGZhbHNlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRleHRDb250ZW50SXRlbS53aWR0aCA9IE1hdGguc3FydCh0cm1bMF0gKiB0cm1bMF0gKyB0cm1bMV0gKiB0cm1bMV0pOwogICAgICAgICAgICAgIHRleHRDb250ZW50SXRlbS5oZWlnaHQgPSAwOwogICAgICAgICAgICAgIHRleHRDb250ZW50SXRlbS52ZXJ0aWNhbCA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBhID0gdGV4dFN0YXRlLnRleHRMaW5lTWF0cml4WzBdOwogICAgICAgICAgICB2YXIgYiA9IHRleHRTdGF0ZS50ZXh0TGluZU1hdHJpeFsxXTsKICAgICAgICAgICAgdmFyIHNjYWxlTGluZVggPSBNYXRoLnNxcnQoYSAqIGEgKyBiICogYik7CiAgICAgICAgICAgIGEgPSB0ZXh0U3RhdGUuY3RtWzBdOwogICAgICAgICAgICBiID0gdGV4dFN0YXRlLmN0bVsxXTsKICAgICAgICAgICAgdmFyIHNjYWxlQ3RtWCA9IE1hdGguc3FydChhICogYSArIGIgKiBiKTsKICAgICAgICAgICAgdGV4dENvbnRlbnRJdGVtLnRleHRBZHZhbmNlU2NhbGUgPSBzY2FsZUN0bVggKiBzY2FsZUxpbmVYOwogICAgICAgICAgICB0ZXh0Q29udGVudEl0ZW0ubGFzdEFkdmFuY2VXaWR0aCA9IDA7CiAgICAgICAgICAgIHRleHRDb250ZW50SXRlbS5sYXN0QWR2YW5jZUhlaWdodCA9IDA7CiAgICAgICAgICAgIHZhciBzcGFjZVdpZHRoID0gZm9udC5zcGFjZVdpZHRoIC8gMTAwMCAqIHRleHRTdGF0ZS5mb250U2l6ZTsKCiAgICAgICAgICAgIGlmIChzcGFjZVdpZHRoKSB7CiAgICAgICAgICAgICAgdGV4dENvbnRlbnRJdGVtLnNwYWNlV2lkdGggPSBzcGFjZVdpZHRoOwogICAgICAgICAgICAgIHRleHRDb250ZW50SXRlbS5mYWtlU3BhY2VNaW4gPSBzcGFjZVdpZHRoICogU1BBQ0VfRkFDVE9SOwogICAgICAgICAgICAgIHRleHRDb250ZW50SXRlbS5mYWtlTXVsdGlTcGFjZU1pbiA9IHNwYWNlV2lkdGggKiBNVUxUSV9TUEFDRV9GQUNUT1I7CiAgICAgICAgICAgICAgdGV4dENvbnRlbnRJdGVtLmZha2VNdWx0aVNwYWNlTWF4ID0gc3BhY2VXaWR0aCAqIE1VTFRJX1NQQUNFX0ZBQ1RPUl9NQVg7CiAgICAgICAgICAgICAgdGV4dENvbnRlbnRJdGVtLnRleHRSdW5CcmVha0FsbG93ZWQgPSAhZm9udC5pc01vbm9zcGFjZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0ZXh0Q29udGVudEl0ZW0uc3BhY2VXaWR0aCA9IDA7CiAgICAgICAgICAgICAgdGV4dENvbnRlbnRJdGVtLmZha2VTcGFjZU1pbiA9IEluZmluaXR5OwogICAgICAgICAgICAgIHRleHRDb250ZW50SXRlbS5mYWtlTXVsdGlTcGFjZU1pbiA9IEluZmluaXR5OwogICAgICAgICAgICAgIHRleHRDb250ZW50SXRlbS5mYWtlTXVsdGlTcGFjZU1heCA9IDA7CiAgICAgICAgICAgICAgdGV4dENvbnRlbnRJdGVtLnRleHRSdW5CcmVha0FsbG93ZWQgPSBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGV4dENvbnRlbnRJdGVtLmluaXRpYWxpemVkID0gdHJ1ZTsKICAgICAgICAgICAgcmV0dXJuIHRleHRDb250ZW50SXRlbTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiByZXBsYWNlV2hpdGVzcGFjZShzdHIpIHsKICAgICAgICAgICAgdmFyIGkgPSAwLAogICAgICAgICAgICAgIGlpID0gc3RyLmxlbmd0aCwKICAgICAgICAgICAgICBjb2RlOwoKICAgICAgICAgICAgd2hpbGUgKGkgPCBpaSAmJiAoY29kZSA9IHN0ci5jaGFyQ29kZUF0KGkpKSA+PSAweDIwICYmIGNvZGUgPD0gMHg3ZikgewogICAgICAgICAgICAgIGkrKzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGkgPCBpaSA/IHN0ci5yZXBsYWNlKFdoaXRlc3BhY2VSZWdleHAsICIgIikgOiBzdHI7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gcnVuQmlkaVRyYW5zZm9ybSh0ZXh0Q2h1bmspIHsKICAgICAgICAgICAgdmFyIHN0ciA9IHRleHRDaHVuay5zdHIuam9pbigiIik7CiAgICAgICAgICAgIHZhciBiaWRpUmVzdWx0ID0gKDAsIF9iaWRpLmJpZGkpKHN0ciwgLTEsIHRleHRDaHVuay52ZXJ0aWNhbCk7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgc3RyOiBub3JtYWxpemVXaGl0ZXNwYWNlID8gcmVwbGFjZVdoaXRlc3BhY2UoYmlkaVJlc3VsdC5zdHIpIDogYmlkaVJlc3VsdC5zdHIsCiAgICAgICAgICAgICAgZGlyOiBiaWRpUmVzdWx0LmRpciwKICAgICAgICAgICAgICB3aWR0aDogdGV4dENodW5rLndpZHRoLAogICAgICAgICAgICAgIGhlaWdodDogdGV4dENodW5rLmhlaWdodCwKICAgICAgICAgICAgICB0cmFuc2Zvcm06IHRleHRDaHVuay50cmFuc2Zvcm0sCiAgICAgICAgICAgICAgZm9udE5hbWU6IHRleHRDaHVuay5mb250TmFtZQogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGhhbmRsZVNldEZvbnQoZm9udE5hbWUsIGZvbnRSZWYpIHsKICAgICAgICAgICAgcmV0dXJuIHNlbGYubG9hZEZvbnQoZm9udE5hbWUsIGZvbnRSZWYsIHJlc291cmNlcykudGhlbihmdW5jdGlvbiAodHJhbnNsYXRlZCkgewogICAgICAgICAgICAgIHRleHRTdGF0ZS5mb250ID0gdHJhbnNsYXRlZC5mb250OwogICAgICAgICAgICAgIHRleHRTdGF0ZS5mb250TWF0cml4ID0gdHJhbnNsYXRlZC5mb250LmZvbnRNYXRyaXggfHwgX3V0aWwuRk9OVF9JREVOVElUWV9NQVRSSVg7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGJ1aWxkVGV4dENvbnRlbnRJdGVtKGNoYXJzKSB7CiAgICAgICAgICAgIHZhciBmb250ID0gdGV4dFN0YXRlLmZvbnQ7CiAgICAgICAgICAgIHZhciB0ZXh0Q2h1bmsgPSBlbnN1cmVUZXh0Q29udGVudEl0ZW0oKTsKICAgICAgICAgICAgdmFyIHdpZHRoID0gMDsKICAgICAgICAgICAgdmFyIGhlaWdodCA9IDA7CiAgICAgICAgICAgIHZhciBnbHlwaHMgPSBmb250LmNoYXJzVG9HbHlwaHMoY2hhcnMpOwoKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBnbHlwaHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICB2YXIgZ2x5cGggPSBnbHlwaHNbaV07CiAgICAgICAgICAgICAgdmFyIGdseXBoV2lkdGggPSBudWxsOwoKICAgICAgICAgICAgICBpZiAoZm9udC52ZXJ0aWNhbCAmJiBnbHlwaC52bWV0cmljKSB7CiAgICAgICAgICAgICAgICBnbHlwaFdpZHRoID0gZ2x5cGgudm1ldHJpY1swXTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZ2x5cGhXaWR0aCA9IGdseXBoLndpZHRoOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIGdseXBoVW5pY29kZSA9IGdseXBoLnVuaWNvZGU7CiAgICAgICAgICAgICAgdmFyIE5vcm1hbGl6ZWRVbmljb2RlcyA9ICgwLCBfdW5pY29kZS5nZXROb3JtYWxpemVkVW5pY29kZXMpKCk7CgogICAgICAgICAgICAgIGlmIChOb3JtYWxpemVkVW5pY29kZXNbZ2x5cGhVbmljb2RlXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBnbHlwaFVuaWNvZGUgPSBOb3JtYWxpemVkVW5pY29kZXNbZ2x5cGhVbmljb2RlXTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGdseXBoVW5pY29kZSA9ICgwLCBfdW5pY29kZS5yZXZlcnNlSWZSdGwpKGdseXBoVW5pY29kZSk7CiAgICAgICAgICAgICAgdmFyIGNoYXJTcGFjaW5nID0gdGV4dFN0YXRlLmNoYXJTcGFjaW5nOwoKICAgICAgICAgICAgICBpZiAoZ2x5cGguaXNTcGFjZSkgewogICAgICAgICAgICAgICAgdmFyIHdvcmRTcGFjaW5nID0gdGV4dFN0YXRlLndvcmRTcGFjaW5nOwogICAgICAgICAgICAgICAgY2hhclNwYWNpbmcgKz0gd29yZFNwYWNpbmc7CgogICAgICAgICAgICAgICAgaWYgKHdvcmRTcGFjaW5nID4gMCkgewogICAgICAgICAgICAgICAgICBhZGRGYWtlU3BhY2VzKHdvcmRTcGFjaW5nLCB0ZXh0Q2h1bmsuc3RyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciB0eCA9IDA7CiAgICAgICAgICAgICAgdmFyIHR5ID0gMDsKCiAgICAgICAgICAgICAgaWYgKCFmb250LnZlcnRpY2FsKSB7CiAgICAgICAgICAgICAgICB2YXIgdzAgPSBnbHlwaFdpZHRoICogdGV4dFN0YXRlLmZvbnRNYXRyaXhbMF07CiAgICAgICAgICAgICAgICB0eCA9ICh3MCAqIHRleHRTdGF0ZS5mb250U2l6ZSArIGNoYXJTcGFjaW5nKSAqIHRleHRTdGF0ZS50ZXh0SFNjYWxlOwogICAgICAgICAgICAgICAgd2lkdGggKz0gdHg7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHZhciB3MSA9IGdseXBoV2lkdGggKiB0ZXh0U3RhdGUuZm9udE1hdHJpeFswXTsKICAgICAgICAgICAgICAgIHR5ID0gdzEgKiB0ZXh0U3RhdGUuZm9udFNpemUgKyBjaGFyU3BhY2luZzsKICAgICAgICAgICAgICAgIGhlaWdodCArPSB0eTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHRleHRTdGF0ZS50cmFuc2xhdGVUZXh0TWF0cml4KHR4LCB0eSk7CiAgICAgICAgICAgICAgdGV4dENodW5rLnN0ci5wdXNoKGdseXBoVW5pY29kZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghZm9udC52ZXJ0aWNhbCkgewogICAgICAgICAgICAgIHRleHRDaHVuay5sYXN0QWR2YW5jZVdpZHRoID0gd2lkdGg7CiAgICAgICAgICAgICAgdGV4dENodW5rLndpZHRoICs9IHdpZHRoOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRleHRDaHVuay5sYXN0QWR2YW5jZUhlaWdodCA9IGhlaWdodDsKICAgICAgICAgICAgICB0ZXh0Q2h1bmsuaGVpZ2h0ICs9IE1hdGguYWJzKGhlaWdodCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB0ZXh0Q2h1bms7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gYWRkRmFrZVNwYWNlcyh3aWR0aCwgc3RyQnVmKSB7CiAgICAgICAgICAgIGlmICh3aWR0aCA8IHRleHRDb250ZW50SXRlbS5mYWtlU3BhY2VNaW4pIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh3aWR0aCA8IHRleHRDb250ZW50SXRlbS5mYWtlTXVsdGlTcGFjZU1pbikgewogICAgICAgICAgICAgIHN0ckJ1Zi5wdXNoKCIgIik7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgZmFrZVNwYWNlcyA9IE1hdGgucm91bmQod2lkdGggLyB0ZXh0Q29udGVudEl0ZW0uc3BhY2VXaWR0aCk7CgogICAgICAgICAgICB3aGlsZSAoZmFrZVNwYWNlcy0tID4gMCkgewogICAgICAgICAgICAgIHN0ckJ1Zi5wdXNoKCIgIik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBmbHVzaFRleHRDb250ZW50SXRlbSgpIHsKICAgICAgICAgICAgaWYgKCF0ZXh0Q29udGVudEl0ZW0uaW5pdGlhbGl6ZWQpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghdGV4dENvbnRlbnRJdGVtLnZlcnRpY2FsKSB7CiAgICAgICAgICAgICAgdGV4dENvbnRlbnRJdGVtLndpZHRoICo9IHRleHRDb250ZW50SXRlbS50ZXh0QWR2YW5jZVNjYWxlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRleHRDb250ZW50SXRlbS5oZWlnaHQgKj0gdGV4dENvbnRlbnRJdGVtLnRleHRBZHZhbmNlU2NhbGU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRleHRDb250ZW50Lml0ZW1zLnB1c2gocnVuQmlkaVRyYW5zZm9ybSh0ZXh0Q29udGVudEl0ZW0pKTsKICAgICAgICAgICAgdGV4dENvbnRlbnRJdGVtLmluaXRpYWxpemVkID0gZmFsc2U7CiAgICAgICAgICAgIHRleHRDb250ZW50SXRlbS5zdHIubGVuZ3RoID0gMDsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBlbnF1ZXVlQ2h1bmsoKSB7CiAgICAgICAgICAgIHZhciBsZW5ndGggPSB0ZXh0Q29udGVudC5pdGVtcy5sZW5ndGg7CgogICAgICAgICAgICBpZiAobGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIHNpbmsuZW5xdWV1ZSh0ZXh0Q29udGVudCwgbGVuZ3RoKTsKICAgICAgICAgICAgICB0ZXh0Q29udGVudC5pdGVtcyA9IFtdOwogICAgICAgICAgICAgIHRleHRDb250ZW50LnN0eWxlcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgdGltZVNsb3RNYW5hZ2VyID0gbmV3IFRpbWVTbG90TWFuYWdlcigpOwogICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIHByb21pc2VCb2R5KHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgICB2YXIgbmV4dCA9IGZ1bmN0aW9uIG5leHQocHJvbWlzZSkgewogICAgICAgICAgICAgIGVucXVldWVDaHVuaygpOwogICAgICAgICAgICAgIFByb21pc2UuYWxsKFtwcm9taXNlLCBzaW5rLnJlYWR5XSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICBwcm9taXNlQm9keShyZXNvbHZlLCByZWplY3QpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgICAgICAgICAgcmVqZWN0KGV4KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LCByZWplY3QpOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgdGFzay5lbnN1cmVOb3RUZXJtaW5hdGVkKCk7CiAgICAgICAgICAgIHRpbWVTbG90TWFuYWdlci5yZXNldCgpOwogICAgICAgICAgICB2YXIgc3RvcCwKICAgICAgICAgICAgICBvcGVyYXRpb24gPSB7fSwKICAgICAgICAgICAgICBhcmdzID0gW107CgogICAgICAgICAgICB3aGlsZSAoIShzdG9wID0gdGltZVNsb3RNYW5hZ2VyLmNoZWNrKCkpKSB7CiAgICAgICAgICAgICAgYXJncy5sZW5ndGggPSAwOwogICAgICAgICAgICAgIG9wZXJhdGlvbi5hcmdzID0gYXJnczsKCiAgICAgICAgICAgICAgaWYgKCFwcmVwcm9jZXNzb3IucmVhZChvcGVyYXRpb24pKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHRleHRTdGF0ZSA9IHN0YXRlTWFuYWdlci5zdGF0ZTsKICAgICAgICAgICAgICB2YXIgZm4gPSBvcGVyYXRpb24uZm47CiAgICAgICAgICAgICAgYXJncyA9IG9wZXJhdGlvbi5hcmdzOwogICAgICAgICAgICAgIHZhciBhZHZhbmNlLCBkaWZmOwoKICAgICAgICAgICAgICBzd2l0Y2ggKGZuIHwgMCkgewogICAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0Rm9udDoKICAgICAgICAgICAgICAgICAgdmFyIGZvbnROYW1lQXJnID0gYXJnc1swXS5uYW1lLAogICAgICAgICAgICAgICAgICAgIGZvbnRTaXplQXJnID0gYXJnc1sxXTsKCiAgICAgICAgICAgICAgICAgIGlmICh0ZXh0U3RhdGUuZm9udCAmJiBmb250TmFtZUFyZyA9PT0gdGV4dFN0YXRlLmZvbnROYW1lICYmIGZvbnRTaXplQXJnID09PSB0ZXh0U3RhdGUuZm9udFNpemUpIHsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgZmx1c2hUZXh0Q29udGVudEl0ZW0oKTsKICAgICAgICAgICAgICAgICAgdGV4dFN0YXRlLmZvbnROYW1lID0gZm9udE5hbWVBcmc7CiAgICAgICAgICAgICAgICAgIHRleHRTdGF0ZS5mb250U2l6ZSA9IGZvbnRTaXplQXJnOwogICAgICAgICAgICAgICAgICBuZXh0KGhhbmRsZVNldEZvbnQoZm9udE5hbWVBcmcsIG51bGwpKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNldFRleHRSaXNlOgogICAgICAgICAgICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgICAgICAgICAgICB0ZXh0U3RhdGUudGV4dFJpc2UgPSBhcmdzWzBdOwogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5zZXRIU2NhbGU6CiAgICAgICAgICAgICAgICAgIGZsdXNoVGV4dENvbnRlbnRJdGVtKCk7CiAgICAgICAgICAgICAgICAgIHRleHRTdGF0ZS50ZXh0SFNjYWxlID0gYXJnc1swXSAvIDEwMDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0TGVhZGluZzoKICAgICAgICAgICAgICAgICAgZmx1c2hUZXh0Q29udGVudEl0ZW0oKTsKICAgICAgICAgICAgICAgICAgdGV4dFN0YXRlLmxlYWRpbmcgPSBhcmdzWzBdOwogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5tb3ZlVGV4dDoKICAgICAgICAgICAgICAgICAgdmFyIGlzU2FtZVRleHRMaW5lID0gIXRleHRTdGF0ZS5mb250ID8gZmFsc2UgOiAodGV4dFN0YXRlLmZvbnQudmVydGljYWwgPyBhcmdzWzBdIDogYXJnc1sxXSkgPT09IDA7CiAgICAgICAgICAgICAgICAgIGFkdmFuY2UgPSBhcmdzWzBdIC0gYXJnc1sxXTsKCiAgICAgICAgICAgICAgICAgIGlmIChjb21iaW5lVGV4dEl0ZW1zICYmIGlzU2FtZVRleHRMaW5lICYmIHRleHRDb250ZW50SXRlbS5pbml0aWFsaXplZCAmJiBhZHZhbmNlID4gMCAmJiBhZHZhbmNlIDw9IHRleHRDb250ZW50SXRlbS5mYWtlTXVsdGlTcGFjZU1heCkgewogICAgICAgICAgICAgICAgICAgIHRleHRTdGF0ZS50cmFuc2xhdGVUZXh0TGluZU1hdHJpeChhcmdzWzBdLCBhcmdzWzFdKTsKICAgICAgICAgICAgICAgICAgICB0ZXh0Q29udGVudEl0ZW0ud2lkdGggKz0gYXJnc1swXSAtIHRleHRDb250ZW50SXRlbS5sYXN0QWR2YW5jZVdpZHRoOwogICAgICAgICAgICAgICAgICAgIHRleHRDb250ZW50SXRlbS5oZWlnaHQgKz0gYXJnc1sxXSAtIHRleHRDb250ZW50SXRlbS5sYXN0QWR2YW5jZUhlaWdodDsKICAgICAgICAgICAgICAgICAgICBkaWZmID0gYXJnc1swXSAtIHRleHRDb250ZW50SXRlbS5sYXN0QWR2YW5jZVdpZHRoIC0gKGFyZ3NbMV0gLSB0ZXh0Q29udGVudEl0ZW0ubGFzdEFkdmFuY2VIZWlnaHQpOwogICAgICAgICAgICAgICAgICAgIGFkZEZha2VTcGFjZXMoZGlmZiwgdGV4dENvbnRlbnRJdGVtLnN0cik7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGZsdXNoVGV4dENvbnRlbnRJdGVtKCk7CiAgICAgICAgICAgICAgICAgIHRleHRTdGF0ZS50cmFuc2xhdGVUZXh0TGluZU1hdHJpeChhcmdzWzBdLCBhcmdzWzFdKTsKICAgICAgICAgICAgICAgICAgdGV4dFN0YXRlLnRleHRNYXRyaXggPSB0ZXh0U3RhdGUudGV4dExpbmVNYXRyaXguc2xpY2UoKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0TGVhZGluZ01vdmVUZXh0OgogICAgICAgICAgICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgICAgICAgICAgICB0ZXh0U3RhdGUubGVhZGluZyA9IC1hcmdzWzFdOwogICAgICAgICAgICAgICAgICB0ZXh0U3RhdGUudHJhbnNsYXRlVGV4dExpbmVNYXRyaXgoYXJnc1swXSwgYXJnc1sxXSk7CiAgICAgICAgICAgICAgICAgIHRleHRTdGF0ZS50ZXh0TWF0cml4ID0gdGV4dFN0YXRlLnRleHRMaW5lTWF0cml4LnNsaWNlKCk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLm5leHRMaW5lOgogICAgICAgICAgICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgICAgICAgICAgICB0ZXh0U3RhdGUuY2FycmlhZ2VSZXR1cm4oKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0VGV4dE1hdHJpeDoKICAgICAgICAgICAgICAgICAgYWR2YW5jZSA9IHRleHRTdGF0ZS5jYWxjVGV4dExpbmVNYXRyaXhBZHZhbmNlKGFyZ3NbMF0sIGFyZ3NbMV0sIGFyZ3NbMl0sIGFyZ3NbM10sIGFyZ3NbNF0sIGFyZ3NbNV0pOwoKICAgICAgICAgICAgICAgICAgaWYgKGNvbWJpbmVUZXh0SXRlbXMgJiYgYWR2YW5jZSAhPT0gbnVsbCAmJiB0ZXh0Q29udGVudEl0ZW0uaW5pdGlhbGl6ZWQgJiYgYWR2YW5jZS52YWx1ZSA+IDAgJiYgYWR2YW5jZS52YWx1ZSA8PSB0ZXh0Q29udGVudEl0ZW0uZmFrZU11bHRpU3BhY2VNYXgpIHsKICAgICAgICAgICAgICAgICAgICB0ZXh0U3RhdGUudHJhbnNsYXRlVGV4dExpbmVNYXRyaXgoYWR2YW5jZS53aWR0aCwgYWR2YW5jZS5oZWlnaHQpOwogICAgICAgICAgICAgICAgICAgIHRleHRDb250ZW50SXRlbS53aWR0aCArPSBhZHZhbmNlLndpZHRoIC0gdGV4dENvbnRlbnRJdGVtLmxhc3RBZHZhbmNlV2lkdGg7CiAgICAgICAgICAgICAgICAgICAgdGV4dENvbnRlbnRJdGVtLmhlaWdodCArPSBhZHZhbmNlLmhlaWdodCAtIHRleHRDb250ZW50SXRlbS5sYXN0QWR2YW5jZUhlaWdodDsKICAgICAgICAgICAgICAgICAgICBkaWZmID0gYWR2YW5jZS53aWR0aCAtIHRleHRDb250ZW50SXRlbS5sYXN0QWR2YW5jZVdpZHRoIC0gKGFkdmFuY2UuaGVpZ2h0IC0gdGV4dENvbnRlbnRJdGVtLmxhc3RBZHZhbmNlSGVpZ2h0KTsKICAgICAgICAgICAgICAgICAgICBhZGRGYWtlU3BhY2VzKGRpZmYsIHRleHRDb250ZW50SXRlbS5zdHIpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgICAgICAgICAgICB0ZXh0U3RhdGUuc2V0VGV4dE1hdHJpeChhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdLCBhcmdzWzNdLCBhcmdzWzRdLCBhcmdzWzVdKTsKICAgICAgICAgICAgICAgICAgdGV4dFN0YXRlLnNldFRleHRMaW5lTWF0cml4KGFyZ3NbMF0sIGFyZ3NbMV0sIGFyZ3NbMl0sIGFyZ3NbM10sIGFyZ3NbNF0sIGFyZ3NbNV0pOwogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlIF91dGlsLk9QUy5zZXRDaGFyU3BhY2luZzoKICAgICAgICAgICAgICAgICAgdGV4dFN0YXRlLmNoYXJTcGFjaW5nID0gYXJnc1swXTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0V29yZFNwYWNpbmc6CiAgICAgICAgICAgICAgICAgIHRleHRTdGF0ZS53b3JkU3BhY2luZyA9IGFyZ3NbMF07CiAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLmJlZ2luVGV4dDoKICAgICAgICAgICAgICAgICAgZmx1c2hUZXh0Q29udGVudEl0ZW0oKTsKICAgICAgICAgICAgICAgICAgdGV4dFN0YXRlLnRleHRNYXRyaXggPSBfdXRpbC5JREVOVElUWV9NQVRSSVguc2xpY2UoKTsKICAgICAgICAgICAgICAgICAgdGV4dFN0YXRlLnRleHRMaW5lTWF0cml4ID0gX3V0aWwuSURFTlRJVFlfTUFUUklYLnNsaWNlKCk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNob3dTcGFjZWRUZXh0OgogICAgICAgICAgICAgICAgICBpZiAoIXN0YXRlTWFuYWdlci5zdGF0ZS5mb250KSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5lbnN1cmVTdGF0ZUZvbnQoc3RhdGVNYW5hZ2VyLnN0YXRlKTsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgdmFyIGl0ZW1zID0gYXJnc1swXTsKICAgICAgICAgICAgICAgICAgdmFyIG9mZnNldDsKCiAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwLCBqaiA9IGl0ZW1zLmxlbmd0aDsgaiA8IGpqOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGl0ZW1zW2pdID09PSAic3RyaW5nIikgewogICAgICAgICAgICAgICAgICAgICAgYnVpbGRUZXh0Q29udGVudEl0ZW0oaXRlbXNbal0pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoKDAsIF91dGlsLmlzTnVtKShpdGVtc1tqXSkpIHsKICAgICAgICAgICAgICAgICAgICAgIGVuc3VyZVRleHRDb250ZW50SXRlbSgpOwogICAgICAgICAgICAgICAgICAgICAgYWR2YW5jZSA9IGl0ZW1zW2pdICogdGV4dFN0YXRlLmZvbnRTaXplIC8gMTAwMDsKICAgICAgICAgICAgICAgICAgICAgIHZhciBicmVha1RleHRSdW4gPSBmYWxzZTsKCiAgICAgICAgICAgICAgICAgICAgICBpZiAodGV4dFN0YXRlLmZvbnQudmVydGljYWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gYWR2YW5jZTsKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dFN0YXRlLnRyYW5zbGF0ZVRleHRNYXRyaXgoMCwgb2Zmc2V0KTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWtUZXh0UnVuID0gdGV4dENvbnRlbnRJdGVtLnRleHRSdW5CcmVha0FsbG93ZWQgJiYgYWR2YW5jZSA+IHRleHRDb250ZW50SXRlbS5mYWtlTXVsdGlTcGFjZU1heDsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghYnJlYWtUZXh0UnVuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dENvbnRlbnRJdGVtLmhlaWdodCArPSBvZmZzZXQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFkdmFuY2UgPSAtYWR2YW5jZTsKICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gYWR2YW5jZSAqIHRleHRTdGF0ZS50ZXh0SFNjYWxlOwogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0U3RhdGUudHJhbnNsYXRlVGV4dE1hdHJpeChvZmZzZXQsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBicmVha1RleHRSdW4gPSB0ZXh0Q29udGVudEl0ZW0udGV4dFJ1bkJyZWFrQWxsb3dlZCAmJiBhZHZhbmNlID4gdGV4dENvbnRlbnRJdGVtLmZha2VNdWx0aVNwYWNlTWF4OwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFicmVha1RleHRSdW4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0Q29udGVudEl0ZW0ud2lkdGggKz0gb2Zmc2V0OwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgaWYgKGJyZWFrVGV4dFJ1bikgewogICAgICAgICAgICAgICAgICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhZHZhbmNlID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBhZGRGYWtlU3BhY2VzKGFkdmFuY2UsIHRleHRDb250ZW50SXRlbS5zdHIpOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2hvd1RleHQ6CiAgICAgICAgICAgICAgICAgIGlmICghc3RhdGVNYW5hZ2VyLnN0YXRlLmZvbnQpIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLmVuc3VyZVN0YXRlRm9udChzdGF0ZU1hbmFnZXIuc3RhdGUpOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBidWlsZFRleHRDb250ZW50SXRlbShhcmdzWzBdKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMubmV4dExpbmVTaG93VGV4dDoKICAgICAgICAgICAgICAgICAgaWYgKCFzdGF0ZU1hbmFnZXIuc3RhdGUuZm9udCkgewogICAgICAgICAgICAgICAgICAgIHNlbGYuZW5zdXJlU3RhdGVGb250KHN0YXRlTWFuYWdlci5zdGF0ZSk7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGZsdXNoVGV4dENvbnRlbnRJdGVtKCk7CiAgICAgICAgICAgICAgICAgIHRleHRTdGF0ZS5jYXJyaWFnZVJldHVybigpOwogICAgICAgICAgICAgICAgICBidWlsZFRleHRDb250ZW50SXRlbShhcmdzWzBdKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMubmV4dExpbmVTZXRTcGFjaW5nU2hvd1RleHQ6CiAgICAgICAgICAgICAgICAgIGlmICghc3RhdGVNYW5hZ2VyLnN0YXRlLmZvbnQpIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLmVuc3VyZVN0YXRlRm9udChzdGF0ZU1hbmFnZXIuc3RhdGUpOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgICAgICAgICAgICB0ZXh0U3RhdGUud29yZFNwYWNpbmcgPSBhcmdzWzBdOwogICAgICAgICAgICAgICAgICB0ZXh0U3RhdGUuY2hhclNwYWNpbmcgPSBhcmdzWzFdOwogICAgICAgICAgICAgICAgICB0ZXh0U3RhdGUuY2FycmlhZ2VSZXR1cm4oKTsKICAgICAgICAgICAgICAgICAgYnVpbGRUZXh0Q29udGVudEl0ZW0oYXJnc1syXSk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnBhaW50WE9iamVjdDoKICAgICAgICAgICAgICAgICAgZmx1c2hUZXh0Q29udGVudEl0ZW0oKTsKCiAgICAgICAgICAgICAgICAgIGlmICgheG9ianMpIHsKICAgICAgICAgICAgICAgICAgICB4b2JqcyA9IHJlc291cmNlcy5nZXQoIlhPYmplY3QiKSB8fCBfcHJpbWl0aXZlcy5EaWN0LmVtcHR5OwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IGFyZ3NbMF0ubmFtZTsKCiAgICAgICAgICAgICAgICAgIGlmIChuYW1lICYmIHNraXBFbXB0eVhPYmpzW25hbWVdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgbmV4dChuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZVhPYmplY3QsIHJlamVjdFhPYmplY3QpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIW5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiWE9iamVjdCBtdXN0IGJlIHJlZmVycmVkIHRvIGJ5IG5hbWUuIik7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICB2YXIgeG9iaiA9IHhvYmpzLmdldChuYW1lKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCF4b2JqKSB7CiAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlWE9iamVjdCgpOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKCEoMCwgX3ByaW1pdGl2ZXMuaXNTdHJlYW0pKHhvYmopKSB7CiAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIlhPYmplY3Qgc2hvdWxkIGJlIGEgc3RyZWFtIik7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICB2YXIgdHlwZSA9IHhvYmouZGljdC5nZXQoIlN1YnR5cGUiKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCEoMCwgX3ByaW1pdGl2ZXMuaXNOYW1lKSh0eXBlKSkgewogICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJYT2JqZWN0IHNob3VsZCBoYXZlIGEgTmFtZSBzdWJ0eXBlIik7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZS5uYW1lICE9PSAiRm9ybSIpIHsKICAgICAgICAgICAgICAgICAgICAgIHNraXBFbXB0eVhPYmpzW25hbWVdID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmVYT2JqZWN0KCk7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICB2YXIgY3VycmVudFN0YXRlID0gc3RhdGVNYW5hZ2VyLnN0YXRlLmNsb25lKCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIHhPYmpTdGF0ZU1hbmFnZXIgPSBuZXcgU3RhdGVNYW5hZ2VyKGN1cnJlbnRTdGF0ZSk7CiAgICAgICAgICAgICAgICAgICAgdmFyIG1hdHJpeCA9IHhvYmouZGljdC5nZXRBcnJheSgiTWF0cml4Iik7CgogICAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KG1hdHJpeCkgJiYgbWF0cml4Lmxlbmd0aCA9PT0gNikgewogICAgICAgICAgICAgICAgICAgICAgeE9ialN0YXRlTWFuYWdlci50cmFuc2Zvcm0obWF0cml4KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGVucXVldWVDaHVuaygpOwogICAgICAgICAgICAgICAgICAgIHZhciBzaW5rV3JhcHBlciA9IHsKICAgICAgICAgICAgICAgICAgICAgIGVucXVldWVJbnZva2VkOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgIGVucXVldWU6IGZ1bmN0aW9uIGVucXVldWUoY2h1bmssIHNpemUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbnF1ZXVlSW52b2tlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIHNpbmsuZW5xdWV1ZShjaHVuaywgc2l6ZSk7CiAgICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICAgIGdldCBkZXNpcmVkU2l6ZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNpbmsuZGVzaXJlZFNpemU7CiAgICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICAgIGdldCByZWFkeSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNpbmsucmVhZHk7CiAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgc2VsZi5nZXRUZXh0Q29udGVudCh7CiAgICAgICAgICAgICAgICAgICAgICBzdHJlYW06IHhvYmosCiAgICAgICAgICAgICAgICAgICAgICB0YXNrOiB0YXNrLAogICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VzOiB4b2JqLmRpY3QuZ2V0KCJSZXNvdXJjZXMiKSB8fCByZXNvdXJjZXMsCiAgICAgICAgICAgICAgICAgICAgICBzdGF0ZU1hbmFnZXI6IHhPYmpTdGF0ZU1hbmFnZXIsCiAgICAgICAgICAgICAgICAgICAgICBub3JtYWxpemVXaGl0ZXNwYWNlOiBub3JtYWxpemVXaGl0ZXNwYWNlLAogICAgICAgICAgICAgICAgICAgICAgY29tYmluZVRleHRJdGVtczogY29tYmluZVRleHRJdGVtcywKICAgICAgICAgICAgICAgICAgICAgIHNpbms6IHNpbmtXcmFwcGVyLAogICAgICAgICAgICAgICAgICAgICAgc2VlblN0eWxlczogc2VlblN0eWxlcwogICAgICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKCFzaW5rV3JhcHBlci5lbnF1ZXVlSW52b2tlZCkgewogICAgICAgICAgICAgICAgICAgICAgICBza2lwRW1wdHlYT2Jqc1tuYW1lXSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZVhPYmplY3QoKTsKICAgICAgICAgICAgICAgICAgICB9LCByZWplY3RYT2JqZWN0KTsKICAgICAgICAgICAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgICAgICAgICAgIGlmIChyZWFzb24gaW5zdGFuY2VvZiBfdXRpbC5BYm9ydEV4Y2VwdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGYub3B0aW9ucy5pZ25vcmVFcnJvcnMpIHsKICAgICAgICAgICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiZ2V0VGV4dENvbnRlbnQgLSBpZ25vcmluZyBYT2JqZWN0OiBcIiIuY29uY2F0KHJlYXNvbiwgIlwiLiIpKTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHRocm93IHJlYXNvbjsKICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0R1N0YXRlOgogICAgICAgICAgICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgICAgICAgICAgICB2YXIgZGljdE5hbWUgPSBhcmdzWzBdOwogICAgICAgICAgICAgICAgICB2YXIgZXh0R1N0YXRlID0gcmVzb3VyY2VzLmdldCgiRXh0R1N0YXRlIik7CgogICAgICAgICAgICAgICAgICBpZiAoISgwLCBfcHJpbWl0aXZlcy5pc0RpY3QpKGV4dEdTdGF0ZSkgfHwgISgwLCBfcHJpbWl0aXZlcy5pc05hbWUpKGRpY3ROYW1lKSkgewogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB2YXIgZ1N0YXRlID0gZXh0R1N0YXRlLmdldChkaWN0TmFtZS5uYW1lKTsKCiAgICAgICAgICAgICAgICAgIGlmICghKDAsIF9wcmltaXRpdmVzLmlzRGljdCkoZ1N0YXRlKSkgewogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB2YXIgZ1N0YXRlRm9udCA9IGdTdGF0ZS5nZXQoIkZvbnQiKTsKCiAgICAgICAgICAgICAgICAgIGlmIChnU3RhdGVGb250KSB7CiAgICAgICAgICAgICAgICAgICAgdGV4dFN0YXRlLmZvbnROYW1lID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICB0ZXh0U3RhdGUuZm9udFNpemUgPSBnU3RhdGVGb250WzFdOwogICAgICAgICAgICAgICAgICAgIG5leHQoaGFuZGxlU2V0Rm9udChudWxsLCBnU3RhdGVGb250WzBdKSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICh0ZXh0Q29udGVudC5pdGVtcy5sZW5ndGggPj0gc2luay5kZXNpcmVkU2l6ZSkgewogICAgICAgICAgICAgICAgc3RvcCA9IHRydWU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChzdG9wKSB7CiAgICAgICAgICAgICAgbmV4dChkZWZlcnJlZCk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgICAgICBlbnF1ZXVlQ2h1bmsoKTsKICAgICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgICBpZiAocmVhc29uIGluc3RhbmNlb2YgX3V0aWwuQWJvcnRFeGNlcHRpb24pIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChfdGhpczExLm9wdGlvbnMuaWdub3JlRXJyb3JzKSB7CiAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJnZXRUZXh0Q29udGVudCAtIGlnbm9yaW5nIGVycm9ycyBkdXJpbmcgXCIiLmNvbmNhdCh0YXNrLm5hbWUsICJcIiAiKSArICJ0YXNrOiBcIiIuY29uY2F0KHJlYXNvbiwgIlwiLiIpKTsKICAgICAgICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgICAgICAgIGVucXVldWVDaHVuaygpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhyb3cgcmVhc29uOwogICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBleHRyYWN0RGF0YVN0cnVjdHVyZXM6IGZ1bmN0aW9uIFBhcnRpYWxFdmFsdWF0b3JfZXh0cmFjdERhdGFTdHJ1Y3R1cmVzKGRpY3QsIGJhc2VEaWN0LCBwcm9wZXJ0aWVzKSB7CiAgICAgICAgICB2YXIgX3RoaXMxMiA9IHRoaXM7CgogICAgICAgICAgdmFyIHhyZWYgPSB0aGlzLnhyZWY7CiAgICAgICAgICB2YXIgY2lkVG9HaWRCeXRlczsKICAgICAgICAgIHZhciB0b1VuaWNvZGUgPSBkaWN0LmdldCgiVG9Vbmljb2RlIikgfHwgYmFzZURpY3QuZ2V0KCJUb1VuaWNvZGUiKTsKICAgICAgICAgIHZhciB0b1VuaWNvZGVQcm9taXNlID0gdG9Vbmljb2RlID8gdGhpcy5yZWFkVG9Vbmljb2RlKHRvVW5pY29kZSkgOiBQcm9taXNlLnJlc29sdmUodW5kZWZpbmVkKTsKCiAgICAgICAgICBpZiAocHJvcGVydGllcy5jb21wb3NpdGUpIHsKICAgICAgICAgICAgdmFyIGNpZFN5c3RlbUluZm8gPSBkaWN0LmdldCgiQ0lEU3lzdGVtSW5mbyIpOwoKICAgICAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc0RpY3QpKGNpZFN5c3RlbUluZm8pKSB7CiAgICAgICAgICAgICAgcHJvcGVydGllcy5jaWRTeXN0ZW1JbmZvID0gewogICAgICAgICAgICAgICAgcmVnaXN0cnk6ICgwLCBfdXRpbC5zdHJpbmdUb1BERlN0cmluZykoY2lkU3lzdGVtSW5mby5nZXQoIlJlZ2lzdHJ5IikpLAogICAgICAgICAgICAgICAgb3JkZXJpbmc6ICgwLCBfdXRpbC5zdHJpbmdUb1BERlN0cmluZykoY2lkU3lzdGVtSW5mby5nZXQoIk9yZGVyaW5nIikpLAogICAgICAgICAgICAgICAgc3VwcGxlbWVudDogY2lkU3lzdGVtSW5mby5nZXQoIlN1cHBsZW1lbnQiKQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBjaWRUb0dpZE1hcCA9IGRpY3QuZ2V0KCJDSURUb0dJRE1hcCIpOwoKICAgICAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc1N0cmVhbSkoY2lkVG9HaWRNYXApKSB7CiAgICAgICAgICAgICAgY2lkVG9HaWRCeXRlcyA9IGNpZFRvR2lkTWFwLmdldEJ5dGVzKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZGlmZmVyZW5jZXMgPSBbXTsKICAgICAgICAgIHZhciBiYXNlRW5jb2RpbmdOYW1lID0gbnVsbDsKICAgICAgICAgIHZhciBlbmNvZGluZzsKCiAgICAgICAgICBpZiAoZGljdC5oYXMoIkVuY29kaW5nIikpIHsKICAgICAgICAgICAgZW5jb2RpbmcgPSBkaWN0LmdldCgiRW5jb2RpbmciKTsKCiAgICAgICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNEaWN0KShlbmNvZGluZykpIHsKICAgICAgICAgICAgICBiYXNlRW5jb2RpbmdOYW1lID0gZW5jb2RpbmcuZ2V0KCJCYXNlRW5jb2RpbmciKTsKICAgICAgICAgICAgICBiYXNlRW5jb2RpbmdOYW1lID0gKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkoYmFzZUVuY29kaW5nTmFtZSkgPyBiYXNlRW5jb2RpbmdOYW1lLm5hbWUgOiBudWxsOwoKICAgICAgICAgICAgICBpZiAoZW5jb2RpbmcuaGFzKCJEaWZmZXJlbmNlcyIpKSB7CiAgICAgICAgICAgICAgICB2YXIgZGlmZkVuY29kaW5nID0gZW5jb2RpbmcuZ2V0KCJEaWZmZXJlbmNlcyIpOwogICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gMDsKCiAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMCwgamogPSBkaWZmRW5jb2RpbmcubGVuZ3RoOyBqIDwgamo7IGorKykgewogICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHhyZWYuZmV0Y2hJZlJlZihkaWZmRW5jb2Rpbmdbal0pOwoKICAgICAgICAgICAgICAgICAgaWYgKCgwLCBfdXRpbC5pc051bSkoZGF0YSkpIHsKICAgICAgICAgICAgICAgICAgICBpbmRleCA9IGRhdGE7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkoZGF0YSkpIHsKICAgICAgICAgICAgICAgICAgICBkaWZmZXJlbmNlc1tpbmRleCsrXSA9IGRhdGEubmFtZTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkludmFsaWQgZW50cnkgaW4gJ0RpZmZlcmVuY2VzJyBhcnJheTogIi5jb25jYXQoZGF0YSkpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc05hbWUpKGVuY29kaW5nKSkgewogICAgICAgICAgICAgIGJhc2VFbmNvZGluZ05hbWUgPSBlbmNvZGluZy5uYW1lOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiRW5jb2RpbmcgaXMgbm90IGEgTmFtZSBub3IgYSBEaWN0Iik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChiYXNlRW5jb2RpbmdOYW1lICE9PSAiTWFjUm9tYW5FbmNvZGluZyIgJiYgYmFzZUVuY29kaW5nTmFtZSAhPT0gIk1hY0V4cGVydEVuY29kaW5nIiAmJiBiYXNlRW5jb2RpbmdOYW1lICE9PSAiV2luQW5zaUVuY29kaW5nIikgewogICAgICAgICAgICAgIGJhc2VFbmNvZGluZ05hbWUgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGJhc2VFbmNvZGluZ05hbWUpIHsKICAgICAgICAgICAgcHJvcGVydGllcy5kZWZhdWx0RW5jb2RpbmcgPSAoMCwgX2VuY29kaW5ncy5nZXRFbmNvZGluZykoYmFzZUVuY29kaW5nTmFtZSkuc2xpY2UoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciBpc1N5bWJvbGljRm9udCA9ICEhKHByb3BlcnRpZXMuZmxhZ3MgJiBfZm9udHMuRm9udEZsYWdzLlN5bWJvbGljKTsKICAgICAgICAgICAgdmFyIGlzTm9uc3ltYm9saWNGb250ID0gISEocHJvcGVydGllcy5mbGFncyAmIF9mb250cy5Gb250RmxhZ3MuTm9uc3ltYm9saWMpOwogICAgICAgICAgICBlbmNvZGluZyA9IF9lbmNvZGluZ3MuU3RhbmRhcmRFbmNvZGluZzsKCiAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzLnR5cGUgPT09ICJUcnVlVHlwZSIgJiYgIWlzTm9uc3ltYm9saWNGb250KSB7CiAgICAgICAgICAgICAgZW5jb2RpbmcgPSBfZW5jb2RpbmdzLldpbkFuc2lFbmNvZGluZzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGlzU3ltYm9saWNGb250KSB7CiAgICAgICAgICAgICAgZW5jb2RpbmcgPSBfZW5jb2RpbmdzLk1hY1JvbWFuRW5jb2Rpbmc7CgogICAgICAgICAgICAgIGlmICghcHJvcGVydGllcy5maWxlKSB7CiAgICAgICAgICAgICAgICBpZiAoL1N5bWJvbC9pLnRlc3QocHJvcGVydGllcy5uYW1lKSkgewogICAgICAgICAgICAgICAgICBlbmNvZGluZyA9IF9lbmNvZGluZ3MuU3ltYm9sU2V0RW5jb2Rpbmc7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKC9EaW5nYmF0c3xXaW5nZGluZ3MvaS50ZXN0KHByb3BlcnRpZXMubmFtZSkpIHsKICAgICAgICAgICAgICAgICAgZW5jb2RpbmcgPSBfZW5jb2RpbmdzLlphcGZEaW5nYmF0c0VuY29kaW5nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHJvcGVydGllcy5kZWZhdWx0RW5jb2RpbmcgPSBlbmNvZGluZzsKICAgICAgICAgIH0KCiAgICAgICAgICBwcm9wZXJ0aWVzLmRpZmZlcmVuY2VzID0gZGlmZmVyZW5jZXM7CiAgICAgICAgICBwcm9wZXJ0aWVzLmJhc2VFbmNvZGluZ05hbWUgPSBiYXNlRW5jb2RpbmdOYW1lOwogICAgICAgICAgcHJvcGVydGllcy5oYXNFbmNvZGluZyA9ICEhYmFzZUVuY29kaW5nTmFtZSB8fCBkaWZmZXJlbmNlcy5sZW5ndGggPiAwOwogICAgICAgICAgcHJvcGVydGllcy5kaWN0ID0gZGljdDsKICAgICAgICAgIHJldHVybiB0b1VuaWNvZGVQcm9taXNlLnRoZW4oZnVuY3Rpb24gKHRvVW5pY29kZSkgewogICAgICAgICAgICBwcm9wZXJ0aWVzLnRvVW5pY29kZSA9IHRvVW5pY29kZTsKICAgICAgICAgICAgcmV0dXJuIF90aGlzMTIuYnVpbGRUb1VuaWNvZGUocHJvcGVydGllcyk7CiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uICh0b1VuaWNvZGUpIHsKICAgICAgICAgICAgcHJvcGVydGllcy50b1VuaWNvZGUgPSB0b1VuaWNvZGU7CgogICAgICAgICAgICBpZiAoY2lkVG9HaWRCeXRlcykgewogICAgICAgICAgICAgIHByb3BlcnRpZXMuY2lkVG9HaWRNYXAgPSBfdGhpczEyLnJlYWRDaWRUb0dpZE1hcChjaWRUb0dpZEJ5dGVzLCB0b1VuaWNvZGUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcHJvcGVydGllczsKICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgX2J1aWxkU2ltcGxlRm9udFRvVW5pY29kZTogZnVuY3Rpb24gX2J1aWxkU2ltcGxlRm9udFRvVW5pY29kZShwcm9wZXJ0aWVzKSB7CiAgICAgICAgICB2YXIgZm9yY2VHbHlwaHMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwogICAgICAgICAgKDAsIF91dGlsLmFzc2VydCkoIXByb3BlcnRpZXMuY29tcG9zaXRlLCAiTXVzdCBiZSBhIHNpbXBsZSBmb250LiIpOwogICAgICAgICAgdmFyIHRvVW5pY29kZSA9IFtdOwogICAgICAgICAgdmFyIGVuY29kaW5nID0gcHJvcGVydGllcy5kZWZhdWx0RW5jb2Rpbmcuc2xpY2UoKTsKICAgICAgICAgIHZhciBiYXNlRW5jb2RpbmdOYW1lID0gcHJvcGVydGllcy5iYXNlRW5jb2RpbmdOYW1lOwogICAgICAgICAgdmFyIGRpZmZlcmVuY2VzID0gcHJvcGVydGllcy5kaWZmZXJlbmNlczsKCiAgICAgICAgICBmb3IgKHZhciBjaGFyY29kZSBpbiBkaWZmZXJlbmNlcykgewogICAgICAgICAgICB2YXIgZ2x5cGhOYW1lID0gZGlmZmVyZW5jZXNbY2hhcmNvZGVdOwoKICAgICAgICAgICAgaWYgKGdseXBoTmFtZSA9PT0gIi5ub3RkZWYiKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGVuY29kaW5nW2NoYXJjb2RlXSA9IGdseXBoTmFtZTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZ2x5cGhzVW5pY29kZU1hcCA9ICgwLCBfZ2x5cGhsaXN0LmdldEdseXBoc1VuaWNvZGUpKCk7CgogICAgICAgICAgZm9yICh2YXIgX2NoYXJjb2RlIGluIGVuY29kaW5nKSB7CiAgICAgICAgICAgIHZhciBfZ2x5cGhOYW1lID0gZW5jb2RpbmdbX2NoYXJjb2RlXTsKCiAgICAgICAgICAgIGlmIChfZ2x5cGhOYW1lID09PSAiIikgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9IGVsc2UgaWYgKGdseXBoc1VuaWNvZGVNYXBbX2dseXBoTmFtZV0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIHZhciBjb2RlID0gMDsKCiAgICAgICAgICAgICAgc3dpdGNoIChfZ2x5cGhOYW1lWzBdKSB7CiAgICAgICAgICAgICAgICBjYXNlICJHIjoKICAgICAgICAgICAgICAgICAgaWYgKF9nbHlwaE5hbWUubGVuZ3RoID09PSAzKSB7CiAgICAgICAgICAgICAgICAgICAgY29kZSA9IHBhcnNlSW50KF9nbHlwaE5hbWUuc3Vic3RyaW5nKDEpLCAxNik7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIGNhc2UgImciOgogICAgICAgICAgICAgICAgICBpZiAoX2dseXBoTmFtZS5sZW5ndGggPT09IDUpIHsKICAgICAgICAgICAgICAgICAgICBjb2RlID0gcGFyc2VJbnQoX2dseXBoTmFtZS5zdWJzdHJpbmcoMSksIDE2KTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSAiQyI6CiAgICAgICAgICAgICAgICBjYXNlICJjIjoKICAgICAgICAgICAgICAgICAgaWYgKF9nbHlwaE5hbWUubGVuZ3RoID49IDMgJiYgX2dseXBoTmFtZS5sZW5ndGggPD0gNCkgewogICAgICAgICAgICAgICAgICAgIHZhciBjb2RlU3RyID0gX2dseXBoTmFtZS5zdWJzdHJpbmcoMSk7CgogICAgICAgICAgICAgICAgICAgIGlmIChmb3JjZUdseXBocykgewogICAgICAgICAgICAgICAgICAgICAgY29kZSA9IHBhcnNlSW50KGNvZGVTdHIsIDE2KTsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgY29kZSA9ICtjb2RlU3RyOwoKICAgICAgICAgICAgICAgICAgICBpZiAoTnVtYmVyLmlzTmFOKGNvZGUpICYmIE51bWJlci5pc0ludGVnZXIocGFyc2VJbnQoY29kZVN0ciwgMTYpKSkgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2J1aWxkU2ltcGxlRm9udFRvVW5pY29kZShwcm9wZXJ0aWVzLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgIHZhciB1bmljb2RlID0gKDAsIF91bmljb2RlLmdldFVuaWNvZGVGb3JHbHlwaCkoX2dseXBoTmFtZSwgZ2x5cGhzVW5pY29kZU1hcCk7CgogICAgICAgICAgICAgICAgICBpZiAodW5pY29kZSAhPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICBjb2RlID0gdW5pY29kZTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChjb2RlID4gMCAmJiBOdW1iZXIuaXNJbnRlZ2VyKGNvZGUpKSB7CiAgICAgICAgICAgICAgICBpZiAoYmFzZUVuY29kaW5nTmFtZSAmJiBjb2RlID09PSArX2NoYXJjb2RlKSB7CiAgICAgICAgICAgICAgICAgIHZhciBiYXNlRW5jb2RpbmcgPSAoMCwgX2VuY29kaW5ncy5nZXRFbmNvZGluZykoYmFzZUVuY29kaW5nTmFtZSk7CgogICAgICAgICAgICAgICAgICBpZiAoYmFzZUVuY29kaW5nICYmIChfZ2x5cGhOYW1lID0gYmFzZUVuY29kaW5nW19jaGFyY29kZV0pKSB7CiAgICAgICAgICAgICAgICAgICAgdG9Vbmljb2RlW19jaGFyY29kZV0gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGdseXBoc1VuaWNvZGVNYXBbX2dseXBoTmFtZV0pOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdG9Vbmljb2RlW19jaGFyY29kZV0gPSBTdHJpbmcuZnJvbUNvZGVQb2ludChjb2RlKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0b1VuaWNvZGVbX2NoYXJjb2RlXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoZ2x5cGhzVW5pY29kZU1hcFtfZ2x5cGhOYW1lXSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIG5ldyBfZm9udHMuVG9Vbmljb2RlTWFwKHRvVW5pY29kZSk7CiAgICAgICAgfSwKICAgICAgICBidWlsZFRvVW5pY29kZTogZnVuY3Rpb24gYnVpbGRUb1VuaWNvZGUocHJvcGVydGllcykgewogICAgICAgICAgcHJvcGVydGllcy5oYXNJbmNsdWRlZFRvVW5pY29kZU1hcCA9ICEhcHJvcGVydGllcy50b1VuaWNvZGUgJiYgcHJvcGVydGllcy50b1VuaWNvZGUubGVuZ3RoID4gMDsKCiAgICAgICAgICBpZiAocHJvcGVydGllcy5oYXNJbmNsdWRlZFRvVW5pY29kZU1hcCkgewogICAgICAgICAgICBpZiAoIXByb3BlcnRpZXMuY29tcG9zaXRlICYmIHByb3BlcnRpZXMuaGFzRW5jb2RpbmcpIHsKICAgICAgICAgICAgICBwcm9wZXJ0aWVzLmZhbGxiYWNrVG9Vbmljb2RlID0gdGhpcy5fYnVpbGRTaW1wbGVGb250VG9Vbmljb2RlKHByb3BlcnRpZXMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHByb3BlcnRpZXMudG9Vbmljb2RlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIXByb3BlcnRpZXMuY29tcG9zaXRlKSB7CiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodGhpcy5fYnVpbGRTaW1wbGVGb250VG9Vbmljb2RlKHByb3BlcnRpZXMpKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAocHJvcGVydGllcy5jb21wb3NpdGUgJiYgKHByb3BlcnRpZXMuY01hcC5idWlsdEluQ01hcCAmJiAhKHByb3BlcnRpZXMuY01hcCBpbnN0YW5jZW9mIF9jbWFwLklkZW50aXR5Q01hcCkgfHwgcHJvcGVydGllcy5jaWRTeXN0ZW1JbmZvLnJlZ2lzdHJ5ID09PSAiQWRvYmUiICYmIChwcm9wZXJ0aWVzLmNpZFN5c3RlbUluZm8ub3JkZXJpbmcgPT09ICJHQjEiIHx8IHByb3BlcnRpZXMuY2lkU3lzdGVtSW5mby5vcmRlcmluZyA9PT0gIkNOUzEiIHx8IHByb3BlcnRpZXMuY2lkU3lzdGVtSW5mby5vcmRlcmluZyA9PT0gIkphcGFuMSIgfHwgcHJvcGVydGllcy5jaWRTeXN0ZW1JbmZvLm9yZGVyaW5nID09PSAiS29yZWExIikpKSB7CiAgICAgICAgICAgIHZhciByZWdpc3RyeSA9IHByb3BlcnRpZXMuY2lkU3lzdGVtSW5mby5yZWdpc3RyeTsKICAgICAgICAgICAgdmFyIG9yZGVyaW5nID0gcHJvcGVydGllcy5jaWRTeXN0ZW1JbmZvLm9yZGVyaW5nOwoKICAgICAgICAgICAgdmFyIHVjczJDTWFwTmFtZSA9IF9wcmltaXRpdmVzLk5hbWUuZ2V0KHJlZ2lzdHJ5ICsgIi0iICsgb3JkZXJpbmcgKyAiLVVDUzIiKTsKCiAgICAgICAgICAgIHJldHVybiBfY21hcC5DTWFwRmFjdG9yeS5jcmVhdGUoewogICAgICAgICAgICAgIGVuY29kaW5nOiB1Y3MyQ01hcE5hbWUsCiAgICAgICAgICAgICAgZmV0Y2hCdWlsdEluQ01hcDogdGhpcy5mZXRjaEJ1aWx0SW5DTWFwLAogICAgICAgICAgICAgIHVzZUNNYXA6IG51bGwKICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAodWNzMkNNYXApIHsKICAgICAgICAgICAgICB2YXIgY01hcCA9IHByb3BlcnRpZXMuY01hcDsKICAgICAgICAgICAgICB2YXIgdG9Vbmljb2RlID0gW107CiAgICAgICAgICAgICAgY01hcC5mb3JFYWNoKGZ1bmN0aW9uIChjaGFyY29kZSwgY2lkKSB7CiAgICAgICAgICAgICAgICBpZiAoY2lkID4gMHhmZmZmKSB7CiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiTWF4IHNpemUgb2YgQ0lEIGlzIDY1LDUzNSIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHZhciB1Y3MyID0gdWNzMkNNYXAubG9va3VwKGNpZCk7CgogICAgICAgICAgICAgICAgaWYgKHVjczIpIHsKICAgICAgICAgICAgICAgICAgdG9Vbmljb2RlW2NoYXJjb2RlXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoKHVjczIuY2hhckNvZGVBdCgwKSA8PCA4KSArIHVjczIuY2hhckNvZGVBdCgxKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBfZm9udHMuVG9Vbmljb2RlTWFwKHRvVW5pY29kZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobmV3IF9mb250cy5JZGVudGl0eVRvVW5pY29kZU1hcChwcm9wZXJ0aWVzLmZpcnN0Q2hhciwgcHJvcGVydGllcy5sYXN0Q2hhcikpOwogICAgICAgIH0sCiAgICAgICAgcmVhZFRvVW5pY29kZTogZnVuY3Rpb24gUGFydGlhbEV2YWx1YXRvcl9yZWFkVG9Vbmljb2RlKHRvVW5pY29kZSkgewogICAgICAgICAgdmFyIF90aGlzMTMgPSB0aGlzOwoKICAgICAgICAgIHZhciBjbWFwT2JqID0gdG9Vbmljb2RlOwoKICAgICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNOYW1lKShjbWFwT2JqKSkgewogICAgICAgICAgICByZXR1cm4gX2NtYXAuQ01hcEZhY3RvcnkuY3JlYXRlKHsKICAgICAgICAgICAgICBlbmNvZGluZzogY21hcE9iaiwKICAgICAgICAgICAgICBmZXRjaEJ1aWx0SW5DTWFwOiB0aGlzLmZldGNoQnVpbHRJbkNNYXAsCiAgICAgICAgICAgICAgdXNlQ01hcDogbnVsbAogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChjbWFwKSB7CiAgICAgICAgICAgICAgaWYgKGNtYXAgaW5zdGFuY2VvZiBfY21hcC5JZGVudGl0eUNNYXApIHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgX2ZvbnRzLklkZW50aXR5VG9Vbmljb2RlTWFwKDAsIDB4ZmZmZik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gbmV3IF9mb250cy5Ub1VuaWNvZGVNYXAoY21hcC5nZXRNYXAoKSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNTdHJlYW0pKGNtYXBPYmopKSB7CiAgICAgICAgICAgIHJldHVybiBfY21hcC5DTWFwRmFjdG9yeS5jcmVhdGUoewogICAgICAgICAgICAgIGVuY29kaW5nOiBjbWFwT2JqLAogICAgICAgICAgICAgIGZldGNoQnVpbHRJbkNNYXA6IHRoaXMuZmV0Y2hCdWlsdEluQ01hcCwKICAgICAgICAgICAgICB1c2VDTWFwOiBudWxsCiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKGNtYXApIHsKICAgICAgICAgICAgICBpZiAoY21hcCBpbnN0YW5jZW9mIF9jbWFwLklkZW50aXR5Q01hcCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBfZm9udHMuSWRlbnRpdHlUb1VuaWNvZGVNYXAoMCwgMHhmZmZmKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBtYXAgPSBuZXcgQXJyYXkoY21hcC5sZW5ndGgpOwogICAgICAgICAgICAgIGNtYXAuZm9yRWFjaChmdW5jdGlvbiAoY2hhckNvZGUsIHRva2VuKSB7CiAgICAgICAgICAgICAgICB2YXIgc3RyID0gW107CgogICAgICAgICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCB0b2tlbi5sZW5ndGg7IGsgKz0gMikgewogICAgICAgICAgICAgICAgICB2YXIgdzEgPSB0b2tlbi5jaGFyQ29kZUF0KGspIDw8IDggfCB0b2tlbi5jaGFyQ29kZUF0KGsgKyAxKTsKCiAgICAgICAgICAgICAgICAgIGlmICgodzEgJiAweGY4MDApICE9PSAweGQ4MDApIHsKICAgICAgICAgICAgICAgICAgICBzdHIucHVzaCh3MSk7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGsgKz0gMjsKICAgICAgICAgICAgICAgICAgdmFyIHcyID0gdG9rZW4uY2hhckNvZGVBdChrKSA8PCA4IHwgdG9rZW4uY2hhckNvZGVBdChrICsgMSk7CiAgICAgICAgICAgICAgICAgIHN0ci5wdXNoKCgodzEgJiAweDNmZikgPDwgMTApICsgKHcyICYgMHgzZmYpICsgMHgxMDAwMCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbWFwW2NoYXJDb2RlXSA9IFN0cmluZy5mcm9tQ29kZVBvaW50LmFwcGx5KFN0cmluZywgc3RyKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICByZXR1cm4gbmV3IF9mb250cy5Ub1VuaWNvZGVNYXAobWFwKTsKICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgICAgIGlmIChyZWFzb24gaW5zdGFuY2VvZiBfdXRpbC5BYm9ydEV4Y2VwdGlvbikgewogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoX3RoaXMxMy5vcHRpb25zLmlnbm9yZUVycm9ycykgewogICAgICAgICAgICAgICAgX3RoaXMxMy5oYW5kbGVyLnNlbmQoIlVuc3VwcG9ydGVkRmVhdHVyZSIsIHsKICAgICAgICAgICAgICAgICAgZmVhdHVyZUlkOiBfdXRpbC5VTlNVUFBPUlRFRF9GRUFUVVJFUy5mb250CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoInJlYWRUb1VuaWNvZGUgLSBpZ25vcmluZyBUb1VuaWNvZGUgZGF0YTogXCIiLmNvbmNhdChyZWFzb24sICJcIi4iKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHRocm93IHJlYXNvbjsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShudWxsKTsKICAgICAgICB9LAogICAgICAgIHJlYWRDaWRUb0dpZE1hcDogZnVuY3Rpb24gcmVhZENpZFRvR2lkTWFwKGdseXBoc0RhdGEsIHRvVW5pY29kZSkgewogICAgICAgICAgdmFyIHJlc3VsdCA9IFtdOwoKICAgICAgICAgIGZvciAodmFyIGogPSAwLCBqaiA9IGdseXBoc0RhdGEubGVuZ3RoOyBqIDwgamo7IGorKykgewogICAgICAgICAgICB2YXIgZ2x5cGhJRCA9IGdseXBoc0RhdGFbaisrXSA8PCA4IHwgZ2x5cGhzRGF0YVtqXTsKICAgICAgICAgICAgdmFyIGNvZGUgPSBqID4+IDE7CgogICAgICAgICAgICBpZiAoZ2x5cGhJRCA9PT0gMCAmJiAhdG9Vbmljb2RlLmhhcyhjb2RlKSkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXN1bHRbY29kZV0gPSBnbHlwaElEOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfSwKICAgICAgICBleHRyYWN0V2lkdGhzOiBmdW5jdGlvbiBQYXJ0aWFsRXZhbHVhdG9yX2V4dHJhY3RXaWR0aHMoZGljdCwgZGVzY3JpcHRvciwgcHJvcGVydGllcykgewogICAgICAgICAgdmFyIHhyZWYgPSB0aGlzLnhyZWY7CiAgICAgICAgICB2YXIgZ2x5cGhzV2lkdGhzID0gW107CiAgICAgICAgICB2YXIgZGVmYXVsdFdpZHRoID0gMDsKICAgICAgICAgIHZhciBnbHlwaHNWTWV0cmljcyA9IFtdOwogICAgICAgICAgdmFyIGRlZmF1bHRWTWV0cmljczsKICAgICAgICAgIHZhciBpLCBpaSwgaiwgamosIHN0YXJ0LCBjb2RlLCB3aWR0aHM7CgogICAgICAgICAgaWYgKHByb3BlcnRpZXMuY29tcG9zaXRlKSB7CiAgICAgICAgICAgIGRlZmF1bHRXaWR0aCA9IGRpY3QuaGFzKCJEVyIpID8gZGljdC5nZXQoIkRXIikgOiAxMDAwOwogICAgICAgICAgICB3aWR0aHMgPSBkaWN0LmdldCgiVyIpOwoKICAgICAgICAgICAgaWYgKHdpZHRocykgewogICAgICAgICAgICAgIGZvciAoaSA9IDAsIGlpID0gd2lkdGhzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgICAgIHN0YXJ0ID0geHJlZi5mZXRjaElmUmVmKHdpZHRoc1tpKytdKTsKICAgICAgICAgICAgICAgIGNvZGUgPSB4cmVmLmZldGNoSWZSZWYod2lkdGhzW2ldKTsKCiAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShjb2RlKSkgewogICAgICAgICAgICAgICAgICBmb3IgKGogPSAwLCBqaiA9IGNvZGUubGVuZ3RoOyBqIDwgamo7IGorKykgewogICAgICAgICAgICAgICAgICAgIGdseXBoc1dpZHRoc1tzdGFydCsrXSA9IHhyZWYuZmV0Y2hJZlJlZihjb2RlW2pdKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgdmFyIHdpZHRoID0geHJlZi5mZXRjaElmUmVmKHdpZHRoc1srK2ldKTsKCiAgICAgICAgICAgICAgICAgIGZvciAoaiA9IHN0YXJ0OyBqIDw9IGNvZGU7IGorKykgewogICAgICAgICAgICAgICAgICAgIGdseXBoc1dpZHRoc1tqXSA9IHdpZHRoOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocHJvcGVydGllcy52ZXJ0aWNhbCkgewogICAgICAgICAgICAgIHZhciB2bWV0cmljcyA9IGRpY3QuZ2V0QXJyYXkoIkRXMiIpIHx8IFs4ODAsIC0xMDAwXTsKICAgICAgICAgICAgICBkZWZhdWx0Vk1ldHJpY3MgPSBbdm1ldHJpY3NbMV0sIGRlZmF1bHRXaWR0aCAqIDAuNSwgdm1ldHJpY3NbMF1dOwogICAgICAgICAgICAgIHZtZXRyaWNzID0gZGljdC5nZXQoIlcyIik7CgogICAgICAgICAgICAgIGlmICh2bWV0cmljcykgewogICAgICAgICAgICAgICAgZm9yIChpID0gMCwgaWkgPSB2bWV0cmljcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgICAgICAgIHN0YXJ0ID0geHJlZi5mZXRjaElmUmVmKHZtZXRyaWNzW2krK10pOwogICAgICAgICAgICAgICAgICBjb2RlID0geHJlZi5mZXRjaElmUmVmKHZtZXRyaWNzW2ldKTsKCiAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGNvZGUpKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChqID0gMCwgamogPSBjb2RlLmxlbmd0aDsgaiA8IGpqOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICAgIGdseXBoc1ZNZXRyaWNzW3N0YXJ0KytdID0gW3hyZWYuZmV0Y2hJZlJlZihjb2RlW2orK10pLCB4cmVmLmZldGNoSWZSZWYoY29kZVtqKytdKSwgeHJlZi5mZXRjaElmUmVmKGNvZGVbal0pXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHZtZXRyaWMgPSBbeHJlZi5mZXRjaElmUmVmKHZtZXRyaWNzWysraV0pLCB4cmVmLmZldGNoSWZSZWYodm1ldHJpY3NbKytpXSksIHhyZWYuZmV0Y2hJZlJlZih2bWV0cmljc1srK2ldKV07CgogICAgICAgICAgICAgICAgICAgIGZvciAoaiA9IHN0YXJ0OyBqIDw9IGNvZGU7IGorKykgewogICAgICAgICAgICAgICAgICAgICAgZ2x5cGhzVk1ldHJpY3Nbal0gPSB2bWV0cmljOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIGZpcnN0Q2hhciA9IHByb3BlcnRpZXMuZmlyc3RDaGFyOwogICAgICAgICAgICB3aWR0aHMgPSBkaWN0LmdldCgiV2lkdGhzIik7CgogICAgICAgICAgICBpZiAod2lkdGhzKSB7CiAgICAgICAgICAgICAgaiA9IGZpcnN0Q2hhcjsKCiAgICAgICAgICAgICAgZm9yIChpID0gMCwgaWkgPSB3aWR0aHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICAgICAgZ2x5cGhzV2lkdGhzW2orK10gPSB4cmVmLmZldGNoSWZSZWYod2lkdGhzW2ldKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGRlZmF1bHRXaWR0aCA9IHBhcnNlRmxvYXQoZGVzY3JpcHRvci5nZXQoIk1pc3NpbmdXaWR0aCIpKSB8fCAwOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHZhciBiYXNlRm9udE5hbWUgPSBkaWN0LmdldCgiQmFzZUZvbnQiKTsKCiAgICAgICAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc05hbWUpKGJhc2VGb250TmFtZSkpIHsKICAgICAgICAgICAgICAgIHZhciBtZXRyaWNzID0gdGhpcy5nZXRCYXNlRm9udE1ldHJpY3MoYmFzZUZvbnROYW1lLm5hbWUpOwogICAgICAgICAgICAgICAgZ2x5cGhzV2lkdGhzID0gdGhpcy5idWlsZENoYXJDb2RlVG9XaWR0aChtZXRyaWNzLndpZHRocywgcHJvcGVydGllcyk7CiAgICAgICAgICAgICAgICBkZWZhdWx0V2lkdGggPSBtZXRyaWNzLmRlZmF1bHRXaWR0aDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgaXNNb25vc3BhY2UgPSB0cnVlOwogICAgICAgICAgdmFyIGZpcnN0V2lkdGggPSBkZWZhdWx0V2lkdGg7CgogICAgICAgICAgZm9yICh2YXIgZ2x5cGggaW4gZ2x5cGhzV2lkdGhzKSB7CiAgICAgICAgICAgIHZhciBnbHlwaFdpZHRoID0gZ2x5cGhzV2lkdGhzW2dseXBoXTsKCiAgICAgICAgICAgIGlmICghZ2x5cGhXaWR0aCkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIWZpcnN0V2lkdGgpIHsKICAgICAgICAgICAgICBmaXJzdFdpZHRoID0gZ2x5cGhXaWR0aDsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGZpcnN0V2lkdGggIT09IGdseXBoV2lkdGgpIHsKICAgICAgICAgICAgICBpc01vbm9zcGFjZSA9IGZhbHNlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGlzTW9ub3NwYWNlKSB7CiAgICAgICAgICAgIHByb3BlcnRpZXMuZmxhZ3MgfD0gX2ZvbnRzLkZvbnRGbGFncy5GaXhlZFBpdGNoOwogICAgICAgICAgfQoKICAgICAgICAgIHByb3BlcnRpZXMuZGVmYXVsdFdpZHRoID0gZGVmYXVsdFdpZHRoOwogICAgICAgICAgcHJvcGVydGllcy53aWR0aHMgPSBnbHlwaHNXaWR0aHM7CiAgICAgICAgICBwcm9wZXJ0aWVzLmRlZmF1bHRWTWV0cmljcyA9IGRlZmF1bHRWTWV0cmljczsKICAgICAgICAgIHByb3BlcnRpZXMudm1ldHJpY3MgPSBnbHlwaHNWTWV0cmljczsKICAgICAgICB9LAogICAgICAgIGlzU2VyaWZGb250OiBmdW5jdGlvbiBQYXJ0aWFsRXZhbHVhdG9yX2lzU2VyaWZGb250KGJhc2VGb250TmFtZSkgewogICAgICAgICAgdmFyIGZvbnROYW1lV29TdHlsZSA9IGJhc2VGb250TmFtZS5zcGxpdCgiLSIpWzBdOwogICAgICAgICAgcmV0dXJuIGZvbnROYW1lV29TdHlsZSBpbiAoMCwgX3N0YW5kYXJkX2ZvbnRzLmdldFNlcmlmRm9udHMpKCkgfHwgZm9udE5hbWVXb1N0eWxlLnNlYXJjaCgvc2VyaWYvZ2kpICE9PSAtMTsKICAgICAgICB9LAogICAgICAgIGdldEJhc2VGb250TWV0cmljczogZnVuY3Rpb24gUGFydGlhbEV2YWx1YXRvcl9nZXRCYXNlRm9udE1ldHJpY3MobmFtZSkgewogICAgICAgICAgdmFyIGRlZmF1bHRXaWR0aCA9IDA7CiAgICAgICAgICB2YXIgd2lkdGhzID0gW107CiAgICAgICAgICB2YXIgbW9ub3NwYWNlID0gZmFsc2U7CiAgICAgICAgICB2YXIgc3RkRm9udE1hcCA9ICgwLCBfc3RhbmRhcmRfZm9udHMuZ2V0U3RkRm9udE1hcCkoKTsKICAgICAgICAgIHZhciBsb29rdXBOYW1lID0gc3RkRm9udE1hcFtuYW1lXSB8fCBuYW1lOwogICAgICAgICAgdmFyIE1ldHJpY3MgPSAoMCwgX21ldHJpY3MuZ2V0TWV0cmljcykoKTsKCiAgICAgICAgICBpZiAoIShsb29rdXBOYW1lIGluIE1ldHJpY3MpKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmlzU2VyaWZGb250KG5hbWUpKSB7CiAgICAgICAgICAgICAgbG9va3VwTmFtZSA9ICJUaW1lcy1Sb21hbiI7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbG9va3VwTmFtZSA9ICJIZWx2ZXRpY2EiOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGdseXBoV2lkdGhzID0gTWV0cmljc1tsb29rdXBOYW1lXTsKCiAgICAgICAgICBpZiAoKDAsIF91dGlsLmlzTnVtKShnbHlwaFdpZHRocykpIHsKICAgICAgICAgICAgZGVmYXVsdFdpZHRoID0gZ2x5cGhXaWR0aHM7CiAgICAgICAgICAgIG1vbm9zcGFjZSA9IHRydWU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB3aWR0aHMgPSBnbHlwaFdpZHRocygpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGRlZmF1bHRXaWR0aDogZGVmYXVsdFdpZHRoLAogICAgICAgICAgICBtb25vc3BhY2U6IG1vbm9zcGFjZSwKICAgICAgICAgICAgd2lkdGhzOiB3aWR0aHMKICAgICAgICAgIH07CiAgICAgICAgfSwKICAgICAgICBidWlsZENoYXJDb2RlVG9XaWR0aDogZnVuY3Rpb24gUGFydGlhbEV2YWx1YXRvcl9idWxpbGRDaGFyQ29kZVRvV2lkdGgod2lkdGhzQnlHbHlwaE5hbWUsIHByb3BlcnRpZXMpIHsKICAgICAgICAgIHZhciB3aWR0aHMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgICAgdmFyIGRpZmZlcmVuY2VzID0gcHJvcGVydGllcy5kaWZmZXJlbmNlczsKICAgICAgICAgIHZhciBlbmNvZGluZyA9IHByb3BlcnRpZXMuZGVmYXVsdEVuY29kaW5nOwoKICAgICAgICAgIGZvciAodmFyIGNoYXJDb2RlID0gMDsgY2hhckNvZGUgPCAyNTY7IGNoYXJDb2RlKyspIHsKICAgICAgICAgICAgaWYgKGNoYXJDb2RlIGluIGRpZmZlcmVuY2VzICYmIHdpZHRoc0J5R2x5cGhOYW1lW2RpZmZlcmVuY2VzW2NoYXJDb2RlXV0pIHsKICAgICAgICAgICAgICB3aWR0aHNbY2hhckNvZGVdID0gd2lkdGhzQnlHbHlwaE5hbWVbZGlmZmVyZW5jZXNbY2hhckNvZGVdXTsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGNoYXJDb2RlIGluIGVuY29kaW5nICYmIHdpZHRoc0J5R2x5cGhOYW1lW2VuY29kaW5nW2NoYXJDb2RlXV0pIHsKICAgICAgICAgICAgICB3aWR0aHNbY2hhckNvZGVdID0gd2lkdGhzQnlHbHlwaE5hbWVbZW5jb2RpbmdbY2hhckNvZGVdXTsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB3aWR0aHM7CiAgICAgICAgfSwKICAgICAgICBwcmVFdmFsdWF0ZUZvbnQ6IGZ1bmN0aW9uIFBhcnRpYWxFdmFsdWF0b3JfcHJlRXZhbHVhdGVGb250KGRpY3QpIHsKICAgICAgICAgIHZhciBiYXNlRGljdCA9IGRpY3Q7CiAgICAgICAgICB2YXIgdHlwZSA9IGRpY3QuZ2V0KCJTdWJ0eXBlIik7CgogICAgICAgICAgaWYgKCEoMCwgX3ByaW1pdGl2ZXMuaXNOYW1lKSh0eXBlKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoImludmFsaWQgZm9udCBTdWJ0eXBlIik7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGNvbXBvc2l0ZSA9IGZhbHNlOwogICAgICAgICAgdmFyIHVpbnQ4YXJyYXk7CgogICAgICAgICAgaWYgKHR5cGUubmFtZSA9PT0gIlR5cGUwIikgewogICAgICAgICAgICB2YXIgZGYgPSBkaWN0LmdldCgiRGVzY2VuZGFudEZvbnRzIik7CgogICAgICAgICAgICBpZiAoIWRmKSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJEZXNjZW5kYW50IGZvbnRzIGFyZSBub3Qgc3BlY2lmaWVkIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGRpY3QgPSBBcnJheS5pc0FycmF5KGRmKSA/IHRoaXMueHJlZi5mZXRjaElmUmVmKGRmWzBdKSA6IGRmOwogICAgICAgICAgICB0eXBlID0gZGljdC5nZXQoIlN1YnR5cGUiKTsKCiAgICAgICAgICAgIGlmICghKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkodHlwZSkpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoImludmFsaWQgZm9udCBTdWJ0eXBlIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbXBvc2l0ZSA9IHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGRlc2NyaXB0b3IgPSBkaWN0LmdldCgiRm9udERlc2NyaXB0b3IiKTsKCiAgICAgICAgICBpZiAoZGVzY3JpcHRvcikgewogICAgICAgICAgICB2YXIgaGFzaCA9IG5ldyBfbXVybXVyaGFzaC5NdXJtdXJIYXNoM182NCgpOwogICAgICAgICAgICB2YXIgZW5jb2RpbmcgPSBiYXNlRGljdC5nZXRSYXcoIkVuY29kaW5nIik7CgogICAgICAgICAgICBpZiAoKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkoZW5jb2RpbmcpKSB7CiAgICAgICAgICAgICAgaGFzaC51cGRhdGUoZW5jb2RpbmcubmFtZSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoKDAsIF9wcmltaXRpdmVzLmlzUmVmKShlbmNvZGluZykpIHsKICAgICAgICAgICAgICBoYXNoLnVwZGF0ZShlbmNvZGluZy50b1N0cmluZygpKTsKICAgICAgICAgICAgfSBlbHNlIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNEaWN0KShlbmNvZGluZykpIHsKICAgICAgICAgICAgICB2YXIga2V5cyA9IGVuY29kaW5nLmdldEtleXMoKTsKCiAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0ga2V5cy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgICAgICB2YXIgZW50cnkgPSBlbmNvZGluZy5nZXRSYXcoa2V5c1tpXSk7CgogICAgICAgICAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc05hbWUpKGVudHJ5KSkgewogICAgICAgICAgICAgICAgICBoYXNoLnVwZGF0ZShlbnRyeS5uYW1lKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoKDAsIF9wcmltaXRpdmVzLmlzUmVmKShlbnRyeSkpIHsKICAgICAgICAgICAgICAgICAgaGFzaC51cGRhdGUoZW50cnkudG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoZW50cnkpKSB7CiAgICAgICAgICAgICAgICAgIHZhciBkaWZmTGVuZ3RoID0gZW50cnkubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgIGRpZmZCdWYgPSBuZXcgQXJyYXkoZGlmZkxlbmd0aCk7CgogICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGRpZmZMZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgICAgIHZhciBkaWZmRW50cnkgPSBlbnRyeVtqXTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc05hbWUpKGRpZmZFbnRyeSkpIHsKICAgICAgICAgICAgICAgICAgICAgIGRpZmZCdWZbal0gPSBkaWZmRW50cnkubmFtZTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCgwLCBfdXRpbC5pc051bSkoZGlmZkVudHJ5KSB8fCAoMCwgX3ByaW1pdGl2ZXMuaXNSZWYpKGRpZmZFbnRyeSkpIHsKICAgICAgICAgICAgICAgICAgICAgIGRpZmZCdWZbal0gPSBkaWZmRW50cnkudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGhhc2gudXBkYXRlKGRpZmZCdWYuam9pbigpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBmaXJzdENoYXIgPSBkaWN0LmdldCgiRmlyc3RDaGFyIikgfHwgMDsKICAgICAgICAgICAgdmFyIGxhc3RDaGFyID0gZGljdC5nZXQoIkxhc3RDaGFyIikgfHwgKGNvbXBvc2l0ZSA/IDB4ZmZmZiA6IDB4ZmYpOwogICAgICAgICAgICBoYXNoLnVwZGF0ZSgiIi5jb25jYXQoZmlyc3RDaGFyLCAiLSIpLmNvbmNhdChsYXN0Q2hhcikpOwogICAgICAgICAgICB2YXIgdG9Vbmljb2RlID0gZGljdC5nZXQoIlRvVW5pY29kZSIpIHx8IGJhc2VEaWN0LmdldCgiVG9Vbmljb2RlIik7CgogICAgICAgICAgICBpZiAoKDAsIF9wcmltaXRpdmVzLmlzU3RyZWFtKSh0b1VuaWNvZGUpKSB7CiAgICAgICAgICAgICAgdmFyIHN0cmVhbSA9IHRvVW5pY29kZS5zdHIgfHwgdG9Vbmljb2RlOwogICAgICAgICAgICAgIHVpbnQ4YXJyYXkgPSBzdHJlYW0uYnVmZmVyID8gbmV3IFVpbnQ4QXJyYXkoc3RyZWFtLmJ1ZmZlci5idWZmZXIsIDAsIHN0cmVhbS5idWZmZXJMZW5ndGgpIDogbmV3IFVpbnQ4QXJyYXkoc3RyZWFtLmJ5dGVzLmJ1ZmZlciwgc3RyZWFtLnN0YXJ0LCBzdHJlYW0uZW5kIC0gc3RyZWFtLnN0YXJ0KTsKICAgICAgICAgICAgICBoYXNoLnVwZGF0ZSh1aW50OGFycmF5KTsKICAgICAgICAgICAgfSBlbHNlIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNOYW1lKSh0b1VuaWNvZGUpKSB7CiAgICAgICAgICAgICAgaGFzaC51cGRhdGUodG9Vbmljb2RlLm5hbWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgd2lkdGhzID0gZGljdC5nZXQoIldpZHRocyIpIHx8IGJhc2VEaWN0LmdldCgiV2lkdGhzIik7CgogICAgICAgICAgICBpZiAod2lkdGhzKSB7CiAgICAgICAgICAgICAgdWludDhhcnJheSA9IG5ldyBVaW50OEFycmF5KG5ldyBVaW50MzJBcnJheSh3aWR0aHMpLmJ1ZmZlcik7CiAgICAgICAgICAgICAgaGFzaC51cGRhdGUodWludDhhcnJheSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBkZXNjcmlwdG9yOiBkZXNjcmlwdG9yLAogICAgICAgICAgICBkaWN0OiBkaWN0LAogICAgICAgICAgICBiYXNlRGljdDogYmFzZURpY3QsCiAgICAgICAgICAgIGNvbXBvc2l0ZTogY29tcG9zaXRlLAogICAgICAgICAgICB0eXBlOiB0eXBlLm5hbWUsCiAgICAgICAgICAgIGhhc2g6IGhhc2ggPyBoYXNoLmhleGRpZ2VzdCgpIDogIiIKICAgICAgICAgIH07CiAgICAgICAgfSwKICAgICAgICB0cmFuc2xhdGVGb250OiBmdW5jdGlvbiBQYXJ0aWFsRXZhbHVhdG9yX3RyYW5zbGF0ZUZvbnQocHJlRXZhbHVhdGVkRm9udCkgewogICAgICAgICAgdmFyIF90aGlzMTQgPSB0aGlzOwoKICAgICAgICAgIHZhciBiYXNlRGljdCA9IHByZUV2YWx1YXRlZEZvbnQuYmFzZURpY3Q7CiAgICAgICAgICB2YXIgZGljdCA9IHByZUV2YWx1YXRlZEZvbnQuZGljdDsKICAgICAgICAgIHZhciBjb21wb3NpdGUgPSBwcmVFdmFsdWF0ZWRGb250LmNvbXBvc2l0ZTsKICAgICAgICAgIHZhciBkZXNjcmlwdG9yID0gcHJlRXZhbHVhdGVkRm9udC5kZXNjcmlwdG9yOwogICAgICAgICAgdmFyIHR5cGUgPSBwcmVFdmFsdWF0ZWRGb250LnR5cGU7CiAgICAgICAgICB2YXIgbWF4Q2hhckluZGV4ID0gY29tcG9zaXRlID8gMHhmZmZmIDogMHhmZjsKICAgICAgICAgIHZhciBwcm9wZXJ0aWVzOwogICAgICAgICAgdmFyIGZpcnN0Q2hhciA9IGRpY3QuZ2V0KCJGaXJzdENoYXIiKSB8fCAwOwogICAgICAgICAgdmFyIGxhc3RDaGFyID0gZGljdC5nZXQoIkxhc3RDaGFyIikgfHwgbWF4Q2hhckluZGV4OwoKICAgICAgICAgIGlmICghZGVzY3JpcHRvcikgewogICAgICAgICAgICBpZiAodHlwZSA9PT0gIlR5cGUzIikgewogICAgICAgICAgICAgIGRlc2NyaXB0b3IgPSBuZXcgX3ByaW1pdGl2ZXMuRGljdChudWxsKTsKICAgICAgICAgICAgICBkZXNjcmlwdG9yLnNldCgiRm9udE5hbWUiLCBfcHJpbWl0aXZlcy5OYW1lLmdldCh0eXBlKSk7CiAgICAgICAgICAgICAgZGVzY3JpcHRvci5zZXQoIkZvbnRCQm94IiwgZGljdC5nZXRBcnJheSgiRm9udEJCb3giKSB8fCBbMCwgMCwgMCwgMF0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHZhciBiYXNlRm9udE5hbWUgPSBkaWN0LmdldCgiQmFzZUZvbnQiKTsKCiAgICAgICAgICAgICAgaWYgKCEoMCwgX3ByaW1pdGl2ZXMuaXNOYW1lKShiYXNlRm9udE5hbWUpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkJhc2UgZm9udCBpcyBub3Qgc3BlY2lmaWVkIik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBiYXNlRm9udE5hbWUgPSBiYXNlRm9udE5hbWUubmFtZS5yZXBsYWNlKC9bLF9dL2csICItIik7CiAgICAgICAgICAgICAgdmFyIG1ldHJpY3MgPSB0aGlzLmdldEJhc2VGb250TWV0cmljcyhiYXNlRm9udE5hbWUpOwogICAgICAgICAgICAgIHZhciBmb250TmFtZVdvU3R5bGUgPSBiYXNlRm9udE5hbWUuc3BsaXQoIi0iKVswXTsKICAgICAgICAgICAgICB2YXIgZmxhZ3MgPSAodGhpcy5pc1NlcmlmRm9udChmb250TmFtZVdvU3R5bGUpID8gX2ZvbnRzLkZvbnRGbGFncy5TZXJpZiA6IDApIHwgKG1ldHJpY3MubW9ub3NwYWNlID8gX2ZvbnRzLkZvbnRGbGFncy5GaXhlZFBpdGNoIDogMCkgfCAoKDAsIF9zdGFuZGFyZF9mb250cy5nZXRTeW1ib2xzRm9udHMpKClbZm9udE5hbWVXb1N0eWxlXSA/IF9mb250cy5Gb250RmxhZ3MuU3ltYm9saWMgOiBfZm9udHMuRm9udEZsYWdzLk5vbnN5bWJvbGljKTsKICAgICAgICAgICAgICBwcm9wZXJ0aWVzID0gewogICAgICAgICAgICAgICAgdHlwZTogdHlwZSwKICAgICAgICAgICAgICAgIG5hbWU6IGJhc2VGb250TmFtZSwKICAgICAgICAgICAgICAgIHdpZHRoczogbWV0cmljcy53aWR0aHMsCiAgICAgICAgICAgICAgICBkZWZhdWx0V2lkdGg6IG1ldHJpY3MuZGVmYXVsdFdpZHRoLAogICAgICAgICAgICAgICAgZmxhZ3M6IGZsYWdzLAogICAgICAgICAgICAgICAgZmlyc3RDaGFyOiBmaXJzdENoYXIsCiAgICAgICAgICAgICAgICBsYXN0Q2hhcjogbGFzdENoYXIKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIHZhciB3aWR0aHMgPSBkaWN0LmdldCgiV2lkdGhzIik7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXh0cmFjdERhdGFTdHJ1Y3R1cmVzKGRpY3QsIGRpY3QsIHByb3BlcnRpZXMpLnRoZW4oZnVuY3Rpb24gKHByb3BlcnRpZXMpIHsKICAgICAgICAgICAgICAgIGlmICh3aWR0aHMpIHsKICAgICAgICAgICAgICAgICAgdmFyIGdseXBoV2lkdGhzID0gW107CiAgICAgICAgICAgICAgICAgIHZhciBqID0gZmlyc3RDaGFyOwoKICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gd2lkdGhzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBnbHlwaFdpZHRoc1tqKytdID0gX3RoaXMxNC54cmVmLmZldGNoSWZSZWYod2lkdGhzW2ldKTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgcHJvcGVydGllcy53aWR0aHMgPSBnbHlwaFdpZHRoczsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXMud2lkdGhzID0gX3RoaXMxNC5idWlsZENoYXJDb2RlVG9XaWR0aChtZXRyaWNzLndpZHRocywgcHJvcGVydGllcyk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBfZm9udHMuRm9udChiYXNlRm9udE5hbWUsIG51bGwsIHByb3BlcnRpZXMpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGZvbnROYW1lID0gZGVzY3JpcHRvci5nZXQoIkZvbnROYW1lIik7CiAgICAgICAgICB2YXIgYmFzZUZvbnQgPSBkaWN0LmdldCgiQmFzZUZvbnQiKTsKCiAgICAgICAgICBpZiAoKDAsIF91dGlsLmlzU3RyaW5nKShmb250TmFtZSkpIHsKICAgICAgICAgICAgZm9udE5hbWUgPSBfcHJpbWl0aXZlcy5OYW1lLmdldChmb250TmFtZSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCgwLCBfdXRpbC5pc1N0cmluZykoYmFzZUZvbnQpKSB7CiAgICAgICAgICAgIGJhc2VGb250ID0gX3ByaW1pdGl2ZXMuTmFtZS5nZXQoYmFzZUZvbnQpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0eXBlICE9PSAiVHlwZTMiKSB7CiAgICAgICAgICAgIHZhciBmb250TmFtZVN0ciA9IGZvbnROYW1lICYmIGZvbnROYW1lLm5hbWU7CiAgICAgICAgICAgIHZhciBiYXNlRm9udFN0ciA9IGJhc2VGb250ICYmIGJhc2VGb250Lm5hbWU7CgogICAgICAgICAgICBpZiAoZm9udE5hbWVTdHIgIT09IGJhc2VGb250U3RyKSB7CiAgICAgICAgICAgICAgKDAsIF91dGlsLmluZm8pKCJUaGUgRm9udERlc2NyaXB0b3IncyBGb250TmFtZSBpcyBcIiIuY29uY2F0KGZvbnROYW1lU3RyLCAiXCIgYnV0ICIpICsgInNob3VsZCBiZSB0aGUgc2FtZSBhcyB0aGUgRm9udCdzIEJhc2VGb250IFwiIi5jb25jYXQoYmFzZUZvbnRTdHIsICJcIi4iKSk7CgogICAgICAgICAgICAgIGlmIChmb250TmFtZVN0ciAmJiBiYXNlRm9udFN0ciAmJiBiYXNlRm9udFN0ci5zdGFydHNXaXRoKGZvbnROYW1lU3RyKSkgewogICAgICAgICAgICAgICAgZm9udE5hbWUgPSBiYXNlRm9udDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBmb250TmFtZSA9IGZvbnROYW1lIHx8IGJhc2VGb250OwoKICAgICAgICAgIGlmICghKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkoZm9udE5hbWUpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiaW52YWxpZCBmb250IG5hbWUiKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZm9udEZpbGUgPSBkZXNjcmlwdG9yLmdldCgiRm9udEZpbGUiLCAiRm9udEZpbGUyIiwgIkZvbnRGaWxlMyIpOwoKICAgICAgICAgIGlmIChmb250RmlsZSkgewogICAgICAgICAgICBpZiAoZm9udEZpbGUuZGljdCkgewogICAgICAgICAgICAgIHZhciBzdWJ0eXBlID0gZm9udEZpbGUuZGljdC5nZXQoIlN1YnR5cGUiKTsKCiAgICAgICAgICAgICAgaWYgKHN1YnR5cGUpIHsKICAgICAgICAgICAgICAgIHN1YnR5cGUgPSBzdWJ0eXBlLm5hbWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgbGVuZ3RoMSA9IGZvbnRGaWxlLmRpY3QuZ2V0KCJMZW5ndGgxIik7CiAgICAgICAgICAgICAgdmFyIGxlbmd0aDIgPSBmb250RmlsZS5kaWN0LmdldCgiTGVuZ3RoMiIpOwogICAgICAgICAgICAgIHZhciBsZW5ndGgzID0gZm9udEZpbGUuZGljdC5nZXQoIkxlbmd0aDMiKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHByb3BlcnRpZXMgPSB7CiAgICAgICAgICAgIHR5cGU6IHR5cGUsCiAgICAgICAgICAgIG5hbWU6IGZvbnROYW1lLm5hbWUsCiAgICAgICAgICAgIHN1YnR5cGU6IHN1YnR5cGUsCiAgICAgICAgICAgIGZpbGU6IGZvbnRGaWxlLAogICAgICAgICAgICBsZW5ndGgxOiBsZW5ndGgxLAogICAgICAgICAgICBsZW5ndGgyOiBsZW5ndGgyLAogICAgICAgICAgICBsZW5ndGgzOiBsZW5ndGgzLAogICAgICAgICAgICBsb2FkZWROYW1lOiBiYXNlRGljdC5sb2FkZWROYW1lLAogICAgICAgICAgICBjb21wb3NpdGU6IGNvbXBvc2l0ZSwKICAgICAgICAgICAgd2lkZUNoYXJzOiBjb21wb3NpdGUsCiAgICAgICAgICAgIGZpeGVkUGl0Y2g6IGZhbHNlLAogICAgICAgICAgICBmb250TWF0cml4OiBkaWN0LmdldEFycmF5KCJGb250TWF0cml4IikgfHwgX3V0aWwuRk9OVF9JREVOVElUWV9NQVRSSVgsCiAgICAgICAgICAgIGZpcnN0Q2hhcjogZmlyc3RDaGFyIHx8IDAsCiAgICAgICAgICAgIGxhc3RDaGFyOiBsYXN0Q2hhciB8fCBtYXhDaGFySW5kZXgsCiAgICAgICAgICAgIGJib3g6IGRlc2NyaXB0b3IuZ2V0QXJyYXkoIkZvbnRCQm94IiksCiAgICAgICAgICAgIGFzY2VudDogZGVzY3JpcHRvci5nZXQoIkFzY2VudCIpLAogICAgICAgICAgICBkZXNjZW50OiBkZXNjcmlwdG9yLmdldCgiRGVzY2VudCIpLAogICAgICAgICAgICB4SGVpZ2h0OiBkZXNjcmlwdG9yLmdldCgiWEhlaWdodCIpLAogICAgICAgICAgICBjYXBIZWlnaHQ6IGRlc2NyaXB0b3IuZ2V0KCJDYXBIZWlnaHQiKSwKICAgICAgICAgICAgZmxhZ3M6IGRlc2NyaXB0b3IuZ2V0KCJGbGFncyIpLAogICAgICAgICAgICBpdGFsaWNBbmdsZTogZGVzY3JpcHRvci5nZXQoIkl0YWxpY0FuZ2xlIiksCiAgICAgICAgICAgIGlzVHlwZTNGb250OiBmYWxzZQogICAgICAgICAgfTsKICAgICAgICAgIHZhciBjTWFwUHJvbWlzZTsKCiAgICAgICAgICBpZiAoY29tcG9zaXRlKSB7CiAgICAgICAgICAgIHZhciBjaWRFbmNvZGluZyA9IGJhc2VEaWN0LmdldCgiRW5jb2RpbmciKTsKCiAgICAgICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNOYW1lKShjaWRFbmNvZGluZykpIHsKICAgICAgICAgICAgICBwcm9wZXJ0aWVzLmNpZEVuY29kaW5nID0gY2lkRW5jb2RpbmcubmFtZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY01hcFByb21pc2UgPSBfY21hcC5DTWFwRmFjdG9yeS5jcmVhdGUoewogICAgICAgICAgICAgIGVuY29kaW5nOiBjaWRFbmNvZGluZywKICAgICAgICAgICAgICBmZXRjaEJ1aWx0SW5DTWFwOiB0aGlzLmZldGNoQnVpbHRJbkNNYXAsCiAgICAgICAgICAgICAgdXNlQ01hcDogbnVsbAogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChjTWFwKSB7CiAgICAgICAgICAgICAgcHJvcGVydGllcy5jTWFwID0gY01hcDsKICAgICAgICAgICAgICBwcm9wZXJ0aWVzLnZlcnRpY2FsID0gcHJvcGVydGllcy5jTWFwLnZlcnRpY2FsOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNNYXBQcm9taXNlID0gUHJvbWlzZS5yZXNvbHZlKHVuZGVmaW5lZCk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGNNYXBQcm9taXNlLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gX3RoaXMxNC5leHRyYWN0RGF0YVN0cnVjdHVyZXMoZGljdCwgYmFzZURpY3QsIHByb3BlcnRpZXMpOwogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocHJvcGVydGllcykgewogICAgICAgICAgICBfdGhpczE0LmV4dHJhY3RXaWR0aHMoZGljdCwgZGVzY3JpcHRvciwgcHJvcGVydGllcyk7CgogICAgICAgICAgICBpZiAodHlwZSA9PT0gIlR5cGUzIikgewogICAgICAgICAgICAgIHByb3BlcnRpZXMuaXNUeXBlM0ZvbnQgPSB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gbmV3IF9mb250cy5Gb250KGZvbnROYW1lLm5hbWUsIGZvbnRGaWxlLCBwcm9wZXJ0aWVzKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIFBhcnRpYWxFdmFsdWF0b3IuYnVpbGRGb250UGF0aHMgPSBmdW5jdGlvbiAoZm9udCwgZ2x5cGhzLCBoYW5kbGVyKSB7CiAgICAgICAgZnVuY3Rpb24gYnVpbGRQYXRoKGZvbnRDaGFyKSB7CiAgICAgICAgICBpZiAoZm9udC5yZW5kZXJlci5oYXNCdWlsdFBhdGgoZm9udENoYXIpKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBoYW5kbGVyLnNlbmQoImNvbW1vbm9iaiIsIFsiIi5jb25jYXQoZm9udC5sb2FkZWROYW1lLCAiX3BhdGhfIikuY29uY2F0KGZvbnRDaGFyKSwgIkZvbnRQYXRoIiwgZm9udC5yZW5kZXJlci5nZXRQYXRoSnMoZm9udENoYXIpXSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IHRydWU7CiAgICAgICAgdmFyIF9kaWRJdGVyYXRvckVycm9yID0gZmFsc2U7CiAgICAgICAgdmFyIF9pdGVyYXRvckVycm9yID0gdW5kZWZpbmVkOwoKICAgICAgICB0cnkgewogICAgICAgICAgZm9yICh2YXIgX2l0ZXJhdG9yID0gZ2x5cGhzW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3N0ZXA7ICEoX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IChfc3RlcCA9IF9pdGVyYXRvci5uZXh0KCkpLmRvbmUpOyBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gdHJ1ZSkgewogICAgICAgICAgICB2YXIgZ2x5cGggPSBfc3RlcC52YWx1ZTsKICAgICAgICAgICAgYnVpbGRQYXRoKGdseXBoLmZvbnRDaGFyKTsKICAgICAgICAgICAgdmFyIGFjY2VudCA9IGdseXBoLmFjY2VudDsKCiAgICAgICAgICAgIGlmIChhY2NlbnQgJiYgYWNjZW50LmZvbnRDaGFyKSB7CiAgICAgICAgICAgICAgYnVpbGRQYXRoKGFjY2VudC5mb250Q2hhcik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgIF9kaWRJdGVyYXRvckVycm9yID0gdHJ1ZTsKICAgICAgICAgIF9pdGVyYXRvckVycm9yID0gZXJyOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gJiYgX2l0ZXJhdG9yWyJyZXR1cm4iXSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yWyJyZXR1cm4iXSgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAoX2RpZEl0ZXJhdG9yRXJyb3IpIHsKICAgICAgICAgICAgICB0aHJvdyBfaXRlcmF0b3JFcnJvcjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTsKCiAgICAgIFBhcnRpYWxFdmFsdWF0b3IuZ2V0RmFsbGJhY2tGb250RGljdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAodGhpcy5fZmFsbGJhY2tGb250RGljdCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX2ZhbGxiYWNrRm9udERpY3Q7CiAgICAgICAgfQoKICAgICAgICB2YXIgZGljdCA9IG5ldyBfcHJpbWl0aXZlcy5EaWN0KCk7CiAgICAgICAgZGljdC5zZXQoIkJhc2VGb250IiwgX3ByaW1pdGl2ZXMuTmFtZS5nZXQoIlBERkpTLUZhbGxiYWNrRm9udCIpKTsKICAgICAgICBkaWN0LnNldCgiVHlwZSIsIF9wcmltaXRpdmVzLk5hbWUuZ2V0KCJGYWxsYmFja1R5cGUiKSk7CiAgICAgICAgZGljdC5zZXQoIlN1YnR5cGUiLCBfcHJpbWl0aXZlcy5OYW1lLmdldCgiRmFsbGJhY2tUeXBlIikpOwogICAgICAgIGRpY3Quc2V0KCJFbmNvZGluZyIsIF9wcmltaXRpdmVzLk5hbWUuZ2V0KCJXaW5BbnNpRW5jb2RpbmciKSk7CiAgICAgICAgcmV0dXJuIHRoaXMuX2ZhbGxiYWNrRm9udERpY3QgPSBkaWN0OwogICAgICB9OwoKICAgICAgcmV0dXJuIFBhcnRpYWxFdmFsdWF0b3I7CiAgICB9KCk7CgogICAgZXhwb3J0cy5QYXJ0aWFsRXZhbHVhdG9yID0gUGFydGlhbEV2YWx1YXRvcjsKCiAgICB2YXIgVHJhbnNsYXRlZEZvbnQgPSBmdW5jdGlvbiBUcmFuc2xhdGVkRm9udENsb3N1cmUoKSB7CiAgICAgIGZ1bmN0aW9uIFRyYW5zbGF0ZWRGb250KGxvYWRlZE5hbWUsIGZvbnQsIGRpY3QpIHsKICAgICAgICB0aGlzLmxvYWRlZE5hbWUgPSBsb2FkZWROYW1lOwogICAgICAgIHRoaXMuZm9udCA9IGZvbnQ7CiAgICAgICAgdGhpcy5kaWN0ID0gZGljdDsKICAgICAgICB0aGlzLnR5cGUzTG9hZGVkID0gbnVsbDsKICAgICAgICB0aGlzLnNlbnQgPSBmYWxzZTsKICAgICAgfQoKICAgICAgVHJhbnNsYXRlZEZvbnQucHJvdG90eXBlID0gewogICAgICAgIHNlbmQ6IGZ1bmN0aW9uIHNlbmQoaGFuZGxlcikgewogICAgICAgICAgaWYgKHRoaXMuc2VudCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5zZW50ID0gdHJ1ZTsKICAgICAgICAgIGhhbmRsZXIuc2VuZCgiY29tbW9ub2JqIiwgW3RoaXMubG9hZGVkTmFtZSwgIkZvbnQiLCB0aGlzLmZvbnQuZXhwb3J0RGF0YSgpXSk7CiAgICAgICAgfSwKICAgICAgICBmYWxsYmFjazogZnVuY3Rpb24gZmFsbGJhY2soaGFuZGxlcikgewogICAgICAgICAgaWYgKCF0aGlzLmZvbnQuZGF0YSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5mb250LmRpc2FibGVGb250RmFjZSA9IHRydWU7CiAgICAgICAgICB2YXIgZ2x5cGhzID0gdGhpcy5mb250LmdseXBoQ2FjaGVWYWx1ZXM7CiAgICAgICAgICBQYXJ0aWFsRXZhbHVhdG9yLmJ1aWxkRm9udFBhdGhzKHRoaXMuZm9udCwgZ2x5cGhzLCBoYW5kbGVyKTsKICAgICAgICB9LAogICAgICAgIGxvYWRUeXBlM0RhdGE6IGZ1bmN0aW9uIGxvYWRUeXBlM0RhdGEoZXZhbHVhdG9yLCByZXNvdXJjZXMsIHBhcmVudE9wZXJhdG9yTGlzdCwgdGFzaykgewogICAgICAgICAgaWYgKCF0aGlzLmZvbnQuaXNUeXBlM0ZvbnQpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJNdXN0IGJlIGEgVHlwZTMgZm9udC4iKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodGhpcy50eXBlM0xvYWRlZCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy50eXBlM0xvYWRlZDsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgdHlwZTNPcHRpb25zID0gT2JqZWN0LmNyZWF0ZShldmFsdWF0b3Iub3B0aW9ucyk7CiAgICAgICAgICB0eXBlM09wdGlvbnMuaWdub3JlRXJyb3JzID0gZmFsc2U7CiAgICAgICAgICB0eXBlM09wdGlvbnMubmF0aXZlSW1hZ2VEZWNvZGVyU3VwcG9ydCA9IF91dGlsLk5hdGl2ZUltYWdlRGVjb2RpbmcuTk9ORTsKICAgICAgICAgIHZhciB0eXBlM0V2YWx1YXRvciA9IGV2YWx1YXRvci5jbG9uZSh0eXBlM09wdGlvbnMpOwogICAgICAgICAgdHlwZTNFdmFsdWF0b3IucGFyc2luZ1R5cGUzRm9udCA9IHRydWU7CiAgICAgICAgICB2YXIgdHJhbnNsYXRlZEZvbnQgPSB0aGlzLmZvbnQ7CiAgICAgICAgICB2YXIgbG9hZENoYXJQcm9jc1Byb21pc2UgPSBQcm9taXNlLnJlc29sdmUoKTsKICAgICAgICAgIHZhciBjaGFyUHJvY3MgPSB0aGlzLmRpY3QuZ2V0KCJDaGFyUHJvY3MiKTsKICAgICAgICAgIHZhciBmb250UmVzb3VyY2VzID0gdGhpcy5kaWN0LmdldCgiUmVzb3VyY2VzIikgfHwgcmVzb3VyY2VzOwogICAgICAgICAgdmFyIGNoYXJQcm9jS2V5cyA9IGNoYXJQcm9jcy5nZXRLZXlzKCk7CiAgICAgICAgICB2YXIgY2hhclByb2NPcGVyYXRvckxpc3QgPSBPYmplY3QuY3JlYXRlKG51bGwpOwoKICAgICAgICAgIHZhciBfbG9vcDIgPSBmdW5jdGlvbiBfbG9vcDIoKSB7CiAgICAgICAgICAgIHZhciBrZXkgPSBjaGFyUHJvY0tleXNbaV07CiAgICAgICAgICAgIGxvYWRDaGFyUHJvY3NQcm9taXNlID0gbG9hZENoYXJQcm9jc1Byb21pc2UudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgdmFyIGdseXBoU3RyZWFtID0gY2hhclByb2NzLmdldChrZXkpOwogICAgICAgICAgICAgIHZhciBvcGVyYXRvckxpc3QgPSBuZXcgX29wZXJhdG9yX2xpc3QuT3BlcmF0b3JMaXN0KCk7CiAgICAgICAgICAgICAgcmV0dXJuIHR5cGUzRXZhbHVhdG9yLmdldE9wZXJhdG9yTGlzdCh7CiAgICAgICAgICAgICAgICBzdHJlYW06IGdseXBoU3RyZWFtLAogICAgICAgICAgICAgICAgdGFzazogdGFzaywKICAgICAgICAgICAgICAgIHJlc291cmNlczogZm9udFJlc291cmNlcywKICAgICAgICAgICAgICAgIG9wZXJhdG9yTGlzdDogb3BlcmF0b3JMaXN0CiAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBjaGFyUHJvY09wZXJhdG9yTGlzdFtrZXldID0gb3BlcmF0b3JMaXN0LmdldElSKCk7CiAgICAgICAgICAgICAgICBwYXJlbnRPcGVyYXRvckxpc3QuYWRkRGVwZW5kZW5jaWVzKG9wZXJhdG9yTGlzdC5kZXBlbmRlbmNpZXMpOwogICAgICAgICAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiVHlwZTMgZm9udCByZXNvdXJjZSBcIiIuY29uY2F0KGtleSwgIlwiIGlzIG5vdCBhdmFpbGFibGUuIikpOwogICAgICAgICAgICAgICAgdmFyIG9wZXJhdG9yTGlzdCA9IG5ldyBfb3BlcmF0b3JfbGlzdC5PcGVyYXRvckxpc3QoKTsKICAgICAgICAgICAgICAgIGNoYXJQcm9jT3BlcmF0b3JMaXN0W2tleV0gPSBvcGVyYXRvckxpc3QuZ2V0SVIoKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9OwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBuID0gY2hhclByb2NLZXlzLmxlbmd0aDsgaSA8IG47ICsraSkgewogICAgICAgICAgICBfbG9vcDIoKTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnR5cGUzTG9hZGVkID0gbG9hZENoYXJQcm9jc1Byb21pc2UudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHRyYW5zbGF0ZWRGb250LmNoYXJQcm9jT3BlcmF0b3JMaXN0ID0gY2hhclByb2NPcGVyYXRvckxpc3Q7CiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiB0aGlzLnR5cGUzTG9hZGVkOwogICAgICAgIH0KICAgICAgfTsKICAgICAgcmV0dXJuIFRyYW5zbGF0ZWRGb250OwogICAgfSgpOwoKICAgIHZhciBTdGF0ZU1hbmFnZXIgPSBmdW5jdGlvbiBTdGF0ZU1hbmFnZXJDbG9zdXJlKCkgewogICAgICBmdW5jdGlvbiBTdGF0ZU1hbmFnZXIoaW5pdGlhbFN0YXRlKSB7CiAgICAgICAgdGhpcy5zdGF0ZSA9IGluaXRpYWxTdGF0ZTsKICAgICAgICB0aGlzLnN0YXRlU3RhY2sgPSBbXTsKICAgICAgfQoKICAgICAgU3RhdGVNYW5hZ2VyLnByb3RvdHlwZSA9IHsKICAgICAgICBzYXZlOiBmdW5jdGlvbiBzYXZlKCkgewogICAgICAgICAgdmFyIG9sZCA9IHRoaXMuc3RhdGU7CiAgICAgICAgICB0aGlzLnN0YXRlU3RhY2sucHVzaCh0aGlzLnN0YXRlKTsKICAgICAgICAgIHRoaXMuc3RhdGUgPSBvbGQuY2xvbmUoKTsKICAgICAgICB9LAogICAgICAgIHJlc3RvcmU6IGZ1bmN0aW9uIHJlc3RvcmUoKSB7CiAgICAgICAgICB2YXIgcHJldiA9IHRoaXMuc3RhdGVTdGFjay5wb3AoKTsKCiAgICAgICAgICBpZiAocHJldikgewogICAgICAgICAgICB0aGlzLnN0YXRlID0gcHJldjsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHRyYW5zZm9ybTogZnVuY3Rpb24gdHJhbnNmb3JtKGFyZ3MpIHsKICAgICAgICAgIHRoaXMuc3RhdGUuY3RtID0gX3V0aWwuVXRpbC50cmFuc2Zvcm0odGhpcy5zdGF0ZS5jdG0sIGFyZ3MpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgcmV0dXJuIFN0YXRlTWFuYWdlcjsKICAgIH0oKTsKCiAgICB2YXIgVGV4dFN0YXRlID0gZnVuY3Rpb24gVGV4dFN0YXRlQ2xvc3VyZSgpIHsKICAgICAgZnVuY3Rpb24gVGV4dFN0YXRlKCkgewogICAgICAgIHRoaXMuY3RtID0gbmV3IEZsb2F0MzJBcnJheShfdXRpbC5JREVOVElUWV9NQVRSSVgpOwogICAgICAgIHRoaXMuZm9udE5hbWUgPSBudWxsOwogICAgICAgIHRoaXMuZm9udFNpemUgPSAwOwogICAgICAgIHRoaXMuZm9udCA9IG51bGw7CiAgICAgICAgdGhpcy5mb250TWF0cml4ID0gX3V0aWwuRk9OVF9JREVOVElUWV9NQVRSSVg7CiAgICAgICAgdGhpcy50ZXh0TWF0cml4ID0gX3V0aWwuSURFTlRJVFlfTUFUUklYLnNsaWNlKCk7CiAgICAgICAgdGhpcy50ZXh0TGluZU1hdHJpeCA9IF91dGlsLklERU5USVRZX01BVFJJWC5zbGljZSgpOwogICAgICAgIHRoaXMuY2hhclNwYWNpbmcgPSAwOwogICAgICAgIHRoaXMud29yZFNwYWNpbmcgPSAwOwogICAgICAgIHRoaXMubGVhZGluZyA9IDA7CiAgICAgICAgdGhpcy50ZXh0SFNjYWxlID0gMTsKICAgICAgICB0aGlzLnRleHRSaXNlID0gMDsKICAgICAgfQoKICAgICAgVGV4dFN0YXRlLnByb3RvdHlwZSA9IHsKICAgICAgICBzZXRUZXh0TWF0cml4OiBmdW5jdGlvbiBUZXh0U3RhdGVfc2V0VGV4dE1hdHJpeChhLCBiLCBjLCBkLCBlLCBmKSB7CiAgICAgICAgICB2YXIgbSA9IHRoaXMudGV4dE1hdHJpeDsKICAgICAgICAgIG1bMF0gPSBhOwogICAgICAgICAgbVsxXSA9IGI7CiAgICAgICAgICBtWzJdID0gYzsKICAgICAgICAgIG1bM10gPSBkOwogICAgICAgICAgbVs0XSA9IGU7CiAgICAgICAgICBtWzVdID0gZjsKICAgICAgICB9LAogICAgICAgIHNldFRleHRMaW5lTWF0cml4OiBmdW5jdGlvbiBUZXh0U3RhdGVfc2V0VGV4dE1hdHJpeChhLCBiLCBjLCBkLCBlLCBmKSB7CiAgICAgICAgICB2YXIgbSA9IHRoaXMudGV4dExpbmVNYXRyaXg7CiAgICAgICAgICBtWzBdID0gYTsKICAgICAgICAgIG1bMV0gPSBiOwogICAgICAgICAgbVsyXSA9IGM7CiAgICAgICAgICBtWzNdID0gZDsKICAgICAgICAgIG1bNF0gPSBlOwogICAgICAgICAgbVs1XSA9IGY7CiAgICAgICAgfSwKICAgICAgICB0cmFuc2xhdGVUZXh0TWF0cml4OiBmdW5jdGlvbiBUZXh0U3RhdGVfdHJhbnNsYXRlVGV4dE1hdHJpeCh4LCB5KSB7CiAgICAgICAgICB2YXIgbSA9IHRoaXMudGV4dE1hdHJpeDsKICAgICAgICAgIG1bNF0gPSBtWzBdICogeCArIG1bMl0gKiB5ICsgbVs0XTsKICAgICAgICAgIG1bNV0gPSBtWzFdICogeCArIG1bM10gKiB5ICsgbVs1XTsKICAgICAgICB9LAogICAgICAgIHRyYW5zbGF0ZVRleHRMaW5lTWF0cml4OiBmdW5jdGlvbiBUZXh0U3RhdGVfdHJhbnNsYXRlVGV4dE1hdHJpeCh4LCB5KSB7CiAgICAgICAgICB2YXIgbSA9IHRoaXMudGV4dExpbmVNYXRyaXg7CiAgICAgICAgICBtWzRdID0gbVswXSAqIHggKyBtWzJdICogeSArIG1bNF07CiAgICAgICAgICBtWzVdID0gbVsxXSAqIHggKyBtWzNdICogeSArIG1bNV07CiAgICAgICAgfSwKICAgICAgICBjYWxjVGV4dExpbmVNYXRyaXhBZHZhbmNlOiBmdW5jdGlvbiBUZXh0U3RhdGVfY2FsY1RleHRMaW5lTWF0cml4QWR2YW5jZShhLCBiLCBjLCBkLCBlLCBmKSB7CiAgICAgICAgICB2YXIgZm9udCA9IHRoaXMuZm9udDsKCiAgICAgICAgICBpZiAoIWZvbnQpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIG0gPSB0aGlzLnRleHRMaW5lTWF0cml4OwoKICAgICAgICAgIGlmICghKGEgPT09IG1bMF0gJiYgYiA9PT0gbVsxXSAmJiBjID09PSBtWzJdICYmIGQgPT09IG1bM10pKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciB0eERpZmYgPSBlIC0gbVs0XSwKICAgICAgICAgICAgdHlEaWZmID0gZiAtIG1bNV07CgogICAgICAgICAgaWYgKGZvbnQudmVydGljYWwgJiYgdHhEaWZmICE9PSAwIHx8ICFmb250LnZlcnRpY2FsICYmIHR5RGlmZiAhPT0gMCkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgdHgsCiAgICAgICAgICAgIHR5LAogICAgICAgICAgICBkZW5vbWluYXRvciA9IGEgKiBkIC0gYiAqIGM7CgogICAgICAgICAgaWYgKGZvbnQudmVydGljYWwpIHsKICAgICAgICAgICAgdHggPSAtdHlEaWZmICogYyAvIGRlbm9taW5hdG9yOwogICAgICAgICAgICB0eSA9IHR5RGlmZiAqIGEgLyBkZW5vbWluYXRvcjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHR4ID0gdHhEaWZmICogZCAvIGRlbm9taW5hdG9yOwogICAgICAgICAgICB0eSA9IC10eERpZmYgKiBiIC8gZGVub21pbmF0b3I7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgd2lkdGg6IHR4LAogICAgICAgICAgICBoZWlnaHQ6IHR5LAogICAgICAgICAgICB2YWx1ZTogZm9udC52ZXJ0aWNhbCA/IHR5IDogdHgKICAgICAgICAgIH07CiAgICAgICAgfSwKICAgICAgICBjYWxjUmVuZGVyTWF0cml4OiBmdW5jdGlvbiBUZXh0U3RhdGVfY2FsY1JlbmRlTWF0cml4KGN0bSkgewogICAgICAgICAgdmFyIHRzbSA9IFt0aGlzLmZvbnRTaXplICogdGhpcy50ZXh0SFNjYWxlLCAwLCAwLCB0aGlzLmZvbnRTaXplLCAwLCB0aGlzLnRleHRSaXNlXTsKICAgICAgICAgIHJldHVybiBfdXRpbC5VdGlsLnRyYW5zZm9ybShjdG0sIF91dGlsLlV0aWwudHJhbnNmb3JtKHRoaXMudGV4dE1hdHJpeCwgdHNtKSk7CiAgICAgICAgfSwKICAgICAgICBjYXJyaWFnZVJldHVybjogZnVuY3Rpb24gVGV4dFN0YXRlX2NhcnJpYWdlUmV0dXJuKCkgewogICAgICAgICAgdGhpcy50cmFuc2xhdGVUZXh0TGluZU1hdHJpeCgwLCAtdGhpcy5sZWFkaW5nKTsKICAgICAgICAgIHRoaXMudGV4dE1hdHJpeCA9IHRoaXMudGV4dExpbmVNYXRyaXguc2xpY2UoKTsKICAgICAgICB9LAogICAgICAgIGNsb25lOiBmdW5jdGlvbiBUZXh0U3RhdGVfY2xvbmUoKSB7CiAgICAgICAgICB2YXIgY2xvbmUgPSBPYmplY3QuY3JlYXRlKHRoaXMpOwogICAgICAgICAgY2xvbmUudGV4dE1hdHJpeCA9IHRoaXMudGV4dE1hdHJpeC5zbGljZSgpOwogICAgICAgICAgY2xvbmUudGV4dExpbmVNYXRyaXggPSB0aGlzLnRleHRMaW5lTWF0cml4LnNsaWNlKCk7CiAgICAgICAgICBjbG9uZS5mb250TWF0cml4ID0gdGhpcy5mb250TWF0cml4LnNsaWNlKCk7CiAgICAgICAgICByZXR1cm4gY2xvbmU7CiAgICAgICAgfQogICAgICB9OwogICAgICByZXR1cm4gVGV4dFN0YXRlOwogICAgfSgpOwoKICAgIHZhciBFdmFsU3RhdGUgPSBmdW5jdGlvbiBFdmFsU3RhdGVDbG9zdXJlKCkgewogICAgICBmdW5jdGlvbiBFdmFsU3RhdGUoKSB7CiAgICAgICAgdGhpcy5jdG0gPSBuZXcgRmxvYXQzMkFycmF5KF91dGlsLklERU5USVRZX01BVFJJWCk7CiAgICAgICAgdGhpcy5mb250ID0gbnVsbDsKICAgICAgICB0aGlzLnRleHRSZW5kZXJpbmdNb2RlID0gX3V0aWwuVGV4dFJlbmRlcmluZ01vZGUuRklMTDsKICAgICAgICB0aGlzLmZpbGxDb2xvclNwYWNlID0gX2NvbG9yc3BhY2UuQ29sb3JTcGFjZS5zaW5nbGV0b25zLmdyYXk7CiAgICAgICAgdGhpcy5zdHJva2VDb2xvclNwYWNlID0gX2NvbG9yc3BhY2UuQ29sb3JTcGFjZS5zaW5nbGV0b25zLmdyYXk7CiAgICAgIH0KCiAgICAgIEV2YWxTdGF0ZS5wcm90b3R5cGUgPSB7CiAgICAgICAgY2xvbmU6IGZ1bmN0aW9uIENhbnZhc0V4dHJhU3RhdGVfY2xvbmUoKSB7CiAgICAgICAgICByZXR1cm4gT2JqZWN0LmNyZWF0ZSh0aGlzKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHJldHVybiBFdmFsU3RhdGU7CiAgICB9KCk7CgogICAgdmFyIEV2YWx1YXRvclByZXByb2Nlc3NvciA9IGZ1bmN0aW9uIEV2YWx1YXRvclByZXByb2Nlc3NvckNsb3N1cmUoKSB7CiAgICAgIHZhciBnZXRPUE1hcCA9ICgwLCBfY29yZV91dGlscy5nZXRMb29rdXBUYWJsZUZhY3RvcnkpKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdFsidyJdID0gewogICAgICAgICAgaWQ6IF91dGlsLk9QUy5zZXRMaW5lV2lkdGgsCiAgICAgICAgICBudW1BcmdzOiAxLAogICAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgdFsiSiJdID0gewogICAgICAgICAgaWQ6IF91dGlsLk9QUy5zZXRMaW5lQ2FwLAogICAgICAgICAgbnVtQXJnczogMSwKICAgICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgICB9OwogICAgICAgIHRbImoiXSA9IHsKICAgICAgICAgIGlkOiBfdXRpbC5PUFMuc2V0TGluZUpvaW4sCiAgICAgICAgICBudW1BcmdzOiAxLAogICAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgdFsiTSJdID0gewogICAgICAgICAgaWQ6IF91dGlsLk9QUy5zZXRNaXRlckxpbWl0LAogICAgICAgICAgbnVtQXJnczogMSwKICAgICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgICB9OwogICAgICAgIHRbImQiXSA9IHsKICAgICAgICAgIGlkOiBfdXRpbC5PUFMuc2V0RGFzaCwKICAgICAgICAgIG51bUFyZ3M6IDIsCiAgICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgICAgfTsKICAgICAgICB0WyJyaSJdID0gewogICAgICAgICAgaWQ6IF91dGlsLk9QUy5zZXRSZW5kZXJpbmdJbnRlbnQsCiAgICAgICAgICBudW1BcmdzOiAxLAogICAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgdFsiaSJdID0gewogICAgICAgICAgaWQ6IF91dGlsLk9QUy5zZXRGbGF0bmVzcywKICAgICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgICAgfTsKICAgICAgICB0WyJncyJdID0gewogICAgICAgICAgaWQ6IF91dGlsLk9QUy5zZXRHU3RhdGUsCiAgICAgICAgICBudW1BcmdzOiAxLAogICAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgdFsicSJdID0gewogICAgICAgICAgaWQ6IF91dGlsLk9QUy5zYXZlLAogICAgICAgICAgbnVtQXJnczogMCwKICAgICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgICB9OwogICAgICAgIHRbIlEiXSA9IHsKICAgICAgICAgIGlkOiBfdXRpbC5PUFMucmVzdG9yZSwKICAgICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgICAgfTsKICAgICAgICB0WyJjbSJdID0gewogICAgICAgICAgaWQ6IF91dGlsLk9QUy50cmFuc2Zvcm0sCiAgICAgICAgICBudW1BcmdzOiA2LAogICAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgdFsibSJdID0gewogICAgICAgICAgaWQ6IF91dGlsLk9QUy5tb3ZlVG8sCiAgICAgICAgICBudW1BcmdzOiAyLAogICAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgdFsibCJdID0gewogICAgICAgICAgaWQ6IF91dGlsLk9QUy5saW5lVG8sCiAgICAgICAgICBudW1BcmdzOiAyLAogICAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgdFsiYyJdID0gewogICAgICAgICAgaWQ6IF91dGlsLk9QUy5jdXJ2ZVRvLAogICAgICAgICAgbnVtQXJnczogNiwKICAgICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgICB9OwogICAgICAgIHRbInYiXSA9IHsKICAgICAgICAgIGlkOiBfdXRpbC5PUFMuY3VydmVUbzIsCiAgICAgICAgICBudW1BcmdzOiA0LAogICAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgdFsieSJdID0gewogICAgICAgICAgaWQ6IF91dGlsLk9QUy5jdXJ2ZVRvMywKICAgICAgICAgIG51bUFyZ3M6IDQsCiAgICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgICAgfTsKICAgICAgICB0WyJoIl0gPSB7CiAgICAgICAgICBpZDogX3V0aWwuT1BTLmNsb3NlUGF0aCwKICAgICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgICAgfTsKICAgICAgICB0WyJyZSJdID0gewogICAgICAgICAgaWQ6IF91dGlsLk9QUy5yZWN0YW5nbGUsCiAgICAgICAgICBudW1BcmdzOiA0LAogICAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgdFsiUyJdID0gewogICAgICAgICAgaWQ6IF91dGlsLk9QUy5zdHJva2UsCiAgICAgICAgICBudW1BcmdzOiAwLAogICAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgdFsicyJdID0gewogICAgICAgICAgaWQ6IF91dGlsLk9QUy5jbG9zZVN0cm9rZSwKICAgICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgICAgfTsKICAgICAgICB0WyJmIl0gPSB7CiAgICAgICAgICBpZDogX3V0aWwuT1BTLmZpbGwsCiAgICAgICAgICBudW1BcmdzOiAwLAogICAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgdFsiRiJdID0gewogICAgICAgICAgaWQ6IF91dGlsLk9QUy5maWxsLAogICAgICAgICAgbnVtQXJnczogMCwKICAgICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgICB9OwogICAgICAgIHRbImYqIl0gPSB7CiAgICAgICAgICBpZDogX3V0aWwuT1BTLmVvRmlsbCwKICAgICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgICAgfTsKICAgICAgICB0WyJCIl0gPSB7CiAgICAgICAgICBpZDogX3V0aWwuT1BTLmZpbGxTdHJva2UsCiAgICAgICAgICBudW1BcmdzOiAwLAogICAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgdFsiQioiXSA9IHsKICAgICAgICAgIGlkOiBfdXRpbC5PUFMuZW9GaWxsU3Ryb2tlLAogICAgICAgICAgbnVtQXJnczogMCwKICAgICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgICB9OwogICAgICAgIHRbImIiXSA9IHsKICAgICAgICAgIGlkOiBfdXRpbC5PUFMuY2xvc2VGaWxsU3Ryb2tlLAogICAgICAgICAgbnVtQXJnczogMCwKICAgICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgICB9OwogICAgICAgIHRbImIqIl0gPSB7CiAgICAgICAgICBpZDogX3V0aWwuT1BTLmNsb3NlRU9GaWxsU3Ryb2tlLAogICAgICAgICAgbnVtQXJnczogMCwKICAgICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgICB9OwogICAgICAgIHRbIm4iXSA9IHsKICAgICAgICAgIGlkOiBfdXRpbC5PUFMuZW5kUGF0aCwKICAgICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgICAgfTsKICAgICAgICB0WyJXIl0gPSB7CiAgICAgICAgICBpZDogX3V0aWwuT1BTLmNsaXAsCiAgICAgICAgICBudW1BcmdzOiAwLAogICAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgdFsiVyoiXSA9IHsKICAgICAgICAgIGlkOiBfdXRpbC5PUFMuZW9DbGlwLAogICAgICAgICAgbnVtQXJnczogMCwKICAgICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgICB9OwogICAgICAgIHRbIkJUIl0gPSB7CiAgICAgICAgICBpZDogX3V0aWwuT1BTLmJlZ2luVGV4dCwKICAgICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgICAgfTsKICAgICAgICB0WyJFVCJdID0gewogICAgICAgICAgaWQ6IF91dGlsLk9QUy5lbmRUZXh0LAogICAgICAgICAgbnVtQXJnczogMCwKICAgICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgICB9OwogICAgICAgIHRbIlRjIl0gPSB7CiAgICAgICAgICBpZDogX3V0aWwuT1BTLnNldENoYXJTcGFjaW5nLAogICAgICAgICAgbnVtQXJnczogMSwKICAgICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgICB9OwogICAgICAgIHRbIlR3Il0gPSB7CiAgICAgICAgICBpZDogX3V0aWwuT1BTLnNldFdvcmRTcGFjaW5nLAogICAgICAgICAgbnVtQXJnczogMSwKICAgICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgICB9OwogICAgICAgIHRbIlR6Il0gPSB7CiAgICAgICAgICBpZDogX3V0aWwuT1BTLnNldEhTY2FsZSwKICAgICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgICAgfTsKICAgICAgICB0WyJUTCJdID0gewogICAgICAgICAgaWQ6IF91dGlsLk9QUy5zZXRMZWFkaW5nLAogICAgICAgICAgbnVtQXJnczogMSwKICAgICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgICB9OwogICAgICAgIHRbIlRmIl0gPSB7CiAgICAgICAgICBpZDogX3V0aWwuT1BTLnNldEZvbnQsCiAgICAgICAgICBudW1BcmdzOiAyLAogICAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgdFsiVHIiXSA9IHsKICAgICAgICAgIGlkOiBfdXRpbC5PUFMuc2V0VGV4dFJlbmRlcmluZ01vZGUsCiAgICAgICAgICBudW1BcmdzOiAxLAogICAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgdFsiVHMiXSA9IHsKICAgICAgICAgIGlkOiBfdXRpbC5PUFMuc2V0VGV4dFJpc2UsCiAgICAgICAgICBudW1BcmdzOiAxLAogICAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgdFsiVGQiXSA9IHsKICAgICAgICAgIGlkOiBfdXRpbC5PUFMubW92ZVRleHQsCiAgICAgICAgICBudW1BcmdzOiAyLAogICAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgdFsiVEQiXSA9IHsKICAgICAgICAgIGlkOiBfdXRpbC5PUFMuc2V0TGVhZGluZ01vdmVUZXh0LAogICAgICAgICAgbnVtQXJnczogMiwKICAgICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgICB9OwogICAgICAgIHRbIlRtIl0gPSB7CiAgICAgICAgICBpZDogX3V0aWwuT1BTLnNldFRleHRNYXRyaXgsCiAgICAgICAgICBudW1BcmdzOiA2LAogICAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgdFsiVCoiXSA9IHsKICAgICAgICAgIGlkOiBfdXRpbC5PUFMubmV4dExpbmUsCiAgICAgICAgICBudW1BcmdzOiAwLAogICAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgdFsiVGoiXSA9IHsKICAgICAgICAgIGlkOiBfdXRpbC5PUFMuc2hvd1RleHQsCiAgICAgICAgICBudW1BcmdzOiAxLAogICAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgdFsiVEoiXSA9IHsKICAgICAgICAgIGlkOiBfdXRpbC5PUFMuc2hvd1NwYWNlZFRleHQsCiAgICAgICAgICBudW1BcmdzOiAxLAogICAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgdFsiJyJdID0gewogICAgICAgICAgaWQ6IF91dGlsLk9QUy5uZXh0TGluZVNob3dUZXh0LAogICAgICAgICAgbnVtQXJnczogMSwKICAgICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgICB9OwogICAgICAgIHRbJyInXSA9IHsKICAgICAgICAgIGlkOiBfdXRpbC5PUFMubmV4dExpbmVTZXRTcGFjaW5nU2hvd1RleHQsCiAgICAgICAgICBudW1BcmdzOiAzLAogICAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgdFsiZDAiXSA9IHsKICAgICAgICAgIGlkOiBfdXRpbC5PUFMuc2V0Q2hhcldpZHRoLAogICAgICAgICAgbnVtQXJnczogMiwKICAgICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgICB9OwogICAgICAgIHRbImQxIl0gPSB7CiAgICAgICAgICBpZDogX3V0aWwuT1BTLnNldENoYXJXaWR0aEFuZEJvdW5kcywKICAgICAgICAgIG51bUFyZ3M6IDYsCiAgICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgICAgfTsKICAgICAgICB0WyJDUyJdID0gewogICAgICAgICAgaWQ6IF91dGlsLk9QUy5zZXRTdHJva2VDb2xvclNwYWNlLAogICAgICAgICAgbnVtQXJnczogMSwKICAgICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgICB9OwogICAgICAgIHRbImNzIl0gPSB7CiAgICAgICAgICBpZDogX3V0aWwuT1BTLnNldEZpbGxDb2xvclNwYWNlLAogICAgICAgICAgbnVtQXJnczogMSwKICAgICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgICB9OwogICAgICAgIHRbIlNDIl0gPSB7CiAgICAgICAgICBpZDogX3V0aWwuT1BTLnNldFN0cm9rZUNvbG9yLAogICAgICAgICAgbnVtQXJnczogNCwKICAgICAgICAgIHZhcmlhYmxlQXJnczogdHJ1ZQogICAgICAgIH07CiAgICAgICAgdFsiU0NOIl0gPSB7CiAgICAgICAgICBpZDogX3V0aWwuT1BTLnNldFN0cm9rZUNvbG9yTiwKICAgICAgICAgIG51bUFyZ3M6IDMzLAogICAgICAgICAgdmFyaWFibGVBcmdzOiB0cnVlCiAgICAgICAgfTsKICAgICAgICB0WyJzYyJdID0gewogICAgICAgICAgaWQ6IF91dGlsLk9QUy5zZXRGaWxsQ29sb3IsCiAgICAgICAgICBudW1BcmdzOiA0LAogICAgICAgICAgdmFyaWFibGVBcmdzOiB0cnVlCiAgICAgICAgfTsKICAgICAgICB0WyJzY24iXSA9IHsKICAgICAgICAgIGlkOiBfdXRpbC5PUFMuc2V0RmlsbENvbG9yTiwKICAgICAgICAgIG51bUFyZ3M6IDMzLAogICAgICAgICAgdmFyaWFibGVBcmdzOiB0cnVlCiAgICAgICAgfTsKICAgICAgICB0WyJHIl0gPSB7CiAgICAgICAgICBpZDogX3V0aWwuT1BTLnNldFN0cm9rZUdyYXksCiAgICAgICAgICBudW1BcmdzOiAxLAogICAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgdFsiZyJdID0gewogICAgICAgICAgaWQ6IF91dGlsLk9QUy5zZXRGaWxsR3JheSwKICAgICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgICAgfTsKICAgICAgICB0WyJSRyJdID0gewogICAgICAgICAgaWQ6IF91dGlsLk9QUy5zZXRTdHJva2VSR0JDb2xvciwKICAgICAgICAgIG51bUFyZ3M6IDMsCiAgICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgICAgfTsKICAgICAgICB0WyJyZyJdID0gewogICAgICAgICAgaWQ6IF91dGlsLk9QUy5zZXRGaWxsUkdCQ29sb3IsCiAgICAgICAgICBudW1BcmdzOiAzLAogICAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgdFsiSyJdID0gewogICAgICAgICAgaWQ6IF91dGlsLk9QUy5zZXRTdHJva2VDTVlLQ29sb3IsCiAgICAgICAgICBudW1BcmdzOiA0LAogICAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgdFsiayJdID0gewogICAgICAgICAgaWQ6IF91dGlsLk9QUy5zZXRGaWxsQ01ZS0NvbG9yLAogICAgICAgICAgbnVtQXJnczogNCwKICAgICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgICB9OwogICAgICAgIHRbInNoIl0gPSB7CiAgICAgICAgICBpZDogX3V0aWwuT1BTLnNoYWRpbmdGaWxsLAogICAgICAgICAgbnVtQXJnczogMSwKICAgICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgICB9OwogICAgICAgIHRbIkJJIl0gPSB7CiAgICAgICAgICBpZDogX3V0aWwuT1BTLmJlZ2luSW5saW5lSW1hZ2UsCiAgICAgICAgICBudW1BcmdzOiAwLAogICAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgdFsiSUQiXSA9IHsKICAgICAgICAgIGlkOiBfdXRpbC5PUFMuYmVnaW5JbWFnZURhdGEsCiAgICAgICAgICBudW1BcmdzOiAwLAogICAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgdFsiRUkiXSA9IHsKICAgICAgICAgIGlkOiBfdXRpbC5PUFMuZW5kSW5saW5lSW1hZ2UsCiAgICAgICAgICBudW1BcmdzOiAxLAogICAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgdFsiRG8iXSA9IHsKICAgICAgICAgIGlkOiBfdXRpbC5PUFMucGFpbnRYT2JqZWN0LAogICAgICAgICAgbnVtQXJnczogMSwKICAgICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgICB9OwogICAgICAgIHRbIk1QIl0gPSB7CiAgICAgICAgICBpZDogX3V0aWwuT1BTLm1hcmtQb2ludCwKICAgICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgICAgfTsKICAgICAgICB0WyJEUCJdID0gewogICAgICAgICAgaWQ6IF91dGlsLk9QUy5tYXJrUG9pbnRQcm9wcywKICAgICAgICAgIG51bUFyZ3M6IDIsCiAgICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgICAgfTsKICAgICAgICB0WyJCTUMiXSA9IHsKICAgICAgICAgIGlkOiBfdXRpbC5PUFMuYmVnaW5NYXJrZWRDb250ZW50LAogICAgICAgICAgbnVtQXJnczogMSwKICAgICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgICB9OwogICAgICAgIHRbIkJEQyJdID0gewogICAgICAgICAgaWQ6IF91dGlsLk9QUy5iZWdpbk1hcmtlZENvbnRlbnRQcm9wcywKICAgICAgICAgIG51bUFyZ3M6IDIsCiAgICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgICAgfTsKICAgICAgICB0WyJFTUMiXSA9IHsKICAgICAgICAgIGlkOiBfdXRpbC5PUFMuZW5kTWFya2VkQ29udGVudCwKICAgICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgICAgfTsKICAgICAgICB0WyJCWCJdID0gewogICAgICAgICAgaWQ6IF91dGlsLk9QUy5iZWdpbkNvbXBhdCwKICAgICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgICAgfTsKICAgICAgICB0WyJFWCJdID0gewogICAgICAgICAgaWQ6IF91dGlsLk9QUy5lbmRDb21wYXQsCiAgICAgICAgICBudW1BcmdzOiAwLAogICAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgdFsiQk0iXSA9IG51bGw7CiAgICAgICAgdFsiQkQiXSA9IG51bGw7CiAgICAgICAgdFsidHJ1ZSJdID0gbnVsbDsKICAgICAgICB0WyJmYSJdID0gbnVsbDsKICAgICAgICB0WyJmYWwiXSA9IG51bGw7CiAgICAgICAgdFsiZmFscyJdID0gbnVsbDsKICAgICAgICB0WyJmYWxzZSJdID0gbnVsbDsKICAgICAgICB0WyJudSJdID0gbnVsbDsKICAgICAgICB0WyJudWwiXSA9IG51bGw7CiAgICAgICAgdFsibnVsbCJdID0gbnVsbDsKICAgICAgfSk7CiAgICAgIHZhciBNQVhfSU5WQUxJRF9QQVRIX09QUyA9IDIwOwoKICAgICAgZnVuY3Rpb24gRXZhbHVhdG9yUHJlcHJvY2Vzc29yKHN0cmVhbSwgeHJlZiwgc3RhdGVNYW5hZ2VyKSB7CiAgICAgICAgdGhpcy5vcE1hcCA9IGdldE9QTWFwKCk7CiAgICAgICAgdGhpcy5wYXJzZXIgPSBuZXcgX3BhcnNlci5QYXJzZXIoewogICAgICAgICAgbGV4ZXI6IG5ldyBfcGFyc2VyLkxleGVyKHN0cmVhbSwgdGhpcy5vcE1hcCksCiAgICAgICAgICB4cmVmOiB4cmVmCiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5zdGF0ZU1hbmFnZXIgPSBzdGF0ZU1hbmFnZXI7CiAgICAgICAgdGhpcy5ub25Qcm9jZXNzZWRBcmdzID0gW107CiAgICAgICAgdGhpcy5fbnVtSW52YWxpZFBhdGhPUFMgPSAwOwogICAgICB9CgogICAgICBFdmFsdWF0b3JQcmVwcm9jZXNzb3IucHJvdG90eXBlID0gewogICAgICAgIGdldCBzYXZlZFN0YXRlc0RlcHRoKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGVNYW5hZ2VyLnN0YXRlU3RhY2subGVuZ3RoOwogICAgICAgIH0sCgogICAgICAgIHJlYWQ6IGZ1bmN0aW9uIEV2YWx1YXRvclByZXByb2Nlc3Nvcl9yZWFkKG9wZXJhdGlvbikgewogICAgICAgICAgdmFyIGFyZ3MgPSBvcGVyYXRpb24uYXJnczsKCiAgICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgICB2YXIgb2JqID0gdGhpcy5wYXJzZXIuZ2V0T2JqKCk7CgogICAgICAgICAgICBpZiAob2JqIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuQ21kKSB7CiAgICAgICAgICAgICAgdmFyIGNtZCA9IG9iai5jbWQ7CiAgICAgICAgICAgICAgdmFyIG9wU3BlYyA9IHRoaXMub3BNYXBbY21kXTsKCiAgICAgICAgICAgICAgaWYgKCFvcFNwZWMpIHsKICAgICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiVW5rbm93biBjb21tYW5kIFwiIi5jb25jYXQoY21kLCAiXCIuIikpOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgZm4gPSBvcFNwZWMuaWQ7CiAgICAgICAgICAgICAgdmFyIG51bUFyZ3MgPSBvcFNwZWMubnVtQXJnczsKICAgICAgICAgICAgICB2YXIgYXJnc0xlbmd0aCA9IGFyZ3MgIT09IG51bGwgPyBhcmdzLmxlbmd0aCA6IDA7CgogICAgICAgICAgICAgIGlmICghb3BTcGVjLnZhcmlhYmxlQXJncykgewogICAgICAgICAgICAgICAgaWYgKGFyZ3NMZW5ndGggIT09IG51bUFyZ3MpIHsKICAgICAgICAgICAgICAgICAgdmFyIG5vblByb2Nlc3NlZEFyZ3MgPSB0aGlzLm5vblByb2Nlc3NlZEFyZ3M7CgogICAgICAgICAgICAgICAgICB3aGlsZSAoYXJnc0xlbmd0aCA+IG51bUFyZ3MpIHsKICAgICAgICAgICAgICAgICAgICBub25Qcm9jZXNzZWRBcmdzLnB1c2goYXJncy5zaGlmdCgpKTsKICAgICAgICAgICAgICAgICAgICBhcmdzTGVuZ3RoLS07CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIHdoaWxlIChhcmdzTGVuZ3RoIDwgbnVtQXJncyAmJiBub25Qcm9jZXNzZWRBcmdzLmxlbmd0aCAhPT0gMCkgewogICAgICAgICAgICAgICAgICAgIGlmIChhcmdzID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICBhcmdzID0gW107CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBhcmdzLnVuc2hpZnQobm9uUHJvY2Vzc2VkQXJncy5wb3AoKSk7CiAgICAgICAgICAgICAgICAgICAgYXJnc0xlbmd0aCsrOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGFyZ3NMZW5ndGggPCBudW1BcmdzKSB7CiAgICAgICAgICAgICAgICAgIHZhciBwYXJ0aWFsTXNnID0gImNvbW1hbmQgIi5jb25jYXQoY21kLCAiOiBleHBlY3RlZCAiKS5jb25jYXQobnVtQXJncywgIiBhcmdzLCAiKSArICJidXQgcmVjZWl2ZWQgIi5jb25jYXQoYXJnc0xlbmd0aCwgIiBhcmdzLiIpOwoKICAgICAgICAgICAgICAgICAgaWYgKGZuID49IF91dGlsLk9QUy5tb3ZlVG8gJiYgZm4gPD0gX3V0aWwuT1BTLmVuZFBhdGggJiYgKyt0aGlzLl9udW1JbnZhbGlkUGF0aE9QUyA+IE1BWF9JTlZBTElEX1BBVEhfT1BTKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJJbnZhbGlkICIuY29uY2F0KHBhcnRpYWxNc2cpKTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJTa2lwcGluZyAiLmNvbmNhdChwYXJ0aWFsTXNnKSk7CgogICAgICAgICAgICAgICAgICBpZiAoYXJncyAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGFyZ3MubGVuZ3RoID0gMDsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChhcmdzTGVuZ3RoID4gbnVtQXJncykgewogICAgICAgICAgICAgICAgKDAsIF91dGlsLmluZm8pKCJDb21tYW5kICIuY29uY2F0KGNtZCwgIjogZXhwZWN0ZWQgWzAsICIpLmNvbmNhdChudW1BcmdzLCAiXSBhcmdzLCAiKSArICJidXQgcmVjZWl2ZWQgIi5jb25jYXQoYXJnc0xlbmd0aCwgIiBhcmdzLiIpKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHRoaXMucHJlcHJvY2Vzc0NvbW1hbmQoZm4sIGFyZ3MpOwogICAgICAgICAgICAgIG9wZXJhdGlvbi5mbiA9IGZuOwogICAgICAgICAgICAgIG9wZXJhdGlvbi5hcmdzID0gYXJnczsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKG9iaiA9PT0gX3ByaW1pdGl2ZXMuRU9GKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAob2JqICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgaWYgKGFyZ3MgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgIGFyZ3MgPSBbXTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGFyZ3MucHVzaChvYmopOwoKICAgICAgICAgICAgICBpZiAoYXJncy5sZW5ndGggPiAzMykgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJUb28gbWFueSBhcmd1bWVudHMiKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHByZXByb2Nlc3NDb21tYW5kOiBmdW5jdGlvbiBFdmFsdWF0b3JQcmVwcm9jZXNzb3JfcHJlcHJvY2Vzc0NvbW1hbmQoZm4sIGFyZ3MpIHsKICAgICAgICAgIHN3aXRjaCAoZm4gfCAwKSB7CiAgICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNhdmU6CiAgICAgICAgICAgICAgdGhpcy5zdGF0ZU1hbmFnZXIuc2F2ZSgpOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSBfdXRpbC5PUFMucmVzdG9yZToKICAgICAgICAgICAgICB0aGlzLnN0YXRlTWFuYWdlci5yZXN0b3JlKCk7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIF91dGlsLk9QUy50cmFuc2Zvcm06CiAgICAgICAgICAgICAgdGhpcy5zdGF0ZU1hbmFnZXIudHJhbnNmb3JtKGFyZ3MpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTsKICAgICAgcmV0dXJuIEV2YWx1YXRvclByZXByb2Nlc3NvcjsKICAgIH0oKTsKCiAgICAvKioqL30pLCAoCiAgLyogMjE2ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgIHZhbHVlOiB0cnVlCiAgICB9KTsKICAgIGV4cG9ydHMuQ01hcEZhY3RvcnkgPSBleHBvcnRzLklkZW50aXR5Q01hcCA9IGV4cG9ydHMuQ01hcCA9IHZvaWQgMDsKCiAgICB2YXIgX3JlZ2VuZXJhdG9yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfX3dfcGRmanNfcmVxdWlyZV9fKDIpKTsKCiAgICB2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUpOwoKICAgIHZhciBfcHJpbWl0aXZlcyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTk0KTsKCiAgICB2YXIgX3BhcnNlciA9IF9fd19wZGZqc19yZXF1aXJlX18oMjAwKTsKCiAgICB2YXIgX2NvcmVfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE5Nyk7CgogICAgdmFyIF9zdHJlYW0gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIwMSk7CgogICAgZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHtyZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTt9CgogICAgZnVuY3Rpb24gYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBrZXksIGFyZykge3RyeSB7dmFyIGluZm8gPSBnZW5ba2V5XShhcmcpO3ZhciB2YWx1ZSA9IGluZm8udmFsdWU7fSBjYXRjaCAoZXJyb3IpIHtyZWplY3QoZXJyb3IpO3JldHVybjt9aWYgKGluZm8uZG9uZSkge3Jlc29sdmUodmFsdWUpO30gZWxzZSB7UHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKF9uZXh0LCBfdGhyb3cpO319CgogICAgZnVuY3Rpb24gX2FzeW5jVG9HZW5lcmF0b3IoZm4pIHtyZXR1cm4gZnVuY3Rpb24gKCkge3ZhciBzZWxmID0gdGhpcyxhcmdzID0gYXJndW1lbnRzO3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7dmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpO2Z1bmN0aW9uIF9uZXh0KHZhbHVlKSB7YXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAibmV4dCIsIHZhbHVlKTt9ZnVuY3Rpb24gX3Rocm93KGVycikge2FzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyKTt9X25leHQodW5kZWZpbmVkKTt9KTt9O30KCiAgICBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyJAYmFiZWwvaGVscGVycyAtIHR5cGVvZiI7aWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIpIHtfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHtyZXR1cm4gdHlwZW9mIG9iajt9O30gZWxzZSB7X3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7cmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajt9O31yZXR1cm4gX3R5cGVvZihvYmopO30KCiAgICBmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7aWYgKGNhbGwgJiYgKF90eXBlb2YoY2FsbCkgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSkge3JldHVybiBjYWxsO31yZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKTt9CgogICAgZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7aWYgKHNlbGYgPT09IHZvaWQgMCkge3Rocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7fXJldHVybiBzZWxmO30KCiAgICBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2Yobykge19nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZiA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7cmV0dXJuIG8uX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihvKTt9O3JldHVybiBfZ2V0UHJvdG90eXBlT2Yobyk7fQoKICAgIGZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykge2lmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTt9c3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pO2lmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpO30KCiAgICBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkge19zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkge28uX19wcm90b19fID0gcDtyZXR1cm4gbzt9O3JldHVybiBfc2V0UHJvdG90eXBlT2YobywgcCk7fQoKICAgIGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHtpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpO319CgogICAgZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykge2ZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHt2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldO2Rlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTtkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7aWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7T2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpO319CgogICAgZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykge2lmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpO2lmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTtyZXR1cm4gQ29uc3RydWN0b3I7fQoKICAgIHZhciBCVUlMVF9JTl9DTUFQUyA9IFsiQWRvYmUtR0IxLVVDUzIiLCAiQWRvYmUtQ05TMS1VQ1MyIiwgIkFkb2JlLUphcGFuMS1VQ1MyIiwgIkFkb2JlLUtvcmVhMS1VQ1MyIiwgIjc4LUVVQy1IIiwgIjc4LUVVQy1WIiwgIjc4LUgiLCAiNzgtUktTSi1IIiwgIjc4LVJLU0otViIsICI3OC1WIiwgIjc4bXMtUktTSi1IIiwgIjc4bXMtUktTSi1WIiwgIjgzcHYtUktTSi1IIiwgIjkwbXMtUktTSi1IIiwgIjkwbXMtUktTSi1WIiwgIjkwbXNwLVJLU0otSCIsICI5MG1zcC1SS1NKLVYiLCAiOTBwdi1SS1NKLUgiLCAiOTBwdi1SS1NKLVYiLCAiQWRkLUgiLCAiQWRkLVJLU0otSCIsICJBZGQtUktTSi1WIiwgIkFkZC1WIiwgIkFkb2JlLUNOUzEtMCIsICJBZG9iZS1DTlMxLTEiLCAiQWRvYmUtQ05TMS0yIiwgIkFkb2JlLUNOUzEtMyIsICJBZG9iZS1DTlMxLTQiLCAiQWRvYmUtQ05TMS01IiwgIkFkb2JlLUNOUzEtNiIsICJBZG9iZS1HQjEtMCIsICJBZG9iZS1HQjEtMSIsICJBZG9iZS1HQjEtMiIsICJBZG9iZS1HQjEtMyIsICJBZG9iZS1HQjEtNCIsICJBZG9iZS1HQjEtNSIsICJBZG9iZS1KYXBhbjEtMCIsICJBZG9iZS1KYXBhbjEtMSIsICJBZG9iZS1KYXBhbjEtMiIsICJBZG9iZS1KYXBhbjEtMyIsICJBZG9iZS1KYXBhbjEtNCIsICJBZG9iZS1KYXBhbjEtNSIsICJBZG9iZS1KYXBhbjEtNiIsICJBZG9iZS1Lb3JlYTEtMCIsICJBZG9iZS1Lb3JlYTEtMSIsICJBZG9iZS1Lb3JlYTEtMiIsICJCNS1IIiwgIkI1LVYiLCAiQjVwYy1IIiwgIkI1cGMtViIsICJDTlMtRVVDLUgiLCAiQ05TLUVVQy1WIiwgIkNOUzEtSCIsICJDTlMxLVYiLCAiQ05TMi1IIiwgIkNOUzItViIsICJFVEhLLUI1LUgiLCAiRVRISy1CNS1WIiwgIkVUZW4tQjUtSCIsICJFVGVuLUI1LVYiLCAiRVRlbm1zLUI1LUgiLCAiRVRlbm1zLUI1LVYiLCAiRVVDLUgiLCAiRVVDLVYiLCAiRXh0LUgiLCAiRXh0LVJLU0otSCIsICJFeHQtUktTSi1WIiwgIkV4dC1WIiwgIkdCLUVVQy1IIiwgIkdCLUVVQy1WIiwgIkdCLUgiLCAiR0ItViIsICJHQkstRVVDLUgiLCAiR0JLLUVVQy1WIiwgIkdCSzJLLUgiLCAiR0JLMkstViIsICJHQktwLUVVQy1IIiwgIkdCS3AtRVVDLVYiLCAiR0JULUVVQy1IIiwgIkdCVC1FVUMtViIsICJHQlQtSCIsICJHQlQtViIsICJHQlRwYy1FVUMtSCIsICJHQlRwYy1FVUMtViIsICJHQnBjLUVVQy1IIiwgIkdCcGMtRVVDLVYiLCAiSCIsICJIS2RsYS1CNS1IIiwgIkhLZGxhLUI1LVYiLCAiSEtkbGItQjUtSCIsICJIS2RsYi1CNS1WIiwgIkhLZ2Njcy1CNS1IIiwgIkhLZ2Njcy1CNS1WIiwgIkhLbTMxNC1CNS1IIiwgIkhLbTMxNC1CNS1WIiwgIkhLbTQ3MS1CNS1IIiwgIkhLbTQ3MS1CNS1WIiwgIkhLc2NzLUI1LUgiLCAiSEtzY3MtQjUtViIsICJIYW5rYWt1IiwgIkhpcmFnYW5hIiwgIktTQy1FVUMtSCIsICJLU0MtRVVDLVYiLCAiS1NDLUgiLCAiS1NDLUpvaGFiLUgiLCAiS1NDLUpvaGFiLVYiLCAiS1NDLVYiLCAiS1NDbXMtVUhDLUgiLCAiS1NDbXMtVUhDLUhXLUgiLCAiS1NDbXMtVUhDLUhXLVYiLCAiS1NDbXMtVUhDLVYiLCAiS1NDcGMtRVVDLUgiLCAiS1NDcGMtRVVDLVYiLCAiS2F0YWthbmEiLCAiTldQLUgiLCAiTldQLVYiLCAiUktTSi1IIiwgIlJLU0otViIsICJSb21hbiIsICJVbmlDTlMtVUNTMi1IIiwgIlVuaUNOUy1VQ1MyLVYiLCAiVW5pQ05TLVVURjE2LUgiLCAiVW5pQ05TLVVURjE2LVYiLCAiVW5pQ05TLVVURjMyLUgiLCAiVW5pQ05TLVVURjMyLVYiLCAiVW5pQ05TLVVURjgtSCIsICJVbmlDTlMtVVRGOC1WIiwgIlVuaUdCLVVDUzItSCIsICJVbmlHQi1VQ1MyLVYiLCAiVW5pR0ItVVRGMTYtSCIsICJVbmlHQi1VVEYxNi1WIiwgIlVuaUdCLVVURjMyLUgiLCAiVW5pR0ItVVRGMzItViIsICJVbmlHQi1VVEY4LUgiLCAiVW5pR0ItVVRGOC1WIiwgIlVuaUpJUy1VQ1MyLUgiLCAiVW5pSklTLVVDUzItSFctSCIsICJVbmlKSVMtVUNTMi1IVy1WIiwgIlVuaUpJUy1VQ1MyLVYiLCAiVW5pSklTLVVURjE2LUgiLCAiVW5pSklTLVVURjE2LVYiLCAiVW5pSklTLVVURjMyLUgiLCAiVW5pSklTLVVURjMyLVYiLCAiVW5pSklTLVVURjgtSCIsICJVbmlKSVMtVVRGOC1WIiwgIlVuaUpJUzIwMDQtVVRGMTYtSCIsICJVbmlKSVMyMDA0LVVURjE2LVYiLCAiVW5pSklTMjAwNC1VVEYzMi1IIiwgIlVuaUpJUzIwMDQtVVRGMzItViIsICJVbmlKSVMyMDA0LVVURjgtSCIsICJVbmlKSVMyMDA0LVVURjgtViIsICJVbmlKSVNQcm8tVUNTMi1IVy1WIiwgIlVuaUpJU1Byby1VQ1MyLVYiLCAiVW5pSklTUHJvLVVURjgtViIsICJVbmlKSVNYMDIxMy1VVEYzMi1IIiwgIlVuaUpJU1gwMjEzLVVURjMyLVYiLCAiVW5pSklTWDAyMTMyMDA0LVVURjMyLUgiLCAiVW5pSklTWDAyMTMyMDA0LVVURjMyLVYiLCAiVW5pS1MtVUNTMi1IIiwgIlVuaUtTLVVDUzItViIsICJVbmlLUy1VVEYxNi1IIiwgIlVuaUtTLVVURjE2LVYiLCAiVW5pS1MtVVRGMzItSCIsICJVbmlLUy1VVEYzMi1WIiwgIlVuaUtTLVVURjgtSCIsICJVbmlLUy1VVEY4LVYiLCAiViIsICJXUC1TeW1ib2wiXTsKCiAgICB2YXIgQ01hcCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgIGZ1bmN0aW9uIENNYXAoKSB7CiAgICAgICAgdmFyIGJ1aWx0SW5DTWFwID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBmYWxzZTsKCiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIENNYXApOwoKICAgICAgICB0aGlzLmNvZGVzcGFjZVJhbmdlcyA9IFtbXSwgW10sIFtdLCBbXV07CiAgICAgICAgdGhpcy5udW1Db2Rlc3BhY2VSYW5nZXMgPSAwOwogICAgICAgIHRoaXMuX21hcCA9IFtdOwogICAgICAgIHRoaXMubmFtZSA9ICIiOwogICAgICAgIHRoaXMudmVydGljYWwgPSBmYWxzZTsKICAgICAgICB0aGlzLnVzZUNNYXAgPSBudWxsOwogICAgICAgIHRoaXMuYnVpbHRJbkNNYXAgPSBidWlsdEluQ01hcDsKICAgICAgfQoKICAgICAgX2NyZWF0ZUNsYXNzKENNYXAsIFt7CiAgICAgICAga2V5OiAiYWRkQ29kZXNwYWNlUmFuZ2UiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRDb2Rlc3BhY2VSYW5nZShuLCBsb3csIGhpZ2gpIHsKICAgICAgICAgIHRoaXMuY29kZXNwYWNlUmFuZ2VzW24gLSAxXS5wdXNoKGxvdywgaGlnaCk7CiAgICAgICAgICB0aGlzLm51bUNvZGVzcGFjZVJhbmdlcysrOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIm1hcENpZFJhbmdlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gbWFwQ2lkUmFuZ2UobG93LCBoaWdoLCBkc3RMb3cpIHsKICAgICAgICAgIHdoaWxlIChsb3cgPD0gaGlnaCkgewogICAgICAgICAgICB0aGlzLl9tYXBbbG93KytdID0gZHN0TG93Kys7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAibWFwQmZSYW5nZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIG1hcEJmUmFuZ2UobG93LCBoaWdoLCBkc3RMb3cpIHsKICAgICAgICAgIHZhciBsYXN0Qnl0ZSA9IGRzdExvdy5sZW5ndGggLSAxOwoKICAgICAgICAgIHdoaWxlIChsb3cgPD0gaGlnaCkgewogICAgICAgICAgICB0aGlzLl9tYXBbbG93KytdID0gZHN0TG93OwogICAgICAgICAgICBkc3RMb3cgPSBkc3RMb3cuc3Vic3RyaW5nKDAsIGxhc3RCeXRlKSArIFN0cmluZy5mcm9tQ2hhckNvZGUoZHN0TG93LmNoYXJDb2RlQXQobGFzdEJ5dGUpICsgMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAibWFwQmZSYW5nZVRvQXJyYXkiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBtYXBCZlJhbmdlVG9BcnJheShsb3csIGhpZ2gsIGFycmF5KSB7CiAgICAgICAgICB2YXIgaWkgPSBhcnJheS5sZW5ndGg7CiAgICAgICAgICB2YXIgaSA9IDA7CgogICAgICAgICAgd2hpbGUgKGxvdyA8PSBoaWdoICYmIGkgPCBpaSkgewogICAgICAgICAgICB0aGlzLl9tYXBbbG93XSA9IGFycmF5W2krK107CiAgICAgICAgICAgICsrbG93OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIm1hcE9uZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIG1hcE9uZShzcmMsIGRzdCkgewogICAgICAgICAgdGhpcy5fbWFwW3NyY10gPSBkc3Q7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAibG9va3VwIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gbG9va3VwKGNvZGUpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9tYXBbY29kZV07CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiY29udGFpbnMiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjb250YWlucyhjb2RlKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fbWFwW2NvZGVdICE9PSB1bmRlZmluZWQ7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZm9yRWFjaCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGZvckVhY2goY2FsbGJhY2spIHsKICAgICAgICAgIHZhciBtYXAgPSB0aGlzLl9tYXA7CiAgICAgICAgICB2YXIgbGVuZ3RoID0gbWFwLmxlbmd0aDsKCiAgICAgICAgICBpZiAobGVuZ3RoIDw9IDB4MTAwMDApIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIGlmIChtYXBbaV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgY2FsbGJhY2soaSwgbWFwW2ldKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGZvciAodmFyIF9pIGluIG1hcCkgewogICAgICAgICAgICAgIGNhbGxiYWNrKF9pLCBtYXBbX2ldKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImNoYXJDb2RlT2YiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjaGFyQ29kZU9mKHZhbHVlKSB7CiAgICAgICAgICB2YXIgbWFwID0gdGhpcy5fbWFwOwoKICAgICAgICAgIGlmIChtYXAubGVuZ3RoIDw9IDB4MTAwMDApIHsKICAgICAgICAgICAgcmV0dXJuIG1hcC5pbmRleE9mKHZhbHVlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3IgKHZhciBjaGFyQ29kZSBpbiBtYXApIHsKICAgICAgICAgICAgaWYgKG1hcFtjaGFyQ29kZV0gPT09IHZhbHVlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGNoYXJDb2RlIHwgMDsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJnZXRNYXAiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRNYXAoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fbWFwOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInJlYWRDaGFyQ29kZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlYWRDaGFyQ29kZShzdHIsIG9mZnNldCwgb3V0KSB7CiAgICAgICAgICB2YXIgYyA9IDA7CiAgICAgICAgICB2YXIgY29kZXNwYWNlUmFuZ2VzID0gdGhpcy5jb2Rlc3BhY2VSYW5nZXM7CgogICAgICAgICAgZm9yICh2YXIgbiA9IDAsIG5uID0gY29kZXNwYWNlUmFuZ2VzLmxlbmd0aDsgbiA8IG5uOyBuKyspIHsKICAgICAgICAgICAgYyA9IChjIDw8IDggfCBzdHIuY2hhckNvZGVBdChvZmZzZXQgKyBuKSkgPj4+IDA7CiAgICAgICAgICAgIHZhciBjb2Rlc3BhY2VSYW5nZSA9IGNvZGVzcGFjZVJhbmdlc1tuXTsKCiAgICAgICAgICAgIGZvciAodmFyIGsgPSAwLCBrayA9IGNvZGVzcGFjZVJhbmdlLmxlbmd0aDsgayA8IGtrOykgewogICAgICAgICAgICAgIHZhciBsb3cgPSBjb2Rlc3BhY2VSYW5nZVtrKytdOwogICAgICAgICAgICAgIHZhciBoaWdoID0gY29kZXNwYWNlUmFuZ2VbaysrXTsKCiAgICAgICAgICAgICAgaWYgKGMgPj0gbG93ICYmIGMgPD0gaGlnaCkgewogICAgICAgICAgICAgICAgb3V0LmNoYXJjb2RlID0gYzsKICAgICAgICAgICAgICAgIG91dC5sZW5ndGggPSBuICsgMTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBvdXQuY2hhcmNvZGUgPSAwOwogICAgICAgICAgb3V0Lmxlbmd0aCA9IDE7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAibGVuZ3RoIiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9tYXAubGVuZ3RoOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImlzSWRlbnRpdHlDTWFwIiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIGlmICghKHRoaXMubmFtZSA9PT0gIklkZW50aXR5LUgiIHx8IHRoaXMubmFtZSA9PT0gIklkZW50aXR5LVYiKSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRoaXMuX21hcC5sZW5ndGggIT09IDB4MTAwMDApIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMHgxMDAwMDsgaSsrKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9tYXBbaV0gIT09IGkpIHsKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBDTWFwOwogICAgfSgpOwoKICAgIGV4cG9ydHMuQ01hcCA9IENNYXA7CgogICAgdmFyIElkZW50aXR5Q01hcCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0NNYXApIHsKICAgICAgX2luaGVyaXRzKElkZW50aXR5Q01hcCwgX0NNYXApOwoKICAgICAgZnVuY3Rpb24gSWRlbnRpdHlDTWFwKHZlcnRpY2FsLCBuKSB7CiAgICAgICAgdmFyIF90aGlzOwoKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgSWRlbnRpdHlDTWFwKTsKCiAgICAgICAgX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoSWRlbnRpdHlDTWFwKS5jYWxsKHRoaXMpKTsKICAgICAgICBfdGhpcy52ZXJ0aWNhbCA9IHZlcnRpY2FsOwoKICAgICAgICBfdGhpcy5hZGRDb2Rlc3BhY2VSYW5nZShuLCAwLCAweGZmZmYpOwoKICAgICAgICByZXR1cm4gX3RoaXM7CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhJZGVudGl0eUNNYXAsIFt7CiAgICAgICAga2V5OiAibWFwQ2lkUmFuZ2UiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBtYXBDaWRSYW5nZShsb3csIGhpZ2gsIGRzdExvdykgewogICAgICAgICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgic2hvdWxkIG5vdCBjYWxsIG1hcENpZFJhbmdlIik7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAibWFwQmZSYW5nZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIG1hcEJmUmFuZ2UobG93LCBoaWdoLCBkc3RMb3cpIHsKICAgICAgICAgICgwLCBfdXRpbC51bnJlYWNoYWJsZSkoInNob3VsZCBub3QgY2FsbCBtYXBCZlJhbmdlIik7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAibWFwQmZSYW5nZVRvQXJyYXkiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBtYXBCZlJhbmdlVG9BcnJheShsb3csIGhpZ2gsIGFycmF5KSB7CiAgICAgICAgICAoMCwgX3V0aWwudW5yZWFjaGFibGUpKCJzaG91bGQgbm90IGNhbGwgbWFwQmZSYW5nZVRvQXJyYXkiKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJtYXBPbmUiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBtYXBPbmUoc3JjLCBkc3QpIHsKICAgICAgICAgICgwLCBfdXRpbC51bnJlYWNoYWJsZSkoInNob3VsZCBub3QgY2FsbCBtYXBDaWRPbmUiKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJsb29rdXAiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBsb29rdXAoY29kZSkgewogICAgICAgICAgcmV0dXJuIE51bWJlci5pc0ludGVnZXIoY29kZSkgJiYgY29kZSA8PSAweGZmZmYgPyBjb2RlIDogdW5kZWZpbmVkOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImNvbnRhaW5zIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY29udGFpbnMoY29kZSkgewogICAgICAgICAgcmV0dXJuIE51bWJlci5pc0ludGVnZXIoY29kZSkgJiYgY29kZSA8PSAweGZmZmY7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZm9yRWFjaCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGZvckVhY2goY2FsbGJhY2spIHsKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDw9IDB4ZmZmZjsgaSsrKSB7CiAgICAgICAgICAgIGNhbGxiYWNrKGksIGkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImNoYXJDb2RlT2YiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjaGFyQ29kZU9mKHZhbHVlKSB7CiAgICAgICAgICByZXR1cm4gTnVtYmVyLmlzSW50ZWdlcih2YWx1ZSkgJiYgdmFsdWUgPD0gMHhmZmZmID8gdmFsdWUgOiAtMTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJnZXRNYXAiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRNYXAoKSB7CiAgICAgICAgICB2YXIgbWFwID0gbmV3IEFycmF5KDB4MTAwMDApOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDw9IDB4ZmZmZjsgaSsrKSB7CiAgICAgICAgICAgIG1hcFtpXSA9IGk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIG1hcDsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJsZW5ndGgiLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuIDB4MTAwMDA7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiaXNJZGVudGl0eUNNYXAiLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgic2hvdWxkIG5vdCBhY2Nlc3MgLmlzSWRlbnRpdHlDTWFwIik7CiAgICAgICAgfQogICAgICB9XSk7CgogICAgICByZXR1cm4gSWRlbnRpdHlDTWFwOwogICAgfShDTWFwKTsKCiAgICBleHBvcnRzLklkZW50aXR5Q01hcCA9IElkZW50aXR5Q01hcDsKCiAgICB2YXIgQmluYXJ5Q01hcFJlYWRlciA9IGZ1bmN0aW9uIEJpbmFyeUNNYXBSZWFkZXJDbG9zdXJlKCkgewogICAgICBmdW5jdGlvbiBoZXhUb0ludChhLCBzaXplKSB7CiAgICAgICAgdmFyIG4gPSAwOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8PSBzaXplOyBpKyspIHsKICAgICAgICAgIG4gPSBuIDw8IDggfCBhW2ldOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG4gPj4+IDA7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGhleFRvU3RyKGEsIHNpemUpIHsKICAgICAgICBpZiAoc2l6ZSA9PT0gMSkgewogICAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoYVswXSwgYVsxXSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2l6ZSA9PT0gMykgewogICAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoYVswXSwgYVsxXSwgYVsyXSwgYVszXSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCBhLnN1YmFycmF5KDAsIHNpemUgKyAxKSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGFkZEhleChhLCBiLCBzaXplKSB7CiAgICAgICAgdmFyIGMgPSAwOwoKICAgICAgICBmb3IgKHZhciBpID0gc2l6ZTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgIGMgKz0gYVtpXSArIGJbaV07CiAgICAgICAgICBhW2ldID0gYyAmIDI1NTsKICAgICAgICAgIGMgPj49IDg7CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBpbmNIZXgoYSwgc2l6ZSkgewogICAgICAgIHZhciBjID0gMTsKCiAgICAgICAgZm9yICh2YXIgaSA9IHNpemU7IGkgPj0gMCAmJiBjID4gMDsgaS0tKSB7CiAgICAgICAgICBjICs9IGFbaV07CiAgICAgICAgICBhW2ldID0gYyAmIDI1NTsKICAgICAgICAgIGMgPj49IDg7CiAgICAgICAgfQogICAgICB9CgogICAgICB2YXIgTUFYX05VTV9TSVpFID0gMTY7CiAgICAgIHZhciBNQVhfRU5DT0RFRF9OVU1fU0laRSA9IDE5OwoKICAgICAgZnVuY3Rpb24gQmluYXJ5Q01hcFN0cmVhbShkYXRhKSB7CiAgICAgICAgdGhpcy5idWZmZXIgPSBkYXRhOwogICAgICAgIHRoaXMucG9zID0gMDsKICAgICAgICB0aGlzLmVuZCA9IGRhdGEubGVuZ3RoOwogICAgICAgIHRoaXMudG1wQnVmID0gbmV3IFVpbnQ4QXJyYXkoTUFYX0VOQ09ERURfTlVNX1NJWkUpOwogICAgICB9CgogICAgICBCaW5hcnlDTWFwU3RyZWFtLnByb3RvdHlwZSA9IHsKICAgICAgICByZWFkQnl0ZTogZnVuY3Rpb24gcmVhZEJ5dGUoKSB7CiAgICAgICAgICBpZiAodGhpcy5wb3MgPj0gdGhpcy5lbmQpIHsKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB0aGlzLmJ1ZmZlclt0aGlzLnBvcysrXTsKICAgICAgICB9LAogICAgICAgIHJlYWROdW1iZXI6IGZ1bmN0aW9uIHJlYWROdW1iZXIoKSB7CiAgICAgICAgICB2YXIgbiA9IDA7CiAgICAgICAgICB2YXIgbGFzdDsKCiAgICAgICAgICBkbyB7CiAgICAgICAgICAgIHZhciBiID0gdGhpcy5yZWFkQnl0ZSgpOwoKICAgICAgICAgICAgaWYgKGIgPCAwKSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJ1bmV4cGVjdGVkIEVPRiBpbiBiY21hcCIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsYXN0ID0gIShiICYgMHg4MCk7CiAgICAgICAgICAgIG4gPSBuIDw8IDcgfCBiICYgMHg3ZjsKICAgICAgICAgIH0gd2hpbGUgKCFsYXN0KTsKCiAgICAgICAgICByZXR1cm4gbjsKICAgICAgICB9LAogICAgICAgIHJlYWRTaWduZWQ6IGZ1bmN0aW9uIHJlYWRTaWduZWQoKSB7CiAgICAgICAgICB2YXIgbiA9IHRoaXMucmVhZE51bWJlcigpOwogICAgICAgICAgcmV0dXJuIG4gJiAxID8gfihuID4+PiAxKSA6IG4gPj4+IDE7CiAgICAgICAgfSwKICAgICAgICByZWFkSGV4OiBmdW5jdGlvbiByZWFkSGV4KG51bSwgc2l6ZSkgewogICAgICAgICAgbnVtLnNldCh0aGlzLmJ1ZmZlci5zdWJhcnJheSh0aGlzLnBvcywgdGhpcy5wb3MgKyBzaXplICsgMSkpOwogICAgICAgICAgdGhpcy5wb3MgKz0gc2l6ZSArIDE7CiAgICAgICAgfSwKICAgICAgICByZWFkSGV4TnVtYmVyOiBmdW5jdGlvbiByZWFkSGV4TnVtYmVyKG51bSwgc2l6ZSkgewogICAgICAgICAgdmFyIGxhc3Q7CiAgICAgICAgICB2YXIgc3RhY2sgPSB0aGlzLnRtcEJ1ZiwKICAgICAgICAgICAgc3AgPSAwOwoKICAgICAgICAgIGRvIHsKICAgICAgICAgICAgdmFyIGIgPSB0aGlzLnJlYWRCeXRlKCk7CgogICAgICAgICAgICBpZiAoYiA8IDApIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoInVuZXhwZWN0ZWQgRU9GIGluIGJjbWFwIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxhc3QgPSAhKGIgJiAweDgwKTsKICAgICAgICAgICAgc3RhY2tbc3ArK10gPSBiICYgMHg3ZjsKICAgICAgICAgIH0gd2hpbGUgKCFsYXN0KTsKCiAgICAgICAgICB2YXIgaSA9IHNpemUsCiAgICAgICAgICAgIGJ1ZmZlciA9IDAsCiAgICAgICAgICAgIGJ1ZmZlclNpemUgPSAwOwoKICAgICAgICAgIHdoaWxlIChpID49IDApIHsKICAgICAgICAgICAgd2hpbGUgKGJ1ZmZlclNpemUgPCA4ICYmIHN0YWNrLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICBidWZmZXIgPSBzdGFja1stLXNwXSA8PCBidWZmZXJTaXplIHwgYnVmZmVyOwogICAgICAgICAgICAgIGJ1ZmZlclNpemUgKz0gNzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbnVtW2ldID0gYnVmZmVyICYgMjU1OwogICAgICAgICAgICBpLS07CiAgICAgICAgICAgIGJ1ZmZlciA+Pj0gODsKICAgICAgICAgICAgYnVmZmVyU2l6ZSAtPSA4OwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgcmVhZEhleFNpZ25lZDogZnVuY3Rpb24gcmVhZEhleFNpZ25lZChudW0sIHNpemUpIHsKICAgICAgICAgIHRoaXMucmVhZEhleE51bWJlcihudW0sIHNpemUpOwogICAgICAgICAgdmFyIHNpZ24gPSBudW1bc2l6ZV0gJiAxID8gMjU1IDogMDsKICAgICAgICAgIHZhciBjID0gMDsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8PSBzaXplOyBpKyspIHsKICAgICAgICAgICAgYyA9IChjICYgMSkgPDwgOCB8IG51bVtpXTsKICAgICAgICAgICAgbnVtW2ldID0gYyA+PiAxIF4gc2lnbjsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHJlYWRTdHJpbmc6IGZ1bmN0aW9uIHJlYWRTdHJpbmcoKSB7CiAgICAgICAgICB2YXIgbGVuID0gdGhpcy5yZWFkTnVtYmVyKCk7CiAgICAgICAgICB2YXIgcyA9ICIiOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgcyArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHRoaXMucmVhZE51bWJlcigpKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gczsKICAgICAgICB9CiAgICAgIH07CgogICAgICBmdW5jdGlvbiBwcm9jZXNzQmluYXJ5Q01hcChkYXRhLCBjTWFwLCBleHRlbmQpIHsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgdmFyIHN0cmVhbSA9IG5ldyBCaW5hcnlDTWFwU3RyZWFtKGRhdGEpOwogICAgICAgICAgdmFyIGhlYWRlciA9IHN0cmVhbS5yZWFkQnl0ZSgpOwogICAgICAgICAgY01hcC52ZXJ0aWNhbCA9ICEhKGhlYWRlciAmIDEpOwogICAgICAgICAgdmFyIHVzZUNNYXAgPSBudWxsOwogICAgICAgICAgdmFyIHN0YXJ0ID0gbmV3IFVpbnQ4QXJyYXkoTUFYX05VTV9TSVpFKTsKICAgICAgICAgIHZhciBlbmQgPSBuZXcgVWludDhBcnJheShNQVhfTlVNX1NJWkUpOwoKICAgICAgICAgIHZhciBfY2hhciA9IG5ldyBVaW50OEFycmF5KE1BWF9OVU1fU0laRSk7CgogICAgICAgICAgdmFyIGNoYXJDb2RlID0gbmV3IFVpbnQ4QXJyYXkoTUFYX05VTV9TSVpFKTsKICAgICAgICAgIHZhciB0bXAgPSBuZXcgVWludDhBcnJheShNQVhfTlVNX1NJWkUpOwogICAgICAgICAgdmFyIGNvZGU7CiAgICAgICAgICB2YXIgYjsKCiAgICAgICAgICB3aGlsZSAoKGIgPSBzdHJlYW0ucmVhZEJ5dGUoKSkgPj0gMCkgewogICAgICAgICAgICB2YXIgdHlwZSA9IGIgPj4gNTsKCiAgICAgICAgICAgIGlmICh0eXBlID09PSA3KSB7CiAgICAgICAgICAgICAgc3dpdGNoIChiICYgMHgxZikgewogICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICBzdHJlYW0ucmVhZFN0cmluZygpOwogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgIHVzZUNNYXAgPSBzdHJlYW0ucmVhZFN0cmluZygpOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgc2VxdWVuY2UgPSAhIShiICYgMHgxMCk7CiAgICAgICAgICAgIHZhciBkYXRhU2l6ZSA9IGIgJiAxNTsKCiAgICAgICAgICAgIGlmIChkYXRhU2l6ZSArIDEgPiBNQVhfTlVNX1NJWkUpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoInByb2Nlc3NCaW5hcnlDTWFwOiBJbnZhbGlkIGRhdGFTaXplLiIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgdWNzMkRhdGFTaXplID0gMTsKICAgICAgICAgICAgdmFyIHN1Yml0ZW1zQ291bnQgPSBzdHJlYW0ucmVhZE51bWJlcigpOwogICAgICAgICAgICB2YXIgaTsKCiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHN0cmVhbS5yZWFkSGV4KHN0YXJ0LCBkYXRhU2l6ZSk7CiAgICAgICAgICAgICAgICBzdHJlYW0ucmVhZEhleE51bWJlcihlbmQsIGRhdGFTaXplKTsKICAgICAgICAgICAgICAgIGFkZEhleChlbmQsIHN0YXJ0LCBkYXRhU2l6ZSk7CiAgICAgICAgICAgICAgICBjTWFwLmFkZENvZGVzcGFjZVJhbmdlKGRhdGFTaXplICsgMSwgaGV4VG9JbnQoc3RhcnQsIGRhdGFTaXplKSwgaGV4VG9JbnQoZW5kLCBkYXRhU2l6ZSkpOwoKICAgICAgICAgICAgICAgIGZvciAoaSA9IDE7IGkgPCBzdWJpdGVtc0NvdW50OyBpKyspIHsKICAgICAgICAgICAgICAgICAgaW5jSGV4KGVuZCwgZGF0YVNpemUpOwogICAgICAgICAgICAgICAgICBzdHJlYW0ucmVhZEhleE51bWJlcihzdGFydCwgZGF0YVNpemUpOwogICAgICAgICAgICAgICAgICBhZGRIZXgoc3RhcnQsIGVuZCwgZGF0YVNpemUpOwogICAgICAgICAgICAgICAgICBzdHJlYW0ucmVhZEhleE51bWJlcihlbmQsIGRhdGFTaXplKTsKICAgICAgICAgICAgICAgICAgYWRkSGV4KGVuZCwgc3RhcnQsIGRhdGFTaXplKTsKICAgICAgICAgICAgICAgICAgY01hcC5hZGRDb2Rlc3BhY2VSYW5nZShkYXRhU2l6ZSArIDEsIGhleFRvSW50KHN0YXJ0LCBkYXRhU2l6ZSksIGhleFRvSW50KGVuZCwgZGF0YVNpemUpKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgc3RyZWFtLnJlYWRIZXgoc3RhcnQsIGRhdGFTaXplKTsKICAgICAgICAgICAgICAgIHN0cmVhbS5yZWFkSGV4TnVtYmVyKGVuZCwgZGF0YVNpemUpOwogICAgICAgICAgICAgICAgYWRkSGV4KGVuZCwgc3RhcnQsIGRhdGFTaXplKTsKICAgICAgICAgICAgICAgIHN0cmVhbS5yZWFkTnVtYmVyKCk7CgogICAgICAgICAgICAgICAgZm9yIChpID0gMTsgaSA8IHN1Yml0ZW1zQ291bnQ7IGkrKykgewogICAgICAgICAgICAgICAgICBpbmNIZXgoZW5kLCBkYXRhU2l6ZSk7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5yZWFkSGV4TnVtYmVyKHN0YXJ0LCBkYXRhU2l6ZSk7CiAgICAgICAgICAgICAgICAgIGFkZEhleChzdGFydCwgZW5kLCBkYXRhU2l6ZSk7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5yZWFkSGV4TnVtYmVyKGVuZCwgZGF0YVNpemUpOwogICAgICAgICAgICAgICAgICBhZGRIZXgoZW5kLCBzdGFydCwgZGF0YVNpemUpOwogICAgICAgICAgICAgICAgICBzdHJlYW0ucmVhZE51bWJlcigpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBzdHJlYW0ucmVhZEhleChfY2hhciwgZGF0YVNpemUpOwogICAgICAgICAgICAgICAgY29kZSA9IHN0cmVhbS5yZWFkTnVtYmVyKCk7CiAgICAgICAgICAgICAgICBjTWFwLm1hcE9uZShoZXhUb0ludChfY2hhciwgZGF0YVNpemUpLCBjb2RlKTsKCiAgICAgICAgICAgICAgICBmb3IgKGkgPSAxOyBpIDwgc3ViaXRlbXNDb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgIGluY0hleChfY2hhciwgZGF0YVNpemUpOwoKICAgICAgICAgICAgICAgICAgaWYgKCFzZXF1ZW5jZSkgewogICAgICAgICAgICAgICAgICAgIHN0cmVhbS5yZWFkSGV4TnVtYmVyKHRtcCwgZGF0YVNpemUpOwogICAgICAgICAgICAgICAgICAgIGFkZEhleChfY2hhciwgdG1wLCBkYXRhU2l6ZSk7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGNvZGUgPSBzdHJlYW0ucmVhZFNpZ25lZCgpICsgKGNvZGUgKyAxKTsKICAgICAgICAgICAgICAgICAgY01hcC5tYXBPbmUoaGV4VG9JbnQoX2NoYXIsIGRhdGFTaXplKSwgY29kZSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIHN0cmVhbS5yZWFkSGV4KHN0YXJ0LCBkYXRhU2l6ZSk7CiAgICAgICAgICAgICAgICBzdHJlYW0ucmVhZEhleE51bWJlcihlbmQsIGRhdGFTaXplKTsKICAgICAgICAgICAgICAgIGFkZEhleChlbmQsIHN0YXJ0LCBkYXRhU2l6ZSk7CiAgICAgICAgICAgICAgICBjb2RlID0gc3RyZWFtLnJlYWROdW1iZXIoKTsKICAgICAgICAgICAgICAgIGNNYXAubWFwQ2lkUmFuZ2UoaGV4VG9JbnQoc3RhcnQsIGRhdGFTaXplKSwgaGV4VG9JbnQoZW5kLCBkYXRhU2l6ZSksIGNvZGUpOwoKICAgICAgICAgICAgICAgIGZvciAoaSA9IDE7IGkgPCBzdWJpdGVtc0NvdW50OyBpKyspIHsKICAgICAgICAgICAgICAgICAgaW5jSGV4KGVuZCwgZGF0YVNpemUpOwoKICAgICAgICAgICAgICAgICAgaWYgKCFzZXF1ZW5jZSkgewogICAgICAgICAgICAgICAgICAgIHN0cmVhbS5yZWFkSGV4TnVtYmVyKHN0YXJ0LCBkYXRhU2l6ZSk7CiAgICAgICAgICAgICAgICAgICAgYWRkSGV4KHN0YXJ0LCBlbmQsIGRhdGFTaXplKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzdGFydC5zZXQoZW5kKTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgc3RyZWFtLnJlYWRIZXhOdW1iZXIoZW5kLCBkYXRhU2l6ZSk7CiAgICAgICAgICAgICAgICAgIGFkZEhleChlbmQsIHN0YXJ0LCBkYXRhU2l6ZSk7CiAgICAgICAgICAgICAgICAgIGNvZGUgPSBzdHJlYW0ucmVhZE51bWJlcigpOwogICAgICAgICAgICAgICAgICBjTWFwLm1hcENpZFJhbmdlKGhleFRvSW50KHN0YXJ0LCBkYXRhU2l6ZSksIGhleFRvSW50KGVuZCwgZGF0YVNpemUpLCBjb2RlKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgc3RyZWFtLnJlYWRIZXgoX2NoYXIsIHVjczJEYXRhU2l6ZSk7CiAgICAgICAgICAgICAgICBzdHJlYW0ucmVhZEhleChjaGFyQ29kZSwgZGF0YVNpemUpOwogICAgICAgICAgICAgICAgY01hcC5tYXBPbmUoaGV4VG9JbnQoX2NoYXIsIHVjczJEYXRhU2l6ZSksIGhleFRvU3RyKGNoYXJDb2RlLCBkYXRhU2l6ZSkpOwoKICAgICAgICAgICAgICAgIGZvciAoaSA9IDE7IGkgPCBzdWJpdGVtc0NvdW50OyBpKyspIHsKICAgICAgICAgICAgICAgICAgaW5jSGV4KF9jaGFyLCB1Y3MyRGF0YVNpemUpOwoKICAgICAgICAgICAgICAgICAgaWYgKCFzZXF1ZW5jZSkgewogICAgICAgICAgICAgICAgICAgIHN0cmVhbS5yZWFkSGV4TnVtYmVyKHRtcCwgdWNzMkRhdGFTaXplKTsKICAgICAgICAgICAgICAgICAgICBhZGRIZXgoX2NoYXIsIHRtcCwgdWNzMkRhdGFTaXplKTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgaW5jSGV4KGNoYXJDb2RlLCBkYXRhU2l6ZSk7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5yZWFkSGV4U2lnbmVkKHRtcCwgZGF0YVNpemUpOwogICAgICAgICAgICAgICAgICBhZGRIZXgoY2hhckNvZGUsIHRtcCwgZGF0YVNpemUpOwogICAgICAgICAgICAgICAgICBjTWFwLm1hcE9uZShoZXhUb0ludChfY2hhciwgdWNzMkRhdGFTaXplKSwgaGV4VG9TdHIoY2hhckNvZGUsIGRhdGFTaXplKSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIHN0cmVhbS5yZWFkSGV4KHN0YXJ0LCB1Y3MyRGF0YVNpemUpOwogICAgICAgICAgICAgICAgc3RyZWFtLnJlYWRIZXhOdW1iZXIoZW5kLCB1Y3MyRGF0YVNpemUpOwogICAgICAgICAgICAgICAgYWRkSGV4KGVuZCwgc3RhcnQsIHVjczJEYXRhU2l6ZSk7CiAgICAgICAgICAgICAgICBzdHJlYW0ucmVhZEhleChjaGFyQ29kZSwgZGF0YVNpemUpOwogICAgICAgICAgICAgICAgY01hcC5tYXBCZlJhbmdlKGhleFRvSW50KHN0YXJ0LCB1Y3MyRGF0YVNpemUpLCBoZXhUb0ludChlbmQsIHVjczJEYXRhU2l6ZSksIGhleFRvU3RyKGNoYXJDb2RlLCBkYXRhU2l6ZSkpOwoKICAgICAgICAgICAgICAgIGZvciAoaSA9IDE7IGkgPCBzdWJpdGVtc0NvdW50OyBpKyspIHsKICAgICAgICAgICAgICAgICAgaW5jSGV4KGVuZCwgdWNzMkRhdGFTaXplKTsKCiAgICAgICAgICAgICAgICAgIGlmICghc2VxdWVuY2UpIHsKICAgICAgICAgICAgICAgICAgICBzdHJlYW0ucmVhZEhleE51bWJlcihzdGFydCwgdWNzMkRhdGFTaXplKTsKICAgICAgICAgICAgICAgICAgICBhZGRIZXgoc3RhcnQsIGVuZCwgdWNzMkRhdGFTaXplKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzdGFydC5zZXQoZW5kKTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgc3RyZWFtLnJlYWRIZXhOdW1iZXIoZW5kLCB1Y3MyRGF0YVNpemUpOwogICAgICAgICAgICAgICAgICBhZGRIZXgoZW5kLCBzdGFydCwgdWNzMkRhdGFTaXplKTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLnJlYWRIZXgoY2hhckNvZGUsIGRhdGFTaXplKTsKICAgICAgICAgICAgICAgICAgY01hcC5tYXBCZlJhbmdlKGhleFRvSW50KHN0YXJ0LCB1Y3MyRGF0YVNpemUpLCBoZXhUb0ludChlbmQsIHVjczJEYXRhU2l6ZSksIGhleFRvU3RyKGNoYXJDb2RlLCBkYXRhU2l6ZSkpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcigicHJvY2Vzc0JpbmFyeUNNYXA6IFVua25vd24gdHlwZTogIiArIHR5cGUpKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmICh1c2VDTWFwKSB7CiAgICAgICAgICAgIHJlc29sdmUoZXh0ZW5kKHVzZUNNYXApKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHJlc29sdmUoY01hcCk7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIEJpbmFyeUNNYXBSZWFkZXIoKSB7fQoKICAgICAgQmluYXJ5Q01hcFJlYWRlci5wcm90b3R5cGUgPSB7CiAgICAgICAgcHJvY2VzczogcHJvY2Vzc0JpbmFyeUNNYXAKICAgICAgfTsKICAgICAgcmV0dXJuIEJpbmFyeUNNYXBSZWFkZXI7CiAgICB9KCk7CgogICAgdmFyIENNYXBGYWN0b3J5ID0gZnVuY3Rpb24gQ01hcEZhY3RvcnlDbG9zdXJlKCkgewogICAgICBmdW5jdGlvbiBzdHJUb0ludChzdHIpIHsKICAgICAgICB2YXIgYSA9IDA7CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBhID0gYSA8PCA4IHwgc3RyLmNoYXJDb2RlQXQoaSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYSA+Pj4gMDsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZXhwZWN0U3RyaW5nKG9iaikgewogICAgICAgIGlmICghKDAsIF91dGlsLmlzU3RyaW5nKShvYmopKSB7CiAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIk1hbGZvcm1lZCBDTWFwOiBleHBlY3RlZCBzdHJpbmcuIik7CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBleHBlY3RJbnQob2JqKSB7CiAgICAgICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKG9iaikpIHsKICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiTWFsZm9ybWVkIENNYXA6IGV4cGVjdGVkIGludC4iKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHBhcnNlQmZDaGFyKGNNYXAsIGxleGVyKSB7CiAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgIHZhciBvYmogPSBsZXhlci5nZXRPYmooKTsKCiAgICAgICAgICBpZiAoKDAsIF9wcmltaXRpdmVzLmlzRU9GKShvYmopKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNDbWQpKG9iaiwgImVuZGJmY2hhciIpKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBleHBlY3RTdHJpbmcob2JqKTsKICAgICAgICAgIHZhciBzcmMgPSBzdHJUb0ludChvYmopOwogICAgICAgICAgb2JqID0gbGV4ZXIuZ2V0T2JqKCk7CiAgICAgICAgICBleHBlY3RTdHJpbmcob2JqKTsKICAgICAgICAgIHZhciBkc3QgPSBvYmo7CiAgICAgICAgICBjTWFwLm1hcE9uZShzcmMsIGRzdCk7CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBwYXJzZUJmUmFuZ2UoY01hcCwgbGV4ZXIpIHsKICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgdmFyIG9iaiA9IGxleGVyLmdldE9iaigpOwoKICAgICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNFT0YpKG9iaikpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc0NtZCkob2JqLCAiZW5kYmZyYW5nZSIpKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBleHBlY3RTdHJpbmcob2JqKTsKICAgICAgICAgIHZhciBsb3cgPSBzdHJUb0ludChvYmopOwogICAgICAgICAgb2JqID0gbGV4ZXIuZ2V0T2JqKCk7CiAgICAgICAgICBleHBlY3RTdHJpbmcob2JqKTsKICAgICAgICAgIHZhciBoaWdoID0gc3RyVG9JbnQob2JqKTsKICAgICAgICAgIG9iaiA9IGxleGVyLmdldE9iaigpOwoKICAgICAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKG9iaikgfHwgKDAsIF91dGlsLmlzU3RyaW5nKShvYmopKSB7CiAgICAgICAgICAgIHZhciBkc3RMb3cgPSBOdW1iZXIuaXNJbnRlZ2VyKG9iaikgPyBTdHJpbmcuZnJvbUNoYXJDb2RlKG9iaikgOiBvYmo7CiAgICAgICAgICAgIGNNYXAubWFwQmZSYW5nZShsb3csIGhpZ2gsIGRzdExvdyk7CiAgICAgICAgICB9IGVsc2UgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc0NtZCkob2JqLCAiWyIpKSB7CiAgICAgICAgICAgIG9iaiA9IGxleGVyLmdldE9iaigpOwogICAgICAgICAgICB2YXIgYXJyYXkgPSBbXTsKCiAgICAgICAgICAgIHdoaWxlICghKDAsIF9wcmltaXRpdmVzLmlzQ21kKShvYmosICJdIikgJiYgISgwLCBfcHJpbWl0aXZlcy5pc0VPRikob2JqKSkgewogICAgICAgICAgICAgIGFycmF5LnB1c2gob2JqKTsKICAgICAgICAgICAgICBvYmogPSBsZXhlci5nZXRPYmooKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY01hcC5tYXBCZlJhbmdlVG9BcnJheShsb3csIGhpZ2gsIGFycmF5KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJJbnZhbGlkIGJmIHJhbmdlLiIpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBwYXJzZUNpZENoYXIoY01hcCwgbGV4ZXIpIHsKICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgdmFyIG9iaiA9IGxleGVyLmdldE9iaigpOwoKICAgICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNFT0YpKG9iaikpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc0NtZCkob2JqLCAiZW5kY2lkY2hhciIpKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBleHBlY3RTdHJpbmcob2JqKTsKICAgICAgICAgIHZhciBzcmMgPSBzdHJUb0ludChvYmopOwogICAgICAgICAgb2JqID0gbGV4ZXIuZ2V0T2JqKCk7CiAgICAgICAgICBleHBlY3RJbnQob2JqKTsKICAgICAgICAgIHZhciBkc3QgPSBvYmo7CiAgICAgICAgICBjTWFwLm1hcE9uZShzcmMsIGRzdCk7CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBwYXJzZUNpZFJhbmdlKGNNYXAsIGxleGVyKSB7CiAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgIHZhciBvYmogPSBsZXhlci5nZXRPYmooKTsKCiAgICAgICAgICBpZiAoKDAsIF9wcmltaXRpdmVzLmlzRU9GKShvYmopKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNDbWQpKG9iaiwgImVuZGNpZHJhbmdlIikpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGV4cGVjdFN0cmluZyhvYmopOwogICAgICAgICAgdmFyIGxvdyA9IHN0clRvSW50KG9iaik7CiAgICAgICAgICBvYmogPSBsZXhlci5nZXRPYmooKTsKICAgICAgICAgIGV4cGVjdFN0cmluZyhvYmopOwogICAgICAgICAgdmFyIGhpZ2ggPSBzdHJUb0ludChvYmopOwogICAgICAgICAgb2JqID0gbGV4ZXIuZ2V0T2JqKCk7CiAgICAgICAgICBleHBlY3RJbnQob2JqKTsKICAgICAgICAgIHZhciBkc3RMb3cgPSBvYmo7CiAgICAgICAgICBjTWFwLm1hcENpZFJhbmdlKGxvdywgaGlnaCwgZHN0TG93KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHBhcnNlQ29kZXNwYWNlUmFuZ2UoY01hcCwgbGV4ZXIpIHsKICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgdmFyIG9iaiA9IGxleGVyLmdldE9iaigpOwoKICAgICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNFT0YpKG9iaikpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc0NtZCkob2JqLCAiZW5kY29kZXNwYWNlcmFuZ2UiKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCEoMCwgX3V0aWwuaXNTdHJpbmcpKG9iaikpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGxvdyA9IHN0clRvSW50KG9iaik7CiAgICAgICAgICBvYmogPSBsZXhlci5nZXRPYmooKTsKCiAgICAgICAgICBpZiAoISgwLCBfdXRpbC5pc1N0cmluZykob2JqKSkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgaGlnaCA9IHN0clRvSW50KG9iaik7CiAgICAgICAgICBjTWFwLmFkZENvZGVzcGFjZVJhbmdlKG9iai5sZW5ndGgsIGxvdywgaGlnaCk7CiAgICAgICAgfQoKICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkludmFsaWQgY29kZXNwYWNlIHJhbmdlLiIpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBwYXJzZVdNb2RlKGNNYXAsIGxleGVyKSB7CiAgICAgICAgdmFyIG9iaiA9IGxleGVyLmdldE9iaigpOwoKICAgICAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihvYmopKSB7CiAgICAgICAgICBjTWFwLnZlcnRpY2FsID0gISFvYmo7CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBwYXJzZUNNYXBOYW1lKGNNYXAsIGxleGVyKSB7CiAgICAgICAgdmFyIG9iaiA9IGxleGVyLmdldE9iaigpOwoKICAgICAgICBpZiAoKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkob2JqKSAmJiAoMCwgX3V0aWwuaXNTdHJpbmcpKG9iai5uYW1lKSkgewogICAgICAgICAgY01hcC5uYW1lID0gb2JqLm5hbWU7CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBwYXJzZUNNYXAoY01hcCwgbGV4ZXIsIGZldGNoQnVpbHRJbkNNYXAsIHVzZUNNYXApIHsKICAgICAgICB2YXIgcHJldmlvdXM7CiAgICAgICAgdmFyIGVtYmVkZGVkVXNlQ01hcDsKCiAgICAgICAgb2JqTG9vcDogd2hpbGUgKHRydWUpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHZhciBvYmogPSBsZXhlci5nZXRPYmooKTsKCiAgICAgICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNFT0YpKG9iaikpIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfSBlbHNlIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNOYW1lKShvYmopKSB7CiAgICAgICAgICAgICAgaWYgKG9iai5uYW1lID09PSAiV01vZGUiKSB7CiAgICAgICAgICAgICAgICBwYXJzZVdNb2RlKGNNYXAsIGxleGVyKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9iai5uYW1lID09PSAiQ01hcE5hbWUiKSB7CiAgICAgICAgICAgICAgICBwYXJzZUNNYXBOYW1lKGNNYXAsIGxleGVyKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHByZXZpb3VzID0gb2JqOwogICAgICAgICAgICB9IGVsc2UgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc0NtZCkob2JqKSkgewogICAgICAgICAgICAgIHN3aXRjaCAob2JqLmNtZCkgewogICAgICAgICAgICAgICAgY2FzZSAiZW5kY21hcCI6CiAgICAgICAgICAgICAgICAgIGJyZWFrIG9iakxvb3A7CgogICAgICAgICAgICAgICAgY2FzZSAidXNlY21hcCI6CiAgICAgICAgICAgICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNOYW1lKShwcmV2aW91cykpIHsKICAgICAgICAgICAgICAgICAgICBlbWJlZGRlZFVzZUNNYXAgPSBwcmV2aW91cy5uYW1lOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlICJiZWdpbmNvZGVzcGFjZXJhbmdlIjoKICAgICAgICAgICAgICAgICAgcGFyc2VDb2Rlc3BhY2VSYW5nZShjTWFwLCBsZXhlcik7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIGNhc2UgImJlZ2luYmZjaGFyIjoKICAgICAgICAgICAgICAgICAgcGFyc2VCZkNoYXIoY01hcCwgbGV4ZXIpOwogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlICJiZWdpbmNpZGNoYXIiOgogICAgICAgICAgICAgICAgICBwYXJzZUNpZENoYXIoY01hcCwgbGV4ZXIpOwogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlICJiZWdpbmJmcmFuZ2UiOgogICAgICAgICAgICAgICAgICBwYXJzZUJmUmFuZ2UoY01hcCwgbGV4ZXIpOwogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlICJiZWdpbmNpZHJhbmdlIjoKICAgICAgICAgICAgICAgICAgcGFyc2VDaWRSYW5nZShjTWFwLCBsZXhlcik7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgICAgaWYgKGV4IGluc3RhbmNlb2YgX2NvcmVfdXRpbHMuTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICAgICAgICB0aHJvdyBleDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJJbnZhbGlkIGNNYXAgZGF0YTogIiArIGV4KTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoIXVzZUNNYXAgJiYgZW1iZWRkZWRVc2VDTWFwKSB7CiAgICAgICAgICB1c2VDTWFwID0gZW1iZWRkZWRVc2VDTWFwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHVzZUNNYXApIHsKICAgICAgICAgIHJldHVybiBleHRlbmRDTWFwKGNNYXAsIGZldGNoQnVpbHRJbkNNYXAsIHVzZUNNYXApOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShjTWFwKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZXh0ZW5kQ01hcChjTWFwLCBmZXRjaEJ1aWx0SW5DTWFwLCB1c2VDTWFwKSB7CiAgICAgICAgcmV0dXJuIGNyZWF0ZUJ1aWx0SW5DTWFwKHVzZUNNYXAsIGZldGNoQnVpbHRJbkNNYXApLnRoZW4oZnVuY3Rpb24gKG5ld0NNYXApIHsKICAgICAgICAgIGNNYXAudXNlQ01hcCA9IG5ld0NNYXA7CgogICAgICAgICAgaWYgKGNNYXAubnVtQ29kZXNwYWNlUmFuZ2VzID09PSAwKSB7CiAgICAgICAgICAgIHZhciB1c2VDb2Rlc3BhY2VSYW5nZXMgPSBjTWFwLnVzZUNNYXAuY29kZXNwYWNlUmFuZ2VzOwoKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB1c2VDb2Rlc3BhY2VSYW5nZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICBjTWFwLmNvZGVzcGFjZVJhbmdlc1tpXSA9IHVzZUNvZGVzcGFjZVJhbmdlc1tpXS5zbGljZSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjTWFwLm51bUNvZGVzcGFjZVJhbmdlcyA9IGNNYXAudXNlQ01hcC5udW1Db2Rlc3BhY2VSYW5nZXM7CiAgICAgICAgICB9CgogICAgICAgICAgY01hcC51c2VDTWFwLmZvckVhY2goZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsKICAgICAgICAgICAgaWYgKCFjTWFwLmNvbnRhaW5zKGtleSkpIHsKICAgICAgICAgICAgICBjTWFwLm1hcE9uZShrZXksIGNNYXAudXNlQ01hcC5sb29rdXAoa2V5KSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIGNNYXA7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGNyZWF0ZUJ1aWx0SW5DTWFwKG5hbWUsIGZldGNoQnVpbHRJbkNNYXApIHsKICAgICAgICBpZiAobmFtZSA9PT0gIklkZW50aXR5LUgiKSB7CiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG5ldyBJZGVudGl0eUNNYXAoZmFsc2UsIDIpKTsKICAgICAgICB9IGVsc2UgaWYgKG5hbWUgPT09ICJJZGVudGl0eS1WIikgewogICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShuZXcgSWRlbnRpdHlDTWFwKHRydWUsIDIpKTsKICAgICAgICB9CgogICAgICAgIGlmICghQlVJTFRfSU5fQ01BUFMuaW5jbHVkZXMobmFtZSkpIHsKICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoIlVua25vd24gQ01hcCBuYW1lOiAiICsgbmFtZSkpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFmZXRjaEJ1aWx0SW5DTWFwKSB7CiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKCJCdWlsdC1pbiBDTWFwIHBhcmFtZXRlcnMgYXJlIG5vdCBwcm92aWRlZC4iKSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmV0Y2hCdWlsdEluQ01hcChuYW1lKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICB2YXIgY01hcERhdGEgPSBkYXRhLmNNYXBEYXRhLAogICAgICAgICAgICBjb21wcmVzc2lvblR5cGUgPSBkYXRhLmNvbXByZXNzaW9uVHlwZTsKICAgICAgICAgIHZhciBjTWFwID0gbmV3IENNYXAodHJ1ZSk7CgogICAgICAgICAgaWYgKGNvbXByZXNzaW9uVHlwZSA9PT0gX3V0aWwuQ01hcENvbXByZXNzaW9uVHlwZS5CSU5BUlkpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBCaW5hcnlDTWFwUmVhZGVyKCkucHJvY2VzcyhjTWFwRGF0YSwgY01hcCwgZnVuY3Rpb24gKHVzZUNNYXApIHsKICAgICAgICAgICAgICByZXR1cm4gZXh0ZW5kQ01hcChjTWFwLCBmZXRjaEJ1aWx0SW5DTWFwLCB1c2VDTWFwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGNvbXByZXNzaW9uVHlwZSA9PT0gX3V0aWwuQ01hcENvbXByZXNzaW9uVHlwZS5OT05FKSB7CiAgICAgICAgICAgIHZhciBsZXhlciA9IG5ldyBfcGFyc2VyLkxleGVyKG5ldyBfc3RyZWFtLlN0cmVhbShjTWFwRGF0YSkpOwogICAgICAgICAgICByZXR1cm4gcGFyc2VDTWFwKGNNYXAsIGxleGVyLCBmZXRjaEJ1aWx0SW5DTWFwLCBudWxsKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKCJUT0RPOiBPbmx5IEJJTkFSWS9OT05FIENNYXAgY29tcHJlc3Npb24gaXMgY3VycmVudGx5IHN1cHBvcnRlZC4iKSk7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB7CiAgICAgICAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUocGFyYW1zKSB7CiAgICAgICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoLyojX19QVVJFX18qL19yZWdlbmVyYXRvclsiZGVmYXVsdCJdLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICAgICAgdmFyIGVuY29kaW5nLCBmZXRjaEJ1aWx0SW5DTWFwLCB1c2VDTWFwLCBjTWFwLCBsZXhlcjsKICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclsiZGVmYXVsdCJdLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgZW5jb2RpbmcgPSBwYXJhbXMuZW5jb2Rpbmc7CiAgICAgICAgICAgICAgICAgICAgZmV0Y2hCdWlsdEluQ01hcCA9IHBhcmFtcy5mZXRjaEJ1aWx0SW5DTWFwOwogICAgICAgICAgICAgICAgICAgIHVzZUNNYXAgPSBwYXJhbXMudXNlQ01hcDsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCEoMCwgX3ByaW1pdGl2ZXMuaXNOYW1lKShlbmNvZGluZykpIHsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA3OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBjcmVhdGVCdWlsdEluQ01hcChlbmNvZGluZy5uYW1lLCBmZXRjaEJ1aWx0SW5DTWFwKSk7CgogICAgICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICAgICAgaWYgKCEoMCwgX3ByaW1pdGl2ZXMuaXNTdHJlYW0pKGVuY29kaW5nKSkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDExOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBjTWFwID0gbmV3IENNYXAoKTsKICAgICAgICAgICAgICAgICAgICBsZXhlciA9IG5ldyBfcGFyc2VyLkxleGVyKGVuY29kaW5nKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBwYXJzZUNNYXAoY01hcCwgbGV4ZXIsIGZldGNoQnVpbHRJbkNNYXAsIHVzZUNNYXApLnRoZW4oZnVuY3Rpb24gKHBhcnNlZENNYXApIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZWRDTWFwLmlzSWRlbnRpdHlDTWFwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjcmVhdGVCdWlsdEluQ01hcChwYXJzZWRDTWFwLm5hbWUsIGZldGNoQnVpbHRJbkNNYXApOwogICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZWRDTWFwOwogICAgICAgICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJFbmNvZGluZyByZXF1aXJlZC4iKTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIF9jYWxsZWUpOwogICAgICAgICAgfSkpKCk7CiAgICAgICAgfQogICAgICB9OwogICAgfSgpOwoKICAgIGV4cG9ydHMuQ01hcEZhY3RvcnkgPSBDTWFwRmFjdG9yeTsKCiAgICAvKioqL30pLCAoCiAgLyogMjE3ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgIHZhbHVlOiB0cnVlCiAgICB9KTsKICAgIGV4cG9ydHMuZ2V0Rm9udFR5cGUgPSBnZXRGb250VHlwZTsKICAgIGV4cG9ydHMuSWRlbnRpdHlUb1VuaWNvZGVNYXAgPSBleHBvcnRzLlRvVW5pY29kZU1hcCA9IGV4cG9ydHMuRm9udEZsYWdzID0gZXhwb3J0cy5Gb250ID0gZXhwb3J0cy5FcnJvckZvbnQgPSBleHBvcnRzLlNFQUNfQU5BTFlTSVNfRU5BQkxFRCA9IHZvaWQgMDsKCiAgICB2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUpOwoKICAgIHZhciBfY2ZmX3BhcnNlciA9IF9fd19wZGZqc19yZXF1aXJlX18oMjE4KTsKCiAgICB2YXIgX2dseXBobGlzdCA9IF9fd19wZGZqc19yZXF1aXJlX18oMjIxKTsKCiAgICB2YXIgX2VuY29kaW5ncyA9IF9fd19wZGZqc19yZXF1aXJlX18oMjIwKTsKCiAgICB2YXIgX3N0YW5kYXJkX2ZvbnRzID0gX193X3BkZmpzX3JlcXVpcmVfXygyMjIpOwoKICAgIHZhciBfdW5pY29kZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjIzKTsKCiAgICB2YXIgX2NvcmVfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE5Nyk7CgogICAgdmFyIF9mb250X3JlbmRlcmVyID0gX193X3BkZmpzX3JlcXVpcmVfXygyMjQpOwoKICAgIHZhciBfY21hcCA9IF9fd19wZGZqc19yZXF1aXJlX18oMjE2KTsKCiAgICB2YXIgX3N0cmVhbSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjAxKTsKCiAgICB2YXIgX3R5cGUxX3BhcnNlciA9IF9fd19wZGZqc19yZXF1aXJlX18oMjI1KTsKCiAgICBmdW5jdGlvbiBfc2xpY2VkVG9BcnJheShhcnIsIGkpIHtyZXR1cm4gX2FycmF5V2l0aEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgfHwgX25vbkl0ZXJhYmxlUmVzdCgpO30KCiAgICBmdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0KCkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UiKTt9CgogICAgZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkge2lmICghKFN5bWJvbC5pdGVyYXRvciBpbiBPYmplY3QoYXJyKSB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYXJyKSA9PT0gIltvYmplY3QgQXJndW1lbnRzXSIpKSB7cmV0dXJuO312YXIgX2FyciA9IFtdO3ZhciBfbiA9IHRydWU7dmFyIF9kID0gZmFsc2U7dmFyIF9lID0gdW5kZWZpbmVkO3RyeSB7Zm9yICh2YXIgX2kgPSBhcnJbU3ltYm9sLml0ZXJhdG9yXSgpLCBfczsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkge19hcnIucHVzaChfcy52YWx1ZSk7aWYgKGkgJiYgX2Fyci5sZW5ndGggPT09IGkpIGJyZWFrO319IGNhdGNoIChlcnIpIHtfZCA9IHRydWU7X2UgPSBlcnI7fSBmaW5hbGx5IHt0cnkge2lmICghX24gJiYgX2lbInJldHVybiJdICE9IG51bGwpIF9pWyJyZXR1cm4iXSgpO30gZmluYWxseSB7aWYgKF9kKSB0aHJvdyBfZTt9fXJldHVybiBfYXJyO30KCiAgICBmdW5jdGlvbiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB7aWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjt9CgogICAgdmFyIFBSSVZBVEVfVVNFX0FSRUFTID0gW1sweGUwMDAsIDB4ZjhmZl0sIFsweDEwMDAwMCwgMHgxMGZmZmRdXTsKICAgIHZhciBQREZfR0xZUEhfU1BBQ0VfVU5JVFMgPSAxMDAwOwogICAgdmFyIFNFQUNfQU5BTFlTSVNfRU5BQkxFRCA9IHRydWU7CiAgICBleHBvcnRzLlNFQUNfQU5BTFlTSVNfRU5BQkxFRCA9IFNFQUNfQU5BTFlTSVNfRU5BQkxFRDsKICAgIHZhciBGb250RmxhZ3MgPSB7CiAgICAgIEZpeGVkUGl0Y2g6IDEsCiAgICAgIFNlcmlmOiAyLAogICAgICBTeW1ib2xpYzogNCwKICAgICAgU2NyaXB0OiA4LAogICAgICBOb25zeW1ib2xpYzogMzIsCiAgICAgIEl0YWxpYzogNjQsCiAgICAgIEFsbENhcDogNjU1MzYsCiAgICAgIFNtYWxsQ2FwOiAxMzEwNzIsCiAgICAgIEZvcmNlQm9sZDogMjYyMTQ0CiAgICB9OwogICAgZXhwb3J0cy5Gb250RmxhZ3MgPSBGb250RmxhZ3M7CiAgICB2YXIgTWFjU3RhbmRhcmRHbHlwaE9yZGVyaW5nID0gWyIubm90ZGVmIiwgIi5udWxsIiwgIm5vbm1hcmtpbmdyZXR1cm4iLCAic3BhY2UiLCAiZXhjbGFtIiwgInF1b3RlZGJsIiwgIm51bWJlcnNpZ24iLCAiZG9sbGFyIiwgInBlcmNlbnQiLCAiYW1wZXJzYW5kIiwgInF1b3Rlc2luZ2xlIiwgInBhcmVubGVmdCIsICJwYXJlbnJpZ2h0IiwgImFzdGVyaXNrIiwgInBsdXMiLCAiY29tbWEiLCAiaHlwaGVuIiwgInBlcmlvZCIsICJzbGFzaCIsICJ6ZXJvIiwgIm9uZSIsICJ0d28iLCAidGhyZWUiLCAiZm91ciIsICJmaXZlIiwgInNpeCIsICJzZXZlbiIsICJlaWdodCIsICJuaW5lIiwgImNvbG9uIiwgInNlbWljb2xvbiIsICJsZXNzIiwgImVxdWFsIiwgImdyZWF0ZXIiLCAicXVlc3Rpb24iLCAiYXQiLCAiQSIsICJCIiwgIkMiLCAiRCIsICJFIiwgIkYiLCAiRyIsICJIIiwgIkkiLCAiSiIsICJLIiwgIkwiLCAiTSIsICJOIiwgIk8iLCAiUCIsICJRIiwgIlIiLCAiUyIsICJUIiwgIlUiLCAiViIsICJXIiwgIlgiLCAiWSIsICJaIiwgImJyYWNrZXRsZWZ0IiwgImJhY2tzbGFzaCIsICJicmFja2V0cmlnaHQiLCAiYXNjaWljaXJjdW0iLCAidW5kZXJzY29yZSIsICJncmF2ZSIsICJhIiwgImIiLCAiYyIsICJkIiwgImUiLCAiZiIsICJnIiwgImgiLCAiaSIsICJqIiwgImsiLCAibCIsICJtIiwgIm4iLCAibyIsICJwIiwgInEiLCAiciIsICJzIiwgInQiLCAidSIsICJ2IiwgInciLCAieCIsICJ5IiwgInoiLCAiYnJhY2VsZWZ0IiwgImJhciIsICJicmFjZXJpZ2h0IiwgImFzY2lpdGlsZGUiLCAiQWRpZXJlc2lzIiwgIkFyaW5nIiwgIkNjZWRpbGxhIiwgIkVhY3V0ZSIsICJOdGlsZGUiLCAiT2RpZXJlc2lzIiwgIlVkaWVyZXNpcyIsICJhYWN1dGUiLCAiYWdyYXZlIiwgImFjaXJjdW1mbGV4IiwgImFkaWVyZXNpcyIsICJhdGlsZGUiLCAiYXJpbmciLCAiY2NlZGlsbGEiLCAiZWFjdXRlIiwgImVncmF2ZSIsICJlY2lyY3VtZmxleCIsICJlZGllcmVzaXMiLCAiaWFjdXRlIiwgImlncmF2ZSIsICJpY2lyY3VtZmxleCIsICJpZGllcmVzaXMiLCAibnRpbGRlIiwgIm9hY3V0ZSIsICJvZ3JhdmUiLCAib2NpcmN1bWZsZXgiLCAib2RpZXJlc2lzIiwgIm90aWxkZSIsICJ1YWN1dGUiLCAidWdyYXZlIiwgInVjaXJjdW1mbGV4IiwgInVkaWVyZXNpcyIsICJkYWdnZXIiLCAiZGVncmVlIiwgImNlbnQiLCAic3RlcmxpbmciLCAic2VjdGlvbiIsICJidWxsZXQiLCAicGFyYWdyYXBoIiwgImdlcm1hbmRibHMiLCAicmVnaXN0ZXJlZCIsICJjb3B5cmlnaHQiLCAidHJhZGVtYXJrIiwgImFjdXRlIiwgImRpZXJlc2lzIiwgIm5vdGVxdWFsIiwgIkFFIiwgIk9zbGFzaCIsICJpbmZpbml0eSIsICJwbHVzbWludXMiLCAibGVzc2VxdWFsIiwgImdyZWF0ZXJlcXVhbCIsICJ5ZW4iLCAibXUiLCAicGFydGlhbGRpZmYiLCAic3VtbWF0aW9uIiwgInByb2R1Y3QiLCAicGkiLCAiaW50ZWdyYWwiLCAib3JkZmVtaW5pbmUiLCAib3JkbWFzY3VsaW5lIiwgIk9tZWdhIiwgImFlIiwgIm9zbGFzaCIsICJxdWVzdGlvbmRvd24iLCAiZXhjbGFtZG93biIsICJsb2dpY2Fsbm90IiwgInJhZGljYWwiLCAiZmxvcmluIiwgImFwcHJveGVxdWFsIiwgIkRlbHRhIiwgImd1aWxsZW1vdGxlZnQiLCAiZ3VpbGxlbW90cmlnaHQiLCAiZWxsaXBzaXMiLCAibm9uYnJlYWtpbmdzcGFjZSIsICJBZ3JhdmUiLCAiQXRpbGRlIiwgIk90aWxkZSIsICJPRSIsICJvZSIsICJlbmRhc2giLCAiZW1kYXNoIiwgInF1b3RlZGJsbGVmdCIsICJxdW90ZWRibHJpZ2h0IiwgInF1b3RlbGVmdCIsICJxdW90ZXJpZ2h0IiwgImRpdmlkZSIsICJsb3plbmdlIiwgInlkaWVyZXNpcyIsICJZZGllcmVzaXMiLCAiZnJhY3Rpb24iLCAiY3VycmVuY3kiLCAiZ3VpbHNpbmdsbGVmdCIsICJndWlsc2luZ2xyaWdodCIsICJmaSIsICJmbCIsICJkYWdnZXJkYmwiLCAicGVyaW9kY2VudGVyZWQiLCAicXVvdGVzaW5nbGJhc2UiLCAicXVvdGVkYmxiYXNlIiwgInBlcnRob3VzYW5kIiwgIkFjaXJjdW1mbGV4IiwgIkVjaXJjdW1mbGV4IiwgIkFhY3V0ZSIsICJFZGllcmVzaXMiLCAiRWdyYXZlIiwgIklhY3V0ZSIsICJJY2lyY3VtZmxleCIsICJJZGllcmVzaXMiLCAiSWdyYXZlIiwgIk9hY3V0ZSIsICJPY2lyY3VtZmxleCIsICJhcHBsZSIsICJPZ3JhdmUiLCAiVWFjdXRlIiwgIlVjaXJjdW1mbGV4IiwgIlVncmF2ZSIsICJkb3RsZXNzaSIsICJjaXJjdW1mbGV4IiwgInRpbGRlIiwgIm1hY3JvbiIsICJicmV2ZSIsICJkb3RhY2NlbnQiLCAicmluZyIsICJjZWRpbGxhIiwgImh1bmdhcnVtbGF1dCIsICJvZ29uZWsiLCAiY2Fyb24iLCAiTHNsYXNoIiwgImxzbGFzaCIsICJTY2Fyb24iLCAic2Nhcm9uIiwgIlpjYXJvbiIsICJ6Y2Fyb24iLCAiYnJva2VuYmFyIiwgIkV0aCIsICJldGgiLCAiWWFjdXRlIiwgInlhY3V0ZSIsICJUaG9ybiIsICJ0aG9ybiIsICJtaW51cyIsICJtdWx0aXBseSIsICJvbmVzdXBlcmlvciIsICJ0d29zdXBlcmlvciIsICJ0aHJlZXN1cGVyaW9yIiwgIm9uZWhhbGYiLCAib25lcXVhcnRlciIsICJ0aHJlZXF1YXJ0ZXJzIiwgImZyYW5jIiwgIkdicmV2ZSIsICJnYnJldmUiLCAiSWRvdGFjY2VudCIsICJTY2VkaWxsYSIsICJzY2VkaWxsYSIsICJDYWN1dGUiLCAiY2FjdXRlIiwgIkNjYXJvbiIsICJjY2Fyb24iLCAiZGNyb2F0Il07CgogICAgZnVuY3Rpb24gYWRqdXN0V2lkdGhzKHByb3BlcnRpZXMpIHsKICAgICAgaWYgKCFwcm9wZXJ0aWVzLmZvbnRNYXRyaXgpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChwcm9wZXJ0aWVzLmZvbnRNYXRyaXhbMF0gPT09IF91dGlsLkZPTlRfSURFTlRJVFlfTUFUUklYWzBdKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgc2NhbGUgPSAwLjAwMSAvIHByb3BlcnRpZXMuZm9udE1hdHJpeFswXTsKICAgICAgdmFyIGdseXBoc1dpZHRocyA9IHByb3BlcnRpZXMud2lkdGhzOwoKICAgICAgZm9yICh2YXIgZ2x5cGggaW4gZ2x5cGhzV2lkdGhzKSB7CiAgICAgICAgZ2x5cGhzV2lkdGhzW2dseXBoXSAqPSBzY2FsZTsKICAgICAgfQoKICAgICAgcHJvcGVydGllcy5kZWZhdWx0V2lkdGggKj0gc2NhbGU7CiAgICB9CgogICAgZnVuY3Rpb24gYWRqdXN0VG9Vbmljb2RlKHByb3BlcnRpZXMsIGJ1aWx0SW5FbmNvZGluZykgewogICAgICBpZiAocHJvcGVydGllcy5oYXNJbmNsdWRlZFRvVW5pY29kZU1hcCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHByb3BlcnRpZXMuaGFzRW5jb2RpbmcpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChidWlsdEluRW5jb2RpbmcgPT09IHByb3BlcnRpZXMuZGVmYXVsdEVuY29kaW5nKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAocHJvcGVydGllcy50b1VuaWNvZGUgaW5zdGFuY2VvZiBJZGVudGl0eVRvVW5pY29kZU1hcCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHRvVW5pY29kZSA9IFtdLAogICAgICAgIGdseXBoc1VuaWNvZGVNYXAgPSAoMCwgX2dseXBobGlzdC5nZXRHbHlwaHNVbmljb2RlKSgpOwoKICAgICAgZm9yICh2YXIgY2hhckNvZGUgaW4gYnVpbHRJbkVuY29kaW5nKSB7CiAgICAgICAgdmFyIGdseXBoTmFtZSA9IGJ1aWx0SW5FbmNvZGluZ1tjaGFyQ29kZV07CiAgICAgICAgdmFyIHVuaWNvZGUgPSAoMCwgX3VuaWNvZGUuZ2V0VW5pY29kZUZvckdseXBoKShnbHlwaE5hbWUsIGdseXBoc1VuaWNvZGVNYXApOwoKICAgICAgICBpZiAodW5pY29kZSAhPT0gLTEpIHsKICAgICAgICAgIHRvVW5pY29kZVtjaGFyQ29kZV0gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHVuaWNvZGUpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcHJvcGVydGllcy50b1VuaWNvZGUuYW1lbmQodG9Vbmljb2RlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRGb250VHlwZSh0eXBlLCBzdWJ0eXBlKSB7CiAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgIGNhc2UgIlR5cGUxIjoKICAgICAgICAgIHJldHVybiBzdWJ0eXBlID09PSAiVHlwZTFDIiA/IF91dGlsLkZvbnRUeXBlLlRZUEUxQyA6IF91dGlsLkZvbnRUeXBlLlRZUEUxOwoKICAgICAgICBjYXNlICJDSURGb250VHlwZTAiOgogICAgICAgICAgcmV0dXJuIHN1YnR5cGUgPT09ICJDSURGb250VHlwZTBDIiA/IF91dGlsLkZvbnRUeXBlLkNJREZPTlRUWVBFMEMgOiBfdXRpbC5Gb250VHlwZS5DSURGT05UVFlQRTA7CgogICAgICAgIGNhc2UgIk9wZW5UeXBlIjoKICAgICAgICAgIHJldHVybiBfdXRpbC5Gb250VHlwZS5PUEVOVFlQRTsKCiAgICAgICAgY2FzZSAiVHJ1ZVR5cGUiOgogICAgICAgICAgcmV0dXJuIF91dGlsLkZvbnRUeXBlLlRSVUVUWVBFOwoKICAgICAgICBjYXNlICJDSURGb250VHlwZTIiOgogICAgICAgICAgcmV0dXJuIF91dGlsLkZvbnRUeXBlLkNJREZPTlRUWVBFMjsKCiAgICAgICAgY2FzZSAiTU1UeXBlMSI6CiAgICAgICAgICByZXR1cm4gX3V0aWwuRm9udFR5cGUuTU1UWVBFMTsKCiAgICAgICAgY2FzZSAiVHlwZTAiOgogICAgICAgICAgcmV0dXJuIF91dGlsLkZvbnRUeXBlLlRZUEUwOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgcmV0dXJuIF91dGlsLkZvbnRUeXBlLlVOS05PV047CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiByZWNvdmVyR2x5cGhOYW1lKG5hbWUsIGdseXBoc1VuaWNvZGVNYXApIHsKICAgICAgaWYgKGdseXBoc1VuaWNvZGVNYXBbbmFtZV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiBuYW1lOwogICAgICB9CgogICAgICB2YXIgdW5pY29kZSA9ICgwLCBfdW5pY29kZS5nZXRVbmljb2RlRm9yR2x5cGgpKG5hbWUsIGdseXBoc1VuaWNvZGVNYXApOwoKICAgICAgaWYgKHVuaWNvZGUgIT09IC0xKSB7CiAgICAgICAgZm9yICh2YXIga2V5IGluIGdseXBoc1VuaWNvZGVNYXApIHsKICAgICAgICAgIGlmIChnbHlwaHNVbmljb2RlTWFwW2tleV0gPT09IHVuaWNvZGUpIHsKICAgICAgICAgICAgcmV0dXJuIGtleTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgICgwLCBfdXRpbC5pbmZvKSgiVW5hYmxlIHRvIHJlY292ZXIgYSBzdGFuZGFyZCBnbHlwaCBuYW1lIGZvcjogIiArIG5hbWUpOwogICAgICByZXR1cm4gbmFtZTsKICAgIH0KCiAgICB2YXIgR2x5cGggPSBmdW5jdGlvbiBHbHlwaENsb3N1cmUoKSB7CiAgICAgIGZ1bmN0aW9uIEdseXBoKGZvbnRDaGFyLCB1bmljb2RlLCBhY2NlbnQsIHdpZHRoLCB2bWV0cmljLCBvcGVyYXRvckxpc3RJZCwgaXNTcGFjZSwgaXNJbkZvbnQpIHsKICAgICAgICB0aGlzLmZvbnRDaGFyID0gZm9udENoYXI7CiAgICAgICAgdGhpcy51bmljb2RlID0gdW5pY29kZTsKICAgICAgICB0aGlzLmFjY2VudCA9IGFjY2VudDsKICAgICAgICB0aGlzLndpZHRoID0gd2lkdGg7CiAgICAgICAgdGhpcy52bWV0cmljID0gdm1ldHJpYzsKICAgICAgICB0aGlzLm9wZXJhdG9yTGlzdElkID0gb3BlcmF0b3JMaXN0SWQ7CiAgICAgICAgdGhpcy5pc1NwYWNlID0gaXNTcGFjZTsKICAgICAgICB0aGlzLmlzSW5Gb250ID0gaXNJbkZvbnQ7CiAgICAgIH0KCiAgICAgIEdseXBoLnByb3RvdHlwZS5tYXRjaGVzRm9yQ2FjaGUgPSBmdW5jdGlvbiAoZm9udENoYXIsIHVuaWNvZGUsIGFjY2VudCwgd2lkdGgsIHZtZXRyaWMsIG9wZXJhdG9yTGlzdElkLCBpc1NwYWNlLCBpc0luRm9udCkgewogICAgICAgIHJldHVybiB0aGlzLmZvbnRDaGFyID09PSBmb250Q2hhciAmJiB0aGlzLnVuaWNvZGUgPT09IHVuaWNvZGUgJiYgdGhpcy5hY2NlbnQgPT09IGFjY2VudCAmJiB0aGlzLndpZHRoID09PSB3aWR0aCAmJiB0aGlzLnZtZXRyaWMgPT09IHZtZXRyaWMgJiYgdGhpcy5vcGVyYXRvckxpc3RJZCA9PT0gb3BlcmF0b3JMaXN0SWQgJiYgdGhpcy5pc1NwYWNlID09PSBpc1NwYWNlICYmIHRoaXMuaXNJbkZvbnQgPT09IGlzSW5Gb250OwogICAgICB9OwoKICAgICAgcmV0dXJuIEdseXBoOwogICAgfSgpOwoKICAgIHZhciBUb1VuaWNvZGVNYXAgPSBmdW5jdGlvbiBUb1VuaWNvZGVNYXBDbG9zdXJlKCkgewogICAgICBmdW5jdGlvbiBUb1VuaWNvZGVNYXAoKSB7CiAgICAgICAgdmFyIGNtYXAgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IFtdOwogICAgICAgIHRoaXMuX21hcCA9IGNtYXA7CiAgICAgIH0KCiAgICAgIFRvVW5pY29kZU1hcC5wcm90b3R5cGUgPSB7CiAgICAgICAgZ2V0IGxlbmd0aCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9tYXAubGVuZ3RoOwogICAgICAgIH0sCgogICAgICAgIGZvckVhY2g6IGZ1bmN0aW9uIGZvckVhY2goY2FsbGJhY2spIHsKICAgICAgICAgIGZvciAodmFyIGNoYXJDb2RlIGluIHRoaXMuX21hcCkgewogICAgICAgICAgICBjYWxsYmFjayhjaGFyQ29kZSwgdGhpcy5fbWFwW2NoYXJDb2RlXS5jaGFyQ29kZUF0KDApKTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGhhczogZnVuY3Rpb24gaGFzKGkpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9tYXBbaV0gIT09IHVuZGVmaW5lZDsKICAgICAgICB9LAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KGkpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9tYXBbaV07CiAgICAgICAgfSwKICAgICAgICBjaGFyQ29kZU9mOiBmdW5jdGlvbiBjaGFyQ29kZU9mKHZhbHVlKSB7CiAgICAgICAgICB2YXIgbWFwID0gdGhpcy5fbWFwOwoKICAgICAgICAgIGlmIChtYXAubGVuZ3RoIDw9IDB4MTAwMDApIHsKICAgICAgICAgICAgcmV0dXJuIG1hcC5pbmRleE9mKHZhbHVlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3IgKHZhciBjaGFyQ29kZSBpbiBtYXApIHsKICAgICAgICAgICAgaWYgKG1hcFtjaGFyQ29kZV0gPT09IHZhbHVlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGNoYXJDb2RlIHwgMDsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICB9LAogICAgICAgIGFtZW5kOiBmdW5jdGlvbiBhbWVuZChtYXApIHsKICAgICAgICAgIGZvciAodmFyIGNoYXJDb2RlIGluIG1hcCkgewogICAgICAgICAgICB0aGlzLl9tYXBbY2hhckNvZGVdID0gbWFwW2NoYXJDb2RlXTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07CiAgICAgIHJldHVybiBUb1VuaWNvZGVNYXA7CiAgICB9KCk7CgogICAgZXhwb3J0cy5Ub1VuaWNvZGVNYXAgPSBUb1VuaWNvZGVNYXA7CgogICAgdmFyIElkZW50aXR5VG9Vbmljb2RlTWFwID0gZnVuY3Rpb24gSWRlbnRpdHlUb1VuaWNvZGVNYXBDbG9zdXJlKCkgewogICAgICBmdW5jdGlvbiBJZGVudGl0eVRvVW5pY29kZU1hcChmaXJzdENoYXIsIGxhc3RDaGFyKSB7CiAgICAgICAgdGhpcy5maXJzdENoYXIgPSBmaXJzdENoYXI7CiAgICAgICAgdGhpcy5sYXN0Q2hhciA9IGxhc3RDaGFyOwogICAgICB9CgogICAgICBJZGVudGl0eVRvVW5pY29kZU1hcC5wcm90b3R5cGUgPSB7CiAgICAgICAgZ2V0IGxlbmd0aCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLmxhc3RDaGFyICsgMSAtIHRoaXMuZmlyc3RDaGFyOwogICAgICAgIH0sCgogICAgICAgIGZvckVhY2g6IGZ1bmN0aW9uIGZvckVhY2goY2FsbGJhY2spIHsKICAgICAgICAgIGZvciAodmFyIGkgPSB0aGlzLmZpcnN0Q2hhciwgaWkgPSB0aGlzLmxhc3RDaGFyOyBpIDw9IGlpOyBpKyspIHsKICAgICAgICAgICAgY2FsbGJhY2soaSwgaSk7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBoYXM6IGZ1bmN0aW9uIGhhcyhpKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5maXJzdENoYXIgPD0gaSAmJiBpIDw9IHRoaXMubGFzdENoYXI7CiAgICAgICAgfSwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldChpKSB7CiAgICAgICAgICBpZiAodGhpcy5maXJzdENoYXIgPD0gaSAmJiBpIDw9IHRoaXMubGFzdENoYXIpIHsKICAgICAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoaSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICB9LAogICAgICAgIGNoYXJDb2RlT2Y6IGZ1bmN0aW9uIGNoYXJDb2RlT2YodikgewogICAgICAgICAgcmV0dXJuIE51bWJlci5pc0ludGVnZXIodikgJiYgdiA+PSB0aGlzLmZpcnN0Q2hhciAmJiB2IDw9IHRoaXMubGFzdENoYXIgPyB2IDogLTE7CiAgICAgICAgfSwKICAgICAgICBhbWVuZDogZnVuY3Rpb24gYW1lbmQobWFwKSB7CiAgICAgICAgICAoMCwgX3V0aWwudW5yZWFjaGFibGUpKCJTaG91bGQgbm90IGNhbGwgYW1lbmQoKSIpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgcmV0dXJuIElkZW50aXR5VG9Vbmljb2RlTWFwOwogICAgfSgpOwoKICAgIGV4cG9ydHMuSWRlbnRpdHlUb1VuaWNvZGVNYXAgPSBJZGVudGl0eVRvVW5pY29kZU1hcDsKCiAgICB2YXIgT3BlblR5cGVGaWxlQnVpbGRlciA9IGZ1bmN0aW9uIE9wZW5UeXBlRmlsZUJ1aWxkZXJDbG9zdXJlKCkgewogICAgICBmdW5jdGlvbiB3cml0ZUludDE2KGRlc3QsIG9mZnNldCwgbnVtKSB7CiAgICAgICAgZGVzdFtvZmZzZXRdID0gbnVtID4+IDggJiAweGZmOwogICAgICAgIGRlc3Rbb2Zmc2V0ICsgMV0gPSBudW0gJiAweGZmOwogICAgICB9CgogICAgICBmdW5jdGlvbiB3cml0ZUludDMyKGRlc3QsIG9mZnNldCwgbnVtKSB7CiAgICAgICAgZGVzdFtvZmZzZXRdID0gbnVtID4+IDI0ICYgMHhmZjsKICAgICAgICBkZXN0W29mZnNldCArIDFdID0gbnVtID4+IDE2ICYgMHhmZjsKICAgICAgICBkZXN0W29mZnNldCArIDJdID0gbnVtID4+IDggJiAweGZmOwogICAgICAgIGRlc3Rbb2Zmc2V0ICsgM10gPSBudW0gJiAweGZmOwogICAgICB9CgogICAgICBmdW5jdGlvbiB3cml0ZURhdGEoZGVzdCwgb2Zmc2V0LCBkYXRhKSB7CiAgICAgICAgdmFyIGksIGlpOwoKICAgICAgICBpZiAoZGF0YSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpIHsKICAgICAgICAgIGRlc3Quc2V0KGRhdGEsIG9mZnNldCk7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgZGF0YSA9PT0gInN0cmluZyIpIHsKICAgICAgICAgIGZvciAoaSA9IDAsIGlpID0gZGF0YS5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgIGRlc3Rbb2Zmc2V0KytdID0gZGF0YS5jaGFyQ29kZUF0KGkpICYgMHhmZjsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgZm9yIChpID0gMCwgaWkgPSBkYXRhLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgZGVzdFtvZmZzZXQrK10gPSBkYXRhW2ldICYgMHhmZjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIE9wZW5UeXBlRmlsZUJ1aWxkZXIoc2ZudCkgewogICAgICAgIHRoaXMuc2ZudCA9IHNmbnQ7CiAgICAgICAgdGhpcy50YWJsZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICB9CgogICAgICBPcGVuVHlwZUZpbGVCdWlsZGVyLmdldFNlYXJjaFBhcmFtcyA9IGZ1bmN0aW9uIE9wZW5UeXBlRmlsZUJ1aWxkZXJfZ2V0U2VhcmNoUGFyYW1zKGVudHJpZXNDb3VudCwgZW50cnlTaXplKSB7CiAgICAgICAgdmFyIG1heFBvd2VyMiA9IDEsCiAgICAgICAgICBsb2cyID0gMDsKCiAgICAgICAgd2hpbGUgKChtYXhQb3dlcjIgXiBlbnRyaWVzQ291bnQpID4gbWF4UG93ZXIyKSB7CiAgICAgICAgICBtYXhQb3dlcjIgPDw9IDE7CiAgICAgICAgICBsb2cyKys7CiAgICAgICAgfQoKICAgICAgICB2YXIgc2VhcmNoUmFuZ2UgPSBtYXhQb3dlcjIgKiBlbnRyeVNpemU7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHJhbmdlOiBzZWFyY2hSYW5nZSwKICAgICAgICAgIGVudHJ5OiBsb2cyLAogICAgICAgICAgcmFuZ2VTaGlmdDogZW50cnlTaXplICogZW50cmllc0NvdW50IC0gc2VhcmNoUmFuZ2UKICAgICAgICB9OwogICAgICB9OwoKICAgICAgdmFyIE9URl9IRUFERVJfU0laRSA9IDEyOwogICAgICB2YXIgT1RGX1RBQkxFX0VOVFJZX1NJWkUgPSAxNjsKICAgICAgT3BlblR5cGVGaWxlQnVpbGRlci5wcm90b3R5cGUgPSB7CiAgICAgICAgdG9BcnJheTogZnVuY3Rpb24gT3BlblR5cGVGaWxlQnVpbGRlcl90b0FycmF5KCkgewogICAgICAgICAgdmFyIHNmbnQgPSB0aGlzLnNmbnQ7CiAgICAgICAgICB2YXIgdGFibGVzID0gdGhpcy50YWJsZXM7CiAgICAgICAgICB2YXIgdGFibGVzTmFtZXMgPSBPYmplY3Qua2V5cyh0YWJsZXMpOwogICAgICAgICAgdGFibGVzTmFtZXMuc29ydCgpOwogICAgICAgICAgdmFyIG51bVRhYmxlcyA9IHRhYmxlc05hbWVzLmxlbmd0aDsKICAgICAgICAgIHZhciBpLCBqLCBqaiwgdGFibGUsIHRhYmxlTmFtZTsKICAgICAgICAgIHZhciBvZmZzZXQgPSBPVEZfSEVBREVSX1NJWkUgKyBudW1UYWJsZXMgKiBPVEZfVEFCTEVfRU5UUllfU0laRTsKICAgICAgICAgIHZhciB0YWJsZU9mZnNldHMgPSBbb2Zmc2V0XTsKCiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbnVtVGFibGVzOyBpKyspIHsKICAgICAgICAgICAgdGFibGUgPSB0YWJsZXNbdGFibGVzTmFtZXNbaV1dOwogICAgICAgICAgICB2YXIgcGFkZGVkTGVuZ3RoID0gKHRhYmxlLmxlbmd0aCArIDMgJiB+MykgPj4+IDA7CiAgICAgICAgICAgIG9mZnNldCArPSBwYWRkZWRMZW5ndGg7CiAgICAgICAgICAgIHRhYmxlT2Zmc2V0cy5wdXNoKG9mZnNldCk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGZpbGUgPSBuZXcgVWludDhBcnJheShvZmZzZXQpOwoKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBudW1UYWJsZXM7IGkrKykgewogICAgICAgICAgICB0YWJsZSA9IHRhYmxlc1t0YWJsZXNOYW1lc1tpXV07CiAgICAgICAgICAgIHdyaXRlRGF0YShmaWxlLCB0YWJsZU9mZnNldHNbaV0sIHRhYmxlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoc2ZudCA9PT0gInRydWUiKSB7CiAgICAgICAgICAgIHNmbnQgPSAoMCwgX3V0aWwuc3RyaW5nMzIpKDB4MDAwMTAwMDApOwogICAgICAgICAgfQoKICAgICAgICAgIGZpbGVbMF0gPSBzZm50LmNoYXJDb2RlQXQoMCkgJiAweGZmOwogICAgICAgICAgZmlsZVsxXSA9IHNmbnQuY2hhckNvZGVBdCgxKSAmIDB4ZmY7CiAgICAgICAgICBmaWxlWzJdID0gc2ZudC5jaGFyQ29kZUF0KDIpICYgMHhmZjsKICAgICAgICAgIGZpbGVbM10gPSBzZm50LmNoYXJDb2RlQXQoMykgJiAweGZmOwogICAgICAgICAgd3JpdGVJbnQxNihmaWxlLCA0LCBudW1UYWJsZXMpOwogICAgICAgICAgdmFyIHNlYXJjaFBhcmFtcyA9IE9wZW5UeXBlRmlsZUJ1aWxkZXIuZ2V0U2VhcmNoUGFyYW1zKG51bVRhYmxlcywgMTYpOwogICAgICAgICAgd3JpdGVJbnQxNihmaWxlLCA2LCBzZWFyY2hQYXJhbXMucmFuZ2UpOwogICAgICAgICAgd3JpdGVJbnQxNihmaWxlLCA4LCBzZWFyY2hQYXJhbXMuZW50cnkpOwogICAgICAgICAgd3JpdGVJbnQxNihmaWxlLCAxMCwgc2VhcmNoUGFyYW1zLnJhbmdlU2hpZnQpOwogICAgICAgICAgb2Zmc2V0ID0gT1RGX0hFQURFUl9TSVpFOwoKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBudW1UYWJsZXM7IGkrKykgewogICAgICAgICAgICB0YWJsZU5hbWUgPSB0YWJsZXNOYW1lc1tpXTsKICAgICAgICAgICAgZmlsZVtvZmZzZXRdID0gdGFibGVOYW1lLmNoYXJDb2RlQXQoMCkgJiAweGZmOwogICAgICAgICAgICBmaWxlW29mZnNldCArIDFdID0gdGFibGVOYW1lLmNoYXJDb2RlQXQoMSkgJiAweGZmOwogICAgICAgICAgICBmaWxlW29mZnNldCArIDJdID0gdGFibGVOYW1lLmNoYXJDb2RlQXQoMikgJiAweGZmOwogICAgICAgICAgICBmaWxlW29mZnNldCArIDNdID0gdGFibGVOYW1lLmNoYXJDb2RlQXQoMykgJiAweGZmOwogICAgICAgICAgICB2YXIgY2hlY2tzdW0gPSAwOwoKICAgICAgICAgICAgZm9yIChqID0gdGFibGVPZmZzZXRzW2ldLCBqaiA9IHRhYmxlT2Zmc2V0c1tpICsgMV07IGogPCBqajsgaiArPSA0KSB7CiAgICAgICAgICAgICAgdmFyIHF1YWQgPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZmlsZSwgaik7CiAgICAgICAgICAgICAgY2hlY2tzdW0gPSBjaGVja3N1bSArIHF1YWQgPj4+IDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdyaXRlSW50MzIoZmlsZSwgb2Zmc2V0ICsgNCwgY2hlY2tzdW0pOwogICAgICAgICAgICB3cml0ZUludDMyKGZpbGUsIG9mZnNldCArIDgsIHRhYmxlT2Zmc2V0c1tpXSk7CiAgICAgICAgICAgIHdyaXRlSW50MzIoZmlsZSwgb2Zmc2V0ICsgMTIsIHRhYmxlc1t0YWJsZU5hbWVdLmxlbmd0aCk7CiAgICAgICAgICAgIG9mZnNldCArPSBPVEZfVEFCTEVfRU5UUllfU0laRTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gZmlsZTsKICAgICAgICB9LAogICAgICAgIGFkZFRhYmxlOiBmdW5jdGlvbiBPcGVuVHlwZUZpbGVCdWlsZGVyX2FkZFRhYmxlKHRhZywgZGF0YSkgewogICAgICAgICAgaWYgKHRhZyBpbiB0aGlzLnRhYmxlcykgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlRhYmxlICIgKyB0YWcgKyAiIGFscmVhZHkgZXhpc3RzIik7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy50YWJsZXNbdGFnXSA9IGRhdGE7CiAgICAgICAgfQogICAgICB9OwogICAgICByZXR1cm4gT3BlblR5cGVGaWxlQnVpbGRlcjsKICAgIH0oKTsKCiAgICB2YXIgRm9udCA9IGZ1bmN0aW9uIEZvbnRDbG9zdXJlKCkgewogICAgICBmdW5jdGlvbiBGb250KG5hbWUsIGZpbGUsIHByb3BlcnRpZXMpIHsKICAgICAgICB2YXIgY2hhckNvZGU7CiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTsKICAgICAgICB0aGlzLmxvYWRlZE5hbWUgPSBwcm9wZXJ0aWVzLmxvYWRlZE5hbWU7CiAgICAgICAgdGhpcy5pc1R5cGUzRm9udCA9IHByb3BlcnRpZXMuaXNUeXBlM0ZvbnQ7CiAgICAgICAgdGhpcy5zaXplcyA9IFtdOwogICAgICAgIHRoaXMubWlzc2luZ0ZpbGUgPSBmYWxzZTsKICAgICAgICB0aGlzLmdseXBoQ2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgIHRoaXMuaXNTZXJpZkZvbnQgPSAhIShwcm9wZXJ0aWVzLmZsYWdzICYgRm9udEZsYWdzLlNlcmlmKTsKICAgICAgICB0aGlzLmlzU3ltYm9saWNGb250ID0gISEocHJvcGVydGllcy5mbGFncyAmIEZvbnRGbGFncy5TeW1ib2xpYyk7CiAgICAgICAgdGhpcy5pc01vbm9zcGFjZSA9ICEhKHByb3BlcnRpZXMuZmxhZ3MgJiBGb250RmxhZ3MuRml4ZWRQaXRjaCk7CiAgICAgICAgdmFyIHR5cGUgPSBwcm9wZXJ0aWVzLnR5cGU7CiAgICAgICAgdmFyIHN1YnR5cGUgPSBwcm9wZXJ0aWVzLnN1YnR5cGU7CiAgICAgICAgdGhpcy50eXBlID0gdHlwZTsKICAgICAgICB0aGlzLnN1YnR5cGUgPSBzdWJ0eXBlOwogICAgICAgIHZhciBmYWxsYmFja05hbWUgPSAic2Fucy1zZXJpZiI7CgogICAgICAgIGlmICh0aGlzLmlzTW9ub3NwYWNlKSB7CiAgICAgICAgICBmYWxsYmFja05hbWUgPSAibW9ub3NwYWNlIjsKICAgICAgICB9IGVsc2UgaWYgKHRoaXMuaXNTZXJpZkZvbnQpIHsKICAgICAgICAgIGZhbGxiYWNrTmFtZSA9ICJzZXJpZiI7CiAgICAgICAgfQoKICAgICAgICB0aGlzLmZhbGxiYWNrTmFtZSA9IGZhbGxiYWNrTmFtZTsKICAgICAgICB0aGlzLmRpZmZlcmVuY2VzID0gcHJvcGVydGllcy5kaWZmZXJlbmNlczsKICAgICAgICB0aGlzLndpZHRocyA9IHByb3BlcnRpZXMud2lkdGhzOwogICAgICAgIHRoaXMuZGVmYXVsdFdpZHRoID0gcHJvcGVydGllcy5kZWZhdWx0V2lkdGg7CiAgICAgICAgdGhpcy5jb21wb3NpdGUgPSBwcm9wZXJ0aWVzLmNvbXBvc2l0ZTsKICAgICAgICB0aGlzLndpZGVDaGFycyA9IHByb3BlcnRpZXMud2lkZUNoYXJzOwogICAgICAgIHRoaXMuY01hcCA9IHByb3BlcnRpZXMuY01hcDsKICAgICAgICB0aGlzLmFzY2VudCA9IHByb3BlcnRpZXMuYXNjZW50IC8gUERGX0dMWVBIX1NQQUNFX1VOSVRTOwogICAgICAgIHRoaXMuZGVzY2VudCA9IHByb3BlcnRpZXMuZGVzY2VudCAvIFBERl9HTFlQSF9TUEFDRV9VTklUUzsKICAgICAgICB0aGlzLmZvbnRNYXRyaXggPSBwcm9wZXJ0aWVzLmZvbnRNYXRyaXg7CiAgICAgICAgdGhpcy5iYm94ID0gcHJvcGVydGllcy5iYm94OwogICAgICAgIHRoaXMuZGVmYXVsdEVuY29kaW5nID0gcHJvcGVydGllcy5kZWZhdWx0RW5jb2Rpbmc7CiAgICAgICAgdGhpcy50b1VuaWNvZGUgPSBwcm9wZXJ0aWVzLnRvVW5pY29kZTsKICAgICAgICB0aGlzLmZhbGxiYWNrVG9Vbmljb2RlID0gcHJvcGVydGllcy5mYWxsYmFja1RvVW5pY29kZSB8fCBuZXcgVG9Vbmljb2RlTWFwKCk7CiAgICAgICAgdGhpcy50b0ZvbnRDaGFyID0gW107CgogICAgICAgIGlmIChwcm9wZXJ0aWVzLnR5cGUgPT09ICJUeXBlMyIpIHsKICAgICAgICAgIGZvciAoY2hhckNvZGUgPSAwOyBjaGFyQ29kZSA8IDI1NjsgY2hhckNvZGUrKykgewogICAgICAgICAgICB0aGlzLnRvRm9udENoYXJbY2hhckNvZGVdID0gdGhpcy5kaWZmZXJlbmNlc1tjaGFyQ29kZV0gfHwgcHJvcGVydGllcy5kZWZhdWx0RW5jb2RpbmdbY2hhckNvZGVdOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuZm9udFR5cGUgPSBfdXRpbC5Gb250VHlwZS5UWVBFMzsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHRoaXMuY2lkRW5jb2RpbmcgPSBwcm9wZXJ0aWVzLmNpZEVuY29kaW5nOwogICAgICAgIHRoaXMudmVydGljYWwgPSBwcm9wZXJ0aWVzLnZlcnRpY2FsOwoKICAgICAgICBpZiAodGhpcy52ZXJ0aWNhbCkgewogICAgICAgICAgdGhpcy52bWV0cmljcyA9IHByb3BlcnRpZXMudm1ldHJpY3M7CiAgICAgICAgICB0aGlzLmRlZmF1bHRWTWV0cmljcyA9IHByb3BlcnRpZXMuZGVmYXVsdFZNZXRyaWNzOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFmaWxlIHx8IGZpbGUuaXNFbXB0eSkgewogICAgICAgICAgaWYgKGZpbGUpIHsKICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCdGb250IGZpbGUgaXMgZW1wdHkgaW4gIicgKyBuYW1lICsgJyIgKCcgKyB0aGlzLmxvYWRlZE5hbWUgKyAiKSIpOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuZmFsbGJhY2tUb1N5c3RlbUZvbnQoKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBfZ2V0Rm9udEZpbGVUeXBlID0gZ2V0Rm9udEZpbGVUeXBlKGZpbGUsIHByb3BlcnRpZXMpOwoKICAgICAgICB2YXIgX2dldEZvbnRGaWxlVHlwZTIgPSBfc2xpY2VkVG9BcnJheShfZ2V0Rm9udEZpbGVUeXBlLCAyKTsKCiAgICAgICAgdHlwZSA9IF9nZXRGb250RmlsZVR5cGUyWzBdOwogICAgICAgIHN1YnR5cGUgPSBfZ2V0Rm9udEZpbGVUeXBlMlsxXTsKCiAgICAgICAgaWYgKHR5cGUgIT09IHRoaXMudHlwZSB8fCBzdWJ0eXBlICE9PSB0aGlzLnN1YnR5cGUpIHsKICAgICAgICAgICgwLCBfdXRpbC5pbmZvKSgiSW5jb25zaXN0ZW50IGZvbnQgZmlsZSBUeXBlL1N1YlR5cGUsIGV4cGVjdGVkOiAiICsgIiIuY29uY2F0KHRoaXMudHlwZSwgIi8iKS5jb25jYXQodGhpcy5zdWJ0eXBlLCAiIGJ1dCBmb3VuZDogIikuY29uY2F0KHR5cGUsICIvIikuY29uY2F0KHN1YnR5cGUsICIuIikpOwogICAgICAgIH0KCiAgICAgICAgdHJ5IHsKICAgICAgICAgIHZhciBkYXRhOwoKICAgICAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgICAgICBjYXNlICJNTVR5cGUxIjoKICAgICAgICAgICAgICAoMCwgX3V0aWwuaW5mbykoIk1NVHlwZTEgZm9udCAoIiArIG5hbWUgKyAiKSwgZmFsbGluZyBiYWNrIHRvIFR5cGUxLiIpOwoKICAgICAgICAgICAgY2FzZSAiVHlwZTEiOgogICAgICAgICAgICBjYXNlICJDSURGb250VHlwZTAiOgogICAgICAgICAgICAgIHRoaXMubWltZXR5cGUgPSAiZm9udC9vcGVudHlwZSI7CiAgICAgICAgICAgICAgdmFyIGNmZiA9IHN1YnR5cGUgPT09ICJUeXBlMUMiIHx8IHN1YnR5cGUgPT09ICJDSURGb250VHlwZTBDIiA/IG5ldyBDRkZGb250KGZpbGUsIHByb3BlcnRpZXMpIDogbmV3IFR5cGUxRm9udChuYW1lLCBmaWxlLCBwcm9wZXJ0aWVzKTsKICAgICAgICAgICAgICBhZGp1c3RXaWR0aHMocHJvcGVydGllcyk7CiAgICAgICAgICAgICAgZGF0YSA9IHRoaXMuY29udmVydChuYW1lLCBjZmYsIHByb3BlcnRpZXMpOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAiT3BlblR5cGUiOgogICAgICAgICAgICBjYXNlICJUcnVlVHlwZSI6CiAgICAgICAgICAgIGNhc2UgIkNJREZvbnRUeXBlMiI6CiAgICAgICAgICAgICAgdGhpcy5taW1ldHlwZSA9ICJmb250L29wZW50eXBlIjsKICAgICAgICAgICAgICBkYXRhID0gdGhpcy5jaGVja0FuZFJlcGFpcihuYW1lLCBmaWxlLCBwcm9wZXJ0aWVzKTsKCiAgICAgICAgICAgICAgaWYgKHRoaXMuaXNPcGVuVHlwZSkgewogICAgICAgICAgICAgICAgYWRqdXN0V2lkdGhzKHByb3BlcnRpZXMpOwogICAgICAgICAgICAgICAgdHlwZSA9ICJPcGVuVHlwZSI7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJGb250ICIuY29uY2F0KHR5cGUsICIgaXMgbm90IHN1cHBvcnRlZCIpKTsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAoMCwgX3V0aWwud2FybikoZSk7CiAgICAgICAgICB0aGlzLmZhbGxiYWNrVG9TeXN0ZW1Gb250KCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB0aGlzLmRhdGEgPSBkYXRhOwogICAgICAgIHRoaXMuZm9udFR5cGUgPSBnZXRGb250VHlwZSh0eXBlLCBzdWJ0eXBlKTsKICAgICAgICB0aGlzLmZvbnRNYXRyaXggPSBwcm9wZXJ0aWVzLmZvbnRNYXRyaXg7CiAgICAgICAgdGhpcy53aWR0aHMgPSBwcm9wZXJ0aWVzLndpZHRoczsKICAgICAgICB0aGlzLmRlZmF1bHRXaWR0aCA9IHByb3BlcnRpZXMuZGVmYXVsdFdpZHRoOwogICAgICAgIHRoaXMudG9Vbmljb2RlID0gcHJvcGVydGllcy50b1VuaWNvZGU7CiAgICAgICAgdGhpcy5lbmNvZGluZyA9IHByb3BlcnRpZXMuYmFzZUVuY29kaW5nOwogICAgICAgIHRoaXMuc2VhY01hcCA9IHByb3BlcnRpZXMuc2VhY01hcDsKICAgICAgfQoKICAgICAgRm9udC5nZXRGb250SUQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIElEID0gMTsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gRm9udF9nZXRGb250SUQoKSB7CiAgICAgICAgICByZXR1cm4gU3RyaW5nKElEKyspOwogICAgICAgIH07CiAgICAgIH0oKTsKCiAgICAgIGZ1bmN0aW9uIGludDE2KGIwLCBiMSkgewogICAgICAgIHJldHVybiAoYjAgPDwgOCkgKyBiMTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gd3JpdGVTaWduZWRJbnQxNihieXRlcywgaW5kZXgsIHZhbHVlKSB7CiAgICAgICAgYnl0ZXNbaW5kZXggKyAxXSA9IHZhbHVlOwogICAgICAgIGJ5dGVzW2luZGV4XSA9IHZhbHVlID4+PiA4OwogICAgICB9CgogICAgICBmdW5jdGlvbiBzaWduZWRJbnQxNihiMCwgYjEpIHsKICAgICAgICB2YXIgdmFsdWUgPSAoYjAgPDwgOCkgKyBiMTsKICAgICAgICByZXR1cm4gdmFsdWUgJiAxIDw8IDE1ID8gdmFsdWUgLSAweDEwMDAwIDogdmFsdWU7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGludDMyKGIwLCBiMSwgYjIsIGIzKSB7CiAgICAgICAgcmV0dXJuIChiMCA8PCAyNCkgKyAoYjEgPDwgMTYpICsgKGIyIDw8IDgpICsgYjM7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHN0cmluZzE2KHZhbHVlKSB7CiAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUodmFsdWUgPj4gOCAmIDB4ZmYsIHZhbHVlICYgMHhmZik7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHNhZmVTdHJpbmcxNih2YWx1ZSkgewogICAgICAgIGlmICh2YWx1ZSA+IDB4N2ZmZikgewogICAgICAgICAgdmFsdWUgPSAweDdmZmY7CiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA8IC0weDgwMDApIHsKICAgICAgICAgIHZhbHVlID0gLTB4ODAwMDsKICAgICAgICB9CgogICAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKHZhbHVlID4+IDggJiAweGZmLCB2YWx1ZSAmIDB4ZmYpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBpc1RydWVUeXBlRmlsZShmaWxlKSB7CiAgICAgICAgdmFyIGhlYWRlciA9IGZpbGUucGVla0J5dGVzKDQpOwogICAgICAgIHJldHVybiAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoaGVhZGVyLCAwKSA9PT0gMHgwMDAxMDAwMCB8fCAoMCwgX3V0aWwuYnl0ZXNUb1N0cmluZykoaGVhZGVyKSA9PT0gInRydWUiOwogICAgICB9CgogICAgICBmdW5jdGlvbiBpc1RydWVUeXBlQ29sbGVjdGlvbkZpbGUoZmlsZSkgewogICAgICAgIHZhciBoZWFkZXIgPSBmaWxlLnBlZWtCeXRlcyg0KTsKICAgICAgICByZXR1cm4gKDAsIF91dGlsLmJ5dGVzVG9TdHJpbmcpKGhlYWRlcikgPT09ICJ0dGNmIjsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gaXNPcGVuVHlwZUZpbGUoZmlsZSkgewogICAgICAgIHZhciBoZWFkZXIgPSBmaWxlLnBlZWtCeXRlcyg0KTsKICAgICAgICByZXR1cm4gKDAsIF91dGlsLmJ5dGVzVG9TdHJpbmcpKGhlYWRlcikgPT09ICJPVFRPIjsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gaXNUeXBlMUZpbGUoZmlsZSkgewogICAgICAgIHZhciBoZWFkZXIgPSBmaWxlLnBlZWtCeXRlcygyKTsKCiAgICAgICAgaWYgKGhlYWRlclswXSA9PT0gMHgyNSAmJiBoZWFkZXJbMV0gPT09IDB4MjEpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgaWYgKGhlYWRlclswXSA9PT0gMHg4MCAmJiBoZWFkZXJbMV0gPT09IDB4MDEpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICBmdW5jdGlvbiBpc0NGRkZpbGUoZmlsZSkgewogICAgICAgIHZhciBoZWFkZXIgPSBmaWxlLnBlZWtCeXRlcyg0KTsKCiAgICAgICAgaWYgKGhlYWRlclswXSA+PSAxICYmIGhlYWRlclszXSA+PSAxICYmIGhlYWRlclszXSA8PSA0KSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZ2V0Rm9udEZpbGVUeXBlKGZpbGUsIF9yZWYpIHsKICAgICAgICB2YXIgdHlwZSA9IF9yZWYudHlwZSwKICAgICAgICAgIHN1YnR5cGUgPSBfcmVmLnN1YnR5cGUsCiAgICAgICAgICBjb21wb3NpdGUgPSBfcmVmLmNvbXBvc2l0ZTsKICAgICAgICB2YXIgZmlsZVR5cGUsIGZpbGVTdWJ0eXBlOwoKICAgICAgICBpZiAoaXNUcnVlVHlwZUZpbGUoZmlsZSkgfHwgaXNUcnVlVHlwZUNvbGxlY3Rpb25GaWxlKGZpbGUpKSB7CiAgICAgICAgICBpZiAoY29tcG9zaXRlKSB7CiAgICAgICAgICAgIGZpbGVUeXBlID0gIkNJREZvbnRUeXBlMiI7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmaWxlVHlwZSA9ICJUcnVlVHlwZSI7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChpc09wZW5UeXBlRmlsZShmaWxlKSkgewogICAgICAgICAgaWYgKGNvbXBvc2l0ZSkgewogICAgICAgICAgICBmaWxlVHlwZSA9ICJDSURGb250VHlwZTIiOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZmlsZVR5cGUgPSAiT3BlblR5cGUiOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoaXNUeXBlMUZpbGUoZmlsZSkpIHsKICAgICAgICAgIGlmIChjb21wb3NpdGUpIHsKICAgICAgICAgICAgZmlsZVR5cGUgPSAiQ0lERm9udFR5cGUwIjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGZpbGVUeXBlID0gdHlwZSA9PT0gIk1NVHlwZTEiID8gIk1NVHlwZTEiIDogIlR5cGUxIjsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGlzQ0ZGRmlsZShmaWxlKSkgewogICAgICAgICAgaWYgKGNvbXBvc2l0ZSkgewogICAgICAgICAgICBmaWxlVHlwZSA9ICJDSURGb250VHlwZTAiOwogICAgICAgICAgICBmaWxlU3VidHlwZSA9ICJDSURGb250VHlwZTBDIjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGZpbGVUeXBlID0gdHlwZSA9PT0gIk1NVHlwZTEiID8gIk1NVHlwZTEiIDogIlR5cGUxIjsKICAgICAgICAgICAgZmlsZVN1YnR5cGUgPSAiVHlwZTFDIjsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJnZXRGb250RmlsZVR5cGU6IFVuYWJsZSB0byBkZXRlY3QgY29ycmVjdCBmb250IGZpbGUgVHlwZS9TdWJ0eXBlLiIpOwogICAgICAgICAgZmlsZVR5cGUgPSB0eXBlOwogICAgICAgICAgZmlsZVN1YnR5cGUgPSBzdWJ0eXBlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIFtmaWxlVHlwZSwgZmlsZVN1YnR5cGVdOwogICAgICB9CgogICAgICBmdW5jdGlvbiBidWlsZFRvRm9udENoYXIoZW5jb2RpbmcsIGdseXBoc1VuaWNvZGVNYXAsIGRpZmZlcmVuY2VzKSB7CiAgICAgICAgdmFyIHRvRm9udENoYXIgPSBbXSwKICAgICAgICAgIHVuaWNvZGU7CgogICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGVuY29kaW5nLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgIHVuaWNvZGUgPSAoMCwgX3VuaWNvZGUuZ2V0VW5pY29kZUZvckdseXBoKShlbmNvZGluZ1tpXSwgZ2x5cGhzVW5pY29kZU1hcCk7CgogICAgICAgICAgaWYgKHVuaWNvZGUgIT09IC0xKSB7CiAgICAgICAgICAgIHRvRm9udENoYXJbaV0gPSB1bmljb2RlOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZm9yICh2YXIgY2hhckNvZGUgaW4gZGlmZmVyZW5jZXMpIHsKICAgICAgICAgIHVuaWNvZGUgPSAoMCwgX3VuaWNvZGUuZ2V0VW5pY29kZUZvckdseXBoKShkaWZmZXJlbmNlc1tjaGFyQ29kZV0sIGdseXBoc1VuaWNvZGVNYXApOwoKICAgICAgICAgIGlmICh1bmljb2RlICE9PSAtMSkgewogICAgICAgICAgICB0b0ZvbnRDaGFyWytjaGFyQ29kZV0gPSB1bmljb2RlOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRvRm9udENoYXI7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGFkanVzdE1hcHBpbmcoY2hhckNvZGVUb0dseXBoSWQsIGhhc0dseXBoLCBuZXdHbHlwaFplcm9JZCkgewogICAgICAgIHZhciBuZXdNYXAgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgIHZhciB0b0ZvbnRDaGFyID0gW107CiAgICAgICAgdmFyIHByaXZhdGVVc2VBcmVhSW5kZXggPSAwOwogICAgICAgIHZhciBuZXh0QXZhaWxhYmxlRm9udENoYXJDb2RlID0gUFJJVkFURV9VU0VfQVJFQVNbcHJpdmF0ZVVzZUFyZWFJbmRleF1bMF07CiAgICAgICAgdmFyIHByaXZhdGVVc2VPZmZldEVuZCA9IFBSSVZBVEVfVVNFX0FSRUFTW3ByaXZhdGVVc2VBcmVhSW5kZXhdWzFdOwoKICAgICAgICBmb3IgKHZhciBvcmlnaW5hbENoYXJDb2RlIGluIGNoYXJDb2RlVG9HbHlwaElkKSB7CiAgICAgICAgICBvcmlnaW5hbENoYXJDb2RlIHw9IDA7CiAgICAgICAgICB2YXIgZ2x5cGhJZCA9IGNoYXJDb2RlVG9HbHlwaElkW29yaWdpbmFsQ2hhckNvZGVdOwoKICAgICAgICAgIGlmICghaGFzR2x5cGgoZ2x5cGhJZCkpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKG5leHRBdmFpbGFibGVGb250Q2hhckNvZGUgPiBwcml2YXRlVXNlT2ZmZXRFbmQpIHsKICAgICAgICAgICAgcHJpdmF0ZVVzZUFyZWFJbmRleCsrOwoKICAgICAgICAgICAgaWYgKHByaXZhdGVVc2VBcmVhSW5kZXggPj0gUFJJVkFURV9VU0VfQVJFQVMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJSYW4gb3V0IG9mIHNwYWNlIGluIGZvbnQgcHJpdmF0ZSB1c2UgYXJlYS4iKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbmV4dEF2YWlsYWJsZUZvbnRDaGFyQ29kZSA9IFBSSVZBVEVfVVNFX0FSRUFTW3ByaXZhdGVVc2VBcmVhSW5kZXhdWzBdOwogICAgICAgICAgICBwcml2YXRlVXNlT2ZmZXRFbmQgPSBQUklWQVRFX1VTRV9BUkVBU1twcml2YXRlVXNlQXJlYUluZGV4XVsxXTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZm9udENoYXJDb2RlID0gbmV4dEF2YWlsYWJsZUZvbnRDaGFyQ29kZSsrOwoKICAgICAgICAgIGlmIChnbHlwaElkID09PSAwKSB7CiAgICAgICAgICAgIGdseXBoSWQgPSBuZXdHbHlwaFplcm9JZDsKICAgICAgICAgIH0KCiAgICAgICAgICBuZXdNYXBbZm9udENoYXJDb2RlXSA9IGdseXBoSWQ7CiAgICAgICAgICB0b0ZvbnRDaGFyW29yaWdpbmFsQ2hhckNvZGVdID0gZm9udENoYXJDb2RlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHRvRm9udENoYXI6IHRvRm9udENoYXIsCiAgICAgICAgICBjaGFyQ29kZVRvR2x5cGhJZDogbmV3TWFwLAogICAgICAgICAgbmV4dEF2YWlsYWJsZUZvbnRDaGFyQ29kZTogbmV4dEF2YWlsYWJsZUZvbnRDaGFyQ29kZQogICAgICAgIH07CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGdldFJhbmdlcyhnbHlwaHMsIG51bUdseXBocykgewogICAgICAgIHZhciBjb2RlcyA9IFtdOwoKICAgICAgICBmb3IgKHZhciBjaGFyQ29kZSBpbiBnbHlwaHMpIHsKICAgICAgICAgIGlmIChnbHlwaHNbY2hhckNvZGVdID49IG51bUdseXBocykgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb2Rlcy5wdXNoKHsKICAgICAgICAgICAgZm9udENoYXJDb2RlOiBjaGFyQ29kZSB8IDAsCiAgICAgICAgICAgIGdseXBoSWQ6IGdseXBoc1tjaGFyQ29kZV0KICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNvZGVzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgY29kZXMucHVzaCh7CiAgICAgICAgICAgIGZvbnRDaGFyQ29kZTogMCwKICAgICAgICAgICAgZ2x5cGhJZDogMAogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBjb2Rlcy5zb3J0KGZ1bmN0aW9uIGZvbnRHZXRSYW5nZXNTb3J0KGEsIGIpIHsKICAgICAgICAgIHJldHVybiBhLmZvbnRDaGFyQ29kZSAtIGIuZm9udENoYXJDb2RlOwogICAgICAgIH0pOwogICAgICAgIHZhciByYW5nZXMgPSBbXTsKICAgICAgICB2YXIgbGVuZ3RoID0gY29kZXMubGVuZ3RoOwoKICAgICAgICBmb3IgKHZhciBuID0gMDsgbiA8IGxlbmd0aDspIHsKICAgICAgICAgIHZhciBzdGFydCA9IGNvZGVzW25dLmZvbnRDaGFyQ29kZTsKICAgICAgICAgIHZhciBjb2RlSW5kaWNlcyA9IFtjb2Rlc1tuXS5nbHlwaElkXTsKICAgICAgICAgICsrbjsKICAgICAgICAgIHZhciBlbmQgPSBzdGFydDsKCiAgICAgICAgICB3aGlsZSAobiA8IGxlbmd0aCAmJiBlbmQgKyAxID09PSBjb2Rlc1tuXS5mb250Q2hhckNvZGUpIHsKICAgICAgICAgICAgY29kZUluZGljZXMucHVzaChjb2Rlc1tuXS5nbHlwaElkKTsKICAgICAgICAgICAgKytlbmQ7CiAgICAgICAgICAgICsrbjsKCiAgICAgICAgICAgIGlmIChlbmQgPT09IDB4ZmZmZikgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcmFuZ2VzLnB1c2goW3N0YXJ0LCBlbmQsIGNvZGVJbmRpY2VzXSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmFuZ2VzOwogICAgICB9CgogICAgICBmdW5jdGlvbiBjcmVhdGVDbWFwVGFibGUoZ2x5cGhzLCBudW1HbHlwaHMpIHsKICAgICAgICB2YXIgcmFuZ2VzID0gZ2V0UmFuZ2VzKGdseXBocywgbnVtR2x5cGhzKTsKICAgICAgICB2YXIgbnVtVGFibGVzID0gcmFuZ2VzW3Jhbmdlcy5sZW5ndGggLSAxXVsxXSA+IDB4ZmZmZiA/IDIgOiAxOwogICAgICAgIHZhciBjbWFwID0gIlx4MDBceDAwIiArIHN0cmluZzE2KG51bVRhYmxlcykgKyAiXHgwMFx4MDMiICsgIlx4MDBceDAxIiArICgwLCBfdXRpbC5zdHJpbmczMikoNCArIG51bVRhYmxlcyAqIDgpOwogICAgICAgIHZhciBpLCBpaSwgaiwgamo7CgogICAgICAgIGZvciAoaSA9IHJhbmdlcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkgewogICAgICAgICAgaWYgKHJhbmdlc1tpXVswXSA8PSAweGZmZmYpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YXIgYm1wTGVuZ3RoID0gaSArIDE7CgogICAgICAgIGlmIChyYW5nZXNbaV1bMF0gPCAweGZmZmYgJiYgcmFuZ2VzW2ldWzFdID09PSAweGZmZmYpIHsKICAgICAgICAgIHJhbmdlc1tpXVsxXSA9IDB4ZmZmZTsKICAgICAgICB9CgogICAgICAgIHZhciB0cmFpbGluZ1Jhbmdlc0NvdW50ID0gcmFuZ2VzW2ldWzFdIDwgMHhmZmZmID8gMSA6IDA7CiAgICAgICAgdmFyIHNlZ0NvdW50ID0gYm1wTGVuZ3RoICsgdHJhaWxpbmdSYW5nZXNDb3VudDsKICAgICAgICB2YXIgc2VhcmNoUGFyYW1zID0gT3BlblR5cGVGaWxlQnVpbGRlci5nZXRTZWFyY2hQYXJhbXMoc2VnQ291bnQsIDIpOwogICAgICAgIHZhciBzdGFydENvdW50ID0gIiI7CiAgICAgICAgdmFyIGVuZENvdW50ID0gIiI7CiAgICAgICAgdmFyIGlkRGVsdGFzID0gIiI7CiAgICAgICAgdmFyIGlkUmFuZ2VPZmZzZXRzID0gIiI7CiAgICAgICAgdmFyIGdseXBoc0lkcyA9ICIiOwogICAgICAgIHZhciBiaWFzID0gMDsKICAgICAgICB2YXIgcmFuZ2UsIHN0YXJ0LCBlbmQsIGNvZGVzOwoKICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGJtcExlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgIHJhbmdlID0gcmFuZ2VzW2ldOwogICAgICAgICAgc3RhcnQgPSByYW5nZVswXTsKICAgICAgICAgIGVuZCA9IHJhbmdlWzFdOwogICAgICAgICAgc3RhcnRDb3VudCArPSBzdHJpbmcxNihzdGFydCk7CiAgICAgICAgICBlbmRDb3VudCArPSBzdHJpbmcxNihlbmQpOwogICAgICAgICAgY29kZXMgPSByYW5nZVsyXTsKICAgICAgICAgIHZhciBjb250aWd1b3VzID0gdHJ1ZTsKCiAgICAgICAgICBmb3IgKGogPSAxLCBqaiA9IGNvZGVzLmxlbmd0aDsgaiA8IGpqOyArK2opIHsKICAgICAgICAgICAgaWYgKGNvZGVzW2pdICE9PSBjb2Rlc1tqIC0gMV0gKyAxKSB7CiAgICAgICAgICAgICAgY29udGlndW91cyA9IGZhbHNlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCFjb250aWd1b3VzKSB7CiAgICAgICAgICAgIHZhciBvZmZzZXQgPSAoc2VnQ291bnQgLSBpKSAqIDIgKyBiaWFzICogMjsKICAgICAgICAgICAgYmlhcyArPSBlbmQgLSBzdGFydCArIDE7CiAgICAgICAgICAgIGlkRGVsdGFzICs9IHN0cmluZzE2KDApOwogICAgICAgICAgICBpZFJhbmdlT2Zmc2V0cyArPSBzdHJpbmcxNihvZmZzZXQpOwoKICAgICAgICAgICAgZm9yIChqID0gMCwgamogPSBjb2Rlcy5sZW5ndGg7IGogPCBqajsgKytqKSB7CiAgICAgICAgICAgICAgZ2x5cGhzSWRzICs9IHN0cmluZzE2KGNvZGVzW2pdKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIHN0YXJ0Q29kZSA9IGNvZGVzWzBdOwogICAgICAgICAgICBpZERlbHRhcyArPSBzdHJpbmcxNihzdGFydENvZGUgLSBzdGFydCAmIDB4ZmZmZik7CiAgICAgICAgICAgIGlkUmFuZ2VPZmZzZXRzICs9IHN0cmluZzE2KDApOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHRyYWlsaW5nUmFuZ2VzQ291bnQgPiAwKSB7CiAgICAgICAgICBlbmRDb3VudCArPSAiXHhGRlx4RkYiOwogICAgICAgICAgc3RhcnRDb3VudCArPSAiXHhGRlx4RkYiOwogICAgICAgICAgaWREZWx0YXMgKz0gIlx4MDBceDAxIjsKICAgICAgICAgIGlkUmFuZ2VPZmZzZXRzICs9ICJceDAwXHgwMCI7CiAgICAgICAgfQoKICAgICAgICB2YXIgZm9ybWF0MzE0ID0gIlx4MDBceDAwIiArIHN0cmluZzE2KDIgKiBzZWdDb3VudCkgKyBzdHJpbmcxNihzZWFyY2hQYXJhbXMucmFuZ2UpICsgc3RyaW5nMTYoc2VhcmNoUGFyYW1zLmVudHJ5KSArIHN0cmluZzE2KHNlYXJjaFBhcmFtcy5yYW5nZVNoaWZ0KSArIGVuZENvdW50ICsgIlx4MDBceDAwIiArIHN0YXJ0Q291bnQgKyBpZERlbHRhcyArIGlkUmFuZ2VPZmZzZXRzICsgZ2x5cGhzSWRzOwogICAgICAgIHZhciBmb3JtYXQzMTAxMiA9ICIiOwogICAgICAgIHZhciBoZWFkZXIzMTAxMiA9ICIiOwoKICAgICAgICBpZiAobnVtVGFibGVzID4gMSkgewogICAgICAgICAgY21hcCArPSAiXHgwMFx4MDMiICsgIlx4MDBceDBBIiArICgwLCBfdXRpbC5zdHJpbmczMikoNCArIG51bVRhYmxlcyAqIDggKyA0ICsgZm9ybWF0MzE0Lmxlbmd0aCk7CiAgICAgICAgICBmb3JtYXQzMTAxMiA9ICIiOwoKICAgICAgICAgIGZvciAoaSA9IDAsIGlpID0gcmFuZ2VzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgcmFuZ2UgPSByYW5nZXNbaV07CiAgICAgICAgICAgIHN0YXJ0ID0gcmFuZ2VbMF07CiAgICAgICAgICAgIGNvZGVzID0gcmFuZ2VbMl07CiAgICAgICAgICAgIHZhciBjb2RlID0gY29kZXNbMF07CgogICAgICAgICAgICBmb3IgKGogPSAxLCBqaiA9IGNvZGVzLmxlbmd0aDsgaiA8IGpqOyArK2opIHsKICAgICAgICAgICAgICBpZiAoY29kZXNbal0gIT09IGNvZGVzW2ogLSAxXSArIDEpIHsKICAgICAgICAgICAgICAgIGVuZCA9IHJhbmdlWzBdICsgaiAtIDE7CiAgICAgICAgICAgICAgICBmb3JtYXQzMTAxMiArPSAoMCwgX3V0aWwuc3RyaW5nMzIpKHN0YXJ0KSArICgwLCBfdXRpbC5zdHJpbmczMikoZW5kKSArICgwLCBfdXRpbC5zdHJpbmczMikoY29kZSk7CiAgICAgICAgICAgICAgICBzdGFydCA9IGVuZCArIDE7CiAgICAgICAgICAgICAgICBjb2RlID0gY29kZXNbal07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBmb3JtYXQzMTAxMiArPSAoMCwgX3V0aWwuc3RyaW5nMzIpKHN0YXJ0KSArICgwLCBfdXRpbC5zdHJpbmczMikocmFuZ2VbMV0pICsgKDAsIF91dGlsLnN0cmluZzMyKShjb2RlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBoZWFkZXIzMTAxMiA9ICJceDAwXHgwQyIgKyAiXHgwMFx4MDAiICsgKDAsIF91dGlsLnN0cmluZzMyKShmb3JtYXQzMTAxMi5sZW5ndGggKyAxNikgKyAiXHgwMFx4MDBceDAwXHgwMCIgKyAoMCwgX3V0aWwuc3RyaW5nMzIpKGZvcm1hdDMxMDEyLmxlbmd0aCAvIDEyKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBjbWFwICsgIlx4MDBceDA0IiArIHN0cmluZzE2KGZvcm1hdDMxNC5sZW5ndGggKyA0KSArIGZvcm1hdDMxNCArIGhlYWRlcjMxMDEyICsgZm9ybWF0MzEwMTI7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHZhbGlkYXRlT1MyVGFibGUob3MyKSB7CiAgICAgICAgdmFyIHN0cmVhbSA9IG5ldyBfc3RyZWFtLlN0cmVhbShvczIuZGF0YSk7CiAgICAgICAgdmFyIHZlcnNpb24gPSBzdHJlYW0uZ2V0VWludDE2KCk7CiAgICAgICAgc3RyZWFtLmdldEJ5dGVzKDYwKTsKICAgICAgICB2YXIgc2VsZWN0aW9uID0gc3RyZWFtLmdldFVpbnQxNigpOwoKICAgICAgICBpZiAodmVyc2lvbiA8IDQgJiYgc2VsZWN0aW9uICYgMHgwMzAwKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICB2YXIgZmlyc3RDaGFyID0gc3RyZWFtLmdldFVpbnQxNigpOwogICAgICAgIHZhciBsYXN0Q2hhciA9IHN0cmVhbS5nZXRVaW50MTYoKTsKCiAgICAgICAgaWYgKGZpcnN0Q2hhciA+IGxhc3RDaGFyKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBzdHJlYW0uZ2V0Qnl0ZXMoNik7CiAgICAgICAgdmFyIHVzV2luQXNjZW50ID0gc3RyZWFtLmdldFVpbnQxNigpOwoKICAgICAgICBpZiAodXNXaW5Bc2NlbnQgPT09IDApIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIG9zMi5kYXRhWzhdID0gb3MyLmRhdGFbOV0gPSAwOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CgogICAgICBmdW5jdGlvbiBjcmVhdGVPUzJUYWJsZShwcm9wZXJ0aWVzLCBjaGFyc3RyaW5ncywgb3ZlcnJpZGUpIHsKICAgICAgICBvdmVycmlkZSA9IG92ZXJyaWRlIHx8IHsKICAgICAgICAgIHVuaXRzUGVyRW06IDAsCiAgICAgICAgICB5TWF4OiAwLAogICAgICAgICAgeU1pbjogMCwKICAgICAgICAgIGFzY2VudDogMCwKICAgICAgICAgIGRlc2NlbnQ6IDAKICAgICAgICB9OwogICAgICAgIHZhciB1bFVuaWNvZGVSYW5nZTEgPSAwOwogICAgICAgIHZhciB1bFVuaWNvZGVSYW5nZTIgPSAwOwogICAgICAgIHZhciB1bFVuaWNvZGVSYW5nZTMgPSAwOwogICAgICAgIHZhciB1bFVuaWNvZGVSYW5nZTQgPSAwOwogICAgICAgIHZhciBmaXJzdENoYXJJbmRleCA9IG51bGw7CiAgICAgICAgdmFyIGxhc3RDaGFySW5kZXggPSAwOwoKICAgICAgICBpZiAoY2hhcnN0cmluZ3MpIHsKICAgICAgICAgIGZvciAodmFyIGNvZGUgaW4gY2hhcnN0cmluZ3MpIHsKICAgICAgICAgICAgY29kZSB8PSAwOwoKICAgICAgICAgICAgaWYgKGZpcnN0Q2hhckluZGV4ID4gY29kZSB8fCAhZmlyc3RDaGFySW5kZXgpIHsKICAgICAgICAgICAgICBmaXJzdENoYXJJbmRleCA9IGNvZGU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChsYXN0Q2hhckluZGV4IDwgY29kZSkgewogICAgICAgICAgICAgIGxhc3RDaGFySW5kZXggPSBjb2RlOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcG9zaXRpb24gPSAoMCwgX3VuaWNvZGUuZ2V0VW5pY29kZVJhbmdlRm9yKShjb2RlKTsKCiAgICAgICAgICAgIGlmIChwb3NpdGlvbiA8IDMyKSB7CiAgICAgICAgICAgICAgdWxVbmljb2RlUmFuZ2UxIHw9IDEgPDwgcG9zaXRpb247CiAgICAgICAgICAgIH0gZWxzZSBpZiAocG9zaXRpb24gPCA2NCkgewogICAgICAgICAgICAgIHVsVW5pY29kZVJhbmdlMiB8PSAxIDw8IHBvc2l0aW9uIC0gMzI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocG9zaXRpb24gPCA5NikgewogICAgICAgICAgICAgIHVsVW5pY29kZVJhbmdlMyB8PSAxIDw8IHBvc2l0aW9uIC0gNjQ7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocG9zaXRpb24gPCAxMjMpIHsKICAgICAgICAgICAgICB1bFVuaWNvZGVSYW5nZTQgfD0gMSA8PCBwb3NpdGlvbiAtIDk2OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiVW5pY29kZSByYW5nZXMgQml0cyA+IDEyMyBhcmUgcmVzZXJ2ZWQgZm9yIGludGVybmFsIHVzYWdlIik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAobGFzdENoYXJJbmRleCA+IDB4ZmZmZikgewogICAgICAgICAgICBsYXN0Q2hhckluZGV4ID0gMHhmZmZmOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmaXJzdENoYXJJbmRleCA9IDA7CiAgICAgICAgICBsYXN0Q2hhckluZGV4ID0gMjU1OwogICAgICAgIH0KCiAgICAgICAgdmFyIGJib3ggPSBwcm9wZXJ0aWVzLmJib3ggfHwgWzAsIDAsIDAsIDBdOwogICAgICAgIHZhciB1bml0c1BlckVtID0gb3ZlcnJpZGUudW5pdHNQZXJFbSB8fCAxIC8gKHByb3BlcnRpZXMuZm9udE1hdHJpeCB8fCBfdXRpbC5GT05UX0lERU5USVRZX01BVFJJWClbMF07CiAgICAgICAgdmFyIHNjYWxlID0gcHJvcGVydGllcy5hc2NlbnRTY2FsZWQgPyAxLjAgOiB1bml0c1BlckVtIC8gUERGX0dMWVBIX1NQQUNFX1VOSVRTOwogICAgICAgIHZhciB0eXBvQXNjZW50ID0gb3ZlcnJpZGUuYXNjZW50IHx8IE1hdGgucm91bmQoc2NhbGUgKiAocHJvcGVydGllcy5hc2NlbnQgfHwgYmJveFszXSkpOwogICAgICAgIHZhciB0eXBvRGVzY2VudCA9IG92ZXJyaWRlLmRlc2NlbnQgfHwgTWF0aC5yb3VuZChzY2FsZSAqIChwcm9wZXJ0aWVzLmRlc2NlbnQgfHwgYmJveFsxXSkpOwoKICAgICAgICBpZiAodHlwb0Rlc2NlbnQgPiAwICYmIHByb3BlcnRpZXMuZGVzY2VudCA+IDAgJiYgYmJveFsxXSA8IDApIHsKICAgICAgICAgIHR5cG9EZXNjZW50ID0gLXR5cG9EZXNjZW50OwogICAgICAgIH0KCiAgICAgICAgdmFyIHdpbkFzY2VudCA9IG92ZXJyaWRlLnlNYXggfHwgdHlwb0FzY2VudDsKICAgICAgICB2YXIgd2luRGVzY2VudCA9IC1vdmVycmlkZS55TWluIHx8IC10eXBvRGVzY2VudDsKICAgICAgICByZXR1cm4gIlx4MDBceDAzIiArICJceDAyXHgyNCIgKyAiXHgwMVx4RjQiICsgIlx4MDBceDA1IiArICJceDAwXHgwMCIgKyAiXHgwMlx4OEEiICsgIlx4MDJceEJCIiArICJceDAwXHgwMCIgKyAiXHgwMFx4OEMiICsgIlx4MDJceDhBIiArICJceDAyXHhCQiIgKyAiXHgwMFx4MDAiICsgIlx4MDFceERGIiArICJceDAwXHgzMSIgKyAiXHgwMVx4MDIiICsgIlx4MDBceDAwIiArICJceDAwXHgwMFx4MDYiICsgU3RyaW5nLmZyb21DaGFyQ29kZShwcm9wZXJ0aWVzLmZpeGVkUGl0Y2ggPyAweDA5IDogMHgwMCkgKyAiXHgwMFx4MDBceDAwXHgwMFx4MDBceDAwIiArICgwLCBfdXRpbC5zdHJpbmczMikodWxVbmljb2RlUmFuZ2UxKSArICgwLCBfdXRpbC5zdHJpbmczMikodWxVbmljb2RlUmFuZ2UyKSArICgwLCBfdXRpbC5zdHJpbmczMikodWxVbmljb2RlUmFuZ2UzKSArICgwLCBfdXRpbC5zdHJpbmczMikodWxVbmljb2RlUmFuZ2U0KSArICJceDJBXHgzMlx4MzFceDJBIiArIHN0cmluZzE2KHByb3BlcnRpZXMuaXRhbGljQW5nbGUgPyAxIDogMCkgKyBzdHJpbmcxNihmaXJzdENoYXJJbmRleCB8fCBwcm9wZXJ0aWVzLmZpcnN0Q2hhcikgKyBzdHJpbmcxNihsYXN0Q2hhckluZGV4IHx8IHByb3BlcnRpZXMubGFzdENoYXIpICsgc3RyaW5nMTYodHlwb0FzY2VudCkgKyBzdHJpbmcxNih0eXBvRGVzY2VudCkgKyAiXHgwMFx4NjQiICsgc3RyaW5nMTYod2luQXNjZW50KSArIHN0cmluZzE2KHdpbkRlc2NlbnQpICsgIlx4MDBceDAwXHgwMFx4MDAiICsgIlx4MDBceDAwXHgwMFx4MDAiICsgc3RyaW5nMTYocHJvcGVydGllcy54SGVpZ2h0KSArIHN0cmluZzE2KHByb3BlcnRpZXMuY2FwSGVpZ2h0KSArIHN0cmluZzE2KDApICsgc3RyaW5nMTYoZmlyc3RDaGFySW5kZXggfHwgcHJvcGVydGllcy5maXJzdENoYXIpICsgIlx4MDBceDAzIjsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gY3JlYXRlUG9zdFRhYmxlKHByb3BlcnRpZXMpIHsKICAgICAgICB2YXIgYW5nbGUgPSBNYXRoLmZsb29yKHByb3BlcnRpZXMuaXRhbGljQW5nbGUgKiBNYXRoLnBvdygyLCAxNikpOwogICAgICAgIHJldHVybiAiXHgwMFx4MDNceDAwXHgwMCIgKyAoMCwgX3V0aWwuc3RyaW5nMzIpKGFuZ2xlKSArICJceDAwXHgwMCIgKyAiXHgwMFx4MDAiICsgKDAsIF91dGlsLnN0cmluZzMyKShwcm9wZXJ0aWVzLmZpeGVkUGl0Y2gpICsgIlx4MDBceDAwXHgwMFx4MDAiICsgIlx4MDBceDAwXHgwMFx4MDAiICsgIlx4MDBceDAwXHgwMFx4MDAiICsgIlx4MDBceDAwXHgwMFx4MDAiOwogICAgICB9CgogICAgICBmdW5jdGlvbiBjcmVhdGVOYW1lVGFibGUobmFtZSwgcHJvdG8pIHsKICAgICAgICBpZiAoIXByb3RvKSB7CiAgICAgICAgICBwcm90byA9IFtbXSwgW11dOwogICAgICAgIH0KCiAgICAgICAgdmFyIHN0cmluZ3MgPSBbcHJvdG9bMF1bMF0gfHwgIk9yaWdpbmFsIGxpY2VuY2UiLCBwcm90b1swXVsxXSB8fCBuYW1lLCBwcm90b1swXVsyXSB8fCAiVW5rbm93biIsIHByb3RvWzBdWzNdIHx8ICJ1bmlxdWVJRCIsIHByb3RvWzBdWzRdIHx8IG5hbWUsIHByb3RvWzBdWzVdIHx8ICJWZXJzaW9uIDAuMTEiLCBwcm90b1swXVs2XSB8fCAiIiwgcHJvdG9bMF1bN10gfHwgIlVua25vd24iLCBwcm90b1swXVs4XSB8fCAiVW5rbm93biIsIHByb3RvWzBdWzldIHx8ICJVbmtub3duIl07CiAgICAgICAgdmFyIHN0cmluZ3NVbmljb2RlID0gW107CiAgICAgICAgdmFyIGksIGlpLCBqLCBqaiwgc3RyOwoKICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IHN0cmluZ3MubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgc3RyID0gcHJvdG9bMV1baV0gfHwgc3RyaW5nc1tpXTsKICAgICAgICAgIHZhciBzdHJCdWZVbmljb2RlID0gW107CgogICAgICAgICAgZm9yIChqID0gMCwgamogPSBzdHIubGVuZ3RoOyBqIDwgamo7IGorKykgewogICAgICAgICAgICBzdHJCdWZVbmljb2RlLnB1c2goc3RyaW5nMTYoc3RyLmNoYXJDb2RlQXQoaikpKTsKICAgICAgICAgIH0KCiAgICAgICAgICBzdHJpbmdzVW5pY29kZS5wdXNoKHN0ckJ1ZlVuaWNvZGUuam9pbigiIikpOwogICAgICAgIH0KCiAgICAgICAgdmFyIG5hbWVzID0gW3N0cmluZ3MsIHN0cmluZ3NVbmljb2RlXTsKICAgICAgICB2YXIgcGxhdGZvcm1zID0gWyJceDAwXHgwMSIsICJceDAwXHgwMyJdOwogICAgICAgIHZhciBlbmNvZGluZ3MgPSBbIlx4MDBceDAwIiwgIlx4MDBceDAxIl07CiAgICAgICAgdmFyIGxhbmd1YWdlcyA9IFsiXHgwMFx4MDAiLCAiXHgwNFx4MDkiXTsKICAgICAgICB2YXIgbmFtZXNSZWNvcmRDb3VudCA9IHN0cmluZ3MubGVuZ3RoICogcGxhdGZvcm1zLmxlbmd0aDsKICAgICAgICB2YXIgbmFtZVRhYmxlID0gIlx4MDBceDAwIiArIHN0cmluZzE2KG5hbWVzUmVjb3JkQ291bnQpICsgc3RyaW5nMTYobmFtZXNSZWNvcmRDb3VudCAqIDEyICsgNik7CiAgICAgICAgdmFyIHN0ck9mZnNldCA9IDA7CgogICAgICAgIGZvciAoaSA9IDAsIGlpID0gcGxhdGZvcm1zLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgIHZhciBzdHJzID0gbmFtZXNbaV07CgogICAgICAgICAgZm9yIChqID0gMCwgamogPSBzdHJzLmxlbmd0aDsgaiA8IGpqOyBqKyspIHsKICAgICAgICAgICAgc3RyID0gc3Ryc1tqXTsKICAgICAgICAgICAgdmFyIG5hbWVSZWNvcmQgPSBwbGF0Zm9ybXNbaV0gKyBlbmNvZGluZ3NbaV0gKyBsYW5ndWFnZXNbaV0gKyBzdHJpbmcxNihqKSArIHN0cmluZzE2KHN0ci5sZW5ndGgpICsgc3RyaW5nMTYoc3RyT2Zmc2V0KTsKICAgICAgICAgICAgbmFtZVRhYmxlICs9IG5hbWVSZWNvcmQ7CiAgICAgICAgICAgIHN0ck9mZnNldCArPSBzdHIubGVuZ3RoOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgbmFtZVRhYmxlICs9IHN0cmluZ3Muam9pbigiIikgKyBzdHJpbmdzVW5pY29kZS5qb2luKCIiKTsKICAgICAgICByZXR1cm4gbmFtZVRhYmxlOwogICAgICB9CgogICAgICBGb250LnByb3RvdHlwZSA9IHsKICAgICAgICBuYW1lOiBudWxsLAogICAgICAgIGZvbnQ6IG51bGwsCiAgICAgICAgbWltZXR5cGU6IG51bGwsCiAgICAgICAgZW5jb2Rpbmc6IG51bGwsCiAgICAgICAgZGlzYWJsZUZvbnRGYWNlOiBmYWxzZSwKCiAgICAgICAgZ2V0IHJlbmRlcmVyKCkgewogICAgICAgICAgdmFyIHJlbmRlcmVyID0gX2ZvbnRfcmVuZGVyZXIuRm9udFJlbmRlcmVyRmFjdG9yeS5jcmVhdGUodGhpcywgU0VBQ19BTkFMWVNJU19FTkFCTEVEKTsKCiAgICAgICAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgInJlbmRlcmVyIiwgcmVuZGVyZXIpOwogICAgICAgIH0sCgogICAgICAgIGV4cG9ydERhdGE6IGZ1bmN0aW9uIEZvbnRfZXhwb3J0RGF0YSgpIHsKICAgICAgICAgIHZhciBkYXRhID0ge307CgogICAgICAgICAgZm9yICh2YXIgaSBpbiB0aGlzKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmhhc093blByb3BlcnR5KGkpKSB7CiAgICAgICAgICAgICAgZGF0YVtpXSA9IHRoaXNbaV07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gZGF0YTsKICAgICAgICB9LAogICAgICAgIGZhbGxiYWNrVG9TeXN0ZW1Gb250OiBmdW5jdGlvbiBGb250X2ZhbGxiYWNrVG9TeXN0ZW1Gb250KCkgewogICAgICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgICAgICB0aGlzLm1pc3NpbmdGaWxlID0gdHJ1ZTsKICAgICAgICAgIHZhciBjaGFyQ29kZSwgdW5pY29kZTsKICAgICAgICAgIHZhciBuYW1lID0gdGhpcy5uYW1lOwogICAgICAgICAgdmFyIHR5cGUgPSB0aGlzLnR5cGU7CiAgICAgICAgICB2YXIgc3VidHlwZSA9IHRoaXMuc3VidHlwZTsKICAgICAgICAgIHZhciBmb250TmFtZSA9IG5hbWUucmVwbGFjZSgvWyxfXS9nLCAiLSIpLnJlcGxhY2UoL1xzL2csICIiKTsKICAgICAgICAgIHZhciBzdGRGb250TWFwID0gKDAsIF9zdGFuZGFyZF9mb250cy5nZXRTdGRGb250TWFwKSgpLAogICAgICAgICAgICBub25TdGRGb250TWFwID0gKDAsIF9zdGFuZGFyZF9mb250cy5nZXROb25TdGRGb250TWFwKSgpOwogICAgICAgICAgdmFyIGlzU3RhbmRhcmRGb250ID0gISFzdGRGb250TWFwW2ZvbnROYW1lXSB8fCAhIShub25TdGRGb250TWFwW2ZvbnROYW1lXSAmJiBzdGRGb250TWFwW25vblN0ZEZvbnRNYXBbZm9udE5hbWVdXSk7CiAgICAgICAgICBmb250TmFtZSA9IHN0ZEZvbnRNYXBbZm9udE5hbWVdIHx8IG5vblN0ZEZvbnRNYXBbZm9udE5hbWVdIHx8IGZvbnROYW1lOwogICAgICAgICAgdGhpcy5ib2xkID0gZm9udE5hbWUuc2VhcmNoKC9ib2xkL2dpKSAhPT0gLTE7CiAgICAgICAgICB0aGlzLml0YWxpYyA9IGZvbnROYW1lLnNlYXJjaCgvb2JsaXF1ZS9naSkgIT09IC0xIHx8IGZvbnROYW1lLnNlYXJjaCgvaXRhbGljL2dpKSAhPT0gLTE7CiAgICAgICAgICB0aGlzLmJsYWNrID0gbmFtZS5zZWFyY2goL0JsYWNrL2cpICE9PSAtMTsKICAgICAgICAgIHRoaXMucmVtZWFzdXJlID0gT2JqZWN0LmtleXModGhpcy53aWR0aHMpLmxlbmd0aCA+IDA7CgogICAgICAgICAgaWYgKGlzU3RhbmRhcmRGb250ICYmIHR5cGUgPT09ICJDSURGb250VHlwZTIiICYmIHRoaXMuY2lkRW5jb2Rpbmcuc3RhcnRzV2l0aCgiSWRlbnRpdHktIikpIHsKICAgICAgICAgICAgdmFyIEdseXBoTWFwRm9yU3RhbmRhcmRGb250cyA9ICgwLCBfc3RhbmRhcmRfZm9udHMuZ2V0R2x5cGhNYXBGb3JTdGFuZGFyZEZvbnRzKSgpOwogICAgICAgICAgICB2YXIgbWFwID0gW107CgogICAgICAgICAgICBmb3IgKGNoYXJDb2RlIGluIEdseXBoTWFwRm9yU3RhbmRhcmRGb250cykgewogICAgICAgICAgICAgIG1hcFsrY2hhckNvZGVdID0gR2x5cGhNYXBGb3JTdGFuZGFyZEZvbnRzW2NoYXJDb2RlXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKC9BcmlhbC0/QmxhY2svaS50ZXN0KG5hbWUpKSB7CiAgICAgICAgICAgICAgdmFyIFN1cHBsZW1lbnRhbEdseXBoTWFwRm9yQXJpYWxCbGFjayA9ICgwLCBfc3RhbmRhcmRfZm9udHMuZ2V0U3VwcGxlbWVudGFsR2x5cGhNYXBGb3JBcmlhbEJsYWNrKSgpOwoKICAgICAgICAgICAgICBmb3IgKGNoYXJDb2RlIGluIFN1cHBsZW1lbnRhbEdseXBoTWFwRm9yQXJpYWxCbGFjaykgewogICAgICAgICAgICAgICAgbWFwWytjaGFyQ29kZV0gPSBTdXBwbGVtZW50YWxHbHlwaE1hcEZvckFyaWFsQmxhY2tbY2hhckNvZGVdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmICgvQ2FsaWJyaS9pLnRlc3QobmFtZSkpIHsKICAgICAgICAgICAgICB2YXIgU3VwcGxlbWVudGFsR2x5cGhNYXBGb3JDYWxpYnJpID0gKDAsIF9zdGFuZGFyZF9mb250cy5nZXRTdXBwbGVtZW50YWxHbHlwaE1hcEZvckNhbGlicmkpKCk7CgogICAgICAgICAgICAgIGZvciAoY2hhckNvZGUgaW4gU3VwcGxlbWVudGFsR2x5cGhNYXBGb3JDYWxpYnJpKSB7CiAgICAgICAgICAgICAgICBtYXBbK2NoYXJDb2RlXSA9IFN1cHBsZW1lbnRhbEdseXBoTWFwRm9yQ2FsaWJyaVtjaGFyQ29kZV07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgaXNJZGVudGl0eVVuaWNvZGUgPSB0aGlzLnRvVW5pY29kZSBpbnN0YW5jZW9mIElkZW50aXR5VG9Vbmljb2RlTWFwOwoKICAgICAgICAgICAgaWYgKCFpc0lkZW50aXR5VW5pY29kZSkgewogICAgICAgICAgICAgIHRoaXMudG9Vbmljb2RlLmZvckVhY2goZnVuY3Rpb24gKGNoYXJDb2RlLCB1bmljb2RlQ2hhckNvZGUpIHsKICAgICAgICAgICAgICAgIG1hcFsrY2hhckNvZGVdID0gdW5pY29kZUNoYXJDb2RlOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLnRvRm9udENoYXIgPSBtYXA7CiAgICAgICAgICAgIHRoaXMudG9Vbmljb2RlID0gbmV3IFRvVW5pY29kZU1hcChtYXApOwogICAgICAgICAgfSBlbHNlIGlmICgvU3ltYm9sL2kudGVzdChmb250TmFtZSkpIHsKICAgICAgICAgICAgdGhpcy50b0ZvbnRDaGFyID0gYnVpbGRUb0ZvbnRDaGFyKF9lbmNvZGluZ3MuU3ltYm9sU2V0RW5jb2RpbmcsICgwLCBfZ2x5cGhsaXN0LmdldEdseXBoc1VuaWNvZGUpKCksIHRoaXMuZGlmZmVyZW5jZXMpOwogICAgICAgICAgfSBlbHNlIGlmICgvRGluZ2JhdHMvaS50ZXN0KGZvbnROYW1lKSkgewogICAgICAgICAgICBpZiAoL1dpbmdkaW5ncy9pLnRlc3QobmFtZSkpIHsKICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIk5vbi1lbWJlZGRlZCBXaW5nZGluZ3MgZm9udCwgZmFsbGluZyBiYWNrIHRvIFphcGZEaW5nYmF0cy4iKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy50b0ZvbnRDaGFyID0gYnVpbGRUb0ZvbnRDaGFyKF9lbmNvZGluZ3MuWmFwZkRpbmdiYXRzRW5jb2RpbmcsICgwLCBfZ2x5cGhsaXN0LmdldERpbmdiYXRzR2x5cGhzVW5pY29kZSkoKSwgdGhpcy5kaWZmZXJlbmNlcyk7CiAgICAgICAgICB9IGVsc2UgaWYgKGlzU3RhbmRhcmRGb250KSB7CiAgICAgICAgICAgIHRoaXMudG9Gb250Q2hhciA9IGJ1aWxkVG9Gb250Q2hhcih0aGlzLmRlZmF1bHRFbmNvZGluZywgKDAsIF9nbHlwaGxpc3QuZ2V0R2x5cGhzVW5pY29kZSkoKSwgdGhpcy5kaWZmZXJlbmNlcyk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgZ2x5cGhzVW5pY29kZU1hcCA9ICgwLCBfZ2x5cGhsaXN0LmdldEdseXBoc1VuaWNvZGUpKCk7CiAgICAgICAgICAgIHZhciBfbWFwID0gW107CiAgICAgICAgICAgIHRoaXMudG9Vbmljb2RlLmZvckVhY2goZnVuY3Rpb24gKGNoYXJDb2RlLCB1bmljb2RlQ2hhckNvZGUpIHsKICAgICAgICAgICAgICBpZiAoIV90aGlzLmNvbXBvc2l0ZSkgewogICAgICAgICAgICAgICAgdmFyIGdseXBoTmFtZSA9IF90aGlzLmRpZmZlcmVuY2VzW2NoYXJDb2RlXSB8fCBfdGhpcy5kZWZhdWx0RW5jb2RpbmdbY2hhckNvZGVdOwogICAgICAgICAgICAgICAgdW5pY29kZSA9ICgwLCBfdW5pY29kZS5nZXRVbmljb2RlRm9yR2x5cGgpKGdseXBoTmFtZSwgZ2x5cGhzVW5pY29kZU1hcCk7CgogICAgICAgICAgICAgICAgaWYgKHVuaWNvZGUgIT09IC0xKSB7CiAgICAgICAgICAgICAgICAgIHVuaWNvZGVDaGFyQ29kZSA9IHVuaWNvZGU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfbWFwWytjaGFyQ29kZV0gPSB1bmljb2RlQ2hhckNvZGU7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKHRoaXMuY29tcG9zaXRlICYmIHRoaXMudG9Vbmljb2RlIGluc3RhbmNlb2YgSWRlbnRpdHlUb1VuaWNvZGVNYXApIHsKICAgICAgICAgICAgICBpZiAoL1ZlcmRhbmEvaS50ZXN0KG5hbWUpKSB7CiAgICAgICAgICAgICAgICB2YXIgX0dseXBoTWFwRm9yU3RhbmRhcmRGb250cyA9ICgwLCBfc3RhbmRhcmRfZm9udHMuZ2V0R2x5cGhNYXBGb3JTdGFuZGFyZEZvbnRzKSgpOwoKICAgICAgICAgICAgICAgIGZvciAoY2hhckNvZGUgaW4gX0dseXBoTWFwRm9yU3RhbmRhcmRGb250cykgewogICAgICAgICAgICAgICAgICBfbWFwWytjaGFyQ29kZV0gPSBfR2x5cGhNYXBGb3JTdGFuZGFyZEZvbnRzW2NoYXJDb2RlXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMudG9Gb250Q2hhciA9IF9tYXA7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5sb2FkZWROYW1lID0gZm9udE5hbWUuc3BsaXQoIi0iKVswXTsKICAgICAgICAgIHRoaXMuZm9udFR5cGUgPSBnZXRGb250VHlwZSh0eXBlLCBzdWJ0eXBlKTsKICAgICAgICB9LAogICAgICAgIGNoZWNrQW5kUmVwYWlyOiBmdW5jdGlvbiBGb250X2NoZWNrQW5kUmVwYWlyKG5hbWUsIGZvbnQsIHByb3BlcnRpZXMpIHsKICAgICAgICAgIHZhciBWQUxJRF9UQUJMRVMgPSBbIk9TLzIiLCAiY21hcCIsICJoZWFkIiwgImhoZWEiLCAiaG10eCIsICJtYXhwIiwgIm5hbWUiLCAicG9zdCIsICJsb2NhIiwgImdseWYiLCAiZnBnbSIsICJwcmVwIiwgImN2dCAiLCAiQ0ZGICJdOwoKICAgICAgICAgIGZ1bmN0aW9uIHJlYWRUYWJsZXMoZmlsZSwgbnVtVGFibGVzKSB7CiAgICAgICAgICAgIHZhciB0YWJsZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgICAgICB0YWJsZXNbIk9TLzIiXSA9IG51bGw7CiAgICAgICAgICAgIHRhYmxlc1siY21hcCJdID0gbnVsbDsKICAgICAgICAgICAgdGFibGVzWyJoZWFkIl0gPSBudWxsOwogICAgICAgICAgICB0YWJsZXNbImhoZWEiXSA9IG51bGw7CiAgICAgICAgICAgIHRhYmxlc1siaG10eCJdID0gbnVsbDsKICAgICAgICAgICAgdGFibGVzWyJtYXhwIl0gPSBudWxsOwogICAgICAgICAgICB0YWJsZXNbIm5hbWUiXSA9IG51bGw7CiAgICAgICAgICAgIHRhYmxlc1sicG9zdCJdID0gbnVsbDsKCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtVGFibGVzOyBpKyspIHsKICAgICAgICAgICAgICB2YXIgdGFibGUgPSByZWFkVGFibGVFbnRyeShmb250KTsKCiAgICAgICAgICAgICAgaWYgKCFWQUxJRF9UQUJMRVMuaW5jbHVkZXModGFibGUudGFnKSkgewogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAodGFibGUubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHRhYmxlc1t0YWJsZS50YWddID0gdGFibGU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB0YWJsZXM7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gcmVhZFRhYmxlRW50cnkoZmlsZSkgewogICAgICAgICAgICB2YXIgdGFnID0gKDAsIF91dGlsLmJ5dGVzVG9TdHJpbmcpKGZpbGUuZ2V0Qnl0ZXMoNCkpOwogICAgICAgICAgICB2YXIgY2hlY2tzdW0gPSBmaWxlLmdldEludDMyKCkgPj4+IDA7CiAgICAgICAgICAgIHZhciBvZmZzZXQgPSBmaWxlLmdldEludDMyKCkgPj4+IDA7CiAgICAgICAgICAgIHZhciBsZW5ndGggPSBmaWxlLmdldEludDMyKCkgPj4+IDA7CiAgICAgICAgICAgIHZhciBwcmV2aW91c1Bvc2l0aW9uID0gZmlsZS5wb3M7CiAgICAgICAgICAgIGZpbGUucG9zID0gZmlsZS5zdGFydCA/IGZpbGUuc3RhcnQgOiAwOwogICAgICAgICAgICBmaWxlLnNraXAob2Zmc2V0KTsKICAgICAgICAgICAgdmFyIGRhdGEgPSBmaWxlLmdldEJ5dGVzKGxlbmd0aCk7CiAgICAgICAgICAgIGZpbGUucG9zID0gcHJldmlvdXNQb3NpdGlvbjsKCiAgICAgICAgICAgIGlmICh0YWcgPT09ICJoZWFkIikgewogICAgICAgICAgICAgIGRhdGFbOF0gPSBkYXRhWzldID0gZGF0YVsxMF0gPSBkYXRhWzExXSA9IDA7CiAgICAgICAgICAgICAgZGF0YVsxN10gfD0gMHgyMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICB0YWc6IHRhZywKICAgICAgICAgICAgICBjaGVja3N1bTogY2hlY2tzdW0sCiAgICAgICAgICAgICAgbGVuZ3RoOiBsZW5ndGgsCiAgICAgICAgICAgICAgb2Zmc2V0OiBvZmZzZXQsCiAgICAgICAgICAgICAgZGF0YTogZGF0YQogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHJlYWRPcGVuVHlwZUhlYWRlcih0dGYpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICB2ZXJzaW9uOiAoMCwgX3V0aWwuYnl0ZXNUb1N0cmluZykodHRmLmdldEJ5dGVzKDQpKSwKICAgICAgICAgICAgICBudW1UYWJsZXM6IHR0Zi5nZXRVaW50MTYoKSwKICAgICAgICAgICAgICBzZWFyY2hSYW5nZTogdHRmLmdldFVpbnQxNigpLAogICAgICAgICAgICAgIGVudHJ5U2VsZWN0b3I6IHR0Zi5nZXRVaW50MTYoKSwKICAgICAgICAgICAgICByYW5nZVNoaWZ0OiB0dGYuZ2V0VWludDE2KCkKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiByZWFkVHJ1ZVR5cGVDb2xsZWN0aW9uSGVhZGVyKHR0YykgewogICAgICAgICAgICB2YXIgdHRjVGFnID0gKDAsIF91dGlsLmJ5dGVzVG9TdHJpbmcpKHR0Yy5nZXRCeXRlcyg0KSk7CiAgICAgICAgICAgICgwLCBfdXRpbC5hc3NlcnQpKHR0Y1RhZyA9PT0gInR0Y2YiLCAiTXVzdCBiZSBhIFRydWVUeXBlIENvbGxlY3Rpb24gZm9udC4iKTsKICAgICAgICAgICAgdmFyIG1ham9yVmVyc2lvbiA9IHR0Yy5nZXRVaW50MTYoKTsKICAgICAgICAgICAgdmFyIG1pbm9yVmVyc2lvbiA9IHR0Yy5nZXRVaW50MTYoKTsKICAgICAgICAgICAgdmFyIG51bUZvbnRzID0gdHRjLmdldEludDMyKCkgPj4+IDA7CiAgICAgICAgICAgIHZhciBvZmZzZXRUYWJsZSA9IFtdOwoKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1Gb250czsgaSsrKSB7CiAgICAgICAgICAgICAgb2Zmc2V0VGFibGUucHVzaCh0dGMuZ2V0SW50MzIoKSA+Pj4gMCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBoZWFkZXIgPSB7CiAgICAgICAgICAgICAgdHRjVGFnOiB0dGNUYWcsCiAgICAgICAgICAgICAgbWFqb3JWZXJzaW9uOiBtYWpvclZlcnNpb24sCiAgICAgICAgICAgICAgbWlub3JWZXJzaW9uOiBtaW5vclZlcnNpb24sCiAgICAgICAgICAgICAgbnVtRm9udHM6IG51bUZvbnRzLAogICAgICAgICAgICAgIG9mZnNldFRhYmxlOiBvZmZzZXRUYWJsZQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgc3dpdGNoIChtYWpvclZlcnNpb24pIHsKICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICByZXR1cm4gaGVhZGVyOwoKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBoZWFkZXIuZHNpZ1RhZyA9IHR0Yy5nZXRJbnQzMigpID4+PiAwOwogICAgICAgICAgICAgICAgaGVhZGVyLmRzaWdMZW5ndGggPSB0dGMuZ2V0SW50MzIoKSA+Pj4gMDsKICAgICAgICAgICAgICAgIGhlYWRlci5kc2lnT2Zmc2V0ID0gdHRjLmdldEludDMyKCkgPj4+IDA7CiAgICAgICAgICAgICAgICByZXR1cm4gaGVhZGVyOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkludmFsaWQgVHJ1ZVR5cGUgQ29sbGVjdGlvbiBtYWpvclZlcnNpb246ICIuY29uY2F0KG1ham9yVmVyc2lvbiwgIi4iKSk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gcmVhZFRydWVUeXBlQ29sbGVjdGlvbkRhdGEodHRjLCBmb250TmFtZSkgewogICAgICAgICAgICB2YXIgX3JlYWRUcnVlVHlwZUNvbGxlY3RpID0gcmVhZFRydWVUeXBlQ29sbGVjdGlvbkhlYWRlcih0dGMpLAogICAgICAgICAgICAgIG51bUZvbnRzID0gX3JlYWRUcnVlVHlwZUNvbGxlY3RpLm51bUZvbnRzLAogICAgICAgICAgICAgIG9mZnNldFRhYmxlID0gX3JlYWRUcnVlVHlwZUNvbGxlY3RpLm9mZnNldFRhYmxlOwoKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1Gb250czsgaSsrKSB7CiAgICAgICAgICAgICAgdHRjLnBvcyA9ICh0dGMuc3RhcnQgfHwgMCkgKyBvZmZzZXRUYWJsZVtpXTsKICAgICAgICAgICAgICB2YXIgcG90ZW50aWFsSGVhZGVyID0gcmVhZE9wZW5UeXBlSGVhZGVyKHR0Yyk7CiAgICAgICAgICAgICAgdmFyIHBvdGVudGlhbFRhYmxlcyA9IHJlYWRUYWJsZXModHRjLCBwb3RlbnRpYWxIZWFkZXIubnVtVGFibGVzKTsKCiAgICAgICAgICAgICAgaWYgKCFwb3RlbnRpYWxUYWJsZXNbIm5hbWUiXSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCdUcnVlVHlwZSBDb2xsZWN0aW9uIGZvbnQgbXVzdCBjb250YWluIGEgIm5hbWUiIHRhYmxlLicpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIG5hbWVUYWJsZSA9IHJlYWROYW1lVGFibGUocG90ZW50aWFsVGFibGVzWyJuYW1lIl0pOwoKICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMCwgamogPSBuYW1lVGFibGUubGVuZ3RoOyBqIDwgamo7IGorKykgewogICAgICAgICAgICAgICAgZm9yICh2YXIgayA9IDAsIGtrID0gbmFtZVRhYmxlW2pdLmxlbmd0aDsgayA8IGtrOyBrKyspIHsKICAgICAgICAgICAgICAgICAgdmFyIG5hbWVFbnRyeSA9IG5hbWVUYWJsZVtqXVtrXTsKCiAgICAgICAgICAgICAgICAgIGlmIChuYW1lRW50cnkgJiYgbmFtZUVudHJ5LnJlcGxhY2UoL1xzL2csICIiKSA9PT0gZm9udE5hbWUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgaGVhZGVyOiBwb3RlbnRpYWxIZWFkZXIsCiAgICAgICAgICAgICAgICAgICAgICB0YWJsZXM6IHBvdGVudGlhbFRhYmxlcwogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiVHJ1ZVR5cGUgQ29sbGVjdGlvbiBkb2VzIG5vdCBjb250YWluIFwiIi5jb25jYXQoZm9udE5hbWUsICJcIiBmb250LiIpKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiByZWFkQ21hcFRhYmxlKGNtYXAsIGZvbnQsIGlzU3ltYm9saWNGb250LCBoYXNFbmNvZGluZykgewogICAgICAgICAgICBpZiAoIWNtYXApIHsKICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIk5vIGNtYXAgdGFibGUgYXZhaWxhYmxlLiIpOwogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBwbGF0Zm9ybUlkOiAtMSwKICAgICAgICAgICAgICAgIGVuY29kaW5nSWQ6IC0xLAogICAgICAgICAgICAgICAgbWFwcGluZ3M6IFtdLAogICAgICAgICAgICAgICAgaGFzU2hvcnRDbWFwOiBmYWxzZQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBzZWdtZW50OwogICAgICAgICAgICB2YXIgc3RhcnQgPSAoZm9udC5zdGFydCA/IGZvbnQuc3RhcnQgOiAwKSArIGNtYXAub2Zmc2V0OwogICAgICAgICAgICBmb250LnBvcyA9IHN0YXJ0OwogICAgICAgICAgICBmb250LmdldFVpbnQxNigpOwogICAgICAgICAgICB2YXIgbnVtVGFibGVzID0gZm9udC5nZXRVaW50MTYoKTsKICAgICAgICAgICAgdmFyIHBvdGVudGlhbFRhYmxlOwogICAgICAgICAgICB2YXIgY2FuQnJlYWsgPSBmYWxzZTsKCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtVGFibGVzOyBpKyspIHsKICAgICAgICAgICAgICB2YXIgcGxhdGZvcm1JZCA9IGZvbnQuZ2V0VWludDE2KCk7CiAgICAgICAgICAgICAgdmFyIGVuY29kaW5nSWQgPSBmb250LmdldFVpbnQxNigpOwogICAgICAgICAgICAgIHZhciBvZmZzZXQgPSBmb250LmdldEludDMyKCkgPj4+IDA7CiAgICAgICAgICAgICAgdmFyIHVzZVRhYmxlID0gZmFsc2U7CgogICAgICAgICAgICAgIGlmIChwb3RlbnRpYWxUYWJsZSAmJiBwb3RlbnRpYWxUYWJsZS5wbGF0Zm9ybUlkID09PSBwbGF0Zm9ybUlkICYmIHBvdGVudGlhbFRhYmxlLmVuY29kaW5nSWQgPT09IGVuY29kaW5nSWQpIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHBsYXRmb3JtSWQgPT09IDAgJiYgZW5jb2RpbmdJZCA9PT0gMCkgewogICAgICAgICAgICAgICAgdXNlVGFibGUgPSB0cnVlOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocGxhdGZvcm1JZCA9PT0gMSAmJiBlbmNvZGluZ0lkID09PSAwKSB7CiAgICAgICAgICAgICAgICB1c2VUYWJsZSA9IHRydWU7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChwbGF0Zm9ybUlkID09PSAzICYmIGVuY29kaW5nSWQgPT09IDEgJiYgKGhhc0VuY29kaW5nIHx8ICFwb3RlbnRpYWxUYWJsZSkpIHsKICAgICAgICAgICAgICAgIHVzZVRhYmxlID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICBpZiAoIWlzU3ltYm9saWNGb250KSB7CiAgICAgICAgICAgICAgICAgIGNhbkJyZWFrID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzU3ltYm9saWNGb250ICYmIHBsYXRmb3JtSWQgPT09IDMgJiYgZW5jb2RpbmdJZCA9PT0gMCkgewogICAgICAgICAgICAgICAgdXNlVGFibGUgPSB0cnVlOwogICAgICAgICAgICAgICAgY2FuQnJlYWsgPSB0cnVlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHVzZVRhYmxlKSB7CiAgICAgICAgICAgICAgICBwb3RlbnRpYWxUYWJsZSA9IHsKICAgICAgICAgICAgICAgICAgcGxhdGZvcm1JZDogcGxhdGZvcm1JZCwKICAgICAgICAgICAgICAgICAgZW5jb2RpbmdJZDogZW5jb2RpbmdJZCwKICAgICAgICAgICAgICAgICAgb2Zmc2V0OiBvZmZzZXQKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoY2FuQnJlYWspIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHBvdGVudGlhbFRhYmxlKSB7CiAgICAgICAgICAgICAgZm9udC5wb3MgPSBzdGFydCArIHBvdGVudGlhbFRhYmxlLm9mZnNldDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCFwb3RlbnRpYWxUYWJsZSB8fCBmb250LnBlZWtCeXRlKCkgPT09IC0xKSB7CiAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJDb3VsZCBub3QgZmluZCBhIHByZWZlcnJlZCBjbWFwIHRhYmxlLiIpOwogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBwbGF0Zm9ybUlkOiAtMSwKICAgICAgICAgICAgICAgIGVuY29kaW5nSWQ6IC0xLAogICAgICAgICAgICAgICAgbWFwcGluZ3M6IFtdLAogICAgICAgICAgICAgICAgaGFzU2hvcnRDbWFwOiBmYWxzZQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBmb3JtYXQgPSBmb250LmdldFVpbnQxNigpOwogICAgICAgICAgICBmb250LmdldFVpbnQxNigpOwogICAgICAgICAgICBmb250LmdldFVpbnQxNigpOwogICAgICAgICAgICB2YXIgaGFzU2hvcnRDbWFwID0gZmFsc2U7CiAgICAgICAgICAgIHZhciBtYXBwaW5ncyA9IFtdOwogICAgICAgICAgICB2YXIgaiwgZ2x5cGhJZDsKCiAgICAgICAgICAgIGlmIChmb3JtYXQgPT09IDApIHsKICAgICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgMjU2OyBqKyspIHsKICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IGZvbnQuZ2V0Qnl0ZSgpOwoKICAgICAgICAgICAgICAgIGlmICghaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbWFwcGluZ3MucHVzaCh7CiAgICAgICAgICAgICAgICAgIGNoYXJDb2RlOiBqLAogICAgICAgICAgICAgICAgICBnbHlwaElkOiBpbmRleAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBoYXNTaG9ydENtYXAgPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UgaWYgKGZvcm1hdCA9PT0gNCkgewogICAgICAgICAgICAgIHZhciBzZWdDb3VudCA9IGZvbnQuZ2V0VWludDE2KCkgPj4gMTsKICAgICAgICAgICAgICBmb250LmdldEJ5dGVzKDYpOwogICAgICAgICAgICAgIHZhciBzZWdJbmRleCwKICAgICAgICAgICAgICAgIHNlZ21lbnRzID0gW107CgogICAgICAgICAgICAgIGZvciAoc2VnSW5kZXggPSAwOyBzZWdJbmRleCA8IHNlZ0NvdW50OyBzZWdJbmRleCsrKSB7CiAgICAgICAgICAgICAgICBzZWdtZW50cy5wdXNoKHsKICAgICAgICAgICAgICAgICAgZW5kOiBmb250LmdldFVpbnQxNigpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGZvbnQuZ2V0VWludDE2KCk7CgogICAgICAgICAgICAgIGZvciAoc2VnSW5kZXggPSAwOyBzZWdJbmRleCA8IHNlZ0NvdW50OyBzZWdJbmRleCsrKSB7CiAgICAgICAgICAgICAgICBzZWdtZW50c1tzZWdJbmRleF0uc3RhcnQgPSBmb250LmdldFVpbnQxNigpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZm9yIChzZWdJbmRleCA9IDA7IHNlZ0luZGV4IDwgc2VnQ291bnQ7IHNlZ0luZGV4KyspIHsKICAgICAgICAgICAgICAgIHNlZ21lbnRzW3NlZ0luZGV4XS5kZWx0YSA9IGZvbnQuZ2V0VWludDE2KCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgb2Zmc2V0c0NvdW50ID0gMDsKCiAgICAgICAgICAgICAgZm9yIChzZWdJbmRleCA9IDA7IHNlZ0luZGV4IDwgc2VnQ291bnQ7IHNlZ0luZGV4KyspIHsKICAgICAgICAgICAgICAgIHNlZ21lbnQgPSBzZWdtZW50c1tzZWdJbmRleF07CiAgICAgICAgICAgICAgICB2YXIgcmFuZ2VPZmZzZXQgPSBmb250LmdldFVpbnQxNigpOwoKICAgICAgICAgICAgICAgIGlmICghcmFuZ2VPZmZzZXQpIHsKICAgICAgICAgICAgICAgICAgc2VnbWVudC5vZmZzZXRJbmRleCA9IC0xOwogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgb2Zmc2V0SW5kZXggPSAocmFuZ2VPZmZzZXQgPj4gMSkgLSAoc2VnQ291bnQgLSBzZWdJbmRleCk7CiAgICAgICAgICAgICAgICBzZWdtZW50Lm9mZnNldEluZGV4ID0gb2Zmc2V0SW5kZXg7CiAgICAgICAgICAgICAgICBvZmZzZXRzQ291bnQgPSBNYXRoLm1heChvZmZzZXRzQ291bnQsIG9mZnNldEluZGV4ICsgc2VnbWVudC5lbmQgLSBzZWdtZW50LnN0YXJ0ICsgMSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgb2Zmc2V0cyA9IFtdOwoKICAgICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgb2Zmc2V0c0NvdW50OyBqKyspIHsKICAgICAgICAgICAgICAgIG9mZnNldHMucHVzaChmb250LmdldFVpbnQxNigpKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGZvciAoc2VnSW5kZXggPSAwOyBzZWdJbmRleCA8IHNlZ0NvdW50OyBzZWdJbmRleCsrKSB7CiAgICAgICAgICAgICAgICBzZWdtZW50ID0gc2VnbWVudHNbc2VnSW5kZXhdOwogICAgICAgICAgICAgICAgc3RhcnQgPSBzZWdtZW50LnN0YXJ0OwogICAgICAgICAgICAgICAgdmFyIGVuZCA9IHNlZ21lbnQuZW5kOwogICAgICAgICAgICAgICAgdmFyIGRlbHRhID0gc2VnbWVudC5kZWx0YTsKICAgICAgICAgICAgICAgIG9mZnNldEluZGV4ID0gc2VnbWVudC5vZmZzZXRJbmRleDsKCiAgICAgICAgICAgICAgICBmb3IgKGogPSBzdGFydDsgaiA8PSBlbmQ7IGorKykgewogICAgICAgICAgICAgICAgICBpZiAoaiA9PT0gMHhmZmZmKSB7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGdseXBoSWQgPSBvZmZzZXRJbmRleCA8IDAgPyBqIDogb2Zmc2V0c1tvZmZzZXRJbmRleCArIGogLSBzdGFydF07CiAgICAgICAgICAgICAgICAgIGdseXBoSWQgPSBnbHlwaElkICsgZGVsdGEgJiAweGZmZmY7CiAgICAgICAgICAgICAgICAgIG1hcHBpbmdzLnB1c2goewogICAgICAgICAgICAgICAgICAgIGNoYXJDb2RlOiBqLAogICAgICAgICAgICAgICAgICAgIGdseXBoSWQ6IGdseXBoSWQKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKGZvcm1hdCA9PT0gNikgewogICAgICAgICAgICAgIHZhciBmaXJzdENvZGUgPSBmb250LmdldFVpbnQxNigpOwogICAgICAgICAgICAgIHZhciBlbnRyeUNvdW50ID0gZm9udC5nZXRVaW50MTYoKTsKCiAgICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IGVudHJ5Q291bnQ7IGorKykgewogICAgICAgICAgICAgICAgZ2x5cGhJZCA9IGZvbnQuZ2V0VWludDE2KCk7CiAgICAgICAgICAgICAgICB2YXIgY2hhckNvZGUgPSBmaXJzdENvZGUgKyBqOwogICAgICAgICAgICAgICAgbWFwcGluZ3MucHVzaCh7CiAgICAgICAgICAgICAgICAgIGNoYXJDb2RlOiBjaGFyQ29kZSwKICAgICAgICAgICAgICAgICAgZ2x5cGhJZDogZ2x5cGhJZAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiY21hcCB0YWJsZSBoYXMgdW5zdXBwb3J0ZWQgZm9ybWF0OiAiICsgZm9ybWF0KTsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgcGxhdGZvcm1JZDogLTEsCiAgICAgICAgICAgICAgICBlbmNvZGluZ0lkOiAtMSwKICAgICAgICAgICAgICAgIG1hcHBpbmdzOiBbXSwKICAgICAgICAgICAgICAgIGhhc1Nob3J0Q21hcDogZmFsc2UKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICBtYXBwaW5ncy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGEuY2hhckNvZGUgLSBiLmNoYXJDb2RlOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGZvciAoaSA9IDE7IGkgPCBtYXBwaW5ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIGlmIChtYXBwaW5nc1tpIC0gMV0uY2hhckNvZGUgPT09IG1hcHBpbmdzW2ldLmNoYXJDb2RlKSB7CiAgICAgICAgICAgICAgICBtYXBwaW5ncy5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgICAgICBpLS07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIHBsYXRmb3JtSWQ6IHBvdGVudGlhbFRhYmxlLnBsYXRmb3JtSWQsCiAgICAgICAgICAgICAgZW5jb2RpbmdJZDogcG90ZW50aWFsVGFibGUuZW5jb2RpbmdJZCwKICAgICAgICAgICAgICBtYXBwaW5nczogbWFwcGluZ3MsCiAgICAgICAgICAgICAgaGFzU2hvcnRDbWFwOiBoYXNTaG9ydENtYXAKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBzYW5pdGl6ZU1ldHJpY3MoZm9udCwgaGVhZGVyLCBtZXRyaWNzLCBudW1HbHlwaHMsIGR1cEZpcnN0RW50cnkpIHsKICAgICAgICAgICAgaWYgKCFoZWFkZXIpIHsKICAgICAgICAgICAgICBpZiAobWV0cmljcykgewogICAgICAgICAgICAgICAgbWV0cmljcy5kYXRhID0gbnVsbDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9udC5wb3MgPSAoZm9udC5zdGFydCA/IGZvbnQuc3RhcnQgOiAwKSArIGhlYWRlci5vZmZzZXQ7CiAgICAgICAgICAgIGZvbnQucG9zICs9IDQ7CiAgICAgICAgICAgIGZvbnQucG9zICs9IDI7CiAgICAgICAgICAgIGZvbnQucG9zICs9IDI7CiAgICAgICAgICAgIGZvbnQucG9zICs9IDI7CiAgICAgICAgICAgIGZvbnQucG9zICs9IDI7CiAgICAgICAgICAgIGZvbnQucG9zICs9IDI7CiAgICAgICAgICAgIGZvbnQucG9zICs9IDI7CiAgICAgICAgICAgIGZvbnQucG9zICs9IDI7CiAgICAgICAgICAgIGZvbnQucG9zICs9IDI7CiAgICAgICAgICAgIGZvbnQucG9zICs9IDI7CiAgICAgICAgICAgIGZvbnQucG9zICs9IDI7CiAgICAgICAgICAgIGZvbnQucG9zICs9IDg7CiAgICAgICAgICAgIGZvbnQucG9zICs9IDI7CiAgICAgICAgICAgIHZhciBudW1PZk1ldHJpY3MgPSBmb250LmdldFVpbnQxNigpOwoKICAgICAgICAgICAgaWYgKG51bU9mTWV0cmljcyA+IG51bUdseXBocykgewogICAgICAgICAgICAgICgwLCBfdXRpbC5pbmZvKSgiVGhlIG51bU9mTWV0cmljcyAoIiArIG51bU9mTWV0cmljcyArICIpIHNob3VsZCBub3QgYmUgIiArICJncmVhdGVyIHRoYW4gdGhlIG51bUdseXBocyAoIiArIG51bUdseXBocyArICIpIik7CiAgICAgICAgICAgICAgbnVtT2ZNZXRyaWNzID0gbnVtR2x5cGhzOwogICAgICAgICAgICAgIGhlYWRlci5kYXRhWzM0XSA9IChudW1PZk1ldHJpY3MgJiAweGZmMDApID4+IDg7CiAgICAgICAgICAgICAgaGVhZGVyLmRhdGFbMzVdID0gbnVtT2ZNZXRyaWNzICYgMHgwMGZmOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgbnVtT2ZTaWRlYmVhcmluZ3MgPSBudW1HbHlwaHMgLSBudW1PZk1ldHJpY3M7CiAgICAgICAgICAgIHZhciBudW1NaXNzaW5nID0gbnVtT2ZTaWRlYmVhcmluZ3MgLSAobWV0cmljcy5sZW5ndGggLSBudW1PZk1ldHJpY3MgKiA0ID4+IDEpOwoKICAgICAgICAgICAgaWYgKG51bU1pc3NpbmcgPiAwKSB7CiAgICAgICAgICAgICAgdmFyIGVudHJpZXMgPSBuZXcgVWludDhBcnJheShtZXRyaWNzLmxlbmd0aCArIG51bU1pc3NpbmcgKiAyKTsKICAgICAgICAgICAgICBlbnRyaWVzLnNldChtZXRyaWNzLmRhdGEpOwoKICAgICAgICAgICAgICBpZiAoZHVwRmlyc3RFbnRyeSkgewogICAgICAgICAgICAgICAgZW50cmllc1ttZXRyaWNzLmxlbmd0aF0gPSBtZXRyaWNzLmRhdGFbMl07CiAgICAgICAgICAgICAgICBlbnRyaWVzW21ldHJpY3MubGVuZ3RoICsgMV0gPSBtZXRyaWNzLmRhdGFbM107CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBtZXRyaWNzLmRhdGEgPSBlbnRyaWVzOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gc2FuaXRpemVHbHlwaChzb3VyY2UsIHNvdXJjZVN0YXJ0LCBzb3VyY2VFbmQsIGRlc3QsIGRlc3RTdGFydCwgaGludHNWYWxpZCkgewogICAgICAgICAgICB2YXIgZ2x5cGhQcm9maWxlID0gewogICAgICAgICAgICAgIGxlbmd0aDogMCwKICAgICAgICAgICAgICBzaXplT2ZJbnN0cnVjdGlvbnM6IDAKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGlmIChzb3VyY2VFbmQgLSBzb3VyY2VTdGFydCA8PSAxMikgewogICAgICAgICAgICAgIHJldHVybiBnbHlwaFByb2ZpbGU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBnbHlmID0gc291cmNlLnN1YmFycmF5KHNvdXJjZVN0YXJ0LCBzb3VyY2VFbmQpOwogICAgICAgICAgICB2YXIgY29udG91cnNDb3VudCA9IHNpZ25lZEludDE2KGdseWZbMF0sIGdseWZbMV0pOwoKICAgICAgICAgICAgaWYgKGNvbnRvdXJzQ291bnQgPCAwKSB7CiAgICAgICAgICAgICAgY29udG91cnNDb3VudCA9IC0xOwogICAgICAgICAgICAgIHdyaXRlU2lnbmVkSW50MTYoZ2x5ZiwgMCwgY29udG91cnNDb3VudCk7CiAgICAgICAgICAgICAgZGVzdC5zZXQoZ2x5ZiwgZGVzdFN0YXJ0KTsKICAgICAgICAgICAgICBnbHlwaFByb2ZpbGUubGVuZ3RoID0gZ2x5Zi5sZW5ndGg7CiAgICAgICAgICAgICAgcmV0dXJuIGdseXBoUHJvZmlsZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGksCiAgICAgICAgICAgICAgaiA9IDEwLAogICAgICAgICAgICAgIGZsYWdzQ291bnQgPSAwOwoKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGNvbnRvdXJzQ291bnQ7IGkrKykgewogICAgICAgICAgICAgIHZhciBlbmRQb2ludCA9IGdseWZbal0gPDwgOCB8IGdseWZbaiArIDFdOwogICAgICAgICAgICAgIGZsYWdzQ291bnQgPSBlbmRQb2ludCArIDE7CiAgICAgICAgICAgICAgaiArPSAyOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgaW5zdHJ1Y3Rpb25zU3RhcnQgPSBqOwogICAgICAgICAgICB2YXIgaW5zdHJ1Y3Rpb25zTGVuZ3RoID0gZ2x5ZltqXSA8PCA4IHwgZ2x5ZltqICsgMV07CiAgICAgICAgICAgIGdseXBoUHJvZmlsZS5zaXplT2ZJbnN0cnVjdGlvbnMgPSBpbnN0cnVjdGlvbnNMZW5ndGg7CiAgICAgICAgICAgIGogKz0gMiArIGluc3RydWN0aW9uc0xlbmd0aDsKICAgICAgICAgICAgdmFyIGluc3RydWN0aW9uc0VuZCA9IGo7CiAgICAgICAgICAgIHZhciBjb29yZGluYXRlc0xlbmd0aCA9IDA7CgogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZmxhZ3NDb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAgdmFyIGZsYWcgPSBnbHlmW2orK107CgogICAgICAgICAgICAgIGlmIChmbGFnICYgMHhjMCkgewogICAgICAgICAgICAgICAgZ2x5ZltqIC0gMV0gPSBmbGFnICYgMHgzZjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciB4TGVuZ3RoID0gMjsKCiAgICAgICAgICAgICAgaWYgKGZsYWcgJiAyKSB7CiAgICAgICAgICAgICAgICB4TGVuZ3RoID0gMTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZsYWcgJiAxNikgewogICAgICAgICAgICAgICAgeExlbmd0aCA9IDA7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgeUxlbmd0aCA9IDI7CgogICAgICAgICAgICAgIGlmIChmbGFnICYgNCkgewogICAgICAgICAgICAgICAgeUxlbmd0aCA9IDE7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChmbGFnICYgMzIpIHsKICAgICAgICAgICAgICAgIHlMZW5ndGggPSAwOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIHh5TGVuZ3RoID0geExlbmd0aCArIHlMZW5ndGg7CiAgICAgICAgICAgICAgY29vcmRpbmF0ZXNMZW5ndGggKz0geHlMZW5ndGg7CgogICAgICAgICAgICAgIGlmIChmbGFnICYgOCkgewogICAgICAgICAgICAgICAgdmFyIHJlcGVhdCA9IGdseWZbaisrXTsKICAgICAgICAgICAgICAgIGkgKz0gcmVwZWF0OwogICAgICAgICAgICAgICAgY29vcmRpbmF0ZXNMZW5ndGggKz0gcmVwZWF0ICogeHlMZW5ndGg7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoY29vcmRpbmF0ZXNMZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICByZXR1cm4gZ2x5cGhQcm9maWxlOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgZ2x5cGhEYXRhTGVuZ3RoID0gaiArIGNvb3JkaW5hdGVzTGVuZ3RoOwoKICAgICAgICAgICAgaWYgKGdseXBoRGF0YUxlbmd0aCA+IGdseWYubGVuZ3RoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGdseXBoUHJvZmlsZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCFoaW50c1ZhbGlkICYmIGluc3RydWN0aW9uc0xlbmd0aCA+IDApIHsKICAgICAgICAgICAgICBkZXN0LnNldChnbHlmLnN1YmFycmF5KDAsIGluc3RydWN0aW9uc1N0YXJ0KSwgZGVzdFN0YXJ0KTsKICAgICAgICAgICAgICBkZXN0LnNldChbMCwgMF0sIGRlc3RTdGFydCArIGluc3RydWN0aW9uc1N0YXJ0KTsKICAgICAgICAgICAgICBkZXN0LnNldChnbHlmLnN1YmFycmF5KGluc3RydWN0aW9uc0VuZCwgZ2x5cGhEYXRhTGVuZ3RoKSwgZGVzdFN0YXJ0ICsgaW5zdHJ1Y3Rpb25zU3RhcnQgKyAyKTsKICAgICAgICAgICAgICBnbHlwaERhdGFMZW5ndGggLT0gaW5zdHJ1Y3Rpb25zTGVuZ3RoOwoKICAgICAgICAgICAgICBpZiAoZ2x5Zi5sZW5ndGggLSBnbHlwaERhdGFMZW5ndGggPiAzKSB7CiAgICAgICAgICAgICAgICBnbHlwaERhdGFMZW5ndGggPSBnbHlwaERhdGFMZW5ndGggKyAzICYgfjM7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBnbHlwaFByb2ZpbGUubGVuZ3RoID0gZ2x5cGhEYXRhTGVuZ3RoOwogICAgICAgICAgICAgIHJldHVybiBnbHlwaFByb2ZpbGU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChnbHlmLmxlbmd0aCAtIGdseXBoRGF0YUxlbmd0aCA+IDMpIHsKICAgICAgICAgICAgICBnbHlwaERhdGFMZW5ndGggPSBnbHlwaERhdGFMZW5ndGggKyAzICYgfjM7CiAgICAgICAgICAgICAgZGVzdC5zZXQoZ2x5Zi5zdWJhcnJheSgwLCBnbHlwaERhdGFMZW5ndGgpLCBkZXN0U3RhcnQpOwogICAgICAgICAgICAgIGdseXBoUHJvZmlsZS5sZW5ndGggPSBnbHlwaERhdGFMZW5ndGg7CiAgICAgICAgICAgICAgcmV0dXJuIGdseXBoUHJvZmlsZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZGVzdC5zZXQoZ2x5ZiwgZGVzdFN0YXJ0KTsKICAgICAgICAgICAgZ2x5cGhQcm9maWxlLmxlbmd0aCA9IGdseWYubGVuZ3RoOwogICAgICAgICAgICByZXR1cm4gZ2x5cGhQcm9maWxlOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHNhbml0aXplSGVhZChoZWFkLCBudW1HbHlwaHMsIGxvY2FMZW5ndGgpIHsKICAgICAgICAgICAgdmFyIGRhdGEgPSBoZWFkLmRhdGE7CiAgICAgICAgICAgIHZhciB2ZXJzaW9uID0gaW50MzIoZGF0YVswXSwgZGF0YVsxXSwgZGF0YVsyXSwgZGF0YVszXSk7CgogICAgICAgICAgICBpZiAodmVyc2lvbiA+PiAxNiAhPT0gMSkgewogICAgICAgICAgICAgICgwLCBfdXRpbC5pbmZvKSgiQXR0ZW1wdGluZyB0byBmaXggaW52YWxpZCB2ZXJzaW9uIGluIGhlYWQgdGFibGU6ICIgKyB2ZXJzaW9uKTsKICAgICAgICAgICAgICBkYXRhWzBdID0gMDsKICAgICAgICAgICAgICBkYXRhWzFdID0gMTsKICAgICAgICAgICAgICBkYXRhWzJdID0gMDsKICAgICAgICAgICAgICBkYXRhWzNdID0gMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGluZGV4VG9Mb2NGb3JtYXQgPSBpbnQxNihkYXRhWzUwXSwgZGF0YVs1MV0pOwoKICAgICAgICAgICAgaWYgKGluZGV4VG9Mb2NGb3JtYXQgPCAwIHx8IGluZGV4VG9Mb2NGb3JtYXQgPiAxKSB7CiAgICAgICAgICAgICAgKDAsIF91dGlsLmluZm8pKCJBdHRlbXB0aW5nIHRvIGZpeCBpbnZhbGlkIGluZGV4VG9Mb2NGb3JtYXQgaW4gaGVhZCB0YWJsZTogIiArIGluZGV4VG9Mb2NGb3JtYXQpOwogICAgICAgICAgICAgIHZhciBudW1HbHlwaHNQbHVzT25lID0gbnVtR2x5cGhzICsgMTsKCiAgICAgICAgICAgICAgaWYgKGxvY2FMZW5ndGggPT09IG51bUdseXBoc1BsdXNPbmUgPDwgMSkgewogICAgICAgICAgICAgICAgZGF0YVs1MF0gPSAwOwogICAgICAgICAgICAgICAgZGF0YVs1MV0gPSAwOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAobG9jYUxlbmd0aCA9PT0gbnVtR2x5cGhzUGx1c09uZSA8PCAyKSB7CiAgICAgICAgICAgICAgICBkYXRhWzUwXSA9IDA7CiAgICAgICAgICAgICAgICBkYXRhWzUxXSA9IDE7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiQ291bGQgbm90IGZpeCBpbmRleFRvTG9jRm9ybWF0OiAiICsgaW5kZXhUb0xvY0Zvcm1hdCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gc2FuaXRpemVHbHlwaExvY2F0aW9ucyhsb2NhLCBnbHlmLCBudW1HbHlwaHMsIGlzR2x5cGhMb2NhdGlvbnNMb25nLCBoaW50c1ZhbGlkLCBkdXBGaXJzdEVudHJ5LCBtYXhTaXplT2ZJbnN0cnVjdGlvbnMpIHsKICAgICAgICAgICAgdmFyIGl0ZW1TaXplLCBpdGVtRGVjb2RlLCBpdGVtRW5jb2RlOwoKICAgICAgICAgICAgaWYgKGlzR2x5cGhMb2NhdGlvbnNMb25nKSB7CiAgICAgICAgICAgICAgaXRlbVNpemUgPSA0OwoKICAgICAgICAgICAgICBpdGVtRGVjb2RlID0gZnVuY3Rpb24gZm9udEl0ZW1EZWNvZGVMb25nKGRhdGEsIG9mZnNldCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFbb2Zmc2V0XSA8PCAyNCB8IGRhdGFbb2Zmc2V0ICsgMV0gPDwgMTYgfCBkYXRhW29mZnNldCArIDJdIDw8IDggfCBkYXRhW29mZnNldCArIDNdOwogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIGl0ZW1FbmNvZGUgPSBmdW5jdGlvbiBmb250SXRlbUVuY29kZUxvbmcoZGF0YSwgb2Zmc2V0LCB2YWx1ZSkgewogICAgICAgICAgICAgICAgZGF0YVtvZmZzZXRdID0gdmFsdWUgPj4+IDI0ICYgMHhmZjsKICAgICAgICAgICAgICAgIGRhdGFbb2Zmc2V0ICsgMV0gPSB2YWx1ZSA+PiAxNiAmIDB4ZmY7CiAgICAgICAgICAgICAgICBkYXRhW29mZnNldCArIDJdID0gdmFsdWUgPj4gOCAmIDB4ZmY7CiAgICAgICAgICAgICAgICBkYXRhW29mZnNldCArIDNdID0gdmFsdWUgJiAweGZmOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgaXRlbVNpemUgPSAyOwoKICAgICAgICAgICAgICBpdGVtRGVjb2RlID0gZnVuY3Rpb24gZm9udEl0ZW1EZWNvZGUoZGF0YSwgb2Zmc2V0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVtvZmZzZXRdIDw8IDkgfCBkYXRhW29mZnNldCArIDFdIDw8IDE7CiAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgaXRlbUVuY29kZSA9IGZ1bmN0aW9uIGZvbnRJdGVtRW5jb2RlKGRhdGEsIG9mZnNldCwgdmFsdWUpIHsKICAgICAgICAgICAgICAgIGRhdGFbb2Zmc2V0XSA9IHZhbHVlID4+IDkgJiAweGZmOwogICAgICAgICAgICAgICAgZGF0YVtvZmZzZXQgKyAxXSA9IHZhbHVlID4+IDEgJiAweGZmOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBudW1HbHlwaHNPdXQgPSBkdXBGaXJzdEVudHJ5ID8gbnVtR2x5cGhzICsgMSA6IG51bUdseXBoczsKICAgICAgICAgICAgdmFyIGxvY2FEYXRhU2l6ZSA9IGl0ZW1TaXplICogKDEgKyBudW1HbHlwaHNPdXQpOwogICAgICAgICAgICB2YXIgbG9jYURhdGEgPSBuZXcgVWludDhBcnJheShsb2NhRGF0YVNpemUpOwogICAgICAgICAgICBsb2NhRGF0YS5zZXQobG9jYS5kYXRhLnN1YmFycmF5KDAsIGxvY2FEYXRhU2l6ZSkpOwogICAgICAgICAgICBsb2NhLmRhdGEgPSBsb2NhRGF0YTsKICAgICAgICAgICAgdmFyIG9sZEdseWZEYXRhID0gZ2x5Zi5kYXRhOwogICAgICAgICAgICB2YXIgb2xkR2x5ZkRhdGFMZW5ndGggPSBvbGRHbHlmRGF0YS5sZW5ndGg7CiAgICAgICAgICAgIHZhciBuZXdHbHlmRGF0YSA9IG5ldyBVaW50OEFycmF5KG9sZEdseWZEYXRhTGVuZ3RoKTsKICAgICAgICAgICAgdmFyIHN0YXJ0T2Zmc2V0ID0gaXRlbURlY29kZShsb2NhRGF0YSwgMCk7CiAgICAgICAgICAgIHZhciB3cml0ZU9mZnNldCA9IDA7CiAgICAgICAgICAgIHZhciBtaXNzaW5nR2x5cGhzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICAgICAgaXRlbUVuY29kZShsb2NhRGF0YSwgMCwgd3JpdGVPZmZzZXQpOwogICAgICAgICAgICB2YXIgaSwgajsKCiAgICAgICAgICAgIGZvciAoaSA9IDAsIGogPSBpdGVtU2l6ZTsgaSA8IG51bUdseXBoczsgaSsrLCBqICs9IGl0ZW1TaXplKSB7CiAgICAgICAgICAgICAgdmFyIGVuZE9mZnNldCA9IGl0ZW1EZWNvZGUobG9jYURhdGEsIGopOwoKICAgICAgICAgICAgICBpZiAoZW5kT2Zmc2V0ID09PSAwKSB7CiAgICAgICAgICAgICAgICBlbmRPZmZzZXQgPSBzdGFydE9mZnNldDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChlbmRPZmZzZXQgPiBvbGRHbHlmRGF0YUxlbmd0aCAmJiAob2xkR2x5ZkRhdGFMZW5ndGggKyAzICYgfjMpID09PSBlbmRPZmZzZXQpIHsKICAgICAgICAgICAgICAgIGVuZE9mZnNldCA9IG9sZEdseWZEYXRhTGVuZ3RoOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGVuZE9mZnNldCA+IG9sZEdseWZEYXRhTGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBzdGFydE9mZnNldCA9IGVuZE9mZnNldDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBnbHlwaFByb2ZpbGUgPSBzYW5pdGl6ZUdseXBoKG9sZEdseWZEYXRhLCBzdGFydE9mZnNldCwgZW5kT2Zmc2V0LCBuZXdHbHlmRGF0YSwgd3JpdGVPZmZzZXQsIGhpbnRzVmFsaWQpOwogICAgICAgICAgICAgIHZhciBuZXdMZW5ndGggPSBnbHlwaFByb2ZpbGUubGVuZ3RoOwoKICAgICAgICAgICAgICBpZiAobmV3TGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICBtaXNzaW5nR2x5cGhzW2ldID0gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChnbHlwaFByb2ZpbGUuc2l6ZU9mSW5zdHJ1Y3Rpb25zID4gbWF4U2l6ZU9mSW5zdHJ1Y3Rpb25zKSB7CiAgICAgICAgICAgICAgICBtYXhTaXplT2ZJbnN0cnVjdGlvbnMgPSBnbHlwaFByb2ZpbGUuc2l6ZU9mSW5zdHJ1Y3Rpb25zOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgd3JpdGVPZmZzZXQgKz0gbmV3TGVuZ3RoOwogICAgICAgICAgICAgIGl0ZW1FbmNvZGUobG9jYURhdGEsIGosIHdyaXRlT2Zmc2V0KTsKICAgICAgICAgICAgICBzdGFydE9mZnNldCA9IGVuZE9mZnNldDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHdyaXRlT2Zmc2V0ID09PSAwKSB7CiAgICAgICAgICAgICAgdmFyIHNpbXBsZUdseXBoID0gbmV3IFVpbnQ4QXJyYXkoWzAsIDEsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDQ5LCAwXSk7CgogICAgICAgICAgICAgIGZvciAoaSA9IDAsIGogPSBpdGVtU2l6ZTsgaSA8IG51bUdseXBoc091dDsgaSsrLCBqICs9IGl0ZW1TaXplKSB7CiAgICAgICAgICAgICAgICBpdGVtRW5jb2RlKGxvY2FEYXRhLCBqLCBzaW1wbGVHbHlwaC5sZW5ndGgpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZ2x5Zi5kYXRhID0gc2ltcGxlR2x5cGg7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZHVwRmlyc3RFbnRyeSkgewogICAgICAgICAgICAgIHZhciBmaXJzdEVudHJ5TGVuZ3RoID0gaXRlbURlY29kZShsb2NhRGF0YSwgaXRlbVNpemUpOwoKICAgICAgICAgICAgICBpZiAobmV3R2x5ZkRhdGEubGVuZ3RoID4gZmlyc3RFbnRyeUxlbmd0aCArIHdyaXRlT2Zmc2V0KSB7CiAgICAgICAgICAgICAgICBnbHlmLmRhdGEgPSBuZXdHbHlmRGF0YS5zdWJhcnJheSgwLCBmaXJzdEVudHJ5TGVuZ3RoICsgd3JpdGVPZmZzZXQpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBnbHlmLmRhdGEgPSBuZXcgVWludDhBcnJheShmaXJzdEVudHJ5TGVuZ3RoICsgd3JpdGVPZmZzZXQpOwogICAgICAgICAgICAgICAgZ2x5Zi5kYXRhLnNldChuZXdHbHlmRGF0YS5zdWJhcnJheSgwLCB3cml0ZU9mZnNldCkpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZ2x5Zi5kYXRhLnNldChuZXdHbHlmRGF0YS5zdWJhcnJheSgwLCBmaXJzdEVudHJ5TGVuZ3RoKSwgd3JpdGVPZmZzZXQpOwogICAgICAgICAgICAgIGl0ZW1FbmNvZGUobG9jYS5kYXRhLCBsb2NhRGF0YS5sZW5ndGggLSBpdGVtU2l6ZSwgd3JpdGVPZmZzZXQgKyBmaXJzdEVudHJ5TGVuZ3RoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBnbHlmLmRhdGEgPSBuZXdHbHlmRGF0YS5zdWJhcnJheSgwLCB3cml0ZU9mZnNldCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgbWlzc2luZ0dseXBoczogbWlzc2luZ0dseXBocywKICAgICAgICAgICAgICBtYXhTaXplT2ZJbnN0cnVjdGlvbnM6IG1heFNpemVPZkluc3RydWN0aW9ucwogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHJlYWRQb3N0U2NyaXB0VGFibGUocG9zdCwgcHJvcGVydGllcywgbWF4cE51bUdseXBocykgewogICAgICAgICAgICB2YXIgc3RhcnQgPSAoZm9udC5zdGFydCA/IGZvbnQuc3RhcnQgOiAwKSArIHBvc3Qub2Zmc2V0OwogICAgICAgICAgICBmb250LnBvcyA9IHN0YXJ0OwogICAgICAgICAgICB2YXIgbGVuZ3RoID0gcG9zdC5sZW5ndGgsCiAgICAgICAgICAgICAgZW5kID0gc3RhcnQgKyBsZW5ndGg7CiAgICAgICAgICAgIHZhciB2ZXJzaW9uID0gZm9udC5nZXRJbnQzMigpOwogICAgICAgICAgICBmb250LmdldEJ5dGVzKDI4KTsKICAgICAgICAgICAgdmFyIGdseXBoTmFtZXM7CiAgICAgICAgICAgIHZhciB2YWxpZCA9IHRydWU7CiAgICAgICAgICAgIHZhciBpOwoKICAgICAgICAgICAgc3dpdGNoICh2ZXJzaW9uKSB7CiAgICAgICAgICAgICAgY2FzZSAweDAwMDEwMDAwOgogICAgICAgICAgICAgICAgZ2x5cGhOYW1lcyA9IE1hY1N0YW5kYXJkR2x5cGhPcmRlcmluZzsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDB4MDAwMjAwMDA6CiAgICAgICAgICAgICAgICB2YXIgbnVtR2x5cGhzID0gZm9udC5nZXRVaW50MTYoKTsKCiAgICAgICAgICAgICAgICBpZiAobnVtR2x5cGhzICE9PSBtYXhwTnVtR2x5cGhzKSB7CiAgICAgICAgICAgICAgICAgIHZhbGlkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHZhciBnbHlwaE5hbWVJbmRleGVzID0gW107CgogICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IG51bUdseXBoczsgKytpKSB7CiAgICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IGZvbnQuZ2V0VWludDE2KCk7CgogICAgICAgICAgICAgICAgICBpZiAoaW5kZXggPj0gMzI3NjgpIHsKICAgICAgICAgICAgICAgICAgICB2YWxpZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBnbHlwaE5hbWVJbmRleGVzLnB1c2goaW5kZXgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICghdmFsaWQpIHsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdmFyIGN1c3RvbU5hbWVzID0gW107CiAgICAgICAgICAgICAgICB2YXIgc3RyQnVmID0gW107CgogICAgICAgICAgICAgICAgd2hpbGUgKGZvbnQucG9zIDwgZW5kKSB7CiAgICAgICAgICAgICAgICAgIHZhciBzdHJpbmdMZW5ndGggPSBmb250LmdldEJ5dGUoKTsKICAgICAgICAgICAgICAgICAgc3RyQnVmLmxlbmd0aCA9IHN0cmluZ0xlbmd0aDsKCiAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzdHJpbmdMZW5ndGg7ICsraSkgewogICAgICAgICAgICAgICAgICAgIHN0ckJ1ZltpXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoZm9udC5nZXRCeXRlKCkpOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBjdXN0b21OYW1lcy5wdXNoKHN0ckJ1Zi5qb2luKCIiKSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZ2x5cGhOYW1lcyA9IFtdOwoKICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBudW1HbHlwaHM7ICsraSkgewogICAgICAgICAgICAgICAgICB2YXIgaiA9IGdseXBoTmFtZUluZGV4ZXNbaV07CgogICAgICAgICAgICAgICAgICBpZiAoaiA8IDI1OCkgewogICAgICAgICAgICAgICAgICAgIGdseXBoTmFtZXMucHVzaChNYWNTdGFuZGFyZEdseXBoT3JkZXJpbmdbal0pOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBnbHlwaE5hbWVzLnB1c2goY3VzdG9tTmFtZXNbaiAtIDI1OF0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDB4MDAwMzAwMDA6CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiVW5rbm93bi91bnN1cHBvcnRlZCBwb3N0IHRhYmxlIHZlcnNpb24gIiArIHZlcnNpb24pOwogICAgICAgICAgICAgICAgdmFsaWQgPSBmYWxzZTsKCiAgICAgICAgICAgICAgICBpZiAocHJvcGVydGllcy5kZWZhdWx0RW5jb2RpbmcpIHsKICAgICAgICAgICAgICAgICAgZ2x5cGhOYW1lcyA9IHByb3BlcnRpZXMuZGVmYXVsdEVuY29kaW5nOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwcm9wZXJ0aWVzLmdseXBoTmFtZXMgPSBnbHlwaE5hbWVzOwogICAgICAgICAgICByZXR1cm4gdmFsaWQ7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gcmVhZE5hbWVUYWJsZShuYW1lVGFibGUpIHsKICAgICAgICAgICAgdmFyIHN0YXJ0ID0gKGZvbnQuc3RhcnQgPyBmb250LnN0YXJ0IDogMCkgKyBuYW1lVGFibGUub2Zmc2V0OwogICAgICAgICAgICBmb250LnBvcyA9IHN0YXJ0OwogICAgICAgICAgICB2YXIgbmFtZXMgPSBbW10sIFtdXTsKICAgICAgICAgICAgdmFyIGxlbmd0aCA9IG5hbWVUYWJsZS5sZW5ndGgsCiAgICAgICAgICAgICAgZW5kID0gc3RhcnQgKyBsZW5ndGg7CiAgICAgICAgICAgIHZhciBmb3JtYXQgPSBmb250LmdldFVpbnQxNigpOwogICAgICAgICAgICB2YXIgRk9STUFUXzBfSEVBREVSX0xFTkdUSCA9IDY7CgogICAgICAgICAgICBpZiAoZm9ybWF0ICE9PSAwIHx8IGxlbmd0aCA8IEZPUk1BVF8wX0hFQURFUl9MRU5HVEgpIHsKICAgICAgICAgICAgICByZXR1cm4gbmFtZXM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBudW1SZWNvcmRzID0gZm9udC5nZXRVaW50MTYoKTsKICAgICAgICAgICAgdmFyIHN0cmluZ3NTdGFydCA9IGZvbnQuZ2V0VWludDE2KCk7CiAgICAgICAgICAgIHZhciByZWNvcmRzID0gW107CiAgICAgICAgICAgIHZhciBOQU1FX1JFQ09SRF9MRU5HVEggPSAxMjsKICAgICAgICAgICAgdmFyIGksIGlpOwoKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IG51bVJlY29yZHMgJiYgZm9udC5wb3MgKyBOQU1FX1JFQ09SRF9MRU5HVEggPD0gZW5kOyBpKyspIHsKICAgICAgICAgICAgICB2YXIgciA9IHsKICAgICAgICAgICAgICAgIHBsYXRmb3JtOiBmb250LmdldFVpbnQxNigpLAogICAgICAgICAgICAgICAgZW5jb2Rpbmc6IGZvbnQuZ2V0VWludDE2KCksCiAgICAgICAgICAgICAgICBsYW5ndWFnZTogZm9udC5nZXRVaW50MTYoKSwKICAgICAgICAgICAgICAgIG5hbWU6IGZvbnQuZ2V0VWludDE2KCksCiAgICAgICAgICAgICAgICBsZW5ndGg6IGZvbnQuZ2V0VWludDE2KCksCiAgICAgICAgICAgICAgICBvZmZzZXQ6IGZvbnQuZ2V0VWludDE2KCkKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICBpZiAoci5wbGF0Zm9ybSA9PT0gMSAmJiByLmVuY29kaW5nID09PSAwICYmIHIubGFuZ3VhZ2UgPT09IDAgfHwgci5wbGF0Zm9ybSA9PT0gMyAmJiByLmVuY29kaW5nID09PSAxICYmIHIubGFuZ3VhZ2UgPT09IDB4NDA5KSB7CiAgICAgICAgICAgICAgICByZWNvcmRzLnB1c2gocik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IHJlY29yZHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICAgIHZhciByZWNvcmQgPSByZWNvcmRzW2ldOwoKICAgICAgICAgICAgICBpZiAocmVjb3JkLmxlbmd0aCA8PSAwKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBwb3MgPSBzdGFydCArIHN0cmluZ3NTdGFydCArIHJlY29yZC5vZmZzZXQ7CgogICAgICAgICAgICAgIGlmIChwb3MgKyByZWNvcmQubGVuZ3RoID4gZW5kKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGZvbnQucG9zID0gcG9zOwogICAgICAgICAgICAgIHZhciBuYW1lSW5kZXggPSByZWNvcmQubmFtZTsKCiAgICAgICAgICAgICAgaWYgKHJlY29yZC5lbmNvZGluZykgewogICAgICAgICAgICAgICAgdmFyIHN0ciA9ICIiOwoKICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwLCBqaiA9IHJlY29yZC5sZW5ndGg7IGogPCBqajsgaiArPSAyKSB7CiAgICAgICAgICAgICAgICAgIHN0ciArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGZvbnQuZ2V0VWludDE2KCkpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG5hbWVzWzFdW25hbWVJbmRleF0gPSBzdHI7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG5hbWVzWzBdW25hbWVJbmRleF0gPSAoMCwgX3V0aWwuYnl0ZXNUb1N0cmluZykoZm9udC5nZXRCeXRlcyhyZWNvcmQubGVuZ3RoKSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gbmFtZXM7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIFRUT3BzU3RhY2tEZWx0YXMgPSBbMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgLTIsIC0yLCAtMiwgLTIsIDAsIDAsIC0yLCAtNSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAwLCAwLCAtMSwgMCwgLTEsIC0xLCAtMSwgLTEsIDEsIC0xLCAtOTk5LCAwLCAxLCAwLCAtMSwgLTIsIDAsIC0xLCAtMiwgLTEsIC0xLCAwLCAtMSwgLTEsIDAsIDAsIC05OTksIC05OTksIC0xLCAtMSwgLTEsIC0xLCAtMiwgLTk5OSwgLTIsIC0yLCAtOTk5LCAwLCAtMiwgLTIsIDAsIDAsIC0yLCAwLCAtMiwgMCwgMCwgMCwgLTIsIC0xLCAtMSwgMSwgMSwgMCwgMCwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIDAsIDAsIC0xLCAwLCAtMSwgLTEsIDAsIC05OTksIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIC0yLCAtOTk5LCAtOTk5LCAtOTk5LCAtOTk5LCAtOTk5LCAtMSwgLTEsIC0yLCAtMiwgMCwgMCwgMCwgMCwgLTEsIC0xLCAtOTk5LCAtMiwgLTIsIDAsIDAsIC0xLCAtMiwgLTIsIDAsIDAsIDAsIC0xLCAtMSwgLTEsIC0yXTsKCiAgICAgICAgICBmdW5jdGlvbiBzYW5pdGl6ZVRUUHJvZ3JhbSh0YWJsZSwgdHRDb250ZXh0KSB7CiAgICAgICAgICAgIHZhciBkYXRhID0gdGFibGUuZGF0YTsKICAgICAgICAgICAgdmFyIGkgPSAwLAogICAgICAgICAgICAgIGosCiAgICAgICAgICAgICAgbiwKICAgICAgICAgICAgICBiLAogICAgICAgICAgICAgIGZ1bmNJZCwKICAgICAgICAgICAgICBwYywKICAgICAgICAgICAgICBsYXN0RW5kZiA9IDAsCiAgICAgICAgICAgICAgbGFzdERlZmYgPSAwOwogICAgICAgICAgICB2YXIgc3RhY2sgPSBbXTsKICAgICAgICAgICAgdmFyIGNhbGxzdGFjayA9IFtdOwogICAgICAgICAgICB2YXIgZnVuY3Rpb25zQ2FsbGVkID0gW107CiAgICAgICAgICAgIHZhciB0b29Db21wbGV4VG9Gb2xsb3dGdW5jdGlvbnMgPSB0dENvbnRleHQudG9vQ29tcGxleFRvRm9sbG93RnVuY3Rpb25zOwogICAgICAgICAgICB2YXIgaW5GREVGID0gZmFsc2UsCiAgICAgICAgICAgICAgaWZMZXZlbCA9IDAsCiAgICAgICAgICAgICAgaW5FTFNFID0gMDsKCiAgICAgICAgICAgIGZvciAodmFyIGlpID0gZGF0YS5sZW5ndGg7IGkgPCBpaTspIHsKICAgICAgICAgICAgICB2YXIgb3AgPSBkYXRhW2krK107CgogICAgICAgICAgICAgIGlmIChvcCA9PT0gMHg0MCkgewogICAgICAgICAgICAgICAgbiA9IGRhdGFbaSsrXTsKCiAgICAgICAgICAgICAgICBpZiAoaW5GREVGIHx8IGluRUxTRSkgewogICAgICAgICAgICAgICAgICBpICs9IG47CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgbjsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgc3RhY2sucHVzaChkYXRhW2krK10pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChvcCA9PT0gMHg0MSkgewogICAgICAgICAgICAgICAgbiA9IGRhdGFbaSsrXTsKCiAgICAgICAgICAgICAgICBpZiAoaW5GREVGIHx8IGluRUxTRSkgewogICAgICAgICAgICAgICAgICBpICs9IG4gKiAyOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IG47IGorKykgewogICAgICAgICAgICAgICAgICAgIGIgPSBkYXRhW2krK107CiAgICAgICAgICAgICAgICAgICAgc3RhY2sucHVzaChiIDw8IDggfCBkYXRhW2krK10pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIGlmICgob3AgJiAweGY4KSA9PT0gMHhiMCkgewogICAgICAgICAgICAgICAgbiA9IG9wIC0gMHhiMCArIDE7CgogICAgICAgICAgICAgICAgaWYgKGluRkRFRiB8fCBpbkVMU0UpIHsKICAgICAgICAgICAgICAgICAgaSArPSBuOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IG47IGorKykgewogICAgICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goZGF0YVtpKytdKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSBpZiAoKG9wICYgMHhmOCkgPT09IDB4YjgpIHsKICAgICAgICAgICAgICAgIG4gPSBvcCAtIDB4YjggKyAxOwoKICAgICAgICAgICAgICAgIGlmIChpbkZERUYgfHwgaW5FTFNFKSB7CiAgICAgICAgICAgICAgICAgIGkgKz0gbiAqIDI7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgbjsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgYiA9IGRhdGFbaSsrXTsKICAgICAgICAgICAgICAgICAgICBzdGFjay5wdXNoKGIgPDwgOCB8IGRhdGFbaSsrXSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9wID09PSAweDJiICYmICF0b29Db21wbGV4VG9Gb2xsb3dGdW5jdGlvbnMpIHsKICAgICAgICAgICAgICAgIGlmICghaW5GREVGICYmICFpbkVMU0UpIHsKICAgICAgICAgICAgICAgICAgZnVuY0lkID0gc3RhY2tbc3RhY2subGVuZ3RoIC0gMV07CgogICAgICAgICAgICAgICAgICBpZiAoaXNOYU4oZnVuY0lkKSkgewogICAgICAgICAgICAgICAgICAgICgwLCBfdXRpbC5pbmZvKSgiVFQ6IENBTEwgZW1wdHkgc3RhY2sgKG9yIGludmFsaWQgZW50cnkpLiIpOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHR0Q29udGV4dC5mdW5jdGlvbnNVc2VkW2Z1bmNJZF0gPSB0cnVlOwoKICAgICAgICAgICAgICAgICAgICBpZiAoZnVuY0lkIGluIHR0Q29udGV4dC5mdW5jdGlvbnNTdGFja0RlbHRhcykgewogICAgICAgICAgICAgICAgICAgICAgdmFyIG5ld1N0YWNrTGVuZ3RoID0gc3RhY2subGVuZ3RoICsgdHRDb250ZXh0LmZ1bmN0aW9uc1N0YWNrRGVsdGFzW2Z1bmNJZF07CgogICAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1N0YWNrTGVuZ3RoIDwgMCkgewogICAgICAgICAgICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIlRUOiBDQUxMIGludmFsaWQgZnVuY3Rpb25zIHN0YWNrIGRlbHRhLiIpOwogICAgICAgICAgICAgICAgICAgICAgICB0dENvbnRleHQuaGludHNWYWxpZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgc3RhY2subGVuZ3RoID0gbmV3U3RhY2tMZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChmdW5jSWQgaW4gdHRDb250ZXh0LmZ1bmN0aW9uc0RlZmluZWQgJiYgIWZ1bmN0aW9uc0NhbGxlZC5pbmNsdWRlcyhmdW5jSWQpKSB7CiAgICAgICAgICAgICAgICAgICAgICBjYWxsc3RhY2sucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgIGk6IGksCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrVG9wOiBzdGFjay5sZW5ndGggLSAxCiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uc0NhbGxlZC5wdXNoKGZ1bmNJZCk7CiAgICAgICAgICAgICAgICAgICAgICBwYyA9IHR0Q29udGV4dC5mdW5jdGlvbnNEZWZpbmVkW2Z1bmNJZF07CgogICAgICAgICAgICAgICAgICAgICAgaWYgKCFwYykgewogICAgICAgICAgICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIlRUOiBDQUxMIG5vbi1leGlzdGVudCBmdW5jdGlvbiIpOwogICAgICAgICAgICAgICAgICAgICAgICB0dENvbnRleHQuaGludHNWYWxpZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IHBjLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICBpID0gcGMuaTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9wID09PSAweDJjICYmICF0b29Db21wbGV4VG9Gb2xsb3dGdW5jdGlvbnMpIHsKICAgICAgICAgICAgICAgIGlmIChpbkZERUYgfHwgaW5FTFNFKSB7CiAgICAgICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiVFQ6IG5lc3RlZCBGREVGcyBub3QgYWxsb3dlZCIpOwogICAgICAgICAgICAgICAgICB0b29Db21wbGV4VG9Gb2xsb3dGdW5jdGlvbnMgPSB0cnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGluRkRFRiA9IHRydWU7CiAgICAgICAgICAgICAgICBsYXN0RGVmZiA9IGk7CiAgICAgICAgICAgICAgICBmdW5jSWQgPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgIHR0Q29udGV4dC5mdW5jdGlvbnNEZWZpbmVkW2Z1bmNJZF0gPSB7CiAgICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgICAgICAgICAgIGk6IGkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChvcCA9PT0gMHgyZCkgewogICAgICAgICAgICAgICAgaWYgKGluRkRFRikgewogICAgICAgICAgICAgICAgICBpbkZERUYgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgbGFzdEVuZGYgPSBpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgcGMgPSBjYWxsc3RhY2sucG9wKCk7CgogICAgICAgICAgICAgICAgICBpZiAoIXBjKSB7CiAgICAgICAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJUVDogRU5ERiBiYWQgc3RhY2siKTsKICAgICAgICAgICAgICAgICAgICB0dENvbnRleHQuaGludHNWYWxpZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgZnVuY0lkID0gZnVuY3Rpb25zQ2FsbGVkLnBvcCgpOwogICAgICAgICAgICAgICAgICBkYXRhID0gcGMuZGF0YTsKICAgICAgICAgICAgICAgICAgaSA9IHBjLmk7CiAgICAgICAgICAgICAgICAgIHR0Q29udGV4dC5mdW5jdGlvbnNTdGFja0RlbHRhc1tmdW5jSWRdID0gc3RhY2subGVuZ3RoIC0gcGMuc3RhY2tUb3A7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChvcCA9PT0gMHg4OSkgewogICAgICAgICAgICAgICAgaWYgKGluRkRFRiB8fCBpbkVMU0UpIHsKICAgICAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJUVDogbmVzdGVkIElERUZzIG5vdCBhbGxvd2VkIik7CiAgICAgICAgICAgICAgICAgIHRvb0NvbXBsZXhUb0ZvbGxvd0Z1bmN0aW9ucyA9IHRydWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaW5GREVGID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGxhc3REZWZmID0gaTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9wID09PSAweDU4KSB7CiAgICAgICAgICAgICAgICArK2lmTGV2ZWw7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChvcCA9PT0gMHgxYikgewogICAgICAgICAgICAgICAgaW5FTFNFID0gaWZMZXZlbDsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9wID09PSAweDU5KSB7CiAgICAgICAgICAgICAgICBpZiAoaW5FTFNFID09PSBpZkxldmVsKSB7CiAgICAgICAgICAgICAgICAgIGluRUxTRSA9IDA7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLS1pZkxldmVsOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAob3AgPT09IDB4MWMpIHsKICAgICAgICAgICAgICAgIGlmICghaW5GREVGICYmICFpbkVMU0UpIHsKICAgICAgICAgICAgICAgICAgdmFyIG9mZnNldCA9IHN0YWNrW3N0YWNrLmxlbmd0aCAtIDFdOwoKICAgICAgICAgICAgICAgICAgaWYgKG9mZnNldCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBpICs9IG9mZnNldCAtIDE7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICghaW5GREVGICYmICFpbkVMU0UpIHsKICAgICAgICAgICAgICAgIHZhciBzdGFja0RlbHRhID0gMDsKCiAgICAgICAgICAgICAgICBpZiAob3AgPD0gMHg4ZSkgewogICAgICAgICAgICAgICAgICBzdGFja0RlbHRhID0gVFRPcHNTdGFja0RlbHRhc1tvcF07CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9wID49IDB4YzAgJiYgb3AgPD0gMHhkZikgewogICAgICAgICAgICAgICAgICBzdGFja0RlbHRhID0gLTE7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9wID49IDB4ZTApIHsKICAgICAgICAgICAgICAgICAgc3RhY2tEZWx0YSA9IC0yOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChvcCA+PSAweDcxICYmIG9wIDw9IDB4NzUpIHsKICAgICAgICAgICAgICAgICAgbiA9IHN0YWNrLnBvcCgpOwoKICAgICAgICAgICAgICAgICAgaWYgKCFpc05hTihuKSkgewogICAgICAgICAgICAgICAgICAgIHN0YWNrRGVsdGEgPSAtbiAqIDI7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB3aGlsZSAoc3RhY2tEZWx0YSA8IDAgJiYgc3RhY2subGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgICAgc3RhY2tEZWx0YSsrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHdoaWxlIChzdGFja0RlbHRhID4gMCkgewogICAgICAgICAgICAgICAgICBzdGFjay5wdXNoKE5hTik7CiAgICAgICAgICAgICAgICAgIHN0YWNrRGVsdGEtLTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHR0Q29udGV4dC50b29Db21wbGV4VG9Gb2xsb3dGdW5jdGlvbnMgPSB0b29Db21wbGV4VG9Gb2xsb3dGdW5jdGlvbnM7CiAgICAgICAgICAgIHZhciBjb250ZW50ID0gW2RhdGFdOwoKICAgICAgICAgICAgaWYgKGkgPiBkYXRhLmxlbmd0aCkgewogICAgICAgICAgICAgIGNvbnRlbnQucHVzaChuZXcgVWludDhBcnJheShpIC0gZGF0YS5sZW5ndGgpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGxhc3REZWZmID4gbGFzdEVuZGYpIHsKICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIlRUOiBjb21wbGVtZW50aW5nIGEgbWlzc2luZyBmdW5jdGlvbiB0YWlsIik7CiAgICAgICAgICAgICAgY29udGVudC5wdXNoKG5ldyBVaW50OEFycmF5KFsweDIyLCAweDJkXSkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmb2xkVFRUYWJsZSh0YWJsZSwgY29udGVudCk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gY2hlY2tJbnZhbGlkRnVuY3Rpb25zKHR0Q29udGV4dCwgbWF4RnVuY3Rpb25EZWZzKSB7CiAgICAgICAgICAgIGlmICh0dENvbnRleHQudG9vQ29tcGxleFRvRm9sbG93RnVuY3Rpb25zKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodHRDb250ZXh0LmZ1bmN0aW9uc0RlZmluZWQubGVuZ3RoID4gbWF4RnVuY3Rpb25EZWZzKSB7CiAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJUVDogbW9yZSBmdW5jdGlvbnMgZGVmaW5lZCB0aGFuIGV4cGVjdGVkIik7CiAgICAgICAgICAgICAgdHRDb250ZXh0LmhpbnRzVmFsaWQgPSBmYWxzZTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvciAodmFyIGogPSAwLCBqaiA9IHR0Q29udGV4dC5mdW5jdGlvbnNVc2VkLmxlbmd0aDsgaiA8IGpqOyBqKyspIHsKICAgICAgICAgICAgICBpZiAoaiA+IG1heEZ1bmN0aW9uRGVmcykgewogICAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJUVDogaW52YWxpZCBmdW5jdGlvbiBpZDogIiArIGopOwogICAgICAgICAgICAgICAgdHRDb250ZXh0LmhpbnRzVmFsaWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICh0dENvbnRleHQuZnVuY3Rpb25zVXNlZFtqXSAmJiAhdHRDb250ZXh0LmZ1bmN0aW9uc0RlZmluZWRbal0pIHsKICAgICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiVFQ6IHVuZGVmaW5lZCBmdW5jdGlvbjogIiArIGopOwogICAgICAgICAgICAgICAgdHRDb250ZXh0LmhpbnRzVmFsaWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBmb2xkVFRUYWJsZSh0YWJsZSwgY29udGVudCkgewogICAgICAgICAgICBpZiAoY29udGVudC5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgdmFyIG5ld0xlbmd0aCA9IDA7CiAgICAgICAgICAgICAgdmFyIGosIGpqOwoKICAgICAgICAgICAgICBmb3IgKGogPSAwLCBqaiA9IGNvbnRlbnQubGVuZ3RoOyBqIDwgamo7IGorKykgewogICAgICAgICAgICAgICAgbmV3TGVuZ3RoICs9IGNvbnRlbnRbal0ubGVuZ3RoOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgbmV3TGVuZ3RoID0gbmV3TGVuZ3RoICsgMyAmIH4zOwogICAgICAgICAgICAgIHZhciByZXN1bHQgPSBuZXcgVWludDhBcnJheShuZXdMZW5ndGgpOwogICAgICAgICAgICAgIHZhciBwb3MgPSAwOwoKICAgICAgICAgICAgICBmb3IgKGogPSAwLCBqaiA9IGNvbnRlbnQubGVuZ3RoOyBqIDwgamo7IGorKykgewogICAgICAgICAgICAgICAgcmVzdWx0LnNldChjb250ZW50W2pdLCBwb3MpOwogICAgICAgICAgICAgICAgcG9zICs9IGNvbnRlbnRbal0ubGVuZ3RoOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdGFibGUuZGF0YSA9IHJlc3VsdDsKICAgICAgICAgICAgICB0YWJsZS5sZW5ndGggPSBuZXdMZW5ndGg7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBzYW5pdGl6ZVRUUHJvZ3JhbXMoZnBnbSwgcHJlcCwgY3Z0LCBtYXhGdW5jdGlvbkRlZnMpIHsKICAgICAgICAgICAgdmFyIHR0Q29udGV4dCA9IHsKICAgICAgICAgICAgICBmdW5jdGlvbnNEZWZpbmVkOiBbXSwKICAgICAgICAgICAgICBmdW5jdGlvbnNVc2VkOiBbXSwKICAgICAgICAgICAgICBmdW5jdGlvbnNTdGFja0RlbHRhczogW10sCiAgICAgICAgICAgICAgdG9vQ29tcGxleFRvRm9sbG93RnVuY3Rpb25zOiBmYWxzZSwKICAgICAgICAgICAgICBoaW50c1ZhbGlkOiB0cnVlCiAgICAgICAgICAgIH07CgogICAgICAgICAgICBpZiAoZnBnbSkgewogICAgICAgICAgICAgIHNhbml0aXplVFRQcm9ncmFtKGZwZ20sIHR0Q29udGV4dCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChwcmVwKSB7CiAgICAgICAgICAgICAgc2FuaXRpemVUVFByb2dyYW0ocHJlcCwgdHRDb250ZXh0KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGZwZ20pIHsKICAgICAgICAgICAgICBjaGVja0ludmFsaWRGdW5jdGlvbnModHRDb250ZXh0LCBtYXhGdW5jdGlvbkRlZnMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoY3Z0ICYmIGN2dC5sZW5ndGggJiAxKSB7CiAgICAgICAgICAgICAgdmFyIGN2dERhdGEgPSBuZXcgVWludDhBcnJheShjdnQubGVuZ3RoICsgMSk7CiAgICAgICAgICAgICAgY3Z0RGF0YS5zZXQoY3Z0LmRhdGEpOwogICAgICAgICAgICAgIGN2dC5kYXRhID0gY3Z0RGF0YTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHR0Q29udGV4dC5oaW50c1ZhbGlkOwogICAgICAgICAgfQoKICAgICAgICAgIGZvbnQgPSBuZXcgX3N0cmVhbS5TdHJlYW0obmV3IFVpbnQ4QXJyYXkoZm9udC5nZXRCeXRlcygpKSk7CiAgICAgICAgICB2YXIgaGVhZGVyLCB0YWJsZXM7CgogICAgICAgICAgaWYgKGlzVHJ1ZVR5cGVDb2xsZWN0aW9uRmlsZShmb250KSkgewogICAgICAgICAgICB2YXIgdHRjRGF0YSA9IHJlYWRUcnVlVHlwZUNvbGxlY3Rpb25EYXRhKGZvbnQsIHRoaXMubmFtZSk7CiAgICAgICAgICAgIGhlYWRlciA9IHR0Y0RhdGEuaGVhZGVyOwogICAgICAgICAgICB0YWJsZXMgPSB0dGNEYXRhLnRhYmxlczsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGhlYWRlciA9IHJlYWRPcGVuVHlwZUhlYWRlcihmb250KTsKICAgICAgICAgICAgdGFibGVzID0gcmVhZFRhYmxlcyhmb250LCBoZWFkZXIubnVtVGFibGVzKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgY2ZmLCBjZmZGaWxlOwogICAgICAgICAgdmFyIGlzVHJ1ZVR5cGUgPSAhdGFibGVzWyJDRkYgIl07CgogICAgICAgICAgaWYgKCFpc1RydWVUeXBlKSB7CiAgICAgICAgICAgIHZhciBpc0NvbXBvc2l0ZSA9IHByb3BlcnRpZXMuY29tcG9zaXRlICYmICgocHJvcGVydGllcy5jaWRUb0dpZE1hcCB8fCBbXSkubGVuZ3RoID4gMCB8fCAhKHByb3BlcnRpZXMuY01hcCBpbnN0YW5jZW9mIF9jbWFwLklkZW50aXR5Q01hcCkpOwoKICAgICAgICAgICAgaWYgKGhlYWRlci52ZXJzaW9uID09PSAiT1RUTyIgJiYgIWlzQ29tcG9zaXRlIHx8ICF0YWJsZXNbImhlYWQiXSB8fCAhdGFibGVzWyJoaGVhIl0gfHwgIXRhYmxlc1sibWF4cCJdIHx8ICF0YWJsZXNbInBvc3QiXSkgewogICAgICAgICAgICAgIGNmZkZpbGUgPSBuZXcgX3N0cmVhbS5TdHJlYW0odGFibGVzWyJDRkYgIl0uZGF0YSk7CiAgICAgICAgICAgICAgY2ZmID0gbmV3IENGRkZvbnQoY2ZmRmlsZSwgcHJvcGVydGllcyk7CiAgICAgICAgICAgICAgYWRqdXN0V2lkdGhzKHByb3BlcnRpZXMpOwogICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnZlcnQobmFtZSwgY2ZmLCBwcm9wZXJ0aWVzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZGVsZXRlIHRhYmxlc1siZ2x5ZiJdOwogICAgICAgICAgICBkZWxldGUgdGFibGVzWyJsb2NhIl07CiAgICAgICAgICAgIGRlbGV0ZSB0YWJsZXNbImZwZ20iXTsKICAgICAgICAgICAgZGVsZXRlIHRhYmxlc1sicHJlcCJdOwogICAgICAgICAgICBkZWxldGUgdGFibGVzWyJjdnQgIl07CiAgICAgICAgICAgIHRoaXMuaXNPcGVuVHlwZSA9IHRydWU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoIXRhYmxlc1sibG9jYSJdKSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCdSZXF1aXJlZCAibG9jYSIgdGFibGUgaXMgbm90IGZvdW5kJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghdGFibGVzWyJnbHlmIl0pIHsKICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoJ1JlcXVpcmVkICJnbHlmIiB0YWJsZSBpcyBub3QgZm91bmQgLS0gdHJ5aW5nIHRvIHJlY292ZXIuJyk7CiAgICAgICAgICAgICAgdGFibGVzWyJnbHlmIl0gPSB7CiAgICAgICAgICAgICAgICB0YWc6ICJnbHlmIiwKICAgICAgICAgICAgICAgIGRhdGE6IG5ldyBVaW50OEFycmF5KDApCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5pc09wZW5UeXBlID0gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCF0YWJsZXNbIm1heHAiXSkgewogICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoJ1JlcXVpcmVkICJtYXhwIiB0YWJsZSBpcyBub3QgZm91bmQnKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmb250LnBvcyA9IChmb250LnN0YXJ0IHx8IDApICsgdGFibGVzWyJtYXhwIl0ub2Zmc2V0OwogICAgICAgICAgdmFyIHZlcnNpb24gPSBmb250LmdldEludDMyKCk7CiAgICAgICAgICB2YXIgbnVtR2x5cGhzID0gZm9udC5nZXRVaW50MTYoKTsKICAgICAgICAgIHZhciBudW1HbHlwaHNPdXQgPSBudW1HbHlwaHMgKyAxOwogICAgICAgICAgdmFyIGR1cEZpcnN0RW50cnkgPSB0cnVlOwoKICAgICAgICAgIGlmIChudW1HbHlwaHNPdXQgPiAweGZmZmYpIHsKICAgICAgICAgICAgZHVwRmlyc3RFbnRyeSA9IGZhbHNlOwogICAgICAgICAgICBudW1HbHlwaHNPdXQgPSBudW1HbHlwaHM7CiAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiTm90IGVub3VnaCBzcGFjZSBpbiBnbHlmcyB0byBkdXBsaWNhdGUgZmlyc3QgZ2x5cGguIik7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIG1heEZ1bmN0aW9uRGVmcyA9IDA7CiAgICAgICAgICB2YXIgbWF4U2l6ZU9mSW5zdHJ1Y3Rpb25zID0gMDsKCiAgICAgICAgICBpZiAodmVyc2lvbiA+PSAweDAwMDEwMDAwICYmIHRhYmxlc1sibWF4cCJdLmxlbmd0aCA+PSAyMikgewogICAgICAgICAgICBmb250LnBvcyArPSA4OwogICAgICAgICAgICB2YXIgbWF4Wm9uZXMgPSBmb250LmdldFVpbnQxNigpOwoKICAgICAgICAgICAgaWYgKG1heFpvbmVzID4gMikgewogICAgICAgICAgICAgIHRhYmxlc1sibWF4cCJdLmRhdGFbMTRdID0gMDsKICAgICAgICAgICAgICB0YWJsZXNbIm1heHAiXS5kYXRhWzE1XSA9IDI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvbnQucG9zICs9IDQ7CiAgICAgICAgICAgIG1heEZ1bmN0aW9uRGVmcyA9IGZvbnQuZ2V0VWludDE2KCk7CiAgICAgICAgICAgIGZvbnQucG9zICs9IDQ7CiAgICAgICAgICAgIG1heFNpemVPZkluc3RydWN0aW9ucyA9IGZvbnQuZ2V0VWludDE2KCk7CiAgICAgICAgICB9CgogICAgICAgICAgdGFibGVzWyJtYXhwIl0uZGF0YVs0XSA9IG51bUdseXBoc091dCA+PiA4OwogICAgICAgICAgdGFibGVzWyJtYXhwIl0uZGF0YVs1XSA9IG51bUdseXBoc091dCAmIDI1NTsKICAgICAgICAgIHZhciBoaW50c1ZhbGlkID0gc2FuaXRpemVUVFByb2dyYW1zKHRhYmxlc1siZnBnbSJdLCB0YWJsZXNbInByZXAiXSwgdGFibGVzWyJjdnQgIl0sIG1heEZ1bmN0aW9uRGVmcyk7CgogICAgICAgICAgaWYgKCFoaW50c1ZhbGlkKSB7CiAgICAgICAgICAgIGRlbGV0ZSB0YWJsZXNbImZwZ20iXTsKICAgICAgICAgICAgZGVsZXRlIHRhYmxlc1sicHJlcCJdOwogICAgICAgICAgICBkZWxldGUgdGFibGVzWyJjdnQgIl07CiAgICAgICAgICB9CgogICAgICAgICAgc2FuaXRpemVNZXRyaWNzKGZvbnQsIHRhYmxlc1siaGhlYSJdLCB0YWJsZXNbImhtdHgiXSwgbnVtR2x5cGhzT3V0LCBkdXBGaXJzdEVudHJ5KTsKCiAgICAgICAgICBpZiAoIXRhYmxlc1siaGVhZCJdKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcignUmVxdWlyZWQgImhlYWQiIHRhYmxlIGlzIG5vdCBmb3VuZCcpOwogICAgICAgICAgfQoKICAgICAgICAgIHNhbml0aXplSGVhZCh0YWJsZXNbImhlYWQiXSwgbnVtR2x5cGhzLCBpc1RydWVUeXBlID8gdGFibGVzWyJsb2NhIl0ubGVuZ3RoIDogMCk7CiAgICAgICAgICB2YXIgbWlzc2luZ0dseXBocyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CgogICAgICAgICAgaWYgKGlzVHJ1ZVR5cGUpIHsKICAgICAgICAgICAgdmFyIGlzR2x5cGhMb2NhdGlvbnNMb25nID0gaW50MTYodGFibGVzWyJoZWFkIl0uZGF0YVs1MF0sIHRhYmxlc1siaGVhZCJdLmRhdGFbNTFdKTsKICAgICAgICAgICAgdmFyIGdseXBoc0luZm8gPSBzYW5pdGl6ZUdseXBoTG9jYXRpb25zKHRhYmxlc1sibG9jYSJdLCB0YWJsZXNbImdseWYiXSwgbnVtR2x5cGhzLCBpc0dseXBoTG9jYXRpb25zTG9uZywgaGludHNWYWxpZCwgZHVwRmlyc3RFbnRyeSwgbWF4U2l6ZU9mSW5zdHJ1Y3Rpb25zKTsKICAgICAgICAgICAgbWlzc2luZ0dseXBocyA9IGdseXBoc0luZm8ubWlzc2luZ0dseXBoczsKCiAgICAgICAgICAgIGlmICh2ZXJzaW9uID49IDB4MDAwMTAwMDAgJiYgdGFibGVzWyJtYXhwIl0ubGVuZ3RoID49IDIyKSB7CiAgICAgICAgICAgICAgdGFibGVzWyJtYXhwIl0uZGF0YVsyNl0gPSBnbHlwaHNJbmZvLm1heFNpemVPZkluc3RydWN0aW9ucyA+PiA4OwogICAgICAgICAgICAgIHRhYmxlc1sibWF4cCJdLmRhdGFbMjddID0gZ2x5cGhzSW5mby5tYXhTaXplT2ZJbnN0cnVjdGlvbnMgJiAyNTU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIXRhYmxlc1siaGhlYSJdKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcignUmVxdWlyZWQgImhoZWEiIHRhYmxlIGlzIG5vdCBmb3VuZCcpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0YWJsZXNbImhoZWEiXS5kYXRhWzEwXSA9PT0gMCAmJiB0YWJsZXNbImhoZWEiXS5kYXRhWzExXSA9PT0gMCkgewogICAgICAgICAgICB0YWJsZXNbImhoZWEiXS5kYXRhWzEwXSA9IDB4ZmY7CiAgICAgICAgICAgIHRhYmxlc1siaGhlYSJdLmRhdGFbMTFdID0gMHhmZjsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgbWV0cmljc092ZXJyaWRlID0gewogICAgICAgICAgICB1bml0c1BlckVtOiBpbnQxNih0YWJsZXNbImhlYWQiXS5kYXRhWzE4XSwgdGFibGVzWyJoZWFkIl0uZGF0YVsxOV0pLAogICAgICAgICAgICB5TWF4OiBpbnQxNih0YWJsZXNbImhlYWQiXS5kYXRhWzQyXSwgdGFibGVzWyJoZWFkIl0uZGF0YVs0M10pLAogICAgICAgICAgICB5TWluOiBzaWduZWRJbnQxNih0YWJsZXNbImhlYWQiXS5kYXRhWzM4XSwgdGFibGVzWyJoZWFkIl0uZGF0YVszOV0pLAogICAgICAgICAgICBhc2NlbnQ6IGludDE2KHRhYmxlc1siaGhlYSJdLmRhdGFbNF0sIHRhYmxlc1siaGhlYSJdLmRhdGFbNV0pLAogICAgICAgICAgICBkZXNjZW50OiBzaWduZWRJbnQxNih0YWJsZXNbImhoZWEiXS5kYXRhWzZdLCB0YWJsZXNbImhoZWEiXS5kYXRhWzddKQogICAgICAgICAgfTsKICAgICAgICAgIHRoaXMuYXNjZW50ID0gbWV0cmljc092ZXJyaWRlLmFzY2VudCAvIG1ldHJpY3NPdmVycmlkZS51bml0c1BlckVtOwogICAgICAgICAgdGhpcy5kZXNjZW50ID0gbWV0cmljc092ZXJyaWRlLmRlc2NlbnQgLyBtZXRyaWNzT3ZlcnJpZGUudW5pdHNQZXJFbTsKCiAgICAgICAgICBpZiAodGFibGVzWyJwb3N0Il0pIHsKICAgICAgICAgICAgcmVhZFBvc3RTY3JpcHRUYWJsZSh0YWJsZXNbInBvc3QiXSwgcHJvcGVydGllcywgbnVtR2x5cGhzKTsKICAgICAgICAgIH0KCiAgICAgICAgICB0YWJsZXNbInBvc3QiXSA9IHsKICAgICAgICAgICAgdGFnOiAicG9zdCIsCiAgICAgICAgICAgIGRhdGE6IGNyZWF0ZVBvc3RUYWJsZShwcm9wZXJ0aWVzKQogICAgICAgICAgfTsKICAgICAgICAgIHZhciBjaGFyQ29kZVRvR2x5cGhJZCA9IFtdLAogICAgICAgICAgICBjaGFyQ29kZTsKCiAgICAgICAgICBmdW5jdGlvbiBoYXNHbHlwaChnbHlwaElkKSB7CiAgICAgICAgICAgIHJldHVybiAhbWlzc2luZ0dseXBoc1tnbHlwaElkXTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAocHJvcGVydGllcy5jb21wb3NpdGUpIHsKICAgICAgICAgICAgdmFyIGNpZFRvR2lkTWFwID0gcHJvcGVydGllcy5jaWRUb0dpZE1hcCB8fCBbXTsKICAgICAgICAgICAgdmFyIGlzQ2lkVG9HaWRNYXBFbXB0eSA9IGNpZFRvR2lkTWFwLmxlbmd0aCA9PT0gMDsKICAgICAgICAgICAgcHJvcGVydGllcy5jTWFwLmZvckVhY2goZnVuY3Rpb24gKGNoYXJDb2RlLCBjaWQpIHsKICAgICAgICAgICAgICBpZiAoY2lkID4gMHhmZmZmKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIk1heCBzaXplIG9mIENJRCBpcyA2NSw1MzUiKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBnbHlwaElkID0gLTE7CgogICAgICAgICAgICAgIGlmIChpc0NpZFRvR2lkTWFwRW1wdHkpIHsKICAgICAgICAgICAgICAgIGdseXBoSWQgPSBjaWQ7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChjaWRUb0dpZE1hcFtjaWRdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGdseXBoSWQgPSBjaWRUb0dpZE1hcFtjaWRdOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGdseXBoSWQgPj0gMCAmJiBnbHlwaElkIDwgbnVtR2x5cGhzICYmIGhhc0dseXBoKGdseXBoSWQpKSB7CiAgICAgICAgICAgICAgICBjaGFyQ29kZVRvR2x5cGhJZFtjaGFyQ29kZV0gPSBnbHlwaElkOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgY21hcFRhYmxlID0gcmVhZENtYXBUYWJsZSh0YWJsZXNbImNtYXAiXSwgZm9udCwgdGhpcy5pc1N5bWJvbGljRm9udCwgcHJvcGVydGllcy5oYXNFbmNvZGluZyk7CiAgICAgICAgICAgIHZhciBjbWFwUGxhdGZvcm1JZCA9IGNtYXBUYWJsZS5wbGF0Zm9ybUlkOwogICAgICAgICAgICB2YXIgY21hcEVuY29kaW5nSWQgPSBjbWFwVGFibGUuZW5jb2RpbmdJZDsKICAgICAgICAgICAgdmFyIGNtYXBNYXBwaW5ncyA9IGNtYXBUYWJsZS5tYXBwaW5nczsKICAgICAgICAgICAgdmFyIGNtYXBNYXBwaW5nc0xlbmd0aCA9IGNtYXBNYXBwaW5ncy5sZW5ndGg7CgogICAgICAgICAgICBpZiAocHJvcGVydGllcy5oYXNFbmNvZGluZyAmJiAoY21hcFBsYXRmb3JtSWQgPT09IDMgJiYgY21hcEVuY29kaW5nSWQgPT09IDEgfHwgY21hcFBsYXRmb3JtSWQgPT09IDEgJiYgY21hcEVuY29kaW5nSWQgPT09IDApIHx8IGNtYXBQbGF0Zm9ybUlkID09PSAtMSAmJiBjbWFwRW5jb2RpbmdJZCA9PT0gLTEgJiYgISEoMCwgX2VuY29kaW5ncy5nZXRFbmNvZGluZykocHJvcGVydGllcy5iYXNlRW5jb2RpbmdOYW1lKSkgewogICAgICAgICAgICAgIHZhciBiYXNlRW5jb2RpbmcgPSBbXTsKCiAgICAgICAgICAgICAgaWYgKHByb3BlcnRpZXMuYmFzZUVuY29kaW5nTmFtZSA9PT0gIk1hY1JvbWFuRW5jb2RpbmciIHx8IHByb3BlcnRpZXMuYmFzZUVuY29kaW5nTmFtZSA9PT0gIldpbkFuc2lFbmNvZGluZyIpIHsKICAgICAgICAgICAgICAgIGJhc2VFbmNvZGluZyA9ICgwLCBfZW5jb2RpbmdzLmdldEVuY29kaW5nKShwcm9wZXJ0aWVzLmJhc2VFbmNvZGluZ05hbWUpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIGdseXBoc1VuaWNvZGVNYXAgPSAoMCwgX2dseXBobGlzdC5nZXRHbHlwaHNVbmljb2RlKSgpOwoKICAgICAgICAgICAgICBmb3IgKGNoYXJDb2RlID0gMDsgY2hhckNvZGUgPCAyNTY7IGNoYXJDb2RlKyspIHsKICAgICAgICAgICAgICAgIHZhciBnbHlwaE5hbWUsIHN0YW5kYXJkR2x5cGhOYW1lOwoKICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpZmZlcmVuY2VzICYmIGNoYXJDb2RlIGluIHRoaXMuZGlmZmVyZW5jZXMpIHsKICAgICAgICAgICAgICAgICAgZ2x5cGhOYW1lID0gdGhpcy5kaWZmZXJlbmNlc1tjaGFyQ29kZV07CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNoYXJDb2RlIGluIGJhc2VFbmNvZGluZyAmJiBiYXNlRW5jb2RpbmdbY2hhckNvZGVdICE9PSAiIikgewogICAgICAgICAgICAgICAgICBnbHlwaE5hbWUgPSBiYXNlRW5jb2RpbmdbY2hhckNvZGVdOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgZ2x5cGhOYW1lID0gX2VuY29kaW5ncy5TdGFuZGFyZEVuY29kaW5nW2NoYXJDb2RlXTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoIWdseXBoTmFtZSkgewogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBzdGFuZGFyZEdseXBoTmFtZSA9IHJlY292ZXJHbHlwaE5hbWUoZ2x5cGhOYW1lLCBnbHlwaHNVbmljb2RlTWFwKTsKICAgICAgICAgICAgICAgIHZhciB1bmljb2RlT3JDaGFyQ29kZTsKCiAgICAgICAgICAgICAgICBpZiAoY21hcFBsYXRmb3JtSWQgPT09IDMgJiYgY21hcEVuY29kaW5nSWQgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgdW5pY29kZU9yQ2hhckNvZGUgPSBnbHlwaHNVbmljb2RlTWFwW3N0YW5kYXJkR2x5cGhOYW1lXTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY21hcFBsYXRmb3JtSWQgPT09IDEgJiYgY21hcEVuY29kaW5nSWQgPT09IDApIHsKICAgICAgICAgICAgICAgICAgdW5pY29kZU9yQ2hhckNvZGUgPSBfZW5jb2RpbmdzLk1hY1JvbWFuRW5jb2RpbmcuaW5kZXhPZihzdGFuZGFyZEdseXBoTmFtZSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdmFyIGZvdW5kID0gZmFsc2U7CgogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjbWFwTWFwcGluZ3NMZW5ndGg7ICsraSkgewogICAgICAgICAgICAgICAgICBpZiAoY21hcE1hcHBpbmdzW2ldLmNoYXJDb2RlICE9PSB1bmljb2RlT3JDaGFyQ29kZSkgewogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBjaGFyQ29kZVRvR2x5cGhJZFtjaGFyQ29kZV0gPSBjbWFwTWFwcGluZ3NbaV0uZ2x5cGhJZDsKICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoIWZvdW5kICYmIHByb3BlcnRpZXMuZ2x5cGhOYW1lcykgewogICAgICAgICAgICAgICAgICB2YXIgZ2x5cGhJZCA9IHByb3BlcnRpZXMuZ2x5cGhOYW1lcy5pbmRleE9mKGdseXBoTmFtZSk7CgogICAgICAgICAgICAgICAgICBpZiAoZ2x5cGhJZCA9PT0gLTEgJiYgc3RhbmRhcmRHbHlwaE5hbWUgIT09IGdseXBoTmFtZSkgewogICAgICAgICAgICAgICAgICAgIGdseXBoSWQgPSBwcm9wZXJ0aWVzLmdseXBoTmFtZXMuaW5kZXhPZihzdGFuZGFyZEdseXBoTmFtZSk7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGlmIChnbHlwaElkID4gMCAmJiBoYXNHbHlwaChnbHlwaElkKSkgewogICAgICAgICAgICAgICAgICAgIGNoYXJDb2RlVG9HbHlwaElkW2NoYXJDb2RlXSA9IGdseXBoSWQ7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoY21hcFBsYXRmb3JtSWQgPT09IDAgJiYgY21hcEVuY29kaW5nSWQgPT09IDApIHsKICAgICAgICAgICAgICBmb3IgKHZhciBfaTIgPSAwOyBfaTIgPCBjbWFwTWFwcGluZ3NMZW5ndGg7ICsrX2kyKSB7CiAgICAgICAgICAgICAgICBjaGFyQ29kZVRvR2x5cGhJZFtjbWFwTWFwcGluZ3NbX2kyXS5jaGFyQ29kZV0gPSBjbWFwTWFwcGluZ3NbX2kyXS5nbHlwaElkOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBmb3IgKHZhciBfaTMgPSAwOyBfaTMgPCBjbWFwTWFwcGluZ3NMZW5ndGg7ICsrX2kzKSB7CiAgICAgICAgICAgICAgICBjaGFyQ29kZSA9IGNtYXBNYXBwaW5nc1tfaTNdLmNoYXJDb2RlOwoKICAgICAgICAgICAgICAgIGlmIChjbWFwUGxhdGZvcm1JZCA9PT0gMyAmJiBjaGFyQ29kZSA+PSAweGYwMDAgJiYgY2hhckNvZGUgPD0gMHhmMGZmKSB7CiAgICAgICAgICAgICAgICAgIGNoYXJDb2RlICY9IDB4ZmY7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY2hhckNvZGVUb0dseXBoSWRbY2hhckNvZGVdID0gY21hcE1hcHBpbmdzW19pM10uZ2x5cGhJZDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoY2hhckNvZGVUb0dseXBoSWQubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIGNoYXJDb2RlVG9HbHlwaElkWzBdID0gMDsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZ2x5cGhaZXJvSWQgPSBudW1HbHlwaHNPdXQgLSAxOwoKICAgICAgICAgIGlmICghZHVwRmlyc3RFbnRyeSkgewogICAgICAgICAgICBnbHlwaFplcm9JZCA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIG5ld01hcHBpbmcgPSBhZGp1c3RNYXBwaW5nKGNoYXJDb2RlVG9HbHlwaElkLCBoYXNHbHlwaCwgZ2x5cGhaZXJvSWQpOwogICAgICAgICAgdGhpcy50b0ZvbnRDaGFyID0gbmV3TWFwcGluZy50b0ZvbnRDaGFyOwogICAgICAgICAgdGFibGVzWyJjbWFwIl0gPSB7CiAgICAgICAgICAgIHRhZzogImNtYXAiLAogICAgICAgICAgICBkYXRhOiBjcmVhdGVDbWFwVGFibGUobmV3TWFwcGluZy5jaGFyQ29kZVRvR2x5cGhJZCwgbnVtR2x5cGhzT3V0KQogICAgICAgICAgfTsKCiAgICAgICAgICBpZiAoIXRhYmxlc1siT1MvMiJdIHx8ICF2YWxpZGF0ZU9TMlRhYmxlKHRhYmxlc1siT1MvMiJdKSkgewogICAgICAgICAgICB0YWJsZXNbIk9TLzIiXSA9IHsKICAgICAgICAgICAgICB0YWc6ICJPUy8yIiwKICAgICAgICAgICAgICBkYXRhOiBjcmVhdGVPUzJUYWJsZShwcm9wZXJ0aWVzLCBuZXdNYXBwaW5nLmNoYXJDb2RlVG9HbHlwaElkLCBtZXRyaWNzT3ZlcnJpZGUpCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCFpc1RydWVUeXBlKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgY2ZmRmlsZSA9IG5ldyBfc3RyZWFtLlN0cmVhbSh0YWJsZXNbIkNGRiAiXS5kYXRhKTsKICAgICAgICAgICAgICB2YXIgcGFyc2VyID0gbmV3IF9jZmZfcGFyc2VyLkNGRlBhcnNlcihjZmZGaWxlLCBwcm9wZXJ0aWVzLCBTRUFDX0FOQUxZU0lTX0VOQUJMRUQpOwogICAgICAgICAgICAgIGNmZiA9IHBhcnNlci5wYXJzZSgpOwogICAgICAgICAgICAgIGNmZi5kdXBsaWNhdGVGaXJzdEdseXBoKCk7CiAgICAgICAgICAgICAgdmFyIGNvbXBpbGVyID0gbmV3IF9jZmZfcGFyc2VyLkNGRkNvbXBpbGVyKGNmZik7CiAgICAgICAgICAgICAgdGFibGVzWyJDRkYgIl0uZGF0YSA9IGNvbXBpbGVyLmNvbXBpbGUoKTsKICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiRmFpbGVkIHRvIGNvbXBpbGUgZm9udCAiICsgcHJvcGVydGllcy5sb2FkZWROYW1lKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmICghdGFibGVzWyJuYW1lIl0pIHsKICAgICAgICAgICAgdGFibGVzWyJuYW1lIl0gPSB7CiAgICAgICAgICAgICAgdGFnOiAibmFtZSIsCiAgICAgICAgICAgICAgZGF0YTogY3JlYXRlTmFtZVRhYmxlKHRoaXMubmFtZSkKICAgICAgICAgICAgfTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciBuYW1lUHJvdG90eXBlID0gcmVhZE5hbWVUYWJsZSh0YWJsZXNbIm5hbWUiXSk7CiAgICAgICAgICAgIHRhYmxlc1sibmFtZSJdLmRhdGEgPSBjcmVhdGVOYW1lVGFibGUobmFtZSwgbmFtZVByb3RvdHlwZSk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGJ1aWxkZXIgPSBuZXcgT3BlblR5cGVGaWxlQnVpbGRlcihoZWFkZXIudmVyc2lvbik7CgogICAgICAgICAgZm9yICh2YXIgdGFibGVUYWcgaW4gdGFibGVzKSB7CiAgICAgICAgICAgIGJ1aWxkZXIuYWRkVGFibGUodGFibGVUYWcsIHRhYmxlc1t0YWJsZVRhZ10uZGF0YSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGJ1aWxkZXIudG9BcnJheSgpOwogICAgICAgIH0sCiAgICAgICAgY29udmVydDogZnVuY3Rpb24gRm9udF9jb252ZXJ0KGZvbnROYW1lLCBmb250LCBwcm9wZXJ0aWVzKSB7CiAgICAgICAgICBwcm9wZXJ0aWVzLmZpeGVkUGl0Y2ggPSBmYWxzZTsKCiAgICAgICAgICBpZiAocHJvcGVydGllcy5idWlsdEluRW5jb2RpbmcpIHsKICAgICAgICAgICAgYWRqdXN0VG9Vbmljb2RlKHByb3BlcnRpZXMsIHByb3BlcnRpZXMuYnVpbHRJbkVuY29kaW5nKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZ2x5cGhaZXJvSWQgPSAxOwoKICAgICAgICAgIGlmIChmb250IGluc3RhbmNlb2YgQ0ZGRm9udCkgewogICAgICAgICAgICBnbHlwaFplcm9JZCA9IGZvbnQubnVtR2x5cGhzIC0gMTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgbWFwcGluZyA9IGZvbnQuZ2V0R2x5cGhNYXBwaW5nKHByb3BlcnRpZXMpOwogICAgICAgICAgdmFyIG5ld01hcHBpbmcgPSBhZGp1c3RNYXBwaW5nKG1hcHBpbmcsIGZvbnQuaGFzR2x5cGhJZC5iaW5kKGZvbnQpLCBnbHlwaFplcm9JZCk7CiAgICAgICAgICB0aGlzLnRvRm9udENoYXIgPSBuZXdNYXBwaW5nLnRvRm9udENoYXI7CiAgICAgICAgICB2YXIgbnVtR2x5cGhzID0gZm9udC5udW1HbHlwaHM7CgogICAgICAgICAgZnVuY3Rpb24gZ2V0Q2hhckNvZGVzKGNoYXJDb2RlVG9HbHlwaElkLCBnbHlwaElkKSB7CiAgICAgICAgICAgIHZhciBjaGFyQ29kZXMgPSBudWxsOwoKICAgICAgICAgICAgZm9yICh2YXIgY2hhckNvZGUgaW4gY2hhckNvZGVUb0dseXBoSWQpIHsKICAgICAgICAgICAgICBpZiAoZ2x5cGhJZCA9PT0gY2hhckNvZGVUb0dseXBoSWRbY2hhckNvZGVdKSB7CiAgICAgICAgICAgICAgICBpZiAoIWNoYXJDb2RlcykgewogICAgICAgICAgICAgICAgICBjaGFyQ29kZXMgPSBbXTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjaGFyQ29kZXMucHVzaChjaGFyQ29kZSB8IDApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGNoYXJDb2RlczsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVDaGFyQ29kZShjaGFyQ29kZVRvR2x5cGhJZCwgZ2x5cGhJZCkgewogICAgICAgICAgICBmb3IgKHZhciBjaGFyQ29kZSBpbiBjaGFyQ29kZVRvR2x5cGhJZCkgewogICAgICAgICAgICAgIGlmIChnbHlwaElkID09PSBjaGFyQ29kZVRvR2x5cGhJZFtjaGFyQ29kZV0pIHsKICAgICAgICAgICAgICAgIHJldHVybiBjaGFyQ29kZSB8IDA7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBuZXdNYXBwaW5nLmNoYXJDb2RlVG9HbHlwaElkW25ld01hcHBpbmcubmV4dEF2YWlsYWJsZUZvbnRDaGFyQ29kZV0gPSBnbHlwaElkOwogICAgICAgICAgICByZXR1cm4gbmV3TWFwcGluZy5uZXh0QXZhaWxhYmxlRm9udENoYXJDb2RlKys7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHNlYWNzID0gZm9udC5zZWFjczsKCiAgICAgICAgICBpZiAoU0VBQ19BTkFMWVNJU19FTkFCTEVEICYmIHNlYWNzICYmIHNlYWNzLmxlbmd0aCkgewogICAgICAgICAgICB2YXIgbWF0cml4ID0gcHJvcGVydGllcy5mb250TWF0cml4IHx8IF91dGlsLkZPTlRfSURFTlRJVFlfTUFUUklYOwogICAgICAgICAgICB2YXIgY2hhcnNldCA9IGZvbnQuZ2V0Q2hhcnNldCgpOwogICAgICAgICAgICB2YXIgc2VhY01hcCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CgogICAgICAgICAgICBmb3IgKHZhciBnbHlwaElkIGluIHNlYWNzKSB7CiAgICAgICAgICAgICAgZ2x5cGhJZCB8PSAwOwogICAgICAgICAgICAgIHZhciBzZWFjID0gc2VhY3NbZ2x5cGhJZF07CiAgICAgICAgICAgICAgdmFyIGJhc2VHbHlwaE5hbWUgPSBfZW5jb2RpbmdzLlN0YW5kYXJkRW5jb2Rpbmdbc2VhY1syXV07CiAgICAgICAgICAgICAgdmFyIGFjY2VudEdseXBoTmFtZSA9IF9lbmNvZGluZ3MuU3RhbmRhcmRFbmNvZGluZ1tzZWFjWzNdXTsKICAgICAgICAgICAgICB2YXIgYmFzZUdseXBoSWQgPSBjaGFyc2V0LmluZGV4T2YoYmFzZUdseXBoTmFtZSk7CiAgICAgICAgICAgICAgdmFyIGFjY2VudEdseXBoSWQgPSBjaGFyc2V0LmluZGV4T2YoYWNjZW50R2x5cGhOYW1lKTsKCiAgICAgICAgICAgICAgaWYgKGJhc2VHbHlwaElkIDwgMCB8fCBhY2NlbnRHbHlwaElkIDwgMCkgewogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgYWNjZW50T2Zmc2V0ID0gewogICAgICAgICAgICAgICAgeDogc2VhY1swXSAqIG1hdHJpeFswXSArIHNlYWNbMV0gKiBtYXRyaXhbMl0gKyBtYXRyaXhbNF0sCiAgICAgICAgICAgICAgICB5OiBzZWFjWzBdICogbWF0cml4WzFdICsgc2VhY1sxXSAqIG1hdHJpeFszXSArIG1hdHJpeFs1XQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgdmFyIGNoYXJDb2RlcyA9IGdldENoYXJDb2RlcyhtYXBwaW5nLCBnbHlwaElkKTsKCiAgICAgICAgICAgICAgaWYgKCFjaGFyQ29kZXMpIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gY2hhckNvZGVzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgICAgIHZhciBjaGFyQ29kZSA9IGNoYXJDb2Rlc1tpXTsKICAgICAgICAgICAgICAgIHZhciBjaGFyQ29kZVRvR2x5cGhJZCA9IG5ld01hcHBpbmcuY2hhckNvZGVUb0dseXBoSWQ7CiAgICAgICAgICAgICAgICB2YXIgYmFzZUZvbnRDaGFyQ29kZSA9IGNyZWF0ZUNoYXJDb2RlKGNoYXJDb2RlVG9HbHlwaElkLCBiYXNlR2x5cGhJZCk7CiAgICAgICAgICAgICAgICB2YXIgYWNjZW50Rm9udENoYXJDb2RlID0gY3JlYXRlQ2hhckNvZGUoY2hhckNvZGVUb0dseXBoSWQsIGFjY2VudEdseXBoSWQpOwogICAgICAgICAgICAgICAgc2VhY01hcFtjaGFyQ29kZV0gPSB7CiAgICAgICAgICAgICAgICAgIGJhc2VGb250Q2hhckNvZGU6IGJhc2VGb250Q2hhckNvZGUsCiAgICAgICAgICAgICAgICAgIGFjY2VudEZvbnRDaGFyQ29kZTogYWNjZW50Rm9udENoYXJDb2RlLAogICAgICAgICAgICAgICAgICBhY2NlbnRPZmZzZXQ6IGFjY2VudE9mZnNldAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHByb3BlcnRpZXMuc2VhY01hcCA9IHNlYWNNYXA7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHVuaXRzUGVyRW0gPSAxIC8gKHByb3BlcnRpZXMuZm9udE1hdHJpeCB8fCBfdXRpbC5GT05UX0lERU5USVRZX01BVFJJWClbMF07CiAgICAgICAgICB2YXIgYnVpbGRlciA9IG5ldyBPcGVuVHlwZUZpbGVCdWlsZGVyKCJceDRGXHg1NFx4NTRceDRGIik7CiAgICAgICAgICBidWlsZGVyLmFkZFRhYmxlKCJDRkYgIiwgZm9udC5kYXRhKTsKICAgICAgICAgIGJ1aWxkZXIuYWRkVGFibGUoIk9TLzIiLCBjcmVhdGVPUzJUYWJsZShwcm9wZXJ0aWVzLCBuZXdNYXBwaW5nLmNoYXJDb2RlVG9HbHlwaElkKSk7CiAgICAgICAgICBidWlsZGVyLmFkZFRhYmxlKCJjbWFwIiwgY3JlYXRlQ21hcFRhYmxlKG5ld01hcHBpbmcuY2hhckNvZGVUb0dseXBoSWQsIG51bUdseXBocykpOwogICAgICAgICAgYnVpbGRlci5hZGRUYWJsZSgiaGVhZCIsICJceDAwXHgwMVx4MDBceDAwIiArICJceDAwXHgwMFx4MTBceDAwIiArICJceDAwXHgwMFx4MDBceDAwIiArICJceDVGXHgwRlx4M0NceEY1IiArICJceDAwXHgwMCIgKyBzYWZlU3RyaW5nMTYodW5pdHNQZXJFbSkgKyAiXHgwMFx4MDBceDAwXHgwMFx4OWVceDBiXHg3ZVx4MjciICsgIlx4MDBceDAwXHgwMFx4MDBceDllXHgwYlx4N2VceDI3IiArICJceDAwXHgwMCIgKyBzYWZlU3RyaW5nMTYocHJvcGVydGllcy5kZXNjZW50KSArICJceDBGXHhGRiIgKyBzYWZlU3RyaW5nMTYocHJvcGVydGllcy5hc2NlbnQpICsgc3RyaW5nMTYocHJvcGVydGllcy5pdGFsaWNBbmdsZSA/IDIgOiAwKSArICJceDAwXHgxMSIgKyAiXHgwMFx4MDAiICsgIlx4MDBceDAwIiArICJceDAwXHgwMCIpOwogICAgICAgICAgYnVpbGRlci5hZGRUYWJsZSgiaGhlYSIsICJceDAwXHgwMVx4MDBceDAwIiArIHNhZmVTdHJpbmcxNihwcm9wZXJ0aWVzLmFzY2VudCkgKyBzYWZlU3RyaW5nMTYocHJvcGVydGllcy5kZXNjZW50KSArICJceDAwXHgwMCIgKyAiXHhGRlx4RkYiICsgIlx4MDBceDAwIiArICJceDAwXHgwMCIgKyAiXHgwMFx4MDAiICsgc2FmZVN0cmluZzE2KHByb3BlcnRpZXMuY2FwSGVpZ2h0KSArIHNhZmVTdHJpbmcxNihNYXRoLnRhbihwcm9wZXJ0aWVzLml0YWxpY0FuZ2xlKSAqIHByb3BlcnRpZXMueEhlaWdodCkgKyAiXHgwMFx4MDAiICsgIlx4MDBceDAwIiArICJceDAwXHgwMCIgKyAiXHgwMFx4MDAiICsgIlx4MDBceDAwIiArICJceDAwXHgwMCIgKyBzdHJpbmcxNihudW1HbHlwaHMpKTsKICAgICAgICAgIGJ1aWxkZXIuYWRkVGFibGUoImhtdHgiLCBmdW5jdGlvbiBmb250RmllbGRzSG10eCgpIHsKICAgICAgICAgICAgdmFyIGNoYXJzdHJpbmdzID0gZm9udC5jaGFyc3RyaW5nczsKICAgICAgICAgICAgdmFyIGNmZldpZHRocyA9IGZvbnQuY2ZmID8gZm9udC5jZmYud2lkdGhzIDogbnVsbDsKICAgICAgICAgICAgdmFyIGhtdHggPSAiXHgwMFx4MDBceDAwXHgwMCI7CgogICAgICAgICAgICBmb3IgKHZhciBpID0gMSwgaWkgPSBudW1HbHlwaHM7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgICAgdmFyIHdpZHRoID0gMDsKCiAgICAgICAgICAgICAgaWYgKGNoYXJzdHJpbmdzKSB7CiAgICAgICAgICAgICAgICB2YXIgY2hhcnN0cmluZyA9IGNoYXJzdHJpbmdzW2kgLSAxXTsKICAgICAgICAgICAgICAgIHdpZHRoID0gIndpZHRoIiBpbiBjaGFyc3RyaW5nID8gY2hhcnN0cmluZy53aWR0aCA6IDA7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChjZmZXaWR0aHMpIHsKICAgICAgICAgICAgICAgIHdpZHRoID0gTWF0aC5jZWlsKGNmZldpZHRoc1tpXSB8fCAwKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGhtdHggKz0gc3RyaW5nMTYod2lkdGgpICsgc3RyaW5nMTYoMCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBobXR4OwogICAgICAgICAgfSgpKTsKICAgICAgICAgIGJ1aWxkZXIuYWRkVGFibGUoIm1heHAiLCAiXHgwMFx4MDBceDUwXHgwMCIgKyBzdHJpbmcxNihudW1HbHlwaHMpKTsKICAgICAgICAgIGJ1aWxkZXIuYWRkVGFibGUoIm5hbWUiLCBjcmVhdGVOYW1lVGFibGUoZm9udE5hbWUpKTsKICAgICAgICAgIGJ1aWxkZXIuYWRkVGFibGUoInBvc3QiLCBjcmVhdGVQb3N0VGFibGUocHJvcGVydGllcykpOwogICAgICAgICAgcmV0dXJuIGJ1aWxkZXIudG9BcnJheSgpOwogICAgICAgIH0sCgogICAgICAgIGdldCBzcGFjZVdpZHRoKCkgewogICAgICAgICAgaWYgKCJfc2hhZG93V2lkdGgiIGluIHRoaXMpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NoYWRvd1dpZHRoOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBwb3NzaWJsZVNwYWNlUmVwbGFjZW1lbnRzID0gWyJzcGFjZSIsICJtaW51cyIsICJvbmUiLCAiaSIsICJJIl07CiAgICAgICAgICB2YXIgd2lkdGg7CgogICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gcG9zc2libGVTcGFjZVJlcGxhY2VtZW50cy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgIHZhciBnbHlwaE5hbWUgPSBwb3NzaWJsZVNwYWNlUmVwbGFjZW1lbnRzW2ldOwoKICAgICAgICAgICAgaWYgKGdseXBoTmFtZSBpbiB0aGlzLndpZHRocykgewogICAgICAgICAgICAgIHdpZHRoID0gdGhpcy53aWR0aHNbZ2x5cGhOYW1lXTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGdseXBoc1VuaWNvZGVNYXAgPSAoMCwgX2dseXBobGlzdC5nZXRHbHlwaHNVbmljb2RlKSgpOwogICAgICAgICAgICB2YXIgZ2x5cGhVbmljb2RlID0gZ2x5cGhzVW5pY29kZU1hcFtnbHlwaE5hbWVdOwogICAgICAgICAgICB2YXIgY2hhcmNvZGUgPSAwOwoKICAgICAgICAgICAgaWYgKHRoaXMuY29tcG9zaXRlKSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuY01hcC5jb250YWlucyhnbHlwaFVuaWNvZGUpKSB7CiAgICAgICAgICAgICAgICBjaGFyY29kZSA9IHRoaXMuY01hcC5sb29rdXAoZ2x5cGhVbmljb2RlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghY2hhcmNvZGUgJiYgdGhpcy50b1VuaWNvZGUpIHsKICAgICAgICAgICAgICBjaGFyY29kZSA9IHRoaXMudG9Vbmljb2RlLmNoYXJDb2RlT2YoZ2x5cGhVbmljb2RlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGNoYXJjb2RlIDw9IDApIHsKICAgICAgICAgICAgICBjaGFyY29kZSA9IGdseXBoVW5pY29kZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2lkdGggPSB0aGlzLndpZHRoc1tjaGFyY29kZV07CgogICAgICAgICAgICBpZiAod2lkdGgpIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHdpZHRoID0gd2lkdGggfHwgdGhpcy5kZWZhdWx0V2lkdGg7CiAgICAgICAgICB0aGlzLl9zaGFkb3dXaWR0aCA9IHdpZHRoOwogICAgICAgICAgcmV0dXJuIHdpZHRoOwogICAgICAgIH0sCgogICAgICAgIGNoYXJUb0dseXBoOiBmdW5jdGlvbiBGb250X2NoYXJUb0dseXBoKGNoYXJjb2RlLCBpc1NwYWNlKSB7CiAgICAgICAgICB2YXIgZm9udENoYXJDb2RlLCB3aWR0aCwgb3BlcmF0b3JMaXN0SWQ7CiAgICAgICAgICB2YXIgd2lkdGhDb2RlID0gY2hhcmNvZGU7CgogICAgICAgICAgaWYgKHRoaXMuY01hcCAmJiB0aGlzLmNNYXAuY29udGFpbnMoY2hhcmNvZGUpKSB7CiAgICAgICAgICAgIHdpZHRoQ29kZSA9IHRoaXMuY01hcC5sb29rdXAoY2hhcmNvZGUpOwogICAgICAgICAgfQoKICAgICAgICAgIHdpZHRoID0gdGhpcy53aWR0aHNbd2lkdGhDb2RlXTsKICAgICAgICAgIHdpZHRoID0gKDAsIF91dGlsLmlzTnVtKSh3aWR0aCkgPyB3aWR0aCA6IHRoaXMuZGVmYXVsdFdpZHRoOwogICAgICAgICAgdmFyIHZtZXRyaWMgPSB0aGlzLnZtZXRyaWNzICYmIHRoaXMudm1ldHJpY3Nbd2lkdGhDb2RlXTsKICAgICAgICAgIHZhciB1bmljb2RlID0gdGhpcy50b1VuaWNvZGUuZ2V0KGNoYXJjb2RlKSB8fCB0aGlzLmZhbGxiYWNrVG9Vbmljb2RlLmdldChjaGFyY29kZSkgfHwgY2hhcmNvZGU7CgogICAgICAgICAgaWYgKHR5cGVvZiB1bmljb2RlID09PSAibnVtYmVyIikgewogICAgICAgICAgICB1bmljb2RlID0gU3RyaW5nLmZyb21DaGFyQ29kZSh1bmljb2RlKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgaXNJbkZvbnQgPSBjaGFyY29kZSBpbiB0aGlzLnRvRm9udENoYXI7CiAgICAgICAgICBmb250Q2hhckNvZGUgPSB0aGlzLnRvRm9udENoYXJbY2hhcmNvZGVdIHx8IGNoYXJjb2RlOwoKICAgICAgICAgIGlmICh0aGlzLm1pc3NpbmdGaWxlKSB7CiAgICAgICAgICAgIHZhciBnbHlwaE5hbWUgPSB0aGlzLmRpZmZlcmVuY2VzW2NoYXJjb2RlXSB8fCB0aGlzLmRlZmF1bHRFbmNvZGluZ1tjaGFyY29kZV07CgogICAgICAgICAgICBpZiAoKGdseXBoTmFtZSA9PT0gIi5ub3RkZWYiIHx8IGdseXBoTmFtZSA9PT0gIiIpICYmIHRoaXMudHlwZSA9PT0gIlR5cGUxIikgewogICAgICAgICAgICAgIGZvbnRDaGFyQ29kZSA9IDB4MjA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvbnRDaGFyQ29kZSA9ICgwLCBfdW5pY29kZS5tYXBTcGVjaWFsVW5pY29kZVZhbHVlcykoZm9udENoYXJDb2RlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodGhpcy5pc1R5cGUzRm9udCkgewogICAgICAgICAgICBvcGVyYXRvckxpc3RJZCA9IGZvbnRDaGFyQ29kZTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgYWNjZW50ID0gbnVsbDsKCiAgICAgICAgICBpZiAodGhpcy5zZWFjTWFwICYmIHRoaXMuc2VhY01hcFtjaGFyY29kZV0pIHsKICAgICAgICAgICAgaXNJbkZvbnQgPSB0cnVlOwogICAgICAgICAgICB2YXIgc2VhYyA9IHRoaXMuc2VhY01hcFtjaGFyY29kZV07CiAgICAgICAgICAgIGZvbnRDaGFyQ29kZSA9IHNlYWMuYmFzZUZvbnRDaGFyQ29kZTsKICAgICAgICAgICAgYWNjZW50ID0gewogICAgICAgICAgICAgIGZvbnRDaGFyOiBTdHJpbmcuZnJvbUNvZGVQb2ludChzZWFjLmFjY2VudEZvbnRDaGFyQ29kZSksCiAgICAgICAgICAgICAgb2Zmc2V0OiBzZWFjLmFjY2VudE9mZnNldAogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBmb250Q2hhciA9IHR5cGVvZiBmb250Q2hhckNvZGUgPT09ICJudW1iZXIiID8gU3RyaW5nLmZyb21Db2RlUG9pbnQoZm9udENoYXJDb2RlKSA6ICIiOwogICAgICAgICAgdmFyIGdseXBoID0gdGhpcy5nbHlwaENhY2hlW2NoYXJjb2RlXTsKCiAgICAgICAgICBpZiAoIWdseXBoIHx8ICFnbHlwaC5tYXRjaGVzRm9yQ2FjaGUoZm9udENoYXIsIHVuaWNvZGUsIGFjY2VudCwgd2lkdGgsIHZtZXRyaWMsIG9wZXJhdG9yTGlzdElkLCBpc1NwYWNlLCBpc0luRm9udCkpIHsKICAgICAgICAgICAgZ2x5cGggPSBuZXcgR2x5cGgoZm9udENoYXIsIHVuaWNvZGUsIGFjY2VudCwgd2lkdGgsIHZtZXRyaWMsIG9wZXJhdG9yTGlzdElkLCBpc1NwYWNlLCBpc0luRm9udCk7CiAgICAgICAgICAgIHRoaXMuZ2x5cGhDYWNoZVtjaGFyY29kZV0gPSBnbHlwaDsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gZ2x5cGg7CiAgICAgICAgfSwKICAgICAgICBjaGFyc1RvR2x5cGhzOiBmdW5jdGlvbiBGb250X2NoYXJzVG9HbHlwaHMoY2hhcnMpIHsKICAgICAgICAgIHZhciBjaGFyc0NhY2hlID0gdGhpcy5jaGFyc0NhY2hlOwogICAgICAgICAgdmFyIGdseXBocywgZ2x5cGgsIGNoYXJjb2RlOwoKICAgICAgICAgIGlmIChjaGFyc0NhY2hlKSB7CiAgICAgICAgICAgIGdseXBocyA9IGNoYXJzQ2FjaGVbY2hhcnNdOwoKICAgICAgICAgICAgaWYgKGdseXBocykgewogICAgICAgICAgICAgIHJldHVybiBnbHlwaHM7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWNoYXJzQ2FjaGUpIHsKICAgICAgICAgICAgY2hhcnNDYWNoZSA9IHRoaXMuY2hhcnNDYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgICB9CgogICAgICAgICAgZ2x5cGhzID0gW107CiAgICAgICAgICB2YXIgY2hhcnNDYWNoZUtleSA9IGNoYXJzOwogICAgICAgICAgdmFyIGkgPSAwLAogICAgICAgICAgICBpaTsKCiAgICAgICAgICBpZiAodGhpcy5jTWFwKSB7CiAgICAgICAgICAgIHZhciBjID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKCiAgICAgICAgICAgIHdoaWxlIChpIDwgY2hhcnMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgdGhpcy5jTWFwLnJlYWRDaGFyQ29kZShjaGFycywgaSwgYyk7CiAgICAgICAgICAgICAgY2hhcmNvZGUgPSBjLmNoYXJjb2RlOwogICAgICAgICAgICAgIHZhciBsZW5ndGggPSBjLmxlbmd0aDsKICAgICAgICAgICAgICBpICs9IGxlbmd0aDsKICAgICAgICAgICAgICB2YXIgaXNTcGFjZSA9IGxlbmd0aCA9PT0gMSAmJiBjaGFycy5jaGFyQ29kZUF0KGkgLSAxKSA9PT0gMHgyMDsKICAgICAgICAgICAgICBnbHlwaCA9IHRoaXMuY2hhclRvR2x5cGgoY2hhcmNvZGUsIGlzU3BhY2UpOwogICAgICAgICAgICAgIGdseXBocy5wdXNoKGdseXBoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZm9yIChpID0gMCwgaWkgPSBjaGFycy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7CiAgICAgICAgICAgICAgY2hhcmNvZGUgPSBjaGFycy5jaGFyQ29kZUF0KGkpOwogICAgICAgICAgICAgIGdseXBoID0gdGhpcy5jaGFyVG9HbHlwaChjaGFyY29kZSwgY2hhcmNvZGUgPT09IDB4MjApOwogICAgICAgICAgICAgIGdseXBocy5wdXNoKGdseXBoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBjaGFyc0NhY2hlW2NoYXJzQ2FjaGVLZXldID0gZ2x5cGhzOwogICAgICAgIH0sCgogICAgICAgIGdldCBnbHlwaENhY2hlVmFsdWVzKCkgewogICAgICAgICAgcmV0dXJuIE9iamVjdC52YWx1ZXModGhpcy5nbHlwaENhY2hlKTsKICAgICAgICB9CgogICAgICB9OwogICAgICByZXR1cm4gRm9udDsKICAgIH0oKTsKCiAgICBleHBvcnRzLkZvbnQgPSBGb250OwoKICAgIHZhciBFcnJvckZvbnQgPSBmdW5jdGlvbiBFcnJvckZvbnRDbG9zdXJlKCkgewogICAgICBmdW5jdGlvbiBFcnJvckZvbnQoZXJyb3IpIHsKICAgICAgICB0aGlzLmVycm9yID0gZXJyb3I7CiAgICAgICAgdGhpcy5sb2FkZWROYW1lID0gImdfZm9udF9lcnJvciI7CiAgICAgICAgdGhpcy5taXNzaW5nRmlsZSA9IHRydWU7CiAgICAgIH0KCiAgICAgIEVycm9yRm9udC5wcm90b3R5cGUgPSB7CiAgICAgICAgY2hhcnNUb0dseXBoczogZnVuY3Rpb24gRXJyb3JGb250X2NoYXJzVG9HbHlwaHMoKSB7CiAgICAgICAgICByZXR1cm4gW107CiAgICAgICAgfSwKICAgICAgICBleHBvcnREYXRhOiBmdW5jdGlvbiBFcnJvckZvbnRfZXhwb3J0RGF0YSgpIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGVycm9yOiB0aGlzLmVycm9yCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfTsKICAgICAgcmV0dXJuIEVycm9yRm9udDsKICAgIH0oKTsKCiAgICBleHBvcnRzLkVycm9yRm9udCA9IEVycm9yRm9udDsKCiAgICBmdW5jdGlvbiB0eXBlMUZvbnRHbHlwaE1hcHBpbmcocHJvcGVydGllcywgYnVpbHRJbkVuY29kaW5nLCBnbHlwaE5hbWVzKSB7CiAgICAgIHZhciBjaGFyQ29kZVRvR2x5cGhJZCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIHZhciBnbHlwaElkLCBjaGFyQ29kZSwgYmFzZUVuY29kaW5nOwogICAgICB2YXIgaXNTeW1ib2xpY0ZvbnQgPSAhIShwcm9wZXJ0aWVzLmZsYWdzICYgRm9udEZsYWdzLlN5bWJvbGljKTsKCiAgICAgIGlmIChwcm9wZXJ0aWVzLmJhc2VFbmNvZGluZ05hbWUpIHsKICAgICAgICBiYXNlRW5jb2RpbmcgPSAoMCwgX2VuY29kaW5ncy5nZXRFbmNvZGluZykocHJvcGVydGllcy5iYXNlRW5jb2RpbmdOYW1lKTsKCiAgICAgICAgZm9yIChjaGFyQ29kZSA9IDA7IGNoYXJDb2RlIDwgYmFzZUVuY29kaW5nLmxlbmd0aDsgY2hhckNvZGUrKykgewogICAgICAgICAgZ2x5cGhJZCA9IGdseXBoTmFtZXMuaW5kZXhPZihiYXNlRW5jb2RpbmdbY2hhckNvZGVdKTsKCiAgICAgICAgICBpZiAoZ2x5cGhJZCA+PSAwKSB7CiAgICAgICAgICAgIGNoYXJDb2RlVG9HbHlwaElkW2NoYXJDb2RlXSA9IGdseXBoSWQ7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjaGFyQ29kZVRvR2x5cGhJZFtjaGFyQ29kZV0gPSAwOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChpc1N5bWJvbGljRm9udCkgewogICAgICAgIGZvciAoY2hhckNvZGUgaW4gYnVpbHRJbkVuY29kaW5nKSB7CiAgICAgICAgICBjaGFyQ29kZVRvR2x5cGhJZFtjaGFyQ29kZV0gPSBidWlsdEluRW5jb2RpbmdbY2hhckNvZGVdOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBiYXNlRW5jb2RpbmcgPSBfZW5jb2RpbmdzLlN0YW5kYXJkRW5jb2Rpbmc7CgogICAgICAgIGZvciAoY2hhckNvZGUgPSAwOyBjaGFyQ29kZSA8IGJhc2VFbmNvZGluZy5sZW5ndGg7IGNoYXJDb2RlKyspIHsKICAgICAgICAgIGdseXBoSWQgPSBnbHlwaE5hbWVzLmluZGV4T2YoYmFzZUVuY29kaW5nW2NoYXJDb2RlXSk7CgogICAgICAgICAgaWYgKGdseXBoSWQgPj0gMCkgewogICAgICAgICAgICBjaGFyQ29kZVRvR2x5cGhJZFtjaGFyQ29kZV0gPSBnbHlwaElkOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY2hhckNvZGVUb0dseXBoSWRbY2hhckNvZGVdID0gMDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHZhciBkaWZmZXJlbmNlcyA9IHByb3BlcnRpZXMuZGlmZmVyZW5jZXMsCiAgICAgICAgZ2x5cGhzVW5pY29kZU1hcDsKCiAgICAgIGlmIChkaWZmZXJlbmNlcykgewogICAgICAgIGZvciAoY2hhckNvZGUgaW4gZGlmZmVyZW5jZXMpIHsKICAgICAgICAgIHZhciBnbHlwaE5hbWUgPSBkaWZmZXJlbmNlc1tjaGFyQ29kZV07CiAgICAgICAgICBnbHlwaElkID0gZ2x5cGhOYW1lcy5pbmRleE9mKGdseXBoTmFtZSk7CgogICAgICAgICAgaWYgKGdseXBoSWQgPT09IC0xKSB7CiAgICAgICAgICAgIGlmICghZ2x5cGhzVW5pY29kZU1hcCkgewogICAgICAgICAgICAgIGdseXBoc1VuaWNvZGVNYXAgPSAoMCwgX2dseXBobGlzdC5nZXRHbHlwaHNVbmljb2RlKSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgc3RhbmRhcmRHbHlwaE5hbWUgPSByZWNvdmVyR2x5cGhOYW1lKGdseXBoTmFtZSwgZ2x5cGhzVW5pY29kZU1hcCk7CgogICAgICAgICAgICBpZiAoc3RhbmRhcmRHbHlwaE5hbWUgIT09IGdseXBoTmFtZSkgewogICAgICAgICAgICAgIGdseXBoSWQgPSBnbHlwaE5hbWVzLmluZGV4T2Yoc3RhbmRhcmRHbHlwaE5hbWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGdseXBoSWQgPj0gMCkgewogICAgICAgICAgICBjaGFyQ29kZVRvR2x5cGhJZFtjaGFyQ29kZV0gPSBnbHlwaElkOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY2hhckNvZGVUb0dseXBoSWRbY2hhckNvZGVdID0gMDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBjaGFyQ29kZVRvR2x5cGhJZDsKICAgIH0KCiAgICB2YXIgVHlwZTFGb250ID0gZnVuY3Rpb24gVHlwZTFGb250Q2xvc3VyZSgpIHsKICAgICAgZnVuY3Rpb24gZmluZEJsb2NrKHN0cmVhbUJ5dGVzLCBzaWduYXR1cmUsIHN0YXJ0SW5kZXgpIHsKICAgICAgICB2YXIgc3RyZWFtQnl0ZXNMZW5ndGggPSBzdHJlYW1CeXRlcy5sZW5ndGg7CiAgICAgICAgdmFyIHNpZ25hdHVyZUxlbmd0aCA9IHNpZ25hdHVyZS5sZW5ndGg7CiAgICAgICAgdmFyIHNjYW5MZW5ndGggPSBzdHJlYW1CeXRlc0xlbmd0aCAtIHNpZ25hdHVyZUxlbmd0aDsKICAgICAgICB2YXIgaSA9IHN0YXJ0SW5kZXgsCiAgICAgICAgICBqLAogICAgICAgICAgZm91bmQgPSBmYWxzZTsKCiAgICAgICAgd2hpbGUgKGkgPCBzY2FuTGVuZ3RoKSB7CiAgICAgICAgICBqID0gMDsKCiAgICAgICAgICB3aGlsZSAoaiA8IHNpZ25hdHVyZUxlbmd0aCAmJiBzdHJlYW1CeXRlc1tpICsgal0gPT09IHNpZ25hdHVyZVtqXSkgewogICAgICAgICAgICBqKys7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGogPj0gc2lnbmF0dXJlTGVuZ3RoKSB7CiAgICAgICAgICAgIGkgKz0gajsKCiAgICAgICAgICAgIHdoaWxlIChpIDwgc3RyZWFtQnl0ZXNMZW5ndGggJiYgKDAsIF9jb3JlX3V0aWxzLmlzV2hpdGVTcGFjZSkoc3RyZWFtQnl0ZXNbaV0pKSB7CiAgICAgICAgICAgICAgaSsrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGkrKzsKICAgICAgICB9CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICBmb3VuZDogZm91bmQsCiAgICAgICAgICBsZW5ndGg6IGkKICAgICAgICB9OwogICAgICB9CgogICAgICBmdW5jdGlvbiBnZXRIZWFkZXJCbG9jayhzdHJlYW0sIHN1Z2dlc3RlZExlbmd0aCkgewogICAgICAgIHZhciBFRVhFQ19TSUdOQVRVUkUgPSBbMHg2NSwgMHg2NSwgMHg3OCwgMHg2NSwgMHg2M107CiAgICAgICAgdmFyIHN0cmVhbVN0YXJ0UG9zID0gc3RyZWFtLnBvczsKICAgICAgICB2YXIgaGVhZGVyQnl0ZXMsIGhlYWRlckJ5dGVzTGVuZ3RoLCBibG9jazsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgIGhlYWRlckJ5dGVzID0gc3RyZWFtLmdldEJ5dGVzKHN1Z2dlc3RlZExlbmd0aCk7CiAgICAgICAgICBoZWFkZXJCeXRlc0xlbmd0aCA9IGhlYWRlckJ5dGVzLmxlbmd0aDsKICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgaWYgKGV4IGluc3RhbmNlb2YgX2NvcmVfdXRpbHMuTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICAgICAgdGhyb3cgZXg7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoaGVhZGVyQnl0ZXNMZW5ndGggPT09IHN1Z2dlc3RlZExlbmd0aCkgewogICAgICAgICAgYmxvY2sgPSBmaW5kQmxvY2soaGVhZGVyQnl0ZXMsIEVFWEVDX1NJR05BVFVSRSwgc3VnZ2VzdGVkTGVuZ3RoIC0gMiAqIEVFWEVDX1NJR05BVFVSRS5sZW5ndGgpOwoKICAgICAgICAgIGlmIChibG9jay5mb3VuZCAmJiBibG9jay5sZW5ndGggPT09IHN1Z2dlc3RlZExlbmd0aCkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIHN0cmVhbTogbmV3IF9zdHJlYW0uU3RyZWFtKGhlYWRlckJ5dGVzKSwKICAgICAgICAgICAgICBsZW5ndGg6IHN1Z2dlc3RlZExlbmd0aAogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgKDAsIF91dGlsLndhcm4pKCdJbnZhbGlkICJMZW5ndGgxIiBwcm9wZXJ0eSBpbiBUeXBlMSBmb250IC0tIHRyeWluZyB0byByZWNvdmVyLicpOwogICAgICAgIHN0cmVhbS5wb3MgPSBzdHJlYW1TdGFydFBvczsKICAgICAgICB2YXIgU0NBTl9CTE9DS19MRU5HVEggPSAyMDQ4OwogICAgICAgIHZhciBhY3R1YWxMZW5ndGg7CgogICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICB2YXIgc2NhbkJ5dGVzID0gc3RyZWFtLnBlZWtCeXRlcyhTQ0FOX0JMT0NLX0xFTkdUSCk7CiAgICAgICAgICBibG9jayA9IGZpbmRCbG9jayhzY2FuQnl0ZXMsIEVFWEVDX1NJR05BVFVSRSwgMCk7CgogICAgICAgICAgaWYgKGJsb2NrLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBzdHJlYW0ucG9zICs9IGJsb2NrLmxlbmd0aDsKCiAgICAgICAgICBpZiAoYmxvY2suZm91bmQpIHsKICAgICAgICAgICAgYWN0dWFsTGVuZ3RoID0gc3RyZWFtLnBvcyAtIHN0cmVhbVN0YXJ0UG9zOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHN0cmVhbS5wb3MgPSBzdHJlYW1TdGFydFBvczsKCiAgICAgICAgaWYgKGFjdHVhbExlbmd0aCkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgc3RyZWFtOiBuZXcgX3N0cmVhbS5TdHJlYW0oc3RyZWFtLmdldEJ5dGVzKGFjdHVhbExlbmd0aCkpLAogICAgICAgICAgICBsZW5ndGg6IGFjdHVhbExlbmd0aAogICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgICgwLCBfdXRpbC53YXJuKSgnVW5hYmxlIHRvIHJlY292ZXIgIkxlbmd0aDEiIHByb3BlcnR5IGluIFR5cGUxIGZvbnQgLS0gdXNpbmcgYXMgaXMuJyk7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHN0cmVhbTogbmV3IF9zdHJlYW0uU3RyZWFtKHN0cmVhbS5nZXRCeXRlcyhzdWdnZXN0ZWRMZW5ndGgpKSwKICAgICAgICAgIGxlbmd0aDogc3VnZ2VzdGVkTGVuZ3RoCiAgICAgICAgfTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZ2V0RWV4ZWNCbG9jayhzdHJlYW0sIHN1Z2dlc3RlZExlbmd0aCkgewogICAgICAgIHZhciBlZXhlY0J5dGVzID0gc3RyZWFtLmdldEJ5dGVzKCk7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHN0cmVhbTogbmV3IF9zdHJlYW0uU3RyZWFtKGVleGVjQnl0ZXMpLAogICAgICAgICAgbGVuZ3RoOiBlZXhlY0J5dGVzLmxlbmd0aAogICAgICAgIH07CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIFR5cGUxRm9udChuYW1lLCBmaWxlLCBwcm9wZXJ0aWVzKSB7CiAgICAgICAgdmFyIFBGQl9IRUFERVJfU0laRSA9IDY7CiAgICAgICAgdmFyIGhlYWRlckJsb2NrTGVuZ3RoID0gcHJvcGVydGllcy5sZW5ndGgxOwogICAgICAgIHZhciBlZXhlY0Jsb2NrTGVuZ3RoID0gcHJvcGVydGllcy5sZW5ndGgyOwogICAgICAgIHZhciBwZmJIZWFkZXIgPSBmaWxlLnBlZWtCeXRlcyhQRkJfSEVBREVSX1NJWkUpOwogICAgICAgIHZhciBwZmJIZWFkZXJQcmVzZW50ID0gcGZiSGVhZGVyWzBdID09PSAweDgwICYmIHBmYkhlYWRlclsxXSA9PT0gMHgwMTsKCiAgICAgICAgaWYgKHBmYkhlYWRlclByZXNlbnQpIHsKICAgICAgICAgIGZpbGUuc2tpcChQRkJfSEVBREVSX1NJWkUpOwogICAgICAgICAgaGVhZGVyQmxvY2tMZW5ndGggPSBwZmJIZWFkZXJbNV0gPDwgMjQgfCBwZmJIZWFkZXJbNF0gPDwgMTYgfCBwZmJIZWFkZXJbM10gPDwgOCB8IHBmYkhlYWRlclsyXTsKICAgICAgICB9CgogICAgICAgIHZhciBoZWFkZXJCbG9jayA9IGdldEhlYWRlckJsb2NrKGZpbGUsIGhlYWRlckJsb2NrTGVuZ3RoKTsKICAgICAgICB2YXIgaGVhZGVyQmxvY2tQYXJzZXIgPSBuZXcgX3R5cGUxX3BhcnNlci5UeXBlMVBhcnNlcihoZWFkZXJCbG9jay5zdHJlYW0sIGZhbHNlLCBTRUFDX0FOQUxZU0lTX0VOQUJMRUQpOwogICAgICAgIGhlYWRlckJsb2NrUGFyc2VyLmV4dHJhY3RGb250SGVhZGVyKHByb3BlcnRpZXMpOwoKICAgICAgICBpZiAocGZiSGVhZGVyUHJlc2VudCkgewogICAgICAgICAgcGZiSGVhZGVyID0gZmlsZS5nZXRCeXRlcyhQRkJfSEVBREVSX1NJWkUpOwogICAgICAgICAgZWV4ZWNCbG9ja0xlbmd0aCA9IHBmYkhlYWRlcls1XSA8PCAyNCB8IHBmYkhlYWRlcls0XSA8PCAxNiB8IHBmYkhlYWRlclszXSA8PCA4IHwgcGZiSGVhZGVyWzJdOwogICAgICAgIH0KCiAgICAgICAgdmFyIGVleGVjQmxvY2sgPSBnZXRFZXhlY0Jsb2NrKGZpbGUsIGVleGVjQmxvY2tMZW5ndGgpOwogICAgICAgIHZhciBlZXhlY0Jsb2NrUGFyc2VyID0gbmV3IF90eXBlMV9wYXJzZXIuVHlwZTFQYXJzZXIoZWV4ZWNCbG9jay5zdHJlYW0sIHRydWUsIFNFQUNfQU5BTFlTSVNfRU5BQkxFRCk7CiAgICAgICAgdmFyIGRhdGEgPSBlZXhlY0Jsb2NrUGFyc2VyLmV4dHJhY3RGb250UHJvZ3JhbShwcm9wZXJ0aWVzKTsKCiAgICAgICAgZm9yICh2YXIgaW5mbyBpbiBkYXRhLnByb3BlcnRpZXMpIHsKICAgICAgICAgIHByb3BlcnRpZXNbaW5mb10gPSBkYXRhLnByb3BlcnRpZXNbaW5mb107CiAgICAgICAgfQoKICAgICAgICB2YXIgY2hhcnN0cmluZ3MgPSBkYXRhLmNoYXJzdHJpbmdzOwogICAgICAgIHZhciB0eXBlMkNoYXJzdHJpbmdzID0gdGhpcy5nZXRUeXBlMkNoYXJzdHJpbmdzKGNoYXJzdHJpbmdzKTsKICAgICAgICB2YXIgc3VicnMgPSB0aGlzLmdldFR5cGUyU3VicnMoZGF0YS5zdWJycyk7CiAgICAgICAgdGhpcy5jaGFyc3RyaW5ncyA9IGNoYXJzdHJpbmdzOwogICAgICAgIHRoaXMuZGF0YSA9IHRoaXMud3JhcChuYW1lLCB0eXBlMkNoYXJzdHJpbmdzLCB0aGlzLmNoYXJzdHJpbmdzLCBzdWJycywgcHJvcGVydGllcyk7CiAgICAgICAgdGhpcy5zZWFjcyA9IHRoaXMuZ2V0U2VhY3MoZGF0YS5jaGFyc3RyaW5ncyk7CiAgICAgIH0KCiAgICAgIFR5cGUxRm9udC5wcm90b3R5cGUgPSB7CiAgICAgICAgZ2V0IG51bUdseXBocygpIHsKICAgICAgICAgIHJldHVybiB0aGlzLmNoYXJzdHJpbmdzLmxlbmd0aCArIDE7CiAgICAgICAgfSwKCiAgICAgICAgZ2V0Q2hhcnNldDogZnVuY3Rpb24gVHlwZTFGb250X2dldENoYXJzZXQoKSB7CiAgICAgICAgICB2YXIgY2hhcnNldCA9IFsiLm5vdGRlZiJdOwogICAgICAgICAgdmFyIGNoYXJzdHJpbmdzID0gdGhpcy5jaGFyc3RyaW5nczsKCiAgICAgICAgICBmb3IgKHZhciBnbHlwaElkID0gMDsgZ2x5cGhJZCA8IGNoYXJzdHJpbmdzLmxlbmd0aDsgZ2x5cGhJZCsrKSB7CiAgICAgICAgICAgIGNoYXJzZXQucHVzaChjaGFyc3RyaW5nc1tnbHlwaElkXS5nbHlwaE5hbWUpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBjaGFyc2V0OwogICAgICAgIH0sCiAgICAgICAgZ2V0R2x5cGhNYXBwaW5nOiBmdW5jdGlvbiBUeXBlMUZvbnRfZ2V0R2x5cGhNYXBwaW5nKHByb3BlcnRpZXMpIHsKICAgICAgICAgIHZhciBjaGFyc3RyaW5ncyA9IHRoaXMuY2hhcnN0cmluZ3M7CiAgICAgICAgICB2YXIgZ2x5cGhOYW1lcyA9IFsiLm5vdGRlZiJdLAogICAgICAgICAgICBnbHlwaElkOwoKICAgICAgICAgIGZvciAoZ2x5cGhJZCA9IDA7IGdseXBoSWQgPCBjaGFyc3RyaW5ncy5sZW5ndGg7IGdseXBoSWQrKykgewogICAgICAgICAgICBnbHlwaE5hbWVzLnB1c2goY2hhcnN0cmluZ3NbZ2x5cGhJZF0uZ2x5cGhOYW1lKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZW5jb2RpbmcgPSBwcm9wZXJ0aWVzLmJ1aWx0SW5FbmNvZGluZzsKCiAgICAgICAgICBpZiAoZW5jb2RpbmcpIHsKICAgICAgICAgICAgdmFyIGJ1aWx0SW5FbmNvZGluZyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CgogICAgICAgICAgICBmb3IgKHZhciBjaGFyQ29kZSBpbiBlbmNvZGluZykgewogICAgICAgICAgICAgIGdseXBoSWQgPSBnbHlwaE5hbWVzLmluZGV4T2YoZW5jb2RpbmdbY2hhckNvZGVdKTsKCiAgICAgICAgICAgICAgaWYgKGdseXBoSWQgPj0gMCkgewogICAgICAgICAgICAgICAgYnVpbHRJbkVuY29kaW5nW2NoYXJDb2RlXSA9IGdseXBoSWQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHR5cGUxRm9udEdseXBoTWFwcGluZyhwcm9wZXJ0aWVzLCBidWlsdEluRW5jb2RpbmcsIGdseXBoTmFtZXMpOwogICAgICAgIH0sCiAgICAgICAgaGFzR2x5cGhJZDogZnVuY3Rpb24gVHlwZTFGb250X2hhc0dseXBoSUQoaWQpIHsKICAgICAgICAgIGlmIChpZCA8IDAgfHwgaWQgPj0gdGhpcy5udW1HbHlwaHMpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChpZCA9PT0gMCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZ2x5cGggPSB0aGlzLmNoYXJzdHJpbmdzW2lkIC0gMV07CiAgICAgICAgICByZXR1cm4gZ2x5cGguY2hhcnN0cmluZy5sZW5ndGggPiAwOwogICAgICAgIH0sCiAgICAgICAgZ2V0U2VhY3M6IGZ1bmN0aW9uIFR5cGUxRm9udF9nZXRTZWFjcyhjaGFyc3RyaW5ncykgewogICAgICAgICAgdmFyIGksIGlpOwogICAgICAgICAgdmFyIHNlYWNNYXAgPSBbXTsKCiAgICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGNoYXJzdHJpbmdzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgdmFyIGNoYXJzdHJpbmcgPSBjaGFyc3RyaW5nc1tpXTsKCiAgICAgICAgICAgIGlmIChjaGFyc3RyaW5nLnNlYWMpIHsKICAgICAgICAgICAgICBzZWFjTWFwW2kgKyAxXSA9IGNoYXJzdHJpbmcuc2VhYzsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBzZWFjTWFwOwogICAgICAgIH0sCiAgICAgICAgZ2V0VHlwZTJDaGFyc3RyaW5nczogZnVuY3Rpb24gVHlwZTFGb250X2dldFR5cGUyQ2hhcnN0cmluZ3ModHlwZTFDaGFyc3RyaW5ncykgewogICAgICAgICAgdmFyIHR5cGUyQ2hhcnN0cmluZ3MgPSBbXTsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSB0eXBlMUNoYXJzdHJpbmdzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgdHlwZTJDaGFyc3RyaW5ncy5wdXNoKHR5cGUxQ2hhcnN0cmluZ3NbaV0uY2hhcnN0cmluZyk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHR5cGUyQ2hhcnN0cmluZ3M7CiAgICAgICAgfSwKICAgICAgICBnZXRUeXBlMlN1YnJzOiBmdW5jdGlvbiBUeXBlMUZvbnRfZ2V0VHlwZTJTdWJycyh0eXBlMVN1YnJzKSB7CiAgICAgICAgICB2YXIgYmlhcyA9IDA7CiAgICAgICAgICB2YXIgY291bnQgPSB0eXBlMVN1YnJzLmxlbmd0aDsKCiAgICAgICAgICBpZiAoY291bnQgPCAxMTMzKSB7CiAgICAgICAgICAgIGJpYXMgPSAxMDc7CiAgICAgICAgICB9IGVsc2UgaWYgKGNvdW50IDwgMzM3NjkpIHsKICAgICAgICAgICAgYmlhcyA9IDExMzE7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBiaWFzID0gMzI3Njg7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHR5cGUyU3VicnMgPSBbXTsKICAgICAgICAgIHZhciBpOwoKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBiaWFzOyBpKyspIHsKICAgICAgICAgICAgdHlwZTJTdWJycy5wdXNoKFsweDBiXSk7CiAgICAgICAgICB9CgogICAgICAgICAgZm9yIChpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgICAgICAgICAgdHlwZTJTdWJycy5wdXNoKHR5cGUxU3VicnNbaV0pOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB0eXBlMlN1YnJzOwogICAgICAgIH0sCiAgICAgICAgd3JhcDogZnVuY3Rpb24gVHlwZTFGb250X3dyYXAobmFtZSwgZ2x5cGhzLCBjaGFyc3RyaW5ncywgc3VicnMsIHByb3BlcnRpZXMpIHsKICAgICAgICAgIHZhciBjZmYgPSBuZXcgX2NmZl9wYXJzZXIuQ0ZGKCk7CiAgICAgICAgICBjZmYuaGVhZGVyID0gbmV3IF9jZmZfcGFyc2VyLkNGRkhlYWRlcigxLCAwLCA0LCA0KTsKICAgICAgICAgIGNmZi5uYW1lcyA9IFtuYW1lXTsKICAgICAgICAgIHZhciB0b3BEaWN0ID0gbmV3IF9jZmZfcGFyc2VyLkNGRlRvcERpY3QoKTsKICAgICAgICAgIHRvcERpY3Quc2V0QnlOYW1lKCJ2ZXJzaW9uIiwgMzkxKTsKICAgICAgICAgIHRvcERpY3Quc2V0QnlOYW1lKCJOb3RpY2UiLCAzOTIpOwogICAgICAgICAgdG9wRGljdC5zZXRCeU5hbWUoIkZ1bGxOYW1lIiwgMzkzKTsKICAgICAgICAgIHRvcERpY3Quc2V0QnlOYW1lKCJGYW1pbHlOYW1lIiwgMzk0KTsKICAgICAgICAgIHRvcERpY3Quc2V0QnlOYW1lKCJXZWlnaHQiLCAzOTUpOwogICAgICAgICAgdG9wRGljdC5zZXRCeU5hbWUoIkVuY29kaW5nIiwgbnVsbCk7CiAgICAgICAgICB0b3BEaWN0LnNldEJ5TmFtZSgiRm9udE1hdHJpeCIsIHByb3BlcnRpZXMuZm9udE1hdHJpeCk7CiAgICAgICAgICB0b3BEaWN0LnNldEJ5TmFtZSgiRm9udEJCb3giLCBwcm9wZXJ0aWVzLmJib3gpOwogICAgICAgICAgdG9wRGljdC5zZXRCeU5hbWUoImNoYXJzZXQiLCBudWxsKTsKICAgICAgICAgIHRvcERpY3Quc2V0QnlOYW1lKCJDaGFyU3RyaW5ncyIsIG51bGwpOwogICAgICAgICAgdG9wRGljdC5zZXRCeU5hbWUoIlByaXZhdGUiLCBudWxsKTsKICAgICAgICAgIGNmZi50b3BEaWN0ID0gdG9wRGljdDsKICAgICAgICAgIHZhciBzdHJpbmdzID0gbmV3IF9jZmZfcGFyc2VyLkNGRlN0cmluZ3MoKTsKICAgICAgICAgIHN0cmluZ3MuYWRkKCJWZXJzaW9uIDAuMTEiKTsKICAgICAgICAgIHN0cmluZ3MuYWRkKCJTZWUgb3JpZ2luYWwgbm90aWNlIik7CiAgICAgICAgICBzdHJpbmdzLmFkZChuYW1lKTsKICAgICAgICAgIHN0cmluZ3MuYWRkKG5hbWUpOwogICAgICAgICAgc3RyaW5ncy5hZGQoIk1lZGl1bSIpOwogICAgICAgICAgY2ZmLnN0cmluZ3MgPSBzdHJpbmdzOwogICAgICAgICAgY2ZmLmdsb2JhbFN1YnJJbmRleCA9IG5ldyBfY2ZmX3BhcnNlci5DRkZJbmRleCgpOwogICAgICAgICAgdmFyIGNvdW50ID0gZ2x5cGhzLmxlbmd0aDsKICAgICAgICAgIHZhciBjaGFyc2V0QXJyYXkgPSBbIi5ub3RkZWYiXTsKICAgICAgICAgIHZhciBpLCBpaTsKCiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY291bnQ7IGkrKykgewogICAgICAgICAgICB2YXIgZ2x5cGhOYW1lID0gY2hhcnN0cmluZ3NbaV0uZ2x5cGhOYW1lOwoKICAgICAgICAgICAgdmFyIGluZGV4ID0gX2NmZl9wYXJzZXIuQ0ZGU3RhbmRhcmRTdHJpbmdzLmluZGV4T2YoZ2x5cGhOYW1lKTsKCiAgICAgICAgICAgIGlmIChpbmRleCA9PT0gLTEpIHsKICAgICAgICAgICAgICBzdHJpbmdzLmFkZChnbHlwaE5hbWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjaGFyc2V0QXJyYXkucHVzaChnbHlwaE5hbWUpOwogICAgICAgICAgfQoKICAgICAgICAgIGNmZi5jaGFyc2V0ID0gbmV3IF9jZmZfcGFyc2VyLkNGRkNoYXJzZXQoZmFsc2UsIDAsIGNoYXJzZXRBcnJheSk7CiAgICAgICAgICB2YXIgY2hhclN0cmluZ3NJbmRleCA9IG5ldyBfY2ZmX3BhcnNlci5DRkZJbmRleCgpOwogICAgICAgICAgY2hhclN0cmluZ3NJbmRleC5hZGQoWzB4OGIsIDB4MGVdKTsKCiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY291bnQ7IGkrKykgewogICAgICAgICAgICBjaGFyU3RyaW5nc0luZGV4LmFkZChnbHlwaHNbaV0pOwogICAgICAgICAgfQoKICAgICAgICAgIGNmZi5jaGFyU3RyaW5ncyA9IGNoYXJTdHJpbmdzSW5kZXg7CiAgICAgICAgICB2YXIgcHJpdmF0ZURpY3QgPSBuZXcgX2NmZl9wYXJzZXIuQ0ZGUHJpdmF0ZURpY3QoKTsKICAgICAgICAgIHByaXZhdGVEaWN0LnNldEJ5TmFtZSgiU3VicnMiLCBudWxsKTsKICAgICAgICAgIHZhciBmaWVsZHMgPSBbIkJsdWVWYWx1ZXMiLCAiT3RoZXJCbHVlcyIsICJGYW1pbHlCbHVlcyIsICJGYW1pbHlPdGhlckJsdWVzIiwgIlN0ZW1TbmFwSCIsICJTdGVtU25hcFYiLCAiQmx1ZVNoaWZ0IiwgIkJsdWVGdXp6IiwgIkJsdWVTY2FsZSIsICJMYW5ndWFnZUdyb3VwIiwgIkV4cGFuc2lvbkZhY3RvciIsICJGb3JjZUJvbGQiLCAiU3RkSFciLCAiU3RkVlciXTsKCiAgICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGZpZWxkcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgIHZhciBmaWVsZCA9IGZpZWxkc1tpXTsKCiAgICAgICAgICAgIGlmICghKGZpZWxkIGluIHByb3BlcnRpZXMucHJpdmF0ZURhdGEpKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciB2YWx1ZSA9IHByb3BlcnRpZXMucHJpdmF0ZURhdGFbZmllbGRdOwoKICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IHZhbHVlLmxlbmd0aCAtIDE7IGogPiAwOyBqLS0pIHsKICAgICAgICAgICAgICAgIHZhbHVlW2pdIC09IHZhbHVlW2ogLSAxXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHByaXZhdGVEaWN0LnNldEJ5TmFtZShmaWVsZCwgdmFsdWUpOwogICAgICAgICAgfQoKICAgICAgICAgIGNmZi50b3BEaWN0LnByaXZhdGVEaWN0ID0gcHJpdmF0ZURpY3Q7CiAgICAgICAgICB2YXIgc3VickluZGV4ID0gbmV3IF9jZmZfcGFyc2VyLkNGRkluZGV4KCk7CgogICAgICAgICAgZm9yIChpID0gMCwgaWkgPSBzdWJycy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgIHN1YnJJbmRleC5hZGQoc3VicnNbaV0pOwogICAgICAgICAgfQoKICAgICAgICAgIHByaXZhdGVEaWN0LnN1YnJzSW5kZXggPSBzdWJySW5kZXg7CiAgICAgICAgICB2YXIgY29tcGlsZXIgPSBuZXcgX2NmZl9wYXJzZXIuQ0ZGQ29tcGlsZXIoY2ZmKTsKICAgICAgICAgIHJldHVybiBjb21waWxlci5jb21waWxlKCk7CiAgICAgICAgfQogICAgICB9OwogICAgICByZXR1cm4gVHlwZTFGb250OwogICAgfSgpOwoKICAgIHZhciBDRkZGb250ID0gZnVuY3Rpb24gQ0ZGRm9udENsb3N1cmUoKSB7CiAgICAgIGZ1bmN0aW9uIENGRkZvbnQoZmlsZSwgcHJvcGVydGllcykgewogICAgICAgIHRoaXMucHJvcGVydGllcyA9IHByb3BlcnRpZXM7CiAgICAgICAgdmFyIHBhcnNlciA9IG5ldyBfY2ZmX3BhcnNlci5DRkZQYXJzZXIoZmlsZSwgcHJvcGVydGllcywgU0VBQ19BTkFMWVNJU19FTkFCTEVEKTsKICAgICAgICB0aGlzLmNmZiA9IHBhcnNlci5wYXJzZSgpOwogICAgICAgIHRoaXMuY2ZmLmR1cGxpY2F0ZUZpcnN0R2x5cGgoKTsKICAgICAgICB2YXIgY29tcGlsZXIgPSBuZXcgX2NmZl9wYXJzZXIuQ0ZGQ29tcGlsZXIodGhpcy5jZmYpOwogICAgICAgIHRoaXMuc2VhY3MgPSB0aGlzLmNmZi5zZWFjczsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgIHRoaXMuZGF0YSA9IGNvbXBpbGVyLmNvbXBpbGUoKTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAoMCwgX3V0aWwud2FybikoIkZhaWxlZCB0byBjb21waWxlIGZvbnQgIiArIHByb3BlcnRpZXMubG9hZGVkTmFtZSk7CiAgICAgICAgICB0aGlzLmRhdGEgPSBmaWxlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgQ0ZGRm9udC5wcm90b3R5cGUgPSB7CiAgICAgICAgZ2V0IG51bUdseXBocygpIHsKICAgICAgICAgIHJldHVybiB0aGlzLmNmZi5jaGFyU3RyaW5ncy5jb3VudDsKICAgICAgICB9LAoKICAgICAgICBnZXRDaGFyc2V0OiBmdW5jdGlvbiBDRkZGb250X2dldENoYXJzZXQoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5jZmYuY2hhcnNldC5jaGFyc2V0OwogICAgICAgIH0sCiAgICAgICAgZ2V0R2x5cGhNYXBwaW5nOiBmdW5jdGlvbiBDRkZGb250X2dldEdseXBoTWFwcGluZygpIHsKICAgICAgICAgIHZhciBjZmYgPSB0aGlzLmNmZjsKICAgICAgICAgIHZhciBwcm9wZXJ0aWVzID0gdGhpcy5wcm9wZXJ0aWVzOwogICAgICAgICAgdmFyIGNoYXJzZXRzID0gY2ZmLmNoYXJzZXQuY2hhcnNldDsKICAgICAgICAgIHZhciBjaGFyQ29kZVRvR2x5cGhJZDsKICAgICAgICAgIHZhciBnbHlwaElkOwoKICAgICAgICAgIGlmIChwcm9wZXJ0aWVzLmNvbXBvc2l0ZSkgewogICAgICAgICAgICBjaGFyQ29kZVRvR2x5cGhJZCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgICAgIHZhciBjaGFyQ29kZTsKCiAgICAgICAgICAgIGlmIChjZmYuaXNDSURGb250KSB7CiAgICAgICAgICAgICAgZm9yIChnbHlwaElkID0gMDsgZ2x5cGhJZCA8IGNoYXJzZXRzLmxlbmd0aDsgZ2x5cGhJZCsrKSB7CiAgICAgICAgICAgICAgICB2YXIgY2lkID0gY2hhcnNldHNbZ2x5cGhJZF07CiAgICAgICAgICAgICAgICBjaGFyQ29kZSA9IHByb3BlcnRpZXMuY01hcC5jaGFyQ29kZU9mKGNpZCk7CiAgICAgICAgICAgICAgICBjaGFyQ29kZVRvR2x5cGhJZFtjaGFyQ29kZV0gPSBnbHlwaElkOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBmb3IgKGdseXBoSWQgPSAwOyBnbHlwaElkIDwgY2ZmLmNoYXJTdHJpbmdzLmNvdW50OyBnbHlwaElkKyspIHsKICAgICAgICAgICAgICAgIGNoYXJDb2RlID0gcHJvcGVydGllcy5jTWFwLmNoYXJDb2RlT2YoZ2x5cGhJZCk7CiAgICAgICAgICAgICAgICBjaGFyQ29kZVRvR2x5cGhJZFtjaGFyQ29kZV0gPSBnbHlwaElkOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGNoYXJDb2RlVG9HbHlwaElkOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBlbmNvZGluZyA9IGNmZi5lbmNvZGluZyA/IGNmZi5lbmNvZGluZy5lbmNvZGluZyA6IG51bGw7CiAgICAgICAgICBjaGFyQ29kZVRvR2x5cGhJZCA9IHR5cGUxRm9udEdseXBoTWFwcGluZyhwcm9wZXJ0aWVzLCBlbmNvZGluZywgY2hhcnNldHMpOwogICAgICAgICAgcmV0dXJuIGNoYXJDb2RlVG9HbHlwaElkOwogICAgICAgIH0sCiAgICAgICAgaGFzR2x5cGhJZDogZnVuY3Rpb24gQ0ZGRm9udF9oYXNHbHlwaElEKGlkKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5jZmYuaGFzR2x5cGhJZChpZCk7CiAgICAgICAgfQogICAgICB9OwogICAgICByZXR1cm4gQ0ZGRm9udDsKICAgIH0oKTsKCiAgICAvKioqL30pLCAoCiAgLyogMjE4ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgIHZhbHVlOiB0cnVlCiAgICB9KTsKICAgIGV4cG9ydHMuQ0ZGRkRTZWxlY3QgPSBleHBvcnRzLkNGRkNvbXBpbGVyID0gZXhwb3J0cy5DRkZQcml2YXRlRGljdCA9IGV4cG9ydHMuQ0ZGVG9wRGljdCA9IGV4cG9ydHMuQ0ZGQ2hhcnNldCA9IGV4cG9ydHMuQ0ZGSW5kZXggPSBleHBvcnRzLkNGRlN0cmluZ3MgPSBleHBvcnRzLkNGRkhlYWRlciA9IGV4cG9ydHMuQ0ZGID0gZXhwb3J0cy5DRkZQYXJzZXIgPSBleHBvcnRzLkNGRlN0YW5kYXJkU3RyaW5ncyA9IHZvaWQgMDsKCiAgICB2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUpOwoKICAgIHZhciBfY2hhcnNldHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIxOSk7CgogICAgdmFyIF9lbmNvZGluZ3MgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIyMCk7CgogICAgdmFyIE1BWF9TVUJSX05FU1RJTkcgPSAxMDsKICAgIHZhciBDRkZTdGFuZGFyZFN0cmluZ3MgPSBbIi5ub3RkZWYiLCAic3BhY2UiLCAiZXhjbGFtIiwgInF1b3RlZGJsIiwgIm51bWJlcnNpZ24iLCAiZG9sbGFyIiwgInBlcmNlbnQiLCAiYW1wZXJzYW5kIiwgInF1b3RlcmlnaHQiLCAicGFyZW5sZWZ0IiwgInBhcmVucmlnaHQiLCAiYXN0ZXJpc2siLCAicGx1cyIsICJjb21tYSIsICJoeXBoZW4iLCAicGVyaW9kIiwgInNsYXNoIiwgInplcm8iLCAib25lIiwgInR3byIsICJ0aHJlZSIsICJmb3VyIiwgImZpdmUiLCAic2l4IiwgInNldmVuIiwgImVpZ2h0IiwgIm5pbmUiLCAiY29sb24iLCAic2VtaWNvbG9uIiwgImxlc3MiLCAiZXF1YWwiLCAiZ3JlYXRlciIsICJxdWVzdGlvbiIsICJhdCIsICJBIiwgIkIiLCAiQyIsICJEIiwgIkUiLCAiRiIsICJHIiwgIkgiLCAiSSIsICJKIiwgIksiLCAiTCIsICJNIiwgIk4iLCAiTyIsICJQIiwgIlEiLCAiUiIsICJTIiwgIlQiLCAiVSIsICJWIiwgIlciLCAiWCIsICJZIiwgIloiLCAiYnJhY2tldGxlZnQiLCAiYmFja3NsYXNoIiwgImJyYWNrZXRyaWdodCIsICJhc2NpaWNpcmN1bSIsICJ1bmRlcnNjb3JlIiwgInF1b3RlbGVmdCIsICJhIiwgImIiLCAiYyIsICJkIiwgImUiLCAiZiIsICJnIiwgImgiLCAiaSIsICJqIiwgImsiLCAibCIsICJtIiwgIm4iLCAibyIsICJwIiwgInEiLCAiciIsICJzIiwgInQiLCAidSIsICJ2IiwgInciLCAieCIsICJ5IiwgInoiLCAiYnJhY2VsZWZ0IiwgImJhciIsICJicmFjZXJpZ2h0IiwgImFzY2lpdGlsZGUiLCAiZXhjbGFtZG93biIsICJjZW50IiwgInN0ZXJsaW5nIiwgImZyYWN0aW9uIiwgInllbiIsICJmbG9yaW4iLCAic2VjdGlvbiIsICJjdXJyZW5jeSIsICJxdW90ZXNpbmdsZSIsICJxdW90ZWRibGxlZnQiLCAiZ3VpbGxlbW90bGVmdCIsICJndWlsc2luZ2xsZWZ0IiwgImd1aWxzaW5nbHJpZ2h0IiwgImZpIiwgImZsIiwgImVuZGFzaCIsICJkYWdnZXIiLCAiZGFnZ2VyZGJsIiwgInBlcmlvZGNlbnRlcmVkIiwgInBhcmFncmFwaCIsICJidWxsZXQiLCAicXVvdGVzaW5nbGJhc2UiLCAicXVvdGVkYmxiYXNlIiwgInF1b3RlZGJscmlnaHQiLCAiZ3VpbGxlbW90cmlnaHQiLCAiZWxsaXBzaXMiLCAicGVydGhvdXNhbmQiLCAicXVlc3Rpb25kb3duIiwgImdyYXZlIiwgImFjdXRlIiwgImNpcmN1bWZsZXgiLCAidGlsZGUiLCAibWFjcm9uIiwgImJyZXZlIiwgImRvdGFjY2VudCIsICJkaWVyZXNpcyIsICJyaW5nIiwgImNlZGlsbGEiLCAiaHVuZ2FydW1sYXV0IiwgIm9nb25layIsICJjYXJvbiIsICJlbWRhc2giLCAiQUUiLCAib3JkZmVtaW5pbmUiLCAiTHNsYXNoIiwgIk9zbGFzaCIsICJPRSIsICJvcmRtYXNjdWxpbmUiLCAiYWUiLCAiZG90bGVzc2kiLCAibHNsYXNoIiwgIm9zbGFzaCIsICJvZSIsICJnZXJtYW5kYmxzIiwgIm9uZXN1cGVyaW9yIiwgImxvZ2ljYWxub3QiLCAibXUiLCAidHJhZGVtYXJrIiwgIkV0aCIsICJvbmVoYWxmIiwgInBsdXNtaW51cyIsICJUaG9ybiIsICJvbmVxdWFydGVyIiwgImRpdmlkZSIsICJicm9rZW5iYXIiLCAiZGVncmVlIiwgInRob3JuIiwgInRocmVlcXVhcnRlcnMiLCAidHdvc3VwZXJpb3IiLCAicmVnaXN0ZXJlZCIsICJtaW51cyIsICJldGgiLCAibXVsdGlwbHkiLCAidGhyZWVzdXBlcmlvciIsICJjb3B5cmlnaHQiLCAiQWFjdXRlIiwgIkFjaXJjdW1mbGV4IiwgIkFkaWVyZXNpcyIsICJBZ3JhdmUiLCAiQXJpbmciLCAiQXRpbGRlIiwgIkNjZWRpbGxhIiwgIkVhY3V0ZSIsICJFY2lyY3VtZmxleCIsICJFZGllcmVzaXMiLCAiRWdyYXZlIiwgIklhY3V0ZSIsICJJY2lyY3VtZmxleCIsICJJZGllcmVzaXMiLCAiSWdyYXZlIiwgIk50aWxkZSIsICJPYWN1dGUiLCAiT2NpcmN1bWZsZXgiLCAiT2RpZXJlc2lzIiwgIk9ncmF2ZSIsICJPdGlsZGUiLCAiU2Nhcm9uIiwgIlVhY3V0ZSIsICJVY2lyY3VtZmxleCIsICJVZGllcmVzaXMiLCAiVWdyYXZlIiwgIllhY3V0ZSIsICJZZGllcmVzaXMiLCAiWmNhcm9uIiwgImFhY3V0ZSIsICJhY2lyY3VtZmxleCIsICJhZGllcmVzaXMiLCAiYWdyYXZlIiwgImFyaW5nIiwgImF0aWxkZSIsICJjY2VkaWxsYSIsICJlYWN1dGUiLCAiZWNpcmN1bWZsZXgiLCAiZWRpZXJlc2lzIiwgImVncmF2ZSIsICJpYWN1dGUiLCAiaWNpcmN1bWZsZXgiLCAiaWRpZXJlc2lzIiwgImlncmF2ZSIsICJudGlsZGUiLCAib2FjdXRlIiwgIm9jaXJjdW1mbGV4IiwgIm9kaWVyZXNpcyIsICJvZ3JhdmUiLCAib3RpbGRlIiwgInNjYXJvbiIsICJ1YWN1dGUiLCAidWNpcmN1bWZsZXgiLCAidWRpZXJlc2lzIiwgInVncmF2ZSIsICJ5YWN1dGUiLCAieWRpZXJlc2lzIiwgInpjYXJvbiIsICJleGNsYW1zbWFsbCIsICJIdW5nYXJ1bWxhdXRzbWFsbCIsICJkb2xsYXJvbGRzdHlsZSIsICJkb2xsYXJzdXBlcmlvciIsICJhbXBlcnNhbmRzbWFsbCIsICJBY3V0ZXNtYWxsIiwgInBhcmVubGVmdHN1cGVyaW9yIiwgInBhcmVucmlnaHRzdXBlcmlvciIsICJ0d29kb3RlbmxlYWRlciIsICJvbmVkb3RlbmxlYWRlciIsICJ6ZXJvb2xkc3R5bGUiLCAib25lb2xkc3R5bGUiLCAidHdvb2xkc3R5bGUiLCAidGhyZWVvbGRzdHlsZSIsICJmb3Vyb2xkc3R5bGUiLCAiZml2ZW9sZHN0eWxlIiwgInNpeG9sZHN0eWxlIiwgInNldmVub2xkc3R5bGUiLCAiZWlnaHRvbGRzdHlsZSIsICJuaW5lb2xkc3R5bGUiLCAiY29tbWFzdXBlcmlvciIsICJ0aHJlZXF1YXJ0ZXJzZW1kYXNoIiwgInBlcmlvZHN1cGVyaW9yIiwgInF1ZXN0aW9uc21hbGwiLCAiYXN1cGVyaW9yIiwgImJzdXBlcmlvciIsICJjZW50c3VwZXJpb3IiLCAiZHN1cGVyaW9yIiwgImVzdXBlcmlvciIsICJpc3VwZXJpb3IiLCAibHN1cGVyaW9yIiwgIm1zdXBlcmlvciIsICJuc3VwZXJpb3IiLCAib3N1cGVyaW9yIiwgInJzdXBlcmlvciIsICJzc3VwZXJpb3IiLCAidHN1cGVyaW9yIiwgImZmIiwgImZmaSIsICJmZmwiLCAicGFyZW5sZWZ0aW5mZXJpb3IiLCAicGFyZW5yaWdodGluZmVyaW9yIiwgIkNpcmN1bWZsZXhzbWFsbCIsICJoeXBoZW5zdXBlcmlvciIsICJHcmF2ZXNtYWxsIiwgIkFzbWFsbCIsICJCc21hbGwiLCAiQ3NtYWxsIiwgIkRzbWFsbCIsICJFc21hbGwiLCAiRnNtYWxsIiwgIkdzbWFsbCIsICJIc21hbGwiLCAiSXNtYWxsIiwgIkpzbWFsbCIsICJLc21hbGwiLCAiTHNtYWxsIiwgIk1zbWFsbCIsICJOc21hbGwiLCAiT3NtYWxsIiwgIlBzbWFsbCIsICJRc21hbGwiLCAiUnNtYWxsIiwgIlNzbWFsbCIsICJUc21hbGwiLCAiVXNtYWxsIiwgIlZzbWFsbCIsICJXc21hbGwiLCAiWHNtYWxsIiwgIllzbWFsbCIsICJac21hbGwiLCAiY29sb25tb25ldGFyeSIsICJvbmVmaXR0ZWQiLCAicnVwaWFoIiwgIlRpbGRlc21hbGwiLCAiZXhjbGFtZG93bnNtYWxsIiwgImNlbnRvbGRzdHlsZSIsICJMc2xhc2hzbWFsbCIsICJTY2Fyb25zbWFsbCIsICJaY2Fyb25zbWFsbCIsICJEaWVyZXNpc3NtYWxsIiwgIkJyZXZlc21hbGwiLCAiQ2Fyb25zbWFsbCIsICJEb3RhY2NlbnRzbWFsbCIsICJNYWNyb25zbWFsbCIsICJmaWd1cmVkYXNoIiwgImh5cGhlbmluZmVyaW9yIiwgIk9nb25la3NtYWxsIiwgIlJpbmdzbWFsbCIsICJDZWRpbGxhc21hbGwiLCAicXVlc3Rpb25kb3duc21hbGwiLCAib25lZWlnaHRoIiwgInRocmVlZWlnaHRocyIsICJmaXZlZWlnaHRocyIsICJzZXZlbmVpZ2h0aHMiLCAib25ldGhpcmQiLCAidHdvdGhpcmRzIiwgInplcm9zdXBlcmlvciIsICJmb3Vyc3VwZXJpb3IiLCAiZml2ZXN1cGVyaW9yIiwgInNpeHN1cGVyaW9yIiwgInNldmVuc3VwZXJpb3IiLCAiZWlnaHRzdXBlcmlvciIsICJuaW5lc3VwZXJpb3IiLCAiemVyb2luZmVyaW9yIiwgIm9uZWluZmVyaW9yIiwgInR3b2luZmVyaW9yIiwgInRocmVlaW5mZXJpb3IiLCAiZm91cmluZmVyaW9yIiwgImZpdmVpbmZlcmlvciIsICJzaXhpbmZlcmlvciIsICJzZXZlbmluZmVyaW9yIiwgImVpZ2h0aW5mZXJpb3IiLCAibmluZWluZmVyaW9yIiwgImNlbnRpbmZlcmlvciIsICJkb2xsYXJpbmZlcmlvciIsICJwZXJpb2RpbmZlcmlvciIsICJjb21tYWluZmVyaW9yIiwgIkFncmF2ZXNtYWxsIiwgIkFhY3V0ZXNtYWxsIiwgIkFjaXJjdW1mbGV4c21hbGwiLCAiQXRpbGRlc21hbGwiLCAiQWRpZXJlc2lzc21hbGwiLCAiQXJpbmdzbWFsbCIsICJBRXNtYWxsIiwgIkNjZWRpbGxhc21hbGwiLCAiRWdyYXZlc21hbGwiLCAiRWFjdXRlc21hbGwiLCAiRWNpcmN1bWZsZXhzbWFsbCIsICJFZGllcmVzaXNzbWFsbCIsICJJZ3JhdmVzbWFsbCIsICJJYWN1dGVzbWFsbCIsICJJY2lyY3VtZmxleHNtYWxsIiwgIklkaWVyZXNpc3NtYWxsIiwgIkV0aHNtYWxsIiwgIk50aWxkZXNtYWxsIiwgIk9ncmF2ZXNtYWxsIiwgIk9hY3V0ZXNtYWxsIiwgIk9jaXJjdW1mbGV4c21hbGwiLCAiT3RpbGRlc21hbGwiLCAiT2RpZXJlc2lzc21hbGwiLCAiT0VzbWFsbCIsICJPc2xhc2hzbWFsbCIsICJVZ3JhdmVzbWFsbCIsICJVYWN1dGVzbWFsbCIsICJVY2lyY3VtZmxleHNtYWxsIiwgIlVkaWVyZXNpc3NtYWxsIiwgIllhY3V0ZXNtYWxsIiwgIlRob3Juc21hbGwiLCAiWWRpZXJlc2lzc21hbGwiLCAiMDAxLjAwMCIsICIwMDEuMDAxIiwgIjAwMS4wMDIiLCAiMDAxLjAwMyIsICJCbGFjayIsICJCb2xkIiwgIkJvb2siLCAiTGlnaHQiLCAiTWVkaXVtIiwgIlJlZ3VsYXIiLCAiUm9tYW4iLCAiU2VtaWJvbGQiXTsKICAgIGV4cG9ydHMuQ0ZGU3RhbmRhcmRTdHJpbmdzID0gQ0ZGU3RhbmRhcmRTdHJpbmdzOwogICAgdmFyIE5VTV9TVEFOREFSRF9DRkZfU1RSSU5HUyA9IDM5MTsKCiAgICB2YXIgQ0ZGUGFyc2VyID0gZnVuY3Rpb24gQ0ZGUGFyc2VyQ2xvc3VyZSgpIHsKICAgICAgdmFyIENoYXJzdHJpbmdWYWxpZGF0aW9uRGF0YSA9IFtudWxsLCB7CiAgICAgICAgaWQ6ICJoc3RlbSIsCiAgICAgICAgbWluOiAyLAogICAgICAgIHN0YWNrQ2xlYXJpbmc6IHRydWUsCiAgICAgICAgc3RlbTogdHJ1ZQogICAgICB9LCBudWxsLCB7CiAgICAgICAgaWQ6ICJ2c3RlbSIsCiAgICAgICAgbWluOiAyLAogICAgICAgIHN0YWNrQ2xlYXJpbmc6IHRydWUsCiAgICAgICAgc3RlbTogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgaWQ6ICJ2bW92ZXRvIiwKICAgICAgICBtaW46IDEsCiAgICAgICAgc3RhY2tDbGVhcmluZzogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgaWQ6ICJybGluZXRvIiwKICAgICAgICBtaW46IDIsCiAgICAgICAgcmVzZXRTdGFjazogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgaWQ6ICJobGluZXRvIiwKICAgICAgICBtaW46IDEsCiAgICAgICAgcmVzZXRTdGFjazogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgaWQ6ICJ2bGluZXRvIiwKICAgICAgICBtaW46IDEsCiAgICAgICAgcmVzZXRTdGFjazogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgaWQ6ICJycmN1cnZldG8iLAogICAgICAgIG1pbjogNiwKICAgICAgICByZXNldFN0YWNrOiB0cnVlCiAgICAgIH0sIG51bGwsIHsKICAgICAgICBpZDogImNhbGxzdWJyIiwKICAgICAgICBtaW46IDEsCiAgICAgICAgdW5kZWZTdGFjazogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgaWQ6ICJyZXR1cm4iLAogICAgICAgIG1pbjogMCwKICAgICAgICB1bmRlZlN0YWNrOiB0cnVlCiAgICAgIH0sIG51bGwsIG51bGwsIHsKICAgICAgICBpZDogImVuZGNoYXIiLAogICAgICAgIG1pbjogMCwKICAgICAgICBzdGFja0NsZWFyaW5nOiB0cnVlCiAgICAgIH0sIG51bGwsIG51bGwsIG51bGwsIHsKICAgICAgICBpZDogImhzdGVtaG0iLAogICAgICAgIG1pbjogMiwKICAgICAgICBzdGFja0NsZWFyaW5nOiB0cnVlLAogICAgICAgIHN0ZW06IHRydWUKICAgICAgfSwgewogICAgICAgIGlkOiAiaGludG1hc2siLAogICAgICAgIG1pbjogMCwKICAgICAgICBzdGFja0NsZWFyaW5nOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBpZDogImNudHJtYXNrIiwKICAgICAgICBtaW46IDAsCiAgICAgICAgc3RhY2tDbGVhcmluZzogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgaWQ6ICJybW92ZXRvIiwKICAgICAgICBtaW46IDIsCiAgICAgICAgc3RhY2tDbGVhcmluZzogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgaWQ6ICJobW92ZXRvIiwKICAgICAgICBtaW46IDEsCiAgICAgICAgc3RhY2tDbGVhcmluZzogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgaWQ6ICJ2c3RlbWhtIiwKICAgICAgICBtaW46IDIsCiAgICAgICAgc3RhY2tDbGVhcmluZzogdHJ1ZSwKICAgICAgICBzdGVtOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBpZDogInJjdXJ2ZWxpbmUiLAogICAgICAgIG1pbjogOCwKICAgICAgICByZXNldFN0YWNrOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBpZDogInJsaW5lY3VydmUiLAogICAgICAgIG1pbjogOCwKICAgICAgICByZXNldFN0YWNrOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBpZDogInZ2Y3VydmV0byIsCiAgICAgICAgbWluOiA0LAogICAgICAgIHJlc2V0U3RhY2s6IHRydWUKICAgICAgfSwgewogICAgICAgIGlkOiAiaGhjdXJ2ZXRvIiwKICAgICAgICBtaW46IDQsCiAgICAgICAgcmVzZXRTdGFjazogdHJ1ZQogICAgICB9LCBudWxsLCB7CiAgICAgICAgaWQ6ICJjYWxsZ3N1YnIiLAogICAgICAgIG1pbjogMSwKICAgICAgICB1bmRlZlN0YWNrOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBpZDogInZoY3VydmV0byIsCiAgICAgICAgbWluOiA0LAogICAgICAgIHJlc2V0U3RhY2s6IHRydWUKICAgICAgfSwgewogICAgICAgIGlkOiAiaHZjdXJ2ZXRvIiwKICAgICAgICBtaW46IDQsCiAgICAgICAgcmVzZXRTdGFjazogdHJ1ZQogICAgICB9XTsKICAgICAgdmFyIENoYXJzdHJpbmdWYWxpZGF0aW9uRGF0YTEyID0gW251bGwsIG51bGwsIG51bGwsIHsKICAgICAgICBpZDogImFuZCIsCiAgICAgICAgbWluOiAyLAogICAgICAgIHN0YWNrRGVsdGE6IC0xCiAgICAgIH0sIHsKICAgICAgICBpZDogIm9yIiwKICAgICAgICBtaW46IDIsCiAgICAgICAgc3RhY2tEZWx0YTogLTEKICAgICAgfSwgewogICAgICAgIGlkOiAibm90IiwKICAgICAgICBtaW46IDEsCiAgICAgICAgc3RhY2tEZWx0YTogMAogICAgICB9LCBudWxsLCBudWxsLCBudWxsLCB7CiAgICAgICAgaWQ6ICJhYnMiLAogICAgICAgIG1pbjogMSwKICAgICAgICBzdGFja0RlbHRhOiAwCiAgICAgIH0sIHsKICAgICAgICBpZDogImFkZCIsCiAgICAgICAgbWluOiAyLAogICAgICAgIHN0YWNrRGVsdGE6IC0xLAogICAgICAgIHN0YWNrRm46IGZ1bmN0aW9uIHN0YWNrX2RpdihzdGFjaywgaW5kZXgpIHsKICAgICAgICAgIHN0YWNrW2luZGV4IC0gMl0gPSBzdGFja1tpbmRleCAtIDJdICsgc3RhY2tbaW5kZXggLSAxXTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBpZDogInN1YiIsCiAgICAgICAgbWluOiAyLAogICAgICAgIHN0YWNrRGVsdGE6IC0xLAogICAgICAgIHN0YWNrRm46IGZ1bmN0aW9uIHN0YWNrX2RpdihzdGFjaywgaW5kZXgpIHsKICAgICAgICAgIHN0YWNrW2luZGV4IC0gMl0gPSBzdGFja1tpbmRleCAtIDJdIC0gc3RhY2tbaW5kZXggLSAxXTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBpZDogImRpdiIsCiAgICAgICAgbWluOiAyLAogICAgICAgIHN0YWNrRGVsdGE6IC0xLAogICAgICAgIHN0YWNrRm46IGZ1bmN0aW9uIHN0YWNrX2RpdihzdGFjaywgaW5kZXgpIHsKICAgICAgICAgIHN0YWNrW2luZGV4IC0gMl0gPSBzdGFja1tpbmRleCAtIDJdIC8gc3RhY2tbaW5kZXggLSAxXTsKICAgICAgICB9CiAgICAgIH0sIG51bGwsIHsKICAgICAgICBpZDogIm5lZyIsCiAgICAgICAgbWluOiAxLAogICAgICAgIHN0YWNrRGVsdGE6IDAsCiAgICAgICAgc3RhY2tGbjogZnVuY3Rpb24gc3RhY2tfZGl2KHN0YWNrLCBpbmRleCkgewogICAgICAgICAgc3RhY2tbaW5kZXggLSAxXSA9IC1zdGFja1tpbmRleCAtIDFdOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGlkOiAiZXEiLAogICAgICAgIG1pbjogMiwKICAgICAgICBzdGFja0RlbHRhOiAtMQogICAgICB9LCBudWxsLCBudWxsLCB7CiAgICAgICAgaWQ6ICJkcm9wIiwKICAgICAgICBtaW46IDEsCiAgICAgICAgc3RhY2tEZWx0YTogLTEKICAgICAgfSwgbnVsbCwgewogICAgICAgIGlkOiAicHV0IiwKICAgICAgICBtaW46IDIsCiAgICAgICAgc3RhY2tEZWx0YTogLTIKICAgICAgfSwgewogICAgICAgIGlkOiAiZ2V0IiwKICAgICAgICBtaW46IDEsCiAgICAgICAgc3RhY2tEZWx0YTogMAogICAgICB9LCB7CiAgICAgICAgaWQ6ICJpZmVsc2UiLAogICAgICAgIG1pbjogNCwKICAgICAgICBzdGFja0RlbHRhOiAtMwogICAgICB9LCB7CiAgICAgICAgaWQ6ICJyYW5kb20iLAogICAgICAgIG1pbjogMCwKICAgICAgICBzdGFja0RlbHRhOiAxCiAgICAgIH0sIHsKICAgICAgICBpZDogIm11bCIsCiAgICAgICAgbWluOiAyLAogICAgICAgIHN0YWNrRGVsdGE6IC0xLAogICAgICAgIHN0YWNrRm46IGZ1bmN0aW9uIHN0YWNrX2RpdihzdGFjaywgaW5kZXgpIHsKICAgICAgICAgIHN0YWNrW2luZGV4IC0gMl0gPSBzdGFja1tpbmRleCAtIDJdICogc3RhY2tbaW5kZXggLSAxXTsKICAgICAgICB9CiAgICAgIH0sIG51bGwsIHsKICAgICAgICBpZDogInNxcnQiLAogICAgICAgIG1pbjogMSwKICAgICAgICBzdGFja0RlbHRhOiAwCiAgICAgIH0sIHsKICAgICAgICBpZDogImR1cCIsCiAgICAgICAgbWluOiAxLAogICAgICAgIHN0YWNrRGVsdGE6IDEKICAgICAgfSwgewogICAgICAgIGlkOiAiZXhjaCIsCiAgICAgICAgbWluOiAyLAogICAgICAgIHN0YWNrRGVsdGE6IDAKICAgICAgfSwgewogICAgICAgIGlkOiAiaW5kZXgiLAogICAgICAgIG1pbjogMiwKICAgICAgICBzdGFja0RlbHRhOiAwCiAgICAgIH0sIHsKICAgICAgICBpZDogInJvbGwiLAogICAgICAgIG1pbjogMywKICAgICAgICBzdGFja0RlbHRhOiAtMgogICAgICB9LCBudWxsLCBudWxsLCBudWxsLCB7CiAgICAgICAgaWQ6ICJoZmxleCIsCiAgICAgICAgbWluOiA3LAogICAgICAgIHJlc2V0U3RhY2s6IHRydWUKICAgICAgfSwgewogICAgICAgIGlkOiAiZmxleCIsCiAgICAgICAgbWluOiAxMywKICAgICAgICByZXNldFN0YWNrOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBpZDogImhmbGV4MSIsCiAgICAgICAgbWluOiA5LAogICAgICAgIHJlc2V0U3RhY2s6IHRydWUKICAgICAgfSwgewogICAgICAgIGlkOiAiZmxleDEiLAogICAgICAgIG1pbjogMTEsCiAgICAgICAgcmVzZXRTdGFjazogdHJ1ZQogICAgICB9XTsKCiAgICAgIGZ1bmN0aW9uIENGRlBhcnNlcihmaWxlLCBwcm9wZXJ0aWVzLCBzZWFjQW5hbHlzaXNFbmFibGVkKSB7CiAgICAgICAgdGhpcy5ieXRlcyA9IGZpbGUuZ2V0Qnl0ZXMoKTsKICAgICAgICB0aGlzLnByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzOwogICAgICAgIHRoaXMuc2VhY0FuYWx5c2lzRW5hYmxlZCA9ICEhc2VhY0FuYWx5c2lzRW5hYmxlZDsKICAgICAgfQoKICAgICAgQ0ZGUGFyc2VyLnByb3RvdHlwZSA9IHsKICAgICAgICBwYXJzZTogZnVuY3Rpb24gQ0ZGUGFyc2VyX3BhcnNlKCkgewogICAgICAgICAgdmFyIHByb3BlcnRpZXMgPSB0aGlzLnByb3BlcnRpZXM7CiAgICAgICAgICB2YXIgY2ZmID0gbmV3IENGRigpOwogICAgICAgICAgdGhpcy5jZmYgPSBjZmY7CiAgICAgICAgICB2YXIgaGVhZGVyID0gdGhpcy5wYXJzZUhlYWRlcigpOwogICAgICAgICAgdmFyIG5hbWVJbmRleCA9IHRoaXMucGFyc2VJbmRleChoZWFkZXIuZW5kUG9zKTsKICAgICAgICAgIHZhciB0b3BEaWN0SW5kZXggPSB0aGlzLnBhcnNlSW5kZXgobmFtZUluZGV4LmVuZFBvcyk7CiAgICAgICAgICB2YXIgc3RyaW5nSW5kZXggPSB0aGlzLnBhcnNlSW5kZXgodG9wRGljdEluZGV4LmVuZFBvcyk7CiAgICAgICAgICB2YXIgZ2xvYmFsU3VickluZGV4ID0gdGhpcy5wYXJzZUluZGV4KHN0cmluZ0luZGV4LmVuZFBvcyk7CiAgICAgICAgICB2YXIgdG9wRGljdFBhcnNlZCA9IHRoaXMucGFyc2VEaWN0KHRvcERpY3RJbmRleC5vYmouZ2V0KDApKTsKICAgICAgICAgIHZhciB0b3BEaWN0ID0gdGhpcy5jcmVhdGVEaWN0KENGRlRvcERpY3QsIHRvcERpY3RQYXJzZWQsIGNmZi5zdHJpbmdzKTsKICAgICAgICAgIGNmZi5oZWFkZXIgPSBoZWFkZXIub2JqOwogICAgICAgICAgY2ZmLm5hbWVzID0gdGhpcy5wYXJzZU5hbWVJbmRleChuYW1lSW5kZXgub2JqKTsKICAgICAgICAgIGNmZi5zdHJpbmdzID0gdGhpcy5wYXJzZVN0cmluZ0luZGV4KHN0cmluZ0luZGV4Lm9iaik7CiAgICAgICAgICBjZmYudG9wRGljdCA9IHRvcERpY3Q7CiAgICAgICAgICBjZmYuZ2xvYmFsU3VickluZGV4ID0gZ2xvYmFsU3VickluZGV4Lm9iajsKICAgICAgICAgIHRoaXMucGFyc2VQcml2YXRlRGljdChjZmYudG9wRGljdCk7CiAgICAgICAgICBjZmYuaXNDSURGb250ID0gdG9wRGljdC5oYXNOYW1lKCJST1MiKTsKICAgICAgICAgIHZhciBjaGFyU3RyaW5nT2Zmc2V0ID0gdG9wRGljdC5nZXRCeU5hbWUoIkNoYXJTdHJpbmdzIik7CiAgICAgICAgICB2YXIgY2hhclN0cmluZ0luZGV4ID0gdGhpcy5wYXJzZUluZGV4KGNoYXJTdHJpbmdPZmZzZXQpLm9iajsKICAgICAgICAgIHZhciBmb250TWF0cml4ID0gdG9wRGljdC5nZXRCeU5hbWUoIkZvbnRNYXRyaXgiKTsKCiAgICAgICAgICBpZiAoZm9udE1hdHJpeCkgewogICAgICAgICAgICBwcm9wZXJ0aWVzLmZvbnRNYXRyaXggPSBmb250TWF0cml4OwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBmb250QkJveCA9IHRvcERpY3QuZ2V0QnlOYW1lKCJGb250QkJveCIpOwoKICAgICAgICAgIGlmIChmb250QkJveCkgewogICAgICAgICAgICBwcm9wZXJ0aWVzLmFzY2VudCA9IE1hdGgubWF4KGZvbnRCQm94WzNdLCBmb250QkJveFsxXSk7CiAgICAgICAgICAgIHByb3BlcnRpZXMuZGVzY2VudCA9IE1hdGgubWluKGZvbnRCQm94WzFdLCBmb250QkJveFszXSk7CiAgICAgICAgICAgIHByb3BlcnRpZXMuYXNjZW50U2NhbGVkID0gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgY2hhcnNldCwgZW5jb2Rpbmc7CgogICAgICAgICAgaWYgKGNmZi5pc0NJREZvbnQpIHsKICAgICAgICAgICAgdmFyIGZkQXJyYXlJbmRleCA9IHRoaXMucGFyc2VJbmRleCh0b3BEaWN0LmdldEJ5TmFtZSgiRkRBcnJheSIpKS5vYmo7CgogICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBmZEFycmF5SW5kZXguY291bnQ7IGkgPCBpaTsgKytpKSB7CiAgICAgICAgICAgICAgdmFyIGRpY3RSYXcgPSBmZEFycmF5SW5kZXguZ2V0KGkpOwogICAgICAgICAgICAgIHZhciBmb250RGljdCA9IHRoaXMuY3JlYXRlRGljdChDRkZUb3BEaWN0LCB0aGlzLnBhcnNlRGljdChkaWN0UmF3KSwgY2ZmLnN0cmluZ3MpOwogICAgICAgICAgICAgIHRoaXMucGFyc2VQcml2YXRlRGljdChmb250RGljdCk7CiAgICAgICAgICAgICAgY2ZmLmZkQXJyYXkucHVzaChmb250RGljdCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGVuY29kaW5nID0gbnVsbDsKICAgICAgICAgICAgY2hhcnNldCA9IHRoaXMucGFyc2VDaGFyc2V0cyh0b3BEaWN0LmdldEJ5TmFtZSgiY2hhcnNldCIpLCBjaGFyU3RyaW5nSW5kZXguY291bnQsIGNmZi5zdHJpbmdzLCB0cnVlKTsKICAgICAgICAgICAgY2ZmLmZkU2VsZWN0ID0gdGhpcy5wYXJzZUZEU2VsZWN0KHRvcERpY3QuZ2V0QnlOYW1lKCJGRFNlbGVjdCIpLCBjaGFyU3RyaW5nSW5kZXguY291bnQpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY2hhcnNldCA9IHRoaXMucGFyc2VDaGFyc2V0cyh0b3BEaWN0LmdldEJ5TmFtZSgiY2hhcnNldCIpLCBjaGFyU3RyaW5nSW5kZXguY291bnQsIGNmZi5zdHJpbmdzLCBmYWxzZSk7CiAgICAgICAgICAgIGVuY29kaW5nID0gdGhpcy5wYXJzZUVuY29kaW5nKHRvcERpY3QuZ2V0QnlOYW1lKCJFbmNvZGluZyIpLCBwcm9wZXJ0aWVzLCBjZmYuc3RyaW5ncywgY2hhcnNldC5jaGFyc2V0KTsKICAgICAgICAgIH0KCiAgICAgICAgICBjZmYuY2hhcnNldCA9IGNoYXJzZXQ7CiAgICAgICAgICBjZmYuZW5jb2RpbmcgPSBlbmNvZGluZzsKICAgICAgICAgIHZhciBjaGFyU3RyaW5nc0FuZFNlYWNzID0gdGhpcy5wYXJzZUNoYXJTdHJpbmdzKHsKICAgICAgICAgICAgY2hhclN0cmluZ3M6IGNoYXJTdHJpbmdJbmRleCwKICAgICAgICAgICAgbG9jYWxTdWJySW5kZXg6IHRvcERpY3QucHJpdmF0ZURpY3Quc3VicnNJbmRleCwKICAgICAgICAgICAgZ2xvYmFsU3VickluZGV4OiBnbG9iYWxTdWJySW5kZXgub2JqLAogICAgICAgICAgICBmZFNlbGVjdDogY2ZmLmZkU2VsZWN0LAogICAgICAgICAgICBmZEFycmF5OiBjZmYuZmRBcnJheSwKICAgICAgICAgICAgcHJpdmF0ZURpY3Q6IHRvcERpY3QucHJpdmF0ZURpY3QKICAgICAgICAgIH0pOwogICAgICAgICAgY2ZmLmNoYXJTdHJpbmdzID0gY2hhclN0cmluZ3NBbmRTZWFjcy5jaGFyU3RyaW5nczsKICAgICAgICAgIGNmZi5zZWFjcyA9IGNoYXJTdHJpbmdzQW5kU2VhY3Muc2VhY3M7CiAgICAgICAgICBjZmYud2lkdGhzID0gY2hhclN0cmluZ3NBbmRTZWFjcy53aWR0aHM7CiAgICAgICAgICByZXR1cm4gY2ZmOwogICAgICAgIH0sCiAgICAgICAgcGFyc2VIZWFkZXI6IGZ1bmN0aW9uIENGRlBhcnNlcl9wYXJzZUhlYWRlcigpIHsKICAgICAgICAgIHZhciBieXRlcyA9IHRoaXMuYnl0ZXM7CiAgICAgICAgICB2YXIgYnl0ZXNMZW5ndGggPSBieXRlcy5sZW5ndGg7CiAgICAgICAgICB2YXIgb2Zmc2V0ID0gMDsKCiAgICAgICAgICB3aGlsZSAob2Zmc2V0IDwgYnl0ZXNMZW5ndGggJiYgYnl0ZXNbb2Zmc2V0XSAhPT0gMSkgewogICAgICAgICAgICArK29mZnNldDsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAob2Zmc2V0ID49IGJ5dGVzTGVuZ3RoKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiSW52YWxpZCBDRkYgaGVhZGVyIik7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKG9mZnNldCAhPT0gMCkgewogICAgICAgICAgICAoMCwgX3V0aWwuaW5mbykoImNmZiBkYXRhIGlzIHNoaWZ0ZWQiKTsKICAgICAgICAgICAgYnl0ZXMgPSBieXRlcy5zdWJhcnJheShvZmZzZXQpOwogICAgICAgICAgICB0aGlzLmJ5dGVzID0gYnl0ZXM7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIG1ham9yID0gYnl0ZXNbMF07CiAgICAgICAgICB2YXIgbWlub3IgPSBieXRlc1sxXTsKICAgICAgICAgIHZhciBoZHJTaXplID0gYnl0ZXNbMl07CiAgICAgICAgICB2YXIgb2ZmU2l6ZSA9IGJ5dGVzWzNdOwogICAgICAgICAgdmFyIGhlYWRlciA9IG5ldyBDRkZIZWFkZXIobWFqb3IsIG1pbm9yLCBoZHJTaXplLCBvZmZTaXplKTsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIG9iajogaGVhZGVyLAogICAgICAgICAgICBlbmRQb3M6IGhkclNpemUKICAgICAgICAgIH07CiAgICAgICAgfSwKICAgICAgICBwYXJzZURpY3Q6IGZ1bmN0aW9uIENGRlBhcnNlcl9wYXJzZURpY3QoZGljdCkgewogICAgICAgICAgdmFyIHBvcyA9IDA7CgogICAgICAgICAgZnVuY3Rpb24gcGFyc2VPcGVyYW5kKCkgewogICAgICAgICAgICB2YXIgdmFsdWUgPSBkaWN0W3BvcysrXTsKCiAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gMzApIHsKICAgICAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdE9wZXJhbmQoKTsKICAgICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gMjgpIHsKICAgICAgICAgICAgICB2YWx1ZSA9IGRpY3RbcG9zKytdOwogICAgICAgICAgICAgIHZhbHVlID0gKHZhbHVlIDw8IDI0IHwgZGljdFtwb3MrK10gPDwgMTYpID4+IDE2OwogICAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gMjkpIHsKICAgICAgICAgICAgICB2YWx1ZSA9IGRpY3RbcG9zKytdOwogICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUgPDwgOCB8IGRpY3RbcG9zKytdOwogICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUgPDwgOCB8IGRpY3RbcG9zKytdOwogICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUgPDwgOCB8IGRpY3RbcG9zKytdOwogICAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA+PSAzMiAmJiB2YWx1ZSA8PSAyNDYpIHsKICAgICAgICAgICAgICByZXR1cm4gdmFsdWUgLSAxMzk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPj0gMjQ3ICYmIHZhbHVlIDw9IDI1MCkgewogICAgICAgICAgICAgIHJldHVybiAodmFsdWUgLSAyNDcpICogMjU2ICsgZGljdFtwb3MrK10gKyAxMDg7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPj0gMjUxICYmIHZhbHVlIDw9IDI1NCkgewogICAgICAgICAgICAgIHJldHVybiAtKCh2YWx1ZSAtIDI1MSkgKiAyNTYpIC0gZGljdFtwb3MrK10gLSAxMDg7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgnQ0ZGUGFyc2VyX3BhcnNlRGljdDogIicgKyB2YWx1ZSArICciIGlzIGEgcmVzZXJ2ZWQgY29tbWFuZC4nKTsKICAgICAgICAgICAgcmV0dXJuIE5hTjsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBwYXJzZUZsb2F0T3BlcmFuZCgpIHsKICAgICAgICAgICAgdmFyIHN0ciA9ICIiOwogICAgICAgICAgICB2YXIgZW9mID0gMTU7CiAgICAgICAgICAgIHZhciBsb29rdXAgPSBbIjAiLCAiMSIsICIyIiwgIjMiLCAiNCIsICI1IiwgIjYiLCAiNyIsICI4IiwgIjkiLCAiLiIsICJFIiwgIkUtIiwgbnVsbCwgIi0iXTsKICAgICAgICAgICAgdmFyIGxlbmd0aCA9IGRpY3QubGVuZ3RoOwoKICAgICAgICAgICAgd2hpbGUgKHBvcyA8IGxlbmd0aCkgewogICAgICAgICAgICAgIHZhciBiID0gZGljdFtwb3MrK107CiAgICAgICAgICAgICAgdmFyIGIxID0gYiA+PiA0OwogICAgICAgICAgICAgIHZhciBiMiA9IGIgJiAxNTsKCiAgICAgICAgICAgICAgaWYgKGIxID09PSBlb2YpIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgc3RyICs9IGxvb2t1cFtiMV07CgogICAgICAgICAgICAgIGlmIChiMiA9PT0gZW9mKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHN0ciArPSBsb29rdXBbYjJdOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChzdHIpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBvcGVyYW5kcyA9IFtdOwogICAgICAgICAgdmFyIGVudHJpZXMgPSBbXTsKICAgICAgICAgIHBvcyA9IDA7CiAgICAgICAgICB2YXIgZW5kID0gZGljdC5sZW5ndGg7CgogICAgICAgICAgd2hpbGUgKHBvcyA8IGVuZCkgewogICAgICAgICAgICB2YXIgYiA9IGRpY3RbcG9zXTsKCiAgICAgICAgICAgIGlmIChiIDw9IDIxKSB7CiAgICAgICAgICAgICAgaWYgKGIgPT09IDEyKSB7CiAgICAgICAgICAgICAgICBiID0gYiA8PCA4IHwgZGljdFsrK3Bvc107CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBlbnRyaWVzLnB1c2goW2IsIG9wZXJhbmRzXSk7CiAgICAgICAgICAgICAgb3BlcmFuZHMgPSBbXTsKICAgICAgICAgICAgICArK3BvczsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBvcGVyYW5kcy5wdXNoKHBhcnNlT3BlcmFuZCgpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBlbnRyaWVzOwogICAgICAgIH0sCiAgICAgICAgcGFyc2VJbmRleDogZnVuY3Rpb24gQ0ZGUGFyc2VyX3BhcnNlSW5kZXgocG9zKSB7CiAgICAgICAgICB2YXIgY2ZmSW5kZXggPSBuZXcgQ0ZGSW5kZXgoKTsKICAgICAgICAgIHZhciBieXRlcyA9IHRoaXMuYnl0ZXM7CiAgICAgICAgICB2YXIgY291bnQgPSBieXRlc1twb3MrK10gPDwgOCB8IGJ5dGVzW3BvcysrXTsKICAgICAgICAgIHZhciBvZmZzZXRzID0gW107CiAgICAgICAgICB2YXIgZW5kID0gcG9zOwogICAgICAgICAgdmFyIGksIGlpOwoKICAgICAgICAgIGlmIChjb3VudCAhPT0gMCkgewogICAgICAgICAgICB2YXIgb2Zmc2V0U2l6ZSA9IGJ5dGVzW3BvcysrXTsKICAgICAgICAgICAgdmFyIHN0YXJ0UG9zID0gcG9zICsgKGNvdW50ICsgMSkgKiBvZmZzZXRTaXplIC0gMTsKCiAgICAgICAgICAgIGZvciAoaSA9IDAsIGlpID0gY291bnQgKyAxOyBpIDwgaWk7ICsraSkgewogICAgICAgICAgICAgIHZhciBvZmZzZXQgPSAwOwoKICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG9mZnNldFNpemU7ICsraikgewogICAgICAgICAgICAgICAgb2Zmc2V0IDw8PSA4OwogICAgICAgICAgICAgICAgb2Zmc2V0ICs9IGJ5dGVzW3BvcysrXTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIG9mZnNldHMucHVzaChzdGFydFBvcyArIG9mZnNldCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGVuZCA9IG9mZnNldHNbY291bnRdOwogICAgICAgICAgfQoKICAgICAgICAgIGZvciAoaSA9IDAsIGlpID0gb2Zmc2V0cy5sZW5ndGggLSAxOyBpIDwgaWk7ICsraSkgewogICAgICAgICAgICB2YXIgb2Zmc2V0U3RhcnQgPSBvZmZzZXRzW2ldOwogICAgICAgICAgICB2YXIgb2Zmc2V0RW5kID0gb2Zmc2V0c1tpICsgMV07CiAgICAgICAgICAgIGNmZkluZGV4LmFkZChieXRlcy5zdWJhcnJheShvZmZzZXRTdGFydCwgb2Zmc2V0RW5kKSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgb2JqOiBjZmZJbmRleCwKICAgICAgICAgICAgZW5kUG9zOiBlbmQKICAgICAgICAgIH07CiAgICAgICAgfSwKICAgICAgICBwYXJzZU5hbWVJbmRleDogZnVuY3Rpb24gQ0ZGUGFyc2VyX3BhcnNlTmFtZUluZGV4KGluZGV4KSB7CiAgICAgICAgICB2YXIgbmFtZXMgPSBbXTsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBpbmRleC5jb3VudDsgaSA8IGlpOyArK2kpIHsKICAgICAgICAgICAgdmFyIG5hbWUgPSBpbmRleC5nZXQoaSk7CiAgICAgICAgICAgIG5hbWVzLnB1c2goKDAsIF91dGlsLmJ5dGVzVG9TdHJpbmcpKG5hbWUpKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gbmFtZXM7CiAgICAgICAgfSwKICAgICAgICBwYXJzZVN0cmluZ0luZGV4OiBmdW5jdGlvbiBDRkZQYXJzZXJfcGFyc2VTdHJpbmdJbmRleChpbmRleCkgewogICAgICAgICAgdmFyIHN0cmluZ3MgPSBuZXcgQ0ZGU3RyaW5ncygpOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGluZGV4LmNvdW50OyBpIDwgaWk7ICsraSkgewogICAgICAgICAgICB2YXIgZGF0YSA9IGluZGV4LmdldChpKTsKICAgICAgICAgICAgc3RyaW5ncy5hZGQoKDAsIF91dGlsLmJ5dGVzVG9TdHJpbmcpKGRhdGEpKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gc3RyaW5nczsKICAgICAgICB9LAogICAgICAgIGNyZWF0ZURpY3Q6IGZ1bmN0aW9uIENGRlBhcnNlcl9jcmVhdGVEaWN0KFR5cGUsIGRpY3QsIHN0cmluZ3MpIHsKICAgICAgICAgIHZhciBjZmZEaWN0ID0gbmV3IFR5cGUoc3RyaW5ncyk7CgogICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gZGljdC5sZW5ndGg7IGkgPCBpaTsgKytpKSB7CiAgICAgICAgICAgIHZhciBwYWlyID0gZGljdFtpXTsKICAgICAgICAgICAgdmFyIGtleSA9IHBhaXJbMF07CiAgICAgICAgICAgIHZhciB2YWx1ZSA9IHBhaXJbMV07CiAgICAgICAgICAgIGNmZkRpY3Quc2V0QnlLZXkoa2V5LCB2YWx1ZSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGNmZkRpY3Q7CiAgICAgICAgfSwKICAgICAgICBwYXJzZUNoYXJTdHJpbmc6IGZ1bmN0aW9uIENGRlBhcnNlcl9wYXJzZUNoYXJTdHJpbmcoc3RhdGUsIGRhdGEsIGxvY2FsU3VickluZGV4LCBnbG9iYWxTdWJySW5kZXgpIHsKICAgICAgICAgIGlmICghZGF0YSB8fCBzdGF0ZS5jYWxsRGVwdGggPiBNQVhfU1VCUl9ORVNUSU5HKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgc3RhY2tTaXplID0gc3RhdGUuc3RhY2tTaXplOwogICAgICAgICAgdmFyIHN0YWNrID0gc3RhdGUuc3RhY2s7CiAgICAgICAgICB2YXIgbGVuZ3RoID0gZGF0YS5sZW5ndGg7CgogICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBsZW5ndGg7KSB7CiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGRhdGFbaisrXTsKICAgICAgICAgICAgdmFyIHZhbGlkYXRpb25Db21tYW5kID0gbnVsbDsKCiAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gMTIpIHsKICAgICAgICAgICAgICB2YXIgcSA9IGRhdGFbaisrXTsKCiAgICAgICAgICAgICAgaWYgKHEgPT09IDApIHsKICAgICAgICAgICAgICAgIGRhdGFbaiAtIDJdID0gMTM5OwogICAgICAgICAgICAgICAgZGF0YVtqIC0gMV0gPSAyMjsKICAgICAgICAgICAgICAgIHN0YWNrU2l6ZSA9IDA7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHZhbGlkYXRpb25Db21tYW5kID0gQ2hhcnN0cmluZ1ZhbGlkYXRpb25EYXRhMTJbcV07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAyOCkgewogICAgICAgICAgICAgIHN0YWNrW3N0YWNrU2l6ZV0gPSAoZGF0YVtqXSA8PCAyNCB8IGRhdGFbaiArIDFdIDw8IDE2KSA+PiAxNjsKICAgICAgICAgICAgICBqICs9IDI7CiAgICAgICAgICAgICAgc3RhY2tTaXplKys7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09IDE0KSB7CiAgICAgICAgICAgICAgaWYgKHN0YWNrU2l6ZSA+PSA0KSB7CiAgICAgICAgICAgICAgICBzdGFja1NpemUgLT0gNDsKCiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWFjQW5hbHlzaXNFbmFibGVkKSB7CiAgICAgICAgICAgICAgICAgIHN0YXRlLnNlYWMgPSBzdGFjay5zbGljZShzdGFja1NpemUsIHN0YWNrU2l6ZSArIDQpOwogICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YWxpZGF0aW9uQ29tbWFuZCA9IENoYXJzdHJpbmdWYWxpZGF0aW9uRGF0YVt2YWx1ZV07CiAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPj0gMzIgJiYgdmFsdWUgPD0gMjQ2KSB7CiAgICAgICAgICAgICAgc3RhY2tbc3RhY2tTaXplXSA9IHZhbHVlIC0gMTM5OwogICAgICAgICAgICAgIHN0YWNrU2l6ZSsrOwogICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID49IDI0NyAmJiB2YWx1ZSA8PSAyNTQpIHsKICAgICAgICAgICAgICBzdGFja1tzdGFja1NpemVdID0gdmFsdWUgPCAyNTEgPyAodmFsdWUgLSAyNDcgPDwgOCkgKyBkYXRhW2pdICsgMTA4IDogLSh2YWx1ZSAtIDI1MSA8PCA4KSAtIGRhdGFbal0gLSAxMDg7CiAgICAgICAgICAgICAgaisrOwogICAgICAgICAgICAgIHN0YWNrU2l6ZSsrOwogICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAyNTUpIHsKICAgICAgICAgICAgICBzdGFja1tzdGFja1NpemVdID0gKGRhdGFbal0gPDwgMjQgfCBkYXRhW2ogKyAxXSA8PCAxNiB8IGRhdGFbaiArIDJdIDw8IDggfCBkYXRhW2ogKyAzXSkgLyA2NTUzNjsKICAgICAgICAgICAgICBqICs9IDQ7CiAgICAgICAgICAgICAgc3RhY2tTaXplKys7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09IDE5IHx8IHZhbHVlID09PSAyMCkgewogICAgICAgICAgICAgIHN0YXRlLmhpbnRzICs9IHN0YWNrU2l6ZSA+PiAxOwogICAgICAgICAgICAgIGogKz0gc3RhdGUuaGludHMgKyA3ID4+IDM7CiAgICAgICAgICAgICAgc3RhY2tTaXplICU9IDI7CiAgICAgICAgICAgICAgdmFsaWRhdGlvbkNvbW1hbmQgPSBDaGFyc3RyaW5nVmFsaWRhdGlvbkRhdGFbdmFsdWVdOwogICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAxMCB8fCB2YWx1ZSA9PT0gMjkpIHsKICAgICAgICAgICAgICB2YXIgc3VicnNJbmRleDsKCiAgICAgICAgICAgICAgaWYgKHZhbHVlID09PSAxMCkgewogICAgICAgICAgICAgICAgc3VicnNJbmRleCA9IGxvY2FsU3VickluZGV4OwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzdWJyc0luZGV4ID0gZ2xvYmFsU3VickluZGV4OwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKCFzdWJyc0luZGV4KSB7CiAgICAgICAgICAgICAgICB2YWxpZGF0aW9uQ29tbWFuZCA9IENoYXJzdHJpbmdWYWxpZGF0aW9uRGF0YVt2YWx1ZV07CiAgICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIk1pc3Npbmcgc3VicnNJbmRleCBmb3IgIiArIHZhbGlkYXRpb25Db21tYW5kLmlkKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBiaWFzID0gMzI3Njg7CgogICAgICAgICAgICAgIGlmIChzdWJyc0luZGV4LmNvdW50IDwgMTI0MCkgewogICAgICAgICAgICAgICAgYmlhcyA9IDEwNzsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHN1YnJzSW5kZXguY291bnQgPCAzMzkwMCkgewogICAgICAgICAgICAgICAgYmlhcyA9IDExMzE7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgc3Vick51bWJlciA9IHN0YWNrWy0tc3RhY2tTaXplXSArIGJpYXM7CgogICAgICAgICAgICAgIGlmIChzdWJyTnVtYmVyIDwgMCB8fCBzdWJyTnVtYmVyID49IHN1YnJzSW5kZXguY291bnQgfHwgaXNOYU4oc3Vick51bWJlcikpIHsKICAgICAgICAgICAgICAgIHZhbGlkYXRpb25Db21tYW5kID0gQ2hhcnN0cmluZ1ZhbGlkYXRpb25EYXRhW3ZhbHVlXTsKICAgICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiT3V0IG9mIGJvdW5kcyBzdWJySW5kZXggZm9yICIgKyB2YWxpZGF0aW9uQ29tbWFuZC5pZCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzdGF0ZS5zdGFja1NpemUgPSBzdGFja1NpemU7CiAgICAgICAgICAgICAgc3RhdGUuY2FsbERlcHRoKys7CiAgICAgICAgICAgICAgdmFyIHZhbGlkID0gdGhpcy5wYXJzZUNoYXJTdHJpbmcoc3RhdGUsIHN1YnJzSW5kZXguZ2V0KHN1YnJOdW1iZXIpLCBsb2NhbFN1YnJJbmRleCwgZ2xvYmFsU3VickluZGV4KTsKCiAgICAgICAgICAgICAgaWYgKCF2YWxpZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgc3RhdGUuY2FsbERlcHRoLS07CiAgICAgICAgICAgICAgc3RhY2tTaXplID0gc3RhdGUuc3RhY2tTaXplOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAxMSkgewogICAgICAgICAgICAgIHN0YXRlLnN0YWNrU2l6ZSA9IHN0YWNrU2l6ZTsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB2YWxpZGF0aW9uQ29tbWFuZCA9IENoYXJzdHJpbmdWYWxpZGF0aW9uRGF0YVt2YWx1ZV07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh2YWxpZGF0aW9uQ29tbWFuZCkgewogICAgICAgICAgICAgIGlmICh2YWxpZGF0aW9uQ29tbWFuZC5zdGVtKSB7CiAgICAgICAgICAgICAgICBzdGF0ZS5oaW50cyArPSBzdGFja1NpemUgPj4gMTsKCiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT09IDMgfHwgdmFsdWUgPT09IDIzKSB7CiAgICAgICAgICAgICAgICAgIHN0YXRlLmhhc1ZTdGVtcyA9IHRydWU7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXRlLmhhc1ZTdGVtcyAmJiAodmFsdWUgPT09IDEgfHwgdmFsdWUgPT09IDE4KSkgewogICAgICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIkNGRiBzdGVtIGhpbnRzIGFyZSBpbiB3cm9uZyBvcmRlciIpOwogICAgICAgICAgICAgICAgICBkYXRhW2ogLSAxXSA9IHZhbHVlID09PSAxID8gMyA6IDIzOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKCJtaW4iIGluIHZhbGlkYXRpb25Db21tYW5kKSB7CiAgICAgICAgICAgICAgICBpZiAoIXN0YXRlLnVuZGVmU3RhY2sgJiYgc3RhY2tTaXplIDwgdmFsaWRhdGlvbkNvbW1hbmQubWluKSB7CiAgICAgICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiTm90IGVub3VnaCBwYXJhbWV0ZXJzIGZvciAiICsgdmFsaWRhdGlvbkNvbW1hbmQuaWQgKyAiOyBhY3R1YWw6ICIgKyBzdGFja1NpemUgKyAiLCBleHBlY3RlZDogIiArIHZhbGlkYXRpb25Db21tYW5kLm1pbik7CiAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChzdGF0ZS5maXJzdFN0YWNrQ2xlYXJpbmcgJiYgdmFsaWRhdGlvbkNvbW1hbmQuc3RhY2tDbGVhcmluZykgewogICAgICAgICAgICAgICAgc3RhdGUuZmlyc3RTdGFja0NsZWFyaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICBzdGFja1NpemUgLT0gdmFsaWRhdGlvbkNvbW1hbmQubWluOwoKICAgICAgICAgICAgICAgIGlmIChzdGFja1NpemUgPj0gMiAmJiB2YWxpZGF0aW9uQ29tbWFuZC5zdGVtKSB7CiAgICAgICAgICAgICAgICAgIHN0YWNrU2l6ZSAlPSAyOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzdGFja1NpemUgPiAxKSB7CiAgICAgICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiRm91bmQgdG9vIG1hbnkgcGFyYW1ldGVycyBmb3Igc3RhY2stY2xlYXJpbmcgY29tbWFuZCIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChzdGFja1NpemUgPiAwICYmIHN0YWNrW3N0YWNrU2l6ZSAtIDFdID49IDApIHsKICAgICAgICAgICAgICAgICAgc3RhdGUud2lkdGggPSBzdGFja1tzdGFja1NpemUgLSAxXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICgic3RhY2tEZWx0YSIgaW4gdmFsaWRhdGlvbkNvbW1hbmQpIHsKICAgICAgICAgICAgICAgIGlmICgic3RhY2tGbiIgaW4gdmFsaWRhdGlvbkNvbW1hbmQpIHsKICAgICAgICAgICAgICAgICAgdmFsaWRhdGlvbkNvbW1hbmQuc3RhY2tGbihzdGFjaywgc3RhY2tTaXplKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBzdGFja1NpemUgKz0gdmFsaWRhdGlvbkNvbW1hbmQuc3RhY2tEZWx0YTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHZhbGlkYXRpb25Db21tYW5kLnN0YWNrQ2xlYXJpbmcpIHsKICAgICAgICAgICAgICAgIHN0YWNrU2l6ZSA9IDA7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh2YWxpZGF0aW9uQ29tbWFuZC5yZXNldFN0YWNrKSB7CiAgICAgICAgICAgICAgICBzdGFja1NpemUgPSAwOwogICAgICAgICAgICAgICAgc3RhdGUudW5kZWZTdGFjayA9IGZhbHNlOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsaWRhdGlvbkNvbW1hbmQudW5kZWZTdGFjaykgewogICAgICAgICAgICAgICAgc3RhY2tTaXplID0gMDsKICAgICAgICAgICAgICAgIHN0YXRlLnVuZGVmU3RhY2sgPSB0cnVlOwogICAgICAgICAgICAgICAgc3RhdGUuZmlyc3RTdGFja0NsZWFyaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgc3RhdGUuc3RhY2tTaXplID0gc3RhY2tTaXplOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSwKICAgICAgICBwYXJzZUNoYXJTdHJpbmdzOiBmdW5jdGlvbiBwYXJzZUNoYXJTdHJpbmdzKF9yZWYpIHsKICAgICAgICAgIHZhciBjaGFyU3RyaW5ncyA9IF9yZWYuY2hhclN0cmluZ3MsCiAgICAgICAgICAgIGxvY2FsU3VickluZGV4ID0gX3JlZi5sb2NhbFN1YnJJbmRleCwKICAgICAgICAgICAgZ2xvYmFsU3VickluZGV4ID0gX3JlZi5nbG9iYWxTdWJySW5kZXgsCiAgICAgICAgICAgIGZkU2VsZWN0ID0gX3JlZi5mZFNlbGVjdCwKICAgICAgICAgICAgZmRBcnJheSA9IF9yZWYuZmRBcnJheSwKICAgICAgICAgICAgcHJpdmF0ZURpY3QgPSBfcmVmLnByaXZhdGVEaWN0OwogICAgICAgICAgdmFyIHNlYWNzID0gW107CiAgICAgICAgICB2YXIgd2lkdGhzID0gW107CiAgICAgICAgICB2YXIgY291bnQgPSBjaGFyU3RyaW5ncy5jb3VudDsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgICAgICAgICAgdmFyIGNoYXJzdHJpbmcgPSBjaGFyU3RyaW5ncy5nZXQoaSk7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IHsKICAgICAgICAgICAgICBjYWxsRGVwdGg6IDAsCiAgICAgICAgICAgICAgc3RhY2tTaXplOiAwLAogICAgICAgICAgICAgIHN0YWNrOiBbXSwKICAgICAgICAgICAgICB1bmRlZlN0YWNrOiB0cnVlLAogICAgICAgICAgICAgIGhpbnRzOiAwLAogICAgICAgICAgICAgIGZpcnN0U3RhY2tDbGVhcmluZzogdHJ1ZSwKICAgICAgICAgICAgICBzZWFjOiBudWxsLAogICAgICAgICAgICAgIHdpZHRoOiBudWxsLAogICAgICAgICAgICAgIGhhc1ZTdGVtczogZmFsc2UKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdmFyIHZhbGlkID0gdHJ1ZTsKICAgICAgICAgICAgdmFyIGxvY2FsU3ViclRvVXNlID0gbnVsbDsKICAgICAgICAgICAgdmFyIHByaXZhdGVEaWN0VG9Vc2UgPSBwcml2YXRlRGljdDsKCiAgICAgICAgICAgIGlmIChmZFNlbGVjdCAmJiBmZEFycmF5Lmxlbmd0aCkgewogICAgICAgICAgICAgIHZhciBmZEluZGV4ID0gZmRTZWxlY3QuZ2V0RkRJbmRleChpKTsKCiAgICAgICAgICAgICAgaWYgKGZkSW5kZXggPT09IC0xKSB7CiAgICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIkdseXBoIGluZGV4IGlzIG5vdCBpbiBmZCBzZWxlY3QuIik7CiAgICAgICAgICAgICAgICB2YWxpZCA9IGZhbHNlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGZkSW5kZXggPj0gZmRBcnJheS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiSW52YWxpZCBmZCBpbmRleCBmb3IgZ2x5cGggaW5kZXguIik7CiAgICAgICAgICAgICAgICB2YWxpZCA9IGZhbHNlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHZhbGlkKSB7CiAgICAgICAgICAgICAgICBwcml2YXRlRGljdFRvVXNlID0gZmRBcnJheVtmZEluZGV4XS5wcml2YXRlRGljdDsKICAgICAgICAgICAgICAgIGxvY2FsU3ViclRvVXNlID0gcHJpdmF0ZURpY3RUb1VzZS5zdWJyc0luZGV4OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChsb2NhbFN1YnJJbmRleCkgewogICAgICAgICAgICAgIGxvY2FsU3ViclRvVXNlID0gbG9jYWxTdWJySW5kZXg7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh2YWxpZCkgewogICAgICAgICAgICAgIHZhbGlkID0gdGhpcy5wYXJzZUNoYXJTdHJpbmcoc3RhdGUsIGNoYXJzdHJpbmcsIGxvY2FsU3ViclRvVXNlLCBnbG9iYWxTdWJySW5kZXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoc3RhdGUud2lkdGggIT09IG51bGwpIHsKICAgICAgICAgICAgICB2YXIgbm9taW5hbFdpZHRoID0gcHJpdmF0ZURpY3RUb1VzZS5nZXRCeU5hbWUoIm5vbWluYWxXaWR0aFgiKTsKICAgICAgICAgICAgICB3aWR0aHNbaV0gPSBub21pbmFsV2lkdGggKyBzdGF0ZS53aWR0aDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB2YXIgZGVmYXVsdFdpZHRoID0gcHJpdmF0ZURpY3RUb1VzZS5nZXRCeU5hbWUoImRlZmF1bHRXaWR0aFgiKTsKICAgICAgICAgICAgICB3aWR0aHNbaV0gPSBkZWZhdWx0V2lkdGg7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChzdGF0ZS5zZWFjICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgc2VhY3NbaV0gPSBzdGF0ZS5zZWFjOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIXZhbGlkKSB7CiAgICAgICAgICAgICAgY2hhclN0cmluZ3Muc2V0KGksIG5ldyBVaW50OEFycmF5KFsxNF0pKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGNoYXJTdHJpbmdzOiBjaGFyU3RyaW5ncywKICAgICAgICAgICAgc2VhY3M6IHNlYWNzLAogICAgICAgICAgICB3aWR0aHM6IHdpZHRocwogICAgICAgICAgfTsKICAgICAgICB9LAogICAgICAgIGVtcHR5UHJpdmF0ZURpY3Rpb25hcnk6IGZ1bmN0aW9uIENGRlBhcnNlcl9lbXB0eVByaXZhdGVEaWN0aW9uYXJ5KHBhcmVudERpY3QpIHsKICAgICAgICAgIHZhciBwcml2YXRlRGljdCA9IHRoaXMuY3JlYXRlRGljdChDRkZQcml2YXRlRGljdCwgW10sIHBhcmVudERpY3Quc3RyaW5ncyk7CiAgICAgICAgICBwYXJlbnREaWN0LnNldEJ5S2V5KDE4LCBbMCwgMF0pOwogICAgICAgICAgcGFyZW50RGljdC5wcml2YXRlRGljdCA9IHByaXZhdGVEaWN0OwogICAgICAgIH0sCiAgICAgICAgcGFyc2VQcml2YXRlRGljdDogZnVuY3Rpb24gQ0ZGUGFyc2VyX3BhcnNlUHJpdmF0ZURpY3QocGFyZW50RGljdCkgewogICAgICAgICAgaWYgKCFwYXJlbnREaWN0Lmhhc05hbWUoIlByaXZhdGUiKSkgewogICAgICAgICAgICB0aGlzLmVtcHR5UHJpdmF0ZURpY3Rpb25hcnkocGFyZW50RGljdCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcHJpdmF0ZU9mZnNldCA9IHBhcmVudERpY3QuZ2V0QnlOYW1lKCJQcml2YXRlIik7CgogICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHByaXZhdGVPZmZzZXQpIHx8IHByaXZhdGVPZmZzZXQubGVuZ3RoICE9PSAyKSB7CiAgICAgICAgICAgIHBhcmVudERpY3QucmVtb3ZlQnlOYW1lKCJQcml2YXRlIik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgc2l6ZSA9IHByaXZhdGVPZmZzZXRbMF07CiAgICAgICAgICB2YXIgb2Zmc2V0ID0gcHJpdmF0ZU9mZnNldFsxXTsKCiAgICAgICAgICBpZiAoc2l6ZSA9PT0gMCB8fCBvZmZzZXQgPj0gdGhpcy5ieXRlcy5sZW5ndGgpIHsKICAgICAgICAgICAgdGhpcy5lbXB0eVByaXZhdGVEaWN0aW9uYXJ5KHBhcmVudERpY3QpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHByaXZhdGVEaWN0RW5kID0gb2Zmc2V0ICsgc2l6ZTsKICAgICAgICAgIHZhciBkaWN0RGF0YSA9IHRoaXMuYnl0ZXMuc3ViYXJyYXkob2Zmc2V0LCBwcml2YXRlRGljdEVuZCk7CiAgICAgICAgICB2YXIgZGljdCA9IHRoaXMucGFyc2VEaWN0KGRpY3REYXRhKTsKICAgICAgICAgIHZhciBwcml2YXRlRGljdCA9IHRoaXMuY3JlYXRlRGljdChDRkZQcml2YXRlRGljdCwgZGljdCwgcGFyZW50RGljdC5zdHJpbmdzKTsKICAgICAgICAgIHBhcmVudERpY3QucHJpdmF0ZURpY3QgPSBwcml2YXRlRGljdDsKCiAgICAgICAgICBpZiAoIXByaXZhdGVEaWN0LmdldEJ5TmFtZSgiU3VicnMiKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHN1YnJzT2Zmc2V0ID0gcHJpdmF0ZURpY3QuZ2V0QnlOYW1lKCJTdWJycyIpOwogICAgICAgICAgdmFyIHJlbGF0aXZlT2Zmc2V0ID0gb2Zmc2V0ICsgc3VicnNPZmZzZXQ7CgogICAgICAgICAgaWYgKHN1YnJzT2Zmc2V0ID09PSAwIHx8IHJlbGF0aXZlT2Zmc2V0ID49IHRoaXMuYnl0ZXMubGVuZ3RoKSB7CiAgICAgICAgICAgIHRoaXMuZW1wdHlQcml2YXRlRGljdGlvbmFyeShwYXJlbnREaWN0KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBzdWJyc0luZGV4ID0gdGhpcy5wYXJzZUluZGV4KHJlbGF0aXZlT2Zmc2V0KTsKICAgICAgICAgIHByaXZhdGVEaWN0LnN1YnJzSW5kZXggPSBzdWJyc0luZGV4Lm9iajsKICAgICAgICB9LAogICAgICAgIHBhcnNlQ2hhcnNldHM6IGZ1bmN0aW9uIENGRlBhcnNlcl9wYXJzZUNoYXJzZXRzKHBvcywgbGVuZ3RoLCBzdHJpbmdzLCBjaWQpIHsKICAgICAgICAgIGlmIChwb3MgPT09IDApIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBDRkZDaGFyc2V0KHRydWUsIENGRkNoYXJzZXRQcmVkZWZpbmVkVHlwZXMuSVNPX0FET0JFLCBfY2hhcnNldHMuSVNPQWRvYmVDaGFyc2V0KTsKICAgICAgICAgIH0gZWxzZSBpZiAocG9zID09PSAxKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgQ0ZGQ2hhcnNldCh0cnVlLCBDRkZDaGFyc2V0UHJlZGVmaW5lZFR5cGVzLkVYUEVSVCwgX2NoYXJzZXRzLkV4cGVydENoYXJzZXQpOwogICAgICAgICAgfSBlbHNlIGlmIChwb3MgPT09IDIpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBDRkZDaGFyc2V0KHRydWUsIENGRkNoYXJzZXRQcmVkZWZpbmVkVHlwZXMuRVhQRVJUX1NVQlNFVCwgX2NoYXJzZXRzLkV4cGVydFN1YnNldENoYXJzZXQpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBieXRlcyA9IHRoaXMuYnl0ZXM7CiAgICAgICAgICB2YXIgc3RhcnQgPSBwb3M7CiAgICAgICAgICB2YXIgZm9ybWF0ID0gYnl0ZXNbcG9zKytdOwogICAgICAgICAgdmFyIGNoYXJzZXQgPSBbIi5ub3RkZWYiXTsKICAgICAgICAgIHZhciBpZCwgY291bnQsIGk7CiAgICAgICAgICBsZW5ndGggLT0gMTsKCiAgICAgICAgICBzd2l0Y2ggKGZvcm1hdCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZCA9IGJ5dGVzW3BvcysrXSA8PCA4IHwgYnl0ZXNbcG9zKytdOwogICAgICAgICAgICAgICAgY2hhcnNldC5wdXNoKGNpZCA/IGlkIDogc3RyaW5ncy5nZXQoaWQpKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgIHdoaWxlIChjaGFyc2V0Lmxlbmd0aCA8PSBsZW5ndGgpIHsKICAgICAgICAgICAgICAgIGlkID0gYnl0ZXNbcG9zKytdIDw8IDggfCBieXRlc1twb3MrK107CiAgICAgICAgICAgICAgICBjb3VudCA9IGJ5dGVzW3BvcysrXTsKCiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDw9IGNvdW50OyBpKyspIHsKICAgICAgICAgICAgICAgICAgY2hhcnNldC5wdXNoKGNpZCA/IGlkKysgOiBzdHJpbmdzLmdldChpZCsrKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICB3aGlsZSAoY2hhcnNldC5sZW5ndGggPD0gbGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBpZCA9IGJ5dGVzW3BvcysrXSA8PCA4IHwgYnl0ZXNbcG9zKytdOwogICAgICAgICAgICAgICAgY291bnQgPSBieXRlc1twb3MrK10gPDwgOCB8IGJ5dGVzW3BvcysrXTsKCiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDw9IGNvdW50OyBpKyspIHsKICAgICAgICAgICAgICAgICAgY2hhcnNldC5wdXNoKGNpZCA/IGlkKysgOiBzdHJpbmdzLmdldChpZCsrKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJVbmtub3duIGNoYXJzZXQgZm9ybWF0Iik7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGVuZCA9IHBvczsKICAgICAgICAgIHZhciByYXcgPSBieXRlcy5zdWJhcnJheShzdGFydCwgZW5kKTsKICAgICAgICAgIHJldHVybiBuZXcgQ0ZGQ2hhcnNldChmYWxzZSwgZm9ybWF0LCBjaGFyc2V0LCByYXcpOwogICAgICAgIH0sCiAgICAgICAgcGFyc2VFbmNvZGluZzogZnVuY3Rpb24gQ0ZGUGFyc2VyX3BhcnNlRW5jb2RpbmcocG9zLCBwcm9wZXJ0aWVzLCBzdHJpbmdzLCBjaGFyc2V0KSB7CiAgICAgICAgICB2YXIgZW5jb2RpbmcgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgICAgdmFyIGJ5dGVzID0gdGhpcy5ieXRlczsKICAgICAgICAgIHZhciBwcmVkZWZpbmVkID0gZmFsc2U7CiAgICAgICAgICB2YXIgZm9ybWF0LCBpLCBpaTsKICAgICAgICAgIHZhciByYXcgPSBudWxsOwoKICAgICAgICAgIGZ1bmN0aW9uIHJlYWRTdXBwbGVtZW50KCkgewogICAgICAgICAgICB2YXIgc3VwcGxlbWVudHNDb3VudCA9IGJ5dGVzW3BvcysrXTsKCiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzdXBwbGVtZW50c0NvdW50OyBpKyspIHsKICAgICAgICAgICAgICB2YXIgY29kZSA9IGJ5dGVzW3BvcysrXTsKICAgICAgICAgICAgICB2YXIgc2lkID0gKGJ5dGVzW3BvcysrXSA8PCA4KSArIChieXRlc1twb3MrK10gJiAweGZmKTsKICAgICAgICAgICAgICBlbmNvZGluZ1tjb2RlXSA9IGNoYXJzZXQuaW5kZXhPZihzdHJpbmdzLmdldChzaWQpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmIChwb3MgPT09IDAgfHwgcG9zID09PSAxKSB7CiAgICAgICAgICAgIHByZWRlZmluZWQgPSB0cnVlOwogICAgICAgICAgICBmb3JtYXQgPSBwb3M7CiAgICAgICAgICAgIHZhciBiYXNlRW5jb2RpbmcgPSBwb3MgPyBfZW5jb2RpbmdzLkV4cGVydEVuY29kaW5nIDogX2VuY29kaW5ncy5TdGFuZGFyZEVuY29kaW5nOwoKICAgICAgICAgICAgZm9yIChpID0gMCwgaWkgPSBjaGFyc2V0Lmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgICB2YXIgaW5kZXggPSBiYXNlRW5jb2RpbmcuaW5kZXhPZihjaGFyc2V0W2ldKTsKCiAgICAgICAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICAgICAgICAgICAgZW5jb2RpbmdbaW5kZXhdID0gaTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciBkYXRhU3RhcnQgPSBwb3M7CiAgICAgICAgICAgIGZvcm1hdCA9IGJ5dGVzW3BvcysrXTsKCiAgICAgICAgICAgIHN3aXRjaCAoZm9ybWF0ICYgMHg3ZikgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHZhciBnbHlwaHNDb3VudCA9IGJ5dGVzW3BvcysrXTsKCiAgICAgICAgICAgICAgICBmb3IgKGkgPSAxOyBpIDw9IGdseXBoc0NvdW50OyBpKyspIHsKICAgICAgICAgICAgICAgICAgZW5jb2RpbmdbYnl0ZXNbcG9zKytdXSA9IGk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgIHZhciByYW5nZXNDb3VudCA9IGJ5dGVzW3BvcysrXTsKICAgICAgICAgICAgICAgIHZhciBnaWQgPSAxOwoKICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCByYW5nZXNDb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgIHZhciBzdGFydCA9IGJ5dGVzW3BvcysrXTsKICAgICAgICAgICAgICAgICAgdmFyIGxlZnQgPSBieXRlc1twb3MrK107CgogICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gc3RhcnQ7IGogPD0gc3RhcnQgKyBsZWZ0OyBqKyspIHsKICAgICAgICAgICAgICAgICAgICBlbmNvZGluZ1tqXSA9IGdpZCsrOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIlVua25vd24gZW5jb2RpbmcgZm9ybWF0OiAiLmNvbmNhdChmb3JtYXQsICIgaW4gQ0ZGIikpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgZGF0YUVuZCA9IHBvczsKCiAgICAgICAgICAgIGlmIChmb3JtYXQgJiAweDgwKSB7CiAgICAgICAgICAgICAgYnl0ZXNbZGF0YVN0YXJ0XSAmPSAweDdmOwogICAgICAgICAgICAgIHJlYWRTdXBwbGVtZW50KCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJhdyA9IGJ5dGVzLnN1YmFycmF5KGRhdGFTdGFydCwgZGF0YUVuZCk7CiAgICAgICAgICB9CgogICAgICAgICAgZm9ybWF0ID0gZm9ybWF0ICYgMHg3ZjsKICAgICAgICAgIHJldHVybiBuZXcgQ0ZGRW5jb2RpbmcocHJlZGVmaW5lZCwgZm9ybWF0LCBlbmNvZGluZywgcmF3KTsKICAgICAgICB9LAogICAgICAgIHBhcnNlRkRTZWxlY3Q6IGZ1bmN0aW9uIENGRlBhcnNlcl9wYXJzZUZEU2VsZWN0KHBvcywgbGVuZ3RoKSB7CiAgICAgICAgICB2YXIgYnl0ZXMgPSB0aGlzLmJ5dGVzOwogICAgICAgICAgdmFyIGZvcm1hdCA9IGJ5dGVzW3BvcysrXTsKICAgICAgICAgIHZhciBmZFNlbGVjdCA9IFtdOwogICAgICAgICAgdmFyIGk7CgogICAgICAgICAgc3dpdGNoIChmb3JtYXQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkgewogICAgICAgICAgICAgICAgdmFyIGlkID0gYnl0ZXNbcG9zKytdOwogICAgICAgICAgICAgICAgZmRTZWxlY3QucHVzaChpZCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICB2YXIgcmFuZ2VzQ291bnQgPSBieXRlc1twb3MrK10gPDwgOCB8IGJ5dGVzW3BvcysrXTsKCiAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHJhbmdlc0NvdW50OyArK2kpIHsKICAgICAgICAgICAgICAgIHZhciBmaXJzdCA9IGJ5dGVzW3BvcysrXSA8PCA4IHwgYnl0ZXNbcG9zKytdOwoKICAgICAgICAgICAgICAgIGlmIChpID09PSAwICYmIGZpcnN0ICE9PSAwKSB7CiAgICAgICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgicGFyc2VGRFNlbGVjdDogVGhlIGZpcnN0IHJhbmdlIG11c3QgaGF2ZSBhIGZpcnN0IEdJRCBvZiAwIiArICIgLS0gdHJ5aW5nIHRvIHJlY292ZXIuIik7CiAgICAgICAgICAgICAgICAgIGZpcnN0ID0gMDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgZmRJbmRleCA9IGJ5dGVzW3BvcysrXTsKICAgICAgICAgICAgICAgIHZhciBuZXh0ID0gYnl0ZXNbcG9zXSA8PCA4IHwgYnl0ZXNbcG9zICsgMV07CgogICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IGZpcnN0OyBqIDwgbmV4dDsgKytqKSB7CiAgICAgICAgICAgICAgICAgIGZkU2VsZWN0LnB1c2goZmRJbmRleCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBwb3MgKz0gMjsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJwYXJzZUZEU2VsZWN0OiBVbmtub3duIGZvcm1hdCBcIiIuY29uY2F0KGZvcm1hdCwgIlwiLiIpKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZmRTZWxlY3QubGVuZ3RoICE9PSBsZW5ndGgpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJwYXJzZUZEU2VsZWN0OiBJbnZhbGlkIGZvbnQgZGF0YS4iKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gbmV3IENGRkZEU2VsZWN0KGZvcm1hdCwgZmRTZWxlY3QpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgcmV0dXJuIENGRlBhcnNlcjsKICAgIH0oKTsKCiAgICBleHBvcnRzLkNGRlBhcnNlciA9IENGRlBhcnNlcjsKCiAgICB2YXIgQ0ZGID0gZnVuY3Rpb24gQ0ZGQ2xvc3VyZSgpIHsKICAgICAgZnVuY3Rpb24gQ0ZGKCkgewogICAgICAgIHRoaXMuaGVhZGVyID0gbnVsbDsKICAgICAgICB0aGlzLm5hbWVzID0gW107CiAgICAgICAgdGhpcy50b3BEaWN0ID0gbnVsbDsKICAgICAgICB0aGlzLnN0cmluZ3MgPSBuZXcgQ0ZGU3RyaW5ncygpOwogICAgICAgIHRoaXMuZ2xvYmFsU3VickluZGV4ID0gbnVsbDsKICAgICAgICB0aGlzLmVuY29kaW5nID0gbnVsbDsKICAgICAgICB0aGlzLmNoYXJzZXQgPSBudWxsOwogICAgICAgIHRoaXMuY2hhclN0cmluZ3MgPSBudWxsOwogICAgICAgIHRoaXMuZmRBcnJheSA9IFtdOwogICAgICAgIHRoaXMuZmRTZWxlY3QgPSBudWxsOwogICAgICAgIHRoaXMuaXNDSURGb250ID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIENGRi5wcm90b3R5cGUgPSB7CiAgICAgICAgZHVwbGljYXRlRmlyc3RHbHlwaDogZnVuY3Rpb24gQ0ZGX2R1cGxpY2F0ZUZpcnN0R2x5cGgoKSB7CiAgICAgICAgICBpZiAodGhpcy5jaGFyU3RyaW5ncy5jb3VudCA+PSA2NTUzNSkgewogICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIk5vdCBlbm91Z2ggc3BhY2UgaW4gY2hhcnN0cmluZ3MgdG8gZHVwbGljYXRlIGZpcnN0IGdseXBoLiIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGdseXBoWmVybyA9IHRoaXMuY2hhclN0cmluZ3MuZ2V0KDApOwogICAgICAgICAgdGhpcy5jaGFyU3RyaW5ncy5hZGQoZ2x5cGhaZXJvKTsKCiAgICAgICAgICBpZiAodGhpcy5pc0NJREZvbnQpIHsKICAgICAgICAgICAgdGhpcy5mZFNlbGVjdC5mZFNlbGVjdC5wdXNoKHRoaXMuZmRTZWxlY3QuZmRTZWxlY3RbMF0pOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgaGFzR2x5cGhJZDogZnVuY3Rpb24gQ0ZGX2hhc0dseXBoSUQoaWQpIHsKICAgICAgICAgIGlmIChpZCA8IDAgfHwgaWQgPj0gdGhpcy5jaGFyU3RyaW5ncy5jb3VudCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGdseXBoID0gdGhpcy5jaGFyU3RyaW5ncy5nZXQoaWQpOwogICAgICAgICAgcmV0dXJuIGdseXBoLmxlbmd0aCA+IDA7CiAgICAgICAgfQogICAgICB9OwogICAgICByZXR1cm4gQ0ZGOwogICAgfSgpOwoKICAgIGV4cG9ydHMuQ0ZGID0gQ0ZGOwoKICAgIHZhciBDRkZIZWFkZXIgPSBmdW5jdGlvbiBDRkZIZWFkZXJDbG9zdXJlKCkgewogICAgICBmdW5jdGlvbiBDRkZIZWFkZXIobWFqb3IsIG1pbm9yLCBoZHJTaXplLCBvZmZTaXplKSB7CiAgICAgICAgdGhpcy5tYWpvciA9IG1ham9yOwogICAgICAgIHRoaXMubWlub3IgPSBtaW5vcjsKICAgICAgICB0aGlzLmhkclNpemUgPSBoZHJTaXplOwogICAgICAgIHRoaXMub2ZmU2l6ZSA9IG9mZlNpemU7CiAgICAgIH0KCiAgICAgIHJldHVybiBDRkZIZWFkZXI7CiAgICB9KCk7CgogICAgZXhwb3J0cy5DRkZIZWFkZXIgPSBDRkZIZWFkZXI7CgogICAgdmFyIENGRlN0cmluZ3MgPSBmdW5jdGlvbiBDRkZTdHJpbmdzQ2xvc3VyZSgpIHsKICAgICAgZnVuY3Rpb24gQ0ZGU3RyaW5ncygpIHsKICAgICAgICB0aGlzLnN0cmluZ3MgPSBbXTsKICAgICAgfQoKICAgICAgQ0ZGU3RyaW5ncy5wcm90b3R5cGUgPSB7CiAgICAgICAgZ2V0OiBmdW5jdGlvbiBDRkZTdHJpbmdzX2dldChpbmRleCkgewogICAgICAgICAgaWYgKGluZGV4ID49IDAgJiYgaW5kZXggPD0gTlVNX1NUQU5EQVJEX0NGRl9TVFJJTkdTIC0gMSkgewogICAgICAgICAgICByZXR1cm4gQ0ZGU3RhbmRhcmRTdHJpbmdzW2luZGV4XTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoaW5kZXggLSBOVU1fU1RBTkRBUkRfQ0ZGX1NUUklOR1MgPD0gdGhpcy5zdHJpbmdzLmxlbmd0aCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5zdHJpbmdzW2luZGV4IC0gTlVNX1NUQU5EQVJEX0NGRl9TVFJJTkdTXTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gQ0ZGU3RhbmRhcmRTdHJpbmdzWzBdOwogICAgICAgIH0sCiAgICAgICAgZ2V0U0lEOiBmdW5jdGlvbiBDRkZTdHJpbmdzX2dldFNJRChzdHIpIHsKICAgICAgICAgIHZhciBpbmRleCA9IENGRlN0YW5kYXJkU3RyaW5ncy5pbmRleE9mKHN0cik7CgogICAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICAgICAgICByZXR1cm4gaW5kZXg7CiAgICAgICAgICB9CgogICAgICAgICAgaW5kZXggPSB0aGlzLnN0cmluZ3MuaW5kZXhPZihzdHIpOwoKICAgICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICAgICAgcmV0dXJuIGluZGV4ICsgTlVNX1NUQU5EQVJEX0NGRl9TVFJJTkdTOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICB9LAogICAgICAgIGFkZDogZnVuY3Rpb24gQ0ZGU3RyaW5nc19hZGQodmFsdWUpIHsKICAgICAgICAgIHRoaXMuc3RyaW5ncy5wdXNoKHZhbHVlKTsKICAgICAgICB9LAoKICAgICAgICBnZXQgY291bnQoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5zdHJpbmdzLmxlbmd0aDsKICAgICAgICB9CgogICAgICB9OwogICAgICByZXR1cm4gQ0ZGU3RyaW5nczsKICAgIH0oKTsKCiAgICBleHBvcnRzLkNGRlN0cmluZ3MgPSBDRkZTdHJpbmdzOwoKICAgIHZhciBDRkZJbmRleCA9IGZ1bmN0aW9uIENGRkluZGV4Q2xvc3VyZSgpIHsKICAgICAgZnVuY3Rpb24gQ0ZGSW5kZXgoKSB7CiAgICAgICAgdGhpcy5vYmplY3RzID0gW107CiAgICAgICAgdGhpcy5sZW5ndGggPSAwOwogICAgICB9CgogICAgICBDRkZJbmRleC5wcm90b3R5cGUgPSB7CiAgICAgICAgYWRkOiBmdW5jdGlvbiBDRkZJbmRleF9hZGQoZGF0YSkgewogICAgICAgICAgdGhpcy5sZW5ndGggKz0gZGF0YS5sZW5ndGg7CiAgICAgICAgICB0aGlzLm9iamVjdHMucHVzaChkYXRhKTsKICAgICAgICB9LAogICAgICAgIHNldDogZnVuY3Rpb24gQ0ZGSW5kZXhfc2V0KGluZGV4LCBkYXRhKSB7CiAgICAgICAgICB0aGlzLmxlbmd0aCArPSBkYXRhLmxlbmd0aCAtIHRoaXMub2JqZWN0c1tpbmRleF0ubGVuZ3RoOwogICAgICAgICAgdGhpcy5vYmplY3RzW2luZGV4XSA9IGRhdGE7CiAgICAgICAgfSwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIENGRkluZGV4X2dldChpbmRleCkgewogICAgICAgICAgcmV0dXJuIHRoaXMub2JqZWN0c1tpbmRleF07CiAgICAgICAgfSwKCiAgICAgICAgZ2V0IGNvdW50KCkgewogICAgICAgICAgcmV0dXJuIHRoaXMub2JqZWN0cy5sZW5ndGg7CiAgICAgICAgfQoKICAgICAgfTsKICAgICAgcmV0dXJuIENGRkluZGV4OwogICAgfSgpOwoKICAgIGV4cG9ydHMuQ0ZGSW5kZXggPSBDRkZJbmRleDsKCiAgICB2YXIgQ0ZGRGljdCA9IGZ1bmN0aW9uIENGRkRpY3RDbG9zdXJlKCkgewogICAgICBmdW5jdGlvbiBDRkZEaWN0KHRhYmxlcywgc3RyaW5ncykgewogICAgICAgIHRoaXMua2V5VG9OYW1lTWFwID0gdGFibGVzLmtleVRvTmFtZU1hcDsKICAgICAgICB0aGlzLm5hbWVUb0tleU1hcCA9IHRhYmxlcy5uYW1lVG9LZXlNYXA7CiAgICAgICAgdGhpcy5kZWZhdWx0cyA9IHRhYmxlcy5kZWZhdWx0czsKICAgICAgICB0aGlzLnR5cGVzID0gdGFibGVzLnR5cGVzOwogICAgICAgIHRoaXMub3Bjb2RlcyA9IHRhYmxlcy5vcGNvZGVzOwogICAgICAgIHRoaXMub3JkZXIgPSB0YWJsZXMub3JkZXI7CiAgICAgICAgdGhpcy5zdHJpbmdzID0gc3RyaW5nczsKICAgICAgICB0aGlzLnZhbHVlcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIH0KCiAgICAgIENGRkRpY3QucHJvdG90eXBlID0gewogICAgICAgIHNldEJ5S2V5OiBmdW5jdGlvbiBDRkZEaWN0X3NldEJ5S2V5KGtleSwgdmFsdWUpIHsKICAgICAgICAgIGlmICghKGtleSBpbiB0aGlzLmtleVRvTmFtZU1hcCkpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciB2YWx1ZUxlbmd0aCA9IHZhbHVlLmxlbmd0aDsKCiAgICAgICAgICBpZiAodmFsdWVMZW5ndGggPT09IDApIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2YWx1ZUxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChpc05hTih2YWx1ZVtpXSkpIHsKICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoJ0ludmFsaWQgQ0ZGRGljdCB2YWx1ZTogIicgKyB2YWx1ZSArICciIGZvciBrZXkgIicgKyBrZXkgKyAnIi4nKTsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHZhciB0eXBlID0gdGhpcy50eXBlc1trZXldOwoKICAgICAgICAgIGlmICh0eXBlID09PSAibnVtIiB8fCB0eXBlID09PSAic2lkIiB8fCB0eXBlID09PSAib2Zmc2V0IikgewogICAgICAgICAgICB2YWx1ZSA9IHZhbHVlWzBdOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMudmFsdWVzW2tleV0gPSB2YWx1ZTsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0sCiAgICAgICAgc2V0QnlOYW1lOiBmdW5jdGlvbiBDRkZEaWN0X3NldEJ5TmFtZShuYW1lLCB2YWx1ZSkgewogICAgICAgICAgaWYgKCEobmFtZSBpbiB0aGlzLm5hbWVUb0tleU1hcCkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJJbnZhbGlkIGRpY3Rpb25hcnkgbmFtZSBcIiIuY29uY2F0KG5hbWUsICJcIiIpKTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnZhbHVlc1t0aGlzLm5hbWVUb0tleU1hcFtuYW1lXV0gPSB2YWx1ZTsKICAgICAgICB9LAogICAgICAgIGhhc05hbWU6IGZ1bmN0aW9uIENGRkRpY3RfaGFzTmFtZShuYW1lKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5uYW1lVG9LZXlNYXBbbmFtZV0gaW4gdGhpcy52YWx1ZXM7CiAgICAgICAgfSwKICAgICAgICBnZXRCeU5hbWU6IGZ1bmN0aW9uIENGRkRpY3RfZ2V0QnlOYW1lKG5hbWUpIHsKICAgICAgICAgIGlmICghKG5hbWUgaW4gdGhpcy5uYW1lVG9LZXlNYXApKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiSW52YWxpZCBkaWN0aW9uYXJ5IG5hbWUgIi5jb25jYXQobmFtZSwgIlwiIikpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBrZXkgPSB0aGlzLm5hbWVUb0tleU1hcFtuYW1lXTsKCiAgICAgICAgICBpZiAoIShrZXkgaW4gdGhpcy52YWx1ZXMpKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmRlZmF1bHRzW2tleV07CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHRoaXMudmFsdWVzW2tleV07CiAgICAgICAgfSwKICAgICAgICByZW1vdmVCeU5hbWU6IGZ1bmN0aW9uIENGRkRpY3RfcmVtb3ZlQnlOYW1lKG5hbWUpIHsKICAgICAgICAgIGRlbGV0ZSB0aGlzLnZhbHVlc1t0aGlzLm5hbWVUb0tleU1hcFtuYW1lXV07CiAgICAgICAgfQogICAgICB9OwoKICAgICAgQ0ZGRGljdC5jcmVhdGVUYWJsZXMgPSBmdW5jdGlvbiBDRkZEaWN0X2NyZWF0ZVRhYmxlcyhsYXlvdXQpIHsKICAgICAgICB2YXIgdGFibGVzID0gewogICAgICAgICAga2V5VG9OYW1lTWFwOiB7fSwKICAgICAgICAgIG5hbWVUb0tleU1hcDoge30sCiAgICAgICAgICBkZWZhdWx0czoge30sCiAgICAgICAgICB0eXBlczoge30sCiAgICAgICAgICBvcGNvZGVzOiB7fSwKICAgICAgICAgIG9yZGVyOiBbXQogICAgICAgIH07CgogICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGxheW91dC5sZW5ndGg7IGkgPCBpaTsgKytpKSB7CiAgICAgICAgICB2YXIgZW50cnkgPSBsYXlvdXRbaV07CiAgICAgICAgICB2YXIga2V5ID0gQXJyYXkuaXNBcnJheShlbnRyeVswXSkgPyAoZW50cnlbMF1bMF0gPDwgOCkgKyBlbnRyeVswXVsxXSA6IGVudHJ5WzBdOwogICAgICAgICAgdGFibGVzLmtleVRvTmFtZU1hcFtrZXldID0gZW50cnlbMV07CiAgICAgICAgICB0YWJsZXMubmFtZVRvS2V5TWFwW2VudHJ5WzFdXSA9IGtleTsKICAgICAgICAgIHRhYmxlcy50eXBlc1trZXldID0gZW50cnlbMl07CiAgICAgICAgICB0YWJsZXMuZGVmYXVsdHNba2V5XSA9IGVudHJ5WzNdOwogICAgICAgICAgdGFibGVzLm9wY29kZXNba2V5XSA9IEFycmF5LmlzQXJyYXkoZW50cnlbMF0pID8gZW50cnlbMF0gOiBbZW50cnlbMF1dOwogICAgICAgICAgdGFibGVzLm9yZGVyLnB1c2goa2V5KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0YWJsZXM7CiAgICAgIH07CgogICAgICByZXR1cm4gQ0ZGRGljdDsKICAgIH0oKTsKCiAgICB2YXIgQ0ZGVG9wRGljdCA9IGZ1bmN0aW9uIENGRlRvcERpY3RDbG9zdXJlKCkgewogICAgICB2YXIgbGF5b3V0ID0gW1tbMTIsIDMwXSwgIlJPUyIsIFsic2lkIiwgInNpZCIsICJudW0iXSwgbnVsbF0sIFtbMTIsIDIwXSwgIlN5bnRoZXRpY0Jhc2UiLCAibnVtIiwgbnVsbF0sIFswLCAidmVyc2lvbiIsICJzaWQiLCBudWxsXSwgWzEsICJOb3RpY2UiLCAic2lkIiwgbnVsbF0sIFtbMTIsIDBdLCAiQ29weXJpZ2h0IiwgInNpZCIsIG51bGxdLCBbMiwgIkZ1bGxOYW1lIiwgInNpZCIsIG51bGxdLCBbMywgIkZhbWlseU5hbWUiLCAic2lkIiwgbnVsbF0sIFs0LCAiV2VpZ2h0IiwgInNpZCIsIG51bGxdLCBbWzEyLCAxXSwgImlzRml4ZWRQaXRjaCIsICJudW0iLCAwXSwgW1sxMiwgMl0sICJJdGFsaWNBbmdsZSIsICJudW0iLCAwXSwgW1sxMiwgM10sICJVbmRlcmxpbmVQb3NpdGlvbiIsICJudW0iLCAtMTAwXSwgW1sxMiwgNF0sICJVbmRlcmxpbmVUaGlja25lc3MiLCAibnVtIiwgNTBdLCBbWzEyLCA1XSwgIlBhaW50VHlwZSIsICJudW0iLCAwXSwgW1sxMiwgNl0sICJDaGFyc3RyaW5nVHlwZSIsICJudW0iLCAyXSwgW1sxMiwgN10sICJGb250TWF0cml4IiwgWyJudW0iLCAibnVtIiwgIm51bSIsICJudW0iLCAibnVtIiwgIm51bSJdLCBbMC4wMDEsIDAsIDAsIDAuMDAxLCAwLCAwXV0sIFsxMywgIlVuaXF1ZUlEIiwgIm51bSIsIG51bGxdLCBbNSwgIkZvbnRCQm94IiwgWyJudW0iLCAibnVtIiwgIm51bSIsICJudW0iXSwgWzAsIDAsIDAsIDBdXSwgW1sxMiwgOF0sICJTdHJva2VXaWR0aCIsICJudW0iLCAwXSwgWzE0LCAiWFVJRCIsICJhcnJheSIsIG51bGxdLCBbMTUsICJjaGFyc2V0IiwgIm9mZnNldCIsIDBdLCBbMTYsICJFbmNvZGluZyIsICJvZmZzZXQiLCAwXSwgWzE3LCAiQ2hhclN0cmluZ3MiLCAib2Zmc2V0IiwgMF0sIFsxOCwgIlByaXZhdGUiLCBbIm9mZnNldCIsICJvZmZzZXQiXSwgbnVsbF0sIFtbMTIsIDIxXSwgIlBvc3RTY3JpcHQiLCAic2lkIiwgbnVsbF0sIFtbMTIsIDIyXSwgIkJhc2VGb250TmFtZSIsICJzaWQiLCBudWxsXSwgW1sxMiwgMjNdLCAiQmFzZUZvbnRCbGVuZCIsICJkZWx0YSIsIG51bGxdLCBbWzEyLCAzMV0sICJDSURGb250VmVyc2lvbiIsICJudW0iLCAwXSwgW1sxMiwgMzJdLCAiQ0lERm9udFJldmlzaW9uIiwgIm51bSIsIDBdLCBbWzEyLCAzM10sICJDSURGb250VHlwZSIsICJudW0iLCAwXSwgW1sxMiwgMzRdLCAiQ0lEQ291bnQiLCAibnVtIiwgODcyMF0sIFtbMTIsIDM1XSwgIlVJREJhc2UiLCAibnVtIiwgbnVsbF0sIFtbMTIsIDM3XSwgIkZEU2VsZWN0IiwgIm9mZnNldCIsIG51bGxdLCBbWzEyLCAzNl0sICJGREFycmF5IiwgIm9mZnNldCIsIG51bGxdLCBbWzEyLCAzOF0sICJGb250TmFtZSIsICJzaWQiLCBudWxsXV07CiAgICAgIHZhciB0YWJsZXMgPSBudWxsOwoKICAgICAgZnVuY3Rpb24gQ0ZGVG9wRGljdChzdHJpbmdzKSB7CiAgICAgICAgaWYgKHRhYmxlcyA9PT0gbnVsbCkgewogICAgICAgICAgdGFibGVzID0gQ0ZGRGljdC5jcmVhdGVUYWJsZXMobGF5b3V0KTsKICAgICAgICB9CgogICAgICAgIENGRkRpY3QuY2FsbCh0aGlzLCB0YWJsZXMsIHN0cmluZ3MpOwogICAgICAgIHRoaXMucHJpdmF0ZURpY3QgPSBudWxsOwogICAgICB9CgogICAgICBDRkZUb3BEaWN0LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoQ0ZGRGljdC5wcm90b3R5cGUpOwogICAgICByZXR1cm4gQ0ZGVG9wRGljdDsKICAgIH0oKTsKCiAgICBleHBvcnRzLkNGRlRvcERpY3QgPSBDRkZUb3BEaWN0OwoKICAgIHZhciBDRkZQcml2YXRlRGljdCA9IGZ1bmN0aW9uIENGRlByaXZhdGVEaWN0Q2xvc3VyZSgpIHsKICAgICAgdmFyIGxheW91dCA9IFtbNiwgIkJsdWVWYWx1ZXMiLCAiZGVsdGEiLCBudWxsXSwgWzcsICJPdGhlckJsdWVzIiwgImRlbHRhIiwgbnVsbF0sIFs4LCAiRmFtaWx5Qmx1ZXMiLCAiZGVsdGEiLCBudWxsXSwgWzksICJGYW1pbHlPdGhlckJsdWVzIiwgImRlbHRhIiwgbnVsbF0sIFtbMTIsIDldLCAiQmx1ZVNjYWxlIiwgIm51bSIsIDAuMDM5NjI1XSwgW1sxMiwgMTBdLCAiQmx1ZVNoaWZ0IiwgIm51bSIsIDddLCBbWzEyLCAxMV0sICJCbHVlRnV6eiIsICJudW0iLCAxXSwgWzEwLCAiU3RkSFciLCAibnVtIiwgbnVsbF0sIFsxMSwgIlN0ZFZXIiwgIm51bSIsIG51bGxdLCBbWzEyLCAxMl0sICJTdGVtU25hcEgiLCAiZGVsdGEiLCBudWxsXSwgW1sxMiwgMTNdLCAiU3RlbVNuYXBWIiwgImRlbHRhIiwgbnVsbF0sIFtbMTIsIDE0XSwgIkZvcmNlQm9sZCIsICJudW0iLCAwXSwgW1sxMiwgMTddLCAiTGFuZ3VhZ2VHcm91cCIsICJudW0iLCAwXSwgW1sxMiwgMThdLCAiRXhwYW5zaW9uRmFjdG9yIiwgIm51bSIsIDAuMDZdLCBbWzEyLCAxOV0sICJpbml0aWFsUmFuZG9tU2VlZCIsICJudW0iLCAwXSwgWzIwLCAiZGVmYXVsdFdpZHRoWCIsICJudW0iLCAwXSwgWzIxLCAibm9taW5hbFdpZHRoWCIsICJudW0iLCAwXSwgWzE5LCAiU3VicnMiLCAib2Zmc2V0IiwgbnVsbF1dOwogICAgICB2YXIgdGFibGVzID0gbnVsbDsKCiAgICAgIGZ1bmN0aW9uIENGRlByaXZhdGVEaWN0KHN0cmluZ3MpIHsKICAgICAgICBpZiAodGFibGVzID09PSBudWxsKSB7CiAgICAgICAgICB0YWJsZXMgPSBDRkZEaWN0LmNyZWF0ZVRhYmxlcyhsYXlvdXQpOwogICAgICAgIH0KCiAgICAgICAgQ0ZGRGljdC5jYWxsKHRoaXMsIHRhYmxlcywgc3RyaW5ncyk7CiAgICAgICAgdGhpcy5zdWJyc0luZGV4ID0gbnVsbDsKICAgICAgfQoKICAgICAgQ0ZGUHJpdmF0ZURpY3QucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShDRkZEaWN0LnByb3RvdHlwZSk7CiAgICAgIHJldHVybiBDRkZQcml2YXRlRGljdDsKICAgIH0oKTsKCiAgICBleHBvcnRzLkNGRlByaXZhdGVEaWN0ID0gQ0ZGUHJpdmF0ZURpY3Q7CiAgICB2YXIgQ0ZGQ2hhcnNldFByZWRlZmluZWRUeXBlcyA9IHsKICAgICAgSVNPX0FET0JFOiAwLAogICAgICBFWFBFUlQ6IDEsCiAgICAgIEVYUEVSVF9TVUJTRVQ6IDIKICAgIH07CgogICAgdmFyIENGRkNoYXJzZXQgPSBmdW5jdGlvbiBDRkZDaGFyc2V0Q2xvc3VyZSgpIHsKICAgICAgZnVuY3Rpb24gQ0ZGQ2hhcnNldChwcmVkZWZpbmVkLCBmb3JtYXQsIGNoYXJzZXQsIHJhdykgewogICAgICAgIHRoaXMucHJlZGVmaW5lZCA9IHByZWRlZmluZWQ7CiAgICAgICAgdGhpcy5mb3JtYXQgPSBmb3JtYXQ7CiAgICAgICAgdGhpcy5jaGFyc2V0ID0gY2hhcnNldDsKICAgICAgICB0aGlzLnJhdyA9IHJhdzsKICAgICAgfQoKICAgICAgcmV0dXJuIENGRkNoYXJzZXQ7CiAgICB9KCk7CgogICAgZXhwb3J0cy5DRkZDaGFyc2V0ID0gQ0ZGQ2hhcnNldDsKCiAgICB2YXIgQ0ZGRW5jb2RpbmcgPSBmdW5jdGlvbiBDRkZFbmNvZGluZ0Nsb3N1cmUoKSB7CiAgICAgIGZ1bmN0aW9uIENGRkVuY29kaW5nKHByZWRlZmluZWQsIGZvcm1hdCwgZW5jb2RpbmcsIHJhdykgewogICAgICAgIHRoaXMucHJlZGVmaW5lZCA9IHByZWRlZmluZWQ7CiAgICAgICAgdGhpcy5mb3JtYXQgPSBmb3JtYXQ7CiAgICAgICAgdGhpcy5lbmNvZGluZyA9IGVuY29kaW5nOwogICAgICAgIHRoaXMucmF3ID0gcmF3OwogICAgICB9CgogICAgICByZXR1cm4gQ0ZGRW5jb2Rpbmc7CiAgICB9KCk7CgogICAgdmFyIENGRkZEU2VsZWN0ID0gZnVuY3Rpb24gQ0ZGRkRTZWxlY3RDbG9zdXJlKCkgewogICAgICBmdW5jdGlvbiBDRkZGRFNlbGVjdChmb3JtYXQsIGZkU2VsZWN0KSB7CiAgICAgICAgdGhpcy5mb3JtYXQgPSBmb3JtYXQ7CiAgICAgICAgdGhpcy5mZFNlbGVjdCA9IGZkU2VsZWN0OwogICAgICB9CgogICAgICBDRkZGRFNlbGVjdC5wcm90b3R5cGUgPSB7CiAgICAgICAgZ2V0RkRJbmRleDogZnVuY3Rpb24gQ0ZGRkRTZWxlY3RfZ2V0KGdseXBoSW5kZXgpIHsKICAgICAgICAgIGlmIChnbHlwaEluZGV4IDwgMCB8fCBnbHlwaEluZGV4ID49IHRoaXMuZmRTZWxlY3QubGVuZ3RoKSB7CiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gdGhpcy5mZFNlbGVjdFtnbHlwaEluZGV4XTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHJldHVybiBDRkZGRFNlbGVjdDsKICAgIH0oKTsKCiAgICBleHBvcnRzLkNGRkZEU2VsZWN0ID0gQ0ZGRkRTZWxlY3Q7CgogICAgdmFyIENGRk9mZnNldFRyYWNrZXIgPSBmdW5jdGlvbiBDRkZPZmZzZXRUcmFja2VyQ2xvc3VyZSgpIHsKICAgICAgZnVuY3Rpb24gQ0ZGT2Zmc2V0VHJhY2tlcigpIHsKICAgICAgICB0aGlzLm9mZnNldHMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICB9CgogICAgICBDRkZPZmZzZXRUcmFja2VyLnByb3RvdHlwZSA9IHsKICAgICAgICBpc1RyYWNraW5nOiBmdW5jdGlvbiBDRkZPZmZzZXRUcmFja2VyX2lzVHJhY2tpbmcoa2V5KSB7CiAgICAgICAgICByZXR1cm4ga2V5IGluIHRoaXMub2Zmc2V0czsKICAgICAgICB9LAogICAgICAgIHRyYWNrOiBmdW5jdGlvbiBDRkZPZmZzZXRUcmFja2VyX3RyYWNrKGtleSwgbG9jYXRpb24pIHsKICAgICAgICAgIGlmIChrZXkgaW4gdGhpcy5vZmZzZXRzKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiQWxyZWFkeSB0cmFja2luZyBsb2NhdGlvbiBvZiAiLmNvbmNhdChrZXkpKTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLm9mZnNldHNba2V5XSA9IGxvY2F0aW9uOwogICAgICAgIH0sCiAgICAgICAgb2Zmc2V0OiBmdW5jdGlvbiBDRkZPZmZzZXRUcmFja2VyX29mZnNldCh2YWx1ZSkgewogICAgICAgICAgZm9yICh2YXIga2V5IGluIHRoaXMub2Zmc2V0cykgewogICAgICAgICAgICB0aGlzLm9mZnNldHNba2V5XSArPSB2YWx1ZTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHNldEVudHJ5TG9jYXRpb246IGZ1bmN0aW9uIENGRk9mZnNldFRyYWNrZXJfc2V0RW50cnlMb2NhdGlvbihrZXksIHZhbHVlcywgb3V0cHV0KSB7CiAgICAgICAgICBpZiAoIShrZXkgaW4gdGhpcy5vZmZzZXRzKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIk5vdCB0cmFja2luZyBsb2NhdGlvbiBvZiAiLmNvbmNhdChrZXkpKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZGF0YSA9IG91dHB1dC5kYXRhOwogICAgICAgICAgdmFyIGRhdGFPZmZzZXQgPSB0aGlzLm9mZnNldHNba2V5XTsKICAgICAgICAgIHZhciBzaXplID0gNTsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSB2YWx1ZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkgewogICAgICAgICAgICB2YXIgb2Zmc2V0MCA9IGkgKiBzaXplICsgZGF0YU9mZnNldDsKICAgICAgICAgICAgdmFyIG9mZnNldDEgPSBvZmZzZXQwICsgMTsKICAgICAgICAgICAgdmFyIG9mZnNldDIgPSBvZmZzZXQwICsgMjsKICAgICAgICAgICAgdmFyIG9mZnNldDMgPSBvZmZzZXQwICsgMzsKICAgICAgICAgICAgdmFyIG9mZnNldDQgPSBvZmZzZXQwICsgNDsKCiAgICAgICAgICAgIGlmIChkYXRhW29mZnNldDBdICE9PSAweDFkIHx8IGRhdGFbb2Zmc2V0MV0gIT09IDAgfHwgZGF0YVtvZmZzZXQyXSAhPT0gMCB8fCBkYXRhW29mZnNldDNdICE9PSAwIHx8IGRhdGFbb2Zmc2V0NF0gIT09IDApIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIndyaXRpbmcgdG8gYW4gb2Zmc2V0IHRoYXQgaXMgbm90IGVtcHR5Iik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciB2YWx1ZSA9IHZhbHVlc1tpXTsKICAgICAgICAgICAgZGF0YVtvZmZzZXQwXSA9IDB4MWQ7CiAgICAgICAgICAgIGRhdGFbb2Zmc2V0MV0gPSB2YWx1ZSA+PiAyNCAmIDB4ZmY7CiAgICAgICAgICAgIGRhdGFbb2Zmc2V0Ml0gPSB2YWx1ZSA+PiAxNiAmIDB4ZmY7CiAgICAgICAgICAgIGRhdGFbb2Zmc2V0M10gPSB2YWx1ZSA+PiA4ICYgMHhmZjsKICAgICAgICAgICAgZGF0YVtvZmZzZXQ0XSA9IHZhbHVlICYgMHhmZjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07CiAgICAgIHJldHVybiBDRkZPZmZzZXRUcmFja2VyOwogICAgfSgpOwoKICAgIHZhciBDRkZDb21waWxlciA9IGZ1bmN0aW9uIENGRkNvbXBpbGVyQ2xvc3VyZSgpIHsKICAgICAgZnVuY3Rpb24gQ0ZGQ29tcGlsZXIoY2ZmKSB7CiAgICAgICAgdGhpcy5jZmYgPSBjZmY7CiAgICAgIH0KCiAgICAgIENGRkNvbXBpbGVyLnByb3RvdHlwZSA9IHsKICAgICAgICBjb21waWxlOiBmdW5jdGlvbiBDRkZDb21waWxlcl9jb21waWxlKCkgewogICAgICAgICAgdmFyIGNmZiA9IHRoaXMuY2ZmOwogICAgICAgICAgdmFyIG91dHB1dCA9IHsKICAgICAgICAgICAgZGF0YTogW10sCiAgICAgICAgICAgIGxlbmd0aDogMCwKICAgICAgICAgICAgYWRkOiBmdW5jdGlvbiBDRkZDb21waWxlcl9hZGQoZGF0YSkgewogICAgICAgICAgICAgIHRoaXMuZGF0YSA9IHRoaXMuZGF0YS5jb25jYXQoZGF0YSk7CiAgICAgICAgICAgICAgdGhpcy5sZW5ndGggPSB0aGlzLmRhdGEubGVuZ3RoOwogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgICAgdmFyIGhlYWRlciA9IHRoaXMuY29tcGlsZUhlYWRlcihjZmYuaGVhZGVyKTsKICAgICAgICAgIG91dHB1dC5hZGQoaGVhZGVyKTsKICAgICAgICAgIHZhciBuYW1lSW5kZXggPSB0aGlzLmNvbXBpbGVOYW1lSW5kZXgoY2ZmLm5hbWVzKTsKICAgICAgICAgIG91dHB1dC5hZGQobmFtZUluZGV4KTsKCiAgICAgICAgICBpZiAoY2ZmLmlzQ0lERm9udCkgewogICAgICAgICAgICBpZiAoY2ZmLnRvcERpY3QuaGFzTmFtZSgiRm9udE1hdHJpeCIpKSB7CiAgICAgICAgICAgICAgdmFyIGJhc2UgPSBjZmYudG9wRGljdC5nZXRCeU5hbWUoIkZvbnRNYXRyaXgiKTsKICAgICAgICAgICAgICBjZmYudG9wRGljdC5yZW1vdmVCeU5hbWUoIkZvbnRNYXRyaXgiKTsKCiAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gY2ZmLmZkQXJyYXkubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICAgICAgdmFyIHN1YkRpY3QgPSBjZmYuZmRBcnJheVtpXTsKICAgICAgICAgICAgICAgIHZhciBtYXRyaXggPSBiYXNlLnNsaWNlKDApOwoKICAgICAgICAgICAgICAgIGlmIChzdWJEaWN0Lmhhc05hbWUoIkZvbnRNYXRyaXgiKSkgewogICAgICAgICAgICAgICAgICBtYXRyaXggPSBfdXRpbC5VdGlsLnRyYW5zZm9ybShtYXRyaXgsIHN1YkRpY3QuZ2V0QnlOYW1lKCJGb250TWF0cml4IikpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHN1YkRpY3Quc2V0QnlOYW1lKCJGb250TWF0cml4IiwgbWF0cml4KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBjZmYudG9wRGljdC5zZXRCeU5hbWUoImNoYXJzZXQiLCAwKTsKICAgICAgICAgIHZhciBjb21waWxlZCA9IHRoaXMuY29tcGlsZVRvcERpY3RzKFtjZmYudG9wRGljdF0sIG91dHB1dC5sZW5ndGgsIGNmZi5pc0NJREZvbnQpOwogICAgICAgICAgb3V0cHV0LmFkZChjb21waWxlZC5vdXRwdXQpOwogICAgICAgICAgdmFyIHRvcERpY3RUcmFja2VyID0gY29tcGlsZWQudHJhY2tlcnNbMF07CiAgICAgICAgICB2YXIgc3RyaW5nSW5kZXggPSB0aGlzLmNvbXBpbGVTdHJpbmdJbmRleChjZmYuc3RyaW5ncy5zdHJpbmdzKTsKICAgICAgICAgIG91dHB1dC5hZGQoc3RyaW5nSW5kZXgpOwogICAgICAgICAgdmFyIGdsb2JhbFN1YnJJbmRleCA9IHRoaXMuY29tcGlsZUluZGV4KGNmZi5nbG9iYWxTdWJySW5kZXgpOwogICAgICAgICAgb3V0cHV0LmFkZChnbG9iYWxTdWJySW5kZXgpOwoKICAgICAgICAgIGlmIChjZmYuZW5jb2RpbmcgJiYgY2ZmLnRvcERpY3QuaGFzTmFtZSgiRW5jb2RpbmciKSkgewogICAgICAgICAgICBpZiAoY2ZmLmVuY29kaW5nLnByZWRlZmluZWQpIHsKICAgICAgICAgICAgICB0b3BEaWN0VHJhY2tlci5zZXRFbnRyeUxvY2F0aW9uKCJFbmNvZGluZyIsIFtjZmYuZW5jb2RpbmcuZm9ybWF0XSwgb3V0cHV0KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB2YXIgZW5jb2RpbmcgPSB0aGlzLmNvbXBpbGVFbmNvZGluZyhjZmYuZW5jb2RpbmcpOwogICAgICAgICAgICAgIHRvcERpY3RUcmFja2VyLnNldEVudHJ5TG9jYXRpb24oIkVuY29kaW5nIiwgW291dHB1dC5sZW5ndGhdLCBvdXRwdXQpOwogICAgICAgICAgICAgIG91dHB1dC5hZGQoZW5jb2RpbmcpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGNoYXJzZXQgPSB0aGlzLmNvbXBpbGVDaGFyc2V0KGNmZi5jaGFyc2V0LCBjZmYuY2hhclN0cmluZ3MuY291bnQsIGNmZi5zdHJpbmdzLCBjZmYuaXNDSURGb250KTsKICAgICAgICAgIHRvcERpY3RUcmFja2VyLnNldEVudHJ5TG9jYXRpb24oImNoYXJzZXQiLCBbb3V0cHV0Lmxlbmd0aF0sIG91dHB1dCk7CiAgICAgICAgICBvdXRwdXQuYWRkKGNoYXJzZXQpOwogICAgICAgICAgdmFyIGNoYXJTdHJpbmdzID0gdGhpcy5jb21waWxlQ2hhclN0cmluZ3MoY2ZmLmNoYXJTdHJpbmdzKTsKICAgICAgICAgIHRvcERpY3RUcmFja2VyLnNldEVudHJ5TG9jYXRpb24oIkNoYXJTdHJpbmdzIiwgW291dHB1dC5sZW5ndGhdLCBvdXRwdXQpOwogICAgICAgICAgb3V0cHV0LmFkZChjaGFyU3RyaW5ncyk7CgogICAgICAgICAgaWYgKGNmZi5pc0NJREZvbnQpIHsKICAgICAgICAgICAgdG9wRGljdFRyYWNrZXIuc2V0RW50cnlMb2NhdGlvbigiRkRTZWxlY3QiLCBbb3V0cHV0Lmxlbmd0aF0sIG91dHB1dCk7CiAgICAgICAgICAgIHZhciBmZFNlbGVjdCA9IHRoaXMuY29tcGlsZUZEU2VsZWN0KGNmZi5mZFNlbGVjdCk7CiAgICAgICAgICAgIG91dHB1dC5hZGQoZmRTZWxlY3QpOwogICAgICAgICAgICBjb21waWxlZCA9IHRoaXMuY29tcGlsZVRvcERpY3RzKGNmZi5mZEFycmF5LCBvdXRwdXQubGVuZ3RoLCB0cnVlKTsKICAgICAgICAgICAgdG9wRGljdFRyYWNrZXIuc2V0RW50cnlMb2NhdGlvbigiRkRBcnJheSIsIFtvdXRwdXQubGVuZ3RoXSwgb3V0cHV0KTsKICAgICAgICAgICAgb3V0cHV0LmFkZChjb21waWxlZC5vdXRwdXQpOwogICAgICAgICAgICB2YXIgZm9udERpY3RUcmFja2VycyA9IGNvbXBpbGVkLnRyYWNrZXJzOwogICAgICAgICAgICB0aGlzLmNvbXBpbGVQcml2YXRlRGljdHMoY2ZmLmZkQXJyYXksIGZvbnREaWN0VHJhY2tlcnMsIG91dHB1dCk7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5jb21waWxlUHJpdmF0ZURpY3RzKFtjZmYudG9wRGljdF0sIFt0b3BEaWN0VHJhY2tlcl0sIG91dHB1dCk7CiAgICAgICAgICBvdXRwdXQuYWRkKFswXSk7CiAgICAgICAgICByZXR1cm4gb3V0cHV0LmRhdGE7CiAgICAgICAgfSwKICAgICAgICBlbmNvZGVOdW1iZXI6IGZ1bmN0aW9uIENGRkNvbXBpbGVyX2VuY29kZU51bWJlcih2YWx1ZSkgewogICAgICAgICAgaWYgKHBhcnNlRmxvYXQodmFsdWUpID09PSBwYXJzZUludCh2YWx1ZSwgMTApICYmICFpc05hTih2YWx1ZSkpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZW5jb2RlSW50ZWdlcih2YWx1ZSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHRoaXMuZW5jb2RlRmxvYXQodmFsdWUpOwogICAgICAgIH0sCiAgICAgICAgZW5jb2RlRmxvYXQ6IGZ1bmN0aW9uIENGRkNvbXBpbGVyX2VuY29kZUZsb2F0KG51bSkgewogICAgICAgICAgdmFyIHZhbHVlID0gbnVtLnRvU3RyaW5nKCk7CiAgICAgICAgICB2YXIgbSA9IC9cLihcZCo/KSg/Ojl7NSwyMH18MHs1LDIwfSlcZHswLDJ9KD86ZSguKyl8JCkvLmV4ZWModmFsdWUpOwoKICAgICAgICAgIGlmIChtKSB7CiAgICAgICAgICAgIHZhciBlcHNpbG9uID0gcGFyc2VGbG9hdCgiMWUiICsgKChtWzJdID8gK21bMl0gOiAwKSArIG1bMV0ubGVuZ3RoKSk7CiAgICAgICAgICAgIHZhbHVlID0gKE1hdGgucm91bmQobnVtICogZXBzaWxvbikgLyBlcHNpbG9uKS50b1N0cmluZygpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBuaWJibGVzID0gIiI7CiAgICAgICAgICB2YXIgaSwgaWk7CgogICAgICAgICAgZm9yIChpID0gMCwgaWkgPSB2YWx1ZS5sZW5ndGg7IGkgPCBpaTsgKytpKSB7CiAgICAgICAgICAgIHZhciBhID0gdmFsdWVbaV07CgogICAgICAgICAgICBpZiAoYSA9PT0gImUiKSB7CiAgICAgICAgICAgICAgbmliYmxlcyArPSB2YWx1ZVsrK2ldID09PSAiLSIgPyAiYyIgOiAiYiI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYSA9PT0gIi4iKSB7CiAgICAgICAgICAgICAgbmliYmxlcyArPSAiYSI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYSA9PT0gIi0iKSB7CiAgICAgICAgICAgICAgbmliYmxlcyArPSAiZSI7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbmliYmxlcyArPSBhOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgbmliYmxlcyArPSBuaWJibGVzLmxlbmd0aCAmIDEgPyAiZiIgOiAiZmYiOwogICAgICAgICAgdmFyIG91dCA9IFszMF07CgogICAgICAgICAgZm9yIChpID0gMCwgaWkgPSBuaWJibGVzLmxlbmd0aDsgaSA8IGlpOyBpICs9IDIpIHsKICAgICAgICAgICAgb3V0LnB1c2gocGFyc2VJbnQobmliYmxlcy5zdWJzdHJpbmcoaSwgaSArIDIpLCAxNikpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBvdXQ7CiAgICAgICAgfSwKICAgICAgICBlbmNvZGVJbnRlZ2VyOiBmdW5jdGlvbiBDRkZDb21waWxlcl9lbmNvZGVJbnRlZ2VyKHZhbHVlKSB7CiAgICAgICAgICB2YXIgY29kZTsKCiAgICAgICAgICBpZiAodmFsdWUgPj0gLTEwNyAmJiB2YWx1ZSA8PSAxMDcpIHsKICAgICAgICAgICAgY29kZSA9IFt2YWx1ZSArIDEzOV07CiAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID49IDEwOCAmJiB2YWx1ZSA8PSAxMTMxKSB7CiAgICAgICAgICAgIHZhbHVlID0gdmFsdWUgLSAxMDg7CiAgICAgICAgICAgIGNvZGUgPSBbKHZhbHVlID4+IDgpICsgMjQ3LCB2YWx1ZSAmIDB4ZmZdOwogICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA+PSAtMTEzMSAmJiB2YWx1ZSA8PSAtMTA4KSB7CiAgICAgICAgICAgIHZhbHVlID0gLXZhbHVlIC0gMTA4OwogICAgICAgICAgICBjb2RlID0gWyh2YWx1ZSA+PiA4KSArIDI1MSwgdmFsdWUgJiAweGZmXTsKICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPj0gLTMyNzY4ICYmIHZhbHVlIDw9IDMyNzY3KSB7CiAgICAgICAgICAgIGNvZGUgPSBbMHgxYywgdmFsdWUgPj4gOCAmIDB4ZmYsIHZhbHVlICYgMHhmZl07CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb2RlID0gWzB4MWQsIHZhbHVlID4+IDI0ICYgMHhmZiwgdmFsdWUgPj4gMTYgJiAweGZmLCB2YWx1ZSA+PiA4ICYgMHhmZiwgdmFsdWUgJiAweGZmXTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gY29kZTsKICAgICAgICB9LAogICAgICAgIGNvbXBpbGVIZWFkZXI6IGZ1bmN0aW9uIENGRkNvbXBpbGVyX2NvbXBpbGVIZWFkZXIoaGVhZGVyKSB7CiAgICAgICAgICByZXR1cm4gW2hlYWRlci5tYWpvciwgaGVhZGVyLm1pbm9yLCBoZWFkZXIuaGRyU2l6ZSwgaGVhZGVyLm9mZlNpemVdOwogICAgICAgIH0sCiAgICAgICAgY29tcGlsZU5hbWVJbmRleDogZnVuY3Rpb24gQ0ZGQ29tcGlsZXJfY29tcGlsZU5hbWVJbmRleChuYW1lcykgewogICAgICAgICAgdmFyIG5hbWVJbmRleCA9IG5ldyBDRkZJbmRleCgpOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IG5hbWVzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHsKICAgICAgICAgICAgdmFyIG5hbWUgPSBuYW1lc1tpXTsKICAgICAgICAgICAgdmFyIGxlbmd0aCA9IE1hdGgubWluKG5hbWUubGVuZ3RoLCAxMjcpOwogICAgICAgICAgICB2YXIgc2FuaXRpemVkTmFtZSA9IG5ldyBBcnJheShsZW5ndGgpOwoKICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBsZW5ndGg7IGorKykgewogICAgICAgICAgICAgIHZhciBfY2hhciA9IG5hbWVbal07CgogICAgICAgICAgICAgIGlmIChfY2hhciA8ICIhIiB8fCBfY2hhciA+ICJ+IiB8fCBfY2hhciA9PT0gIlsiIHx8IF9jaGFyID09PSAiXSIgfHwgX2NoYXIgPT09ICIoIiB8fCBfY2hhciA9PT0gIikiIHx8IF9jaGFyID09PSAieyIgfHwgX2NoYXIgPT09ICJ9IiB8fCBfY2hhciA9PT0gIjwiIHx8IF9jaGFyID09PSAiPiIgfHwgX2NoYXIgPT09ICIvIiB8fCBfY2hhciA9PT0gIiUiKSB7CiAgICAgICAgICAgICAgICBfY2hhciA9ICJfIjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHNhbml0aXplZE5hbWVbal0gPSBfY2hhcjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc2FuaXRpemVkTmFtZSA9IHNhbml0aXplZE5hbWUuam9pbigiIik7CgogICAgICAgICAgICBpZiAoc2FuaXRpemVkTmFtZSA9PT0gIiIpIHsKICAgICAgICAgICAgICBzYW5pdGl6ZWROYW1lID0gIkJhZF9Gb250X05hbWUiOwogICAgICAgICAgICB9CgogICAgICAgICAgICBuYW1lSW5kZXguYWRkKCgwLCBfdXRpbC5zdHJpbmdUb0J5dGVzKShzYW5pdGl6ZWROYW1lKSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHRoaXMuY29tcGlsZUluZGV4KG5hbWVJbmRleCk7CiAgICAgICAgfSwKICAgICAgICBjb21waWxlVG9wRGljdHM6IGZ1bmN0aW9uIENGRkNvbXBpbGVyX2NvbXBpbGVUb3BEaWN0cyhkaWN0cywgbGVuZ3RoLCByZW1vdmVDaWRLZXlzKSB7CiAgICAgICAgICB2YXIgZm9udERpY3RUcmFja2VycyA9IFtdOwogICAgICAgICAgdmFyIGZkQXJyYXlJbmRleCA9IG5ldyBDRkZJbmRleCgpOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGRpY3RzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHsKICAgICAgICAgICAgdmFyIGZvbnREaWN0ID0gZGljdHNbaV07CgogICAgICAgICAgICBpZiAocmVtb3ZlQ2lkS2V5cykgewogICAgICAgICAgICAgIGZvbnREaWN0LnJlbW92ZUJ5TmFtZSgiQ0lERm9udFZlcnNpb24iKTsKICAgICAgICAgICAgICBmb250RGljdC5yZW1vdmVCeU5hbWUoIkNJREZvbnRSZXZpc2lvbiIpOwogICAgICAgICAgICAgIGZvbnREaWN0LnJlbW92ZUJ5TmFtZSgiQ0lERm9udFR5cGUiKTsKICAgICAgICAgICAgICBmb250RGljdC5yZW1vdmVCeU5hbWUoIkNJRENvdW50Iik7CiAgICAgICAgICAgICAgZm9udERpY3QucmVtb3ZlQnlOYW1lKCJVSURCYXNlIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBmb250RGljdFRyYWNrZXIgPSBuZXcgQ0ZGT2Zmc2V0VHJhY2tlcigpOwogICAgICAgICAgICB2YXIgZm9udERpY3REYXRhID0gdGhpcy5jb21waWxlRGljdChmb250RGljdCwgZm9udERpY3RUcmFja2VyKTsKICAgICAgICAgICAgZm9udERpY3RUcmFja2Vycy5wdXNoKGZvbnREaWN0VHJhY2tlcik7CiAgICAgICAgICAgIGZkQXJyYXlJbmRleC5hZGQoZm9udERpY3REYXRhKTsKICAgICAgICAgICAgZm9udERpY3RUcmFja2VyLm9mZnNldChsZW5ndGgpOwogICAgICAgICAgfQoKICAgICAgICAgIGZkQXJyYXlJbmRleCA9IHRoaXMuY29tcGlsZUluZGV4KGZkQXJyYXlJbmRleCwgZm9udERpY3RUcmFja2Vycyk7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICB0cmFja2VyczogZm9udERpY3RUcmFja2VycywKICAgICAgICAgICAgb3V0cHV0OiBmZEFycmF5SW5kZXgKICAgICAgICAgIH07CiAgICAgICAgfSwKICAgICAgICBjb21waWxlUHJpdmF0ZURpY3RzOiBmdW5jdGlvbiBDRkZDb21waWxlcl9jb21waWxlUHJpdmF0ZURpY3RzKGRpY3RzLCB0cmFja2Vycywgb3V0cHV0KSB7CiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBkaWN0cy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7CiAgICAgICAgICAgIHZhciBmb250RGljdCA9IGRpY3RzW2ldOwogICAgICAgICAgICB2YXIgcHJpdmF0ZURpY3QgPSBmb250RGljdC5wcml2YXRlRGljdDsKCiAgICAgICAgICAgIGlmICghcHJpdmF0ZURpY3QgfHwgIWZvbnREaWN0Lmhhc05hbWUoIlByaXZhdGUiKSkgewogICAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiVGhlcmUgbXVzdCBiZSBhIHByaXZhdGUgZGljdGlvbmFyeS4iKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHByaXZhdGVEaWN0VHJhY2tlciA9IG5ldyBDRkZPZmZzZXRUcmFja2VyKCk7CiAgICAgICAgICAgIHZhciBwcml2YXRlRGljdERhdGEgPSB0aGlzLmNvbXBpbGVEaWN0KHByaXZhdGVEaWN0LCBwcml2YXRlRGljdFRyYWNrZXIpOwogICAgICAgICAgICB2YXIgb3V0cHV0TGVuZ3RoID0gb3V0cHV0Lmxlbmd0aDsKICAgICAgICAgICAgcHJpdmF0ZURpY3RUcmFja2VyLm9mZnNldChvdXRwdXRMZW5ndGgpOwoKICAgICAgICAgICAgaWYgKCFwcml2YXRlRGljdERhdGEubGVuZ3RoKSB7CiAgICAgICAgICAgICAgb3V0cHV0TGVuZ3RoID0gMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdHJhY2tlcnNbaV0uc2V0RW50cnlMb2NhdGlvbigiUHJpdmF0ZSIsIFtwcml2YXRlRGljdERhdGEubGVuZ3RoLCBvdXRwdXRMZW5ndGhdLCBvdXRwdXQpOwogICAgICAgICAgICBvdXRwdXQuYWRkKHByaXZhdGVEaWN0RGF0YSk7CgogICAgICAgICAgICBpZiAocHJpdmF0ZURpY3Quc3VicnNJbmRleCAmJiBwcml2YXRlRGljdC5oYXNOYW1lKCJTdWJycyIpKSB7CiAgICAgICAgICAgICAgdmFyIHN1YnJzID0gdGhpcy5jb21waWxlSW5kZXgocHJpdmF0ZURpY3Quc3VicnNJbmRleCk7CiAgICAgICAgICAgICAgcHJpdmF0ZURpY3RUcmFja2VyLnNldEVudHJ5TG9jYXRpb24oIlN1YnJzIiwgW3ByaXZhdGVEaWN0RGF0YS5sZW5ndGhdLCBvdXRwdXQpOwogICAgICAgICAgICAgIG91dHB1dC5hZGQoc3VicnMpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBjb21waWxlRGljdDogZnVuY3Rpb24gQ0ZGQ29tcGlsZXJfY29tcGlsZURpY3QoZGljdCwgb2Zmc2V0VHJhY2tlcikgewogICAgICAgICAgdmFyIG91dCA9IFtdOwogICAgICAgICAgdmFyIG9yZGVyID0gZGljdC5vcmRlcjsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9yZGVyLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgIHZhciBrZXkgPSBvcmRlcltpXTsKCiAgICAgICAgICAgIGlmICghKGtleSBpbiBkaWN0LnZhbHVlcykpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHZhbHVlcyA9IGRpY3QudmFsdWVzW2tleV07CiAgICAgICAgICAgIHZhciB0eXBlcyA9IGRpY3QudHlwZXNba2V5XTsKCiAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheSh0eXBlcykpIHsKICAgICAgICAgICAgICB0eXBlcyA9IFt0eXBlc107CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheSh2YWx1ZXMpKSB7CiAgICAgICAgICAgICAgdmFsdWVzID0gW3ZhbHVlc107CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh2YWx1ZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvciAodmFyIGogPSAwLCBqaiA9IHR5cGVzLmxlbmd0aDsgaiA8IGpqOyArK2opIHsKICAgICAgICAgICAgICB2YXIgdHlwZSA9IHR5cGVzW2pdOwogICAgICAgICAgICAgIHZhciB2YWx1ZSA9IHZhbHVlc1tqXTsKCiAgICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlICJudW0iOgogICAgICAgICAgICAgICAgY2FzZSAic2lkIjoKICAgICAgICAgICAgICAgICAgb3V0ID0gb3V0LmNvbmNhdCh0aGlzLmVuY29kZU51bWJlcih2YWx1ZSkpOwogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlICJvZmZzZXQiOgogICAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IGRpY3Qua2V5VG9OYW1lTWFwW2tleV07CgogICAgICAgICAgICAgICAgICBpZiAoIW9mZnNldFRyYWNrZXIuaXNUcmFja2luZyhuYW1lKSkgewogICAgICAgICAgICAgICAgICAgIG9mZnNldFRyYWNrZXIudHJhY2sobmFtZSwgb3V0Lmxlbmd0aCk7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIG91dCA9IG91dC5jb25jYXQoWzB4MWQsIDAsIDAsIDAsIDBdKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSAiYXJyYXkiOgogICAgICAgICAgICAgICAgY2FzZSAiZGVsdGEiOgogICAgICAgICAgICAgICAgICBvdXQgPSBvdXQuY29uY2F0KHRoaXMuZW5jb2RlTnVtYmVyKHZhbHVlKSk7CgogICAgICAgICAgICAgICAgICBmb3IgKHZhciBrID0gMSwga2sgPSB2YWx1ZXMubGVuZ3RoOyBrIDwga2s7ICsraykgewogICAgICAgICAgICAgICAgICAgIG91dCA9IG91dC5jb25jYXQodGhpcy5lbmNvZGVOdW1iZXIodmFsdWVzW2tdKSk7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiVW5rbm93biBkYXRhIHR5cGUgb2YgIi5jb25jYXQodHlwZSkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgb3V0ID0gb3V0LmNvbmNhdChkaWN0Lm9wY29kZXNba2V5XSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIG91dDsKICAgICAgICB9LAogICAgICAgIGNvbXBpbGVTdHJpbmdJbmRleDogZnVuY3Rpb24gQ0ZGQ29tcGlsZXJfY29tcGlsZVN0cmluZ0luZGV4KHN0cmluZ3MpIHsKICAgICAgICAgIHZhciBzdHJpbmdJbmRleCA9IG5ldyBDRkZJbmRleCgpOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IHN0cmluZ3MubGVuZ3RoOyBpIDwgaWk7ICsraSkgewogICAgICAgICAgICBzdHJpbmdJbmRleC5hZGQoKDAsIF91dGlsLnN0cmluZ1RvQnl0ZXMpKHN0cmluZ3NbaV0pKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gdGhpcy5jb21waWxlSW5kZXgoc3RyaW5nSW5kZXgpOwogICAgICAgIH0sCiAgICAgICAgY29tcGlsZUdsb2JhbFN1YnJJbmRleDogZnVuY3Rpb24gQ0ZGQ29tcGlsZXJfY29tcGlsZUdsb2JhbFN1YnJJbmRleCgpIHsKICAgICAgICAgIHZhciBnbG9iYWxTdWJySW5kZXggPSB0aGlzLmNmZi5nbG9iYWxTdWJySW5kZXg7CiAgICAgICAgICB0aGlzLm91dC53cml0ZUJ5dGVBcnJheSh0aGlzLmNvbXBpbGVJbmRleChnbG9iYWxTdWJySW5kZXgpKTsKICAgICAgICB9LAogICAgICAgIGNvbXBpbGVDaGFyU3RyaW5nczogZnVuY3Rpb24gQ0ZGQ29tcGlsZXJfY29tcGlsZUNoYXJTdHJpbmdzKGNoYXJTdHJpbmdzKSB7CiAgICAgICAgICB2YXIgY2hhclN0cmluZ3NJbmRleCA9IG5ldyBDRkZJbmRleCgpOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hhclN0cmluZ3MuY291bnQ7IGkrKykgewogICAgICAgICAgICB2YXIgZ2x5cGggPSBjaGFyU3RyaW5ncy5nZXQoaSk7CgogICAgICAgICAgICBpZiAoZ2x5cGgubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgY2hhclN0cmluZ3NJbmRleC5hZGQobmV3IFVpbnQ4QXJyYXkoWzB4OGIsIDB4MGVdKSk7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNoYXJTdHJpbmdzSW5kZXguYWRkKGdseXBoKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gdGhpcy5jb21waWxlSW5kZXgoY2hhclN0cmluZ3NJbmRleCk7CiAgICAgICAgfSwKICAgICAgICBjb21waWxlQ2hhcnNldDogZnVuY3Rpb24gQ0ZGQ29tcGlsZXJfY29tcGlsZUNoYXJzZXQoY2hhcnNldCwgbnVtR2x5cGhzLCBzdHJpbmdzLCBpc0NJREZvbnQpIHsKICAgICAgICAgIHZhciBvdXQ7CiAgICAgICAgICB2YXIgbnVtR2x5cGhzTGVzc05vdERlZiA9IG51bUdseXBocyAtIDE7CgogICAgICAgICAgaWYgKGlzQ0lERm9udCkgewogICAgICAgICAgICBvdXQgPSBuZXcgVWludDhBcnJheShbMiwgMCwgMCwgbnVtR2x5cGhzTGVzc05vdERlZiA+PiA4ICYgMHhmZiwgbnVtR2x5cGhzTGVzc05vdERlZiAmIDB4ZmZdKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciBsZW5ndGggPSAxICsgbnVtR2x5cGhzTGVzc05vdERlZiAqIDI7CiAgICAgICAgICAgIG91dCA9IG5ldyBVaW50OEFycmF5KGxlbmd0aCk7CiAgICAgICAgICAgIG91dFswXSA9IDA7CiAgICAgICAgICAgIHZhciBjaGFyc2V0SW5kZXggPSAwOwogICAgICAgICAgICB2YXIgbnVtQ2hhcnNldHMgPSBjaGFyc2V0LmNoYXJzZXQubGVuZ3RoOwogICAgICAgICAgICB2YXIgd2FybmVkID0gZmFsc2U7CgogICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IG91dC5sZW5ndGg7IGkgKz0gMikgewogICAgICAgICAgICAgIHZhciBzaWQgPSAwOwoKICAgICAgICAgICAgICBpZiAoY2hhcnNldEluZGV4IDwgbnVtQ2hhcnNldHMpIHsKICAgICAgICAgICAgICAgIHZhciBuYW1lID0gY2hhcnNldC5jaGFyc2V0W2NoYXJzZXRJbmRleCsrXTsKICAgICAgICAgICAgICAgIHNpZCA9IHN0cmluZ3MuZ2V0U0lEKG5hbWUpOwoKICAgICAgICAgICAgICAgIGlmIChzaWQgPT09IC0xKSB7CiAgICAgICAgICAgICAgICAgIHNpZCA9IDA7CgogICAgICAgICAgICAgICAgICBpZiAoIXdhcm5lZCkgewogICAgICAgICAgICAgICAgICAgIHdhcm5lZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJDb3VsZG4ndCBmaW5kICIuY29uY2F0KG5hbWUsICIgaW4gQ0ZGIHN0cmluZ3MiKSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIG91dFtpXSA9IHNpZCA+PiA4ICYgMHhmZjsKICAgICAgICAgICAgICBvdXRbaSArIDFdID0gc2lkICYgMHhmZjsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB0aGlzLmNvbXBpbGVUeXBlZEFycmF5KG91dCk7CiAgICAgICAgfSwKICAgICAgICBjb21waWxlRW5jb2Rpbmc6IGZ1bmN0aW9uIENGRkNvbXBpbGVyX2NvbXBpbGVFbmNvZGluZyhlbmNvZGluZykgewogICAgICAgICAgcmV0dXJuIHRoaXMuY29tcGlsZVR5cGVkQXJyYXkoZW5jb2RpbmcucmF3KTsKICAgICAgICB9LAogICAgICAgIGNvbXBpbGVGRFNlbGVjdDogZnVuY3Rpb24gQ0ZGQ29tcGlsZXJfY29tcGlsZUZEU2VsZWN0KGZkU2VsZWN0KSB7CiAgICAgICAgICB2YXIgZm9ybWF0ID0gZmRTZWxlY3QuZm9ybWF0OwogICAgICAgICAgdmFyIG91dCwgaTsKCiAgICAgICAgICBzd2l0Y2ggKGZvcm1hdCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgb3V0ID0gbmV3IFVpbnQ4QXJyYXkoMSArIGZkU2VsZWN0LmZkU2VsZWN0Lmxlbmd0aCk7CiAgICAgICAgICAgICAgb3V0WzBdID0gZm9ybWF0OwoKICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZmRTZWxlY3QuZmRTZWxlY3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIG91dFtpICsgMV0gPSBmZFNlbGVjdC5mZFNlbGVjdFtpXTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgIHZhciBzdGFydCA9IDA7CiAgICAgICAgICAgICAgdmFyIGxhc3RGRCA9IGZkU2VsZWN0LmZkU2VsZWN0WzBdOwogICAgICAgICAgICAgIHZhciByYW5nZXMgPSBbZm9ybWF0LCAwLCAwLCBzdGFydCA+PiA4ICYgMHhmZiwgc3RhcnQgJiAweGZmLCBsYXN0RkRdOwoKICAgICAgICAgICAgICBmb3IgKGkgPSAxOyBpIDwgZmRTZWxlY3QuZmRTZWxlY3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHZhciBjdXJyZW50RkQgPSBmZFNlbGVjdC5mZFNlbGVjdFtpXTsKCiAgICAgICAgICAgICAgICBpZiAoY3VycmVudEZEICE9PSBsYXN0RkQpIHsKICAgICAgICAgICAgICAgICAgcmFuZ2VzLnB1c2goaSA+PiA4ICYgMHhmZiwgaSAmIDB4ZmYsIGN1cnJlbnRGRCk7CiAgICAgICAgICAgICAgICAgIGxhc3RGRCA9IGN1cnJlbnRGRDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBudW1SYW5nZXMgPSAocmFuZ2VzLmxlbmd0aCAtIDMpIC8gMzsKICAgICAgICAgICAgICByYW5nZXNbMV0gPSBudW1SYW5nZXMgPj4gOCAmIDB4ZmY7CiAgICAgICAgICAgICAgcmFuZ2VzWzJdID0gbnVtUmFuZ2VzICYgMHhmZjsKICAgICAgICAgICAgICByYW5nZXMucHVzaChpID4+IDggJiAweGZmLCBpICYgMHhmZik7CiAgICAgICAgICAgICAgb3V0ID0gbmV3IFVpbnQ4QXJyYXkocmFuZ2VzKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gdGhpcy5jb21waWxlVHlwZWRBcnJheShvdXQpOwogICAgICAgIH0sCiAgICAgICAgY29tcGlsZVR5cGVkQXJyYXk6IGZ1bmN0aW9uIENGRkNvbXBpbGVyX2NvbXBpbGVUeXBlZEFycmF5KGRhdGEpIHsKICAgICAgICAgIHZhciBvdXQgPSBbXTsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBkYXRhLmxlbmd0aDsgaSA8IGlpOyArK2kpIHsKICAgICAgICAgICAgb3V0W2ldID0gZGF0YVtpXTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gb3V0OwogICAgICAgIH0sCiAgICAgICAgY29tcGlsZUluZGV4OiBmdW5jdGlvbiBDRkZDb21waWxlcl9jb21waWxlSW5kZXgoaW5kZXgsIHRyYWNrZXJzKSB7CiAgICAgICAgICB0cmFja2VycyA9IHRyYWNrZXJzIHx8IFtdOwogICAgICAgICAgdmFyIG9iamVjdHMgPSBpbmRleC5vYmplY3RzOwogICAgICAgICAgdmFyIGNvdW50ID0gb2JqZWN0cy5sZW5ndGg7CgogICAgICAgICAgaWYgKGNvdW50ID09PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBbMCwgMCwgMF07CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGRhdGEgPSBbY291bnQgPj4gOCAmIDB4ZmYsIGNvdW50ICYgMHhmZl07CiAgICAgICAgICB2YXIgbGFzdE9mZnNldCA9IDEsCiAgICAgICAgICAgIGk7CgogICAgICAgICAgZm9yIChpID0gMDsgaSA8IGNvdW50OyArK2kpIHsKICAgICAgICAgICAgbGFzdE9mZnNldCArPSBvYmplY3RzW2ldLmxlbmd0aDsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgb2Zmc2V0U2l6ZTsKCiAgICAgICAgICBpZiAobGFzdE9mZnNldCA8IDB4MTAwKSB7CiAgICAgICAgICAgIG9mZnNldFNpemUgPSAxOwogICAgICAgICAgfSBlbHNlIGlmIChsYXN0T2Zmc2V0IDwgMHgxMDAwMCkgewogICAgICAgICAgICBvZmZzZXRTaXplID0gMjsKICAgICAgICAgIH0gZWxzZSBpZiAobGFzdE9mZnNldCA8IDB4MTAwMDAwMCkgewogICAgICAgICAgICBvZmZzZXRTaXplID0gMzsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG9mZnNldFNpemUgPSA0OwogICAgICAgICAgfQoKICAgICAgICAgIGRhdGEucHVzaChvZmZzZXRTaXplKTsKICAgICAgICAgIHZhciByZWxhdGl2ZU9mZnNldCA9IDE7CgogICAgICAgICAgZm9yIChpID0gMDsgaSA8IGNvdW50ICsgMTsgaSsrKSB7CiAgICAgICAgICAgIGlmIChvZmZzZXRTaXplID09PSAxKSB7CiAgICAgICAgICAgICAgZGF0YS5wdXNoKHJlbGF0aXZlT2Zmc2V0ICYgMHhmZik7CiAgICAgICAgICAgIH0gZWxzZSBpZiAob2Zmc2V0U2l6ZSA9PT0gMikgewogICAgICAgICAgICAgIGRhdGEucHVzaChyZWxhdGl2ZU9mZnNldCA+PiA4ICYgMHhmZiwgcmVsYXRpdmVPZmZzZXQgJiAweGZmKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChvZmZzZXRTaXplID09PSAzKSB7CiAgICAgICAgICAgICAgZGF0YS5wdXNoKHJlbGF0aXZlT2Zmc2V0ID4+IDE2ICYgMHhmZiwgcmVsYXRpdmVPZmZzZXQgPj4gOCAmIDB4ZmYsIHJlbGF0aXZlT2Zmc2V0ICYgMHhmZik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZGF0YS5wdXNoKHJlbGF0aXZlT2Zmc2V0ID4+PiAyNCAmIDB4ZmYsIHJlbGF0aXZlT2Zmc2V0ID4+IDE2ICYgMHhmZiwgcmVsYXRpdmVPZmZzZXQgPj4gOCAmIDB4ZmYsIHJlbGF0aXZlT2Zmc2V0ICYgMHhmZik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChvYmplY3RzW2ldKSB7CiAgICAgICAgICAgICAgcmVsYXRpdmVPZmZzZXQgKz0gb2JqZWN0c1tpXS5sZW5ndGg7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY291bnQ7IGkrKykgewogICAgICAgICAgICBpZiAodHJhY2tlcnNbaV0pIHsKICAgICAgICAgICAgICB0cmFja2Vyc1tpXS5vZmZzZXQoZGF0YS5sZW5ndGgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmb3IgKHZhciBqID0gMCwgamogPSBvYmplY3RzW2ldLmxlbmd0aDsgaiA8IGpqOyBqKyspIHsKICAgICAgICAgICAgICBkYXRhLnB1c2gob2JqZWN0c1tpXVtqXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gZGF0YTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHJldHVybiBDRkZDb21waWxlcjsKICAgIH0oKTsKCiAgICBleHBvcnRzLkNGRkNvbXBpbGVyID0gQ0ZGQ29tcGlsZXI7CgogICAgLyoqKi99KSwgKAogIC8qIDIxOSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCgogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICB2YWx1ZTogdHJ1ZQogICAgfSk7CiAgICBleHBvcnRzLkV4cGVydFN1YnNldENoYXJzZXQgPSBleHBvcnRzLkV4cGVydENoYXJzZXQgPSBleHBvcnRzLklTT0Fkb2JlQ2hhcnNldCA9IHZvaWQgMDsKICAgIHZhciBJU09BZG9iZUNoYXJzZXQgPSBbIi5ub3RkZWYiLCAic3BhY2UiLCAiZXhjbGFtIiwgInF1b3RlZGJsIiwgIm51bWJlcnNpZ24iLCAiZG9sbGFyIiwgInBlcmNlbnQiLCAiYW1wZXJzYW5kIiwgInF1b3RlcmlnaHQiLCAicGFyZW5sZWZ0IiwgInBhcmVucmlnaHQiLCAiYXN0ZXJpc2siLCAicGx1cyIsICJjb21tYSIsICJoeXBoZW4iLCAicGVyaW9kIiwgInNsYXNoIiwgInplcm8iLCAib25lIiwgInR3byIsICJ0aHJlZSIsICJmb3VyIiwgImZpdmUiLCAic2l4IiwgInNldmVuIiwgImVpZ2h0IiwgIm5pbmUiLCAiY29sb24iLCAic2VtaWNvbG9uIiwgImxlc3MiLCAiZXF1YWwiLCAiZ3JlYXRlciIsICJxdWVzdGlvbiIsICJhdCIsICJBIiwgIkIiLCAiQyIsICJEIiwgIkUiLCAiRiIsICJHIiwgIkgiLCAiSSIsICJKIiwgIksiLCAiTCIsICJNIiwgIk4iLCAiTyIsICJQIiwgIlEiLCAiUiIsICJTIiwgIlQiLCAiVSIsICJWIiwgIlciLCAiWCIsICJZIiwgIloiLCAiYnJhY2tldGxlZnQiLCAiYmFja3NsYXNoIiwgImJyYWNrZXRyaWdodCIsICJhc2NpaWNpcmN1bSIsICJ1bmRlcnNjb3JlIiwgInF1b3RlbGVmdCIsICJhIiwgImIiLCAiYyIsICJkIiwgImUiLCAiZiIsICJnIiwgImgiLCAiaSIsICJqIiwgImsiLCAibCIsICJtIiwgIm4iLCAibyIsICJwIiwgInEiLCAiciIsICJzIiwgInQiLCAidSIsICJ2IiwgInciLCAieCIsICJ5IiwgInoiLCAiYnJhY2VsZWZ0IiwgImJhciIsICJicmFjZXJpZ2h0IiwgImFzY2lpdGlsZGUiLCAiZXhjbGFtZG93biIsICJjZW50IiwgInN0ZXJsaW5nIiwgImZyYWN0aW9uIiwgInllbiIsICJmbG9yaW4iLCAic2VjdGlvbiIsICJjdXJyZW5jeSIsICJxdW90ZXNpbmdsZSIsICJxdW90ZWRibGxlZnQiLCAiZ3VpbGxlbW90bGVmdCIsICJndWlsc2luZ2xsZWZ0IiwgImd1aWxzaW5nbHJpZ2h0IiwgImZpIiwgImZsIiwgImVuZGFzaCIsICJkYWdnZXIiLCAiZGFnZ2VyZGJsIiwgInBlcmlvZGNlbnRlcmVkIiwgInBhcmFncmFwaCIsICJidWxsZXQiLCAicXVvdGVzaW5nbGJhc2UiLCAicXVvdGVkYmxiYXNlIiwgInF1b3RlZGJscmlnaHQiLCAiZ3VpbGxlbW90cmlnaHQiLCAiZWxsaXBzaXMiLCAicGVydGhvdXNhbmQiLCAicXVlc3Rpb25kb3duIiwgImdyYXZlIiwgImFjdXRlIiwgImNpcmN1bWZsZXgiLCAidGlsZGUiLCAibWFjcm9uIiwgImJyZXZlIiwgImRvdGFjY2VudCIsICJkaWVyZXNpcyIsICJyaW5nIiwgImNlZGlsbGEiLCAiaHVuZ2FydW1sYXV0IiwgIm9nb25layIsICJjYXJvbiIsICJlbWRhc2giLCAiQUUiLCAib3JkZmVtaW5pbmUiLCAiTHNsYXNoIiwgIk9zbGFzaCIsICJPRSIsICJvcmRtYXNjdWxpbmUiLCAiYWUiLCAiZG90bGVzc2kiLCAibHNsYXNoIiwgIm9zbGFzaCIsICJvZSIsICJnZXJtYW5kYmxzIiwgIm9uZXN1cGVyaW9yIiwgImxvZ2ljYWxub3QiLCAibXUiLCAidHJhZGVtYXJrIiwgIkV0aCIsICJvbmVoYWxmIiwgInBsdXNtaW51cyIsICJUaG9ybiIsICJvbmVxdWFydGVyIiwgImRpdmlkZSIsICJicm9rZW5iYXIiLCAiZGVncmVlIiwgInRob3JuIiwgInRocmVlcXVhcnRlcnMiLCAidHdvc3VwZXJpb3IiLCAicmVnaXN0ZXJlZCIsICJtaW51cyIsICJldGgiLCAibXVsdGlwbHkiLCAidGhyZWVzdXBlcmlvciIsICJjb3B5cmlnaHQiLCAiQWFjdXRlIiwgIkFjaXJjdW1mbGV4IiwgIkFkaWVyZXNpcyIsICJBZ3JhdmUiLCAiQXJpbmciLCAiQXRpbGRlIiwgIkNjZWRpbGxhIiwgIkVhY3V0ZSIsICJFY2lyY3VtZmxleCIsICJFZGllcmVzaXMiLCAiRWdyYXZlIiwgIklhY3V0ZSIsICJJY2lyY3VtZmxleCIsICJJZGllcmVzaXMiLCAiSWdyYXZlIiwgIk50aWxkZSIsICJPYWN1dGUiLCAiT2NpcmN1bWZsZXgiLCAiT2RpZXJlc2lzIiwgIk9ncmF2ZSIsICJPdGlsZGUiLCAiU2Nhcm9uIiwgIlVhY3V0ZSIsICJVY2lyY3VtZmxleCIsICJVZGllcmVzaXMiLCAiVWdyYXZlIiwgIllhY3V0ZSIsICJZZGllcmVzaXMiLCAiWmNhcm9uIiwgImFhY3V0ZSIsICJhY2lyY3VtZmxleCIsICJhZGllcmVzaXMiLCAiYWdyYXZlIiwgImFyaW5nIiwgImF0aWxkZSIsICJjY2VkaWxsYSIsICJlYWN1dGUiLCAiZWNpcmN1bWZsZXgiLCAiZWRpZXJlc2lzIiwgImVncmF2ZSIsICJpYWN1dGUiLCAiaWNpcmN1bWZsZXgiLCAiaWRpZXJlc2lzIiwgImlncmF2ZSIsICJudGlsZGUiLCAib2FjdXRlIiwgIm9jaXJjdW1mbGV4IiwgIm9kaWVyZXNpcyIsICJvZ3JhdmUiLCAib3RpbGRlIiwgInNjYXJvbiIsICJ1YWN1dGUiLCAidWNpcmN1bWZsZXgiLCAidWRpZXJlc2lzIiwgInVncmF2ZSIsICJ5YWN1dGUiLCAieWRpZXJlc2lzIiwgInpjYXJvbiJdOwogICAgZXhwb3J0cy5JU09BZG9iZUNoYXJzZXQgPSBJU09BZG9iZUNoYXJzZXQ7CiAgICB2YXIgRXhwZXJ0Q2hhcnNldCA9IFsiLm5vdGRlZiIsICJzcGFjZSIsICJleGNsYW1zbWFsbCIsICJIdW5nYXJ1bWxhdXRzbWFsbCIsICJkb2xsYXJvbGRzdHlsZSIsICJkb2xsYXJzdXBlcmlvciIsICJhbXBlcnNhbmRzbWFsbCIsICJBY3V0ZXNtYWxsIiwgInBhcmVubGVmdHN1cGVyaW9yIiwgInBhcmVucmlnaHRzdXBlcmlvciIsICJ0d29kb3RlbmxlYWRlciIsICJvbmVkb3RlbmxlYWRlciIsICJjb21tYSIsICJoeXBoZW4iLCAicGVyaW9kIiwgImZyYWN0aW9uIiwgInplcm9vbGRzdHlsZSIsICJvbmVvbGRzdHlsZSIsICJ0d29vbGRzdHlsZSIsICJ0aHJlZW9sZHN0eWxlIiwgImZvdXJvbGRzdHlsZSIsICJmaXZlb2xkc3R5bGUiLCAic2l4b2xkc3R5bGUiLCAic2V2ZW5vbGRzdHlsZSIsICJlaWdodG9sZHN0eWxlIiwgIm5pbmVvbGRzdHlsZSIsICJjb2xvbiIsICJzZW1pY29sb24iLCAiY29tbWFzdXBlcmlvciIsICJ0aHJlZXF1YXJ0ZXJzZW1kYXNoIiwgInBlcmlvZHN1cGVyaW9yIiwgInF1ZXN0aW9uc21hbGwiLCAiYXN1cGVyaW9yIiwgImJzdXBlcmlvciIsICJjZW50c3VwZXJpb3IiLCAiZHN1cGVyaW9yIiwgImVzdXBlcmlvciIsICJpc3VwZXJpb3IiLCAibHN1cGVyaW9yIiwgIm1zdXBlcmlvciIsICJuc3VwZXJpb3IiLCAib3N1cGVyaW9yIiwgInJzdXBlcmlvciIsICJzc3VwZXJpb3IiLCAidHN1cGVyaW9yIiwgImZmIiwgImZpIiwgImZsIiwgImZmaSIsICJmZmwiLCAicGFyZW5sZWZ0aW5mZXJpb3IiLCAicGFyZW5yaWdodGluZmVyaW9yIiwgIkNpcmN1bWZsZXhzbWFsbCIsICJoeXBoZW5zdXBlcmlvciIsICJHcmF2ZXNtYWxsIiwgIkFzbWFsbCIsICJCc21hbGwiLCAiQ3NtYWxsIiwgIkRzbWFsbCIsICJFc21hbGwiLCAiRnNtYWxsIiwgIkdzbWFsbCIsICJIc21hbGwiLCAiSXNtYWxsIiwgIkpzbWFsbCIsICJLc21hbGwiLCAiTHNtYWxsIiwgIk1zbWFsbCIsICJOc21hbGwiLCAiT3NtYWxsIiwgIlBzbWFsbCIsICJRc21hbGwiLCAiUnNtYWxsIiwgIlNzbWFsbCIsICJUc21hbGwiLCAiVXNtYWxsIiwgIlZzbWFsbCIsICJXc21hbGwiLCAiWHNtYWxsIiwgIllzbWFsbCIsICJac21hbGwiLCAiY29sb25tb25ldGFyeSIsICJvbmVmaXR0ZWQiLCAicnVwaWFoIiwgIlRpbGRlc21hbGwiLCAiZXhjbGFtZG93bnNtYWxsIiwgImNlbnRvbGRzdHlsZSIsICJMc2xhc2hzbWFsbCIsICJTY2Fyb25zbWFsbCIsICJaY2Fyb25zbWFsbCIsICJEaWVyZXNpc3NtYWxsIiwgIkJyZXZlc21hbGwiLCAiQ2Fyb25zbWFsbCIsICJEb3RhY2NlbnRzbWFsbCIsICJNYWNyb25zbWFsbCIsICJmaWd1cmVkYXNoIiwgImh5cGhlbmluZmVyaW9yIiwgIk9nb25la3NtYWxsIiwgIlJpbmdzbWFsbCIsICJDZWRpbGxhc21hbGwiLCAib25lcXVhcnRlciIsICJvbmVoYWxmIiwgInRocmVlcXVhcnRlcnMiLCAicXVlc3Rpb25kb3duc21hbGwiLCAib25lZWlnaHRoIiwgInRocmVlZWlnaHRocyIsICJmaXZlZWlnaHRocyIsICJzZXZlbmVpZ2h0aHMiLCAib25ldGhpcmQiLCAidHdvdGhpcmRzIiwgInplcm9zdXBlcmlvciIsICJvbmVzdXBlcmlvciIsICJ0d29zdXBlcmlvciIsICJ0aHJlZXN1cGVyaW9yIiwgImZvdXJzdXBlcmlvciIsICJmaXZlc3VwZXJpb3IiLCAic2l4c3VwZXJpb3IiLCAic2V2ZW5zdXBlcmlvciIsICJlaWdodHN1cGVyaW9yIiwgIm5pbmVzdXBlcmlvciIsICJ6ZXJvaW5mZXJpb3IiLCAib25laW5mZXJpb3IiLCAidHdvaW5mZXJpb3IiLCAidGhyZWVpbmZlcmlvciIsICJmb3VyaW5mZXJpb3IiLCAiZml2ZWluZmVyaW9yIiwgInNpeGluZmVyaW9yIiwgInNldmVuaW5mZXJpb3IiLCAiZWlnaHRpbmZlcmlvciIsICJuaW5laW5mZXJpb3IiLCAiY2VudGluZmVyaW9yIiwgImRvbGxhcmluZmVyaW9yIiwgInBlcmlvZGluZmVyaW9yIiwgImNvbW1haW5mZXJpb3IiLCAiQWdyYXZlc21hbGwiLCAiQWFjdXRlc21hbGwiLCAiQWNpcmN1bWZsZXhzbWFsbCIsICJBdGlsZGVzbWFsbCIsICJBZGllcmVzaXNzbWFsbCIsICJBcmluZ3NtYWxsIiwgIkFFc21hbGwiLCAiQ2NlZGlsbGFzbWFsbCIsICJFZ3JhdmVzbWFsbCIsICJFYWN1dGVzbWFsbCIsICJFY2lyY3VtZmxleHNtYWxsIiwgIkVkaWVyZXNpc3NtYWxsIiwgIklncmF2ZXNtYWxsIiwgIklhY3V0ZXNtYWxsIiwgIkljaXJjdW1mbGV4c21hbGwiLCAiSWRpZXJlc2lzc21hbGwiLCAiRXRoc21hbGwiLCAiTnRpbGRlc21hbGwiLCAiT2dyYXZlc21hbGwiLCAiT2FjdXRlc21hbGwiLCAiT2NpcmN1bWZsZXhzbWFsbCIsICJPdGlsZGVzbWFsbCIsICJPZGllcmVzaXNzbWFsbCIsICJPRXNtYWxsIiwgIk9zbGFzaHNtYWxsIiwgIlVncmF2ZXNtYWxsIiwgIlVhY3V0ZXNtYWxsIiwgIlVjaXJjdW1mbGV4c21hbGwiLCAiVWRpZXJlc2lzc21hbGwiLCAiWWFjdXRlc21hbGwiLCAiVGhvcm5zbWFsbCIsICJZZGllcmVzaXNzbWFsbCJdOwogICAgZXhwb3J0cy5FeHBlcnRDaGFyc2V0ID0gRXhwZXJ0Q2hhcnNldDsKICAgIHZhciBFeHBlcnRTdWJzZXRDaGFyc2V0ID0gWyIubm90ZGVmIiwgInNwYWNlIiwgImRvbGxhcm9sZHN0eWxlIiwgImRvbGxhcnN1cGVyaW9yIiwgInBhcmVubGVmdHN1cGVyaW9yIiwgInBhcmVucmlnaHRzdXBlcmlvciIsICJ0d29kb3RlbmxlYWRlciIsICJvbmVkb3RlbmxlYWRlciIsICJjb21tYSIsICJoeXBoZW4iLCAicGVyaW9kIiwgImZyYWN0aW9uIiwgInplcm9vbGRzdHlsZSIsICJvbmVvbGRzdHlsZSIsICJ0d29vbGRzdHlsZSIsICJ0aHJlZW9sZHN0eWxlIiwgImZvdXJvbGRzdHlsZSIsICJmaXZlb2xkc3R5bGUiLCAic2l4b2xkc3R5bGUiLCAic2V2ZW5vbGRzdHlsZSIsICJlaWdodG9sZHN0eWxlIiwgIm5pbmVvbGRzdHlsZSIsICJjb2xvbiIsICJzZW1pY29sb24iLCAiY29tbWFzdXBlcmlvciIsICJ0aHJlZXF1YXJ0ZXJzZW1kYXNoIiwgInBlcmlvZHN1cGVyaW9yIiwgImFzdXBlcmlvciIsICJic3VwZXJpb3IiLCAiY2VudHN1cGVyaW9yIiwgImRzdXBlcmlvciIsICJlc3VwZXJpb3IiLCAiaXN1cGVyaW9yIiwgImxzdXBlcmlvciIsICJtc3VwZXJpb3IiLCAibnN1cGVyaW9yIiwgIm9zdXBlcmlvciIsICJyc3VwZXJpb3IiLCAic3N1cGVyaW9yIiwgInRzdXBlcmlvciIsICJmZiIsICJmaSIsICJmbCIsICJmZmkiLCAiZmZsIiwgInBhcmVubGVmdGluZmVyaW9yIiwgInBhcmVucmlnaHRpbmZlcmlvciIsICJoeXBoZW5zdXBlcmlvciIsICJjb2xvbm1vbmV0YXJ5IiwgIm9uZWZpdHRlZCIsICJydXBpYWgiLCAiY2VudG9sZHN0eWxlIiwgImZpZ3VyZWRhc2giLCAiaHlwaGVuaW5mZXJpb3IiLCAib25lcXVhcnRlciIsICJvbmVoYWxmIiwgInRocmVlcXVhcnRlcnMiLCAib25lZWlnaHRoIiwgInRocmVlZWlnaHRocyIsICJmaXZlZWlnaHRocyIsICJzZXZlbmVpZ2h0aHMiLCAib25ldGhpcmQiLCAidHdvdGhpcmRzIiwgInplcm9zdXBlcmlvciIsICJvbmVzdXBlcmlvciIsICJ0d29zdXBlcmlvciIsICJ0aHJlZXN1cGVyaW9yIiwgImZvdXJzdXBlcmlvciIsICJmaXZlc3VwZXJpb3IiLCAic2l4c3VwZXJpb3IiLCAic2V2ZW5zdXBlcmlvciIsICJlaWdodHN1cGVyaW9yIiwgIm5pbmVzdXBlcmlvciIsICJ6ZXJvaW5mZXJpb3IiLCAib25laW5mZXJpb3IiLCAidHdvaW5mZXJpb3IiLCAidGhyZWVpbmZlcmlvciIsICJmb3VyaW5mZXJpb3IiLCAiZml2ZWluZmVyaW9yIiwgInNpeGluZmVyaW9yIiwgInNldmVuaW5mZXJpb3IiLCAiZWlnaHRpbmZlcmlvciIsICJuaW5laW5mZXJpb3IiLCAiY2VudGluZmVyaW9yIiwgImRvbGxhcmluZmVyaW9yIiwgInBlcmlvZGluZmVyaW9yIiwgImNvbW1haW5mZXJpb3IiXTsKICAgIGV4cG9ydHMuRXhwZXJ0U3Vic2V0Q2hhcnNldCA9IEV4cGVydFN1YnNldENoYXJzZXQ7CgogICAgLyoqKi99KSwgKAogIC8qIDIyMCAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCgogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICB2YWx1ZTogdHJ1ZQogICAgfSk7CiAgICBleHBvcnRzLmdldEVuY29kaW5nID0gZ2V0RW5jb2Rpbmc7CiAgICBleHBvcnRzLkV4cGVydEVuY29kaW5nID0gZXhwb3J0cy5aYXBmRGluZ2JhdHNFbmNvZGluZyA9IGV4cG9ydHMuU3ltYm9sU2V0RW5jb2RpbmcgPSBleHBvcnRzLk1hY1JvbWFuRW5jb2RpbmcgPSBleHBvcnRzLlN0YW5kYXJkRW5jb2RpbmcgPSBleHBvcnRzLldpbkFuc2lFbmNvZGluZyA9IHZvaWQgMDsKICAgIHZhciBFeHBlcnRFbmNvZGluZyA9IFsiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICJzcGFjZSIsICJleGNsYW1zbWFsbCIsICJIdW5nYXJ1bWxhdXRzbWFsbCIsICIiLCAiZG9sbGFyb2xkc3R5bGUiLCAiZG9sbGFyc3VwZXJpb3IiLCAiYW1wZXJzYW5kc21hbGwiLCAiQWN1dGVzbWFsbCIsICJwYXJlbmxlZnRzdXBlcmlvciIsICJwYXJlbnJpZ2h0c3VwZXJpb3IiLCAidHdvZG90ZW5sZWFkZXIiLCAib25lZG90ZW5sZWFkZXIiLCAiY29tbWEiLCAiaHlwaGVuIiwgInBlcmlvZCIsICJmcmFjdGlvbiIsICJ6ZXJvb2xkc3R5bGUiLCAib25lb2xkc3R5bGUiLCAidHdvb2xkc3R5bGUiLCAidGhyZWVvbGRzdHlsZSIsICJmb3Vyb2xkc3R5bGUiLCAiZml2ZW9sZHN0eWxlIiwgInNpeG9sZHN0eWxlIiwgInNldmVub2xkc3R5bGUiLCAiZWlnaHRvbGRzdHlsZSIsICJuaW5lb2xkc3R5bGUiLCAiY29sb24iLCAic2VtaWNvbG9uIiwgImNvbW1hc3VwZXJpb3IiLCAidGhyZWVxdWFydGVyc2VtZGFzaCIsICJwZXJpb2RzdXBlcmlvciIsICJxdWVzdGlvbnNtYWxsIiwgIiIsICJhc3VwZXJpb3IiLCAiYnN1cGVyaW9yIiwgImNlbnRzdXBlcmlvciIsICJkc3VwZXJpb3IiLCAiZXN1cGVyaW9yIiwgIiIsICIiLCAiIiwgImlzdXBlcmlvciIsICIiLCAiIiwgImxzdXBlcmlvciIsICJtc3VwZXJpb3IiLCAibnN1cGVyaW9yIiwgIm9zdXBlcmlvciIsICIiLCAiIiwgInJzdXBlcmlvciIsICJzc3VwZXJpb3IiLCAidHN1cGVyaW9yIiwgIiIsICJmZiIsICJmaSIsICJmbCIsICJmZmkiLCAiZmZsIiwgInBhcmVubGVmdGluZmVyaW9yIiwgIiIsICJwYXJlbnJpZ2h0aW5mZXJpb3IiLCAiQ2lyY3VtZmxleHNtYWxsIiwgImh5cGhlbnN1cGVyaW9yIiwgIkdyYXZlc21hbGwiLCAiQXNtYWxsIiwgIkJzbWFsbCIsICJDc21hbGwiLCAiRHNtYWxsIiwgIkVzbWFsbCIsICJGc21hbGwiLCAiR3NtYWxsIiwgIkhzbWFsbCIsICJJc21hbGwiLCAiSnNtYWxsIiwgIktzbWFsbCIsICJMc21hbGwiLCAiTXNtYWxsIiwgIk5zbWFsbCIsICJPc21hbGwiLCAiUHNtYWxsIiwgIlFzbWFsbCIsICJSc21hbGwiLCAiU3NtYWxsIiwgIlRzbWFsbCIsICJVc21hbGwiLCAiVnNtYWxsIiwgIldzbWFsbCIsICJYc21hbGwiLCAiWXNtYWxsIiwgIlpzbWFsbCIsICJjb2xvbm1vbmV0YXJ5IiwgIm9uZWZpdHRlZCIsICJydXBpYWgiLCAiVGlsZGVzbWFsbCIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiZXhjbGFtZG93bnNtYWxsIiwgImNlbnRvbGRzdHlsZSIsICJMc2xhc2hzbWFsbCIsICIiLCAiIiwgIlNjYXJvbnNtYWxsIiwgIlpjYXJvbnNtYWxsIiwgIkRpZXJlc2lzc21hbGwiLCAiQnJldmVzbWFsbCIsICJDYXJvbnNtYWxsIiwgIiIsICJEb3RhY2NlbnRzbWFsbCIsICIiLCAiIiwgIk1hY3JvbnNtYWxsIiwgIiIsICIiLCAiZmlndXJlZGFzaCIsICJoeXBoZW5pbmZlcmlvciIsICIiLCAiIiwgIk9nb25la3NtYWxsIiwgIlJpbmdzbWFsbCIsICJDZWRpbGxhc21hbGwiLCAiIiwgIiIsICIiLCAib25lcXVhcnRlciIsICJvbmVoYWxmIiwgInRocmVlcXVhcnRlcnMiLCAicXVlc3Rpb25kb3duc21hbGwiLCAib25lZWlnaHRoIiwgInRocmVlZWlnaHRocyIsICJmaXZlZWlnaHRocyIsICJzZXZlbmVpZ2h0aHMiLCAib25ldGhpcmQiLCAidHdvdGhpcmRzIiwgIiIsICIiLCAiemVyb3N1cGVyaW9yIiwgIm9uZXN1cGVyaW9yIiwgInR3b3N1cGVyaW9yIiwgInRocmVlc3VwZXJpb3IiLCAiZm91cnN1cGVyaW9yIiwgImZpdmVzdXBlcmlvciIsICJzaXhzdXBlcmlvciIsICJzZXZlbnN1cGVyaW9yIiwgImVpZ2h0c3VwZXJpb3IiLCAibmluZXN1cGVyaW9yIiwgInplcm9pbmZlcmlvciIsICJvbmVpbmZlcmlvciIsICJ0d29pbmZlcmlvciIsICJ0aHJlZWluZmVyaW9yIiwgImZvdXJpbmZlcmlvciIsICJmaXZlaW5mZXJpb3IiLCAic2l4aW5mZXJpb3IiLCAic2V2ZW5pbmZlcmlvciIsICJlaWdodGluZmVyaW9yIiwgIm5pbmVpbmZlcmlvciIsICJjZW50aW5mZXJpb3IiLCAiZG9sbGFyaW5mZXJpb3IiLCAicGVyaW9kaW5mZXJpb3IiLCAiY29tbWFpbmZlcmlvciIsICJBZ3JhdmVzbWFsbCIsICJBYWN1dGVzbWFsbCIsICJBY2lyY3VtZmxleHNtYWxsIiwgIkF0aWxkZXNtYWxsIiwgIkFkaWVyZXNpc3NtYWxsIiwgIkFyaW5nc21hbGwiLCAiQUVzbWFsbCIsICJDY2VkaWxsYXNtYWxsIiwgIkVncmF2ZXNtYWxsIiwgIkVhY3V0ZXNtYWxsIiwgIkVjaXJjdW1mbGV4c21hbGwiLCAiRWRpZXJlc2lzc21hbGwiLCAiSWdyYXZlc21hbGwiLCAiSWFjdXRlc21hbGwiLCAiSWNpcmN1bWZsZXhzbWFsbCIsICJJZGllcmVzaXNzbWFsbCIsICJFdGhzbWFsbCIsICJOdGlsZGVzbWFsbCIsICJPZ3JhdmVzbWFsbCIsICJPYWN1dGVzbWFsbCIsICJPY2lyY3VtZmxleHNtYWxsIiwgIk90aWxkZXNtYWxsIiwgIk9kaWVyZXNpc3NtYWxsIiwgIk9Fc21hbGwiLCAiT3NsYXNoc21hbGwiLCAiVWdyYXZlc21hbGwiLCAiVWFjdXRlc21hbGwiLCAiVWNpcmN1bWZsZXhzbWFsbCIsICJVZGllcmVzaXNzbWFsbCIsICJZYWN1dGVzbWFsbCIsICJUaG9ybnNtYWxsIiwgIllkaWVyZXNpc3NtYWxsIl07CiAgICBleHBvcnRzLkV4cGVydEVuY29kaW5nID0gRXhwZXJ0RW5jb2Rpbmc7CiAgICB2YXIgTWFjRXhwZXJ0RW5jb2RpbmcgPSBbIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAic3BhY2UiLCAiZXhjbGFtc21hbGwiLCAiSHVuZ2FydW1sYXV0c21hbGwiLCAiY2VudG9sZHN0eWxlIiwgImRvbGxhcm9sZHN0eWxlIiwgImRvbGxhcnN1cGVyaW9yIiwgImFtcGVyc2FuZHNtYWxsIiwgIkFjdXRlc21hbGwiLCAicGFyZW5sZWZ0c3VwZXJpb3IiLCAicGFyZW5yaWdodHN1cGVyaW9yIiwgInR3b2RvdGVubGVhZGVyIiwgIm9uZWRvdGVubGVhZGVyIiwgImNvbW1hIiwgImh5cGhlbiIsICJwZXJpb2QiLCAiZnJhY3Rpb24iLCAiemVyb29sZHN0eWxlIiwgIm9uZW9sZHN0eWxlIiwgInR3b29sZHN0eWxlIiwgInRocmVlb2xkc3R5bGUiLCAiZm91cm9sZHN0eWxlIiwgImZpdmVvbGRzdHlsZSIsICJzaXhvbGRzdHlsZSIsICJzZXZlbm9sZHN0eWxlIiwgImVpZ2h0b2xkc3R5bGUiLCAibmluZW9sZHN0eWxlIiwgImNvbG9uIiwgInNlbWljb2xvbiIsICIiLCAidGhyZWVxdWFydGVyc2VtZGFzaCIsICIiLCAicXVlc3Rpb25zbWFsbCIsICIiLCAiIiwgIiIsICIiLCAiRXRoc21hbGwiLCAiIiwgIiIsICJvbmVxdWFydGVyIiwgIm9uZWhhbGYiLCAidGhyZWVxdWFydGVycyIsICJvbmVlaWdodGgiLCAidGhyZWVlaWdodGhzIiwgImZpdmVlaWdodGhzIiwgInNldmVuZWlnaHRocyIsICJvbmV0aGlyZCIsICJ0d290aGlyZHMiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiZmYiLCAiZmkiLCAiZmwiLCAiZmZpIiwgImZmbCIsICJwYXJlbmxlZnRpbmZlcmlvciIsICIiLCAicGFyZW5yaWdodGluZmVyaW9yIiwgIkNpcmN1bWZsZXhzbWFsbCIsICJoeXBoZW5pbmZlcmlvciIsICJHcmF2ZXNtYWxsIiwgIkFzbWFsbCIsICJCc21hbGwiLCAiQ3NtYWxsIiwgIkRzbWFsbCIsICJFc21hbGwiLCAiRnNtYWxsIiwgIkdzbWFsbCIsICJIc21hbGwiLCAiSXNtYWxsIiwgIkpzbWFsbCIsICJLc21hbGwiLCAiTHNtYWxsIiwgIk1zbWFsbCIsICJOc21hbGwiLCAiT3NtYWxsIiwgIlBzbWFsbCIsICJRc21hbGwiLCAiUnNtYWxsIiwgIlNzbWFsbCIsICJUc21hbGwiLCAiVXNtYWxsIiwgIlZzbWFsbCIsICJXc21hbGwiLCAiWHNtYWxsIiwgIllzbWFsbCIsICJac21hbGwiLCAiY29sb25tb25ldGFyeSIsICJvbmVmaXR0ZWQiLCAicnVwaWFoIiwgIlRpbGRlc21hbGwiLCAiIiwgIiIsICJhc3VwZXJpb3IiLCAiY2VudHN1cGVyaW9yIiwgIiIsICIiLCAiIiwgIiIsICJBYWN1dGVzbWFsbCIsICJBZ3JhdmVzbWFsbCIsICJBY2lyY3VtZmxleHNtYWxsIiwgIkFkaWVyZXNpc3NtYWxsIiwgIkF0aWxkZXNtYWxsIiwgIkFyaW5nc21hbGwiLCAiQ2NlZGlsbGFzbWFsbCIsICJFYWN1dGVzbWFsbCIsICJFZ3JhdmVzbWFsbCIsICJFY2lyY3VtZmxleHNtYWxsIiwgIkVkaWVyZXNpc3NtYWxsIiwgIklhY3V0ZXNtYWxsIiwgIklncmF2ZXNtYWxsIiwgIkljaXJjdW1mbGV4c21hbGwiLCAiSWRpZXJlc2lzc21hbGwiLCAiTnRpbGRlc21hbGwiLCAiT2FjdXRlc21hbGwiLCAiT2dyYXZlc21hbGwiLCAiT2NpcmN1bWZsZXhzbWFsbCIsICJPZGllcmVzaXNzbWFsbCIsICJPdGlsZGVzbWFsbCIsICJVYWN1dGVzbWFsbCIsICJVZ3JhdmVzbWFsbCIsICJVY2lyY3VtZmxleHNtYWxsIiwgIlVkaWVyZXNpc3NtYWxsIiwgIiIsICJlaWdodHN1cGVyaW9yIiwgImZvdXJpbmZlcmlvciIsICJ0aHJlZWluZmVyaW9yIiwgInNpeGluZmVyaW9yIiwgImVpZ2h0aW5mZXJpb3IiLCAic2V2ZW5pbmZlcmlvciIsICJTY2Fyb25zbWFsbCIsICIiLCAiY2VudGluZmVyaW9yIiwgInR3b2luZmVyaW9yIiwgIiIsICJEaWVyZXNpc3NtYWxsIiwgIiIsICJDYXJvbnNtYWxsIiwgIm9zdXBlcmlvciIsICJmaXZlaW5mZXJpb3IiLCAiIiwgImNvbW1haW5mZXJpb3IiLCAicGVyaW9kaW5mZXJpb3IiLCAiWWFjdXRlc21hbGwiLCAiIiwgImRvbGxhcmluZmVyaW9yIiwgIiIsICIiLCAiVGhvcm5zbWFsbCIsICIiLCAibmluZWluZmVyaW9yIiwgInplcm9pbmZlcmlvciIsICJaY2Fyb25zbWFsbCIsICJBRXNtYWxsIiwgIk9zbGFzaHNtYWxsIiwgInF1ZXN0aW9uZG93bnNtYWxsIiwgIm9uZWluZmVyaW9yIiwgIkxzbGFzaHNtYWxsIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIkNlZGlsbGFzbWFsbCIsICIiLCAiIiwgIiIsICIiLCAiIiwgIk9Fc21hbGwiLCAiZmlndXJlZGFzaCIsICJoeXBoZW5zdXBlcmlvciIsICIiLCAiIiwgIiIsICIiLCAiZXhjbGFtZG93bnNtYWxsIiwgIiIsICJZZGllcmVzaXNzbWFsbCIsICIiLCAib25lc3VwZXJpb3IiLCAidHdvc3VwZXJpb3IiLCAidGhyZWVzdXBlcmlvciIsICJmb3Vyc3VwZXJpb3IiLCAiZml2ZXN1cGVyaW9yIiwgInNpeHN1cGVyaW9yIiwgInNldmVuc3VwZXJpb3IiLCAibmluZXN1cGVyaW9yIiwgInplcm9zdXBlcmlvciIsICIiLCAiZXN1cGVyaW9yIiwgInJzdXBlcmlvciIsICJ0c3VwZXJpb3IiLCAiIiwgIiIsICJpc3VwZXJpb3IiLCAic3N1cGVyaW9yIiwgImRzdXBlcmlvciIsICIiLCAiIiwgIiIsICIiLCAiIiwgImxzdXBlcmlvciIsICJPZ29uZWtzbWFsbCIsICJCcmV2ZXNtYWxsIiwgIk1hY3JvbnNtYWxsIiwgImJzdXBlcmlvciIsICJuc3VwZXJpb3IiLCAibXN1cGVyaW9yIiwgImNvbW1hc3VwZXJpb3IiLCAicGVyaW9kc3VwZXJpb3IiLCAiRG90YWNjZW50c21hbGwiLCAiUmluZ3NtYWxsIiwgIiIsICIiLCAiIiwgIiJdOwogICAgdmFyIE1hY1JvbWFuRW5jb2RpbmcgPSBbIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAic3BhY2UiLCAiZXhjbGFtIiwgInF1b3RlZGJsIiwgIm51bWJlcnNpZ24iLCAiZG9sbGFyIiwgInBlcmNlbnQiLCAiYW1wZXJzYW5kIiwgInF1b3Rlc2luZ2xlIiwgInBhcmVubGVmdCIsICJwYXJlbnJpZ2h0IiwgImFzdGVyaXNrIiwgInBsdXMiLCAiY29tbWEiLCAiaHlwaGVuIiwgInBlcmlvZCIsICJzbGFzaCIsICJ6ZXJvIiwgIm9uZSIsICJ0d28iLCAidGhyZWUiLCAiZm91ciIsICJmaXZlIiwgInNpeCIsICJzZXZlbiIsICJlaWdodCIsICJuaW5lIiwgImNvbG9uIiwgInNlbWljb2xvbiIsICJsZXNzIiwgImVxdWFsIiwgImdyZWF0ZXIiLCAicXVlc3Rpb24iLCAiYXQiLCAiQSIsICJCIiwgIkMiLCAiRCIsICJFIiwgIkYiLCAiRyIsICJIIiwgIkkiLCAiSiIsICJLIiwgIkwiLCAiTSIsICJOIiwgIk8iLCAiUCIsICJRIiwgIlIiLCAiUyIsICJUIiwgIlUiLCAiViIsICJXIiwgIlgiLCAiWSIsICJaIiwgImJyYWNrZXRsZWZ0IiwgImJhY2tzbGFzaCIsICJicmFja2V0cmlnaHQiLCAiYXNjaWljaXJjdW0iLCAidW5kZXJzY29yZSIsICJncmF2ZSIsICJhIiwgImIiLCAiYyIsICJkIiwgImUiLCAiZiIsICJnIiwgImgiLCAiaSIsICJqIiwgImsiLCAibCIsICJtIiwgIm4iLCAibyIsICJwIiwgInEiLCAiciIsICJzIiwgInQiLCAidSIsICJ2IiwgInciLCAieCIsICJ5IiwgInoiLCAiYnJhY2VsZWZ0IiwgImJhciIsICJicmFjZXJpZ2h0IiwgImFzY2lpdGlsZGUiLCAiIiwgIkFkaWVyZXNpcyIsICJBcmluZyIsICJDY2VkaWxsYSIsICJFYWN1dGUiLCAiTnRpbGRlIiwgIk9kaWVyZXNpcyIsICJVZGllcmVzaXMiLCAiYWFjdXRlIiwgImFncmF2ZSIsICJhY2lyY3VtZmxleCIsICJhZGllcmVzaXMiLCAiYXRpbGRlIiwgImFyaW5nIiwgImNjZWRpbGxhIiwgImVhY3V0ZSIsICJlZ3JhdmUiLCAiZWNpcmN1bWZsZXgiLCAiZWRpZXJlc2lzIiwgImlhY3V0ZSIsICJpZ3JhdmUiLCAiaWNpcmN1bWZsZXgiLCAiaWRpZXJlc2lzIiwgIm50aWxkZSIsICJvYWN1dGUiLCAib2dyYXZlIiwgIm9jaXJjdW1mbGV4IiwgIm9kaWVyZXNpcyIsICJvdGlsZGUiLCAidWFjdXRlIiwgInVncmF2ZSIsICJ1Y2lyY3VtZmxleCIsICJ1ZGllcmVzaXMiLCAiZGFnZ2VyIiwgImRlZ3JlZSIsICJjZW50IiwgInN0ZXJsaW5nIiwgInNlY3Rpb24iLCAiYnVsbGV0IiwgInBhcmFncmFwaCIsICJnZXJtYW5kYmxzIiwgInJlZ2lzdGVyZWQiLCAiY29weXJpZ2h0IiwgInRyYWRlbWFyayIsICJhY3V0ZSIsICJkaWVyZXNpcyIsICJub3RlcXVhbCIsICJBRSIsICJPc2xhc2giLCAiaW5maW5pdHkiLCAicGx1c21pbnVzIiwgImxlc3NlcXVhbCIsICJncmVhdGVyZXF1YWwiLCAieWVuIiwgIm11IiwgInBhcnRpYWxkaWZmIiwgInN1bW1hdGlvbiIsICJwcm9kdWN0IiwgInBpIiwgImludGVncmFsIiwgIm9yZGZlbWluaW5lIiwgIm9yZG1hc2N1bGluZSIsICJPbWVnYSIsICJhZSIsICJvc2xhc2giLCAicXVlc3Rpb25kb3duIiwgImV4Y2xhbWRvd24iLCAibG9naWNhbG5vdCIsICJyYWRpY2FsIiwgImZsb3JpbiIsICJhcHByb3hlcXVhbCIsICJEZWx0YSIsICJndWlsbGVtb3RsZWZ0IiwgImd1aWxsZW1vdHJpZ2h0IiwgImVsbGlwc2lzIiwgInNwYWNlIiwgIkFncmF2ZSIsICJBdGlsZGUiLCAiT3RpbGRlIiwgIk9FIiwgIm9lIiwgImVuZGFzaCIsICJlbWRhc2giLCAicXVvdGVkYmxsZWZ0IiwgInF1b3RlZGJscmlnaHQiLCAicXVvdGVsZWZ0IiwgInF1b3RlcmlnaHQiLCAiZGl2aWRlIiwgImxvemVuZ2UiLCAieWRpZXJlc2lzIiwgIllkaWVyZXNpcyIsICJmcmFjdGlvbiIsICJjdXJyZW5jeSIsICJndWlsc2luZ2xsZWZ0IiwgImd1aWxzaW5nbHJpZ2h0IiwgImZpIiwgImZsIiwgImRhZ2dlcmRibCIsICJwZXJpb2RjZW50ZXJlZCIsICJxdW90ZXNpbmdsYmFzZSIsICJxdW90ZWRibGJhc2UiLCAicGVydGhvdXNhbmQiLCAiQWNpcmN1bWZsZXgiLCAiRWNpcmN1bWZsZXgiLCAiQWFjdXRlIiwgIkVkaWVyZXNpcyIsICJFZ3JhdmUiLCAiSWFjdXRlIiwgIkljaXJjdW1mbGV4IiwgIklkaWVyZXNpcyIsICJJZ3JhdmUiLCAiT2FjdXRlIiwgIk9jaXJjdW1mbGV4IiwgImFwcGxlIiwgIk9ncmF2ZSIsICJVYWN1dGUiLCAiVWNpcmN1bWZsZXgiLCAiVWdyYXZlIiwgImRvdGxlc3NpIiwgImNpcmN1bWZsZXgiLCAidGlsZGUiLCAibWFjcm9uIiwgImJyZXZlIiwgImRvdGFjY2VudCIsICJyaW5nIiwgImNlZGlsbGEiLCAiaHVuZ2FydW1sYXV0IiwgIm9nb25layIsICJjYXJvbiJdOwogICAgZXhwb3J0cy5NYWNSb21hbkVuY29kaW5nID0gTWFjUm9tYW5FbmNvZGluZzsKICAgIHZhciBTdGFuZGFyZEVuY29kaW5nID0gWyIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgInNwYWNlIiwgImV4Y2xhbSIsICJxdW90ZWRibCIsICJudW1iZXJzaWduIiwgImRvbGxhciIsICJwZXJjZW50IiwgImFtcGVyc2FuZCIsICJxdW90ZXJpZ2h0IiwgInBhcmVubGVmdCIsICJwYXJlbnJpZ2h0IiwgImFzdGVyaXNrIiwgInBsdXMiLCAiY29tbWEiLCAiaHlwaGVuIiwgInBlcmlvZCIsICJzbGFzaCIsICJ6ZXJvIiwgIm9uZSIsICJ0d28iLCAidGhyZWUiLCAiZm91ciIsICJmaXZlIiwgInNpeCIsICJzZXZlbiIsICJlaWdodCIsICJuaW5lIiwgImNvbG9uIiwgInNlbWljb2xvbiIsICJsZXNzIiwgImVxdWFsIiwgImdyZWF0ZXIiLCAicXVlc3Rpb24iLCAiYXQiLCAiQSIsICJCIiwgIkMiLCAiRCIsICJFIiwgIkYiLCAiRyIsICJIIiwgIkkiLCAiSiIsICJLIiwgIkwiLCAiTSIsICJOIiwgIk8iLCAiUCIsICJRIiwgIlIiLCAiUyIsICJUIiwgIlUiLCAiViIsICJXIiwgIlgiLCAiWSIsICJaIiwgImJyYWNrZXRsZWZ0IiwgImJhY2tzbGFzaCIsICJicmFja2V0cmlnaHQiLCAiYXNjaWljaXJjdW0iLCAidW5kZXJzY29yZSIsICJxdW90ZWxlZnQiLCAiYSIsICJiIiwgImMiLCAiZCIsICJlIiwgImYiLCAiZyIsICJoIiwgImkiLCAiaiIsICJrIiwgImwiLCAibSIsICJuIiwgIm8iLCAicCIsICJxIiwgInIiLCAicyIsICJ0IiwgInUiLCAidiIsICJ3IiwgIngiLCAieSIsICJ6IiwgImJyYWNlbGVmdCIsICJiYXIiLCAiYnJhY2VyaWdodCIsICJhc2NpaXRpbGRlIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICJleGNsYW1kb3duIiwgImNlbnQiLCAic3RlcmxpbmciLCAiZnJhY3Rpb24iLCAieWVuIiwgImZsb3JpbiIsICJzZWN0aW9uIiwgImN1cnJlbmN5IiwgInF1b3Rlc2luZ2xlIiwgInF1b3RlZGJsbGVmdCIsICJndWlsbGVtb3RsZWZ0IiwgImd1aWxzaW5nbGxlZnQiLCAiZ3VpbHNpbmdscmlnaHQiLCAiZmkiLCAiZmwiLCAiIiwgImVuZGFzaCIsICJkYWdnZXIiLCAiZGFnZ2VyZGJsIiwgInBlcmlvZGNlbnRlcmVkIiwgIiIsICJwYXJhZ3JhcGgiLCAiYnVsbGV0IiwgInF1b3Rlc2luZ2xiYXNlIiwgInF1b3RlZGJsYmFzZSIsICJxdW90ZWRibHJpZ2h0IiwgImd1aWxsZW1vdHJpZ2h0IiwgImVsbGlwc2lzIiwgInBlcnRob3VzYW5kIiwgIiIsICJxdWVzdGlvbmRvd24iLCAiIiwgImdyYXZlIiwgImFjdXRlIiwgImNpcmN1bWZsZXgiLCAidGlsZGUiLCAibWFjcm9uIiwgImJyZXZlIiwgImRvdGFjY2VudCIsICJkaWVyZXNpcyIsICIiLCAicmluZyIsICJjZWRpbGxhIiwgIiIsICJodW5nYXJ1bWxhdXQiLCAib2dvbmVrIiwgImNhcm9uIiwgImVtZGFzaCIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiQUUiLCAiIiwgIm9yZGZlbWluaW5lIiwgIiIsICIiLCAiIiwgIiIsICJMc2xhc2giLCAiT3NsYXNoIiwgIk9FIiwgIm9yZG1hc2N1bGluZSIsICIiLCAiIiwgIiIsICIiLCAiIiwgImFlIiwgIiIsICIiLCAiIiwgImRvdGxlc3NpIiwgIiIsICIiLCAibHNsYXNoIiwgIm9zbGFzaCIsICJvZSIsICJnZXJtYW5kYmxzIiwgIiIsICIiLCAiIiwgIiJdOwogICAgZXhwb3J0cy5TdGFuZGFyZEVuY29kaW5nID0gU3RhbmRhcmRFbmNvZGluZzsKICAgIHZhciBXaW5BbnNpRW5jb2RpbmcgPSBbIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAic3BhY2UiLCAiZXhjbGFtIiwgInF1b3RlZGJsIiwgIm51bWJlcnNpZ24iLCAiZG9sbGFyIiwgInBlcmNlbnQiLCAiYW1wZXJzYW5kIiwgInF1b3Rlc2luZ2xlIiwgInBhcmVubGVmdCIsICJwYXJlbnJpZ2h0IiwgImFzdGVyaXNrIiwgInBsdXMiLCAiY29tbWEiLCAiaHlwaGVuIiwgInBlcmlvZCIsICJzbGFzaCIsICJ6ZXJvIiwgIm9uZSIsICJ0d28iLCAidGhyZWUiLCAiZm91ciIsICJmaXZlIiwgInNpeCIsICJzZXZlbiIsICJlaWdodCIsICJuaW5lIiwgImNvbG9uIiwgInNlbWljb2xvbiIsICJsZXNzIiwgImVxdWFsIiwgImdyZWF0ZXIiLCAicXVlc3Rpb24iLCAiYXQiLCAiQSIsICJCIiwgIkMiLCAiRCIsICJFIiwgIkYiLCAiRyIsICJIIiwgIkkiLCAiSiIsICJLIiwgIkwiLCAiTSIsICJOIiwgIk8iLCAiUCIsICJRIiwgIlIiLCAiUyIsICJUIiwgIlUiLCAiViIsICJXIiwgIlgiLCAiWSIsICJaIiwgImJyYWNrZXRsZWZ0IiwgImJhY2tzbGFzaCIsICJicmFja2V0cmlnaHQiLCAiYXNjaWljaXJjdW0iLCAidW5kZXJzY29yZSIsICJncmF2ZSIsICJhIiwgImIiLCAiYyIsICJkIiwgImUiLCAiZiIsICJnIiwgImgiLCAiaSIsICJqIiwgImsiLCAibCIsICJtIiwgIm4iLCAibyIsICJwIiwgInEiLCAiciIsICJzIiwgInQiLCAidSIsICJ2IiwgInciLCAieCIsICJ5IiwgInoiLCAiYnJhY2VsZWZ0IiwgImJhciIsICJicmFjZXJpZ2h0IiwgImFzY2lpdGlsZGUiLCAiYnVsbGV0IiwgIkV1cm8iLCAiYnVsbGV0IiwgInF1b3Rlc2luZ2xiYXNlIiwgImZsb3JpbiIsICJxdW90ZWRibGJhc2UiLCAiZWxsaXBzaXMiLCAiZGFnZ2VyIiwgImRhZ2dlcmRibCIsICJjaXJjdW1mbGV4IiwgInBlcnRob3VzYW5kIiwgIlNjYXJvbiIsICJndWlsc2luZ2xsZWZ0IiwgIk9FIiwgImJ1bGxldCIsICJaY2Fyb24iLCAiYnVsbGV0IiwgImJ1bGxldCIsICJxdW90ZWxlZnQiLCAicXVvdGVyaWdodCIsICJxdW90ZWRibGxlZnQiLCAicXVvdGVkYmxyaWdodCIsICJidWxsZXQiLCAiZW5kYXNoIiwgImVtZGFzaCIsICJ0aWxkZSIsICJ0cmFkZW1hcmsiLCAic2Nhcm9uIiwgImd1aWxzaW5nbHJpZ2h0IiwgIm9lIiwgImJ1bGxldCIsICJ6Y2Fyb24iLCAiWWRpZXJlc2lzIiwgInNwYWNlIiwgImV4Y2xhbWRvd24iLCAiY2VudCIsICJzdGVybGluZyIsICJjdXJyZW5jeSIsICJ5ZW4iLCAiYnJva2VuYmFyIiwgInNlY3Rpb24iLCAiZGllcmVzaXMiLCAiY29weXJpZ2h0IiwgIm9yZGZlbWluaW5lIiwgImd1aWxsZW1vdGxlZnQiLCAibG9naWNhbG5vdCIsICJoeXBoZW4iLCAicmVnaXN0ZXJlZCIsICJtYWNyb24iLCAiZGVncmVlIiwgInBsdXNtaW51cyIsICJ0d29zdXBlcmlvciIsICJ0aHJlZXN1cGVyaW9yIiwgImFjdXRlIiwgIm11IiwgInBhcmFncmFwaCIsICJwZXJpb2RjZW50ZXJlZCIsICJjZWRpbGxhIiwgIm9uZXN1cGVyaW9yIiwgIm9yZG1hc2N1bGluZSIsICJndWlsbGVtb3RyaWdodCIsICJvbmVxdWFydGVyIiwgIm9uZWhhbGYiLCAidGhyZWVxdWFydGVycyIsICJxdWVzdGlvbmRvd24iLCAiQWdyYXZlIiwgIkFhY3V0ZSIsICJBY2lyY3VtZmxleCIsICJBdGlsZGUiLCAiQWRpZXJlc2lzIiwgIkFyaW5nIiwgIkFFIiwgIkNjZWRpbGxhIiwgIkVncmF2ZSIsICJFYWN1dGUiLCAiRWNpcmN1bWZsZXgiLCAiRWRpZXJlc2lzIiwgIklncmF2ZSIsICJJYWN1dGUiLCAiSWNpcmN1bWZsZXgiLCAiSWRpZXJlc2lzIiwgIkV0aCIsICJOdGlsZGUiLCAiT2dyYXZlIiwgIk9hY3V0ZSIsICJPY2lyY3VtZmxleCIsICJPdGlsZGUiLCAiT2RpZXJlc2lzIiwgIm11bHRpcGx5IiwgIk9zbGFzaCIsICJVZ3JhdmUiLCAiVWFjdXRlIiwgIlVjaXJjdW1mbGV4IiwgIlVkaWVyZXNpcyIsICJZYWN1dGUiLCAiVGhvcm4iLCAiZ2VybWFuZGJscyIsICJhZ3JhdmUiLCAiYWFjdXRlIiwgImFjaXJjdW1mbGV4IiwgImF0aWxkZSIsICJhZGllcmVzaXMiLCAiYXJpbmciLCAiYWUiLCAiY2NlZGlsbGEiLCAiZWdyYXZlIiwgImVhY3V0ZSIsICJlY2lyY3VtZmxleCIsICJlZGllcmVzaXMiLCAiaWdyYXZlIiwgImlhY3V0ZSIsICJpY2lyY3VtZmxleCIsICJpZGllcmVzaXMiLCAiZXRoIiwgIm50aWxkZSIsICJvZ3JhdmUiLCAib2FjdXRlIiwgIm9jaXJjdW1mbGV4IiwgIm90aWxkZSIsICJvZGllcmVzaXMiLCAiZGl2aWRlIiwgIm9zbGFzaCIsICJ1Z3JhdmUiLCAidWFjdXRlIiwgInVjaXJjdW1mbGV4IiwgInVkaWVyZXNpcyIsICJ5YWN1dGUiLCAidGhvcm4iLCAieWRpZXJlc2lzIl07CiAgICBleHBvcnRzLldpbkFuc2lFbmNvZGluZyA9IFdpbkFuc2lFbmNvZGluZzsKICAgIHZhciBTeW1ib2xTZXRFbmNvZGluZyA9IFsiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICJzcGFjZSIsICJleGNsYW0iLCAidW5pdmVyc2FsIiwgIm51bWJlcnNpZ24iLCAiZXhpc3RlbnRpYWwiLCAicGVyY2VudCIsICJhbXBlcnNhbmQiLCAic3VjaHRoYXQiLCAicGFyZW5sZWZ0IiwgInBhcmVucmlnaHQiLCAiYXN0ZXJpc2ttYXRoIiwgInBsdXMiLCAiY29tbWEiLCAibWludXMiLCAicGVyaW9kIiwgInNsYXNoIiwgInplcm8iLCAib25lIiwgInR3byIsICJ0aHJlZSIsICJmb3VyIiwgImZpdmUiLCAic2l4IiwgInNldmVuIiwgImVpZ2h0IiwgIm5pbmUiLCAiY29sb24iLCAic2VtaWNvbG9uIiwgImxlc3MiLCAiZXF1YWwiLCAiZ3JlYXRlciIsICJxdWVzdGlvbiIsICJjb25ncnVlbnQiLCAiQWxwaGEiLCAiQmV0YSIsICJDaGkiLCAiRGVsdGEiLCAiRXBzaWxvbiIsICJQaGkiLCAiR2FtbWEiLCAiRXRhIiwgIklvdGEiLCAidGhldGExIiwgIkthcHBhIiwgIkxhbWJkYSIsICJNdSIsICJOdSIsICJPbWljcm9uIiwgIlBpIiwgIlRoZXRhIiwgIlJobyIsICJTaWdtYSIsICJUYXUiLCAiVXBzaWxvbiIsICJzaWdtYTEiLCAiT21lZ2EiLCAiWGkiLCAiUHNpIiwgIlpldGEiLCAiYnJhY2tldGxlZnQiLCAidGhlcmVmb3JlIiwgImJyYWNrZXRyaWdodCIsICJwZXJwZW5kaWN1bGFyIiwgInVuZGVyc2NvcmUiLCAicmFkaWNhbGV4IiwgImFscGhhIiwgImJldGEiLCAiY2hpIiwgImRlbHRhIiwgImVwc2lsb24iLCAicGhpIiwgImdhbW1hIiwgImV0YSIsICJpb3RhIiwgInBoaTEiLCAia2FwcGEiLCAibGFtYmRhIiwgIm11IiwgIm51IiwgIm9taWNyb24iLCAicGkiLCAidGhldGEiLCAicmhvIiwgInNpZ21hIiwgInRhdSIsICJ1cHNpbG9uIiwgIm9tZWdhMSIsICJvbWVnYSIsICJ4aSIsICJwc2kiLCAiemV0YSIsICJicmFjZWxlZnQiLCAiYmFyIiwgImJyYWNlcmlnaHQiLCAic2ltaWxhciIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICJFdXJvIiwgIlVwc2lsb24xIiwgIm1pbnV0ZSIsICJsZXNzZXF1YWwiLCAiZnJhY3Rpb24iLCAiaW5maW5pdHkiLCAiZmxvcmluIiwgImNsdWIiLCAiZGlhbW9uZCIsICJoZWFydCIsICJzcGFkZSIsICJhcnJvd2JvdGgiLCAiYXJyb3dsZWZ0IiwgImFycm93dXAiLCAiYXJyb3dyaWdodCIsICJhcnJvd2Rvd24iLCAiZGVncmVlIiwgInBsdXNtaW51cyIsICJzZWNvbmQiLCAiZ3JlYXRlcmVxdWFsIiwgIm11bHRpcGx5IiwgInByb3BvcnRpb25hbCIsICJwYXJ0aWFsZGlmZiIsICJidWxsZXQiLCAiZGl2aWRlIiwgIm5vdGVxdWFsIiwgImVxdWl2YWxlbmNlIiwgImFwcHJveGVxdWFsIiwgImVsbGlwc2lzIiwgImFycm93dmVydGV4IiwgImFycm93aG9yaXpleCIsICJjYXJyaWFnZXJldHVybiIsICJhbGVwaCIsICJJZnJha3R1ciIsICJSZnJha3R1ciIsICJ3ZWllcnN0cmFzcyIsICJjaXJjbGVtdWx0aXBseSIsICJjaXJjbGVwbHVzIiwgImVtcHR5c2V0IiwgImludGVyc2VjdGlvbiIsICJ1bmlvbiIsICJwcm9wZXJzdXBlcnNldCIsICJyZWZsZXhzdXBlcnNldCIsICJub3RzdWJzZXQiLCAicHJvcGVyc3Vic2V0IiwgInJlZmxleHN1YnNldCIsICJlbGVtZW50IiwgIm5vdGVsZW1lbnQiLCAiYW5nbGUiLCAiZ3JhZGllbnQiLCAicmVnaXN0ZXJzZXJpZiIsICJjb3B5cmlnaHRzZXJpZiIsICJ0cmFkZW1hcmtzZXJpZiIsICJwcm9kdWN0IiwgInJhZGljYWwiLCAiZG90bWF0aCIsICJsb2dpY2Fsbm90IiwgImxvZ2ljYWxhbmQiLCAibG9naWNhbG9yIiwgImFycm93ZGJsYm90aCIsICJhcnJvd2RibGxlZnQiLCAiYXJyb3dkYmx1cCIsICJhcnJvd2RibHJpZ2h0IiwgImFycm93ZGJsZG93biIsICJsb3plbmdlIiwgImFuZ2xlbGVmdCIsICJyZWdpc3RlcnNhbnMiLCAiY29weXJpZ2h0c2FucyIsICJ0cmFkZW1hcmtzYW5zIiwgInN1bW1hdGlvbiIsICJwYXJlbmxlZnR0cCIsICJwYXJlbmxlZnRleCIsICJwYXJlbmxlZnRidCIsICJicmFja2V0bGVmdHRwIiwgImJyYWNrZXRsZWZ0ZXgiLCAiYnJhY2tldGxlZnRidCIsICJicmFjZWxlZnR0cCIsICJicmFjZWxlZnRtaWQiLCAiYnJhY2VsZWZ0YnQiLCAiYnJhY2VleCIsICIiLCAiYW5nbGVyaWdodCIsICJpbnRlZ3JhbCIsICJpbnRlZ3JhbHRwIiwgImludGVncmFsZXgiLCAiaW50ZWdyYWxidCIsICJwYXJlbnJpZ2h0dHAiLCAicGFyZW5yaWdodGV4IiwgInBhcmVucmlnaHRidCIsICJicmFja2V0cmlnaHR0cCIsICJicmFja2V0cmlnaHRleCIsICJicmFja2V0cmlnaHRidCIsICJicmFjZXJpZ2h0dHAiLCAiYnJhY2VyaWdodG1pZCIsICJicmFjZXJpZ2h0YnQiLCAiIl07CiAgICBleHBvcnRzLlN5bWJvbFNldEVuY29kaW5nID0gU3ltYm9sU2V0RW5jb2Rpbmc7CiAgICB2YXIgWmFwZkRpbmdiYXRzRW5jb2RpbmcgPSBbIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAic3BhY2UiLCAiYTEiLCAiYTIiLCAiYTIwMiIsICJhMyIsICJhNCIsICJhNSIsICJhMTE5IiwgImExMTgiLCAiYTExNyIsICJhMTEiLCAiYTEyIiwgImExMyIsICJhMTQiLCAiYTE1IiwgImExNiIsICJhMTA1IiwgImExNyIsICJhMTgiLCAiYTE5IiwgImEyMCIsICJhMjEiLCAiYTIyIiwgImEyMyIsICJhMjQiLCAiYTI1IiwgImEyNiIsICJhMjciLCAiYTI4IiwgImE2IiwgImE3IiwgImE4IiwgImE5IiwgImExMCIsICJhMjkiLCAiYTMwIiwgImEzMSIsICJhMzIiLCAiYTMzIiwgImEzNCIsICJhMzUiLCAiYTM2IiwgImEzNyIsICJhMzgiLCAiYTM5IiwgImE0MCIsICJhNDEiLCAiYTQyIiwgImE0MyIsICJhNDQiLCAiYTQ1IiwgImE0NiIsICJhNDciLCAiYTQ4IiwgImE0OSIsICJhNTAiLCAiYTUxIiwgImE1MiIsICJhNTMiLCAiYTU0IiwgImE1NSIsICJhNTYiLCAiYTU3IiwgImE1OCIsICJhNTkiLCAiYTYwIiwgImE2MSIsICJhNjIiLCAiYTYzIiwgImE2NCIsICJhNjUiLCAiYTY2IiwgImE2NyIsICJhNjgiLCAiYTY5IiwgImE3MCIsICJhNzEiLCAiYTcyIiwgImE3MyIsICJhNzQiLCAiYTIwMyIsICJhNzUiLCAiYTIwNCIsICJhNzYiLCAiYTc3IiwgImE3OCIsICJhNzkiLCAiYTgxIiwgImE4MiIsICJhODMiLCAiYTg0IiwgImE5NyIsICJhOTgiLCAiYTk5IiwgImExMDAiLCAiIiwgImE4OSIsICJhOTAiLCAiYTkzIiwgImE5NCIsICJhOTEiLCAiYTkyIiwgImEyMDUiLCAiYTg1IiwgImEyMDYiLCAiYTg2IiwgImE4NyIsICJhODgiLCAiYTk1IiwgImE5NiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiYTEwMSIsICJhMTAyIiwgImExMDMiLCAiYTEwNCIsICJhMTA2IiwgImExMDciLCAiYTEwOCIsICJhMTEyIiwgImExMTEiLCAiYTExMCIsICJhMTA5IiwgImExMjAiLCAiYTEyMSIsICJhMTIyIiwgImExMjMiLCAiYTEyNCIsICJhMTI1IiwgImExMjYiLCAiYTEyNyIsICJhMTI4IiwgImExMjkiLCAiYTEzMCIsICJhMTMxIiwgImExMzIiLCAiYTEzMyIsICJhMTM0IiwgImExMzUiLCAiYTEzNiIsICJhMTM3IiwgImExMzgiLCAiYTEzOSIsICJhMTQwIiwgImExNDEiLCAiYTE0MiIsICJhMTQzIiwgImExNDQiLCAiYTE0NSIsICJhMTQ2IiwgImExNDciLCAiYTE0OCIsICJhMTQ5IiwgImExNTAiLCAiYTE1MSIsICJhMTUyIiwgImExNTMiLCAiYTE1NCIsICJhMTU1IiwgImExNTYiLCAiYTE1NyIsICJhMTU4IiwgImExNTkiLCAiYTE2MCIsICJhMTYxIiwgImExNjMiLCAiYTE2NCIsICJhMTk2IiwgImExNjUiLCAiYTE5MiIsICJhMTY2IiwgImExNjciLCAiYTE2OCIsICJhMTY5IiwgImExNzAiLCAiYTE3MSIsICJhMTcyIiwgImExNzMiLCAiYTE2MiIsICJhMTc0IiwgImExNzUiLCAiYTE3NiIsICJhMTc3IiwgImExNzgiLCAiYTE3OSIsICJhMTkzIiwgImExODAiLCAiYTE5OSIsICJhMTgxIiwgImEyMDAiLCAiYTE4MiIsICIiLCAiYTIwMSIsICJhMTgzIiwgImExODQiLCAiYTE5NyIsICJhMTg1IiwgImExOTQiLCAiYTE5OCIsICJhMTg2IiwgImExOTUiLCAiYTE4NyIsICJhMTg4IiwgImExODkiLCAiYTE5MCIsICJhMTkxIiwgIiJdOwogICAgZXhwb3J0cy5aYXBmRGluZ2JhdHNFbmNvZGluZyA9IFphcGZEaW5nYmF0c0VuY29kaW5nOwoKICAgIGZ1bmN0aW9uIGdldEVuY29kaW5nKGVuY29kaW5nTmFtZSkgewogICAgICBzd2l0Y2ggKGVuY29kaW5nTmFtZSkgewogICAgICAgIGNhc2UgIldpbkFuc2lFbmNvZGluZyI6CiAgICAgICAgICByZXR1cm4gV2luQW5zaUVuY29kaW5nOwoKICAgICAgICBjYXNlICJTdGFuZGFyZEVuY29kaW5nIjoKICAgICAgICAgIHJldHVybiBTdGFuZGFyZEVuY29kaW5nOwoKICAgICAgICBjYXNlICJNYWNSb21hbkVuY29kaW5nIjoKICAgICAgICAgIHJldHVybiBNYWNSb21hbkVuY29kaW5nOwoKICAgICAgICBjYXNlICJTeW1ib2xTZXRFbmNvZGluZyI6CiAgICAgICAgICByZXR1cm4gU3ltYm9sU2V0RW5jb2Rpbmc7CgogICAgICAgIGNhc2UgIlphcGZEaW5nYmF0c0VuY29kaW5nIjoKICAgICAgICAgIHJldHVybiBaYXBmRGluZ2JhdHNFbmNvZGluZzsKCiAgICAgICAgY2FzZSAiRXhwZXJ0RW5jb2RpbmciOgogICAgICAgICAgcmV0dXJuIEV4cGVydEVuY29kaW5nOwoKICAgICAgICBjYXNlICJNYWNFeHBlcnRFbmNvZGluZyI6CiAgICAgICAgICByZXR1cm4gTWFjRXhwZXJ0RW5jb2Rpbmc7CgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfQoKICAgIC8qKiovfSksICgKICAvKiAyMjEgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICB2YXIgZ2V0TG9va3VwVGFibGVGYWN0b3J5ID0gX193X3BkZmpzX3JlcXVpcmVfXygxOTcpLmdldExvb2t1cFRhYmxlRmFjdG9yeTsKICAgIHZhciBnZXRHbHlwaHNVbmljb2RlID0gZ2V0TG9va3VwVGFibGVGYWN0b3J5KGZ1bmN0aW9uICh0KSB7CiAgICAgIHRbIkEiXSA9IDB4MDA0MTsKICAgICAgdFsiQUUiXSA9IDB4MDBjNjsKICAgICAgdFsiQUVhY3V0ZSJdID0gMHgwMWZjOwogICAgICB0WyJBRW1hY3JvbiJdID0gMHgwMWUyOwogICAgICB0WyJBRXNtYWxsIl0gPSAweGY3ZTY7CiAgICAgIHRbIkFhY3V0ZSJdID0gMHgwMGMxOwogICAgICB0WyJBYWN1dGVzbWFsbCJdID0gMHhmN2UxOwogICAgICB0WyJBYnJldmUiXSA9IDB4MDEwMjsKICAgICAgdFsiQWJyZXZlYWN1dGUiXSA9IDB4MWVhZTsKICAgICAgdFsiQWJyZXZlY3lyaWxsaWMiXSA9IDB4MDRkMDsKICAgICAgdFsiQWJyZXZlZG90YmVsb3ciXSA9IDB4MWViNjsKICAgICAgdFsiQWJyZXZlZ3JhdmUiXSA9IDB4MWViMDsKICAgICAgdFsiQWJyZXZlaG9va2Fib3ZlIl0gPSAweDFlYjI7CiAgICAgIHRbIkFicmV2ZXRpbGRlIl0gPSAweDFlYjQ7CiAgICAgIHRbIkFjYXJvbiJdID0gMHgwMWNkOwogICAgICB0WyJBY2lyY2xlIl0gPSAweDI0YjY7CiAgICAgIHRbIkFjaXJjdW1mbGV4Il0gPSAweDAwYzI7CiAgICAgIHRbIkFjaXJjdW1mbGV4YWN1dGUiXSA9IDB4MWVhNDsKICAgICAgdFsiQWNpcmN1bWZsZXhkb3RiZWxvdyJdID0gMHgxZWFjOwogICAgICB0WyJBY2lyY3VtZmxleGdyYXZlIl0gPSAweDFlYTY7CiAgICAgIHRbIkFjaXJjdW1mbGV4aG9va2Fib3ZlIl0gPSAweDFlYTg7CiAgICAgIHRbIkFjaXJjdW1mbGV4c21hbGwiXSA9IDB4ZjdlMjsKICAgICAgdFsiQWNpcmN1bWZsZXh0aWxkZSJdID0gMHgxZWFhOwogICAgICB0WyJBY3V0ZSJdID0gMHhmNmM5OwogICAgICB0WyJBY3V0ZXNtYWxsIl0gPSAweGY3YjQ7CiAgICAgIHRbIkFjeXJpbGxpYyJdID0gMHgwNDEwOwogICAgICB0WyJBZGJsZ3JhdmUiXSA9IDB4MDIwMDsKICAgICAgdFsiQWRpZXJlc2lzIl0gPSAweDAwYzQ7CiAgICAgIHRbIkFkaWVyZXNpc2N5cmlsbGljIl0gPSAweDA0ZDI7CiAgICAgIHRbIkFkaWVyZXNpc21hY3JvbiJdID0gMHgwMWRlOwogICAgICB0WyJBZGllcmVzaXNzbWFsbCJdID0gMHhmN2U0OwogICAgICB0WyJBZG90YmVsb3ciXSA9IDB4MWVhMDsKICAgICAgdFsiQWRvdG1hY3JvbiJdID0gMHgwMWUwOwogICAgICB0WyJBZ3JhdmUiXSA9IDB4MDBjMDsKICAgICAgdFsiQWdyYXZlc21hbGwiXSA9IDB4ZjdlMDsKICAgICAgdFsiQWhvb2thYm92ZSJdID0gMHgxZWEyOwogICAgICB0WyJBaWVjeXJpbGxpYyJdID0gMHgwNGQ0OwogICAgICB0WyJBaW52ZXJ0ZWRicmV2ZSJdID0gMHgwMjAyOwogICAgICB0WyJBbHBoYSJdID0gMHgwMzkxOwogICAgICB0WyJBbHBoYXRvbm9zIl0gPSAweDAzODY7CiAgICAgIHRbIkFtYWNyb24iXSA9IDB4MDEwMDsKICAgICAgdFsiQW1vbm9zcGFjZSJdID0gMHhmZjIxOwogICAgICB0WyJBb2dvbmVrIl0gPSAweDAxMDQ7CiAgICAgIHRbIkFyaW5nIl0gPSAweDAwYzU7CiAgICAgIHRbIkFyaW5nYWN1dGUiXSA9IDB4MDFmYTsKICAgICAgdFsiQXJpbmdiZWxvdyJdID0gMHgxZTAwOwogICAgICB0WyJBcmluZ3NtYWxsIl0gPSAweGY3ZTU7CiAgICAgIHRbIkFzbWFsbCJdID0gMHhmNzYxOwogICAgICB0WyJBdGlsZGUiXSA9IDB4MDBjMzsKICAgICAgdFsiQXRpbGRlc21hbGwiXSA9IDB4ZjdlMzsKICAgICAgdFsiQXliYXJtZW5pYW4iXSA9IDB4MDUzMTsKICAgICAgdFsiQiJdID0gMHgwMDQyOwogICAgICB0WyJCY2lyY2xlIl0gPSAweDI0Yjc7CiAgICAgIHRbIkJkb3RhY2NlbnQiXSA9IDB4MWUwMjsKICAgICAgdFsiQmRvdGJlbG93Il0gPSAweDFlMDQ7CiAgICAgIHRbIkJlY3lyaWxsaWMiXSA9IDB4MDQxMTsKICAgICAgdFsiQmVuYXJtZW5pYW4iXSA9IDB4MDUzMjsKICAgICAgdFsiQmV0YSJdID0gMHgwMzkyOwogICAgICB0WyJCaG9vayJdID0gMHgwMTgxOwogICAgICB0WyJCbGluZWJlbG93Il0gPSAweDFlMDY7CiAgICAgIHRbIkJtb25vc3BhY2UiXSA9IDB4ZmYyMjsKICAgICAgdFsiQnJldmVzbWFsbCJdID0gMHhmNmY0OwogICAgICB0WyJCc21hbGwiXSA9IDB4Zjc2MjsKICAgICAgdFsiQnRvcGJhciJdID0gMHgwMTgyOwogICAgICB0WyJDIl0gPSAweDAwNDM7CiAgICAgIHRbIkNhYXJtZW5pYW4iXSA9IDB4MDUzZTsKICAgICAgdFsiQ2FjdXRlIl0gPSAweDAxMDY7CiAgICAgIHRbIkNhcm9uIl0gPSAweGY2Y2E7CiAgICAgIHRbIkNhcm9uc21hbGwiXSA9IDB4ZjZmNTsKICAgICAgdFsiQ2Nhcm9uIl0gPSAweDAxMGM7CiAgICAgIHRbIkNjZWRpbGxhIl0gPSAweDAwYzc7CiAgICAgIHRbIkNjZWRpbGxhYWN1dGUiXSA9IDB4MWUwODsKICAgICAgdFsiQ2NlZGlsbGFzbWFsbCJdID0gMHhmN2U3OwogICAgICB0WyJDY2lyY2xlIl0gPSAweDI0Yjg7CiAgICAgIHRbIkNjaXJjdW1mbGV4Il0gPSAweDAxMDg7CiAgICAgIHRbIkNkb3QiXSA9IDB4MDEwYTsKICAgICAgdFsiQ2RvdGFjY2VudCJdID0gMHgwMTBhOwogICAgICB0WyJDZWRpbGxhc21hbGwiXSA9IDB4ZjdiODsKICAgICAgdFsiQ2hhYXJtZW5pYW4iXSA9IDB4MDU0OTsKICAgICAgdFsiQ2hlYWJraGFzaWFuY3lyaWxsaWMiXSA9IDB4MDRiYzsKICAgICAgdFsiQ2hlY3lyaWxsaWMiXSA9IDB4MDQyNzsKICAgICAgdFsiQ2hlZGVzY2VuZGVyYWJraGFzaWFuY3lyaWxsaWMiXSA9IDB4MDRiZTsKICAgICAgdFsiQ2hlZGVzY2VuZGVyY3lyaWxsaWMiXSA9IDB4MDRiNjsKICAgICAgdFsiQ2hlZGllcmVzaXNjeXJpbGxpYyJdID0gMHgwNGY0OwogICAgICB0WyJDaGVoYXJtZW5pYW4iXSA9IDB4MDU0MzsKICAgICAgdFsiQ2hla2hha2Fzc2lhbmN5cmlsbGljIl0gPSAweDA0Y2I7CiAgICAgIHRbIkNoZXZlcnRpY2Fsc3Ryb2tlY3lyaWxsaWMiXSA9IDB4MDRiODsKICAgICAgdFsiQ2hpIl0gPSAweDAzYTc7CiAgICAgIHRbIkNob29rIl0gPSAweDAxODc7CiAgICAgIHRbIkNpcmN1bWZsZXhzbWFsbCJdID0gMHhmNmY2OwogICAgICB0WyJDbW9ub3NwYWNlIl0gPSAweGZmMjM7CiAgICAgIHRbIkNvYXJtZW5pYW4iXSA9IDB4MDU1MTsKICAgICAgdFsiQ3NtYWxsIl0gPSAweGY3NjM7CiAgICAgIHRbIkQiXSA9IDB4MDA0NDsKICAgICAgdFsiRFoiXSA9IDB4MDFmMTsKICAgICAgdFsiRFpjYXJvbiJdID0gMHgwMWM0OwogICAgICB0WyJEYWFybWVuaWFuIl0gPSAweDA1MzQ7CiAgICAgIHRbIkRhZnJpY2FuIl0gPSAweDAxODk7CiAgICAgIHRbIkRjYXJvbiJdID0gMHgwMTBlOwogICAgICB0WyJEY2VkaWxsYSJdID0gMHgxZTEwOwogICAgICB0WyJEY2lyY2xlIl0gPSAweDI0Yjk7CiAgICAgIHRbIkRjaXJjdW1mbGV4YmVsb3ciXSA9IDB4MWUxMjsKICAgICAgdFsiRGNyb2F0Il0gPSAweDAxMTA7CiAgICAgIHRbIkRkb3RhY2NlbnQiXSA9IDB4MWUwYTsKICAgICAgdFsiRGRvdGJlbG93Il0gPSAweDFlMGM7CiAgICAgIHRbIkRlY3lyaWxsaWMiXSA9IDB4MDQxNDsKICAgICAgdFsiRGVpY29wdGljIl0gPSAweDAzZWU7CiAgICAgIHRbIkRlbHRhIl0gPSAweDIyMDY7CiAgICAgIHRbIkRlbHRhZ3JlZWsiXSA9IDB4MDM5NDsKICAgICAgdFsiRGhvb2siXSA9IDB4MDE4YTsKICAgICAgdFsiRGllcmVzaXMiXSA9IDB4ZjZjYjsKICAgICAgdFsiRGllcmVzaXNBY3V0ZSJdID0gMHhmNmNjOwogICAgICB0WyJEaWVyZXNpc0dyYXZlIl0gPSAweGY2Y2Q7CiAgICAgIHRbIkRpZXJlc2lzc21hbGwiXSA9IDB4ZjdhODsKICAgICAgdFsiRGlnYW1tYWdyZWVrIl0gPSAweDAzZGM7CiAgICAgIHRbIkRqZWN5cmlsbGljIl0gPSAweDA0MDI7CiAgICAgIHRbIkRsaW5lYmVsb3ciXSA9IDB4MWUwZTsKICAgICAgdFsiRG1vbm9zcGFjZSJdID0gMHhmZjI0OwogICAgICB0WyJEb3RhY2NlbnRzbWFsbCJdID0gMHhmNmY3OwogICAgICB0WyJEc2xhc2giXSA9IDB4MDExMDsKICAgICAgdFsiRHNtYWxsIl0gPSAweGY3NjQ7CiAgICAgIHRbIkR0b3BiYXIiXSA9IDB4MDE4YjsKICAgICAgdFsiRHoiXSA9IDB4MDFmMjsKICAgICAgdFsiRHpjYXJvbiJdID0gMHgwMWM1OwogICAgICB0WyJEemVhYmtoYXNpYW5jeXJpbGxpYyJdID0gMHgwNGUwOwogICAgICB0WyJEemVjeXJpbGxpYyJdID0gMHgwNDA1OwogICAgICB0WyJEemhlY3lyaWxsaWMiXSA9IDB4MDQwZjsKICAgICAgdFsiRSJdID0gMHgwMDQ1OwogICAgICB0WyJFYWN1dGUiXSA9IDB4MDBjOTsKICAgICAgdFsiRWFjdXRlc21hbGwiXSA9IDB4ZjdlOTsKICAgICAgdFsiRWJyZXZlIl0gPSAweDAxMTQ7CiAgICAgIHRbIkVjYXJvbiJdID0gMHgwMTFhOwogICAgICB0WyJFY2VkaWxsYWJyZXZlIl0gPSAweDFlMWM7CiAgICAgIHRbIkVjaGFybWVuaWFuIl0gPSAweDA1MzU7CiAgICAgIHRbIkVjaXJjbGUiXSA9IDB4MjRiYTsKICAgICAgdFsiRWNpcmN1bWZsZXgiXSA9IDB4MDBjYTsKICAgICAgdFsiRWNpcmN1bWZsZXhhY3V0ZSJdID0gMHgxZWJlOwogICAgICB0WyJFY2lyY3VtZmxleGJlbG93Il0gPSAweDFlMTg7CiAgICAgIHRbIkVjaXJjdW1mbGV4ZG90YmVsb3ciXSA9IDB4MWVjNjsKICAgICAgdFsiRWNpcmN1bWZsZXhncmF2ZSJdID0gMHgxZWMwOwogICAgICB0WyJFY2lyY3VtZmxleGhvb2thYm92ZSJdID0gMHgxZWMyOwogICAgICB0WyJFY2lyY3VtZmxleHNtYWxsIl0gPSAweGY3ZWE7CiAgICAgIHRbIkVjaXJjdW1mbGV4dGlsZGUiXSA9IDB4MWVjNDsKICAgICAgdFsiRWN5cmlsbGljIl0gPSAweDA0MDQ7CiAgICAgIHRbIkVkYmxncmF2ZSJdID0gMHgwMjA0OwogICAgICB0WyJFZGllcmVzaXMiXSA9IDB4MDBjYjsKICAgICAgdFsiRWRpZXJlc2lzc21hbGwiXSA9IDB4ZjdlYjsKICAgICAgdFsiRWRvdCJdID0gMHgwMTE2OwogICAgICB0WyJFZG90YWNjZW50Il0gPSAweDAxMTY7CiAgICAgIHRbIkVkb3RiZWxvdyJdID0gMHgxZWI4OwogICAgICB0WyJFZmN5cmlsbGljIl0gPSAweDA0MjQ7CiAgICAgIHRbIkVncmF2ZSJdID0gMHgwMGM4OwogICAgICB0WyJFZ3JhdmVzbWFsbCJdID0gMHhmN2U4OwogICAgICB0WyJFaGFybWVuaWFuIl0gPSAweDA1Mzc7CiAgICAgIHRbIkVob29rYWJvdmUiXSA9IDB4MWViYTsKICAgICAgdFsiRWlnaHRyb21hbiJdID0gMHgyMTY3OwogICAgICB0WyJFaW52ZXJ0ZWRicmV2ZSJdID0gMHgwMjA2OwogICAgICB0WyJFaW90aWZpZWRjeXJpbGxpYyJdID0gMHgwNDY0OwogICAgICB0WyJFbGN5cmlsbGljIl0gPSAweDA0MWI7CiAgICAgIHRbIkVsZXZlbnJvbWFuIl0gPSAweDIxNmE7CiAgICAgIHRbIkVtYWNyb24iXSA9IDB4MDExMjsKICAgICAgdFsiRW1hY3JvbmFjdXRlIl0gPSAweDFlMTY7CiAgICAgIHRbIkVtYWNyb25ncmF2ZSJdID0gMHgxZTE0OwogICAgICB0WyJFbWN5cmlsbGljIl0gPSAweDA0MWM7CiAgICAgIHRbIkVtb25vc3BhY2UiXSA9IDB4ZmYyNTsKICAgICAgdFsiRW5jeXJpbGxpYyJdID0gMHgwNDFkOwogICAgICB0WyJFbmRlc2NlbmRlcmN5cmlsbGljIl0gPSAweDA0YTI7CiAgICAgIHRbIkVuZyJdID0gMHgwMTRhOwogICAgICB0WyJFbmdoZWN5cmlsbGljIl0gPSAweDA0YTQ7CiAgICAgIHRbIkVuaG9va2N5cmlsbGljIl0gPSAweDA0Yzc7CiAgICAgIHRbIkVvZ29uZWsiXSA9IDB4MDExODsKICAgICAgdFsiRW9wZW4iXSA9IDB4MDE5MDsKICAgICAgdFsiRXBzaWxvbiJdID0gMHgwMzk1OwogICAgICB0WyJFcHNpbG9udG9ub3MiXSA9IDB4MDM4ODsKICAgICAgdFsiRXJjeXJpbGxpYyJdID0gMHgwNDIwOwogICAgICB0WyJFcmV2ZXJzZWQiXSA9IDB4MDE4ZTsKICAgICAgdFsiRXJldmVyc2VkY3lyaWxsaWMiXSA9IDB4MDQyZDsKICAgICAgdFsiRXNjeXJpbGxpYyJdID0gMHgwNDIxOwogICAgICB0WyJFc2Rlc2NlbmRlcmN5cmlsbGljIl0gPSAweDA0YWE7CiAgICAgIHRbIkVzaCJdID0gMHgwMWE5OwogICAgICB0WyJFc21hbGwiXSA9IDB4Zjc2NTsKICAgICAgdFsiRXRhIl0gPSAweDAzOTc7CiAgICAgIHRbIkV0YXJtZW5pYW4iXSA9IDB4MDUzODsKICAgICAgdFsiRXRhdG9ub3MiXSA9IDB4MDM4OTsKICAgICAgdFsiRXRoIl0gPSAweDAwZDA7CiAgICAgIHRbIkV0aHNtYWxsIl0gPSAweGY3ZjA7CiAgICAgIHRbIkV0aWxkZSJdID0gMHgxZWJjOwogICAgICB0WyJFdGlsZGViZWxvdyJdID0gMHgxZTFhOwogICAgICB0WyJFdXJvIl0gPSAweDIwYWM7CiAgICAgIHRbIkV6aCJdID0gMHgwMWI3OwogICAgICB0WyJFemhjYXJvbiJdID0gMHgwMWVlOwogICAgICB0WyJFemhyZXZlcnNlZCJdID0gMHgwMWI4OwogICAgICB0WyJGIl0gPSAweDAwNDY7CiAgICAgIHRbIkZjaXJjbGUiXSA9IDB4MjRiYjsKICAgICAgdFsiRmRvdGFjY2VudCJdID0gMHgxZTFlOwogICAgICB0WyJGZWhhcm1lbmlhbiJdID0gMHgwNTU2OwogICAgICB0WyJGZWljb3B0aWMiXSA9IDB4MDNlNDsKICAgICAgdFsiRmhvb2siXSA9IDB4MDE5MTsKICAgICAgdFsiRml0YWN5cmlsbGljIl0gPSAweDA0NzI7CiAgICAgIHRbIkZpdmVyb21hbiJdID0gMHgyMTY0OwogICAgICB0WyJGbW9ub3NwYWNlIl0gPSAweGZmMjY7CiAgICAgIHRbIkZvdXJyb21hbiJdID0gMHgyMTYzOwogICAgICB0WyJGc21hbGwiXSA9IDB4Zjc2NjsKICAgICAgdFsiRyJdID0gMHgwMDQ3OwogICAgICB0WyJHQnNxdWFyZSJdID0gMHgzMzg3OwogICAgICB0WyJHYWN1dGUiXSA9IDB4MDFmNDsKICAgICAgdFsiR2FtbWEiXSA9IDB4MDM5MzsKICAgICAgdFsiR2FtbWFhZnJpY2FuIl0gPSAweDAxOTQ7CiAgICAgIHRbIkdhbmdpYWNvcHRpYyJdID0gMHgwM2VhOwogICAgICB0WyJHYnJldmUiXSA9IDB4MDExZTsKICAgICAgdFsiR2Nhcm9uIl0gPSAweDAxZTY7CiAgICAgIHRbIkdjZWRpbGxhIl0gPSAweDAxMjI7CiAgICAgIHRbIkdjaXJjbGUiXSA9IDB4MjRiYzsKICAgICAgdFsiR2NpcmN1bWZsZXgiXSA9IDB4MDExYzsKICAgICAgdFsiR2NvbW1hYWNjZW50Il0gPSAweDAxMjI7CiAgICAgIHRbIkdkb3QiXSA9IDB4MDEyMDsKICAgICAgdFsiR2RvdGFjY2VudCJdID0gMHgwMTIwOwogICAgICB0WyJHZWN5cmlsbGljIl0gPSAweDA0MTM7CiAgICAgIHRbIkdoYWRhcm1lbmlhbiJdID0gMHgwNTQyOwogICAgICB0WyJHaGVtaWRkbGVob29rY3lyaWxsaWMiXSA9IDB4MDQ5NDsKICAgICAgdFsiR2hlc3Ryb2tlY3lyaWxsaWMiXSA9IDB4MDQ5MjsKICAgICAgdFsiR2hldXB0dXJuY3lyaWxsaWMiXSA9IDB4MDQ5MDsKICAgICAgdFsiR2hvb2siXSA9IDB4MDE5MzsKICAgICAgdFsiR2ltYXJtZW5pYW4iXSA9IDB4MDUzMzsKICAgICAgdFsiR2plY3lyaWxsaWMiXSA9IDB4MDQwMzsKICAgICAgdFsiR21hY3JvbiJdID0gMHgxZTIwOwogICAgICB0WyJHbW9ub3NwYWNlIl0gPSAweGZmMjc7CiAgICAgIHRbIkdyYXZlIl0gPSAweGY2Y2U7CiAgICAgIHRbIkdyYXZlc21hbGwiXSA9IDB4Zjc2MDsKICAgICAgdFsiR3NtYWxsIl0gPSAweGY3Njc7CiAgICAgIHRbIkdzbWFsbGhvb2siXSA9IDB4MDI5YjsKICAgICAgdFsiR3N0cm9rZSJdID0gMHgwMWU0OwogICAgICB0WyJIIl0gPSAweDAwNDg7CiAgICAgIHRbIkgxODUzMyJdID0gMHgyNWNmOwogICAgICB0WyJIMTg1NDMiXSA9IDB4MjVhYTsKICAgICAgdFsiSDE4NTUxIl0gPSAweDI1YWI7CiAgICAgIHRbIkgyMjA3MyJdID0gMHgyNWExOwogICAgICB0WyJIUHNxdWFyZSJdID0gMHgzM2NiOwogICAgICB0WyJIYWFia2hhc2lhbmN5cmlsbGljIl0gPSAweDA0YTg7CiAgICAgIHRbIkhhZGVzY2VuZGVyY3lyaWxsaWMiXSA9IDB4MDRiMjsKICAgICAgdFsiSGFyZHNpZ25jeXJpbGxpYyJdID0gMHgwNDJhOwogICAgICB0WyJIYmFyIl0gPSAweDAxMjY7CiAgICAgIHRbIkhicmV2ZWJlbG93Il0gPSAweDFlMmE7CiAgICAgIHRbIkhjZWRpbGxhIl0gPSAweDFlMjg7CiAgICAgIHRbIkhjaXJjbGUiXSA9IDB4MjRiZDsKICAgICAgdFsiSGNpcmN1bWZsZXgiXSA9IDB4MDEyNDsKICAgICAgdFsiSGRpZXJlc2lzIl0gPSAweDFlMjY7CiAgICAgIHRbIkhkb3RhY2NlbnQiXSA9IDB4MWUyMjsKICAgICAgdFsiSGRvdGJlbG93Il0gPSAweDFlMjQ7CiAgICAgIHRbIkhtb25vc3BhY2UiXSA9IDB4ZmYyODsKICAgICAgdFsiSG9hcm1lbmlhbiJdID0gMHgwNTQwOwogICAgICB0WyJIb3JpY29wdGljIl0gPSAweDAzZTg7CiAgICAgIHRbIkhzbWFsbCJdID0gMHhmNzY4OwogICAgICB0WyJIdW5nYXJ1bWxhdXQiXSA9IDB4ZjZjZjsKICAgICAgdFsiSHVuZ2FydW1sYXV0c21hbGwiXSA9IDB4ZjZmODsKICAgICAgdFsiSHpzcXVhcmUiXSA9IDB4MzM5MDsKICAgICAgdFsiSSJdID0gMHgwMDQ5OwogICAgICB0WyJJQWN5cmlsbGljIl0gPSAweDA0MmY7CiAgICAgIHRbIklKIl0gPSAweDAxMzI7CiAgICAgIHRbIklVY3lyaWxsaWMiXSA9IDB4MDQyZTsKICAgICAgdFsiSWFjdXRlIl0gPSAweDAwY2Q7CiAgICAgIHRbIklhY3V0ZXNtYWxsIl0gPSAweGY3ZWQ7CiAgICAgIHRbIklicmV2ZSJdID0gMHgwMTJjOwogICAgICB0WyJJY2Fyb24iXSA9IDB4MDFjZjsKICAgICAgdFsiSWNpcmNsZSJdID0gMHgyNGJlOwogICAgICB0WyJJY2lyY3VtZmxleCJdID0gMHgwMGNlOwogICAgICB0WyJJY2lyY3VtZmxleHNtYWxsIl0gPSAweGY3ZWU7CiAgICAgIHRbIkljeXJpbGxpYyJdID0gMHgwNDA2OwogICAgICB0WyJJZGJsZ3JhdmUiXSA9IDB4MDIwODsKICAgICAgdFsiSWRpZXJlc2lzIl0gPSAweDAwY2Y7CiAgICAgIHRbIklkaWVyZXNpc2FjdXRlIl0gPSAweDFlMmU7CiAgICAgIHRbIklkaWVyZXNpc2N5cmlsbGljIl0gPSAweDA0ZTQ7CiAgICAgIHRbIklkaWVyZXNpc3NtYWxsIl0gPSAweGY3ZWY7CiAgICAgIHRbIklkb3QiXSA9IDB4MDEzMDsKICAgICAgdFsiSWRvdGFjY2VudCJdID0gMHgwMTMwOwogICAgICB0WyJJZG90YmVsb3ciXSA9IDB4MWVjYTsKICAgICAgdFsiSWVicmV2ZWN5cmlsbGljIl0gPSAweDA0ZDY7CiAgICAgIHRbIkllY3lyaWxsaWMiXSA9IDB4MDQxNTsKICAgICAgdFsiSWZyYWt0dXIiXSA9IDB4MjExMTsKICAgICAgdFsiSWdyYXZlIl0gPSAweDAwY2M7CiAgICAgIHRbIklncmF2ZXNtYWxsIl0gPSAweGY3ZWM7CiAgICAgIHRbIklob29rYWJvdmUiXSA9IDB4MWVjODsKICAgICAgdFsiSWljeXJpbGxpYyJdID0gMHgwNDE4OwogICAgICB0WyJJaW52ZXJ0ZWRicmV2ZSJdID0gMHgwMjBhOwogICAgICB0WyJJaXNob3J0Y3lyaWxsaWMiXSA9IDB4MDQxOTsKICAgICAgdFsiSW1hY3JvbiJdID0gMHgwMTJhOwogICAgICB0WyJJbWFjcm9uY3lyaWxsaWMiXSA9IDB4MDRlMjsKICAgICAgdFsiSW1vbm9zcGFjZSJdID0gMHhmZjI5OwogICAgICB0WyJJbmlhcm1lbmlhbiJdID0gMHgwNTNiOwogICAgICB0WyJJb2N5cmlsbGljIl0gPSAweDA0MDE7CiAgICAgIHRbIklvZ29uZWsiXSA9IDB4MDEyZTsKICAgICAgdFsiSW90YSJdID0gMHgwMzk5OwogICAgICB0WyJJb3RhYWZyaWNhbiJdID0gMHgwMTk2OwogICAgICB0WyJJb3RhZGllcmVzaXMiXSA9IDB4MDNhYTsKICAgICAgdFsiSW90YXRvbm9zIl0gPSAweDAzOGE7CiAgICAgIHRbIklzbWFsbCJdID0gMHhmNzY5OwogICAgICB0WyJJc3Ryb2tlIl0gPSAweDAxOTc7CiAgICAgIHRbIkl0aWxkZSJdID0gMHgwMTI4OwogICAgICB0WyJJdGlsZGViZWxvdyJdID0gMHgxZTJjOwogICAgICB0WyJJemhpdHNhY3lyaWxsaWMiXSA9IDB4MDQ3NDsKICAgICAgdFsiSXpoaXRzYWRibGdyYXZlY3lyaWxsaWMiXSA9IDB4MDQ3NjsKICAgICAgdFsiSiJdID0gMHgwMDRhOwogICAgICB0WyJKYWFybWVuaWFuIl0gPSAweDA1NDE7CiAgICAgIHRbIkpjaXJjbGUiXSA9IDB4MjRiZjsKICAgICAgdFsiSmNpcmN1bWZsZXgiXSA9IDB4MDEzNDsKICAgICAgdFsiSmVjeXJpbGxpYyJdID0gMHgwNDA4OwogICAgICB0WyJKaGVoYXJtZW5pYW4iXSA9IDB4MDU0YjsKICAgICAgdFsiSm1vbm9zcGFjZSJdID0gMHhmZjJhOwogICAgICB0WyJKc21hbGwiXSA9IDB4Zjc2YTsKICAgICAgdFsiSyJdID0gMHgwMDRiOwogICAgICB0WyJLQnNxdWFyZSJdID0gMHgzMzg1OwogICAgICB0WyJLS3NxdWFyZSJdID0gMHgzM2NkOwogICAgICB0WyJLYWJhc2hraXJjeXJpbGxpYyJdID0gMHgwNGEwOwogICAgICB0WyJLYWN1dGUiXSA9IDB4MWUzMDsKICAgICAgdFsiS2FjeXJpbGxpYyJdID0gMHgwNDFhOwogICAgICB0WyJLYWRlc2NlbmRlcmN5cmlsbGljIl0gPSAweDA0OWE7CiAgICAgIHRbIkthaG9va2N5cmlsbGljIl0gPSAweDA0YzM7CiAgICAgIHRbIkthcHBhIl0gPSAweDAzOWE7CiAgICAgIHRbIkthc3Ryb2tlY3lyaWxsaWMiXSA9IDB4MDQ5ZTsKICAgICAgdFsiS2F2ZXJ0aWNhbHN0cm9rZWN5cmlsbGljIl0gPSAweDA0OWM7CiAgICAgIHRbIktjYXJvbiJdID0gMHgwMWU4OwogICAgICB0WyJLY2VkaWxsYSJdID0gMHgwMTM2OwogICAgICB0WyJLY2lyY2xlIl0gPSAweDI0YzA7CiAgICAgIHRbIktjb21tYWFjY2VudCJdID0gMHgwMTM2OwogICAgICB0WyJLZG90YmVsb3ciXSA9IDB4MWUzMjsKICAgICAgdFsiS2VoYXJtZW5pYW4iXSA9IDB4MDU1NDsKICAgICAgdFsiS2VuYXJtZW5pYW4iXSA9IDB4MDUzZjsKICAgICAgdFsiS2hhY3lyaWxsaWMiXSA9IDB4MDQyNTsKICAgICAgdFsiS2hlaWNvcHRpYyJdID0gMHgwM2U2OwogICAgICB0WyJLaG9vayJdID0gMHgwMTk4OwogICAgICB0WyJLamVjeXJpbGxpYyJdID0gMHgwNDBjOwogICAgICB0WyJLbGluZWJlbG93Il0gPSAweDFlMzQ7CiAgICAgIHRbIkttb25vc3BhY2UiXSA9IDB4ZmYyYjsKICAgICAgdFsiS29wcGFjeXJpbGxpYyJdID0gMHgwNDgwOwogICAgICB0WyJLb3BwYWdyZWVrIl0gPSAweDAzZGU7CiAgICAgIHRbIktzaWN5cmlsbGljIl0gPSAweDA0NmU7CiAgICAgIHRbIktzbWFsbCJdID0gMHhmNzZiOwogICAgICB0WyJMIl0gPSAweDAwNGM7CiAgICAgIHRbIkxKIl0gPSAweDAxYzc7CiAgICAgIHRbIkxMIl0gPSAweGY2YmY7CiAgICAgIHRbIkxhY3V0ZSJdID0gMHgwMTM5OwogICAgICB0WyJMYW1iZGEiXSA9IDB4MDM5YjsKICAgICAgdFsiTGNhcm9uIl0gPSAweDAxM2Q7CiAgICAgIHRbIkxjZWRpbGxhIl0gPSAweDAxM2I7CiAgICAgIHRbIkxjaXJjbGUiXSA9IDB4MjRjMTsKICAgICAgdFsiTGNpcmN1bWZsZXhiZWxvdyJdID0gMHgxZTNjOwogICAgICB0WyJMY29tbWFhY2NlbnQiXSA9IDB4MDEzYjsKICAgICAgdFsiTGRvdCJdID0gMHgwMTNmOwogICAgICB0WyJMZG90YWNjZW50Il0gPSAweDAxM2Y7CiAgICAgIHRbIkxkb3RiZWxvdyJdID0gMHgxZTM2OwogICAgICB0WyJMZG90YmVsb3dtYWNyb24iXSA9IDB4MWUzODsKICAgICAgdFsiTGl3bmFybWVuaWFuIl0gPSAweDA1M2M7CiAgICAgIHRbIkxqIl0gPSAweDAxYzg7CiAgICAgIHRbIkxqZWN5cmlsbGljIl0gPSAweDA0MDk7CiAgICAgIHRbIkxsaW5lYmVsb3ciXSA9IDB4MWUzYTsKICAgICAgdFsiTG1vbm9zcGFjZSJdID0gMHhmZjJjOwogICAgICB0WyJMc2xhc2giXSA9IDB4MDE0MTsKICAgICAgdFsiTHNsYXNoc21hbGwiXSA9IDB4ZjZmOTsKICAgICAgdFsiTHNtYWxsIl0gPSAweGY3NmM7CiAgICAgIHRbIk0iXSA9IDB4MDA0ZDsKICAgICAgdFsiTUJzcXVhcmUiXSA9IDB4MzM4NjsKICAgICAgdFsiTWFjcm9uIl0gPSAweGY2ZDA7CiAgICAgIHRbIk1hY3JvbnNtYWxsIl0gPSAweGY3YWY7CiAgICAgIHRbIk1hY3V0ZSJdID0gMHgxZTNlOwogICAgICB0WyJNY2lyY2xlIl0gPSAweDI0YzI7CiAgICAgIHRbIk1kb3RhY2NlbnQiXSA9IDB4MWU0MDsKICAgICAgdFsiTWRvdGJlbG93Il0gPSAweDFlNDI7CiAgICAgIHRbIk1lbmFybWVuaWFuIl0gPSAweDA1NDQ7CiAgICAgIHRbIk1tb25vc3BhY2UiXSA9IDB4ZmYyZDsKICAgICAgdFsiTXNtYWxsIl0gPSAweGY3NmQ7CiAgICAgIHRbIk10dXJuZWQiXSA9IDB4MDE5YzsKICAgICAgdFsiTXUiXSA9IDB4MDM5YzsKICAgICAgdFsiTiJdID0gMHgwMDRlOwogICAgICB0WyJOSiJdID0gMHgwMWNhOwogICAgICB0WyJOYWN1dGUiXSA9IDB4MDE0MzsKICAgICAgdFsiTmNhcm9uIl0gPSAweDAxNDc7CiAgICAgIHRbIk5jZWRpbGxhIl0gPSAweDAxNDU7CiAgICAgIHRbIk5jaXJjbGUiXSA9IDB4MjRjMzsKICAgICAgdFsiTmNpcmN1bWZsZXhiZWxvdyJdID0gMHgxZTRhOwogICAgICB0WyJOY29tbWFhY2NlbnQiXSA9IDB4MDE0NTsKICAgICAgdFsiTmRvdGFjY2VudCJdID0gMHgxZTQ0OwogICAgICB0WyJOZG90YmVsb3ciXSA9IDB4MWU0NjsKICAgICAgdFsiTmhvb2tsZWZ0Il0gPSAweDAxOWQ7CiAgICAgIHRbIk5pbmVyb21hbiJdID0gMHgyMTY4OwogICAgICB0WyJOaiJdID0gMHgwMWNiOwogICAgICB0WyJOamVjeXJpbGxpYyJdID0gMHgwNDBhOwogICAgICB0WyJObGluZWJlbG93Il0gPSAweDFlNDg7CiAgICAgIHRbIk5tb25vc3BhY2UiXSA9IDB4ZmYyZTsKICAgICAgdFsiTm93YXJtZW5pYW4iXSA9IDB4MDU0NjsKICAgICAgdFsiTnNtYWxsIl0gPSAweGY3NmU7CiAgICAgIHRbIk50aWxkZSJdID0gMHgwMGQxOwogICAgICB0WyJOdGlsZGVzbWFsbCJdID0gMHhmN2YxOwogICAgICB0WyJOdSJdID0gMHgwMzlkOwogICAgICB0WyJPIl0gPSAweDAwNGY7CiAgICAgIHRbIk9FIl0gPSAweDAxNTI7CiAgICAgIHRbIk9Fc21hbGwiXSA9IDB4ZjZmYTsKICAgICAgdFsiT2FjdXRlIl0gPSAweDAwZDM7CiAgICAgIHRbIk9hY3V0ZXNtYWxsIl0gPSAweGY3ZjM7CiAgICAgIHRbIk9iYXJyZWRjeXJpbGxpYyJdID0gMHgwNGU4OwogICAgICB0WyJPYmFycmVkZGllcmVzaXNjeXJpbGxpYyJdID0gMHgwNGVhOwogICAgICB0WyJPYnJldmUiXSA9IDB4MDE0ZTsKICAgICAgdFsiT2Nhcm9uIl0gPSAweDAxZDE7CiAgICAgIHRbIk9jZW50ZXJlZHRpbGRlIl0gPSAweDAxOWY7CiAgICAgIHRbIk9jaXJjbGUiXSA9IDB4MjRjNDsKICAgICAgdFsiT2NpcmN1bWZsZXgiXSA9IDB4MDBkNDsKICAgICAgdFsiT2NpcmN1bWZsZXhhY3V0ZSJdID0gMHgxZWQwOwogICAgICB0WyJPY2lyY3VtZmxleGRvdGJlbG93Il0gPSAweDFlZDg7CiAgICAgIHRbIk9jaXJjdW1mbGV4Z3JhdmUiXSA9IDB4MWVkMjsKICAgICAgdFsiT2NpcmN1bWZsZXhob29rYWJvdmUiXSA9IDB4MWVkNDsKICAgICAgdFsiT2NpcmN1bWZsZXhzbWFsbCJdID0gMHhmN2Y0OwogICAgICB0WyJPY2lyY3VtZmxleHRpbGRlIl0gPSAweDFlZDY7CiAgICAgIHRbIk9jeXJpbGxpYyJdID0gMHgwNDFlOwogICAgICB0WyJPZGJsYWN1dGUiXSA9IDB4MDE1MDsKICAgICAgdFsiT2RibGdyYXZlIl0gPSAweDAyMGM7CiAgICAgIHRbIk9kaWVyZXNpcyJdID0gMHgwMGQ2OwogICAgICB0WyJPZGllcmVzaXNjeXJpbGxpYyJdID0gMHgwNGU2OwogICAgICB0WyJPZGllcmVzaXNzbWFsbCJdID0gMHhmN2Y2OwogICAgICB0WyJPZG90YmVsb3ciXSA9IDB4MWVjYzsKICAgICAgdFsiT2dvbmVrc21hbGwiXSA9IDB4ZjZmYjsKICAgICAgdFsiT2dyYXZlIl0gPSAweDAwZDI7CiAgICAgIHRbIk9ncmF2ZXNtYWxsIl0gPSAweGY3ZjI7CiAgICAgIHRbIk9oYXJtZW5pYW4iXSA9IDB4MDU1NTsKICAgICAgdFsiT2htIl0gPSAweDIxMjY7CiAgICAgIHRbIk9ob29rYWJvdmUiXSA9IDB4MWVjZTsKICAgICAgdFsiT2hvcm4iXSA9IDB4MDFhMDsKICAgICAgdFsiT2hvcm5hY3V0ZSJdID0gMHgxZWRhOwogICAgICB0WyJPaG9ybmRvdGJlbG93Il0gPSAweDFlZTI7CiAgICAgIHRbIk9ob3JuZ3JhdmUiXSA9IDB4MWVkYzsKICAgICAgdFsiT2hvcm5ob29rYWJvdmUiXSA9IDB4MWVkZTsKICAgICAgdFsiT2hvcm50aWxkZSJdID0gMHgxZWUwOwogICAgICB0WyJPaHVuZ2FydW1sYXV0Il0gPSAweDAxNTA7CiAgICAgIHRbIk9pIl0gPSAweDAxYTI7CiAgICAgIHRbIk9pbnZlcnRlZGJyZXZlIl0gPSAweDAyMGU7CiAgICAgIHRbIk9tYWNyb24iXSA9IDB4MDE0YzsKICAgICAgdFsiT21hY3JvbmFjdXRlIl0gPSAweDFlNTI7CiAgICAgIHRbIk9tYWNyb25ncmF2ZSJdID0gMHgxZTUwOwogICAgICB0WyJPbWVnYSJdID0gMHgyMTI2OwogICAgICB0WyJPbWVnYWN5cmlsbGljIl0gPSAweDA0NjA7CiAgICAgIHRbIk9tZWdhZ3JlZWsiXSA9IDB4MDNhOTsKICAgICAgdFsiT21lZ2Fyb3VuZGN5cmlsbGljIl0gPSAweDA0N2E7CiAgICAgIHRbIk9tZWdhdGl0bG9jeXJpbGxpYyJdID0gMHgwNDdjOwogICAgICB0WyJPbWVnYXRvbm9zIl0gPSAweDAzOGY7CiAgICAgIHRbIk9taWNyb24iXSA9IDB4MDM5ZjsKICAgICAgdFsiT21pY3JvbnRvbm9zIl0gPSAweDAzOGM7CiAgICAgIHRbIk9tb25vc3BhY2UiXSA9IDB4ZmYyZjsKICAgICAgdFsiT25lcm9tYW4iXSA9IDB4MjE2MDsKICAgICAgdFsiT29nb25layJdID0gMHgwMWVhOwogICAgICB0WyJPb2dvbmVrbWFjcm9uIl0gPSAweDAxZWM7CiAgICAgIHRbIk9vcGVuIl0gPSAweDAxODY7CiAgICAgIHRbIk9zbGFzaCJdID0gMHgwMGQ4OwogICAgICB0WyJPc2xhc2hhY3V0ZSJdID0gMHgwMWZlOwogICAgICB0WyJPc2xhc2hzbWFsbCJdID0gMHhmN2Y4OwogICAgICB0WyJPc21hbGwiXSA9IDB4Zjc2ZjsKICAgICAgdFsiT3N0cm9rZWFjdXRlIl0gPSAweDAxZmU7CiAgICAgIHRbIk90Y3lyaWxsaWMiXSA9IDB4MDQ3ZTsKICAgICAgdFsiT3RpbGRlIl0gPSAweDAwZDU7CiAgICAgIHRbIk90aWxkZWFjdXRlIl0gPSAweDFlNGM7CiAgICAgIHRbIk90aWxkZWRpZXJlc2lzIl0gPSAweDFlNGU7CiAgICAgIHRbIk90aWxkZXNtYWxsIl0gPSAweGY3ZjU7CiAgICAgIHRbIlAiXSA9IDB4MDA1MDsKICAgICAgdFsiUGFjdXRlIl0gPSAweDFlNTQ7CiAgICAgIHRbIlBjaXJjbGUiXSA9IDB4MjRjNTsKICAgICAgdFsiUGRvdGFjY2VudCJdID0gMHgxZTU2OwogICAgICB0WyJQZWN5cmlsbGljIl0gPSAweDA0MWY7CiAgICAgIHRbIlBlaGFybWVuaWFuIl0gPSAweDA1NGE7CiAgICAgIHRbIlBlbWlkZGxlaG9va2N5cmlsbGljIl0gPSAweDA0YTY7CiAgICAgIHRbIlBoaSJdID0gMHgwM2E2OwogICAgICB0WyJQaG9vayJdID0gMHgwMWE0OwogICAgICB0WyJQaSJdID0gMHgwM2EwOwogICAgICB0WyJQaXdyYXJtZW5pYW4iXSA9IDB4MDU1MzsKICAgICAgdFsiUG1vbm9zcGFjZSJdID0gMHhmZjMwOwogICAgICB0WyJQc2kiXSA9IDB4MDNhODsKICAgICAgdFsiUHNpY3lyaWxsaWMiXSA9IDB4MDQ3MDsKICAgICAgdFsiUHNtYWxsIl0gPSAweGY3NzA7CiAgICAgIHRbIlEiXSA9IDB4MDA1MTsKICAgICAgdFsiUWNpcmNsZSJdID0gMHgyNGM2OwogICAgICB0WyJRbW9ub3NwYWNlIl0gPSAweGZmMzE7CiAgICAgIHRbIlFzbWFsbCJdID0gMHhmNzcxOwogICAgICB0WyJSIl0gPSAweDAwNTI7CiAgICAgIHRbIlJhYXJtZW5pYW4iXSA9IDB4MDU0YzsKICAgICAgdFsiUmFjdXRlIl0gPSAweDAxNTQ7CiAgICAgIHRbIlJjYXJvbiJdID0gMHgwMTU4OwogICAgICB0WyJSY2VkaWxsYSJdID0gMHgwMTU2OwogICAgICB0WyJSY2lyY2xlIl0gPSAweDI0Yzc7CiAgICAgIHRbIlJjb21tYWFjY2VudCJdID0gMHgwMTU2OwogICAgICB0WyJSZGJsZ3JhdmUiXSA9IDB4MDIxMDsKICAgICAgdFsiUmRvdGFjY2VudCJdID0gMHgxZTU4OwogICAgICB0WyJSZG90YmVsb3ciXSA9IDB4MWU1YTsKICAgICAgdFsiUmRvdGJlbG93bWFjcm9uIl0gPSAweDFlNWM7CiAgICAgIHRbIlJlaGFybWVuaWFuIl0gPSAweDA1NTA7CiAgICAgIHRbIlJmcmFrdHVyIl0gPSAweDIxMWM7CiAgICAgIHRbIlJobyJdID0gMHgwM2ExOwogICAgICB0WyJSaW5nc21hbGwiXSA9IDB4ZjZmYzsKICAgICAgdFsiUmludmVydGVkYnJldmUiXSA9IDB4MDIxMjsKICAgICAgdFsiUmxpbmViZWxvdyJdID0gMHgxZTVlOwogICAgICB0WyJSbW9ub3NwYWNlIl0gPSAweGZmMzI7CiAgICAgIHRbIlJzbWFsbCJdID0gMHhmNzcyOwogICAgICB0WyJSc21hbGxpbnZlcnRlZCJdID0gMHgwMjgxOwogICAgICB0WyJSc21hbGxpbnZlcnRlZHN1cGVyaW9yIl0gPSAweDAyYjY7CiAgICAgIHRbIlMiXSA9IDB4MDA1MzsKICAgICAgdFsiU0YwMTAwMDAiXSA9IDB4MjUwYzsKICAgICAgdFsiU0YwMjAwMDAiXSA9IDB4MjUxNDsKICAgICAgdFsiU0YwMzAwMDAiXSA9IDB4MjUxMDsKICAgICAgdFsiU0YwNDAwMDAiXSA9IDB4MjUxODsKICAgICAgdFsiU0YwNTAwMDAiXSA9IDB4MjUzYzsKICAgICAgdFsiU0YwNjAwMDAiXSA9IDB4MjUyYzsKICAgICAgdFsiU0YwNzAwMDAiXSA9IDB4MjUzNDsKICAgICAgdFsiU0YwODAwMDAiXSA9IDB4MjUxYzsKICAgICAgdFsiU0YwOTAwMDAiXSA9IDB4MjUyNDsKICAgICAgdFsiU0YxMDAwMDAiXSA9IDB4MjUwMDsKICAgICAgdFsiU0YxMTAwMDAiXSA9IDB4MjUwMjsKICAgICAgdFsiU0YxOTAwMDAiXSA9IDB4MjU2MTsKICAgICAgdFsiU0YyMDAwMDAiXSA9IDB4MjU2MjsKICAgICAgdFsiU0YyMTAwMDAiXSA9IDB4MjU1NjsKICAgICAgdFsiU0YyMjAwMDAiXSA9IDB4MjU1NTsKICAgICAgdFsiU0YyMzAwMDAiXSA9IDB4MjU2MzsKICAgICAgdFsiU0YyNDAwMDAiXSA9IDB4MjU1MTsKICAgICAgdFsiU0YyNTAwMDAiXSA9IDB4MjU1NzsKICAgICAgdFsiU0YyNjAwMDAiXSA9IDB4MjU1ZDsKICAgICAgdFsiU0YyNzAwMDAiXSA9IDB4MjU1YzsKICAgICAgdFsiU0YyODAwMDAiXSA9IDB4MjU1YjsKICAgICAgdFsiU0YzNjAwMDAiXSA9IDB4MjU1ZTsKICAgICAgdFsiU0YzNzAwMDAiXSA9IDB4MjU1ZjsKICAgICAgdFsiU0YzODAwMDAiXSA9IDB4MjU1YTsKICAgICAgdFsiU0YzOTAwMDAiXSA9IDB4MjU1NDsKICAgICAgdFsiU0Y0MDAwMDAiXSA9IDB4MjU2OTsKICAgICAgdFsiU0Y0MTAwMDAiXSA9IDB4MjU2NjsKICAgICAgdFsiU0Y0MjAwMDAiXSA9IDB4MjU2MDsKICAgICAgdFsiU0Y0MzAwMDAiXSA9IDB4MjU1MDsKICAgICAgdFsiU0Y0NDAwMDAiXSA9IDB4MjU2YzsKICAgICAgdFsiU0Y0NTAwMDAiXSA9IDB4MjU2NzsKICAgICAgdFsiU0Y0NjAwMDAiXSA9IDB4MjU2ODsKICAgICAgdFsiU0Y0NzAwMDAiXSA9IDB4MjU2NDsKICAgICAgdFsiU0Y0ODAwMDAiXSA9IDB4MjU2NTsKICAgICAgdFsiU0Y0OTAwMDAiXSA9IDB4MjU1OTsKICAgICAgdFsiU0Y1MDAwMDAiXSA9IDB4MjU1ODsKICAgICAgdFsiU0Y1MTAwMDAiXSA9IDB4MjU1MjsKICAgICAgdFsiU0Y1MjAwMDAiXSA9IDB4MjU1MzsKICAgICAgdFsiU0Y1MzAwMDAiXSA9IDB4MjU2YjsKICAgICAgdFsiU0Y1NDAwMDAiXSA9IDB4MjU2YTsKICAgICAgdFsiU2FjdXRlIl0gPSAweDAxNWE7CiAgICAgIHRbIlNhY3V0ZWRvdGFjY2VudCJdID0gMHgxZTY0OwogICAgICB0WyJTYW1waWdyZWVrIl0gPSAweDAzZTA7CiAgICAgIHRbIlNjYXJvbiJdID0gMHgwMTYwOwogICAgICB0WyJTY2Fyb25kb3RhY2NlbnQiXSA9IDB4MWU2NjsKICAgICAgdFsiU2Nhcm9uc21hbGwiXSA9IDB4ZjZmZDsKICAgICAgdFsiU2NlZGlsbGEiXSA9IDB4MDE1ZTsKICAgICAgdFsiU2Nod2EiXSA9IDB4MDE4ZjsKICAgICAgdFsiU2Nod2FjeXJpbGxpYyJdID0gMHgwNGQ4OwogICAgICB0WyJTY2h3YWRpZXJlc2lzY3lyaWxsaWMiXSA9IDB4MDRkYTsKICAgICAgdFsiU2NpcmNsZSJdID0gMHgyNGM4OwogICAgICB0WyJTY2lyY3VtZmxleCJdID0gMHgwMTVjOwogICAgICB0WyJTY29tbWFhY2NlbnQiXSA9IDB4MDIxODsKICAgICAgdFsiU2RvdGFjY2VudCJdID0gMHgxZTYwOwogICAgICB0WyJTZG90YmVsb3ciXSA9IDB4MWU2MjsKICAgICAgdFsiU2RvdGJlbG93ZG90YWNjZW50Il0gPSAweDFlNjg7CiAgICAgIHRbIlNlaGFybWVuaWFuIl0gPSAweDA1NGQ7CiAgICAgIHRbIlNldmVucm9tYW4iXSA9IDB4MjE2NjsKICAgICAgdFsiU2hhYXJtZW5pYW4iXSA9IDB4MDU0NzsKICAgICAgdFsiU2hhY3lyaWxsaWMiXSA9IDB4MDQyODsKICAgICAgdFsiU2hjaGFjeXJpbGxpYyJdID0gMHgwNDI5OwogICAgICB0WyJTaGVpY29wdGljIl0gPSAweDAzZTI7CiAgICAgIHRbIlNoaGFjeXJpbGxpYyJdID0gMHgwNGJhOwogICAgICB0WyJTaGltYWNvcHRpYyJdID0gMHgwM2VjOwogICAgICB0WyJTaWdtYSJdID0gMHgwM2EzOwogICAgICB0WyJTaXhyb21hbiJdID0gMHgyMTY1OwogICAgICB0WyJTbW9ub3NwYWNlIl0gPSAweGZmMzM7CiAgICAgIHRbIlNvZnRzaWduY3lyaWxsaWMiXSA9IDB4MDQyYzsKICAgICAgdFsiU3NtYWxsIl0gPSAweGY3NzM7CiAgICAgIHRbIlN0aWdtYWdyZWVrIl0gPSAweDAzZGE7CiAgICAgIHRbIlQiXSA9IDB4MDA1NDsKICAgICAgdFsiVGF1Il0gPSAweDAzYTQ7CiAgICAgIHRbIlRiYXIiXSA9IDB4MDE2NjsKICAgICAgdFsiVGNhcm9uIl0gPSAweDAxNjQ7CiAgICAgIHRbIlRjZWRpbGxhIl0gPSAweDAxNjI7CiAgICAgIHRbIlRjaXJjbGUiXSA9IDB4MjRjOTsKICAgICAgdFsiVGNpcmN1bWZsZXhiZWxvdyJdID0gMHgxZTcwOwogICAgICB0WyJUY29tbWFhY2NlbnQiXSA9IDB4MDE2MjsKICAgICAgdFsiVGRvdGFjY2VudCJdID0gMHgxZTZhOwogICAgICB0WyJUZG90YmVsb3ciXSA9IDB4MWU2YzsKICAgICAgdFsiVGVjeXJpbGxpYyJdID0gMHgwNDIyOwogICAgICB0WyJUZWRlc2NlbmRlcmN5cmlsbGljIl0gPSAweDA0YWM7CiAgICAgIHRbIlRlbnJvbWFuIl0gPSAweDIxNjk7CiAgICAgIHRbIlRldHNlY3lyaWxsaWMiXSA9IDB4MDRiNDsKICAgICAgdFsiVGhldGEiXSA9IDB4MDM5ODsKICAgICAgdFsiVGhvb2siXSA9IDB4MDFhYzsKICAgICAgdFsiVGhvcm4iXSA9IDB4MDBkZTsKICAgICAgdFsiVGhvcm5zbWFsbCJdID0gMHhmN2ZlOwogICAgICB0WyJUaHJlZXJvbWFuIl0gPSAweDIxNjI7CiAgICAgIHRbIlRpbGRlc21hbGwiXSA9IDB4ZjZmZTsKICAgICAgdFsiVGl3bmFybWVuaWFuIl0gPSAweDA1NGY7CiAgICAgIHRbIlRsaW5lYmVsb3ciXSA9IDB4MWU2ZTsKICAgICAgdFsiVG1vbm9zcGFjZSJdID0gMHhmZjM0OwogICAgICB0WyJUb2FybWVuaWFuIl0gPSAweDA1Mzk7CiAgICAgIHRbIlRvbmVmaXZlIl0gPSAweDAxYmM7CiAgICAgIHRbIlRvbmVzaXgiXSA9IDB4MDE4NDsKICAgICAgdFsiVG9uZXR3byJdID0gMHgwMWE3OwogICAgICB0WyJUcmV0cm9mbGV4aG9vayJdID0gMHgwMWFlOwogICAgICB0WyJUc2VjeXJpbGxpYyJdID0gMHgwNDI2OwogICAgICB0WyJUc2hlY3lyaWxsaWMiXSA9IDB4MDQwYjsKICAgICAgdFsiVHNtYWxsIl0gPSAweGY3NzQ7CiAgICAgIHRbIlR3ZWx2ZXJvbWFuIl0gPSAweDIxNmI7CiAgICAgIHRbIlR3b3JvbWFuIl0gPSAweDIxNjE7CiAgICAgIHRbIlUiXSA9IDB4MDA1NTsKICAgICAgdFsiVWFjdXRlIl0gPSAweDAwZGE7CiAgICAgIHRbIlVhY3V0ZXNtYWxsIl0gPSAweGY3ZmE7CiAgICAgIHRbIlVicmV2ZSJdID0gMHgwMTZjOwogICAgICB0WyJVY2Fyb24iXSA9IDB4MDFkMzsKICAgICAgdFsiVWNpcmNsZSJdID0gMHgyNGNhOwogICAgICB0WyJVY2lyY3VtZmxleCJdID0gMHgwMGRiOwogICAgICB0WyJVY2lyY3VtZmxleGJlbG93Il0gPSAweDFlNzY7CiAgICAgIHRbIlVjaXJjdW1mbGV4c21hbGwiXSA9IDB4ZjdmYjsKICAgICAgdFsiVWN5cmlsbGljIl0gPSAweDA0MjM7CiAgICAgIHRbIlVkYmxhY3V0ZSJdID0gMHgwMTcwOwogICAgICB0WyJVZGJsZ3JhdmUiXSA9IDB4MDIxNDsKICAgICAgdFsiVWRpZXJlc2lzIl0gPSAweDAwZGM7CiAgICAgIHRbIlVkaWVyZXNpc2FjdXRlIl0gPSAweDAxZDc7CiAgICAgIHRbIlVkaWVyZXNpc2JlbG93Il0gPSAweDFlNzI7CiAgICAgIHRbIlVkaWVyZXNpc2Nhcm9uIl0gPSAweDAxZDk7CiAgICAgIHRbIlVkaWVyZXNpc2N5cmlsbGljIl0gPSAweDA0ZjA7CiAgICAgIHRbIlVkaWVyZXNpc2dyYXZlIl0gPSAweDAxZGI7CiAgICAgIHRbIlVkaWVyZXNpc21hY3JvbiJdID0gMHgwMWQ1OwogICAgICB0WyJVZGllcmVzaXNzbWFsbCJdID0gMHhmN2ZjOwogICAgICB0WyJVZG90YmVsb3ciXSA9IDB4MWVlNDsKICAgICAgdFsiVWdyYXZlIl0gPSAweDAwZDk7CiAgICAgIHRbIlVncmF2ZXNtYWxsIl0gPSAweGY3Zjk7CiAgICAgIHRbIlVob29rYWJvdmUiXSA9IDB4MWVlNjsKICAgICAgdFsiVWhvcm4iXSA9IDB4MDFhZjsKICAgICAgdFsiVWhvcm5hY3V0ZSJdID0gMHgxZWU4OwogICAgICB0WyJVaG9ybmRvdGJlbG93Il0gPSAweDFlZjA7CiAgICAgIHRbIlVob3JuZ3JhdmUiXSA9IDB4MWVlYTsKICAgICAgdFsiVWhvcm5ob29rYWJvdmUiXSA9IDB4MWVlYzsKICAgICAgdFsiVWhvcm50aWxkZSJdID0gMHgxZWVlOwogICAgICB0WyJVaHVuZ2FydW1sYXV0Il0gPSAweDAxNzA7CiAgICAgIHRbIlVodW5nYXJ1bWxhdXRjeXJpbGxpYyJdID0gMHgwNGYyOwogICAgICB0WyJVaW52ZXJ0ZWRicmV2ZSJdID0gMHgwMjE2OwogICAgICB0WyJVa2N5cmlsbGljIl0gPSAweDA0Nzg7CiAgICAgIHRbIlVtYWNyb24iXSA9IDB4MDE2YTsKICAgICAgdFsiVW1hY3JvbmN5cmlsbGljIl0gPSAweDA0ZWU7CiAgICAgIHRbIlVtYWNyb25kaWVyZXNpcyJdID0gMHgxZTdhOwogICAgICB0WyJVbW9ub3NwYWNlIl0gPSAweGZmMzU7CiAgICAgIHRbIlVvZ29uZWsiXSA9IDB4MDE3MjsKICAgICAgdFsiVXBzaWxvbiJdID0gMHgwM2E1OwogICAgICB0WyJVcHNpbG9uMSJdID0gMHgwM2QyOwogICAgICB0WyJVcHNpbG9uYWN1dGVob29rc3ltYm9sZ3JlZWsiXSA9IDB4MDNkMzsKICAgICAgdFsiVXBzaWxvbmFmcmljYW4iXSA9IDB4MDFiMTsKICAgICAgdFsiVXBzaWxvbmRpZXJlc2lzIl0gPSAweDAzYWI7CiAgICAgIHRbIlVwc2lsb25kaWVyZXNpc2hvb2tzeW1ib2xncmVlayJdID0gMHgwM2Q0OwogICAgICB0WyJVcHNpbG9uaG9va3N5bWJvbCJdID0gMHgwM2QyOwogICAgICB0WyJVcHNpbG9udG9ub3MiXSA9IDB4MDM4ZTsKICAgICAgdFsiVXJpbmciXSA9IDB4MDE2ZTsKICAgICAgdFsiVXNob3J0Y3lyaWxsaWMiXSA9IDB4MDQwZTsKICAgICAgdFsiVXNtYWxsIl0gPSAweGY3NzU7CiAgICAgIHRbIlVzdHJhaWdodGN5cmlsbGljIl0gPSAweDA0YWU7CiAgICAgIHRbIlVzdHJhaWdodHN0cm9rZWN5cmlsbGljIl0gPSAweDA0YjA7CiAgICAgIHRbIlV0aWxkZSJdID0gMHgwMTY4OwogICAgICB0WyJVdGlsZGVhY3V0ZSJdID0gMHgxZTc4OwogICAgICB0WyJVdGlsZGViZWxvdyJdID0gMHgxZTc0OwogICAgICB0WyJWIl0gPSAweDAwNTY7CiAgICAgIHRbIlZjaXJjbGUiXSA9IDB4MjRjYjsKICAgICAgdFsiVmRvdGJlbG93Il0gPSAweDFlN2U7CiAgICAgIHRbIlZlY3lyaWxsaWMiXSA9IDB4MDQxMjsKICAgICAgdFsiVmV3YXJtZW5pYW4iXSA9IDB4MDU0ZTsKICAgICAgdFsiVmhvb2siXSA9IDB4MDFiMjsKICAgICAgdFsiVm1vbm9zcGFjZSJdID0gMHhmZjM2OwogICAgICB0WyJWb2FybWVuaWFuIl0gPSAweDA1NDg7CiAgICAgIHRbIlZzbWFsbCJdID0gMHhmNzc2OwogICAgICB0WyJWdGlsZGUiXSA9IDB4MWU3YzsKICAgICAgdFsiVyJdID0gMHgwMDU3OwogICAgICB0WyJXYWN1dGUiXSA9IDB4MWU4MjsKICAgICAgdFsiV2NpcmNsZSJdID0gMHgyNGNjOwogICAgICB0WyJXY2lyY3VtZmxleCJdID0gMHgwMTc0OwogICAgICB0WyJXZGllcmVzaXMiXSA9IDB4MWU4NDsKICAgICAgdFsiV2RvdGFjY2VudCJdID0gMHgxZTg2OwogICAgICB0WyJXZG90YmVsb3ciXSA9IDB4MWU4ODsKICAgICAgdFsiV2dyYXZlIl0gPSAweDFlODA7CiAgICAgIHRbIldtb25vc3BhY2UiXSA9IDB4ZmYzNzsKICAgICAgdFsiV3NtYWxsIl0gPSAweGY3Nzc7CiAgICAgIHRbIlgiXSA9IDB4MDA1ODsKICAgICAgdFsiWGNpcmNsZSJdID0gMHgyNGNkOwogICAgICB0WyJYZGllcmVzaXMiXSA9IDB4MWU4YzsKICAgICAgdFsiWGRvdGFjY2VudCJdID0gMHgxZThhOwogICAgICB0WyJYZWhhcm1lbmlhbiJdID0gMHgwNTNkOwogICAgICB0WyJYaSJdID0gMHgwMzllOwogICAgICB0WyJYbW9ub3NwYWNlIl0gPSAweGZmMzg7CiAgICAgIHRbIlhzbWFsbCJdID0gMHhmNzc4OwogICAgICB0WyJZIl0gPSAweDAwNTk7CiAgICAgIHRbIllhY3V0ZSJdID0gMHgwMGRkOwogICAgICB0WyJZYWN1dGVzbWFsbCJdID0gMHhmN2ZkOwogICAgICB0WyJZYXRjeXJpbGxpYyJdID0gMHgwNDYyOwogICAgICB0WyJZY2lyY2xlIl0gPSAweDI0Y2U7CiAgICAgIHRbIlljaXJjdW1mbGV4Il0gPSAweDAxNzY7CiAgICAgIHRbIllkaWVyZXNpcyJdID0gMHgwMTc4OwogICAgICB0WyJZZGllcmVzaXNzbWFsbCJdID0gMHhmN2ZmOwogICAgICB0WyJZZG90YWNjZW50Il0gPSAweDFlOGU7CiAgICAgIHRbIllkb3RiZWxvdyJdID0gMHgxZWY0OwogICAgICB0WyJZZXJpY3lyaWxsaWMiXSA9IDB4MDQyYjsKICAgICAgdFsiWWVydWRpZXJlc2lzY3lyaWxsaWMiXSA9IDB4MDRmODsKICAgICAgdFsiWWdyYXZlIl0gPSAweDFlZjI7CiAgICAgIHRbIllob29rIl0gPSAweDAxYjM7CiAgICAgIHRbIllob29rYWJvdmUiXSA9IDB4MWVmNjsKICAgICAgdFsiWWlhcm1lbmlhbiJdID0gMHgwNTQ1OwogICAgICB0WyJZaWN5cmlsbGljIl0gPSAweDA0MDc7CiAgICAgIHRbIllpd25hcm1lbmlhbiJdID0gMHgwNTUyOwogICAgICB0WyJZbW9ub3NwYWNlIl0gPSAweGZmMzk7CiAgICAgIHRbIllzbWFsbCJdID0gMHhmNzc5OwogICAgICB0WyJZdGlsZGUiXSA9IDB4MWVmODsKICAgICAgdFsiWXVzYmlnY3lyaWxsaWMiXSA9IDB4MDQ2YTsKICAgICAgdFsiWXVzYmlnaW90aWZpZWRjeXJpbGxpYyJdID0gMHgwNDZjOwogICAgICB0WyJZdXNsaXR0bGVjeXJpbGxpYyJdID0gMHgwNDY2OwogICAgICB0WyJZdXNsaXR0bGVpb3RpZmllZGN5cmlsbGljIl0gPSAweDA0Njg7CiAgICAgIHRbIloiXSA9IDB4MDA1YTsKICAgICAgdFsiWmFhcm1lbmlhbiJdID0gMHgwNTM2OwogICAgICB0WyJaYWN1dGUiXSA9IDB4MDE3OTsKICAgICAgdFsiWmNhcm9uIl0gPSAweDAxN2Q7CiAgICAgIHRbIlpjYXJvbnNtYWxsIl0gPSAweGY2ZmY7CiAgICAgIHRbIlpjaXJjbGUiXSA9IDB4MjRjZjsKICAgICAgdFsiWmNpcmN1bWZsZXgiXSA9IDB4MWU5MDsKICAgICAgdFsiWmRvdCJdID0gMHgwMTdiOwogICAgICB0WyJaZG90YWNjZW50Il0gPSAweDAxN2I7CiAgICAgIHRbIlpkb3RiZWxvdyJdID0gMHgxZTkyOwogICAgICB0WyJaZWN5cmlsbGljIl0gPSAweDA0MTc7CiAgICAgIHRbIlplZGVzY2VuZGVyY3lyaWxsaWMiXSA9IDB4MDQ5ODsKICAgICAgdFsiWmVkaWVyZXNpc2N5cmlsbGljIl0gPSAweDA0ZGU7CiAgICAgIHRbIlpldGEiXSA9IDB4MDM5NjsKICAgICAgdFsiWmhlYXJtZW5pYW4iXSA9IDB4MDUzYTsKICAgICAgdFsiWmhlYnJldmVjeXJpbGxpYyJdID0gMHgwNGMxOwogICAgICB0WyJaaGVjeXJpbGxpYyJdID0gMHgwNDE2OwogICAgICB0WyJaaGVkZXNjZW5kZXJjeXJpbGxpYyJdID0gMHgwNDk2OwogICAgICB0WyJaaGVkaWVyZXNpc2N5cmlsbGljIl0gPSAweDA0ZGM7CiAgICAgIHRbIlpsaW5lYmVsb3ciXSA9IDB4MWU5NDsKICAgICAgdFsiWm1vbm9zcGFjZSJdID0gMHhmZjNhOwogICAgICB0WyJac21hbGwiXSA9IDB4Zjc3YTsKICAgICAgdFsiWnN0cm9rZSJdID0gMHgwMWI1OwogICAgICB0WyJhIl0gPSAweDAwNjE7CiAgICAgIHRbImFhYmVuZ2FsaSJdID0gMHgwOTg2OwogICAgICB0WyJhYWN1dGUiXSA9IDB4MDBlMTsKICAgICAgdFsiYWFkZXZhIl0gPSAweDA5MDY7CiAgICAgIHRbImFhZ3VqYXJhdGkiXSA9IDB4MGE4NjsKICAgICAgdFsiYWFndXJtdWtoaSJdID0gMHgwYTA2OwogICAgICB0WyJhYW1hdHJhZ3VybXVraGkiXSA9IDB4MGEzZTsKICAgICAgdFsiYWFydXNxdWFyZSJdID0gMHgzMzAzOwogICAgICB0WyJhYXZvd2Vsc2lnbmJlbmdhbGkiXSA9IDB4MDliZTsKICAgICAgdFsiYWF2b3dlbHNpZ25kZXZhIl0gPSAweDA5M2U7CiAgICAgIHRbImFhdm93ZWxzaWduZ3VqYXJhdGkiXSA9IDB4MGFiZTsKICAgICAgdFsiYWJicmV2aWF0aW9ubWFya2FybWVuaWFuIl0gPSAweDA1NWY7CiAgICAgIHRbImFiYnJldmlhdGlvbnNpZ25kZXZhIl0gPSAweDA5NzA7CiAgICAgIHRbImFiZW5nYWxpIl0gPSAweDA5ODU7CiAgICAgIHRbImFib3BvbW9mbyJdID0gMHgzMTFhOwogICAgICB0WyJhYnJldmUiXSA9IDB4MDEwMzsKICAgICAgdFsiYWJyZXZlYWN1dGUiXSA9IDB4MWVhZjsKICAgICAgdFsiYWJyZXZlY3lyaWxsaWMiXSA9IDB4MDRkMTsKICAgICAgdFsiYWJyZXZlZG90YmVsb3ciXSA9IDB4MWViNzsKICAgICAgdFsiYWJyZXZlZ3JhdmUiXSA9IDB4MWViMTsKICAgICAgdFsiYWJyZXZlaG9va2Fib3ZlIl0gPSAweDFlYjM7CiAgICAgIHRbImFicmV2ZXRpbGRlIl0gPSAweDFlYjU7CiAgICAgIHRbImFjYXJvbiJdID0gMHgwMWNlOwogICAgICB0WyJhY2lyY2xlIl0gPSAweDI0ZDA7CiAgICAgIHRbImFjaXJjdW1mbGV4Il0gPSAweDAwZTI7CiAgICAgIHRbImFjaXJjdW1mbGV4YWN1dGUiXSA9IDB4MWVhNTsKICAgICAgdFsiYWNpcmN1bWZsZXhkb3RiZWxvdyJdID0gMHgxZWFkOwogICAgICB0WyJhY2lyY3VtZmxleGdyYXZlIl0gPSAweDFlYTc7CiAgICAgIHRbImFjaXJjdW1mbGV4aG9va2Fib3ZlIl0gPSAweDFlYTk7CiAgICAgIHRbImFjaXJjdW1mbGV4dGlsZGUiXSA9IDB4MWVhYjsKICAgICAgdFsiYWN1dGUiXSA9IDB4MDBiNDsKICAgICAgdFsiYWN1dGViZWxvd2NtYiJdID0gMHgwMzE3OwogICAgICB0WyJhY3V0ZWNtYiJdID0gMHgwMzAxOwogICAgICB0WyJhY3V0ZWNvbWIiXSA9IDB4MDMwMTsKICAgICAgdFsiYWN1dGVkZXZhIl0gPSAweDA5NTQ7CiAgICAgIHRbImFjdXRlbG93bW9kIl0gPSAweDAyY2Y7CiAgICAgIHRbImFjdXRldG9uZWNtYiJdID0gMHgwMzQxOwogICAgICB0WyJhY3lyaWxsaWMiXSA9IDB4MDQzMDsKICAgICAgdFsiYWRibGdyYXZlIl0gPSAweDAyMDE7CiAgICAgIHRbImFkZGFrZ3VybXVraGkiXSA9IDB4MGE3MTsKICAgICAgdFsiYWRldmEiXSA9IDB4MDkwNTsKICAgICAgdFsiYWRpZXJlc2lzIl0gPSAweDAwZTQ7CiAgICAgIHRbImFkaWVyZXNpc2N5cmlsbGljIl0gPSAweDA0ZDM7CiAgICAgIHRbImFkaWVyZXNpc21hY3JvbiJdID0gMHgwMWRmOwogICAgICB0WyJhZG90YmVsb3ciXSA9IDB4MWVhMTsKICAgICAgdFsiYWRvdG1hY3JvbiJdID0gMHgwMWUxOwogICAgICB0WyJhZSJdID0gMHgwMGU2OwogICAgICB0WyJhZWFjdXRlIl0gPSAweDAxZmQ7CiAgICAgIHRbImFla29yZWFuIl0gPSAweDMxNTA7CiAgICAgIHRbImFlbWFjcm9uIl0gPSAweDAxZTM7CiAgICAgIHRbImFmaWkwMDIwOCJdID0gMHgyMDE1OwogICAgICB0WyJhZmlpMDg5NDEiXSA9IDB4MjBhNDsKICAgICAgdFsiYWZpaTEwMDE3Il0gPSAweDA0MTA7CiAgICAgIHRbImFmaWkxMDAxOCJdID0gMHgwNDExOwogICAgICB0WyJhZmlpMTAwMTkiXSA9IDB4MDQxMjsKICAgICAgdFsiYWZpaTEwMDIwIl0gPSAweDA0MTM7CiAgICAgIHRbImFmaWkxMDAyMSJdID0gMHgwNDE0OwogICAgICB0WyJhZmlpMTAwMjIiXSA9IDB4MDQxNTsKICAgICAgdFsiYWZpaTEwMDIzIl0gPSAweDA0MDE7CiAgICAgIHRbImFmaWkxMDAyNCJdID0gMHgwNDE2OwogICAgICB0WyJhZmlpMTAwMjUiXSA9IDB4MDQxNzsKICAgICAgdFsiYWZpaTEwMDI2Il0gPSAweDA0MTg7CiAgICAgIHRbImFmaWkxMDAyNyJdID0gMHgwNDE5OwogICAgICB0WyJhZmlpMTAwMjgiXSA9IDB4MDQxYTsKICAgICAgdFsiYWZpaTEwMDI5Il0gPSAweDA0MWI7CiAgICAgIHRbImFmaWkxMDAzMCJdID0gMHgwNDFjOwogICAgICB0WyJhZmlpMTAwMzEiXSA9IDB4MDQxZDsKICAgICAgdFsiYWZpaTEwMDMyIl0gPSAweDA0MWU7CiAgICAgIHRbImFmaWkxMDAzMyJdID0gMHgwNDFmOwogICAgICB0WyJhZmlpMTAwMzQiXSA9IDB4MDQyMDsKICAgICAgdFsiYWZpaTEwMDM1Il0gPSAweDA0MjE7CiAgICAgIHRbImFmaWkxMDAzNiJdID0gMHgwNDIyOwogICAgICB0WyJhZmlpMTAwMzciXSA9IDB4MDQyMzsKICAgICAgdFsiYWZpaTEwMDM4Il0gPSAweDA0MjQ7CiAgICAgIHRbImFmaWkxMDAzOSJdID0gMHgwNDI1OwogICAgICB0WyJhZmlpMTAwNDAiXSA9IDB4MDQyNjsKICAgICAgdFsiYWZpaTEwMDQxIl0gPSAweDA0Mjc7CiAgICAgIHRbImFmaWkxMDA0MiJdID0gMHgwNDI4OwogICAgICB0WyJhZmlpMTAwNDMiXSA9IDB4MDQyOTsKICAgICAgdFsiYWZpaTEwMDQ0Il0gPSAweDA0MmE7CiAgICAgIHRbImFmaWkxMDA0NSJdID0gMHgwNDJiOwogICAgICB0WyJhZmlpMTAwNDYiXSA9IDB4MDQyYzsKICAgICAgdFsiYWZpaTEwMDQ3Il0gPSAweDA0MmQ7CiAgICAgIHRbImFmaWkxMDA0OCJdID0gMHgwNDJlOwogICAgICB0WyJhZmlpMTAwNDkiXSA9IDB4MDQyZjsKICAgICAgdFsiYWZpaTEwMDUwIl0gPSAweDA0OTA7CiAgICAgIHRbImFmaWkxMDA1MSJdID0gMHgwNDAyOwogICAgICB0WyJhZmlpMTAwNTIiXSA9IDB4MDQwMzsKICAgICAgdFsiYWZpaTEwMDUzIl0gPSAweDA0MDQ7CiAgICAgIHRbImFmaWkxMDA1NCJdID0gMHgwNDA1OwogICAgICB0WyJhZmlpMTAwNTUiXSA9IDB4MDQwNjsKICAgICAgdFsiYWZpaTEwMDU2Il0gPSAweDA0MDc7CiAgICAgIHRbImFmaWkxMDA1NyJdID0gMHgwNDA4OwogICAgICB0WyJhZmlpMTAwNTgiXSA9IDB4MDQwOTsKICAgICAgdFsiYWZpaTEwMDU5Il0gPSAweDA0MGE7CiAgICAgIHRbImFmaWkxMDA2MCJdID0gMHgwNDBiOwogICAgICB0WyJhZmlpMTAwNjEiXSA9IDB4MDQwYzsKICAgICAgdFsiYWZpaTEwMDYyIl0gPSAweDA0MGU7CiAgICAgIHRbImFmaWkxMDA2MyJdID0gMHhmNmM0OwogICAgICB0WyJhZmlpMTAwNjQiXSA9IDB4ZjZjNTsKICAgICAgdFsiYWZpaTEwMDY1Il0gPSAweDA0MzA7CiAgICAgIHRbImFmaWkxMDA2NiJdID0gMHgwNDMxOwogICAgICB0WyJhZmlpMTAwNjciXSA9IDB4MDQzMjsKICAgICAgdFsiYWZpaTEwMDY4Il0gPSAweDA0MzM7CiAgICAgIHRbImFmaWkxMDA2OSJdID0gMHgwNDM0OwogICAgICB0WyJhZmlpMTAwNzAiXSA9IDB4MDQzNTsKICAgICAgdFsiYWZpaTEwMDcxIl0gPSAweDA0NTE7CiAgICAgIHRbImFmaWkxMDA3MiJdID0gMHgwNDM2OwogICAgICB0WyJhZmlpMTAwNzMiXSA9IDB4MDQzNzsKICAgICAgdFsiYWZpaTEwMDc0Il0gPSAweDA0Mzg7CiAgICAgIHRbImFmaWkxMDA3NSJdID0gMHgwNDM5OwogICAgICB0WyJhZmlpMTAwNzYiXSA9IDB4MDQzYTsKICAgICAgdFsiYWZpaTEwMDc3Il0gPSAweDA0M2I7CiAgICAgIHRbImFmaWkxMDA3OCJdID0gMHgwNDNjOwogICAgICB0WyJhZmlpMTAwNzkiXSA9IDB4MDQzZDsKICAgICAgdFsiYWZpaTEwMDgwIl0gPSAweDA0M2U7CiAgICAgIHRbImFmaWkxMDA4MSJdID0gMHgwNDNmOwogICAgICB0WyJhZmlpMTAwODIiXSA9IDB4MDQ0MDsKICAgICAgdFsiYWZpaTEwMDgzIl0gPSAweDA0NDE7CiAgICAgIHRbImFmaWkxMDA4NCJdID0gMHgwNDQyOwogICAgICB0WyJhZmlpMTAwODUiXSA9IDB4MDQ0MzsKICAgICAgdFsiYWZpaTEwMDg2Il0gPSAweDA0NDQ7CiAgICAgIHRbImFmaWkxMDA4NyJdID0gMHgwNDQ1OwogICAgICB0WyJhZmlpMTAwODgiXSA9IDB4MDQ0NjsKICAgICAgdFsiYWZpaTEwMDg5Il0gPSAweDA0NDc7CiAgICAgIHRbImFmaWkxMDA5MCJdID0gMHgwNDQ4OwogICAgICB0WyJhZmlpMTAwOTEiXSA9IDB4MDQ0OTsKICAgICAgdFsiYWZpaTEwMDkyIl0gPSAweDA0NGE7CiAgICAgIHRbImFmaWkxMDA5MyJdID0gMHgwNDRiOwogICAgICB0WyJhZmlpMTAwOTQiXSA9IDB4MDQ0YzsKICAgICAgdFsiYWZpaTEwMDk1Il0gPSAweDA0NGQ7CiAgICAgIHRbImFmaWkxMDA5NiJdID0gMHgwNDRlOwogICAgICB0WyJhZmlpMTAwOTciXSA9IDB4MDQ0ZjsKICAgICAgdFsiYWZpaTEwMDk4Il0gPSAweDA0OTE7CiAgICAgIHRbImFmaWkxMDA5OSJdID0gMHgwNDUyOwogICAgICB0WyJhZmlpMTAxMDAiXSA9IDB4MDQ1MzsKICAgICAgdFsiYWZpaTEwMTAxIl0gPSAweDA0NTQ7CiAgICAgIHRbImFmaWkxMDEwMiJdID0gMHgwNDU1OwogICAgICB0WyJhZmlpMTAxMDMiXSA9IDB4MDQ1NjsKICAgICAgdFsiYWZpaTEwMTA0Il0gPSAweDA0NTc7CiAgICAgIHRbImFmaWkxMDEwNSJdID0gMHgwNDU4OwogICAgICB0WyJhZmlpMTAxMDYiXSA9IDB4MDQ1OTsKICAgICAgdFsiYWZpaTEwMTA3Il0gPSAweDA0NWE7CiAgICAgIHRbImFmaWkxMDEwOCJdID0gMHgwNDViOwogICAgICB0WyJhZmlpMTAxMDkiXSA9IDB4MDQ1YzsKICAgICAgdFsiYWZpaTEwMTEwIl0gPSAweDA0NWU7CiAgICAgIHRbImFmaWkxMDE0NSJdID0gMHgwNDBmOwogICAgICB0WyJhZmlpMTAxNDYiXSA9IDB4MDQ2MjsKICAgICAgdFsiYWZpaTEwMTQ3Il0gPSAweDA0NzI7CiAgICAgIHRbImFmaWkxMDE0OCJdID0gMHgwNDc0OwogICAgICB0WyJhZmlpMTAxOTIiXSA9IDB4ZjZjNjsKICAgICAgdFsiYWZpaTEwMTkzIl0gPSAweDA0NWY7CiAgICAgIHRbImFmaWkxMDE5NCJdID0gMHgwNDYzOwogICAgICB0WyJhZmlpMTAxOTUiXSA9IDB4MDQ3MzsKICAgICAgdFsiYWZpaTEwMTk2Il0gPSAweDA0NzU7CiAgICAgIHRbImFmaWkxMDgzMSJdID0gMHhmNmM3OwogICAgICB0WyJhZmlpMTA4MzIiXSA9IDB4ZjZjODsKICAgICAgdFsiYWZpaTEwODQ2Il0gPSAweDA0ZDk7CiAgICAgIHRbImFmaWkyOTkiXSA9IDB4MjAwZTsKICAgICAgdFsiYWZpaTMwMCJdID0gMHgyMDBmOwogICAgICB0WyJhZmlpMzAxIl0gPSAweDIwMGQ7CiAgICAgIHRbImFmaWk1NzM4MSJdID0gMHgwNjZhOwogICAgICB0WyJhZmlpNTczODgiXSA9IDB4MDYwYzsKICAgICAgdFsiYWZpaTU3MzkyIl0gPSAweDA2NjA7CiAgICAgIHRbImFmaWk1NzM5MyJdID0gMHgwNjYxOwogICAgICB0WyJhZmlpNTczOTQiXSA9IDB4MDY2MjsKICAgICAgdFsiYWZpaTU3Mzk1Il0gPSAweDA2NjM7CiAgICAgIHRbImFmaWk1NzM5NiJdID0gMHgwNjY0OwogICAgICB0WyJhZmlpNTczOTciXSA9IDB4MDY2NTsKICAgICAgdFsiYWZpaTU3Mzk4Il0gPSAweDA2NjY7CiAgICAgIHRbImFmaWk1NzM5OSJdID0gMHgwNjY3OwogICAgICB0WyJhZmlpNTc0MDAiXSA9IDB4MDY2ODsKICAgICAgdFsiYWZpaTU3NDAxIl0gPSAweDA2Njk7CiAgICAgIHRbImFmaWk1NzQwMyJdID0gMHgwNjFiOwogICAgICB0WyJhZmlpNTc0MDciXSA9IDB4MDYxZjsKICAgICAgdFsiYWZpaTU3NDA5Il0gPSAweDA2MjE7CiAgICAgIHRbImFmaWk1NzQxMCJdID0gMHgwNjIyOwogICAgICB0WyJhZmlpNTc0MTEiXSA9IDB4MDYyMzsKICAgICAgdFsiYWZpaTU3NDEyIl0gPSAweDA2MjQ7CiAgICAgIHRbImFmaWk1NzQxMyJdID0gMHgwNjI1OwogICAgICB0WyJhZmlpNTc0MTQiXSA9IDB4MDYyNjsKICAgICAgdFsiYWZpaTU3NDE1Il0gPSAweDA2Mjc7CiAgICAgIHRbImFmaWk1NzQxNiJdID0gMHgwNjI4OwogICAgICB0WyJhZmlpNTc0MTciXSA9IDB4MDYyOTsKICAgICAgdFsiYWZpaTU3NDE4Il0gPSAweDA2MmE7CiAgICAgIHRbImFmaWk1NzQxOSJdID0gMHgwNjJiOwogICAgICB0WyJhZmlpNTc0MjAiXSA9IDB4MDYyYzsKICAgICAgdFsiYWZpaTU3NDIxIl0gPSAweDA2MmQ7CiAgICAgIHRbImFmaWk1NzQyMiJdID0gMHgwNjJlOwogICAgICB0WyJhZmlpNTc0MjMiXSA9IDB4MDYyZjsKICAgICAgdFsiYWZpaTU3NDI0Il0gPSAweDA2MzA7CiAgICAgIHRbImFmaWk1NzQyNSJdID0gMHgwNjMxOwogICAgICB0WyJhZmlpNTc0MjYiXSA9IDB4MDYzMjsKICAgICAgdFsiYWZpaTU3NDI3Il0gPSAweDA2MzM7CiAgICAgIHRbImFmaWk1NzQyOCJdID0gMHgwNjM0OwogICAgICB0WyJhZmlpNTc0MjkiXSA9IDB4MDYzNTsKICAgICAgdFsiYWZpaTU3NDMwIl0gPSAweDA2MzY7CiAgICAgIHRbImFmaWk1NzQzMSJdID0gMHgwNjM3OwogICAgICB0WyJhZmlpNTc0MzIiXSA9IDB4MDYzODsKICAgICAgdFsiYWZpaTU3NDMzIl0gPSAweDA2Mzk7CiAgICAgIHRbImFmaWk1NzQzNCJdID0gMHgwNjNhOwogICAgICB0WyJhZmlpNTc0NDAiXSA9IDB4MDY0MDsKICAgICAgdFsiYWZpaTU3NDQxIl0gPSAweDA2NDE7CiAgICAgIHRbImFmaWk1NzQ0MiJdID0gMHgwNjQyOwogICAgICB0WyJhZmlpNTc0NDMiXSA9IDB4MDY0MzsKICAgICAgdFsiYWZpaTU3NDQ0Il0gPSAweDA2NDQ7CiAgICAgIHRbImFmaWk1NzQ0NSJdID0gMHgwNjQ1OwogICAgICB0WyJhZmlpNTc0NDYiXSA9IDB4MDY0NjsKICAgICAgdFsiYWZpaTU3NDQ4Il0gPSAweDA2NDg7CiAgICAgIHRbImFmaWk1NzQ0OSJdID0gMHgwNjQ5OwogICAgICB0WyJhZmlpNTc0NTAiXSA9IDB4MDY0YTsKICAgICAgdFsiYWZpaTU3NDUxIl0gPSAweDA2NGI7CiAgICAgIHRbImFmaWk1NzQ1MiJdID0gMHgwNjRjOwogICAgICB0WyJhZmlpNTc0NTMiXSA9IDB4MDY0ZDsKICAgICAgdFsiYWZpaTU3NDU0Il0gPSAweDA2NGU7CiAgICAgIHRbImFmaWk1NzQ1NSJdID0gMHgwNjRmOwogICAgICB0WyJhZmlpNTc0NTYiXSA9IDB4MDY1MDsKICAgICAgdFsiYWZpaTU3NDU3Il0gPSAweDA2NTE7CiAgICAgIHRbImFmaWk1NzQ1OCJdID0gMHgwNjUyOwogICAgICB0WyJhZmlpNTc0NzAiXSA9IDB4MDY0NzsKICAgICAgdFsiYWZpaTU3NTA1Il0gPSAweDA2YTQ7CiAgICAgIHRbImFmaWk1NzUwNiJdID0gMHgwNjdlOwogICAgICB0WyJhZmlpNTc1MDciXSA9IDB4MDY4NjsKICAgICAgdFsiYWZpaTU3NTA4Il0gPSAweDA2OTg7CiAgICAgIHRbImFmaWk1NzUwOSJdID0gMHgwNmFmOwogICAgICB0WyJhZmlpNTc1MTEiXSA9IDB4MDY3OTsKICAgICAgdFsiYWZpaTU3NTEyIl0gPSAweDA2ODg7CiAgICAgIHRbImFmaWk1NzUxMyJdID0gMHgwNjkxOwogICAgICB0WyJhZmlpNTc1MTQiXSA9IDB4MDZiYTsKICAgICAgdFsiYWZpaTU3NTE5Il0gPSAweDA2ZDI7CiAgICAgIHRbImFmaWk1NzUzNCJdID0gMHgwNmQ1OwogICAgICB0WyJhZmlpNTc2MzYiXSA9IDB4MjBhYTsKICAgICAgdFsiYWZpaTU3NjQ1Il0gPSAweDA1YmU7CiAgICAgIHRbImFmaWk1NzY1OCJdID0gMHgwNWMzOwogICAgICB0WyJhZmlpNTc2NjQiXSA9IDB4MDVkMDsKICAgICAgdFsiYWZpaTU3NjY1Il0gPSAweDA1ZDE7CiAgICAgIHRbImFmaWk1NzY2NiJdID0gMHgwNWQyOwogICAgICB0WyJhZmlpNTc2NjciXSA9IDB4MDVkMzsKICAgICAgdFsiYWZpaTU3NjY4Il0gPSAweDA1ZDQ7CiAgICAgIHRbImFmaWk1NzY2OSJdID0gMHgwNWQ1OwogICAgICB0WyJhZmlpNTc2NzAiXSA9IDB4MDVkNjsKICAgICAgdFsiYWZpaTU3NjcxIl0gPSAweDA1ZDc7CiAgICAgIHRbImFmaWk1NzY3MiJdID0gMHgwNWQ4OwogICAgICB0WyJhZmlpNTc2NzMiXSA9IDB4MDVkOTsKICAgICAgdFsiYWZpaTU3Njc0Il0gPSAweDA1ZGE7CiAgICAgIHRbImFmaWk1NzY3NSJdID0gMHgwNWRiOwogICAgICB0WyJhZmlpNTc2NzYiXSA9IDB4MDVkYzsKICAgICAgdFsiYWZpaTU3Njc3Il0gPSAweDA1ZGQ7CiAgICAgIHRbImFmaWk1NzY3OCJdID0gMHgwNWRlOwogICAgICB0WyJhZmlpNTc2NzkiXSA9IDB4MDVkZjsKICAgICAgdFsiYWZpaTU3NjgwIl0gPSAweDA1ZTA7CiAgICAgIHRbImFmaWk1NzY4MSJdID0gMHgwNWUxOwogICAgICB0WyJhZmlpNTc2ODIiXSA9IDB4MDVlMjsKICAgICAgdFsiYWZpaTU3NjgzIl0gPSAweDA1ZTM7CiAgICAgIHRbImFmaWk1NzY4NCJdID0gMHgwNWU0OwogICAgICB0WyJhZmlpNTc2ODUiXSA9IDB4MDVlNTsKICAgICAgdFsiYWZpaTU3Njg2Il0gPSAweDA1ZTY7CiAgICAgIHRbImFmaWk1NzY4NyJdID0gMHgwNWU3OwogICAgICB0WyJhZmlpNTc2ODgiXSA9IDB4MDVlODsKICAgICAgdFsiYWZpaTU3Njg5Il0gPSAweDA1ZTk7CiAgICAgIHRbImFmaWk1NzY5MCJdID0gMHgwNWVhOwogICAgICB0WyJhZmlpNTc2OTQiXSA9IDB4ZmIyYTsKICAgICAgdFsiYWZpaTU3Njk1Il0gPSAweGZiMmI7CiAgICAgIHRbImFmaWk1NzcwMCJdID0gMHhmYjRiOwogICAgICB0WyJhZmlpNTc3MDUiXSA9IDB4ZmIxZjsKICAgICAgdFsiYWZpaTU3NzE2Il0gPSAweDA1ZjA7CiAgICAgIHRbImFmaWk1NzcxNyJdID0gMHgwNWYxOwogICAgICB0WyJhZmlpNTc3MTgiXSA9IDB4MDVmMjsKICAgICAgdFsiYWZpaTU3NzIzIl0gPSAweGZiMzU7CiAgICAgIHRbImFmaWk1Nzc5MyJdID0gMHgwNWI0OwogICAgICB0WyJhZmlpNTc3OTQiXSA9IDB4MDViNTsKICAgICAgdFsiYWZpaTU3Nzk1Il0gPSAweDA1YjY7CiAgICAgIHRbImFmaWk1Nzc5NiJdID0gMHgwNWJiOwogICAgICB0WyJhZmlpNTc3OTciXSA9IDB4MDViODsKICAgICAgdFsiYWZpaTU3Nzk4Il0gPSAweDA1Yjc7CiAgICAgIHRbImFmaWk1Nzc5OSJdID0gMHgwNWIwOwogICAgICB0WyJhZmlpNTc4MDAiXSA9IDB4MDViMjsKICAgICAgdFsiYWZpaTU3ODAxIl0gPSAweDA1YjE7CiAgICAgIHRbImFmaWk1NzgwMiJdID0gMHgwNWIzOwogICAgICB0WyJhZmlpNTc4MDMiXSA9IDB4MDVjMjsKICAgICAgdFsiYWZpaTU3ODA0Il0gPSAweDA1YzE7CiAgICAgIHRbImFmaWk1NzgwNiJdID0gMHgwNWI5OwogICAgICB0WyJhZmlpNTc4MDciXSA9IDB4MDViYzsKICAgICAgdFsiYWZpaTU3ODM5Il0gPSAweDA1YmQ7CiAgICAgIHRbImFmaWk1Nzg0MSJdID0gMHgwNWJmOwogICAgICB0WyJhZmlpNTc4NDIiXSA9IDB4MDVjMDsKICAgICAgdFsiYWZpaTU3OTI5Il0gPSAweDAyYmM7CiAgICAgIHRbImFmaWk2MTI0OCJdID0gMHgyMTA1OwogICAgICB0WyJhZmlpNjEyODkiXSA9IDB4MjExMzsKICAgICAgdFsiYWZpaTYxMzUyIl0gPSAweDIxMTY7CiAgICAgIHRbImFmaWk2MTU3MyJdID0gMHgyMDJjOwogICAgICB0WyJhZmlpNjE1NzQiXSA9IDB4MjAyZDsKICAgICAgdFsiYWZpaTYxNTc1Il0gPSAweDIwMmU7CiAgICAgIHRbImFmaWk2MTY2NCJdID0gMHgyMDBjOwogICAgICB0WyJhZmlpNjMxNjciXSA9IDB4MDY2ZDsKICAgICAgdFsiYWZpaTY0OTM3Il0gPSAweDAyYmQ7CiAgICAgIHRbImFncmF2ZSJdID0gMHgwMGUwOwogICAgICB0WyJhZ3VqYXJhdGkiXSA9IDB4MGE4NTsKICAgICAgdFsiYWd1cm11a2hpIl0gPSAweDBhMDU7CiAgICAgIHRbImFoaXJhZ2FuYSJdID0gMHgzMDQyOwogICAgICB0WyJhaG9va2Fib3ZlIl0gPSAweDFlYTM7CiAgICAgIHRbImFpYmVuZ2FsaSJdID0gMHgwOTkwOwogICAgICB0WyJhaWJvcG9tb2ZvIl0gPSAweDMxMWU7CiAgICAgIHRbImFpZGV2YSJdID0gMHgwOTEwOwogICAgICB0WyJhaWVjeXJpbGxpYyJdID0gMHgwNGQ1OwogICAgICB0WyJhaWd1amFyYXRpIl0gPSAweDBhOTA7CiAgICAgIHRbImFpZ3VybXVraGkiXSA9IDB4MGExMDsKICAgICAgdFsiYWltYXRyYWd1cm11a2hpIl0gPSAweDBhNDg7CiAgICAgIHRbImFpbmFyYWJpYyJdID0gMHgwNjM5OwogICAgICB0WyJhaW5maW5hbGFyYWJpYyJdID0gMHhmZWNhOwogICAgICB0WyJhaW5pbml0aWFsYXJhYmljIl0gPSAweGZlY2I7CiAgICAgIHRbImFpbm1lZGlhbGFyYWJpYyJdID0gMHhmZWNjOwogICAgICB0WyJhaW52ZXJ0ZWRicmV2ZSJdID0gMHgwMjAzOwogICAgICB0WyJhaXZvd2Vsc2lnbmJlbmdhbGkiXSA9IDB4MDljODsKICAgICAgdFsiYWl2b3dlbHNpZ25kZXZhIl0gPSAweDA5NDg7CiAgICAgIHRbImFpdm93ZWxzaWduZ3VqYXJhdGkiXSA9IDB4MGFjODsKICAgICAgdFsiYWthdGFrYW5hIl0gPSAweDMwYTI7CiAgICAgIHRbImFrYXRha2FuYWhhbGZ3aWR0aCJdID0gMHhmZjcxOwogICAgICB0WyJha29yZWFuIl0gPSAweDMxNGY7CiAgICAgIHRbImFsZWYiXSA9IDB4MDVkMDsKICAgICAgdFsiYWxlZmFyYWJpYyJdID0gMHgwNjI3OwogICAgICB0WyJhbGVmZGFnZXNoaGVicmV3Il0gPSAweGZiMzA7CiAgICAgIHRbImFsZWZmaW5hbGFyYWJpYyJdID0gMHhmZThlOwogICAgICB0WyJhbGVmaGFtemFhYm92ZWFyYWJpYyJdID0gMHgwNjIzOwogICAgICB0WyJhbGVmaGFtemFhYm92ZWZpbmFsYXJhYmljIl0gPSAweGZlODQ7CiAgICAgIHRbImFsZWZoYW16YWJlbG93YXJhYmljIl0gPSAweDA2MjU7CiAgICAgIHRbImFsZWZoYW16YWJlbG93ZmluYWxhcmFiaWMiXSA9IDB4ZmU4ODsKICAgICAgdFsiYWxlZmhlYnJldyJdID0gMHgwNWQwOwogICAgICB0WyJhbGVmbGFtZWRoZWJyZXciXSA9IDB4ZmI0ZjsKICAgICAgdFsiYWxlZm1hZGRhYWJvdmVhcmFiaWMiXSA9IDB4MDYyMjsKICAgICAgdFsiYWxlZm1hZGRhYWJvdmVmaW5hbGFyYWJpYyJdID0gMHhmZTgyOwogICAgICB0WyJhbGVmbWFrc3VyYWFyYWJpYyJdID0gMHgwNjQ5OwogICAgICB0WyJhbGVmbWFrc3VyYWZpbmFsYXJhYmljIl0gPSAweGZlZjA7CiAgICAgIHRbImFsZWZtYWtzdXJhaW5pdGlhbGFyYWJpYyJdID0gMHhmZWYzOwogICAgICB0WyJhbGVmbWFrc3VyYW1lZGlhbGFyYWJpYyJdID0gMHhmZWY0OwogICAgICB0WyJhbGVmcGF0YWhoZWJyZXciXSA9IDB4ZmIyZTsKICAgICAgdFsiYWxlZnFhbWF0c2hlYnJldyJdID0gMHhmYjJmOwogICAgICB0WyJhbGVwaCJdID0gMHgyMTM1OwogICAgICB0WyJhbGxlcXVhbCJdID0gMHgyMjRjOwogICAgICB0WyJhbHBoYSJdID0gMHgwM2IxOwogICAgICB0WyJhbHBoYXRvbm9zIl0gPSAweDAzYWM7CiAgICAgIHRbImFtYWNyb24iXSA9IDB4MDEwMTsKICAgICAgdFsiYW1vbm9zcGFjZSJdID0gMHhmZjQxOwogICAgICB0WyJhbXBlcnNhbmQiXSA9IDB4MDAyNjsKICAgICAgdFsiYW1wZXJzYW5kbW9ub3NwYWNlIl0gPSAweGZmMDY7CiAgICAgIHRbImFtcGVyc2FuZHNtYWxsIl0gPSAweGY3MjY7CiAgICAgIHRbImFtc3F1YXJlIl0gPSAweDMzYzI7CiAgICAgIHRbImFuYm9wb21vZm8iXSA9IDB4MzEyMjsKICAgICAgdFsiYW5nYm9wb21vZm8iXSA9IDB4MzEyNDsKICAgICAgdFsiYW5nYnJhY2tldGxlZnQiXSA9IDB4MzAwODsKICAgICAgdFsiYW5nYnJhY2tldHJpZ2h0Il0gPSAweDMwMDk7CiAgICAgIHRbImFuZ2toYW5raHV0aGFpIl0gPSAweDBlNWE7CiAgICAgIHRbImFuZ2xlIl0gPSAweDIyMjA7CiAgICAgIHRbImFuZ2xlYnJhY2tldGxlZnQiXSA9IDB4MzAwODsKICAgICAgdFsiYW5nbGVicmFja2V0bGVmdHZlcnRpY2FsIl0gPSAweGZlM2Y7CiAgICAgIHRbImFuZ2xlYnJhY2tldHJpZ2h0Il0gPSAweDMwMDk7CiAgICAgIHRbImFuZ2xlYnJhY2tldHJpZ2h0dmVydGljYWwiXSA9IDB4ZmU0MDsKICAgICAgdFsiYW5nbGVsZWZ0Il0gPSAweDIzMjk7CiAgICAgIHRbImFuZ2xlcmlnaHQiXSA9IDB4MjMyYTsKICAgICAgdFsiYW5nc3Ryb20iXSA9IDB4MjEyYjsKICAgICAgdFsiYW5vdGVsZWlhIl0gPSAweDAzODc7CiAgICAgIHRbImFudWRhdHRhZGV2YSJdID0gMHgwOTUyOwogICAgICB0WyJhbnVzdmFyYWJlbmdhbGkiXSA9IDB4MDk4MjsKICAgICAgdFsiYW51c3ZhcmFkZXZhIl0gPSAweDA5MDI7CiAgICAgIHRbImFudXN2YXJhZ3VqYXJhdGkiXSA9IDB4MGE4MjsKICAgICAgdFsiYW9nb25layJdID0gMHgwMTA1OwogICAgICB0WyJhcGFhdG9zcXVhcmUiXSA9IDB4MzMwMDsKICAgICAgdFsiYXBhcmVuIl0gPSAweDI0OWM7CiAgICAgIHRbImFwb3N0cm9waGVhcm1lbmlhbiJdID0gMHgwNTVhOwogICAgICB0WyJhcG9zdHJvcGhlbW9kIl0gPSAweDAyYmM7CiAgICAgIHRbImFwcGxlIl0gPSAweGY4ZmY7CiAgICAgIHRbImFwcHJvYWNoZXMiXSA9IDB4MjI1MDsKICAgICAgdFsiYXBwcm94ZXF1YWwiXSA9IDB4MjI0ODsKICAgICAgdFsiYXBwcm94ZXF1YWxvcmltYWdlIl0gPSAweDIyNTI7CiAgICAgIHRbImFwcHJveGltYXRlbHllcXVhbCJdID0gMHgyMjQ1OwogICAgICB0WyJhcmFlYWVrb3JlYW4iXSA9IDB4MzE4ZTsKICAgICAgdFsiYXJhZWFrb3JlYW4iXSA9IDB4MzE4ZDsKICAgICAgdFsiYXJjIl0gPSAweDIzMTI7CiAgICAgIHRbImFyaWdodGhhbGZyaW5nIl0gPSAweDFlOWE7CiAgICAgIHRbImFyaW5nIl0gPSAweDAwZTU7CiAgICAgIHRbImFyaW5nYWN1dGUiXSA9IDB4MDFmYjsKICAgICAgdFsiYXJpbmdiZWxvdyJdID0gMHgxZTAxOwogICAgICB0WyJhcnJvd2JvdGgiXSA9IDB4MjE5NDsKICAgICAgdFsiYXJyb3dkYXNoZG93biJdID0gMHgyMWUzOwogICAgICB0WyJhcnJvd2Rhc2hsZWZ0Il0gPSAweDIxZTA7CiAgICAgIHRbImFycm93ZGFzaHJpZ2h0Il0gPSAweDIxZTI7CiAgICAgIHRbImFycm93ZGFzaHVwIl0gPSAweDIxZTE7CiAgICAgIHRbImFycm93ZGJsYm90aCJdID0gMHgyMWQ0OwogICAgICB0WyJhcnJvd2RibGRvd24iXSA9IDB4MjFkMzsKICAgICAgdFsiYXJyb3dkYmxsZWZ0Il0gPSAweDIxZDA7CiAgICAgIHRbImFycm93ZGJscmlnaHQiXSA9IDB4MjFkMjsKICAgICAgdFsiYXJyb3dkYmx1cCJdID0gMHgyMWQxOwogICAgICB0WyJhcnJvd2Rvd24iXSA9IDB4MjE5MzsKICAgICAgdFsiYXJyb3dkb3dubGVmdCJdID0gMHgyMTk5OwogICAgICB0WyJhcnJvd2Rvd25yaWdodCJdID0gMHgyMTk4OwogICAgICB0WyJhcnJvd2Rvd253aGl0ZSJdID0gMHgyMWU5OwogICAgICB0WyJhcnJvd2hlYWRkb3dubW9kIl0gPSAweDAyYzU7CiAgICAgIHRbImFycm93aGVhZGxlZnRtb2QiXSA9IDB4MDJjMjsKICAgICAgdFsiYXJyb3doZWFkcmlnaHRtb2QiXSA9IDB4MDJjMzsKICAgICAgdFsiYXJyb3doZWFkdXBtb2QiXSA9IDB4MDJjNDsKICAgICAgdFsiYXJyb3dob3JpemV4Il0gPSAweGY4ZTc7CiAgICAgIHRbImFycm93bGVmdCJdID0gMHgyMTkwOwogICAgICB0WyJhcnJvd2xlZnRkYmwiXSA9IDB4MjFkMDsKICAgICAgdFsiYXJyb3dsZWZ0ZGJsc3Ryb2tlIl0gPSAweDIxY2Q7CiAgICAgIHRbImFycm93bGVmdG92ZXJyaWdodCJdID0gMHgyMWM2OwogICAgICB0WyJhcnJvd2xlZnR3aGl0ZSJdID0gMHgyMWU2OwogICAgICB0WyJhcnJvd3JpZ2h0Il0gPSAweDIxOTI7CiAgICAgIHRbImFycm93cmlnaHRkYmxzdHJva2UiXSA9IDB4MjFjZjsKICAgICAgdFsiYXJyb3dyaWdodGhlYXZ5Il0gPSAweDI3OWU7CiAgICAgIHRbImFycm93cmlnaHRvdmVybGVmdCJdID0gMHgyMWM0OwogICAgICB0WyJhcnJvd3JpZ2h0d2hpdGUiXSA9IDB4MjFlODsKICAgICAgdFsiYXJyb3d0YWJsZWZ0Il0gPSAweDIxZTQ7CiAgICAgIHRbImFycm93dGFicmlnaHQiXSA9IDB4MjFlNTsKICAgICAgdFsiYXJyb3d1cCJdID0gMHgyMTkxOwogICAgICB0WyJhcnJvd3VwZG4iXSA9IDB4MjE5NTsKICAgICAgdFsiYXJyb3d1cGRuYnNlIl0gPSAweDIxYTg7CiAgICAgIHRbImFycm93dXBkb3duYmFzZSJdID0gMHgyMWE4OwogICAgICB0WyJhcnJvd3VwbGVmdCJdID0gMHgyMTk2OwogICAgICB0WyJhcnJvd3VwbGVmdG9mZG93biJdID0gMHgyMWM1OwogICAgICB0WyJhcnJvd3VwcmlnaHQiXSA9IDB4MjE5NzsKICAgICAgdFsiYXJyb3d1cHdoaXRlIl0gPSAweDIxZTc7CiAgICAgIHRbImFycm93dmVydGV4Il0gPSAweGY4ZTY7CiAgICAgIHRbImFzY2lpY2lyY3VtIl0gPSAweDAwNWU7CiAgICAgIHRbImFzY2lpY2lyY3VtbW9ub3NwYWNlIl0gPSAweGZmM2U7CiAgICAgIHRbImFzY2lpdGlsZGUiXSA9IDB4MDA3ZTsKICAgICAgdFsiYXNjaWl0aWxkZW1vbm9zcGFjZSJdID0gMHhmZjVlOwogICAgICB0WyJhc2NyaXB0Il0gPSAweDAyNTE7CiAgICAgIHRbImFzY3JpcHR0dXJuZWQiXSA9IDB4MDI1MjsKICAgICAgdFsiYXNtYWxsaGlyYWdhbmEiXSA9IDB4MzA0MTsKICAgICAgdFsiYXNtYWxsa2F0YWthbmEiXSA9IDB4MzBhMTsKICAgICAgdFsiYXNtYWxsa2F0YWthbmFoYWxmd2lkdGgiXSA9IDB4ZmY2NzsKICAgICAgdFsiYXN0ZXJpc2siXSA9IDB4MDAyYTsKICAgICAgdFsiYXN0ZXJpc2thbHRvbmVhcmFiaWMiXSA9IDB4MDY2ZDsKICAgICAgdFsiYXN0ZXJpc2thcmFiaWMiXSA9IDB4MDY2ZDsKICAgICAgdFsiYXN0ZXJpc2ttYXRoIl0gPSAweDIyMTc7CiAgICAgIHRbImFzdGVyaXNrbW9ub3NwYWNlIl0gPSAweGZmMGE7CiAgICAgIHRbImFzdGVyaXNrc21hbGwiXSA9IDB4ZmU2MTsKICAgICAgdFsiYXN0ZXJpc20iXSA9IDB4MjA0MjsKICAgICAgdFsiYXN1cGVyaW9yIl0gPSAweGY2ZTk7CiAgICAgIHRbImFzeW1wdG90aWNhbGx5ZXF1YWwiXSA9IDB4MjI0MzsKICAgICAgdFsiYXQiXSA9IDB4MDA0MDsKICAgICAgdFsiYXRpbGRlIl0gPSAweDAwZTM7CiAgICAgIHRbImF0bW9ub3NwYWNlIl0gPSAweGZmMjA7CiAgICAgIHRbImF0c21hbGwiXSA9IDB4ZmU2YjsKICAgICAgdFsiYXR1cm5lZCJdID0gMHgwMjUwOwogICAgICB0WyJhdWJlbmdhbGkiXSA9IDB4MDk5NDsKICAgICAgdFsiYXVib3BvbW9mbyJdID0gMHgzMTIwOwogICAgICB0WyJhdWRldmEiXSA9IDB4MDkxNDsKICAgICAgdFsiYXVndWphcmF0aSJdID0gMHgwYTk0OwogICAgICB0WyJhdWd1cm11a2hpIl0gPSAweDBhMTQ7CiAgICAgIHRbImF1bGVuZ3RobWFya2JlbmdhbGkiXSA9IDB4MDlkNzsKICAgICAgdFsiYXVtYXRyYWd1cm11a2hpIl0gPSAweDBhNGM7CiAgICAgIHRbImF1dm93ZWxzaWduYmVuZ2FsaSJdID0gMHgwOWNjOwogICAgICB0WyJhdXZvd2Vsc2lnbmRldmEiXSA9IDB4MDk0YzsKICAgICAgdFsiYXV2b3dlbHNpZ25ndWphcmF0aSJdID0gMHgwYWNjOwogICAgICB0WyJhdmFncmFoYWRldmEiXSA9IDB4MDkzZDsKICAgICAgdFsiYXliYXJtZW5pYW4iXSA9IDB4MDU2MTsKICAgICAgdFsiYXlpbiJdID0gMHgwNWUyOwogICAgICB0WyJheWluYWx0b25laGVicmV3Il0gPSAweGZiMjA7CiAgICAgIHRbImF5aW5oZWJyZXciXSA9IDB4MDVlMjsKICAgICAgdFsiYiJdID0gMHgwMDYyOwogICAgICB0WyJiYWJlbmdhbGkiXSA9IDB4MDlhYzsKICAgICAgdFsiYmFja3NsYXNoIl0gPSAweDAwNWM7CiAgICAgIHRbImJhY2tzbGFzaG1vbm9zcGFjZSJdID0gMHhmZjNjOwogICAgICB0WyJiYWRldmEiXSA9IDB4MDkyYzsKICAgICAgdFsiYmFndWphcmF0aSJdID0gMHgwYWFjOwogICAgICB0WyJiYWd1cm11a2hpIl0gPSAweDBhMmM7CiAgICAgIHRbImJhaGlyYWdhbmEiXSA9IDB4MzA3MDsKICAgICAgdFsiYmFodHRoYWkiXSA9IDB4MGUzZjsKICAgICAgdFsiYmFrYXRha2FuYSJdID0gMHgzMGQwOwogICAgICB0WyJiYXIiXSA9IDB4MDA3YzsKICAgICAgdFsiYmFybW9ub3NwYWNlIl0gPSAweGZmNWM7CiAgICAgIHRbImJib3BvbW9mbyJdID0gMHgzMTA1OwogICAgICB0WyJiY2lyY2xlIl0gPSAweDI0ZDE7CiAgICAgIHRbImJkb3RhY2NlbnQiXSA9IDB4MWUwMzsKICAgICAgdFsiYmRvdGJlbG93Il0gPSAweDFlMDU7CiAgICAgIHRbImJlYW1lZHNpeHRlZW50aG5vdGVzIl0gPSAweDI2NmM7CiAgICAgIHRbImJlY2F1c2UiXSA9IDB4MjIzNTsKICAgICAgdFsiYmVjeXJpbGxpYyJdID0gMHgwNDMxOwogICAgICB0WyJiZWhhcmFiaWMiXSA9IDB4MDYyODsKICAgICAgdFsiYmVoZmluYWxhcmFiaWMiXSA9IDB4ZmU5MDsKICAgICAgdFsiYmVoaW5pdGlhbGFyYWJpYyJdID0gMHhmZTkxOwogICAgICB0WyJiZWhpcmFnYW5hIl0gPSAweDMwNzk7CiAgICAgIHRbImJlaG1lZGlhbGFyYWJpYyJdID0gMHhmZTkyOwogICAgICB0WyJiZWhtZWVtaW5pdGlhbGFyYWJpYyJdID0gMHhmYzlmOwogICAgICB0WyJiZWhtZWVtaXNvbGF0ZWRhcmFiaWMiXSA9IDB4ZmMwODsKICAgICAgdFsiYmVobm9vbmZpbmFsYXJhYmljIl0gPSAweGZjNmQ7CiAgICAgIHRbImJla2F0YWthbmEiXSA9IDB4MzBkOTsKICAgICAgdFsiYmVuYXJtZW5pYW4iXSA9IDB4MDU2MjsKICAgICAgdFsiYmV0Il0gPSAweDA1ZDE7CiAgICAgIHRbImJldGEiXSA9IDB4MDNiMjsKICAgICAgdFsiYmV0YXN5bWJvbGdyZWVrIl0gPSAweDAzZDA7CiAgICAgIHRbImJldGRhZ2VzaCJdID0gMHhmYjMxOwogICAgICB0WyJiZXRkYWdlc2hoZWJyZXciXSA9IDB4ZmIzMTsKICAgICAgdFsiYmV0aGVicmV3Il0gPSAweDA1ZDE7CiAgICAgIHRbImJldHJhZmVoZWJyZXciXSA9IDB4ZmI0YzsKICAgICAgdFsiYmhhYmVuZ2FsaSJdID0gMHgwOWFkOwogICAgICB0WyJiaGFkZXZhIl0gPSAweDA5MmQ7CiAgICAgIHRbImJoYWd1amFyYXRpIl0gPSAweDBhYWQ7CiAgICAgIHRbImJoYWd1cm11a2hpIl0gPSAweDBhMmQ7CiAgICAgIHRbImJob29rIl0gPSAweDAyNTM7CiAgICAgIHRbImJpaGlyYWdhbmEiXSA9IDB4MzA3MzsKICAgICAgdFsiYmlrYXRha2FuYSJdID0gMHgzMGQzOwogICAgICB0WyJiaWxhYmlhbGNsaWNrIl0gPSAweDAyOTg7CiAgICAgIHRbImJpbmRpZ3VybXVraGkiXSA9IDB4MGEwMjsKICAgICAgdFsiYmlydXNxdWFyZSJdID0gMHgzMzMxOwogICAgICB0WyJibGFja2NpcmNsZSJdID0gMHgyNWNmOwogICAgICB0WyJibGFja2RpYW1vbmQiXSA9IDB4MjVjNjsKICAgICAgdFsiYmxhY2tkb3ducG9pbnRpbmd0cmlhbmdsZSJdID0gMHgyNWJjOwogICAgICB0WyJibGFja2xlZnRwb2ludGluZ3BvaW50ZXIiXSA9IDB4MjVjNDsKICAgICAgdFsiYmxhY2tsZWZ0cG9pbnRpbmd0cmlhbmdsZSJdID0gMHgyNWMwOwogICAgICB0WyJibGFja2xlbnRpY3VsYXJicmFja2V0bGVmdCJdID0gMHgzMDEwOwogICAgICB0WyJibGFja2xlbnRpY3VsYXJicmFja2V0bGVmdHZlcnRpY2FsIl0gPSAweGZlM2I7CiAgICAgIHRbImJsYWNrbGVudGljdWxhcmJyYWNrZXRyaWdodCJdID0gMHgzMDExOwogICAgICB0WyJibGFja2xlbnRpY3VsYXJicmFja2V0cmlnaHR2ZXJ0aWNhbCJdID0gMHhmZTNjOwogICAgICB0WyJibGFja2xvd2VybGVmdHRyaWFuZ2xlIl0gPSAweDI1ZTM7CiAgICAgIHRbImJsYWNrbG93ZXJyaWdodHRyaWFuZ2xlIl0gPSAweDI1ZTI7CiAgICAgIHRbImJsYWNrcmVjdGFuZ2xlIl0gPSAweDI1YWM7CiAgICAgIHRbImJsYWNrcmlnaHRwb2ludGluZ3BvaW50ZXIiXSA9IDB4MjViYTsKICAgICAgdFsiYmxhY2tyaWdodHBvaW50aW5ndHJpYW5nbGUiXSA9IDB4MjViNjsKICAgICAgdFsiYmxhY2tzbWFsbHNxdWFyZSJdID0gMHgyNWFhOwogICAgICB0WyJibGFja3NtaWxpbmdmYWNlIl0gPSAweDI2M2I7CiAgICAgIHRbImJsYWNrc3F1YXJlIl0gPSAweDI1YTA7CiAgICAgIHRbImJsYWNrc3RhciJdID0gMHgyNjA1OwogICAgICB0WyJibGFja3VwcGVybGVmdHRyaWFuZ2xlIl0gPSAweDI1ZTQ7CiAgICAgIHRbImJsYWNrdXBwZXJyaWdodHRyaWFuZ2xlIl0gPSAweDI1ZTU7CiAgICAgIHRbImJsYWNrdXBwb2ludGluZ3NtYWxsdHJpYW5nbGUiXSA9IDB4MjViNDsKICAgICAgdFsiYmxhY2t1cHBvaW50aW5ndHJpYW5nbGUiXSA9IDB4MjViMjsKICAgICAgdFsiYmxhbmsiXSA9IDB4MjQyMzsKICAgICAgdFsiYmxpbmViZWxvdyJdID0gMHgxZTA3OwogICAgICB0WyJibG9jayJdID0gMHgyNTg4OwogICAgICB0WyJibW9ub3NwYWNlIl0gPSAweGZmNDI7CiAgICAgIHRbImJvYmFpbWFpdGhhaSJdID0gMHgwZTFhOwogICAgICB0WyJib2hpcmFnYW5hIl0gPSAweDMwN2M7CiAgICAgIHRbImJva2F0YWthbmEiXSA9IDB4MzBkYzsKICAgICAgdFsiYnBhcmVuIl0gPSAweDI0OWQ7CiAgICAgIHRbImJxc3F1YXJlIl0gPSAweDMzYzM7CiAgICAgIHRbImJyYWNlZXgiXSA9IDB4ZjhmNDsKICAgICAgdFsiYnJhY2VsZWZ0Il0gPSAweDAwN2I7CiAgICAgIHRbImJyYWNlbGVmdGJ0Il0gPSAweGY4ZjM7CiAgICAgIHRbImJyYWNlbGVmdG1pZCJdID0gMHhmOGYyOwogICAgICB0WyJicmFjZWxlZnRtb25vc3BhY2UiXSA9IDB4ZmY1YjsKICAgICAgdFsiYnJhY2VsZWZ0c21hbGwiXSA9IDB4ZmU1YjsKICAgICAgdFsiYnJhY2VsZWZ0dHAiXSA9IDB4ZjhmMTsKICAgICAgdFsiYnJhY2VsZWZ0dmVydGljYWwiXSA9IDB4ZmUzNzsKICAgICAgdFsiYnJhY2VyaWdodCJdID0gMHgwMDdkOwogICAgICB0WyJicmFjZXJpZ2h0YnQiXSA9IDB4ZjhmZTsKICAgICAgdFsiYnJhY2VyaWdodG1pZCJdID0gMHhmOGZkOwogICAgICB0WyJicmFjZXJpZ2h0bW9ub3NwYWNlIl0gPSAweGZmNWQ7CiAgICAgIHRbImJyYWNlcmlnaHRzbWFsbCJdID0gMHhmZTVjOwogICAgICB0WyJicmFjZXJpZ2h0dHAiXSA9IDB4ZjhmYzsKICAgICAgdFsiYnJhY2VyaWdodHZlcnRpY2FsIl0gPSAweGZlMzg7CiAgICAgIHRbImJyYWNrZXRsZWZ0Il0gPSAweDAwNWI7CiAgICAgIHRbImJyYWNrZXRsZWZ0YnQiXSA9IDB4ZjhmMDsKICAgICAgdFsiYnJhY2tldGxlZnRleCJdID0gMHhmOGVmOwogICAgICB0WyJicmFja2V0bGVmdG1vbm9zcGFjZSJdID0gMHhmZjNiOwogICAgICB0WyJicmFja2V0bGVmdHRwIl0gPSAweGY4ZWU7CiAgICAgIHRbImJyYWNrZXRyaWdodCJdID0gMHgwMDVkOwogICAgICB0WyJicmFja2V0cmlnaHRidCJdID0gMHhmOGZiOwogICAgICB0WyJicmFja2V0cmlnaHRleCJdID0gMHhmOGZhOwogICAgICB0WyJicmFja2V0cmlnaHRtb25vc3BhY2UiXSA9IDB4ZmYzZDsKICAgICAgdFsiYnJhY2tldHJpZ2h0dHAiXSA9IDB4ZjhmOTsKICAgICAgdFsiYnJldmUiXSA9IDB4MDJkODsKICAgICAgdFsiYnJldmViZWxvd2NtYiJdID0gMHgwMzJlOwogICAgICB0WyJicmV2ZWNtYiJdID0gMHgwMzA2OwogICAgICB0WyJicmV2ZWludmVydGVkYmVsb3djbWIiXSA9IDB4MDMyZjsKICAgICAgdFsiYnJldmVpbnZlcnRlZGNtYiJdID0gMHgwMzExOwogICAgICB0WyJicmV2ZWludmVydGVkZG91YmxlY21iIl0gPSAweDAzNjE7CiAgICAgIHRbImJyaWRnZWJlbG93Y21iIl0gPSAweDAzMmE7CiAgICAgIHRbImJyaWRnZWludmVydGVkYmVsb3djbWIiXSA9IDB4MDMzYTsKICAgICAgdFsiYnJva2VuYmFyIl0gPSAweDAwYTY7CiAgICAgIHRbImJzdHJva2UiXSA9IDB4MDE4MDsKICAgICAgdFsiYnN1cGVyaW9yIl0gPSAweGY2ZWE7CiAgICAgIHRbImJ0b3BiYXIiXSA9IDB4MDE4MzsKICAgICAgdFsiYnVoaXJhZ2FuYSJdID0gMHgzMDc2OwogICAgICB0WyJidWthdGFrYW5hIl0gPSAweDMwZDY7CiAgICAgIHRbImJ1bGxldCJdID0gMHgyMDIyOwogICAgICB0WyJidWxsZXRpbnZlcnNlIl0gPSAweDI1ZDg7CiAgICAgIHRbImJ1bGxldG9wZXJhdG9yIl0gPSAweDIyMTk7CiAgICAgIHRbImJ1bGxzZXllIl0gPSAweDI1Y2U7CiAgICAgIHRbImMiXSA9IDB4MDA2MzsKICAgICAgdFsiY2Fhcm1lbmlhbiJdID0gMHgwNTZlOwogICAgICB0WyJjYWJlbmdhbGkiXSA9IDB4MDk5YTsKICAgICAgdFsiY2FjdXRlIl0gPSAweDAxMDc7CiAgICAgIHRbImNhZGV2YSJdID0gMHgwOTFhOwogICAgICB0WyJjYWd1amFyYXRpIl0gPSAweDBhOWE7CiAgICAgIHRbImNhZ3VybXVraGkiXSA9IDB4MGExYTsKICAgICAgdFsiY2Fsc3F1YXJlIl0gPSAweDMzODg7CiAgICAgIHRbImNhbmRyYWJpbmR1YmVuZ2FsaSJdID0gMHgwOTgxOwogICAgICB0WyJjYW5kcmFiaW5kdWNtYiJdID0gMHgwMzEwOwogICAgICB0WyJjYW5kcmFiaW5kdWRldmEiXSA9IDB4MDkwMTsKICAgICAgdFsiY2FuZHJhYmluZHVndWphcmF0aSJdID0gMHgwYTgxOwogICAgICB0WyJjYXBzbG9jayJdID0gMHgyMWVhOwogICAgICB0WyJjYXJlb2YiXSA9IDB4MjEwNTsKICAgICAgdFsiY2Fyb24iXSA9IDB4MDJjNzsKICAgICAgdFsiY2Fyb25iZWxvd2NtYiJdID0gMHgwMzJjOwogICAgICB0WyJjYXJvbmNtYiJdID0gMHgwMzBjOwogICAgICB0WyJjYXJyaWFnZXJldHVybiJdID0gMHgyMWI1OwogICAgICB0WyJjYm9wb21vZm8iXSA9IDB4MzExODsKICAgICAgdFsiY2Nhcm9uIl0gPSAweDAxMGQ7CiAgICAgIHRbImNjZWRpbGxhIl0gPSAweDAwZTc7CiAgICAgIHRbImNjZWRpbGxhYWN1dGUiXSA9IDB4MWUwOTsKICAgICAgdFsiY2NpcmNsZSJdID0gMHgyNGQyOwogICAgICB0WyJjY2lyY3VtZmxleCJdID0gMHgwMTA5OwogICAgICB0WyJjY3VybCJdID0gMHgwMjU1OwogICAgICB0WyJjZG90Il0gPSAweDAxMGI7CiAgICAgIHRbImNkb3RhY2NlbnQiXSA9IDB4MDEwYjsKICAgICAgdFsiY2RzcXVhcmUiXSA9IDB4MzNjNTsKICAgICAgdFsiY2VkaWxsYSJdID0gMHgwMGI4OwogICAgICB0WyJjZWRpbGxhY21iIl0gPSAweDAzMjc7CiAgICAgIHRbImNlbnQiXSA9IDB4MDBhMjsKICAgICAgdFsiY2VudGlncmFkZSJdID0gMHgyMTAzOwogICAgICB0WyJjZW50aW5mZXJpb3IiXSA9IDB4ZjZkZjsKICAgICAgdFsiY2VudG1vbm9zcGFjZSJdID0gMHhmZmUwOwogICAgICB0WyJjZW50b2xkc3R5bGUiXSA9IDB4ZjdhMjsKICAgICAgdFsiY2VudHN1cGVyaW9yIl0gPSAweGY2ZTA7CiAgICAgIHRbImNoYWFybWVuaWFuIl0gPSAweDA1Nzk7CiAgICAgIHRbImNoYWJlbmdhbGkiXSA9IDB4MDk5YjsKICAgICAgdFsiY2hhZGV2YSJdID0gMHgwOTFiOwogICAgICB0WyJjaGFndWphcmF0aSJdID0gMHgwYTliOwogICAgICB0WyJjaGFndXJtdWtoaSJdID0gMHgwYTFiOwogICAgICB0WyJjaGJvcG9tb2ZvIl0gPSAweDMxMTQ7CiAgICAgIHRbImNoZWFia2hhc2lhbmN5cmlsbGljIl0gPSAweDA0YmQ7CiAgICAgIHRbImNoZWNrbWFyayJdID0gMHgyNzEzOwogICAgICB0WyJjaGVjeXJpbGxpYyJdID0gMHgwNDQ3OwogICAgICB0WyJjaGVkZXNjZW5kZXJhYmtoYXNpYW5jeXJpbGxpYyJdID0gMHgwNGJmOwogICAgICB0WyJjaGVkZXNjZW5kZXJjeXJpbGxpYyJdID0gMHgwNGI3OwogICAgICB0WyJjaGVkaWVyZXNpc2N5cmlsbGljIl0gPSAweDA0ZjU7CiAgICAgIHRbImNoZWhhcm1lbmlhbiJdID0gMHgwNTczOwogICAgICB0WyJjaGVraGFrYXNzaWFuY3lyaWxsaWMiXSA9IDB4MDRjYzsKICAgICAgdFsiY2hldmVydGljYWxzdHJva2VjeXJpbGxpYyJdID0gMHgwNGI5OwogICAgICB0WyJjaGkiXSA9IDB4MDNjNzsKICAgICAgdFsiY2hpZXVjaGFjaXJjbGVrb3JlYW4iXSA9IDB4MzI3NzsKICAgICAgdFsiY2hpZXVjaGFwYXJlbmtvcmVhbiJdID0gMHgzMjE3OwogICAgICB0WyJjaGlldWNoY2lyY2xla29yZWFuIl0gPSAweDMyNjk7CiAgICAgIHRbImNoaWV1Y2hrb3JlYW4iXSA9IDB4MzE0YTsKICAgICAgdFsiY2hpZXVjaHBhcmVua29yZWFuIl0gPSAweDMyMDk7CiAgICAgIHRbImNob2NoYW5ndGhhaSJdID0gMHgwZTBhOwogICAgICB0WyJjaG9jaGFudGhhaSJdID0gMHgwZTA4OwogICAgICB0WyJjaG9jaGluZ3RoYWkiXSA9IDB4MGUwOTsKICAgICAgdFsiY2hvY2hvZXRoYWkiXSA9IDB4MGUwYzsKICAgICAgdFsiY2hvb2siXSA9IDB4MDE4ODsKICAgICAgdFsiY2lldWNhY2lyY2xla29yZWFuIl0gPSAweDMyNzY7CiAgICAgIHRbImNpZXVjYXBhcmVua29yZWFuIl0gPSAweDMyMTY7CiAgICAgIHRbImNpZXVjY2lyY2xla29yZWFuIl0gPSAweDMyNjg7CiAgICAgIHRbImNpZXVja29yZWFuIl0gPSAweDMxNDg7CiAgICAgIHRbImNpZXVjcGFyZW5rb3JlYW4iXSA9IDB4MzIwODsKICAgICAgdFsiY2lldWN1cGFyZW5rb3JlYW4iXSA9IDB4MzIxYzsKICAgICAgdFsiY2lyY2xlIl0gPSAweDI1Y2I7CiAgICAgIHRbImNpcmNsZWNvcHlydCJdID0gMHgwMGE5OwogICAgICB0WyJjaXJjbGVtdWx0aXBseSJdID0gMHgyMjk3OwogICAgICB0WyJjaXJjbGVvdCJdID0gMHgyMjk5OwogICAgICB0WyJjaXJjbGVwbHVzIl0gPSAweDIyOTU7CiAgICAgIHRbImNpcmNsZXBvc3RhbG1hcmsiXSA9IDB4MzAzNjsKICAgICAgdFsiY2lyY2xld2l0aGxlZnRoYWxmYmxhY2siXSA9IDB4MjVkMDsKICAgICAgdFsiY2lyY2xld2l0aHJpZ2h0aGFsZmJsYWNrIl0gPSAweDI1ZDE7CiAgICAgIHRbImNpcmN1bWZsZXgiXSA9IDB4MDJjNjsKICAgICAgdFsiY2lyY3VtZmxleGJlbG93Y21iIl0gPSAweDAzMmQ7CiAgICAgIHRbImNpcmN1bWZsZXhjbWIiXSA9IDB4MDMwMjsKICAgICAgdFsiY2xlYXIiXSA9IDB4MjMyNzsKICAgICAgdFsiY2xpY2thbHZlb2xhciJdID0gMHgwMWMyOwogICAgICB0WyJjbGlja2RlbnRhbCJdID0gMHgwMWMwOwogICAgICB0WyJjbGlja2xhdGVyYWwiXSA9IDB4MDFjMTsKICAgICAgdFsiY2xpY2tyZXRyb2ZsZXgiXSA9IDB4MDFjMzsKICAgICAgdFsiY2x1YiJdID0gMHgyNjYzOwogICAgICB0WyJjbHVic3VpdGJsYWNrIl0gPSAweDI2NjM7CiAgICAgIHRbImNsdWJzdWl0d2hpdGUiXSA9IDB4MjY2NzsKICAgICAgdFsiY21jdWJlZHNxdWFyZSJdID0gMHgzM2E0OwogICAgICB0WyJjbW9ub3NwYWNlIl0gPSAweGZmNDM7CiAgICAgIHRbImNtc3F1YXJlZHNxdWFyZSJdID0gMHgzM2EwOwogICAgICB0WyJjb2FybWVuaWFuIl0gPSAweDA1ODE7CiAgICAgIHRbImNvbG9uIl0gPSAweDAwM2E7CiAgICAgIHRbImNvbG9ubW9uZXRhcnkiXSA9IDB4MjBhMTsKICAgICAgdFsiY29sb25tb25vc3BhY2UiXSA9IDB4ZmYxYTsKICAgICAgdFsiY29sb25zaWduIl0gPSAweDIwYTE7CiAgICAgIHRbImNvbG9uc21hbGwiXSA9IDB4ZmU1NTsKICAgICAgdFsiY29sb250cmlhbmd1bGFyaGFsZm1vZCJdID0gMHgwMmQxOwogICAgICB0WyJjb2xvbnRyaWFuZ3VsYXJtb2QiXSA9IDB4MDJkMDsKICAgICAgdFsiY29tbWEiXSA9IDB4MDAyYzsKICAgICAgdFsiY29tbWFhYm92ZWNtYiJdID0gMHgwMzEzOwogICAgICB0WyJjb21tYWFib3ZlcmlnaHRjbWIiXSA9IDB4MDMxNTsKICAgICAgdFsiY29tbWFhY2NlbnQiXSA9IDB4ZjZjMzsKICAgICAgdFsiY29tbWFhcmFiaWMiXSA9IDB4MDYwYzsKICAgICAgdFsiY29tbWFhcm1lbmlhbiJdID0gMHgwNTVkOwogICAgICB0WyJjb21tYWluZmVyaW9yIl0gPSAweGY2ZTE7CiAgICAgIHRbImNvbW1hbW9ub3NwYWNlIl0gPSAweGZmMGM7CiAgICAgIHRbImNvbW1hcmV2ZXJzZWRhYm92ZWNtYiJdID0gMHgwMzE0OwogICAgICB0WyJjb21tYXJldmVyc2VkbW9kIl0gPSAweDAyYmQ7CiAgICAgIHRbImNvbW1hc21hbGwiXSA9IDB4ZmU1MDsKICAgICAgdFsiY29tbWFzdXBlcmlvciJdID0gMHhmNmUyOwogICAgICB0WyJjb21tYXR1cm5lZGFib3ZlY21iIl0gPSAweDAzMTI7CiAgICAgIHRbImNvbW1hdHVybmVkbW9kIl0gPSAweDAyYmI7CiAgICAgIHRbImNvbXBhc3MiXSA9IDB4MjYzYzsKICAgICAgdFsiY29uZ3J1ZW50Il0gPSAweDIyNDU7CiAgICAgIHRbImNvbnRvdXJpbnRlZ3JhbCJdID0gMHgyMjJlOwogICAgICB0WyJjb250cm9sIl0gPSAweDIzMDM7CiAgICAgIHRbImNvbnRyb2xBQ0siXSA9IDB4MDAwNjsKICAgICAgdFsiY29udHJvbEJFTCJdID0gMHgwMDA3OwogICAgICB0WyJjb250cm9sQlMiXSA9IDB4MDAwODsKICAgICAgdFsiY29udHJvbENBTiJdID0gMHgwMDE4OwogICAgICB0WyJjb250cm9sQ1IiXSA9IDB4MDAwZDsKICAgICAgdFsiY29udHJvbERDMSJdID0gMHgwMDExOwogICAgICB0WyJjb250cm9sREMyIl0gPSAweDAwMTI7CiAgICAgIHRbImNvbnRyb2xEQzMiXSA9IDB4MDAxMzsKICAgICAgdFsiY29udHJvbERDNCJdID0gMHgwMDE0OwogICAgICB0WyJjb250cm9sREVMIl0gPSAweDAwN2Y7CiAgICAgIHRbImNvbnRyb2xETEUiXSA9IDB4MDAxMDsKICAgICAgdFsiY29udHJvbEVNIl0gPSAweDAwMTk7CiAgICAgIHRbImNvbnRyb2xFTlEiXSA9IDB4MDAwNTsKICAgICAgdFsiY29udHJvbEVPVCJdID0gMHgwMDA0OwogICAgICB0WyJjb250cm9sRVNDIl0gPSAweDAwMWI7CiAgICAgIHRbImNvbnRyb2xFVEIiXSA9IDB4MDAxNzsKICAgICAgdFsiY29udHJvbEVUWCJdID0gMHgwMDAzOwogICAgICB0WyJjb250cm9sRkYiXSA9IDB4MDAwYzsKICAgICAgdFsiY29udHJvbEZTIl0gPSAweDAwMWM7CiAgICAgIHRbImNvbnRyb2xHUyJdID0gMHgwMDFkOwogICAgICB0WyJjb250cm9sSFQiXSA9IDB4MDAwOTsKICAgICAgdFsiY29udHJvbExGIl0gPSAweDAwMGE7CiAgICAgIHRbImNvbnRyb2xOQUsiXSA9IDB4MDAxNTsKICAgICAgdFsiY29udHJvbE5VTEwiXSA9IDB4MDAwMDsKICAgICAgdFsiY29udHJvbFJTIl0gPSAweDAwMWU7CiAgICAgIHRbImNvbnRyb2xTSSJdID0gMHgwMDBmOwogICAgICB0WyJjb250cm9sU08iXSA9IDB4MDAwZTsKICAgICAgdFsiY29udHJvbFNPVCJdID0gMHgwMDAyOwogICAgICB0WyJjb250cm9sU1RYIl0gPSAweDAwMDE7CiAgICAgIHRbImNvbnRyb2xTVUIiXSA9IDB4MDAxYTsKICAgICAgdFsiY29udHJvbFNZTiJdID0gMHgwMDE2OwogICAgICB0WyJjb250cm9sVVMiXSA9IDB4MDAxZjsKICAgICAgdFsiY29udHJvbFZUIl0gPSAweDAwMGI7CiAgICAgIHRbImNvcHlyaWdodCJdID0gMHgwMGE5OwogICAgICB0WyJjb3B5cmlnaHRzYW5zIl0gPSAweGY4ZTk7CiAgICAgIHRbImNvcHlyaWdodHNlcmlmIl0gPSAweGY2ZDk7CiAgICAgIHRbImNvcm5lcmJyYWNrZXRsZWZ0Il0gPSAweDMwMGM7CiAgICAgIHRbImNvcm5lcmJyYWNrZXRsZWZ0aGFsZndpZHRoIl0gPSAweGZmNjI7CiAgICAgIHRbImNvcm5lcmJyYWNrZXRsZWZ0dmVydGljYWwiXSA9IDB4ZmU0MTsKICAgICAgdFsiY29ybmVyYnJhY2tldHJpZ2h0Il0gPSAweDMwMGQ7CiAgICAgIHRbImNvcm5lcmJyYWNrZXRyaWdodGhhbGZ3aWR0aCJdID0gMHhmZjYzOwogICAgICB0WyJjb3JuZXJicmFja2V0cmlnaHR2ZXJ0aWNhbCJdID0gMHhmZTQyOwogICAgICB0WyJjb3Jwb3JhdGlvbnNxdWFyZSJdID0gMHgzMzdmOwogICAgICB0WyJjb3NxdWFyZSJdID0gMHgzM2M3OwogICAgICB0WyJjb3Zlcmtnc3F1YXJlIl0gPSAweDMzYzY7CiAgICAgIHRbImNwYXJlbiJdID0gMHgyNDllOwogICAgICB0WyJjcnV6ZWlybyJdID0gMHgyMGEyOwogICAgICB0WyJjc3RyZXRjaGVkIl0gPSAweDAyOTc7CiAgICAgIHRbImN1cmx5YW5kIl0gPSAweDIyY2Y7CiAgICAgIHRbImN1cmx5b3IiXSA9IDB4MjJjZTsKICAgICAgdFsiY3VycmVuY3kiXSA9IDB4MDBhNDsKICAgICAgdFsiY3lyQnJldmUiXSA9IDB4ZjZkMTsKICAgICAgdFsiY3lyRmxleCJdID0gMHhmNmQyOwogICAgICB0WyJjeXJicmV2ZSJdID0gMHhmNmQ0OwogICAgICB0WyJjeXJmbGV4Il0gPSAweGY2ZDU7CiAgICAgIHRbImQiXSA9IDB4MDA2NDsKICAgICAgdFsiZGFhcm1lbmlhbiJdID0gMHgwNTY0OwogICAgICB0WyJkYWJlbmdhbGkiXSA9IDB4MDlhNjsKICAgICAgdFsiZGFkYXJhYmljIl0gPSAweDA2MzY7CiAgICAgIHRbImRhZGV2YSJdID0gMHgwOTI2OwogICAgICB0WyJkYWRmaW5hbGFyYWJpYyJdID0gMHhmZWJlOwogICAgICB0WyJkYWRpbml0aWFsYXJhYmljIl0gPSAweGZlYmY7CiAgICAgIHRbImRhZG1lZGlhbGFyYWJpYyJdID0gMHhmZWMwOwogICAgICB0WyJkYWdlc2giXSA9IDB4MDViYzsKICAgICAgdFsiZGFnZXNoaGVicmV3Il0gPSAweDA1YmM7CiAgICAgIHRbImRhZ2dlciJdID0gMHgyMDIwOwogICAgICB0WyJkYWdnZXJkYmwiXSA9IDB4MjAyMTsKICAgICAgdFsiZGFndWphcmF0aSJdID0gMHgwYWE2OwogICAgICB0WyJkYWd1cm11a2hpIl0gPSAweDBhMjY7CiAgICAgIHRbImRhaGlyYWdhbmEiXSA9IDB4MzA2MDsKICAgICAgdFsiZGFrYXRha2FuYSJdID0gMHgzMGMwOwogICAgICB0WyJkYWxhcmFiaWMiXSA9IDB4MDYyZjsKICAgICAgdFsiZGFsZXQiXSA9IDB4MDVkMzsKICAgICAgdFsiZGFsZXRkYWdlc2giXSA9IDB4ZmIzMzsKICAgICAgdFsiZGFsZXRkYWdlc2hoZWJyZXciXSA9IDB4ZmIzMzsKICAgICAgdFsiZGFsZXRoZWJyZXciXSA9IDB4MDVkMzsKICAgICAgdFsiZGFsZmluYWxhcmFiaWMiXSA9IDB4ZmVhYTsKICAgICAgdFsiZGFtbWFhcmFiaWMiXSA9IDB4MDY0ZjsKICAgICAgdFsiZGFtbWFsb3dhcmFiaWMiXSA9IDB4MDY0ZjsKICAgICAgdFsiZGFtbWF0YW5hbHRvbmVhcmFiaWMiXSA9IDB4MDY0YzsKICAgICAgdFsiZGFtbWF0YW5hcmFiaWMiXSA9IDB4MDY0YzsKICAgICAgdFsiZGFuZGEiXSA9IDB4MDk2NDsKICAgICAgdFsiZGFyZ2FoZWJyZXciXSA9IDB4MDVhNzsKICAgICAgdFsiZGFyZ2FsZWZ0aGVicmV3Il0gPSAweDA1YTc7CiAgICAgIHRbImRhc2lhcG5ldW1hdGFjeXJpbGxpY2NtYiJdID0gMHgwNDg1OwogICAgICB0WyJkYmxHcmF2ZSJdID0gMHhmNmQzOwogICAgICB0WyJkYmxhbmdsZWJyYWNrZXRsZWZ0Il0gPSAweDMwMGE7CiAgICAgIHRbImRibGFuZ2xlYnJhY2tldGxlZnR2ZXJ0aWNhbCJdID0gMHhmZTNkOwogICAgICB0WyJkYmxhbmdsZWJyYWNrZXRyaWdodCJdID0gMHgzMDBiOwogICAgICB0WyJkYmxhbmdsZWJyYWNrZXRyaWdodHZlcnRpY2FsIl0gPSAweGZlM2U7CiAgICAgIHRbImRibGFyY2hpbnZlcnRlZGJlbG93Y21iIl0gPSAweDAzMmI7CiAgICAgIHRbImRibGFycm93bGVmdCJdID0gMHgyMWQ0OwogICAgICB0WyJkYmxhcnJvd3JpZ2h0Il0gPSAweDIxZDI7CiAgICAgIHRbImRibGRhbmRhIl0gPSAweDA5NjU7CiAgICAgIHRbImRibGdyYXZlIl0gPSAweGY2ZDY7CiAgICAgIHRbImRibGdyYXZlY21iIl0gPSAweDAzMGY7CiAgICAgIHRbImRibGludGVncmFsIl0gPSAweDIyMmM7CiAgICAgIHRbImRibGxvd2xpbmUiXSA9IDB4MjAxNzsKICAgICAgdFsiZGJsbG93bGluZWNtYiJdID0gMHgwMzMzOwogICAgICB0WyJkYmxvdmVybGluZWNtYiJdID0gMHgwMzNmOwogICAgICB0WyJkYmxwcmltZW1vZCJdID0gMHgwMmJhOwogICAgICB0WyJkYmx2ZXJ0aWNhbGJhciJdID0gMHgyMDE2OwogICAgICB0WyJkYmx2ZXJ0aWNhbGxpbmVhYm92ZWNtYiJdID0gMHgwMzBlOwogICAgICB0WyJkYm9wb21vZm8iXSA9IDB4MzEwOTsKICAgICAgdFsiZGJzcXVhcmUiXSA9IDB4MzNjODsKICAgICAgdFsiZGNhcm9uIl0gPSAweDAxMGY7CiAgICAgIHRbImRjZWRpbGxhIl0gPSAweDFlMTE7CiAgICAgIHRbImRjaXJjbGUiXSA9IDB4MjRkMzsKICAgICAgdFsiZGNpcmN1bWZsZXhiZWxvdyJdID0gMHgxZTEzOwogICAgICB0WyJkY3JvYXQiXSA9IDB4MDExMTsKICAgICAgdFsiZGRhYmVuZ2FsaSJdID0gMHgwOWExOwogICAgICB0WyJkZGFkZXZhIl0gPSAweDA5MjE7CiAgICAgIHRbImRkYWd1amFyYXRpIl0gPSAweDBhYTE7CiAgICAgIHRbImRkYWd1cm11a2hpIl0gPSAweDBhMjE7CiAgICAgIHRbImRkYWxhcmFiaWMiXSA9IDB4MDY4ODsKICAgICAgdFsiZGRhbGZpbmFsYXJhYmljIl0gPSAweGZiODk7CiAgICAgIHRbImRkZGhhZGV2YSJdID0gMHgwOTVjOwogICAgICB0WyJkZGhhYmVuZ2FsaSJdID0gMHgwOWEyOwogICAgICB0WyJkZGhhZGV2YSJdID0gMHgwOTIyOwogICAgICB0WyJkZGhhZ3VqYXJhdGkiXSA9IDB4MGFhMjsKICAgICAgdFsiZGRoYWd1cm11a2hpIl0gPSAweDBhMjI7CiAgICAgIHRbImRkb3RhY2NlbnQiXSA9IDB4MWUwYjsKICAgICAgdFsiZGRvdGJlbG93Il0gPSAweDFlMGQ7CiAgICAgIHRbImRlY2ltYWxzZXBhcmF0b3JhcmFiaWMiXSA9IDB4MDY2YjsKICAgICAgdFsiZGVjaW1hbHNlcGFyYXRvcnBlcnNpYW4iXSA9IDB4MDY2YjsKICAgICAgdFsiZGVjeXJpbGxpYyJdID0gMHgwNDM0OwogICAgICB0WyJkZWdyZWUiXSA9IDB4MDBiMDsKICAgICAgdFsiZGVoaWhlYnJldyJdID0gMHgwNWFkOwogICAgICB0WyJkZWhpcmFnYW5hIl0gPSAweDMwNjc7CiAgICAgIHRbImRlaWNvcHRpYyJdID0gMHgwM2VmOwogICAgICB0WyJkZWthdGFrYW5hIl0gPSAweDMwYzc7CiAgICAgIHRbImRlbGV0ZWxlZnQiXSA9IDB4MjMyYjsKICAgICAgdFsiZGVsZXRlcmlnaHQiXSA9IDB4MjMyNjsKICAgICAgdFsiZGVsdGEiXSA9IDB4MDNiNDsKICAgICAgdFsiZGVsdGF0dXJuZWQiXSA9IDB4MDE4ZDsKICAgICAgdFsiZGVub21pbmF0b3JtaW51c29uZW51bWVyYXRvcmJlbmdhbGkiXSA9IDB4MDlmODsKICAgICAgdFsiZGV6aCJdID0gMHgwMmE0OwogICAgICB0WyJkaGFiZW5nYWxpIl0gPSAweDA5YTc7CiAgICAgIHRbImRoYWRldmEiXSA9IDB4MDkyNzsKICAgICAgdFsiZGhhZ3VqYXJhdGkiXSA9IDB4MGFhNzsKICAgICAgdFsiZGhhZ3VybXVraGkiXSA9IDB4MGEyNzsKICAgICAgdFsiZGhvb2siXSA9IDB4MDI1NzsKICAgICAgdFsiZGlhbHl0aWthdG9ub3MiXSA9IDB4MDM4NTsKICAgICAgdFsiZGlhbHl0aWthdG9ub3NjbWIiXSA9IDB4MDM0NDsKICAgICAgdFsiZGlhbW9uZCJdID0gMHgyNjY2OwogICAgICB0WyJkaWFtb25kc3VpdHdoaXRlIl0gPSAweDI2NjI7CiAgICAgIHRbImRpZXJlc2lzIl0gPSAweDAwYTg7CiAgICAgIHRbImRpZXJlc2lzYWN1dGUiXSA9IDB4ZjZkNzsKICAgICAgdFsiZGllcmVzaXNiZWxvd2NtYiJdID0gMHgwMzI0OwogICAgICB0WyJkaWVyZXNpc2NtYiJdID0gMHgwMzA4OwogICAgICB0WyJkaWVyZXNpc2dyYXZlIl0gPSAweGY2ZDg7CiAgICAgIHRbImRpZXJlc2lzdG9ub3MiXSA9IDB4MDM4NTsKICAgICAgdFsiZGloaXJhZ2FuYSJdID0gMHgzMDYyOwogICAgICB0WyJkaWthdGFrYW5hIl0gPSAweDMwYzI7CiAgICAgIHRbImRpdHRvbWFyayJdID0gMHgzMDAzOwogICAgICB0WyJkaXZpZGUiXSA9IDB4MDBmNzsKICAgICAgdFsiZGl2aWRlcyJdID0gMHgyMjIzOwogICAgICB0WyJkaXZpc2lvbnNsYXNoIl0gPSAweDIyMTU7CiAgICAgIHRbImRqZWN5cmlsbGljIl0gPSAweDA0NTI7CiAgICAgIHRbImRrc2hhZGUiXSA9IDB4MjU5MzsKICAgICAgdFsiZGxpbmViZWxvdyJdID0gMHgxZTBmOwogICAgICB0WyJkbHNxdWFyZSJdID0gMHgzMzk3OwogICAgICB0WyJkbWFjcm9uIl0gPSAweDAxMTE7CiAgICAgIHRbImRtb25vc3BhY2UiXSA9IDB4ZmY0NDsKICAgICAgdFsiZG5ibG9jayJdID0gMHgyNTg0OwogICAgICB0WyJkb2NoYWRhdGhhaSJdID0gMHgwZTBlOwogICAgICB0WyJkb2Rla3RoYWkiXSA9IDB4MGUxNDsKICAgICAgdFsiZG9oaXJhZ2FuYSJdID0gMHgzMDY5OwogICAgICB0WyJkb2thdGFrYW5hIl0gPSAweDMwYzk7CiAgICAgIHRbImRvbGxhciJdID0gMHgwMDI0OwogICAgICB0WyJkb2xsYXJpbmZlcmlvciJdID0gMHhmNmUzOwogICAgICB0WyJkb2xsYXJtb25vc3BhY2UiXSA9IDB4ZmYwNDsKICAgICAgdFsiZG9sbGFyb2xkc3R5bGUiXSA9IDB4ZjcyNDsKICAgICAgdFsiZG9sbGFyc21hbGwiXSA9IDB4ZmU2OTsKICAgICAgdFsiZG9sbGFyc3VwZXJpb3IiXSA9IDB4ZjZlNDsKICAgICAgdFsiZG9uZyJdID0gMHgyMGFiOwogICAgICB0WyJkb3J1c3F1YXJlIl0gPSAweDMzMjY7CiAgICAgIHRbImRvdGFjY2VudCJdID0gMHgwMmQ5OwogICAgICB0WyJkb3RhY2NlbnRjbWIiXSA9IDB4MDMwNzsKICAgICAgdFsiZG90YmVsb3djbWIiXSA9IDB4MDMyMzsKICAgICAgdFsiZG90YmVsb3djb21iIl0gPSAweDAzMjM7CiAgICAgIHRbImRvdGthdGFrYW5hIl0gPSAweDMwZmI7CiAgICAgIHRbImRvdGxlc3NpIl0gPSAweDAxMzE7CiAgICAgIHRbImRvdGxlc3NqIl0gPSAweGY2YmU7CiAgICAgIHRbImRvdGxlc3Nqc3Ryb2tlaG9vayJdID0gMHgwMjg0OwogICAgICB0WyJkb3RtYXRoIl0gPSAweDIyYzU7CiAgICAgIHRbImRvdHRlZGNpcmNsZSJdID0gMHgyNWNjOwogICAgICB0WyJkb3VibGV5b2RwYXRhaCJdID0gMHhmYjFmOwogICAgICB0WyJkb3VibGV5b2RwYXRhaGhlYnJldyJdID0gMHhmYjFmOwogICAgICB0WyJkb3dudGFja2JlbG93Y21iIl0gPSAweDAzMWU7CiAgICAgIHRbImRvd250YWNrbW9kIl0gPSAweDAyZDU7CiAgICAgIHRbImRwYXJlbiJdID0gMHgyNDlmOwogICAgICB0WyJkc3VwZXJpb3IiXSA9IDB4ZjZlYjsKICAgICAgdFsiZHRhaWwiXSA9IDB4MDI1NjsKICAgICAgdFsiZHRvcGJhciJdID0gMHgwMThjOwogICAgICB0WyJkdWhpcmFnYW5hIl0gPSAweDMwNjU7CiAgICAgIHRbImR1a2F0YWthbmEiXSA9IDB4MzBjNTsKICAgICAgdFsiZHoiXSA9IDB4MDFmMzsKICAgICAgdFsiZHphbHRvbmUiXSA9IDB4MDJhMzsKICAgICAgdFsiZHpjYXJvbiJdID0gMHgwMWM2OwogICAgICB0WyJkemN1cmwiXSA9IDB4MDJhNTsKICAgICAgdFsiZHplYWJraGFzaWFuY3lyaWxsaWMiXSA9IDB4MDRlMTsKICAgICAgdFsiZHplY3lyaWxsaWMiXSA9IDB4MDQ1NTsKICAgICAgdFsiZHpoZWN5cmlsbGljIl0gPSAweDA0NWY7CiAgICAgIHRbImUiXSA9IDB4MDA2NTsKICAgICAgdFsiZWFjdXRlIl0gPSAweDAwZTk7CiAgICAgIHRbImVhcnRoIl0gPSAweDI2NDE7CiAgICAgIHRbImViZW5nYWxpIl0gPSAweDA5OGY7CiAgICAgIHRbImVib3BvbW9mbyJdID0gMHgzMTFjOwogICAgICB0WyJlYnJldmUiXSA9IDB4MDExNTsKICAgICAgdFsiZWNhbmRyYWRldmEiXSA9IDB4MDkwZDsKICAgICAgdFsiZWNhbmRyYWd1amFyYXRpIl0gPSAweDBhOGQ7CiAgICAgIHRbImVjYW5kcmF2b3dlbHNpZ25kZXZhIl0gPSAweDA5NDU7CiAgICAgIHRbImVjYW5kcmF2b3dlbHNpZ25ndWphcmF0aSJdID0gMHgwYWM1OwogICAgICB0WyJlY2Fyb24iXSA9IDB4MDExYjsKICAgICAgdFsiZWNlZGlsbGFicmV2ZSJdID0gMHgxZTFkOwogICAgICB0WyJlY2hhcm1lbmlhbiJdID0gMHgwNTY1OwogICAgICB0WyJlY2h5aXduYXJtZW5pYW4iXSA9IDB4MDU4NzsKICAgICAgdFsiZWNpcmNsZSJdID0gMHgyNGQ0OwogICAgICB0WyJlY2lyY3VtZmxleCJdID0gMHgwMGVhOwogICAgICB0WyJlY2lyY3VtZmxleGFjdXRlIl0gPSAweDFlYmY7CiAgICAgIHRbImVjaXJjdW1mbGV4YmVsb3ciXSA9IDB4MWUxOTsKICAgICAgdFsiZWNpcmN1bWZsZXhkb3RiZWxvdyJdID0gMHgxZWM3OwogICAgICB0WyJlY2lyY3VtZmxleGdyYXZlIl0gPSAweDFlYzE7CiAgICAgIHRbImVjaXJjdW1mbGV4aG9va2Fib3ZlIl0gPSAweDFlYzM7CiAgICAgIHRbImVjaXJjdW1mbGV4dGlsZGUiXSA9IDB4MWVjNTsKICAgICAgdFsiZWN5cmlsbGljIl0gPSAweDA0NTQ7CiAgICAgIHRbImVkYmxncmF2ZSJdID0gMHgwMjA1OwogICAgICB0WyJlZGV2YSJdID0gMHgwOTBmOwogICAgICB0WyJlZGllcmVzaXMiXSA9IDB4MDBlYjsKICAgICAgdFsiZWRvdCJdID0gMHgwMTE3OwogICAgICB0WyJlZG90YWNjZW50Il0gPSAweDAxMTc7CiAgICAgIHRbImVkb3RiZWxvdyJdID0gMHgxZWI5OwogICAgICB0WyJlZWd1cm11a2hpIl0gPSAweDBhMGY7CiAgICAgIHRbImVlbWF0cmFndXJtdWtoaSJdID0gMHgwYTQ3OwogICAgICB0WyJlZmN5cmlsbGljIl0gPSAweDA0NDQ7CiAgICAgIHRbImVncmF2ZSJdID0gMHgwMGU4OwogICAgICB0WyJlZ3VqYXJhdGkiXSA9IDB4MGE4ZjsKICAgICAgdFsiZWhhcm1lbmlhbiJdID0gMHgwNTY3OwogICAgICB0WyJlaGJvcG9tb2ZvIl0gPSAweDMxMWQ7CiAgICAgIHRbImVoaXJhZ2FuYSJdID0gMHgzMDQ4OwogICAgICB0WyJlaG9va2Fib3ZlIl0gPSAweDFlYmI7CiAgICAgIHRbImVpYm9wb21vZm8iXSA9IDB4MzExZjsKICAgICAgdFsiZWlnaHQiXSA9IDB4MDAzODsKICAgICAgdFsiZWlnaHRhcmFiaWMiXSA9IDB4MDY2ODsKICAgICAgdFsiZWlnaHRiZW5nYWxpIl0gPSAweDA5ZWU7CiAgICAgIHRbImVpZ2h0Y2lyY2xlIl0gPSAweDI0Njc7CiAgICAgIHRbImVpZ2h0Y2lyY2xlaW52ZXJzZXNhbnNzZXJpZiJdID0gMHgyNzkxOwogICAgICB0WyJlaWdodGRldmEiXSA9IDB4MDk2ZTsKICAgICAgdFsiZWlnaHRlZW5jaXJjbGUiXSA9IDB4MjQ3MTsKICAgICAgdFsiZWlnaHRlZW5wYXJlbiJdID0gMHgyNDg1OwogICAgICB0WyJlaWdodGVlbnBlcmlvZCJdID0gMHgyNDk5OwogICAgICB0WyJlaWdodGd1amFyYXRpIl0gPSAweDBhZWU7CiAgICAgIHRbImVpZ2h0Z3VybXVraGkiXSA9IDB4MGE2ZTsKICAgICAgdFsiZWlnaHRoYWNrYXJhYmljIl0gPSAweDA2Njg7CiAgICAgIHRbImVpZ2h0aGFuZ3pob3UiXSA9IDB4MzAyODsKICAgICAgdFsiZWlnaHRobm90ZWJlYW1lZCJdID0gMHgyNjZiOwogICAgICB0WyJlaWdodGlkZW9ncmFwaGljcGFyZW4iXSA9IDB4MzIyNzsKICAgICAgdFsiZWlnaHRpbmZlcmlvciJdID0gMHgyMDg4OwogICAgICB0WyJlaWdodG1vbm9zcGFjZSJdID0gMHhmZjE4OwogICAgICB0WyJlaWdodG9sZHN0eWxlIl0gPSAweGY3Mzg7CiAgICAgIHRbImVpZ2h0cGFyZW4iXSA9IDB4MjQ3YjsKICAgICAgdFsiZWlnaHRwZXJpb2QiXSA9IDB4MjQ4ZjsKICAgICAgdFsiZWlnaHRwZXJzaWFuIl0gPSAweDA2Zjg7CiAgICAgIHRbImVpZ2h0cm9tYW4iXSA9IDB4MjE3NzsKICAgICAgdFsiZWlnaHRzdXBlcmlvciJdID0gMHgyMDc4OwogICAgICB0WyJlaWdodHRoYWkiXSA9IDB4MGU1ODsKICAgICAgdFsiZWludmVydGVkYnJldmUiXSA9IDB4MDIwNzsKICAgICAgdFsiZWlvdGlmaWVkY3lyaWxsaWMiXSA9IDB4MDQ2NTsKICAgICAgdFsiZWthdGFrYW5hIl0gPSAweDMwYTg7CiAgICAgIHRbImVrYXRha2FuYWhhbGZ3aWR0aCJdID0gMHhmZjc0OwogICAgICB0WyJla29ua2FyZ3VybXVraGkiXSA9IDB4MGE3NDsKICAgICAgdFsiZWtvcmVhbiJdID0gMHgzMTU0OwogICAgICB0WyJlbGN5cmlsbGljIl0gPSAweDA0M2I7CiAgICAgIHRbImVsZW1lbnQiXSA9IDB4MjIwODsKICAgICAgdFsiZWxldmVuY2lyY2xlIl0gPSAweDI0NmE7CiAgICAgIHRbImVsZXZlbnBhcmVuIl0gPSAweDI0N2U7CiAgICAgIHRbImVsZXZlbnBlcmlvZCJdID0gMHgyNDkyOwogICAgICB0WyJlbGV2ZW5yb21hbiJdID0gMHgyMTdhOwogICAgICB0WyJlbGxpcHNpcyJdID0gMHgyMDI2OwogICAgICB0WyJlbGxpcHNpc3ZlcnRpY2FsIl0gPSAweDIyZWU7CiAgICAgIHRbImVtYWNyb24iXSA9IDB4MDExMzsKICAgICAgdFsiZW1hY3JvbmFjdXRlIl0gPSAweDFlMTc7CiAgICAgIHRbImVtYWNyb25ncmF2ZSJdID0gMHgxZTE1OwogICAgICB0WyJlbWN5cmlsbGljIl0gPSAweDA0M2M7CiAgICAgIHRbImVtZGFzaCJdID0gMHgyMDE0OwogICAgICB0WyJlbWRhc2h2ZXJ0aWNhbCJdID0gMHhmZTMxOwogICAgICB0WyJlbW9ub3NwYWNlIl0gPSAweGZmNDU7CiAgICAgIHRbImVtcGhhc2lzbWFya2FybWVuaWFuIl0gPSAweDA1NWI7CiAgICAgIHRbImVtcHR5c2V0Il0gPSAweDIyMDU7CiAgICAgIHRbImVuYm9wb21vZm8iXSA9IDB4MzEyMzsKICAgICAgdFsiZW5jeXJpbGxpYyJdID0gMHgwNDNkOwogICAgICB0WyJlbmRhc2giXSA9IDB4MjAxMzsKICAgICAgdFsiZW5kYXNodmVydGljYWwiXSA9IDB4ZmUzMjsKICAgICAgdFsiZW5kZXNjZW5kZXJjeXJpbGxpYyJdID0gMHgwNGEzOwogICAgICB0WyJlbmciXSA9IDB4MDE0YjsKICAgICAgdFsiZW5nYm9wb21vZm8iXSA9IDB4MzEyNTsKICAgICAgdFsiZW5naGVjeXJpbGxpYyJdID0gMHgwNGE1OwogICAgICB0WyJlbmhvb2tjeXJpbGxpYyJdID0gMHgwNGM4OwogICAgICB0WyJlbnNwYWNlIl0gPSAweDIwMDI7CiAgICAgIHRbImVvZ29uZWsiXSA9IDB4MDExOTsKICAgICAgdFsiZW9rb3JlYW4iXSA9IDB4MzE1MzsKICAgICAgdFsiZW9wZW4iXSA9IDB4MDI1YjsKICAgICAgdFsiZW9wZW5jbG9zZWQiXSA9IDB4MDI5YTsKICAgICAgdFsiZW9wZW5yZXZlcnNlZCJdID0gMHgwMjVjOwogICAgICB0WyJlb3BlbnJldmVyc2VkY2xvc2VkIl0gPSAweDAyNWU7CiAgICAgIHRbImVvcGVucmV2ZXJzZWRob29rIl0gPSAweDAyNWQ7CiAgICAgIHRbImVwYXJlbiJdID0gMHgyNGEwOwogICAgICB0WyJlcHNpbG9uIl0gPSAweDAzYjU7CiAgICAgIHRbImVwc2lsb250b25vcyJdID0gMHgwM2FkOwogICAgICB0WyJlcXVhbCJdID0gMHgwMDNkOwogICAgICB0WyJlcXVhbG1vbm9zcGFjZSJdID0gMHhmZjFkOwogICAgICB0WyJlcXVhbHNtYWxsIl0gPSAweGZlNjY7CiAgICAgIHRbImVxdWFsc3VwZXJpb3IiXSA9IDB4MjA3YzsKICAgICAgdFsiZXF1aXZhbGVuY2UiXSA9IDB4MjI2MTsKICAgICAgdFsiZXJib3BvbW9mbyJdID0gMHgzMTI2OwogICAgICB0WyJlcmN5cmlsbGljIl0gPSAweDA0NDA7CiAgICAgIHRbImVyZXZlcnNlZCJdID0gMHgwMjU4OwogICAgICB0WyJlcmV2ZXJzZWRjeXJpbGxpYyJdID0gMHgwNDRkOwogICAgICB0WyJlc2N5cmlsbGljIl0gPSAweDA0NDE7CiAgICAgIHRbImVzZGVzY2VuZGVyY3lyaWxsaWMiXSA9IDB4MDRhYjsKICAgICAgdFsiZXNoIl0gPSAweDAyODM7CiAgICAgIHRbImVzaGN1cmwiXSA9IDB4MDI4NjsKICAgICAgdFsiZXNob3J0ZGV2YSJdID0gMHgwOTBlOwogICAgICB0WyJlc2hvcnR2b3dlbHNpZ25kZXZhIl0gPSAweDA5NDY7CiAgICAgIHRbImVzaHJldmVyc2VkbG9vcCJdID0gMHgwMWFhOwogICAgICB0WyJlc2hzcXVhdHJldmVyc2VkIl0gPSAweDAyODU7CiAgICAgIHRbImVzbWFsbGhpcmFnYW5hIl0gPSAweDMwNDc7CiAgICAgIHRbImVzbWFsbGthdGFrYW5hIl0gPSAweDMwYTc7CiAgICAgIHRbImVzbWFsbGthdGFrYW5haGFsZndpZHRoIl0gPSAweGZmNmE7CiAgICAgIHRbImVzdGltYXRlZCJdID0gMHgyMTJlOwogICAgICB0WyJlc3VwZXJpb3IiXSA9IDB4ZjZlYzsKICAgICAgdFsiZXRhIl0gPSAweDAzYjc7CiAgICAgIHRbImV0YXJtZW5pYW4iXSA9IDB4MDU2ODsKICAgICAgdFsiZXRhdG9ub3MiXSA9IDB4MDNhZTsKICAgICAgdFsiZXRoIl0gPSAweDAwZjA7CiAgICAgIHRbImV0aWxkZSJdID0gMHgxZWJkOwogICAgICB0WyJldGlsZGViZWxvdyJdID0gMHgxZTFiOwogICAgICB0WyJldG5haHRhZm91a2hoZWJyZXciXSA9IDB4MDU5MTsKICAgICAgdFsiZXRuYWh0YWZvdWtobGVmdGhlYnJldyJdID0gMHgwNTkxOwogICAgICB0WyJldG5haHRhaGVicmV3Il0gPSAweDA1OTE7CiAgICAgIHRbImV0bmFodGFsZWZ0aGVicmV3Il0gPSAweDA1OTE7CiAgICAgIHRbImV0dXJuZWQiXSA9IDB4MDFkZDsKICAgICAgdFsiZXVrb3JlYW4iXSA9IDB4MzE2MTsKICAgICAgdFsiZXVybyJdID0gMHgyMGFjOwogICAgICB0WyJldm93ZWxzaWduYmVuZ2FsaSJdID0gMHgwOWM3OwogICAgICB0WyJldm93ZWxzaWduZGV2YSJdID0gMHgwOTQ3OwogICAgICB0WyJldm93ZWxzaWduZ3VqYXJhdGkiXSA9IDB4MGFjNzsKICAgICAgdFsiZXhjbGFtIl0gPSAweDAwMjE7CiAgICAgIHRbImV4Y2xhbWFybWVuaWFuIl0gPSAweDA1NWM7CiAgICAgIHRbImV4Y2xhbWRibCJdID0gMHgyMDNjOwogICAgICB0WyJleGNsYW1kb3duIl0gPSAweDAwYTE7CiAgICAgIHRbImV4Y2xhbWRvd25zbWFsbCJdID0gMHhmN2ExOwogICAgICB0WyJleGNsYW1tb25vc3BhY2UiXSA9IDB4ZmYwMTsKICAgICAgdFsiZXhjbGFtc21hbGwiXSA9IDB4ZjcyMTsKICAgICAgdFsiZXhpc3RlbnRpYWwiXSA9IDB4MjIwMzsKICAgICAgdFsiZXpoIl0gPSAweDAyOTI7CiAgICAgIHRbImV6aGNhcm9uIl0gPSAweDAxZWY7CiAgICAgIHRbImV6aGN1cmwiXSA9IDB4MDI5MzsKICAgICAgdFsiZXpocmV2ZXJzZWQiXSA9IDB4MDFiOTsKICAgICAgdFsiZXpodGFpbCJdID0gMHgwMWJhOwogICAgICB0WyJmIl0gPSAweDAwNjY7CiAgICAgIHRbImZhZGV2YSJdID0gMHgwOTVlOwogICAgICB0WyJmYWd1cm11a2hpIl0gPSAweDBhNWU7CiAgICAgIHRbImZhaHJlbmhlaXQiXSA9IDB4MjEwOTsKICAgICAgdFsiZmF0aGFhcmFiaWMiXSA9IDB4MDY0ZTsKICAgICAgdFsiZmF0aGFsb3dhcmFiaWMiXSA9IDB4MDY0ZTsKICAgICAgdFsiZmF0aGF0YW5hcmFiaWMiXSA9IDB4MDY0YjsKICAgICAgdFsiZmJvcG9tb2ZvIl0gPSAweDMxMDg7CiAgICAgIHRbImZjaXJjbGUiXSA9IDB4MjRkNTsKICAgICAgdFsiZmRvdGFjY2VudCJdID0gMHgxZTFmOwogICAgICB0WyJmZWhhcmFiaWMiXSA9IDB4MDY0MTsKICAgICAgdFsiZmVoYXJtZW5pYW4iXSA9IDB4MDU4NjsKICAgICAgdFsiZmVoZmluYWxhcmFiaWMiXSA9IDB4ZmVkMjsKICAgICAgdFsiZmVoaW5pdGlhbGFyYWJpYyJdID0gMHhmZWQzOwogICAgICB0WyJmZWhtZWRpYWxhcmFiaWMiXSA9IDB4ZmVkNDsKICAgICAgdFsiZmVpY29wdGljIl0gPSAweDAzZTU7CiAgICAgIHRbImZlbWFsZSJdID0gMHgyNjQwOwogICAgICB0WyJmZiJdID0gMHhmYjAwOwogICAgICB0WyJmX2YiXSA9IDB4ZmIwMDsKICAgICAgdFsiZmZpIl0gPSAweGZiMDM7CiAgICAgIHRbImZmbCJdID0gMHhmYjA0OwogICAgICB0WyJmaSJdID0gMHhmYjAxOwogICAgICB0WyJmaWZ0ZWVuY2lyY2xlIl0gPSAweDI0NmU7CiAgICAgIHRbImZpZnRlZW5wYXJlbiJdID0gMHgyNDgyOwogICAgICB0WyJmaWZ0ZWVucGVyaW9kIl0gPSAweDI0OTY7CiAgICAgIHRbImZpZ3VyZWRhc2giXSA9IDB4MjAxMjsKICAgICAgdFsiZmlsbGVkYm94Il0gPSAweDI1YTA7CiAgICAgIHRbImZpbGxlZHJlY3QiXSA9IDB4MjVhYzsKICAgICAgdFsiZmluYWxrYWYiXSA9IDB4MDVkYTsKICAgICAgdFsiZmluYWxrYWZkYWdlc2giXSA9IDB4ZmIzYTsKICAgICAgdFsiZmluYWxrYWZkYWdlc2hoZWJyZXciXSA9IDB4ZmIzYTsKICAgICAgdFsiZmluYWxrYWZoZWJyZXciXSA9IDB4MDVkYTsKICAgICAgdFsiZmluYWxtZW0iXSA9IDB4MDVkZDsKICAgICAgdFsiZmluYWxtZW1oZWJyZXciXSA9IDB4MDVkZDsKICAgICAgdFsiZmluYWxudW4iXSA9IDB4MDVkZjsKICAgICAgdFsiZmluYWxudW5oZWJyZXciXSA9IDB4MDVkZjsKICAgICAgdFsiZmluYWxwZSJdID0gMHgwNWUzOwogICAgICB0WyJmaW5hbHBlaGVicmV3Il0gPSAweDA1ZTM7CiAgICAgIHRbImZpbmFsdHNhZGkiXSA9IDB4MDVlNTsKICAgICAgdFsiZmluYWx0c2FkaWhlYnJldyJdID0gMHgwNWU1OwogICAgICB0WyJmaXJzdHRvbmVjaGluZXNlIl0gPSAweDAyYzk7CiAgICAgIHRbImZpc2hleWUiXSA9IDB4MjVjOTsKICAgICAgdFsiZml0YWN5cmlsbGljIl0gPSAweDA0NzM7CiAgICAgIHRbImZpdmUiXSA9IDB4MDAzNTsKICAgICAgdFsiZml2ZWFyYWJpYyJdID0gMHgwNjY1OwogICAgICB0WyJmaXZlYmVuZ2FsaSJdID0gMHgwOWViOwogICAgICB0WyJmaXZlY2lyY2xlIl0gPSAweDI0NjQ7CiAgICAgIHRbImZpdmVjaXJjbGVpbnZlcnNlc2Fuc3NlcmlmIl0gPSAweDI3OGU7CiAgICAgIHRbImZpdmVkZXZhIl0gPSAweDA5NmI7CiAgICAgIHRbImZpdmVlaWdodGhzIl0gPSAweDIxNWQ7CiAgICAgIHRbImZpdmVndWphcmF0aSJdID0gMHgwYWViOwogICAgICB0WyJmaXZlZ3VybXVraGkiXSA9IDB4MGE2YjsKICAgICAgdFsiZml2ZWhhY2thcmFiaWMiXSA9IDB4MDY2NTsKICAgICAgdFsiZml2ZWhhbmd6aG91Il0gPSAweDMwMjU7CiAgICAgIHRbImZpdmVpZGVvZ3JhcGhpY3BhcmVuIl0gPSAweDMyMjQ7CiAgICAgIHRbImZpdmVpbmZlcmlvciJdID0gMHgyMDg1OwogICAgICB0WyJmaXZlbW9ub3NwYWNlIl0gPSAweGZmMTU7CiAgICAgIHRbImZpdmVvbGRzdHlsZSJdID0gMHhmNzM1OwogICAgICB0WyJmaXZlcGFyZW4iXSA9IDB4MjQ3ODsKICAgICAgdFsiZml2ZXBlcmlvZCJdID0gMHgyNDhjOwogICAgICB0WyJmaXZlcGVyc2lhbiJdID0gMHgwNmY1OwogICAgICB0WyJmaXZlcm9tYW4iXSA9IDB4MjE3NDsKICAgICAgdFsiZml2ZXN1cGVyaW9yIl0gPSAweDIwNzU7CiAgICAgIHRbImZpdmV0aGFpIl0gPSAweDBlNTU7CiAgICAgIHRbImZsIl0gPSAweGZiMDI7CiAgICAgIHRbImZsb3JpbiJdID0gMHgwMTkyOwogICAgICB0WyJmbW9ub3NwYWNlIl0gPSAweGZmNDY7CiAgICAgIHRbImZtc3F1YXJlIl0gPSAweDMzOTk7CiAgICAgIHRbImZvZmFudGhhaSJdID0gMHgwZTFmOwogICAgICB0WyJmb2ZhdGhhaSJdID0gMHgwZTFkOwogICAgICB0WyJmb25nbWFudGhhaSJdID0gMHgwZTRmOwogICAgICB0WyJmb3JhbGwiXSA9IDB4MjIwMDsKICAgICAgdFsiZm91ciJdID0gMHgwMDM0OwogICAgICB0WyJmb3VyYXJhYmljIl0gPSAweDA2NjQ7CiAgICAgIHRbImZvdXJiZW5nYWxpIl0gPSAweDA5ZWE7CiAgICAgIHRbImZvdXJjaXJjbGUiXSA9IDB4MjQ2MzsKICAgICAgdFsiZm91cmNpcmNsZWludmVyc2VzYW5zc2VyaWYiXSA9IDB4Mjc4ZDsKICAgICAgdFsiZm91cmRldmEiXSA9IDB4MDk2YTsKICAgICAgdFsiZm91cmd1amFyYXRpIl0gPSAweDBhZWE7CiAgICAgIHRbImZvdXJndXJtdWtoaSJdID0gMHgwYTZhOwogICAgICB0WyJmb3VyaGFja2FyYWJpYyJdID0gMHgwNjY0OwogICAgICB0WyJmb3VyaGFuZ3pob3UiXSA9IDB4MzAyNDsKICAgICAgdFsiZm91cmlkZW9ncmFwaGljcGFyZW4iXSA9IDB4MzIyMzsKICAgICAgdFsiZm91cmluZmVyaW9yIl0gPSAweDIwODQ7CiAgICAgIHRbImZvdXJtb25vc3BhY2UiXSA9IDB4ZmYxNDsKICAgICAgdFsiZm91cm51bWVyYXRvcmJlbmdhbGkiXSA9IDB4MDlmNzsKICAgICAgdFsiZm91cm9sZHN0eWxlIl0gPSAweGY3MzQ7CiAgICAgIHRbImZvdXJwYXJlbiJdID0gMHgyNDc3OwogICAgICB0WyJmb3VycGVyaW9kIl0gPSAweDI0OGI7CiAgICAgIHRbImZvdXJwZXJzaWFuIl0gPSAweDA2ZjQ7CiAgICAgIHRbImZvdXJyb21hbiJdID0gMHgyMTczOwogICAgICB0WyJmb3Vyc3VwZXJpb3IiXSA9IDB4MjA3NDsKICAgICAgdFsiZm91cnRlZW5jaXJjbGUiXSA9IDB4MjQ2ZDsKICAgICAgdFsiZm91cnRlZW5wYXJlbiJdID0gMHgyNDgxOwogICAgICB0WyJmb3VydGVlbnBlcmlvZCJdID0gMHgyNDk1OwogICAgICB0WyJmb3VydGhhaSJdID0gMHgwZTU0OwogICAgICB0WyJmb3VydGh0b25lY2hpbmVzZSJdID0gMHgwMmNiOwogICAgICB0WyJmcGFyZW4iXSA9IDB4MjRhMTsKICAgICAgdFsiZnJhY3Rpb24iXSA9IDB4MjA0NDsKICAgICAgdFsiZnJhbmMiXSA9IDB4MjBhMzsKICAgICAgdFsiZyJdID0gMHgwMDY3OwogICAgICB0WyJnYWJlbmdhbGkiXSA9IDB4MDk5NzsKICAgICAgdFsiZ2FjdXRlIl0gPSAweDAxZjU7CiAgICAgIHRbImdhZGV2YSJdID0gMHgwOTE3OwogICAgICB0WyJnYWZhcmFiaWMiXSA9IDB4MDZhZjsKICAgICAgdFsiZ2FmZmluYWxhcmFiaWMiXSA9IDB4ZmI5MzsKICAgICAgdFsiZ2FmaW5pdGlhbGFyYWJpYyJdID0gMHhmYjk0OwogICAgICB0WyJnYWZtZWRpYWxhcmFiaWMiXSA9IDB4ZmI5NTsKICAgICAgdFsiZ2FndWphcmF0aSJdID0gMHgwYTk3OwogICAgICB0WyJnYWd1cm11a2hpIl0gPSAweDBhMTc7CiAgICAgIHRbImdhaGlyYWdhbmEiXSA9IDB4MzA0YzsKICAgICAgdFsiZ2FrYXRha2FuYSJdID0gMHgzMGFjOwogICAgICB0WyJnYW1tYSJdID0gMHgwM2IzOwogICAgICB0WyJnYW1tYWxhdGluc21hbGwiXSA9IDB4MDI2MzsKICAgICAgdFsiZ2FtbWFzdXBlcmlvciJdID0gMHgwMmUwOwogICAgICB0WyJnYW5naWFjb3B0aWMiXSA9IDB4MDNlYjsKICAgICAgdFsiZ2JvcG9tb2ZvIl0gPSAweDMxMGQ7CiAgICAgIHRbImdicmV2ZSJdID0gMHgwMTFmOwogICAgICB0WyJnY2Fyb24iXSA9IDB4MDFlNzsKICAgICAgdFsiZ2NlZGlsbGEiXSA9IDB4MDEyMzsKICAgICAgdFsiZ2NpcmNsZSJdID0gMHgyNGQ2OwogICAgICB0WyJnY2lyY3VtZmxleCJdID0gMHgwMTFkOwogICAgICB0WyJnY29tbWFhY2NlbnQiXSA9IDB4MDEyMzsKICAgICAgdFsiZ2RvdCJdID0gMHgwMTIxOwogICAgICB0WyJnZG90YWNjZW50Il0gPSAweDAxMjE7CiAgICAgIHRbImdlY3lyaWxsaWMiXSA9IDB4MDQzMzsKICAgICAgdFsiZ2VoaXJhZ2FuYSJdID0gMHgzMDUyOwogICAgICB0WyJnZWthdGFrYW5hIl0gPSAweDMwYjI7CiAgICAgIHRbImdlb21ldHJpY2FsbHllcXVhbCJdID0gMHgyMjUxOwogICAgICB0WyJnZXJlc2hhY2NlbnRoZWJyZXciXSA9IDB4MDU5YzsKICAgICAgdFsiZ2VyZXNoaGVicmV3Il0gPSAweDA1ZjM7CiAgICAgIHRbImdlcmVzaG11cWRhbWhlYnJldyJdID0gMHgwNTlkOwogICAgICB0WyJnZXJtYW5kYmxzIl0gPSAweDAwZGY7CiAgICAgIHRbImdlcnNoYXlpbWFjY2VudGhlYnJldyJdID0gMHgwNTllOwogICAgICB0WyJnZXJzaGF5aW1oZWJyZXciXSA9IDB4MDVmNDsKICAgICAgdFsiZ2V0YW1hcmsiXSA9IDB4MzAxMzsKICAgICAgdFsiZ2hhYmVuZ2FsaSJdID0gMHgwOTk4OwogICAgICB0WyJnaGFkYXJtZW5pYW4iXSA9IDB4MDU3MjsKICAgICAgdFsiZ2hhZGV2YSJdID0gMHgwOTE4OwogICAgICB0WyJnaGFndWphcmF0aSJdID0gMHgwYTk4OwogICAgICB0WyJnaGFndXJtdWtoaSJdID0gMHgwYTE4OwogICAgICB0WyJnaGFpbmFyYWJpYyJdID0gMHgwNjNhOwogICAgICB0WyJnaGFpbmZpbmFsYXJhYmljIl0gPSAweGZlY2U7CiAgICAgIHRbImdoYWluaW5pdGlhbGFyYWJpYyJdID0gMHhmZWNmOwogICAgICB0WyJnaGFpbm1lZGlhbGFyYWJpYyJdID0gMHhmZWQwOwogICAgICB0WyJnaGVtaWRkbGVob29rY3lyaWxsaWMiXSA9IDB4MDQ5NTsKICAgICAgdFsiZ2hlc3Ryb2tlY3lyaWxsaWMiXSA9IDB4MDQ5MzsKICAgICAgdFsiZ2hldXB0dXJuY3lyaWxsaWMiXSA9IDB4MDQ5MTsKICAgICAgdFsiZ2hoYWRldmEiXSA9IDB4MDk1YTsKICAgICAgdFsiZ2hoYWd1cm11a2hpIl0gPSAweDBhNWE7CiAgICAgIHRbImdob29rIl0gPSAweDAyNjA7CiAgICAgIHRbImdoenNxdWFyZSJdID0gMHgzMzkzOwogICAgICB0WyJnaWhpcmFnYW5hIl0gPSAweDMwNGU7CiAgICAgIHRbImdpa2F0YWthbmEiXSA9IDB4MzBhZTsKICAgICAgdFsiZ2ltYXJtZW5pYW4iXSA9IDB4MDU2MzsKICAgICAgdFsiZ2ltZWwiXSA9IDB4MDVkMjsKICAgICAgdFsiZ2ltZWxkYWdlc2giXSA9IDB4ZmIzMjsKICAgICAgdFsiZ2ltZWxkYWdlc2hoZWJyZXciXSA9IDB4ZmIzMjsKICAgICAgdFsiZ2ltZWxoZWJyZXciXSA9IDB4MDVkMjsKICAgICAgdFsiZ2plY3lyaWxsaWMiXSA9IDB4MDQ1MzsKICAgICAgdFsiZ2xvdHRhbGludmVydGVkc3Ryb2tlIl0gPSAweDAxYmU7CiAgICAgIHRbImdsb3R0YWxzdG9wIl0gPSAweDAyOTQ7CiAgICAgIHRbImdsb3R0YWxzdG9waW52ZXJ0ZWQiXSA9IDB4MDI5NjsKICAgICAgdFsiZ2xvdHRhbHN0b3Btb2QiXSA9IDB4MDJjMDsKICAgICAgdFsiZ2xvdHRhbHN0b3ByZXZlcnNlZCJdID0gMHgwMjk1OwogICAgICB0WyJnbG90dGFsc3RvcHJldmVyc2VkbW9kIl0gPSAweDAyYzE7CiAgICAgIHRbImdsb3R0YWxzdG9wcmV2ZXJzZWRzdXBlcmlvciJdID0gMHgwMmU0OwogICAgICB0WyJnbG90dGFsc3RvcHN0cm9rZSJdID0gMHgwMmExOwogICAgICB0WyJnbG90dGFsc3RvcHN0cm9rZXJldmVyc2VkIl0gPSAweDAyYTI7CiAgICAgIHRbImdtYWNyb24iXSA9IDB4MWUyMTsKICAgICAgdFsiZ21vbm9zcGFjZSJdID0gMHhmZjQ3OwogICAgICB0WyJnb2hpcmFnYW5hIl0gPSAweDMwNTQ7CiAgICAgIHRbImdva2F0YWthbmEiXSA9IDB4MzBiNDsKICAgICAgdFsiZ3BhcmVuIl0gPSAweDI0YTI7CiAgICAgIHRbImdwYXNxdWFyZSJdID0gMHgzM2FjOwogICAgICB0WyJncmFkaWVudCJdID0gMHgyMjA3OwogICAgICB0WyJncmF2ZSJdID0gMHgwMDYwOwogICAgICB0WyJncmF2ZWJlbG93Y21iIl0gPSAweDAzMTY7CiAgICAgIHRbImdyYXZlY21iIl0gPSAweDAzMDA7CiAgICAgIHRbImdyYXZlY29tYiJdID0gMHgwMzAwOwogICAgICB0WyJncmF2ZWRldmEiXSA9IDB4MDk1MzsKICAgICAgdFsiZ3JhdmVsb3dtb2QiXSA9IDB4MDJjZTsKICAgICAgdFsiZ3JhdmVtb25vc3BhY2UiXSA9IDB4ZmY0MDsKICAgICAgdFsiZ3JhdmV0b25lY21iIl0gPSAweDAzNDA7CiAgICAgIHRbImdyZWF0ZXIiXSA9IDB4MDAzZTsKICAgICAgdFsiZ3JlYXRlcmVxdWFsIl0gPSAweDIyNjU7CiAgICAgIHRbImdyZWF0ZXJlcXVhbG9ybGVzcyJdID0gMHgyMmRiOwogICAgICB0WyJncmVhdGVybW9ub3NwYWNlIl0gPSAweGZmMWU7CiAgICAgIHRbImdyZWF0ZXJvcmVxdWl2YWxlbnQiXSA9IDB4MjI3MzsKICAgICAgdFsiZ3JlYXRlcm9ybGVzcyJdID0gMHgyMjc3OwogICAgICB0WyJncmVhdGVyb3ZlcmVxdWFsIl0gPSAweDIyNjc7CiAgICAgIHRbImdyZWF0ZXJzbWFsbCJdID0gMHhmZTY1OwogICAgICB0WyJnc2NyaXB0Il0gPSAweDAyNjE7CiAgICAgIHRbImdzdHJva2UiXSA9IDB4MDFlNTsKICAgICAgdFsiZ3VoaXJhZ2FuYSJdID0gMHgzMDUwOwogICAgICB0WyJndWlsbGVtb3RsZWZ0Il0gPSAweDAwYWI7CiAgICAgIHRbImd1aWxsZW1vdHJpZ2h0Il0gPSAweDAwYmI7CiAgICAgIHRbImd1aWxzaW5nbGxlZnQiXSA9IDB4MjAzOTsKICAgICAgdFsiZ3VpbHNpbmdscmlnaHQiXSA9IDB4MjAzYTsKICAgICAgdFsiZ3VrYXRha2FuYSJdID0gMHgzMGIwOwogICAgICB0WyJndXJhbXVzcXVhcmUiXSA9IDB4MzMxODsKICAgICAgdFsiZ3lzcXVhcmUiXSA9IDB4MzNjOTsKICAgICAgdFsiaCJdID0gMHgwMDY4OwogICAgICB0WyJoYWFia2hhc2lhbmN5cmlsbGljIl0gPSAweDA0YTk7CiAgICAgIHRbImhhYWx0b25lYXJhYmljIl0gPSAweDA2YzE7CiAgICAgIHRbImhhYmVuZ2FsaSJdID0gMHgwOWI5OwogICAgICB0WyJoYWRlc2NlbmRlcmN5cmlsbGljIl0gPSAweDA0YjM7CiAgICAgIHRbImhhZGV2YSJdID0gMHgwOTM5OwogICAgICB0WyJoYWd1amFyYXRpIl0gPSAweDBhYjk7CiAgICAgIHRbImhhZ3VybXVraGkiXSA9IDB4MGEzOTsKICAgICAgdFsiaGFoYXJhYmljIl0gPSAweDA2MmQ7CiAgICAgIHRbImhhaGZpbmFsYXJhYmljIl0gPSAweGZlYTI7CiAgICAgIHRbImhhaGluaXRpYWxhcmFiaWMiXSA9IDB4ZmVhMzsKICAgICAgdFsiaGFoaXJhZ2FuYSJdID0gMHgzMDZmOwogICAgICB0WyJoYWhtZWRpYWxhcmFiaWMiXSA9IDB4ZmVhNDsKICAgICAgdFsiaGFpdHVzcXVhcmUiXSA9IDB4MzMyYTsKICAgICAgdFsiaGFrYXRha2FuYSJdID0gMHgzMGNmOwogICAgICB0WyJoYWthdGFrYW5haGFsZndpZHRoIl0gPSAweGZmOGE7CiAgICAgIHRbImhhbGFudGd1cm11a2hpIl0gPSAweDBhNGQ7CiAgICAgIHRbImhhbXphYXJhYmljIl0gPSAweDA2MjE7CiAgICAgIHRbImhhbXphbG93YXJhYmljIl0gPSAweDA2MjE7CiAgICAgIHRbImhhbmd1bGZpbGxlciJdID0gMHgzMTY0OwogICAgICB0WyJoYXJkc2lnbmN5cmlsbGljIl0gPSAweDA0NGE7CiAgICAgIHRbImhhcnBvb25sZWZ0YmFyYnVwIl0gPSAweDIxYmM7CiAgICAgIHRbImhhcnBvb25yaWdodGJhcmJ1cCJdID0gMHgyMWMwOwogICAgICB0WyJoYXNxdWFyZSJdID0gMHgzM2NhOwogICAgICB0WyJoYXRhZnBhdGFoIl0gPSAweDA1YjI7CiAgICAgIHRbImhhdGFmcGF0YWgxNiJdID0gMHgwNWIyOwogICAgICB0WyJoYXRhZnBhdGFoMjMiXSA9IDB4MDViMjsKICAgICAgdFsiaGF0YWZwYXRhaDJmIl0gPSAweDA1YjI7CiAgICAgIHRbImhhdGFmcGF0YWhoZWJyZXciXSA9IDB4MDViMjsKICAgICAgdFsiaGF0YWZwYXRhaG5hcnJvd2hlYnJldyJdID0gMHgwNWIyOwogICAgICB0WyJoYXRhZnBhdGFocXVhcnRlcmhlYnJldyJdID0gMHgwNWIyOwogICAgICB0WyJoYXRhZnBhdGFod2lkZWhlYnJldyJdID0gMHgwNWIyOwogICAgICB0WyJoYXRhZnFhbWF0cyJdID0gMHgwNWIzOwogICAgICB0WyJoYXRhZnFhbWF0czFiIl0gPSAweDA1YjM7CiAgICAgIHRbImhhdGFmcWFtYXRzMjgiXSA9IDB4MDViMzsKICAgICAgdFsiaGF0YWZxYW1hdHMzNCJdID0gMHgwNWIzOwogICAgICB0WyJoYXRhZnFhbWF0c2hlYnJldyJdID0gMHgwNWIzOwogICAgICB0WyJoYXRhZnFhbWF0c25hcnJvd2hlYnJldyJdID0gMHgwNWIzOwogICAgICB0WyJoYXRhZnFhbWF0c3F1YXJ0ZXJoZWJyZXciXSA9IDB4MDViMzsKICAgICAgdFsiaGF0YWZxYW1hdHN3aWRlaGVicmV3Il0gPSAweDA1YjM7CiAgICAgIHRbImhhdGFmc2Vnb2wiXSA9IDB4MDViMTsKICAgICAgdFsiaGF0YWZzZWdvbDE3Il0gPSAweDA1YjE7CiAgICAgIHRbImhhdGFmc2Vnb2wyNCJdID0gMHgwNWIxOwogICAgICB0WyJoYXRhZnNlZ29sMzAiXSA9IDB4MDViMTsKICAgICAgdFsiaGF0YWZzZWdvbGhlYnJldyJdID0gMHgwNWIxOwogICAgICB0WyJoYXRhZnNlZ29sbmFycm93aGVicmV3Il0gPSAweDA1YjE7CiAgICAgIHRbImhhdGFmc2Vnb2xxdWFydGVyaGVicmV3Il0gPSAweDA1YjE7CiAgICAgIHRbImhhdGFmc2Vnb2x3aWRlaGVicmV3Il0gPSAweDA1YjE7CiAgICAgIHRbImhiYXIiXSA9IDB4MDEyNzsKICAgICAgdFsiaGJvcG9tb2ZvIl0gPSAweDMxMGY7CiAgICAgIHRbImhicmV2ZWJlbG93Il0gPSAweDFlMmI7CiAgICAgIHRbImhjZWRpbGxhIl0gPSAweDFlMjk7CiAgICAgIHRbImhjaXJjbGUiXSA9IDB4MjRkNzsKICAgICAgdFsiaGNpcmN1bWZsZXgiXSA9IDB4MDEyNTsKICAgICAgdFsiaGRpZXJlc2lzIl0gPSAweDFlMjc7CiAgICAgIHRbImhkb3RhY2NlbnQiXSA9IDB4MWUyMzsKICAgICAgdFsiaGRvdGJlbG93Il0gPSAweDFlMjU7CiAgICAgIHRbImhlIl0gPSAweDA1ZDQ7CiAgICAgIHRbImhlYXJ0Il0gPSAweDI2NjU7CiAgICAgIHRbImhlYXJ0c3VpdGJsYWNrIl0gPSAweDI2NjU7CiAgICAgIHRbImhlYXJ0c3VpdHdoaXRlIl0gPSAweDI2NjE7CiAgICAgIHRbImhlZGFnZXNoIl0gPSAweGZiMzQ7CiAgICAgIHRbImhlZGFnZXNoaGVicmV3Il0gPSAweGZiMzQ7CiAgICAgIHRbImhlaGFsdG9uZWFyYWJpYyJdID0gMHgwNmMxOwogICAgICB0WyJoZWhhcmFiaWMiXSA9IDB4MDY0NzsKICAgICAgdFsiaGVoZWJyZXciXSA9IDB4MDVkNDsKICAgICAgdFsiaGVoZmluYWxhbHRvbmVhcmFiaWMiXSA9IDB4ZmJhNzsKICAgICAgdFsiaGVoZmluYWxhbHR0d29hcmFiaWMiXSA9IDB4ZmVlYTsKICAgICAgdFsiaGVoZmluYWxhcmFiaWMiXSA9IDB4ZmVlYTsKICAgICAgdFsiaGVoaGFtemFhYm92ZWZpbmFsYXJhYmljIl0gPSAweGZiYTU7CiAgICAgIHRbImhlaGhhbXphYWJvdmVpc29sYXRlZGFyYWJpYyJdID0gMHhmYmE0OwogICAgICB0WyJoZWhpbml0aWFsYWx0b25lYXJhYmljIl0gPSAweGZiYTg7CiAgICAgIHRbImhlaGluaXRpYWxhcmFiaWMiXSA9IDB4ZmVlYjsKICAgICAgdFsiaGVoaXJhZ2FuYSJdID0gMHgzMDc4OwogICAgICB0WyJoZWhtZWRpYWxhbHRvbmVhcmFiaWMiXSA9IDB4ZmJhOTsKICAgICAgdFsiaGVobWVkaWFsYXJhYmljIl0gPSAweGZlZWM7CiAgICAgIHRbImhlaXNlaWVyYXNxdWFyZSJdID0gMHgzMzdiOwogICAgICB0WyJoZWthdGFrYW5hIl0gPSAweDMwZDg7CiAgICAgIHRbImhla2F0YWthbmFoYWxmd2lkdGgiXSA9IDB4ZmY4ZDsKICAgICAgdFsiaGVrdXRhYXJ1c3F1YXJlIl0gPSAweDMzMzY7CiAgICAgIHRbImhlbmdob29rIl0gPSAweDAyNjc7CiAgICAgIHRbImhlcnV0dXNxdWFyZSJdID0gMHgzMzM5OwogICAgICB0WyJoZXQiXSA9IDB4MDVkNzsKICAgICAgdFsiaGV0aGVicmV3Il0gPSAweDA1ZDc7CiAgICAgIHRbImhob29rIl0gPSAweDAyNjY7CiAgICAgIHRbImhob29rc3VwZXJpb3IiXSA9IDB4MDJiMTsKICAgICAgdFsiaGlldWhhY2lyY2xla29yZWFuIl0gPSAweDMyN2I7CiAgICAgIHRbImhpZXVoYXBhcmVua29yZWFuIl0gPSAweDMyMWI7CiAgICAgIHRbImhpZXVoY2lyY2xla29yZWFuIl0gPSAweDMyNmQ7CiAgICAgIHRbImhpZXVoa29yZWFuIl0gPSAweDMxNGU7CiAgICAgIHRbImhpZXVocGFyZW5rb3JlYW4iXSA9IDB4MzIwZDsKICAgICAgdFsiaGloaXJhZ2FuYSJdID0gMHgzMDcyOwogICAgICB0WyJoaWthdGFrYW5hIl0gPSAweDMwZDI7CiAgICAgIHRbImhpa2F0YWthbmFoYWxmd2lkdGgiXSA9IDB4ZmY4YjsKICAgICAgdFsiaGlyaXEiXSA9IDB4MDViNDsKICAgICAgdFsiaGlyaXExNCJdID0gMHgwNWI0OwogICAgICB0WyJoaXJpcTIxIl0gPSAweDA1YjQ7CiAgICAgIHRbImhpcmlxMmQiXSA9IDB4MDViNDsKICAgICAgdFsiaGlyaXFoZWJyZXciXSA9IDB4MDViNDsKICAgICAgdFsiaGlyaXFuYXJyb3doZWJyZXciXSA9IDB4MDViNDsKICAgICAgdFsiaGlyaXFxdWFydGVyaGVicmV3Il0gPSAweDA1YjQ7CiAgICAgIHRbImhpcmlxd2lkZWhlYnJldyJdID0gMHgwNWI0OwogICAgICB0WyJobGluZWJlbG93Il0gPSAweDFlOTY7CiAgICAgIHRbImhtb25vc3BhY2UiXSA9IDB4ZmY0ODsKICAgICAgdFsiaG9hcm1lbmlhbiJdID0gMHgwNTcwOwogICAgICB0WyJob2hpcHRoYWkiXSA9IDB4MGUyYjsKICAgICAgdFsiaG9oaXJhZ2FuYSJdID0gMHgzMDdiOwogICAgICB0WyJob2thdGFrYW5hIl0gPSAweDMwZGI7CiAgICAgIHRbImhva2F0YWthbmFoYWxmd2lkdGgiXSA9IDB4ZmY4ZTsKICAgICAgdFsiaG9sYW0iXSA9IDB4MDViOTsKICAgICAgdFsiaG9sYW0xOSJdID0gMHgwNWI5OwogICAgICB0WyJob2xhbTI2Il0gPSAweDA1Yjk7CiAgICAgIHRbImhvbGFtMzIiXSA9IDB4MDViOTsKICAgICAgdFsiaG9sYW1oZWJyZXciXSA9IDB4MDViOTsKICAgICAgdFsiaG9sYW1uYXJyb3doZWJyZXciXSA9IDB4MDViOTsKICAgICAgdFsiaG9sYW1xdWFydGVyaGVicmV3Il0gPSAweDA1Yjk7CiAgICAgIHRbImhvbGFtd2lkZWhlYnJldyJdID0gMHgwNWI5OwogICAgICB0WyJob25va2h1a3RoYWkiXSA9IDB4MGUyZTsKICAgICAgdFsiaG9va2Fib3ZlY29tYiJdID0gMHgwMzA5OwogICAgICB0WyJob29rY21iIl0gPSAweDAzMDk7CiAgICAgIHRbImhvb2twYWxhdGFsaXplZGJlbG93Y21iIl0gPSAweDAzMjE7CiAgICAgIHRbImhvb2tyZXRyb2ZsZXhiZWxvd2NtYiJdID0gMHgwMzIyOwogICAgICB0WyJob29uc3F1YXJlIl0gPSAweDMzNDI7CiAgICAgIHRbImhvcmljb3B0aWMiXSA9IDB4MDNlOTsKICAgICAgdFsiaG9yaXpvbnRhbGJhciJdID0gMHgyMDE1OwogICAgICB0WyJob3JuY21iIl0gPSAweDAzMWI7CiAgICAgIHRbImhvdHNwcmluZ3MiXSA9IDB4MjY2ODsKICAgICAgdFsiaG91c2UiXSA9IDB4MjMwMjsKICAgICAgdFsiaHBhcmVuIl0gPSAweDI0YTM7CiAgICAgIHRbImhzdXBlcmlvciJdID0gMHgwMmIwOwogICAgICB0WyJodHVybmVkIl0gPSAweDAyNjU7CiAgICAgIHRbImh1aGlyYWdhbmEiXSA9IDB4MzA3NTsKICAgICAgdFsiaHVpaXRvc3F1YXJlIl0gPSAweDMzMzM7CiAgICAgIHRbImh1a2F0YWthbmEiXSA9IDB4MzBkNTsKICAgICAgdFsiaHVrYXRha2FuYWhhbGZ3aWR0aCJdID0gMHhmZjhjOwogICAgICB0WyJodW5nYXJ1bWxhdXQiXSA9IDB4MDJkZDsKICAgICAgdFsiaHVuZ2FydW1sYXV0Y21iIl0gPSAweDAzMGI7CiAgICAgIHRbImh2Il0gPSAweDAxOTU7CiAgICAgIHRbImh5cGhlbiJdID0gMHgwMDJkOwogICAgICB0WyJoeXBoZW5pbmZlcmlvciJdID0gMHhmNmU1OwogICAgICB0WyJoeXBoZW5tb25vc3BhY2UiXSA9IDB4ZmYwZDsKICAgICAgdFsiaHlwaGVuc21hbGwiXSA9IDB4ZmU2MzsKICAgICAgdFsiaHlwaGVuc3VwZXJpb3IiXSA9IDB4ZjZlNjsKICAgICAgdFsiaHlwaGVudHdvIl0gPSAweDIwMTA7CiAgICAgIHRbImkiXSA9IDB4MDA2OTsKICAgICAgdFsiaWFjdXRlIl0gPSAweDAwZWQ7CiAgICAgIHRbImlhY3lyaWxsaWMiXSA9IDB4MDQ0ZjsKICAgICAgdFsiaWJlbmdhbGkiXSA9IDB4MDk4NzsKICAgICAgdFsiaWJvcG9tb2ZvIl0gPSAweDMxMjc7CiAgICAgIHRbImlicmV2ZSJdID0gMHgwMTJkOwogICAgICB0WyJpY2Fyb24iXSA9IDB4MDFkMDsKICAgICAgdFsiaWNpcmNsZSJdID0gMHgyNGQ4OwogICAgICB0WyJpY2lyY3VtZmxleCJdID0gMHgwMGVlOwogICAgICB0WyJpY3lyaWxsaWMiXSA9IDB4MDQ1NjsKICAgICAgdFsiaWRibGdyYXZlIl0gPSAweDAyMDk7CiAgICAgIHRbImlkZW9ncmFwaGVhcnRoY2lyY2xlIl0gPSAweDMyOGY7CiAgICAgIHRbImlkZW9ncmFwaGZpcmVjaXJjbGUiXSA9IDB4MzI4YjsKICAgICAgdFsiaWRlb2dyYXBoaWNhbGxpYW5jZXBhcmVuIl0gPSAweDMyM2Y7CiAgICAgIHRbImlkZW9ncmFwaGljY2FsbHBhcmVuIl0gPSAweDMyM2E7CiAgICAgIHRbImlkZW9ncmFwaGljY2VudHJlY2lyY2xlIl0gPSAweDMyYTU7CiAgICAgIHRbImlkZW9ncmFwaGljY2xvc2UiXSA9IDB4MzAwNjsKICAgICAgdFsiaWRlb2dyYXBoaWNjb21tYSJdID0gMHgzMDAxOwogICAgICB0WyJpZGVvZ3JhcGhpY2NvbW1hbGVmdCJdID0gMHhmZjY0OwogICAgICB0WyJpZGVvZ3JhcGhpY2NvbmdyYXR1bGF0aW9ucGFyZW4iXSA9IDB4MzIzNzsKICAgICAgdFsiaWRlb2dyYXBoaWNjb3JyZWN0Y2lyY2xlIl0gPSAweDMyYTM7CiAgICAgIHRbImlkZW9ncmFwaGljZWFydGhwYXJlbiJdID0gMHgzMjJmOwogICAgICB0WyJpZGVvZ3JhcGhpY2VudGVycHJpc2VwYXJlbiJdID0gMHgzMjNkOwogICAgICB0WyJpZGVvZ3JhcGhpY2V4Y2VsbGVudGNpcmNsZSJdID0gMHgzMjlkOwogICAgICB0WyJpZGVvZ3JhcGhpY2Zlc3RpdmFscGFyZW4iXSA9IDB4MzI0MDsKICAgICAgdFsiaWRlb2dyYXBoaWNmaW5hbmNpYWxjaXJjbGUiXSA9IDB4MzI5NjsKICAgICAgdFsiaWRlb2dyYXBoaWNmaW5hbmNpYWxwYXJlbiJdID0gMHgzMjM2OwogICAgICB0WyJpZGVvZ3JhcGhpY2ZpcmVwYXJlbiJdID0gMHgzMjJiOwogICAgICB0WyJpZGVvZ3JhcGhpY2hhdmVwYXJlbiJdID0gMHgzMjMyOwogICAgICB0WyJpZGVvZ3JhcGhpY2hpZ2hjaXJjbGUiXSA9IDB4MzJhNDsKICAgICAgdFsiaWRlb2dyYXBoaWNpdGVyYXRpb25tYXJrIl0gPSAweDMwMDU7CiAgICAgIHRbImlkZW9ncmFwaGljbGFib3JjaXJjbGUiXSA9IDB4MzI5ODsKICAgICAgdFsiaWRlb2dyYXBoaWNsYWJvcnBhcmVuIl0gPSAweDMyMzg7CiAgICAgIHRbImlkZW9ncmFwaGljbGVmdGNpcmNsZSJdID0gMHgzMmE3OwogICAgICB0WyJpZGVvZ3JhcGhpY2xvd2NpcmNsZSJdID0gMHgzMmE2OwogICAgICB0WyJpZGVvZ3JhcGhpY21lZGljaW5lY2lyY2xlIl0gPSAweDMyYTk7CiAgICAgIHRbImlkZW9ncmFwaGljbWV0YWxwYXJlbiJdID0gMHgzMjJlOwogICAgICB0WyJpZGVvZ3JhcGhpY21vb25wYXJlbiJdID0gMHgzMjJhOwogICAgICB0WyJpZGVvZ3JhcGhpY25hbWVwYXJlbiJdID0gMHgzMjM0OwogICAgICB0WyJpZGVvZ3JhcGhpY3BlcmlvZCJdID0gMHgzMDAyOwogICAgICB0WyJpZGVvZ3JhcGhpY3ByaW50Y2lyY2xlIl0gPSAweDMyOWU7CiAgICAgIHRbImlkZW9ncmFwaGljcmVhY2hwYXJlbiJdID0gMHgzMjQzOwogICAgICB0WyJpZGVvZ3JhcGhpY3JlcHJlc2VudHBhcmVuIl0gPSAweDMyMzk7CiAgICAgIHRbImlkZW9ncmFwaGljcmVzb3VyY2VwYXJlbiJdID0gMHgzMjNlOwogICAgICB0WyJpZGVvZ3JhcGhpY3JpZ2h0Y2lyY2xlIl0gPSAweDMyYTg7CiAgICAgIHRbImlkZW9ncmFwaGljc2VjcmV0Y2lyY2xlIl0gPSAweDMyOTk7CiAgICAgIHRbImlkZW9ncmFwaGljc2VsZnBhcmVuIl0gPSAweDMyNDI7CiAgICAgIHRbImlkZW9ncmFwaGljc29jaWV0eXBhcmVuIl0gPSAweDMyMzM7CiAgICAgIHRbImlkZW9ncmFwaGljc3BhY2UiXSA9IDB4MzAwMDsKICAgICAgdFsiaWRlb2dyYXBoaWNzcGVjaWFscGFyZW4iXSA9IDB4MzIzNTsKICAgICAgdFsiaWRlb2dyYXBoaWNzdG9ja3BhcmVuIl0gPSAweDMyMzE7CiAgICAgIHRbImlkZW9ncmFwaGljc3R1ZHlwYXJlbiJdID0gMHgzMjNiOwogICAgICB0WyJpZGVvZ3JhcGhpY3N1bnBhcmVuIl0gPSAweDMyMzA7CiAgICAgIHRbImlkZW9ncmFwaGljc3VwZXJ2aXNlcGFyZW4iXSA9IDB4MzIzYzsKICAgICAgdFsiaWRlb2dyYXBoaWN3YXRlcnBhcmVuIl0gPSAweDMyMmM7CiAgICAgIHRbImlkZW9ncmFwaGljd29vZHBhcmVuIl0gPSAweDMyMmQ7CiAgICAgIHRbImlkZW9ncmFwaGljemVybyJdID0gMHgzMDA3OwogICAgICB0WyJpZGVvZ3JhcGhtZXRhbGNpcmNsZSJdID0gMHgzMjhlOwogICAgICB0WyJpZGVvZ3JhcGhtb29uY2lyY2xlIl0gPSAweDMyOGE7CiAgICAgIHRbImlkZW9ncmFwaG5hbWVjaXJjbGUiXSA9IDB4MzI5NDsKICAgICAgdFsiaWRlb2dyYXBoc3VuY2lyY2xlIl0gPSAweDMyOTA7CiAgICAgIHRbImlkZW9ncmFwaHdhdGVyY2lyY2xlIl0gPSAweDMyOGM7CiAgICAgIHRbImlkZW9ncmFwaHdvb2RjaXJjbGUiXSA9IDB4MzI4ZDsKICAgICAgdFsiaWRldmEiXSA9IDB4MDkwNzsKICAgICAgdFsiaWRpZXJlc2lzIl0gPSAweDAwZWY7CiAgICAgIHRbImlkaWVyZXNpc2FjdXRlIl0gPSAweDFlMmY7CiAgICAgIHRbImlkaWVyZXNpc2N5cmlsbGljIl0gPSAweDA0ZTU7CiAgICAgIHRbImlkb3RiZWxvdyJdID0gMHgxZWNiOwogICAgICB0WyJpZWJyZXZlY3lyaWxsaWMiXSA9IDB4MDRkNzsKICAgICAgdFsiaWVjeXJpbGxpYyJdID0gMHgwNDM1OwogICAgICB0WyJpZXVuZ2FjaXJjbGVrb3JlYW4iXSA9IDB4MzI3NTsKICAgICAgdFsiaWV1bmdhcGFyZW5rb3JlYW4iXSA9IDB4MzIxNTsKICAgICAgdFsiaWV1bmdjaXJjbGVrb3JlYW4iXSA9IDB4MzI2NzsKICAgICAgdFsiaWV1bmdrb3JlYW4iXSA9IDB4MzE0NzsKICAgICAgdFsiaWV1bmdwYXJlbmtvcmVhbiJdID0gMHgzMjA3OwogICAgICB0WyJpZ3JhdmUiXSA9IDB4MDBlYzsKICAgICAgdFsiaWd1amFyYXRpIl0gPSAweDBhODc7CiAgICAgIHRbImlndXJtdWtoaSJdID0gMHgwYTA3OwogICAgICB0WyJpaGlyYWdhbmEiXSA9IDB4MzA0NDsKICAgICAgdFsiaWhvb2thYm92ZSJdID0gMHgxZWM5OwogICAgICB0WyJpaWJlbmdhbGkiXSA9IDB4MDk4ODsKICAgICAgdFsiaWljeXJpbGxpYyJdID0gMHgwNDM4OwogICAgICB0WyJpaWRldmEiXSA9IDB4MDkwODsKICAgICAgdFsiaWlndWphcmF0aSJdID0gMHgwYTg4OwogICAgICB0WyJpaWd1cm11a2hpIl0gPSAweDBhMDg7CiAgICAgIHRbImlpbWF0cmFndXJtdWtoaSJdID0gMHgwYTQwOwogICAgICB0WyJpaW52ZXJ0ZWRicmV2ZSJdID0gMHgwMjBiOwogICAgICB0WyJpaXNob3J0Y3lyaWxsaWMiXSA9IDB4MDQzOTsKICAgICAgdFsiaWl2b3dlbHNpZ25iZW5nYWxpIl0gPSAweDA5YzA7CiAgICAgIHRbImlpdm93ZWxzaWduZGV2YSJdID0gMHgwOTQwOwogICAgICB0WyJpaXZvd2Vsc2lnbmd1amFyYXRpIl0gPSAweDBhYzA7CiAgICAgIHRbImlqIl0gPSAweDAxMzM7CiAgICAgIHRbImlrYXRha2FuYSJdID0gMHgzMGE0OwogICAgICB0WyJpa2F0YWthbmFoYWxmd2lkdGgiXSA9IDB4ZmY3MjsKICAgICAgdFsiaWtvcmVhbiJdID0gMHgzMTYzOwogICAgICB0WyJpbGRlIl0gPSAweDAyZGM7CiAgICAgIHRbImlsdXloZWJyZXciXSA9IDB4MDVhYzsKICAgICAgdFsiaW1hY3JvbiJdID0gMHgwMTJiOwogICAgICB0WyJpbWFjcm9uY3lyaWxsaWMiXSA9IDB4MDRlMzsKICAgICAgdFsiaW1hZ2VvcmFwcHJveGltYXRlbHllcXVhbCJdID0gMHgyMjUzOwogICAgICB0WyJpbWF0cmFndXJtdWtoaSJdID0gMHgwYTNmOwogICAgICB0WyJpbW9ub3NwYWNlIl0gPSAweGZmNDk7CiAgICAgIHRbImluY3JlbWVudCJdID0gMHgyMjA2OwogICAgICB0WyJpbmZpbml0eSJdID0gMHgyMjFlOwogICAgICB0WyJpbmlhcm1lbmlhbiJdID0gMHgwNTZiOwogICAgICB0WyJpbnRlZ3JhbCJdID0gMHgyMjJiOwogICAgICB0WyJpbnRlZ3JhbGJvdHRvbSJdID0gMHgyMzIxOwogICAgICB0WyJpbnRlZ3JhbGJ0Il0gPSAweDIzMjE7CiAgICAgIHRbImludGVncmFsZXgiXSA9IDB4ZjhmNTsKICAgICAgdFsiaW50ZWdyYWx0b3AiXSA9IDB4MjMyMDsKICAgICAgdFsiaW50ZWdyYWx0cCJdID0gMHgyMzIwOwogICAgICB0WyJpbnRlcnNlY3Rpb24iXSA9IDB4MjIyOTsKICAgICAgdFsiaW50aXNxdWFyZSJdID0gMHgzMzA1OwogICAgICB0WyJpbnZidWxsZXQiXSA9IDB4MjVkODsKICAgICAgdFsiaW52Y2lyY2xlIl0gPSAweDI1ZDk7CiAgICAgIHRbImludnNtaWxlZmFjZSJdID0gMHgyNjNiOwogICAgICB0WyJpb2N5cmlsbGljIl0gPSAweDA0NTE7CiAgICAgIHRbImlvZ29uZWsiXSA9IDB4MDEyZjsKICAgICAgdFsiaW90YSJdID0gMHgwM2I5OwogICAgICB0WyJpb3RhZGllcmVzaXMiXSA9IDB4MDNjYTsKICAgICAgdFsiaW90YWRpZXJlc2lzdG9ub3MiXSA9IDB4MDM5MDsKICAgICAgdFsiaW90YWxhdGluIl0gPSAweDAyNjk7CiAgICAgIHRbImlvdGF0b25vcyJdID0gMHgwM2FmOwogICAgICB0WyJpcGFyZW4iXSA9IDB4MjRhNDsKICAgICAgdFsiaXJpZ3VybXVraGkiXSA9IDB4MGE3MjsKICAgICAgdFsiaXNtYWxsaGlyYWdhbmEiXSA9IDB4MzA0MzsKICAgICAgdFsiaXNtYWxsa2F0YWthbmEiXSA9IDB4MzBhMzsKICAgICAgdFsiaXNtYWxsa2F0YWthbmFoYWxmd2lkdGgiXSA9IDB4ZmY2ODsKICAgICAgdFsiaXNzaGFyYmVuZ2FsaSJdID0gMHgwOWZhOwogICAgICB0WyJpc3Ryb2tlIl0gPSAweDAyNjg7CiAgICAgIHRbImlzdXBlcmlvciJdID0gMHhmNmVkOwogICAgICB0WyJpdGVyYXRpb25oaXJhZ2FuYSJdID0gMHgzMDlkOwogICAgICB0WyJpdGVyYXRpb25rYXRha2FuYSJdID0gMHgzMGZkOwogICAgICB0WyJpdGlsZGUiXSA9IDB4MDEyOTsKICAgICAgdFsiaXRpbGRlYmVsb3ciXSA9IDB4MWUyZDsKICAgICAgdFsiaXVib3BvbW9mbyJdID0gMHgzMTI5OwogICAgICB0WyJpdWN5cmlsbGljIl0gPSAweDA0NGU7CiAgICAgIHRbIml2b3dlbHNpZ25iZW5nYWxpIl0gPSAweDA5YmY7CiAgICAgIHRbIml2b3dlbHNpZ25kZXZhIl0gPSAweDA5M2Y7CiAgICAgIHRbIml2b3dlbHNpZ25ndWphcmF0aSJdID0gMHgwYWJmOwogICAgICB0WyJpemhpdHNhY3lyaWxsaWMiXSA9IDB4MDQ3NTsKICAgICAgdFsiaXpoaXRzYWRibGdyYXZlY3lyaWxsaWMiXSA9IDB4MDQ3NzsKICAgICAgdFsiaiJdID0gMHgwMDZhOwogICAgICB0WyJqYWFybWVuaWFuIl0gPSAweDA1NzE7CiAgICAgIHRbImphYmVuZ2FsaSJdID0gMHgwOTljOwogICAgICB0WyJqYWRldmEiXSA9IDB4MDkxYzsKICAgICAgdFsiamFndWphcmF0aSJdID0gMHgwYTljOwogICAgICB0WyJqYWd1cm11a2hpIl0gPSAweDBhMWM7CiAgICAgIHRbImpib3BvbW9mbyJdID0gMHgzMTEwOwogICAgICB0WyJqY2Fyb24iXSA9IDB4MDFmMDsKICAgICAgdFsiamNpcmNsZSJdID0gMHgyNGQ5OwogICAgICB0WyJqY2lyY3VtZmxleCJdID0gMHgwMTM1OwogICAgICB0WyJqY3Jvc3NlZHRhaWwiXSA9IDB4MDI5ZDsKICAgICAgdFsiamRvdGxlc3NzdHJva2UiXSA9IDB4MDI1ZjsKICAgICAgdFsiamVjeXJpbGxpYyJdID0gMHgwNDU4OwogICAgICB0WyJqZWVtYXJhYmljIl0gPSAweDA2MmM7CiAgICAgIHRbImplZW1maW5hbGFyYWJpYyJdID0gMHhmZTllOwogICAgICB0WyJqZWVtaW5pdGlhbGFyYWJpYyJdID0gMHhmZTlmOwogICAgICB0WyJqZWVtbWVkaWFsYXJhYmljIl0gPSAweGZlYTA7CiAgICAgIHRbImplaGFyYWJpYyJdID0gMHgwNjk4OwogICAgICB0WyJqZWhmaW5hbGFyYWJpYyJdID0gMHhmYjhiOwogICAgICB0WyJqaGFiZW5nYWxpIl0gPSAweDA5OWQ7CiAgICAgIHRbImpoYWRldmEiXSA9IDB4MDkxZDsKICAgICAgdFsiamhhZ3VqYXJhdGkiXSA9IDB4MGE5ZDsKICAgICAgdFsiamhhZ3VybXVraGkiXSA9IDB4MGExZDsKICAgICAgdFsiamhlaGFybWVuaWFuIl0gPSAweDA1N2I7CiAgICAgIHRbImppcyJdID0gMHgzMDA0OwogICAgICB0WyJqbW9ub3NwYWNlIl0gPSAweGZmNGE7CiAgICAgIHRbImpwYXJlbiJdID0gMHgyNGE1OwogICAgICB0WyJqc3VwZXJpb3IiXSA9IDB4MDJiMjsKICAgICAgdFsiayJdID0gMHgwMDZiOwogICAgICB0WyJrYWJhc2hraXJjeXJpbGxpYyJdID0gMHgwNGExOwogICAgICB0WyJrYWJlbmdhbGkiXSA9IDB4MDk5NTsKICAgICAgdFsia2FjdXRlIl0gPSAweDFlMzE7CiAgICAgIHRbImthY3lyaWxsaWMiXSA9IDB4MDQzYTsKICAgICAgdFsia2FkZXNjZW5kZXJjeXJpbGxpYyJdID0gMHgwNDliOwogICAgICB0WyJrYWRldmEiXSA9IDB4MDkxNTsKICAgICAgdFsia2FmIl0gPSAweDA1ZGI7CiAgICAgIHRbImthZmFyYWJpYyJdID0gMHgwNjQzOwogICAgICB0WyJrYWZkYWdlc2giXSA9IDB4ZmIzYjsKICAgICAgdFsia2FmZGFnZXNoaGVicmV3Il0gPSAweGZiM2I7CiAgICAgIHRbImthZmZpbmFsYXJhYmljIl0gPSAweGZlZGE7CiAgICAgIHRbImthZmhlYnJldyJdID0gMHgwNWRiOwogICAgICB0WyJrYWZpbml0aWFsYXJhYmljIl0gPSAweGZlZGI7CiAgICAgIHRbImthZm1lZGlhbGFyYWJpYyJdID0gMHhmZWRjOwogICAgICB0WyJrYWZyYWZlaGVicmV3Il0gPSAweGZiNGQ7CiAgICAgIHRbImthZ3VqYXJhdGkiXSA9IDB4MGE5NTsKICAgICAgdFsia2FndXJtdWtoaSJdID0gMHgwYTE1OwogICAgICB0WyJrYWhpcmFnYW5hIl0gPSAweDMwNGI7CiAgICAgIHRbImthaG9va2N5cmlsbGljIl0gPSAweDA0YzQ7CiAgICAgIHRbImtha2F0YWthbmEiXSA9IDB4MzBhYjsKICAgICAgdFsia2FrYXRha2FuYWhhbGZ3aWR0aCJdID0gMHhmZjc2OwogICAgICB0WyJrYXBwYSJdID0gMHgwM2JhOwogICAgICB0WyJrYXBwYXN5bWJvbGdyZWVrIl0gPSAweDAzZjA7CiAgICAgIHRbImthcHllb3VubWlldW1rb3JlYW4iXSA9IDB4MzE3MTsKICAgICAgdFsia2FweWVvdW5waGlldXBoa29yZWFuIl0gPSAweDMxODQ7CiAgICAgIHRbImthcHllb3VucGlldXBrb3JlYW4iXSA9IDB4MzE3ODsKICAgICAgdFsia2FweWVvdW5zc2FuZ3BpZXVwa29yZWFuIl0gPSAweDMxNzk7CiAgICAgIHRbImthcm9yaWlzcXVhcmUiXSA9IDB4MzMwZDsKICAgICAgdFsia2FzaGlkYWF1dG9hcmFiaWMiXSA9IDB4MDY0MDsKICAgICAgdFsia2FzaGlkYWF1dG9ub3NpZGViZWFyaW5nYXJhYmljIl0gPSAweDA2NDA7CiAgICAgIHRbImthc21hbGxrYXRha2FuYSJdID0gMHgzMGY1OwogICAgICB0WyJrYXNxdWFyZSJdID0gMHgzMzg0OwogICAgICB0WyJrYXNyYWFyYWJpYyJdID0gMHgwNjUwOwogICAgICB0WyJrYXNyYXRhbmFyYWJpYyJdID0gMHgwNjRkOwogICAgICB0WyJrYXN0cm9rZWN5cmlsbGljIl0gPSAweDA0OWY7CiAgICAgIHRbImthdGFoaXJhcHJvbG9uZ21hcmtoYWxmd2lkdGgiXSA9IDB4ZmY3MDsKICAgICAgdFsia2F2ZXJ0aWNhbHN0cm9rZWN5cmlsbGljIl0gPSAweDA0OWQ7CiAgICAgIHRbImtib3BvbW9mbyJdID0gMHgzMTBlOwogICAgICB0WyJrY2Fsc3F1YXJlIl0gPSAweDMzODk7CiAgICAgIHRbImtjYXJvbiJdID0gMHgwMWU5OwogICAgICB0WyJrY2VkaWxsYSJdID0gMHgwMTM3OwogICAgICB0WyJrY2lyY2xlIl0gPSAweDI0ZGE7CiAgICAgIHRbImtjb21tYWFjY2VudCJdID0gMHgwMTM3OwogICAgICB0WyJrZG90YmVsb3ciXSA9IDB4MWUzMzsKICAgICAgdFsia2VoYXJtZW5pYW4iXSA9IDB4MDU4NDsKICAgICAgdFsia2VoaXJhZ2FuYSJdID0gMHgzMDUxOwogICAgICB0WyJrZWthdGFrYW5hIl0gPSAweDMwYjE7CiAgICAgIHRbImtla2F0YWthbmFoYWxmd2lkdGgiXSA9IDB4ZmY3OTsKICAgICAgdFsia2VuYXJtZW5pYW4iXSA9IDB4MDU2ZjsKICAgICAgdFsia2VzbWFsbGthdGFrYW5hIl0gPSAweDMwZjY7CiAgICAgIHRbImtncmVlbmxhbmRpYyJdID0gMHgwMTM4OwogICAgICB0WyJraGFiZW5nYWxpIl0gPSAweDA5OTY7CiAgICAgIHRbImtoYWN5cmlsbGljIl0gPSAweDA0NDU7CiAgICAgIHRbImtoYWRldmEiXSA9IDB4MDkxNjsKICAgICAgdFsia2hhZ3VqYXJhdGkiXSA9IDB4MGE5NjsKICAgICAgdFsia2hhZ3VybXVraGkiXSA9IDB4MGExNjsKICAgICAgdFsia2hhaGFyYWJpYyJdID0gMHgwNjJlOwogICAgICB0WyJraGFoZmluYWxhcmFiaWMiXSA9IDB4ZmVhNjsKICAgICAgdFsia2hhaGluaXRpYWxhcmFiaWMiXSA9IDB4ZmVhNzsKICAgICAgdFsia2hhaG1lZGlhbGFyYWJpYyJdID0gMHhmZWE4OwogICAgICB0WyJraGVpY29wdGljIl0gPSAweDAzZTc7CiAgICAgIHRbImtoaGFkZXZhIl0gPSAweDA5NTk7CiAgICAgIHRbImtoaGFndXJtdWtoaSJdID0gMHgwYTU5OwogICAgICB0WyJraGlldWtoYWNpcmNsZWtvcmVhbiJdID0gMHgzMjc4OwogICAgICB0WyJraGlldWtoYXBhcmVua29yZWFuIl0gPSAweDMyMTg7CiAgICAgIHRbImtoaWV1a2hjaXJjbGVrb3JlYW4iXSA9IDB4MzI2YTsKICAgICAgdFsia2hpZXVraGtvcmVhbiJdID0gMHgzMTRiOwogICAgICB0WyJraGlldWtocGFyZW5rb3JlYW4iXSA9IDB4MzIwYTsKICAgICAgdFsia2hva2hhaXRoYWkiXSA9IDB4MGUwMjsKICAgICAgdFsia2hva2hvbnRoYWkiXSA9IDB4MGUwNTsKICAgICAgdFsia2hva2h1YXR0aGFpIl0gPSAweDBlMDM7CiAgICAgIHRbImtob2tod2FpdGhhaSJdID0gMHgwZTA0OwogICAgICB0WyJraG9tdXR0aGFpIl0gPSAweDBlNWI7CiAgICAgIHRbImtob29rIl0gPSAweDAxOTk7CiAgICAgIHRbImtob3Jha2hhbmd0aGFpIl0gPSAweDBlMDY7CiAgICAgIHRbImtoenNxdWFyZSJdID0gMHgzMzkxOwogICAgICB0WyJraWhpcmFnYW5hIl0gPSAweDMwNGQ7CiAgICAgIHRbImtpa2F0YWthbmEiXSA9IDB4MzBhZDsKICAgICAgdFsia2lrYXRha2FuYWhhbGZ3aWR0aCJdID0gMHhmZjc3OwogICAgICB0WyJraXJvZ3VyYW11c3F1YXJlIl0gPSAweDMzMTU7CiAgICAgIHRbImtpcm9tZWV0b3J1c3F1YXJlIl0gPSAweDMzMTY7CiAgICAgIHRbImtpcm9zcXVhcmUiXSA9IDB4MzMxNDsKICAgICAgdFsia2l5ZW9rYWNpcmNsZWtvcmVhbiJdID0gMHgzMjZlOwogICAgICB0WyJraXllb2thcGFyZW5rb3JlYW4iXSA9IDB4MzIwZTsKICAgICAgdFsia2l5ZW9rY2lyY2xla29yZWFuIl0gPSAweDMyNjA7CiAgICAgIHRbImtpeWVva2tvcmVhbiJdID0gMHgzMTMxOwogICAgICB0WyJraXllb2twYXJlbmtvcmVhbiJdID0gMHgzMjAwOwogICAgICB0WyJraXllb2tzaW9za29yZWFuIl0gPSAweDMxMzM7CiAgICAgIHRbImtqZWN5cmlsbGljIl0gPSAweDA0NWM7CiAgICAgIHRbImtsaW5lYmVsb3ciXSA9IDB4MWUzNTsKICAgICAgdFsia2xzcXVhcmUiXSA9IDB4MzM5ODsKICAgICAgdFsia21jdWJlZHNxdWFyZSJdID0gMHgzM2E2OwogICAgICB0WyJrbW9ub3NwYWNlIl0gPSAweGZmNGI7CiAgICAgIHRbImttc3F1YXJlZHNxdWFyZSJdID0gMHgzM2EyOwogICAgICB0WyJrb2hpcmFnYW5hIl0gPSAweDMwNTM7CiAgICAgIHRbImtvaG1zcXVhcmUiXSA9IDB4MzNjMDsKICAgICAgdFsia29rYWl0aGFpIl0gPSAweDBlMDE7CiAgICAgIHRbImtva2F0YWthbmEiXSA9IDB4MzBiMzsKICAgICAgdFsia29rYXRha2FuYWhhbGZ3aWR0aCJdID0gMHhmZjdhOwogICAgICB0WyJrb29wb3NxdWFyZSJdID0gMHgzMzFlOwogICAgICB0WyJrb3BwYWN5cmlsbGljIl0gPSAweDA0ODE7CiAgICAgIHRbImtvcmVhbnN0YW5kYXJkc3ltYm9sIl0gPSAweDMyN2Y7CiAgICAgIHRbImtvcm9uaXNjbWIiXSA9IDB4MDM0MzsKICAgICAgdFsia3BhcmVuIl0gPSAweDI0YTY7CiAgICAgIHRbImtwYXNxdWFyZSJdID0gMHgzM2FhOwogICAgICB0WyJrc2ljeXJpbGxpYyJdID0gMHgwNDZmOwogICAgICB0WyJrdHNxdWFyZSJdID0gMHgzM2NmOwogICAgICB0WyJrdHVybmVkIl0gPSAweDAyOWU7CiAgICAgIHRbImt1aGlyYWdhbmEiXSA9IDB4MzA0ZjsKICAgICAgdFsia3VrYXRha2FuYSJdID0gMHgzMGFmOwogICAgICB0WyJrdWthdGFrYW5haGFsZndpZHRoIl0gPSAweGZmNzg7CiAgICAgIHRbImt2c3F1YXJlIl0gPSAweDMzYjg7CiAgICAgIHRbImt3c3F1YXJlIl0gPSAweDMzYmU7CiAgICAgIHRbImwiXSA9IDB4MDA2YzsKICAgICAgdFsibGFiZW5nYWxpIl0gPSAweDA5YjI7CiAgICAgIHRbImxhY3V0ZSJdID0gMHgwMTNhOwogICAgICB0WyJsYWRldmEiXSA9IDB4MDkzMjsKICAgICAgdFsibGFndWphcmF0aSJdID0gMHgwYWIyOwogICAgICB0WyJsYWd1cm11a2hpIl0gPSAweDBhMzI7CiAgICAgIHRbImxha2toYW5neWFvdGhhaSJdID0gMHgwZTQ1OwogICAgICB0WyJsYW1hbGVmZmluYWxhcmFiaWMiXSA9IDB4ZmVmYzsKICAgICAgdFsibGFtYWxlZmhhbXphYWJvdmVmaW5hbGFyYWJpYyJdID0gMHhmZWY4OwogICAgICB0WyJsYW1hbGVmaGFtemFhYm92ZWlzb2xhdGVkYXJhYmljIl0gPSAweGZlZjc7CiAgICAgIHRbImxhbWFsZWZoYW16YWJlbG93ZmluYWxhcmFiaWMiXSA9IDB4ZmVmYTsKICAgICAgdFsibGFtYWxlZmhhbXphYmVsb3dpc29sYXRlZGFyYWJpYyJdID0gMHhmZWY5OwogICAgICB0WyJsYW1hbGVmaXNvbGF0ZWRhcmFiaWMiXSA9IDB4ZmVmYjsKICAgICAgdFsibGFtYWxlZm1hZGRhYWJvdmVmaW5hbGFyYWJpYyJdID0gMHhmZWY2OwogICAgICB0WyJsYW1hbGVmbWFkZGFhYm92ZWlzb2xhdGVkYXJhYmljIl0gPSAweGZlZjU7CiAgICAgIHRbImxhbWFyYWJpYyJdID0gMHgwNjQ0OwogICAgICB0WyJsYW1iZGEiXSA9IDB4MDNiYjsKICAgICAgdFsibGFtYmRhc3Ryb2tlIl0gPSAweDAxOWI7CiAgICAgIHRbImxhbWVkIl0gPSAweDA1ZGM7CiAgICAgIHRbImxhbWVkZGFnZXNoIl0gPSAweGZiM2M7CiAgICAgIHRbImxhbWVkZGFnZXNoaGVicmV3Il0gPSAweGZiM2M7CiAgICAgIHRbImxhbWVkaGVicmV3Il0gPSAweDA1ZGM7CiAgICAgIHRbImxhbWZpbmFsYXJhYmljIl0gPSAweGZlZGU7CiAgICAgIHRbImxhbWhhaGluaXRpYWxhcmFiaWMiXSA9IDB4ZmNjYTsKICAgICAgdFsibGFtaW5pdGlhbGFyYWJpYyJdID0gMHhmZWRmOwogICAgICB0WyJsYW1qZWVtaW5pdGlhbGFyYWJpYyJdID0gMHhmY2M5OwogICAgICB0WyJsYW1raGFoaW5pdGlhbGFyYWJpYyJdID0gMHhmY2NiOwogICAgICB0WyJsYW1sYW1oZWhpc29sYXRlZGFyYWJpYyJdID0gMHhmZGYyOwogICAgICB0WyJsYW1tZWRpYWxhcmFiaWMiXSA9IDB4ZmVlMDsKICAgICAgdFsibGFtbWVlbWhhaGluaXRpYWxhcmFiaWMiXSA9IDB4ZmQ4ODsKICAgICAgdFsibGFtbWVlbWluaXRpYWxhcmFiaWMiXSA9IDB4ZmNjYzsKICAgICAgdFsibGFyZ2VjaXJjbGUiXSA9IDB4MjVlZjsKICAgICAgdFsibGJhciJdID0gMHgwMTlhOwogICAgICB0WyJsYmVsdCJdID0gMHgwMjZjOwogICAgICB0WyJsYm9wb21vZm8iXSA9IDB4MzEwYzsKICAgICAgdFsibGNhcm9uIl0gPSAweDAxM2U7CiAgICAgIHRbImxjZWRpbGxhIl0gPSAweDAxM2M7CiAgICAgIHRbImxjaXJjbGUiXSA9IDB4MjRkYjsKICAgICAgdFsibGNpcmN1bWZsZXhiZWxvdyJdID0gMHgxZTNkOwogICAgICB0WyJsY29tbWFhY2NlbnQiXSA9IDB4MDEzYzsKICAgICAgdFsibGRvdCJdID0gMHgwMTQwOwogICAgICB0WyJsZG90YWNjZW50Il0gPSAweDAxNDA7CiAgICAgIHRbImxkb3RiZWxvdyJdID0gMHgxZTM3OwogICAgICB0WyJsZG90YmVsb3dtYWNyb24iXSA9IDB4MWUzOTsKICAgICAgdFsibGVmdGFuZ2xlYWJvdmVjbWIiXSA9IDB4MDMxYTsKICAgICAgdFsibGVmdHRhY2tiZWxvd2NtYiJdID0gMHgwMzE4OwogICAgICB0WyJsZXNzIl0gPSAweDAwM2M7CiAgICAgIHRbImxlc3NlcXVhbCJdID0gMHgyMjY0OwogICAgICB0WyJsZXNzZXF1YWxvcmdyZWF0ZXIiXSA9IDB4MjJkYTsKICAgICAgdFsibGVzc21vbm9zcGFjZSJdID0gMHhmZjFjOwogICAgICB0WyJsZXNzb3JlcXVpdmFsZW50Il0gPSAweDIyNzI7CiAgICAgIHRbImxlc3NvcmdyZWF0ZXIiXSA9IDB4MjI3NjsKICAgICAgdFsibGVzc292ZXJlcXVhbCJdID0gMHgyMjY2OwogICAgICB0WyJsZXNzc21hbGwiXSA9IDB4ZmU2NDsKICAgICAgdFsibGV6aCJdID0gMHgwMjZlOwogICAgICB0WyJsZmJsb2NrIl0gPSAweDI1OGM7CiAgICAgIHRbImxob29rcmV0cm9mbGV4Il0gPSAweDAyNmQ7CiAgICAgIHRbImxpcmEiXSA9IDB4MjBhNDsKICAgICAgdFsibGl3bmFybWVuaWFuIl0gPSAweDA1NmM7CiAgICAgIHRbImxqIl0gPSAweDAxYzk7CiAgICAgIHRbImxqZWN5cmlsbGljIl0gPSAweDA0NTk7CiAgICAgIHRbImxsIl0gPSAweGY2YzA7CiAgICAgIHRbImxsYWRldmEiXSA9IDB4MDkzMzsKICAgICAgdFsibGxhZ3VqYXJhdGkiXSA9IDB4MGFiMzsKICAgICAgdFsibGxpbmViZWxvdyJdID0gMHgxZTNiOwogICAgICB0WyJsbGxhZGV2YSJdID0gMHgwOTM0OwogICAgICB0WyJsbHZvY2FsaWNiZW5nYWxpIl0gPSAweDA5ZTE7CiAgICAgIHRbImxsdm9jYWxpY2RldmEiXSA9IDB4MDk2MTsKICAgICAgdFsibGx2b2NhbGljdm93ZWxzaWduYmVuZ2FsaSJdID0gMHgwOWUzOwogICAgICB0WyJsbHZvY2FsaWN2b3dlbHNpZ25kZXZhIl0gPSAweDA5NjM7CiAgICAgIHRbImxtaWRkbGV0aWxkZSJdID0gMHgwMjZiOwogICAgICB0WyJsbW9ub3NwYWNlIl0gPSAweGZmNGM7CiAgICAgIHRbImxtc3F1YXJlIl0gPSAweDMzZDA7CiAgICAgIHRbImxvY2h1bGF0aGFpIl0gPSAweDBlMmM7CiAgICAgIHRbImxvZ2ljYWxhbmQiXSA9IDB4MjIyNzsKICAgICAgdFsibG9naWNhbG5vdCJdID0gMHgwMGFjOwogICAgICB0WyJsb2dpY2Fsbm90cmV2ZXJzZWQiXSA9IDB4MjMxMDsKICAgICAgdFsibG9naWNhbG9yIl0gPSAweDIyMjg7CiAgICAgIHRbImxvbGluZ3RoYWkiXSA9IDB4MGUyNTsKICAgICAgdFsibG9uZ3MiXSA9IDB4MDE3ZjsKICAgICAgdFsibG93bGluZWNlbnRlcmxpbmUiXSA9IDB4ZmU0ZTsKICAgICAgdFsibG93bGluZWNtYiJdID0gMHgwMzMyOwogICAgICB0WyJsb3dsaW5lZGFzaGVkIl0gPSAweGZlNGQ7CiAgICAgIHRbImxvemVuZ2UiXSA9IDB4MjVjYTsKICAgICAgdFsibHBhcmVuIl0gPSAweDI0YTc7CiAgICAgIHRbImxzbGFzaCJdID0gMHgwMTQyOwogICAgICB0WyJsc3F1YXJlIl0gPSAweDIxMTM7CiAgICAgIHRbImxzdXBlcmlvciJdID0gMHhmNmVlOwogICAgICB0WyJsdHNoYWRlIl0gPSAweDI1OTE7CiAgICAgIHRbImx1dGhhaSJdID0gMHgwZTI2OwogICAgICB0WyJsdm9jYWxpY2JlbmdhbGkiXSA9IDB4MDk4YzsKICAgICAgdFsibHZvY2FsaWNkZXZhIl0gPSAweDA5MGM7CiAgICAgIHRbImx2b2NhbGljdm93ZWxzaWduYmVuZ2FsaSJdID0gMHgwOWUyOwogICAgICB0WyJsdm9jYWxpY3Zvd2Vsc2lnbmRldmEiXSA9IDB4MDk2MjsKICAgICAgdFsibHhzcXVhcmUiXSA9IDB4MzNkMzsKICAgICAgdFsibSJdID0gMHgwMDZkOwogICAgICB0WyJtYWJlbmdhbGkiXSA9IDB4MDlhZTsKICAgICAgdFsibWFjcm9uIl0gPSAweDAwYWY7CiAgICAgIHRbIm1hY3JvbmJlbG93Y21iIl0gPSAweDAzMzE7CiAgICAgIHRbIm1hY3JvbmNtYiJdID0gMHgwMzA0OwogICAgICB0WyJtYWNyb25sb3dtb2QiXSA9IDB4MDJjZDsKICAgICAgdFsibWFjcm9ubW9ub3NwYWNlIl0gPSAweGZmZTM7CiAgICAgIHRbIm1hY3V0ZSJdID0gMHgxZTNmOwogICAgICB0WyJtYWRldmEiXSA9IDB4MDkyZTsKICAgICAgdFsibWFndWphcmF0aSJdID0gMHgwYWFlOwogICAgICB0WyJtYWd1cm11a2hpIl0gPSAweDBhMmU7CiAgICAgIHRbIm1haGFwYWtoaGVicmV3Il0gPSAweDA1YTQ7CiAgICAgIHRbIm1haGFwYWtobGVmdGhlYnJldyJdID0gMHgwNWE0OwogICAgICB0WyJtYWhpcmFnYW5hIl0gPSAweDMwN2U7CiAgICAgIHRbIm1haWNoYXR0YXdhbG93bGVmdHRoYWkiXSA9IDB4Zjg5NTsKICAgICAgdFsibWFpY2hhdHRhd2Fsb3dyaWdodHRoYWkiXSA9IDB4Zjg5NDsKICAgICAgdFsibWFpY2hhdHRhd2F0aGFpIl0gPSAweDBlNGI7CiAgICAgIHRbIm1haWNoYXR0YXdhdXBwZXJsZWZ0dGhhaSJdID0gMHhmODkzOwogICAgICB0WyJtYWlla2xvd2xlZnR0aGFpIl0gPSAweGY4OGM7CiAgICAgIHRbIm1haWVrbG93cmlnaHR0aGFpIl0gPSAweGY4OGI7CiAgICAgIHRbIm1haWVrdGhhaSJdID0gMHgwZTQ4OwogICAgICB0WyJtYWlla3VwcGVybGVmdHRoYWkiXSA9IDB4Zjg4YTsKICAgICAgdFsibWFpaGFuYWthdGxlZnR0aGFpIl0gPSAweGY4ODQ7CiAgICAgIHRbIm1haWhhbmFrYXR0aGFpIl0gPSAweDBlMzE7CiAgICAgIHRbIm1haXRhaWtodWxlZnR0aGFpIl0gPSAweGY4ODk7CiAgICAgIHRbIm1haXRhaWtodXRoYWkiXSA9IDB4MGU0NzsKICAgICAgdFsibWFpdGhvbG93bGVmdHRoYWkiXSA9IDB4Zjg4ZjsKICAgICAgdFsibWFpdGhvbG93cmlnaHR0aGFpIl0gPSAweGY4OGU7CiAgICAgIHRbIm1haXRob3RoYWkiXSA9IDB4MGU0OTsKICAgICAgdFsibWFpdGhvdXBwZXJsZWZ0dGhhaSJdID0gMHhmODhkOwogICAgICB0WyJtYWl0cmlsb3dsZWZ0dGhhaSJdID0gMHhmODkyOwogICAgICB0WyJtYWl0cmlsb3dyaWdodHRoYWkiXSA9IDB4Zjg5MTsKICAgICAgdFsibWFpdHJpdGhhaSJdID0gMHgwZTRhOwogICAgICB0WyJtYWl0cml1cHBlcmxlZnR0aGFpIl0gPSAweGY4OTA7CiAgICAgIHRbIm1haXlhbW9rdGhhaSJdID0gMHgwZTQ2OwogICAgICB0WyJtYWthdGFrYW5hIl0gPSAweDMwZGU7CiAgICAgIHRbIm1ha2F0YWthbmFoYWxmd2lkdGgiXSA9IDB4ZmY4ZjsKICAgICAgdFsibWFsZSJdID0gMHgyNjQyOwogICAgICB0WyJtYW5zeW9uc3F1YXJlIl0gPSAweDMzNDc7CiAgICAgIHRbIm1hcWFmaGVicmV3Il0gPSAweDA1YmU7CiAgICAgIHRbIm1hcnMiXSA9IDB4MjY0MjsKICAgICAgdFsibWFzb3JhY2lyY2xlaGVicmV3Il0gPSAweDA1YWY7CiAgICAgIHRbIm1hc3F1YXJlIl0gPSAweDMzODM7CiAgICAgIHRbIm1ib3BvbW9mbyJdID0gMHgzMTA3OwogICAgICB0WyJtYnNxdWFyZSJdID0gMHgzM2Q0OwogICAgICB0WyJtY2lyY2xlIl0gPSAweDI0ZGM7CiAgICAgIHRbIm1jdWJlZHNxdWFyZSJdID0gMHgzM2E1OwogICAgICB0WyJtZG90YWNjZW50Il0gPSAweDFlNDE7CiAgICAgIHRbIm1kb3RiZWxvdyJdID0gMHgxZTQzOwogICAgICB0WyJtZWVtYXJhYmljIl0gPSAweDA2NDU7CiAgICAgIHRbIm1lZW1maW5hbGFyYWJpYyJdID0gMHhmZWUyOwogICAgICB0WyJtZWVtaW5pdGlhbGFyYWJpYyJdID0gMHhmZWUzOwogICAgICB0WyJtZWVtbWVkaWFsYXJhYmljIl0gPSAweGZlZTQ7CiAgICAgIHRbIm1lZW1tZWVtaW5pdGlhbGFyYWJpYyJdID0gMHhmY2QxOwogICAgICB0WyJtZWVtbWVlbWlzb2xhdGVkYXJhYmljIl0gPSAweGZjNDg7CiAgICAgIHRbIm1lZXRvcnVzcXVhcmUiXSA9IDB4MzM0ZDsKICAgICAgdFsibWVoaXJhZ2FuYSJdID0gMHgzMDgxOwogICAgICB0WyJtZWl6aWVyYXNxdWFyZSJdID0gMHgzMzdlOwogICAgICB0WyJtZWthdGFrYW5hIl0gPSAweDMwZTE7CiAgICAgIHRbIm1la2F0YWthbmFoYWxmd2lkdGgiXSA9IDB4ZmY5MjsKICAgICAgdFsibWVtIl0gPSAweDA1ZGU7CiAgICAgIHRbIm1lbWRhZ2VzaCJdID0gMHhmYjNlOwogICAgICB0WyJtZW1kYWdlc2hoZWJyZXciXSA9IDB4ZmIzZTsKICAgICAgdFsibWVtaGVicmV3Il0gPSAweDA1ZGU7CiAgICAgIHRbIm1lbmFybWVuaWFuIl0gPSAweDA1NzQ7CiAgICAgIHRbIm1lcmtoYWhlYnJldyJdID0gMHgwNWE1OwogICAgICB0WyJtZXJraGFrZWZ1bGFoZWJyZXciXSA9IDB4MDVhNjsKICAgICAgdFsibWVya2hha2VmdWxhbGVmdGhlYnJldyJdID0gMHgwNWE2OwogICAgICB0WyJtZXJraGFsZWZ0aGVicmV3Il0gPSAweDA1YTU7CiAgICAgIHRbIm1ob29rIl0gPSAweDAyNzE7CiAgICAgIHRbIm1oenNxdWFyZSJdID0gMHgzMzkyOwogICAgICB0WyJtaWRkbGVkb3RrYXRha2FuYWhhbGZ3aWR0aCJdID0gMHhmZjY1OwogICAgICB0WyJtaWRkb3QiXSA9IDB4MDBiNzsKICAgICAgdFsibWlldW1hY2lyY2xla29yZWFuIl0gPSAweDMyNzI7CiAgICAgIHRbIm1pZXVtYXBhcmVua29yZWFuIl0gPSAweDMyMTI7CiAgICAgIHRbIm1pZXVtY2lyY2xla29yZWFuIl0gPSAweDMyNjQ7CiAgICAgIHRbIm1pZXVta29yZWFuIl0gPSAweDMxNDE7CiAgICAgIHRbIm1pZXVtcGFuc2lvc2tvcmVhbiJdID0gMHgzMTcwOwogICAgICB0WyJtaWV1bXBhcmVua29yZWFuIl0gPSAweDMyMDQ7CiAgICAgIHRbIm1pZXVtcGlldXBrb3JlYW4iXSA9IDB4MzE2ZTsKICAgICAgdFsibWlldW1zaW9za29yZWFuIl0gPSAweDMxNmY7CiAgICAgIHRbIm1paGlyYWdhbmEiXSA9IDB4MzA3ZjsKICAgICAgdFsibWlrYXRha2FuYSJdID0gMHgzMGRmOwogICAgICB0WyJtaWthdGFrYW5haGFsZndpZHRoIl0gPSAweGZmOTA7CiAgICAgIHRbIm1pbnVzIl0gPSAweDIyMTI7CiAgICAgIHRbIm1pbnVzYmVsb3djbWIiXSA9IDB4MDMyMDsKICAgICAgdFsibWludXNjaXJjbGUiXSA9IDB4MjI5NjsKICAgICAgdFsibWludXNtb2QiXSA9IDB4MDJkNzsKICAgICAgdFsibWludXNwbHVzIl0gPSAweDIyMTM7CiAgICAgIHRbIm1pbnV0ZSJdID0gMHgyMDMyOwogICAgICB0WyJtaXJpYmFhcnVzcXVhcmUiXSA9IDB4MzM0YTsKICAgICAgdFsibWlyaXNxdWFyZSJdID0gMHgzMzQ5OwogICAgICB0WyJtbG9uZ2xlZ3R1cm5lZCJdID0gMHgwMjcwOwogICAgICB0WyJtbHNxdWFyZSJdID0gMHgzMzk2OwogICAgICB0WyJtbWN1YmVkc3F1YXJlIl0gPSAweDMzYTM7CiAgICAgIHRbIm1tb25vc3BhY2UiXSA9IDB4ZmY0ZDsKICAgICAgdFsibW1zcXVhcmVkc3F1YXJlIl0gPSAweDMzOWY7CiAgICAgIHRbIm1vaGlyYWdhbmEiXSA9IDB4MzA4MjsKICAgICAgdFsibW9obXNxdWFyZSJdID0gMHgzM2MxOwogICAgICB0WyJtb2thdGFrYW5hIl0gPSAweDMwZTI7CiAgICAgIHRbIm1va2F0YWthbmFoYWxmd2lkdGgiXSA9IDB4ZmY5MzsKICAgICAgdFsibW9sc3F1YXJlIl0gPSAweDMzZDY7CiAgICAgIHRbIm1vbWF0aGFpIl0gPSAweDBlMjE7CiAgICAgIHRbIm1vdmVyc3NxdWFyZSJdID0gMHgzM2E3OwogICAgICB0WyJtb3ZlcnNzcXVhcmVkc3F1YXJlIl0gPSAweDMzYTg7CiAgICAgIHRbIm1wYXJlbiJdID0gMHgyNGE4OwogICAgICB0WyJtcGFzcXVhcmUiXSA9IDB4MzNhYjsKICAgICAgdFsibXNzcXVhcmUiXSA9IDB4MzNiMzsKICAgICAgdFsibXN1cGVyaW9yIl0gPSAweGY2ZWY7CiAgICAgIHRbIm10dXJuZWQiXSA9IDB4MDI2ZjsKICAgICAgdFsibXUiXSA9IDB4MDBiNTsKICAgICAgdFsibXUxIl0gPSAweDAwYjU7CiAgICAgIHRbIm11YXNxdWFyZSJdID0gMHgzMzgyOwogICAgICB0WyJtdWNoZ3JlYXRlciJdID0gMHgyMjZiOwogICAgICB0WyJtdWNobGVzcyJdID0gMHgyMjZhOwogICAgICB0WyJtdWZzcXVhcmUiXSA9IDB4MzM4YzsKICAgICAgdFsibXVncmVlayJdID0gMHgwM2JjOwogICAgICB0WyJtdWdzcXVhcmUiXSA9IDB4MzM4ZDsKICAgICAgdFsibXVoaXJhZ2FuYSJdID0gMHgzMDgwOwogICAgICB0WyJtdWthdGFrYW5hIl0gPSAweDMwZTA7CiAgICAgIHRbIm11a2F0YWthbmFoYWxmd2lkdGgiXSA9IDB4ZmY5MTsKICAgICAgdFsibXVsc3F1YXJlIl0gPSAweDMzOTU7CiAgICAgIHRbIm11bHRpcGx5Il0gPSAweDAwZDc7CiAgICAgIHRbIm11bXNxdWFyZSJdID0gMHgzMzliOwogICAgICB0WyJtdW5haGhlYnJldyJdID0gMHgwNWEzOwogICAgICB0WyJtdW5haGxlZnRoZWJyZXciXSA9IDB4MDVhMzsKICAgICAgdFsibXVzaWNhbG5vdGUiXSA9IDB4MjY2YTsKICAgICAgdFsibXVzaWNhbG5vdGVkYmwiXSA9IDB4MjY2YjsKICAgICAgdFsibXVzaWNmbGF0c2lnbiJdID0gMHgyNjZkOwogICAgICB0WyJtdXNpY3NoYXJwc2lnbiJdID0gMHgyNjZmOwogICAgICB0WyJtdXNzcXVhcmUiXSA9IDB4MzNiMjsKICAgICAgdFsibXV2c3F1YXJlIl0gPSAweDMzYjY7CiAgICAgIHRbIm11d3NxdWFyZSJdID0gMHgzM2JjOwogICAgICB0WyJtdm1lZ2FzcXVhcmUiXSA9IDB4MzNiOTsKICAgICAgdFsibXZzcXVhcmUiXSA9IDB4MzNiNzsKICAgICAgdFsibXdtZWdhc3F1YXJlIl0gPSAweDMzYmY7CiAgICAgIHRbIm13c3F1YXJlIl0gPSAweDMzYmQ7CiAgICAgIHRbIm4iXSA9IDB4MDA2ZTsKICAgICAgdFsibmFiZW5nYWxpIl0gPSAweDA5YTg7CiAgICAgIHRbIm5hYmxhIl0gPSAweDIyMDc7CiAgICAgIHRbIm5hY3V0ZSJdID0gMHgwMTQ0OwogICAgICB0WyJuYWRldmEiXSA9IDB4MDkyODsKICAgICAgdFsibmFndWphcmF0aSJdID0gMHgwYWE4OwogICAgICB0WyJuYWd1cm11a2hpIl0gPSAweDBhMjg7CiAgICAgIHRbIm5haGlyYWdhbmEiXSA9IDB4MzA2YTsKICAgICAgdFsibmFrYXRha2FuYSJdID0gMHgzMGNhOwogICAgICB0WyJuYWthdGFrYW5haGFsZndpZHRoIl0gPSAweGZmODU7CiAgICAgIHRbIm5hcG9zdHJvcGhlIl0gPSAweDAxNDk7CiAgICAgIHRbIm5hc3F1YXJlIl0gPSAweDMzODE7CiAgICAgIHRbIm5ib3BvbW9mbyJdID0gMHgzMTBiOwogICAgICB0WyJuYnNwYWNlIl0gPSAweDAwYTA7CiAgICAgIHRbIm5jYXJvbiJdID0gMHgwMTQ4OwogICAgICB0WyJuY2VkaWxsYSJdID0gMHgwMTQ2OwogICAgICB0WyJuY2lyY2xlIl0gPSAweDI0ZGQ7CiAgICAgIHRbIm5jaXJjdW1mbGV4YmVsb3ciXSA9IDB4MWU0YjsKICAgICAgdFsibmNvbW1hYWNjZW50Il0gPSAweDAxNDY7CiAgICAgIHRbIm5kb3RhY2NlbnQiXSA9IDB4MWU0NTsKICAgICAgdFsibmRvdGJlbG93Il0gPSAweDFlNDc7CiAgICAgIHRbIm5laGlyYWdhbmEiXSA9IDB4MzA2ZDsKICAgICAgdFsibmVrYXRha2FuYSJdID0gMHgzMGNkOwogICAgICB0WyJuZWthdGFrYW5haGFsZndpZHRoIl0gPSAweGZmODg7CiAgICAgIHRbIm5ld3NoZXFlbHNpZ24iXSA9IDB4MjBhYTsKICAgICAgdFsibmZzcXVhcmUiXSA9IDB4MzM4YjsKICAgICAgdFsibmdhYmVuZ2FsaSJdID0gMHgwOTk5OwogICAgICB0WyJuZ2FkZXZhIl0gPSAweDA5MTk7CiAgICAgIHRbIm5nYWd1amFyYXRpIl0gPSAweDBhOTk7CiAgICAgIHRbIm5nYWd1cm11a2hpIl0gPSAweDBhMTk7CiAgICAgIHRbIm5nb25ndXRoYWkiXSA9IDB4MGUwNzsKICAgICAgdFsibmhpcmFnYW5hIl0gPSAweDMwOTM7CiAgICAgIHRbIm5ob29rbGVmdCJdID0gMHgwMjcyOwogICAgICB0WyJuaG9va3JldHJvZmxleCJdID0gMHgwMjczOwogICAgICB0WyJuaWV1bmFjaXJjbGVrb3JlYW4iXSA9IDB4MzI2ZjsKICAgICAgdFsibmlldW5hcGFyZW5rb3JlYW4iXSA9IDB4MzIwZjsKICAgICAgdFsibmlldW5jaWV1Y2tvcmVhbiJdID0gMHgzMTM1OwogICAgICB0WyJuaWV1bmNpcmNsZWtvcmVhbiJdID0gMHgzMjYxOwogICAgICB0WyJuaWV1bmhpZXVoa29yZWFuIl0gPSAweDMxMzY7CiAgICAgIHRbIm5pZXVua29yZWFuIl0gPSAweDMxMzQ7CiAgICAgIHRbIm5pZXVucGFuc2lvc2tvcmVhbiJdID0gMHgzMTY4OwogICAgICB0WyJuaWV1bnBhcmVua29yZWFuIl0gPSAweDMyMDE7CiAgICAgIHRbIm5pZXVuc2lvc2tvcmVhbiJdID0gMHgzMTY3OwogICAgICB0WyJuaWV1bnRpa2V1dGtvcmVhbiJdID0gMHgzMTY2OwogICAgICB0WyJuaWhpcmFnYW5hIl0gPSAweDMwNmI7CiAgICAgIHRbIm5pa2F0YWthbmEiXSA9IDB4MzBjYjsKICAgICAgdFsibmlrYXRha2FuYWhhbGZ3aWR0aCJdID0gMHhmZjg2OwogICAgICB0WyJuaWtoYWhpdGxlZnR0aGFpIl0gPSAweGY4OTk7CiAgICAgIHRbIm5pa2hhaGl0dGhhaSJdID0gMHgwZTRkOwogICAgICB0WyJuaW5lIl0gPSAweDAwMzk7CiAgICAgIHRbIm5pbmVhcmFiaWMiXSA9IDB4MDY2OTsKICAgICAgdFsibmluZWJlbmdhbGkiXSA9IDB4MDllZjsKICAgICAgdFsibmluZWNpcmNsZSJdID0gMHgyNDY4OwogICAgICB0WyJuaW5lY2lyY2xlaW52ZXJzZXNhbnNzZXJpZiJdID0gMHgyNzkyOwogICAgICB0WyJuaW5lZGV2YSJdID0gMHgwOTZmOwogICAgICB0WyJuaW5lZ3VqYXJhdGkiXSA9IDB4MGFlZjsKICAgICAgdFsibmluZWd1cm11a2hpIl0gPSAweDBhNmY7CiAgICAgIHRbIm5pbmVoYWNrYXJhYmljIl0gPSAweDA2Njk7CiAgICAgIHRbIm5pbmVoYW5nemhvdSJdID0gMHgzMDI5OwogICAgICB0WyJuaW5laWRlb2dyYXBoaWNwYXJlbiJdID0gMHgzMjI4OwogICAgICB0WyJuaW5laW5mZXJpb3IiXSA9IDB4MjA4OTsKICAgICAgdFsibmluZW1vbm9zcGFjZSJdID0gMHhmZjE5OwogICAgICB0WyJuaW5lb2xkc3R5bGUiXSA9IDB4ZjczOTsKICAgICAgdFsibmluZXBhcmVuIl0gPSAweDI0N2M7CiAgICAgIHRbIm5pbmVwZXJpb2QiXSA9IDB4MjQ5MDsKICAgICAgdFsibmluZXBlcnNpYW4iXSA9IDB4MDZmOTsKICAgICAgdFsibmluZXJvbWFuIl0gPSAweDIxNzg7CiAgICAgIHRbIm5pbmVzdXBlcmlvciJdID0gMHgyMDc5OwogICAgICB0WyJuaW5ldGVlbmNpcmNsZSJdID0gMHgyNDcyOwogICAgICB0WyJuaW5ldGVlbnBhcmVuIl0gPSAweDI0ODY7CiAgICAgIHRbIm5pbmV0ZWVucGVyaW9kIl0gPSAweDI0OWE7CiAgICAgIHRbIm5pbmV0aGFpIl0gPSAweDBlNTk7CiAgICAgIHRbIm5qIl0gPSAweDAxY2M7CiAgICAgIHRbIm5qZWN5cmlsbGljIl0gPSAweDA0NWE7CiAgICAgIHRbIm5rYXRha2FuYSJdID0gMHgzMGYzOwogICAgICB0WyJua2F0YWthbmFoYWxmd2lkdGgiXSA9IDB4ZmY5ZDsKICAgICAgdFsibmxlZ3JpZ2h0bG9uZyJdID0gMHgwMTllOwogICAgICB0WyJubGluZWJlbG93Il0gPSAweDFlNDk7CiAgICAgIHRbIm5tb25vc3BhY2UiXSA9IDB4ZmY0ZTsKICAgICAgdFsibm1zcXVhcmUiXSA9IDB4MzM5YTsKICAgICAgdFsibm5hYmVuZ2FsaSJdID0gMHgwOWEzOwogICAgICB0WyJubmFkZXZhIl0gPSAweDA5MjM7CiAgICAgIHRbIm5uYWd1amFyYXRpIl0gPSAweDBhYTM7CiAgICAgIHRbIm5uYWd1cm11a2hpIl0gPSAweDBhMjM7CiAgICAgIHRbIm5ubmFkZXZhIl0gPSAweDA5Mjk7CiAgICAgIHRbIm5vaGlyYWdhbmEiXSA9IDB4MzA2ZTsKICAgICAgdFsibm9rYXRha2FuYSJdID0gMHgzMGNlOwogICAgICB0WyJub2thdGFrYW5haGFsZndpZHRoIl0gPSAweGZmODk7CiAgICAgIHRbIm5vbmJyZWFraW5nc3BhY2UiXSA9IDB4MDBhMDsKICAgICAgdFsibm9uZW50aGFpIl0gPSAweDBlMTM7CiAgICAgIHRbIm5vbnV0aGFpIl0gPSAweDBlMTk7CiAgICAgIHRbIm5vb25hcmFiaWMiXSA9IDB4MDY0NjsKICAgICAgdFsibm9vbmZpbmFsYXJhYmljIl0gPSAweGZlZTY7CiAgICAgIHRbIm5vb25naHVubmFhcmFiaWMiXSA9IDB4MDZiYTsKICAgICAgdFsibm9vbmdodW5uYWZpbmFsYXJhYmljIl0gPSAweGZiOWY7CiAgICAgIHRbIm5vb25pbml0aWFsYXJhYmljIl0gPSAweGZlZTc7CiAgICAgIHRbIm5vb25qZWVtaW5pdGlhbGFyYWJpYyJdID0gMHhmY2QyOwogICAgICB0WyJub29uamVlbWlzb2xhdGVkYXJhYmljIl0gPSAweGZjNGI7CiAgICAgIHRbIm5vb25tZWRpYWxhcmFiaWMiXSA9IDB4ZmVlODsKICAgICAgdFsibm9vbm1lZW1pbml0aWFsYXJhYmljIl0gPSAweGZjZDU7CiAgICAgIHRbIm5vb25tZWVtaXNvbGF0ZWRhcmFiaWMiXSA9IDB4ZmM0ZTsKICAgICAgdFsibm9vbm5vb25maW5hbGFyYWJpYyJdID0gMHhmYzhkOwogICAgICB0WyJub3Rjb250YWlucyJdID0gMHgyMjBjOwogICAgICB0WyJub3RlbGVtZW50Il0gPSAweDIyMDk7CiAgICAgIHRbIm5vdGVsZW1lbnRvZiJdID0gMHgyMjA5OwogICAgICB0WyJub3RlcXVhbCJdID0gMHgyMjYwOwogICAgICB0WyJub3RncmVhdGVyIl0gPSAweDIyNmY7CiAgICAgIHRbIm5vdGdyZWF0ZXJub3JlcXVhbCJdID0gMHgyMjcxOwogICAgICB0WyJub3RncmVhdGVybm9ybGVzcyJdID0gMHgyMjc5OwogICAgICB0WyJub3RpZGVudGljYWwiXSA9IDB4MjI2MjsKICAgICAgdFsibm90bGVzcyJdID0gMHgyMjZlOwogICAgICB0WyJub3RsZXNzbm9yZXF1YWwiXSA9IDB4MjI3MDsKICAgICAgdFsibm90cGFyYWxsZWwiXSA9IDB4MjIyNjsKICAgICAgdFsibm90cHJlY2VkZXMiXSA9IDB4MjI4MDsKICAgICAgdFsibm90c3Vic2V0Il0gPSAweDIyODQ7CiAgICAgIHRbIm5vdHN1Y2NlZWRzIl0gPSAweDIyODE7CiAgICAgIHRbIm5vdHN1cGVyc2V0Il0gPSAweDIyODU7CiAgICAgIHRbIm5vd2FybWVuaWFuIl0gPSAweDA1NzY7CiAgICAgIHRbIm5wYXJlbiJdID0gMHgyNGE5OwogICAgICB0WyJuc3NxdWFyZSJdID0gMHgzM2IxOwogICAgICB0WyJuc3VwZXJpb3IiXSA9IDB4MjA3ZjsKICAgICAgdFsibnRpbGRlIl0gPSAweDAwZjE7CiAgICAgIHRbIm51Il0gPSAweDAzYmQ7CiAgICAgIHRbIm51aGlyYWdhbmEiXSA9IDB4MzA2YzsKICAgICAgdFsibnVrYXRha2FuYSJdID0gMHgzMGNjOwogICAgICB0WyJudWthdGFrYW5haGFsZndpZHRoIl0gPSAweGZmODc7CiAgICAgIHRbIm51a3RhYmVuZ2FsaSJdID0gMHgwOWJjOwogICAgICB0WyJudWt0YWRldmEiXSA9IDB4MDkzYzsKICAgICAgdFsibnVrdGFndWphcmF0aSJdID0gMHgwYWJjOwogICAgICB0WyJudWt0YWd1cm11a2hpIl0gPSAweDBhM2M7CiAgICAgIHRbIm51bWJlcnNpZ24iXSA9IDB4MDAyMzsKICAgICAgdFsibnVtYmVyc2lnbm1vbm9zcGFjZSJdID0gMHhmZjAzOwogICAgICB0WyJudW1iZXJzaWduc21hbGwiXSA9IDB4ZmU1ZjsKICAgICAgdFsibnVtZXJhbHNpZ25ncmVlayJdID0gMHgwMzc0OwogICAgICB0WyJudW1lcmFsc2lnbmxvd2VyZ3JlZWsiXSA9IDB4MDM3NTsKICAgICAgdFsibnVtZXJvIl0gPSAweDIxMTY7CiAgICAgIHRbIm51biJdID0gMHgwNWUwOwogICAgICB0WyJudW5kYWdlc2giXSA9IDB4ZmI0MDsKICAgICAgdFsibnVuZGFnZXNoaGVicmV3Il0gPSAweGZiNDA7CiAgICAgIHRbIm51bmhlYnJldyJdID0gMHgwNWUwOwogICAgICB0WyJudnNxdWFyZSJdID0gMHgzM2I1OwogICAgICB0WyJud3NxdWFyZSJdID0gMHgzM2JiOwogICAgICB0WyJueWFiZW5nYWxpIl0gPSAweDA5OWU7CiAgICAgIHRbIm55YWRldmEiXSA9IDB4MDkxZTsKICAgICAgdFsibnlhZ3VqYXJhdGkiXSA9IDB4MGE5ZTsKICAgICAgdFsibnlhZ3VybXVraGkiXSA9IDB4MGExZTsKICAgICAgdFsibyJdID0gMHgwMDZmOwogICAgICB0WyJvYWN1dGUiXSA9IDB4MDBmMzsKICAgICAgdFsib2FuZ3RoYWkiXSA9IDB4MGUyZDsKICAgICAgdFsib2JhcnJlZCJdID0gMHgwMjc1OwogICAgICB0WyJvYmFycmVkY3lyaWxsaWMiXSA9IDB4MDRlOTsKICAgICAgdFsib2JhcnJlZGRpZXJlc2lzY3lyaWxsaWMiXSA9IDB4MDRlYjsKICAgICAgdFsib2JlbmdhbGkiXSA9IDB4MDk5MzsKICAgICAgdFsib2JvcG9tb2ZvIl0gPSAweDMxMWI7CiAgICAgIHRbIm9icmV2ZSJdID0gMHgwMTRmOwogICAgICB0WyJvY2FuZHJhZGV2YSJdID0gMHgwOTExOwogICAgICB0WyJvY2FuZHJhZ3VqYXJhdGkiXSA9IDB4MGE5MTsKICAgICAgdFsib2NhbmRyYXZvd2Vsc2lnbmRldmEiXSA9IDB4MDk0OTsKICAgICAgdFsib2NhbmRyYXZvd2Vsc2lnbmd1amFyYXRpIl0gPSAweDBhYzk7CiAgICAgIHRbIm9jYXJvbiJdID0gMHgwMWQyOwogICAgICB0WyJvY2lyY2xlIl0gPSAweDI0ZGU7CiAgICAgIHRbIm9jaXJjdW1mbGV4Il0gPSAweDAwZjQ7CiAgICAgIHRbIm9jaXJjdW1mbGV4YWN1dGUiXSA9IDB4MWVkMTsKICAgICAgdFsib2NpcmN1bWZsZXhkb3RiZWxvdyJdID0gMHgxZWQ5OwogICAgICB0WyJvY2lyY3VtZmxleGdyYXZlIl0gPSAweDFlZDM7CiAgICAgIHRbIm9jaXJjdW1mbGV4aG9va2Fib3ZlIl0gPSAweDFlZDU7CiAgICAgIHRbIm9jaXJjdW1mbGV4dGlsZGUiXSA9IDB4MWVkNzsKICAgICAgdFsib2N5cmlsbGljIl0gPSAweDA0M2U7CiAgICAgIHRbIm9kYmxhY3V0ZSJdID0gMHgwMTUxOwogICAgICB0WyJvZGJsZ3JhdmUiXSA9IDB4MDIwZDsKICAgICAgdFsib2RldmEiXSA9IDB4MDkxMzsKICAgICAgdFsib2RpZXJlc2lzIl0gPSAweDAwZjY7CiAgICAgIHRbIm9kaWVyZXNpc2N5cmlsbGljIl0gPSAweDA0ZTc7CiAgICAgIHRbIm9kb3RiZWxvdyJdID0gMHgxZWNkOwogICAgICB0WyJvZSJdID0gMHgwMTUzOwogICAgICB0WyJvZWtvcmVhbiJdID0gMHgzMTVhOwogICAgICB0WyJvZ29uZWsiXSA9IDB4MDJkYjsKICAgICAgdFsib2dvbmVrY21iIl0gPSAweDAzMjg7CiAgICAgIHRbIm9ncmF2ZSJdID0gMHgwMGYyOwogICAgICB0WyJvZ3VqYXJhdGkiXSA9IDB4MGE5MzsKICAgICAgdFsib2hhcm1lbmlhbiJdID0gMHgwNTg1OwogICAgICB0WyJvaGlyYWdhbmEiXSA9IDB4MzA0YTsKICAgICAgdFsib2hvb2thYm92ZSJdID0gMHgxZWNmOwogICAgICB0WyJvaG9ybiJdID0gMHgwMWExOwogICAgICB0WyJvaG9ybmFjdXRlIl0gPSAweDFlZGI7CiAgICAgIHRbIm9ob3JuZG90YmVsb3ciXSA9IDB4MWVlMzsKICAgICAgdFsib2hvcm5ncmF2ZSJdID0gMHgxZWRkOwogICAgICB0WyJvaG9ybmhvb2thYm92ZSJdID0gMHgxZWRmOwogICAgICB0WyJvaG9ybnRpbGRlIl0gPSAweDFlZTE7CiAgICAgIHRbIm9odW5nYXJ1bWxhdXQiXSA9IDB4MDE1MTsKICAgICAgdFsib2kiXSA9IDB4MDFhMzsKICAgICAgdFsib2ludmVydGVkYnJldmUiXSA9IDB4MDIwZjsKICAgICAgdFsib2thdGFrYW5hIl0gPSAweDMwYWE7CiAgICAgIHRbIm9rYXRha2FuYWhhbGZ3aWR0aCJdID0gMHhmZjc1OwogICAgICB0WyJva29yZWFuIl0gPSAweDMxNTc7CiAgICAgIHRbIm9sZWhlYnJldyJdID0gMHgwNWFiOwogICAgICB0WyJvbWFjcm9uIl0gPSAweDAxNGQ7CiAgICAgIHRbIm9tYWNyb25hY3V0ZSJdID0gMHgxZTUzOwogICAgICB0WyJvbWFjcm9uZ3JhdmUiXSA9IDB4MWU1MTsKICAgICAgdFsib21kZXZhIl0gPSAweDA5NTA7CiAgICAgIHRbIm9tZWdhIl0gPSAweDAzYzk7CiAgICAgIHRbIm9tZWdhMSJdID0gMHgwM2Q2OwogICAgICB0WyJvbWVnYWN5cmlsbGljIl0gPSAweDA0NjE7CiAgICAgIHRbIm9tZWdhbGF0aW5jbG9zZWQiXSA9IDB4MDI3NzsKICAgICAgdFsib21lZ2Fyb3VuZGN5cmlsbGljIl0gPSAweDA0N2I7CiAgICAgIHRbIm9tZWdhdGl0bG9jeXJpbGxpYyJdID0gMHgwNDdkOwogICAgICB0WyJvbWVnYXRvbm9zIl0gPSAweDAzY2U7CiAgICAgIHRbIm9tZ3VqYXJhdGkiXSA9IDB4MGFkMDsKICAgICAgdFsib21pY3JvbiJdID0gMHgwM2JmOwogICAgICB0WyJvbWljcm9udG9ub3MiXSA9IDB4MDNjYzsKICAgICAgdFsib21vbm9zcGFjZSJdID0gMHhmZjRmOwogICAgICB0WyJvbmUiXSA9IDB4MDAzMTsKICAgICAgdFsib25lYXJhYmljIl0gPSAweDA2NjE7CiAgICAgIHRbIm9uZWJlbmdhbGkiXSA9IDB4MDllNzsKICAgICAgdFsib25lY2lyY2xlIl0gPSAweDI0NjA7CiAgICAgIHRbIm9uZWNpcmNsZWludmVyc2VzYW5zc2VyaWYiXSA9IDB4Mjc4YTsKICAgICAgdFsib25lZGV2YSJdID0gMHgwOTY3OwogICAgICB0WyJvbmVkb3RlbmxlYWRlciJdID0gMHgyMDI0OwogICAgICB0WyJvbmVlaWdodGgiXSA9IDB4MjE1YjsKICAgICAgdFsib25lZml0dGVkIl0gPSAweGY2ZGM7CiAgICAgIHRbIm9uZWd1amFyYXRpIl0gPSAweDBhZTc7CiAgICAgIHRbIm9uZWd1cm11a2hpIl0gPSAweDBhNjc7CiAgICAgIHRbIm9uZWhhY2thcmFiaWMiXSA9IDB4MDY2MTsKICAgICAgdFsib25laGFsZiJdID0gMHgwMGJkOwogICAgICB0WyJvbmVoYW5nemhvdSJdID0gMHgzMDIxOwogICAgICB0WyJvbmVpZGVvZ3JhcGhpY3BhcmVuIl0gPSAweDMyMjA7CiAgICAgIHRbIm9uZWluZmVyaW9yIl0gPSAweDIwODE7CiAgICAgIHRbIm9uZW1vbm9zcGFjZSJdID0gMHhmZjExOwogICAgICB0WyJvbmVudW1lcmF0b3JiZW5nYWxpIl0gPSAweDA5ZjQ7CiAgICAgIHRbIm9uZW9sZHN0eWxlIl0gPSAweGY3MzE7CiAgICAgIHRbIm9uZXBhcmVuIl0gPSAweDI0NzQ7CiAgICAgIHRbIm9uZXBlcmlvZCJdID0gMHgyNDg4OwogICAgICB0WyJvbmVwZXJzaWFuIl0gPSAweDA2ZjE7CiAgICAgIHRbIm9uZXF1YXJ0ZXIiXSA9IDB4MDBiYzsKICAgICAgdFsib25lcm9tYW4iXSA9IDB4MjE3MDsKICAgICAgdFsib25lc3VwZXJpb3IiXSA9IDB4MDBiOTsKICAgICAgdFsib25ldGhhaSJdID0gMHgwZTUxOwogICAgICB0WyJvbmV0aGlyZCJdID0gMHgyMTUzOwogICAgICB0WyJvb2dvbmVrIl0gPSAweDAxZWI7CiAgICAgIHRbIm9vZ29uZWttYWNyb24iXSA9IDB4MDFlZDsKICAgICAgdFsib29ndXJtdWtoaSJdID0gMHgwYTEzOwogICAgICB0WyJvb21hdHJhZ3VybXVraGkiXSA9IDB4MGE0YjsKICAgICAgdFsib29wZW4iXSA9IDB4MDI1NDsKICAgICAgdFsib3BhcmVuIl0gPSAweDI0YWE7CiAgICAgIHRbIm9wZW5idWxsZXQiXSA9IDB4MjVlNjsKICAgICAgdFsib3B0aW9uIl0gPSAweDIzMjU7CiAgICAgIHRbIm9yZGZlbWluaW5lIl0gPSAweDAwYWE7CiAgICAgIHRbIm9yZG1hc2N1bGluZSJdID0gMHgwMGJhOwogICAgICB0WyJvcnRob2dvbmFsIl0gPSAweDIyMWY7CiAgICAgIHRbIm9zaG9ydGRldmEiXSA9IDB4MDkxMjsKICAgICAgdFsib3Nob3J0dm93ZWxzaWduZGV2YSJdID0gMHgwOTRhOwogICAgICB0WyJvc2xhc2giXSA9IDB4MDBmODsKICAgICAgdFsib3NsYXNoYWN1dGUiXSA9IDB4MDFmZjsKICAgICAgdFsib3NtYWxsaGlyYWdhbmEiXSA9IDB4MzA0OTsKICAgICAgdFsib3NtYWxsa2F0YWthbmEiXSA9IDB4MzBhOTsKICAgICAgdFsib3NtYWxsa2F0YWthbmFoYWxmd2lkdGgiXSA9IDB4ZmY2YjsKICAgICAgdFsib3N0cm9rZWFjdXRlIl0gPSAweDAxZmY7CiAgICAgIHRbIm9zdXBlcmlvciJdID0gMHhmNmYwOwogICAgICB0WyJvdGN5cmlsbGljIl0gPSAweDA0N2Y7CiAgICAgIHRbIm90aWxkZSJdID0gMHgwMGY1OwogICAgICB0WyJvdGlsZGVhY3V0ZSJdID0gMHgxZTRkOwogICAgICB0WyJvdGlsZGVkaWVyZXNpcyJdID0gMHgxZTRmOwogICAgICB0WyJvdWJvcG9tb2ZvIl0gPSAweDMxMjE7CiAgICAgIHRbIm92ZXJsaW5lIl0gPSAweDIwM2U7CiAgICAgIHRbIm92ZXJsaW5lY2VudGVybGluZSJdID0gMHhmZTRhOwogICAgICB0WyJvdmVybGluZWNtYiJdID0gMHgwMzA1OwogICAgICB0WyJvdmVybGluZWRhc2hlZCJdID0gMHhmZTQ5OwogICAgICB0WyJvdmVybGluZWRibHdhdnkiXSA9IDB4ZmU0YzsKICAgICAgdFsib3ZlcmxpbmV3YXZ5Il0gPSAweGZlNGI7CiAgICAgIHRbIm92ZXJzY29yZSJdID0gMHgwMGFmOwogICAgICB0WyJvdm93ZWxzaWduYmVuZ2FsaSJdID0gMHgwOWNiOwogICAgICB0WyJvdm93ZWxzaWduZGV2YSJdID0gMHgwOTRiOwogICAgICB0WyJvdm93ZWxzaWduZ3VqYXJhdGkiXSA9IDB4MGFjYjsKICAgICAgdFsicCJdID0gMHgwMDcwOwogICAgICB0WyJwYWFtcHNzcXVhcmUiXSA9IDB4MzM4MDsKICAgICAgdFsicGFhc2VudG9zcXVhcmUiXSA9IDB4MzMyYjsKICAgICAgdFsicGFiZW5nYWxpIl0gPSAweDA5YWE7CiAgICAgIHRbInBhY3V0ZSJdID0gMHgxZTU1OwogICAgICB0WyJwYWRldmEiXSA9IDB4MDkyYTsKICAgICAgdFsicGFnZWRvd24iXSA9IDB4MjFkZjsKICAgICAgdFsicGFnZXVwIl0gPSAweDIxZGU7CiAgICAgIHRbInBhZ3VqYXJhdGkiXSA9IDB4MGFhYTsKICAgICAgdFsicGFndXJtdWtoaSJdID0gMHgwYTJhOwogICAgICB0WyJwYWhpcmFnYW5hIl0gPSAweDMwNzE7CiAgICAgIHRbInBhaXlhbm5vaXRoYWkiXSA9IDB4MGUyZjsKICAgICAgdFsicGFrYXRha2FuYSJdID0gMHgzMGQxOwogICAgICB0WyJwYWxhdGFsaXphdGlvbmN5cmlsbGljY21iIl0gPSAweDA0ODQ7CiAgICAgIHRbInBhbG9jaGthY3lyaWxsaWMiXSA9IDB4MDRjMDsKICAgICAgdFsicGFuc2lvc2tvcmVhbiJdID0gMHgzMTdmOwogICAgICB0WyJwYXJhZ3JhcGgiXSA9IDB4MDBiNjsKICAgICAgdFsicGFyYWxsZWwiXSA9IDB4MjIyNTsKICAgICAgdFsicGFyZW5sZWZ0Il0gPSAweDAwMjg7CiAgICAgIHRbInBhcmVubGVmdGFsdG9uZWFyYWJpYyJdID0gMHhmZDNlOwogICAgICB0WyJwYXJlbmxlZnRidCJdID0gMHhmOGVkOwogICAgICB0WyJwYXJlbmxlZnRleCJdID0gMHhmOGVjOwogICAgICB0WyJwYXJlbmxlZnRpbmZlcmlvciJdID0gMHgyMDhkOwogICAgICB0WyJwYXJlbmxlZnRtb25vc3BhY2UiXSA9IDB4ZmYwODsKICAgICAgdFsicGFyZW5sZWZ0c21hbGwiXSA9IDB4ZmU1OTsKICAgICAgdFsicGFyZW5sZWZ0c3VwZXJpb3IiXSA9IDB4MjA3ZDsKICAgICAgdFsicGFyZW5sZWZ0dHAiXSA9IDB4ZjhlYjsKICAgICAgdFsicGFyZW5sZWZ0dmVydGljYWwiXSA9IDB4ZmUzNTsKICAgICAgdFsicGFyZW5yaWdodCJdID0gMHgwMDI5OwogICAgICB0WyJwYXJlbnJpZ2h0YWx0b25lYXJhYmljIl0gPSAweGZkM2Y7CiAgICAgIHRbInBhcmVucmlnaHRidCJdID0gMHhmOGY4OwogICAgICB0WyJwYXJlbnJpZ2h0ZXgiXSA9IDB4ZjhmNzsKICAgICAgdFsicGFyZW5yaWdodGluZmVyaW9yIl0gPSAweDIwOGU7CiAgICAgIHRbInBhcmVucmlnaHRtb25vc3BhY2UiXSA9IDB4ZmYwOTsKICAgICAgdFsicGFyZW5yaWdodHNtYWxsIl0gPSAweGZlNWE7CiAgICAgIHRbInBhcmVucmlnaHRzdXBlcmlvciJdID0gMHgyMDdlOwogICAgICB0WyJwYXJlbnJpZ2h0dHAiXSA9IDB4ZjhmNjsKICAgICAgdFsicGFyZW5yaWdodHZlcnRpY2FsIl0gPSAweGZlMzY7CiAgICAgIHRbInBhcnRpYWxkaWZmIl0gPSAweDIyMDI7CiAgICAgIHRbInBhc2VxaGVicmV3Il0gPSAweDA1YzA7CiAgICAgIHRbInBhc2h0YWhlYnJldyJdID0gMHgwNTk5OwogICAgICB0WyJwYXNxdWFyZSJdID0gMHgzM2E5OwogICAgICB0WyJwYXRhaCJdID0gMHgwNWI3OwogICAgICB0WyJwYXRhaDExIl0gPSAweDA1Yjc7CiAgICAgIHRbInBhdGFoMWQiXSA9IDB4MDViNzsKICAgICAgdFsicGF0YWgyYSJdID0gMHgwNWI3OwogICAgICB0WyJwYXRhaGhlYnJldyJdID0gMHgwNWI3OwogICAgICB0WyJwYXRhaG5hcnJvd2hlYnJldyJdID0gMHgwNWI3OwogICAgICB0WyJwYXRhaHF1YXJ0ZXJoZWJyZXciXSA9IDB4MDViNzsKICAgICAgdFsicGF0YWh3aWRlaGVicmV3Il0gPSAweDA1Yjc7CiAgICAgIHRbInBhemVyaGVicmV3Il0gPSAweDA1YTE7CiAgICAgIHRbInBib3BvbW9mbyJdID0gMHgzMTA2OwogICAgICB0WyJwY2lyY2xlIl0gPSAweDI0ZGY7CiAgICAgIHRbInBkb3RhY2NlbnQiXSA9IDB4MWU1NzsKICAgICAgdFsicGUiXSA9IDB4MDVlNDsKICAgICAgdFsicGVjeXJpbGxpYyJdID0gMHgwNDNmOwogICAgICB0WyJwZWRhZ2VzaCJdID0gMHhmYjQ0OwogICAgICB0WyJwZWRhZ2VzaGhlYnJldyJdID0gMHhmYjQ0OwogICAgICB0WyJwZWV6aXNxdWFyZSJdID0gMHgzMzNiOwogICAgICB0WyJwZWZpbmFsZGFnZXNoaGVicmV3Il0gPSAweGZiNDM7CiAgICAgIHRbInBlaGFyYWJpYyJdID0gMHgwNjdlOwogICAgICB0WyJwZWhhcm1lbmlhbiJdID0gMHgwNTdhOwogICAgICB0WyJwZWhlYnJldyJdID0gMHgwNWU0OwogICAgICB0WyJwZWhmaW5hbGFyYWJpYyJdID0gMHhmYjU3OwogICAgICB0WyJwZWhpbml0aWFsYXJhYmljIl0gPSAweGZiNTg7CiAgICAgIHRbInBlaGlyYWdhbmEiXSA9IDB4MzA3YTsKICAgICAgdFsicGVobWVkaWFsYXJhYmljIl0gPSAweGZiNTk7CiAgICAgIHRbInBla2F0YWthbmEiXSA9IDB4MzBkYTsKICAgICAgdFsicGVtaWRkbGVob29rY3lyaWxsaWMiXSA9IDB4MDRhNzsKICAgICAgdFsicGVyYWZlaGVicmV3Il0gPSAweGZiNGU7CiAgICAgIHRbInBlcmNlbnQiXSA9IDB4MDAyNTsKICAgICAgdFsicGVyY2VudGFyYWJpYyJdID0gMHgwNjZhOwogICAgICB0WyJwZXJjZW50bW9ub3NwYWNlIl0gPSAweGZmMDU7CiAgICAgIHRbInBlcmNlbnRzbWFsbCJdID0gMHhmZTZhOwogICAgICB0WyJwZXJpb2QiXSA9IDB4MDAyZTsKICAgICAgdFsicGVyaW9kYXJtZW5pYW4iXSA9IDB4MDU4OTsKICAgICAgdFsicGVyaW9kY2VudGVyZWQiXSA9IDB4MDBiNzsKICAgICAgdFsicGVyaW9kaGFsZndpZHRoIl0gPSAweGZmNjE7CiAgICAgIHRbInBlcmlvZGluZmVyaW9yIl0gPSAweGY2ZTc7CiAgICAgIHRbInBlcmlvZG1vbm9zcGFjZSJdID0gMHhmZjBlOwogICAgICB0WyJwZXJpb2RzbWFsbCJdID0gMHhmZTUyOwogICAgICB0WyJwZXJpb2RzdXBlcmlvciJdID0gMHhmNmU4OwogICAgICB0WyJwZXJpc3BvbWVuaWdyZWVrY21iIl0gPSAweDAzNDI7CiAgICAgIHRbInBlcnBlbmRpY3VsYXIiXSA9IDB4MjJhNTsKICAgICAgdFsicGVydGhvdXNhbmQiXSA9IDB4MjAzMDsKICAgICAgdFsicGVzZXRhIl0gPSAweDIwYTc7CiAgICAgIHRbInBmc3F1YXJlIl0gPSAweDMzOGE7CiAgICAgIHRbInBoYWJlbmdhbGkiXSA9IDB4MDlhYjsKICAgICAgdFsicGhhZGV2YSJdID0gMHgwOTJiOwogICAgICB0WyJwaGFndWphcmF0aSJdID0gMHgwYWFiOwogICAgICB0WyJwaGFndXJtdWtoaSJdID0gMHgwYTJiOwogICAgICB0WyJwaGkiXSA9IDB4MDNjNjsKICAgICAgdFsicGhpMSJdID0gMHgwM2Q1OwogICAgICB0WyJwaGlldXBoYWNpcmNsZWtvcmVhbiJdID0gMHgzMjdhOwogICAgICB0WyJwaGlldXBoYXBhcmVua29yZWFuIl0gPSAweDMyMWE7CiAgICAgIHRbInBoaWV1cGhjaXJjbGVrb3JlYW4iXSA9IDB4MzI2YzsKICAgICAgdFsicGhpZXVwaGtvcmVhbiJdID0gMHgzMTRkOwogICAgICB0WyJwaGlldXBocGFyZW5rb3JlYW4iXSA9IDB4MzIwYzsKICAgICAgdFsicGhpbGF0aW4iXSA9IDB4MDI3ODsKICAgICAgdFsicGhpbnRodXRoYWkiXSA9IDB4MGUzYTsKICAgICAgdFsicGhpc3ltYm9sZ3JlZWsiXSA9IDB4MDNkNTsKICAgICAgdFsicGhvb2siXSA9IDB4MDFhNTsKICAgICAgdFsicGhvcGhhbnRoYWkiXSA9IDB4MGUxZTsKICAgICAgdFsicGhvcGh1bmd0aGFpIl0gPSAweDBlMWM7CiAgICAgIHRbInBob3NhbXBoYW90aGFpIl0gPSAweDBlMjA7CiAgICAgIHRbInBpIl0gPSAweDAzYzA7CiAgICAgIHRbInBpZXVwYWNpcmNsZWtvcmVhbiJdID0gMHgzMjczOwogICAgICB0WyJwaWV1cGFwYXJlbmtvcmVhbiJdID0gMHgzMjEzOwogICAgICB0WyJwaWV1cGNpZXVja29yZWFuIl0gPSAweDMxNzY7CiAgICAgIHRbInBpZXVwY2lyY2xla29yZWFuIl0gPSAweDMyNjU7CiAgICAgIHRbInBpZXVwa2l5ZW9ra29yZWFuIl0gPSAweDMxNzI7CiAgICAgIHRbInBpZXVwa29yZWFuIl0gPSAweDMxNDI7CiAgICAgIHRbInBpZXVwcGFyZW5rb3JlYW4iXSA9IDB4MzIwNTsKICAgICAgdFsicGlldXBzaW9za2l5ZW9ra29yZWFuIl0gPSAweDMxNzQ7CiAgICAgIHRbInBpZXVwc2lvc2tvcmVhbiJdID0gMHgzMTQ0OwogICAgICB0WyJwaWV1cHNpb3N0aWtldXRrb3JlYW4iXSA9IDB4MzE3NTsKICAgICAgdFsicGlldXB0aGlldXRoa29yZWFuIl0gPSAweDMxNzc7CiAgICAgIHRbInBpZXVwdGlrZXV0a29yZWFuIl0gPSAweDMxNzM7CiAgICAgIHRbInBpaGlyYWdhbmEiXSA9IDB4MzA3NDsKICAgICAgdFsicGlrYXRha2FuYSJdID0gMHgzMGQ0OwogICAgICB0WyJwaXN5bWJvbGdyZWVrIl0gPSAweDAzZDY7CiAgICAgIHRbInBpd3Jhcm1lbmlhbiJdID0gMHgwNTgzOwogICAgICB0WyJwbHVzIl0gPSAweDAwMmI7CiAgICAgIHRbInBsdXNiZWxvd2NtYiJdID0gMHgwMzFmOwogICAgICB0WyJwbHVzY2lyY2xlIl0gPSAweDIyOTU7CiAgICAgIHRbInBsdXNtaW51cyJdID0gMHgwMGIxOwogICAgICB0WyJwbHVzbW9kIl0gPSAweDAyZDY7CiAgICAgIHRbInBsdXNtb25vc3BhY2UiXSA9IDB4ZmYwYjsKICAgICAgdFsicGx1c3NtYWxsIl0gPSAweGZlNjI7CiAgICAgIHRbInBsdXNzdXBlcmlvciJdID0gMHgyMDdhOwogICAgICB0WyJwbW9ub3NwYWNlIl0gPSAweGZmNTA7CiAgICAgIHRbInBtc3F1YXJlIl0gPSAweDMzZDg7CiAgICAgIHRbInBvaGlyYWdhbmEiXSA9IDB4MzA3ZDsKICAgICAgdFsicG9pbnRpbmdpbmRleGRvd253aGl0ZSJdID0gMHgyNjFmOwogICAgICB0WyJwb2ludGluZ2luZGV4bGVmdHdoaXRlIl0gPSAweDI2MWM7CiAgICAgIHRbInBvaW50aW5naW5kZXhyaWdodHdoaXRlIl0gPSAweDI2MWU7CiAgICAgIHRbInBvaW50aW5naW5kZXh1cHdoaXRlIl0gPSAweDI2MWQ7CiAgICAgIHRbInBva2F0YWthbmEiXSA9IDB4MzBkZDsKICAgICAgdFsicG9wbGF0aGFpIl0gPSAweDBlMWI7CiAgICAgIHRbInBvc3RhbG1hcmsiXSA9IDB4MzAxMjsKICAgICAgdFsicG9zdGFsbWFya2ZhY2UiXSA9IDB4MzAyMDsKICAgICAgdFsicHBhcmVuIl0gPSAweDI0YWI7CiAgICAgIHRbInByZWNlZGVzIl0gPSAweDIyN2E7CiAgICAgIHRbInByZXNjcmlwdGlvbiJdID0gMHgyMTFlOwogICAgICB0WyJwcmltZW1vZCJdID0gMHgwMmI5OwogICAgICB0WyJwcmltZXJldmVyc2VkIl0gPSAweDIwMzU7CiAgICAgIHRbInByb2R1Y3QiXSA9IDB4MjIwZjsKICAgICAgdFsicHJvamVjdGl2ZSJdID0gMHgyMzA1OwogICAgICB0WyJwcm9sb25nZWRrYW5hIl0gPSAweDMwZmM7CiAgICAgIHRbInByb3BlbGxvciJdID0gMHgyMzE4OwogICAgICB0WyJwcm9wZXJzdWJzZXQiXSA9IDB4MjI4MjsKICAgICAgdFsicHJvcGVyc3VwZXJzZXQiXSA9IDB4MjI4MzsKICAgICAgdFsicHJvcG9ydGlvbiJdID0gMHgyMjM3OwogICAgICB0WyJwcm9wb3J0aW9uYWwiXSA9IDB4MjIxZDsKICAgICAgdFsicHNpIl0gPSAweDAzYzg7CiAgICAgIHRbInBzaWN5cmlsbGljIl0gPSAweDA0NzE7CiAgICAgIHRbInBzaWxpcG5ldW1hdGFjeXJpbGxpY2NtYiJdID0gMHgwNDg2OwogICAgICB0WyJwc3NxdWFyZSJdID0gMHgzM2IwOwogICAgICB0WyJwdWhpcmFnYW5hIl0gPSAweDMwNzc7CiAgICAgIHRbInB1a2F0YWthbmEiXSA9IDB4MzBkNzsKICAgICAgdFsicHZzcXVhcmUiXSA9IDB4MzNiNDsKICAgICAgdFsicHdzcXVhcmUiXSA9IDB4MzNiYTsKICAgICAgdFsicSJdID0gMHgwMDcxOwogICAgICB0WyJxYWRldmEiXSA9IDB4MDk1ODsKICAgICAgdFsicWFkbWFoZWJyZXciXSA9IDB4MDVhODsKICAgICAgdFsicWFmYXJhYmljIl0gPSAweDA2NDI7CiAgICAgIHRbInFhZmZpbmFsYXJhYmljIl0gPSAweGZlZDY7CiAgICAgIHRbInFhZmluaXRpYWxhcmFiaWMiXSA9IDB4ZmVkNzsKICAgICAgdFsicWFmbWVkaWFsYXJhYmljIl0gPSAweGZlZDg7CiAgICAgIHRbInFhbWF0cyJdID0gMHgwNWI4OwogICAgICB0WyJxYW1hdHMxMCJdID0gMHgwNWI4OwogICAgICB0WyJxYW1hdHMxYSJdID0gMHgwNWI4OwogICAgICB0WyJxYW1hdHMxYyJdID0gMHgwNWI4OwogICAgICB0WyJxYW1hdHMyNyJdID0gMHgwNWI4OwogICAgICB0WyJxYW1hdHMyOSJdID0gMHgwNWI4OwogICAgICB0WyJxYW1hdHMzMyJdID0gMHgwNWI4OwogICAgICB0WyJxYW1hdHNkZSJdID0gMHgwNWI4OwogICAgICB0WyJxYW1hdHNoZWJyZXciXSA9IDB4MDViODsKICAgICAgdFsicWFtYXRzbmFycm93aGVicmV3Il0gPSAweDA1Yjg7CiAgICAgIHRbInFhbWF0c3FhdGFuaGVicmV3Il0gPSAweDA1Yjg7CiAgICAgIHRbInFhbWF0c3FhdGFubmFycm93aGVicmV3Il0gPSAweDA1Yjg7CiAgICAgIHRbInFhbWF0c3FhdGFucXVhcnRlcmhlYnJldyJdID0gMHgwNWI4OwogICAgICB0WyJxYW1hdHNxYXRhbndpZGVoZWJyZXciXSA9IDB4MDViODsKICAgICAgdFsicWFtYXRzcXVhcnRlcmhlYnJldyJdID0gMHgwNWI4OwogICAgICB0WyJxYW1hdHN3aWRlaGVicmV3Il0gPSAweDA1Yjg7CiAgICAgIHRbInFhcm5leXBhcmFoZWJyZXciXSA9IDB4MDU5ZjsKICAgICAgdFsicWJvcG9tb2ZvIl0gPSAweDMxMTE7CiAgICAgIHRbInFjaXJjbGUiXSA9IDB4MjRlMDsKICAgICAgdFsicWhvb2siXSA9IDB4MDJhMDsKICAgICAgdFsicW1vbm9zcGFjZSJdID0gMHhmZjUxOwogICAgICB0WyJxb2YiXSA9IDB4MDVlNzsKICAgICAgdFsicW9mZGFnZXNoIl0gPSAweGZiNDc7CiAgICAgIHRbInFvZmRhZ2VzaGhlYnJldyJdID0gMHhmYjQ3OwogICAgICB0WyJxb2ZoZWJyZXciXSA9IDB4MDVlNzsKICAgICAgdFsicXBhcmVuIl0gPSAweDI0YWM7CiAgICAgIHRbInF1YXJ0ZXJub3RlIl0gPSAweDI2Njk7CiAgICAgIHRbInF1YnV0cyJdID0gMHgwNWJiOwogICAgICB0WyJxdWJ1dHMxOCJdID0gMHgwNWJiOwogICAgICB0WyJxdWJ1dHMyNSJdID0gMHgwNWJiOwogICAgICB0WyJxdWJ1dHMzMSJdID0gMHgwNWJiOwogICAgICB0WyJxdWJ1dHNoZWJyZXciXSA9IDB4MDViYjsKICAgICAgdFsicXVidXRzbmFycm93aGVicmV3Il0gPSAweDA1YmI7CiAgICAgIHRbInF1YnV0c3F1YXJ0ZXJoZWJyZXciXSA9IDB4MDViYjsKICAgICAgdFsicXVidXRzd2lkZWhlYnJldyJdID0gMHgwNWJiOwogICAgICB0WyJxdWVzdGlvbiJdID0gMHgwMDNmOwogICAgICB0WyJxdWVzdGlvbmFyYWJpYyJdID0gMHgwNjFmOwogICAgICB0WyJxdWVzdGlvbmFybWVuaWFuIl0gPSAweDA1NWU7CiAgICAgIHRbInF1ZXN0aW9uZG93biJdID0gMHgwMGJmOwogICAgICB0WyJxdWVzdGlvbmRvd25zbWFsbCJdID0gMHhmN2JmOwogICAgICB0WyJxdWVzdGlvbmdyZWVrIl0gPSAweDAzN2U7CiAgICAgIHRbInF1ZXN0aW9ubW9ub3NwYWNlIl0gPSAweGZmMWY7CiAgICAgIHRbInF1ZXN0aW9uc21hbGwiXSA9IDB4ZjczZjsKICAgICAgdFsicXVvdGVkYmwiXSA9IDB4MDAyMjsKICAgICAgdFsicXVvdGVkYmxiYXNlIl0gPSAweDIwMWU7CiAgICAgIHRbInF1b3RlZGJsbGVmdCJdID0gMHgyMDFjOwogICAgICB0WyJxdW90ZWRibG1vbm9zcGFjZSJdID0gMHhmZjAyOwogICAgICB0WyJxdW90ZWRibHByaW1lIl0gPSAweDMwMWU7CiAgICAgIHRbInF1b3RlZGJscHJpbWVyZXZlcnNlZCJdID0gMHgzMDFkOwogICAgICB0WyJxdW90ZWRibHJpZ2h0Il0gPSAweDIwMWQ7CiAgICAgIHRbInF1b3RlbGVmdCJdID0gMHgyMDE4OwogICAgICB0WyJxdW90ZWxlZnRyZXZlcnNlZCJdID0gMHgyMDFiOwogICAgICB0WyJxdW90ZXJldmVyc2VkIl0gPSAweDIwMWI7CiAgICAgIHRbInF1b3RlcmlnaHQiXSA9IDB4MjAxOTsKICAgICAgdFsicXVvdGVyaWdodG4iXSA9IDB4MDE0OTsKICAgICAgdFsicXVvdGVzaW5nbGJhc2UiXSA9IDB4MjAxYTsKICAgICAgdFsicXVvdGVzaW5nbGUiXSA9IDB4MDAyNzsKICAgICAgdFsicXVvdGVzaW5nbGVtb25vc3BhY2UiXSA9IDB4ZmYwNzsKICAgICAgdFsiciJdID0gMHgwMDcyOwogICAgICB0WyJyYWFybWVuaWFuIl0gPSAweDA1N2M7CiAgICAgIHRbInJhYmVuZ2FsaSJdID0gMHgwOWIwOwogICAgICB0WyJyYWN1dGUiXSA9IDB4MDE1NTsKICAgICAgdFsicmFkZXZhIl0gPSAweDA5MzA7CiAgICAgIHRbInJhZGljYWwiXSA9IDB4MjIxYTsKICAgICAgdFsicmFkaWNhbGV4Il0gPSAweGY4ZTU7CiAgICAgIHRbInJhZG92ZXJzc3F1YXJlIl0gPSAweDMzYWU7CiAgICAgIHRbInJhZG92ZXJzc3F1YXJlZHNxdWFyZSJdID0gMHgzM2FmOwogICAgICB0WyJyYWRzcXVhcmUiXSA9IDB4MzNhZDsKICAgICAgdFsicmFmZSJdID0gMHgwNWJmOwogICAgICB0WyJyYWZlaGVicmV3Il0gPSAweDA1YmY7CiAgICAgIHRbInJhZ3VqYXJhdGkiXSA9IDB4MGFiMDsKICAgICAgdFsicmFndXJtdWtoaSJdID0gMHgwYTMwOwogICAgICB0WyJyYWhpcmFnYW5hIl0gPSAweDMwODk7CiAgICAgIHRbInJha2F0YWthbmEiXSA9IDB4MzBlOTsKICAgICAgdFsicmFrYXRha2FuYWhhbGZ3aWR0aCJdID0gMHhmZjk3OwogICAgICB0WyJyYWxvd2VyZGlhZ29uYWxiZW5nYWxpIl0gPSAweDA5ZjE7CiAgICAgIHRbInJhbWlkZGxlZGlhZ29uYWxiZW5nYWxpIl0gPSAweDA5ZjA7CiAgICAgIHRbInJhbXNob3JuIl0gPSAweDAyNjQ7CiAgICAgIHRbInJhdGlvIl0gPSAweDIyMzY7CiAgICAgIHRbInJib3BvbW9mbyJdID0gMHgzMTE2OwogICAgICB0WyJyY2Fyb24iXSA9IDB4MDE1OTsKICAgICAgdFsicmNlZGlsbGEiXSA9IDB4MDE1NzsKICAgICAgdFsicmNpcmNsZSJdID0gMHgyNGUxOwogICAgICB0WyJyY29tbWFhY2NlbnQiXSA9IDB4MDE1NzsKICAgICAgdFsicmRibGdyYXZlIl0gPSAweDAyMTE7CiAgICAgIHRbInJkb3RhY2NlbnQiXSA9IDB4MWU1OTsKICAgICAgdFsicmRvdGJlbG93Il0gPSAweDFlNWI7CiAgICAgIHRbInJkb3RiZWxvd21hY3JvbiJdID0gMHgxZTVkOwogICAgICB0WyJyZWZlcmVuY2VtYXJrIl0gPSAweDIwM2I7CiAgICAgIHRbInJlZmxleHN1YnNldCJdID0gMHgyMjg2OwogICAgICB0WyJyZWZsZXhzdXBlcnNldCJdID0gMHgyMjg3OwogICAgICB0WyJyZWdpc3RlcmVkIl0gPSAweDAwYWU7CiAgICAgIHRbInJlZ2lzdGVyc2FucyJdID0gMHhmOGU4OwogICAgICB0WyJyZWdpc3RlcnNlcmlmIl0gPSAweGY2ZGE7CiAgICAgIHRbInJlaGFyYWJpYyJdID0gMHgwNjMxOwogICAgICB0WyJyZWhhcm1lbmlhbiJdID0gMHgwNTgwOwogICAgICB0WyJyZWhmaW5hbGFyYWJpYyJdID0gMHhmZWFlOwogICAgICB0WyJyZWhpcmFnYW5hIl0gPSAweDMwOGM7CiAgICAgIHRbInJla2F0YWthbmEiXSA9IDB4MzBlYzsKICAgICAgdFsicmVrYXRha2FuYWhhbGZ3aWR0aCJdID0gMHhmZjlhOwogICAgICB0WyJyZXNoIl0gPSAweDA1ZTg7CiAgICAgIHRbInJlc2hkYWdlc2hoZWJyZXciXSA9IDB4ZmI0ODsKICAgICAgdFsicmVzaGhlYnJldyJdID0gMHgwNWU4OwogICAgICB0WyJyZXZlcnNlZHRpbGRlIl0gPSAweDIyM2Q7CiAgICAgIHRbInJldmlhaGVicmV3Il0gPSAweDA1OTc7CiAgICAgIHRbInJldmlhbXVncmFzaGhlYnJldyJdID0gMHgwNTk3OwogICAgICB0WyJyZXZsb2dpY2Fsbm90Il0gPSAweDIzMTA7CiAgICAgIHRbInJmaXNoaG9vayJdID0gMHgwMjdlOwogICAgICB0WyJyZmlzaGhvb2tyZXZlcnNlZCJdID0gMHgwMjdmOwogICAgICB0WyJyaGFiZW5nYWxpIl0gPSAweDA5ZGQ7CiAgICAgIHRbInJoYWRldmEiXSA9IDB4MDk1ZDsKICAgICAgdFsicmhvIl0gPSAweDAzYzE7CiAgICAgIHRbInJob29rIl0gPSAweDAyN2Q7CiAgICAgIHRbInJob29rdHVybmVkIl0gPSAweDAyN2I7CiAgICAgIHRbInJob29rdHVybmVkc3VwZXJpb3IiXSA9IDB4MDJiNTsKICAgICAgdFsicmhvc3ltYm9sZ3JlZWsiXSA9IDB4MDNmMTsKICAgICAgdFsicmhvdGljaG9va21vZCJdID0gMHgwMmRlOwogICAgICB0WyJyaWV1bGFjaXJjbGVrb3JlYW4iXSA9IDB4MzI3MTsKICAgICAgdFsicmlldWxhcGFyZW5rb3JlYW4iXSA9IDB4MzIxMTsKICAgICAgdFsicmlldWxjaXJjbGVrb3JlYW4iXSA9IDB4MzI2MzsKICAgICAgdFsicmlldWxoaWV1aGtvcmVhbiJdID0gMHgzMTQwOwogICAgICB0WyJyaWV1bGtpeWVva2tvcmVhbiJdID0gMHgzMTNhOwogICAgICB0WyJyaWV1bGtpeWVva3Npb3Nrb3JlYW4iXSA9IDB4MzE2OTsKICAgICAgdFsicmlldWxrb3JlYW4iXSA9IDB4MzEzOTsKICAgICAgdFsicmlldWxtaWV1bWtvcmVhbiJdID0gMHgzMTNiOwogICAgICB0WyJyaWV1bHBhbnNpb3Nrb3JlYW4iXSA9IDB4MzE2YzsKICAgICAgdFsicmlldWxwYXJlbmtvcmVhbiJdID0gMHgzMjAzOwogICAgICB0WyJyaWV1bHBoaWV1cGhrb3JlYW4iXSA9IDB4MzEzZjsKICAgICAgdFsicmlldWxwaWV1cGtvcmVhbiJdID0gMHgzMTNjOwogICAgICB0WyJyaWV1bHBpZXVwc2lvc2tvcmVhbiJdID0gMHgzMTZiOwogICAgICB0WyJyaWV1bHNpb3Nrb3JlYW4iXSA9IDB4MzEzZDsKICAgICAgdFsicmlldWx0aGlldXRoa29yZWFuIl0gPSAweDMxM2U7CiAgICAgIHRbInJpZXVsdGlrZXV0a29yZWFuIl0gPSAweDMxNmE7CiAgICAgIHRbInJpZXVseWVvcmluaGlldWhrb3JlYW4iXSA9IDB4MzE2ZDsKICAgICAgdFsicmlnaHRhbmdsZSJdID0gMHgyMjFmOwogICAgICB0WyJyaWdodHRhY2tiZWxvd2NtYiJdID0gMHgwMzE5OwogICAgICB0WyJyaWdodHRyaWFuZ2xlIl0gPSAweDIyYmY7CiAgICAgIHRbInJpaGlyYWdhbmEiXSA9IDB4MzA4YTsKICAgICAgdFsicmlrYXRha2FuYSJdID0gMHgzMGVhOwogICAgICB0WyJyaWthdGFrYW5haGFsZndpZHRoIl0gPSAweGZmOTg7CiAgICAgIHRbInJpbmciXSA9IDB4MDJkYTsKICAgICAgdFsicmluZ2JlbG93Y21iIl0gPSAweDAzMjU7CiAgICAgIHRbInJpbmdjbWIiXSA9IDB4MDMwYTsKICAgICAgdFsicmluZ2hhbGZsZWZ0Il0gPSAweDAyYmY7CiAgICAgIHRbInJpbmdoYWxmbGVmdGFybWVuaWFuIl0gPSAweDA1NTk7CiAgICAgIHRbInJpbmdoYWxmbGVmdGJlbG93Y21iIl0gPSAweDAzMWM7CiAgICAgIHRbInJpbmdoYWxmbGVmdGNlbnRlcmVkIl0gPSAweDAyZDM7CiAgICAgIHRbInJpbmdoYWxmcmlnaHQiXSA9IDB4MDJiZTsKICAgICAgdFsicmluZ2hhbGZyaWdodGJlbG93Y21iIl0gPSAweDAzMzk7CiAgICAgIHRbInJpbmdoYWxmcmlnaHRjZW50ZXJlZCJdID0gMHgwMmQyOwogICAgICB0WyJyaW52ZXJ0ZWRicmV2ZSJdID0gMHgwMjEzOwogICAgICB0WyJyaXR0b3J1c3F1YXJlIl0gPSAweDMzNTE7CiAgICAgIHRbInJsaW5lYmVsb3ciXSA9IDB4MWU1ZjsKICAgICAgdFsicmxvbmdsZWciXSA9IDB4MDI3YzsKICAgICAgdFsicmxvbmdsZWd0dXJuZWQiXSA9IDB4MDI3YTsKICAgICAgdFsicm1vbm9zcGFjZSJdID0gMHhmZjUyOwogICAgICB0WyJyb2hpcmFnYW5hIl0gPSAweDMwOGQ7CiAgICAgIHRbInJva2F0YWthbmEiXSA9IDB4MzBlZDsKICAgICAgdFsicm9rYXRha2FuYWhhbGZ3aWR0aCJdID0gMHhmZjliOwogICAgICB0WyJyb3J1YXRoYWkiXSA9IDB4MGUyMzsKICAgICAgdFsicnBhcmVuIl0gPSAweDI0YWQ7CiAgICAgIHRbInJyYWJlbmdhbGkiXSA9IDB4MDlkYzsKICAgICAgdFsicnJhZGV2YSJdID0gMHgwOTMxOwogICAgICB0WyJycmFndXJtdWtoaSJdID0gMHgwYTVjOwogICAgICB0WyJycmVoYXJhYmljIl0gPSAweDA2OTE7CiAgICAgIHRbInJyZWhmaW5hbGFyYWJpYyJdID0gMHhmYjhkOwogICAgICB0WyJycnZvY2FsaWNiZW5nYWxpIl0gPSAweDA5ZTA7CiAgICAgIHRbInJydm9jYWxpY2RldmEiXSA9IDB4MDk2MDsKICAgICAgdFsicnJ2b2NhbGljZ3VqYXJhdGkiXSA9IDB4MGFlMDsKICAgICAgdFsicnJ2b2NhbGljdm93ZWxzaWduYmVuZ2FsaSJdID0gMHgwOWM0OwogICAgICB0WyJycnZvY2FsaWN2b3dlbHNpZ25kZXZhIl0gPSAweDA5NDQ7CiAgICAgIHRbInJydm9jYWxpY3Zvd2Vsc2lnbmd1amFyYXRpIl0gPSAweDBhYzQ7CiAgICAgIHRbInJzdXBlcmlvciJdID0gMHhmNmYxOwogICAgICB0WyJydGJsb2NrIl0gPSAweDI1OTA7CiAgICAgIHRbInJ0dXJuZWQiXSA9IDB4MDI3OTsKICAgICAgdFsicnR1cm5lZHN1cGVyaW9yIl0gPSAweDAyYjQ7CiAgICAgIHRbInJ1aGlyYWdhbmEiXSA9IDB4MzA4YjsKICAgICAgdFsicnVrYXRha2FuYSJdID0gMHgzMGViOwogICAgICB0WyJydWthdGFrYW5haGFsZndpZHRoIl0gPSAweGZmOTk7CiAgICAgIHRbInJ1cGVlbWFya2JlbmdhbGkiXSA9IDB4MDlmMjsKICAgICAgdFsicnVwZWVzaWduYmVuZ2FsaSJdID0gMHgwOWYzOwogICAgICB0WyJydXBpYWgiXSA9IDB4ZjZkZDsKICAgICAgdFsicnV0aGFpIl0gPSAweDBlMjQ7CiAgICAgIHRbInJ2b2NhbGljYmVuZ2FsaSJdID0gMHgwOThiOwogICAgICB0WyJydm9jYWxpY2RldmEiXSA9IDB4MDkwYjsKICAgICAgdFsicnZvY2FsaWNndWphcmF0aSJdID0gMHgwYThiOwogICAgICB0WyJydm9jYWxpY3Zvd2Vsc2lnbmJlbmdhbGkiXSA9IDB4MDljMzsKICAgICAgdFsicnZvY2FsaWN2b3dlbHNpZ25kZXZhIl0gPSAweDA5NDM7CiAgICAgIHRbInJ2b2NhbGljdm93ZWxzaWduZ3VqYXJhdGkiXSA9IDB4MGFjMzsKICAgICAgdFsicyJdID0gMHgwMDczOwogICAgICB0WyJzYWJlbmdhbGkiXSA9IDB4MDliODsKICAgICAgdFsic2FjdXRlIl0gPSAweDAxNWI7CiAgICAgIHRbInNhY3V0ZWRvdGFjY2VudCJdID0gMHgxZTY1OwogICAgICB0WyJzYWRhcmFiaWMiXSA9IDB4MDYzNTsKICAgICAgdFsic2FkZXZhIl0gPSAweDA5Mzg7CiAgICAgIHRbInNhZGZpbmFsYXJhYmljIl0gPSAweGZlYmE7CiAgICAgIHRbInNhZGluaXRpYWxhcmFiaWMiXSA9IDB4ZmViYjsKICAgICAgdFsic2FkbWVkaWFsYXJhYmljIl0gPSAweGZlYmM7CiAgICAgIHRbInNhZ3VqYXJhdGkiXSA9IDB4MGFiODsKICAgICAgdFsic2FndXJtdWtoaSJdID0gMHgwYTM4OwogICAgICB0WyJzYWhpcmFnYW5hIl0gPSAweDMwNTU7CiAgICAgIHRbInNha2F0YWthbmEiXSA9IDB4MzBiNTsKICAgICAgdFsic2FrYXRha2FuYWhhbGZ3aWR0aCJdID0gMHhmZjdiOwogICAgICB0WyJzYWxsYWxsYWhvdWFsYXloZXdhc2FsbGFtYXJhYmljIl0gPSAweGZkZmE7CiAgICAgIHRbInNhbWVraCJdID0gMHgwNWUxOwogICAgICB0WyJzYW1la2hkYWdlc2giXSA9IDB4ZmI0MTsKICAgICAgdFsic2FtZWtoZGFnZXNoaGVicmV3Il0gPSAweGZiNDE7CiAgICAgIHRbInNhbWVraGhlYnJldyJdID0gMHgwNWUxOwogICAgICB0WyJzYXJhYWF0aGFpIl0gPSAweDBlMzI7CiAgICAgIHRbInNhcmFhZXRoYWkiXSA9IDB4MGU0MTsKICAgICAgdFsic2FyYWFpbWFpbWFsYWl0aGFpIl0gPSAweDBlNDQ7CiAgICAgIHRbInNhcmFhaW1haW11YW50aGFpIl0gPSAweDBlNDM7CiAgICAgIHRbInNhcmFhbXRoYWkiXSA9IDB4MGUzMzsKICAgICAgdFsic2FyYWF0aGFpIl0gPSAweDBlMzA7CiAgICAgIHRbInNhcmFldGhhaSJdID0gMHgwZTQwOwogICAgICB0WyJzYXJhaWlsZWZ0dGhhaSJdID0gMHhmODg2OwogICAgICB0WyJzYXJhaWl0aGFpIl0gPSAweDBlMzU7CiAgICAgIHRbInNhcmFpbGVmdHRoYWkiXSA9IDB4Zjg4NTsKICAgICAgdFsic2FyYWl0aGFpIl0gPSAweDBlMzQ7CiAgICAgIHRbInNhcmFvdGhhaSJdID0gMHgwZTQyOwogICAgICB0WyJzYXJhdWVlbGVmdHRoYWkiXSA9IDB4Zjg4ODsKICAgICAgdFsic2FyYXVlZXRoYWkiXSA9IDB4MGUzNzsKICAgICAgdFsic2FyYXVlbGVmdHRoYWkiXSA9IDB4Zjg4NzsKICAgICAgdFsic2FyYXVldGhhaSJdID0gMHgwZTM2OwogICAgICB0WyJzYXJhdXRoYWkiXSA9IDB4MGUzODsKICAgICAgdFsic2FyYXV1dGhhaSJdID0gMHgwZTM5OwogICAgICB0WyJzYm9wb21vZm8iXSA9IDB4MzExOTsKICAgICAgdFsic2Nhcm9uIl0gPSAweDAxNjE7CiAgICAgIHRbInNjYXJvbmRvdGFjY2VudCJdID0gMHgxZTY3OwogICAgICB0WyJzY2VkaWxsYSJdID0gMHgwMTVmOwogICAgICB0WyJzY2h3YSJdID0gMHgwMjU5OwogICAgICB0WyJzY2h3YWN5cmlsbGljIl0gPSAweDA0ZDk7CiAgICAgIHRbInNjaHdhZGllcmVzaXNjeXJpbGxpYyJdID0gMHgwNGRiOwogICAgICB0WyJzY2h3YWhvb2siXSA9IDB4MDI1YTsKICAgICAgdFsic2NpcmNsZSJdID0gMHgyNGUyOwogICAgICB0WyJzY2lyY3VtZmxleCJdID0gMHgwMTVkOwogICAgICB0WyJzY29tbWFhY2NlbnQiXSA9IDB4MDIxOTsKICAgICAgdFsic2RvdGFjY2VudCJdID0gMHgxZTYxOwogICAgICB0WyJzZG90YmVsb3ciXSA9IDB4MWU2MzsKICAgICAgdFsic2RvdGJlbG93ZG90YWNjZW50Il0gPSAweDFlNjk7CiAgICAgIHRbInNlYWd1bGxiZWxvd2NtYiJdID0gMHgwMzNjOwogICAgICB0WyJzZWNvbmQiXSA9IDB4MjAzMzsKICAgICAgdFsic2Vjb25kdG9uZWNoaW5lc2UiXSA9IDB4MDJjYTsKICAgICAgdFsic2VjdGlvbiJdID0gMHgwMGE3OwogICAgICB0WyJzZWVuYXJhYmljIl0gPSAweDA2MzM7CiAgICAgIHRbInNlZW5maW5hbGFyYWJpYyJdID0gMHhmZWIyOwogICAgICB0WyJzZWVuaW5pdGlhbGFyYWJpYyJdID0gMHhmZWIzOwogICAgICB0WyJzZWVubWVkaWFsYXJhYmljIl0gPSAweGZlYjQ7CiAgICAgIHRbInNlZ29sIl0gPSAweDA1YjY7CiAgICAgIHRbInNlZ29sMTMiXSA9IDB4MDViNjsKICAgICAgdFsic2Vnb2wxZiJdID0gMHgwNWI2OwogICAgICB0WyJzZWdvbDJjIl0gPSAweDA1YjY7CiAgICAgIHRbInNlZ29saGVicmV3Il0gPSAweDA1YjY7CiAgICAgIHRbInNlZ29sbmFycm93aGVicmV3Il0gPSAweDA1YjY7CiAgICAgIHRbInNlZ29scXVhcnRlcmhlYnJldyJdID0gMHgwNWI2OwogICAgICB0WyJzZWdvbHRhaGVicmV3Il0gPSAweDA1OTI7CiAgICAgIHRbInNlZ29sd2lkZWhlYnJldyJdID0gMHgwNWI2OwogICAgICB0WyJzZWhhcm1lbmlhbiJdID0gMHgwNTdkOwogICAgICB0WyJzZWhpcmFnYW5hIl0gPSAweDMwNWI7CiAgICAgIHRbInNla2F0YWthbmEiXSA9IDB4MzBiYjsKICAgICAgdFsic2VrYXRha2FuYWhhbGZ3aWR0aCJdID0gMHhmZjdlOwogICAgICB0WyJzZW1pY29sb24iXSA9IDB4MDAzYjsKICAgICAgdFsic2VtaWNvbG9uYXJhYmljIl0gPSAweDA2MWI7CiAgICAgIHRbInNlbWljb2xvbm1vbm9zcGFjZSJdID0gMHhmZjFiOwogICAgICB0WyJzZW1pY29sb25zbWFsbCJdID0gMHhmZTU0OwogICAgICB0WyJzZW1pdm9pY2VkbWFya2thbmEiXSA9IDB4MzA5YzsKICAgICAgdFsic2VtaXZvaWNlZG1hcmtrYW5haGFsZndpZHRoIl0gPSAweGZmOWY7CiAgICAgIHRbInNlbnRpc3F1YXJlIl0gPSAweDMzMjI7CiAgICAgIHRbInNlbnRvc3F1YXJlIl0gPSAweDMzMjM7CiAgICAgIHRbInNldmVuIl0gPSAweDAwMzc7CiAgICAgIHRbInNldmVuYXJhYmljIl0gPSAweDA2Njc7CiAgICAgIHRbInNldmVuYmVuZ2FsaSJdID0gMHgwOWVkOwogICAgICB0WyJzZXZlbmNpcmNsZSJdID0gMHgyNDY2OwogICAgICB0WyJzZXZlbmNpcmNsZWludmVyc2VzYW5zc2VyaWYiXSA9IDB4Mjc5MDsKICAgICAgdFsic2V2ZW5kZXZhIl0gPSAweDA5NmQ7CiAgICAgIHRbInNldmVuZWlnaHRocyJdID0gMHgyMTVlOwogICAgICB0WyJzZXZlbmd1amFyYXRpIl0gPSAweDBhZWQ7CiAgICAgIHRbInNldmVuZ3VybXVraGkiXSA9IDB4MGE2ZDsKICAgICAgdFsic2V2ZW5oYWNrYXJhYmljIl0gPSAweDA2Njc7CiAgICAgIHRbInNldmVuaGFuZ3pob3UiXSA9IDB4MzAyNzsKICAgICAgdFsic2V2ZW5pZGVvZ3JhcGhpY3BhcmVuIl0gPSAweDMyMjY7CiAgICAgIHRbInNldmVuaW5mZXJpb3IiXSA9IDB4MjA4NzsKICAgICAgdFsic2V2ZW5tb25vc3BhY2UiXSA9IDB4ZmYxNzsKICAgICAgdFsic2V2ZW5vbGRzdHlsZSJdID0gMHhmNzM3OwogICAgICB0WyJzZXZlbnBhcmVuIl0gPSAweDI0N2E7CiAgICAgIHRbInNldmVucGVyaW9kIl0gPSAweDI0OGU7CiAgICAgIHRbInNldmVucGVyc2lhbiJdID0gMHgwNmY3OwogICAgICB0WyJzZXZlbnJvbWFuIl0gPSAweDIxNzY7CiAgICAgIHRbInNldmVuc3VwZXJpb3IiXSA9IDB4MjA3NzsKICAgICAgdFsic2V2ZW50ZWVuY2lyY2xlIl0gPSAweDI0NzA7CiAgICAgIHRbInNldmVudGVlbnBhcmVuIl0gPSAweDI0ODQ7CiAgICAgIHRbInNldmVudGVlbnBlcmlvZCJdID0gMHgyNDk4OwogICAgICB0WyJzZXZlbnRoYWkiXSA9IDB4MGU1NzsKICAgICAgdFsic2Z0aHlwaGVuIl0gPSAweDAwYWQ7CiAgICAgIHRbInNoYWFybWVuaWFuIl0gPSAweDA1Nzc7CiAgICAgIHRbInNoYWJlbmdhbGkiXSA9IDB4MDliNjsKICAgICAgdFsic2hhY3lyaWxsaWMiXSA9IDB4MDQ0ODsKICAgICAgdFsic2hhZGRhYXJhYmljIl0gPSAweDA2NTE7CiAgICAgIHRbInNoYWRkYWRhbW1hYXJhYmljIl0gPSAweGZjNjE7CiAgICAgIHRbInNoYWRkYWRhbW1hdGFuYXJhYmljIl0gPSAweGZjNWU7CiAgICAgIHRbInNoYWRkYWZhdGhhYXJhYmljIl0gPSAweGZjNjA7CiAgICAgIHRbInNoYWRkYWthc3JhYXJhYmljIl0gPSAweGZjNjI7CiAgICAgIHRbInNoYWRkYWthc3JhdGFuYXJhYmljIl0gPSAweGZjNWY7CiAgICAgIHRbInNoYWRlIl0gPSAweDI1OTI7CiAgICAgIHRbInNoYWRlZGFyayJdID0gMHgyNTkzOwogICAgICB0WyJzaGFkZWxpZ2h0Il0gPSAweDI1OTE7CiAgICAgIHRbInNoYWRlbWVkaXVtIl0gPSAweDI1OTI7CiAgICAgIHRbInNoYWRldmEiXSA9IDB4MDkzNjsKICAgICAgdFsic2hhZ3VqYXJhdGkiXSA9IDB4MGFiNjsKICAgICAgdFsic2hhZ3VybXVraGkiXSA9IDB4MGEzNjsKICAgICAgdFsic2hhbHNoZWxldGhlYnJldyJdID0gMHgwNTkzOwogICAgICB0WyJzaGJvcG9tb2ZvIl0gPSAweDMxMTU7CiAgICAgIHRbInNoY2hhY3lyaWxsaWMiXSA9IDB4MDQ0OTsKICAgICAgdFsic2hlZW5hcmFiaWMiXSA9IDB4MDYzNDsKICAgICAgdFsic2hlZW5maW5hbGFyYWJpYyJdID0gMHhmZWI2OwogICAgICB0WyJzaGVlbmluaXRpYWxhcmFiaWMiXSA9IDB4ZmViNzsKICAgICAgdFsic2hlZW5tZWRpYWxhcmFiaWMiXSA9IDB4ZmViODsKICAgICAgdFsic2hlaWNvcHRpYyJdID0gMHgwM2UzOwogICAgICB0WyJzaGVxZWwiXSA9IDB4MjBhYTsKICAgICAgdFsic2hlcWVsaGVicmV3Il0gPSAweDIwYWE7CiAgICAgIHRbInNoZXZhIl0gPSAweDA1YjA7CiAgICAgIHRbInNoZXZhMTE1Il0gPSAweDA1YjA7CiAgICAgIHRbInNoZXZhMTUiXSA9IDB4MDViMDsKICAgICAgdFsic2hldmEyMiJdID0gMHgwNWIwOwogICAgICB0WyJzaGV2YTJlIl0gPSAweDA1YjA7CiAgICAgIHRbInNoZXZhaGVicmV3Il0gPSAweDA1YjA7CiAgICAgIHRbInNoZXZhbmFycm93aGVicmV3Il0gPSAweDA1YjA7CiAgICAgIHRbInNoZXZhcXVhcnRlcmhlYnJldyJdID0gMHgwNWIwOwogICAgICB0WyJzaGV2YXdpZGVoZWJyZXciXSA9IDB4MDViMDsKICAgICAgdFsic2hoYWN5cmlsbGljIl0gPSAweDA0YmI7CiAgICAgIHRbInNoaW1hY29wdGljIl0gPSAweDAzZWQ7CiAgICAgIHRbInNoaW4iXSA9IDB4MDVlOTsKICAgICAgdFsic2hpbmRhZ2VzaCJdID0gMHhmYjQ5OwogICAgICB0WyJzaGluZGFnZXNoaGVicmV3Il0gPSAweGZiNDk7CiAgICAgIHRbInNoaW5kYWdlc2hzaGluZG90Il0gPSAweGZiMmM7CiAgICAgIHRbInNoaW5kYWdlc2hzaGluZG90aGVicmV3Il0gPSAweGZiMmM7CiAgICAgIHRbInNoaW5kYWdlc2hzaW5kb3QiXSA9IDB4ZmIyZDsKICAgICAgdFsic2hpbmRhZ2VzaHNpbmRvdGhlYnJldyJdID0gMHhmYjJkOwogICAgICB0WyJzaGluZG90aGVicmV3Il0gPSAweDA1YzE7CiAgICAgIHRbInNoaW5oZWJyZXciXSA9IDB4MDVlOTsKICAgICAgdFsic2hpbnNoaW5kb3QiXSA9IDB4ZmIyYTsKICAgICAgdFsic2hpbnNoaW5kb3RoZWJyZXciXSA9IDB4ZmIyYTsKICAgICAgdFsic2hpbnNpbmRvdCJdID0gMHhmYjJiOwogICAgICB0WyJzaGluc2luZG90aGVicmV3Il0gPSAweGZiMmI7CiAgICAgIHRbInNob29rIl0gPSAweDAyODI7CiAgICAgIHRbInNpZ21hIl0gPSAweDAzYzM7CiAgICAgIHRbInNpZ21hMSJdID0gMHgwM2MyOwogICAgICB0WyJzaWdtYWZpbmFsIl0gPSAweDAzYzI7CiAgICAgIHRbInNpZ21hbHVuYXRlc3ltYm9sZ3JlZWsiXSA9IDB4MDNmMjsKICAgICAgdFsic2loaXJhZ2FuYSJdID0gMHgzMDU3OwogICAgICB0WyJzaWthdGFrYW5hIl0gPSAweDMwYjc7CiAgICAgIHRbInNpa2F0YWthbmFoYWxmd2lkdGgiXSA9IDB4ZmY3YzsKICAgICAgdFsic2lsdXFoZWJyZXciXSA9IDB4MDViZDsKICAgICAgdFsic2lsdXFsZWZ0aGVicmV3Il0gPSAweDA1YmQ7CiAgICAgIHRbInNpbWlsYXIiXSA9IDB4MjIzYzsKICAgICAgdFsic2luZG90aGVicmV3Il0gPSAweDA1YzI7CiAgICAgIHRbInNpb3NhY2lyY2xla29yZWFuIl0gPSAweDMyNzQ7CiAgICAgIHRbInNpb3NhcGFyZW5rb3JlYW4iXSA9IDB4MzIxNDsKICAgICAgdFsic2lvc2NpZXVja29yZWFuIl0gPSAweDMxN2U7CiAgICAgIHRbInNpb3NjaXJjbGVrb3JlYW4iXSA9IDB4MzI2NjsKICAgICAgdFsic2lvc2tpeWVva2tvcmVhbiJdID0gMHgzMTdhOwogICAgICB0WyJzaW9za29yZWFuIl0gPSAweDMxNDU7CiAgICAgIHRbInNpb3NuaWV1bmtvcmVhbiJdID0gMHgzMTdiOwogICAgICB0WyJzaW9zcGFyZW5rb3JlYW4iXSA9IDB4MzIwNjsKICAgICAgdFsic2lvc3BpZXVwa29yZWFuIl0gPSAweDMxN2Q7CiAgICAgIHRbInNpb3N0aWtldXRrb3JlYW4iXSA9IDB4MzE3YzsKICAgICAgdFsic2l4Il0gPSAweDAwMzY7CiAgICAgIHRbInNpeGFyYWJpYyJdID0gMHgwNjY2OwogICAgICB0WyJzaXhiZW5nYWxpIl0gPSAweDA5ZWM7CiAgICAgIHRbInNpeGNpcmNsZSJdID0gMHgyNDY1OwogICAgICB0WyJzaXhjaXJjbGVpbnZlcnNlc2Fuc3NlcmlmIl0gPSAweDI3OGY7CiAgICAgIHRbInNpeGRldmEiXSA9IDB4MDk2YzsKICAgICAgdFsic2l4Z3VqYXJhdGkiXSA9IDB4MGFlYzsKICAgICAgdFsic2l4Z3VybXVraGkiXSA9IDB4MGE2YzsKICAgICAgdFsic2l4aGFja2FyYWJpYyJdID0gMHgwNjY2OwogICAgICB0WyJzaXhoYW5nemhvdSJdID0gMHgzMDI2OwogICAgICB0WyJzaXhpZGVvZ3JhcGhpY3BhcmVuIl0gPSAweDMyMjU7CiAgICAgIHRbInNpeGluZmVyaW9yIl0gPSAweDIwODY7CiAgICAgIHRbInNpeG1vbm9zcGFjZSJdID0gMHhmZjE2OwogICAgICB0WyJzaXhvbGRzdHlsZSJdID0gMHhmNzM2OwogICAgICB0WyJzaXhwYXJlbiJdID0gMHgyNDc5OwogICAgICB0WyJzaXhwZXJpb2QiXSA9IDB4MjQ4ZDsKICAgICAgdFsic2l4cGVyc2lhbiJdID0gMHgwNmY2OwogICAgICB0WyJzaXhyb21hbiJdID0gMHgyMTc1OwogICAgICB0WyJzaXhzdXBlcmlvciJdID0gMHgyMDc2OwogICAgICB0WyJzaXh0ZWVuY2lyY2xlIl0gPSAweDI0NmY7CiAgICAgIHRbInNpeHRlZW5jdXJyZW5jeWRlbm9taW5hdG9yYmVuZ2FsaSJdID0gMHgwOWY5OwogICAgICB0WyJzaXh0ZWVucGFyZW4iXSA9IDB4MjQ4MzsKICAgICAgdFsic2l4dGVlbnBlcmlvZCJdID0gMHgyNDk3OwogICAgICB0WyJzaXh0aGFpIl0gPSAweDBlNTY7CiAgICAgIHRbInNsYXNoIl0gPSAweDAwMmY7CiAgICAgIHRbInNsYXNobW9ub3NwYWNlIl0gPSAweGZmMGY7CiAgICAgIHRbInNsb25nIl0gPSAweDAxN2Y7CiAgICAgIHRbInNsb25nZG90YWNjZW50Il0gPSAweDFlOWI7CiAgICAgIHRbInNtaWxlZmFjZSJdID0gMHgyNjNhOwogICAgICB0WyJzbW9ub3NwYWNlIl0gPSAweGZmNTM7CiAgICAgIHRbInNvZnBhc3VxaGVicmV3Il0gPSAweDA1YzM7CiAgICAgIHRbInNvZnRoeXBoZW4iXSA9IDB4MDBhZDsKICAgICAgdFsic29mdHNpZ25jeXJpbGxpYyJdID0gMHgwNDRjOwogICAgICB0WyJzb2hpcmFnYW5hIl0gPSAweDMwNWQ7CiAgICAgIHRbInNva2F0YWthbmEiXSA9IDB4MzBiZDsKICAgICAgdFsic29rYXRha2FuYWhhbGZ3aWR0aCJdID0gMHhmZjdmOwogICAgICB0WyJzb2xpZHVzbG9uZ292ZXJsYXljbWIiXSA9IDB4MDMzODsKICAgICAgdFsic29saWR1c3Nob3J0b3ZlcmxheWNtYiJdID0gMHgwMzM3OwogICAgICB0WyJzb3J1c2l0aGFpIl0gPSAweDBlMjk7CiAgICAgIHRbInNvc2FsYXRoYWkiXSA9IDB4MGUyODsKICAgICAgdFsic29zb3RoYWkiXSA9IDB4MGUwYjsKICAgICAgdFsic29zdWF0aGFpIl0gPSAweDBlMmE7CiAgICAgIHRbInNwYWNlIl0gPSAweDAwMjA7CiAgICAgIHRbInNwYWNlaGFja2FyYWJpYyJdID0gMHgwMDIwOwogICAgICB0WyJzcGFkZSJdID0gMHgyNjYwOwogICAgICB0WyJzcGFkZXN1aXRibGFjayJdID0gMHgyNjYwOwogICAgICB0WyJzcGFkZXN1aXR3aGl0ZSJdID0gMHgyNjY0OwogICAgICB0WyJzcGFyZW4iXSA9IDB4MjRhZTsKICAgICAgdFsic3F1YXJlYmVsb3djbWIiXSA9IDB4MDMzYjsKICAgICAgdFsic3F1YXJlY2MiXSA9IDB4MzNjNDsKICAgICAgdFsic3F1YXJlY20iXSA9IDB4MzM5ZDsKICAgICAgdFsic3F1YXJlZGlhZ29uYWxjcm9zc2hhdGNoZmlsbCJdID0gMHgyNWE5OwogICAgICB0WyJzcXVhcmVob3Jpem9udGFsZmlsbCJdID0gMHgyNWE0OwogICAgICB0WyJzcXVhcmVrZyJdID0gMHgzMzhmOwogICAgICB0WyJzcXVhcmVrbSJdID0gMHgzMzllOwogICAgICB0WyJzcXVhcmVrbWNhcGl0YWwiXSA9IDB4MzNjZTsKICAgICAgdFsic3F1YXJlbG4iXSA9IDB4MzNkMTsKICAgICAgdFsic3F1YXJlbG9nIl0gPSAweDMzZDI7CiAgICAgIHRbInNxdWFyZW1nIl0gPSAweDMzOGU7CiAgICAgIHRbInNxdWFyZW1pbCJdID0gMHgzM2Q1OwogICAgICB0WyJzcXVhcmVtbSJdID0gMHgzMzljOwogICAgICB0WyJzcXVhcmVtc3F1YXJlZCJdID0gMHgzM2ExOwogICAgICB0WyJzcXVhcmVvcnRob2dvbmFsY3Jvc3NoYXRjaGZpbGwiXSA9IDB4MjVhNjsKICAgICAgdFsic3F1YXJldXBwZXJsZWZ0dG9sb3dlcnJpZ2h0ZmlsbCJdID0gMHgyNWE3OwogICAgICB0WyJzcXVhcmV1cHBlcnJpZ2h0dG9sb3dlcmxlZnRmaWxsIl0gPSAweDI1YTg7CiAgICAgIHRbInNxdWFyZXZlcnRpY2FsZmlsbCJdID0gMHgyNWE1OwogICAgICB0WyJzcXVhcmV3aGl0ZXdpdGhzbWFsbGJsYWNrIl0gPSAweDI1YTM7CiAgICAgIHRbInNyc3F1YXJlIl0gPSAweDMzZGI7CiAgICAgIHRbInNzYWJlbmdhbGkiXSA9IDB4MDliNzsKICAgICAgdFsic3NhZGV2YSJdID0gMHgwOTM3OwogICAgICB0WyJzc2FndWphcmF0aSJdID0gMHgwYWI3OwogICAgICB0WyJzc2FuZ2NpZXVja29yZWFuIl0gPSAweDMxNDk7CiAgICAgIHRbInNzYW5naGlldWhrb3JlYW4iXSA9IDB4MzE4NTsKICAgICAgdFsic3NhbmdpZXVuZ2tvcmVhbiJdID0gMHgzMTgwOwogICAgICB0WyJzc2FuZ2tpeWVva2tvcmVhbiJdID0gMHgzMTMyOwogICAgICB0WyJzc2FuZ25pZXVua29yZWFuIl0gPSAweDMxNjU7CiAgICAgIHRbInNzYW5ncGlldXBrb3JlYW4iXSA9IDB4MzE0MzsKICAgICAgdFsic3NhbmdzaW9za29yZWFuIl0gPSAweDMxNDY7CiAgICAgIHRbInNzYW5ndGlrZXV0a29yZWFuIl0gPSAweDMxMzg7CiAgICAgIHRbInNzdXBlcmlvciJdID0gMHhmNmYyOwogICAgICB0WyJzdGVybGluZyJdID0gMHgwMGEzOwogICAgICB0WyJzdGVybGluZ21vbm9zcGFjZSJdID0gMHhmZmUxOwogICAgICB0WyJzdHJva2Vsb25nb3ZlcmxheWNtYiJdID0gMHgwMzM2OwogICAgICB0WyJzdHJva2VzaG9ydG92ZXJsYXljbWIiXSA9IDB4MDMzNTsKICAgICAgdFsic3Vic2V0Il0gPSAweDIyODI7CiAgICAgIHRbInN1YnNldG5vdGVxdWFsIl0gPSAweDIyOGE7CiAgICAgIHRbInN1YnNldG9yZXF1YWwiXSA9IDB4MjI4NjsKICAgICAgdFsic3VjY2VlZHMiXSA9IDB4MjI3YjsKICAgICAgdFsic3VjaHRoYXQiXSA9IDB4MjIwYjsKICAgICAgdFsic3VoaXJhZ2FuYSJdID0gMHgzMDU5OwogICAgICB0WyJzdWthdGFrYW5hIl0gPSAweDMwYjk7CiAgICAgIHRbInN1a2F0YWthbmFoYWxmd2lkdGgiXSA9IDB4ZmY3ZDsKICAgICAgdFsic3VrdW5hcmFiaWMiXSA9IDB4MDY1MjsKICAgICAgdFsic3VtbWF0aW9uIl0gPSAweDIyMTE7CiAgICAgIHRbInN1biJdID0gMHgyNjNjOwogICAgICB0WyJzdXBlcnNldCJdID0gMHgyMjgzOwogICAgICB0WyJzdXBlcnNldG5vdGVxdWFsIl0gPSAweDIyOGI7CiAgICAgIHRbInN1cGVyc2V0b3JlcXVhbCJdID0gMHgyMjg3OwogICAgICB0WyJzdnNxdWFyZSJdID0gMHgzM2RjOwogICAgICB0WyJzeW91d2FlcmFzcXVhcmUiXSA9IDB4MzM3YzsKICAgICAgdFsidCJdID0gMHgwMDc0OwogICAgICB0WyJ0YWJlbmdhbGkiXSA9IDB4MDlhNDsKICAgICAgdFsidGFja2Rvd24iXSA9IDB4MjJhNDsKICAgICAgdFsidGFja2xlZnQiXSA9IDB4MjJhMzsKICAgICAgdFsidGFkZXZhIl0gPSAweDA5MjQ7CiAgICAgIHRbInRhZ3VqYXJhdGkiXSA9IDB4MGFhNDsKICAgICAgdFsidGFndXJtdWtoaSJdID0gMHgwYTI0OwogICAgICB0WyJ0YWhhcmFiaWMiXSA9IDB4MDYzNzsKICAgICAgdFsidGFoZmluYWxhcmFiaWMiXSA9IDB4ZmVjMjsKICAgICAgdFsidGFoaW5pdGlhbGFyYWJpYyJdID0gMHhmZWMzOwogICAgICB0WyJ0YWhpcmFnYW5hIl0gPSAweDMwNWY7CiAgICAgIHRbInRhaG1lZGlhbGFyYWJpYyJdID0gMHhmZWM0OwogICAgICB0WyJ0YWlzeW91ZXJhc3F1YXJlIl0gPSAweDMzN2Q7CiAgICAgIHRbInRha2F0YWthbmEiXSA9IDB4MzBiZjsKICAgICAgdFsidGFrYXRha2FuYWhhbGZ3aWR0aCJdID0gMHhmZjgwOwogICAgICB0WyJ0YXR3ZWVsYXJhYmljIl0gPSAweDA2NDA7CiAgICAgIHRbInRhdSJdID0gMHgwM2M0OwogICAgICB0WyJ0YXYiXSA9IDB4MDVlYTsKICAgICAgdFsidGF2ZGFnZXMiXSA9IDB4ZmI0YTsKICAgICAgdFsidGF2ZGFnZXNoIl0gPSAweGZiNGE7CiAgICAgIHRbInRhdmRhZ2VzaGhlYnJldyJdID0gMHhmYjRhOwogICAgICB0WyJ0YXZoZWJyZXciXSA9IDB4MDVlYTsKICAgICAgdFsidGJhciJdID0gMHgwMTY3OwogICAgICB0WyJ0Ym9wb21vZm8iXSA9IDB4MzEwYTsKICAgICAgdFsidGNhcm9uIl0gPSAweDAxNjU7CiAgICAgIHRbInRjY3VybCJdID0gMHgwMmE4OwogICAgICB0WyJ0Y2VkaWxsYSJdID0gMHgwMTYzOwogICAgICB0WyJ0Y2hlaGFyYWJpYyJdID0gMHgwNjg2OwogICAgICB0WyJ0Y2hlaGZpbmFsYXJhYmljIl0gPSAweGZiN2I7CiAgICAgIHRbInRjaGVoaW5pdGlhbGFyYWJpYyJdID0gMHhmYjdjOwogICAgICB0WyJ0Y2hlaG1lZGlhbGFyYWJpYyJdID0gMHhmYjdkOwogICAgICB0WyJ0Y2lyY2xlIl0gPSAweDI0ZTM7CiAgICAgIHRbInRjaXJjdW1mbGV4YmVsb3ciXSA9IDB4MWU3MTsKICAgICAgdFsidGNvbW1hYWNjZW50Il0gPSAweDAxNjM7CiAgICAgIHRbInRkaWVyZXNpcyJdID0gMHgxZTk3OwogICAgICB0WyJ0ZG90YWNjZW50Il0gPSAweDFlNmI7CiAgICAgIHRbInRkb3RiZWxvdyJdID0gMHgxZTZkOwogICAgICB0WyJ0ZWN5cmlsbGljIl0gPSAweDA0NDI7CiAgICAgIHRbInRlZGVzY2VuZGVyY3lyaWxsaWMiXSA9IDB4MDRhZDsKICAgICAgdFsidGVoYXJhYmljIl0gPSAweDA2MmE7CiAgICAgIHRbInRlaGZpbmFsYXJhYmljIl0gPSAweGZlOTY7CiAgICAgIHRbInRlaGhhaGluaXRpYWxhcmFiaWMiXSA9IDB4ZmNhMjsKICAgICAgdFsidGVoaGFoaXNvbGF0ZWRhcmFiaWMiXSA9IDB4ZmMwYzsKICAgICAgdFsidGVoaW5pdGlhbGFyYWJpYyJdID0gMHhmZTk3OwogICAgICB0WyJ0ZWhpcmFnYW5hIl0gPSAweDMwNjY7CiAgICAgIHRbInRlaGplZW1pbml0aWFsYXJhYmljIl0gPSAweGZjYTE7CiAgICAgIHRbInRlaGplZW1pc29sYXRlZGFyYWJpYyJdID0gMHhmYzBiOwogICAgICB0WyJ0ZWhtYXJidXRhYXJhYmljIl0gPSAweDA2Mjk7CiAgICAgIHRbInRlaG1hcmJ1dGFmaW5hbGFyYWJpYyJdID0gMHhmZTk0OwogICAgICB0WyJ0ZWhtZWRpYWxhcmFiaWMiXSA9IDB4ZmU5ODsKICAgICAgdFsidGVobWVlbWluaXRpYWxhcmFiaWMiXSA9IDB4ZmNhNDsKICAgICAgdFsidGVobWVlbWlzb2xhdGVkYXJhYmljIl0gPSAweGZjMGU7CiAgICAgIHRbInRlaG5vb25maW5hbGFyYWJpYyJdID0gMHhmYzczOwogICAgICB0WyJ0ZWthdGFrYW5hIl0gPSAweDMwYzY7CiAgICAgIHRbInRla2F0YWthbmFoYWxmd2lkdGgiXSA9IDB4ZmY4MzsKICAgICAgdFsidGVsZXBob25lIl0gPSAweDIxMjE7CiAgICAgIHRbInRlbGVwaG9uZWJsYWNrIl0gPSAweDI2MGU7CiAgICAgIHRbInRlbGlzaGFnZWRvbGFoZWJyZXciXSA9IDB4MDVhMDsKICAgICAgdFsidGVsaXNoYXFldGFuYWhlYnJldyJdID0gMHgwNWE5OwogICAgICB0WyJ0ZW5jaXJjbGUiXSA9IDB4MjQ2OTsKICAgICAgdFsidGVuaWRlb2dyYXBoaWNwYXJlbiJdID0gMHgzMjI5OwogICAgICB0WyJ0ZW5wYXJlbiJdID0gMHgyNDdkOwogICAgICB0WyJ0ZW5wZXJpb2QiXSA9IDB4MjQ5MTsKICAgICAgdFsidGVucm9tYW4iXSA9IDB4MjE3OTsKICAgICAgdFsidGVzaCJdID0gMHgwMmE3OwogICAgICB0WyJ0ZXQiXSA9IDB4MDVkODsKICAgICAgdFsidGV0ZGFnZXNoIl0gPSAweGZiMzg7CiAgICAgIHRbInRldGRhZ2VzaGhlYnJldyJdID0gMHhmYjM4OwogICAgICB0WyJ0ZXRoZWJyZXciXSA9IDB4MDVkODsKICAgICAgdFsidGV0c2VjeXJpbGxpYyJdID0gMHgwNGI1OwogICAgICB0WyJ0ZXZpcmhlYnJldyJdID0gMHgwNTliOwogICAgICB0WyJ0ZXZpcmxlZnRoZWJyZXciXSA9IDB4MDU5YjsKICAgICAgdFsidGhhYmVuZ2FsaSJdID0gMHgwOWE1OwogICAgICB0WyJ0aGFkZXZhIl0gPSAweDA5MjU7CiAgICAgIHRbInRoYWd1amFyYXRpIl0gPSAweDBhYTU7CiAgICAgIHRbInRoYWd1cm11a2hpIl0gPSAweDBhMjU7CiAgICAgIHRbInRoYWxhcmFiaWMiXSA9IDB4MDYzMDsKICAgICAgdFsidGhhbGZpbmFsYXJhYmljIl0gPSAweGZlYWM7CiAgICAgIHRbInRoYW50aGFraGF0bG93bGVmdHRoYWkiXSA9IDB4Zjg5ODsKICAgICAgdFsidGhhbnRoYWtoYXRsb3dyaWdodHRoYWkiXSA9IDB4Zjg5NzsKICAgICAgdFsidGhhbnRoYWtoYXR0aGFpIl0gPSAweDBlNGM7CiAgICAgIHRbInRoYW50aGFraGF0dXBwZXJsZWZ0dGhhaSJdID0gMHhmODk2OwogICAgICB0WyJ0aGVoYXJhYmljIl0gPSAweDA2MmI7CiAgICAgIHRbInRoZWhmaW5hbGFyYWJpYyJdID0gMHhmZTlhOwogICAgICB0WyJ0aGVoaW5pdGlhbGFyYWJpYyJdID0gMHhmZTliOwogICAgICB0WyJ0aGVobWVkaWFsYXJhYmljIl0gPSAweGZlOWM7CiAgICAgIHRbInRoZXJlZXhpc3RzIl0gPSAweDIyMDM7CiAgICAgIHRbInRoZXJlZm9yZSJdID0gMHgyMjM0OwogICAgICB0WyJ0aGV0YSJdID0gMHgwM2I4OwogICAgICB0WyJ0aGV0YTEiXSA9IDB4MDNkMTsKICAgICAgdFsidGhldGFzeW1ib2xncmVlayJdID0gMHgwM2QxOwogICAgICB0WyJ0aGlldXRoYWNpcmNsZWtvcmVhbiJdID0gMHgzMjc5OwogICAgICB0WyJ0aGlldXRoYXBhcmVua29yZWFuIl0gPSAweDMyMTk7CiAgICAgIHRbInRoaWV1dGhjaXJjbGVrb3JlYW4iXSA9IDB4MzI2YjsKICAgICAgdFsidGhpZXV0aGtvcmVhbiJdID0gMHgzMTRjOwogICAgICB0WyJ0aGlldXRocGFyZW5rb3JlYW4iXSA9IDB4MzIwYjsKICAgICAgdFsidGhpcnRlZW5jaXJjbGUiXSA9IDB4MjQ2YzsKICAgICAgdFsidGhpcnRlZW5wYXJlbiJdID0gMHgyNDgwOwogICAgICB0WyJ0aGlydGVlbnBlcmlvZCJdID0gMHgyNDk0OwogICAgICB0WyJ0aG9uYW5nbW9udGhvdGhhaSJdID0gMHgwZTExOwogICAgICB0WyJ0aG9vayJdID0gMHgwMWFkOwogICAgICB0WyJ0aG9waHV0aGFvdGhhaSJdID0gMHgwZTEyOwogICAgICB0WyJ0aG9ybiJdID0gMHgwMGZlOwogICAgICB0WyJ0aG90aGFoYW50aGFpIl0gPSAweDBlMTc7CiAgICAgIHRbInRob3RoYW50aGFpIl0gPSAweDBlMTA7CiAgICAgIHRbInRob3Rob25ndGhhaSJdID0gMHgwZTE4OwogICAgICB0WyJ0aG90aHVuZ3RoYWkiXSA9IDB4MGUxNjsKICAgICAgdFsidGhvdXNhbmRjeXJpbGxpYyJdID0gMHgwNDgyOwogICAgICB0WyJ0aG91c2FuZHNzZXBhcmF0b3JhcmFiaWMiXSA9IDB4MDY2YzsKICAgICAgdFsidGhvdXNhbmRzc2VwYXJhdG9ycGVyc2lhbiJdID0gMHgwNjZjOwogICAgICB0WyJ0aHJlZSJdID0gMHgwMDMzOwogICAgICB0WyJ0aHJlZWFyYWJpYyJdID0gMHgwNjYzOwogICAgICB0WyJ0aHJlZWJlbmdhbGkiXSA9IDB4MDllOTsKICAgICAgdFsidGhyZWVjaXJjbGUiXSA9IDB4MjQ2MjsKICAgICAgdFsidGhyZWVjaXJjbGVpbnZlcnNlc2Fuc3NlcmlmIl0gPSAweDI3OGM7CiAgICAgIHRbInRocmVlZGV2YSJdID0gMHgwOTY5OwogICAgICB0WyJ0aHJlZWVpZ2h0aHMiXSA9IDB4MjE1YzsKICAgICAgdFsidGhyZWVndWphcmF0aSJdID0gMHgwYWU5OwogICAgICB0WyJ0aHJlZWd1cm11a2hpIl0gPSAweDBhNjk7CiAgICAgIHRbInRocmVlaGFja2FyYWJpYyJdID0gMHgwNjYzOwogICAgICB0WyJ0aHJlZWhhbmd6aG91Il0gPSAweDMwMjM7CiAgICAgIHRbInRocmVlaWRlb2dyYXBoaWNwYXJlbiJdID0gMHgzMjIyOwogICAgICB0WyJ0aHJlZWluZmVyaW9yIl0gPSAweDIwODM7CiAgICAgIHRbInRocmVlbW9ub3NwYWNlIl0gPSAweGZmMTM7CiAgICAgIHRbInRocmVlbnVtZXJhdG9yYmVuZ2FsaSJdID0gMHgwOWY2OwogICAgICB0WyJ0aHJlZW9sZHN0eWxlIl0gPSAweGY3MzM7CiAgICAgIHRbInRocmVlcGFyZW4iXSA9IDB4MjQ3NjsKICAgICAgdFsidGhyZWVwZXJpb2QiXSA9IDB4MjQ4YTsKICAgICAgdFsidGhyZWVwZXJzaWFuIl0gPSAweDA2ZjM7CiAgICAgIHRbInRocmVlcXVhcnRlcnMiXSA9IDB4MDBiZTsKICAgICAgdFsidGhyZWVxdWFydGVyc2VtZGFzaCJdID0gMHhmNmRlOwogICAgICB0WyJ0aHJlZXJvbWFuIl0gPSAweDIxNzI7CiAgICAgIHRbInRocmVlc3VwZXJpb3IiXSA9IDB4MDBiMzsKICAgICAgdFsidGhyZWV0aGFpIl0gPSAweDBlNTM7CiAgICAgIHRbInRoenNxdWFyZSJdID0gMHgzMzk0OwogICAgICB0WyJ0aWhpcmFnYW5hIl0gPSAweDMwNjE7CiAgICAgIHRbInRpa2F0YWthbmEiXSA9IDB4MzBjMTsKICAgICAgdFsidGlrYXRha2FuYWhhbGZ3aWR0aCJdID0gMHhmZjgxOwogICAgICB0WyJ0aWtldXRhY2lyY2xla29yZWFuIl0gPSAweDMyNzA7CiAgICAgIHRbInRpa2V1dGFwYXJlbmtvcmVhbiJdID0gMHgzMjEwOwogICAgICB0WyJ0aWtldXRjaXJjbGVrb3JlYW4iXSA9IDB4MzI2MjsKICAgICAgdFsidGlrZXV0a29yZWFuIl0gPSAweDMxMzc7CiAgICAgIHRbInRpa2V1dHBhcmVua29yZWFuIl0gPSAweDMyMDI7CiAgICAgIHRbInRpbGRlIl0gPSAweDAyZGM7CiAgICAgIHRbInRpbGRlYmVsb3djbWIiXSA9IDB4MDMzMDsKICAgICAgdFsidGlsZGVjbWIiXSA9IDB4MDMwMzsKICAgICAgdFsidGlsZGVjb21iIl0gPSAweDAzMDM7CiAgICAgIHRbInRpbGRlZG91YmxlY21iIl0gPSAweDAzNjA7CiAgICAgIHRbInRpbGRlb3BlcmF0b3IiXSA9IDB4MjIzYzsKICAgICAgdFsidGlsZGVvdmVybGF5Y21iIl0gPSAweDAzMzQ7CiAgICAgIHRbInRpbGRldmVydGljYWxjbWIiXSA9IDB4MDMzZTsKICAgICAgdFsidGltZXNjaXJjbGUiXSA9IDB4MjI5NzsKICAgICAgdFsidGlwZWhhaGVicmV3Il0gPSAweDA1OTY7CiAgICAgIHRbInRpcGVoYWxlZnRoZWJyZXciXSA9IDB4MDU5NjsKICAgICAgdFsidGlwcGlndXJtdWtoaSJdID0gMHgwYTcwOwogICAgICB0WyJ0aXRsb2N5cmlsbGljY21iIl0gPSAweDA0ODM7CiAgICAgIHRbInRpd25hcm1lbmlhbiJdID0gMHgwNTdmOwogICAgICB0WyJ0bGluZWJlbG93Il0gPSAweDFlNmY7CiAgICAgIHRbInRtb25vc3BhY2UiXSA9IDB4ZmY1NDsKICAgICAgdFsidG9hcm1lbmlhbiJdID0gMHgwNTY5OwogICAgICB0WyJ0b2hpcmFnYW5hIl0gPSAweDMwNjg7CiAgICAgIHRbInRva2F0YWthbmEiXSA9IDB4MzBjODsKICAgICAgdFsidG9rYXRha2FuYWhhbGZ3aWR0aCJdID0gMHhmZjg0OwogICAgICB0WyJ0b25lYmFyZXh0cmFoaWdobW9kIl0gPSAweDAyZTU7CiAgICAgIHRbInRvbmViYXJleHRyYWxvd21vZCJdID0gMHgwMmU5OwogICAgICB0WyJ0b25lYmFyaGlnaG1vZCJdID0gMHgwMmU2OwogICAgICB0WyJ0b25lYmFybG93bW9kIl0gPSAweDAyZTg7CiAgICAgIHRbInRvbmViYXJtaWRtb2QiXSA9IDB4MDJlNzsKICAgICAgdFsidG9uZWZpdmUiXSA9IDB4MDFiZDsKICAgICAgdFsidG9uZXNpeCJdID0gMHgwMTg1OwogICAgICB0WyJ0b25ldHdvIl0gPSAweDAxYTg7CiAgICAgIHRbInRvbm9zIl0gPSAweDAzODQ7CiAgICAgIHRbInRvbnNxdWFyZSJdID0gMHgzMzI3OwogICAgICB0WyJ0b3BhdGFrdGhhaSJdID0gMHgwZTBmOwogICAgICB0WyJ0b3J0b2lzZXNoZWxsYnJhY2tldGxlZnQiXSA9IDB4MzAxNDsKICAgICAgdFsidG9ydG9pc2VzaGVsbGJyYWNrZXRsZWZ0c21hbGwiXSA9IDB4ZmU1ZDsKICAgICAgdFsidG9ydG9pc2VzaGVsbGJyYWNrZXRsZWZ0dmVydGljYWwiXSA9IDB4ZmUzOTsKICAgICAgdFsidG9ydG9pc2VzaGVsbGJyYWNrZXRyaWdodCJdID0gMHgzMDE1OwogICAgICB0WyJ0b3J0b2lzZXNoZWxsYnJhY2tldHJpZ2h0c21hbGwiXSA9IDB4ZmU1ZTsKICAgICAgdFsidG9ydG9pc2VzaGVsbGJyYWNrZXRyaWdodHZlcnRpY2FsIl0gPSAweGZlM2E7CiAgICAgIHRbInRvdGFvdGhhaSJdID0gMHgwZTE1OwogICAgICB0WyJ0cGFsYXRhbGhvb2siXSA9IDB4MDFhYjsKICAgICAgdFsidHBhcmVuIl0gPSAweDI0YWY7CiAgICAgIHRbInRyYWRlbWFyayJdID0gMHgyMTIyOwogICAgICB0WyJ0cmFkZW1hcmtzYW5zIl0gPSAweGY4ZWE7CiAgICAgIHRbInRyYWRlbWFya3NlcmlmIl0gPSAweGY2ZGI7CiAgICAgIHRbInRyZXRyb2ZsZXhob29rIl0gPSAweDAyODg7CiAgICAgIHRbInRyaWFnZG4iXSA9IDB4MjViYzsKICAgICAgdFsidHJpYWdsZiJdID0gMHgyNWM0OwogICAgICB0WyJ0cmlhZ3J0Il0gPSAweDI1YmE7CiAgICAgIHRbInRyaWFndXAiXSA9IDB4MjViMjsKICAgICAgdFsidHMiXSA9IDB4MDJhNjsKICAgICAgdFsidHNhZGkiXSA9IDB4MDVlNjsKICAgICAgdFsidHNhZGlkYWdlc2giXSA9IDB4ZmI0NjsKICAgICAgdFsidHNhZGlkYWdlc2hoZWJyZXciXSA9IDB4ZmI0NjsKICAgICAgdFsidHNhZGloZWJyZXciXSA9IDB4MDVlNjsKICAgICAgdFsidHNlY3lyaWxsaWMiXSA9IDB4MDQ0NjsKICAgICAgdFsidHNlcmUiXSA9IDB4MDViNTsKICAgICAgdFsidHNlcmUxMiJdID0gMHgwNWI1OwogICAgICB0WyJ0c2VyZTFlIl0gPSAweDA1YjU7CiAgICAgIHRbInRzZXJlMmIiXSA9IDB4MDViNTsKICAgICAgdFsidHNlcmVoZWJyZXciXSA9IDB4MDViNTsKICAgICAgdFsidHNlcmVuYXJyb3doZWJyZXciXSA9IDB4MDViNTsKICAgICAgdFsidHNlcmVxdWFydGVyaGVicmV3Il0gPSAweDA1YjU7CiAgICAgIHRbInRzZXJld2lkZWhlYnJldyJdID0gMHgwNWI1OwogICAgICB0WyJ0c2hlY3lyaWxsaWMiXSA9IDB4MDQ1YjsKICAgICAgdFsidHN1cGVyaW9yIl0gPSAweGY2ZjM7CiAgICAgIHRbInR0YWJlbmdhbGkiXSA9IDB4MDk5ZjsKICAgICAgdFsidHRhZGV2YSJdID0gMHgwOTFmOwogICAgICB0WyJ0dGFndWphcmF0aSJdID0gMHgwYTlmOwogICAgICB0WyJ0dGFndXJtdWtoaSJdID0gMHgwYTFmOwogICAgICB0WyJ0dGVoYXJhYmljIl0gPSAweDA2Nzk7CiAgICAgIHRbInR0ZWhmaW5hbGFyYWJpYyJdID0gMHhmYjY3OwogICAgICB0WyJ0dGVoaW5pdGlhbGFyYWJpYyJdID0gMHhmYjY4OwogICAgICB0WyJ0dGVobWVkaWFsYXJhYmljIl0gPSAweGZiNjk7CiAgICAgIHRbInR0aGFiZW5nYWxpIl0gPSAweDA5YTA7CiAgICAgIHRbInR0aGFkZXZhIl0gPSAweDA5MjA7CiAgICAgIHRbInR0aGFndWphcmF0aSJdID0gMHgwYWEwOwogICAgICB0WyJ0dGhhZ3VybXVraGkiXSA9IDB4MGEyMDsKICAgICAgdFsidHR1cm5lZCJdID0gMHgwMjg3OwogICAgICB0WyJ0dWhpcmFnYW5hIl0gPSAweDMwNjQ7CiAgICAgIHRbInR1a2F0YWthbmEiXSA9IDB4MzBjNDsKICAgICAgdFsidHVrYXRha2FuYWhhbGZ3aWR0aCJdID0gMHhmZjgyOwogICAgICB0WyJ0dXNtYWxsaGlyYWdhbmEiXSA9IDB4MzA2MzsKICAgICAgdFsidHVzbWFsbGthdGFrYW5hIl0gPSAweDMwYzM7CiAgICAgIHRbInR1c21hbGxrYXRha2FuYWhhbGZ3aWR0aCJdID0gMHhmZjZmOwogICAgICB0WyJ0d2VsdmVjaXJjbGUiXSA9IDB4MjQ2YjsKICAgICAgdFsidHdlbHZlcGFyZW4iXSA9IDB4MjQ3ZjsKICAgICAgdFsidHdlbHZlcGVyaW9kIl0gPSAweDI0OTM7CiAgICAgIHRbInR3ZWx2ZXJvbWFuIl0gPSAweDIxN2I7CiAgICAgIHRbInR3ZW50eWNpcmNsZSJdID0gMHgyNDczOwogICAgICB0WyJ0d2VudHloYW5nemhvdSJdID0gMHg1MzQ0OwogICAgICB0WyJ0d2VudHlwYXJlbiJdID0gMHgyNDg3OwogICAgICB0WyJ0d2VudHlwZXJpb2QiXSA9IDB4MjQ5YjsKICAgICAgdFsidHdvIl0gPSAweDAwMzI7CiAgICAgIHRbInR3b2FyYWJpYyJdID0gMHgwNjYyOwogICAgICB0WyJ0d29iZW5nYWxpIl0gPSAweDA5ZTg7CiAgICAgIHRbInR3b2NpcmNsZSJdID0gMHgyNDYxOwogICAgICB0WyJ0d29jaXJjbGVpbnZlcnNlc2Fuc3NlcmlmIl0gPSAweDI3OGI7CiAgICAgIHRbInR3b2RldmEiXSA9IDB4MDk2ODsKICAgICAgdFsidHdvZG90ZW5sZWFkZXIiXSA9IDB4MjAyNTsKICAgICAgdFsidHdvZG90bGVhZGVyIl0gPSAweDIwMjU7CiAgICAgIHRbInR3b2RvdGxlYWRlcnZlcnRpY2FsIl0gPSAweGZlMzA7CiAgICAgIHRbInR3b2d1amFyYXRpIl0gPSAweDBhZTg7CiAgICAgIHRbInR3b2d1cm11a2hpIl0gPSAweDBhNjg7CiAgICAgIHRbInR3b2hhY2thcmFiaWMiXSA9IDB4MDY2MjsKICAgICAgdFsidHdvaGFuZ3pob3UiXSA9IDB4MzAyMjsKICAgICAgdFsidHdvaWRlb2dyYXBoaWNwYXJlbiJdID0gMHgzMjIxOwogICAgICB0WyJ0d29pbmZlcmlvciJdID0gMHgyMDgyOwogICAgICB0WyJ0d29tb25vc3BhY2UiXSA9IDB4ZmYxMjsKICAgICAgdFsidHdvbnVtZXJhdG9yYmVuZ2FsaSJdID0gMHgwOWY1OwogICAgICB0WyJ0d29vbGRzdHlsZSJdID0gMHhmNzMyOwogICAgICB0WyJ0d29wYXJlbiJdID0gMHgyNDc1OwogICAgICB0WyJ0d29wZXJpb2QiXSA9IDB4MjQ4OTsKICAgICAgdFsidHdvcGVyc2lhbiJdID0gMHgwNmYyOwogICAgICB0WyJ0d29yb21hbiJdID0gMHgyMTcxOwogICAgICB0WyJ0d29zdHJva2UiXSA9IDB4MDFiYjsKICAgICAgdFsidHdvc3VwZXJpb3IiXSA9IDB4MDBiMjsKICAgICAgdFsidHdvdGhhaSJdID0gMHgwZTUyOwogICAgICB0WyJ0d290aGlyZHMiXSA9IDB4MjE1NDsKICAgICAgdFsidSJdID0gMHgwMDc1OwogICAgICB0WyJ1YWN1dGUiXSA9IDB4MDBmYTsKICAgICAgdFsidWJhciJdID0gMHgwMjg5OwogICAgICB0WyJ1YmVuZ2FsaSJdID0gMHgwOTg5OwogICAgICB0WyJ1Ym9wb21vZm8iXSA9IDB4MzEyODsKICAgICAgdFsidWJyZXZlIl0gPSAweDAxNmQ7CiAgICAgIHRbInVjYXJvbiJdID0gMHgwMWQ0OwogICAgICB0WyJ1Y2lyY2xlIl0gPSAweDI0ZTQ7CiAgICAgIHRbInVjaXJjdW1mbGV4Il0gPSAweDAwZmI7CiAgICAgIHRbInVjaXJjdW1mbGV4YmVsb3ciXSA9IDB4MWU3NzsKICAgICAgdFsidWN5cmlsbGljIl0gPSAweDA0NDM7CiAgICAgIHRbInVkYXR0YWRldmEiXSA9IDB4MDk1MTsKICAgICAgdFsidWRibGFjdXRlIl0gPSAweDAxNzE7CiAgICAgIHRbInVkYmxncmF2ZSJdID0gMHgwMjE1OwogICAgICB0WyJ1ZGV2YSJdID0gMHgwOTA5OwogICAgICB0WyJ1ZGllcmVzaXMiXSA9IDB4MDBmYzsKICAgICAgdFsidWRpZXJlc2lzYWN1dGUiXSA9IDB4MDFkODsKICAgICAgdFsidWRpZXJlc2lzYmVsb3ciXSA9IDB4MWU3MzsKICAgICAgdFsidWRpZXJlc2lzY2Fyb24iXSA9IDB4MDFkYTsKICAgICAgdFsidWRpZXJlc2lzY3lyaWxsaWMiXSA9IDB4MDRmMTsKICAgICAgdFsidWRpZXJlc2lzZ3JhdmUiXSA9IDB4MDFkYzsKICAgICAgdFsidWRpZXJlc2lzbWFjcm9uIl0gPSAweDAxZDY7CiAgICAgIHRbInVkb3RiZWxvdyJdID0gMHgxZWU1OwogICAgICB0WyJ1Z3JhdmUiXSA9IDB4MDBmOTsKICAgICAgdFsidWd1amFyYXRpIl0gPSAweDBhODk7CiAgICAgIHRbInVndXJtdWtoaSJdID0gMHgwYTA5OwogICAgICB0WyJ1aGlyYWdhbmEiXSA9IDB4MzA0NjsKICAgICAgdFsidWhvb2thYm92ZSJdID0gMHgxZWU3OwogICAgICB0WyJ1aG9ybiJdID0gMHgwMWIwOwogICAgICB0WyJ1aG9ybmFjdXRlIl0gPSAweDFlZTk7CiAgICAgIHRbInVob3JuZG90YmVsb3ciXSA9IDB4MWVmMTsKICAgICAgdFsidWhvcm5ncmF2ZSJdID0gMHgxZWViOwogICAgICB0WyJ1aG9ybmhvb2thYm92ZSJdID0gMHgxZWVkOwogICAgICB0WyJ1aG9ybnRpbGRlIl0gPSAweDFlZWY7CiAgICAgIHRbInVodW5nYXJ1bWxhdXQiXSA9IDB4MDE3MTsKICAgICAgdFsidWh1bmdhcnVtbGF1dGN5cmlsbGljIl0gPSAweDA0ZjM7CiAgICAgIHRbInVpbnZlcnRlZGJyZXZlIl0gPSAweDAyMTc7CiAgICAgIHRbInVrYXRha2FuYSJdID0gMHgzMGE2OwogICAgICB0WyJ1a2F0YWthbmFoYWxmd2lkdGgiXSA9IDB4ZmY3MzsKICAgICAgdFsidWtjeXJpbGxpYyJdID0gMHgwNDc5OwogICAgICB0WyJ1a29yZWFuIl0gPSAweDMxNWM7CiAgICAgIHRbInVtYWNyb24iXSA9IDB4MDE2YjsKICAgICAgdFsidW1hY3JvbmN5cmlsbGljIl0gPSAweDA0ZWY7CiAgICAgIHRbInVtYWNyb25kaWVyZXNpcyJdID0gMHgxZTdiOwogICAgICB0WyJ1bWF0cmFndXJtdWtoaSJdID0gMHgwYTQxOwogICAgICB0WyJ1bW9ub3NwYWNlIl0gPSAweGZmNTU7CiAgICAgIHRbInVuZGVyc2NvcmUiXSA9IDB4MDA1ZjsKICAgICAgdFsidW5kZXJzY29yZWRibCJdID0gMHgyMDE3OwogICAgICB0WyJ1bmRlcnNjb3JlbW9ub3NwYWNlIl0gPSAweGZmM2Y7CiAgICAgIHRbInVuZGVyc2NvcmV2ZXJ0aWNhbCJdID0gMHhmZTMzOwogICAgICB0WyJ1bmRlcnNjb3Jld2F2eSJdID0gMHhmZTRmOwogICAgICB0WyJ1bmlvbiJdID0gMHgyMjJhOwogICAgICB0WyJ1bml2ZXJzYWwiXSA9IDB4MjIwMDsKICAgICAgdFsidW9nb25layJdID0gMHgwMTczOwogICAgICB0WyJ1cGFyZW4iXSA9IDB4MjRiMDsKICAgICAgdFsidXBibG9jayJdID0gMHgyNTgwOwogICAgICB0WyJ1cHBlcmRvdGhlYnJldyJdID0gMHgwNWM0OwogICAgICB0WyJ1cHNpbG9uIl0gPSAweDAzYzU7CiAgICAgIHRbInVwc2lsb25kaWVyZXNpcyJdID0gMHgwM2NiOwogICAgICB0WyJ1cHNpbG9uZGllcmVzaXN0b25vcyJdID0gMHgwM2IwOwogICAgICB0WyJ1cHNpbG9ubGF0aW4iXSA9IDB4MDI4YTsKICAgICAgdFsidXBzaWxvbnRvbm9zIl0gPSAweDAzY2Q7CiAgICAgIHRbInVwdGFja2JlbG93Y21iIl0gPSAweDAzMWQ7CiAgICAgIHRbInVwdGFja21vZCJdID0gMHgwMmQ0OwogICAgICB0WyJ1cmFndXJtdWtoaSJdID0gMHgwYTczOwogICAgICB0WyJ1cmluZyJdID0gMHgwMTZmOwogICAgICB0WyJ1c2hvcnRjeXJpbGxpYyJdID0gMHgwNDVlOwogICAgICB0WyJ1c21hbGxoaXJhZ2FuYSJdID0gMHgzMDQ1OwogICAgICB0WyJ1c21hbGxrYXRha2FuYSJdID0gMHgzMGE1OwogICAgICB0WyJ1c21hbGxrYXRha2FuYWhhbGZ3aWR0aCJdID0gMHhmZjY5OwogICAgICB0WyJ1c3RyYWlnaHRjeXJpbGxpYyJdID0gMHgwNGFmOwogICAgICB0WyJ1c3RyYWlnaHRzdHJva2VjeXJpbGxpYyJdID0gMHgwNGIxOwogICAgICB0WyJ1dGlsZGUiXSA9IDB4MDE2OTsKICAgICAgdFsidXRpbGRlYWN1dGUiXSA9IDB4MWU3OTsKICAgICAgdFsidXRpbGRlYmVsb3ciXSA9IDB4MWU3NTsKICAgICAgdFsidXViZW5nYWxpIl0gPSAweDA5OGE7CiAgICAgIHRbInV1ZGV2YSJdID0gMHgwOTBhOwogICAgICB0WyJ1dWd1amFyYXRpIl0gPSAweDBhOGE7CiAgICAgIHRbInV1Z3VybXVraGkiXSA9IDB4MGEwYTsKICAgICAgdFsidXVtYXRyYWd1cm11a2hpIl0gPSAweDBhNDI7CiAgICAgIHRbInV1dm93ZWxzaWduYmVuZ2FsaSJdID0gMHgwOWMyOwogICAgICB0WyJ1dXZvd2Vsc2lnbmRldmEiXSA9IDB4MDk0MjsKICAgICAgdFsidXV2b3dlbHNpZ25ndWphcmF0aSJdID0gMHgwYWMyOwogICAgICB0WyJ1dm93ZWxzaWduYmVuZ2FsaSJdID0gMHgwOWMxOwogICAgICB0WyJ1dm93ZWxzaWduZGV2YSJdID0gMHgwOTQxOwogICAgICB0WyJ1dm93ZWxzaWduZ3VqYXJhdGkiXSA9IDB4MGFjMTsKICAgICAgdFsidiJdID0gMHgwMDc2OwogICAgICB0WyJ2YWRldmEiXSA9IDB4MDkzNTsKICAgICAgdFsidmFndWphcmF0aSJdID0gMHgwYWI1OwogICAgICB0WyJ2YWd1cm11a2hpIl0gPSAweDBhMzU7CiAgICAgIHRbInZha2F0YWthbmEiXSA9IDB4MzBmNzsKICAgICAgdFsidmF2Il0gPSAweDA1ZDU7CiAgICAgIHRbInZhdmRhZ2VzaCJdID0gMHhmYjM1OwogICAgICB0WyJ2YXZkYWdlc2g2NSJdID0gMHhmYjM1OwogICAgICB0WyJ2YXZkYWdlc2hoZWJyZXciXSA9IDB4ZmIzNTsKICAgICAgdFsidmF2aGVicmV3Il0gPSAweDA1ZDU7CiAgICAgIHRbInZhdmhvbGFtIl0gPSAweGZiNGI7CiAgICAgIHRbInZhdmhvbGFtaGVicmV3Il0gPSAweGZiNGI7CiAgICAgIHRbInZhdnZhdmhlYnJldyJdID0gMHgwNWYwOwogICAgICB0WyJ2YXZ5b2RoZWJyZXciXSA9IDB4MDVmMTsKICAgICAgdFsidmNpcmNsZSJdID0gMHgyNGU1OwogICAgICB0WyJ2ZG90YmVsb3ciXSA9IDB4MWU3ZjsKICAgICAgdFsidmVjeXJpbGxpYyJdID0gMHgwNDMyOwogICAgICB0WyJ2ZWhhcmFiaWMiXSA9IDB4MDZhNDsKICAgICAgdFsidmVoZmluYWxhcmFiaWMiXSA9IDB4ZmI2YjsKICAgICAgdFsidmVoaW5pdGlhbGFyYWJpYyJdID0gMHhmYjZjOwogICAgICB0WyJ2ZWhtZWRpYWxhcmFiaWMiXSA9IDB4ZmI2ZDsKICAgICAgdFsidmVrYXRha2FuYSJdID0gMHgzMGY5OwogICAgICB0WyJ2ZW51cyJdID0gMHgyNjQwOwogICAgICB0WyJ2ZXJ0aWNhbGJhciJdID0gMHgwMDdjOwogICAgICB0WyJ2ZXJ0aWNhbGxpbmVhYm92ZWNtYiJdID0gMHgwMzBkOwogICAgICB0WyJ2ZXJ0aWNhbGxpbmViZWxvd2NtYiJdID0gMHgwMzI5OwogICAgICB0WyJ2ZXJ0aWNhbGxpbmVsb3dtb2QiXSA9IDB4MDJjYzsKICAgICAgdFsidmVydGljYWxsaW5lbW9kIl0gPSAweDAyYzg7CiAgICAgIHRbInZld2FybWVuaWFuIl0gPSAweDA1N2U7CiAgICAgIHRbInZob29rIl0gPSAweDAyOGI7CiAgICAgIHRbInZpa2F0YWthbmEiXSA9IDB4MzBmODsKICAgICAgdFsidmlyYW1hYmVuZ2FsaSJdID0gMHgwOWNkOwogICAgICB0WyJ2aXJhbWFkZXZhIl0gPSAweDA5NGQ7CiAgICAgIHRbInZpcmFtYWd1amFyYXRpIl0gPSAweDBhY2Q7CiAgICAgIHRbInZpc2FyZ2FiZW5nYWxpIl0gPSAweDA5ODM7CiAgICAgIHRbInZpc2FyZ2FkZXZhIl0gPSAweDA5MDM7CiAgICAgIHRbInZpc2FyZ2FndWphcmF0aSJdID0gMHgwYTgzOwogICAgICB0WyJ2bW9ub3NwYWNlIl0gPSAweGZmNTY7CiAgICAgIHRbInZvYXJtZW5pYW4iXSA9IDB4MDU3ODsKICAgICAgdFsidm9pY2VkaXRlcmF0aW9uaGlyYWdhbmEiXSA9IDB4MzA5ZTsKICAgICAgdFsidm9pY2VkaXRlcmF0aW9ua2F0YWthbmEiXSA9IDB4MzBmZTsKICAgICAgdFsidm9pY2VkbWFya2thbmEiXSA9IDB4MzA5YjsKICAgICAgdFsidm9pY2VkbWFya2thbmFoYWxmd2lkdGgiXSA9IDB4ZmY5ZTsKICAgICAgdFsidm9rYXRha2FuYSJdID0gMHgzMGZhOwogICAgICB0WyJ2cGFyZW4iXSA9IDB4MjRiMTsKICAgICAgdFsidnRpbGRlIl0gPSAweDFlN2Q7CiAgICAgIHRbInZ0dXJuZWQiXSA9IDB4MDI4YzsKICAgICAgdFsidnVoaXJhZ2FuYSJdID0gMHgzMDk0OwogICAgICB0WyJ2dWthdGFrYW5hIl0gPSAweDMwZjQ7CiAgICAgIHRbInciXSA9IDB4MDA3NzsKICAgICAgdFsid2FjdXRlIl0gPSAweDFlODM7CiAgICAgIHRbIndhZWtvcmVhbiJdID0gMHgzMTU5OwogICAgICB0WyJ3YWhpcmFnYW5hIl0gPSAweDMwOGY7CiAgICAgIHRbIndha2F0YWthbmEiXSA9IDB4MzBlZjsKICAgICAgdFsid2FrYXRha2FuYWhhbGZ3aWR0aCJdID0gMHhmZjljOwogICAgICB0WyJ3YWtvcmVhbiJdID0gMHgzMTU4OwogICAgICB0WyJ3YXNtYWxsaGlyYWdhbmEiXSA9IDB4MzA4ZTsKICAgICAgdFsid2FzbWFsbGthdGFrYW5hIl0gPSAweDMwZWU7CiAgICAgIHRbIndhdHRvc3F1YXJlIl0gPSAweDMzNTc7CiAgICAgIHRbIndhdmVkYXNoIl0gPSAweDMwMWM7CiAgICAgIHRbIndhdnl1bmRlcnNjb3JldmVydGljYWwiXSA9IDB4ZmUzNDsKICAgICAgdFsid2F3YXJhYmljIl0gPSAweDA2NDg7CiAgICAgIHRbIndhd2ZpbmFsYXJhYmljIl0gPSAweGZlZWU7CiAgICAgIHRbIndhd2hhbXphYWJvdmVhcmFiaWMiXSA9IDB4MDYyNDsKICAgICAgdFsid2F3aGFtemFhYm92ZWZpbmFsYXJhYmljIl0gPSAweGZlODY7CiAgICAgIHRbIndic3F1YXJlIl0gPSAweDMzZGQ7CiAgICAgIHRbIndjaXJjbGUiXSA9IDB4MjRlNjsKICAgICAgdFsid2NpcmN1bWZsZXgiXSA9IDB4MDE3NTsKICAgICAgdFsid2RpZXJlc2lzIl0gPSAweDFlODU7CiAgICAgIHRbIndkb3RhY2NlbnQiXSA9IDB4MWU4NzsKICAgICAgdFsid2RvdGJlbG93Il0gPSAweDFlODk7CiAgICAgIHRbIndlaGlyYWdhbmEiXSA9IDB4MzA5MTsKICAgICAgdFsid2VpZXJzdHJhc3MiXSA9IDB4MjExODsKICAgICAgdFsid2VrYXRha2FuYSJdID0gMHgzMGYxOwogICAgICB0WyJ3ZWtvcmVhbiJdID0gMHgzMTVlOwogICAgICB0WyJ3ZW9rb3JlYW4iXSA9IDB4MzE1ZDsKICAgICAgdFsid2dyYXZlIl0gPSAweDFlODE7CiAgICAgIHRbIndoaXRlYnVsbGV0Il0gPSAweDI1ZTY7CiAgICAgIHRbIndoaXRlY2lyY2xlIl0gPSAweDI1Y2I7CiAgICAgIHRbIndoaXRlY2lyY2xlaW52ZXJzZSJdID0gMHgyNWQ5OwogICAgICB0WyJ3aGl0ZWNvcm5lcmJyYWNrZXRsZWZ0Il0gPSAweDMwMGU7CiAgICAgIHRbIndoaXRlY29ybmVyYnJhY2tldGxlZnR2ZXJ0aWNhbCJdID0gMHhmZTQzOwogICAgICB0WyJ3aGl0ZWNvcm5lcmJyYWNrZXRyaWdodCJdID0gMHgzMDBmOwogICAgICB0WyJ3aGl0ZWNvcm5lcmJyYWNrZXRyaWdodHZlcnRpY2FsIl0gPSAweGZlNDQ7CiAgICAgIHRbIndoaXRlZGlhbW9uZCJdID0gMHgyNWM3OwogICAgICB0WyJ3aGl0ZWRpYW1vbmRjb250YWluaW5nYmxhY2tzbWFsbGRpYW1vbmQiXSA9IDB4MjVjODsKICAgICAgdFsid2hpdGVkb3ducG9pbnRpbmdzbWFsbHRyaWFuZ2xlIl0gPSAweDI1YmY7CiAgICAgIHRbIndoaXRlZG93bnBvaW50aW5ndHJpYW5nbGUiXSA9IDB4MjViZDsKICAgICAgdFsid2hpdGVsZWZ0cG9pbnRpbmdzbWFsbHRyaWFuZ2xlIl0gPSAweDI1YzM7CiAgICAgIHRbIndoaXRlbGVmdHBvaW50aW5ndHJpYW5nbGUiXSA9IDB4MjVjMTsKICAgICAgdFsid2hpdGVsZW50aWN1bGFyYnJhY2tldGxlZnQiXSA9IDB4MzAxNjsKICAgICAgdFsid2hpdGVsZW50aWN1bGFyYnJhY2tldHJpZ2h0Il0gPSAweDMwMTc7CiAgICAgIHRbIndoaXRlcmlnaHRwb2ludGluZ3NtYWxsdHJpYW5nbGUiXSA9IDB4MjViOTsKICAgICAgdFsid2hpdGVyaWdodHBvaW50aW5ndHJpYW5nbGUiXSA9IDB4MjViNzsKICAgICAgdFsid2hpdGVzbWFsbHNxdWFyZSJdID0gMHgyNWFiOwogICAgICB0WyJ3aGl0ZXNtaWxpbmdmYWNlIl0gPSAweDI2M2E7CiAgICAgIHRbIndoaXRlc3F1YXJlIl0gPSAweDI1YTE7CiAgICAgIHRbIndoaXRlc3RhciJdID0gMHgyNjA2OwogICAgICB0WyJ3aGl0ZXRlbGVwaG9uZSJdID0gMHgyNjBmOwogICAgICB0WyJ3aGl0ZXRvcnRvaXNlc2hlbGxicmFja2V0bGVmdCJdID0gMHgzMDE4OwogICAgICB0WyJ3aGl0ZXRvcnRvaXNlc2hlbGxicmFja2V0cmlnaHQiXSA9IDB4MzAxOTsKICAgICAgdFsid2hpdGV1cHBvaW50aW5nc21hbGx0cmlhbmdsZSJdID0gMHgyNWI1OwogICAgICB0WyJ3aGl0ZXVwcG9pbnRpbmd0cmlhbmdsZSJdID0gMHgyNWIzOwogICAgICB0WyJ3aWhpcmFnYW5hIl0gPSAweDMwOTA7CiAgICAgIHRbIndpa2F0YWthbmEiXSA9IDB4MzBmMDsKICAgICAgdFsid2lrb3JlYW4iXSA9IDB4MzE1ZjsKICAgICAgdFsid21vbm9zcGFjZSJdID0gMHhmZjU3OwogICAgICB0WyJ3b2hpcmFnYW5hIl0gPSAweDMwOTI7CiAgICAgIHRbIndva2F0YWthbmEiXSA9IDB4MzBmMjsKICAgICAgdFsid29rYXRha2FuYWhhbGZ3aWR0aCJdID0gMHhmZjY2OwogICAgICB0WyJ3b24iXSA9IDB4MjBhOTsKICAgICAgdFsid29ubW9ub3NwYWNlIl0gPSAweGZmZTY7CiAgICAgIHRbIndvd2FlbnRoYWkiXSA9IDB4MGUyNzsKICAgICAgdFsid3BhcmVuIl0gPSAweDI0YjI7CiAgICAgIHRbIndyaW5nIl0gPSAweDFlOTg7CiAgICAgIHRbIndzdXBlcmlvciJdID0gMHgwMmI3OwogICAgICB0WyJ3dHVybmVkIl0gPSAweDAyOGQ7CiAgICAgIHRbInd5bm4iXSA9IDB4MDFiZjsKICAgICAgdFsieCJdID0gMHgwMDc4OwogICAgICB0WyJ4YWJvdmVjbWIiXSA9IDB4MDMzZDsKICAgICAgdFsieGJvcG9tb2ZvIl0gPSAweDMxMTI7CiAgICAgIHRbInhjaXJjbGUiXSA9IDB4MjRlNzsKICAgICAgdFsieGRpZXJlc2lzIl0gPSAweDFlOGQ7CiAgICAgIHRbInhkb3RhY2NlbnQiXSA9IDB4MWU4YjsKICAgICAgdFsieGVoYXJtZW5pYW4iXSA9IDB4MDU2ZDsKICAgICAgdFsieGkiXSA9IDB4MDNiZTsKICAgICAgdFsieG1vbm9zcGFjZSJdID0gMHhmZjU4OwogICAgICB0WyJ4cGFyZW4iXSA9IDB4MjRiMzsKICAgICAgdFsieHN1cGVyaW9yIl0gPSAweDAyZTM7CiAgICAgIHRbInkiXSA9IDB4MDA3OTsKICAgICAgdFsieWFhZG9zcXVhcmUiXSA9IDB4MzM0ZTsKICAgICAgdFsieWFiZW5nYWxpIl0gPSAweDA5YWY7CiAgICAgIHRbInlhY3V0ZSJdID0gMHgwMGZkOwogICAgICB0WyJ5YWRldmEiXSA9IDB4MDkyZjsKICAgICAgdFsieWFla29yZWFuIl0gPSAweDMxNTI7CiAgICAgIHRbInlhZ3VqYXJhdGkiXSA9IDB4MGFhZjsKICAgICAgdFsieWFndXJtdWtoaSJdID0gMHgwYTJmOwogICAgICB0WyJ5YWhpcmFnYW5hIl0gPSAweDMwODQ7CiAgICAgIHRbInlha2F0YWthbmEiXSA9IDB4MzBlNDsKICAgICAgdFsieWFrYXRha2FuYWhhbGZ3aWR0aCJdID0gMHhmZjk0OwogICAgICB0WyJ5YWtvcmVhbiJdID0gMHgzMTUxOwogICAgICB0WyJ5YW1ha2thbnRoYWkiXSA9IDB4MGU0ZTsKICAgICAgdFsieWFzbWFsbGhpcmFnYW5hIl0gPSAweDMwODM7CiAgICAgIHRbInlhc21hbGxrYXRha2FuYSJdID0gMHgzMGUzOwogICAgICB0WyJ5YXNtYWxsa2F0YWthbmFoYWxmd2lkdGgiXSA9IDB4ZmY2YzsKICAgICAgdFsieWF0Y3lyaWxsaWMiXSA9IDB4MDQ2MzsKICAgICAgdFsieWNpcmNsZSJdID0gMHgyNGU4OwogICAgICB0WyJ5Y2lyY3VtZmxleCJdID0gMHgwMTc3OwogICAgICB0WyJ5ZGllcmVzaXMiXSA9IDB4MDBmZjsKICAgICAgdFsieWRvdGFjY2VudCJdID0gMHgxZThmOwogICAgICB0WyJ5ZG90YmVsb3ciXSA9IDB4MWVmNTsKICAgICAgdFsieWVoYXJhYmljIl0gPSAweDA2NGE7CiAgICAgIHRbInllaGJhcnJlZWFyYWJpYyJdID0gMHgwNmQyOwogICAgICB0WyJ5ZWhiYXJyZWVmaW5hbGFyYWJpYyJdID0gMHhmYmFmOwogICAgICB0WyJ5ZWhmaW5hbGFyYWJpYyJdID0gMHhmZWYyOwogICAgICB0WyJ5ZWhoYW16YWFib3ZlYXJhYmljIl0gPSAweDA2MjY7CiAgICAgIHRbInllaGhhbXphYWJvdmVmaW5hbGFyYWJpYyJdID0gMHhmZThhOwogICAgICB0WyJ5ZWhoYW16YWFib3ZlaW5pdGlhbGFyYWJpYyJdID0gMHhmZThiOwogICAgICB0WyJ5ZWhoYW16YWFib3ZlbWVkaWFsYXJhYmljIl0gPSAweGZlOGM7CiAgICAgIHRbInllaGluaXRpYWxhcmFiaWMiXSA9IDB4ZmVmMzsKICAgICAgdFsieWVobWVkaWFsYXJhYmljIl0gPSAweGZlZjQ7CiAgICAgIHRbInllaG1lZW1pbml0aWFsYXJhYmljIl0gPSAweGZjZGQ7CiAgICAgIHRbInllaG1lZW1pc29sYXRlZGFyYWJpYyJdID0gMHhmYzU4OwogICAgICB0WyJ5ZWhub29uZmluYWxhcmFiaWMiXSA9IDB4ZmM5NDsKICAgICAgdFsieWVodGhyZWVkb3RzYmVsb3dhcmFiaWMiXSA9IDB4MDZkMTsKICAgICAgdFsieWVrb3JlYW4iXSA9IDB4MzE1NjsKICAgICAgdFsieWVuIl0gPSAweDAwYTU7CiAgICAgIHRbInllbm1vbm9zcGFjZSJdID0gMHhmZmU1OwogICAgICB0WyJ5ZW9rb3JlYW4iXSA9IDB4MzE1NTsKICAgICAgdFsieWVvcmluaGlldWhrb3JlYW4iXSA9IDB4MzE4NjsKICAgICAgdFsieWVyYWhiZW55b21vaGVicmV3Il0gPSAweDA1YWE7CiAgICAgIHRbInllcmFoYmVueW9tb2xlZnRoZWJyZXciXSA9IDB4MDVhYTsKICAgICAgdFsieWVyaWN5cmlsbGljIl0gPSAweDA0NGI7CiAgICAgIHRbInllcnVkaWVyZXNpc2N5cmlsbGljIl0gPSAweDA0Zjk7CiAgICAgIHRbInllc2lldW5na29yZWFuIl0gPSAweDMxODE7CiAgICAgIHRbInllc2lldW5ncGFuc2lvc2tvcmVhbiJdID0gMHgzMTgzOwogICAgICB0WyJ5ZXNpZXVuZ3Npb3Nrb3JlYW4iXSA9IDB4MzE4MjsKICAgICAgdFsieWV0aXZoZWJyZXciXSA9IDB4MDU5YTsKICAgICAgdFsieWdyYXZlIl0gPSAweDFlZjM7CiAgICAgIHRbInlob29rIl0gPSAweDAxYjQ7CiAgICAgIHRbInlob29rYWJvdmUiXSA9IDB4MWVmNzsKICAgICAgdFsieWlhcm1lbmlhbiJdID0gMHgwNTc1OwogICAgICB0WyJ5aWN5cmlsbGljIl0gPSAweDA0NTc7CiAgICAgIHRbInlpa29yZWFuIl0gPSAweDMxNjI7CiAgICAgIHRbInlpbnlhbmciXSA9IDB4MjYyZjsKICAgICAgdFsieWl3bmFybWVuaWFuIl0gPSAweDA1ODI7CiAgICAgIHRbInltb25vc3BhY2UiXSA9IDB4ZmY1OTsKICAgICAgdFsieW9kIl0gPSAweDA1ZDk7CiAgICAgIHRbInlvZGRhZ2VzaCJdID0gMHhmYjM5OwogICAgICB0WyJ5b2RkYWdlc2hoZWJyZXciXSA9IDB4ZmIzOTsKICAgICAgdFsieW9kaGVicmV3Il0gPSAweDA1ZDk7CiAgICAgIHRbInlvZHlvZGhlYnJldyJdID0gMHgwNWYyOwogICAgICB0WyJ5b2R5b2RwYXRhaGhlYnJldyJdID0gMHhmYjFmOwogICAgICB0WyJ5b2hpcmFnYW5hIl0gPSAweDMwODg7CiAgICAgIHRbInlvaWtvcmVhbiJdID0gMHgzMTg5OwogICAgICB0WyJ5b2thdGFrYW5hIl0gPSAweDMwZTg7CiAgICAgIHRbInlva2F0YWthbmFoYWxmd2lkdGgiXSA9IDB4ZmY5NjsKICAgICAgdFsieW9rb3JlYW4iXSA9IDB4MzE1YjsKICAgICAgdFsieW9zbWFsbGhpcmFnYW5hIl0gPSAweDMwODc7CiAgICAgIHRbInlvc21hbGxrYXRha2FuYSJdID0gMHgzMGU3OwogICAgICB0WyJ5b3NtYWxsa2F0YWthbmFoYWxmd2lkdGgiXSA9IDB4ZmY2ZTsKICAgICAgdFsieW90Z3JlZWsiXSA9IDB4MDNmMzsKICAgICAgdFsieW95YWVrb3JlYW4iXSA9IDB4MzE4ODsKICAgICAgdFsieW95YWtvcmVhbiJdID0gMHgzMTg3OwogICAgICB0WyJ5b3lha3RoYWkiXSA9IDB4MGUyMjsKICAgICAgdFsieW95aW5ndGhhaSJdID0gMHgwZTBkOwogICAgICB0WyJ5cGFyZW4iXSA9IDB4MjRiNDsKICAgICAgdFsieXBvZ2VncmFtbWVuaSJdID0gMHgwMzdhOwogICAgICB0WyJ5cG9nZWdyYW1tZW5pZ3JlZWtjbWIiXSA9IDB4MDM0NTsKICAgICAgdFsieXIiXSA9IDB4MDFhNjsKICAgICAgdFsieXJpbmciXSA9IDB4MWU5OTsKICAgICAgdFsieXN1cGVyaW9yIl0gPSAweDAyYjg7CiAgICAgIHRbInl0aWxkZSJdID0gMHgxZWY5OwogICAgICB0WyJ5dHVybmVkIl0gPSAweDAyOGU7CiAgICAgIHRbInl1aGlyYWdhbmEiXSA9IDB4MzA4NjsKICAgICAgdFsieXVpa29yZWFuIl0gPSAweDMxOGM7CiAgICAgIHRbInl1a2F0YWthbmEiXSA9IDB4MzBlNjsKICAgICAgdFsieXVrYXRha2FuYWhhbGZ3aWR0aCJdID0gMHhmZjk1OwogICAgICB0WyJ5dWtvcmVhbiJdID0gMHgzMTYwOwogICAgICB0WyJ5dXNiaWdjeXJpbGxpYyJdID0gMHgwNDZiOwogICAgICB0WyJ5dXNiaWdpb3RpZmllZGN5cmlsbGljIl0gPSAweDA0NmQ7CiAgICAgIHRbInl1c2xpdHRsZWN5cmlsbGljIl0gPSAweDA0Njc7CiAgICAgIHRbInl1c2xpdHRsZWlvdGlmaWVkY3lyaWxsaWMiXSA9IDB4MDQ2OTsKICAgICAgdFsieXVzbWFsbGhpcmFnYW5hIl0gPSAweDMwODU7CiAgICAgIHRbInl1c21hbGxrYXRha2FuYSJdID0gMHgzMGU1OwogICAgICB0WyJ5dXNtYWxsa2F0YWthbmFoYWxmd2lkdGgiXSA9IDB4ZmY2ZDsKICAgICAgdFsieXV5ZWtvcmVhbiJdID0gMHgzMThiOwogICAgICB0WyJ5dXllb2tvcmVhbiJdID0gMHgzMThhOwogICAgICB0WyJ5eWFiZW5nYWxpIl0gPSAweDA5ZGY7CiAgICAgIHRbInl5YWRldmEiXSA9IDB4MDk1ZjsKICAgICAgdFsieiJdID0gMHgwMDdhOwogICAgICB0WyJ6YWFybWVuaWFuIl0gPSAweDA1NjY7CiAgICAgIHRbInphY3V0ZSJdID0gMHgwMTdhOwogICAgICB0WyJ6YWRldmEiXSA9IDB4MDk1YjsKICAgICAgdFsiemFndXJtdWtoaSJdID0gMHgwYTViOwogICAgICB0WyJ6YWhhcmFiaWMiXSA9IDB4MDYzODsKICAgICAgdFsiemFoZmluYWxhcmFiaWMiXSA9IDB4ZmVjNjsKICAgICAgdFsiemFoaW5pdGlhbGFyYWJpYyJdID0gMHhmZWM3OwogICAgICB0WyJ6YWhpcmFnYW5hIl0gPSAweDMwNTY7CiAgICAgIHRbInphaG1lZGlhbGFyYWJpYyJdID0gMHhmZWM4OwogICAgICB0WyJ6YWluYXJhYmljIl0gPSAweDA2MzI7CiAgICAgIHRbInphaW5maW5hbGFyYWJpYyJdID0gMHhmZWIwOwogICAgICB0WyJ6YWthdGFrYW5hIl0gPSAweDMwYjY7CiAgICAgIHRbInphcWVmZ2Fkb2xoZWJyZXciXSA9IDB4MDU5NTsKICAgICAgdFsiemFxZWZxYXRhbmhlYnJldyJdID0gMHgwNTk0OwogICAgICB0WyJ6YXJxYWhlYnJldyJdID0gMHgwNTk4OwogICAgICB0WyJ6YXlpbiJdID0gMHgwNWQ2OwogICAgICB0WyJ6YXlpbmRhZ2VzaCJdID0gMHhmYjM2OwogICAgICB0WyJ6YXlpbmRhZ2VzaGhlYnJldyJdID0gMHhmYjM2OwogICAgICB0WyJ6YXlpbmhlYnJldyJdID0gMHgwNWQ2OwogICAgICB0WyJ6Ym9wb21vZm8iXSA9IDB4MzExNzsKICAgICAgdFsiemNhcm9uIl0gPSAweDAxN2U7CiAgICAgIHRbInpjaXJjbGUiXSA9IDB4MjRlOTsKICAgICAgdFsiemNpcmN1bWZsZXgiXSA9IDB4MWU5MTsKICAgICAgdFsiemN1cmwiXSA9IDB4MDI5MTsKICAgICAgdFsiemRvdCJdID0gMHgwMTdjOwogICAgICB0WyJ6ZG90YWNjZW50Il0gPSAweDAxN2M7CiAgICAgIHRbInpkb3RiZWxvdyJdID0gMHgxZTkzOwogICAgICB0WyJ6ZWN5cmlsbGljIl0gPSAweDA0Mzc7CiAgICAgIHRbInplZGVzY2VuZGVyY3lyaWxsaWMiXSA9IDB4MDQ5OTsKICAgICAgdFsiemVkaWVyZXNpc2N5cmlsbGljIl0gPSAweDA0ZGY7CiAgICAgIHRbInplaGlyYWdhbmEiXSA9IDB4MzA1YzsKICAgICAgdFsiemVrYXRha2FuYSJdID0gMHgzMGJjOwogICAgICB0WyJ6ZXJvIl0gPSAweDAwMzA7CiAgICAgIHRbInplcm9hcmFiaWMiXSA9IDB4MDY2MDsKICAgICAgdFsiemVyb2JlbmdhbGkiXSA9IDB4MDllNjsKICAgICAgdFsiemVyb2RldmEiXSA9IDB4MDk2NjsKICAgICAgdFsiemVyb2d1amFyYXRpIl0gPSAweDBhZTY7CiAgICAgIHRbInplcm9ndXJtdWtoaSJdID0gMHgwYTY2OwogICAgICB0WyJ6ZXJvaGFja2FyYWJpYyJdID0gMHgwNjYwOwogICAgICB0WyJ6ZXJvaW5mZXJpb3IiXSA9IDB4MjA4MDsKICAgICAgdFsiemVyb21vbm9zcGFjZSJdID0gMHhmZjEwOwogICAgICB0WyJ6ZXJvb2xkc3R5bGUiXSA9IDB4ZjczMDsKICAgICAgdFsiemVyb3BlcnNpYW4iXSA9IDB4MDZmMDsKICAgICAgdFsiemVyb3N1cGVyaW9yIl0gPSAweDIwNzA7CiAgICAgIHRbInplcm90aGFpIl0gPSAweDBlNTA7CiAgICAgIHRbInplcm93aWR0aGpvaW5lciJdID0gMHhmZWZmOwogICAgICB0WyJ6ZXJvd2lkdGhub25qb2luZXIiXSA9IDB4MjAwYzsKICAgICAgdFsiemVyb3dpZHRoc3BhY2UiXSA9IDB4MjAwYjsKICAgICAgdFsiemV0YSJdID0gMHgwM2I2OwogICAgICB0WyJ6aGJvcG9tb2ZvIl0gPSAweDMxMTM7CiAgICAgIHRbInpoZWFybWVuaWFuIl0gPSAweDA1NmE7CiAgICAgIHRbInpoZWJyZXZlY3lyaWxsaWMiXSA9IDB4MDRjMjsKICAgICAgdFsiemhlY3lyaWxsaWMiXSA9IDB4MDQzNjsKICAgICAgdFsiemhlZGVzY2VuZGVyY3lyaWxsaWMiXSA9IDB4MDQ5NzsKICAgICAgdFsiemhlZGllcmVzaXNjeXJpbGxpYyJdID0gMHgwNGRkOwogICAgICB0WyJ6aWhpcmFnYW5hIl0gPSAweDMwNTg7CiAgICAgIHRbInppa2F0YWthbmEiXSA9IDB4MzBiODsKICAgICAgdFsiemlub3JoZWJyZXciXSA9IDB4MDVhZTsKICAgICAgdFsiemxpbmViZWxvdyJdID0gMHgxZTk1OwogICAgICB0WyJ6bW9ub3NwYWNlIl0gPSAweGZmNWE7CiAgICAgIHRbInpvaGlyYWdhbmEiXSA9IDB4MzA1ZTsKICAgICAgdFsiem9rYXRha2FuYSJdID0gMHgzMGJlOwogICAgICB0WyJ6cGFyZW4iXSA9IDB4MjRiNTsKICAgICAgdFsienJldHJvZmxleGhvb2siXSA9IDB4MDI5MDsKICAgICAgdFsienN0cm9rZSJdID0gMHgwMWI2OwogICAgICB0WyJ6dWhpcmFnYW5hIl0gPSAweDMwNWE7CiAgICAgIHRbInp1a2F0YWthbmEiXSA9IDB4MzBiYTsKICAgICAgdFsiLm5vdGRlZiJdID0gMHgwMDAwOwogICAgICB0WyJhbmdicmFja2V0bGVmdGJpZyJdID0gMHgyMzI5OwogICAgICB0WyJhbmdicmFja2V0bGVmdEJpZyJdID0gMHgyMzI5OwogICAgICB0WyJhbmdicmFja2V0bGVmdGJpZ2ciXSA9IDB4MjMyOTsKICAgICAgdFsiYW5nYnJhY2tldGxlZnRCaWdnIl0gPSAweDIzMjk7CiAgICAgIHRbImFuZ2JyYWNrZXRyaWdodEJpZyJdID0gMHgyMzJhOwogICAgICB0WyJhbmdicmFja2V0cmlnaHRiaWciXSA9IDB4MjMyYTsKICAgICAgdFsiYW5nYnJhY2tldHJpZ2h0QmlnZyJdID0gMHgyMzJhOwogICAgICB0WyJhbmdicmFja2V0cmlnaHRiaWdnIl0gPSAweDIzMmE7CiAgICAgIHRbImFycm93aG9va2xlZnQiXSA9IDB4MjFhYTsKICAgICAgdFsiYXJyb3dob29rcmlnaHQiXSA9IDB4MjFhOTsKICAgICAgdFsiYXJyb3dsZWZ0dG9waGFsZiJdID0gMHgyMWJjOwogICAgICB0WyJhcnJvd2xlZnRib3RoYWxmIl0gPSAweDIxYmQ7CiAgICAgIHRbImFycm93bm9ydGhlYXN0Il0gPSAweDIxOTc7CiAgICAgIHRbImFycm93bm9ydGh3ZXN0Il0gPSAweDIxOTY7CiAgICAgIHRbImFycm93cmlnaHR0b3BoYWxmIl0gPSAweDIxYzA7CiAgICAgIHRbImFycm93cmlnaHRib3RoYWxmIl0gPSAweDIxYzE7CiAgICAgIHRbImFycm93c291dGhlYXN0Il0gPSAweDIxOTg7CiAgICAgIHRbImFycm93c291dGh3ZXN0Il0gPSAweDIxOTk7CiAgICAgIHRbImJhY2tzbGFzaGJpZyJdID0gMHgyMjE2OwogICAgICB0WyJiYWNrc2xhc2hCaWciXSA9IDB4MjIxNjsKICAgICAgdFsiYmFja3NsYXNoQmlnZyJdID0gMHgyMjE2OwogICAgICB0WyJiYWNrc2xhc2hiaWdnIl0gPSAweDIyMTY7CiAgICAgIHRbImJhcmRibCJdID0gMHgyMDE2OwogICAgICB0WyJicmFjZWh0aXBkb3dubGVmdCJdID0gMHhmZTM3OwogICAgICB0WyJicmFjZWh0aXBkb3ducmlnaHQiXSA9IDB4ZmUzNzsKICAgICAgdFsiYnJhY2VodGlwdXBsZWZ0Il0gPSAweGZlMzg7CiAgICAgIHRbImJyYWNlaHRpcHVwcmlnaHQiXSA9IDB4ZmUzODsKICAgICAgdFsiYnJhY2VsZWZ0QmlnIl0gPSAweDAwN2I7CiAgICAgIHRbImJyYWNlbGVmdGJpZyJdID0gMHgwMDdiOwogICAgICB0WyJicmFjZWxlZnRiaWdnIl0gPSAweDAwN2I7CiAgICAgIHRbImJyYWNlbGVmdEJpZ2ciXSA9IDB4MDA3YjsKICAgICAgdFsiYnJhY2VyaWdodEJpZyJdID0gMHgwMDdkOwogICAgICB0WyJicmFjZXJpZ2h0YmlnIl0gPSAweDAwN2Q7CiAgICAgIHRbImJyYWNlcmlnaHRiaWdnIl0gPSAweDAwN2Q7CiAgICAgIHRbImJyYWNlcmlnaHRCaWdnIl0gPSAweDAwN2Q7CiAgICAgIHRbImJyYWNrZXRsZWZ0YmlnIl0gPSAweDAwNWI7CiAgICAgIHRbImJyYWNrZXRsZWZ0QmlnIl0gPSAweDAwNWI7CiAgICAgIHRbImJyYWNrZXRsZWZ0YmlnZyJdID0gMHgwMDViOwogICAgICB0WyJicmFja2V0bGVmdEJpZ2ciXSA9IDB4MDA1YjsKICAgICAgdFsiYnJhY2tldHJpZ2h0QmlnIl0gPSAweDAwNWQ7CiAgICAgIHRbImJyYWNrZXRyaWdodGJpZyJdID0gMHgwMDVkOwogICAgICB0WyJicmFja2V0cmlnaHRiaWdnIl0gPSAweDAwNWQ7CiAgICAgIHRbImJyYWNrZXRyaWdodEJpZ2ciXSA9IDB4MDA1ZDsKICAgICAgdFsiY2VpbGluZ2xlZnRiaWciXSA9IDB4MjMwODsKICAgICAgdFsiY2VpbGluZ2xlZnRCaWciXSA9IDB4MjMwODsKICAgICAgdFsiY2VpbGluZ2xlZnRCaWdnIl0gPSAweDIzMDg7CiAgICAgIHRbImNlaWxpbmdsZWZ0YmlnZyJdID0gMHgyMzA4OwogICAgICB0WyJjZWlsaW5ncmlnaHRiaWciXSA9IDB4MjMwOTsKICAgICAgdFsiY2VpbGluZ3JpZ2h0QmlnIl0gPSAweDIzMDk7CiAgICAgIHRbImNlaWxpbmdyaWdodGJpZ2ciXSA9IDB4MjMwOTsKICAgICAgdFsiY2VpbGluZ3JpZ2h0QmlnZyJdID0gMHgyMzA5OwogICAgICB0WyJjaXJjbGVkb3RkaXNwbGF5Il0gPSAweDIyOTk7CiAgICAgIHRbImNpcmNsZWRvdHRleHQiXSA9IDB4MjI5OTsKICAgICAgdFsiY2lyY2xlbXVsdGlwbHlkaXNwbGF5Il0gPSAweDIyOTc7CiAgICAgIHRbImNpcmNsZW11bHRpcGx5dGV4dCJdID0gMHgyMjk3OwogICAgICB0WyJjaXJjbGVwbHVzZGlzcGxheSJdID0gMHgyMjk1OwogICAgICB0WyJjaXJjbGVwbHVzdGV4dCJdID0gMHgyMjk1OwogICAgICB0WyJjb250aW50ZWdyYWxkaXNwbGF5Il0gPSAweDIyMmU7CiAgICAgIHRbImNvbnRpbnRlZ3JhbHRleHQiXSA9IDB4MjIyZTsKICAgICAgdFsiY29wcm9kdWN0ZGlzcGxheSJdID0gMHgyMjEwOwogICAgICB0WyJjb3Byb2R1Y3R0ZXh0Il0gPSAweDIyMTA7CiAgICAgIHRbImZsb29ybGVmdEJpZyJdID0gMHgyMzBhOwogICAgICB0WyJmbG9vcmxlZnRiaWciXSA9IDB4MjMwYTsKICAgICAgdFsiZmxvb3JsZWZ0YmlnZyJdID0gMHgyMzBhOwogICAgICB0WyJmbG9vcmxlZnRCaWdnIl0gPSAweDIzMGE7CiAgICAgIHRbImZsb29ycmlnaHRiaWciXSA9IDB4MjMwYjsKICAgICAgdFsiZmxvb3JyaWdodEJpZyJdID0gMHgyMzBiOwogICAgICB0WyJmbG9vcnJpZ2h0QmlnZyJdID0gMHgyMzBiOwogICAgICB0WyJmbG9vcnJpZ2h0YmlnZyJdID0gMHgyMzBiOwogICAgICB0WyJoYXR3aWRlIl0gPSAweDAzMDI7CiAgICAgIHRbImhhdHdpZGVyIl0gPSAweDAzMDI7CiAgICAgIHRbImhhdHdpZGVzdCJdID0gMHgwMzAyOwogICAgICB0WyJpbnRlcmNhbCJdID0gMHgxZDQwOwogICAgICB0WyJpbnRlZ3JhbGRpc3BsYXkiXSA9IDB4MjIyYjsKICAgICAgdFsiaW50ZWdyYWx0ZXh0Il0gPSAweDIyMmI7CiAgICAgIHRbImludGVyc2VjdGlvbmRpc3BsYXkiXSA9IDB4MjJjMjsKICAgICAgdFsiaW50ZXJzZWN0aW9udGV4dCJdID0gMHgyMmMyOwogICAgICB0WyJsb2dpY2FsYW5kZGlzcGxheSJdID0gMHgyMjI3OwogICAgICB0WyJsb2dpY2FsYW5kdGV4dCJdID0gMHgyMjI3OwogICAgICB0WyJsb2dpY2Fsb3JkaXNwbGF5Il0gPSAweDIyMjg7CiAgICAgIHRbImxvZ2ljYWxvcnRleHQiXSA9IDB4MjIyODsKICAgICAgdFsicGFyZW5sZWZ0QmlnIl0gPSAweDAwMjg7CiAgICAgIHRbInBhcmVubGVmdGJpZyJdID0gMHgwMDI4OwogICAgICB0WyJwYXJlbmxlZnRCaWdnIl0gPSAweDAwMjg7CiAgICAgIHRbInBhcmVubGVmdGJpZ2ciXSA9IDB4MDAyODsKICAgICAgdFsicGFyZW5yaWdodEJpZyJdID0gMHgwMDI5OwogICAgICB0WyJwYXJlbnJpZ2h0YmlnIl0gPSAweDAwMjk7CiAgICAgIHRbInBhcmVucmlnaHRCaWdnIl0gPSAweDAwMjk7CiAgICAgIHRbInBhcmVucmlnaHRiaWdnIl0gPSAweDAwMjk7CiAgICAgIHRbInByaW1lIl0gPSAweDIwMzI7CiAgICAgIHRbInByb2R1Y3RkaXNwbGF5Il0gPSAweDIyMGY7CiAgICAgIHRbInByb2R1Y3R0ZXh0Il0gPSAweDIyMGY7CiAgICAgIHRbInJhZGljYWxiaWciXSA9IDB4MjIxYTsKICAgICAgdFsicmFkaWNhbEJpZyJdID0gMHgyMjFhOwogICAgICB0WyJyYWRpY2FsQmlnZyJdID0gMHgyMjFhOwogICAgICB0WyJyYWRpY2FsYmlnZyJdID0gMHgyMjFhOwogICAgICB0WyJyYWRpY2FsYnQiXSA9IDB4MjIxYTsKICAgICAgdFsicmFkaWNhbHRwIl0gPSAweDIyMWE7CiAgICAgIHRbInJhZGljYWx2ZXJ0ZXgiXSA9IDB4MjIxYTsKICAgICAgdFsic2xhc2hiaWciXSA9IDB4MDAyZjsKICAgICAgdFsic2xhc2hCaWciXSA9IDB4MDAyZjsKICAgICAgdFsic2xhc2hCaWdnIl0gPSAweDAwMmY7CiAgICAgIHRbInNsYXNoYmlnZyJdID0gMHgwMDJmOwogICAgICB0WyJzdW1tYXRpb25kaXNwbGF5Il0gPSAweDIyMTE7CiAgICAgIHRbInN1bW1hdGlvbnRleHQiXSA9IDB4MjIxMTsKICAgICAgdFsidGlsZGV3aWRlIl0gPSAweDAyZGM7CiAgICAgIHRbInRpbGRld2lkZXIiXSA9IDB4MDJkYzsKICAgICAgdFsidGlsZGV3aWRlc3QiXSA9IDB4MDJkYzsKICAgICAgdFsidW5pb25kaXNwbGF5Il0gPSAweDIyYzM7CiAgICAgIHRbInVuaW9ubXVsdGlkaXNwbGF5Il0gPSAweDIyOGU7CiAgICAgIHRbInVuaW9ubXVsdGl0ZXh0Il0gPSAweDIyOGU7CiAgICAgIHRbInVuaW9uc3FkaXNwbGF5Il0gPSAweDIyOTQ7CiAgICAgIHRbInVuaW9uc3F0ZXh0Il0gPSAweDIyOTQ7CiAgICAgIHRbInVuaW9udGV4dCJdID0gMHgyMmMzOwogICAgICB0WyJ2ZXh0ZW5kZG91YmxlIl0gPSAweDIyMjU7CiAgICAgIHRbInZleHRlbmRzaW5nbGUiXSA9IDB4MjIyMzsKICAgIH0pOwogICAgdmFyIGdldERpbmdiYXRzR2x5cGhzVW5pY29kZSA9IGdldExvb2t1cFRhYmxlRmFjdG9yeShmdW5jdGlvbiAodCkgewogICAgICB0WyJzcGFjZSJdID0gMHgwMDIwOwogICAgICB0WyJhMSJdID0gMHgyNzAxOwogICAgICB0WyJhMiJdID0gMHgyNzAyOwogICAgICB0WyJhMjAyIl0gPSAweDI3MDM7CiAgICAgIHRbImEzIl0gPSAweDI3MDQ7CiAgICAgIHRbImE0Il0gPSAweDI2MGU7CiAgICAgIHRbImE1Il0gPSAweDI3MDY7CiAgICAgIHRbImExMTkiXSA9IDB4MjcwNzsKICAgICAgdFsiYTExOCJdID0gMHgyNzA4OwogICAgICB0WyJhMTE3Il0gPSAweDI3MDk7CiAgICAgIHRbImExMSJdID0gMHgyNjFiOwogICAgICB0WyJhMTIiXSA9IDB4MjYxZTsKICAgICAgdFsiYTEzIl0gPSAweDI3MGM7CiAgICAgIHRbImExNCJdID0gMHgyNzBkOwogICAgICB0WyJhMTUiXSA9IDB4MjcwZTsKICAgICAgdFsiYTE2Il0gPSAweDI3MGY7CiAgICAgIHRbImExMDUiXSA9IDB4MjcxMDsKICAgICAgdFsiYTE3Il0gPSAweDI3MTE7CiAgICAgIHRbImExOCJdID0gMHgyNzEyOwogICAgICB0WyJhMTkiXSA9IDB4MjcxMzsKICAgICAgdFsiYTIwIl0gPSAweDI3MTQ7CiAgICAgIHRbImEyMSJdID0gMHgyNzE1OwogICAgICB0WyJhMjIiXSA9IDB4MjcxNjsKICAgICAgdFsiYTIzIl0gPSAweDI3MTc7CiAgICAgIHRbImEyNCJdID0gMHgyNzE4OwogICAgICB0WyJhMjUiXSA9IDB4MjcxOTsKICAgICAgdFsiYTI2Il0gPSAweDI3MWE7CiAgICAgIHRbImEyNyJdID0gMHgyNzFiOwogICAgICB0WyJhMjgiXSA9IDB4MjcxYzsKICAgICAgdFsiYTYiXSA9IDB4MjcxZDsKICAgICAgdFsiYTciXSA9IDB4MjcxZTsKICAgICAgdFsiYTgiXSA9IDB4MjcxZjsKICAgICAgdFsiYTkiXSA9IDB4MjcyMDsKICAgICAgdFsiYTEwIl0gPSAweDI3MjE7CiAgICAgIHRbImEyOSJdID0gMHgyNzIyOwogICAgICB0WyJhMzAiXSA9IDB4MjcyMzsKICAgICAgdFsiYTMxIl0gPSAweDI3MjQ7CiAgICAgIHRbImEzMiJdID0gMHgyNzI1OwogICAgICB0WyJhMzMiXSA9IDB4MjcyNjsKICAgICAgdFsiYTM0Il0gPSAweDI3Mjc7CiAgICAgIHRbImEzNSJdID0gMHgyNjA1OwogICAgICB0WyJhMzYiXSA9IDB4MjcyOTsKICAgICAgdFsiYTM3Il0gPSAweDI3MmE7CiAgICAgIHRbImEzOCJdID0gMHgyNzJiOwogICAgICB0WyJhMzkiXSA9IDB4MjcyYzsKICAgICAgdFsiYTQwIl0gPSAweDI3MmQ7CiAgICAgIHRbImE0MSJdID0gMHgyNzJlOwogICAgICB0WyJhNDIiXSA9IDB4MjcyZjsKICAgICAgdFsiYTQzIl0gPSAweDI3MzA7CiAgICAgIHRbImE0NCJdID0gMHgyNzMxOwogICAgICB0WyJhNDUiXSA9IDB4MjczMjsKICAgICAgdFsiYTQ2Il0gPSAweDI3MzM7CiAgICAgIHRbImE0NyJdID0gMHgyNzM0OwogICAgICB0WyJhNDgiXSA9IDB4MjczNTsKICAgICAgdFsiYTQ5Il0gPSAweDI3MzY7CiAgICAgIHRbImE1MCJdID0gMHgyNzM3OwogICAgICB0WyJhNTEiXSA9IDB4MjczODsKICAgICAgdFsiYTUyIl0gPSAweDI3Mzk7CiAgICAgIHRbImE1MyJdID0gMHgyNzNhOwogICAgICB0WyJhNTQiXSA9IDB4MjczYjsKICAgICAgdFsiYTU1Il0gPSAweDI3M2M7CiAgICAgIHRbImE1NiJdID0gMHgyNzNkOwogICAgICB0WyJhNTciXSA9IDB4MjczZTsKICAgICAgdFsiYTU4Il0gPSAweDI3M2Y7CiAgICAgIHRbImE1OSJdID0gMHgyNzQwOwogICAgICB0WyJhNjAiXSA9IDB4Mjc0MTsKICAgICAgdFsiYTYxIl0gPSAweDI3NDI7CiAgICAgIHRbImE2MiJdID0gMHgyNzQzOwogICAgICB0WyJhNjMiXSA9IDB4Mjc0NDsKICAgICAgdFsiYTY0Il0gPSAweDI3NDU7CiAgICAgIHRbImE2NSJdID0gMHgyNzQ2OwogICAgICB0WyJhNjYiXSA9IDB4Mjc0NzsKICAgICAgdFsiYTY3Il0gPSAweDI3NDg7CiAgICAgIHRbImE2OCJdID0gMHgyNzQ5OwogICAgICB0WyJhNjkiXSA9IDB4Mjc0YTsKICAgICAgdFsiYTcwIl0gPSAweDI3NGI7CiAgICAgIHRbImE3MSJdID0gMHgyNWNmOwogICAgICB0WyJhNzIiXSA9IDB4Mjc0ZDsKICAgICAgdFsiYTczIl0gPSAweDI1YTA7CiAgICAgIHRbImE3NCJdID0gMHgyNzRmOwogICAgICB0WyJhMjAzIl0gPSAweDI3NTA7CiAgICAgIHRbImE3NSJdID0gMHgyNzUxOwogICAgICB0WyJhMjA0Il0gPSAweDI3NTI7CiAgICAgIHRbImE3NiJdID0gMHgyNWIyOwogICAgICB0WyJhNzciXSA9IDB4MjViYzsKICAgICAgdFsiYTc4Il0gPSAweDI1YzY7CiAgICAgIHRbImE3OSJdID0gMHgyNzU2OwogICAgICB0WyJhODEiXSA9IDB4MjVkNzsKICAgICAgdFsiYTgyIl0gPSAweDI3NTg7CiAgICAgIHRbImE4MyJdID0gMHgyNzU5OwogICAgICB0WyJhODQiXSA9IDB4Mjc1YTsKICAgICAgdFsiYTk3Il0gPSAweDI3NWI7CiAgICAgIHRbImE5OCJdID0gMHgyNzVjOwogICAgICB0WyJhOTkiXSA9IDB4Mjc1ZDsKICAgICAgdFsiYTEwMCJdID0gMHgyNzVlOwogICAgICB0WyJhMTAxIl0gPSAweDI3NjE7CiAgICAgIHRbImExMDIiXSA9IDB4Mjc2MjsKICAgICAgdFsiYTEwMyJdID0gMHgyNzYzOwogICAgICB0WyJhMTA0Il0gPSAweDI3NjQ7CiAgICAgIHRbImExMDYiXSA9IDB4Mjc2NTsKICAgICAgdFsiYTEwNyJdID0gMHgyNzY2OwogICAgICB0WyJhMTA4Il0gPSAweDI3Njc7CiAgICAgIHRbImExMTIiXSA9IDB4MjY2MzsKICAgICAgdFsiYTExMSJdID0gMHgyNjY2OwogICAgICB0WyJhMTEwIl0gPSAweDI2NjU7CiAgICAgIHRbImExMDkiXSA9IDB4MjY2MDsKICAgICAgdFsiYTEyMCJdID0gMHgyNDYwOwogICAgICB0WyJhMTIxIl0gPSAweDI0NjE7CiAgICAgIHRbImExMjIiXSA9IDB4MjQ2MjsKICAgICAgdFsiYTEyMyJdID0gMHgyNDYzOwogICAgICB0WyJhMTI0Il0gPSAweDI0NjQ7CiAgICAgIHRbImExMjUiXSA9IDB4MjQ2NTsKICAgICAgdFsiYTEyNiJdID0gMHgyNDY2OwogICAgICB0WyJhMTI3Il0gPSAweDI0Njc7CiAgICAgIHRbImExMjgiXSA9IDB4MjQ2ODsKICAgICAgdFsiYTEyOSJdID0gMHgyNDY5OwogICAgICB0WyJhMTMwIl0gPSAweDI3NzY7CiAgICAgIHRbImExMzEiXSA9IDB4Mjc3NzsKICAgICAgdFsiYTEzMiJdID0gMHgyNzc4OwogICAgICB0WyJhMTMzIl0gPSAweDI3Nzk7CiAgICAgIHRbImExMzQiXSA9IDB4Mjc3YTsKICAgICAgdFsiYTEzNSJdID0gMHgyNzdiOwogICAgICB0WyJhMTM2Il0gPSAweDI3N2M7CiAgICAgIHRbImExMzciXSA9IDB4Mjc3ZDsKICAgICAgdFsiYTEzOCJdID0gMHgyNzdlOwogICAgICB0WyJhMTM5Il0gPSAweDI3N2Y7CiAgICAgIHRbImExNDAiXSA9IDB4Mjc4MDsKICAgICAgdFsiYTE0MSJdID0gMHgyNzgxOwogICAgICB0WyJhMTQyIl0gPSAweDI3ODI7CiAgICAgIHRbImExNDMiXSA9IDB4Mjc4MzsKICAgICAgdFsiYTE0NCJdID0gMHgyNzg0OwogICAgICB0WyJhMTQ1Il0gPSAweDI3ODU7CiAgICAgIHRbImExNDYiXSA9IDB4Mjc4NjsKICAgICAgdFsiYTE0NyJdID0gMHgyNzg3OwogICAgICB0WyJhMTQ4Il0gPSAweDI3ODg7CiAgICAgIHRbImExNDkiXSA9IDB4Mjc4OTsKICAgICAgdFsiYTE1MCJdID0gMHgyNzhhOwogICAgICB0WyJhMTUxIl0gPSAweDI3OGI7CiAgICAgIHRbImExNTIiXSA9IDB4Mjc4YzsKICAgICAgdFsiYTE1MyJdID0gMHgyNzhkOwogICAgICB0WyJhMTU0Il0gPSAweDI3OGU7CiAgICAgIHRbImExNTUiXSA9IDB4Mjc4ZjsKICAgICAgdFsiYTE1NiJdID0gMHgyNzkwOwogICAgICB0WyJhMTU3Il0gPSAweDI3OTE7CiAgICAgIHRbImExNTgiXSA9IDB4Mjc5MjsKICAgICAgdFsiYTE1OSJdID0gMHgyNzkzOwogICAgICB0WyJhMTYwIl0gPSAweDI3OTQ7CiAgICAgIHRbImExNjEiXSA9IDB4MjE5MjsKICAgICAgdFsiYTE2MyJdID0gMHgyMTk0OwogICAgICB0WyJhMTY0Il0gPSAweDIxOTU7CiAgICAgIHRbImExOTYiXSA9IDB4Mjc5ODsKICAgICAgdFsiYTE2NSJdID0gMHgyNzk5OwogICAgICB0WyJhMTkyIl0gPSAweDI3OWE7CiAgICAgIHRbImExNjYiXSA9IDB4Mjc5YjsKICAgICAgdFsiYTE2NyJdID0gMHgyNzljOwogICAgICB0WyJhMTY4Il0gPSAweDI3OWQ7CiAgICAgIHRbImExNjkiXSA9IDB4Mjc5ZTsKICAgICAgdFsiYTE3MCJdID0gMHgyNzlmOwogICAgICB0WyJhMTcxIl0gPSAweDI3YTA7CiAgICAgIHRbImExNzIiXSA9IDB4MjdhMTsKICAgICAgdFsiYTE3MyJdID0gMHgyN2EyOwogICAgICB0WyJhMTYyIl0gPSAweDI3YTM7CiAgICAgIHRbImExNzQiXSA9IDB4MjdhNDsKICAgICAgdFsiYTE3NSJdID0gMHgyN2E1OwogICAgICB0WyJhMTc2Il0gPSAweDI3YTY7CiAgICAgIHRbImExNzciXSA9IDB4MjdhNzsKICAgICAgdFsiYTE3OCJdID0gMHgyN2E4OwogICAgICB0WyJhMTc5Il0gPSAweDI3YTk7CiAgICAgIHRbImExOTMiXSA9IDB4MjdhYTsKICAgICAgdFsiYTE4MCJdID0gMHgyN2FiOwogICAgICB0WyJhMTk5Il0gPSAweDI3YWM7CiAgICAgIHRbImExODEiXSA9IDB4MjdhZDsKICAgICAgdFsiYTIwMCJdID0gMHgyN2FlOwogICAgICB0WyJhMTgyIl0gPSAweDI3YWY7CiAgICAgIHRbImEyMDEiXSA9IDB4MjdiMTsKICAgICAgdFsiYTE4MyJdID0gMHgyN2IyOwogICAgICB0WyJhMTg0Il0gPSAweDI3YjM7CiAgICAgIHRbImExOTciXSA9IDB4MjdiNDsKICAgICAgdFsiYTE4NSJdID0gMHgyN2I1OwogICAgICB0WyJhMTk0Il0gPSAweDI3YjY7CiAgICAgIHRbImExOTgiXSA9IDB4MjdiNzsKICAgICAgdFsiYTE4NiJdID0gMHgyN2I4OwogICAgICB0WyJhMTk1Il0gPSAweDI3Yjk7CiAgICAgIHRbImExODciXSA9IDB4MjdiYTsKICAgICAgdFsiYTE4OCJdID0gMHgyN2JiOwogICAgICB0WyJhMTg5Il0gPSAweDI3YmM7CiAgICAgIHRbImExOTAiXSA9IDB4MjdiZDsKICAgICAgdFsiYTE5MSJdID0gMHgyN2JlOwogICAgICB0WyJhODkiXSA9IDB4Mjc2ODsKICAgICAgdFsiYTkwIl0gPSAweDI3Njk7CiAgICAgIHRbImE5MyJdID0gMHgyNzZhOwogICAgICB0WyJhOTQiXSA9IDB4Mjc2YjsKICAgICAgdFsiYTkxIl0gPSAweDI3NmM7CiAgICAgIHRbImE5MiJdID0gMHgyNzZkOwogICAgICB0WyJhMjA1Il0gPSAweDI3NmU7CiAgICAgIHRbImE4NSJdID0gMHgyNzZmOwogICAgICB0WyJhMjA2Il0gPSAweDI3NzA7CiAgICAgIHRbImE4NiJdID0gMHgyNzcxOwogICAgICB0WyJhODciXSA9IDB4Mjc3MjsKICAgICAgdFsiYTg4Il0gPSAweDI3NzM7CiAgICAgIHRbImE5NSJdID0gMHgyNzc0OwogICAgICB0WyJhOTYiXSA9IDB4Mjc3NTsKICAgICAgdFsiLm5vdGRlZiJdID0gMHgwMDAwOwogICAgfSk7CiAgICBleHBvcnRzLmdldEdseXBoc1VuaWNvZGUgPSBnZXRHbHlwaHNVbmljb2RlOwogICAgZXhwb3J0cy5nZXREaW5nYmF0c0dseXBoc1VuaWNvZGUgPSBnZXREaW5nYmF0c0dseXBoc1VuaWNvZGU7CgogICAgLyoqKi99KSwgKAogIC8qIDIyMiAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCgogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICB2YWx1ZTogdHJ1ZQogICAgfSk7CiAgICBleHBvcnRzLmdldFN1cHBsZW1lbnRhbEdseXBoTWFwRm9yQ2FsaWJyaSA9IGV4cG9ydHMuZ2V0U3VwcGxlbWVudGFsR2x5cGhNYXBGb3JBcmlhbEJsYWNrID0gZXhwb3J0cy5nZXRHbHlwaE1hcEZvclN0YW5kYXJkRm9udHMgPSBleHBvcnRzLmdldFN5bWJvbHNGb250cyA9IGV4cG9ydHMuZ2V0U2VyaWZGb250cyA9IGV4cG9ydHMuZ2V0Tm9uU3RkRm9udE1hcCA9IGV4cG9ydHMuZ2V0U3RkRm9udE1hcCA9IHZvaWQgMDsKCiAgICB2YXIgX2NvcmVfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE5Nyk7CgogICAgdmFyIGdldFN0ZEZvbnRNYXAgPSAoMCwgX2NvcmVfdXRpbHMuZ2V0TG9va3VwVGFibGVGYWN0b3J5KShmdW5jdGlvbiAodCkgewogICAgICB0WyJBcmlhbE5hcnJvdyJdID0gIkhlbHZldGljYSI7CiAgICAgIHRbIkFyaWFsTmFycm93LUJvbGQiXSA9ICJIZWx2ZXRpY2EtQm9sZCI7CiAgICAgIHRbIkFyaWFsTmFycm93LUJvbGRJdGFsaWMiXSA9ICJIZWx2ZXRpY2EtQm9sZE9ibGlxdWUiOwogICAgICB0WyJBcmlhbE5hcnJvdy1JdGFsaWMiXSA9ICJIZWx2ZXRpY2EtT2JsaXF1ZSI7CiAgICAgIHRbIkFyaWFsQmxhY2siXSA9ICJIZWx2ZXRpY2EiOwogICAgICB0WyJBcmlhbEJsYWNrLUJvbGQiXSA9ICJIZWx2ZXRpY2EtQm9sZCI7CiAgICAgIHRbIkFyaWFsQmxhY2stQm9sZEl0YWxpYyJdID0gIkhlbHZldGljYS1Cb2xkT2JsaXF1ZSI7CiAgICAgIHRbIkFyaWFsQmxhY2stSXRhbGljIl0gPSAiSGVsdmV0aWNhLU9ibGlxdWUiOwogICAgICB0WyJBcmlhbC1CbGFjayJdID0gIkhlbHZldGljYSI7CiAgICAgIHRbIkFyaWFsLUJsYWNrLUJvbGQiXSA9ICJIZWx2ZXRpY2EtQm9sZCI7CiAgICAgIHRbIkFyaWFsLUJsYWNrLUJvbGRJdGFsaWMiXSA9ICJIZWx2ZXRpY2EtQm9sZE9ibGlxdWUiOwogICAgICB0WyJBcmlhbC1CbGFjay1JdGFsaWMiXSA9ICJIZWx2ZXRpY2EtT2JsaXF1ZSI7CiAgICAgIHRbIkFyaWFsIl0gPSAiSGVsdmV0aWNhIjsKICAgICAgdFsiQXJpYWwtQm9sZCJdID0gIkhlbHZldGljYS1Cb2xkIjsKICAgICAgdFsiQXJpYWwtQm9sZEl0YWxpYyJdID0gIkhlbHZldGljYS1Cb2xkT2JsaXF1ZSI7CiAgICAgIHRbIkFyaWFsLUl0YWxpYyJdID0gIkhlbHZldGljYS1PYmxpcXVlIjsKICAgICAgdFsiQXJpYWwtQm9sZEl0YWxpY01UIl0gPSAiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIjsKICAgICAgdFsiQXJpYWwtQm9sZE1UIl0gPSAiSGVsdmV0aWNhLUJvbGQiOwogICAgICB0WyJBcmlhbC1JdGFsaWNNVCJdID0gIkhlbHZldGljYS1PYmxpcXVlIjsKICAgICAgdFsiQXJpYWxNVCJdID0gIkhlbHZldGljYSI7CiAgICAgIHRbIkNvdXJpZXItQm9sZCJdID0gIkNvdXJpZXItQm9sZCI7CiAgICAgIHRbIkNvdXJpZXItQm9sZEl0YWxpYyJdID0gIkNvdXJpZXItQm9sZE9ibGlxdWUiOwogICAgICB0WyJDb3VyaWVyLUl0YWxpYyJdID0gIkNvdXJpZXItT2JsaXF1ZSI7CiAgICAgIHRbIkNvdXJpZXJOZXciXSA9ICJDb3VyaWVyIjsKICAgICAgdFsiQ291cmllck5ldy1Cb2xkIl0gPSAiQ291cmllci1Cb2xkIjsKICAgICAgdFsiQ291cmllck5ldy1Cb2xkSXRhbGljIl0gPSAiQ291cmllci1Cb2xkT2JsaXF1ZSI7CiAgICAgIHRbIkNvdXJpZXJOZXctSXRhbGljIl0gPSAiQ291cmllci1PYmxpcXVlIjsKICAgICAgdFsiQ291cmllck5ld1BTLUJvbGRJdGFsaWNNVCJdID0gIkNvdXJpZXItQm9sZE9ibGlxdWUiOwogICAgICB0WyJDb3VyaWVyTmV3UFMtQm9sZE1UIl0gPSAiQ291cmllci1Cb2xkIjsKICAgICAgdFsiQ291cmllck5ld1BTLUl0YWxpY01UIl0gPSAiQ291cmllci1PYmxpcXVlIjsKICAgICAgdFsiQ291cmllck5ld1BTTVQiXSA9ICJDb3VyaWVyIjsKICAgICAgdFsiSGVsdmV0aWNhIl0gPSAiSGVsdmV0aWNhIjsKICAgICAgdFsiSGVsdmV0aWNhLUJvbGQiXSA9ICJIZWx2ZXRpY2EtQm9sZCI7CiAgICAgIHRbIkhlbHZldGljYS1Cb2xkSXRhbGljIl0gPSAiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIjsKICAgICAgdFsiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIl0gPSAiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIjsKICAgICAgdFsiSGVsdmV0aWNhLUl0YWxpYyJdID0gIkhlbHZldGljYS1PYmxpcXVlIjsKICAgICAgdFsiSGVsdmV0aWNhLU9ibGlxdWUiXSA9ICJIZWx2ZXRpY2EtT2JsaXF1ZSI7CiAgICAgIHRbIlN5bWJvbC1Cb2xkIl0gPSAiU3ltYm9sIjsKICAgICAgdFsiU3ltYm9sLUJvbGRJdGFsaWMiXSA9ICJTeW1ib2wiOwogICAgICB0WyJTeW1ib2wtSXRhbGljIl0gPSAiU3ltYm9sIjsKICAgICAgdFsiVGltZXNOZXdSb21hbiJdID0gIlRpbWVzLVJvbWFuIjsKICAgICAgdFsiVGltZXNOZXdSb21hbi1Cb2xkIl0gPSAiVGltZXMtQm9sZCI7CiAgICAgIHRbIlRpbWVzTmV3Um9tYW4tQm9sZEl0YWxpYyJdID0gIlRpbWVzLUJvbGRJdGFsaWMiOwogICAgICB0WyJUaW1lc05ld1JvbWFuLUl0YWxpYyJdID0gIlRpbWVzLUl0YWxpYyI7CiAgICAgIHRbIlRpbWVzTmV3Um9tYW5QUyJdID0gIlRpbWVzLVJvbWFuIjsKICAgICAgdFsiVGltZXNOZXdSb21hblBTLUJvbGQiXSA9ICJUaW1lcy1Cb2xkIjsKICAgICAgdFsiVGltZXNOZXdSb21hblBTLUJvbGRJdGFsaWMiXSA9ICJUaW1lcy1Cb2xkSXRhbGljIjsKICAgICAgdFsiVGltZXNOZXdSb21hblBTLUJvbGRJdGFsaWNNVCJdID0gIlRpbWVzLUJvbGRJdGFsaWMiOwogICAgICB0WyJUaW1lc05ld1JvbWFuUFMtQm9sZE1UIl0gPSAiVGltZXMtQm9sZCI7CiAgICAgIHRbIlRpbWVzTmV3Um9tYW5QUy1JdGFsaWMiXSA9ICJUaW1lcy1JdGFsaWMiOwogICAgICB0WyJUaW1lc05ld1JvbWFuUFMtSXRhbGljTVQiXSA9ICJUaW1lcy1JdGFsaWMiOwogICAgICB0WyJUaW1lc05ld1JvbWFuUFNNVCJdID0gIlRpbWVzLVJvbWFuIjsKICAgICAgdFsiVGltZXNOZXdSb21hblBTTVQtQm9sZCJdID0gIlRpbWVzLUJvbGQiOwogICAgICB0WyJUaW1lc05ld1JvbWFuUFNNVC1Cb2xkSXRhbGljIl0gPSAiVGltZXMtQm9sZEl0YWxpYyI7CiAgICAgIHRbIlRpbWVzTmV3Um9tYW5QU01ULUl0YWxpYyJdID0gIlRpbWVzLUl0YWxpYyI7CiAgICB9KTsKICAgIGV4cG9ydHMuZ2V0U3RkRm9udE1hcCA9IGdldFN0ZEZvbnRNYXA7CiAgICB2YXIgZ2V0Tm9uU3RkRm9udE1hcCA9ICgwLCBfY29yZV91dGlscy5nZXRMb29rdXBUYWJsZUZhY3RvcnkpKGZ1bmN0aW9uICh0KSB7CiAgICAgIHRbIkNhbGlicmkiXSA9ICJIZWx2ZXRpY2EiOwogICAgICB0WyJDYWxpYnJpLUJvbGQiXSA9ICJIZWx2ZXRpY2EtQm9sZCI7CiAgICAgIHRbIkNhbGlicmktQm9sZEl0YWxpYyJdID0gIkhlbHZldGljYS1Cb2xkT2JsaXF1ZSI7CiAgICAgIHRbIkNhbGlicmktSXRhbGljIl0gPSAiSGVsdmV0aWNhLU9ibGlxdWUiOwogICAgICB0WyJDZW50dXJ5R290aGljIl0gPSAiSGVsdmV0aWNhIjsKICAgICAgdFsiQ2VudHVyeUdvdGhpYy1Cb2xkIl0gPSAiSGVsdmV0aWNhLUJvbGQiOwogICAgICB0WyJDZW50dXJ5R290aGljLUJvbGRJdGFsaWMiXSA9ICJIZWx2ZXRpY2EtQm9sZE9ibGlxdWUiOwogICAgICB0WyJDZW50dXJ5R290aGljLUl0YWxpYyJdID0gIkhlbHZldGljYS1PYmxpcXVlIjsKICAgICAgdFsiQ29taWNTYW5zTVMiXSA9ICJDb21pYyBTYW5zIE1TIjsKICAgICAgdFsiQ29taWNTYW5zTVMtQm9sZCJdID0gIkNvbWljIFNhbnMgTVMtQm9sZCI7CiAgICAgIHRbIkNvbWljU2Fuc01TLUJvbGRJdGFsaWMiXSA9ICJDb21pYyBTYW5zIE1TLUJvbGRJdGFsaWMiOwogICAgICB0WyJDb21pY1NhbnNNUy1JdGFsaWMiXSA9ICJDb21pYyBTYW5zIE1TLUl0YWxpYyI7CiAgICAgIHRbIkx1Y2lkYUNvbnNvbGUiXSA9ICJDb3VyaWVyIjsKICAgICAgdFsiTHVjaWRhQ29uc29sZS1Cb2xkIl0gPSAiQ291cmllci1Cb2xkIjsKICAgICAgdFsiTHVjaWRhQ29uc29sZS1Cb2xkSXRhbGljIl0gPSAiQ291cmllci1Cb2xkT2JsaXF1ZSI7CiAgICAgIHRbIkx1Y2lkYUNvbnNvbGUtSXRhbGljIl0gPSAiQ291cmllci1PYmxpcXVlIjsKICAgICAgdFsiTHVjaWRhU2Fucy1EZW1pIl0gPSAiSGVsdmV0aWNhLUJvbGQiOwogICAgICB0WyJNUy1Hb3RoaWMiXSA9ICJNUyBHb3RoaWMiOwogICAgICB0WyJNUy1Hb3RoaWMtQm9sZCJdID0gIk1TIEdvdGhpYy1Cb2xkIjsKICAgICAgdFsiTVMtR290aGljLUJvbGRJdGFsaWMiXSA9ICJNUyBHb3RoaWMtQm9sZEl0YWxpYyI7CiAgICAgIHRbIk1TLUdvdGhpYy1JdGFsaWMiXSA9ICJNUyBHb3RoaWMtSXRhbGljIjsKICAgICAgdFsiTVMtTWluY2hvIl0gPSAiTVMgTWluY2hvIjsKICAgICAgdFsiTVMtTWluY2hvLUJvbGQiXSA9ICJNUyBNaW5jaG8tQm9sZCI7CiAgICAgIHRbIk1TLU1pbmNoby1Cb2xkSXRhbGljIl0gPSAiTVMgTWluY2hvLUJvbGRJdGFsaWMiOwogICAgICB0WyJNUy1NaW5jaG8tSXRhbGljIl0gPSAiTVMgTWluY2hvLUl0YWxpYyI7CiAgICAgIHRbIk1TLVBHb3RoaWMiXSA9ICJNUyBQR290aGljIjsKICAgICAgdFsiTVMtUEdvdGhpYy1Cb2xkIl0gPSAiTVMgUEdvdGhpYy1Cb2xkIjsKICAgICAgdFsiTVMtUEdvdGhpYy1Cb2xkSXRhbGljIl0gPSAiTVMgUEdvdGhpYy1Cb2xkSXRhbGljIjsKICAgICAgdFsiTVMtUEdvdGhpYy1JdGFsaWMiXSA9ICJNUyBQR290aGljLUl0YWxpYyI7CiAgICAgIHRbIk1TLVBNaW5jaG8iXSA9ICJNUyBQTWluY2hvIjsKICAgICAgdFsiTVMtUE1pbmNoby1Cb2xkIl0gPSAiTVMgUE1pbmNoby1Cb2xkIjsKICAgICAgdFsiTVMtUE1pbmNoby1Cb2xkSXRhbGljIl0gPSAiTVMgUE1pbmNoby1Cb2xkSXRhbGljIjsKICAgICAgdFsiTVMtUE1pbmNoby1JdGFsaWMiXSA9ICJNUyBQTWluY2hvLUl0YWxpYyI7CiAgICAgIHRbIk51cHRpYWxTY3JpcHQiXSA9ICJUaW1lcy1JdGFsaWMiOwogICAgICB0WyJTZWdvZVVJU3ltYm9sIl0gPSAiSGVsdmV0aWNhIjsKICAgICAgdFsiV2luZ2RpbmdzIl0gPSAiWmFwZkRpbmdiYXRzIjsKICAgICAgdFsiV2luZ2RpbmdzLVJlZ3VsYXIiXSA9ICJaYXBmRGluZ2JhdHMiOwogICAgfSk7CiAgICBleHBvcnRzLmdldE5vblN0ZEZvbnRNYXAgPSBnZXROb25TdGRGb250TWFwOwogICAgdmFyIGdldFNlcmlmRm9udHMgPSAoMCwgX2NvcmVfdXRpbHMuZ2V0TG9va3VwVGFibGVGYWN0b3J5KShmdW5jdGlvbiAodCkgewogICAgICB0WyJBZG9iZSBKZW5zb24iXSA9IHRydWU7CiAgICAgIHRbIkFkb2JlIFRleHQiXSA9IHRydWU7CiAgICAgIHRbIkFsYmVydHVzIl0gPSB0cnVlOwogICAgICB0WyJBbGR1cyJdID0gdHJ1ZTsKICAgICAgdFsiQWxleGFuZHJpYSJdID0gdHJ1ZTsKICAgICAgdFsiQWxnZXJpYW4iXSA9IHRydWU7CiAgICAgIHRbIkFtZXJpY2FuIFR5cGV3cml0ZXIiXSA9IHRydWU7CiAgICAgIHRbIkFudGlxdWEiXSA9IHRydWU7CiAgICAgIHRbIkFwZXgiXSA9IHRydWU7CiAgICAgIHRbIkFybm8iXSA9IHRydWU7CiAgICAgIHRbIkFzdGVyIl0gPSB0cnVlOwogICAgICB0WyJBdXJvcmEiXSA9IHRydWU7CiAgICAgIHRbIkJhc2tlcnZpbGxlIl0gPSB0cnVlOwogICAgICB0WyJCZWxsIl0gPSB0cnVlOwogICAgICB0WyJCZW1ibyJdID0gdHJ1ZTsKICAgICAgdFsiQmVtYm8gU2Nob29sYm9vayJdID0gdHJ1ZTsKICAgICAgdFsiQmVuZ3VpYXQiXSA9IHRydWU7CiAgICAgIHRbIkJlcmtlbGV5IE9sZCBTdHlsZSJdID0gdHJ1ZTsKICAgICAgdFsiQmVybmhhcmQgTW9kZXJuIl0gPSB0cnVlOwogICAgICB0WyJCZXJ0aG9sZCBDaXR5Il0gPSB0cnVlOwogICAgICB0WyJCb2RvbmkiXSA9IHRydWU7CiAgICAgIHRbIkJhdWVyIEJvZG9uaSJdID0gdHJ1ZTsKICAgICAgdFsiQm9vayBBbnRpcXVhIl0gPSB0cnVlOwogICAgICB0WyJCb29rbWFuIl0gPSB0cnVlOwogICAgICB0WyJCb3JkZWF1eCBSb21hbiJdID0gdHJ1ZTsKICAgICAgdFsiQ2FsaWZvcm5pYW4gRkIiXSA9IHRydWU7CiAgICAgIHRbIkNhbGlzdG8iXSA9IHRydWU7CiAgICAgIHRbIkNhbHZlcnQiXSA9IHRydWU7CiAgICAgIHRbIkNhcGl0YWxzIl0gPSB0cnVlOwogICAgICB0WyJDYW1icmlhIl0gPSB0cnVlOwogICAgICB0WyJDYXJ0aWVyIl0gPSB0cnVlOwogICAgICB0WyJDYXNsb24iXSA9IHRydWU7CiAgICAgIHRbIkNhdHVsbCJdID0gdHJ1ZTsKICAgICAgdFsiQ2VudGF1ciJdID0gdHJ1ZTsKICAgICAgdFsiQ2VudHVyeSBPbGQgU3R5bGUiXSA9IHRydWU7CiAgICAgIHRbIkNlbnR1cnkgU2Nob29sYm9vayJdID0gdHJ1ZTsKICAgICAgdFsiQ2hhcGFycmFsIl0gPSB0cnVlOwogICAgICB0WyJDaGFyaXMgU0lMIl0gPSB0cnVlOwogICAgICB0WyJDaGVsdGVuaGFtIl0gPSB0cnVlOwogICAgICB0WyJDaG9sbGEgU2xhYiJdID0gdHJ1ZTsKICAgICAgdFsiQ2xhcmVuZG9uIl0gPSB0cnVlOwogICAgICB0WyJDbGVhcmZhY2UiXSA9IHRydWU7CiAgICAgIHRbIkNvY2hpbiJdID0gdHJ1ZTsKICAgICAgdFsiQ29sb25uYSJdID0gdHJ1ZTsKICAgICAgdFsiQ29tcHV0ZXIgTW9kZXJuIl0gPSB0cnVlOwogICAgICB0WyJDb25jcmV0ZSBSb21hbiJdID0gdHJ1ZTsKICAgICAgdFsiQ29uc3RhbnRpYSJdID0gdHJ1ZTsKICAgICAgdFsiQ29vcGVyIEJsYWNrIl0gPSB0cnVlOwogICAgICB0WyJDb3JvbmEiXSA9IHRydWU7CiAgICAgIHRbIkVjb3R5cGUiXSA9IHRydWU7CiAgICAgIHRbIkVneXB0aWVubmUiXSA9IHRydWU7CiAgICAgIHRbIkVsZXBoYW50Il0gPSB0cnVlOwogICAgICB0WyJFeGNlbHNpb3IiXSA9IHRydWU7CiAgICAgIHRbIkZhaXJmaWVsZCJdID0gdHJ1ZTsKICAgICAgdFsiRkYgU2NhbGEiXSA9IHRydWU7CiAgICAgIHRbIkZvbGthcmQiXSA9IHRydWU7CiAgICAgIHRbIkZvb3RsaWdodCJdID0gdHJ1ZTsKICAgICAgdFsiRnJlZVNlcmlmIl0gPSB0cnVlOwogICAgICB0WyJGcml6IFF1YWRyYXRhIl0gPSB0cnVlOwogICAgICB0WyJHYXJhbW9uZCJdID0gdHJ1ZTsKICAgICAgdFsiR2VudGl1bSJdID0gdHJ1ZTsKICAgICAgdFsiR2VvcmdpYSJdID0gdHJ1ZTsKICAgICAgdFsiR2xvdWNlc3RlciJdID0gdHJ1ZTsKICAgICAgdFsiR291ZHkgT2xkIFN0eWxlIl0gPSB0cnVlOwogICAgICB0WyJHb3VkeSBTY2hvb2xib29rIl0gPSB0cnVlOwogICAgICB0WyJHb3VkeSBQcm8gRm9udCJdID0gdHJ1ZTsKICAgICAgdFsiR3JhbmpvbiJdID0gdHJ1ZTsKICAgICAgdFsiR3VhcmRpYW4gRWd5cHRpYW4iXSA9IHRydWU7CiAgICAgIHRbIkhlYXRoZXIiXSA9IHRydWU7CiAgICAgIHRbIkhlcmN1bGVzIl0gPSB0cnVlOwogICAgICB0WyJIaWdoIFRvd2VyIFRleHQiXSA9IHRydWU7CiAgICAgIHRbIkhpcm9zaGlnZSJdID0gdHJ1ZTsKICAgICAgdFsiSG9lZmxlciBUZXh0Il0gPSB0cnVlOwogICAgICB0WyJIdW1hbmEgU2VyaWYiXSA9IHRydWU7CiAgICAgIHRbIkltcHJpbnQiXSA9IHRydWU7CiAgICAgIHRbIklvbmljIE5vLiA1Il0gPSB0cnVlOwogICAgICB0WyJKYW5zb24iXSA9IHRydWU7CiAgICAgIHRbIkpvYW5uYSJdID0gdHJ1ZTsKICAgICAgdFsiS29yaW5uYSJdID0gdHJ1ZTsKICAgICAgdFsiTGV4aWNvbiJdID0gdHJ1ZTsKICAgICAgdFsiTGliZXJhdGlvbiBTZXJpZiJdID0gdHJ1ZTsKICAgICAgdFsiTGludXggTGliZXJ0aW5lIl0gPSB0cnVlOwogICAgICB0WyJMaXRlcmF0dXJuYXlhIl0gPSB0cnVlOwogICAgICB0WyJMdWNpZGEiXSA9IHRydWU7CiAgICAgIHRbIkx1Y2lkYSBCcmlnaHQiXSA9IHRydWU7CiAgICAgIHRbIk1lbGlvciJdID0gdHJ1ZTsKICAgICAgdFsiTWVtcGhpcyJdID0gdHJ1ZTsKICAgICAgdFsiTWlsbGVyIl0gPSB0cnVlOwogICAgICB0WyJNaW5pb24iXSA9IHRydWU7CiAgICAgIHRbIk1vZGVybiJdID0gdHJ1ZTsKICAgICAgdFsiTW9uYSBMaXNhIl0gPSB0cnVlOwogICAgICB0WyJNcnMgRWF2ZXMiXSA9IHRydWU7CiAgICAgIHRbIk1TIFNlcmlmIl0gPSB0cnVlOwogICAgICB0WyJNdXNlbyBTbGFiIl0gPSB0cnVlOwogICAgICB0WyJOZXcgWW9yayJdID0gdHJ1ZTsKICAgICAgdFsiTmltYnVzIFJvbWFuIl0gPSB0cnVlOwogICAgICB0WyJOUFMgUmF3bGluc29uIFJvYWR3YXkiXSA9IHRydWU7CiAgICAgIHRbIk51cHRpYWxTY3JpcHQiXSA9IHRydWU7CiAgICAgIHRbIlBhbGF0aW5vIl0gPSB0cnVlOwogICAgICB0WyJQZXJwZXR1YSJdID0gdHJ1ZTsKICAgICAgdFsiUGxhbnRpbiJdID0gdHJ1ZTsKICAgICAgdFsiUGxhbnRpbiBTY2hvb2xib29rIl0gPSB0cnVlOwogICAgICB0WyJQbGF5YmlsbCJdID0gdHJ1ZTsKICAgICAgdFsiUG9vciBSaWNoYXJkIl0gPSB0cnVlOwogICAgICB0WyJSYXdsaW5zb24gUm9hZHdheSJdID0gdHJ1ZTsKICAgICAgdFsiUmVuYXVsdCJdID0gdHJ1ZTsKICAgICAgdFsiUmVxdWllbSJdID0gdHJ1ZTsKICAgICAgdFsiUm9ja3dlbGwiXSA9IHRydWU7CiAgICAgIHRbIlJvbWFuIl0gPSB0cnVlOwogICAgICB0WyJSb3RpcyBTZXJpZiJdID0gdHJ1ZTsKICAgICAgdFsiU2Fib24iXSA9IHRydWU7CiAgICAgIHRbIlNjYWxhIl0gPSB0cnVlOwogICAgICB0WyJTZWFndWxsIl0gPSB0cnVlOwogICAgICB0WyJTaXN0aW5hIl0gPSB0cnVlOwogICAgICB0WyJTb3V2ZW5pciJdID0gdHJ1ZTsKICAgICAgdFsiU1RJWCJdID0gdHJ1ZTsKICAgICAgdFsiU3RvbmUgSW5mb3JtYWwiXSA9IHRydWU7CiAgICAgIHRbIlN0b25lIFNlcmlmIl0gPSB0cnVlOwogICAgICB0WyJTeWxmYWVuIl0gPSB0cnVlOwogICAgICB0WyJUaW1lcyJdID0gdHJ1ZTsKICAgICAgdFsiVHJhamFuIl0gPSB0cnVlOwogICAgICB0WyJUcmluaXTDqSJdID0gdHJ1ZTsKICAgICAgdFsiVHJ1bXAgTWVkaWFldmFsIl0gPSB0cnVlOwogICAgICB0WyJVdG9waWEiXSA9IHRydWU7CiAgICAgIHRbIlZhbGUgVHlwZSJdID0gdHJ1ZTsKICAgICAgdFsiQml0c3RyZWFtIFZlcmEiXSA9IHRydWU7CiAgICAgIHRbIlZlcmEgU2VyaWYiXSA9IHRydWU7CiAgICAgIHRbIlZlcnNhaWxsZXMiXSA9IHRydWU7CiAgICAgIHRbIldhbnRlZCJdID0gdHJ1ZTsKICAgICAgdFsiV2Vpc3MiXSA9IHRydWU7CiAgICAgIHRbIldpZGUgTGF0aW4iXSA9IHRydWU7CiAgICAgIHRbIldpbmRzb3IiXSA9IHRydWU7CiAgICAgIHRbIlhJVFMiXSA9IHRydWU7CiAgICB9KTsKICAgIGV4cG9ydHMuZ2V0U2VyaWZGb250cyA9IGdldFNlcmlmRm9udHM7CiAgICB2YXIgZ2V0U3ltYm9sc0ZvbnRzID0gKDAsIF9jb3JlX3V0aWxzLmdldExvb2t1cFRhYmxlRmFjdG9yeSkoZnVuY3Rpb24gKHQpIHsKICAgICAgdFsiRGluZ2JhdHMiXSA9IHRydWU7CiAgICAgIHRbIlN5bWJvbCJdID0gdHJ1ZTsKICAgICAgdFsiWmFwZkRpbmdiYXRzIl0gPSB0cnVlOwogICAgfSk7CiAgICBleHBvcnRzLmdldFN5bWJvbHNGb250cyA9IGdldFN5bWJvbHNGb250czsKICAgIHZhciBnZXRHbHlwaE1hcEZvclN0YW5kYXJkRm9udHMgPSAoMCwgX2NvcmVfdXRpbHMuZ2V0TG9va3VwVGFibGVGYWN0b3J5KShmdW5jdGlvbiAodCkgewogICAgICB0WzJdID0gMTA7CiAgICAgIHRbM10gPSAzMjsKICAgICAgdFs0XSA9IDMzOwogICAgICB0WzVdID0gMzQ7CiAgICAgIHRbNl0gPSAzNTsKICAgICAgdFs3XSA9IDM2OwogICAgICB0WzhdID0gMzc7CiAgICAgIHRbOV0gPSAzODsKICAgICAgdFsxMF0gPSAzOTsKICAgICAgdFsxMV0gPSA0MDsKICAgICAgdFsxMl0gPSA0MTsKICAgICAgdFsxM10gPSA0MjsKICAgICAgdFsxNF0gPSA0MzsKICAgICAgdFsxNV0gPSA0NDsKICAgICAgdFsxNl0gPSA0NTsKICAgICAgdFsxN10gPSA0NjsKICAgICAgdFsxOF0gPSA0NzsKICAgICAgdFsxOV0gPSA0ODsKICAgICAgdFsyMF0gPSA0OTsKICAgICAgdFsyMV0gPSA1MDsKICAgICAgdFsyMl0gPSA1MTsKICAgICAgdFsyM10gPSA1MjsKICAgICAgdFsyNF0gPSA1MzsKICAgICAgdFsyNV0gPSA1NDsKICAgICAgdFsyNl0gPSA1NTsKICAgICAgdFsyN10gPSA1NjsKICAgICAgdFsyOF0gPSA1NzsKICAgICAgdFsyOV0gPSA1ODsKICAgICAgdFszMF0gPSA4OTQ7CiAgICAgIHRbMzFdID0gNjA7CiAgICAgIHRbMzJdID0gNjE7CiAgICAgIHRbMzNdID0gNjI7CiAgICAgIHRbMzRdID0gNjM7CiAgICAgIHRbMzVdID0gNjQ7CiAgICAgIHRbMzZdID0gNjU7CiAgICAgIHRbMzddID0gNjY7CiAgICAgIHRbMzhdID0gNjc7CiAgICAgIHRbMzldID0gNjg7CiAgICAgIHRbNDBdID0gNjk7CiAgICAgIHRbNDFdID0gNzA7CiAgICAgIHRbNDJdID0gNzE7CiAgICAgIHRbNDNdID0gNzI7CiAgICAgIHRbNDRdID0gNzM7CiAgICAgIHRbNDVdID0gNzQ7CiAgICAgIHRbNDZdID0gNzU7CiAgICAgIHRbNDddID0gNzY7CiAgICAgIHRbNDhdID0gNzc7CiAgICAgIHRbNDldID0gNzg7CiAgICAgIHRbNTBdID0gNzk7CiAgICAgIHRbNTFdID0gODA7CiAgICAgIHRbNTJdID0gODE7CiAgICAgIHRbNTNdID0gODI7CiAgICAgIHRbNTRdID0gODM7CiAgICAgIHRbNTVdID0gODQ7CiAgICAgIHRbNTZdID0gODU7CiAgICAgIHRbNTddID0gODY7CiAgICAgIHRbNThdID0gODc7CiAgICAgIHRbNTldID0gODg7CiAgICAgIHRbNjBdID0gODk7CiAgICAgIHRbNjFdID0gOTA7CiAgICAgIHRbNjJdID0gOTE7CiAgICAgIHRbNjNdID0gOTI7CiAgICAgIHRbNjRdID0gOTM7CiAgICAgIHRbNjVdID0gOTQ7CiAgICAgIHRbNjZdID0gOTU7CiAgICAgIHRbNjddID0gOTY7CiAgICAgIHRbNjhdID0gOTc7CiAgICAgIHRbNjldID0gOTg7CiAgICAgIHRbNzBdID0gOTk7CiAgICAgIHRbNzFdID0gMTAwOwogICAgICB0WzcyXSA9IDEwMTsKICAgICAgdFs3M10gPSAxMDI7CiAgICAgIHRbNzRdID0gMTAzOwogICAgICB0Wzc1XSA9IDEwNDsKICAgICAgdFs3Nl0gPSAxMDU7CiAgICAgIHRbNzddID0gMTA2OwogICAgICB0Wzc4XSA9IDEwNzsKICAgICAgdFs3OV0gPSAxMDg7CiAgICAgIHRbODBdID0gMTA5OwogICAgICB0WzgxXSA9IDExMDsKICAgICAgdFs4Ml0gPSAxMTE7CiAgICAgIHRbODNdID0gMTEyOwogICAgICB0Wzg0XSA9IDExMzsKICAgICAgdFs4NV0gPSAxMTQ7CiAgICAgIHRbODZdID0gMTE1OwogICAgICB0Wzg3XSA9IDExNjsKICAgICAgdFs4OF0gPSAxMTc7CiAgICAgIHRbODldID0gMTE4OwogICAgICB0WzkwXSA9IDExOTsKICAgICAgdFs5MV0gPSAxMjA7CiAgICAgIHRbOTJdID0gMTIxOwogICAgICB0WzkzXSA9IDEyMjsKICAgICAgdFs5NF0gPSAxMjM7CiAgICAgIHRbOTVdID0gMTI0OwogICAgICB0Wzk2XSA9IDEyNTsKICAgICAgdFs5N10gPSAxMjY7CiAgICAgIHRbOThdID0gMTk2OwogICAgICB0Wzk5XSA9IDE5NzsKICAgICAgdFsxMDBdID0gMTk5OwogICAgICB0WzEwMV0gPSAyMDE7CiAgICAgIHRbMTAyXSA9IDIwOTsKICAgICAgdFsxMDNdID0gMjE0OwogICAgICB0WzEwNF0gPSAyMjA7CiAgICAgIHRbMTA1XSA9IDIyNTsKICAgICAgdFsxMDZdID0gMjI0OwogICAgICB0WzEwN10gPSAyMjY7CiAgICAgIHRbMTA4XSA9IDIyODsKICAgICAgdFsxMDldID0gMjI3OwogICAgICB0WzExMF0gPSAyMjk7CiAgICAgIHRbMTExXSA9IDIzMTsKICAgICAgdFsxMTJdID0gMjMzOwogICAgICB0WzExM10gPSAyMzI7CiAgICAgIHRbMTE0XSA9IDIzNDsKICAgICAgdFsxMTVdID0gMjM1OwogICAgICB0WzExNl0gPSAyMzc7CiAgICAgIHRbMTE3XSA9IDIzNjsKICAgICAgdFsxMThdID0gMjM4OwogICAgICB0WzExOV0gPSAyMzk7CiAgICAgIHRbMTIwXSA9IDI0MTsKICAgICAgdFsxMjFdID0gMjQzOwogICAgICB0WzEyMl0gPSAyNDI7CiAgICAgIHRbMTIzXSA9IDI0NDsKICAgICAgdFsxMjRdID0gMjQ2OwogICAgICB0WzEyNV0gPSAyNDU7CiAgICAgIHRbMTI2XSA9IDI1MDsKICAgICAgdFsxMjddID0gMjQ5OwogICAgICB0WzEyOF0gPSAyNTE7CiAgICAgIHRbMTI5XSA9IDI1MjsKICAgICAgdFsxMzBdID0gODIyNDsKICAgICAgdFsxMzFdID0gMTc2OwogICAgICB0WzEzMl0gPSAxNjI7CiAgICAgIHRbMTMzXSA9IDE2MzsKICAgICAgdFsxMzRdID0gMTY3OwogICAgICB0WzEzNV0gPSA4MjI2OwogICAgICB0WzEzNl0gPSAxODI7CiAgICAgIHRbMTM3XSA9IDIyMzsKICAgICAgdFsxMzhdID0gMTc0OwogICAgICB0WzEzOV0gPSAxNjk7CiAgICAgIHRbMTQwXSA9IDg0ODI7CiAgICAgIHRbMTQxXSA9IDE4MDsKICAgICAgdFsxNDJdID0gMTY4OwogICAgICB0WzE0M10gPSA4ODAwOwogICAgICB0WzE0NF0gPSAxOTg7CiAgICAgIHRbMTQ1XSA9IDIxNjsKICAgICAgdFsxNDZdID0gODczNDsKICAgICAgdFsxNDddID0gMTc3OwogICAgICB0WzE0OF0gPSA4ODA0OwogICAgICB0WzE0OV0gPSA4ODA1OwogICAgICB0WzE1MF0gPSAxNjU7CiAgICAgIHRbMTUxXSA9IDE4MTsKICAgICAgdFsxNTJdID0gODcwNjsKICAgICAgdFsxNTNdID0gODcyMTsKICAgICAgdFsxNTRdID0gODcxOTsKICAgICAgdFsxNTZdID0gODc0NzsKICAgICAgdFsxNTddID0gMTcwOwogICAgICB0WzE1OF0gPSAxODY7CiAgICAgIHRbMTU5XSA9IDg0ODY7CiAgICAgIHRbMTYwXSA9IDIzMDsKICAgICAgdFsxNjFdID0gMjQ4OwogICAgICB0WzE2Ml0gPSAxOTE7CiAgICAgIHRbMTYzXSA9IDE2MTsKICAgICAgdFsxNjRdID0gMTcyOwogICAgICB0WzE2NV0gPSA4NzMwOwogICAgICB0WzE2Nl0gPSA0MDI7CiAgICAgIHRbMTY3XSA9IDg3NzY7CiAgICAgIHRbMTY4XSA9IDg3MTA7CiAgICAgIHRbMTY5XSA9IDE3MTsKICAgICAgdFsxNzBdID0gMTg3OwogICAgICB0WzE3MV0gPSA4MjMwOwogICAgICB0WzIxMF0gPSAyMTg7CiAgICAgIHRbMjIzXSA9IDcxMTsKICAgICAgdFsyMjRdID0gMzIxOwogICAgICB0WzIyNV0gPSAzMjI7CiAgICAgIHRbMjI3XSA9IDM1MzsKICAgICAgdFsyMjldID0gMzgyOwogICAgICB0WzIzNF0gPSAyNTM7CiAgICAgIHRbMjUyXSA9IDI2MzsKICAgICAgdFsyNTNdID0gMjY4OwogICAgICB0WzI1NF0gPSAyNjk7CiAgICAgIHRbMjU4XSA9IDI1ODsKICAgICAgdFsyNjBdID0gMjYwOwogICAgICB0WzI2MV0gPSAyNjE7CiAgICAgIHRbMjY1XSA9IDI4MDsKICAgICAgdFsyNjZdID0gMjgxOwogICAgICB0WzI2OF0gPSAyODM7CiAgICAgIHRbMjY5XSA9IDMxMzsKICAgICAgdFsyNzVdID0gMzIzOwogICAgICB0WzI3Nl0gPSAzMjQ7CiAgICAgIHRbMjc4XSA9IDMyODsKICAgICAgdFsyODRdID0gMzQ1OwogICAgICB0WzI4NV0gPSAzNDY7CiAgICAgIHRbMjg2XSA9IDM0NzsKICAgICAgdFsyOTJdID0gMzY3OwogICAgICB0WzI5NV0gPSAzNzc7CiAgICAgIHRbMjk2XSA9IDM3ODsKICAgICAgdFsyOThdID0gMzgwOwogICAgICB0WzMwNV0gPSA5NjM7CiAgICAgIHRbMzA2XSA9IDk2NDsKICAgICAgdFszMDddID0gOTY2OwogICAgICB0WzMwOF0gPSA4MjE1OwogICAgICB0WzMwOV0gPSA4MjUyOwogICAgICB0WzMxMF0gPSA4MzE5OwogICAgICB0WzMxMV0gPSA4MzU5OwogICAgICB0WzMxMl0gPSA4NTkyOwogICAgICB0WzMxM10gPSA4NTkzOwogICAgICB0WzMzN10gPSA5NTUyOwogICAgICB0WzQ5M10gPSAxMDM5OwogICAgICB0WzQ5NF0gPSAxMDQwOwogICAgICB0WzcwNV0gPSAxNTI0OwogICAgICB0WzcwNl0gPSA4MzYyOwogICAgICB0WzcxMF0gPSA2NDI4ODsKICAgICAgdFs3MTFdID0gNjQyOTg7CiAgICAgIHRbNzU5XSA9IDE2MTc7CiAgICAgIHRbNzYxXSA9IDE3NzY7CiAgICAgIHRbNzYzXSA9IDE3Nzg7CiAgICAgIHRbNzc1XSA9IDE2NTI7CiAgICAgIHRbNzc3XSA9IDE3NjQ7CiAgICAgIHRbNzc4XSA9IDE3ODA7CiAgICAgIHRbNzc5XSA9IDE3ODE7CiAgICAgIHRbNzgwXSA9IDE3ODI7CiAgICAgIHRbNzgyXSA9IDc3MTsKICAgICAgdFs3ODNdID0gNjQ3MjY7CiAgICAgIHRbNzg2XSA9IDgzNjM7CiAgICAgIHRbNzg4XSA9IDg1MzI7CiAgICAgIHRbNzkwXSA9IDc2ODsKICAgICAgdFs3OTFdID0gNzY5OwogICAgICB0Wzc5Ml0gPSA3Njg7CiAgICAgIHRbNzk1XSA9IDgwMzsKICAgICAgdFs3OTddID0gNjQzMzY7CiAgICAgIHRbNzk4XSA9IDY0MzM3OwogICAgICB0Wzc5OV0gPSA2NDM0MjsKICAgICAgdFs4MDBdID0gNjQzNDM7CiAgICAgIHRbODAxXSA9IDY0MzQ0OwogICAgICB0WzgwMl0gPSA2NDM0NTsKICAgICAgdFs4MDNdID0gNjQzNjI7CiAgICAgIHRbODA0XSA9IDY0MzYzOwogICAgICB0WzgwNV0gPSA2NDM2NDsKICAgICAgdFsyNDI0XSA9IDc4MjE7CiAgICAgIHRbMjQyNV0gPSA3ODIyOwogICAgICB0WzI0MjZdID0gNzgyMzsKICAgICAgdFsyNDI3XSA9IDc4MjQ7CiAgICAgIHRbMjQyOF0gPSA3ODI1OwogICAgICB0WzI0MjldID0gNzgyNjsKICAgICAgdFsyNDMwXSA9IDc4Mjc7CiAgICAgIHRbMjQzM10gPSA3NjgyOwogICAgICB0WzI2NzhdID0gODA0NTsKICAgICAgdFsyNjc5XSA9IDgwNDY7CiAgICAgIHRbMjgzMF0gPSAxNTUyOwogICAgICB0WzI4MzhdID0gNjg2OwogICAgICB0WzI4NDBdID0gNzUxOwogICAgICB0WzI4NDJdID0gNzUzOwogICAgICB0WzI4NDNdID0gNzU0OwogICAgICB0WzI4NDRdID0gNzU1OwogICAgICB0WzI4NDZdID0gNzU3OwogICAgICB0WzI4NTZdID0gNzY3OwogICAgICB0WzI4NTddID0gODQ4OwogICAgICB0WzI4NThdID0gODQ5OwogICAgICB0WzI4NjJdID0gODUzOwogICAgICB0WzI4NjNdID0gODU0OwogICAgICB0WzI4NjRdID0gODU1OwogICAgICB0WzI4NjVdID0gODYxOwogICAgICB0WzI4NjZdID0gODYyOwogICAgICB0WzI5MDZdID0gNzQ2MDsKICAgICAgdFsyOTA4XSA9IDc0NjI7CiAgICAgIHRbMjkwOV0gPSA3NDYzOwogICAgICB0WzI5MTBdID0gNzQ2NDsKICAgICAgdFsyOTEyXSA9IDc0NjY7CiAgICAgIHRbMjkxM10gPSA3NDY3OwogICAgICB0WzI5MTRdID0gNzQ2ODsKICAgICAgdFsyOTE2XSA9IDc0NzA7CiAgICAgIHRbMjkxN10gPSA3NDcxOwogICAgICB0WzI5MThdID0gNzQ3MjsKICAgICAgdFsyOTIwXSA9IDc0NzQ7CiAgICAgIHRbMjkyMV0gPSA3NDc1OwogICAgICB0WzI5MjJdID0gNzQ3NjsKICAgICAgdFsyOTI0XSA9IDc0Nzg7CiAgICAgIHRbMjkyNV0gPSA3NDc5OwogICAgICB0WzI5MjZdID0gNzQ4MDsKICAgICAgdFsyOTI4XSA9IDc0ODI7CiAgICAgIHRbMjkyOV0gPSA3NDgzOwogICAgICB0WzI5MzBdID0gNzQ4NDsKICAgICAgdFsyOTMyXSA9IDc0ODY7CiAgICAgIHRbMjkzM10gPSA3NDg3OwogICAgICB0WzI5MzRdID0gNzQ4ODsKICAgICAgdFsyOTM2XSA9IDc0OTA7CiAgICAgIHRbMjkzN10gPSA3NDkxOwogICAgICB0WzI5MzhdID0gNzQ5MjsKICAgICAgdFsyOTQwXSA9IDc0OTQ7CiAgICAgIHRbMjk0MV0gPSA3NDk1OwogICAgICB0WzI5NDJdID0gNzQ5NjsKICAgICAgdFsyOTQ0XSA9IDc0OTg7CiAgICAgIHRbMjk0Nl0gPSA3NTAwOwogICAgICB0WzI5NDhdID0gNzUwMjsKICAgICAgdFsyOTUwXSA9IDc1MDQ7CiAgICAgIHRbMjk1MV0gPSA3NTA1OwogICAgICB0WzI5NTJdID0gNzUwNjsKICAgICAgdFsyOTU0XSA9IDc1MDg7CiAgICAgIHRbMjk1NV0gPSA3NTA5OwogICAgICB0WzI5NTZdID0gNzUxMDsKICAgICAgdFsyOTU4XSA9IDc1MTI7CiAgICAgIHRbMjk1OV0gPSA3NTEzOwogICAgICB0WzI5NjBdID0gNzUxNDsKICAgICAgdFsyOTYyXSA9IDc1MTY7CiAgICAgIHRbMjk2M10gPSA3NTE3OwogICAgICB0WzI5NjRdID0gNzUxODsKICAgICAgdFsyOTY2XSA9IDc1MjA7CiAgICAgIHRbMjk2N10gPSA3NTIxOwogICAgICB0WzI5NjhdID0gNzUyMjsKICAgICAgdFsyOTcwXSA9IDc1MjQ7CiAgICAgIHRbMjk3MV0gPSA3NTI1OwogICAgICB0WzI5NzJdID0gNzUyNjsKICAgICAgdFsyOTc0XSA9IDc1Mjg7CiAgICAgIHRbMjk3NV0gPSA3NTI5OwogICAgICB0WzI5NzZdID0gNzUzMDsKICAgICAgdFsyOTc4XSA9IDE1Mzc7CiAgICAgIHRbMjk3OV0gPSAxNTM4OwogICAgICB0WzI5ODBdID0gMTUzOTsKICAgICAgdFsyOTgyXSA9IDE1NDk7CiAgICAgIHRbMjk4M10gPSAxNTUxOwogICAgICB0WzI5ODRdID0gMTU1MjsKICAgICAgdFsyOTg2XSA9IDE1NTQ7CiAgICAgIHRbMjk4N10gPSAxNTU1OwogICAgICB0WzI5ODhdID0gMTU1NjsKICAgICAgdFsyOTkwXSA9IDE2MjM7CiAgICAgIHRbMjk5MV0gPSAxNjI0OwogICAgICB0WzI5OTVdID0gMTc3NTsKICAgICAgdFsyOTk5XSA9IDE3OTE7CiAgICAgIHRbMzAwMl0gPSA2NDI5MDsKICAgICAgdFszMDAzXSA9IDY0MjkxOwogICAgICB0WzMwMDRdID0gNjQyOTI7CiAgICAgIHRbMzAwNl0gPSA2NDI5NDsKICAgICAgdFszMDA3XSA9IDY0Mjk1OwogICAgICB0WzMwMDhdID0gNjQyOTY7CiAgICAgIHRbMzAxMV0gPSAxOTAwOwogICAgICB0WzMwMTRdID0gODIyMzsKICAgICAgdFszMDE1XSA9IDgyNDQ7CiAgICAgIHRbMzAxN10gPSA3NTMyOwogICAgICB0WzMwMThdID0gNzUzMzsKICAgICAgdFszMDE5XSA9IDc1MzQ7CiAgICAgIHRbMzA3NV0gPSA3NTkwOwogICAgICB0WzMwNzZdID0gNzU5MTsKICAgICAgdFszMDc5XSA9IDc1OTQ7CiAgICAgIHRbMzA4MF0gPSA3NTk1OwogICAgICB0WzMwODNdID0gNzU5ODsKICAgICAgdFszMDg0XSA9IDc1OTk7CiAgICAgIHRbMzA4N10gPSA3NjAyOwogICAgICB0WzMwODhdID0gNzYwMzsKICAgICAgdFszMDkxXSA9IDc2MDY7CiAgICAgIHRbMzA5Ml0gPSA3NjA3OwogICAgICB0WzMwOTVdID0gNzYxMDsKICAgICAgdFszMDk2XSA9IDc2MTE7CiAgICAgIHRbMzA5OV0gPSA3NjE0OwogICAgICB0WzMxMDBdID0gNzYxNTsKICAgICAgdFszMTAzXSA9IDc2MTg7CiAgICAgIHRbMzEwNF0gPSA3NjE5OwogICAgICB0WzMxMDddID0gODMzNzsKICAgICAgdFszMTA4XSA9IDgzMzg7CiAgICAgIHRbMzExNl0gPSAxODg0OwogICAgICB0WzMxMTldID0gMTg4NTsKICAgICAgdFszMTIwXSA9IDE4ODU7CiAgICAgIHRbMzEyM10gPSAxODg2OwogICAgICB0WzMxMjRdID0gMTg4NjsKICAgICAgdFszMTI3XSA9IDE4ODc7CiAgICAgIHRbMzEyOF0gPSAxODg3OwogICAgICB0WzMxMzFdID0gMTg4ODsKICAgICAgdFszMTMyXSA9IDE4ODg7CiAgICAgIHRbMzEzNV0gPSAxODg5OwogICAgICB0WzMxMzZdID0gMTg4OTsKICAgICAgdFszMTM5XSA9IDE4OTA7CiAgICAgIHRbMzE0MF0gPSAxODkwOwogICAgICB0WzMxNDNdID0gMTg5MTsKICAgICAgdFszMTQ0XSA9IDE4OTE7CiAgICAgIHRbMzE0N10gPSAxODkyOwogICAgICB0WzMxNDhdID0gMTg5MjsKICAgICAgdFszMTUzXSA9IDU4MDsKICAgICAgdFszMTU0XSA9IDU4MTsKICAgICAgdFszMTU3XSA9IDU4NDsKICAgICAgdFszMTU4XSA9IDU4NTsKICAgICAgdFszMTYxXSA9IDU4ODsKICAgICAgdFszMTYyXSA9IDU4OTsKICAgICAgdFszMTY1XSA9IDg5MTsKICAgICAgdFszMTY2XSA9IDg5MjsKICAgICAgdFszMTY5XSA9IDEyNzQ7CiAgICAgIHRbMzE3MF0gPSAxMjc1OwogICAgICB0WzMxNzNdID0gMTI3ODsKICAgICAgdFszMTc0XSA9IDEyNzk7CiAgICAgIHRbMzE4MV0gPSA3NjIyOwogICAgICB0WzMxODJdID0gNzYyMzsKICAgICAgdFszMjgyXSA9IDExNzk5OwogICAgICB0WzMzMTZdID0gNTc4OwogICAgICB0WzMzNzldID0gNDI3ODU7CiAgICAgIHRbMzM5M10gPSAxMTU5OwogICAgICB0WzM0MTZdID0gODM3NzsKICAgIH0pOwogICAgZXhwb3J0cy5nZXRHbHlwaE1hcEZvclN0YW5kYXJkRm9udHMgPSBnZXRHbHlwaE1hcEZvclN0YW5kYXJkRm9udHM7CiAgICB2YXIgZ2V0U3VwcGxlbWVudGFsR2x5cGhNYXBGb3JBcmlhbEJsYWNrID0gKDAsIF9jb3JlX3V0aWxzLmdldExvb2t1cFRhYmxlRmFjdG9yeSkoZnVuY3Rpb24gKHQpIHsKICAgICAgdFsyMjddID0gMzIyOwogICAgICB0WzI2NF0gPSAyNjE7CiAgICAgIHRbMjkxXSA9IDM0NjsKICAgIH0pOwogICAgZXhwb3J0cy5nZXRTdXBwbGVtZW50YWxHbHlwaE1hcEZvckFyaWFsQmxhY2sgPSBnZXRTdXBwbGVtZW50YWxHbHlwaE1hcEZvckFyaWFsQmxhY2s7CiAgICB2YXIgZ2V0U3VwcGxlbWVudGFsR2x5cGhNYXBGb3JDYWxpYnJpID0gKDAsIF9jb3JlX3V0aWxzLmdldExvb2t1cFRhYmxlRmFjdG9yeSkoZnVuY3Rpb24gKHQpIHsKICAgICAgdFsxXSA9IDMyOwogICAgICB0WzRdID0gNjU7CiAgICAgIHRbMTddID0gNjY7CiAgICAgIHRbMThdID0gNjc7CiAgICAgIHRbMjRdID0gNjg7CiAgICAgIHRbMjhdID0gNjk7CiAgICAgIHRbMzhdID0gNzA7CiAgICAgIHRbMzldID0gNzE7CiAgICAgIHRbNDRdID0gNzI7CiAgICAgIHRbNDddID0gNzM7CiAgICAgIHRbNThdID0gNzQ7CiAgICAgIHRbNjBdID0gNzU7CiAgICAgIHRbNjJdID0gNzY7CiAgICAgIHRbNjhdID0gNzc7CiAgICAgIHRbNjldID0gNzg7CiAgICAgIHRbNzVdID0gNzk7CiAgICAgIHRbODddID0gODA7CiAgICAgIHRbODldID0gODE7CiAgICAgIHRbOTBdID0gODI7CiAgICAgIHRbOTRdID0gODM7CiAgICAgIHRbMTAwXSA9IDg0OwogICAgICB0WzEwNF0gPSA4NTsKICAgICAgdFsxMTVdID0gODY7CiAgICAgIHRbMTE2XSA9IDg3OwogICAgICB0WzEyMV0gPSA4ODsKICAgICAgdFsxMjJdID0gODk7CiAgICAgIHRbMTI3XSA9IDkwOwogICAgICB0WzI1OF0gPSA5NzsKICAgICAgdFsyNjhdID0gMjYxOwogICAgICB0WzI3MV0gPSA5ODsKICAgICAgdFsyNzJdID0gOTk7CiAgICAgIHRbMjczXSA9IDI2MzsKICAgICAgdFsyODJdID0gMTAwOwogICAgICB0WzI4Nl0gPSAxMDE7CiAgICAgIHRbMjk1XSA9IDI4MTsKICAgICAgdFsyOTZdID0gMTAyOwogICAgICB0WzMzNl0gPSAxMDM7CiAgICAgIHRbMzQ2XSA9IDEwNDsKICAgICAgdFszNDldID0gMTA1OwogICAgICB0WzM2MV0gPSAxMDY7CiAgICAgIHRbMzY0XSA9IDEwNzsKICAgICAgdFszNjddID0gMTA4OwogICAgICB0WzM3MV0gPSAzMjI7CiAgICAgIHRbMzczXSA9IDEwOTsKICAgICAgdFszNzRdID0gMTEwOwogICAgICB0WzM4MV0gPSAxMTE7CiAgICAgIHRbMzgzXSA9IDI0MzsKICAgICAgdFszOTNdID0gMTEyOwogICAgICB0WzM5NV0gPSAxMTM7CiAgICAgIHRbMzk2XSA9IDExNDsKICAgICAgdFs0MDBdID0gMTE1OwogICAgICB0WzQwMV0gPSAzNDc7CiAgICAgIHRbNDEwXSA9IDExNjsKICAgICAgdFs0MzddID0gMTE3OwogICAgICB0WzQ0OF0gPSAxMTg7CiAgICAgIHRbNDQ5XSA9IDExOTsKICAgICAgdFs0NTRdID0gMTIwOwogICAgICB0WzQ1NV0gPSAxMjE7CiAgICAgIHRbNDYwXSA9IDEyMjsKICAgICAgdFs0NjNdID0gMzgwOwogICAgICB0Wzg1M10gPSA0NDsKICAgICAgdFs4NTVdID0gNTg7CiAgICAgIHRbODU2XSA9IDQ2OwogICAgICB0Wzg3Nl0gPSA0NzsKICAgICAgdFs4NzhdID0gNDU7CiAgICAgIHRbODgyXSA9IDQ1OwogICAgICB0Wzg5NF0gPSA0MDsKICAgICAgdFs4OTVdID0gNDE7CiAgICAgIHRbODk2XSA9IDkxOwogICAgICB0Wzg5N10gPSA5MzsKICAgICAgdFs5MjNdID0gNjQ7CiAgICAgIHRbMTAwNF0gPSA0ODsKICAgICAgdFsxMDA1XSA9IDQ5OwogICAgICB0WzEwMDZdID0gNTA7CiAgICAgIHRbMTAwN10gPSA1MTsKICAgICAgdFsxMDA4XSA9IDUyOwogICAgICB0WzEwMDldID0gNTM7CiAgICAgIHRbMTAxMF0gPSA1NDsKICAgICAgdFsxMDExXSA9IDU1OwogICAgICB0WzEwMTJdID0gNTY7CiAgICAgIHRbMTAxM10gPSA1NzsKICAgICAgdFsxMDgxXSA9IDM3OwogICAgICB0WzEwODVdID0gNDM7CiAgICAgIHRbMTA4Nl0gPSA0NTsKICAgIH0pOwogICAgZXhwb3J0cy5nZXRTdXBwbGVtZW50YWxHbHlwaE1hcEZvckNhbGlicmkgPSBnZXRTdXBwbGVtZW50YWxHbHlwaE1hcEZvckNhbGlicmk7CgogICAgLyoqKi99KSwgKAogIC8qIDIyMyAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgIHZhciBnZXRMb29rdXBUYWJsZUZhY3RvcnkgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE5NykuZ2V0TG9va3VwVGFibGVGYWN0b3J5OwogICAgdmFyIGdldFNwZWNpYWxQVUFTeW1ib2xzID0gZ2V0TG9va3VwVGFibGVGYWN0b3J5KGZ1bmN0aW9uICh0KSB7CiAgICAgIHRbNjM3MjFdID0gMHgwMGE5OwogICAgICB0WzYzMTkzXSA9IDB4MDBhOTsKICAgICAgdFs2MzcyMF0gPSAweDAwYWU7CiAgICAgIHRbNjMxOTRdID0gMHgwMGFlOwogICAgICB0WzYzNzIyXSA9IDB4MjEyMjsKICAgICAgdFs2MzE5NV0gPSAweDIxMjI7CiAgICAgIHRbNjM3MjldID0gMHgyM2E3OwogICAgICB0WzYzNzMwXSA9IDB4MjNhODsKICAgICAgdFs2MzczMV0gPSAweDIzYTk7CiAgICAgIHRbNjM3NDBdID0gMHgyM2FiOwogICAgICB0WzYzNzQxXSA9IDB4MjNhYzsKICAgICAgdFs2Mzc0Ml0gPSAweDIzYWQ7CiAgICAgIHRbNjM3MjZdID0gMHgyM2ExOwogICAgICB0WzYzNzI3XSA9IDB4MjNhMjsKICAgICAgdFs2MzcyOF0gPSAweDIzYTM7CiAgICAgIHRbNjM3MzddID0gMHgyM2E0OwogICAgICB0WzYzNzM4XSA9IDB4MjNhNTsKICAgICAgdFs2MzczOV0gPSAweDIzYTY7CiAgICAgIHRbNjM3MjNdID0gMHgyMzliOwogICAgICB0WzYzNzI0XSA9IDB4MjM5YzsKICAgICAgdFs2MzcyNV0gPSAweDIzOWQ7CiAgICAgIHRbNjM3MzRdID0gMHgyMzllOwogICAgICB0WzYzNzM1XSA9IDB4MjM5ZjsKICAgICAgdFs2MzczNl0gPSAweDIzYTA7CiAgICB9KTsKICAgIGZ1bmN0aW9uIG1hcFNwZWNpYWxVbmljb2RlVmFsdWVzKGNvZGUpIHsKICAgICAgaWYgKGNvZGUgPj0gMHhmZmYwICYmIGNvZGUgPD0gMHhmZmZmKSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICAgIH0gZWxzZSBpZiAoY29kZSA+PSAweGY2MDAgJiYgY29kZSA8PSAweGY4ZmYpIHsKICAgICAgICByZXR1cm4gZ2V0U3BlY2lhbFBVQVN5bWJvbHMoKVtjb2RlXSB8fCBjb2RlOwogICAgICB9IGVsc2UgaWYgKGNvZGUgPT09IDB4MDBhZCkgewogICAgICAgIHJldHVybiAweDAwMmQ7CiAgICAgIH0KICAgICAgcmV0dXJuIGNvZGU7CiAgICB9CiAgICBmdW5jdGlvbiBnZXRVbmljb2RlRm9yR2x5cGgobmFtZSwgZ2x5cGhzVW5pY29kZU1hcCkgewogICAgICB2YXIgdW5pY29kZSA9IGdseXBoc1VuaWNvZGVNYXBbbmFtZV07CiAgICAgIGlmICh1bmljb2RlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gdW5pY29kZTsKICAgICAgfQogICAgICBpZiAoIW5hbWUpIHsKICAgICAgICByZXR1cm4gLTE7CiAgICAgIH0KICAgICAgaWYgKG5hbWVbMF0gPT09ICJ1IikgewogICAgICAgIHZhciBuYW1lTGVuID0gbmFtZS5sZW5ndGgsaGV4U3RyOwogICAgICAgIGlmIChuYW1lTGVuID09PSA3ICYmIG5hbWVbMV0gPT09ICJuIiAmJiBuYW1lWzJdID09PSAiaSIpIHsKICAgICAgICAgIGhleFN0ciA9IG5hbWUuc3Vic3RyaW5nKDMpOwogICAgICAgIH0gZWxzZSBpZiAobmFtZUxlbiA+PSA1ICYmIG5hbWVMZW4gPD0gNykgewogICAgICAgICAgaGV4U3RyID0gbmFtZS5zdWJzdHJpbmcoMSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICB9CiAgICAgICAgaWYgKGhleFN0ciA9PT0gaGV4U3RyLnRvVXBwZXJDYXNlKCkpIHsKICAgICAgICAgIHVuaWNvZGUgPSBwYXJzZUludChoZXhTdHIsIDE2KTsKICAgICAgICAgIGlmICh1bmljb2RlID49IDApIHsKICAgICAgICAgICAgcmV0dXJuIHVuaWNvZGU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiAtMTsKICAgIH0KICAgIHZhciBVbmljb2RlUmFuZ2VzID0gWwogICAgewogICAgICBiZWdpbjogMHgwMDAwLAogICAgICBlbmQ6IDB4MDA3ZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4MDA4MCwKICAgICAgZW5kOiAweDAwZmYKICAgIH0sCiAgICB7CiAgICAgIGJlZ2luOiAweDAxMDAsCiAgICAgIGVuZDogMHgwMTdmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgwMTgwLAogICAgICBlbmQ6IDB4MDI0ZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4MDI1MCwKICAgICAgZW5kOiAweDAyYWYKICAgIH0sCiAgICB7CiAgICAgIGJlZ2luOiAweDAyYjAsCiAgICAgIGVuZDogMHgwMmZmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgwMzAwLAogICAgICBlbmQ6IDB4MDM2ZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4MDM3MCwKICAgICAgZW5kOiAweDAzZmYKICAgIH0sCiAgICB7CiAgICAgIGJlZ2luOiAweDJjODAsCiAgICAgIGVuZDogMHgyY2ZmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgwNDAwLAogICAgICBlbmQ6IDB4MDRmZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4MDUzMCwKICAgICAgZW5kOiAweDA1OGYKICAgIH0sCiAgICB7CiAgICAgIGJlZ2luOiAweDA1OTAsCiAgICAgIGVuZDogMHgwNWZmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHhhNTAwLAogICAgICBlbmQ6IDB4YTYzZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4MDYwMCwKICAgICAgZW5kOiAweDA2ZmYKICAgIH0sCiAgICB7CiAgICAgIGJlZ2luOiAweDA3YzAsCiAgICAgIGVuZDogMHgwN2ZmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgwOTAwLAogICAgICBlbmQ6IDB4MDk3ZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4MDk4MCwKICAgICAgZW5kOiAweDA5ZmYKICAgIH0sCiAgICB7CiAgICAgIGJlZ2luOiAweDBhMDAsCiAgICAgIGVuZDogMHgwYTdmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgwYTgwLAogICAgICBlbmQ6IDB4MGFmZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4MGIwMCwKICAgICAgZW5kOiAweDBiN2YKICAgIH0sCiAgICB7CiAgICAgIGJlZ2luOiAweDBiODAsCiAgICAgIGVuZDogMHgwYmZmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgwYzAwLAogICAgICBlbmQ6IDB4MGM3ZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4MGM4MCwKICAgICAgZW5kOiAweDBjZmYKICAgIH0sCiAgICB7CiAgICAgIGJlZ2luOiAweDBkMDAsCiAgICAgIGVuZDogMHgwZDdmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgwZTAwLAogICAgICBlbmQ6IDB4MGU3ZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4MGU4MCwKICAgICAgZW5kOiAweDBlZmYKICAgIH0sCiAgICB7CiAgICAgIGJlZ2luOiAweDEwYTAsCiAgICAgIGVuZDogMHgxMGZmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgxYjAwLAogICAgICBlbmQ6IDB4MWI3ZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4MTEwMCwKICAgICAgZW5kOiAweDExZmYKICAgIH0sCiAgICB7CiAgICAgIGJlZ2luOiAweDFlMDAsCiAgICAgIGVuZDogMHgxZWZmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgxZjAwLAogICAgICBlbmQ6IDB4MWZmZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4MjAwMCwKICAgICAgZW5kOiAweDIwNmYKICAgIH0sCiAgICB7CiAgICAgIGJlZ2luOiAweDIwNzAsCiAgICAgIGVuZDogMHgyMDlmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgyMGEwLAogICAgICBlbmQ6IDB4MjBjZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4MjBkMCwKICAgICAgZW5kOiAweDIwZmYKICAgIH0sCiAgICB7CiAgICAgIGJlZ2luOiAweDIxMDAsCiAgICAgIGVuZDogMHgyMTRmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgyMTUwLAogICAgICBlbmQ6IDB4MjE4ZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4MjE5MCwKICAgICAgZW5kOiAweDIxZmYKICAgIH0sCiAgICB7CiAgICAgIGJlZ2luOiAweDIyMDAsCiAgICAgIGVuZDogMHgyMmZmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgyMzAwLAogICAgICBlbmQ6IDB4MjNmZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4MjQwMCwKICAgICAgZW5kOiAweDI0M2YKICAgIH0sCiAgICB7CiAgICAgIGJlZ2luOiAweDI0NDAsCiAgICAgIGVuZDogMHgyNDVmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgyNDYwLAogICAgICBlbmQ6IDB4MjRmZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4MjUwMCwKICAgICAgZW5kOiAweDI1N2YKICAgIH0sCiAgICB7CiAgICAgIGJlZ2luOiAweDI1ODAsCiAgICAgIGVuZDogMHgyNTlmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgyNWEwLAogICAgICBlbmQ6IDB4MjVmZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4MjYwMCwKICAgICAgZW5kOiAweDI2ZmYKICAgIH0sCiAgICB7CiAgICAgIGJlZ2luOiAweDI3MDAsCiAgICAgIGVuZDogMHgyN2JmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgzMDAwLAogICAgICBlbmQ6IDB4MzAzZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4MzA0MCwKICAgICAgZW5kOiAweDMwOWYKICAgIH0sCiAgICB7CiAgICAgIGJlZ2luOiAweDMwYTAsCiAgICAgIGVuZDogMHgzMGZmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgzMTAwLAogICAgICBlbmQ6IDB4MzEyZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4MzEzMCwKICAgICAgZW5kOiAweDMxOGYKICAgIH0sCiAgICB7CiAgICAgIGJlZ2luOiAweGE4NDAsCiAgICAgIGVuZDogMHhhODdmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgzMjAwLAogICAgICBlbmQ6IDB4MzJmZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4MzMwMCwKICAgICAgZW5kOiAweDMzZmYKICAgIH0sCiAgICB7CiAgICAgIGJlZ2luOiAweGFjMDAsCiAgICAgIGVuZDogMHhkN2FmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHhkODAwLAogICAgICBlbmQ6IDB4ZGZmZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4MTA5MDAsCiAgICAgIGVuZDogMHgxMDkxZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4NGUwMCwKICAgICAgZW5kOiAweDlmZmYKICAgIH0sCiAgICB7CiAgICAgIGJlZ2luOiAweGUwMDAsCiAgICAgIGVuZDogMHhmOGZmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgzMWMwLAogICAgICBlbmQ6IDB4MzFlZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4ZmIwMCwKICAgICAgZW5kOiAweGZiNGYKICAgIH0sCiAgICB7CiAgICAgIGJlZ2luOiAweGZiNTAsCiAgICAgIGVuZDogMHhmZGZmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHhmZTIwLAogICAgICBlbmQ6IDB4ZmUyZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4ZmUxMCwKICAgICAgZW5kOiAweGZlMWYKICAgIH0sCiAgICB7CiAgICAgIGJlZ2luOiAweGZlNTAsCiAgICAgIGVuZDogMHhmZTZmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHhmZTcwLAogICAgICBlbmQ6IDB4ZmVmZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4ZmYwMCwKICAgICAgZW5kOiAweGZmZWYKICAgIH0sCiAgICB7CiAgICAgIGJlZ2luOiAweGZmZjAsCiAgICAgIGVuZDogMHhmZmZmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgwZjAwLAogICAgICBlbmQ6IDB4MGZmZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4MDcwMCwKICAgICAgZW5kOiAweDA3NGYKICAgIH0sCiAgICB7CiAgICAgIGJlZ2luOiAweDA3ODAsCiAgICAgIGVuZDogMHgwN2JmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgwZDgwLAogICAgICBlbmQ6IDB4MGRmZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4MTAwMCwKICAgICAgZW5kOiAweDEwOWYKICAgIH0sCiAgICB7CiAgICAgIGJlZ2luOiAweDEyMDAsCiAgICAgIGVuZDogMHgxMzdmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgxM2EwLAogICAgICBlbmQ6IDB4MTNmZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4MTQwMCwKICAgICAgZW5kOiAweDE2N2YKICAgIH0sCiAgICB7CiAgICAgIGJlZ2luOiAweDE2ODAsCiAgICAgIGVuZDogMHgxNjlmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgxNmEwLAogICAgICBlbmQ6IDB4MTZmZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4MTc4MCwKICAgICAgZW5kOiAweDE3ZmYKICAgIH0sCiAgICB7CiAgICAgIGJlZ2luOiAweDE4MDAsCiAgICAgIGVuZDogMHgxOGFmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgyODAwLAogICAgICBlbmQ6IDB4MjhmZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4YTAwMCwKICAgICAgZW5kOiAweGE0OGYKICAgIH0sCiAgICB7CiAgICAgIGJlZ2luOiAweDE3MDAsCiAgICAgIGVuZDogMHgxNzFmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgxMDMwMCwKICAgICAgZW5kOiAweDEwMzJmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgxMDMzMCwKICAgICAgZW5kOiAweDEwMzRmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgxMDQwMCwKICAgICAgZW5kOiAweDEwNDRmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgxZDAwMCwKICAgICAgZW5kOiAweDFkMGZmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgxZDQwMCwKICAgICAgZW5kOiAweDFkN2ZmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHhmZjAwMCwKICAgICAgZW5kOiAweGZmZmZkCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHhmZTAwLAogICAgICBlbmQ6IDB4ZmUwZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4ZTAwMDAsCiAgICAgIGVuZDogMHhlMDA3ZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4MTkwMCwKICAgICAgZW5kOiAweDE5NGYKICAgIH0sCiAgICB7CiAgICAgIGJlZ2luOiAweDE5NTAsCiAgICAgIGVuZDogMHgxOTdmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgxOTgwLAogICAgICBlbmQ6IDB4MTlkZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4MWEwMCwKICAgICAgZW5kOiAweDFhMWYKICAgIH0sCiAgICB7CiAgICAgIGJlZ2luOiAweDJjMDAsCiAgICAgIGVuZDogMHgyYzVmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgyZDMwLAogICAgICBlbmQ6IDB4MmQ3ZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4NGRjMCwKICAgICAgZW5kOiAweDRkZmYKICAgIH0sCiAgICB7CiAgICAgIGJlZ2luOiAweGE4MDAsCiAgICAgIGVuZDogMHhhODJmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgxMDAwMCwKICAgICAgZW5kOiAweDEwMDdmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgxMDE0MCwKICAgICAgZW5kOiAweDEwMThmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgxMDM4MCwKICAgICAgZW5kOiAweDEwMzlmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgxMDNhMCwKICAgICAgZW5kOiAweDEwM2RmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgxMDQ1MCwKICAgICAgZW5kOiAweDEwNDdmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgxMDQ4MCwKICAgICAgZW5kOiAweDEwNGFmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgxMDgwMCwKICAgICAgZW5kOiAweDEwODNmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgxMGEwMCwKICAgICAgZW5kOiAweDEwYTVmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgxZDMwMCwKICAgICAgZW5kOiAweDFkMzVmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgxMjAwMCwKICAgICAgZW5kOiAweDEyM2ZmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgxZDM2MCwKICAgICAgZW5kOiAweDFkMzdmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHgxYjgwLAogICAgICBlbmQ6IDB4MWJiZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4MWMwMCwKICAgICAgZW5kOiAweDFjNGYKICAgIH0sCiAgICB7CiAgICAgIGJlZ2luOiAweDFjNTAsCiAgICAgIGVuZDogMHgxYzdmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHhhODgwLAogICAgICBlbmQ6IDB4YThkZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4YTkwMCwKICAgICAgZW5kOiAweGE5MmYKICAgIH0sCiAgICB7CiAgICAgIGJlZ2luOiAweGE5MzAsCiAgICAgIGVuZDogMHhhOTVmCiAgICB9LAogICAgewogICAgICBiZWdpbjogMHhhYTAwLAogICAgICBlbmQ6IDB4YWE1ZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4MTAxOTAsCiAgICAgIGVuZDogMHgxMDFjZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4MTAxZDAsCiAgICAgIGVuZDogMHgxMDFmZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4MTAyYTAsCiAgICAgIGVuZDogMHgxMDJkZgogICAgfSwKICAgIHsKICAgICAgYmVnaW46IDB4MWYwMzAsCiAgICAgIGVuZDogMHgxZjA5ZgogICAgfV07CgogICAgZnVuY3Rpb24gZ2V0VW5pY29kZVJhbmdlRm9yKHZhbHVlKSB7CiAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IFVuaWNvZGVSYW5nZXMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgIHZhciByYW5nZSA9IFVuaWNvZGVSYW5nZXNbaV07CiAgICAgICAgaWYgKHZhbHVlID49IHJhbmdlLmJlZ2luICYmIHZhbHVlIDwgcmFuZ2UuZW5kKSB7CiAgICAgICAgICByZXR1cm4gaTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIC0xOwogICAgfQogICAgZnVuY3Rpb24gaXNSVExSYW5nZUZvcih2YWx1ZSkgewogICAgICB2YXIgcmFuZ2UgPSBVbmljb2RlUmFuZ2VzWzEzXTsKICAgICAgaWYgKHZhbHVlID49IHJhbmdlLmJlZ2luICYmIHZhbHVlIDwgcmFuZ2UuZW5kKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgcmFuZ2UgPSBVbmljb2RlUmFuZ2VzWzExXTsKICAgICAgaWYgKHZhbHVlID49IHJhbmdlLmJlZ2luICYmIHZhbHVlIDwgcmFuZ2UuZW5kKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgdmFyIGdldE5vcm1hbGl6ZWRVbmljb2RlcyA9IGdldExvb2t1cFRhYmxlRmFjdG9yeShmdW5jdGlvbiAodCkgewogICAgICB0WyJceEE4Il0gPSAiIFx1MDMwOCI7CiAgICAgIHRbIlx4QUYiXSA9ICIgXHUwMzA0IjsKICAgICAgdFsiXHhCNCJdID0gIiBcdTAzMDEiOwogICAgICB0WyJceEI1Il0gPSAiXHUwM0JDIjsKICAgICAgdFsiXHhCOCJdID0gIiBcdTAzMjciOwogICAgICB0WyJcdTAxMzIiXSA9ICJJSiI7CiAgICAgIHRbIlx1MDEzMyJdID0gImlqIjsKICAgICAgdFsiXHUwMTNGIl0gPSAiTFx4QjciOwogICAgICB0WyJcdTAxNDAiXSA9ICJsXHhCNyI7CiAgICAgIHRbIlx1MDE0OSJdID0gIlx1MDJCQ24iOwogICAgICB0WyJcdTAxN0YiXSA9ICJzIjsKICAgICAgdFsiXHUwMUM0Il0gPSAiRFx1MDE3RCI7CiAgICAgIHRbIlx1MDFDNSJdID0gIkRcdTAxN0UiOwogICAgICB0WyJcdTAxQzYiXSA9ICJkXHUwMTdFIjsKICAgICAgdFsiXHUwMUM3Il0gPSAiTEoiOwogICAgICB0WyJcdTAxQzgiXSA9ICJMaiI7CiAgICAgIHRbIlx1MDFDOSJdID0gImxqIjsKICAgICAgdFsiXHUwMUNBIl0gPSAiTkoiOwogICAgICB0WyJcdTAxQ0IiXSA9ICJOaiI7CiAgICAgIHRbIlx1MDFDQyJdID0gIm5qIjsKICAgICAgdFsiXHUwMUYxIl0gPSAiRFoiOwogICAgICB0WyJcdTAxRjIiXSA9ICJEeiI7CiAgICAgIHRbIlx1MDFGMyJdID0gImR6IjsKICAgICAgdFsiXHUwMkQ4Il0gPSAiIFx1MDMwNiI7CiAgICAgIHRbIlx1MDJEOSJdID0gIiBcdTAzMDciOwogICAgICB0WyJcdTAyREEiXSA9ICIgXHUwMzBBIjsKICAgICAgdFsiXHUwMkRCIl0gPSAiIFx1MDMyOCI7CiAgICAgIHRbIlx1MDJEQyJdID0gIiBcdTAzMDMiOwogICAgICB0WyJcdTAyREQiXSA9ICIgXHUwMzBCIjsKICAgICAgdFsiXHUwMzdBIl0gPSAiIFx1MDM0NSI7CiAgICAgIHRbIlx1MDM4NCJdID0gIiBcdTAzMDEiOwogICAgICB0WyJcdTAzRDAiXSA9ICJcdTAzQjIiOwogICAgICB0WyJcdTAzRDEiXSA9ICJcdTAzQjgiOwogICAgICB0WyJcdTAzRDIiXSA9ICJcdTAzQTUiOwogICAgICB0WyJcdTAzRDUiXSA9ICJcdTAzQzYiOwogICAgICB0WyJcdTAzRDYiXSA9ICJcdTAzQzAiOwogICAgICB0WyJcdTAzRjAiXSA9ICJcdTAzQkEiOwogICAgICB0WyJcdTAzRjEiXSA9ICJcdTAzQzEiOwogICAgICB0WyJcdTAzRjIiXSA9ICJcdTAzQzIiOwogICAgICB0WyJcdTAzRjQiXSA9ICJcdTAzOTgiOwogICAgICB0WyJcdTAzRjUiXSA9ICJcdTAzQjUiOwogICAgICB0WyJcdTAzRjkiXSA9ICJcdTAzQTMiOwogICAgICB0WyJcdTA1ODciXSA9ICJcdTA1NjVcdTA1ODIiOwogICAgICB0WyJcdTA2NzUiXSA9ICJcdTA2MjdcdTA2NzQiOwogICAgICB0WyJcdTA2NzYiXSA9ICJcdTA2NDhcdTA2NzQiOwogICAgICB0WyJcdTA2NzciXSA9ICJcdTA2QzdcdTA2NzQiOwogICAgICB0WyJcdTA2NzgiXSA9ICJcdTA2NEFcdTA2NzQiOwogICAgICB0WyJcdTBFMzMiXSA9ICJcdTBFNERcdTBFMzIiOwogICAgICB0WyJcdTBFQjMiXSA9ICJcdTBFQ0RcdTBFQjIiOwogICAgICB0WyJcdTBFREMiXSA9ICJcdTBFQUJcdTBFOTkiOwogICAgICB0WyJcdTBFREQiXSA9ICJcdTBFQUJcdTBFQTEiOwogICAgICB0WyJcdTBGNzciXSA9ICJcdTBGQjJcdTBGODEiOwogICAgICB0WyJcdTBGNzkiXSA9ICJcdTBGQjNcdTBGODEiOwogICAgICB0WyJcdTFFOUEiXSA9ICJhXHUwMkJFIjsKICAgICAgdFsiXHUxRkJEIl0gPSAiIFx1MDMxMyI7CiAgICAgIHRbIlx1MUZCRiJdID0gIiBcdTAzMTMiOwogICAgICB0WyJcdTFGQzAiXSA9ICIgXHUwMzQyIjsKICAgICAgdFsiXHUxRkZFIl0gPSAiIFx1MDMxNCI7CiAgICAgIHRbIlx1MjAwMiJdID0gIiAiOwogICAgICB0WyJcdTIwMDMiXSA9ICIgIjsKICAgICAgdFsiXHUyMDA0Il0gPSAiICI7CiAgICAgIHRbIlx1MjAwNSJdID0gIiAiOwogICAgICB0WyJcdTIwMDYiXSA9ICIgIjsKICAgICAgdFsiXHUyMDA4Il0gPSAiICI7CiAgICAgIHRbIlx1MjAwOSJdID0gIiAiOwogICAgICB0WyJcdTIwMEEiXSA9ICIgIjsKICAgICAgdFsiXHUyMDE3Il0gPSAiIFx1MDMzMyI7CiAgICAgIHRbIlx1MjAyNCJdID0gIi4iOwogICAgICB0WyJcdTIwMjUiXSA9ICIuLiI7CiAgICAgIHRbIlx1MjAyNiJdID0gIi4uLiI7CiAgICAgIHRbIlx1MjAzMyJdID0gIlx1MjAzMlx1MjAzMiI7CiAgICAgIHRbIlx1MjAzNCJdID0gIlx1MjAzMlx1MjAzMlx1MjAzMiI7CiAgICAgIHRbIlx1MjAzNiJdID0gIlx1MjAzNVx1MjAzNSI7CiAgICAgIHRbIlx1MjAzNyJdID0gIlx1MjAzNVx1MjAzNVx1MjAzNSI7CiAgICAgIHRbIlx1MjAzQyJdID0gIiEhIjsKICAgICAgdFsiXHUyMDNFIl0gPSAiIFx1MDMwNSI7CiAgICAgIHRbIlx1MjA0NyJdID0gIj8/IjsKICAgICAgdFsiXHUyMDQ4Il0gPSAiPyEiOwogICAgICB0WyJcdTIwNDkiXSA9ICIhPyI7CiAgICAgIHRbIlx1MjA1NyJdID0gIlx1MjAzMlx1MjAzMlx1MjAzMlx1MjAzMiI7CiAgICAgIHRbIlx1MjA1RiJdID0gIiAiOwogICAgICB0WyJcdTIwQTgiXSA9ICJScyI7CiAgICAgIHRbIlx1MjEwMCJdID0gImEvYyI7CiAgICAgIHRbIlx1MjEwMSJdID0gImEvcyI7CiAgICAgIHRbIlx1MjEwMyJdID0gIlx4QjBDIjsKICAgICAgdFsiXHUyMTA1Il0gPSAiYy9vIjsKICAgICAgdFsiXHUyMTA2Il0gPSAiYy91IjsKICAgICAgdFsiXHUyMTA3Il0gPSAiXHUwMTkwIjsKICAgICAgdFsiXHUyMTA5Il0gPSAiXHhCMEYiOwogICAgICB0WyJcdTIxMTYiXSA9ICJObyI7CiAgICAgIHRbIlx1MjEyMSJdID0gIlRFTCI7CiAgICAgIHRbIlx1MjEzNSJdID0gIlx1MDVEMCI7CiAgICAgIHRbIlx1MjEzNiJdID0gIlx1MDVEMSI7CiAgICAgIHRbIlx1MjEzNyJdID0gIlx1MDVEMiI7CiAgICAgIHRbIlx1MjEzOCJdID0gIlx1MDVEMyI7CiAgICAgIHRbIlx1MjEzQiJdID0gIkZBWCI7CiAgICAgIHRbIlx1MjE2MCJdID0gIkkiOwogICAgICB0WyJcdTIxNjEiXSA9ICJJSSI7CiAgICAgIHRbIlx1MjE2MiJdID0gIklJSSI7CiAgICAgIHRbIlx1MjE2MyJdID0gIklWIjsKICAgICAgdFsiXHUyMTY0Il0gPSAiViI7CiAgICAgIHRbIlx1MjE2NSJdID0gIlZJIjsKICAgICAgdFsiXHUyMTY2Il0gPSAiVklJIjsKICAgICAgdFsiXHUyMTY3Il0gPSAiVklJSSI7CiAgICAgIHRbIlx1MjE2OCJdID0gIklYIjsKICAgICAgdFsiXHUyMTY5Il0gPSAiWCI7CiAgICAgIHRbIlx1MjE2QSJdID0gIlhJIjsKICAgICAgdFsiXHUyMTZCIl0gPSAiWElJIjsKICAgICAgdFsiXHUyMTZDIl0gPSAiTCI7CiAgICAgIHRbIlx1MjE2RCJdID0gIkMiOwogICAgICB0WyJcdTIxNkUiXSA9ICJEIjsKICAgICAgdFsiXHUyMTZGIl0gPSAiTSI7CiAgICAgIHRbIlx1MjE3MCJdID0gImkiOwogICAgICB0WyJcdTIxNzEiXSA9ICJpaSI7CiAgICAgIHRbIlx1MjE3MiJdID0gImlpaSI7CiAgICAgIHRbIlx1MjE3MyJdID0gIml2IjsKICAgICAgdFsiXHUyMTc0Il0gPSAidiI7CiAgICAgIHRbIlx1MjE3NSJdID0gInZpIjsKICAgICAgdFsiXHUyMTc2Il0gPSAidmlpIjsKICAgICAgdFsiXHUyMTc3Il0gPSAidmlpaSI7CiAgICAgIHRbIlx1MjE3OCJdID0gIml4IjsKICAgICAgdFsiXHUyMTc5Il0gPSAieCI7CiAgICAgIHRbIlx1MjE3QSJdID0gInhpIjsKICAgICAgdFsiXHUyMTdCIl0gPSAieGlpIjsKICAgICAgdFsiXHUyMTdDIl0gPSAibCI7CiAgICAgIHRbIlx1MjE3RCJdID0gImMiOwogICAgICB0WyJcdTIxN0UiXSA9ICJkIjsKICAgICAgdFsiXHUyMTdGIl0gPSAibSI7CiAgICAgIHRbIlx1MjIyQyJdID0gIlx1MjIyQlx1MjIyQiI7CiAgICAgIHRbIlx1MjIyRCJdID0gIlx1MjIyQlx1MjIyQlx1MjIyQiI7CiAgICAgIHRbIlx1MjIyRiJdID0gIlx1MjIyRVx1MjIyRSI7CiAgICAgIHRbIlx1MjIzMCJdID0gIlx1MjIyRVx1MjIyRVx1MjIyRSI7CiAgICAgIHRbIlx1MjQ3NCJdID0gIigxKSI7CiAgICAgIHRbIlx1MjQ3NSJdID0gIigyKSI7CiAgICAgIHRbIlx1MjQ3NiJdID0gIigzKSI7CiAgICAgIHRbIlx1MjQ3NyJdID0gIig0KSI7CiAgICAgIHRbIlx1MjQ3OCJdID0gIig1KSI7CiAgICAgIHRbIlx1MjQ3OSJdID0gIig2KSI7CiAgICAgIHRbIlx1MjQ3QSJdID0gIig3KSI7CiAgICAgIHRbIlx1MjQ3QiJdID0gIig4KSI7CiAgICAgIHRbIlx1MjQ3QyJdID0gIig5KSI7CiAgICAgIHRbIlx1MjQ3RCJdID0gIigxMCkiOwogICAgICB0WyJcdTI0N0UiXSA9ICIoMTEpIjsKICAgICAgdFsiXHUyNDdGIl0gPSAiKDEyKSI7CiAgICAgIHRbIlx1MjQ4MCJdID0gIigxMykiOwogICAgICB0WyJcdTI0ODEiXSA9ICIoMTQpIjsKICAgICAgdFsiXHUyNDgyIl0gPSAiKDE1KSI7CiAgICAgIHRbIlx1MjQ4MyJdID0gIigxNikiOwogICAgICB0WyJcdTI0ODQiXSA9ICIoMTcpIjsKICAgICAgdFsiXHUyNDg1Il0gPSAiKDE4KSI7CiAgICAgIHRbIlx1MjQ4NiJdID0gIigxOSkiOwogICAgICB0WyJcdTI0ODciXSA9ICIoMjApIjsKICAgICAgdFsiXHUyNDg4Il0gPSAiMS4iOwogICAgICB0WyJcdTI0ODkiXSA9ICIyLiI7CiAgICAgIHRbIlx1MjQ4QSJdID0gIjMuIjsKICAgICAgdFsiXHUyNDhCIl0gPSAiNC4iOwogICAgICB0WyJcdTI0OEMiXSA9ICI1LiI7CiAgICAgIHRbIlx1MjQ4RCJdID0gIjYuIjsKICAgICAgdFsiXHUyNDhFIl0gPSAiNy4iOwogICAgICB0WyJcdTI0OEYiXSA9ICI4LiI7CiAgICAgIHRbIlx1MjQ5MCJdID0gIjkuIjsKICAgICAgdFsiXHUyNDkxIl0gPSAiMTAuIjsKICAgICAgdFsiXHUyNDkyIl0gPSAiMTEuIjsKICAgICAgdFsiXHUyNDkzIl0gPSAiMTIuIjsKICAgICAgdFsiXHUyNDk0Il0gPSAiMTMuIjsKICAgICAgdFsiXHUyNDk1Il0gPSAiMTQuIjsKICAgICAgdFsiXHUyNDk2Il0gPSAiMTUuIjsKICAgICAgdFsiXHUyNDk3Il0gPSAiMTYuIjsKICAgICAgdFsiXHUyNDk4Il0gPSAiMTcuIjsKICAgICAgdFsiXHUyNDk5Il0gPSAiMTguIjsKICAgICAgdFsiXHUyNDlBIl0gPSAiMTkuIjsKICAgICAgdFsiXHUyNDlCIl0gPSAiMjAuIjsKICAgICAgdFsiXHUyNDlDIl0gPSAiKGEpIjsKICAgICAgdFsiXHUyNDlEIl0gPSAiKGIpIjsKICAgICAgdFsiXHUyNDlFIl0gPSAiKGMpIjsKICAgICAgdFsiXHUyNDlGIl0gPSAiKGQpIjsKICAgICAgdFsiXHUyNEEwIl0gPSAiKGUpIjsKICAgICAgdFsiXHUyNEExIl0gPSAiKGYpIjsKICAgICAgdFsiXHUyNEEyIl0gPSAiKGcpIjsKICAgICAgdFsiXHUyNEEzIl0gPSAiKGgpIjsKICAgICAgdFsiXHUyNEE0Il0gPSAiKGkpIjsKICAgICAgdFsiXHUyNEE1Il0gPSAiKGopIjsKICAgICAgdFsiXHUyNEE2Il0gPSAiKGspIjsKICAgICAgdFsiXHUyNEE3Il0gPSAiKGwpIjsKICAgICAgdFsiXHUyNEE4Il0gPSAiKG0pIjsKICAgICAgdFsiXHUyNEE5Il0gPSAiKG4pIjsKICAgICAgdFsiXHUyNEFBIl0gPSAiKG8pIjsKICAgICAgdFsiXHUyNEFCIl0gPSAiKHApIjsKICAgICAgdFsiXHUyNEFDIl0gPSAiKHEpIjsKICAgICAgdFsiXHUyNEFEIl0gPSAiKHIpIjsKICAgICAgdFsiXHUyNEFFIl0gPSAiKHMpIjsKICAgICAgdFsiXHUyNEFGIl0gPSAiKHQpIjsKICAgICAgdFsiXHUyNEIwIl0gPSAiKHUpIjsKICAgICAgdFsiXHUyNEIxIl0gPSAiKHYpIjsKICAgICAgdFsiXHUyNEIyIl0gPSAiKHcpIjsKICAgICAgdFsiXHUyNEIzIl0gPSAiKHgpIjsKICAgICAgdFsiXHUyNEI0Il0gPSAiKHkpIjsKICAgICAgdFsiXHUyNEI1Il0gPSAiKHopIjsKICAgICAgdFsiXHUyQTBDIl0gPSAiXHUyMjJCXHUyMjJCXHUyMjJCXHUyMjJCIjsKICAgICAgdFsiXHUyQTc0Il0gPSAiOjo9IjsKICAgICAgdFsiXHUyQTc1Il0gPSAiPT0iOwogICAgICB0WyJcdTJBNzYiXSA9ICI9PT0iOwogICAgICB0WyJcdTJFOUYiXSA9ICJcdTZCQ0QiOwogICAgICB0WyJcdTJFRjMiXSA9ICJcdTlGOUYiOwogICAgICB0WyJcdTJGMDAiXSA9ICJcdTRFMDAiOwogICAgICB0WyJcdTJGMDEiXSA9ICJcdTRFMjgiOwogICAgICB0WyJcdTJGMDIiXSA9ICJcdTRFMzYiOwogICAgICB0WyJcdTJGMDMiXSA9ICJcdTRFM0YiOwogICAgICB0WyJcdTJGMDQiXSA9ICJcdTRFNTkiOwogICAgICB0WyJcdTJGMDUiXSA9ICJcdTRFODUiOwogICAgICB0WyJcdTJGMDYiXSA9ICJcdTRFOEMiOwogICAgICB0WyJcdTJGMDciXSA9ICJcdTRFQTAiOwogICAgICB0WyJcdTJGMDgiXSA9ICJcdTRFQkEiOwogICAgICB0WyJcdTJGMDkiXSA9ICJcdTUxM0YiOwogICAgICB0WyJcdTJGMEEiXSA9ICJcdTUxNjUiOwogICAgICB0WyJcdTJGMEIiXSA9ICJcdTUxNkIiOwogICAgICB0WyJcdTJGMEMiXSA9ICJcdTUxODIiOwogICAgICB0WyJcdTJGMEQiXSA9ICJcdTUxOTYiOwogICAgICB0WyJcdTJGMEUiXSA9ICJcdTUxQUIiOwogICAgICB0WyJcdTJGMEYiXSA9ICJcdTUxRTAiOwogICAgICB0WyJcdTJGMTAiXSA9ICJcdTUxRjUiOwogICAgICB0WyJcdTJGMTEiXSA9ICJcdTUyMDAiOwogICAgICB0WyJcdTJGMTIiXSA9ICJcdTUyOUIiOwogICAgICB0WyJcdTJGMTMiXSA9ICJcdTUyRjkiOwogICAgICB0WyJcdTJGMTQiXSA9ICJcdTUzMTUiOwogICAgICB0WyJcdTJGMTUiXSA9ICJcdTUzMUEiOwogICAgICB0WyJcdTJGMTYiXSA9ICJcdTUzMzgiOwogICAgICB0WyJcdTJGMTciXSA9ICJcdTUzNDEiOwogICAgICB0WyJcdTJGMTgiXSA9ICJcdTUzNUMiOwogICAgICB0WyJcdTJGMTkiXSA9ICJcdTUzNjkiOwogICAgICB0WyJcdTJGMUEiXSA9ICJcdTUzODIiOwogICAgICB0WyJcdTJGMUIiXSA9ICJcdTUzQjYiOwogICAgICB0WyJcdTJGMUMiXSA9ICJcdTUzQzgiOwogICAgICB0WyJcdTJGMUQiXSA9ICJcdTUzRTMiOwogICAgICB0WyJcdTJGMUUiXSA9ICJcdTU2RDciOwogICAgICB0WyJcdTJGMUYiXSA9ICJcdTU3MUYiOwogICAgICB0WyJcdTJGMjAiXSA9ICJcdTU4RUIiOwogICAgICB0WyJcdTJGMjEiXSA9ICJcdTU5MDIiOwogICAgICB0WyJcdTJGMjIiXSA9ICJcdTU5MEEiOwogICAgICB0WyJcdTJGMjMiXSA9ICJcdTU5MTUiOwogICAgICB0WyJcdTJGMjQiXSA9ICJcdTU5MjciOwogICAgICB0WyJcdTJGMjUiXSA9ICJcdTU5NzMiOwogICAgICB0WyJcdTJGMjYiXSA9ICJcdTVCNTAiOwogICAgICB0WyJcdTJGMjciXSA9ICJcdTVCODAiOwogICAgICB0WyJcdTJGMjgiXSA9ICJcdTVCRjgiOwogICAgICB0WyJcdTJGMjkiXSA9ICJcdTVDMEYiOwogICAgICB0WyJcdTJGMkEiXSA9ICJcdTVDMjIiOwogICAgICB0WyJcdTJGMkIiXSA9ICJcdTVDMzgiOwogICAgICB0WyJcdTJGMkMiXSA9ICJcdTVDNkUiOwogICAgICB0WyJcdTJGMkQiXSA9ICJcdTVDNzEiOwogICAgICB0WyJcdTJGMkUiXSA9ICJcdTVEREIiOwogICAgICB0WyJcdTJGMkYiXSA9ICJcdTVERTUiOwogICAgICB0WyJcdTJGMzAiXSA9ICJcdTVERjEiOwogICAgICB0WyJcdTJGMzEiXSA9ICJcdTVERkUiOwogICAgICB0WyJcdTJGMzIiXSA9ICJcdTVFNzIiOwogICAgICB0WyJcdTJGMzMiXSA9ICJcdTVFN0EiOwogICAgICB0WyJcdTJGMzQiXSA9ICJcdTVFN0YiOwogICAgICB0WyJcdTJGMzUiXSA9ICJcdTVFRjQiOwogICAgICB0WyJcdTJGMzYiXSA9ICJcdTVFRkUiOwogICAgICB0WyJcdTJGMzciXSA9ICJcdTVGMEIiOwogICAgICB0WyJcdTJGMzgiXSA9ICJcdTVGMTMiOwogICAgICB0WyJcdTJGMzkiXSA9ICJcdTVGNTAiOwogICAgICB0WyJcdTJGM0EiXSA9ICJcdTVGNjEiOwogICAgICB0WyJcdTJGM0IiXSA9ICJcdTVGNzMiOwogICAgICB0WyJcdTJGM0MiXSA9ICJcdTVGQzMiOwogICAgICB0WyJcdTJGM0QiXSA9ICJcdTYyMDgiOwogICAgICB0WyJcdTJGM0UiXSA9ICJcdTYyMzYiOwogICAgICB0WyJcdTJGM0YiXSA9ICJcdTYyNEIiOwogICAgICB0WyJcdTJGNDAiXSA9ICJcdTY1MkYiOwogICAgICB0WyJcdTJGNDEiXSA9ICJcdTY1MzQiOwogICAgICB0WyJcdTJGNDIiXSA9ICJcdTY1ODciOwogICAgICB0WyJcdTJGNDMiXSA9ICJcdTY1OTciOwogICAgICB0WyJcdTJGNDQiXSA9ICJcdTY1QTQiOwogICAgICB0WyJcdTJGNDUiXSA9ICJcdTY1QjkiOwogICAgICB0WyJcdTJGNDYiXSA9ICJcdTY1RTAiOwogICAgICB0WyJcdTJGNDciXSA9ICJcdTY1RTUiOwogICAgICB0WyJcdTJGNDgiXSA9ICJcdTY2RjAiOwogICAgICB0WyJcdTJGNDkiXSA9ICJcdTY3MDgiOwogICAgICB0WyJcdTJGNEEiXSA9ICJcdTY3MjgiOwogICAgICB0WyJcdTJGNEIiXSA9ICJcdTZCMjAiOwogICAgICB0WyJcdTJGNEMiXSA9ICJcdTZCNjIiOwogICAgICB0WyJcdTJGNEQiXSA9ICJcdTZCNzkiOwogICAgICB0WyJcdTJGNEUiXSA9ICJcdTZCQjMiOwogICAgICB0WyJcdTJGNEYiXSA9ICJcdTZCQ0IiOwogICAgICB0WyJcdTJGNTAiXSA9ICJcdTZCRDQiOwogICAgICB0WyJcdTJGNTEiXSA9ICJcdTZCREIiOwogICAgICB0WyJcdTJGNTIiXSA9ICJcdTZDMEYiOwogICAgICB0WyJcdTJGNTMiXSA9ICJcdTZDMTQiOwogICAgICB0WyJcdTJGNTQiXSA9ICJcdTZDMzQiOwogICAgICB0WyJcdTJGNTUiXSA9ICJcdTcwNkIiOwogICAgICB0WyJcdTJGNTYiXSA9ICJcdTcyMkEiOwogICAgICB0WyJcdTJGNTciXSA9ICJcdTcyMzYiOwogICAgICB0WyJcdTJGNTgiXSA9ICJcdTcyM0IiOwogICAgICB0WyJcdTJGNTkiXSA9ICJcdTcyM0YiOwogICAgICB0WyJcdTJGNUEiXSA9ICJcdTcyNDciOwogICAgICB0WyJcdTJGNUIiXSA9ICJcdTcyNTkiOwogICAgICB0WyJcdTJGNUMiXSA9ICJcdTcyNUIiOwogICAgICB0WyJcdTJGNUQiXSA9ICJcdTcyQUMiOwogICAgICB0WyJcdTJGNUUiXSA9ICJcdTczODQiOwogICAgICB0WyJcdTJGNUYiXSA9ICJcdTczODkiOwogICAgICB0WyJcdTJGNjAiXSA9ICJcdTc0REMiOwogICAgICB0WyJcdTJGNjEiXSA9ICJcdTc0RTYiOwogICAgICB0WyJcdTJGNjIiXSA9ICJcdTc1MTgiOwogICAgICB0WyJcdTJGNjMiXSA9ICJcdTc1MUYiOwogICAgICB0WyJcdTJGNjQiXSA9ICJcdTc1MjgiOwogICAgICB0WyJcdTJGNjUiXSA9ICJcdTc1MzAiOwogICAgICB0WyJcdTJGNjYiXSA9ICJcdTc1OEIiOwogICAgICB0WyJcdTJGNjciXSA9ICJcdTc1OTIiOwogICAgICB0WyJcdTJGNjgiXSA9ICJcdTc2NzYiOwogICAgICB0WyJcdTJGNjkiXSA9ICJcdTc2N0QiOwogICAgICB0WyJcdTJGNkEiXSA9ICJcdTc2QUUiOwogICAgICB0WyJcdTJGNkIiXSA9ICJcdTc2QkYiOwogICAgICB0WyJcdTJGNkMiXSA9ICJcdTc2RUUiOwogICAgICB0WyJcdTJGNkQiXSA9ICJcdTc3REIiOwogICAgICB0WyJcdTJGNkUiXSA9ICJcdTc3RTIiOwogICAgICB0WyJcdTJGNkYiXSA9ICJcdTc3RjMiOwogICAgICB0WyJcdTJGNzAiXSA9ICJcdTc5M0EiOwogICAgICB0WyJcdTJGNzEiXSA9ICJcdTc5QjgiOwogICAgICB0WyJcdTJGNzIiXSA9ICJcdTc5QkUiOwogICAgICB0WyJcdTJGNzMiXSA9ICJcdTdBNzQiOwogICAgICB0WyJcdTJGNzQiXSA9ICJcdTdBQ0IiOwogICAgICB0WyJcdTJGNzUiXSA9ICJcdTdBRjkiOwogICAgICB0WyJcdTJGNzYiXSA9ICJcdTdDNzMiOwogICAgICB0WyJcdTJGNzciXSA9ICJcdTdDRjgiOwogICAgICB0WyJcdTJGNzgiXSA9ICJcdTdGMzYiOwogICAgICB0WyJcdTJGNzkiXSA9ICJcdTdGNTEiOwogICAgICB0WyJcdTJGN0EiXSA9ICJcdTdGOEEiOwogICAgICB0WyJcdTJGN0IiXSA9ICJcdTdGQkQiOwogICAgICB0WyJcdTJGN0MiXSA9ICJcdTgwMDEiOwogICAgICB0WyJcdTJGN0QiXSA9ICJcdTgwMEMiOwogICAgICB0WyJcdTJGN0UiXSA9ICJcdTgwMTIiOwogICAgICB0WyJcdTJGN0YiXSA9ICJcdTgwMzMiOwogICAgICB0WyJcdTJGODAiXSA9ICJcdTgwN0YiOwogICAgICB0WyJcdTJGODEiXSA9ICJcdTgwODkiOwogICAgICB0WyJcdTJGODIiXSA9ICJcdTgxRTMiOwogICAgICB0WyJcdTJGODMiXSA9ICJcdTgxRUEiOwogICAgICB0WyJcdTJGODQiXSA9ICJcdTgxRjMiOwogICAgICB0WyJcdTJGODUiXSA9ICJcdTgxRkMiOwogICAgICB0WyJcdTJGODYiXSA9ICJcdTgyMEMiOwogICAgICB0WyJcdTJGODciXSA9ICJcdTgyMUIiOwogICAgICB0WyJcdTJGODgiXSA9ICJcdTgyMUYiOwogICAgICB0WyJcdTJGODkiXSA9ICJcdTgyNkUiOwogICAgICB0WyJcdTJGOEEiXSA9ICJcdTgyNzIiOwogICAgICB0WyJcdTJGOEIiXSA9ICJcdTgyNzgiOwogICAgICB0WyJcdTJGOEMiXSA9ICJcdTg2NEQiOwogICAgICB0WyJcdTJGOEQiXSA9ICJcdTg2NkIiOwogICAgICB0WyJcdTJGOEUiXSA9ICJcdTg4NDAiOwogICAgICB0WyJcdTJGOEYiXSA9ICJcdTg4NEMiOwogICAgICB0WyJcdTJGOTAiXSA9ICJcdTg4NjMiOwogICAgICB0WyJcdTJGOTEiXSA9ICJcdTg5N0UiOwogICAgICB0WyJcdTJGOTIiXSA9ICJcdTg5OEIiOwogICAgICB0WyJcdTJGOTMiXSA9ICJcdTg5RDIiOwogICAgICB0WyJcdTJGOTQiXSA9ICJcdThBMDAiOwogICAgICB0WyJcdTJGOTUiXSA9ICJcdThDMzciOwogICAgICB0WyJcdTJGOTYiXSA9ICJcdThDNDYiOwogICAgICB0WyJcdTJGOTciXSA9ICJcdThDNTUiOwogICAgICB0WyJcdTJGOTgiXSA9ICJcdThDNzgiOwogICAgICB0WyJcdTJGOTkiXSA9ICJcdThDOUQiOwogICAgICB0WyJcdTJGOUEiXSA9ICJcdThENjQiOwogICAgICB0WyJcdTJGOUIiXSA9ICJcdThENzAiOwogICAgICB0WyJcdTJGOUMiXSA9ICJcdThEQjMiOwogICAgICB0WyJcdTJGOUQiXSA9ICJcdThFQUIiOwogICAgICB0WyJcdTJGOUUiXSA9ICJcdThFQ0EiOwogICAgICB0WyJcdTJGOUYiXSA9ICJcdThGOUIiOwogICAgICB0WyJcdTJGQTAiXSA9ICJcdThGQjAiOwogICAgICB0WyJcdTJGQTEiXSA9ICJcdThGQjUiOwogICAgICB0WyJcdTJGQTIiXSA9ICJcdTkwOTEiOwogICAgICB0WyJcdTJGQTMiXSA9ICJcdTkxNDkiOwogICAgICB0WyJcdTJGQTQiXSA9ICJcdTkxQzYiOwogICAgICB0WyJcdTJGQTUiXSA9ICJcdTkxQ0MiOwogICAgICB0WyJcdTJGQTYiXSA9ICJcdTkxRDEiOwogICAgICB0WyJcdTJGQTciXSA9ICJcdTk1NzciOwogICAgICB0WyJcdTJGQTgiXSA9ICJcdTk1ODAiOwogICAgICB0WyJcdTJGQTkiXSA9ICJcdTk2MUMiOwogICAgICB0WyJcdTJGQUEiXSA9ICJcdTk2QjYiOwogICAgICB0WyJcdTJGQUIiXSA9ICJcdTk2QjkiOwogICAgICB0WyJcdTJGQUMiXSA9ICJcdTk2RTgiOwogICAgICB0WyJcdTJGQUQiXSA9ICJcdTk3NTEiOwogICAgICB0WyJcdTJGQUUiXSA9ICJcdTk3NUUiOwogICAgICB0WyJcdTJGQUYiXSA9ICJcdTk3NjIiOwogICAgICB0WyJcdTJGQjAiXSA9ICJcdTk3NjkiOwogICAgICB0WyJcdTJGQjEiXSA9ICJcdTk3Q0IiOwogICAgICB0WyJcdTJGQjIiXSA9ICJcdTk3RUQiOwogICAgICB0WyJcdTJGQjMiXSA9ICJcdTk3RjMiOwogICAgICB0WyJcdTJGQjQiXSA9ICJcdTk4MDEiOwogICAgICB0WyJcdTJGQjUiXSA9ICJcdTk4QTgiOwogICAgICB0WyJcdTJGQjYiXSA9ICJcdTk4REIiOwogICAgICB0WyJcdTJGQjciXSA9ICJcdTk4REYiOwogICAgICB0WyJcdTJGQjgiXSA9ICJcdTk5OTYiOwogICAgICB0WyJcdTJGQjkiXSA9ICJcdTk5OTkiOwogICAgICB0WyJcdTJGQkEiXSA9ICJcdTk5QUMiOwogICAgICB0WyJcdTJGQkIiXSA9ICJcdTlBQTgiOwogICAgICB0WyJcdTJGQkMiXSA9ICJcdTlBRDgiOwogICAgICB0WyJcdTJGQkQiXSA9ICJcdTlBREYiOwogICAgICB0WyJcdTJGQkUiXSA9ICJcdTlCMjUiOwogICAgICB0WyJcdTJGQkYiXSA9ICJcdTlCMkYiOwogICAgICB0WyJcdTJGQzAiXSA9ICJcdTlCMzIiOwogICAgICB0WyJcdTJGQzEiXSA9ICJcdTlCM0MiOwogICAgICB0WyJcdTJGQzIiXSA9ICJcdTlCNUEiOwogICAgICB0WyJcdTJGQzMiXSA9ICJcdTlDRTUiOwogICAgICB0WyJcdTJGQzQiXSA9ICJcdTlFNzUiOwogICAgICB0WyJcdTJGQzUiXSA9ICJcdTlFN0YiOwogICAgICB0WyJcdTJGQzYiXSA9ICJcdTlFQTUiOwogICAgICB0WyJcdTJGQzciXSA9ICJcdTlFQkIiOwogICAgICB0WyJcdTJGQzgiXSA9ICJcdTlFQzMiOwogICAgICB0WyJcdTJGQzkiXSA9ICJcdTlFQ0QiOwogICAgICB0WyJcdTJGQ0EiXSA9ICJcdTlFRDEiOwogICAgICB0WyJcdTJGQ0IiXSA9ICJcdTlFRjkiOwogICAgICB0WyJcdTJGQ0MiXSA9ICJcdTlFRkQiOwogICAgICB0WyJcdTJGQ0QiXSA9ICJcdTlGMEUiOwogICAgICB0WyJcdTJGQ0UiXSA9ICJcdTlGMTMiOwogICAgICB0WyJcdTJGQ0YiXSA9ICJcdTlGMjAiOwogICAgICB0WyJcdTJGRDAiXSA9ICJcdTlGM0IiOwogICAgICB0WyJcdTJGRDEiXSA9ICJcdTlGNEEiOwogICAgICB0WyJcdTJGRDIiXSA9ICJcdTlGNTIiOwogICAgICB0WyJcdTJGRDMiXSA9ICJcdTlGOEQiOwogICAgICB0WyJcdTJGRDQiXSA9ICJcdTlGOUMiOwogICAgICB0WyJcdTJGRDUiXSA9ICJcdTlGQTAiOwogICAgICB0WyJcdTMwMzYiXSA9ICJcdTMwMTIiOwogICAgICB0WyJcdTMwMzgiXSA9ICJcdTUzNDEiOwogICAgICB0WyJcdTMwMzkiXSA9ICJcdTUzNDQiOwogICAgICB0WyJcdTMwM0EiXSA9ICJcdTUzNDUiOwogICAgICB0WyJcdTMwOUIiXSA9ICIgXHUzMDk5IjsKICAgICAgdFsiXHUzMDlDIl0gPSAiIFx1MzA5QSI7CiAgICAgIHRbIlx1MzEzMSJdID0gIlx1MTEwMCI7CiAgICAgIHRbIlx1MzEzMiJdID0gIlx1MTEwMSI7CiAgICAgIHRbIlx1MzEzMyJdID0gIlx1MTFBQSI7CiAgICAgIHRbIlx1MzEzNCJdID0gIlx1MTEwMiI7CiAgICAgIHRbIlx1MzEzNSJdID0gIlx1MTFBQyI7CiAgICAgIHRbIlx1MzEzNiJdID0gIlx1MTFBRCI7CiAgICAgIHRbIlx1MzEzNyJdID0gIlx1MTEwMyI7CiAgICAgIHRbIlx1MzEzOCJdID0gIlx1MTEwNCI7CiAgICAgIHRbIlx1MzEzOSJdID0gIlx1MTEwNSI7CiAgICAgIHRbIlx1MzEzQSJdID0gIlx1MTFCMCI7CiAgICAgIHRbIlx1MzEzQiJdID0gIlx1MTFCMSI7CiAgICAgIHRbIlx1MzEzQyJdID0gIlx1MTFCMiI7CiAgICAgIHRbIlx1MzEzRCJdID0gIlx1MTFCMyI7CiAgICAgIHRbIlx1MzEzRSJdID0gIlx1MTFCNCI7CiAgICAgIHRbIlx1MzEzRiJdID0gIlx1MTFCNSI7CiAgICAgIHRbIlx1MzE0MCJdID0gIlx1MTExQSI7CiAgICAgIHRbIlx1MzE0MSJdID0gIlx1MTEwNiI7CiAgICAgIHRbIlx1MzE0MiJdID0gIlx1MTEwNyI7CiAgICAgIHRbIlx1MzE0MyJdID0gIlx1MTEwOCI7CiAgICAgIHRbIlx1MzE0NCJdID0gIlx1MTEyMSI7CiAgICAgIHRbIlx1MzE0NSJdID0gIlx1MTEwOSI7CiAgICAgIHRbIlx1MzE0NiJdID0gIlx1MTEwQSI7CiAgICAgIHRbIlx1MzE0NyJdID0gIlx1MTEwQiI7CiAgICAgIHRbIlx1MzE0OCJdID0gIlx1MTEwQyI7CiAgICAgIHRbIlx1MzE0OSJdID0gIlx1MTEwRCI7CiAgICAgIHRbIlx1MzE0QSJdID0gIlx1MTEwRSI7CiAgICAgIHRbIlx1MzE0QiJdID0gIlx1MTEwRiI7CiAgICAgIHRbIlx1MzE0QyJdID0gIlx1MTExMCI7CiAgICAgIHRbIlx1MzE0RCJdID0gIlx1MTExMSI7CiAgICAgIHRbIlx1MzE0RSJdID0gIlx1MTExMiI7CiAgICAgIHRbIlx1MzE0RiJdID0gIlx1MTE2MSI7CiAgICAgIHRbIlx1MzE1MCJdID0gIlx1MTE2MiI7CiAgICAgIHRbIlx1MzE1MSJdID0gIlx1MTE2MyI7CiAgICAgIHRbIlx1MzE1MiJdID0gIlx1MTE2NCI7CiAgICAgIHRbIlx1MzE1MyJdID0gIlx1MTE2NSI7CiAgICAgIHRbIlx1MzE1NCJdID0gIlx1MTE2NiI7CiAgICAgIHRbIlx1MzE1NSJdID0gIlx1MTE2NyI7CiAgICAgIHRbIlx1MzE1NiJdID0gIlx1MTE2OCI7CiAgICAgIHRbIlx1MzE1NyJdID0gIlx1MTE2OSI7CiAgICAgIHRbIlx1MzE1OCJdID0gIlx1MTE2QSI7CiAgICAgIHRbIlx1MzE1OSJdID0gIlx1MTE2QiI7CiAgICAgIHRbIlx1MzE1QSJdID0gIlx1MTE2QyI7CiAgICAgIHRbIlx1MzE1QiJdID0gIlx1MTE2RCI7CiAgICAgIHRbIlx1MzE1QyJdID0gIlx1MTE2RSI7CiAgICAgIHRbIlx1MzE1RCJdID0gIlx1MTE2RiI7CiAgICAgIHRbIlx1MzE1RSJdID0gIlx1MTE3MCI7CiAgICAgIHRbIlx1MzE1RiJdID0gIlx1MTE3MSI7CiAgICAgIHRbIlx1MzE2MCJdID0gIlx1MTE3MiI7CiAgICAgIHRbIlx1MzE2MSJdID0gIlx1MTE3MyI7CiAgICAgIHRbIlx1MzE2MiJdID0gIlx1MTE3NCI7CiAgICAgIHRbIlx1MzE2MyJdID0gIlx1MTE3NSI7CiAgICAgIHRbIlx1MzE2NCJdID0gIlx1MTE2MCI7CiAgICAgIHRbIlx1MzE2NSJdID0gIlx1MTExNCI7CiAgICAgIHRbIlx1MzE2NiJdID0gIlx1MTExNSI7CiAgICAgIHRbIlx1MzE2NyJdID0gIlx1MTFDNyI7CiAgICAgIHRbIlx1MzE2OCJdID0gIlx1MTFDOCI7CiAgICAgIHRbIlx1MzE2OSJdID0gIlx1MTFDQyI7CiAgICAgIHRbIlx1MzE2QSJdID0gIlx1MTFDRSI7CiAgICAgIHRbIlx1MzE2QiJdID0gIlx1MTFEMyI7CiAgICAgIHRbIlx1MzE2QyJdID0gIlx1MTFENyI7CiAgICAgIHRbIlx1MzE2RCJdID0gIlx1MTFEOSI7CiAgICAgIHRbIlx1MzE2RSJdID0gIlx1MTExQyI7CiAgICAgIHRbIlx1MzE2RiJdID0gIlx1MTFERCI7CiAgICAgIHRbIlx1MzE3MCJdID0gIlx1MTFERiI7CiAgICAgIHRbIlx1MzE3MSJdID0gIlx1MTExRCI7CiAgICAgIHRbIlx1MzE3MiJdID0gIlx1MTExRSI7CiAgICAgIHRbIlx1MzE3MyJdID0gIlx1MTEyMCI7CiAgICAgIHRbIlx1MzE3NCJdID0gIlx1MTEyMiI7CiAgICAgIHRbIlx1MzE3NSJdID0gIlx1MTEyMyI7CiAgICAgIHRbIlx1MzE3NiJdID0gIlx1MTEyNyI7CiAgICAgIHRbIlx1MzE3NyJdID0gIlx1MTEyOSI7CiAgICAgIHRbIlx1MzE3OCJdID0gIlx1MTEyQiI7CiAgICAgIHRbIlx1MzE3OSJdID0gIlx1MTEyQyI7CiAgICAgIHRbIlx1MzE3QSJdID0gIlx1MTEyRCI7CiAgICAgIHRbIlx1MzE3QiJdID0gIlx1MTEyRSI7CiAgICAgIHRbIlx1MzE3QyJdID0gIlx1MTEyRiI7CiAgICAgIHRbIlx1MzE3RCJdID0gIlx1MTEzMiI7CiAgICAgIHRbIlx1MzE3RSJdID0gIlx1MTEzNiI7CiAgICAgIHRbIlx1MzE3RiJdID0gIlx1MTE0MCI7CiAgICAgIHRbIlx1MzE4MCJdID0gIlx1MTE0NyI7CiAgICAgIHRbIlx1MzE4MSJdID0gIlx1MTE0QyI7CiAgICAgIHRbIlx1MzE4MiJdID0gIlx1MTFGMSI7CiAgICAgIHRbIlx1MzE4MyJdID0gIlx1MTFGMiI7CiAgICAgIHRbIlx1MzE4NCJdID0gIlx1MTE1NyI7CiAgICAgIHRbIlx1MzE4NSJdID0gIlx1MTE1OCI7CiAgICAgIHRbIlx1MzE4NiJdID0gIlx1MTE1OSI7CiAgICAgIHRbIlx1MzE4NyJdID0gIlx1MTE4NCI7CiAgICAgIHRbIlx1MzE4OCJdID0gIlx1MTE4NSI7CiAgICAgIHRbIlx1MzE4OSJdID0gIlx1MTE4OCI7CiAgICAgIHRbIlx1MzE4QSJdID0gIlx1MTE5MSI7CiAgICAgIHRbIlx1MzE4QiJdID0gIlx1MTE5MiI7CiAgICAgIHRbIlx1MzE4QyJdID0gIlx1MTE5NCI7CiAgICAgIHRbIlx1MzE4RCJdID0gIlx1MTE5RSI7CiAgICAgIHRbIlx1MzE4RSJdID0gIlx1MTFBMSI7CiAgICAgIHRbIlx1MzIwMCJdID0gIihcdTExMDApIjsKICAgICAgdFsiXHUzMjAxIl0gPSAiKFx1MTEwMikiOwogICAgICB0WyJcdTMyMDIiXSA9ICIoXHUxMTAzKSI7CiAgICAgIHRbIlx1MzIwMyJdID0gIihcdTExMDUpIjsKICAgICAgdFsiXHUzMjA0Il0gPSAiKFx1MTEwNikiOwogICAgICB0WyJcdTMyMDUiXSA9ICIoXHUxMTA3KSI7CiAgICAgIHRbIlx1MzIwNiJdID0gIihcdTExMDkpIjsKICAgICAgdFsiXHUzMjA3Il0gPSAiKFx1MTEwQikiOwogICAgICB0WyJcdTMyMDgiXSA9ICIoXHUxMTBDKSI7CiAgICAgIHRbIlx1MzIwOSJdID0gIihcdTExMEUpIjsKICAgICAgdFsiXHUzMjBBIl0gPSAiKFx1MTEwRikiOwogICAgICB0WyJcdTMyMEIiXSA9ICIoXHUxMTEwKSI7CiAgICAgIHRbIlx1MzIwQyJdID0gIihcdTExMTEpIjsKICAgICAgdFsiXHUzMjBEIl0gPSAiKFx1MTExMikiOwogICAgICB0WyJcdTMyMEUiXSA9ICIoXHUxMTAwXHUxMTYxKSI7CiAgICAgIHRbIlx1MzIwRiJdID0gIihcdTExMDJcdTExNjEpIjsKICAgICAgdFsiXHUzMjEwIl0gPSAiKFx1MTEwM1x1MTE2MSkiOwogICAgICB0WyJcdTMyMTEiXSA9ICIoXHUxMTA1XHUxMTYxKSI7CiAgICAgIHRbIlx1MzIxMiJdID0gIihcdTExMDZcdTExNjEpIjsKICAgICAgdFsiXHUzMjEzIl0gPSAiKFx1MTEwN1x1MTE2MSkiOwogICAgICB0WyJcdTMyMTQiXSA9ICIoXHUxMTA5XHUxMTYxKSI7CiAgICAgIHRbIlx1MzIxNSJdID0gIihcdTExMEJcdTExNjEpIjsKICAgICAgdFsiXHUzMjE2Il0gPSAiKFx1MTEwQ1x1MTE2MSkiOwogICAgICB0WyJcdTMyMTciXSA9ICIoXHUxMTBFXHUxMTYxKSI7CiAgICAgIHRbIlx1MzIxOCJdID0gIihcdTExMEZcdTExNjEpIjsKICAgICAgdFsiXHUzMjE5Il0gPSAiKFx1MTExMFx1MTE2MSkiOwogICAgICB0WyJcdTMyMUEiXSA9ICIoXHUxMTExXHUxMTYxKSI7CiAgICAgIHRbIlx1MzIxQiJdID0gIihcdTExMTJcdTExNjEpIjsKICAgICAgdFsiXHUzMjFDIl0gPSAiKFx1MTEwQ1x1MTE2RSkiOwogICAgICB0WyJcdTMyMUQiXSA9ICIoXHUxMTBCXHUxMTY5XHUxMTBDXHUxMTY1XHUxMUFCKSI7CiAgICAgIHRbIlx1MzIxRSJdID0gIihcdTExMEJcdTExNjlcdTExMTJcdTExNkUpIjsKICAgICAgdFsiXHUzMjIwIl0gPSAiKFx1NEUwMCkiOwogICAgICB0WyJcdTMyMjEiXSA9ICIoXHU0RThDKSI7CiAgICAgIHRbIlx1MzIyMiJdID0gIihcdTRFMDkpIjsKICAgICAgdFsiXHUzMjIzIl0gPSAiKFx1NTZEQikiOwogICAgICB0WyJcdTMyMjQiXSA9ICIoXHU0RTk0KSI7CiAgICAgIHRbIlx1MzIyNSJdID0gIihcdTUxNkQpIjsKICAgICAgdFsiXHUzMjI2Il0gPSAiKFx1NEUwMykiOwogICAgICB0WyJcdTMyMjciXSA9ICIoXHU1MTZCKSI7CiAgICAgIHRbIlx1MzIyOCJdID0gIihcdTRFNUQpIjsKICAgICAgdFsiXHUzMjI5Il0gPSAiKFx1NTM0MSkiOwogICAgICB0WyJcdTMyMkEiXSA9ICIoXHU2NzA4KSI7CiAgICAgIHRbIlx1MzIyQiJdID0gIihcdTcwNkIpIjsKICAgICAgdFsiXHUzMjJDIl0gPSAiKFx1NkMzNCkiOwogICAgICB0WyJcdTMyMkQiXSA9ICIoXHU2NzI4KSI7CiAgICAgIHRbIlx1MzIyRSJdID0gIihcdTkxRDEpIjsKICAgICAgdFsiXHUzMjJGIl0gPSAiKFx1NTcxRikiOwogICAgICB0WyJcdTMyMzAiXSA9ICIoXHU2NUU1KSI7CiAgICAgIHRbIlx1MzIzMSJdID0gIihcdTY4MkEpIjsKICAgICAgdFsiXHUzMjMyIl0gPSAiKFx1NjcwOSkiOwogICAgICB0WyJcdTMyMzMiXSA9ICIoXHU3OTNFKSI7CiAgICAgIHRbIlx1MzIzNCJdID0gIihcdTU0MEQpIjsKICAgICAgdFsiXHUzMjM1Il0gPSAiKFx1NzI3OSkiOwogICAgICB0WyJcdTMyMzYiXSA9ICIoXHU4Q0ExKSI7CiAgICAgIHRbIlx1MzIzNyJdID0gIihcdTc5NUQpIjsKICAgICAgdFsiXHUzMjM4Il0gPSAiKFx1NTJCNCkiOwogICAgICB0WyJcdTMyMzkiXSA9ICIoXHU0RUUzKSI7CiAgICAgIHRbIlx1MzIzQSJdID0gIihcdTU0N0MpIjsKICAgICAgdFsiXHUzMjNCIl0gPSAiKFx1NUI2NikiOwogICAgICB0WyJcdTMyM0MiXSA9ICIoXHU3NkUzKSI7CiAgICAgIHRbIlx1MzIzRCJdID0gIihcdTRGMDEpIjsKICAgICAgdFsiXHUzMjNFIl0gPSAiKFx1OENDNykiOwogICAgICB0WyJcdTMyM0YiXSA9ICIoXHU1MzU0KSI7CiAgICAgIHRbIlx1MzI0MCJdID0gIihcdTc5NkQpIjsKICAgICAgdFsiXHUzMjQxIl0gPSAiKFx1NEYxMSkiOwogICAgICB0WyJcdTMyNDIiXSA9ICIoXHU4MUVBKSI7CiAgICAgIHRbIlx1MzI0MyJdID0gIihcdTgxRjMpIjsKICAgICAgdFsiXHUzMkMwIl0gPSAiMVx1NjcwOCI7CiAgICAgIHRbIlx1MzJDMSJdID0gIjJcdTY3MDgiOwogICAgICB0WyJcdTMyQzIiXSA9ICIzXHU2NzA4IjsKICAgICAgdFsiXHUzMkMzIl0gPSAiNFx1NjcwOCI7CiAgICAgIHRbIlx1MzJDNCJdID0gIjVcdTY3MDgiOwogICAgICB0WyJcdTMyQzUiXSA9ICI2XHU2NzA4IjsKICAgICAgdFsiXHUzMkM2Il0gPSAiN1x1NjcwOCI7CiAgICAgIHRbIlx1MzJDNyJdID0gIjhcdTY3MDgiOwogICAgICB0WyJcdTMyQzgiXSA9ICI5XHU2NzA4IjsKICAgICAgdFsiXHUzMkM5Il0gPSAiMTBcdTY3MDgiOwogICAgICB0WyJcdTMyQ0EiXSA9ICIxMVx1NjcwOCI7CiAgICAgIHRbIlx1MzJDQiJdID0gIjEyXHU2NzA4IjsKICAgICAgdFsiXHUzMzU4Il0gPSAiMFx1NzBCOSI7CiAgICAgIHRbIlx1MzM1OSJdID0gIjFcdTcwQjkiOwogICAgICB0WyJcdTMzNUEiXSA9ICIyXHU3MEI5IjsKICAgICAgdFsiXHUzMzVCIl0gPSAiM1x1NzBCOSI7CiAgICAgIHRbIlx1MzM1QyJdID0gIjRcdTcwQjkiOwogICAgICB0WyJcdTMzNUQiXSA9ICI1XHU3MEI5IjsKICAgICAgdFsiXHUzMzVFIl0gPSAiNlx1NzBCOSI7CiAgICAgIHRbIlx1MzM1RiJdID0gIjdcdTcwQjkiOwogICAgICB0WyJcdTMzNjAiXSA9ICI4XHU3MEI5IjsKICAgICAgdFsiXHUzMzYxIl0gPSAiOVx1NzBCOSI7CiAgICAgIHRbIlx1MzM2MiJdID0gIjEwXHU3MEI5IjsKICAgICAgdFsiXHUzMzYzIl0gPSAiMTFcdTcwQjkiOwogICAgICB0WyJcdTMzNjQiXSA9ICIxMlx1NzBCOSI7CiAgICAgIHRbIlx1MzM2NSJdID0gIjEzXHU3MEI5IjsKICAgICAgdFsiXHUzMzY2Il0gPSAiMTRcdTcwQjkiOwogICAgICB0WyJcdTMzNjciXSA9ICIxNVx1NzBCOSI7CiAgICAgIHRbIlx1MzM2OCJdID0gIjE2XHU3MEI5IjsKICAgICAgdFsiXHUzMzY5Il0gPSAiMTdcdTcwQjkiOwogICAgICB0WyJcdTMzNkEiXSA9ICIxOFx1NzBCOSI7CiAgICAgIHRbIlx1MzM2QiJdID0gIjE5XHU3MEI5IjsKICAgICAgdFsiXHUzMzZDIl0gPSAiMjBcdTcwQjkiOwogICAgICB0WyJcdTMzNkQiXSA9ICIyMVx1NzBCOSI7CiAgICAgIHRbIlx1MzM2RSJdID0gIjIyXHU3MEI5IjsKICAgICAgdFsiXHUzMzZGIl0gPSAiMjNcdTcwQjkiOwogICAgICB0WyJcdTMzNzAiXSA9ICIyNFx1NzBCOSI7CiAgICAgIHRbIlx1MzNFMCJdID0gIjFcdTY1RTUiOwogICAgICB0WyJcdTMzRTEiXSA9ICIyXHU2NUU1IjsKICAgICAgdFsiXHUzM0UyIl0gPSAiM1x1NjVFNSI7CiAgICAgIHRbIlx1MzNFMyJdID0gIjRcdTY1RTUiOwogICAgICB0WyJcdTMzRTQiXSA9ICI1XHU2NUU1IjsKICAgICAgdFsiXHUzM0U1Il0gPSAiNlx1NjVFNSI7CiAgICAgIHRbIlx1MzNFNiJdID0gIjdcdTY1RTUiOwogICAgICB0WyJcdTMzRTciXSA9ICI4XHU2NUU1IjsKICAgICAgdFsiXHUzM0U4Il0gPSAiOVx1NjVFNSI7CiAgICAgIHRbIlx1MzNFOSJdID0gIjEwXHU2NUU1IjsKICAgICAgdFsiXHUzM0VBIl0gPSAiMTFcdTY1RTUiOwogICAgICB0WyJcdTMzRUIiXSA9ICIxMlx1NjVFNSI7CiAgICAgIHRbIlx1MzNFQyJdID0gIjEzXHU2NUU1IjsKICAgICAgdFsiXHUzM0VEIl0gPSAiMTRcdTY1RTUiOwogICAgICB0WyJcdTMzRUUiXSA9ICIxNVx1NjVFNSI7CiAgICAgIHRbIlx1MzNFRiJdID0gIjE2XHU2NUU1IjsKICAgICAgdFsiXHUzM0YwIl0gPSAiMTdcdTY1RTUiOwogICAgICB0WyJcdTMzRjEiXSA9ICIxOFx1NjVFNSI7CiAgICAgIHRbIlx1MzNGMiJdID0gIjE5XHU2NUU1IjsKICAgICAgdFsiXHUzM0YzIl0gPSAiMjBcdTY1RTUiOwogICAgICB0WyJcdTMzRjQiXSA9ICIyMVx1NjVFNSI7CiAgICAgIHRbIlx1MzNGNSJdID0gIjIyXHU2NUU1IjsKICAgICAgdFsiXHUzM0Y2Il0gPSAiMjNcdTY1RTUiOwogICAgICB0WyJcdTMzRjciXSA9ICIyNFx1NjVFNSI7CiAgICAgIHRbIlx1MzNGOCJdID0gIjI1XHU2NUU1IjsKICAgICAgdFsiXHUzM0Y5Il0gPSAiMjZcdTY1RTUiOwogICAgICB0WyJcdTMzRkEiXSA9ICIyN1x1NjVFNSI7CiAgICAgIHRbIlx1MzNGQiJdID0gIjI4XHU2NUU1IjsKICAgICAgdFsiXHUzM0ZDIl0gPSAiMjlcdTY1RTUiOwogICAgICB0WyJcdTMzRkQiXSA9ICIzMFx1NjVFNSI7CiAgICAgIHRbIlx1MzNGRSJdID0gIjMxXHU2NUU1IjsKICAgICAgdFsiXHVGQjAwIl0gPSAiZmYiOwogICAgICB0WyJcdUZCMDEiXSA9ICJmaSI7CiAgICAgIHRbIlx1RkIwMiJdID0gImZsIjsKICAgICAgdFsiXHVGQjAzIl0gPSAiZmZpIjsKICAgICAgdFsiXHVGQjA0Il0gPSAiZmZsIjsKICAgICAgdFsiXHVGQjA1Il0gPSAiXHUwMTdGdCI7CiAgICAgIHRbIlx1RkIwNiJdID0gInN0IjsKICAgICAgdFsiXHVGQjEzIl0gPSAiXHUwNTc0XHUwNTc2IjsKICAgICAgdFsiXHVGQjE0Il0gPSAiXHUwNTc0XHUwNTY1IjsKICAgICAgdFsiXHVGQjE1Il0gPSAiXHUwNTc0XHUwNTZCIjsKICAgICAgdFsiXHVGQjE2Il0gPSAiXHUwNTdFXHUwNTc2IjsKICAgICAgdFsiXHVGQjE3Il0gPSAiXHUwNTc0XHUwNTZEIjsKICAgICAgdFsiXHVGQjRGIl0gPSAiXHUwNUQwXHUwNURDIjsKICAgICAgdFsiXHVGQjUwIl0gPSAiXHUwNjcxIjsKICAgICAgdFsiXHVGQjUxIl0gPSAiXHUwNjcxIjsKICAgICAgdFsiXHVGQjUyIl0gPSAiXHUwNjdCIjsKICAgICAgdFsiXHVGQjUzIl0gPSAiXHUwNjdCIjsKICAgICAgdFsiXHVGQjU0Il0gPSAiXHUwNjdCIjsKICAgICAgdFsiXHVGQjU1Il0gPSAiXHUwNjdCIjsKICAgICAgdFsiXHVGQjU2Il0gPSAiXHUwNjdFIjsKICAgICAgdFsiXHVGQjU3Il0gPSAiXHUwNjdFIjsKICAgICAgdFsiXHVGQjU4Il0gPSAiXHUwNjdFIjsKICAgICAgdFsiXHVGQjU5Il0gPSAiXHUwNjdFIjsKICAgICAgdFsiXHVGQjVBIl0gPSAiXHUwNjgwIjsKICAgICAgdFsiXHVGQjVCIl0gPSAiXHUwNjgwIjsKICAgICAgdFsiXHVGQjVDIl0gPSAiXHUwNjgwIjsKICAgICAgdFsiXHVGQjVEIl0gPSAiXHUwNjgwIjsKICAgICAgdFsiXHVGQjVFIl0gPSAiXHUwNjdBIjsKICAgICAgdFsiXHVGQjVGIl0gPSAiXHUwNjdBIjsKICAgICAgdFsiXHVGQjYwIl0gPSAiXHUwNjdBIjsKICAgICAgdFsiXHVGQjYxIl0gPSAiXHUwNjdBIjsKICAgICAgdFsiXHVGQjYyIl0gPSAiXHUwNjdGIjsKICAgICAgdFsiXHVGQjYzIl0gPSAiXHUwNjdGIjsKICAgICAgdFsiXHVGQjY0Il0gPSAiXHUwNjdGIjsKICAgICAgdFsiXHVGQjY1Il0gPSAiXHUwNjdGIjsKICAgICAgdFsiXHVGQjY2Il0gPSAiXHUwNjc5IjsKICAgICAgdFsiXHVGQjY3Il0gPSAiXHUwNjc5IjsKICAgICAgdFsiXHVGQjY4Il0gPSAiXHUwNjc5IjsKICAgICAgdFsiXHVGQjY5Il0gPSAiXHUwNjc5IjsKICAgICAgdFsiXHVGQjZBIl0gPSAiXHUwNkE0IjsKICAgICAgdFsiXHVGQjZCIl0gPSAiXHUwNkE0IjsKICAgICAgdFsiXHVGQjZDIl0gPSAiXHUwNkE0IjsKICAgICAgdFsiXHVGQjZEIl0gPSAiXHUwNkE0IjsKICAgICAgdFsiXHVGQjZFIl0gPSAiXHUwNkE2IjsKICAgICAgdFsiXHVGQjZGIl0gPSAiXHUwNkE2IjsKICAgICAgdFsiXHVGQjcwIl0gPSAiXHUwNkE2IjsKICAgICAgdFsiXHVGQjcxIl0gPSAiXHUwNkE2IjsKICAgICAgdFsiXHVGQjcyIl0gPSAiXHUwNjg0IjsKICAgICAgdFsiXHVGQjczIl0gPSAiXHUwNjg0IjsKICAgICAgdFsiXHVGQjc0Il0gPSAiXHUwNjg0IjsKICAgICAgdFsiXHVGQjc1Il0gPSAiXHUwNjg0IjsKICAgICAgdFsiXHVGQjc2Il0gPSAiXHUwNjgzIjsKICAgICAgdFsiXHVGQjc3Il0gPSAiXHUwNjgzIjsKICAgICAgdFsiXHVGQjc4Il0gPSAiXHUwNjgzIjsKICAgICAgdFsiXHVGQjc5Il0gPSAiXHUwNjgzIjsKICAgICAgdFsiXHVGQjdBIl0gPSAiXHUwNjg2IjsKICAgICAgdFsiXHVGQjdCIl0gPSAiXHUwNjg2IjsKICAgICAgdFsiXHVGQjdDIl0gPSAiXHUwNjg2IjsKICAgICAgdFsiXHVGQjdEIl0gPSAiXHUwNjg2IjsKICAgICAgdFsiXHVGQjdFIl0gPSAiXHUwNjg3IjsKICAgICAgdFsiXHVGQjdGIl0gPSAiXHUwNjg3IjsKICAgICAgdFsiXHVGQjgwIl0gPSAiXHUwNjg3IjsKICAgICAgdFsiXHVGQjgxIl0gPSAiXHUwNjg3IjsKICAgICAgdFsiXHVGQjgyIl0gPSAiXHUwNjhEIjsKICAgICAgdFsiXHVGQjgzIl0gPSAiXHUwNjhEIjsKICAgICAgdFsiXHVGQjg0Il0gPSAiXHUwNjhDIjsKICAgICAgdFsiXHVGQjg1Il0gPSAiXHUwNjhDIjsKICAgICAgdFsiXHVGQjg2Il0gPSAiXHUwNjhFIjsKICAgICAgdFsiXHVGQjg3Il0gPSAiXHUwNjhFIjsKICAgICAgdFsiXHVGQjg4Il0gPSAiXHUwNjg4IjsKICAgICAgdFsiXHVGQjg5Il0gPSAiXHUwNjg4IjsKICAgICAgdFsiXHVGQjhBIl0gPSAiXHUwNjk4IjsKICAgICAgdFsiXHVGQjhCIl0gPSAiXHUwNjk4IjsKICAgICAgdFsiXHVGQjhDIl0gPSAiXHUwNjkxIjsKICAgICAgdFsiXHVGQjhEIl0gPSAiXHUwNjkxIjsKICAgICAgdFsiXHVGQjhFIl0gPSAiXHUwNkE5IjsKICAgICAgdFsiXHVGQjhGIl0gPSAiXHUwNkE5IjsKICAgICAgdFsiXHVGQjkwIl0gPSAiXHUwNkE5IjsKICAgICAgdFsiXHVGQjkxIl0gPSAiXHUwNkE5IjsKICAgICAgdFsiXHVGQjkyIl0gPSAiXHUwNkFGIjsKICAgICAgdFsiXHVGQjkzIl0gPSAiXHUwNkFGIjsKICAgICAgdFsiXHVGQjk0Il0gPSAiXHUwNkFGIjsKICAgICAgdFsiXHVGQjk1Il0gPSAiXHUwNkFGIjsKICAgICAgdFsiXHVGQjk2Il0gPSAiXHUwNkIzIjsKICAgICAgdFsiXHVGQjk3Il0gPSAiXHUwNkIzIjsKICAgICAgdFsiXHVGQjk4Il0gPSAiXHUwNkIzIjsKICAgICAgdFsiXHVGQjk5Il0gPSAiXHUwNkIzIjsKICAgICAgdFsiXHVGQjlBIl0gPSAiXHUwNkIxIjsKICAgICAgdFsiXHVGQjlCIl0gPSAiXHUwNkIxIjsKICAgICAgdFsiXHVGQjlDIl0gPSAiXHUwNkIxIjsKICAgICAgdFsiXHVGQjlEIl0gPSAiXHUwNkIxIjsKICAgICAgdFsiXHVGQjlFIl0gPSAiXHUwNkJBIjsKICAgICAgdFsiXHVGQjlGIl0gPSAiXHUwNkJBIjsKICAgICAgdFsiXHVGQkEwIl0gPSAiXHUwNkJCIjsKICAgICAgdFsiXHVGQkExIl0gPSAiXHUwNkJCIjsKICAgICAgdFsiXHVGQkEyIl0gPSAiXHUwNkJCIjsKICAgICAgdFsiXHVGQkEzIl0gPSAiXHUwNkJCIjsKICAgICAgdFsiXHVGQkE0Il0gPSAiXHUwNkMwIjsKICAgICAgdFsiXHVGQkE1Il0gPSAiXHUwNkMwIjsKICAgICAgdFsiXHVGQkE2Il0gPSAiXHUwNkMxIjsKICAgICAgdFsiXHVGQkE3Il0gPSAiXHUwNkMxIjsKICAgICAgdFsiXHVGQkE4Il0gPSAiXHUwNkMxIjsKICAgICAgdFsiXHVGQkE5Il0gPSAiXHUwNkMxIjsKICAgICAgdFsiXHVGQkFBIl0gPSAiXHUwNkJFIjsKICAgICAgdFsiXHVGQkFCIl0gPSAiXHUwNkJFIjsKICAgICAgdFsiXHVGQkFDIl0gPSAiXHUwNkJFIjsKICAgICAgdFsiXHVGQkFEIl0gPSAiXHUwNkJFIjsKICAgICAgdFsiXHVGQkFFIl0gPSAiXHUwNkQyIjsKICAgICAgdFsiXHVGQkFGIl0gPSAiXHUwNkQyIjsKICAgICAgdFsiXHVGQkIwIl0gPSAiXHUwNkQzIjsKICAgICAgdFsiXHVGQkIxIl0gPSAiXHUwNkQzIjsKICAgICAgdFsiXHVGQkQzIl0gPSAiXHUwNkFEIjsKICAgICAgdFsiXHVGQkQ0Il0gPSAiXHUwNkFEIjsKICAgICAgdFsiXHVGQkQ1Il0gPSAiXHUwNkFEIjsKICAgICAgdFsiXHVGQkQ2Il0gPSAiXHUwNkFEIjsKICAgICAgdFsiXHVGQkQ3Il0gPSAiXHUwNkM3IjsKICAgICAgdFsiXHVGQkQ4Il0gPSAiXHUwNkM3IjsKICAgICAgdFsiXHVGQkQ5Il0gPSAiXHUwNkM2IjsKICAgICAgdFsiXHVGQkRBIl0gPSAiXHUwNkM2IjsKICAgICAgdFsiXHVGQkRCIl0gPSAiXHUwNkM4IjsKICAgICAgdFsiXHVGQkRDIl0gPSAiXHUwNkM4IjsKICAgICAgdFsiXHVGQkREIl0gPSAiXHUwNjc3IjsKICAgICAgdFsiXHVGQkRFIl0gPSAiXHUwNkNCIjsKICAgICAgdFsiXHVGQkRGIl0gPSAiXHUwNkNCIjsKICAgICAgdFsiXHVGQkUwIl0gPSAiXHUwNkM1IjsKICAgICAgdFsiXHVGQkUxIl0gPSAiXHUwNkM1IjsKICAgICAgdFsiXHVGQkUyIl0gPSAiXHUwNkM5IjsKICAgICAgdFsiXHVGQkUzIl0gPSAiXHUwNkM5IjsKICAgICAgdFsiXHVGQkU0Il0gPSAiXHUwNkQwIjsKICAgICAgdFsiXHVGQkU1Il0gPSAiXHUwNkQwIjsKICAgICAgdFsiXHVGQkU2Il0gPSAiXHUwNkQwIjsKICAgICAgdFsiXHVGQkU3Il0gPSAiXHUwNkQwIjsKICAgICAgdFsiXHVGQkU4Il0gPSAiXHUwNjQ5IjsKICAgICAgdFsiXHVGQkU5Il0gPSAiXHUwNjQ5IjsKICAgICAgdFsiXHVGQkVBIl0gPSAiXHUwNjI2XHUwNjI3IjsKICAgICAgdFsiXHVGQkVCIl0gPSAiXHUwNjI2XHUwNjI3IjsKICAgICAgdFsiXHVGQkVDIl0gPSAiXHUwNjI2XHUwNkQ1IjsKICAgICAgdFsiXHVGQkVEIl0gPSAiXHUwNjI2XHUwNkQ1IjsKICAgICAgdFsiXHVGQkVFIl0gPSAiXHUwNjI2XHUwNjQ4IjsKICAgICAgdFsiXHVGQkVGIl0gPSAiXHUwNjI2XHUwNjQ4IjsKICAgICAgdFsiXHVGQkYwIl0gPSAiXHUwNjI2XHUwNkM3IjsKICAgICAgdFsiXHVGQkYxIl0gPSAiXHUwNjI2XHUwNkM3IjsKICAgICAgdFsiXHVGQkYyIl0gPSAiXHUwNjI2XHUwNkM2IjsKICAgICAgdFsiXHVGQkYzIl0gPSAiXHUwNjI2XHUwNkM2IjsKICAgICAgdFsiXHVGQkY0Il0gPSAiXHUwNjI2XHUwNkM4IjsKICAgICAgdFsiXHVGQkY1Il0gPSAiXHUwNjI2XHUwNkM4IjsKICAgICAgdFsiXHVGQkY2Il0gPSAiXHUwNjI2XHUwNkQwIjsKICAgICAgdFsiXHVGQkY3Il0gPSAiXHUwNjI2XHUwNkQwIjsKICAgICAgdFsiXHVGQkY4Il0gPSAiXHUwNjI2XHUwNkQwIjsKICAgICAgdFsiXHVGQkY5Il0gPSAiXHUwNjI2XHUwNjQ5IjsKICAgICAgdFsiXHVGQkZBIl0gPSAiXHUwNjI2XHUwNjQ5IjsKICAgICAgdFsiXHVGQkZCIl0gPSAiXHUwNjI2XHUwNjQ5IjsKICAgICAgdFsiXHVGQkZDIl0gPSAiXHUwNkNDIjsKICAgICAgdFsiXHVGQkZEIl0gPSAiXHUwNkNDIjsKICAgICAgdFsiXHVGQkZFIl0gPSAiXHUwNkNDIjsKICAgICAgdFsiXHVGQkZGIl0gPSAiXHUwNkNDIjsKICAgICAgdFsiXHVGQzAwIl0gPSAiXHUwNjI2XHUwNjJDIjsKICAgICAgdFsiXHVGQzAxIl0gPSAiXHUwNjI2XHUwNjJEIjsKICAgICAgdFsiXHVGQzAyIl0gPSAiXHUwNjI2XHUwNjQ1IjsKICAgICAgdFsiXHVGQzAzIl0gPSAiXHUwNjI2XHUwNjQ5IjsKICAgICAgdFsiXHVGQzA0Il0gPSAiXHUwNjI2XHUwNjRBIjsKICAgICAgdFsiXHVGQzA1Il0gPSAiXHUwNjI4XHUwNjJDIjsKICAgICAgdFsiXHVGQzA2Il0gPSAiXHUwNjI4XHUwNjJEIjsKICAgICAgdFsiXHVGQzA3Il0gPSAiXHUwNjI4XHUwNjJFIjsKICAgICAgdFsiXHVGQzA4Il0gPSAiXHUwNjI4XHUwNjQ1IjsKICAgICAgdFsiXHVGQzA5Il0gPSAiXHUwNjI4XHUwNjQ5IjsKICAgICAgdFsiXHVGQzBBIl0gPSAiXHUwNjI4XHUwNjRBIjsKICAgICAgdFsiXHVGQzBCIl0gPSAiXHUwNjJBXHUwNjJDIjsKICAgICAgdFsiXHVGQzBDIl0gPSAiXHUwNjJBXHUwNjJEIjsKICAgICAgdFsiXHVGQzBEIl0gPSAiXHUwNjJBXHUwNjJFIjsKICAgICAgdFsiXHVGQzBFIl0gPSAiXHUwNjJBXHUwNjQ1IjsKICAgICAgdFsiXHVGQzBGIl0gPSAiXHUwNjJBXHUwNjQ5IjsKICAgICAgdFsiXHVGQzEwIl0gPSAiXHUwNjJBXHUwNjRBIjsKICAgICAgdFsiXHVGQzExIl0gPSAiXHUwNjJCXHUwNjJDIjsKICAgICAgdFsiXHVGQzEyIl0gPSAiXHUwNjJCXHUwNjQ1IjsKICAgICAgdFsiXHVGQzEzIl0gPSAiXHUwNjJCXHUwNjQ5IjsKICAgICAgdFsiXHVGQzE0Il0gPSAiXHUwNjJCXHUwNjRBIjsKICAgICAgdFsiXHVGQzE1Il0gPSAiXHUwNjJDXHUwNjJEIjsKICAgICAgdFsiXHVGQzE2Il0gPSAiXHUwNjJDXHUwNjQ1IjsKICAgICAgdFsiXHVGQzE3Il0gPSAiXHUwNjJEXHUwNjJDIjsKICAgICAgdFsiXHVGQzE4Il0gPSAiXHUwNjJEXHUwNjQ1IjsKICAgICAgdFsiXHVGQzE5Il0gPSAiXHUwNjJFXHUwNjJDIjsKICAgICAgdFsiXHVGQzFBIl0gPSAiXHUwNjJFXHUwNjJEIjsKICAgICAgdFsiXHVGQzFCIl0gPSAiXHUwNjJFXHUwNjQ1IjsKICAgICAgdFsiXHVGQzFDIl0gPSAiXHUwNjMzXHUwNjJDIjsKICAgICAgdFsiXHVGQzFEIl0gPSAiXHUwNjMzXHUwNjJEIjsKICAgICAgdFsiXHVGQzFFIl0gPSAiXHUwNjMzXHUwNjJFIjsKICAgICAgdFsiXHVGQzFGIl0gPSAiXHUwNjMzXHUwNjQ1IjsKICAgICAgdFsiXHVGQzIwIl0gPSAiXHUwNjM1XHUwNjJEIjsKICAgICAgdFsiXHVGQzIxIl0gPSAiXHUwNjM1XHUwNjQ1IjsKICAgICAgdFsiXHVGQzIyIl0gPSAiXHUwNjM2XHUwNjJDIjsKICAgICAgdFsiXHVGQzIzIl0gPSAiXHUwNjM2XHUwNjJEIjsKICAgICAgdFsiXHVGQzI0Il0gPSAiXHUwNjM2XHUwNjJFIjsKICAgICAgdFsiXHVGQzI1Il0gPSAiXHUwNjM2XHUwNjQ1IjsKICAgICAgdFsiXHVGQzI2Il0gPSAiXHUwNjM3XHUwNjJEIjsKICAgICAgdFsiXHVGQzI3Il0gPSAiXHUwNjM3XHUwNjQ1IjsKICAgICAgdFsiXHVGQzI4Il0gPSAiXHUwNjM4XHUwNjQ1IjsKICAgICAgdFsiXHVGQzI5Il0gPSAiXHUwNjM5XHUwNjJDIjsKICAgICAgdFsiXHVGQzJBIl0gPSAiXHUwNjM5XHUwNjQ1IjsKICAgICAgdFsiXHVGQzJCIl0gPSAiXHUwNjNBXHUwNjJDIjsKICAgICAgdFsiXHVGQzJDIl0gPSAiXHUwNjNBXHUwNjQ1IjsKICAgICAgdFsiXHVGQzJEIl0gPSAiXHUwNjQxXHUwNjJDIjsKICAgICAgdFsiXHVGQzJFIl0gPSAiXHUwNjQxXHUwNjJEIjsKICAgICAgdFsiXHVGQzJGIl0gPSAiXHUwNjQxXHUwNjJFIjsKICAgICAgdFsiXHVGQzMwIl0gPSAiXHUwNjQxXHUwNjQ1IjsKICAgICAgdFsiXHVGQzMxIl0gPSAiXHUwNjQxXHUwNjQ5IjsKICAgICAgdFsiXHVGQzMyIl0gPSAiXHUwNjQxXHUwNjRBIjsKICAgICAgdFsiXHVGQzMzIl0gPSAiXHUwNjQyXHUwNjJEIjsKICAgICAgdFsiXHVGQzM0Il0gPSAiXHUwNjQyXHUwNjQ1IjsKICAgICAgdFsiXHVGQzM1Il0gPSAiXHUwNjQyXHUwNjQ5IjsKICAgICAgdFsiXHVGQzM2Il0gPSAiXHUwNjQyXHUwNjRBIjsKICAgICAgdFsiXHVGQzM3Il0gPSAiXHUwNjQzXHUwNjI3IjsKICAgICAgdFsiXHVGQzM4Il0gPSAiXHUwNjQzXHUwNjJDIjsKICAgICAgdFsiXHVGQzM5Il0gPSAiXHUwNjQzXHUwNjJEIjsKICAgICAgdFsiXHVGQzNBIl0gPSAiXHUwNjQzXHUwNjJFIjsKICAgICAgdFsiXHVGQzNCIl0gPSAiXHUwNjQzXHUwNjQ0IjsKICAgICAgdFsiXHVGQzNDIl0gPSAiXHUwNjQzXHUwNjQ1IjsKICAgICAgdFsiXHVGQzNEIl0gPSAiXHUwNjQzXHUwNjQ5IjsKICAgICAgdFsiXHVGQzNFIl0gPSAiXHUwNjQzXHUwNjRBIjsKICAgICAgdFsiXHVGQzNGIl0gPSAiXHUwNjQ0XHUwNjJDIjsKICAgICAgdFsiXHVGQzQwIl0gPSAiXHUwNjQ0XHUwNjJEIjsKICAgICAgdFsiXHVGQzQxIl0gPSAiXHUwNjQ0XHUwNjJFIjsKICAgICAgdFsiXHVGQzQyIl0gPSAiXHUwNjQ0XHUwNjQ1IjsKICAgICAgdFsiXHVGQzQzIl0gPSAiXHUwNjQ0XHUwNjQ5IjsKICAgICAgdFsiXHVGQzQ0Il0gPSAiXHUwNjQ0XHUwNjRBIjsKICAgICAgdFsiXHVGQzQ1Il0gPSAiXHUwNjQ1XHUwNjJDIjsKICAgICAgdFsiXHVGQzQ2Il0gPSAiXHUwNjQ1XHUwNjJEIjsKICAgICAgdFsiXHVGQzQ3Il0gPSAiXHUwNjQ1XHUwNjJFIjsKICAgICAgdFsiXHVGQzQ4Il0gPSAiXHUwNjQ1XHUwNjQ1IjsKICAgICAgdFsiXHVGQzQ5Il0gPSAiXHUwNjQ1XHUwNjQ5IjsKICAgICAgdFsiXHVGQzRBIl0gPSAiXHUwNjQ1XHUwNjRBIjsKICAgICAgdFsiXHVGQzRCIl0gPSAiXHUwNjQ2XHUwNjJDIjsKICAgICAgdFsiXHVGQzRDIl0gPSAiXHUwNjQ2XHUwNjJEIjsKICAgICAgdFsiXHVGQzREIl0gPSAiXHUwNjQ2XHUwNjJFIjsKICAgICAgdFsiXHVGQzRFIl0gPSAiXHUwNjQ2XHUwNjQ1IjsKICAgICAgdFsiXHVGQzRGIl0gPSAiXHUwNjQ2XHUwNjQ5IjsKICAgICAgdFsiXHVGQzUwIl0gPSAiXHUwNjQ2XHUwNjRBIjsKICAgICAgdFsiXHVGQzUxIl0gPSAiXHUwNjQ3XHUwNjJDIjsKICAgICAgdFsiXHVGQzUyIl0gPSAiXHUwNjQ3XHUwNjQ1IjsKICAgICAgdFsiXHVGQzUzIl0gPSAiXHUwNjQ3XHUwNjQ5IjsKICAgICAgdFsiXHVGQzU0Il0gPSAiXHUwNjQ3XHUwNjRBIjsKICAgICAgdFsiXHVGQzU1Il0gPSAiXHUwNjRBXHUwNjJDIjsKICAgICAgdFsiXHVGQzU2Il0gPSAiXHUwNjRBXHUwNjJEIjsKICAgICAgdFsiXHVGQzU3Il0gPSAiXHUwNjRBXHUwNjJFIjsKICAgICAgdFsiXHVGQzU4Il0gPSAiXHUwNjRBXHUwNjQ1IjsKICAgICAgdFsiXHVGQzU5Il0gPSAiXHUwNjRBXHUwNjQ5IjsKICAgICAgdFsiXHVGQzVBIl0gPSAiXHUwNjRBXHUwNjRBIjsKICAgICAgdFsiXHVGQzVCIl0gPSAiXHUwNjMwXHUwNjcwIjsKICAgICAgdFsiXHVGQzVDIl0gPSAiXHUwNjMxXHUwNjcwIjsKICAgICAgdFsiXHVGQzVEIl0gPSAiXHUwNjQ5XHUwNjcwIjsKICAgICAgdFsiXHVGQzVFIl0gPSAiIFx1MDY0Q1x1MDY1MSI7CiAgICAgIHRbIlx1RkM1RiJdID0gIiBcdTA2NERcdTA2NTEiOwogICAgICB0WyJcdUZDNjAiXSA9ICIgXHUwNjRFXHUwNjUxIjsKICAgICAgdFsiXHVGQzYxIl0gPSAiIFx1MDY0Rlx1MDY1MSI7CiAgICAgIHRbIlx1RkM2MiJdID0gIiBcdTA2NTBcdTA2NTEiOwogICAgICB0WyJcdUZDNjMiXSA9ICIgXHUwNjUxXHUwNjcwIjsKICAgICAgdFsiXHVGQzY0Il0gPSAiXHUwNjI2XHUwNjMxIjsKICAgICAgdFsiXHVGQzY1Il0gPSAiXHUwNjI2XHUwNjMyIjsKICAgICAgdFsiXHVGQzY2Il0gPSAiXHUwNjI2XHUwNjQ1IjsKICAgICAgdFsiXHVGQzY3Il0gPSAiXHUwNjI2XHUwNjQ2IjsKICAgICAgdFsiXHVGQzY4Il0gPSAiXHUwNjI2XHUwNjQ5IjsKICAgICAgdFsiXHVGQzY5Il0gPSAiXHUwNjI2XHUwNjRBIjsKICAgICAgdFsiXHVGQzZBIl0gPSAiXHUwNjI4XHUwNjMxIjsKICAgICAgdFsiXHVGQzZCIl0gPSAiXHUwNjI4XHUwNjMyIjsKICAgICAgdFsiXHVGQzZDIl0gPSAiXHUwNjI4XHUwNjQ1IjsKICAgICAgdFsiXHVGQzZEIl0gPSAiXHUwNjI4XHUwNjQ2IjsKICAgICAgdFsiXHVGQzZFIl0gPSAiXHUwNjI4XHUwNjQ5IjsKICAgICAgdFsiXHVGQzZGIl0gPSAiXHUwNjI4XHUwNjRBIjsKICAgICAgdFsiXHVGQzcwIl0gPSAiXHUwNjJBXHUwNjMxIjsKICAgICAgdFsiXHVGQzcxIl0gPSAiXHUwNjJBXHUwNjMyIjsKICAgICAgdFsiXHVGQzcyIl0gPSAiXHUwNjJBXHUwNjQ1IjsKICAgICAgdFsiXHVGQzczIl0gPSAiXHUwNjJBXHUwNjQ2IjsKICAgICAgdFsiXHVGQzc0Il0gPSAiXHUwNjJBXHUwNjQ5IjsKICAgICAgdFsiXHVGQzc1Il0gPSAiXHUwNjJBXHUwNjRBIjsKICAgICAgdFsiXHVGQzc2Il0gPSAiXHUwNjJCXHUwNjMxIjsKICAgICAgdFsiXHVGQzc3Il0gPSAiXHUwNjJCXHUwNjMyIjsKICAgICAgdFsiXHVGQzc4Il0gPSAiXHUwNjJCXHUwNjQ1IjsKICAgICAgdFsiXHVGQzc5Il0gPSAiXHUwNjJCXHUwNjQ2IjsKICAgICAgdFsiXHVGQzdBIl0gPSAiXHUwNjJCXHUwNjQ5IjsKICAgICAgdFsiXHVGQzdCIl0gPSAiXHUwNjJCXHUwNjRBIjsKICAgICAgdFsiXHVGQzdDIl0gPSAiXHUwNjQxXHUwNjQ5IjsKICAgICAgdFsiXHVGQzdEIl0gPSAiXHUwNjQxXHUwNjRBIjsKICAgICAgdFsiXHVGQzdFIl0gPSAiXHUwNjQyXHUwNjQ5IjsKICAgICAgdFsiXHVGQzdGIl0gPSAiXHUwNjQyXHUwNjRBIjsKICAgICAgdFsiXHVGQzgwIl0gPSAiXHUwNjQzXHUwNjI3IjsKICAgICAgdFsiXHVGQzgxIl0gPSAiXHUwNjQzXHUwNjQ0IjsKICAgICAgdFsiXHVGQzgyIl0gPSAiXHUwNjQzXHUwNjQ1IjsKICAgICAgdFsiXHVGQzgzIl0gPSAiXHUwNjQzXHUwNjQ5IjsKICAgICAgdFsiXHVGQzg0Il0gPSAiXHUwNjQzXHUwNjRBIjsKICAgICAgdFsiXHVGQzg1Il0gPSAiXHUwNjQ0XHUwNjQ1IjsKICAgICAgdFsiXHVGQzg2Il0gPSAiXHUwNjQ0XHUwNjQ5IjsKICAgICAgdFsiXHVGQzg3Il0gPSAiXHUwNjQ0XHUwNjRBIjsKICAgICAgdFsiXHVGQzg4Il0gPSAiXHUwNjQ1XHUwNjI3IjsKICAgICAgdFsiXHVGQzg5Il0gPSAiXHUwNjQ1XHUwNjQ1IjsKICAgICAgdFsiXHVGQzhBIl0gPSAiXHUwNjQ2XHUwNjMxIjsKICAgICAgdFsiXHVGQzhCIl0gPSAiXHUwNjQ2XHUwNjMyIjsKICAgICAgdFsiXHVGQzhDIl0gPSAiXHUwNjQ2XHUwNjQ1IjsKICAgICAgdFsiXHVGQzhEIl0gPSAiXHUwNjQ2XHUwNjQ2IjsKICAgICAgdFsiXHVGQzhFIl0gPSAiXHUwNjQ2XHUwNjQ5IjsKICAgICAgdFsiXHVGQzhGIl0gPSAiXHUwNjQ2XHUwNjRBIjsKICAgICAgdFsiXHVGQzkwIl0gPSAiXHUwNjQ5XHUwNjcwIjsKICAgICAgdFsiXHVGQzkxIl0gPSAiXHUwNjRBXHUwNjMxIjsKICAgICAgdFsiXHVGQzkyIl0gPSAiXHUwNjRBXHUwNjMyIjsKICAgICAgdFsiXHVGQzkzIl0gPSAiXHUwNjRBXHUwNjQ1IjsKICAgICAgdFsiXHVGQzk0Il0gPSAiXHUwNjRBXHUwNjQ2IjsKICAgICAgdFsiXHVGQzk1Il0gPSAiXHUwNjRBXHUwNjQ5IjsKICAgICAgdFsiXHVGQzk2Il0gPSAiXHUwNjRBXHUwNjRBIjsKICAgICAgdFsiXHVGQzk3Il0gPSAiXHUwNjI2XHUwNjJDIjsKICAgICAgdFsiXHVGQzk4Il0gPSAiXHUwNjI2XHUwNjJEIjsKICAgICAgdFsiXHVGQzk5Il0gPSAiXHUwNjI2XHUwNjJFIjsKICAgICAgdFsiXHVGQzlBIl0gPSAiXHUwNjI2XHUwNjQ1IjsKICAgICAgdFsiXHVGQzlCIl0gPSAiXHUwNjI2XHUwNjQ3IjsKICAgICAgdFsiXHVGQzlDIl0gPSAiXHUwNjI4XHUwNjJDIjsKICAgICAgdFsiXHVGQzlEIl0gPSAiXHUwNjI4XHUwNjJEIjsKICAgICAgdFsiXHVGQzlFIl0gPSAiXHUwNjI4XHUwNjJFIjsKICAgICAgdFsiXHVGQzlGIl0gPSAiXHUwNjI4XHUwNjQ1IjsKICAgICAgdFsiXHVGQ0EwIl0gPSAiXHUwNjI4XHUwNjQ3IjsKICAgICAgdFsiXHVGQ0ExIl0gPSAiXHUwNjJBXHUwNjJDIjsKICAgICAgdFsiXHVGQ0EyIl0gPSAiXHUwNjJBXHUwNjJEIjsKICAgICAgdFsiXHVGQ0EzIl0gPSAiXHUwNjJBXHUwNjJFIjsKICAgICAgdFsiXHVGQ0E0Il0gPSAiXHUwNjJBXHUwNjQ1IjsKICAgICAgdFsiXHVGQ0E1Il0gPSAiXHUwNjJBXHUwNjQ3IjsKICAgICAgdFsiXHVGQ0E2Il0gPSAiXHUwNjJCXHUwNjQ1IjsKICAgICAgdFsiXHVGQ0E3Il0gPSAiXHUwNjJDXHUwNjJEIjsKICAgICAgdFsiXHVGQ0E4Il0gPSAiXHUwNjJDXHUwNjQ1IjsKICAgICAgdFsiXHVGQ0E5Il0gPSAiXHUwNjJEXHUwNjJDIjsKICAgICAgdFsiXHVGQ0FBIl0gPSAiXHUwNjJEXHUwNjQ1IjsKICAgICAgdFsiXHVGQ0FCIl0gPSAiXHUwNjJFXHUwNjJDIjsKICAgICAgdFsiXHVGQ0FDIl0gPSAiXHUwNjJFXHUwNjQ1IjsKICAgICAgdFsiXHVGQ0FEIl0gPSAiXHUwNjMzXHUwNjJDIjsKICAgICAgdFsiXHVGQ0FFIl0gPSAiXHUwNjMzXHUwNjJEIjsKICAgICAgdFsiXHVGQ0FGIl0gPSAiXHUwNjMzXHUwNjJFIjsKICAgICAgdFsiXHVGQ0IwIl0gPSAiXHUwNjMzXHUwNjQ1IjsKICAgICAgdFsiXHVGQ0IxIl0gPSAiXHUwNjM1XHUwNjJEIjsKICAgICAgdFsiXHVGQ0IyIl0gPSAiXHUwNjM1XHUwNjJFIjsKICAgICAgdFsiXHVGQ0IzIl0gPSAiXHUwNjM1XHUwNjQ1IjsKICAgICAgdFsiXHVGQ0I0Il0gPSAiXHUwNjM2XHUwNjJDIjsKICAgICAgdFsiXHVGQ0I1Il0gPSAiXHUwNjM2XHUwNjJEIjsKICAgICAgdFsiXHVGQ0I2Il0gPSAiXHUwNjM2XHUwNjJFIjsKICAgICAgdFsiXHVGQ0I3Il0gPSAiXHUwNjM2XHUwNjQ1IjsKICAgICAgdFsiXHVGQ0I4Il0gPSAiXHUwNjM3XHUwNjJEIjsKICAgICAgdFsiXHVGQ0I5Il0gPSAiXHUwNjM4XHUwNjQ1IjsKICAgICAgdFsiXHVGQ0JBIl0gPSAiXHUwNjM5XHUwNjJDIjsKICAgICAgdFsiXHVGQ0JCIl0gPSAiXHUwNjM5XHUwNjQ1IjsKICAgICAgdFsiXHVGQ0JDIl0gPSAiXHUwNjNBXHUwNjJDIjsKICAgICAgdFsiXHVGQ0JEIl0gPSAiXHUwNjNBXHUwNjQ1IjsKICAgICAgdFsiXHVGQ0JFIl0gPSAiXHUwNjQxXHUwNjJDIjsKICAgICAgdFsiXHVGQ0JGIl0gPSAiXHUwNjQxXHUwNjJEIjsKICAgICAgdFsiXHVGQ0MwIl0gPSAiXHUwNjQxXHUwNjJFIjsKICAgICAgdFsiXHVGQ0MxIl0gPSAiXHUwNjQxXHUwNjQ1IjsKICAgICAgdFsiXHVGQ0MyIl0gPSAiXHUwNjQyXHUwNjJEIjsKICAgICAgdFsiXHVGQ0MzIl0gPSAiXHUwNjQyXHUwNjQ1IjsKICAgICAgdFsiXHVGQ0M0Il0gPSAiXHUwNjQzXHUwNjJDIjsKICAgICAgdFsiXHVGQ0M1Il0gPSAiXHUwNjQzXHUwNjJEIjsKICAgICAgdFsiXHVGQ0M2Il0gPSAiXHUwNjQzXHUwNjJFIjsKICAgICAgdFsiXHVGQ0M3Il0gPSAiXHUwNjQzXHUwNjQ0IjsKICAgICAgdFsiXHVGQ0M4Il0gPSAiXHUwNjQzXHUwNjQ1IjsKICAgICAgdFsiXHVGQ0M5Il0gPSAiXHUwNjQ0XHUwNjJDIjsKICAgICAgdFsiXHVGQ0NBIl0gPSAiXHUwNjQ0XHUwNjJEIjsKICAgICAgdFsiXHVGQ0NCIl0gPSAiXHUwNjQ0XHUwNjJFIjsKICAgICAgdFsiXHVGQ0NDIl0gPSAiXHUwNjQ0XHUwNjQ1IjsKICAgICAgdFsiXHVGQ0NEIl0gPSAiXHUwNjQ0XHUwNjQ3IjsKICAgICAgdFsiXHVGQ0NFIl0gPSAiXHUwNjQ1XHUwNjJDIjsKICAgICAgdFsiXHVGQ0NGIl0gPSAiXHUwNjQ1XHUwNjJEIjsKICAgICAgdFsiXHVGQ0QwIl0gPSAiXHUwNjQ1XHUwNjJFIjsKICAgICAgdFsiXHVGQ0QxIl0gPSAiXHUwNjQ1XHUwNjQ1IjsKICAgICAgdFsiXHVGQ0QyIl0gPSAiXHUwNjQ2XHUwNjJDIjsKICAgICAgdFsiXHVGQ0QzIl0gPSAiXHUwNjQ2XHUwNjJEIjsKICAgICAgdFsiXHVGQ0Q0Il0gPSAiXHUwNjQ2XHUwNjJFIjsKICAgICAgdFsiXHVGQ0Q1Il0gPSAiXHUwNjQ2XHUwNjQ1IjsKICAgICAgdFsiXHVGQ0Q2Il0gPSAiXHUwNjQ2XHUwNjQ3IjsKICAgICAgdFsiXHVGQ0Q3Il0gPSAiXHUwNjQ3XHUwNjJDIjsKICAgICAgdFsiXHVGQ0Q4Il0gPSAiXHUwNjQ3XHUwNjQ1IjsKICAgICAgdFsiXHVGQ0Q5Il0gPSAiXHUwNjQ3XHUwNjcwIjsKICAgICAgdFsiXHVGQ0RBIl0gPSAiXHUwNjRBXHUwNjJDIjsKICAgICAgdFsiXHVGQ0RCIl0gPSAiXHUwNjRBXHUwNjJEIjsKICAgICAgdFsiXHVGQ0RDIl0gPSAiXHUwNjRBXHUwNjJFIjsKICAgICAgdFsiXHVGQ0REIl0gPSAiXHUwNjRBXHUwNjQ1IjsKICAgICAgdFsiXHVGQ0RFIl0gPSAiXHUwNjRBXHUwNjQ3IjsKICAgICAgdFsiXHVGQ0RGIl0gPSAiXHUwNjI2XHUwNjQ1IjsKICAgICAgdFsiXHVGQ0UwIl0gPSAiXHUwNjI2XHUwNjQ3IjsKICAgICAgdFsiXHVGQ0UxIl0gPSAiXHUwNjI4XHUwNjQ1IjsKICAgICAgdFsiXHVGQ0UyIl0gPSAiXHUwNjI4XHUwNjQ3IjsKICAgICAgdFsiXHVGQ0UzIl0gPSAiXHUwNjJBXHUwNjQ1IjsKICAgICAgdFsiXHVGQ0U0Il0gPSAiXHUwNjJBXHUwNjQ3IjsKICAgICAgdFsiXHVGQ0U1Il0gPSAiXHUwNjJCXHUwNjQ1IjsKICAgICAgdFsiXHVGQ0U2Il0gPSAiXHUwNjJCXHUwNjQ3IjsKICAgICAgdFsiXHVGQ0U3Il0gPSAiXHUwNjMzXHUwNjQ1IjsKICAgICAgdFsiXHVGQ0U4Il0gPSAiXHUwNjMzXHUwNjQ3IjsKICAgICAgdFsiXHVGQ0U5Il0gPSAiXHUwNjM0XHUwNjQ1IjsKICAgICAgdFsiXHVGQ0VBIl0gPSAiXHUwNjM0XHUwNjQ3IjsKICAgICAgdFsiXHVGQ0VCIl0gPSAiXHUwNjQzXHUwNjQ0IjsKICAgICAgdFsiXHVGQ0VDIl0gPSAiXHUwNjQzXHUwNjQ1IjsKICAgICAgdFsiXHVGQ0VEIl0gPSAiXHUwNjQ0XHUwNjQ1IjsKICAgICAgdFsiXHVGQ0VFIl0gPSAiXHUwNjQ2XHUwNjQ1IjsKICAgICAgdFsiXHVGQ0VGIl0gPSAiXHUwNjQ2XHUwNjQ3IjsKICAgICAgdFsiXHVGQ0YwIl0gPSAiXHUwNjRBXHUwNjQ1IjsKICAgICAgdFsiXHVGQ0YxIl0gPSAiXHUwNjRBXHUwNjQ3IjsKICAgICAgdFsiXHVGQ0YyIl0gPSAiXHUwNjQwXHUwNjRFXHUwNjUxIjsKICAgICAgdFsiXHVGQ0YzIl0gPSAiXHUwNjQwXHUwNjRGXHUwNjUxIjsKICAgICAgdFsiXHVGQ0Y0Il0gPSAiXHUwNjQwXHUwNjUwXHUwNjUxIjsKICAgICAgdFsiXHVGQ0Y1Il0gPSAiXHUwNjM3XHUwNjQ5IjsKICAgICAgdFsiXHVGQ0Y2Il0gPSAiXHUwNjM3XHUwNjRBIjsKICAgICAgdFsiXHVGQ0Y3Il0gPSAiXHUwNjM5XHUwNjQ5IjsKICAgICAgdFsiXHVGQ0Y4Il0gPSAiXHUwNjM5XHUwNjRBIjsKICAgICAgdFsiXHVGQ0Y5Il0gPSAiXHUwNjNBXHUwNjQ5IjsKICAgICAgdFsiXHVGQ0ZBIl0gPSAiXHUwNjNBXHUwNjRBIjsKICAgICAgdFsiXHVGQ0ZCIl0gPSAiXHUwNjMzXHUwNjQ5IjsKICAgICAgdFsiXHVGQ0ZDIl0gPSAiXHUwNjMzXHUwNjRBIjsKICAgICAgdFsiXHVGQ0ZEIl0gPSAiXHUwNjM0XHUwNjQ5IjsKICAgICAgdFsiXHVGQ0ZFIl0gPSAiXHUwNjM0XHUwNjRBIjsKICAgICAgdFsiXHVGQ0ZGIl0gPSAiXHUwNjJEXHUwNjQ5IjsKICAgICAgdFsiXHVGRDAwIl0gPSAiXHUwNjJEXHUwNjRBIjsKICAgICAgdFsiXHVGRDAxIl0gPSAiXHUwNjJDXHUwNjQ5IjsKICAgICAgdFsiXHVGRDAyIl0gPSAiXHUwNjJDXHUwNjRBIjsKICAgICAgdFsiXHVGRDAzIl0gPSAiXHUwNjJFXHUwNjQ5IjsKICAgICAgdFsiXHVGRDA0Il0gPSAiXHUwNjJFXHUwNjRBIjsKICAgICAgdFsiXHVGRDA1Il0gPSAiXHUwNjM1XHUwNjQ5IjsKICAgICAgdFsiXHVGRDA2Il0gPSAiXHUwNjM1XHUwNjRBIjsKICAgICAgdFsiXHVGRDA3Il0gPSAiXHUwNjM2XHUwNjQ5IjsKICAgICAgdFsiXHVGRDA4Il0gPSAiXHUwNjM2XHUwNjRBIjsKICAgICAgdFsiXHVGRDA5Il0gPSAiXHUwNjM0XHUwNjJDIjsKICAgICAgdFsiXHVGRDBBIl0gPSAiXHUwNjM0XHUwNjJEIjsKICAgICAgdFsiXHVGRDBCIl0gPSAiXHUwNjM0XHUwNjJFIjsKICAgICAgdFsiXHVGRDBDIl0gPSAiXHUwNjM0XHUwNjQ1IjsKICAgICAgdFsiXHVGRDBEIl0gPSAiXHUwNjM0XHUwNjMxIjsKICAgICAgdFsiXHVGRDBFIl0gPSAiXHUwNjMzXHUwNjMxIjsKICAgICAgdFsiXHVGRDBGIl0gPSAiXHUwNjM1XHUwNjMxIjsKICAgICAgdFsiXHVGRDEwIl0gPSAiXHUwNjM2XHUwNjMxIjsKICAgICAgdFsiXHVGRDExIl0gPSAiXHUwNjM3XHUwNjQ5IjsKICAgICAgdFsiXHVGRDEyIl0gPSAiXHUwNjM3XHUwNjRBIjsKICAgICAgdFsiXHVGRDEzIl0gPSAiXHUwNjM5XHUwNjQ5IjsKICAgICAgdFsiXHVGRDE0Il0gPSAiXHUwNjM5XHUwNjRBIjsKICAgICAgdFsiXHVGRDE1Il0gPSAiXHUwNjNBXHUwNjQ5IjsKICAgICAgdFsiXHVGRDE2Il0gPSAiXHUwNjNBXHUwNjRBIjsKICAgICAgdFsiXHVGRDE3Il0gPSAiXHUwNjMzXHUwNjQ5IjsKICAgICAgdFsiXHVGRDE4Il0gPSAiXHUwNjMzXHUwNjRBIjsKICAgICAgdFsiXHVGRDE5Il0gPSAiXHUwNjM0XHUwNjQ5IjsKICAgICAgdFsiXHVGRDFBIl0gPSAiXHUwNjM0XHUwNjRBIjsKICAgICAgdFsiXHVGRDFCIl0gPSAiXHUwNjJEXHUwNjQ5IjsKICAgICAgdFsiXHVGRDFDIl0gPSAiXHUwNjJEXHUwNjRBIjsKICAgICAgdFsiXHVGRDFEIl0gPSAiXHUwNjJDXHUwNjQ5IjsKICAgICAgdFsiXHVGRDFFIl0gPSAiXHUwNjJDXHUwNjRBIjsKICAgICAgdFsiXHVGRDFGIl0gPSAiXHUwNjJFXHUwNjQ5IjsKICAgICAgdFsiXHVGRDIwIl0gPSAiXHUwNjJFXHUwNjRBIjsKICAgICAgdFsiXHVGRDIxIl0gPSAiXHUwNjM1XHUwNjQ5IjsKICAgICAgdFsiXHVGRDIyIl0gPSAiXHUwNjM1XHUwNjRBIjsKICAgICAgdFsiXHVGRDIzIl0gPSAiXHUwNjM2XHUwNjQ5IjsKICAgICAgdFsiXHVGRDI0Il0gPSAiXHUwNjM2XHUwNjRBIjsKICAgICAgdFsiXHVGRDI1Il0gPSAiXHUwNjM0XHUwNjJDIjsKICAgICAgdFsiXHVGRDI2Il0gPSAiXHUwNjM0XHUwNjJEIjsKICAgICAgdFsiXHVGRDI3Il0gPSAiXHUwNjM0XHUwNjJFIjsKICAgICAgdFsiXHVGRDI4Il0gPSAiXHUwNjM0XHUwNjQ1IjsKICAgICAgdFsiXHVGRDI5Il0gPSAiXHUwNjM0XHUwNjMxIjsKICAgICAgdFsiXHVGRDJBIl0gPSAiXHUwNjMzXHUwNjMxIjsKICAgICAgdFsiXHVGRDJCIl0gPSAiXHUwNjM1XHUwNjMxIjsKICAgICAgdFsiXHVGRDJDIl0gPSAiXHUwNjM2XHUwNjMxIjsKICAgICAgdFsiXHVGRDJEIl0gPSAiXHUwNjM0XHUwNjJDIjsKICAgICAgdFsiXHVGRDJFIl0gPSAiXHUwNjM0XHUwNjJEIjsKICAgICAgdFsiXHVGRDJGIl0gPSAiXHUwNjM0XHUwNjJFIjsKICAgICAgdFsiXHVGRDMwIl0gPSAiXHUwNjM0XHUwNjQ1IjsKICAgICAgdFsiXHVGRDMxIl0gPSAiXHUwNjMzXHUwNjQ3IjsKICAgICAgdFsiXHVGRDMyIl0gPSAiXHUwNjM0XHUwNjQ3IjsKICAgICAgdFsiXHVGRDMzIl0gPSAiXHUwNjM3XHUwNjQ1IjsKICAgICAgdFsiXHVGRDM0Il0gPSAiXHUwNjMzXHUwNjJDIjsKICAgICAgdFsiXHVGRDM1Il0gPSAiXHUwNjMzXHUwNjJEIjsKICAgICAgdFsiXHVGRDM2Il0gPSAiXHUwNjMzXHUwNjJFIjsKICAgICAgdFsiXHVGRDM3Il0gPSAiXHUwNjM0XHUwNjJDIjsKICAgICAgdFsiXHVGRDM4Il0gPSAiXHUwNjM0XHUwNjJEIjsKICAgICAgdFsiXHVGRDM5Il0gPSAiXHUwNjM0XHUwNjJFIjsKICAgICAgdFsiXHVGRDNBIl0gPSAiXHUwNjM3XHUwNjQ1IjsKICAgICAgdFsiXHVGRDNCIl0gPSAiXHUwNjM4XHUwNjQ1IjsKICAgICAgdFsiXHVGRDNDIl0gPSAiXHUwNjI3XHUwNjRCIjsKICAgICAgdFsiXHVGRDNEIl0gPSAiXHUwNjI3XHUwNjRCIjsKICAgICAgdFsiXHVGRDUwIl0gPSAiXHUwNjJBXHUwNjJDXHUwNjQ1IjsKICAgICAgdFsiXHVGRDUxIl0gPSAiXHUwNjJBXHUwNjJEXHUwNjJDIjsKICAgICAgdFsiXHVGRDUyIl0gPSAiXHUwNjJBXHUwNjJEXHUwNjJDIjsKICAgICAgdFsiXHVGRDUzIl0gPSAiXHUwNjJBXHUwNjJEXHUwNjQ1IjsKICAgICAgdFsiXHVGRDU0Il0gPSAiXHUwNjJBXHUwNjJFXHUwNjQ1IjsKICAgICAgdFsiXHVGRDU1Il0gPSAiXHUwNjJBXHUwNjQ1XHUwNjJDIjsKICAgICAgdFsiXHVGRDU2Il0gPSAiXHUwNjJBXHUwNjQ1XHUwNjJEIjsKICAgICAgdFsiXHVGRDU3Il0gPSAiXHUwNjJBXHUwNjQ1XHUwNjJFIjsKICAgICAgdFsiXHVGRDU4Il0gPSAiXHUwNjJDXHUwNjQ1XHUwNjJEIjsKICAgICAgdFsiXHVGRDU5Il0gPSAiXHUwNjJDXHUwNjQ1XHUwNjJEIjsKICAgICAgdFsiXHVGRDVBIl0gPSAiXHUwNjJEXHUwNjQ1XHUwNjRBIjsKICAgICAgdFsiXHVGRDVCIl0gPSAiXHUwNjJEXHUwNjQ1XHUwNjQ5IjsKICAgICAgdFsiXHVGRDVDIl0gPSAiXHUwNjMzXHUwNjJEXHUwNjJDIjsKICAgICAgdFsiXHVGRDVEIl0gPSAiXHUwNjMzXHUwNjJDXHUwNjJEIjsKICAgICAgdFsiXHVGRDVFIl0gPSAiXHUwNjMzXHUwNjJDXHUwNjQ5IjsKICAgICAgdFsiXHVGRDVGIl0gPSAiXHUwNjMzXHUwNjQ1XHUwNjJEIjsKICAgICAgdFsiXHVGRDYwIl0gPSAiXHUwNjMzXHUwNjQ1XHUwNjJEIjsKICAgICAgdFsiXHVGRDYxIl0gPSAiXHUwNjMzXHUwNjQ1XHUwNjJDIjsKICAgICAgdFsiXHVGRDYyIl0gPSAiXHUwNjMzXHUwNjQ1XHUwNjQ1IjsKICAgICAgdFsiXHVGRDYzIl0gPSAiXHUwNjMzXHUwNjQ1XHUwNjQ1IjsKICAgICAgdFsiXHVGRDY0Il0gPSAiXHUwNjM1XHUwNjJEXHUwNjJEIjsKICAgICAgdFsiXHVGRDY1Il0gPSAiXHUwNjM1XHUwNjJEXHUwNjJEIjsKICAgICAgdFsiXHVGRDY2Il0gPSAiXHUwNjM1XHUwNjQ1XHUwNjQ1IjsKICAgICAgdFsiXHVGRDY3Il0gPSAiXHUwNjM0XHUwNjJEXHUwNjQ1IjsKICAgICAgdFsiXHVGRDY4Il0gPSAiXHUwNjM0XHUwNjJEXHUwNjQ1IjsKICAgICAgdFsiXHVGRDY5Il0gPSAiXHUwNjM0XHUwNjJDXHUwNjRBIjsKICAgICAgdFsiXHVGRDZBIl0gPSAiXHUwNjM0XHUwNjQ1XHUwNjJFIjsKICAgICAgdFsiXHVGRDZCIl0gPSAiXHUwNjM0XHUwNjQ1XHUwNjJFIjsKICAgICAgdFsiXHVGRDZDIl0gPSAiXHUwNjM0XHUwNjQ1XHUwNjQ1IjsKICAgICAgdFsiXHVGRDZEIl0gPSAiXHUwNjM0XHUwNjQ1XHUwNjQ1IjsKICAgICAgdFsiXHVGRDZFIl0gPSAiXHUwNjM2XHUwNjJEXHUwNjQ5IjsKICAgICAgdFsiXHVGRDZGIl0gPSAiXHUwNjM2XHUwNjJFXHUwNjQ1IjsKICAgICAgdFsiXHVGRDcwIl0gPSAiXHUwNjM2XHUwNjJFXHUwNjQ1IjsKICAgICAgdFsiXHVGRDcxIl0gPSAiXHUwNjM3XHUwNjQ1XHUwNjJEIjsKICAgICAgdFsiXHVGRDcyIl0gPSAiXHUwNjM3XHUwNjQ1XHUwNjJEIjsKICAgICAgdFsiXHVGRDczIl0gPSAiXHUwNjM3XHUwNjQ1XHUwNjQ1IjsKICAgICAgdFsiXHVGRDc0Il0gPSAiXHUwNjM3XHUwNjQ1XHUwNjRBIjsKICAgICAgdFsiXHVGRDc1Il0gPSAiXHUwNjM5XHUwNjJDXHUwNjQ1IjsKICAgICAgdFsiXHVGRDc2Il0gPSAiXHUwNjM5XHUwNjQ1XHUwNjQ1IjsKICAgICAgdFsiXHVGRDc3Il0gPSAiXHUwNjM5XHUwNjQ1XHUwNjQ1IjsKICAgICAgdFsiXHVGRDc4Il0gPSAiXHUwNjM5XHUwNjQ1XHUwNjQ5IjsKICAgICAgdFsiXHVGRDc5Il0gPSAiXHUwNjNBXHUwNjQ1XHUwNjQ1IjsKICAgICAgdFsiXHVGRDdBIl0gPSAiXHUwNjNBXHUwNjQ1XHUwNjRBIjsKICAgICAgdFsiXHVGRDdCIl0gPSAiXHUwNjNBXHUwNjQ1XHUwNjQ5IjsKICAgICAgdFsiXHVGRDdDIl0gPSAiXHUwNjQxXHUwNjJFXHUwNjQ1IjsKICAgICAgdFsiXHVGRDdEIl0gPSAiXHUwNjQxXHUwNjJFXHUwNjQ1IjsKICAgICAgdFsiXHVGRDdFIl0gPSAiXHUwNjQyXHUwNjQ1XHUwNjJEIjsKICAgICAgdFsiXHVGRDdGIl0gPSAiXHUwNjQyXHUwNjQ1XHUwNjQ1IjsKICAgICAgdFsiXHVGRDgwIl0gPSAiXHUwNjQ0XHUwNjJEXHUwNjQ1IjsKICAgICAgdFsiXHVGRDgxIl0gPSAiXHUwNjQ0XHUwNjJEXHUwNjRBIjsKICAgICAgdFsiXHVGRDgyIl0gPSAiXHUwNjQ0XHUwNjJEXHUwNjQ5IjsKICAgICAgdFsiXHVGRDgzIl0gPSAiXHUwNjQ0XHUwNjJDXHUwNjJDIjsKICAgICAgdFsiXHVGRDg0Il0gPSAiXHUwNjQ0XHUwNjJDXHUwNjJDIjsKICAgICAgdFsiXHVGRDg1Il0gPSAiXHUwNjQ0XHUwNjJFXHUwNjQ1IjsKICAgICAgdFsiXHVGRDg2Il0gPSAiXHUwNjQ0XHUwNjJFXHUwNjQ1IjsKICAgICAgdFsiXHVGRDg3Il0gPSAiXHUwNjQ0XHUwNjQ1XHUwNjJEIjsKICAgICAgdFsiXHVGRDg4Il0gPSAiXHUwNjQ0XHUwNjQ1XHUwNjJEIjsKICAgICAgdFsiXHVGRDg5Il0gPSAiXHUwNjQ1XHUwNjJEXHUwNjJDIjsKICAgICAgdFsiXHVGRDhBIl0gPSAiXHUwNjQ1XHUwNjJEXHUwNjQ1IjsKICAgICAgdFsiXHVGRDhCIl0gPSAiXHUwNjQ1XHUwNjJEXHUwNjRBIjsKICAgICAgdFsiXHVGRDhDIl0gPSAiXHUwNjQ1XHUwNjJDXHUwNjJEIjsKICAgICAgdFsiXHVGRDhEIl0gPSAiXHUwNjQ1XHUwNjJDXHUwNjQ1IjsKICAgICAgdFsiXHVGRDhFIl0gPSAiXHUwNjQ1XHUwNjJFXHUwNjJDIjsKICAgICAgdFsiXHVGRDhGIl0gPSAiXHUwNjQ1XHUwNjJFXHUwNjQ1IjsKICAgICAgdFsiXHVGRDkyIl0gPSAiXHUwNjQ1XHUwNjJDXHUwNjJFIjsKICAgICAgdFsiXHVGRDkzIl0gPSAiXHUwNjQ3XHUwNjQ1XHUwNjJDIjsKICAgICAgdFsiXHVGRDk0Il0gPSAiXHUwNjQ3XHUwNjQ1XHUwNjQ1IjsKICAgICAgdFsiXHVGRDk1Il0gPSAiXHUwNjQ2XHUwNjJEXHUwNjQ1IjsKICAgICAgdFsiXHVGRDk2Il0gPSAiXHUwNjQ2XHUwNjJEXHUwNjQ5IjsKICAgICAgdFsiXHVGRDk3Il0gPSAiXHUwNjQ2XHUwNjJDXHUwNjQ1IjsKICAgICAgdFsiXHVGRDk4Il0gPSAiXHUwNjQ2XHUwNjJDXHUwNjQ1IjsKICAgICAgdFsiXHVGRDk5Il0gPSAiXHUwNjQ2XHUwNjJDXHUwNjQ5IjsKICAgICAgdFsiXHVGRDlBIl0gPSAiXHUwNjQ2XHUwNjQ1XHUwNjRBIjsKICAgICAgdFsiXHVGRDlCIl0gPSAiXHUwNjQ2XHUwNjQ1XHUwNjQ5IjsKICAgICAgdFsiXHVGRDlDIl0gPSAiXHUwNjRBXHUwNjQ1XHUwNjQ1IjsKICAgICAgdFsiXHVGRDlEIl0gPSAiXHUwNjRBXHUwNjQ1XHUwNjQ1IjsKICAgICAgdFsiXHVGRDlFIl0gPSAiXHUwNjI4XHUwNjJFXHUwNjRBIjsKICAgICAgdFsiXHVGRDlGIl0gPSAiXHUwNjJBXHUwNjJDXHUwNjRBIjsKICAgICAgdFsiXHVGREEwIl0gPSAiXHUwNjJBXHUwNjJDXHUwNjQ5IjsKICAgICAgdFsiXHVGREExIl0gPSAiXHUwNjJBXHUwNjJFXHUwNjRBIjsKICAgICAgdFsiXHVGREEyIl0gPSAiXHUwNjJBXHUwNjJFXHUwNjQ5IjsKICAgICAgdFsiXHVGREEzIl0gPSAiXHUwNjJBXHUwNjQ1XHUwNjRBIjsKICAgICAgdFsiXHVGREE0Il0gPSAiXHUwNjJBXHUwNjQ1XHUwNjQ5IjsKICAgICAgdFsiXHVGREE1Il0gPSAiXHUwNjJDXHUwNjQ1XHUwNjRBIjsKICAgICAgdFsiXHVGREE2Il0gPSAiXHUwNjJDXHUwNjJEXHUwNjQ5IjsKICAgICAgdFsiXHVGREE3Il0gPSAiXHUwNjJDXHUwNjQ1XHUwNjQ5IjsKICAgICAgdFsiXHVGREE4Il0gPSAiXHUwNjMzXHUwNjJFXHUwNjQ5IjsKICAgICAgdFsiXHVGREE5Il0gPSAiXHUwNjM1XHUwNjJEXHUwNjRBIjsKICAgICAgdFsiXHVGREFBIl0gPSAiXHUwNjM0XHUwNjJEXHUwNjRBIjsKICAgICAgdFsiXHVGREFCIl0gPSAiXHUwNjM2XHUwNjJEXHUwNjRBIjsKICAgICAgdFsiXHVGREFDIl0gPSAiXHUwNjQ0XHUwNjJDXHUwNjRBIjsKICAgICAgdFsiXHVGREFEIl0gPSAiXHUwNjQ0XHUwNjQ1XHUwNjRBIjsKICAgICAgdFsiXHVGREFFIl0gPSAiXHUwNjRBXHUwNjJEXHUwNjRBIjsKICAgICAgdFsiXHVGREFGIl0gPSAiXHUwNjRBXHUwNjJDXHUwNjRBIjsKICAgICAgdFsiXHVGREIwIl0gPSAiXHUwNjRBXHUwNjQ1XHUwNjRBIjsKICAgICAgdFsiXHVGREIxIl0gPSAiXHUwNjQ1XHUwNjQ1XHUwNjRBIjsKICAgICAgdFsiXHVGREIyIl0gPSAiXHUwNjQyXHUwNjQ1XHUwNjRBIjsKICAgICAgdFsiXHVGREIzIl0gPSAiXHUwNjQ2XHUwNjJEXHUwNjRBIjsKICAgICAgdFsiXHVGREI0Il0gPSAiXHUwNjQyXHUwNjQ1XHUwNjJEIjsKICAgICAgdFsiXHVGREI1Il0gPSAiXHUwNjQ0XHUwNjJEXHUwNjQ1IjsKICAgICAgdFsiXHVGREI2Il0gPSAiXHUwNjM5XHUwNjQ1XHUwNjRBIjsKICAgICAgdFsiXHVGREI3Il0gPSAiXHUwNjQzXHUwNjQ1XHUwNjRBIjsKICAgICAgdFsiXHVGREI4Il0gPSAiXHUwNjQ2XHUwNjJDXHUwNjJEIjsKICAgICAgdFsiXHVGREI5Il0gPSAiXHUwNjQ1XHUwNjJFXHUwNjRBIjsKICAgICAgdFsiXHVGREJBIl0gPSAiXHUwNjQ0XHUwNjJDXHUwNjQ1IjsKICAgICAgdFsiXHVGREJCIl0gPSAiXHUwNjQzXHUwNjQ1XHUwNjQ1IjsKICAgICAgdFsiXHVGREJDIl0gPSAiXHUwNjQ0XHUwNjJDXHUwNjQ1IjsKICAgICAgdFsiXHVGREJEIl0gPSAiXHUwNjQ2XHUwNjJDXHUwNjJEIjsKICAgICAgdFsiXHVGREJFIl0gPSAiXHUwNjJDXHUwNjJEXHUwNjRBIjsKICAgICAgdFsiXHVGREJGIl0gPSAiXHUwNjJEXHUwNjJDXHUwNjRBIjsKICAgICAgdFsiXHVGREMwIl0gPSAiXHUwNjQ1XHUwNjJDXHUwNjRBIjsKICAgICAgdFsiXHVGREMxIl0gPSAiXHUwNjQxXHUwNjQ1XHUwNjRBIjsKICAgICAgdFsiXHVGREMyIl0gPSAiXHUwNjI4XHUwNjJEXHUwNjRBIjsKICAgICAgdFsiXHVGREMzIl0gPSAiXHUwNjQzXHUwNjQ1XHUwNjQ1IjsKICAgICAgdFsiXHVGREM0Il0gPSAiXHUwNjM5XHUwNjJDXHUwNjQ1IjsKICAgICAgdFsiXHVGREM1Il0gPSAiXHUwNjM1XHUwNjQ1XHUwNjQ1IjsKICAgICAgdFsiXHVGREM2Il0gPSAiXHUwNjMzXHUwNjJFXHUwNjRBIjsKICAgICAgdFsiXHVGREM3Il0gPSAiXHUwNjQ2XHUwNjJDXHUwNjRBIjsKICAgICAgdFsiXHVGRTQ5Il0gPSAiXHUyMDNFIjsKICAgICAgdFsiXHVGRTRBIl0gPSAiXHUyMDNFIjsKICAgICAgdFsiXHVGRTRCIl0gPSAiXHUyMDNFIjsKICAgICAgdFsiXHVGRTRDIl0gPSAiXHUyMDNFIjsKICAgICAgdFsiXHVGRTREIl0gPSAiXyI7CiAgICAgIHRbIlx1RkU0RSJdID0gIl8iOwogICAgICB0WyJcdUZFNEYiXSA9ICJfIjsKICAgICAgdFsiXHVGRTgwIl0gPSAiXHUwNjIxIjsKICAgICAgdFsiXHVGRTgxIl0gPSAiXHUwNjIyIjsKICAgICAgdFsiXHVGRTgyIl0gPSAiXHUwNjIyIjsKICAgICAgdFsiXHVGRTgzIl0gPSAiXHUwNjIzIjsKICAgICAgdFsiXHVGRTg0Il0gPSAiXHUwNjIzIjsKICAgICAgdFsiXHVGRTg1Il0gPSAiXHUwNjI0IjsKICAgICAgdFsiXHVGRTg2Il0gPSAiXHUwNjI0IjsKICAgICAgdFsiXHVGRTg3Il0gPSAiXHUwNjI1IjsKICAgICAgdFsiXHVGRTg4Il0gPSAiXHUwNjI1IjsKICAgICAgdFsiXHVGRTg5Il0gPSAiXHUwNjI2IjsKICAgICAgdFsiXHVGRThBIl0gPSAiXHUwNjI2IjsKICAgICAgdFsiXHVGRThCIl0gPSAiXHUwNjI2IjsKICAgICAgdFsiXHVGRThDIl0gPSAiXHUwNjI2IjsKICAgICAgdFsiXHVGRThEIl0gPSAiXHUwNjI3IjsKICAgICAgdFsiXHVGRThFIl0gPSAiXHUwNjI3IjsKICAgICAgdFsiXHVGRThGIl0gPSAiXHUwNjI4IjsKICAgICAgdFsiXHVGRTkwIl0gPSAiXHUwNjI4IjsKICAgICAgdFsiXHVGRTkxIl0gPSAiXHUwNjI4IjsKICAgICAgdFsiXHVGRTkyIl0gPSAiXHUwNjI4IjsKICAgICAgdFsiXHVGRTkzIl0gPSAiXHUwNjI5IjsKICAgICAgdFsiXHVGRTk0Il0gPSAiXHUwNjI5IjsKICAgICAgdFsiXHVGRTk1Il0gPSAiXHUwNjJBIjsKICAgICAgdFsiXHVGRTk2Il0gPSAiXHUwNjJBIjsKICAgICAgdFsiXHVGRTk3Il0gPSAiXHUwNjJBIjsKICAgICAgdFsiXHVGRTk4Il0gPSAiXHUwNjJBIjsKICAgICAgdFsiXHVGRTk5Il0gPSAiXHUwNjJCIjsKICAgICAgdFsiXHVGRTlBIl0gPSAiXHUwNjJCIjsKICAgICAgdFsiXHVGRTlCIl0gPSAiXHUwNjJCIjsKICAgICAgdFsiXHVGRTlDIl0gPSAiXHUwNjJCIjsKICAgICAgdFsiXHVGRTlEIl0gPSAiXHUwNjJDIjsKICAgICAgdFsiXHVGRTlFIl0gPSAiXHUwNjJDIjsKICAgICAgdFsiXHVGRTlGIl0gPSAiXHUwNjJDIjsKICAgICAgdFsiXHVGRUEwIl0gPSAiXHUwNjJDIjsKICAgICAgdFsiXHVGRUExIl0gPSAiXHUwNjJEIjsKICAgICAgdFsiXHVGRUEyIl0gPSAiXHUwNjJEIjsKICAgICAgdFsiXHVGRUEzIl0gPSAiXHUwNjJEIjsKICAgICAgdFsiXHVGRUE0Il0gPSAiXHUwNjJEIjsKICAgICAgdFsiXHVGRUE1Il0gPSAiXHUwNjJFIjsKICAgICAgdFsiXHVGRUE2Il0gPSAiXHUwNjJFIjsKICAgICAgdFsiXHVGRUE3Il0gPSAiXHUwNjJFIjsKICAgICAgdFsiXHVGRUE4Il0gPSAiXHUwNjJFIjsKICAgICAgdFsiXHVGRUE5Il0gPSAiXHUwNjJGIjsKICAgICAgdFsiXHVGRUFBIl0gPSAiXHUwNjJGIjsKICAgICAgdFsiXHVGRUFCIl0gPSAiXHUwNjMwIjsKICAgICAgdFsiXHVGRUFDIl0gPSAiXHUwNjMwIjsKICAgICAgdFsiXHVGRUFEIl0gPSAiXHUwNjMxIjsKICAgICAgdFsiXHVGRUFFIl0gPSAiXHUwNjMxIjsKICAgICAgdFsiXHVGRUFGIl0gPSAiXHUwNjMyIjsKICAgICAgdFsiXHVGRUIwIl0gPSAiXHUwNjMyIjsKICAgICAgdFsiXHVGRUIxIl0gPSAiXHUwNjMzIjsKICAgICAgdFsiXHVGRUIyIl0gPSAiXHUwNjMzIjsKICAgICAgdFsiXHVGRUIzIl0gPSAiXHUwNjMzIjsKICAgICAgdFsiXHVGRUI0Il0gPSAiXHUwNjMzIjsKICAgICAgdFsiXHVGRUI1Il0gPSAiXHUwNjM0IjsKICAgICAgdFsiXHVGRUI2Il0gPSAiXHUwNjM0IjsKICAgICAgdFsiXHVGRUI3Il0gPSAiXHUwNjM0IjsKICAgICAgdFsiXHVGRUI4Il0gPSAiXHUwNjM0IjsKICAgICAgdFsiXHVGRUI5Il0gPSAiXHUwNjM1IjsKICAgICAgdFsiXHVGRUJBIl0gPSAiXHUwNjM1IjsKICAgICAgdFsiXHVGRUJCIl0gPSAiXHUwNjM1IjsKICAgICAgdFsiXHVGRUJDIl0gPSAiXHUwNjM1IjsKICAgICAgdFsiXHVGRUJEIl0gPSAiXHUwNjM2IjsKICAgICAgdFsiXHVGRUJFIl0gPSAiXHUwNjM2IjsKICAgICAgdFsiXHVGRUJGIl0gPSAiXHUwNjM2IjsKICAgICAgdFsiXHVGRUMwIl0gPSAiXHUwNjM2IjsKICAgICAgdFsiXHVGRUMxIl0gPSAiXHUwNjM3IjsKICAgICAgdFsiXHVGRUMyIl0gPSAiXHUwNjM3IjsKICAgICAgdFsiXHVGRUMzIl0gPSAiXHUwNjM3IjsKICAgICAgdFsiXHVGRUM0Il0gPSAiXHUwNjM3IjsKICAgICAgdFsiXHVGRUM1Il0gPSAiXHUwNjM4IjsKICAgICAgdFsiXHVGRUM2Il0gPSAiXHUwNjM4IjsKICAgICAgdFsiXHVGRUM3Il0gPSAiXHUwNjM4IjsKICAgICAgdFsiXHVGRUM4Il0gPSAiXHUwNjM4IjsKICAgICAgdFsiXHVGRUM5Il0gPSAiXHUwNjM5IjsKICAgICAgdFsiXHVGRUNBIl0gPSAiXHUwNjM5IjsKICAgICAgdFsiXHVGRUNCIl0gPSAiXHUwNjM5IjsKICAgICAgdFsiXHVGRUNDIl0gPSAiXHUwNjM5IjsKICAgICAgdFsiXHVGRUNEIl0gPSAiXHUwNjNBIjsKICAgICAgdFsiXHVGRUNFIl0gPSAiXHUwNjNBIjsKICAgICAgdFsiXHVGRUNGIl0gPSAiXHUwNjNBIjsKICAgICAgdFsiXHVGRUQwIl0gPSAiXHUwNjNBIjsKICAgICAgdFsiXHVGRUQxIl0gPSAiXHUwNjQxIjsKICAgICAgdFsiXHVGRUQyIl0gPSAiXHUwNjQxIjsKICAgICAgdFsiXHVGRUQzIl0gPSAiXHUwNjQxIjsKICAgICAgdFsiXHVGRUQ0Il0gPSAiXHUwNjQxIjsKICAgICAgdFsiXHVGRUQ1Il0gPSAiXHUwNjQyIjsKICAgICAgdFsiXHVGRUQ2Il0gPSAiXHUwNjQyIjsKICAgICAgdFsiXHVGRUQ3Il0gPSAiXHUwNjQyIjsKICAgICAgdFsiXHVGRUQ4Il0gPSAiXHUwNjQyIjsKICAgICAgdFsiXHVGRUQ5Il0gPSAiXHUwNjQzIjsKICAgICAgdFsiXHVGRURBIl0gPSAiXHUwNjQzIjsKICAgICAgdFsiXHVGRURCIl0gPSAiXHUwNjQzIjsKICAgICAgdFsiXHVGRURDIl0gPSAiXHUwNjQzIjsKICAgICAgdFsiXHVGRUREIl0gPSAiXHUwNjQ0IjsKICAgICAgdFsiXHVGRURFIl0gPSAiXHUwNjQ0IjsKICAgICAgdFsiXHVGRURGIl0gPSAiXHUwNjQ0IjsKICAgICAgdFsiXHVGRUUwIl0gPSAiXHUwNjQ0IjsKICAgICAgdFsiXHVGRUUxIl0gPSAiXHUwNjQ1IjsKICAgICAgdFsiXHVGRUUyIl0gPSAiXHUwNjQ1IjsKICAgICAgdFsiXHVGRUUzIl0gPSAiXHUwNjQ1IjsKICAgICAgdFsiXHVGRUU0Il0gPSAiXHUwNjQ1IjsKICAgICAgdFsiXHVGRUU1Il0gPSAiXHUwNjQ2IjsKICAgICAgdFsiXHVGRUU2Il0gPSAiXHUwNjQ2IjsKICAgICAgdFsiXHVGRUU3Il0gPSAiXHUwNjQ2IjsKICAgICAgdFsiXHVGRUU4Il0gPSAiXHUwNjQ2IjsKICAgICAgdFsiXHVGRUU5Il0gPSAiXHUwNjQ3IjsKICAgICAgdFsiXHVGRUVBIl0gPSAiXHUwNjQ3IjsKICAgICAgdFsiXHVGRUVCIl0gPSAiXHUwNjQ3IjsKICAgICAgdFsiXHVGRUVDIl0gPSAiXHUwNjQ3IjsKICAgICAgdFsiXHVGRUVEIl0gPSAiXHUwNjQ4IjsKICAgICAgdFsiXHVGRUVFIl0gPSAiXHUwNjQ4IjsKICAgICAgdFsiXHVGRUVGIl0gPSAiXHUwNjQ5IjsKICAgICAgdFsiXHVGRUYwIl0gPSAiXHUwNjQ5IjsKICAgICAgdFsiXHVGRUYxIl0gPSAiXHUwNjRBIjsKICAgICAgdFsiXHVGRUYyIl0gPSAiXHUwNjRBIjsKICAgICAgdFsiXHVGRUYzIl0gPSAiXHUwNjRBIjsKICAgICAgdFsiXHVGRUY0Il0gPSAiXHUwNjRBIjsKICAgICAgdFsiXHVGRUY1Il0gPSAiXHUwNjQ0XHUwNjIyIjsKICAgICAgdFsiXHVGRUY2Il0gPSAiXHUwNjQ0XHUwNjIyIjsKICAgICAgdFsiXHVGRUY3Il0gPSAiXHUwNjQ0XHUwNjIzIjsKICAgICAgdFsiXHVGRUY4Il0gPSAiXHUwNjQ0XHUwNjIzIjsKICAgICAgdFsiXHVGRUY5Il0gPSAiXHUwNjQ0XHUwNjI1IjsKICAgICAgdFsiXHVGRUZBIl0gPSAiXHUwNjQ0XHUwNjI1IjsKICAgICAgdFsiXHVGRUZCIl0gPSAiXHUwNjQ0XHUwNjI3IjsKICAgICAgdFsiXHVGRUZDIl0gPSAiXHUwNjQ0XHUwNjI3IjsKICAgIH0pOwogICAgZnVuY3Rpb24gcmV2ZXJzZUlmUnRsKGNoYXJzKSB7CiAgICAgIHZhciBjaGFyc0xlbmd0aCA9IGNoYXJzLmxlbmd0aDsKICAgICAgaWYgKGNoYXJzTGVuZ3RoIDw9IDEgfHwgIWlzUlRMUmFuZ2VGb3IoY2hhcnMuY2hhckNvZGVBdCgwKSkpIHsKICAgICAgICByZXR1cm4gY2hhcnM7CiAgICAgIH0KICAgICAgdmFyIHMgPSAiIjsKICAgICAgZm9yICh2YXIgaWkgPSBjaGFyc0xlbmd0aCAtIDE7IGlpID49IDA7IGlpLS0pIHsKICAgICAgICBzICs9IGNoYXJzW2lpXTsKICAgICAgfQogICAgICByZXR1cm4gczsKICAgIH0KICAgIGV4cG9ydHMubWFwU3BlY2lhbFVuaWNvZGVWYWx1ZXMgPSBtYXBTcGVjaWFsVW5pY29kZVZhbHVlczsKICAgIGV4cG9ydHMucmV2ZXJzZUlmUnRsID0gcmV2ZXJzZUlmUnRsOwogICAgZXhwb3J0cy5nZXRVbmljb2RlUmFuZ2VGb3IgPSBnZXRVbmljb2RlUmFuZ2VGb3I7CiAgICBleHBvcnRzLmdldE5vcm1hbGl6ZWRVbmljb2RlcyA9IGdldE5vcm1hbGl6ZWRVbmljb2RlczsKICAgIGV4cG9ydHMuZ2V0VW5pY29kZUZvckdseXBoID0gZ2V0VW5pY29kZUZvckdseXBoOwoKICAgIC8qKiovfSksICgKICAvKiAyMjQgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgoKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgICAgdmFsdWU6IHRydWUKICAgIH0pOwogICAgZXhwb3J0cy5Gb250UmVuZGVyZXJGYWN0b3J5ID0gdm9pZCAwOwoKICAgIHZhciBfdXRpbCA9IF9fd19wZGZqc19yZXF1aXJlX18oNSk7CgogICAgdmFyIF9jZmZfcGFyc2VyID0gX193X3BkZmpzX3JlcXVpcmVfXygyMTgpOwoKICAgIHZhciBfZ2x5cGhsaXN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygyMjEpOwoKICAgIHZhciBfZW5jb2RpbmdzID0gX193X3BkZmpzX3JlcXVpcmVfXygyMjApOwoKICAgIHZhciBfc3RyZWFtID0gX193X3BkZmpzX3JlcXVpcmVfXygyMDEpOwoKICAgIGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mIjtpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAic3ltYm9sIikge190eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikge3JldHVybiB0eXBlb2Ygb2JqO307fSBlbHNlIHtfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHtyZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqO307fXJldHVybiBfdHlwZW9mKG9iaik7fQoKICAgIGZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHtpZiAoY2FsbCAmJiAoX3R5cGVvZihjYWxsKSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7cmV0dXJuIGNhbGw7fXJldHVybiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpO30KCiAgICBmdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHtpZiAoc2VsZiA9PT0gdm9pZCAwKSB7dGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTt9cmV0dXJuIHNlbGY7fQoKICAgIGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7X2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHtyZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pO307cmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTt9CgogICAgZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7aWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpO31zdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7aWYgKHN1cGVyQ2xhc3MpIF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7fQoKICAgIGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7X3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7by5fX3Byb3RvX18gPSBwO3JldHVybiBvO307cmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTt9CgogICAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3Rvcikge2lmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7fX0KCiAgICBmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7Zm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykge3ZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07ZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlO2Rlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTtpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTtPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7fX0KCiAgICBmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7aWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7aWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpO3JldHVybiBDb25zdHJ1Y3Rvcjt9CgogICAgdmFyIEZvbnRSZW5kZXJlckZhY3RvcnkgPSBmdW5jdGlvbiBGb250UmVuZGVyZXJGYWN0b3J5Q2xvc3VyZSgpIHsKICAgICAgZnVuY3Rpb24gZ2V0TG9uZyhkYXRhLCBvZmZzZXQpIHsKICAgICAgICByZXR1cm4gZGF0YVtvZmZzZXRdIDw8IDI0IHwgZGF0YVtvZmZzZXQgKyAxXSA8PCAxNiB8IGRhdGFbb2Zmc2V0ICsgMl0gPDwgOCB8IGRhdGFbb2Zmc2V0ICsgM107CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGdldFVzaG9ydChkYXRhLCBvZmZzZXQpIHsKICAgICAgICByZXR1cm4gZGF0YVtvZmZzZXRdIDw8IDggfCBkYXRhW29mZnNldCArIDFdOwogICAgICB9CgogICAgICBmdW5jdGlvbiBnZXRTdWJyb3V0aW5lQmlhcyhzdWJycykgewogICAgICAgIHZhciBudW1TdWJycyA9IHN1YnJzLmxlbmd0aDsKICAgICAgICB2YXIgYmlhcyA9IDMyNzY4OwoKICAgICAgICBpZiAobnVtU3VicnMgPCAxMjQwKSB7CiAgICAgICAgICBiaWFzID0gMTA3OwogICAgICAgIH0gZWxzZSBpZiAobnVtU3VicnMgPCAzMzkwMCkgewogICAgICAgICAgYmlhcyA9IDExMzE7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYmlhczsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gcGFyc2VDbWFwKGRhdGEsIHN0YXJ0LCBlbmQpIHsKICAgICAgICB2YXIgb2Zmc2V0ID0gZ2V0VXNob3J0KGRhdGEsIHN0YXJ0ICsgMikgPT09IDEgPyBnZXRMb25nKGRhdGEsIHN0YXJ0ICsgOCkgOiBnZXRMb25nKGRhdGEsIHN0YXJ0ICsgMTYpOwogICAgICAgIHZhciBmb3JtYXQgPSBnZXRVc2hvcnQoZGF0YSwgc3RhcnQgKyBvZmZzZXQpOwogICAgICAgIHZhciByYW5nZXMsIHAsIGk7CgogICAgICAgIGlmIChmb3JtYXQgPT09IDQpIHsKICAgICAgICAgIGdldFVzaG9ydChkYXRhLCBzdGFydCArIG9mZnNldCArIDIpOwogICAgICAgICAgdmFyIHNlZ0NvdW50ID0gZ2V0VXNob3J0KGRhdGEsIHN0YXJ0ICsgb2Zmc2V0ICsgNikgPj4gMTsKICAgICAgICAgIHAgPSBzdGFydCArIG9mZnNldCArIDE0OwogICAgICAgICAgcmFuZ2VzID0gW107CgogICAgICAgICAgZm9yIChpID0gMDsgaSA8IHNlZ0NvdW50OyBpKyssIHAgKz0gMikgewogICAgICAgICAgICByYW5nZXNbaV0gPSB7CiAgICAgICAgICAgICAgZW5kOiBnZXRVc2hvcnQoZGF0YSwgcCkKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KCiAgICAgICAgICBwICs9IDI7CgogICAgICAgICAgZm9yIChpID0gMDsgaSA8IHNlZ0NvdW50OyBpKyssIHAgKz0gMikgewogICAgICAgICAgICByYW5nZXNbaV0uc3RhcnQgPSBnZXRVc2hvcnQoZGF0YSwgcCk7CiAgICAgICAgICB9CgogICAgICAgICAgZm9yIChpID0gMDsgaSA8IHNlZ0NvdW50OyBpKyssIHAgKz0gMikgewogICAgICAgICAgICByYW5nZXNbaV0uaWREZWx0YSA9IGdldFVzaG9ydChkYXRhLCBwKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgc2VnQ291bnQ7IGkrKywgcCArPSAyKSB7CiAgICAgICAgICAgIHZhciBpZE9mZnNldCA9IGdldFVzaG9ydChkYXRhLCBwKTsKCiAgICAgICAgICAgIGlmIChpZE9mZnNldCA9PT0gMCkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICByYW5nZXNbaV0uaWRzID0gW107CgogICAgICAgICAgICBmb3IgKHZhciBqID0gMCwgamogPSByYW5nZXNbaV0uZW5kIC0gcmFuZ2VzW2ldLnN0YXJ0ICsgMTsgaiA8IGpqOyBqKyspIHsKICAgICAgICAgICAgICByYW5nZXNbaV0uaWRzW2pdID0gZ2V0VXNob3J0KGRhdGEsIHAgKyBpZE9mZnNldCk7CiAgICAgICAgICAgICAgaWRPZmZzZXQgKz0gMjsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiByYW5nZXM7CiAgICAgICAgfSBlbHNlIGlmIChmb3JtYXQgPT09IDEyKSB7CiAgICAgICAgICBnZXRMb25nKGRhdGEsIHN0YXJ0ICsgb2Zmc2V0ICsgNCk7CiAgICAgICAgICB2YXIgZ3JvdXBzID0gZ2V0TG9uZyhkYXRhLCBzdGFydCArIG9mZnNldCArIDEyKTsKICAgICAgICAgIHAgPSBzdGFydCArIG9mZnNldCArIDE2OwogICAgICAgICAgcmFuZ2VzID0gW107CgogICAgICAgICAgZm9yIChpID0gMDsgaSA8IGdyb3VwczsgaSsrKSB7CiAgICAgICAgICAgIHJhbmdlcy5wdXNoKHsKICAgICAgICAgICAgICBzdGFydDogZ2V0TG9uZyhkYXRhLCBwKSwKICAgICAgICAgICAgICBlbmQ6IGdldExvbmcoZGF0YSwgcCArIDQpLAogICAgICAgICAgICAgIGlkRGVsdGE6IGdldExvbmcoZGF0YSwgcCArIDgpIC0gZ2V0TG9uZyhkYXRhLCBwKQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcCArPSAxMjsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gcmFuZ2VzOwogICAgICAgIH0KCiAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJ1bnN1cHBvcnRlZCBjbWFwOiAiLmNvbmNhdChmb3JtYXQpKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gcGFyc2VDZmYoZGF0YSwgc3RhcnQsIGVuZCwgc2VhY0FuYWx5c2lzRW5hYmxlZCkgewogICAgICAgIHZhciBwcm9wZXJ0aWVzID0ge307CiAgICAgICAgdmFyIHBhcnNlciA9IG5ldyBfY2ZmX3BhcnNlci5DRkZQYXJzZXIobmV3IF9zdHJlYW0uU3RyZWFtKGRhdGEsIHN0YXJ0LCBlbmQgLSBzdGFydCksIHByb3BlcnRpZXMsIHNlYWNBbmFseXNpc0VuYWJsZWQpOwogICAgICAgIHZhciBjZmYgPSBwYXJzZXIucGFyc2UoKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgZ2x5cGhzOiBjZmYuY2hhclN0cmluZ3Mub2JqZWN0cywKICAgICAgICAgIHN1YnJzOiBjZmYudG9wRGljdC5wcml2YXRlRGljdCAmJiBjZmYudG9wRGljdC5wcml2YXRlRGljdC5zdWJyc0luZGV4ICYmIGNmZi50b3BEaWN0LnByaXZhdGVEaWN0LnN1YnJzSW5kZXgub2JqZWN0cywKICAgICAgICAgIGdzdWJyczogY2ZmLmdsb2JhbFN1YnJJbmRleCAmJiBjZmYuZ2xvYmFsU3VickluZGV4Lm9iamVjdHMsCiAgICAgICAgICBpc0NGRkNJREZvbnQ6IGNmZi5pc0NJREZvbnQsCiAgICAgICAgICBmZFNlbGVjdDogY2ZmLmZkU2VsZWN0LAogICAgICAgICAgZmRBcnJheTogY2ZmLmZkQXJyYXkKICAgICAgICB9OwogICAgICB9CgogICAgICBmdW5jdGlvbiBwYXJzZUdseWZUYWJsZShnbHlmLCBsb2NhLCBpc0dseXBoTG9jYXRpb25zTG9uZykgewogICAgICAgIHZhciBpdGVtU2l6ZSwgaXRlbURlY29kZTsKCiAgICAgICAgaWYgKGlzR2x5cGhMb2NhdGlvbnNMb25nKSB7CiAgICAgICAgICBpdGVtU2l6ZSA9IDQ7CgogICAgICAgICAgaXRlbURlY29kZSA9IGZ1bmN0aW9uIGZvbnRJdGVtRGVjb2RlTG9uZyhkYXRhLCBvZmZzZXQpIHsKICAgICAgICAgICAgcmV0dXJuIGRhdGFbb2Zmc2V0XSA8PCAyNCB8IGRhdGFbb2Zmc2V0ICsgMV0gPDwgMTYgfCBkYXRhW29mZnNldCArIDJdIDw8IDggfCBkYXRhW29mZnNldCArIDNdOwogICAgICAgICAgfTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaXRlbVNpemUgPSAyOwoKICAgICAgICAgIGl0ZW1EZWNvZGUgPSBmdW5jdGlvbiBmb250SXRlbURlY29kZShkYXRhLCBvZmZzZXQpIHsKICAgICAgICAgICAgcmV0dXJuIGRhdGFbb2Zmc2V0XSA8PCA5IHwgZGF0YVtvZmZzZXQgKyAxXSA8PCAxOwogICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIHZhciBnbHlwaHMgPSBbXTsKICAgICAgICB2YXIgc3RhcnRPZmZzZXQgPSBpdGVtRGVjb2RlKGxvY2EsIDApOwoKICAgICAgICBmb3IgKHZhciBqID0gaXRlbVNpemU7IGogPCBsb2NhLmxlbmd0aDsgaiArPSBpdGVtU2l6ZSkgewogICAgICAgICAgdmFyIGVuZE9mZnNldCA9IGl0ZW1EZWNvZGUobG9jYSwgaik7CiAgICAgICAgICBnbHlwaHMucHVzaChnbHlmLnN1YmFycmF5KHN0YXJ0T2Zmc2V0LCBlbmRPZmZzZXQpKTsKICAgICAgICAgIHN0YXJ0T2Zmc2V0ID0gZW5kT2Zmc2V0OwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGdseXBoczsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gbG9va3VwQ21hcChyYW5nZXMsIHVuaWNvZGUpIHsKICAgICAgICB2YXIgY29kZSA9IHVuaWNvZGUuY29kZVBvaW50QXQoMCksCiAgICAgICAgICBnaWQgPSAwOwogICAgICAgIHZhciBsID0gMCwKICAgICAgICAgIHIgPSByYW5nZXMubGVuZ3RoIC0gMTsKCiAgICAgICAgd2hpbGUgKGwgPCByKSB7CiAgICAgICAgICB2YXIgYyA9IGwgKyByICsgMSA+PiAxOwoKICAgICAgICAgIGlmIChjb2RlIDwgcmFuZ2VzW2NdLnN0YXJ0KSB7CiAgICAgICAgICAgIHIgPSBjIC0gMTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGwgPSBjOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHJhbmdlc1tsXS5zdGFydCA8PSBjb2RlICYmIGNvZGUgPD0gcmFuZ2VzW2xdLmVuZCkgewogICAgICAgICAgZ2lkID0gcmFuZ2VzW2xdLmlkRGVsdGEgKyAocmFuZ2VzW2xdLmlkcyA/IHJhbmdlc1tsXS5pZHNbY29kZSAtIHJhbmdlc1tsXS5zdGFydF0gOiBjb2RlKSAmIDB4ZmZmZjsKICAgICAgICB9CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICBjaGFyQ29kZTogY29kZSwKICAgICAgICAgIGdseXBoSWQ6IGdpZAogICAgICAgIH07CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGNvbXBpbGVHbHlmKGNvZGUsIGNtZHMsIGZvbnQpIHsKICAgICAgICBmdW5jdGlvbiBtb3ZlVG8oeCwgeSkgewogICAgICAgICAgY21kcy5wdXNoKHsKICAgICAgICAgICAgY21kOiAibW92ZVRvIiwKICAgICAgICAgICAgYXJnczogW3gsIHldCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGxpbmVUbyh4LCB5KSB7CiAgICAgICAgICBjbWRzLnB1c2goewogICAgICAgICAgICBjbWQ6ICJsaW5lVG8iLAogICAgICAgICAgICBhcmdzOiBbeCwgeV0KICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gcXVhZHJhdGljQ3VydmVUbyh4YSwgeWEsIHgsIHkpIHsKICAgICAgICAgIGNtZHMucHVzaCh7CiAgICAgICAgICAgIGNtZDogInF1YWRyYXRpY0N1cnZlVG8iLAogICAgICAgICAgICBhcmdzOiBbeGEsIHlhLCB4LCB5XQogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgaSA9IDA7CiAgICAgICAgdmFyIG51bWJlck9mQ29udG91cnMgPSAoY29kZVtpXSA8PCAyNCB8IGNvZGVbaSArIDFdIDw8IDE2KSA+PiAxNjsKICAgICAgICB2YXIgZmxhZ3M7CiAgICAgICAgdmFyIHggPSAwLAogICAgICAgICAgeSA9IDA7CiAgICAgICAgaSArPSAxMDsKCiAgICAgICAgaWYgKG51bWJlck9mQ29udG91cnMgPCAwKSB7CiAgICAgICAgICBkbyB7CiAgICAgICAgICAgIGZsYWdzID0gY29kZVtpXSA8PCA4IHwgY29kZVtpICsgMV07CiAgICAgICAgICAgIHZhciBnbHlwaEluZGV4ID0gY29kZVtpICsgMl0gPDwgOCB8IGNvZGVbaSArIDNdOwogICAgICAgICAgICBpICs9IDQ7CiAgICAgICAgICAgIHZhciBhcmcxLCBhcmcyOwoKICAgICAgICAgICAgaWYgKGZsYWdzICYgMHgwMSkgewogICAgICAgICAgICAgIGFyZzEgPSAoY29kZVtpXSA8PCAyNCB8IGNvZGVbaSArIDFdIDw8IDE2KSA+PiAxNjsKICAgICAgICAgICAgICBhcmcyID0gKGNvZGVbaSArIDJdIDw8IDI0IHwgY29kZVtpICsgM10gPDwgMTYpID4+IDE2OwogICAgICAgICAgICAgIGkgKz0gNDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBhcmcxID0gY29kZVtpKytdOwogICAgICAgICAgICAgIGFyZzIgPSBjb2RlW2krK107CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmbGFncyAmIDB4MDIpIHsKICAgICAgICAgICAgICB4ID0gYXJnMTsKICAgICAgICAgICAgICB5ID0gYXJnMjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB4ID0gMDsKICAgICAgICAgICAgICB5ID0gMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHNjYWxlWCA9IDEsCiAgICAgICAgICAgICAgc2NhbGVZID0gMSwKICAgICAgICAgICAgICBzY2FsZTAxID0gMCwKICAgICAgICAgICAgICBzY2FsZTEwID0gMDsKCiAgICAgICAgICAgIGlmIChmbGFncyAmIDB4MDgpIHsKICAgICAgICAgICAgICBzY2FsZVggPSBzY2FsZVkgPSAoY29kZVtpXSA8PCAyNCB8IGNvZGVbaSArIDFdIDw8IDE2KSAvIDEwNzM3NDE4MjQ7CiAgICAgICAgICAgICAgaSArPSAyOwogICAgICAgICAgICB9IGVsc2UgaWYgKGZsYWdzICYgMHg0MCkgewogICAgICAgICAgICAgIHNjYWxlWCA9IChjb2RlW2ldIDw8IDI0IHwgY29kZVtpICsgMV0gPDwgMTYpIC8gMTA3Mzc0MTgyNDsKICAgICAgICAgICAgICBzY2FsZVkgPSAoY29kZVtpICsgMl0gPDwgMjQgfCBjb2RlW2kgKyAzXSA8PCAxNikgLyAxMDczNzQxODI0OwogICAgICAgICAgICAgIGkgKz0gNDsKICAgICAgICAgICAgfSBlbHNlIGlmIChmbGFncyAmIDB4ODApIHsKICAgICAgICAgICAgICBzY2FsZVggPSAoY29kZVtpXSA8PCAyNCB8IGNvZGVbaSArIDFdIDw8IDE2KSAvIDEwNzM3NDE4MjQ7CiAgICAgICAgICAgICAgc2NhbGUwMSA9IChjb2RlW2kgKyAyXSA8PCAyNCB8IGNvZGVbaSArIDNdIDw8IDE2KSAvIDEwNzM3NDE4MjQ7CiAgICAgICAgICAgICAgc2NhbGUxMCA9IChjb2RlW2kgKyA0XSA8PCAyNCB8IGNvZGVbaSArIDVdIDw8IDE2KSAvIDEwNzM3NDE4MjQ7CiAgICAgICAgICAgICAgc2NhbGVZID0gKGNvZGVbaSArIDZdIDw8IDI0IHwgY29kZVtpICsgN10gPDwgMTYpIC8gMTA3Mzc0MTgyNDsKICAgICAgICAgICAgICBpICs9IDg7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBzdWJnbHlwaCA9IGZvbnQuZ2x5cGhzW2dseXBoSW5kZXhdOwoKICAgICAgICAgICAgaWYgKHN1YmdseXBoKSB7CiAgICAgICAgICAgICAgY21kcy5wdXNoKHsKICAgICAgICAgICAgICAgIGNtZDogInNhdmUiCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgY21kcy5wdXNoKHsKICAgICAgICAgICAgICAgIGNtZDogInRyYW5zZm9ybSIsCiAgICAgICAgICAgICAgICBhcmdzOiBbc2NhbGVYLCBzY2FsZTAxLCBzY2FsZTEwLCBzY2FsZVksIHgsIHldCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgY29tcGlsZUdseWYoc3ViZ2x5cGgsIGNtZHMsIGZvbnQpOwogICAgICAgICAgICAgIGNtZHMucHVzaCh7CiAgICAgICAgICAgICAgICBjbWQ6ICJyZXN0b3JlIgogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9IHdoaWxlIChmbGFncyAmIDB4MjApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgZW5kUHRzT2ZDb250b3VycyA9IFtdOwogICAgICAgICAgdmFyIGosIGpqOwoKICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBudW1iZXJPZkNvbnRvdXJzOyBqKyspIHsKICAgICAgICAgICAgZW5kUHRzT2ZDb250b3Vycy5wdXNoKGNvZGVbaV0gPDwgOCB8IGNvZGVbaSArIDFdKTsKICAgICAgICAgICAgaSArPSAyOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBpbnN0cnVjdGlvbkxlbmd0aCA9IGNvZGVbaV0gPDwgOCB8IGNvZGVbaSArIDFdOwogICAgICAgICAgaSArPSAyICsgaW5zdHJ1Y3Rpb25MZW5ndGg7CiAgICAgICAgICB2YXIgbnVtYmVyT2ZQb2ludHMgPSBlbmRQdHNPZkNvbnRvdXJzW2VuZFB0c09mQ29udG91cnMubGVuZ3RoIC0gMV0gKyAxOwogICAgICAgICAgdmFyIHBvaW50cyA9IFtdOwoKICAgICAgICAgIHdoaWxlIChwb2ludHMubGVuZ3RoIDwgbnVtYmVyT2ZQb2ludHMpIHsKICAgICAgICAgICAgZmxhZ3MgPSBjb2RlW2krK107CiAgICAgICAgICAgIHZhciByZXBlYXQgPSAxOwoKICAgICAgICAgICAgaWYgKGZsYWdzICYgMHgwOCkgewogICAgICAgICAgICAgIHJlcGVhdCArPSBjb2RlW2krK107CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdoaWxlIChyZXBlYXQtLSA+IDApIHsKICAgICAgICAgICAgICBwb2ludHMucHVzaCh7CiAgICAgICAgICAgICAgICBmbGFnczogZmxhZ3MKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBudW1iZXJPZlBvaW50czsgaisrKSB7CiAgICAgICAgICAgIHN3aXRjaCAocG9pbnRzW2pdLmZsYWdzICYgMHgxMikgewogICAgICAgICAgICAgIGNhc2UgMHgwMDoKICAgICAgICAgICAgICAgIHggKz0gKGNvZGVbaV0gPDwgMjQgfCBjb2RlW2kgKyAxXSA8PCAxNikgPj4gMTY7CiAgICAgICAgICAgICAgICBpICs9IDI7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAweDAyOgogICAgICAgICAgICAgICAgeCAtPSBjb2RlW2krK107CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAweDEyOgogICAgICAgICAgICAgICAgeCArPSBjb2RlW2krK107CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcG9pbnRzW2pdLnggPSB4OwogICAgICAgICAgfQoKICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBudW1iZXJPZlBvaW50czsgaisrKSB7CiAgICAgICAgICAgIHN3aXRjaCAocG9pbnRzW2pdLmZsYWdzICYgMHgyNCkgewogICAgICAgICAgICAgIGNhc2UgMHgwMDoKICAgICAgICAgICAgICAgIHkgKz0gKGNvZGVbaV0gPDwgMjQgfCBjb2RlW2kgKyAxXSA8PCAxNikgPj4gMTY7CiAgICAgICAgICAgICAgICBpICs9IDI7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAweDA0OgogICAgICAgICAgICAgICAgeSAtPSBjb2RlW2krK107CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAweDI0OgogICAgICAgICAgICAgICAgeSArPSBjb2RlW2krK107CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcG9pbnRzW2pdLnkgPSB5OwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBzdGFydFBvaW50ID0gMDsKCiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbnVtYmVyT2ZDb250b3VyczsgaSsrKSB7CiAgICAgICAgICAgIHZhciBlbmRQb2ludCA9IGVuZFB0c09mQ29udG91cnNbaV07CiAgICAgICAgICAgIHZhciBjb250b3VyID0gcG9pbnRzLnNsaWNlKHN0YXJ0UG9pbnQsIGVuZFBvaW50ICsgMSk7CgogICAgICAgICAgICBpZiAoY29udG91clswXS5mbGFncyAmIDEpIHsKICAgICAgICAgICAgICBjb250b3VyLnB1c2goY29udG91clswXSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoY29udG91cltjb250b3VyLmxlbmd0aCAtIDFdLmZsYWdzICYgMSkgewogICAgICAgICAgICAgIGNvbnRvdXIudW5zaGlmdChjb250b3VyW2NvbnRvdXIubGVuZ3RoIC0gMV0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHZhciBwID0gewogICAgICAgICAgICAgICAgZmxhZ3M6IDEsCiAgICAgICAgICAgICAgICB4OiAoY29udG91clswXS54ICsgY29udG91cltjb250b3VyLmxlbmd0aCAtIDFdLngpIC8gMiwKICAgICAgICAgICAgICAgIHk6IChjb250b3VyWzBdLnkgKyBjb250b3VyW2NvbnRvdXIubGVuZ3RoIC0gMV0ueSkgLyAyCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBjb250b3VyLnVuc2hpZnQocCk7CiAgICAgICAgICAgICAgY29udG91ci5wdXNoKHApOwogICAgICAgICAgICB9CgogICAgICAgICAgICBtb3ZlVG8oY29udG91clswXS54LCBjb250b3VyWzBdLnkpOwoKICAgICAgICAgICAgZm9yIChqID0gMSwgamogPSBjb250b3VyLmxlbmd0aDsgaiA8IGpqOyBqKyspIHsKICAgICAgICAgICAgICBpZiAoY29udG91cltqXS5mbGFncyAmIDEpIHsKICAgICAgICAgICAgICAgIGxpbmVUbyhjb250b3VyW2pdLngsIGNvbnRvdXJbal0ueSk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChjb250b3VyW2ogKyAxXS5mbGFncyAmIDEpIHsKICAgICAgICAgICAgICAgIHF1YWRyYXRpY0N1cnZlVG8oY29udG91cltqXS54LCBjb250b3VyW2pdLnksIGNvbnRvdXJbaiArIDFdLngsIGNvbnRvdXJbaiArIDFdLnkpOwogICAgICAgICAgICAgICAgaisrOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBxdWFkcmF0aWNDdXJ2ZVRvKGNvbnRvdXJbal0ueCwgY29udG91cltqXS55LCAoY29udG91cltqXS54ICsgY29udG91cltqICsgMV0ueCkgLyAyLCAoY29udG91cltqXS55ICsgY29udG91cltqICsgMV0ueSkgLyAyKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHN0YXJ0UG9pbnQgPSBlbmRQb2ludCArIDE7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBjb21waWxlQ2hhclN0cmluZyhjb2RlLCBjbWRzLCBmb250LCBnbHlwaElkKSB7CiAgICAgICAgdmFyIHN0YWNrID0gW107CiAgICAgICAgdmFyIHggPSAwLAogICAgICAgICAgeSA9IDA7CiAgICAgICAgdmFyIHN0ZW1zID0gMDsKCiAgICAgICAgZnVuY3Rpb24gbW92ZVRvKHgsIHkpIHsKICAgICAgICAgIGNtZHMucHVzaCh7CiAgICAgICAgICAgIGNtZDogIm1vdmVUbyIsCiAgICAgICAgICAgIGFyZ3M6IFt4LCB5XQogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBsaW5lVG8oeCwgeSkgewogICAgICAgICAgY21kcy5wdXNoKHsKICAgICAgICAgICAgY21kOiAibGluZVRvIiwKICAgICAgICAgICAgYXJnczogW3gsIHldCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGJlemllckN1cnZlVG8oeDEsIHkxLCB4MiwgeTIsIHgsIHkpIHsKICAgICAgICAgIGNtZHMucHVzaCh7CiAgICAgICAgICAgIGNtZDogImJlemllckN1cnZlVG8iLAogICAgICAgICAgICBhcmdzOiBbeDEsIHkxLCB4MiwgeTIsIHgsIHldCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHBhcnNlKGNvZGUpIHsKICAgICAgICAgIHZhciBpID0gMDsKCiAgICAgICAgICB3aGlsZSAoaSA8IGNvZGUubGVuZ3RoKSB7CiAgICAgICAgICAgIHZhciBzdGFja0NsZWFuID0gZmFsc2U7CiAgICAgICAgICAgIHZhciB2ID0gY29kZVtpKytdOwogICAgICAgICAgICB2YXIgeGEsIHhiLCB5YSwgeWIsIHkxLCB5MiwgeTMsIG4sIHN1YnJDb2RlOwoKICAgICAgICAgICAgc3dpdGNoICh2KSB7CiAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgc3RlbXMgKz0gc3RhY2subGVuZ3RoID4+IDE7CiAgICAgICAgICAgICAgICBzdGFja0NsZWFuID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBzdGVtcyArPSBzdGFjay5sZW5ndGggPj4gMTsKICAgICAgICAgICAgICAgIHN0YWNrQ2xlYW4gPSB0cnVlOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgIHkgKz0gc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICBtb3ZlVG8oeCwgeSk7CiAgICAgICAgICAgICAgICBzdGFja0NsZWFuID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICB3aGlsZSAoc3RhY2subGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICB4ICs9IHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgIHkgKz0gc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICAgICAgbGluZVRvKHgsIHkpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICB3aGlsZSAoc3RhY2subGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICB4ICs9IHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgIGxpbmVUbyh4LCB5KTsKCiAgICAgICAgICAgICAgICAgIGlmIChzdGFjay5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgeSArPSBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgICAgICBsaW5lVG8oeCwgeSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgIHdoaWxlIChzdGFjay5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgIHkgKz0gc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICAgICAgbGluZVRvKHgsIHkpOwoKICAgICAgICAgICAgICAgICAgaWYgKHN0YWNrLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB4ICs9IHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgIGxpbmVUbyh4LCB5KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgd2hpbGUgKHN0YWNrLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgeGEgPSB4ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICAgICAgeWEgPSB5ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICAgICAgeGIgPSB4YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgIHliID0geWEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgICAgICB4ID0geGIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgICAgICB5ID0geWIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgICAgICBiZXppZXJDdXJ2ZVRvKHhhLCB5YSwgeGIsIHliLCB4LCB5KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgIG4gPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgIHN1YnJDb2RlID0gbnVsbDsKCiAgICAgICAgICAgICAgICBpZiAoZm9udC5pc0NGRkNJREZvbnQpIHsKICAgICAgICAgICAgICAgICAgdmFyIGZkSW5kZXggPSBmb250LmZkU2VsZWN0LmdldEZESW5kZXgoZ2x5cGhJZCk7CgogICAgICAgICAgICAgICAgICBpZiAoZmRJbmRleCA+PSAwICYmIGZkSW5kZXggPCBmb250LmZkQXJyYXkubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGZvbnREaWN0ID0gZm9udC5mZEFycmF5W2ZkSW5kZXhdOwogICAgICAgICAgICAgICAgICAgIHZhciBzdWJycyA9IHZvaWQgMDsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGZvbnREaWN0LnByaXZhdGVEaWN0ICYmIGZvbnREaWN0LnByaXZhdGVEaWN0LnN1YnJzSW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICAgIHN1YnJzID0gZm9udERpY3QucHJpdmF0ZURpY3Quc3VicnNJbmRleC5vYmplY3RzOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKHN1YnJzKSB7CiAgICAgICAgICAgICAgICAgICAgICBuICs9IGdldFN1YnJvdXRpbmVCaWFzKHN1YnJzKTsKICAgICAgICAgICAgICAgICAgICAgIHN1YnJDb2RlID0gc3VicnNbbl07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiSW52YWxpZCBmZCBpbmRleCBmb3IgZ2x5cGggaW5kZXguIik7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHN1YnJDb2RlID0gZm9udC5zdWJyc1tuICsgZm9udC5zdWJyc0JpYXNdOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChzdWJyQ29kZSkgewogICAgICAgICAgICAgICAgICBwYXJzZShzdWJyQ29kZSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICB2ID0gY29kZVtpKytdOwoKICAgICAgICAgICAgICAgIHN3aXRjaCAodikgewogICAgICAgICAgICAgICAgICBjYXNlIDM0OgogICAgICAgICAgICAgICAgICAgIHhhID0geCArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgICAgeGIgPSB4YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgICAgeTEgPSB5ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICAgICAgICB4ID0geGIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgICAgICAgIGJlemllckN1cnZlVG8oeGEsIHksIHhiLCB5MSwgeCwgeTEpOwogICAgICAgICAgICAgICAgICAgIHhhID0geCArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgICAgeGIgPSB4YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgICAgeCA9IHhiICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICAgICAgICBiZXppZXJDdXJ2ZVRvKHhhLCB5MSwgeGIsIHksIHgsIHkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgY2FzZSAzNToKICAgICAgICAgICAgICAgICAgICB4YSA9IHggKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgICAgICAgIHlhID0geSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgICAgeGIgPSB4YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgICAgeWIgPSB5YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgICAgeCA9IHhiICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICAgICAgICB5ID0geWIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgICAgICAgIGJlemllckN1cnZlVG8oeGEsIHlhLCB4YiwgeWIsIHgsIHkpOwogICAgICAgICAgICAgICAgICAgIHhhID0geCArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgICAgeWEgPSB5ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICAgICAgICB4YiA9IHhhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICAgICAgICB5YiA9IHlhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICAgICAgICB4ID0geGIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgICAgICAgIHkgPSB5YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeWEsIHhiLCB5YiwgeCwgeSk7CiAgICAgICAgICAgICAgICAgICAgc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlIDM2OgogICAgICAgICAgICAgICAgICAgIHhhID0geCArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgICAgeTEgPSB5ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICAgICAgICB4YiA9IHhhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICAgICAgICB5MiA9IHkxICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICAgICAgICB4ID0geGIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgICAgICAgIGJlemllckN1cnZlVG8oeGEsIHkxLCB4YiwgeTIsIHgsIHkyKTsKICAgICAgICAgICAgICAgICAgICB4YSA9IHggKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgICAgICAgIHkzID0geTIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgICAgICAgIHggPSB4YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeTIsIHhiLCB5MywgeCwgeSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlIDM3OgogICAgICAgICAgICAgICAgICAgIHZhciB4MCA9IHgsCiAgICAgICAgICAgICAgICAgICAgICB5MCA9IHk7CiAgICAgICAgICAgICAgICAgICAgeGEgPSB4ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICAgICAgICB5YSA9IHkgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgICAgICAgIHliID0geWEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgICAgICAgIHggPSB4YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgICAgeSA9IHliICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICAgICAgICBiZXppZXJDdXJ2ZVRvKHhhLCB5YSwgeGIsIHliLCB4LCB5KTsKICAgICAgICAgICAgICAgICAgICB4YSA9IHggKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgICAgICAgIHlhID0geSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgICAgeGIgPSB4YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgICAgeWIgPSB5YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgICAgeCA9IHhiOwogICAgICAgICAgICAgICAgICAgIHkgPSB5YjsKCiAgICAgICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKHggLSB4MCkgPiBNYXRoLmFicyh5IC0geTApKSB7CiAgICAgICAgICAgICAgICAgICAgICB4ICs9IHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIHkgKz0gc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGJlemllckN1cnZlVG8oeGEsIHlhLCB4YiwgeWIsIHgsIHkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoInVua25vd24gb3BlcmF0b3I6IDEyICIuY29uY2F0KHYpKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICAgIGlmIChzdGFjay5sZW5ndGggPj0gNCkgewogICAgICAgICAgICAgICAgICB2YXIgYWNoYXIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgICAgdmFyIGJjaGFyID0gc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICAgIHkgPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgICAgeCA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgICBjbWRzLnB1c2goewogICAgICAgICAgICAgICAgICAgIGNtZDogInNhdmUiCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICBjbWRzLnB1c2goewogICAgICAgICAgICAgICAgICAgIGNtZDogInRyYW5zbGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgYXJnczogW3gsIHldCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB2YXIgY21hcCA9IGxvb2t1cENtYXAoZm9udC5jbWFwLCBTdHJpbmcuZnJvbUNoYXJDb2RlKGZvbnQuZ2x5cGhOYW1lTWFwW19lbmNvZGluZ3MuU3RhbmRhcmRFbmNvZGluZ1thY2hhcl1dKSk7CiAgICAgICAgICAgICAgICAgIGNvbXBpbGVDaGFyU3RyaW5nKGZvbnQuZ2x5cGhzW2NtYXAuZ2x5cGhJZF0sIGNtZHMsIGZvbnQsIGNtYXAuZ2x5cGhJZCk7CiAgICAgICAgICAgICAgICAgIGNtZHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgY21kOiAicmVzdG9yZSIKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIGNtYXAgPSBsb29rdXBDbWFwKGZvbnQuY21hcCwgU3RyaW5nLmZyb21DaGFyQ29kZShmb250LmdseXBoTmFtZU1hcFtfZW5jb2RpbmdzLlN0YW5kYXJkRW5jb2RpbmdbYmNoYXJdXSkpOwogICAgICAgICAgICAgICAgICBjb21waWxlQ2hhclN0cmluZyhmb250LmdseXBoc1tjbWFwLmdseXBoSWRdLCBjbWRzLCBmb250LCBjbWFwLmdseXBoSWQpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgICAgIHN0ZW1zICs9IHN0YWNrLmxlbmd0aCA+PiAxOwogICAgICAgICAgICAgICAgc3RhY2tDbGVhbiA9IHRydWU7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAxOToKICAgICAgICAgICAgICAgIHN0ZW1zICs9IHN0YWNrLmxlbmd0aCA+PiAxOwogICAgICAgICAgICAgICAgaSArPSBzdGVtcyArIDcgPj4gMzsKICAgICAgICAgICAgICAgIHN0YWNrQ2xlYW4gPSB0cnVlOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMjA6CiAgICAgICAgICAgICAgICBzdGVtcyArPSBzdGFjay5sZW5ndGggPj4gMTsKICAgICAgICAgICAgICAgIGkgKz0gc3RlbXMgKyA3ID4+IDM7CiAgICAgICAgICAgICAgICBzdGFja0NsZWFuID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDIxOgogICAgICAgICAgICAgICAgeSArPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgIHggKz0gc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICBtb3ZlVG8oeCwgeSk7CiAgICAgICAgICAgICAgICBzdGFja0NsZWFuID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDIyOgogICAgICAgICAgICAgICAgeCArPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgIG1vdmVUbyh4LCB5KTsKICAgICAgICAgICAgICAgIHN0YWNrQ2xlYW4gPSB0cnVlOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMjM6CiAgICAgICAgICAgICAgICBzdGVtcyArPSBzdGFjay5sZW5ndGggPj4gMTsKICAgICAgICAgICAgICAgIHN0YWNrQ2xlYW4gPSB0cnVlOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMjQ6CiAgICAgICAgICAgICAgICB3aGlsZSAoc3RhY2subGVuZ3RoID4gMikgewogICAgICAgICAgICAgICAgICB4YSA9IHggKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgICAgICB5YSA9IHkgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgICAgICB4YiA9IHhhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICAgICAgeWIgPSB5YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgIHggPSB4YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgIHkgPSB5YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgIGJlemllckN1cnZlVG8oeGEsIHlhLCB4YiwgeWIsIHgsIHkpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHggKz0gc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICAgIHkgKz0gc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICAgIGxpbmVUbyh4LCB5KTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDI1OgogICAgICAgICAgICAgICAgd2hpbGUgKHN0YWNrLmxlbmd0aCA+IDYpIHsKICAgICAgICAgICAgICAgICAgeCArPSBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgICAgICB5ICs9IHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgIGxpbmVUbyh4LCB5KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB4YSA9IHggKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgICAgeWEgPSB5ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgICAgeWIgPSB5YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICB4ID0geGIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgICAgeSA9IHliICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICAgIGJlemllckN1cnZlVG8oeGEsIHlhLCB4YiwgeWIsIHgsIHkpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMjY6CiAgICAgICAgICAgICAgICBpZiAoc3RhY2subGVuZ3RoICUgMikgewogICAgICAgICAgICAgICAgICB4ICs9IHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgd2hpbGUgKHN0YWNrLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgeGEgPSB4OwogICAgICAgICAgICAgICAgICB5YSA9IHkgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgICAgICB4YiA9IHhhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICAgICAgeWIgPSB5YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgIHggPSB4YjsKICAgICAgICAgICAgICAgICAgeSA9IHliICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeWEsIHhiLCB5YiwgeCwgeSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMjc6CiAgICAgICAgICAgICAgICBpZiAoc3RhY2subGVuZ3RoICUgMikgewogICAgICAgICAgICAgICAgICB5ICs9IHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgd2hpbGUgKHN0YWNrLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgeGEgPSB4ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICAgICAgeWEgPSB5OwogICAgICAgICAgICAgICAgICB4YiA9IHhhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICAgICAgeWIgPSB5YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgIHggPSB4YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgIHkgPSB5YjsKICAgICAgICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeWEsIHhiLCB5YiwgeCwgeSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMjg6CiAgICAgICAgICAgICAgICBzdGFjay5wdXNoKChjb2RlW2ldIDw8IDI0IHwgY29kZVtpICsgMV0gPDwgMTYpID4+IDE2KTsKICAgICAgICAgICAgICAgIGkgKz0gMjsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDI5OgogICAgICAgICAgICAgICAgbiA9IHN0YWNrLnBvcCgpICsgZm9udC5nc3VicnNCaWFzOwogICAgICAgICAgICAgICAgc3VickNvZGUgPSBmb250LmdzdWJyc1tuXTsKCiAgICAgICAgICAgICAgICBpZiAoc3VickNvZGUpIHsKICAgICAgICAgICAgICAgICAgcGFyc2Uoc3VickNvZGUpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDMwOgogICAgICAgICAgICAgICAgd2hpbGUgKHN0YWNrLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgeGEgPSB4OwogICAgICAgICAgICAgICAgICB5YSA9IHkgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgICAgICB4YiA9IHhhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICAgICAgeWIgPSB5YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgIHggPSB4YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgIHkgPSB5YiArIChzdGFjay5sZW5ndGggPT09IDEgPyBzdGFjay5zaGlmdCgpIDogMCk7CiAgICAgICAgICAgICAgICAgIGJlemllckN1cnZlVG8oeGEsIHlhLCB4YiwgeWIsIHgsIHkpOwoKICAgICAgICAgICAgICAgICAgaWYgKHN0YWNrLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB4YSA9IHggKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgICAgICB5YSA9IHk7CiAgICAgICAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgICAgICB5YiA9IHlhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICAgICAgeSA9IHliICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICAgICAgeCA9IHhiICsgKHN0YWNrLmxlbmd0aCA9PT0gMSA/IHN0YWNrLnNoaWZ0KCkgOiAwKTsKICAgICAgICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeWEsIHhiLCB5YiwgeCwgeSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMzE6CiAgICAgICAgICAgICAgICB3aGlsZSAoc3RhY2subGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICB4YSA9IHggKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgICAgICB5YSA9IHk7CiAgICAgICAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgICAgICB5YiA9IHlhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICAgICAgeSA9IHliICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICAgICAgeCA9IHhiICsgKHN0YWNrLmxlbmd0aCA9PT0gMSA/IHN0YWNrLnNoaWZ0KCkgOiAwKTsKICAgICAgICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeWEsIHhiLCB5YiwgeCwgeSk7CgogICAgICAgICAgICAgICAgICBpZiAoc3RhY2subGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIHhhID0geDsKICAgICAgICAgICAgICAgICAgeWEgPSB5ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICAgICAgeGIgPSB4YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgIHliID0geWEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgICAgICB4ID0geGIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgICAgICB5ID0geWIgKyAoc3RhY2subGVuZ3RoID09PSAxID8gc3RhY2suc2hpZnQoKSA6IDApOwogICAgICAgICAgICAgICAgICBiZXppZXJDdXJ2ZVRvKHhhLCB5YSwgeGIsIHliLCB4LCB5KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGlmICh2IDwgMzIpIHsKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJ1bmtub3duIG9wZXJhdG9yOiAiLmNvbmNhdCh2KSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHYgPCAyNDcpIHsKICAgICAgICAgICAgICAgICAgc3RhY2sucHVzaCh2IC0gMTM5KTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodiA8IDI1MSkgewogICAgICAgICAgICAgICAgICBzdGFjay5wdXNoKCh2IC0gMjQ3KSAqIDI1NiArIGNvZGVbaSsrXSArIDEwOCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHYgPCAyNTUpIHsKICAgICAgICAgICAgICAgICAgc3RhY2sucHVzaCgtKHYgLSAyNTEpICogMjU2IC0gY29kZVtpKytdIC0gMTA4KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goKGNvZGVbaV0gPDwgMjQgfCBjb2RlW2kgKyAxXSA8PCAxNiB8IGNvZGVbaSArIDJdIDw8IDggfCBjb2RlW2kgKyAzXSkgLyA2NTUzNik7CiAgICAgICAgICAgICAgICAgIGkgKz0gNDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHN0YWNrQ2xlYW4pIHsKICAgICAgICAgICAgICBzdGFjay5sZW5ndGggPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwYXJzZShjb2RlKTsKICAgICAgfQoKICAgICAgdmFyIE5PT1AgPSBbXTsKCiAgICAgIHZhciBDb21waWxlZEZvbnQgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIENvbXBpbGVkRm9udChmb250TWF0cml4KSB7CiAgICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQ29tcGlsZWRGb250KTsKCiAgICAgICAgICBpZiAodGhpcy5jb25zdHJ1Y3RvciA9PT0gQ29tcGlsZWRGb250KSB7CiAgICAgICAgICAgICgwLCBfdXRpbC51bnJlYWNoYWJsZSkoIkNhbm5vdCBpbml0aWFsaXplIENvbXBpbGVkRm9udC4iKTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLmZvbnRNYXRyaXggPSBmb250TWF0cml4OwogICAgICAgICAgdGhpcy5jb21waWxlZEdseXBocyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgICB0aGlzLmNvbXBpbGVkQ2hhckNvZGVUb0dseXBoSWQgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgIH0KCiAgICAgICAgX2NyZWF0ZUNsYXNzKENvbXBpbGVkRm9udCwgW3sKICAgICAgICAgIGtleTogImdldFBhdGhKcyIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UGF0aEpzKHVuaWNvZGUpIHsKICAgICAgICAgICAgdmFyIGNtYXAgPSBsb29rdXBDbWFwKHRoaXMuY21hcCwgdW5pY29kZSk7CiAgICAgICAgICAgIHZhciBmbiA9IHRoaXMuY29tcGlsZWRHbHlwaHNbY21hcC5nbHlwaElkXTsKCiAgICAgICAgICAgIGlmICghZm4pIHsKICAgICAgICAgICAgICBmbiA9IHRoaXMuY29tcGlsZUdseXBoKHRoaXMuZ2x5cGhzW2NtYXAuZ2x5cGhJZF0sIGNtYXAuZ2x5cGhJZCk7CiAgICAgICAgICAgICAgdGhpcy5jb21waWxlZEdseXBoc1tjbWFwLmdseXBoSWRdID0gZm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0aGlzLmNvbXBpbGVkQ2hhckNvZGVUb0dseXBoSWRbY21hcC5jaGFyQ29kZV0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIHRoaXMuY29tcGlsZWRDaGFyQ29kZVRvR2x5cGhJZFtjbWFwLmNoYXJDb2RlXSA9IGNtYXAuZ2x5cGhJZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGZuOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogImNvbXBpbGVHbHlwaCIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY29tcGlsZUdseXBoKGNvZGUsIGdseXBoSWQpIHsKICAgICAgICAgICAgaWYgKCFjb2RlIHx8IGNvZGUubGVuZ3RoID09PSAwIHx8IGNvZGVbMF0gPT09IDE0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIE5PT1A7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBmb250TWF0cml4ID0gdGhpcy5mb250TWF0cml4OwoKICAgICAgICAgICAgaWYgKHRoaXMuaXNDRkZDSURGb250KSB7CiAgICAgICAgICAgICAgdmFyIGZkSW5kZXggPSB0aGlzLmZkU2VsZWN0LmdldEZESW5kZXgoZ2x5cGhJZCk7CgogICAgICAgICAgICAgIGlmIChmZEluZGV4ID49IDAgJiYgZmRJbmRleCA8IHRoaXMuZmRBcnJheS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIHZhciBmb250RGljdCA9IHRoaXMuZmRBcnJheVtmZEluZGV4XTsKICAgICAgICAgICAgICAgIGZvbnRNYXRyaXggPSBmb250RGljdC5nZXRCeU5hbWUoIkZvbnRNYXRyaXgiKSB8fCBfdXRpbC5GT05UX0lERU5USVRZX01BVFJJWDsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJJbnZhbGlkIGZkIGluZGV4IGZvciBnbHlwaCBpbmRleC4iKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBjbWRzID0gW107CiAgICAgICAgICAgIGNtZHMucHVzaCh7CiAgICAgICAgICAgICAgY21kOiAic2F2ZSIKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNtZHMucHVzaCh7CiAgICAgICAgICAgICAgY21kOiAidHJhbnNmb3JtIiwKICAgICAgICAgICAgICBhcmdzOiBmb250TWF0cml4LnNsaWNlKCkKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNtZHMucHVzaCh7CiAgICAgICAgICAgICAgY21kOiAic2NhbGUiLAogICAgICAgICAgICAgIGFyZ3M6IFsic2l6ZSIsICItc2l6ZSJdCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLmNvbXBpbGVHbHlwaEltcGwoY29kZSwgY21kcywgZ2x5cGhJZCk7CiAgICAgICAgICAgIGNtZHMucHVzaCh7CiAgICAgICAgICAgICAgY21kOiAicmVzdG9yZSIKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBjbWRzOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogImNvbXBpbGVHbHlwaEltcGwiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBpbGVHbHlwaEltcGwoKSB7CiAgICAgICAgICAgICgwLCBfdXRpbC51bnJlYWNoYWJsZSkoIkNoaWxkcmVuIGNsYXNzZXMgc2hvdWxkIGltcGxlbWVudCB0aGlzLiIpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogImhhc0J1aWx0UGF0aCIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaGFzQnVpbHRQYXRoKHVuaWNvZGUpIHsKICAgICAgICAgICAgdmFyIGNtYXAgPSBsb29rdXBDbWFwKHRoaXMuY21hcCwgdW5pY29kZSk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbXBpbGVkR2x5cGhzW2NtYXAuZ2x5cGhJZF0gIT09IHVuZGVmaW5lZCAmJiB0aGlzLmNvbXBpbGVkQ2hhckNvZGVUb0dseXBoSWRbY21hcC5jaGFyQ29kZV0gIT09IHVuZGVmaW5lZDsKICAgICAgICAgIH0KICAgICAgICB9XSk7CgogICAgICAgIHJldHVybiBDb21waWxlZEZvbnQ7CiAgICAgIH0oKTsKCiAgICAgIHZhciBUcnVlVHlwZUNvbXBpbGVkID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQ29tcGlsZWRGb250KSB7CiAgICAgICAgX2luaGVyaXRzKFRydWVUeXBlQ29tcGlsZWQsIF9Db21waWxlZEZvbnQpOwoKICAgICAgICBmdW5jdGlvbiBUcnVlVHlwZUNvbXBpbGVkKGdseXBocywgY21hcCwgZm9udE1hdHJpeCkgewogICAgICAgICAgdmFyIF90aGlzOwoKICAgICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBUcnVlVHlwZUNvbXBpbGVkKTsKCiAgICAgICAgICBfdGhpcyA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihUcnVlVHlwZUNvbXBpbGVkKS5jYWxsKHRoaXMsIGZvbnRNYXRyaXggfHwgWzAuMDAwNDg4LCAwLCAwLCAwLjAwMDQ4OCwgMCwgMF0pKTsKICAgICAgICAgIF90aGlzLmdseXBocyA9IGdseXBoczsKICAgICAgICAgIF90aGlzLmNtYXAgPSBjbWFwOwogICAgICAgICAgcmV0dXJuIF90aGlzOwogICAgICAgIH0KCiAgICAgICAgX2NyZWF0ZUNsYXNzKFRydWVUeXBlQ29tcGlsZWQsIFt7CiAgICAgICAgICBrZXk6ICJjb21waWxlR2x5cGhJbXBsIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjb21waWxlR2x5cGhJbXBsKGNvZGUsIGNtZHMpIHsKICAgICAgICAgICAgY29tcGlsZUdseWYoY29kZSwgY21kcywgdGhpcyk7CiAgICAgICAgICB9CiAgICAgICAgfV0pOwoKICAgICAgICByZXR1cm4gVHJ1ZVR5cGVDb21waWxlZDsKICAgICAgfShDb21waWxlZEZvbnQpOwoKICAgICAgdmFyIFR5cGUyQ29tcGlsZWQgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9Db21waWxlZEZvbnQyKSB7CiAgICAgICAgX2luaGVyaXRzKFR5cGUyQ29tcGlsZWQsIF9Db21waWxlZEZvbnQyKTsKCiAgICAgICAgZnVuY3Rpb24gVHlwZTJDb21waWxlZChjZmZJbmZvLCBjbWFwLCBmb250TWF0cml4LCBnbHlwaE5hbWVNYXApIHsKICAgICAgICAgIHZhciBfdGhpczI7CgogICAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFR5cGUyQ29tcGlsZWQpOwoKICAgICAgICAgIF90aGlzMiA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihUeXBlMkNvbXBpbGVkKS5jYWxsKHRoaXMsIGZvbnRNYXRyaXggfHwgWzAuMDAxLCAwLCAwLCAwLjAwMSwgMCwgMF0pKTsKICAgICAgICAgIF90aGlzMi5nbHlwaHMgPSBjZmZJbmZvLmdseXBoczsKICAgICAgICAgIF90aGlzMi5nc3VicnMgPSBjZmZJbmZvLmdzdWJycyB8fCBbXTsKICAgICAgICAgIF90aGlzMi5zdWJycyA9IGNmZkluZm8uc3VicnMgfHwgW107CiAgICAgICAgICBfdGhpczIuY21hcCA9IGNtYXA7CiAgICAgICAgICBfdGhpczIuZ2x5cGhOYW1lTWFwID0gZ2x5cGhOYW1lTWFwIHx8ICgwLCBfZ2x5cGhsaXN0LmdldEdseXBoc1VuaWNvZGUpKCk7CiAgICAgICAgICBfdGhpczIuZ3N1YnJzQmlhcyA9IGdldFN1YnJvdXRpbmVCaWFzKF90aGlzMi5nc3VicnMpOwogICAgICAgICAgX3RoaXMyLnN1YnJzQmlhcyA9IGdldFN1YnJvdXRpbmVCaWFzKF90aGlzMi5zdWJycyk7CiAgICAgICAgICBfdGhpczIuaXNDRkZDSURGb250ID0gY2ZmSW5mby5pc0NGRkNJREZvbnQ7CiAgICAgICAgICBfdGhpczIuZmRTZWxlY3QgPSBjZmZJbmZvLmZkU2VsZWN0OwogICAgICAgICAgX3RoaXMyLmZkQXJyYXkgPSBjZmZJbmZvLmZkQXJyYXk7CiAgICAgICAgICByZXR1cm4gX3RoaXMyOwogICAgICAgIH0KCiAgICAgICAgX2NyZWF0ZUNsYXNzKFR5cGUyQ29tcGlsZWQsIFt7CiAgICAgICAgICBrZXk6ICJjb21waWxlR2x5cGhJbXBsIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjb21waWxlR2x5cGhJbXBsKGNvZGUsIGNtZHMsIGdseXBoSWQpIHsKICAgICAgICAgICAgY29tcGlsZUNoYXJTdHJpbmcoY29kZSwgY21kcywgdGhpcywgZ2x5cGhJZCk7CiAgICAgICAgICB9CiAgICAgICAgfV0pOwoKICAgICAgICByZXR1cm4gVHlwZTJDb21waWxlZDsKICAgICAgfShDb21waWxlZEZvbnQpOwoKICAgICAgcmV0dXJuIHsKICAgICAgICBjcmVhdGU6IGZ1bmN0aW9uIEZvbnRSZW5kZXJlckZhY3RvcnlfY3JlYXRlKGZvbnQsIHNlYWNBbmFseXNpc0VuYWJsZWQpIHsKICAgICAgICAgIHZhciBkYXRhID0gbmV3IFVpbnQ4QXJyYXkoZm9udC5kYXRhKTsKICAgICAgICAgIHZhciBjbWFwLCBnbHlmLCBsb2NhLCBjZmYsIGluZGV4VG9Mb2NGb3JtYXQsIHVuaXRzUGVyRW07CiAgICAgICAgICB2YXIgbnVtVGFibGVzID0gZ2V0VXNob3J0KGRhdGEsIDQpOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBwID0gMTI7IGkgPCBudW1UYWJsZXM7IGkrKywgcCArPSAxNikgewogICAgICAgICAgICB2YXIgdGFnID0gKDAsIF91dGlsLmJ5dGVzVG9TdHJpbmcpKGRhdGEuc3ViYXJyYXkocCwgcCArIDQpKTsKICAgICAgICAgICAgdmFyIG9mZnNldCA9IGdldExvbmcoZGF0YSwgcCArIDgpOwogICAgICAgICAgICB2YXIgbGVuZ3RoID0gZ2V0TG9uZyhkYXRhLCBwICsgMTIpOwoKICAgICAgICAgICAgc3dpdGNoICh0YWcpIHsKICAgICAgICAgICAgICBjYXNlICJjbWFwIjoKICAgICAgICAgICAgICAgIGNtYXAgPSBwYXJzZUNtYXAoZGF0YSwgb2Zmc2V0LCBvZmZzZXQgKyBsZW5ndGgpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgImdseWYiOgogICAgICAgICAgICAgICAgZ2x5ZiA9IGRhdGEuc3ViYXJyYXkob2Zmc2V0LCBvZmZzZXQgKyBsZW5ndGgpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgImxvY2EiOgogICAgICAgICAgICAgICAgbG9jYSA9IGRhdGEuc3ViYXJyYXkob2Zmc2V0LCBvZmZzZXQgKyBsZW5ndGgpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgImhlYWQiOgogICAgICAgICAgICAgICAgdW5pdHNQZXJFbSA9IGdldFVzaG9ydChkYXRhLCBvZmZzZXQgKyAxOCk7CiAgICAgICAgICAgICAgICBpbmRleFRvTG9jRm9ybWF0ID0gZ2V0VXNob3J0KGRhdGEsIG9mZnNldCArIDUwKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICJDRkYgIjoKICAgICAgICAgICAgICAgIGNmZiA9IHBhcnNlQ2ZmKGRhdGEsIG9mZnNldCwgb2Zmc2V0ICsgbGVuZ3RoLCBzZWFjQW5hbHlzaXNFbmFibGVkKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGdseWYpIHsKICAgICAgICAgICAgdmFyIGZvbnRNYXRyaXggPSAhdW5pdHNQZXJFbSA/IGZvbnQuZm9udE1hdHJpeCA6IFsxIC8gdW5pdHNQZXJFbSwgMCwgMCwgMSAvIHVuaXRzUGVyRW0sIDAsIDBdOwogICAgICAgICAgICByZXR1cm4gbmV3IFRydWVUeXBlQ29tcGlsZWQocGFyc2VHbHlmVGFibGUoZ2x5ZiwgbG9jYSwgaW5kZXhUb0xvY0Zvcm1hdCksIGNtYXAsIGZvbnRNYXRyaXgpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBuZXcgVHlwZTJDb21waWxlZChjZmYsIGNtYXAsIGZvbnQuZm9udE1hdHJpeCwgZm9udC5nbHlwaE5hbWVNYXApOwogICAgICAgIH0KICAgICAgfTsKICAgIH0oKTsKCiAgICBleHBvcnRzLkZvbnRSZW5kZXJlckZhY3RvcnkgPSBGb250UmVuZGVyZXJGYWN0b3J5OwoKICAgIC8qKiovfSksICgKICAvKiAyMjUgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgoKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgICAgdmFsdWU6IHRydWUKICAgIH0pOwogICAgZXhwb3J0cy5UeXBlMVBhcnNlciA9IHZvaWQgMDsKCiAgICB2YXIgX2VuY29kaW5ncyA9IF9fd19wZGZqc19yZXF1aXJlX18oMjIwKTsKCiAgICB2YXIgX2NvcmVfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE5Nyk7CgogICAgdmFyIF9zdHJlYW0gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIwMSk7CgogICAgdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXyg1KTsKCiAgICB2YXIgSElOVElOR19FTkFCTEVEID0gZmFsc2U7CgogICAgdmFyIFR5cGUxQ2hhclN0cmluZyA9IGZ1bmN0aW9uIFR5cGUxQ2hhclN0cmluZ0Nsb3N1cmUoKSB7CiAgICAgIHZhciBDT01NQU5EX01BUCA9IHsKICAgICAgICBoc3RlbTogWzFdLAogICAgICAgIHZzdGVtOiBbM10sCiAgICAgICAgdm1vdmV0bzogWzRdLAogICAgICAgIHJsaW5ldG86IFs1XSwKICAgICAgICBobGluZXRvOiBbNl0sCiAgICAgICAgdmxpbmV0bzogWzddLAogICAgICAgIHJyY3VydmV0bzogWzhdLAogICAgICAgIGNhbGxzdWJyOiBbMTBdLAogICAgICAgIGZsZXg6IFsxMiwgMzVdLAogICAgICAgIGRyb3A6IFsxMiwgMThdLAogICAgICAgIGVuZGNoYXI6IFsxNF0sCiAgICAgICAgcm1vdmV0bzogWzIxXSwKICAgICAgICBobW92ZXRvOiBbMjJdLAogICAgICAgIHZoY3VydmV0bzogWzMwXSwKICAgICAgICBodmN1cnZldG86IFszMV0KICAgICAgfTsKCiAgICAgIGZ1bmN0aW9uIFR5cGUxQ2hhclN0cmluZygpIHsKICAgICAgICB0aGlzLndpZHRoID0gMDsKICAgICAgICB0aGlzLmxzYiA9IDA7CiAgICAgICAgdGhpcy5mbGV4aW5nID0gZmFsc2U7CiAgICAgICAgdGhpcy5vdXRwdXQgPSBbXTsKICAgICAgICB0aGlzLnN0YWNrID0gW107CiAgICAgIH0KCiAgICAgIFR5cGUxQ2hhclN0cmluZy5wcm90b3R5cGUgPSB7CiAgICAgICAgY29udmVydDogZnVuY3Rpb24gVHlwZTFDaGFyU3RyaW5nX2NvbnZlcnQoZW5jb2RlZCwgc3VicnMsIHNlYWNBbmFseXNpc0VuYWJsZWQpIHsKICAgICAgICAgIHZhciBjb3VudCA9IGVuY29kZWQubGVuZ3RoOwogICAgICAgICAgdmFyIGVycm9yID0gZmFsc2U7CiAgICAgICAgICB2YXIgd3gsIHNieCwgc3Vick51bWJlcjsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgICAgICAgICAgdmFyIHZhbHVlID0gZW5jb2RlZFtpXTsKCiAgICAgICAgICAgIGlmICh2YWx1ZSA8IDMyKSB7CiAgICAgICAgICAgICAgaWYgKHZhbHVlID09PSAxMikgewogICAgICAgICAgICAgICAgdmFsdWUgPSAodmFsdWUgPDwgOCkgKyBlbmNvZGVkWysraV07CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzd2l0Y2ggKHZhbHVlKSB7CiAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgIGlmICghSElOVElOR19FTkFCTEVEKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGFjayA9IFtdOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoMiwgQ09NTUFORF9NQVAuaHN0ZW0pOwogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgIGlmICghSElOVElOR19FTkFCTEVEKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGFjayA9IFtdOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoMiwgQ09NTUFORF9NQVAudnN0ZW0pOwogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmZsZXhpbmcpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGFjay5sZW5ndGggPCAxKSB7CiAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHZhciBkeSA9IHRoaXMuc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGFjay5wdXNoKDAsIGR5KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgZXJyb3IgPSB0aGlzLmV4ZWN1dGVDb21tYW5kKDEsIENPTU1BTkRfTUFQLnZtb3ZldG8pOwogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICAgIGVycm9yID0gdGhpcy5leGVjdXRlQ29tbWFuZCgyLCBDT01NQU5EX01BUC5ybGluZXRvKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoMSwgQ09NTUFORF9NQVAuaGxpbmV0byk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgICAgZXJyb3IgPSB0aGlzLmV4ZWN1dGVDb21tYW5kKDEsIENPTU1BTkRfTUFQLnZsaW5ldG8pOwogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgICAgIGVycm9yID0gdGhpcy5leGVjdXRlQ29tbWFuZCg2LCBDT01NQU5EX01BUC5ycmN1cnZldG8pOwogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICAgIHRoaXMuc3RhY2sgPSBbXTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhY2subGVuZ3RoIDwgMSkgewogICAgICAgICAgICAgICAgICAgIGVycm9yID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgc3Vick51bWJlciA9IHRoaXMuc3RhY2sucG9wKCk7CgogICAgICAgICAgICAgICAgICBpZiAoIXN1YnJzW3N1YnJOdW1iZXJdKSB7CiAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBlcnJvciA9IHRoaXMuY29udmVydChzdWJyc1tzdWJyTnVtYmVyXSwgc3VicnMsIHNlYWNBbmFseXNpc0VuYWJsZWQpOwogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3I7CgogICAgICAgICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhY2subGVuZ3RoIDwgMikgewogICAgICAgICAgICAgICAgICAgIGVycm9yID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgd3ggPSB0aGlzLnN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgICBzYnggPSB0aGlzLnN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgICB0aGlzLmxzYiA9IHNieDsKICAgICAgICAgICAgICAgICAgdGhpcy53aWR0aCA9IHd4OwogICAgICAgICAgICAgICAgICB0aGlzLnN0YWNrLnB1c2god3gsIHNieCk7CiAgICAgICAgICAgICAgICAgIGVycm9yID0gdGhpcy5leGVjdXRlQ29tbWFuZCgyLCBDT01NQU5EX01BUC5obW92ZXRvKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICAgICAgdGhpcy5vdXRwdXQucHVzaChDT01NQU5EX01BUC5lbmRjaGFyWzBdKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSAyMToKICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZmxleGluZykgewogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoMiwgQ09NTUFORF9NQVAucm1vdmV0byk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIGNhc2UgMjI6CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmZsZXhpbmcpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YWNrLnB1c2goMCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGVycm9yID0gdGhpcy5leGVjdXRlQ29tbWFuZCgxLCBDT01NQU5EX01BUC5obW92ZXRvKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSAzMDoKICAgICAgICAgICAgICAgICAgZXJyb3IgPSB0aGlzLmV4ZWN1dGVDb21tYW5kKDQsIENPTU1BTkRfTUFQLnZoY3VydmV0byk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIGNhc2UgMzE6CiAgICAgICAgICAgICAgICAgIGVycm9yID0gdGhpcy5leGVjdXRlQ29tbWFuZCg0LCBDT01NQU5EX01BUC5odmN1cnZldG8pOwogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlICgxMiA8PCA4KSArIDA6CiAgICAgICAgICAgICAgICAgIHRoaXMuc3RhY2sgPSBbXTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSAoMTIgPDwgOCkgKyAxOgogICAgICAgICAgICAgICAgICBpZiAoIUhJTlRJTkdfRU5BQkxFRCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhY2sgPSBbXTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgZXJyb3IgPSB0aGlzLmV4ZWN1dGVDb21tYW5kKDIsIENPTU1BTkRfTUFQLnZzdGVtKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSAoMTIgPDwgOCkgKyAyOgogICAgICAgICAgICAgICAgICBpZiAoIUhJTlRJTkdfRU5BQkxFRCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhY2sgPSBbXTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgZXJyb3IgPSB0aGlzLmV4ZWN1dGVDb21tYW5kKDIsIENPTU1BTkRfTUFQLmhzdGVtKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSAoMTIgPDwgOCkgKyA2OgogICAgICAgICAgICAgICAgICBpZiAoc2VhY0FuYWx5c2lzRW5hYmxlZCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2VhYyA9IHRoaXMuc3RhY2suc3BsaWNlKC00LCA0KTsKICAgICAgICAgICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoMCwgQ09NTUFORF9NQVAuZW5kY2hhcik7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSB0aGlzLmV4ZWN1dGVDb21tYW5kKDQsIENPTU1BTkRfTUFQLmVuZGNoYXIpOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlICgxMiA8PCA4KSArIDc6CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YWNrLmxlbmd0aCA8IDQpIHsKICAgICAgICAgICAgICAgICAgICBlcnJvciA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIHRoaXMuc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICAgIHd4ID0gdGhpcy5zdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgICAgdmFyIHNieSA9IHRoaXMuc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICAgIHNieCA9IHRoaXMuc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICAgIHRoaXMubHNiID0gc2J4OwogICAgICAgICAgICAgICAgICB0aGlzLndpZHRoID0gd3g7CiAgICAgICAgICAgICAgICAgIHRoaXMuc3RhY2sucHVzaCh3eCwgc2J4LCBzYnkpOwogICAgICAgICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoMywgQ09NTUFORF9NQVAucm1vdmV0byk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIGNhc2UgKDEyIDw8IDgpICsgMTI6CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YWNrLmxlbmd0aCA8IDIpIHsKICAgICAgICAgICAgICAgICAgICBlcnJvciA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIHZhciBudW0yID0gdGhpcy5zdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgICAgdmFyIG51bTEgPSB0aGlzLnN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgICB0aGlzLnN0YWNrLnB1c2gobnVtMSAvIG51bTIpOwogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlICgxMiA8PCA4KSArIDE2OgogICAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGFjay5sZW5ndGggPCAyKSB7CiAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBzdWJyTnVtYmVyID0gdGhpcy5zdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgICAgdmFyIG51bUFyZ3MgPSB0aGlzLnN0YWNrLnBvcCgpOwoKICAgICAgICAgICAgICAgICAgaWYgKHN1YnJOdW1iZXIgPT09IDAgJiYgbnVtQXJncyA9PT0gMykgewogICAgICAgICAgICAgICAgICAgIHZhciBmbGV4QXJncyA9IHRoaXMuc3RhY2suc3BsaWNlKHRoaXMuc3RhY2subGVuZ3RoIC0gMTcsIDE3KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YWNrLnB1c2goZmxleEFyZ3NbMl0gKyBmbGV4QXJnc1swXSwgZmxleEFyZ3NbM10gKyBmbGV4QXJnc1sxXSwgZmxleEFyZ3NbNF0sIGZsZXhBcmdzWzVdLCBmbGV4QXJnc1s2XSwgZmxleEFyZ3NbN10sIGZsZXhBcmdzWzhdLCBmbGV4QXJnc1s5XSwgZmxleEFyZ3NbMTBdLCBmbGV4QXJnc1sxMV0sIGZsZXhBcmdzWzEyXSwgZmxleEFyZ3NbMTNdLCBmbGV4QXJnc1sxNF0pOwogICAgICAgICAgICAgICAgICAgIGVycm9yID0gdGhpcy5leGVjdXRlQ29tbWFuZCgxMywgQ09NTUFORF9NQVAuZmxleCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5mbGV4aW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGFjay5wdXNoKGZsZXhBcmdzWzE1XSwgZmxleEFyZ3NbMTZdKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzdWJyTnVtYmVyID09PSAxICYmIG51bUFyZ3MgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmZsZXhpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlICgxMiA8PCA4KSArIDE3OgogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlICgxMiA8PCA4KSArIDMzOgogICAgICAgICAgICAgICAgICB0aGlzLnN0YWNrID0gW107CiAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgnVW5rbm93biB0eXBlIDEgY2hhcnN0cmluZyBjb21tYW5kIG9mICInICsgdmFsdWUgKyAnIicpOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChlcnJvcikgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA8PSAyNDYpIHsKICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlIC0gMTM5OwogICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlIDw9IDI1MCkgewogICAgICAgICAgICAgIHZhbHVlID0gKHZhbHVlIC0gMjQ3KSAqIDI1NiArIGVuY29kZWRbKytpXSArIDEwODsKICAgICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA8PSAyNTQpIHsKICAgICAgICAgICAgICB2YWx1ZSA9IC0oKHZhbHVlIC0gMjUxKSAqIDI1NikgLSBlbmNvZGVkWysraV0gLSAxMDg7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdmFsdWUgPSAoZW5jb2RlZFsrK2ldICYgMHhmZikgPDwgMjQgfCAoZW5jb2RlZFsrK2ldICYgMHhmZikgPDwgMTYgfCAoZW5jb2RlZFsrK2ldICYgMHhmZikgPDwgOCB8IChlbmNvZGVkWysraV0gJiAweGZmKSA8PCAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLnN0YWNrLnB1c2godmFsdWUpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBlcnJvcjsKICAgICAgICB9LAogICAgICAgIGV4ZWN1dGVDb21tYW5kOiBmdW5jdGlvbiBleGVjdXRlQ29tbWFuZChob3dNYW55QXJncywgY29tbWFuZCwga2VlcFN0YWNrKSB7CiAgICAgICAgICB2YXIgc3RhY2tMZW5ndGggPSB0aGlzLnN0YWNrLmxlbmd0aDsKCiAgICAgICAgICBpZiAoaG93TWFueUFyZ3MgPiBzdGFja0xlbmd0aCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgc3RhcnQgPSBzdGFja0xlbmd0aCAtIGhvd01hbnlBcmdzOwoKICAgICAgICAgIGZvciAodmFyIGkgPSBzdGFydDsgaSA8IHN0YWNrTGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdmFyIHZhbHVlID0gdGhpcy5zdGFja1tpXTsKCiAgICAgICAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKHZhbHVlKSkgewogICAgICAgICAgICAgIHRoaXMub3V0cHV0LnB1c2goMjgsIHZhbHVlID4+IDggJiAweGZmLCB2YWx1ZSAmIDB4ZmYpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHZhbHVlID0gNjU1MzYgKiB2YWx1ZSB8IDA7CiAgICAgICAgICAgICAgdGhpcy5vdXRwdXQucHVzaCgyNTUsIHZhbHVlID4+IDI0ICYgMHhmZiwgdmFsdWUgPj4gMTYgJiAweGZmLCB2YWx1ZSA+PiA4ICYgMHhmZiwgdmFsdWUgJiAweGZmKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMub3V0cHV0LnB1c2guYXBwbHkodGhpcy5vdXRwdXQsIGNvbW1hbmQpOwoKICAgICAgICAgIGlmIChrZWVwU3RhY2spIHsKICAgICAgICAgICAgdGhpcy5zdGFjay5zcGxpY2Uoc3RhcnQsIGhvd01hbnlBcmdzKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuc3RhY2subGVuZ3RoID0gMDsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9OwogICAgICByZXR1cm4gVHlwZTFDaGFyU3RyaW5nOwogICAgfSgpOwoKICAgIHZhciBUeXBlMVBhcnNlciA9IGZ1bmN0aW9uIFR5cGUxUGFyc2VyQ2xvc3VyZSgpIHsKICAgICAgdmFyIEVFWEVDX0VOQ1JZUFRfS0VZID0gNTU2NjU7CiAgICAgIHZhciBDSEFSX1NUUlNfRU5DUllQVF9LRVkgPSA0MzMwOwoKICAgICAgZnVuY3Rpb24gaXNIZXhEaWdpdChjb2RlKSB7CiAgICAgICAgcmV0dXJuIGNvZGUgPj0gNDggJiYgY29kZSA8PSA1NyB8fCBjb2RlID49IDY1ICYmIGNvZGUgPD0gNzAgfHwgY29kZSA+PSA5NyAmJiBjb2RlIDw9IDEwMjsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZGVjcnlwdChkYXRhLCBrZXksIGRpc2NhcmROdW1iZXIpIHsKICAgICAgICBpZiAoZGlzY2FyZE51bWJlciA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KDApOwogICAgICAgIH0KCiAgICAgICAgdmFyIHIgPSBrZXkgfCAwLAogICAgICAgICAgYzEgPSA1Mjg0NSwKICAgICAgICAgIGMyID0gMjI3MTksCiAgICAgICAgICBpLAogICAgICAgICAgajsKCiAgICAgICAgZm9yIChpID0gMDsgaSA8IGRpc2NhcmROdW1iZXI7IGkrKykgewogICAgICAgICAgciA9IChkYXRhW2ldICsgcikgKiBjMSArIGMyICYgKDEgPDwgMTYpIC0gMTsKICAgICAgICB9CgogICAgICAgIHZhciBjb3VudCA9IGRhdGEubGVuZ3RoIC0gZGlzY2FyZE51bWJlcjsKICAgICAgICB2YXIgZGVjcnlwdGVkID0gbmV3IFVpbnQ4QXJyYXkoY291bnQpOwoKICAgICAgICBmb3IgKGkgPSBkaXNjYXJkTnVtYmVyLCBqID0gMDsgaiA8IGNvdW50OyBpKyssIGorKykgewogICAgICAgICAgdmFyIHZhbHVlID0gZGF0YVtpXTsKICAgICAgICAgIGRlY3J5cHRlZFtqXSA9IHZhbHVlIF4gciA+PiA4OwogICAgICAgICAgciA9ICh2YWx1ZSArIHIpICogYzEgKyBjMiAmICgxIDw8IDE2KSAtIDE7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZGVjcnlwdGVkOwogICAgICB9CgogICAgICBmdW5jdGlvbiBkZWNyeXB0QXNjaWkoZGF0YSwga2V5LCBkaXNjYXJkTnVtYmVyKSB7CiAgICAgICAgdmFyIHIgPSBrZXkgfCAwLAogICAgICAgICAgYzEgPSA1Mjg0NSwKICAgICAgICAgIGMyID0gMjI3MTk7CiAgICAgICAgdmFyIGNvdW50ID0gZGF0YS5sZW5ndGgsCiAgICAgICAgICBtYXliZUxlbmd0aCA9IGNvdW50ID4+PiAxOwogICAgICAgIHZhciBkZWNyeXB0ZWQgPSBuZXcgVWludDhBcnJheShtYXliZUxlbmd0aCk7CiAgICAgICAgdmFyIGksIGo7CgogICAgICAgIGZvciAoaSA9IDAsIGogPSAwOyBpIDwgY291bnQ7IGkrKykgewogICAgICAgICAgdmFyIGRpZ2l0MSA9IGRhdGFbaV07CgogICAgICAgICAgaWYgKCFpc0hleERpZ2l0KGRpZ2l0MSkpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgaSsrOwogICAgICAgICAgdmFyIGRpZ2l0MjsKCiAgICAgICAgICB3aGlsZSAoaSA8IGNvdW50ICYmICFpc0hleERpZ2l0KGRpZ2l0MiA9IGRhdGFbaV0pKSB7CiAgICAgICAgICAgIGkrKzsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoaSA8IGNvdW50KSB7CiAgICAgICAgICAgIHZhciB2YWx1ZSA9IHBhcnNlSW50KFN0cmluZy5mcm9tQ2hhckNvZGUoZGlnaXQxLCBkaWdpdDIpLCAxNik7CiAgICAgICAgICAgIGRlY3J5cHRlZFtqKytdID0gdmFsdWUgXiByID4+IDg7CiAgICAgICAgICAgIHIgPSAodmFsdWUgKyByKSAqIGMxICsgYzIgJiAoMSA8PCAxNikgLSAxOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGRlY3J5cHRlZCwgZGlzY2FyZE51bWJlciwgaik7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGlzU3BlY2lhbChjKSB7CiAgICAgICAgcmV0dXJuIGMgPT09IDB4MmYgfHwgYyA9PT0gMHg1YiB8fCBjID09PSAweDVkIHx8IGMgPT09IDB4N2IgfHwgYyA9PT0gMHg3ZCB8fCBjID09PSAweDI4IHx8IGMgPT09IDB4Mjk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIFR5cGUxUGFyc2VyKHN0cmVhbSwgZW5jcnlwdGVkLCBzZWFjQW5hbHlzaXNFbmFibGVkKSB7CiAgICAgICAgaWYgKGVuY3J5cHRlZCkgewogICAgICAgICAgdmFyIGRhdGEgPSBzdHJlYW0uZ2V0Qnl0ZXMoKTsKICAgICAgICAgIHZhciBpc0JpbmFyeSA9ICEoaXNIZXhEaWdpdChkYXRhWzBdKSAmJiBpc0hleERpZ2l0KGRhdGFbMV0pICYmIGlzSGV4RGlnaXQoZGF0YVsyXSkgJiYgaXNIZXhEaWdpdChkYXRhWzNdKSk7CiAgICAgICAgICBzdHJlYW0gPSBuZXcgX3N0cmVhbS5TdHJlYW0oaXNCaW5hcnkgPyBkZWNyeXB0KGRhdGEsIEVFWEVDX0VOQ1JZUFRfS0VZLCA0KSA6IGRlY3J5cHRBc2NpaShkYXRhLCBFRVhFQ19FTkNSWVBUX0tFWSwgNCkpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5zZWFjQW5hbHlzaXNFbmFibGVkID0gISFzZWFjQW5hbHlzaXNFbmFibGVkOwogICAgICAgIHRoaXMuc3RyZWFtID0gc3RyZWFtOwogICAgICAgIHRoaXMubmV4dENoYXIoKTsKICAgICAgfQoKICAgICAgVHlwZTFQYXJzZXIucHJvdG90eXBlID0gewogICAgICAgIHJlYWROdW1iZXJBcnJheTogZnVuY3Rpb24gVHlwZTFQYXJzZXJfcmVhZE51bWJlckFycmF5KCkgewogICAgICAgICAgdGhpcy5nZXRUb2tlbigpOwogICAgICAgICAgdmFyIGFycmF5ID0gW107CgogICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgdmFyIHRva2VuID0gdGhpcy5nZXRUb2tlbigpOwoKICAgICAgICAgICAgaWYgKHRva2VuID09PSBudWxsIHx8IHRva2VuID09PSAiXSIgfHwgdG9rZW4gPT09ICJ9IikgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBhcnJheS5wdXNoKHBhcnNlRmxvYXQodG9rZW4gfHwgMCkpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBhcnJheTsKICAgICAgICB9LAogICAgICAgIHJlYWROdW1iZXI6IGZ1bmN0aW9uIFR5cGUxUGFyc2VyX3JlYWROdW1iZXIoKSB7CiAgICAgICAgICB2YXIgdG9rZW4gPSB0aGlzLmdldFRva2VuKCk7CiAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdCh0b2tlbiB8fCAwKTsKICAgICAgICB9LAogICAgICAgIHJlYWRJbnQ6IGZ1bmN0aW9uIFR5cGUxUGFyc2VyX3JlYWRJbnQoKSB7CiAgICAgICAgICB2YXIgdG9rZW4gPSB0aGlzLmdldFRva2VuKCk7CiAgICAgICAgICByZXR1cm4gcGFyc2VJbnQodG9rZW4gfHwgMCwgMTApIHwgMDsKICAgICAgICB9LAogICAgICAgIHJlYWRCb29sZWFuOiBmdW5jdGlvbiBUeXBlMVBhcnNlcl9yZWFkQm9vbGVhbigpIHsKICAgICAgICAgIHZhciB0b2tlbiA9IHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgIHJldHVybiB0b2tlbiA9PT0gInRydWUiID8gMSA6IDA7CiAgICAgICAgfSwKICAgICAgICBuZXh0Q2hhcjogZnVuY3Rpb24gVHlwZTFfbmV4dENoYXIoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50Q2hhciA9IHRoaXMuc3RyZWFtLmdldEJ5dGUoKTsKICAgICAgICB9LAogICAgICAgIGdldFRva2VuOiBmdW5jdGlvbiBUeXBlMVBhcnNlcl9nZXRUb2tlbigpIHsKICAgICAgICAgIHZhciBjb21tZW50ID0gZmFsc2U7CiAgICAgICAgICB2YXIgY2ggPSB0aGlzLmN1cnJlbnRDaGFyOwoKICAgICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgIGlmIChjaCA9PT0gLTEpIHsKICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGNvbW1lbnQpIHsKICAgICAgICAgICAgICBpZiAoY2ggPT09IDB4MGEgfHwgY2ggPT09IDB4MGQpIHsKICAgICAgICAgICAgICAgIGNvbW1lbnQgPSBmYWxzZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoY2ggPT09IDB4MjUpIHsKICAgICAgICAgICAgICBjb21tZW50ID0gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIGlmICghKDAsIF9jb3JlX3V0aWxzLmlzV2hpdGVTcGFjZSkoY2gpKSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChpc1NwZWNpYWwoY2gpKSB7CiAgICAgICAgICAgIHRoaXMubmV4dENoYXIoKTsKICAgICAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciB0b2tlbiA9ICIiOwoKICAgICAgICAgIGRvIHsKICAgICAgICAgICAgdG9rZW4gKz0gU3RyaW5nLmZyb21DaGFyQ29kZShjaCk7CiAgICAgICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgfSB3aGlsZSAoY2ggPj0gMCAmJiAhKDAsIF9jb3JlX3V0aWxzLmlzV2hpdGVTcGFjZSkoY2gpICYmICFpc1NwZWNpYWwoY2gpKTsKCiAgICAgICAgICByZXR1cm4gdG9rZW47CiAgICAgICAgfSwKICAgICAgICByZWFkQ2hhclN0cmluZ3M6IGZ1bmN0aW9uIFR5cGUxUGFyc2VyX3JlYWRDaGFyU3RyaW5ncyhieXRlcywgbGVuSVYpIHsKICAgICAgICAgIGlmIChsZW5JViA9PT0gLTEpIHsKICAgICAgICAgICAgcmV0dXJuIGJ5dGVzOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBkZWNyeXB0KGJ5dGVzLCBDSEFSX1NUUlNfRU5DUllQVF9LRVksIGxlbklWKTsKICAgICAgICB9LAogICAgICAgIGV4dHJhY3RGb250UHJvZ3JhbTogZnVuY3Rpb24gVHlwZTFQYXJzZXJfZXh0cmFjdEZvbnRQcm9ncmFtKHByb3BlcnRpZXMpIHsKICAgICAgICAgIHZhciBzdHJlYW0gPSB0aGlzLnN0cmVhbTsKICAgICAgICAgIHZhciBzdWJycyA9IFtdLAogICAgICAgICAgICBjaGFyc3RyaW5ncyA9IFtdOwogICAgICAgICAgdmFyIHByaXZhdGVEYXRhID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICAgIHByaXZhdGVEYXRhWyJsZW5JViJdID0gNDsKICAgICAgICAgIHZhciBwcm9ncmFtID0gewogICAgICAgICAgICBzdWJyczogW10sCiAgICAgICAgICAgIGNoYXJzdHJpbmdzOiBbXSwKICAgICAgICAgICAgcHJvcGVydGllczogewogICAgICAgICAgICAgIHByaXZhdGVEYXRhOiBwcml2YXRlRGF0YQogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgICAgdmFyIHRva2VuLCBsZW5ndGgsIGRhdGEsIGxlbklWLCBlbmNvZGVkOwoKICAgICAgICAgIHdoaWxlICgodG9rZW4gPSB0aGlzLmdldFRva2VuKCkpICE9PSBudWxsKSB7CiAgICAgICAgICAgIGlmICh0b2tlbiAhPT0gIi8iKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRva2VuID0gdGhpcy5nZXRUb2tlbigpOwoKICAgICAgICAgICAgc3dpdGNoICh0b2tlbikgewogICAgICAgICAgICAgIGNhc2UgIkNoYXJTdHJpbmdzIjoKICAgICAgICAgICAgICAgIHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgICAgICAgIHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgICAgICAgIHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgICAgICAgIHRoaXMuZ2V0VG9rZW4oKTsKCiAgICAgICAgICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgICAgICAgICB0b2tlbiA9IHRoaXMuZ2V0VG9rZW4oKTsKCiAgICAgICAgICAgICAgICAgIGlmICh0b2tlbiA9PT0gbnVsbCB8fCB0b2tlbiA9PT0gImVuZCIpIHsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgaWYgKHRva2VuICE9PSAiLyIpIHsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgdmFyIGdseXBoID0gdGhpcy5nZXRUb2tlbigpOwogICAgICAgICAgICAgICAgICBsZW5ndGggPSB0aGlzLnJlYWRJbnQoKTsKICAgICAgICAgICAgICAgICAgdGhpcy5nZXRUb2tlbigpOwogICAgICAgICAgICAgICAgICBkYXRhID0gbGVuZ3RoID4gMCA/IHN0cmVhbS5nZXRCeXRlcyhsZW5ndGgpIDogbmV3IFVpbnQ4QXJyYXkoMCk7CiAgICAgICAgICAgICAgICAgIGxlbklWID0gcHJvZ3JhbS5wcm9wZXJ0aWVzLnByaXZhdGVEYXRhWyJsZW5JViJdOwogICAgICAgICAgICAgICAgICBlbmNvZGVkID0gdGhpcy5yZWFkQ2hhclN0cmluZ3MoZGF0YSwgbGVuSVYpOwogICAgICAgICAgICAgICAgICB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgICAgICAgICAgIHRva2VuID0gdGhpcy5nZXRUb2tlbigpOwoKICAgICAgICAgICAgICAgICAgaWYgKHRva2VuID09PSAibm9hY2Nlc3MiKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRUb2tlbigpOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBjaGFyc3RyaW5ncy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICBnbHlwaDogZ2x5cGgsCiAgICAgICAgICAgICAgICAgICAgZW5jb2RlZDogZW5jb2RlZAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAiU3VicnMiOgogICAgICAgICAgICAgICAgdGhpcy5yZWFkSW50KCk7CiAgICAgICAgICAgICAgICB0aGlzLmdldFRva2VuKCk7CgogICAgICAgICAgICAgICAgd2hpbGUgKHRoaXMuZ2V0VG9rZW4oKSA9PT0gImR1cCIpIHsKICAgICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gdGhpcy5yZWFkSW50KCk7CiAgICAgICAgICAgICAgICAgIGxlbmd0aCA9IHRoaXMucmVhZEludCgpOwogICAgICAgICAgICAgICAgICB0aGlzLmdldFRva2VuKCk7CiAgICAgICAgICAgICAgICAgIGRhdGEgPSBsZW5ndGggPiAwID8gc3RyZWFtLmdldEJ5dGVzKGxlbmd0aCkgOiBuZXcgVWludDhBcnJheSgwKTsKICAgICAgICAgICAgICAgICAgbGVuSVYgPSBwcm9ncmFtLnByb3BlcnRpZXMucHJpdmF0ZURhdGFbImxlbklWIl07CiAgICAgICAgICAgICAgICAgIGVuY29kZWQgPSB0aGlzLnJlYWRDaGFyU3RyaW5ncyhkYXRhLCBsZW5JVik7CiAgICAgICAgICAgICAgICAgIHRoaXMubmV4dENoYXIoKTsKICAgICAgICAgICAgICAgICAgdG9rZW4gPSB0aGlzLmdldFRva2VuKCk7CgogICAgICAgICAgICAgICAgICBpZiAodG9rZW4gPT09ICJub2FjY2VzcyIpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmdldFRva2VuKCk7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIHN1YnJzW2luZGV4XSA9IGVuY29kZWQ7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgIkJsdWVWYWx1ZXMiOgogICAgICAgICAgICAgIGNhc2UgIk90aGVyQmx1ZXMiOgogICAgICAgICAgICAgIGNhc2UgIkZhbWlseUJsdWVzIjoKICAgICAgICAgICAgICBjYXNlICJGYW1pbHlPdGhlckJsdWVzIjoKICAgICAgICAgICAgICAgIHZhciBibHVlQXJyYXkgPSB0aGlzLnJlYWROdW1iZXJBcnJheSgpOwoKICAgICAgICAgICAgICAgIGlmIChibHVlQXJyYXkubGVuZ3RoID4gMCAmJiBibHVlQXJyYXkubGVuZ3RoICUgMiA9PT0gMCAmJiBISU5USU5HX0VOQUJMRUQpIHsKICAgICAgICAgICAgICAgICAgcHJvZ3JhbS5wcm9wZXJ0aWVzLnByaXZhdGVEYXRhW3Rva2VuXSA9IGJsdWVBcnJheTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAiU3RlbVNuYXBIIjoKICAgICAgICAgICAgICBjYXNlICJTdGVtU25hcFYiOgogICAgICAgICAgICAgICAgcHJvZ3JhbS5wcm9wZXJ0aWVzLnByaXZhdGVEYXRhW3Rva2VuXSA9IHRoaXMucmVhZE51bWJlckFycmF5KCk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAiU3RkSFciOgogICAgICAgICAgICAgIGNhc2UgIlN0ZFZXIjoKICAgICAgICAgICAgICAgIHByb2dyYW0ucHJvcGVydGllcy5wcml2YXRlRGF0YVt0b2tlbl0gPSB0aGlzLnJlYWROdW1iZXJBcnJheSgpWzBdOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgIkJsdWVTaGlmdCI6CiAgICAgICAgICAgICAgY2FzZSAibGVuSVYiOgogICAgICAgICAgICAgIGNhc2UgIkJsdWVGdXp6IjoKICAgICAgICAgICAgICBjYXNlICJCbHVlU2NhbGUiOgogICAgICAgICAgICAgIGNhc2UgIkxhbmd1YWdlR3JvdXAiOgogICAgICAgICAgICAgIGNhc2UgIkV4cGFuc2lvbkZhY3RvciI6CiAgICAgICAgICAgICAgICBwcm9ncmFtLnByb3BlcnRpZXMucHJpdmF0ZURhdGFbdG9rZW5dID0gdGhpcy5yZWFkTnVtYmVyKCk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAiRm9yY2VCb2xkIjoKICAgICAgICAgICAgICAgIHByb2dyYW0ucHJvcGVydGllcy5wcml2YXRlRGF0YVt0b2tlbl0gPSB0aGlzLnJlYWRCb29sZWFuKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hhcnN0cmluZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgZ2x5cGggPSBjaGFyc3RyaW5nc1tpXS5nbHlwaDsKICAgICAgICAgICAgZW5jb2RlZCA9IGNoYXJzdHJpbmdzW2ldLmVuY29kZWQ7CiAgICAgICAgICAgIHZhciBjaGFyU3RyaW5nID0gbmV3IFR5cGUxQ2hhclN0cmluZygpOwogICAgICAgICAgICB2YXIgZXJyb3IgPSBjaGFyU3RyaW5nLmNvbnZlcnQoZW5jb2RlZCwgc3VicnMsIHRoaXMuc2VhY0FuYWx5c2lzRW5hYmxlZCk7CiAgICAgICAgICAgIHZhciBvdXRwdXQgPSBjaGFyU3RyaW5nLm91dHB1dDsKCiAgICAgICAgICAgIGlmIChlcnJvcikgewogICAgICAgICAgICAgIG91dHB1dCA9IFsxNF07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBjaGFyU3RyaW5nT2JqZWN0ID0gewogICAgICAgICAgICAgIGdseXBoTmFtZTogZ2x5cGgsCiAgICAgICAgICAgICAgY2hhcnN0cmluZzogb3V0cHV0LAogICAgICAgICAgICAgIHdpZHRoOiBjaGFyU3RyaW5nLndpZHRoLAogICAgICAgICAgICAgIGxzYjogY2hhclN0cmluZy5sc2IsCiAgICAgICAgICAgICAgc2VhYzogY2hhclN0cmluZy5zZWFjCiAgICAgICAgICAgIH07CgogICAgICAgICAgICBpZiAoZ2x5cGggPT09ICIubm90ZGVmIikgewogICAgICAgICAgICAgIHByb2dyYW0uY2hhcnN0cmluZ3MudW5zaGlmdChjaGFyU3RyaW5nT2JqZWN0KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBwcm9ncmFtLmNoYXJzdHJpbmdzLnB1c2goY2hhclN0cmluZ09iamVjdCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzLmJ1aWx0SW5FbmNvZGluZykgewogICAgICAgICAgICAgIHZhciBfaW5kZXggPSBwcm9wZXJ0aWVzLmJ1aWx0SW5FbmNvZGluZy5pbmRleE9mKGdseXBoKTsKCiAgICAgICAgICAgICAgaWYgKF9pbmRleCA+IC0xICYmIHByb3BlcnRpZXMud2lkdGhzW19pbmRleF0gPT09IHVuZGVmaW5lZCAmJiBfaW5kZXggPj0gcHJvcGVydGllcy5maXJzdENoYXIgJiYgX2luZGV4IDw9IHByb3BlcnRpZXMubGFzdENoYXIpIHsKICAgICAgICAgICAgICAgIHByb3BlcnRpZXMud2lkdGhzW19pbmRleF0gPSBjaGFyU3RyaW5nLndpZHRoOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBwcm9ncmFtOwogICAgICAgIH0sCiAgICAgICAgZXh0cmFjdEZvbnRIZWFkZXI6IGZ1bmN0aW9uIFR5cGUxUGFyc2VyX2V4dHJhY3RGb250SGVhZGVyKHByb3BlcnRpZXMpIHsKICAgICAgICAgIHZhciB0b2tlbjsKCiAgICAgICAgICB3aGlsZSAoKHRva2VuID0gdGhpcy5nZXRUb2tlbigpKSAhPT0gbnVsbCkgewogICAgICAgICAgICBpZiAodG9rZW4gIT09ICIvIikgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0b2tlbiA9IHRoaXMuZ2V0VG9rZW4oKTsKCiAgICAgICAgICAgIHN3aXRjaCAodG9rZW4pIHsKICAgICAgICAgICAgICBjYXNlICJGb250TWF0cml4IjoKICAgICAgICAgICAgICAgIHZhciBtYXRyaXggPSB0aGlzLnJlYWROdW1iZXJBcnJheSgpOwogICAgICAgICAgICAgICAgcHJvcGVydGllcy5mb250TWF0cml4ID0gbWF0cml4OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgIkVuY29kaW5nIjoKICAgICAgICAgICAgICAgIHZhciBlbmNvZGluZ0FyZyA9IHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgICAgICAgIHZhciBlbmNvZGluZzsKCiAgICAgICAgICAgICAgICBpZiAoIS9eXGQrJC8udGVzdChlbmNvZGluZ0FyZykpIHsKICAgICAgICAgICAgICAgICAgZW5jb2RpbmcgPSAoMCwgX2VuY29kaW5ncy5nZXRFbmNvZGluZykoZW5jb2RpbmdBcmcpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgZW5jb2RpbmcgPSBbXTsKICAgICAgICAgICAgICAgICAgdmFyIHNpemUgPSBwYXJzZUludChlbmNvZGluZ0FyZywgMTApIHwgMDsKICAgICAgICAgICAgICAgICAgdGhpcy5nZXRUb2tlbigpOwoKICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzaXplOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IHRoaXMuZ2V0VG9rZW4oKTsKCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHRva2VuICE9PSAiZHVwIiAmJiB0b2tlbiAhPT0gImRlZiIpIHsKICAgICAgICAgICAgICAgICAgICAgIHRva2VuID0gdGhpcy5nZXRUb2tlbigpOwoKICAgICAgICAgICAgICAgICAgICAgIGlmICh0b2tlbiA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAodG9rZW4gPT09ICJkZWYiKSB7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IHRoaXMucmVhZEludCgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgICAgICAgICAgICB2YXIgZ2x5cGggPSB0aGlzLmdldFRva2VuKCk7CiAgICAgICAgICAgICAgICAgICAgZW5jb2RpbmdbaW5kZXhdID0gZ2x5cGg7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRUb2tlbigpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcHJvcGVydGllcy5idWlsdEluRW5jb2RpbmcgPSBlbmNvZGluZzsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICJGb250QkJveCI6CiAgICAgICAgICAgICAgICB2YXIgZm9udEJCb3ggPSB0aGlzLnJlYWROdW1iZXJBcnJheSgpOwogICAgICAgICAgICAgICAgcHJvcGVydGllcy5hc2NlbnQgPSBNYXRoLm1heChmb250QkJveFszXSwgZm9udEJCb3hbMV0pOwogICAgICAgICAgICAgICAgcHJvcGVydGllcy5kZXNjZW50ID0gTWF0aC5taW4oZm9udEJCb3hbMV0sIGZvbnRCQm94WzNdKTsKICAgICAgICAgICAgICAgIHByb3BlcnRpZXMuYXNjZW50U2NhbGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OwogICAgICByZXR1cm4gVHlwZTFQYXJzZXI7CiAgICB9KCk7CgogICAgZXhwb3J0cy5UeXBlMVBhcnNlciA9IFR5cGUxUGFyc2VyOwoKICAgIC8qKiovfSksICgKICAvKiAyMjYgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgoKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgICAgdmFsdWU6IHRydWUKICAgIH0pOwogICAgZXhwb3J0cy5nZXRUaWxpbmdQYXR0ZXJuSVIgPSBnZXRUaWxpbmdQYXR0ZXJuSVI7CiAgICBleHBvcnRzLlBhdHRlcm4gPSB2b2lkIDA7CgogICAgdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXyg1KTsKCiAgICB2YXIgX2NvbG9yc3BhY2UgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIxMik7CgogICAgdmFyIF9wcmltaXRpdmVzID0gX193X3BkZmpzX3JlcXVpcmVfXygxOTQpOwoKICAgIHZhciBfY29yZV91dGlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTk3KTsKCiAgICB2YXIgU2hhZGluZ1R5cGUgPSB7CiAgICAgIEZVTkNUSU9OX0JBU0VEOiAxLAogICAgICBBWElBTDogMiwKICAgICAgUkFESUFMOiAzLAogICAgICBGUkVFX0ZPUk1fTUVTSDogNCwKICAgICAgTEFUVElDRV9GT1JNX01FU0g6IDUsCiAgICAgIENPT05TX1BBVENIX01FU0g6IDYsCiAgICAgIFRFTlNPUl9QQVRDSF9NRVNIOiA3CiAgICB9OwoKICAgIHZhciBQYXR0ZXJuID0gZnVuY3Rpb24gUGF0dGVybkNsb3N1cmUoKSB7CiAgICAgIGZ1bmN0aW9uIFBhdHRlcm4oKSB7CiAgICAgICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgic2hvdWxkIG5vdCBjYWxsIFBhdHRlcm4gY29uc3RydWN0b3IiKTsKICAgICAgfQoKICAgICAgUGF0dGVybi5wcm90b3R5cGUgPSB7CiAgICAgICAgZ2V0UGF0dGVybjogZnVuY3Rpb24gUGF0dGVybl9nZXRQYXR0ZXJuKGN0eCkgewogICAgICAgICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgiU2hvdWxkIG5vdCBjYWxsIFBhdHRlcm4uZ2V0U3R5bGU6ICIuY29uY2F0KGN0eCkpOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIFBhdHRlcm4ucGFyc2VTaGFkaW5nID0gZnVuY3Rpb24gKHNoYWRpbmcsIG1hdHJpeCwgeHJlZiwgcmVzLCBoYW5kbGVyLCBwZGZGdW5jdGlvbkZhY3RvcnkpIHsKICAgICAgICB2YXIgZGljdCA9ICgwLCBfcHJpbWl0aXZlcy5pc1N0cmVhbSkoc2hhZGluZykgPyBzaGFkaW5nLmRpY3QgOiBzaGFkaW5nOwogICAgICAgIHZhciB0eXBlID0gZGljdC5nZXQoIlNoYWRpbmdUeXBlIik7CgogICAgICAgIHRyeSB7CiAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgICAgY2FzZSBTaGFkaW5nVHlwZS5BWElBTDoKICAgICAgICAgICAgY2FzZSBTaGFkaW5nVHlwZS5SQURJQUw6CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTaGFkaW5ncy5SYWRpYWxBeGlhbChkaWN0LCBtYXRyaXgsIHhyZWYsIHJlcywgcGRmRnVuY3Rpb25GYWN0b3J5KTsKCiAgICAgICAgICAgIGNhc2UgU2hhZGluZ1R5cGUuRlJFRV9GT1JNX01FU0g6CiAgICAgICAgICAgIGNhc2UgU2hhZGluZ1R5cGUuTEFUVElDRV9GT1JNX01FU0g6CiAgICAgICAgICAgIGNhc2UgU2hhZGluZ1R5cGUuQ09PTlNfUEFUQ0hfTUVTSDoKICAgICAgICAgICAgY2FzZSBTaGFkaW5nVHlwZS5URU5TT1JfUEFUQ0hfTUVTSDoKICAgICAgICAgICAgICByZXR1cm4gbmV3IFNoYWRpbmdzLk1lc2goc2hhZGluZywgbWF0cml4LCB4cmVmLCByZXMsIHBkZkZ1bmN0aW9uRmFjdG9yeSk7CgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiVW5zdXBwb3J0ZWQgU2hhZGluZ1R5cGU6ICIgKyB0eXBlKTsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgaWYgKGV4IGluc3RhbmNlb2YgX2NvcmVfdXRpbHMuTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICAgICAgdGhyb3cgZXg7CiAgICAgICAgICB9CgogICAgICAgICAgaGFuZGxlci5zZW5kKCJVbnN1cHBvcnRlZEZlYXR1cmUiLCB7CiAgICAgICAgICAgIGZlYXR1cmVJZDogX3V0aWwuVU5TVVBQT1JURURfRkVBVFVSRVMuc2hhZGluZ1BhdHRlcm4KICAgICAgICAgIH0pOwogICAgICAgICAgKDAsIF91dGlsLndhcm4pKGV4KTsKICAgICAgICAgIHJldHVybiBuZXcgU2hhZGluZ3MuRHVtbXkoKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICByZXR1cm4gUGF0dGVybjsKICAgIH0oKTsKCiAgICBleHBvcnRzLlBhdHRlcm4gPSBQYXR0ZXJuOwogICAgdmFyIFNoYWRpbmdzID0ge307CiAgICBTaGFkaW5ncy5TTUFMTF9OVU1CRVIgPSAxZS02OwoKICAgIFNoYWRpbmdzLlJhZGlhbEF4aWFsID0gZnVuY3Rpb24gUmFkaWFsQXhpYWxDbG9zdXJlKCkgewogICAgICBmdW5jdGlvbiBSYWRpYWxBeGlhbChkaWN0LCBtYXRyaXgsIHhyZWYsIHJlcywgcGRmRnVuY3Rpb25GYWN0b3J5KSB7CiAgICAgICAgdGhpcy5tYXRyaXggPSBtYXRyaXg7CiAgICAgICAgdGhpcy5jb29yZHNBcnIgPSBkaWN0LmdldEFycmF5KCJDb29yZHMiKTsKICAgICAgICB0aGlzLnNoYWRpbmdUeXBlID0gZGljdC5nZXQoIlNoYWRpbmdUeXBlIik7CiAgICAgICAgdGhpcy50eXBlID0gIlBhdHRlcm4iOwogICAgICAgIHZhciBjcyA9IGRpY3QuZ2V0KCJDb2xvclNwYWNlIiwgIkNTIik7CiAgICAgICAgY3MgPSBfY29sb3JzcGFjZS5Db2xvclNwYWNlLnBhcnNlKGNzLCB4cmVmLCByZXMsIHBkZkZ1bmN0aW9uRmFjdG9yeSk7CiAgICAgICAgdGhpcy5jcyA9IGNzOwogICAgICAgIHZhciBiYm94ID0gZGljdC5nZXRBcnJheSgiQkJveCIpOwoKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShiYm94KSAmJiBiYm94Lmxlbmd0aCA9PT0gNCkgewogICAgICAgICAgdGhpcy5iYm94ID0gX3V0aWwuVXRpbC5ub3JtYWxpemVSZWN0KGJib3gpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmJib3ggPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgdmFyIHQwID0gMC4wLAogICAgICAgICAgdDEgPSAxLjA7CgogICAgICAgIGlmIChkaWN0LmhhcygiRG9tYWluIikpIHsKICAgICAgICAgIHZhciBkb21haW5BcnIgPSBkaWN0LmdldEFycmF5KCJEb21haW4iKTsKICAgICAgICAgIHQwID0gZG9tYWluQXJyWzBdOwogICAgICAgICAgdDEgPSBkb21haW5BcnJbMV07CiAgICAgICAgfQoKICAgICAgICB2YXIgZXh0ZW5kU3RhcnQgPSBmYWxzZSwKICAgICAgICAgIGV4dGVuZEVuZCA9IGZhbHNlOwoKICAgICAgICBpZiAoZGljdC5oYXMoIkV4dGVuZCIpKSB7CiAgICAgICAgICB2YXIgZXh0ZW5kQXJyID0gZGljdC5nZXRBcnJheSgiRXh0ZW5kIik7CiAgICAgICAgICBleHRlbmRTdGFydCA9IGV4dGVuZEFyclswXTsKICAgICAgICAgIGV4dGVuZEVuZCA9IGV4dGVuZEFyclsxXTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLnNoYWRpbmdUeXBlID09PSBTaGFkaW5nVHlwZS5SQURJQUwgJiYgKCFleHRlbmRTdGFydCB8fCAhZXh0ZW5kRW5kKSkgewogICAgICAgICAgdmFyIHgxID0gdGhpcy5jb29yZHNBcnJbMF07CiAgICAgICAgICB2YXIgeTEgPSB0aGlzLmNvb3Jkc0FyclsxXTsKICAgICAgICAgIHZhciByMSA9IHRoaXMuY29vcmRzQXJyWzJdOwogICAgICAgICAgdmFyIHgyID0gdGhpcy5jb29yZHNBcnJbM107CiAgICAgICAgICB2YXIgeTIgPSB0aGlzLmNvb3Jkc0Fycls0XTsKICAgICAgICAgIHZhciByMiA9IHRoaXMuY29vcmRzQXJyWzVdOwogICAgICAgICAgdmFyIGRpc3RhbmNlID0gTWF0aC5zcXJ0KCh4MSAtIHgyKSAqICh4MSAtIHgyKSArICh5MSAtIHkyKSAqICh5MSAtIHkyKSk7CgogICAgICAgICAgaWYgKHIxIDw9IHIyICsgZGlzdGFuY2UgJiYgcjIgPD0gcjEgKyBkaXN0YW5jZSkgewogICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIlVuc3VwcG9ydGVkIHJhZGlhbCBncmFkaWVudC4iKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXMuZXh0ZW5kU3RhcnQgPSBleHRlbmRTdGFydDsKICAgICAgICB0aGlzLmV4dGVuZEVuZCA9IGV4dGVuZEVuZDsKICAgICAgICB2YXIgZm5PYmogPSBkaWN0LmdldCgiRnVuY3Rpb24iKTsKICAgICAgICB2YXIgZm4gPSBwZGZGdW5jdGlvbkZhY3RvcnkuY3JlYXRlRnJvbUFycmF5KGZuT2JqKTsKICAgICAgICB2YXIgTlVNQkVSX09GX1NBTVBMRVMgPSAxMDsKICAgICAgICB2YXIgc3RlcCA9ICh0MSAtIHQwKSAvIE5VTUJFUl9PRl9TQU1QTEVTOwogICAgICAgIHZhciBjb2xvclN0b3BzID0gdGhpcy5jb2xvclN0b3BzID0gW107CgogICAgICAgIGlmICh0MCA+PSB0MSB8fCBzdGVwIDw9IDApIHsKICAgICAgICAgICgwLCBfdXRpbC5pbmZvKSgiQmFkIHNoYWRpbmcgZG9tYWluLiIpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIGNvbG9yID0gbmV3IEZsb2F0MzJBcnJheShjcy5udW1Db21wcyksCiAgICAgICAgICByYXRpbyA9IG5ldyBGbG9hdDMyQXJyYXkoMSk7CiAgICAgICAgdmFyIHJnYkNvbG9yOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8PSBOVU1CRVJfT0ZfU0FNUExFUzsgaSsrKSB7CiAgICAgICAgICByYXRpb1swXSA9IHQwICsgaSAqIHN0ZXA7CiAgICAgICAgICBmbihyYXRpbywgMCwgY29sb3IsIDApOwogICAgICAgICAgcmdiQ29sb3IgPSBjcy5nZXRSZ2IoY29sb3IsIDApOwoKICAgICAgICAgIHZhciBjc3NDb2xvciA9IF91dGlsLlV0aWwubWFrZUNzc1JnYihyZ2JDb2xvclswXSwgcmdiQ29sb3JbMV0sIHJnYkNvbG9yWzJdKTsKCiAgICAgICAgICBjb2xvclN0b3BzLnB1c2goW2kgLyBOVU1CRVJfT0ZfU0FNUExFUywgY3NzQ29sb3JdKTsKICAgICAgICB9CgogICAgICAgIHZhciBiYWNrZ3JvdW5kID0gInRyYW5zcGFyZW50IjsKCiAgICAgICAgaWYgKGRpY3QuaGFzKCJCYWNrZ3JvdW5kIikpIHsKICAgICAgICAgIHJnYkNvbG9yID0gY3MuZ2V0UmdiKGRpY3QuZ2V0KCJCYWNrZ3JvdW5kIiksIDApOwogICAgICAgICAgYmFja2dyb3VuZCA9IF91dGlsLlV0aWwubWFrZUNzc1JnYihyZ2JDb2xvclswXSwgcmdiQ29sb3JbMV0sIHJnYkNvbG9yWzJdKTsKICAgICAgICB9CgogICAgICAgIGlmICghZXh0ZW5kU3RhcnQpIHsKICAgICAgICAgIGNvbG9yU3RvcHMudW5zaGlmdChbMCwgYmFja2dyb3VuZF0pOwogICAgICAgICAgY29sb3JTdG9wc1sxXVswXSArPSBTaGFkaW5ncy5TTUFMTF9OVU1CRVI7CiAgICAgICAgfQoKICAgICAgICBpZiAoIWV4dGVuZEVuZCkgewogICAgICAgICAgY29sb3JTdG9wc1tjb2xvclN0b3BzLmxlbmd0aCAtIDFdWzBdIC09IFNoYWRpbmdzLlNNQUxMX05VTUJFUjsKICAgICAgICAgIGNvbG9yU3RvcHMucHVzaChbMSwgYmFja2dyb3VuZF0pOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5jb2xvclN0b3BzID0gY29sb3JTdG9wczsKICAgICAgfQoKICAgICAgUmFkaWFsQXhpYWwucHJvdG90eXBlID0gewogICAgICAgIGdldElSOiBmdW5jdGlvbiBSYWRpYWxBeGlhbF9nZXRJUigpIHsKICAgICAgICAgIHZhciBjb29yZHNBcnIgPSB0aGlzLmNvb3Jkc0FycjsKICAgICAgICAgIHZhciBzaGFkaW5nVHlwZSA9IHRoaXMuc2hhZGluZ1R5cGU7CiAgICAgICAgICB2YXIgdHlwZSwgcDAsIHAxLCByMCwgcjE7CgogICAgICAgICAgaWYgKHNoYWRpbmdUeXBlID09PSBTaGFkaW5nVHlwZS5BWElBTCkgewogICAgICAgICAgICBwMCA9IFtjb29yZHNBcnJbMF0sIGNvb3Jkc0FyclsxXV07CiAgICAgICAgICAgIHAxID0gW2Nvb3Jkc0FyclsyXSwgY29vcmRzQXJyWzNdXTsKICAgICAgICAgICAgcjAgPSBudWxsOwogICAgICAgICAgICByMSA9IG51bGw7CiAgICAgICAgICAgIHR5cGUgPSAiYXhpYWwiOwogICAgICAgICAgfSBlbHNlIGlmIChzaGFkaW5nVHlwZSA9PT0gU2hhZGluZ1R5cGUuUkFESUFMKSB7CiAgICAgICAgICAgIHAwID0gW2Nvb3Jkc0FyclswXSwgY29vcmRzQXJyWzFdXTsKICAgICAgICAgICAgcDEgPSBbY29vcmRzQXJyWzNdLCBjb29yZHNBcnJbNF1dOwogICAgICAgICAgICByMCA9IGNvb3Jkc0FyclsyXTsKICAgICAgICAgICAgcjEgPSBjb29yZHNBcnJbNV07CiAgICAgICAgICAgIHR5cGUgPSAicmFkaWFsIjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICgwLCBfdXRpbC51bnJlYWNoYWJsZSkoImdldFBhdHRlcm4gdHlwZSB1bmtub3duOiAiLmNvbmNhdChzaGFkaW5nVHlwZSkpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBtYXRyaXggPSB0aGlzLm1hdHJpeDsKCiAgICAgICAgICBpZiAobWF0cml4KSB7CiAgICAgICAgICAgIHAwID0gX3V0aWwuVXRpbC5hcHBseVRyYW5zZm9ybShwMCwgbWF0cml4KTsKICAgICAgICAgICAgcDEgPSBfdXRpbC5VdGlsLmFwcGx5VHJhbnNmb3JtKHAxLCBtYXRyaXgpOwoKICAgICAgICAgICAgaWYgKHNoYWRpbmdUeXBlID09PSBTaGFkaW5nVHlwZS5SQURJQUwpIHsKICAgICAgICAgICAgICB2YXIgc2NhbGUgPSBfdXRpbC5VdGlsLnNpbmd1bGFyVmFsdWVEZWNvbXBvc2UyZFNjYWxlKG1hdHJpeCk7CgogICAgICAgICAgICAgIHIwICo9IHNjYWxlWzBdOwogICAgICAgICAgICAgIHIxICo9IHNjYWxlWzFdOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIFsiUmFkaWFsQXhpYWwiLCB0eXBlLCB0aGlzLmJib3gsIHRoaXMuY29sb3JTdG9wcywgcDAsIHAxLCByMCwgcjFdOwogICAgICAgIH0KICAgICAgfTsKICAgICAgcmV0dXJuIFJhZGlhbEF4aWFsOwogICAgfSgpOwoKICAgIFNoYWRpbmdzLk1lc2ggPSBmdW5jdGlvbiBNZXNoQ2xvc3VyZSgpIHsKICAgICAgZnVuY3Rpb24gTWVzaFN0cmVhbVJlYWRlcihzdHJlYW0sIGNvbnRleHQpIHsKICAgICAgICB0aGlzLnN0cmVhbSA9IHN0cmVhbTsKICAgICAgICB0aGlzLmNvbnRleHQgPSBjb250ZXh0OwogICAgICAgIHRoaXMuYnVmZmVyID0gMDsKICAgICAgICB0aGlzLmJ1ZmZlckxlbmd0aCA9IDA7CiAgICAgICAgdmFyIG51bUNvbXBzID0gY29udGV4dC5udW1Db21wczsKICAgICAgICB0aGlzLnRtcENvbXBzQnVmID0gbmV3IEZsb2F0MzJBcnJheShudW1Db21wcyk7CiAgICAgICAgdmFyIGNzTnVtQ29tcHMgPSBjb250ZXh0LmNvbG9yU3BhY2UubnVtQ29tcHM7CiAgICAgICAgdGhpcy50bXBDc0NvbXBzQnVmID0gY29udGV4dC5jb2xvckZuID8gbmV3IEZsb2F0MzJBcnJheShjc051bUNvbXBzKSA6IHRoaXMudG1wQ29tcHNCdWY7CiAgICAgIH0KCiAgICAgIE1lc2hTdHJlYW1SZWFkZXIucHJvdG90eXBlID0gewogICAgICAgIGdldCBoYXNEYXRhKCkgewogICAgICAgICAgaWYgKHRoaXMuc3RyZWFtLmVuZCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5zdHJlYW0ucG9zIDwgdGhpcy5zdHJlYW0uZW5kOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0aGlzLmJ1ZmZlckxlbmd0aCA+IDApIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIG5leHRCeXRlID0gdGhpcy5zdHJlYW0uZ2V0Qnl0ZSgpOwoKICAgICAgICAgIGlmIChuZXh0Qnl0ZSA8IDApIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuYnVmZmVyID0gbmV4dEJ5dGU7CiAgICAgICAgICB0aGlzLmJ1ZmZlckxlbmd0aCA9IDg7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9LAoKICAgICAgICByZWFkQml0czogZnVuY3Rpb24gTWVzaFN0cmVhbVJlYWRlcl9yZWFkQml0cyhuKSB7CiAgICAgICAgICB2YXIgYnVmZmVyID0gdGhpcy5idWZmZXI7CiAgICAgICAgICB2YXIgYnVmZmVyTGVuZ3RoID0gdGhpcy5idWZmZXJMZW5ndGg7CgogICAgICAgICAgaWYgKG4gPT09IDMyKSB7CiAgICAgICAgICAgIGlmIChidWZmZXJMZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICByZXR1cm4gKHRoaXMuc3RyZWFtLmdldEJ5dGUoKSA8PCAyNCB8IHRoaXMuc3RyZWFtLmdldEJ5dGUoKSA8PCAxNiB8IHRoaXMuc3RyZWFtLmdldEJ5dGUoKSA8PCA4IHwgdGhpcy5zdHJlYW0uZ2V0Qnl0ZSgpKSA+Pj4gMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnVmZmVyID0gYnVmZmVyIDw8IDI0IHwgdGhpcy5zdHJlYW0uZ2V0Qnl0ZSgpIDw8IDE2IHwgdGhpcy5zdHJlYW0uZ2V0Qnl0ZSgpIDw8IDggfCB0aGlzLnN0cmVhbS5nZXRCeXRlKCk7CiAgICAgICAgICAgIHZhciBuZXh0Qnl0ZSA9IHRoaXMuc3RyZWFtLmdldEJ5dGUoKTsKICAgICAgICAgICAgdGhpcy5idWZmZXIgPSBuZXh0Qnl0ZSAmICgxIDw8IGJ1ZmZlckxlbmd0aCkgLSAxOwogICAgICAgICAgICByZXR1cm4gKGJ1ZmZlciA8PCA4IC0gYnVmZmVyTGVuZ3RoIHwgKG5leHRCeXRlICYgMHhmZikgPj4gYnVmZmVyTGVuZ3RoKSA+Pj4gMDsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAobiA9PT0gOCAmJiBidWZmZXJMZW5ndGggPT09IDApIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RyZWFtLmdldEJ5dGUoKTsKICAgICAgICAgIH0KCiAgICAgICAgICB3aGlsZSAoYnVmZmVyTGVuZ3RoIDwgbikgewogICAgICAgICAgICBidWZmZXIgPSBidWZmZXIgPDwgOCB8IHRoaXMuc3RyZWFtLmdldEJ5dGUoKTsKICAgICAgICAgICAgYnVmZmVyTGVuZ3RoICs9IDg7CiAgICAgICAgICB9CgogICAgICAgICAgYnVmZmVyTGVuZ3RoIC09IG47CiAgICAgICAgICB0aGlzLmJ1ZmZlckxlbmd0aCA9IGJ1ZmZlckxlbmd0aDsKICAgICAgICAgIHRoaXMuYnVmZmVyID0gYnVmZmVyICYgKDEgPDwgYnVmZmVyTGVuZ3RoKSAtIDE7CiAgICAgICAgICByZXR1cm4gYnVmZmVyID4+IGJ1ZmZlckxlbmd0aDsKICAgICAgICB9LAogICAgICAgIGFsaWduOiBmdW5jdGlvbiBNZXNoU3RyZWFtUmVhZGVyX2FsaWduKCkgewogICAgICAgICAgdGhpcy5idWZmZXIgPSAwOwogICAgICAgICAgdGhpcy5idWZmZXJMZW5ndGggPSAwOwogICAgICAgIH0sCiAgICAgICAgcmVhZEZsYWc6IGZ1bmN0aW9uIE1lc2hTdHJlYW1SZWFkZXJfcmVhZEZsYWcoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5yZWFkQml0cyh0aGlzLmNvbnRleHQuYml0c1BlckZsYWcpOwogICAgICAgIH0sCiAgICAgICAgcmVhZENvb3JkaW5hdGU6IGZ1bmN0aW9uIE1lc2hTdHJlYW1SZWFkZXJfcmVhZENvb3JkaW5hdGUoKSB7CiAgICAgICAgICB2YXIgYml0c1BlckNvb3JkaW5hdGUgPSB0aGlzLmNvbnRleHQuYml0c1BlckNvb3JkaW5hdGU7CiAgICAgICAgICB2YXIgeGkgPSB0aGlzLnJlYWRCaXRzKGJpdHNQZXJDb29yZGluYXRlKTsKICAgICAgICAgIHZhciB5aSA9IHRoaXMucmVhZEJpdHMoYml0c1BlckNvb3JkaW5hdGUpOwogICAgICAgICAgdmFyIGRlY29kZSA9IHRoaXMuY29udGV4dC5kZWNvZGU7CiAgICAgICAgICB2YXIgc2NhbGUgPSBiaXRzUGVyQ29vcmRpbmF0ZSA8IDMyID8gMSAvICgoMSA8PCBiaXRzUGVyQ29vcmRpbmF0ZSkgLSAxKSA6IDIuMzI4MzA2NDM2NTM4Njk2M2UtMTA7CiAgICAgICAgICByZXR1cm4gW3hpICogc2NhbGUgKiAoZGVjb2RlWzFdIC0gZGVjb2RlWzBdKSArIGRlY29kZVswXSwgeWkgKiBzY2FsZSAqIChkZWNvZGVbM10gLSBkZWNvZGVbMl0pICsgZGVjb2RlWzJdXTsKICAgICAgICB9LAogICAgICAgIHJlYWRDb21wb25lbnRzOiBmdW5jdGlvbiBNZXNoU3RyZWFtUmVhZGVyX3JlYWRDb21wb25lbnRzKCkgewogICAgICAgICAgdmFyIG51bUNvbXBzID0gdGhpcy5jb250ZXh0Lm51bUNvbXBzOwogICAgICAgICAgdmFyIGJpdHNQZXJDb21wb25lbnQgPSB0aGlzLmNvbnRleHQuYml0c1BlckNvbXBvbmVudDsKICAgICAgICAgIHZhciBzY2FsZSA9IGJpdHNQZXJDb21wb25lbnQgPCAzMiA/IDEgLyAoKDEgPDwgYml0c1BlckNvbXBvbmVudCkgLSAxKSA6IDIuMzI4MzA2NDM2NTM4Njk2M2UtMTA7CiAgICAgICAgICB2YXIgZGVjb2RlID0gdGhpcy5jb250ZXh0LmRlY29kZTsKICAgICAgICAgIHZhciBjb21wb25lbnRzID0gdGhpcy50bXBDb21wc0J1ZjsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaiA9IDQ7IGkgPCBudW1Db21wczsgaSsrLCBqICs9IDIpIHsKICAgICAgICAgICAgdmFyIGNpID0gdGhpcy5yZWFkQml0cyhiaXRzUGVyQ29tcG9uZW50KTsKICAgICAgICAgICAgY29tcG9uZW50c1tpXSA9IGNpICogc2NhbGUgKiAoZGVjb2RlW2ogKyAxXSAtIGRlY29kZVtqXSkgKyBkZWNvZGVbal07CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGNvbG9yID0gdGhpcy50bXBDc0NvbXBzQnVmOwoKICAgICAgICAgIGlmICh0aGlzLmNvbnRleHQuY29sb3JGbikgewogICAgICAgICAgICB0aGlzLmNvbnRleHQuY29sb3JGbihjb21wb25lbnRzLCAwLCBjb2xvciwgMCk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHRoaXMuY29udGV4dC5jb2xvclNwYWNlLmdldFJnYihjb2xvciwgMCk7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgZnVuY3Rpb24gZGVjb2RlVHlwZTRTaGFkaW5nKG1lc2gsIHJlYWRlcikgewogICAgICAgIHZhciBjb29yZHMgPSBtZXNoLmNvb3JkczsKICAgICAgICB2YXIgY29sb3JzID0gbWVzaC5jb2xvcnM7CiAgICAgICAgdmFyIG9wZXJhdG9ycyA9IFtdOwogICAgICAgIHZhciBwcyA9IFtdOwogICAgICAgIHZhciB2ZXJ0aWNlc0xlZnQgPSAwOwoKICAgICAgICB3aGlsZSAocmVhZGVyLmhhc0RhdGEpIHsKICAgICAgICAgIHZhciBmID0gcmVhZGVyLnJlYWRGbGFnKCk7CiAgICAgICAgICB2YXIgY29vcmQgPSByZWFkZXIucmVhZENvb3JkaW5hdGUoKTsKICAgICAgICAgIHZhciBjb2xvciA9IHJlYWRlci5yZWFkQ29tcG9uZW50cygpOwoKICAgICAgICAgIGlmICh2ZXJ0aWNlc0xlZnQgPT09IDApIHsKICAgICAgICAgICAgaWYgKCEoMCA8PSBmICYmIGYgPD0gMikpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIlVua25vd24gdHlwZTQgZmxhZyIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzd2l0Y2ggKGYpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICB2ZXJ0aWNlc0xlZnQgPSAzOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgIHBzLnB1c2gocHNbcHMubGVuZ3RoIC0gMl0sIHBzW3BzLmxlbmd0aCAtIDFdKTsKICAgICAgICAgICAgICAgIHZlcnRpY2VzTGVmdCA9IDE7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgcHMucHVzaChwc1twcy5sZW5ndGggLSAzXSwgcHNbcHMubGVuZ3RoIC0gMV0pOwogICAgICAgICAgICAgICAgdmVydGljZXNMZWZ0ID0gMTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBvcGVyYXRvcnMucHVzaChmKTsKICAgICAgICAgIH0KCiAgICAgICAgICBwcy5wdXNoKGNvb3Jkcy5sZW5ndGgpOwogICAgICAgICAgY29vcmRzLnB1c2goY29vcmQpOwogICAgICAgICAgY29sb3JzLnB1c2goY29sb3IpOwogICAgICAgICAgdmVydGljZXNMZWZ0LS07CiAgICAgICAgICByZWFkZXIuYWxpZ24oKTsKICAgICAgICB9CgogICAgICAgIG1lc2guZmlndXJlcy5wdXNoKHsKICAgICAgICAgIHR5cGU6ICJ0cmlhbmdsZXMiLAogICAgICAgICAgY29vcmRzOiBuZXcgSW50MzJBcnJheShwcyksCiAgICAgICAgICBjb2xvcnM6IG5ldyBJbnQzMkFycmF5KHBzKQogICAgICAgIH0pOwogICAgICB9CgogICAgICBmdW5jdGlvbiBkZWNvZGVUeXBlNVNoYWRpbmcobWVzaCwgcmVhZGVyLCB2ZXJ0aWNlc1BlclJvdykgewogICAgICAgIHZhciBjb29yZHMgPSBtZXNoLmNvb3JkczsKICAgICAgICB2YXIgY29sb3JzID0gbWVzaC5jb2xvcnM7CiAgICAgICAgdmFyIHBzID0gW107CgogICAgICAgIHdoaWxlIChyZWFkZXIuaGFzRGF0YSkgewogICAgICAgICAgdmFyIGNvb3JkID0gcmVhZGVyLnJlYWRDb29yZGluYXRlKCk7CiAgICAgICAgICB2YXIgY29sb3IgPSByZWFkZXIucmVhZENvbXBvbmVudHMoKTsKICAgICAgICAgIHBzLnB1c2goY29vcmRzLmxlbmd0aCk7CiAgICAgICAgICBjb29yZHMucHVzaChjb29yZCk7CiAgICAgICAgICBjb2xvcnMucHVzaChjb2xvcik7CiAgICAgICAgfQoKICAgICAgICBtZXNoLmZpZ3VyZXMucHVzaCh7CiAgICAgICAgICB0eXBlOiAibGF0dGljZSIsCiAgICAgICAgICBjb29yZHM6IG5ldyBJbnQzMkFycmF5KHBzKSwKICAgICAgICAgIGNvbG9yczogbmV3IEludDMyQXJyYXkocHMpLAogICAgICAgICAgdmVydGljZXNQZXJSb3c6IHZlcnRpY2VzUGVyUm93CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHZhciBNSU5fU1BMSVRfUEFUQ0hfQ0hVTktTX0FNT1VOVCA9IDM7CiAgICAgIHZhciBNQVhfU1BMSVRfUEFUQ0hfQ0hVTktTX0FNT1VOVCA9IDIwOwogICAgICB2YXIgVFJJQU5HTEVfREVOU0lUWSA9IDIwOwoKICAgICAgdmFyIGdldEIgPSBmdW5jdGlvbiBnZXRCQ2xvc3VyZSgpIHsKICAgICAgICBmdW5jdGlvbiBidWlsZEIoY291bnQpIHsKICAgICAgICAgIHZhciBsdXQgPSBbXTsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8PSBjb3VudDsgaSsrKSB7CiAgICAgICAgICAgIHZhciB0ID0gaSAvIGNvdW50LAogICAgICAgICAgICAgIHRfID0gMSAtIHQ7CiAgICAgICAgICAgIGx1dC5wdXNoKG5ldyBGbG9hdDMyQXJyYXkoW3RfICogdF8gKiB0XywgMyAqIHQgKiB0XyAqIHRfLCAzICogdCAqIHQgKiB0XywgdCAqIHQgKiB0XSkpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBsdXQ7CiAgICAgICAgfQoKICAgICAgICB2YXIgY2FjaGUgPSBbXTsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gZ2V0Qihjb3VudCkgewogICAgICAgICAgaWYgKCFjYWNoZVtjb3VudF0pIHsKICAgICAgICAgICAgY2FjaGVbY291bnRdID0gYnVpbGRCKGNvdW50KTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gY2FjaGVbY291bnRdOwogICAgICAgIH07CiAgICAgIH0oKTsKCiAgICAgIGZ1bmN0aW9uIGJ1aWxkRmlndXJlRnJvbVBhdGNoKG1lc2gsIGluZGV4KSB7CiAgICAgICAgdmFyIGZpZ3VyZSA9IG1lc2guZmlndXJlc1tpbmRleF07CiAgICAgICAgKDAsIF91dGlsLmFzc2VydCkoZmlndXJlLnR5cGUgPT09ICJwYXRjaCIsICJVbmV4cGVjdGVkIHBhdGNoIG1lc2ggZmlndXJlIik7CiAgICAgICAgdmFyIGNvb3JkcyA9IG1lc2guY29vcmRzLAogICAgICAgICAgY29sb3JzID0gbWVzaC5jb2xvcnM7CiAgICAgICAgdmFyIHBpID0gZmlndXJlLmNvb3JkczsKICAgICAgICB2YXIgY2kgPSBmaWd1cmUuY29sb3JzOwogICAgICAgIHZhciBmaWd1cmVNaW5YID0gTWF0aC5taW4oY29vcmRzW3BpWzBdXVswXSwgY29vcmRzW3BpWzNdXVswXSwgY29vcmRzW3BpWzEyXV1bMF0sIGNvb3Jkc1twaVsxNV1dWzBdKTsKICAgICAgICB2YXIgZmlndXJlTWluWSA9IE1hdGgubWluKGNvb3Jkc1twaVswXV1bMV0sIGNvb3Jkc1twaVszXV1bMV0sIGNvb3Jkc1twaVsxMl1dWzFdLCBjb29yZHNbcGlbMTVdXVsxXSk7CiAgICAgICAgdmFyIGZpZ3VyZU1heFggPSBNYXRoLm1heChjb29yZHNbcGlbMF1dWzBdLCBjb29yZHNbcGlbM11dWzBdLCBjb29yZHNbcGlbMTJdXVswXSwgY29vcmRzW3BpWzE1XV1bMF0pOwogICAgICAgIHZhciBmaWd1cmVNYXhZID0gTWF0aC5tYXgoY29vcmRzW3BpWzBdXVsxXSwgY29vcmRzW3BpWzNdXVsxXSwgY29vcmRzW3BpWzEyXV1bMV0sIGNvb3Jkc1twaVsxNV1dWzFdKTsKICAgICAgICB2YXIgc3BsaXRYQnkgPSBNYXRoLmNlaWwoKGZpZ3VyZU1heFggLSBmaWd1cmVNaW5YKSAqIFRSSUFOR0xFX0RFTlNJVFkgLyAobWVzaC5ib3VuZHNbMl0gLSBtZXNoLmJvdW5kc1swXSkpOwogICAgICAgIHNwbGl0WEJ5ID0gTWF0aC5tYXgoTUlOX1NQTElUX1BBVENIX0NIVU5LU19BTU9VTlQsIE1hdGgubWluKE1BWF9TUExJVF9QQVRDSF9DSFVOS1NfQU1PVU5ULCBzcGxpdFhCeSkpOwogICAgICAgIHZhciBzcGxpdFlCeSA9IE1hdGguY2VpbCgoZmlndXJlTWF4WSAtIGZpZ3VyZU1pblkpICogVFJJQU5HTEVfREVOU0lUWSAvIChtZXNoLmJvdW5kc1szXSAtIG1lc2guYm91bmRzWzFdKSk7CiAgICAgICAgc3BsaXRZQnkgPSBNYXRoLm1heChNSU5fU1BMSVRfUEFUQ0hfQ0hVTktTX0FNT1VOVCwgTWF0aC5taW4oTUFYX1NQTElUX1BBVENIX0NIVU5LU19BTU9VTlQsIHNwbGl0WUJ5KSk7CiAgICAgICAgdmFyIHZlcnRpY2VzUGVyUm93ID0gc3BsaXRYQnkgKyAxOwogICAgICAgIHZhciBmaWd1cmVDb29yZHMgPSBuZXcgSW50MzJBcnJheSgoc3BsaXRZQnkgKyAxKSAqIHZlcnRpY2VzUGVyUm93KTsKICAgICAgICB2YXIgZmlndXJlQ29sb3JzID0gbmV3IEludDMyQXJyYXkoKHNwbGl0WUJ5ICsgMSkgKiB2ZXJ0aWNlc1BlclJvdyk7CiAgICAgICAgdmFyIGsgPSAwOwogICAgICAgIHZhciBjbCA9IG5ldyBVaW50OEFycmF5KDMpLAogICAgICAgICAgY3IgPSBuZXcgVWludDhBcnJheSgzKTsKICAgICAgICB2YXIgYzAgPSBjb2xvcnNbY2lbMF1dLAogICAgICAgICAgYzEgPSBjb2xvcnNbY2lbMV1dLAogICAgICAgICAgYzIgPSBjb2xvcnNbY2lbMl1dLAogICAgICAgICAgYzMgPSBjb2xvcnNbY2lbM11dOwogICAgICAgIHZhciBiUm93ID0gZ2V0QihzcGxpdFlCeSksCiAgICAgICAgICBiQ29sID0gZ2V0QihzcGxpdFhCeSk7CgogICAgICAgIGZvciAodmFyIHJvdyA9IDA7IHJvdyA8PSBzcGxpdFlCeTsgcm93KyspIHsKICAgICAgICAgIGNsWzBdID0gKGMwWzBdICogKHNwbGl0WUJ5IC0gcm93KSArIGMyWzBdICogcm93KSAvIHNwbGl0WUJ5IHwgMDsKICAgICAgICAgIGNsWzFdID0gKGMwWzFdICogKHNwbGl0WUJ5IC0gcm93KSArIGMyWzFdICogcm93KSAvIHNwbGl0WUJ5IHwgMDsKICAgICAgICAgIGNsWzJdID0gKGMwWzJdICogKHNwbGl0WUJ5IC0gcm93KSArIGMyWzJdICogcm93KSAvIHNwbGl0WUJ5IHwgMDsKICAgICAgICAgIGNyWzBdID0gKGMxWzBdICogKHNwbGl0WUJ5IC0gcm93KSArIGMzWzBdICogcm93KSAvIHNwbGl0WUJ5IHwgMDsKICAgICAgICAgIGNyWzFdID0gKGMxWzFdICogKHNwbGl0WUJ5IC0gcm93KSArIGMzWzFdICogcm93KSAvIHNwbGl0WUJ5IHwgMDsKICAgICAgICAgIGNyWzJdID0gKGMxWzJdICogKHNwbGl0WUJ5IC0gcm93KSArIGMzWzJdICogcm93KSAvIHNwbGl0WUJ5IHwgMDsKCiAgICAgICAgICBmb3IgKHZhciBjb2wgPSAwOyBjb2wgPD0gc3BsaXRYQnk7IGNvbCsrLCBrKyspIHsKICAgICAgICAgICAgaWYgKChyb3cgPT09IDAgfHwgcm93ID09PSBzcGxpdFlCeSkgJiYgKGNvbCA9PT0gMCB8fCBjb2wgPT09IHNwbGl0WEJ5KSkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgeCA9IDAsCiAgICAgICAgICAgICAgeSA9IDA7CiAgICAgICAgICAgIHZhciBxID0gMDsKCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDw9IDM7IGkrKykgewogICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDw9IDM7IGorKywgcSsrKSB7CiAgICAgICAgICAgICAgICB2YXIgbSA9IGJSb3dbcm93XVtpXSAqIGJDb2xbY29sXVtqXTsKICAgICAgICAgICAgICAgIHggKz0gY29vcmRzW3BpW3FdXVswXSAqIG07CiAgICAgICAgICAgICAgICB5ICs9IGNvb3Jkc1twaVtxXV1bMV0gKiBtOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgZmlndXJlQ29vcmRzW2tdID0gY29vcmRzLmxlbmd0aDsKICAgICAgICAgICAgY29vcmRzLnB1c2goW3gsIHldKTsKICAgICAgICAgICAgZmlndXJlQ29sb3JzW2tdID0gY29sb3JzLmxlbmd0aDsKICAgICAgICAgICAgdmFyIG5ld0NvbG9yID0gbmV3IFVpbnQ4QXJyYXkoMyk7CiAgICAgICAgICAgIG5ld0NvbG9yWzBdID0gKGNsWzBdICogKHNwbGl0WEJ5IC0gY29sKSArIGNyWzBdICogY29sKSAvIHNwbGl0WEJ5IHwgMDsKICAgICAgICAgICAgbmV3Q29sb3JbMV0gPSAoY2xbMV0gKiAoc3BsaXRYQnkgLSBjb2wpICsgY3JbMV0gKiBjb2wpIC8gc3BsaXRYQnkgfCAwOwogICAgICAgICAgICBuZXdDb2xvclsyXSA9IChjbFsyXSAqIChzcGxpdFhCeSAtIGNvbCkgKyBjclsyXSAqIGNvbCkgLyBzcGxpdFhCeSB8IDA7CiAgICAgICAgICAgIGNvbG9ycy5wdXNoKG5ld0NvbG9yKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZpZ3VyZUNvb3Jkc1swXSA9IHBpWzBdOwogICAgICAgIGZpZ3VyZUNvbG9yc1swXSA9IGNpWzBdOwogICAgICAgIGZpZ3VyZUNvb3Jkc1tzcGxpdFhCeV0gPSBwaVszXTsKICAgICAgICBmaWd1cmVDb2xvcnNbc3BsaXRYQnldID0gY2lbMV07CiAgICAgICAgZmlndXJlQ29vcmRzW3ZlcnRpY2VzUGVyUm93ICogc3BsaXRZQnldID0gcGlbMTJdOwogICAgICAgIGZpZ3VyZUNvbG9yc1t2ZXJ0aWNlc1BlclJvdyAqIHNwbGl0WUJ5XSA9IGNpWzJdOwogICAgICAgIGZpZ3VyZUNvb3Jkc1t2ZXJ0aWNlc1BlclJvdyAqIHNwbGl0WUJ5ICsgc3BsaXRYQnldID0gcGlbMTVdOwogICAgICAgIGZpZ3VyZUNvbG9yc1t2ZXJ0aWNlc1BlclJvdyAqIHNwbGl0WUJ5ICsgc3BsaXRYQnldID0gY2lbM107CiAgICAgICAgbWVzaC5maWd1cmVzW2luZGV4XSA9IHsKICAgICAgICAgIHR5cGU6ICJsYXR0aWNlIiwKICAgICAgICAgIGNvb3JkczogZmlndXJlQ29vcmRzLAogICAgICAgICAgY29sb3JzOiBmaWd1cmVDb2xvcnMsCiAgICAgICAgICB2ZXJ0aWNlc1BlclJvdzogdmVydGljZXNQZXJSb3cKICAgICAgICB9OwogICAgICB9CgogICAgICBmdW5jdGlvbiBkZWNvZGVUeXBlNlNoYWRpbmcobWVzaCwgcmVhZGVyKSB7CiAgICAgICAgdmFyIGNvb3JkcyA9IG1lc2guY29vcmRzOwogICAgICAgIHZhciBjb2xvcnMgPSBtZXNoLmNvbG9yczsKICAgICAgICB2YXIgcHMgPSBuZXcgSW50MzJBcnJheSgxNik7CiAgICAgICAgdmFyIGNzID0gbmV3IEludDMyQXJyYXkoNCk7CgogICAgICAgIHdoaWxlIChyZWFkZXIuaGFzRGF0YSkgewogICAgICAgICAgdmFyIGYgPSByZWFkZXIucmVhZEZsYWcoKTsKCiAgICAgICAgICBpZiAoISgwIDw9IGYgJiYgZiA8PSAzKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIlVua25vd24gdHlwZTYgZmxhZyIpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBpLCBpaTsKICAgICAgICAgIHZhciBwaSA9IGNvb3Jkcy5sZW5ndGg7CgogICAgICAgICAgZm9yIChpID0gMCwgaWkgPSBmICE9PSAwID8gOCA6IDEyOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICBjb29yZHMucHVzaChyZWFkZXIucmVhZENvb3JkaW5hdGUoKSk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGNpID0gY29sb3JzLmxlbmd0aDsKCiAgICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGYgIT09IDAgPyAyIDogNDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgY29sb3JzLnB1c2gocmVhZGVyLnJlYWRDb21wb25lbnRzKCkpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciB0bXAxLCB0bXAyLCB0bXAzLCB0bXA0OwoKICAgICAgICAgIHN3aXRjaCAoZikgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgcHNbMTJdID0gcGkgKyAzOwogICAgICAgICAgICAgIHBzWzEzXSA9IHBpICsgNDsKICAgICAgICAgICAgICBwc1sxNF0gPSBwaSArIDU7CiAgICAgICAgICAgICAgcHNbMTVdID0gcGkgKyA2OwogICAgICAgICAgICAgIHBzWzhdID0gcGkgKyAyOwogICAgICAgICAgICAgIHBzWzExXSA9IHBpICsgNzsKICAgICAgICAgICAgICBwc1s0XSA9IHBpICsgMTsKICAgICAgICAgICAgICBwc1s3XSA9IHBpICsgODsKICAgICAgICAgICAgICBwc1swXSA9IHBpOwogICAgICAgICAgICAgIHBzWzFdID0gcGkgKyAxMTsKICAgICAgICAgICAgICBwc1syXSA9IHBpICsgMTA7CiAgICAgICAgICAgICAgcHNbM10gPSBwaSArIDk7CiAgICAgICAgICAgICAgY3NbMl0gPSBjaSArIDE7CiAgICAgICAgICAgICAgY3NbM10gPSBjaSArIDI7CiAgICAgICAgICAgICAgY3NbMF0gPSBjaTsKICAgICAgICAgICAgICBjc1sxXSA9IGNpICsgMzsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICB0bXAxID0gcHNbMTJdOwogICAgICAgICAgICAgIHRtcDIgPSBwc1sxM107CiAgICAgICAgICAgICAgdG1wMyA9IHBzWzE0XTsKICAgICAgICAgICAgICB0bXA0ID0gcHNbMTVdOwogICAgICAgICAgICAgIHBzWzEyXSA9IHRtcDQ7CiAgICAgICAgICAgICAgcHNbMTNdID0gcGkgKyAwOwogICAgICAgICAgICAgIHBzWzE0XSA9IHBpICsgMTsKICAgICAgICAgICAgICBwc1sxNV0gPSBwaSArIDI7CiAgICAgICAgICAgICAgcHNbOF0gPSB0bXAzOwogICAgICAgICAgICAgIHBzWzExXSA9IHBpICsgMzsKICAgICAgICAgICAgICBwc1s0XSA9IHRtcDI7CiAgICAgICAgICAgICAgcHNbN10gPSBwaSArIDQ7CiAgICAgICAgICAgICAgcHNbMF0gPSB0bXAxOwogICAgICAgICAgICAgIHBzWzFdID0gcGkgKyA3OwogICAgICAgICAgICAgIHBzWzJdID0gcGkgKyA2OwogICAgICAgICAgICAgIHBzWzNdID0gcGkgKyA1OwogICAgICAgICAgICAgIHRtcDEgPSBjc1syXTsKICAgICAgICAgICAgICB0bXAyID0gY3NbM107CiAgICAgICAgICAgICAgY3NbMl0gPSB0bXAyOwogICAgICAgICAgICAgIGNzWzNdID0gY2k7CiAgICAgICAgICAgICAgY3NbMF0gPSB0bXAxOwogICAgICAgICAgICAgIGNzWzFdID0gY2kgKyAxOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIHRtcDEgPSBwc1sxNV07CiAgICAgICAgICAgICAgdG1wMiA9IHBzWzExXTsKICAgICAgICAgICAgICBwc1sxMl0gPSBwc1szXTsKICAgICAgICAgICAgICBwc1sxM10gPSBwaSArIDA7CiAgICAgICAgICAgICAgcHNbMTRdID0gcGkgKyAxOwogICAgICAgICAgICAgIHBzWzE1XSA9IHBpICsgMjsKICAgICAgICAgICAgICBwc1s4XSA9IHBzWzddOwogICAgICAgICAgICAgIHBzWzExXSA9IHBpICsgMzsKICAgICAgICAgICAgICBwc1s0XSA9IHRtcDI7CiAgICAgICAgICAgICAgcHNbN10gPSBwaSArIDQ7CiAgICAgICAgICAgICAgcHNbMF0gPSB0bXAxOwogICAgICAgICAgICAgIHBzWzFdID0gcGkgKyA3OwogICAgICAgICAgICAgIHBzWzJdID0gcGkgKyA2OwogICAgICAgICAgICAgIHBzWzNdID0gcGkgKyA1OwogICAgICAgICAgICAgIHRtcDEgPSBjc1szXTsKICAgICAgICAgICAgICBjc1syXSA9IGNzWzFdOwogICAgICAgICAgICAgIGNzWzNdID0gY2k7CiAgICAgICAgICAgICAgY3NbMF0gPSB0bXAxOwogICAgICAgICAgICAgIGNzWzFdID0gY2kgKyAxOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgIHBzWzEyXSA9IHBzWzBdOwogICAgICAgICAgICAgIHBzWzEzXSA9IHBpICsgMDsKICAgICAgICAgICAgICBwc1sxNF0gPSBwaSArIDE7CiAgICAgICAgICAgICAgcHNbMTVdID0gcGkgKyAyOwogICAgICAgICAgICAgIHBzWzhdID0gcHNbMV07CiAgICAgICAgICAgICAgcHNbMTFdID0gcGkgKyAzOwogICAgICAgICAgICAgIHBzWzRdID0gcHNbMl07CiAgICAgICAgICAgICAgcHNbN10gPSBwaSArIDQ7CiAgICAgICAgICAgICAgcHNbMF0gPSBwc1szXTsKICAgICAgICAgICAgICBwc1sxXSA9IHBpICsgNzsKICAgICAgICAgICAgICBwc1syXSA9IHBpICsgNjsKICAgICAgICAgICAgICBwc1szXSA9IHBpICsgNTsKICAgICAgICAgICAgICBjc1syXSA9IGNzWzBdOwogICAgICAgICAgICAgIGNzWzNdID0gY2k7CiAgICAgICAgICAgICAgY3NbMF0gPSBjc1sxXTsKICAgICAgICAgICAgICBjc1sxXSA9IGNpICsgMTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBwc1s1XSA9IGNvb3Jkcy5sZW5ndGg7CiAgICAgICAgICBjb29yZHMucHVzaChbKC00ICogY29vcmRzW3BzWzBdXVswXSAtIGNvb3Jkc1twc1sxNV1dWzBdICsgNiAqIChjb29yZHNbcHNbNF1dWzBdICsgY29vcmRzW3BzWzFdXVswXSkgLSAyICogKGNvb3Jkc1twc1sxMl1dWzBdICsgY29vcmRzW3BzWzNdXVswXSkgKyAzICogKGNvb3Jkc1twc1sxM11dWzBdICsgY29vcmRzW3BzWzddXVswXSkpIC8gOSwgKC00ICogY29vcmRzW3BzWzBdXVsxXSAtIGNvb3Jkc1twc1sxNV1dWzFdICsgNiAqIChjb29yZHNbcHNbNF1dWzFdICsgY29vcmRzW3BzWzFdXVsxXSkgLSAyICogKGNvb3Jkc1twc1sxMl1dWzFdICsgY29vcmRzW3BzWzNdXVsxXSkgKyAzICogKGNvb3Jkc1twc1sxM11dWzFdICsgY29vcmRzW3BzWzddXVsxXSkpIC8gOV0pOwogICAgICAgICAgcHNbNl0gPSBjb29yZHMubGVuZ3RoOwogICAgICAgICAgY29vcmRzLnB1c2goWygtNCAqIGNvb3Jkc1twc1szXV1bMF0gLSBjb29yZHNbcHNbMTJdXVswXSArIDYgKiAoY29vcmRzW3BzWzJdXVswXSArIGNvb3Jkc1twc1s3XV1bMF0pIC0gMiAqIChjb29yZHNbcHNbMF1dWzBdICsgY29vcmRzW3BzWzE1XV1bMF0pICsgMyAqIChjb29yZHNbcHNbNF1dWzBdICsgY29vcmRzW3BzWzE0XV1bMF0pKSAvIDksICgtNCAqIGNvb3Jkc1twc1szXV1bMV0gLSBjb29yZHNbcHNbMTJdXVsxXSArIDYgKiAoY29vcmRzW3BzWzJdXVsxXSArIGNvb3Jkc1twc1s3XV1bMV0pIC0gMiAqIChjb29yZHNbcHNbMF1dWzFdICsgY29vcmRzW3BzWzE1XV1bMV0pICsgMyAqIChjb29yZHNbcHNbNF1dWzFdICsgY29vcmRzW3BzWzE0XV1bMV0pKSAvIDldKTsKICAgICAgICAgIHBzWzldID0gY29vcmRzLmxlbmd0aDsKICAgICAgICAgIGNvb3Jkcy5wdXNoKFsoLTQgKiBjb29yZHNbcHNbMTJdXVswXSAtIGNvb3Jkc1twc1szXV1bMF0gKyA2ICogKGNvb3Jkc1twc1s4XV1bMF0gKyBjb29yZHNbcHNbMTNdXVswXSkgLSAyICogKGNvb3Jkc1twc1swXV1bMF0gKyBjb29yZHNbcHNbMTVdXVswXSkgKyAzICogKGNvb3Jkc1twc1sxMV1dWzBdICsgY29vcmRzW3BzWzFdXVswXSkpIC8gOSwgKC00ICogY29vcmRzW3BzWzEyXV1bMV0gLSBjb29yZHNbcHNbM11dWzFdICsgNiAqIChjb29yZHNbcHNbOF1dWzFdICsgY29vcmRzW3BzWzEzXV1bMV0pIC0gMiAqIChjb29yZHNbcHNbMF1dWzFdICsgY29vcmRzW3BzWzE1XV1bMV0pICsgMyAqIChjb29yZHNbcHNbMTFdXVsxXSArIGNvb3Jkc1twc1sxXV1bMV0pKSAvIDldKTsKICAgICAgICAgIHBzWzEwXSA9IGNvb3Jkcy5sZW5ndGg7CiAgICAgICAgICBjb29yZHMucHVzaChbKC00ICogY29vcmRzW3BzWzE1XV1bMF0gLSBjb29yZHNbcHNbMF1dWzBdICsgNiAqIChjb29yZHNbcHNbMTFdXVswXSArIGNvb3Jkc1twc1sxNF1dWzBdKSAtIDIgKiAoY29vcmRzW3BzWzEyXV1bMF0gKyBjb29yZHNbcHNbM11dWzBdKSArIDMgKiAoY29vcmRzW3BzWzJdXVswXSArIGNvb3Jkc1twc1s4XV1bMF0pKSAvIDksICgtNCAqIGNvb3Jkc1twc1sxNV1dWzFdIC0gY29vcmRzW3BzWzBdXVsxXSArIDYgKiAoY29vcmRzW3BzWzExXV1bMV0gKyBjb29yZHNbcHNbMTRdXVsxXSkgLSAyICogKGNvb3Jkc1twc1sxMl1dWzFdICsgY29vcmRzW3BzWzNdXVsxXSkgKyAzICogKGNvb3Jkc1twc1syXV1bMV0gKyBjb29yZHNbcHNbOF1dWzFdKSkgLyA5XSk7CiAgICAgICAgICBtZXNoLmZpZ3VyZXMucHVzaCh7CiAgICAgICAgICAgIHR5cGU6ICJwYXRjaCIsCiAgICAgICAgICAgIGNvb3JkczogbmV3IEludDMyQXJyYXkocHMpLAogICAgICAgICAgICBjb2xvcnM6IG5ldyBJbnQzMkFycmF5KGNzKQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBkZWNvZGVUeXBlN1NoYWRpbmcobWVzaCwgcmVhZGVyKSB7CiAgICAgICAgdmFyIGNvb3JkcyA9IG1lc2guY29vcmRzOwogICAgICAgIHZhciBjb2xvcnMgPSBtZXNoLmNvbG9yczsKICAgICAgICB2YXIgcHMgPSBuZXcgSW50MzJBcnJheSgxNik7CiAgICAgICAgdmFyIGNzID0gbmV3IEludDMyQXJyYXkoNCk7CgogICAgICAgIHdoaWxlIChyZWFkZXIuaGFzRGF0YSkgewogICAgICAgICAgdmFyIGYgPSByZWFkZXIucmVhZEZsYWcoKTsKCiAgICAgICAgICBpZiAoISgwIDw9IGYgJiYgZiA8PSAzKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIlVua25vd24gdHlwZTcgZmxhZyIpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBpLCBpaTsKICAgICAgICAgIHZhciBwaSA9IGNvb3Jkcy5sZW5ndGg7CgogICAgICAgICAgZm9yIChpID0gMCwgaWkgPSBmICE9PSAwID8gMTIgOiAxNjsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgY29vcmRzLnB1c2gocmVhZGVyLnJlYWRDb29yZGluYXRlKCkpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBjaSA9IGNvbG9ycy5sZW5ndGg7CgogICAgICAgICAgZm9yIChpID0gMCwgaWkgPSBmICE9PSAwID8gMiA6IDQ7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgIGNvbG9ycy5wdXNoKHJlYWRlci5yZWFkQ29tcG9uZW50cygpKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgdG1wMSwgdG1wMiwgdG1wMywgdG1wNDsKCiAgICAgICAgICBzd2l0Y2ggKGYpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIHBzWzEyXSA9IHBpICsgMzsKICAgICAgICAgICAgICBwc1sxM10gPSBwaSArIDQ7CiAgICAgICAgICAgICAgcHNbMTRdID0gcGkgKyA1OwogICAgICAgICAgICAgIHBzWzE1XSA9IHBpICsgNjsKICAgICAgICAgICAgICBwc1s4XSA9IHBpICsgMjsKICAgICAgICAgICAgICBwc1s5XSA9IHBpICsgMTM7CiAgICAgICAgICAgICAgcHNbMTBdID0gcGkgKyAxNDsKICAgICAgICAgICAgICBwc1sxMV0gPSBwaSArIDc7CiAgICAgICAgICAgICAgcHNbNF0gPSBwaSArIDE7CiAgICAgICAgICAgICAgcHNbNV0gPSBwaSArIDEyOwogICAgICAgICAgICAgIHBzWzZdID0gcGkgKyAxNTsKICAgICAgICAgICAgICBwc1s3XSA9IHBpICsgODsKICAgICAgICAgICAgICBwc1swXSA9IHBpOwogICAgICAgICAgICAgIHBzWzFdID0gcGkgKyAxMTsKICAgICAgICAgICAgICBwc1syXSA9IHBpICsgMTA7CiAgICAgICAgICAgICAgcHNbM10gPSBwaSArIDk7CiAgICAgICAgICAgICAgY3NbMl0gPSBjaSArIDE7CiAgICAgICAgICAgICAgY3NbM10gPSBjaSArIDI7CiAgICAgICAgICAgICAgY3NbMF0gPSBjaTsKICAgICAgICAgICAgICBjc1sxXSA9IGNpICsgMzsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICB0bXAxID0gcHNbMTJdOwogICAgICAgICAgICAgIHRtcDIgPSBwc1sxM107CiAgICAgICAgICAgICAgdG1wMyA9IHBzWzE0XTsKICAgICAgICAgICAgICB0bXA0ID0gcHNbMTVdOwogICAgICAgICAgICAgIHBzWzEyXSA9IHRtcDQ7CiAgICAgICAgICAgICAgcHNbMTNdID0gcGkgKyAwOwogICAgICAgICAgICAgIHBzWzE0XSA9IHBpICsgMTsKICAgICAgICAgICAgICBwc1sxNV0gPSBwaSArIDI7CiAgICAgICAgICAgICAgcHNbOF0gPSB0bXAzOwogICAgICAgICAgICAgIHBzWzldID0gcGkgKyA5OwogICAgICAgICAgICAgIHBzWzEwXSA9IHBpICsgMTA7CiAgICAgICAgICAgICAgcHNbMTFdID0gcGkgKyAzOwogICAgICAgICAgICAgIHBzWzRdID0gdG1wMjsKICAgICAgICAgICAgICBwc1s1XSA9IHBpICsgODsKICAgICAgICAgICAgICBwc1s2XSA9IHBpICsgMTE7CiAgICAgICAgICAgICAgcHNbN10gPSBwaSArIDQ7CiAgICAgICAgICAgICAgcHNbMF0gPSB0bXAxOwogICAgICAgICAgICAgIHBzWzFdID0gcGkgKyA3OwogICAgICAgICAgICAgIHBzWzJdID0gcGkgKyA2OwogICAgICAgICAgICAgIHBzWzNdID0gcGkgKyA1OwogICAgICAgICAgICAgIHRtcDEgPSBjc1syXTsKICAgICAgICAgICAgICB0bXAyID0gY3NbM107CiAgICAgICAgICAgICAgY3NbMl0gPSB0bXAyOwogICAgICAgICAgICAgIGNzWzNdID0gY2k7CiAgICAgICAgICAgICAgY3NbMF0gPSB0bXAxOwogICAgICAgICAgICAgIGNzWzFdID0gY2kgKyAxOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIHRtcDEgPSBwc1sxNV07CiAgICAgICAgICAgICAgdG1wMiA9IHBzWzExXTsKICAgICAgICAgICAgICBwc1sxMl0gPSBwc1szXTsKICAgICAgICAgICAgICBwc1sxM10gPSBwaSArIDA7CiAgICAgICAgICAgICAgcHNbMTRdID0gcGkgKyAxOwogICAgICAgICAgICAgIHBzWzE1XSA9IHBpICsgMjsKICAgICAgICAgICAgICBwc1s4XSA9IHBzWzddOwogICAgICAgICAgICAgIHBzWzldID0gcGkgKyA5OwogICAgICAgICAgICAgIHBzWzEwXSA9IHBpICsgMTA7CiAgICAgICAgICAgICAgcHNbMTFdID0gcGkgKyAzOwogICAgICAgICAgICAgIHBzWzRdID0gdG1wMjsKICAgICAgICAgICAgICBwc1s1XSA9IHBpICsgODsKICAgICAgICAgICAgICBwc1s2XSA9IHBpICsgMTE7CiAgICAgICAgICAgICAgcHNbN10gPSBwaSArIDQ7CiAgICAgICAgICAgICAgcHNbMF0gPSB0bXAxOwogICAgICAgICAgICAgIHBzWzFdID0gcGkgKyA3OwogICAgICAgICAgICAgIHBzWzJdID0gcGkgKyA2OwogICAgICAgICAgICAgIHBzWzNdID0gcGkgKyA1OwogICAgICAgICAgICAgIHRtcDEgPSBjc1szXTsKICAgICAgICAgICAgICBjc1syXSA9IGNzWzFdOwogICAgICAgICAgICAgIGNzWzNdID0gY2k7CiAgICAgICAgICAgICAgY3NbMF0gPSB0bXAxOwogICAgICAgICAgICAgIGNzWzFdID0gY2kgKyAxOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgIHBzWzEyXSA9IHBzWzBdOwogICAgICAgICAgICAgIHBzWzEzXSA9IHBpICsgMDsKICAgICAgICAgICAgICBwc1sxNF0gPSBwaSArIDE7CiAgICAgICAgICAgICAgcHNbMTVdID0gcGkgKyAyOwogICAgICAgICAgICAgIHBzWzhdID0gcHNbMV07CiAgICAgICAgICAgICAgcHNbOV0gPSBwaSArIDk7CiAgICAgICAgICAgICAgcHNbMTBdID0gcGkgKyAxMDsKICAgICAgICAgICAgICBwc1sxMV0gPSBwaSArIDM7CiAgICAgICAgICAgICAgcHNbNF0gPSBwc1syXTsKICAgICAgICAgICAgICBwc1s1XSA9IHBpICsgODsKICAgICAgICAgICAgICBwc1s2XSA9IHBpICsgMTE7CiAgICAgICAgICAgICAgcHNbN10gPSBwaSArIDQ7CiAgICAgICAgICAgICAgcHNbMF0gPSBwc1szXTsKICAgICAgICAgICAgICBwc1sxXSA9IHBpICsgNzsKICAgICAgICAgICAgICBwc1syXSA9IHBpICsgNjsKICAgICAgICAgICAgICBwc1szXSA9IHBpICsgNTsKICAgICAgICAgICAgICBjc1syXSA9IGNzWzBdOwogICAgICAgICAgICAgIGNzWzNdID0gY2k7CiAgICAgICAgICAgICAgY3NbMF0gPSBjc1sxXTsKICAgICAgICAgICAgICBjc1sxXSA9IGNpICsgMTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBtZXNoLmZpZ3VyZXMucHVzaCh7CiAgICAgICAgICAgIHR5cGU6ICJwYXRjaCIsCiAgICAgICAgICAgIGNvb3JkczogbmV3IEludDMyQXJyYXkocHMpLAogICAgICAgICAgICBjb2xvcnM6IG5ldyBJbnQzMkFycmF5KGNzKQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiB1cGRhdGVCb3VuZHMobWVzaCkgewogICAgICAgIHZhciBtaW5YID0gbWVzaC5jb29yZHNbMF1bMF0sCiAgICAgICAgICBtaW5ZID0gbWVzaC5jb29yZHNbMF1bMV0sCiAgICAgICAgICBtYXhYID0gbWluWCwKICAgICAgICAgIG1heFkgPSBtaW5ZOwoKICAgICAgICBmb3IgKHZhciBpID0gMSwgaWkgPSBtZXNoLmNvb3Jkcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICB2YXIgeCA9IG1lc2guY29vcmRzW2ldWzBdLAogICAgICAgICAgICB5ID0gbWVzaC5jb29yZHNbaV1bMV07CiAgICAgICAgICBtaW5YID0gbWluWCA+IHggPyB4IDogbWluWDsKICAgICAgICAgIG1pblkgPSBtaW5ZID4geSA/IHkgOiBtaW5ZOwogICAgICAgICAgbWF4WCA9IG1heFggPCB4ID8geCA6IG1heFg7CiAgICAgICAgICBtYXhZID0gbWF4WSA8IHkgPyB5IDogbWF4WTsKICAgICAgICB9CgogICAgICAgIG1lc2guYm91bmRzID0gW21pblgsIG1pblksIG1heFgsIG1heFldOwogICAgICB9CgogICAgICBmdW5jdGlvbiBwYWNrRGF0YShtZXNoKSB7CiAgICAgICAgdmFyIGksIGlpLCBqLCBqajsKICAgICAgICB2YXIgY29vcmRzID0gbWVzaC5jb29yZHM7CiAgICAgICAgdmFyIGNvb3Jkc1BhY2tlZCA9IG5ldyBGbG9hdDMyQXJyYXkoY29vcmRzLmxlbmd0aCAqIDIpOwoKICAgICAgICBmb3IgKGkgPSAwLCBqID0gMCwgaWkgPSBjb29yZHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgdmFyIHh5ID0gY29vcmRzW2ldOwogICAgICAgICAgY29vcmRzUGFja2VkW2orK10gPSB4eVswXTsKICAgICAgICAgIGNvb3Jkc1BhY2tlZFtqKytdID0geHlbMV07CiAgICAgICAgfQoKICAgICAgICBtZXNoLmNvb3JkcyA9IGNvb3Jkc1BhY2tlZDsKICAgICAgICB2YXIgY29sb3JzID0gbWVzaC5jb2xvcnM7CiAgICAgICAgdmFyIGNvbG9yc1BhY2tlZCA9IG5ldyBVaW50OEFycmF5KGNvbG9ycy5sZW5ndGggKiAzKTsKCiAgICAgICAgZm9yIChpID0gMCwgaiA9IDAsIGlpID0gY29sb3JzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgIHZhciBjID0gY29sb3JzW2ldOwogICAgICAgICAgY29sb3JzUGFja2VkW2orK10gPSBjWzBdOwogICAgICAgICAgY29sb3JzUGFja2VkW2orK10gPSBjWzFdOwogICAgICAgICAgY29sb3JzUGFja2VkW2orK10gPSBjWzJdOwogICAgICAgIH0KCiAgICAgICAgbWVzaC5jb2xvcnMgPSBjb2xvcnNQYWNrZWQ7CiAgICAgICAgdmFyIGZpZ3VyZXMgPSBtZXNoLmZpZ3VyZXM7CgogICAgICAgIGZvciAoaSA9IDAsIGlpID0gZmlndXJlcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICB2YXIgZmlndXJlID0gZmlndXJlc1tpXSwKICAgICAgICAgICAgcHMgPSBmaWd1cmUuY29vcmRzLAogICAgICAgICAgICBjcyA9IGZpZ3VyZS5jb2xvcnM7CgogICAgICAgICAgZm9yIChqID0gMCwgamogPSBwcy5sZW5ndGg7IGogPCBqajsgaisrKSB7CiAgICAgICAgICAgIHBzW2pdICo9IDI7CiAgICAgICAgICAgIGNzW2pdICo9IDM7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBNZXNoKHN0cmVhbSwgbWF0cml4LCB4cmVmLCByZXMsIHBkZkZ1bmN0aW9uRmFjdG9yeSkgewogICAgICAgIGlmICghKDAsIF9wcmltaXRpdmVzLmlzU3RyZWFtKShzdHJlYW0pKSB7CiAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIk1lc2ggZGF0YSBpcyBub3QgYSBzdHJlYW0iKTsKICAgICAgICB9CgogICAgICAgIHZhciBkaWN0ID0gc3RyZWFtLmRpY3Q7CiAgICAgICAgdGhpcy5tYXRyaXggPSBtYXRyaXg7CiAgICAgICAgdGhpcy5zaGFkaW5nVHlwZSA9IGRpY3QuZ2V0KCJTaGFkaW5nVHlwZSIpOwogICAgICAgIHRoaXMudHlwZSA9ICJQYXR0ZXJuIjsKICAgICAgICB2YXIgYmJveCA9IGRpY3QuZ2V0QXJyYXkoIkJCb3giKTsKCiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoYmJveCkgJiYgYmJveC5sZW5ndGggPT09IDQpIHsKICAgICAgICAgIHRoaXMuYmJveCA9IF91dGlsLlV0aWwubm9ybWFsaXplUmVjdChiYm94KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5iYm94ID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIHZhciBjcyA9IGRpY3QuZ2V0KCJDb2xvclNwYWNlIiwgIkNTIik7CiAgICAgICAgY3MgPSBfY29sb3JzcGFjZS5Db2xvclNwYWNlLnBhcnNlKGNzLCB4cmVmLCByZXMsIHBkZkZ1bmN0aW9uRmFjdG9yeSk7CiAgICAgICAgdGhpcy5jcyA9IGNzOwogICAgICAgIHRoaXMuYmFja2dyb3VuZCA9IGRpY3QuaGFzKCJCYWNrZ3JvdW5kIikgPyBjcy5nZXRSZ2IoZGljdC5nZXQoIkJhY2tncm91bmQiKSwgMCkgOiBudWxsOwogICAgICAgIHZhciBmbk9iaiA9IGRpY3QuZ2V0KCJGdW5jdGlvbiIpOwogICAgICAgIHZhciBmbiA9IGZuT2JqID8gcGRmRnVuY3Rpb25GYWN0b3J5LmNyZWF0ZUZyb21BcnJheShmbk9iaikgOiBudWxsOwogICAgICAgIHRoaXMuY29vcmRzID0gW107CiAgICAgICAgdGhpcy5jb2xvcnMgPSBbXTsKICAgICAgICB0aGlzLmZpZ3VyZXMgPSBbXTsKICAgICAgICB2YXIgZGVjb2RlQ29udGV4dCA9IHsKICAgICAgICAgIGJpdHNQZXJDb29yZGluYXRlOiBkaWN0LmdldCgiQml0c1BlckNvb3JkaW5hdGUiKSwKICAgICAgICAgIGJpdHNQZXJDb21wb25lbnQ6IGRpY3QuZ2V0KCJCaXRzUGVyQ29tcG9uZW50IiksCiAgICAgICAgICBiaXRzUGVyRmxhZzogZGljdC5nZXQoIkJpdHNQZXJGbGFnIiksCiAgICAgICAgICBkZWNvZGU6IGRpY3QuZ2V0QXJyYXkoIkRlY29kZSIpLAogICAgICAgICAgY29sb3JGbjogZm4sCiAgICAgICAgICBjb2xvclNwYWNlOiBjcywKICAgICAgICAgIG51bUNvbXBzOiBmbiA/IDEgOiBjcy5udW1Db21wcwogICAgICAgIH07CiAgICAgICAgdmFyIHJlYWRlciA9IG5ldyBNZXNoU3RyZWFtUmVhZGVyKHN0cmVhbSwgZGVjb2RlQ29udGV4dCk7CiAgICAgICAgdmFyIHBhdGNoTWVzaCA9IGZhbHNlOwoKICAgICAgICBzd2l0Y2ggKHRoaXMuc2hhZGluZ1R5cGUpIHsKICAgICAgICAgIGNhc2UgU2hhZGluZ1R5cGUuRlJFRV9GT1JNX01FU0g6CiAgICAgICAgICAgIGRlY29kZVR5cGU0U2hhZGluZyh0aGlzLCByZWFkZXIpOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIFNoYWRpbmdUeXBlLkxBVFRJQ0VfRk9STV9NRVNIOgogICAgICAgICAgICB2YXIgdmVydGljZXNQZXJSb3cgPSBkaWN0LmdldCgiVmVydGljZXNQZXJSb3ciKSB8IDA7CgogICAgICAgICAgICBpZiAodmVydGljZXNQZXJSb3cgPCAyKSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJJbnZhbGlkIFZlcnRpY2VzUGVyUm93Iik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGRlY29kZVR5cGU1U2hhZGluZyh0aGlzLCByZWFkZXIsIHZlcnRpY2VzUGVyUm93KTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSBTaGFkaW5nVHlwZS5DT09OU19QQVRDSF9NRVNIOgogICAgICAgICAgICBkZWNvZGVUeXBlNlNoYWRpbmcodGhpcywgcmVhZGVyKTsKICAgICAgICAgICAgcGF0Y2hNZXNoID0gdHJ1ZTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSBTaGFkaW5nVHlwZS5URU5TT1JfUEFUQ0hfTUVTSDoKICAgICAgICAgICAgZGVjb2RlVHlwZTdTaGFkaW5nKHRoaXMsIHJlYWRlcik7CiAgICAgICAgICAgIHBhdGNoTWVzaCA9IHRydWU7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICgwLCBfdXRpbC51bnJlYWNoYWJsZSkoIlVuc3VwcG9ydGVkIG1lc2ggdHlwZS4iKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBpZiAocGF0Y2hNZXNoKSB7CiAgICAgICAgICB1cGRhdGVCb3VuZHModGhpcyk7CgogICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gdGhpcy5maWd1cmVzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgYnVpbGRGaWd1cmVGcm9tUGF0Y2godGhpcywgaSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB1cGRhdGVCb3VuZHModGhpcyk7CiAgICAgICAgcGFja0RhdGEodGhpcyk7CiAgICAgIH0KCiAgICAgIE1lc2gucHJvdG90eXBlID0gewogICAgICAgIGdldElSOiBmdW5jdGlvbiBNZXNoX2dldElSKCkgewogICAgICAgICAgcmV0dXJuIFsiTWVzaCIsIHRoaXMuc2hhZGluZ1R5cGUsIHRoaXMuY29vcmRzLCB0aGlzLmNvbG9ycywgdGhpcy5maWd1cmVzLCB0aGlzLmJvdW5kcywgdGhpcy5tYXRyaXgsIHRoaXMuYmJveCwgdGhpcy5iYWNrZ3JvdW5kXTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHJldHVybiBNZXNoOwogICAgfSgpOwoKICAgIFNoYWRpbmdzLkR1bW15ID0gZnVuY3Rpb24gRHVtbXlDbG9zdXJlKCkgewogICAgICBmdW5jdGlvbiBEdW1teSgpIHsKICAgICAgICB0aGlzLnR5cGUgPSAiUGF0dGVybiI7CiAgICAgIH0KCiAgICAgIER1bW15LnByb3RvdHlwZSA9IHsKICAgICAgICBnZXRJUjogZnVuY3Rpb24gRHVtbXlfZ2V0SVIoKSB7CiAgICAgICAgICByZXR1cm4gWyJEdW1teSJdOwogICAgICAgIH0KICAgICAgfTsKICAgICAgcmV0dXJuIER1bW15OwogICAgfSgpOwoKICAgIGZ1bmN0aW9uIGdldFRpbGluZ1BhdHRlcm5JUihvcGVyYXRvckxpc3QsIGRpY3QsIGFyZ3MpIHsKICAgICAgdmFyIG1hdHJpeCA9IGRpY3QuZ2V0QXJyYXkoIk1hdHJpeCIpOwoKICAgICAgdmFyIGJib3ggPSBfdXRpbC5VdGlsLm5vcm1hbGl6ZVJlY3QoZGljdC5nZXRBcnJheSgiQkJveCIpKTsKCiAgICAgIHZhciB4c3RlcCA9IGRpY3QuZ2V0KCJYU3RlcCIpOwogICAgICB2YXIgeXN0ZXAgPSBkaWN0LmdldCgiWVN0ZXAiKTsKICAgICAgdmFyIHBhaW50VHlwZSA9IGRpY3QuZ2V0KCJQYWludFR5cGUiKTsKICAgICAgdmFyIHRpbGluZ1R5cGUgPSBkaWN0LmdldCgiVGlsaW5nVHlwZSIpOwoKICAgICAgaWYgKGJib3hbMl0gLSBiYm94WzBdID09PSAwIHx8IGJib3hbM10gLSBiYm94WzFdID09PSAwKSB7CiAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJJbnZhbGlkIGdldFRpbGluZ1BhdHRlcm5JUiAvQkJveCBhcnJheTogWyIuY29uY2F0KGJib3gsICJdLiIpKTsKICAgICAgfQoKICAgICAgcmV0dXJuIFsiVGlsaW5nUGF0dGVybiIsIGFyZ3MsIG9wZXJhdG9yTGlzdCwgbWF0cml4LCBiYm94LCB4c3RlcCwgeXN0ZXAsIHBhaW50VHlwZSwgdGlsaW5nVHlwZV07CiAgICB9CgogICAgLyoqKi99KSwgKAogIC8qIDIyNyAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCgogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICB2YWx1ZTogdHJ1ZQogICAgfSk7CiAgICBleHBvcnRzLmJpZGkgPSBiaWRpOwoKICAgIHZhciBfdXRpbCA9IF9fd19wZGZqc19yZXF1aXJlX18oNSk7CgogICAgdmFyIGJhc2VUeXBlcyA9IFsiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiUyIsICJCIiwgIlMiLCAiV1MiLCAiQiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCIiwgIkIiLCAiQiIsICJTIiwgIldTIiwgIk9OIiwgIk9OIiwgIkVUIiwgIkVUIiwgIkVUIiwgIk9OIiwgIk9OIiwgIk9OIiwgIk9OIiwgIk9OIiwgIkVTIiwgIkNTIiwgIkVTIiwgIkNTIiwgIkNTIiwgIkVOIiwgIkVOIiwgIkVOIiwgIkVOIiwgIkVOIiwgIkVOIiwgIkVOIiwgIkVOIiwgIkVOIiwgIkVOIiwgIkNTIiwgIk9OIiwgIk9OIiwgIk9OIiwgIk9OIiwgIk9OIiwgIk9OIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJPTiIsICJPTiIsICJPTiIsICJPTiIsICJPTiIsICJPTiIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiT04iLCAiT04iLCAiT04iLCAiT04iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJDUyIsICJPTiIsICJFVCIsICJFVCIsICJFVCIsICJFVCIsICJPTiIsICJPTiIsICJPTiIsICJPTiIsICJMIiwgIk9OIiwgIk9OIiwgIkJOIiwgIk9OIiwgIk9OIiwgIkVUIiwgIkVUIiwgIkVOIiwgIkVOIiwgIk9OIiwgIkwiLCAiT04iLCAiT04iLCAiT04iLCAiRU4iLCAiTCIsICJPTiIsICJPTiIsICJPTiIsICJPTiIsICJPTiIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiT04iLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJPTiIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiXTsKICAgIHZhciBhcmFiaWNUeXBlcyA9IFsiQU4iLCAiQU4iLCAiQU4iLCAiQU4iLCAiQU4iLCAiQU4iLCAiT04iLCAiT04iLCAiQUwiLCAiRVQiLCAiRVQiLCAiQUwiLCAiQ1MiLCAiQUwiLCAiT04iLCAiT04iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJBTCIsICJBTCIsICIiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiQU4iLCAiQU4iLCAiQU4iLCAiQU4iLCAiQU4iLCAiQU4iLCAiQU4iLCAiQU4iLCAiQU4iLCAiQU4iLCAiRVQiLCAiQU4iLCAiQU4iLCAiQUwiLCAiQUwiLCAiQUwiLCAiTlNNIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJBTiIsICJPTiIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJBTCIsICJBTCIsICJOU00iLCAiTlNNIiwgIk9OIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJBTCIsICJBTCIsICJFTiIsICJFTiIsICJFTiIsICJFTiIsICJFTiIsICJFTiIsICJFTiIsICJFTiIsICJFTiIsICJFTiIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCJdOwoKICAgIGZ1bmN0aW9uIGlzT2RkKGkpIHsKICAgICAgcmV0dXJuIChpICYgMSkgIT09IDA7CiAgICB9CgogICAgZnVuY3Rpb24gaXNFdmVuKGkpIHsKICAgICAgcmV0dXJuIChpICYgMSkgPT09IDA7CiAgICB9CgogICAgZnVuY3Rpb24gZmluZFVuZXF1YWwoYXJyLCBzdGFydCwgdmFsdWUpIHsKICAgICAgZm9yICh2YXIgaiA9IHN0YXJ0LCBqaiA9IGFyci5sZW5ndGg7IGogPCBqajsgKytqKSB7CiAgICAgICAgaWYgKGFycltqXSAhPT0gdmFsdWUpIHsKICAgICAgICAgIHJldHVybiBqOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIGo7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0VmFsdWVzKGFyciwgc3RhcnQsIGVuZCwgdmFsdWUpIHsKICAgICAgZm9yICh2YXIgaiA9IHN0YXJ0OyBqIDwgZW5kOyArK2opIHsKICAgICAgICBhcnJbal0gPSB2YWx1ZTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHJldmVyc2VWYWx1ZXMoYXJyLCBzdGFydCwgZW5kKSB7CiAgICAgIGZvciAodmFyIGkgPSBzdGFydCwgaiA9IGVuZCAtIDE7IGkgPCBqOyArK2ksIC0taikgewogICAgICAgIHZhciB0ZW1wID0gYXJyW2ldOwogICAgICAgIGFycltpXSA9IGFycltqXTsKICAgICAgICBhcnJbal0gPSB0ZW1wOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gY3JlYXRlQmlkaVRleHQoc3RyLCBpc0xUUikgewogICAgICB2YXIgdmVydGljYWwgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IGZhbHNlOwogICAgICB2YXIgZGlyID0gImx0ciI7CgogICAgICBpZiAodmVydGljYWwpIHsKICAgICAgICBkaXIgPSAidHRiIjsKICAgICAgfSBlbHNlIGlmICghaXNMVFIpIHsKICAgICAgICBkaXIgPSAicnRsIjsKICAgICAgfQoKICAgICAgcmV0dXJuIHsKICAgICAgICBzdHI6IHN0ciwKICAgICAgICBkaXI6IGRpcgogICAgICB9OwogICAgfQoKICAgIHZhciBjaGFycyA9IFtdOwogICAgdmFyIHR5cGVzID0gW107CgogICAgZnVuY3Rpb24gYmlkaShzdHIsIHN0YXJ0TGV2ZWwsIHZlcnRpY2FsKSB7CiAgICAgIHZhciBpc0xUUiA9IHRydWU7CiAgICAgIHZhciBzdHJMZW5ndGggPSBzdHIubGVuZ3RoOwoKICAgICAgaWYgKHN0ckxlbmd0aCA9PT0gMCB8fCB2ZXJ0aWNhbCkgewogICAgICAgIHJldHVybiBjcmVhdGVCaWRpVGV4dChzdHIsIGlzTFRSLCB2ZXJ0aWNhbCk7CiAgICAgIH0KCiAgICAgIGNoYXJzLmxlbmd0aCA9IHN0ckxlbmd0aDsKICAgICAgdHlwZXMubGVuZ3RoID0gc3RyTGVuZ3RoOwogICAgICB2YXIgbnVtQmlkaSA9IDA7CiAgICAgIHZhciBpLCBpaTsKCiAgICAgIGZvciAoaSA9IDA7IGkgPCBzdHJMZW5ndGg7ICsraSkgewogICAgICAgIGNoYXJzW2ldID0gc3RyLmNoYXJBdChpKTsKICAgICAgICB2YXIgY2hhckNvZGUgPSBzdHIuY2hhckNvZGVBdChpKTsKICAgICAgICB2YXIgY2hhclR5cGUgPSAiTCI7CgogICAgICAgIGlmIChjaGFyQ29kZSA8PSAweDAwZmYpIHsKICAgICAgICAgIGNoYXJUeXBlID0gYmFzZVR5cGVzW2NoYXJDb2RlXTsKICAgICAgICB9IGVsc2UgaWYgKDB4MDU5MCA8PSBjaGFyQ29kZSAmJiBjaGFyQ29kZSA8PSAweDA1ZjQpIHsKICAgICAgICAgIGNoYXJUeXBlID0gIlIiOwogICAgICAgIH0gZWxzZSBpZiAoMHgwNjAwIDw9IGNoYXJDb2RlICYmIGNoYXJDb2RlIDw9IDB4MDZmZikgewogICAgICAgICAgY2hhclR5cGUgPSBhcmFiaWNUeXBlc1tjaGFyQ29kZSAmIDB4ZmZdOwoKICAgICAgICAgIGlmICghY2hhclR5cGUpIHsKICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJCaWRpOiBpbnZhbGlkIFVuaWNvZGUgY2hhcmFjdGVyICIgKyBjaGFyQ29kZS50b1N0cmluZygxNikpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoMHgwNzAwIDw9IGNoYXJDb2RlICYmIGNoYXJDb2RlIDw9IDB4MDhhYykgewogICAgICAgICAgY2hhclR5cGUgPSAiQUwiOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNoYXJUeXBlID09PSAiUiIgfHwgY2hhclR5cGUgPT09ICJBTCIgfHwgY2hhclR5cGUgPT09ICJBTiIpIHsKICAgICAgICAgIG51bUJpZGkrKzsKICAgICAgICB9CgogICAgICAgIHR5cGVzW2ldID0gY2hhclR5cGU7CiAgICAgIH0KCiAgICAgIGlmIChudW1CaWRpID09PSAwKSB7CiAgICAgICAgaXNMVFIgPSB0cnVlOwogICAgICAgIHJldHVybiBjcmVhdGVCaWRpVGV4dChzdHIsIGlzTFRSKTsKICAgICAgfQoKICAgICAgaWYgKHN0YXJ0TGV2ZWwgPT09IC0xKSB7CiAgICAgICAgaWYgKG51bUJpZGkgLyBzdHJMZW5ndGggPCAwLjMpIHsKICAgICAgICAgIGlzTFRSID0gdHJ1ZTsKICAgICAgICAgIHN0YXJ0TGV2ZWwgPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpc0xUUiA9IGZhbHNlOwogICAgICAgICAgc3RhcnRMZXZlbCA9IDE7CiAgICAgICAgfQogICAgICB9CgogICAgICB2YXIgbGV2ZWxzID0gW107CgogICAgICBmb3IgKGkgPSAwOyBpIDwgc3RyTGVuZ3RoOyArK2kpIHsKICAgICAgICBsZXZlbHNbaV0gPSBzdGFydExldmVsOwogICAgICB9CgogICAgICB2YXIgZSA9IGlzT2RkKHN0YXJ0TGV2ZWwpID8gIlIiIDogIkwiOwogICAgICB2YXIgc29yID0gZTsKICAgICAgdmFyIGVvciA9IHNvcjsKICAgICAgdmFyIGxhc3RUeXBlID0gc29yOwoKICAgICAgZm9yIChpID0gMDsgaSA8IHN0ckxlbmd0aDsgKytpKSB7CiAgICAgICAgaWYgKHR5cGVzW2ldID09PSAiTlNNIikgewogICAgICAgICAgdHlwZXNbaV0gPSBsYXN0VHlwZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbGFzdFR5cGUgPSB0eXBlc1tpXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGxhc3RUeXBlID0gc29yOwogICAgICB2YXIgdDsKCiAgICAgIGZvciAoaSA9IDA7IGkgPCBzdHJMZW5ndGg7ICsraSkgewogICAgICAgIHQgPSB0eXBlc1tpXTsKCiAgICAgICAgaWYgKHQgPT09ICJFTiIpIHsKICAgICAgICAgIHR5cGVzW2ldID0gbGFzdFR5cGUgPT09ICJBTCIgPyAiQU4iIDogIkVOIjsKICAgICAgICB9IGVsc2UgaWYgKHQgPT09ICJSIiB8fCB0ID09PSAiTCIgfHwgdCA9PT0gIkFMIikgewogICAgICAgICAgbGFzdFR5cGUgPSB0OwogICAgICAgIH0KICAgICAgfQoKICAgICAgZm9yIChpID0gMDsgaSA8IHN0ckxlbmd0aDsgKytpKSB7CiAgICAgICAgdCA9IHR5cGVzW2ldOwoKICAgICAgICBpZiAodCA9PT0gIkFMIikgewogICAgICAgICAgdHlwZXNbaV0gPSAiUiI7CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKGkgPSAxOyBpIDwgc3RyTGVuZ3RoIC0gMTsgKytpKSB7CiAgICAgICAgaWYgKHR5cGVzW2ldID09PSAiRVMiICYmIHR5cGVzW2kgLSAxXSA9PT0gIkVOIiAmJiB0eXBlc1tpICsgMV0gPT09ICJFTiIpIHsKICAgICAgICAgIHR5cGVzW2ldID0gIkVOIjsKICAgICAgICB9CgogICAgICAgIGlmICh0eXBlc1tpXSA9PT0gIkNTIiAmJiAodHlwZXNbaSAtIDFdID09PSAiRU4iIHx8IHR5cGVzW2kgLSAxXSA9PT0gIkFOIikgJiYgdHlwZXNbaSArIDFdID09PSB0eXBlc1tpIC0gMV0pIHsKICAgICAgICAgIHR5cGVzW2ldID0gdHlwZXNbaSAtIDFdOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZm9yIChpID0gMDsgaSA8IHN0ckxlbmd0aDsgKytpKSB7CiAgICAgICAgaWYgKHR5cGVzW2ldID09PSAiRU4iKSB7CiAgICAgICAgICB2YXIgajsKCiAgICAgICAgICBmb3IgKGogPSBpIC0gMTsgaiA+PSAwOyAtLWopIHsKICAgICAgICAgICAgaWYgKHR5cGVzW2pdICE9PSAiRVQiKSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHR5cGVzW2pdID0gIkVOIjsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3IgKGogPSBpICsgMTsgaiA8IHN0ckxlbmd0aDsgKytqKSB7CiAgICAgICAgICAgIGlmICh0eXBlc1tqXSAhPT0gIkVUIikgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0eXBlc1tqXSA9ICJFTiI7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKGkgPSAwOyBpIDwgc3RyTGVuZ3RoOyArK2kpIHsKICAgICAgICB0ID0gdHlwZXNbaV07CgogICAgICAgIGlmICh0ID09PSAiV1MiIHx8IHQgPT09ICJFUyIgfHwgdCA9PT0gIkVUIiB8fCB0ID09PSAiQ1MiKSB7CiAgICAgICAgICB0eXBlc1tpXSA9ICJPTiI7CiAgICAgICAgfQogICAgICB9CgogICAgICBsYXN0VHlwZSA9IHNvcjsKCiAgICAgIGZvciAoaSA9IDA7IGkgPCBzdHJMZW5ndGg7ICsraSkgewogICAgICAgIHQgPSB0eXBlc1tpXTsKCiAgICAgICAgaWYgKHQgPT09ICJFTiIpIHsKICAgICAgICAgIHR5cGVzW2ldID0gbGFzdFR5cGUgPT09ICJMIiA/ICJMIiA6ICJFTiI7CiAgICAgICAgfSBlbHNlIGlmICh0ID09PSAiUiIgfHwgdCA9PT0gIkwiKSB7CiAgICAgICAgICBsYXN0VHlwZSA9IHQ7CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKGkgPSAwOyBpIDwgc3RyTGVuZ3RoOyArK2kpIHsKICAgICAgICBpZiAodHlwZXNbaV0gPT09ICJPTiIpIHsKICAgICAgICAgIHZhciBlbmQgPSBmaW5kVW5lcXVhbCh0eXBlcywgaSArIDEsICJPTiIpOwogICAgICAgICAgdmFyIGJlZm9yZSA9IHNvcjsKCiAgICAgICAgICBpZiAoaSA+IDApIHsKICAgICAgICAgICAgYmVmb3JlID0gdHlwZXNbaSAtIDFdOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBhZnRlciA9IGVvcjsKCiAgICAgICAgICBpZiAoZW5kICsgMSA8IHN0ckxlbmd0aCkgewogICAgICAgICAgICBhZnRlciA9IHR5cGVzW2VuZCArIDFdOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChiZWZvcmUgIT09ICJMIikgewogICAgICAgICAgICBiZWZvcmUgPSAiUiI7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGFmdGVyICE9PSAiTCIpIHsKICAgICAgICAgICAgYWZ0ZXIgPSAiUiI7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGJlZm9yZSA9PT0gYWZ0ZXIpIHsKICAgICAgICAgICAgc2V0VmFsdWVzKHR5cGVzLCBpLCBlbmQsIGJlZm9yZSk7CiAgICAgICAgICB9CgogICAgICAgICAgaSA9IGVuZCAtIDE7CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKGkgPSAwOyBpIDwgc3RyTGVuZ3RoOyArK2kpIHsKICAgICAgICBpZiAodHlwZXNbaV0gPT09ICJPTiIpIHsKICAgICAgICAgIHR5cGVzW2ldID0gZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZvciAoaSA9IDA7IGkgPCBzdHJMZW5ndGg7ICsraSkgewogICAgICAgIHQgPSB0eXBlc1tpXTsKCiAgICAgICAgaWYgKGlzRXZlbihsZXZlbHNbaV0pKSB7CiAgICAgICAgICBpZiAodCA9PT0gIlIiKSB7CiAgICAgICAgICAgIGxldmVsc1tpXSArPSAxOwogICAgICAgICAgfSBlbHNlIGlmICh0ID09PSAiQU4iIHx8IHQgPT09ICJFTiIpIHsKICAgICAgICAgICAgbGV2ZWxzW2ldICs9IDI7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmICh0ID09PSAiTCIgfHwgdCA9PT0gIkFOIiB8fCB0ID09PSAiRU4iKSB7CiAgICAgICAgICAgIGxldmVsc1tpXSArPSAxOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdmFyIGhpZ2hlc3RMZXZlbCA9IC0xOwogICAgICB2YXIgbG93ZXN0T2RkTGV2ZWwgPSA5OTsKICAgICAgdmFyIGxldmVsOwoKICAgICAgZm9yIChpID0gMCwgaWkgPSBsZXZlbHMubGVuZ3RoOyBpIDwgaWk7ICsraSkgewogICAgICAgIGxldmVsID0gbGV2ZWxzW2ldOwoKICAgICAgICBpZiAoaGlnaGVzdExldmVsIDwgbGV2ZWwpIHsKICAgICAgICAgIGhpZ2hlc3RMZXZlbCA9IGxldmVsOwogICAgICAgIH0KCiAgICAgICAgaWYgKGxvd2VzdE9kZExldmVsID4gbGV2ZWwgJiYgaXNPZGQobGV2ZWwpKSB7CiAgICAgICAgICBsb3dlc3RPZGRMZXZlbCA9IGxldmVsOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZm9yIChsZXZlbCA9IGhpZ2hlc3RMZXZlbDsgbGV2ZWwgPj0gbG93ZXN0T2RkTGV2ZWw7IC0tbGV2ZWwpIHsKICAgICAgICB2YXIgc3RhcnQgPSAtMTsKCiAgICAgICAgZm9yIChpID0gMCwgaWkgPSBsZXZlbHMubGVuZ3RoOyBpIDwgaWk7ICsraSkgewogICAgICAgICAgaWYgKGxldmVsc1tpXSA8IGxldmVsKSB7CiAgICAgICAgICAgIGlmIChzdGFydCA+PSAwKSB7CiAgICAgICAgICAgICAgcmV2ZXJzZVZhbHVlcyhjaGFycywgc3RhcnQsIGkpOwogICAgICAgICAgICAgIHN0YXJ0ID0gLTE7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAoc3RhcnQgPCAwKSB7CiAgICAgICAgICAgIHN0YXJ0ID0gaTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChzdGFydCA+PSAwKSB7CiAgICAgICAgICByZXZlcnNlVmFsdWVzKGNoYXJzLCBzdGFydCwgbGV2ZWxzLmxlbmd0aCk7CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKGkgPSAwLCBpaSA9IGNoYXJzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHsKICAgICAgICB2YXIgY2ggPSBjaGFyc1tpXTsKCiAgICAgICAgaWYgKGNoID09PSAiPCIgfHwgY2ggPT09ICI+IikgewogICAgICAgICAgY2hhcnNbaV0gPSAiIjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBjcmVhdGVCaWRpVGV4dChjaGFycy5qb2luKCIiKSwgaXNMVFIpOwogICAgfQoKICAgIC8qKiovfSksICgKICAvKiAyMjggKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgoKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgICAgdmFsdWU6IHRydWUKICAgIH0pOwogICAgZXhwb3J0cy5nZXRNZXRyaWNzID0gdm9pZCAwOwoKICAgIHZhciBfY29yZV91dGlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTk3KTsKCiAgICB2YXIgZ2V0TWV0cmljcyA9ICgwLCBfY29yZV91dGlscy5nZXRMb29rdXBUYWJsZUZhY3RvcnkpKGZ1bmN0aW9uICh0KSB7CiAgICAgIHRbIkNvdXJpZXIiXSA9IDYwMDsKICAgICAgdFsiQ291cmllci1Cb2xkIl0gPSA2MDA7CiAgICAgIHRbIkNvdXJpZXItQm9sZE9ibGlxdWUiXSA9IDYwMDsKICAgICAgdFsiQ291cmllci1PYmxpcXVlIl0gPSA2MDA7CiAgICAgIHRbIkhlbHZldGljYSJdID0gKDAsIF9jb3JlX3V0aWxzLmdldExvb2t1cFRhYmxlRmFjdG9yeSkoZnVuY3Rpb24gKHQpIHsKICAgICAgICB0WyJzcGFjZSJdID0gMjc4OwogICAgICAgIHRbImV4Y2xhbSJdID0gMjc4OwogICAgICAgIHRbInF1b3RlZGJsIl0gPSAzNTU7CiAgICAgICAgdFsibnVtYmVyc2lnbiJdID0gNTU2OwogICAgICAgIHRbImRvbGxhciJdID0gNTU2OwogICAgICAgIHRbInBlcmNlbnQiXSA9IDg4OTsKICAgICAgICB0WyJhbXBlcnNhbmQiXSA9IDY2NzsKICAgICAgICB0WyJxdW90ZXJpZ2h0Il0gPSAyMjI7CiAgICAgICAgdFsicGFyZW5sZWZ0Il0gPSAzMzM7CiAgICAgICAgdFsicGFyZW5yaWdodCJdID0gMzMzOwogICAgICAgIHRbImFzdGVyaXNrIl0gPSAzODk7CiAgICAgICAgdFsicGx1cyJdID0gNTg0OwogICAgICAgIHRbImNvbW1hIl0gPSAyNzg7CiAgICAgICAgdFsiaHlwaGVuIl0gPSAzMzM7CiAgICAgICAgdFsicGVyaW9kIl0gPSAyNzg7CiAgICAgICAgdFsic2xhc2giXSA9IDI3ODsKICAgICAgICB0WyJ6ZXJvIl0gPSA1NTY7CiAgICAgICAgdFsib25lIl0gPSA1NTY7CiAgICAgICAgdFsidHdvIl0gPSA1NTY7CiAgICAgICAgdFsidGhyZWUiXSA9IDU1NjsKICAgICAgICB0WyJmb3VyIl0gPSA1NTY7CiAgICAgICAgdFsiZml2ZSJdID0gNTU2OwogICAgICAgIHRbInNpeCJdID0gNTU2OwogICAgICAgIHRbInNldmVuIl0gPSA1NTY7CiAgICAgICAgdFsiZWlnaHQiXSA9IDU1NjsKICAgICAgICB0WyJuaW5lIl0gPSA1NTY7CiAgICAgICAgdFsiY29sb24iXSA9IDI3ODsKICAgICAgICB0WyJzZW1pY29sb24iXSA9IDI3ODsKICAgICAgICB0WyJsZXNzIl0gPSA1ODQ7CiAgICAgICAgdFsiZXF1YWwiXSA9IDU4NDsKICAgICAgICB0WyJncmVhdGVyIl0gPSA1ODQ7CiAgICAgICAgdFsicXVlc3Rpb24iXSA9IDU1NjsKICAgICAgICB0WyJhdCJdID0gMTAxNTsKICAgICAgICB0WyJBIl0gPSA2Njc7CiAgICAgICAgdFsiQiJdID0gNjY3OwogICAgICAgIHRbIkMiXSA9IDcyMjsKICAgICAgICB0WyJEIl0gPSA3MjI7CiAgICAgICAgdFsiRSJdID0gNjY3OwogICAgICAgIHRbIkYiXSA9IDYxMTsKICAgICAgICB0WyJHIl0gPSA3Nzg7CiAgICAgICAgdFsiSCJdID0gNzIyOwogICAgICAgIHRbIkkiXSA9IDI3ODsKICAgICAgICB0WyJKIl0gPSA1MDA7CiAgICAgICAgdFsiSyJdID0gNjY3OwogICAgICAgIHRbIkwiXSA9IDU1NjsKICAgICAgICB0WyJNIl0gPSA4MzM7CiAgICAgICAgdFsiTiJdID0gNzIyOwogICAgICAgIHRbIk8iXSA9IDc3ODsKICAgICAgICB0WyJQIl0gPSA2Njc7CiAgICAgICAgdFsiUSJdID0gNzc4OwogICAgICAgIHRbIlIiXSA9IDcyMjsKICAgICAgICB0WyJTIl0gPSA2Njc7CiAgICAgICAgdFsiVCJdID0gNjExOwogICAgICAgIHRbIlUiXSA9IDcyMjsKICAgICAgICB0WyJWIl0gPSA2Njc7CiAgICAgICAgdFsiVyJdID0gOTQ0OwogICAgICAgIHRbIlgiXSA9IDY2NzsKICAgICAgICB0WyJZIl0gPSA2Njc7CiAgICAgICAgdFsiWiJdID0gNjExOwogICAgICAgIHRbImJyYWNrZXRsZWZ0Il0gPSAyNzg7CiAgICAgICAgdFsiYmFja3NsYXNoIl0gPSAyNzg7CiAgICAgICAgdFsiYnJhY2tldHJpZ2h0Il0gPSAyNzg7CiAgICAgICAgdFsiYXNjaWljaXJjdW0iXSA9IDQ2OTsKICAgICAgICB0WyJ1bmRlcnNjb3JlIl0gPSA1NTY7CiAgICAgICAgdFsicXVvdGVsZWZ0Il0gPSAyMjI7CiAgICAgICAgdFsiYSJdID0gNTU2OwogICAgICAgIHRbImIiXSA9IDU1NjsKICAgICAgICB0WyJjIl0gPSA1MDA7CiAgICAgICAgdFsiZCJdID0gNTU2OwogICAgICAgIHRbImUiXSA9IDU1NjsKICAgICAgICB0WyJmIl0gPSAyNzg7CiAgICAgICAgdFsiZyJdID0gNTU2OwogICAgICAgIHRbImgiXSA9IDU1NjsKICAgICAgICB0WyJpIl0gPSAyMjI7CiAgICAgICAgdFsiaiJdID0gMjIyOwogICAgICAgIHRbImsiXSA9IDUwMDsKICAgICAgICB0WyJsIl0gPSAyMjI7CiAgICAgICAgdFsibSJdID0gODMzOwogICAgICAgIHRbIm4iXSA9IDU1NjsKICAgICAgICB0WyJvIl0gPSA1NTY7CiAgICAgICAgdFsicCJdID0gNTU2OwogICAgICAgIHRbInEiXSA9IDU1NjsKICAgICAgICB0WyJyIl0gPSAzMzM7CiAgICAgICAgdFsicyJdID0gNTAwOwogICAgICAgIHRbInQiXSA9IDI3ODsKICAgICAgICB0WyJ1Il0gPSA1NTY7CiAgICAgICAgdFsidiJdID0gNTAwOwogICAgICAgIHRbInciXSA9IDcyMjsKICAgICAgICB0WyJ4Il0gPSA1MDA7CiAgICAgICAgdFsieSJdID0gNTAwOwogICAgICAgIHRbInoiXSA9IDUwMDsKICAgICAgICB0WyJicmFjZWxlZnQiXSA9IDMzNDsKICAgICAgICB0WyJiYXIiXSA9IDI2MDsKICAgICAgICB0WyJicmFjZXJpZ2h0Il0gPSAzMzQ7CiAgICAgICAgdFsiYXNjaWl0aWxkZSJdID0gNTg0OwogICAgICAgIHRbImV4Y2xhbWRvd24iXSA9IDMzMzsKICAgICAgICB0WyJjZW50Il0gPSA1NTY7CiAgICAgICAgdFsic3RlcmxpbmciXSA9IDU1NjsKICAgICAgICB0WyJmcmFjdGlvbiJdID0gMTY3OwogICAgICAgIHRbInllbiJdID0gNTU2OwogICAgICAgIHRbImZsb3JpbiJdID0gNTU2OwogICAgICAgIHRbInNlY3Rpb24iXSA9IDU1NjsKICAgICAgICB0WyJjdXJyZW5jeSJdID0gNTU2OwogICAgICAgIHRbInF1b3Rlc2luZ2xlIl0gPSAxOTE7CiAgICAgICAgdFsicXVvdGVkYmxsZWZ0Il0gPSAzMzM7CiAgICAgICAgdFsiZ3VpbGxlbW90bGVmdCJdID0gNTU2OwogICAgICAgIHRbImd1aWxzaW5nbGxlZnQiXSA9IDMzMzsKICAgICAgICB0WyJndWlsc2luZ2xyaWdodCJdID0gMzMzOwogICAgICAgIHRbImZpIl0gPSA1MDA7CiAgICAgICAgdFsiZmwiXSA9IDUwMDsKICAgICAgICB0WyJlbmRhc2giXSA9IDU1NjsKICAgICAgICB0WyJkYWdnZXIiXSA9IDU1NjsKICAgICAgICB0WyJkYWdnZXJkYmwiXSA9IDU1NjsKICAgICAgICB0WyJwZXJpb2RjZW50ZXJlZCJdID0gMjc4OwogICAgICAgIHRbInBhcmFncmFwaCJdID0gNTM3OwogICAgICAgIHRbImJ1bGxldCJdID0gMzUwOwogICAgICAgIHRbInF1b3Rlc2luZ2xiYXNlIl0gPSAyMjI7CiAgICAgICAgdFsicXVvdGVkYmxiYXNlIl0gPSAzMzM7CiAgICAgICAgdFsicXVvdGVkYmxyaWdodCJdID0gMzMzOwogICAgICAgIHRbImd1aWxsZW1vdHJpZ2h0Il0gPSA1NTY7CiAgICAgICAgdFsiZWxsaXBzaXMiXSA9IDEwMDA7CiAgICAgICAgdFsicGVydGhvdXNhbmQiXSA9IDEwMDA7CiAgICAgICAgdFsicXVlc3Rpb25kb3duIl0gPSA2MTE7CiAgICAgICAgdFsiZ3JhdmUiXSA9IDMzMzsKICAgICAgICB0WyJhY3V0ZSJdID0gMzMzOwogICAgICAgIHRbImNpcmN1bWZsZXgiXSA9IDMzMzsKICAgICAgICB0WyJ0aWxkZSJdID0gMzMzOwogICAgICAgIHRbIm1hY3JvbiJdID0gMzMzOwogICAgICAgIHRbImJyZXZlIl0gPSAzMzM7CiAgICAgICAgdFsiZG90YWNjZW50Il0gPSAzMzM7CiAgICAgICAgdFsiZGllcmVzaXMiXSA9IDMzMzsKICAgICAgICB0WyJyaW5nIl0gPSAzMzM7CiAgICAgICAgdFsiY2VkaWxsYSJdID0gMzMzOwogICAgICAgIHRbImh1bmdhcnVtbGF1dCJdID0gMzMzOwogICAgICAgIHRbIm9nb25layJdID0gMzMzOwogICAgICAgIHRbImNhcm9uIl0gPSAzMzM7CiAgICAgICAgdFsiZW1kYXNoIl0gPSAxMDAwOwogICAgICAgIHRbIkFFIl0gPSAxMDAwOwogICAgICAgIHRbIm9yZGZlbWluaW5lIl0gPSAzNzA7CiAgICAgICAgdFsiTHNsYXNoIl0gPSA1NTY7CiAgICAgICAgdFsiT3NsYXNoIl0gPSA3Nzg7CiAgICAgICAgdFsiT0UiXSA9IDEwMDA7CiAgICAgICAgdFsib3JkbWFzY3VsaW5lIl0gPSAzNjU7CiAgICAgICAgdFsiYWUiXSA9IDg4OTsKICAgICAgICB0WyJkb3RsZXNzaSJdID0gMjc4OwogICAgICAgIHRbImxzbGFzaCJdID0gMjIyOwogICAgICAgIHRbIm9zbGFzaCJdID0gNjExOwogICAgICAgIHRbIm9lIl0gPSA5NDQ7CiAgICAgICAgdFsiZ2VybWFuZGJscyJdID0gNjExOwogICAgICAgIHRbIklkaWVyZXNpcyJdID0gMjc4OwogICAgICAgIHRbImVhY3V0ZSJdID0gNTU2OwogICAgICAgIHRbImFicmV2ZSJdID0gNTU2OwogICAgICAgIHRbInVodW5nYXJ1bWxhdXQiXSA9IDU1NjsKICAgICAgICB0WyJlY2Fyb24iXSA9IDU1NjsKICAgICAgICB0WyJZZGllcmVzaXMiXSA9IDY2NzsKICAgICAgICB0WyJkaXZpZGUiXSA9IDU4NDsKICAgICAgICB0WyJZYWN1dGUiXSA9IDY2NzsKICAgICAgICB0WyJBY2lyY3VtZmxleCJdID0gNjY3OwogICAgICAgIHRbImFhY3V0ZSJdID0gNTU2OwogICAgICAgIHRbIlVjaXJjdW1mbGV4Il0gPSA3MjI7CiAgICAgICAgdFsieWFjdXRlIl0gPSA1MDA7CiAgICAgICAgdFsic2NvbW1hYWNjZW50Il0gPSA1MDA7CiAgICAgICAgdFsiZWNpcmN1bWZsZXgiXSA9IDU1NjsKICAgICAgICB0WyJVcmluZyJdID0gNzIyOwogICAgICAgIHRbIlVkaWVyZXNpcyJdID0gNzIyOwogICAgICAgIHRbImFvZ29uZWsiXSA9IDU1NjsKICAgICAgICB0WyJVYWN1dGUiXSA9IDcyMjsKICAgICAgICB0WyJ1b2dvbmVrIl0gPSA1NTY7CiAgICAgICAgdFsiRWRpZXJlc2lzIl0gPSA2Njc7CiAgICAgICAgdFsiRGNyb2F0Il0gPSA3MjI7CiAgICAgICAgdFsiY29tbWFhY2NlbnQiXSA9IDI1MDsKICAgICAgICB0WyJjb3B5cmlnaHQiXSA9IDczNzsKICAgICAgICB0WyJFbWFjcm9uIl0gPSA2Njc7CiAgICAgICAgdFsiY2Nhcm9uIl0gPSA1MDA7CiAgICAgICAgdFsiYXJpbmciXSA9IDU1NjsKICAgICAgICB0WyJOY29tbWFhY2NlbnQiXSA9IDcyMjsKICAgICAgICB0WyJsYWN1dGUiXSA9IDIyMjsKICAgICAgICB0WyJhZ3JhdmUiXSA9IDU1NjsKICAgICAgICB0WyJUY29tbWFhY2NlbnQiXSA9IDYxMTsKICAgICAgICB0WyJDYWN1dGUiXSA9IDcyMjsKICAgICAgICB0WyJhdGlsZGUiXSA9IDU1NjsKICAgICAgICB0WyJFZG90YWNjZW50Il0gPSA2Njc7CiAgICAgICAgdFsic2Nhcm9uIl0gPSA1MDA7CiAgICAgICAgdFsic2NlZGlsbGEiXSA9IDUwMDsKICAgICAgICB0WyJpYWN1dGUiXSA9IDI3ODsKICAgICAgICB0WyJsb3plbmdlIl0gPSA0NzE7CiAgICAgICAgdFsiUmNhcm9uIl0gPSA3MjI7CiAgICAgICAgdFsiR2NvbW1hYWNjZW50Il0gPSA3Nzg7CiAgICAgICAgdFsidWNpcmN1bWZsZXgiXSA9IDU1NjsKICAgICAgICB0WyJhY2lyY3VtZmxleCJdID0gNTU2OwogICAgICAgIHRbIkFtYWNyb24iXSA9IDY2NzsKICAgICAgICB0WyJyY2Fyb24iXSA9IDMzMzsKICAgICAgICB0WyJjY2VkaWxsYSJdID0gNTAwOwogICAgICAgIHRbIlpkb3RhY2NlbnQiXSA9IDYxMTsKICAgICAgICB0WyJUaG9ybiJdID0gNjY3OwogICAgICAgIHRbIk9tYWNyb24iXSA9IDc3ODsKICAgICAgICB0WyJSYWN1dGUiXSA9IDcyMjsKICAgICAgICB0WyJTYWN1dGUiXSA9IDY2NzsKICAgICAgICB0WyJkY2Fyb24iXSA9IDY0MzsKICAgICAgICB0WyJVbWFjcm9uIl0gPSA3MjI7CiAgICAgICAgdFsidXJpbmciXSA9IDU1NjsKICAgICAgICB0WyJ0aHJlZXN1cGVyaW9yIl0gPSAzMzM7CiAgICAgICAgdFsiT2dyYXZlIl0gPSA3Nzg7CiAgICAgICAgdFsiQWdyYXZlIl0gPSA2Njc7CiAgICAgICAgdFsiQWJyZXZlIl0gPSA2Njc7CiAgICAgICAgdFsibXVsdGlwbHkiXSA9IDU4NDsKICAgICAgICB0WyJ1YWN1dGUiXSA9IDU1NjsKICAgICAgICB0WyJUY2Fyb24iXSA9IDYxMTsKICAgICAgICB0WyJwYXJ0aWFsZGlmZiJdID0gNDc2OwogICAgICAgIHRbInlkaWVyZXNpcyJdID0gNTAwOwogICAgICAgIHRbIk5hY3V0ZSJdID0gNzIyOwogICAgICAgIHRbImljaXJjdW1mbGV4Il0gPSAyNzg7CiAgICAgICAgdFsiRWNpcmN1bWZsZXgiXSA9IDY2NzsKICAgICAgICB0WyJhZGllcmVzaXMiXSA9IDU1NjsKICAgICAgICB0WyJlZGllcmVzaXMiXSA9IDU1NjsKICAgICAgICB0WyJjYWN1dGUiXSA9IDUwMDsKICAgICAgICB0WyJuYWN1dGUiXSA9IDU1NjsKICAgICAgICB0WyJ1bWFjcm9uIl0gPSA1NTY7CiAgICAgICAgdFsiTmNhcm9uIl0gPSA3MjI7CiAgICAgICAgdFsiSWFjdXRlIl0gPSAyNzg7CiAgICAgICAgdFsicGx1c21pbnVzIl0gPSA1ODQ7CiAgICAgICAgdFsiYnJva2VuYmFyIl0gPSAyNjA7CiAgICAgICAgdFsicmVnaXN0ZXJlZCJdID0gNzM3OwogICAgICAgIHRbIkdicmV2ZSJdID0gNzc4OwogICAgICAgIHRbIklkb3RhY2NlbnQiXSA9IDI3ODsKICAgICAgICB0WyJzdW1tYXRpb24iXSA9IDYwMDsKICAgICAgICB0WyJFZ3JhdmUiXSA9IDY2NzsKICAgICAgICB0WyJyYWN1dGUiXSA9IDMzMzsKICAgICAgICB0WyJvbWFjcm9uIl0gPSA1NTY7CiAgICAgICAgdFsiWmFjdXRlIl0gPSA2MTE7CiAgICAgICAgdFsiWmNhcm9uIl0gPSA2MTE7CiAgICAgICAgdFsiZ3JlYXRlcmVxdWFsIl0gPSA1NDk7CiAgICAgICAgdFsiRXRoIl0gPSA3MjI7CiAgICAgICAgdFsiQ2NlZGlsbGEiXSA9IDcyMjsKICAgICAgICB0WyJsY29tbWFhY2NlbnQiXSA9IDIyMjsKICAgICAgICB0WyJ0Y2Fyb24iXSA9IDMxNzsKICAgICAgICB0WyJlb2dvbmVrIl0gPSA1NTY7CiAgICAgICAgdFsiVW9nb25layJdID0gNzIyOwogICAgICAgIHRbIkFhY3V0ZSJdID0gNjY3OwogICAgICAgIHRbIkFkaWVyZXNpcyJdID0gNjY3OwogICAgICAgIHRbImVncmF2ZSJdID0gNTU2OwogICAgICAgIHRbInphY3V0ZSJdID0gNTAwOwogICAgICAgIHRbImlvZ29uZWsiXSA9IDIyMjsKICAgICAgICB0WyJPYWN1dGUiXSA9IDc3ODsKICAgICAgICB0WyJvYWN1dGUiXSA9IDU1NjsKICAgICAgICB0WyJhbWFjcm9uIl0gPSA1NTY7CiAgICAgICAgdFsic2FjdXRlIl0gPSA1MDA7CiAgICAgICAgdFsiaWRpZXJlc2lzIl0gPSAyNzg7CiAgICAgICAgdFsiT2NpcmN1bWZsZXgiXSA9IDc3ODsKICAgICAgICB0WyJVZ3JhdmUiXSA9IDcyMjsKICAgICAgICB0WyJEZWx0YSJdID0gNjEyOwogICAgICAgIHRbInRob3JuIl0gPSA1NTY7CiAgICAgICAgdFsidHdvc3VwZXJpb3IiXSA9IDMzMzsKICAgICAgICB0WyJPZGllcmVzaXMiXSA9IDc3ODsKICAgICAgICB0WyJtdSJdID0gNTU2OwogICAgICAgIHRbImlncmF2ZSJdID0gMjc4OwogICAgICAgIHRbIm9odW5nYXJ1bWxhdXQiXSA9IDU1NjsKICAgICAgICB0WyJFb2dvbmVrIl0gPSA2Njc7CiAgICAgICAgdFsiZGNyb2F0Il0gPSA1NTY7CiAgICAgICAgdFsidGhyZWVxdWFydGVycyJdID0gODM0OwogICAgICAgIHRbIlNjZWRpbGxhIl0gPSA2Njc7CiAgICAgICAgdFsibGNhcm9uIl0gPSAyOTk7CiAgICAgICAgdFsiS2NvbW1hYWNjZW50Il0gPSA2Njc7CiAgICAgICAgdFsiTGFjdXRlIl0gPSA1NTY7CiAgICAgICAgdFsidHJhZGVtYXJrIl0gPSAxMDAwOwogICAgICAgIHRbImVkb3RhY2NlbnQiXSA9IDU1NjsKICAgICAgICB0WyJJZ3JhdmUiXSA9IDI3ODsKICAgICAgICB0WyJJbWFjcm9uIl0gPSAyNzg7CiAgICAgICAgdFsiTGNhcm9uIl0gPSA1NTY7CiAgICAgICAgdFsib25laGFsZiJdID0gODM0OwogICAgICAgIHRbImxlc3NlcXVhbCJdID0gNTQ5OwogICAgICAgIHRbIm9jaXJjdW1mbGV4Il0gPSA1NTY7CiAgICAgICAgdFsibnRpbGRlIl0gPSA1NTY7CiAgICAgICAgdFsiVWh1bmdhcnVtbGF1dCJdID0gNzIyOwogICAgICAgIHRbIkVhY3V0ZSJdID0gNjY3OwogICAgICAgIHRbImVtYWNyb24iXSA9IDU1NjsKICAgICAgICB0WyJnYnJldmUiXSA9IDU1NjsKICAgICAgICB0WyJvbmVxdWFydGVyIl0gPSA4MzQ7CiAgICAgICAgdFsiU2Nhcm9uIl0gPSA2Njc7CiAgICAgICAgdFsiU2NvbW1hYWNjZW50Il0gPSA2Njc7CiAgICAgICAgdFsiT2h1bmdhcnVtbGF1dCJdID0gNzc4OwogICAgICAgIHRbImRlZ3JlZSJdID0gNDAwOwogICAgICAgIHRbIm9ncmF2ZSJdID0gNTU2OwogICAgICAgIHRbIkNjYXJvbiJdID0gNzIyOwogICAgICAgIHRbInVncmF2ZSJdID0gNTU2OwogICAgICAgIHRbInJhZGljYWwiXSA9IDQ1MzsKICAgICAgICB0WyJEY2Fyb24iXSA9IDcyMjsKICAgICAgICB0WyJyY29tbWFhY2NlbnQiXSA9IDMzMzsKICAgICAgICB0WyJOdGlsZGUiXSA9IDcyMjsKICAgICAgICB0WyJvdGlsZGUiXSA9IDU1NjsKICAgICAgICB0WyJSY29tbWFhY2NlbnQiXSA9IDcyMjsKICAgICAgICB0WyJMY29tbWFhY2NlbnQiXSA9IDU1NjsKICAgICAgICB0WyJBdGlsZGUiXSA9IDY2NzsKICAgICAgICB0WyJBb2dvbmVrIl0gPSA2Njc7CiAgICAgICAgdFsiQXJpbmciXSA9IDY2NzsKICAgICAgICB0WyJPdGlsZGUiXSA9IDc3ODsKICAgICAgICB0WyJ6ZG90YWNjZW50Il0gPSA1MDA7CiAgICAgICAgdFsiRWNhcm9uIl0gPSA2Njc7CiAgICAgICAgdFsiSW9nb25layJdID0gMjc4OwogICAgICAgIHRbImtjb21tYWFjY2VudCJdID0gNTAwOwogICAgICAgIHRbIm1pbnVzIl0gPSA1ODQ7CiAgICAgICAgdFsiSWNpcmN1bWZsZXgiXSA9IDI3ODsKICAgICAgICB0WyJuY2Fyb24iXSA9IDU1NjsKICAgICAgICB0WyJ0Y29tbWFhY2NlbnQiXSA9IDI3ODsKICAgICAgICB0WyJsb2dpY2Fsbm90Il0gPSA1ODQ7CiAgICAgICAgdFsib2RpZXJlc2lzIl0gPSA1NTY7CiAgICAgICAgdFsidWRpZXJlc2lzIl0gPSA1NTY7CiAgICAgICAgdFsibm90ZXF1YWwiXSA9IDU0OTsKICAgICAgICB0WyJnY29tbWFhY2NlbnQiXSA9IDU1NjsKICAgICAgICB0WyJldGgiXSA9IDU1NjsKICAgICAgICB0WyJ6Y2Fyb24iXSA9IDUwMDsKICAgICAgICB0WyJuY29tbWFhY2NlbnQiXSA9IDU1NjsKICAgICAgICB0WyJvbmVzdXBlcmlvciJdID0gMzMzOwogICAgICAgIHRbImltYWNyb24iXSA9IDI3ODsKICAgICAgICB0WyJFdXJvIl0gPSA1NTY7CiAgICAgIH0pOwogICAgICB0WyJIZWx2ZXRpY2EtQm9sZCJdID0gKDAsIF9jb3JlX3V0aWxzLmdldExvb2t1cFRhYmxlRmFjdG9yeSkoZnVuY3Rpb24gKHQpIHsKICAgICAgICB0WyJzcGFjZSJdID0gMjc4OwogICAgICAgIHRbImV4Y2xhbSJdID0gMzMzOwogICAgICAgIHRbInF1b3RlZGJsIl0gPSA0NzQ7CiAgICAgICAgdFsibnVtYmVyc2lnbiJdID0gNTU2OwogICAgICAgIHRbImRvbGxhciJdID0gNTU2OwogICAgICAgIHRbInBlcmNlbnQiXSA9IDg4OTsKICAgICAgICB0WyJhbXBlcnNhbmQiXSA9IDcyMjsKICAgICAgICB0WyJxdW90ZXJpZ2h0Il0gPSAyNzg7CiAgICAgICAgdFsicGFyZW5sZWZ0Il0gPSAzMzM7CiAgICAgICAgdFsicGFyZW5yaWdodCJdID0gMzMzOwogICAgICAgIHRbImFzdGVyaXNrIl0gPSAzODk7CiAgICAgICAgdFsicGx1cyJdID0gNTg0OwogICAgICAgIHRbImNvbW1hIl0gPSAyNzg7CiAgICAgICAgdFsiaHlwaGVuIl0gPSAzMzM7CiAgICAgICAgdFsicGVyaW9kIl0gPSAyNzg7CiAgICAgICAgdFsic2xhc2giXSA9IDI3ODsKICAgICAgICB0WyJ6ZXJvIl0gPSA1NTY7CiAgICAgICAgdFsib25lIl0gPSA1NTY7CiAgICAgICAgdFsidHdvIl0gPSA1NTY7CiAgICAgICAgdFsidGhyZWUiXSA9IDU1NjsKICAgICAgICB0WyJmb3VyIl0gPSA1NTY7CiAgICAgICAgdFsiZml2ZSJdID0gNTU2OwogICAgICAgIHRbInNpeCJdID0gNTU2OwogICAgICAgIHRbInNldmVuIl0gPSA1NTY7CiAgICAgICAgdFsiZWlnaHQiXSA9IDU1NjsKICAgICAgICB0WyJuaW5lIl0gPSA1NTY7CiAgICAgICAgdFsiY29sb24iXSA9IDMzMzsKICAgICAgICB0WyJzZW1pY29sb24iXSA9IDMzMzsKICAgICAgICB0WyJsZXNzIl0gPSA1ODQ7CiAgICAgICAgdFsiZXF1YWwiXSA9IDU4NDsKICAgICAgICB0WyJncmVhdGVyIl0gPSA1ODQ7CiAgICAgICAgdFsicXVlc3Rpb24iXSA9IDYxMTsKICAgICAgICB0WyJhdCJdID0gOTc1OwogICAgICAgIHRbIkEiXSA9IDcyMjsKICAgICAgICB0WyJCIl0gPSA3MjI7CiAgICAgICAgdFsiQyJdID0gNzIyOwogICAgICAgIHRbIkQiXSA9IDcyMjsKICAgICAgICB0WyJFIl0gPSA2Njc7CiAgICAgICAgdFsiRiJdID0gNjExOwogICAgICAgIHRbIkciXSA9IDc3ODsKICAgICAgICB0WyJIIl0gPSA3MjI7CiAgICAgICAgdFsiSSJdID0gMjc4OwogICAgICAgIHRbIkoiXSA9IDU1NjsKICAgICAgICB0WyJLIl0gPSA3MjI7CiAgICAgICAgdFsiTCJdID0gNjExOwogICAgICAgIHRbIk0iXSA9IDgzMzsKICAgICAgICB0WyJOIl0gPSA3MjI7CiAgICAgICAgdFsiTyJdID0gNzc4OwogICAgICAgIHRbIlAiXSA9IDY2NzsKICAgICAgICB0WyJRIl0gPSA3Nzg7CiAgICAgICAgdFsiUiJdID0gNzIyOwogICAgICAgIHRbIlMiXSA9IDY2NzsKICAgICAgICB0WyJUIl0gPSA2MTE7CiAgICAgICAgdFsiVSJdID0gNzIyOwogICAgICAgIHRbIlYiXSA9IDY2NzsKICAgICAgICB0WyJXIl0gPSA5NDQ7CiAgICAgICAgdFsiWCJdID0gNjY3OwogICAgICAgIHRbIlkiXSA9IDY2NzsKICAgICAgICB0WyJaIl0gPSA2MTE7CiAgICAgICAgdFsiYnJhY2tldGxlZnQiXSA9IDMzMzsKICAgICAgICB0WyJiYWNrc2xhc2giXSA9IDI3ODsKICAgICAgICB0WyJicmFja2V0cmlnaHQiXSA9IDMzMzsKICAgICAgICB0WyJhc2NpaWNpcmN1bSJdID0gNTg0OwogICAgICAgIHRbInVuZGVyc2NvcmUiXSA9IDU1NjsKICAgICAgICB0WyJxdW90ZWxlZnQiXSA9IDI3ODsKICAgICAgICB0WyJhIl0gPSA1NTY7CiAgICAgICAgdFsiYiJdID0gNjExOwogICAgICAgIHRbImMiXSA9IDU1NjsKICAgICAgICB0WyJkIl0gPSA2MTE7CiAgICAgICAgdFsiZSJdID0gNTU2OwogICAgICAgIHRbImYiXSA9IDMzMzsKICAgICAgICB0WyJnIl0gPSA2MTE7CiAgICAgICAgdFsiaCJdID0gNjExOwogICAgICAgIHRbImkiXSA9IDI3ODsKICAgICAgICB0WyJqIl0gPSAyNzg7CiAgICAgICAgdFsiayJdID0gNTU2OwogICAgICAgIHRbImwiXSA9IDI3ODsKICAgICAgICB0WyJtIl0gPSA4ODk7CiAgICAgICAgdFsibiJdID0gNjExOwogICAgICAgIHRbIm8iXSA9IDYxMTsKICAgICAgICB0WyJwIl0gPSA2MTE7CiAgICAgICAgdFsicSJdID0gNjExOwogICAgICAgIHRbInIiXSA9IDM4OTsKICAgICAgICB0WyJzIl0gPSA1NTY7CiAgICAgICAgdFsidCJdID0gMzMzOwogICAgICAgIHRbInUiXSA9IDYxMTsKICAgICAgICB0WyJ2Il0gPSA1NTY7CiAgICAgICAgdFsidyJdID0gNzc4OwogICAgICAgIHRbIngiXSA9IDU1NjsKICAgICAgICB0WyJ5Il0gPSA1NTY7CiAgICAgICAgdFsieiJdID0gNTAwOwogICAgICAgIHRbImJyYWNlbGVmdCJdID0gMzg5OwogICAgICAgIHRbImJhciJdID0gMjgwOwogICAgICAgIHRbImJyYWNlcmlnaHQiXSA9IDM4OTsKICAgICAgICB0WyJhc2NpaXRpbGRlIl0gPSA1ODQ7CiAgICAgICAgdFsiZXhjbGFtZG93biJdID0gMzMzOwogICAgICAgIHRbImNlbnQiXSA9IDU1NjsKICAgICAgICB0WyJzdGVybGluZyJdID0gNTU2OwogICAgICAgIHRbImZyYWN0aW9uIl0gPSAxNjc7CiAgICAgICAgdFsieWVuIl0gPSA1NTY7CiAgICAgICAgdFsiZmxvcmluIl0gPSA1NTY7CiAgICAgICAgdFsic2VjdGlvbiJdID0gNTU2OwogICAgICAgIHRbImN1cnJlbmN5Il0gPSA1NTY7CiAgICAgICAgdFsicXVvdGVzaW5nbGUiXSA9IDIzODsKICAgICAgICB0WyJxdW90ZWRibGxlZnQiXSA9IDUwMDsKICAgICAgICB0WyJndWlsbGVtb3RsZWZ0Il0gPSA1NTY7CiAgICAgICAgdFsiZ3VpbHNpbmdsbGVmdCJdID0gMzMzOwogICAgICAgIHRbImd1aWxzaW5nbHJpZ2h0Il0gPSAzMzM7CiAgICAgICAgdFsiZmkiXSA9IDYxMTsKICAgICAgICB0WyJmbCJdID0gNjExOwogICAgICAgIHRbImVuZGFzaCJdID0gNTU2OwogICAgICAgIHRbImRhZ2dlciJdID0gNTU2OwogICAgICAgIHRbImRhZ2dlcmRibCJdID0gNTU2OwogICAgICAgIHRbInBlcmlvZGNlbnRlcmVkIl0gPSAyNzg7CiAgICAgICAgdFsicGFyYWdyYXBoIl0gPSA1NTY7CiAgICAgICAgdFsiYnVsbGV0Il0gPSAzNTA7CiAgICAgICAgdFsicXVvdGVzaW5nbGJhc2UiXSA9IDI3ODsKICAgICAgICB0WyJxdW90ZWRibGJhc2UiXSA9IDUwMDsKICAgICAgICB0WyJxdW90ZWRibHJpZ2h0Il0gPSA1MDA7CiAgICAgICAgdFsiZ3VpbGxlbW90cmlnaHQiXSA9IDU1NjsKICAgICAgICB0WyJlbGxpcHNpcyJdID0gMTAwMDsKICAgICAgICB0WyJwZXJ0aG91c2FuZCJdID0gMTAwMDsKICAgICAgICB0WyJxdWVzdGlvbmRvd24iXSA9IDYxMTsKICAgICAgICB0WyJncmF2ZSJdID0gMzMzOwogICAgICAgIHRbImFjdXRlIl0gPSAzMzM7CiAgICAgICAgdFsiY2lyY3VtZmxleCJdID0gMzMzOwogICAgICAgIHRbInRpbGRlIl0gPSAzMzM7CiAgICAgICAgdFsibWFjcm9uIl0gPSAzMzM7CiAgICAgICAgdFsiYnJldmUiXSA9IDMzMzsKICAgICAgICB0WyJkb3RhY2NlbnQiXSA9IDMzMzsKICAgICAgICB0WyJkaWVyZXNpcyJdID0gMzMzOwogICAgICAgIHRbInJpbmciXSA9IDMzMzsKICAgICAgICB0WyJjZWRpbGxhIl0gPSAzMzM7CiAgICAgICAgdFsiaHVuZ2FydW1sYXV0Il0gPSAzMzM7CiAgICAgICAgdFsib2dvbmVrIl0gPSAzMzM7CiAgICAgICAgdFsiY2Fyb24iXSA9IDMzMzsKICAgICAgICB0WyJlbWRhc2giXSA9IDEwMDA7CiAgICAgICAgdFsiQUUiXSA9IDEwMDA7CiAgICAgICAgdFsib3JkZmVtaW5pbmUiXSA9IDM3MDsKICAgICAgICB0WyJMc2xhc2giXSA9IDYxMTsKICAgICAgICB0WyJPc2xhc2giXSA9IDc3ODsKICAgICAgICB0WyJPRSJdID0gMTAwMDsKICAgICAgICB0WyJvcmRtYXNjdWxpbmUiXSA9IDM2NTsKICAgICAgICB0WyJhZSJdID0gODg5OwogICAgICAgIHRbImRvdGxlc3NpIl0gPSAyNzg7CiAgICAgICAgdFsibHNsYXNoIl0gPSAyNzg7CiAgICAgICAgdFsib3NsYXNoIl0gPSA2MTE7CiAgICAgICAgdFsib2UiXSA9IDk0NDsKICAgICAgICB0WyJnZXJtYW5kYmxzIl0gPSA2MTE7CiAgICAgICAgdFsiSWRpZXJlc2lzIl0gPSAyNzg7CiAgICAgICAgdFsiZWFjdXRlIl0gPSA1NTY7CiAgICAgICAgdFsiYWJyZXZlIl0gPSA1NTY7CiAgICAgICAgdFsidWh1bmdhcnVtbGF1dCJdID0gNjExOwogICAgICAgIHRbImVjYXJvbiJdID0gNTU2OwogICAgICAgIHRbIllkaWVyZXNpcyJdID0gNjY3OwogICAgICAgIHRbImRpdmlkZSJdID0gNTg0OwogICAgICAgIHRbIllhY3V0ZSJdID0gNjY3OwogICAgICAgIHRbIkFjaXJjdW1mbGV4Il0gPSA3MjI7CiAgICAgICAgdFsiYWFjdXRlIl0gPSA1NTY7CiAgICAgICAgdFsiVWNpcmN1bWZsZXgiXSA9IDcyMjsKICAgICAgICB0WyJ5YWN1dGUiXSA9IDU1NjsKICAgICAgICB0WyJzY29tbWFhY2NlbnQiXSA9IDU1NjsKICAgICAgICB0WyJlY2lyY3VtZmxleCJdID0gNTU2OwogICAgICAgIHRbIlVyaW5nIl0gPSA3MjI7CiAgICAgICAgdFsiVWRpZXJlc2lzIl0gPSA3MjI7CiAgICAgICAgdFsiYW9nb25layJdID0gNTU2OwogICAgICAgIHRbIlVhY3V0ZSJdID0gNzIyOwogICAgICAgIHRbInVvZ29uZWsiXSA9IDYxMTsKICAgICAgICB0WyJFZGllcmVzaXMiXSA9IDY2NzsKICAgICAgICB0WyJEY3JvYXQiXSA9IDcyMjsKICAgICAgICB0WyJjb21tYWFjY2VudCJdID0gMjUwOwogICAgICAgIHRbImNvcHlyaWdodCJdID0gNzM3OwogICAgICAgIHRbIkVtYWNyb24iXSA9IDY2NzsKICAgICAgICB0WyJjY2Fyb24iXSA9IDU1NjsKICAgICAgICB0WyJhcmluZyJdID0gNTU2OwogICAgICAgIHRbIk5jb21tYWFjY2VudCJdID0gNzIyOwogICAgICAgIHRbImxhY3V0ZSJdID0gMjc4OwogICAgICAgIHRbImFncmF2ZSJdID0gNTU2OwogICAgICAgIHRbIlRjb21tYWFjY2VudCJdID0gNjExOwogICAgICAgIHRbIkNhY3V0ZSJdID0gNzIyOwogICAgICAgIHRbImF0aWxkZSJdID0gNTU2OwogICAgICAgIHRbIkVkb3RhY2NlbnQiXSA9IDY2NzsKICAgICAgICB0WyJzY2Fyb24iXSA9IDU1NjsKICAgICAgICB0WyJzY2VkaWxsYSJdID0gNTU2OwogICAgICAgIHRbImlhY3V0ZSJdID0gMjc4OwogICAgICAgIHRbImxvemVuZ2UiXSA9IDQ5NDsKICAgICAgICB0WyJSY2Fyb24iXSA9IDcyMjsKICAgICAgICB0WyJHY29tbWFhY2NlbnQiXSA9IDc3ODsKICAgICAgICB0WyJ1Y2lyY3VtZmxleCJdID0gNjExOwogICAgICAgIHRbImFjaXJjdW1mbGV4Il0gPSA1NTY7CiAgICAgICAgdFsiQW1hY3JvbiJdID0gNzIyOwogICAgICAgIHRbInJjYXJvbiJdID0gMzg5OwogICAgICAgIHRbImNjZWRpbGxhIl0gPSA1NTY7CiAgICAgICAgdFsiWmRvdGFjY2VudCJdID0gNjExOwogICAgICAgIHRbIlRob3JuIl0gPSA2Njc7CiAgICAgICAgdFsiT21hY3JvbiJdID0gNzc4OwogICAgICAgIHRbIlJhY3V0ZSJdID0gNzIyOwogICAgICAgIHRbIlNhY3V0ZSJdID0gNjY3OwogICAgICAgIHRbImRjYXJvbiJdID0gNzQzOwogICAgICAgIHRbIlVtYWNyb24iXSA9IDcyMjsKICAgICAgICB0WyJ1cmluZyJdID0gNjExOwogICAgICAgIHRbInRocmVlc3VwZXJpb3IiXSA9IDMzMzsKICAgICAgICB0WyJPZ3JhdmUiXSA9IDc3ODsKICAgICAgICB0WyJBZ3JhdmUiXSA9IDcyMjsKICAgICAgICB0WyJBYnJldmUiXSA9IDcyMjsKICAgICAgICB0WyJtdWx0aXBseSJdID0gNTg0OwogICAgICAgIHRbInVhY3V0ZSJdID0gNjExOwogICAgICAgIHRbIlRjYXJvbiJdID0gNjExOwogICAgICAgIHRbInBhcnRpYWxkaWZmIl0gPSA0OTQ7CiAgICAgICAgdFsieWRpZXJlc2lzIl0gPSA1NTY7CiAgICAgICAgdFsiTmFjdXRlIl0gPSA3MjI7CiAgICAgICAgdFsiaWNpcmN1bWZsZXgiXSA9IDI3ODsKICAgICAgICB0WyJFY2lyY3VtZmxleCJdID0gNjY3OwogICAgICAgIHRbImFkaWVyZXNpcyJdID0gNTU2OwogICAgICAgIHRbImVkaWVyZXNpcyJdID0gNTU2OwogICAgICAgIHRbImNhY3V0ZSJdID0gNTU2OwogICAgICAgIHRbIm5hY3V0ZSJdID0gNjExOwogICAgICAgIHRbInVtYWNyb24iXSA9IDYxMTsKICAgICAgICB0WyJOY2Fyb24iXSA9IDcyMjsKICAgICAgICB0WyJJYWN1dGUiXSA9IDI3ODsKICAgICAgICB0WyJwbHVzbWludXMiXSA9IDU4NDsKICAgICAgICB0WyJicm9rZW5iYXIiXSA9IDI4MDsKICAgICAgICB0WyJyZWdpc3RlcmVkIl0gPSA3Mzc7CiAgICAgICAgdFsiR2JyZXZlIl0gPSA3Nzg7CiAgICAgICAgdFsiSWRvdGFjY2VudCJdID0gMjc4OwogICAgICAgIHRbInN1bW1hdGlvbiJdID0gNjAwOwogICAgICAgIHRbIkVncmF2ZSJdID0gNjY3OwogICAgICAgIHRbInJhY3V0ZSJdID0gMzg5OwogICAgICAgIHRbIm9tYWNyb24iXSA9IDYxMTsKICAgICAgICB0WyJaYWN1dGUiXSA9IDYxMTsKICAgICAgICB0WyJaY2Fyb24iXSA9IDYxMTsKICAgICAgICB0WyJncmVhdGVyZXF1YWwiXSA9IDU0OTsKICAgICAgICB0WyJFdGgiXSA9IDcyMjsKICAgICAgICB0WyJDY2VkaWxsYSJdID0gNzIyOwogICAgICAgIHRbImxjb21tYWFjY2VudCJdID0gMjc4OwogICAgICAgIHRbInRjYXJvbiJdID0gMzg5OwogICAgICAgIHRbImVvZ29uZWsiXSA9IDU1NjsKICAgICAgICB0WyJVb2dvbmVrIl0gPSA3MjI7CiAgICAgICAgdFsiQWFjdXRlIl0gPSA3MjI7CiAgICAgICAgdFsiQWRpZXJlc2lzIl0gPSA3MjI7CiAgICAgICAgdFsiZWdyYXZlIl0gPSA1NTY7CiAgICAgICAgdFsiemFjdXRlIl0gPSA1MDA7CiAgICAgICAgdFsiaW9nb25layJdID0gMjc4OwogICAgICAgIHRbIk9hY3V0ZSJdID0gNzc4OwogICAgICAgIHRbIm9hY3V0ZSJdID0gNjExOwogICAgICAgIHRbImFtYWNyb24iXSA9IDU1NjsKICAgICAgICB0WyJzYWN1dGUiXSA9IDU1NjsKICAgICAgICB0WyJpZGllcmVzaXMiXSA9IDI3ODsKICAgICAgICB0WyJPY2lyY3VtZmxleCJdID0gNzc4OwogICAgICAgIHRbIlVncmF2ZSJdID0gNzIyOwogICAgICAgIHRbIkRlbHRhIl0gPSA2MTI7CiAgICAgICAgdFsidGhvcm4iXSA9IDYxMTsKICAgICAgICB0WyJ0d29zdXBlcmlvciJdID0gMzMzOwogICAgICAgIHRbIk9kaWVyZXNpcyJdID0gNzc4OwogICAgICAgIHRbIm11Il0gPSA2MTE7CiAgICAgICAgdFsiaWdyYXZlIl0gPSAyNzg7CiAgICAgICAgdFsib2h1bmdhcnVtbGF1dCJdID0gNjExOwogICAgICAgIHRbIkVvZ29uZWsiXSA9IDY2NzsKICAgICAgICB0WyJkY3JvYXQiXSA9IDYxMTsKICAgICAgICB0WyJ0aHJlZXF1YXJ0ZXJzIl0gPSA4MzQ7CiAgICAgICAgdFsiU2NlZGlsbGEiXSA9IDY2NzsKICAgICAgICB0WyJsY2Fyb24iXSA9IDQwMDsKICAgICAgICB0WyJLY29tbWFhY2NlbnQiXSA9IDcyMjsKICAgICAgICB0WyJMYWN1dGUiXSA9IDYxMTsKICAgICAgICB0WyJ0cmFkZW1hcmsiXSA9IDEwMDA7CiAgICAgICAgdFsiZWRvdGFjY2VudCJdID0gNTU2OwogICAgICAgIHRbIklncmF2ZSJdID0gMjc4OwogICAgICAgIHRbIkltYWNyb24iXSA9IDI3ODsKICAgICAgICB0WyJMY2Fyb24iXSA9IDYxMTsKICAgICAgICB0WyJvbmVoYWxmIl0gPSA4MzQ7CiAgICAgICAgdFsibGVzc2VxdWFsIl0gPSA1NDk7CiAgICAgICAgdFsib2NpcmN1bWZsZXgiXSA9IDYxMTsKICAgICAgICB0WyJudGlsZGUiXSA9IDYxMTsKICAgICAgICB0WyJVaHVuZ2FydW1sYXV0Il0gPSA3MjI7CiAgICAgICAgdFsiRWFjdXRlIl0gPSA2Njc7CiAgICAgICAgdFsiZW1hY3JvbiJdID0gNTU2OwogICAgICAgIHRbImdicmV2ZSJdID0gNjExOwogICAgICAgIHRbIm9uZXF1YXJ0ZXIiXSA9IDgzNDsKICAgICAgICB0WyJTY2Fyb24iXSA9IDY2NzsKICAgICAgICB0WyJTY29tbWFhY2NlbnQiXSA9IDY2NzsKICAgICAgICB0WyJPaHVuZ2FydW1sYXV0Il0gPSA3Nzg7CiAgICAgICAgdFsiZGVncmVlIl0gPSA0MDA7CiAgICAgICAgdFsib2dyYXZlIl0gPSA2MTE7CiAgICAgICAgdFsiQ2Nhcm9uIl0gPSA3MjI7CiAgICAgICAgdFsidWdyYXZlIl0gPSA2MTE7CiAgICAgICAgdFsicmFkaWNhbCJdID0gNTQ5OwogICAgICAgIHRbIkRjYXJvbiJdID0gNzIyOwogICAgICAgIHRbInJjb21tYWFjY2VudCJdID0gMzg5OwogICAgICAgIHRbIk50aWxkZSJdID0gNzIyOwogICAgICAgIHRbIm90aWxkZSJdID0gNjExOwogICAgICAgIHRbIlJjb21tYWFjY2VudCJdID0gNzIyOwogICAgICAgIHRbIkxjb21tYWFjY2VudCJdID0gNjExOwogICAgICAgIHRbIkF0aWxkZSJdID0gNzIyOwogICAgICAgIHRbIkFvZ29uZWsiXSA9IDcyMjsKICAgICAgICB0WyJBcmluZyJdID0gNzIyOwogICAgICAgIHRbIk90aWxkZSJdID0gNzc4OwogICAgICAgIHRbInpkb3RhY2NlbnQiXSA9IDUwMDsKICAgICAgICB0WyJFY2Fyb24iXSA9IDY2NzsKICAgICAgICB0WyJJb2dvbmVrIl0gPSAyNzg7CiAgICAgICAgdFsia2NvbW1hYWNjZW50Il0gPSA1NTY7CiAgICAgICAgdFsibWludXMiXSA9IDU4NDsKICAgICAgICB0WyJJY2lyY3VtZmxleCJdID0gMjc4OwogICAgICAgIHRbIm5jYXJvbiJdID0gNjExOwogICAgICAgIHRbInRjb21tYWFjY2VudCJdID0gMzMzOwogICAgICAgIHRbImxvZ2ljYWxub3QiXSA9IDU4NDsKICAgICAgICB0WyJvZGllcmVzaXMiXSA9IDYxMTsKICAgICAgICB0WyJ1ZGllcmVzaXMiXSA9IDYxMTsKICAgICAgICB0WyJub3RlcXVhbCJdID0gNTQ5OwogICAgICAgIHRbImdjb21tYWFjY2VudCJdID0gNjExOwogICAgICAgIHRbImV0aCJdID0gNjExOwogICAgICAgIHRbInpjYXJvbiJdID0gNTAwOwogICAgICAgIHRbIm5jb21tYWFjY2VudCJdID0gNjExOwogICAgICAgIHRbIm9uZXN1cGVyaW9yIl0gPSAzMzM7CiAgICAgICAgdFsiaW1hY3JvbiJdID0gMjc4OwogICAgICAgIHRbIkV1cm8iXSA9IDU1NjsKICAgICAgfSk7CiAgICAgIHRbIkhlbHZldGljYS1Cb2xkT2JsaXF1ZSJdID0gKDAsIF9jb3JlX3V0aWxzLmdldExvb2t1cFRhYmxlRmFjdG9yeSkoZnVuY3Rpb24gKHQpIHsKICAgICAgICB0WyJzcGFjZSJdID0gMjc4OwogICAgICAgIHRbImV4Y2xhbSJdID0gMzMzOwogICAgICAgIHRbInF1b3RlZGJsIl0gPSA0NzQ7CiAgICAgICAgdFsibnVtYmVyc2lnbiJdID0gNTU2OwogICAgICAgIHRbImRvbGxhciJdID0gNTU2OwogICAgICAgIHRbInBlcmNlbnQiXSA9IDg4OTsKICAgICAgICB0WyJhbXBlcnNhbmQiXSA9IDcyMjsKICAgICAgICB0WyJxdW90ZXJpZ2h0Il0gPSAyNzg7CiAgICAgICAgdFsicGFyZW5sZWZ0Il0gPSAzMzM7CiAgICAgICAgdFsicGFyZW5yaWdodCJdID0gMzMzOwogICAgICAgIHRbImFzdGVyaXNrIl0gPSAzODk7CiAgICAgICAgdFsicGx1cyJdID0gNTg0OwogICAgICAgIHRbImNvbW1hIl0gPSAyNzg7CiAgICAgICAgdFsiaHlwaGVuIl0gPSAzMzM7CiAgICAgICAgdFsicGVyaW9kIl0gPSAyNzg7CiAgICAgICAgdFsic2xhc2giXSA9IDI3ODsKICAgICAgICB0WyJ6ZXJvIl0gPSA1NTY7CiAgICAgICAgdFsib25lIl0gPSA1NTY7CiAgICAgICAgdFsidHdvIl0gPSA1NTY7CiAgICAgICAgdFsidGhyZWUiXSA9IDU1NjsKICAgICAgICB0WyJmb3VyIl0gPSA1NTY7CiAgICAgICAgdFsiZml2ZSJdID0gNTU2OwogICAgICAgIHRbInNpeCJdID0gNTU2OwogICAgICAgIHRbInNldmVuIl0gPSA1NTY7CiAgICAgICAgdFsiZWlnaHQiXSA9IDU1NjsKICAgICAgICB0WyJuaW5lIl0gPSA1NTY7CiAgICAgICAgdFsiY29sb24iXSA9IDMzMzsKICAgICAgICB0WyJzZW1pY29sb24iXSA9IDMzMzsKICAgICAgICB0WyJsZXNzIl0gPSA1ODQ7CiAgICAgICAgdFsiZXF1YWwiXSA9IDU4NDsKICAgICAgICB0WyJncmVhdGVyIl0gPSA1ODQ7CiAgICAgICAgdFsicXVlc3Rpb24iXSA9IDYxMTsKICAgICAgICB0WyJhdCJdID0gOTc1OwogICAgICAgIHRbIkEiXSA9IDcyMjsKICAgICAgICB0WyJCIl0gPSA3MjI7CiAgICAgICAgdFsiQyJdID0gNzIyOwogICAgICAgIHRbIkQiXSA9IDcyMjsKICAgICAgICB0WyJFIl0gPSA2Njc7CiAgICAgICAgdFsiRiJdID0gNjExOwogICAgICAgIHRbIkciXSA9IDc3ODsKICAgICAgICB0WyJIIl0gPSA3MjI7CiAgICAgICAgdFsiSSJdID0gMjc4OwogICAgICAgIHRbIkoiXSA9IDU1NjsKICAgICAgICB0WyJLIl0gPSA3MjI7CiAgICAgICAgdFsiTCJdID0gNjExOwogICAgICAgIHRbIk0iXSA9IDgzMzsKICAgICAgICB0WyJOIl0gPSA3MjI7CiAgICAgICAgdFsiTyJdID0gNzc4OwogICAgICAgIHRbIlAiXSA9IDY2NzsKICAgICAgICB0WyJRIl0gPSA3Nzg7CiAgICAgICAgdFsiUiJdID0gNzIyOwogICAgICAgIHRbIlMiXSA9IDY2NzsKICAgICAgICB0WyJUIl0gPSA2MTE7CiAgICAgICAgdFsiVSJdID0gNzIyOwogICAgICAgIHRbIlYiXSA9IDY2NzsKICAgICAgICB0WyJXIl0gPSA5NDQ7CiAgICAgICAgdFsiWCJdID0gNjY3OwogICAgICAgIHRbIlkiXSA9IDY2NzsKICAgICAgICB0WyJaIl0gPSA2MTE7CiAgICAgICAgdFsiYnJhY2tldGxlZnQiXSA9IDMzMzsKICAgICAgICB0WyJiYWNrc2xhc2giXSA9IDI3ODsKICAgICAgICB0WyJicmFja2V0cmlnaHQiXSA9IDMzMzsKICAgICAgICB0WyJhc2NpaWNpcmN1bSJdID0gNTg0OwogICAgICAgIHRbInVuZGVyc2NvcmUiXSA9IDU1NjsKICAgICAgICB0WyJxdW90ZWxlZnQiXSA9IDI3ODsKICAgICAgICB0WyJhIl0gPSA1NTY7CiAgICAgICAgdFsiYiJdID0gNjExOwogICAgICAgIHRbImMiXSA9IDU1NjsKICAgICAgICB0WyJkIl0gPSA2MTE7CiAgICAgICAgdFsiZSJdID0gNTU2OwogICAgICAgIHRbImYiXSA9IDMzMzsKICAgICAgICB0WyJnIl0gPSA2MTE7CiAgICAgICAgdFsiaCJdID0gNjExOwogICAgICAgIHRbImkiXSA9IDI3ODsKICAgICAgICB0WyJqIl0gPSAyNzg7CiAgICAgICAgdFsiayJdID0gNTU2OwogICAgICAgIHRbImwiXSA9IDI3ODsKICAgICAgICB0WyJtIl0gPSA4ODk7CiAgICAgICAgdFsibiJdID0gNjExOwogICAgICAgIHRbIm8iXSA9IDYxMTsKICAgICAgICB0WyJwIl0gPSA2MTE7CiAgICAgICAgdFsicSJdID0gNjExOwogICAgICAgIHRbInIiXSA9IDM4OTsKICAgICAgICB0WyJzIl0gPSA1NTY7CiAgICAgICAgdFsidCJdID0gMzMzOwogICAgICAgIHRbInUiXSA9IDYxMTsKICAgICAgICB0WyJ2Il0gPSA1NTY7CiAgICAgICAgdFsidyJdID0gNzc4OwogICAgICAgIHRbIngiXSA9IDU1NjsKICAgICAgICB0WyJ5Il0gPSA1NTY7CiAgICAgICAgdFsieiJdID0gNTAwOwogICAgICAgIHRbImJyYWNlbGVmdCJdID0gMzg5OwogICAgICAgIHRbImJhciJdID0gMjgwOwogICAgICAgIHRbImJyYWNlcmlnaHQiXSA9IDM4OTsKICAgICAgICB0WyJhc2NpaXRpbGRlIl0gPSA1ODQ7CiAgICAgICAgdFsiZXhjbGFtZG93biJdID0gMzMzOwogICAgICAgIHRbImNlbnQiXSA9IDU1NjsKICAgICAgICB0WyJzdGVybGluZyJdID0gNTU2OwogICAgICAgIHRbImZyYWN0aW9uIl0gPSAxNjc7CiAgICAgICAgdFsieWVuIl0gPSA1NTY7CiAgICAgICAgdFsiZmxvcmluIl0gPSA1NTY7CiAgICAgICAgdFsic2VjdGlvbiJdID0gNTU2OwogICAgICAgIHRbImN1cnJlbmN5Il0gPSA1NTY7CiAgICAgICAgdFsicXVvdGVzaW5nbGUiXSA9IDIzODsKICAgICAgICB0WyJxdW90ZWRibGxlZnQiXSA9IDUwMDsKICAgICAgICB0WyJndWlsbGVtb3RsZWZ0Il0gPSA1NTY7CiAgICAgICAgdFsiZ3VpbHNpbmdsbGVmdCJdID0gMzMzOwogICAgICAgIHRbImd1aWxzaW5nbHJpZ2h0Il0gPSAzMzM7CiAgICAgICAgdFsiZmkiXSA9IDYxMTsKICAgICAgICB0WyJmbCJdID0gNjExOwogICAgICAgIHRbImVuZGFzaCJdID0gNTU2OwogICAgICAgIHRbImRhZ2dlciJdID0gNTU2OwogICAgICAgIHRbImRhZ2dlcmRibCJdID0gNTU2OwogICAgICAgIHRbInBlcmlvZGNlbnRlcmVkIl0gPSAyNzg7CiAgICAgICAgdFsicGFyYWdyYXBoIl0gPSA1NTY7CiAgICAgICAgdFsiYnVsbGV0Il0gPSAzNTA7CiAgICAgICAgdFsicXVvdGVzaW5nbGJhc2UiXSA9IDI3ODsKICAgICAgICB0WyJxdW90ZWRibGJhc2UiXSA9IDUwMDsKICAgICAgICB0WyJxdW90ZWRibHJpZ2h0Il0gPSA1MDA7CiAgICAgICAgdFsiZ3VpbGxlbW90cmlnaHQiXSA9IDU1NjsKICAgICAgICB0WyJlbGxpcHNpcyJdID0gMTAwMDsKICAgICAgICB0WyJwZXJ0aG91c2FuZCJdID0gMTAwMDsKICAgICAgICB0WyJxdWVzdGlvbmRvd24iXSA9IDYxMTsKICAgICAgICB0WyJncmF2ZSJdID0gMzMzOwogICAgICAgIHRbImFjdXRlIl0gPSAzMzM7CiAgICAgICAgdFsiY2lyY3VtZmxleCJdID0gMzMzOwogICAgICAgIHRbInRpbGRlIl0gPSAzMzM7CiAgICAgICAgdFsibWFjcm9uIl0gPSAzMzM7CiAgICAgICAgdFsiYnJldmUiXSA9IDMzMzsKICAgICAgICB0WyJkb3RhY2NlbnQiXSA9IDMzMzsKICAgICAgICB0WyJkaWVyZXNpcyJdID0gMzMzOwogICAgICAgIHRbInJpbmciXSA9IDMzMzsKICAgICAgICB0WyJjZWRpbGxhIl0gPSAzMzM7CiAgICAgICAgdFsiaHVuZ2FydW1sYXV0Il0gPSAzMzM7CiAgICAgICAgdFsib2dvbmVrIl0gPSAzMzM7CiAgICAgICAgdFsiY2Fyb24iXSA9IDMzMzsKICAgICAgICB0WyJlbWRhc2giXSA9IDEwMDA7CiAgICAgICAgdFsiQUUiXSA9IDEwMDA7CiAgICAgICAgdFsib3JkZmVtaW5pbmUiXSA9IDM3MDsKICAgICAgICB0WyJMc2xhc2giXSA9IDYxMTsKICAgICAgICB0WyJPc2xhc2giXSA9IDc3ODsKICAgICAgICB0WyJPRSJdID0gMTAwMDsKICAgICAgICB0WyJvcmRtYXNjdWxpbmUiXSA9IDM2NTsKICAgICAgICB0WyJhZSJdID0gODg5OwogICAgICAgIHRbImRvdGxlc3NpIl0gPSAyNzg7CiAgICAgICAgdFsibHNsYXNoIl0gPSAyNzg7CiAgICAgICAgdFsib3NsYXNoIl0gPSA2MTE7CiAgICAgICAgdFsib2UiXSA9IDk0NDsKICAgICAgICB0WyJnZXJtYW5kYmxzIl0gPSA2MTE7CiAgICAgICAgdFsiSWRpZXJlc2lzIl0gPSAyNzg7CiAgICAgICAgdFsiZWFjdXRlIl0gPSA1NTY7CiAgICAgICAgdFsiYWJyZXZlIl0gPSA1NTY7CiAgICAgICAgdFsidWh1bmdhcnVtbGF1dCJdID0gNjExOwogICAgICAgIHRbImVjYXJvbiJdID0gNTU2OwogICAgICAgIHRbIllkaWVyZXNpcyJdID0gNjY3OwogICAgICAgIHRbImRpdmlkZSJdID0gNTg0OwogICAgICAgIHRbIllhY3V0ZSJdID0gNjY3OwogICAgICAgIHRbIkFjaXJjdW1mbGV4Il0gPSA3MjI7CiAgICAgICAgdFsiYWFjdXRlIl0gPSA1NTY7CiAgICAgICAgdFsiVWNpcmN1bWZsZXgiXSA9IDcyMjsKICAgICAgICB0WyJ5YWN1dGUiXSA9IDU1NjsKICAgICAgICB0WyJzY29tbWFhY2NlbnQiXSA9IDU1NjsKICAgICAgICB0WyJlY2lyY3VtZmxleCJdID0gNTU2OwogICAgICAgIHRbIlVyaW5nIl0gPSA3MjI7CiAgICAgICAgdFsiVWRpZXJlc2lzIl0gPSA3MjI7CiAgICAgICAgdFsiYW9nb25layJdID0gNTU2OwogICAgICAgIHRbIlVhY3V0ZSJdID0gNzIyOwogICAgICAgIHRbInVvZ29uZWsiXSA9IDYxMTsKICAgICAgICB0WyJFZGllcmVzaXMiXSA9IDY2NzsKICAgICAgICB0WyJEY3JvYXQiXSA9IDcyMjsKICAgICAgICB0WyJjb21tYWFjY2VudCJdID0gMjUwOwogICAgICAgIHRbImNvcHlyaWdodCJdID0gNzM3OwogICAgICAgIHRbIkVtYWNyb24iXSA9IDY2NzsKICAgICAgICB0WyJjY2Fyb24iXSA9IDU1NjsKICAgICAgICB0WyJhcmluZyJdID0gNTU2OwogICAgICAgIHRbIk5jb21tYWFjY2VudCJdID0gNzIyOwogICAgICAgIHRbImxhY3V0ZSJdID0gMjc4OwogICAgICAgIHRbImFncmF2ZSJdID0gNTU2OwogICAgICAgIHRbIlRjb21tYWFjY2VudCJdID0gNjExOwogICAgICAgIHRbIkNhY3V0ZSJdID0gNzIyOwogICAgICAgIHRbImF0aWxkZSJdID0gNTU2OwogICAgICAgIHRbIkVkb3RhY2NlbnQiXSA9IDY2NzsKICAgICAgICB0WyJzY2Fyb24iXSA9IDU1NjsKICAgICAgICB0WyJzY2VkaWxsYSJdID0gNTU2OwogICAgICAgIHRbImlhY3V0ZSJdID0gMjc4OwogICAgICAgIHRbImxvemVuZ2UiXSA9IDQ5NDsKICAgICAgICB0WyJSY2Fyb24iXSA9IDcyMjsKICAgICAgICB0WyJHY29tbWFhY2NlbnQiXSA9IDc3ODsKICAgICAgICB0WyJ1Y2lyY3VtZmxleCJdID0gNjExOwogICAgICAgIHRbImFjaXJjdW1mbGV4Il0gPSA1NTY7CiAgICAgICAgdFsiQW1hY3JvbiJdID0gNzIyOwogICAgICAgIHRbInJjYXJvbiJdID0gMzg5OwogICAgICAgIHRbImNjZWRpbGxhIl0gPSA1NTY7CiAgICAgICAgdFsiWmRvdGFjY2VudCJdID0gNjExOwogICAgICAgIHRbIlRob3JuIl0gPSA2Njc7CiAgICAgICAgdFsiT21hY3JvbiJdID0gNzc4OwogICAgICAgIHRbIlJhY3V0ZSJdID0gNzIyOwogICAgICAgIHRbIlNhY3V0ZSJdID0gNjY3OwogICAgICAgIHRbImRjYXJvbiJdID0gNzQzOwogICAgICAgIHRbIlVtYWNyb24iXSA9IDcyMjsKICAgICAgICB0WyJ1cmluZyJdID0gNjExOwogICAgICAgIHRbInRocmVlc3VwZXJpb3IiXSA9IDMzMzsKICAgICAgICB0WyJPZ3JhdmUiXSA9IDc3ODsKICAgICAgICB0WyJBZ3JhdmUiXSA9IDcyMjsKICAgICAgICB0WyJBYnJldmUiXSA9IDcyMjsKICAgICAgICB0WyJtdWx0aXBseSJdID0gNTg0OwogICAgICAgIHRbInVhY3V0ZSJdID0gNjExOwogICAgICAgIHRbIlRjYXJvbiJdID0gNjExOwogICAgICAgIHRbInBhcnRpYWxkaWZmIl0gPSA0OTQ7CiAgICAgICAgdFsieWRpZXJlc2lzIl0gPSA1NTY7CiAgICAgICAgdFsiTmFjdXRlIl0gPSA3MjI7CiAgICAgICAgdFsiaWNpcmN1bWZsZXgiXSA9IDI3ODsKICAgICAgICB0WyJFY2lyY3VtZmxleCJdID0gNjY3OwogICAgICAgIHRbImFkaWVyZXNpcyJdID0gNTU2OwogICAgICAgIHRbImVkaWVyZXNpcyJdID0gNTU2OwogICAgICAgIHRbImNhY3V0ZSJdID0gNTU2OwogICAgICAgIHRbIm5hY3V0ZSJdID0gNjExOwogICAgICAgIHRbInVtYWNyb24iXSA9IDYxMTsKICAgICAgICB0WyJOY2Fyb24iXSA9IDcyMjsKICAgICAgICB0WyJJYWN1dGUiXSA9IDI3ODsKICAgICAgICB0WyJwbHVzbWludXMiXSA9IDU4NDsKICAgICAgICB0WyJicm9rZW5iYXIiXSA9IDI4MDsKICAgICAgICB0WyJyZWdpc3RlcmVkIl0gPSA3Mzc7CiAgICAgICAgdFsiR2JyZXZlIl0gPSA3Nzg7CiAgICAgICAgdFsiSWRvdGFjY2VudCJdID0gMjc4OwogICAgICAgIHRbInN1bW1hdGlvbiJdID0gNjAwOwogICAgICAgIHRbIkVncmF2ZSJdID0gNjY3OwogICAgICAgIHRbInJhY3V0ZSJdID0gMzg5OwogICAgICAgIHRbIm9tYWNyb24iXSA9IDYxMTsKICAgICAgICB0WyJaYWN1dGUiXSA9IDYxMTsKICAgICAgICB0WyJaY2Fyb24iXSA9IDYxMTsKICAgICAgICB0WyJncmVhdGVyZXF1YWwiXSA9IDU0OTsKICAgICAgICB0WyJFdGgiXSA9IDcyMjsKICAgICAgICB0WyJDY2VkaWxsYSJdID0gNzIyOwogICAgICAgIHRbImxjb21tYWFjY2VudCJdID0gMjc4OwogICAgICAgIHRbInRjYXJvbiJdID0gMzg5OwogICAgICAgIHRbImVvZ29uZWsiXSA9IDU1NjsKICAgICAgICB0WyJVb2dvbmVrIl0gPSA3MjI7CiAgICAgICAgdFsiQWFjdXRlIl0gPSA3MjI7CiAgICAgICAgdFsiQWRpZXJlc2lzIl0gPSA3MjI7CiAgICAgICAgdFsiZWdyYXZlIl0gPSA1NTY7CiAgICAgICAgdFsiemFjdXRlIl0gPSA1MDA7CiAgICAgICAgdFsiaW9nb25layJdID0gMjc4OwogICAgICAgIHRbIk9hY3V0ZSJdID0gNzc4OwogICAgICAgIHRbIm9hY3V0ZSJdID0gNjExOwogICAgICAgIHRbImFtYWNyb24iXSA9IDU1NjsKICAgICAgICB0WyJzYWN1dGUiXSA9IDU1NjsKICAgICAgICB0WyJpZGllcmVzaXMiXSA9IDI3ODsKICAgICAgICB0WyJPY2lyY3VtZmxleCJdID0gNzc4OwogICAgICAgIHRbIlVncmF2ZSJdID0gNzIyOwogICAgICAgIHRbIkRlbHRhIl0gPSA2MTI7CiAgICAgICAgdFsidGhvcm4iXSA9IDYxMTsKICAgICAgICB0WyJ0d29zdXBlcmlvciJdID0gMzMzOwogICAgICAgIHRbIk9kaWVyZXNpcyJdID0gNzc4OwogICAgICAgIHRbIm11Il0gPSA2MTE7CiAgICAgICAgdFsiaWdyYXZlIl0gPSAyNzg7CiAgICAgICAgdFsib2h1bmdhcnVtbGF1dCJdID0gNjExOwogICAgICAgIHRbIkVvZ29uZWsiXSA9IDY2NzsKICAgICAgICB0WyJkY3JvYXQiXSA9IDYxMTsKICAgICAgICB0WyJ0aHJlZXF1YXJ0ZXJzIl0gPSA4MzQ7CiAgICAgICAgdFsiU2NlZGlsbGEiXSA9IDY2NzsKICAgICAgICB0WyJsY2Fyb24iXSA9IDQwMDsKICAgICAgICB0WyJLY29tbWFhY2NlbnQiXSA9IDcyMjsKICAgICAgICB0WyJMYWN1dGUiXSA9IDYxMTsKICAgICAgICB0WyJ0cmFkZW1hcmsiXSA9IDEwMDA7CiAgICAgICAgdFsiZWRvdGFjY2VudCJdID0gNTU2OwogICAgICAgIHRbIklncmF2ZSJdID0gMjc4OwogICAgICAgIHRbIkltYWNyb24iXSA9IDI3ODsKICAgICAgICB0WyJMY2Fyb24iXSA9IDYxMTsKICAgICAgICB0WyJvbmVoYWxmIl0gPSA4MzQ7CiAgICAgICAgdFsibGVzc2VxdWFsIl0gPSA1NDk7CiAgICAgICAgdFsib2NpcmN1bWZsZXgiXSA9IDYxMTsKICAgICAgICB0WyJudGlsZGUiXSA9IDYxMTsKICAgICAgICB0WyJVaHVuZ2FydW1sYXV0Il0gPSA3MjI7CiAgICAgICAgdFsiRWFjdXRlIl0gPSA2Njc7CiAgICAgICAgdFsiZW1hY3JvbiJdID0gNTU2OwogICAgICAgIHRbImdicmV2ZSJdID0gNjExOwogICAgICAgIHRbIm9uZXF1YXJ0ZXIiXSA9IDgzNDsKICAgICAgICB0WyJTY2Fyb24iXSA9IDY2NzsKICAgICAgICB0WyJTY29tbWFhY2NlbnQiXSA9IDY2NzsKICAgICAgICB0WyJPaHVuZ2FydW1sYXV0Il0gPSA3Nzg7CiAgICAgICAgdFsiZGVncmVlIl0gPSA0MDA7CiAgICAgICAgdFsib2dyYXZlIl0gPSA2MTE7CiAgICAgICAgdFsiQ2Nhcm9uIl0gPSA3MjI7CiAgICAgICAgdFsidWdyYXZlIl0gPSA2MTE7CiAgICAgICAgdFsicmFkaWNhbCJdID0gNTQ5OwogICAgICAgIHRbIkRjYXJvbiJdID0gNzIyOwogICAgICAgIHRbInJjb21tYWFjY2VudCJdID0gMzg5OwogICAgICAgIHRbIk50aWxkZSJdID0gNzIyOwogICAgICAgIHRbIm90aWxkZSJdID0gNjExOwogICAgICAgIHRbIlJjb21tYWFjY2VudCJdID0gNzIyOwogICAgICAgIHRbIkxjb21tYWFjY2VudCJdID0gNjExOwogICAgICAgIHRbIkF0aWxkZSJdID0gNzIyOwogICAgICAgIHRbIkFvZ29uZWsiXSA9IDcyMjsKICAgICAgICB0WyJBcmluZyJdID0gNzIyOwogICAgICAgIHRbIk90aWxkZSJdID0gNzc4OwogICAgICAgIHRbInpkb3RhY2NlbnQiXSA9IDUwMDsKICAgICAgICB0WyJFY2Fyb24iXSA9IDY2NzsKICAgICAgICB0WyJJb2dvbmVrIl0gPSAyNzg7CiAgICAgICAgdFsia2NvbW1hYWNjZW50Il0gPSA1NTY7CiAgICAgICAgdFsibWludXMiXSA9IDU4NDsKICAgICAgICB0WyJJY2lyY3VtZmxleCJdID0gMjc4OwogICAgICAgIHRbIm5jYXJvbiJdID0gNjExOwogICAgICAgIHRbInRjb21tYWFjY2VudCJdID0gMzMzOwogICAgICAgIHRbImxvZ2ljYWxub3QiXSA9IDU4NDsKICAgICAgICB0WyJvZGllcmVzaXMiXSA9IDYxMTsKICAgICAgICB0WyJ1ZGllcmVzaXMiXSA9IDYxMTsKICAgICAgICB0WyJub3RlcXVhbCJdID0gNTQ5OwogICAgICAgIHRbImdjb21tYWFjY2VudCJdID0gNjExOwogICAgICAgIHRbImV0aCJdID0gNjExOwogICAgICAgIHRbInpjYXJvbiJdID0gNTAwOwogICAgICAgIHRbIm5jb21tYWFjY2VudCJdID0gNjExOwogICAgICAgIHRbIm9uZXN1cGVyaW9yIl0gPSAzMzM7CiAgICAgICAgdFsiaW1hY3JvbiJdID0gMjc4OwogICAgICAgIHRbIkV1cm8iXSA9IDU1NjsKICAgICAgfSk7CiAgICAgIHRbIkhlbHZldGljYS1PYmxpcXVlIl0gPSAoMCwgX2NvcmVfdXRpbHMuZ2V0TG9va3VwVGFibGVGYWN0b3J5KShmdW5jdGlvbiAodCkgewogICAgICAgIHRbInNwYWNlIl0gPSAyNzg7CiAgICAgICAgdFsiZXhjbGFtIl0gPSAyNzg7CiAgICAgICAgdFsicXVvdGVkYmwiXSA9IDM1NTsKICAgICAgICB0WyJudW1iZXJzaWduIl0gPSA1NTY7CiAgICAgICAgdFsiZG9sbGFyIl0gPSA1NTY7CiAgICAgICAgdFsicGVyY2VudCJdID0gODg5OwogICAgICAgIHRbImFtcGVyc2FuZCJdID0gNjY3OwogICAgICAgIHRbInF1b3RlcmlnaHQiXSA9IDIyMjsKICAgICAgICB0WyJwYXJlbmxlZnQiXSA9IDMzMzsKICAgICAgICB0WyJwYXJlbnJpZ2h0Il0gPSAzMzM7CiAgICAgICAgdFsiYXN0ZXJpc2siXSA9IDM4OTsKICAgICAgICB0WyJwbHVzIl0gPSA1ODQ7CiAgICAgICAgdFsiY29tbWEiXSA9IDI3ODsKICAgICAgICB0WyJoeXBoZW4iXSA9IDMzMzsKICAgICAgICB0WyJwZXJpb2QiXSA9IDI3ODsKICAgICAgICB0WyJzbGFzaCJdID0gMjc4OwogICAgICAgIHRbInplcm8iXSA9IDU1NjsKICAgICAgICB0WyJvbmUiXSA9IDU1NjsKICAgICAgICB0WyJ0d28iXSA9IDU1NjsKICAgICAgICB0WyJ0aHJlZSJdID0gNTU2OwogICAgICAgIHRbImZvdXIiXSA9IDU1NjsKICAgICAgICB0WyJmaXZlIl0gPSA1NTY7CiAgICAgICAgdFsic2l4Il0gPSA1NTY7CiAgICAgICAgdFsic2V2ZW4iXSA9IDU1NjsKICAgICAgICB0WyJlaWdodCJdID0gNTU2OwogICAgICAgIHRbIm5pbmUiXSA9IDU1NjsKICAgICAgICB0WyJjb2xvbiJdID0gMjc4OwogICAgICAgIHRbInNlbWljb2xvbiJdID0gMjc4OwogICAgICAgIHRbImxlc3MiXSA9IDU4NDsKICAgICAgICB0WyJlcXVhbCJdID0gNTg0OwogICAgICAgIHRbImdyZWF0ZXIiXSA9IDU4NDsKICAgICAgICB0WyJxdWVzdGlvbiJdID0gNTU2OwogICAgICAgIHRbImF0Il0gPSAxMDE1OwogICAgICAgIHRbIkEiXSA9IDY2NzsKICAgICAgICB0WyJCIl0gPSA2Njc7CiAgICAgICAgdFsiQyJdID0gNzIyOwogICAgICAgIHRbIkQiXSA9IDcyMjsKICAgICAgICB0WyJFIl0gPSA2Njc7CiAgICAgICAgdFsiRiJdID0gNjExOwogICAgICAgIHRbIkciXSA9IDc3ODsKICAgICAgICB0WyJIIl0gPSA3MjI7CiAgICAgICAgdFsiSSJdID0gMjc4OwogICAgICAgIHRbIkoiXSA9IDUwMDsKICAgICAgICB0WyJLIl0gPSA2Njc7CiAgICAgICAgdFsiTCJdID0gNTU2OwogICAgICAgIHRbIk0iXSA9IDgzMzsKICAgICAgICB0WyJOIl0gPSA3MjI7CiAgICAgICAgdFsiTyJdID0gNzc4OwogICAgICAgIHRbIlAiXSA9IDY2NzsKICAgICAgICB0WyJRIl0gPSA3Nzg7CiAgICAgICAgdFsiUiJdID0gNzIyOwogICAgICAgIHRbIlMiXSA9IDY2NzsKICAgICAgICB0WyJUIl0gPSA2MTE7CiAgICAgICAgdFsiVSJdID0gNzIyOwogICAgICAgIHRbIlYiXSA9IDY2NzsKICAgICAgICB0WyJXIl0gPSA5NDQ7CiAgICAgICAgdFsiWCJdID0gNjY3OwogICAgICAgIHRbIlkiXSA9IDY2NzsKICAgICAgICB0WyJaIl0gPSA2MTE7CiAgICAgICAgdFsiYnJhY2tldGxlZnQiXSA9IDI3ODsKICAgICAgICB0WyJiYWNrc2xhc2giXSA9IDI3ODsKICAgICAgICB0WyJicmFja2V0cmlnaHQiXSA9IDI3ODsKICAgICAgICB0WyJhc2NpaWNpcmN1bSJdID0gNDY5OwogICAgICAgIHRbInVuZGVyc2NvcmUiXSA9IDU1NjsKICAgICAgICB0WyJxdW90ZWxlZnQiXSA9IDIyMjsKICAgICAgICB0WyJhIl0gPSA1NTY7CiAgICAgICAgdFsiYiJdID0gNTU2OwogICAgICAgIHRbImMiXSA9IDUwMDsKICAgICAgICB0WyJkIl0gPSA1NTY7CiAgICAgICAgdFsiZSJdID0gNTU2OwogICAgICAgIHRbImYiXSA9IDI3ODsKICAgICAgICB0WyJnIl0gPSA1NTY7CiAgICAgICAgdFsiaCJdID0gNTU2OwogICAgICAgIHRbImkiXSA9IDIyMjsKICAgICAgICB0WyJqIl0gPSAyMjI7CiAgICAgICAgdFsiayJdID0gNTAwOwogICAgICAgIHRbImwiXSA9IDIyMjsKICAgICAgICB0WyJtIl0gPSA4MzM7CiAgICAgICAgdFsibiJdID0gNTU2OwogICAgICAgIHRbIm8iXSA9IDU1NjsKICAgICAgICB0WyJwIl0gPSA1NTY7CiAgICAgICAgdFsicSJdID0gNTU2OwogICAgICAgIHRbInIiXSA9IDMzMzsKICAgICAgICB0WyJzIl0gPSA1MDA7CiAgICAgICAgdFsidCJdID0gMjc4OwogICAgICAgIHRbInUiXSA9IDU1NjsKICAgICAgICB0WyJ2Il0gPSA1MDA7CiAgICAgICAgdFsidyJdID0gNzIyOwogICAgICAgIHRbIngiXSA9IDUwMDsKICAgICAgICB0WyJ5Il0gPSA1MDA7CiAgICAgICAgdFsieiJdID0gNTAwOwogICAgICAgIHRbImJyYWNlbGVmdCJdID0gMzM0OwogICAgICAgIHRbImJhciJdID0gMjYwOwogICAgICAgIHRbImJyYWNlcmlnaHQiXSA9IDMzNDsKICAgICAgICB0WyJhc2NpaXRpbGRlIl0gPSA1ODQ7CiAgICAgICAgdFsiZXhjbGFtZG93biJdID0gMzMzOwogICAgICAgIHRbImNlbnQiXSA9IDU1NjsKICAgICAgICB0WyJzdGVybGluZyJdID0gNTU2OwogICAgICAgIHRbImZyYWN0aW9uIl0gPSAxNjc7CiAgICAgICAgdFsieWVuIl0gPSA1NTY7CiAgICAgICAgdFsiZmxvcmluIl0gPSA1NTY7CiAgICAgICAgdFsic2VjdGlvbiJdID0gNTU2OwogICAgICAgIHRbImN1cnJlbmN5Il0gPSA1NTY7CiAgICAgICAgdFsicXVvdGVzaW5nbGUiXSA9IDE5MTsKICAgICAgICB0WyJxdW90ZWRibGxlZnQiXSA9IDMzMzsKICAgICAgICB0WyJndWlsbGVtb3RsZWZ0Il0gPSA1NTY7CiAgICAgICAgdFsiZ3VpbHNpbmdsbGVmdCJdID0gMzMzOwogICAgICAgIHRbImd1aWxzaW5nbHJpZ2h0Il0gPSAzMzM7CiAgICAgICAgdFsiZmkiXSA9IDUwMDsKICAgICAgICB0WyJmbCJdID0gNTAwOwogICAgICAgIHRbImVuZGFzaCJdID0gNTU2OwogICAgICAgIHRbImRhZ2dlciJdID0gNTU2OwogICAgICAgIHRbImRhZ2dlcmRibCJdID0gNTU2OwogICAgICAgIHRbInBlcmlvZGNlbnRlcmVkIl0gPSAyNzg7CiAgICAgICAgdFsicGFyYWdyYXBoIl0gPSA1Mzc7CiAgICAgICAgdFsiYnVsbGV0Il0gPSAzNTA7CiAgICAgICAgdFsicXVvdGVzaW5nbGJhc2UiXSA9IDIyMjsKICAgICAgICB0WyJxdW90ZWRibGJhc2UiXSA9IDMzMzsKICAgICAgICB0WyJxdW90ZWRibHJpZ2h0Il0gPSAzMzM7CiAgICAgICAgdFsiZ3VpbGxlbW90cmlnaHQiXSA9IDU1NjsKICAgICAgICB0WyJlbGxpcHNpcyJdID0gMTAwMDsKICAgICAgICB0WyJwZXJ0aG91c2FuZCJdID0gMTAwMDsKICAgICAgICB0WyJxdWVzdGlvbmRvd24iXSA9IDYxMTsKICAgICAgICB0WyJncmF2ZSJdID0gMzMzOwogICAgICAgIHRbImFjdXRlIl0gPSAzMzM7CiAgICAgICAgdFsiY2lyY3VtZmxleCJdID0gMzMzOwogICAgICAgIHRbInRpbGRlIl0gPSAzMzM7CiAgICAgICAgdFsibWFjcm9uIl0gPSAzMzM7CiAgICAgICAgdFsiYnJldmUiXSA9IDMzMzsKICAgICAgICB0WyJkb3RhY2NlbnQiXSA9IDMzMzsKICAgICAgICB0WyJkaWVyZXNpcyJdID0gMzMzOwogICAgICAgIHRbInJpbmciXSA9IDMzMzsKICAgICAgICB0WyJjZWRpbGxhIl0gPSAzMzM7CiAgICAgICAgdFsiaHVuZ2FydW1sYXV0Il0gPSAzMzM7CiAgICAgICAgdFsib2dvbmVrIl0gPSAzMzM7CiAgICAgICAgdFsiY2Fyb24iXSA9IDMzMzsKICAgICAgICB0WyJlbWRhc2giXSA9IDEwMDA7CiAgICAgICAgdFsiQUUiXSA9IDEwMDA7CiAgICAgICAgdFsib3JkZmVtaW5pbmUiXSA9IDM3MDsKICAgICAgICB0WyJMc2xhc2giXSA9IDU1NjsKICAgICAgICB0WyJPc2xhc2giXSA9IDc3ODsKICAgICAgICB0WyJPRSJdID0gMTAwMDsKICAgICAgICB0WyJvcmRtYXNjdWxpbmUiXSA9IDM2NTsKICAgICAgICB0WyJhZSJdID0gODg5OwogICAgICAgIHRbImRvdGxlc3NpIl0gPSAyNzg7CiAgICAgICAgdFsibHNsYXNoIl0gPSAyMjI7CiAgICAgICAgdFsib3NsYXNoIl0gPSA2MTE7CiAgICAgICAgdFsib2UiXSA9IDk0NDsKICAgICAgICB0WyJnZXJtYW5kYmxzIl0gPSA2MTE7CiAgICAgICAgdFsiSWRpZXJlc2lzIl0gPSAyNzg7CiAgICAgICAgdFsiZWFjdXRlIl0gPSA1NTY7CiAgICAgICAgdFsiYWJyZXZlIl0gPSA1NTY7CiAgICAgICAgdFsidWh1bmdhcnVtbGF1dCJdID0gNTU2OwogICAgICAgIHRbImVjYXJvbiJdID0gNTU2OwogICAgICAgIHRbIllkaWVyZXNpcyJdID0gNjY3OwogICAgICAgIHRbImRpdmlkZSJdID0gNTg0OwogICAgICAgIHRbIllhY3V0ZSJdID0gNjY3OwogICAgICAgIHRbIkFjaXJjdW1mbGV4Il0gPSA2Njc7CiAgICAgICAgdFsiYWFjdXRlIl0gPSA1NTY7CiAgICAgICAgdFsiVWNpcmN1bWZsZXgiXSA9IDcyMjsKICAgICAgICB0WyJ5YWN1dGUiXSA9IDUwMDsKICAgICAgICB0WyJzY29tbWFhY2NlbnQiXSA9IDUwMDsKICAgICAgICB0WyJlY2lyY3VtZmxleCJdID0gNTU2OwogICAgICAgIHRbIlVyaW5nIl0gPSA3MjI7CiAgICAgICAgdFsiVWRpZXJlc2lzIl0gPSA3MjI7CiAgICAgICAgdFsiYW9nb25layJdID0gNTU2OwogICAgICAgIHRbIlVhY3V0ZSJdID0gNzIyOwogICAgICAgIHRbInVvZ29uZWsiXSA9IDU1NjsKICAgICAgICB0WyJFZGllcmVzaXMiXSA9IDY2NzsKICAgICAgICB0WyJEY3JvYXQiXSA9IDcyMjsKICAgICAgICB0WyJjb21tYWFjY2VudCJdID0gMjUwOwogICAgICAgIHRbImNvcHlyaWdodCJdID0gNzM3OwogICAgICAgIHRbIkVtYWNyb24iXSA9IDY2NzsKICAgICAgICB0WyJjY2Fyb24iXSA9IDUwMDsKICAgICAgICB0WyJhcmluZyJdID0gNTU2OwogICAgICAgIHRbIk5jb21tYWFjY2VudCJdID0gNzIyOwogICAgICAgIHRbImxhY3V0ZSJdID0gMjIyOwogICAgICAgIHRbImFncmF2ZSJdID0gNTU2OwogICAgICAgIHRbIlRjb21tYWFjY2VudCJdID0gNjExOwogICAgICAgIHRbIkNhY3V0ZSJdID0gNzIyOwogICAgICAgIHRbImF0aWxkZSJdID0gNTU2OwogICAgICAgIHRbIkVkb3RhY2NlbnQiXSA9IDY2NzsKICAgICAgICB0WyJzY2Fyb24iXSA9IDUwMDsKICAgICAgICB0WyJzY2VkaWxsYSJdID0gNTAwOwogICAgICAgIHRbImlhY3V0ZSJdID0gMjc4OwogICAgICAgIHRbImxvemVuZ2UiXSA9IDQ3MTsKICAgICAgICB0WyJSY2Fyb24iXSA9IDcyMjsKICAgICAgICB0WyJHY29tbWFhY2NlbnQiXSA9IDc3ODsKICAgICAgICB0WyJ1Y2lyY3VtZmxleCJdID0gNTU2OwogICAgICAgIHRbImFjaXJjdW1mbGV4Il0gPSA1NTY7CiAgICAgICAgdFsiQW1hY3JvbiJdID0gNjY3OwogICAgICAgIHRbInJjYXJvbiJdID0gMzMzOwogICAgICAgIHRbImNjZWRpbGxhIl0gPSA1MDA7CiAgICAgICAgdFsiWmRvdGFjY2VudCJdID0gNjExOwogICAgICAgIHRbIlRob3JuIl0gPSA2Njc7CiAgICAgICAgdFsiT21hY3JvbiJdID0gNzc4OwogICAgICAgIHRbIlJhY3V0ZSJdID0gNzIyOwogICAgICAgIHRbIlNhY3V0ZSJdID0gNjY3OwogICAgICAgIHRbImRjYXJvbiJdID0gNjQzOwogICAgICAgIHRbIlVtYWNyb24iXSA9IDcyMjsKICAgICAgICB0WyJ1cmluZyJdID0gNTU2OwogICAgICAgIHRbInRocmVlc3VwZXJpb3IiXSA9IDMzMzsKICAgICAgICB0WyJPZ3JhdmUiXSA9IDc3ODsKICAgICAgICB0WyJBZ3JhdmUiXSA9IDY2NzsKICAgICAgICB0WyJBYnJldmUiXSA9IDY2NzsKICAgICAgICB0WyJtdWx0aXBseSJdID0gNTg0OwogICAgICAgIHRbInVhY3V0ZSJdID0gNTU2OwogICAgICAgIHRbIlRjYXJvbiJdID0gNjExOwogICAgICAgIHRbInBhcnRpYWxkaWZmIl0gPSA0NzY7CiAgICAgICAgdFsieWRpZXJlc2lzIl0gPSA1MDA7CiAgICAgICAgdFsiTmFjdXRlIl0gPSA3MjI7CiAgICAgICAgdFsiaWNpcmN1bWZsZXgiXSA9IDI3ODsKICAgICAgICB0WyJFY2lyY3VtZmxleCJdID0gNjY3OwogICAgICAgIHRbImFkaWVyZXNpcyJdID0gNTU2OwogICAgICAgIHRbImVkaWVyZXNpcyJdID0gNTU2OwogICAgICAgIHRbImNhY3V0ZSJdID0gNTAwOwogICAgICAgIHRbIm5hY3V0ZSJdID0gNTU2OwogICAgICAgIHRbInVtYWNyb24iXSA9IDU1NjsKICAgICAgICB0WyJOY2Fyb24iXSA9IDcyMjsKICAgICAgICB0WyJJYWN1dGUiXSA9IDI3ODsKICAgICAgICB0WyJwbHVzbWludXMiXSA9IDU4NDsKICAgICAgICB0WyJicm9rZW5iYXIiXSA9IDI2MDsKICAgICAgICB0WyJyZWdpc3RlcmVkIl0gPSA3Mzc7CiAgICAgICAgdFsiR2JyZXZlIl0gPSA3Nzg7CiAgICAgICAgdFsiSWRvdGFjY2VudCJdID0gMjc4OwogICAgICAgIHRbInN1bW1hdGlvbiJdID0gNjAwOwogICAgICAgIHRbIkVncmF2ZSJdID0gNjY3OwogICAgICAgIHRbInJhY3V0ZSJdID0gMzMzOwogICAgICAgIHRbIm9tYWNyb24iXSA9IDU1NjsKICAgICAgICB0WyJaYWN1dGUiXSA9IDYxMTsKICAgICAgICB0WyJaY2Fyb24iXSA9IDYxMTsKICAgICAgICB0WyJncmVhdGVyZXF1YWwiXSA9IDU0OTsKICAgICAgICB0WyJFdGgiXSA9IDcyMjsKICAgICAgICB0WyJDY2VkaWxsYSJdID0gNzIyOwogICAgICAgIHRbImxjb21tYWFjY2VudCJdID0gMjIyOwogICAgICAgIHRbInRjYXJvbiJdID0gMzE3OwogICAgICAgIHRbImVvZ29uZWsiXSA9IDU1NjsKICAgICAgICB0WyJVb2dvbmVrIl0gPSA3MjI7CiAgICAgICAgdFsiQWFjdXRlIl0gPSA2Njc7CiAgICAgICAgdFsiQWRpZXJlc2lzIl0gPSA2Njc7CiAgICAgICAgdFsiZWdyYXZlIl0gPSA1NTY7CiAgICAgICAgdFsiemFjdXRlIl0gPSA1MDA7CiAgICAgICAgdFsiaW9nb25layJdID0gMjIyOwogICAgICAgIHRbIk9hY3V0ZSJdID0gNzc4OwogICAgICAgIHRbIm9hY3V0ZSJdID0gNTU2OwogICAgICAgIHRbImFtYWNyb24iXSA9IDU1NjsKICAgICAgICB0WyJzYWN1dGUiXSA9IDUwMDsKICAgICAgICB0WyJpZGllcmVzaXMiXSA9IDI3ODsKICAgICAgICB0WyJPY2lyY3VtZmxleCJdID0gNzc4OwogICAgICAgIHRbIlVncmF2ZSJdID0gNzIyOwogICAgICAgIHRbIkRlbHRhIl0gPSA2MTI7CiAgICAgICAgdFsidGhvcm4iXSA9IDU1NjsKICAgICAgICB0WyJ0d29zdXBlcmlvciJdID0gMzMzOwogICAgICAgIHRbIk9kaWVyZXNpcyJdID0gNzc4OwogICAgICAgIHRbIm11Il0gPSA1NTY7CiAgICAgICAgdFsiaWdyYXZlIl0gPSAyNzg7CiAgICAgICAgdFsib2h1bmdhcnVtbGF1dCJdID0gNTU2OwogICAgICAgIHRbIkVvZ29uZWsiXSA9IDY2NzsKICAgICAgICB0WyJkY3JvYXQiXSA9IDU1NjsKICAgICAgICB0WyJ0aHJlZXF1YXJ0ZXJzIl0gPSA4MzQ7CiAgICAgICAgdFsiU2NlZGlsbGEiXSA9IDY2NzsKICAgICAgICB0WyJsY2Fyb24iXSA9IDI5OTsKICAgICAgICB0WyJLY29tbWFhY2NlbnQiXSA9IDY2NzsKICAgICAgICB0WyJMYWN1dGUiXSA9IDU1NjsKICAgICAgICB0WyJ0cmFkZW1hcmsiXSA9IDEwMDA7CiAgICAgICAgdFsiZWRvdGFjY2VudCJdID0gNTU2OwogICAgICAgIHRbIklncmF2ZSJdID0gMjc4OwogICAgICAgIHRbIkltYWNyb24iXSA9IDI3ODsKICAgICAgICB0WyJMY2Fyb24iXSA9IDU1NjsKICAgICAgICB0WyJvbmVoYWxmIl0gPSA4MzQ7CiAgICAgICAgdFsibGVzc2VxdWFsIl0gPSA1NDk7CiAgICAgICAgdFsib2NpcmN1bWZsZXgiXSA9IDU1NjsKICAgICAgICB0WyJudGlsZGUiXSA9IDU1NjsKICAgICAgICB0WyJVaHVuZ2FydW1sYXV0Il0gPSA3MjI7CiAgICAgICAgdFsiRWFjdXRlIl0gPSA2Njc7CiAgICAgICAgdFsiZW1hY3JvbiJdID0gNTU2OwogICAgICAgIHRbImdicmV2ZSJdID0gNTU2OwogICAgICAgIHRbIm9uZXF1YXJ0ZXIiXSA9IDgzNDsKICAgICAgICB0WyJTY2Fyb24iXSA9IDY2NzsKICAgICAgICB0WyJTY29tbWFhY2NlbnQiXSA9IDY2NzsKICAgICAgICB0WyJPaHVuZ2FydW1sYXV0Il0gPSA3Nzg7CiAgICAgICAgdFsiZGVncmVlIl0gPSA0MDA7CiAgICAgICAgdFsib2dyYXZlIl0gPSA1NTY7CiAgICAgICAgdFsiQ2Nhcm9uIl0gPSA3MjI7CiAgICAgICAgdFsidWdyYXZlIl0gPSA1NTY7CiAgICAgICAgdFsicmFkaWNhbCJdID0gNDUzOwogICAgICAgIHRbIkRjYXJvbiJdID0gNzIyOwogICAgICAgIHRbInJjb21tYWFjY2VudCJdID0gMzMzOwogICAgICAgIHRbIk50aWxkZSJdID0gNzIyOwogICAgICAgIHRbIm90aWxkZSJdID0gNTU2OwogICAgICAgIHRbIlJjb21tYWFjY2VudCJdID0gNzIyOwogICAgICAgIHRbIkxjb21tYWFjY2VudCJdID0gNTU2OwogICAgICAgIHRbIkF0aWxkZSJdID0gNjY3OwogICAgICAgIHRbIkFvZ29uZWsiXSA9IDY2NzsKICAgICAgICB0WyJBcmluZyJdID0gNjY3OwogICAgICAgIHRbIk90aWxkZSJdID0gNzc4OwogICAgICAgIHRbInpkb3RhY2NlbnQiXSA9IDUwMDsKICAgICAgICB0WyJFY2Fyb24iXSA9IDY2NzsKICAgICAgICB0WyJJb2dvbmVrIl0gPSAyNzg7CiAgICAgICAgdFsia2NvbW1hYWNjZW50Il0gPSA1MDA7CiAgICAgICAgdFsibWludXMiXSA9IDU4NDsKICAgICAgICB0WyJJY2lyY3VtZmxleCJdID0gMjc4OwogICAgICAgIHRbIm5jYXJvbiJdID0gNTU2OwogICAgICAgIHRbInRjb21tYWFjY2VudCJdID0gMjc4OwogICAgICAgIHRbImxvZ2ljYWxub3QiXSA9IDU4NDsKICAgICAgICB0WyJvZGllcmVzaXMiXSA9IDU1NjsKICAgICAgICB0WyJ1ZGllcmVzaXMiXSA9IDU1NjsKICAgICAgICB0WyJub3RlcXVhbCJdID0gNTQ5OwogICAgICAgIHRbImdjb21tYWFjY2VudCJdID0gNTU2OwogICAgICAgIHRbImV0aCJdID0gNTU2OwogICAgICAgIHRbInpjYXJvbiJdID0gNTAwOwogICAgICAgIHRbIm5jb21tYWFjY2VudCJdID0gNTU2OwogICAgICAgIHRbIm9uZXN1cGVyaW9yIl0gPSAzMzM7CiAgICAgICAgdFsiaW1hY3JvbiJdID0gMjc4OwogICAgICAgIHRbIkV1cm8iXSA9IDU1NjsKICAgICAgfSk7CiAgICAgIHRbIlN5bWJvbCJdID0gKDAsIF9jb3JlX3V0aWxzLmdldExvb2t1cFRhYmxlRmFjdG9yeSkoZnVuY3Rpb24gKHQpIHsKICAgICAgICB0WyJzcGFjZSJdID0gMjUwOwogICAgICAgIHRbImV4Y2xhbSJdID0gMzMzOwogICAgICAgIHRbInVuaXZlcnNhbCJdID0gNzEzOwogICAgICAgIHRbIm51bWJlcnNpZ24iXSA9IDUwMDsKICAgICAgICB0WyJleGlzdGVudGlhbCJdID0gNTQ5OwogICAgICAgIHRbInBlcmNlbnQiXSA9IDgzMzsKICAgICAgICB0WyJhbXBlcnNhbmQiXSA9IDc3ODsKICAgICAgICB0WyJzdWNodGhhdCJdID0gNDM5OwogICAgICAgIHRbInBhcmVubGVmdCJdID0gMzMzOwogICAgICAgIHRbInBhcmVucmlnaHQiXSA9IDMzMzsKICAgICAgICB0WyJhc3Rlcmlza21hdGgiXSA9IDUwMDsKICAgICAgICB0WyJwbHVzIl0gPSA1NDk7CiAgICAgICAgdFsiY29tbWEiXSA9IDI1MDsKICAgICAgICB0WyJtaW51cyJdID0gNTQ5OwogICAgICAgIHRbInBlcmlvZCJdID0gMjUwOwogICAgICAgIHRbInNsYXNoIl0gPSAyNzg7CiAgICAgICAgdFsiemVybyJdID0gNTAwOwogICAgICAgIHRbIm9uZSJdID0gNTAwOwogICAgICAgIHRbInR3byJdID0gNTAwOwogICAgICAgIHRbInRocmVlIl0gPSA1MDA7CiAgICAgICAgdFsiZm91ciJdID0gNTAwOwogICAgICAgIHRbImZpdmUiXSA9IDUwMDsKICAgICAgICB0WyJzaXgiXSA9IDUwMDsKICAgICAgICB0WyJzZXZlbiJdID0gNTAwOwogICAgICAgIHRbImVpZ2h0Il0gPSA1MDA7CiAgICAgICAgdFsibmluZSJdID0gNTAwOwogICAgICAgIHRbImNvbG9uIl0gPSAyNzg7CiAgICAgICAgdFsic2VtaWNvbG9uIl0gPSAyNzg7CiAgICAgICAgdFsibGVzcyJdID0gNTQ5OwogICAgICAgIHRbImVxdWFsIl0gPSA1NDk7CiAgICAgICAgdFsiZ3JlYXRlciJdID0gNTQ5OwogICAgICAgIHRbInF1ZXN0aW9uIl0gPSA0NDQ7CiAgICAgICAgdFsiY29uZ3J1ZW50Il0gPSA1NDk7CiAgICAgICAgdFsiQWxwaGEiXSA9IDcyMjsKICAgICAgICB0WyJCZXRhIl0gPSA2Njc7CiAgICAgICAgdFsiQ2hpIl0gPSA3MjI7CiAgICAgICAgdFsiRGVsdGEiXSA9IDYxMjsKICAgICAgICB0WyJFcHNpbG9uIl0gPSA2MTE7CiAgICAgICAgdFsiUGhpIl0gPSA3NjM7CiAgICAgICAgdFsiR2FtbWEiXSA9IDYwMzsKICAgICAgICB0WyJFdGEiXSA9IDcyMjsKICAgICAgICB0WyJJb3RhIl0gPSAzMzM7CiAgICAgICAgdFsidGhldGExIl0gPSA2MzE7CiAgICAgICAgdFsiS2FwcGEiXSA9IDcyMjsKICAgICAgICB0WyJMYW1iZGEiXSA9IDY4NjsKICAgICAgICB0WyJNdSJdID0gODg5OwogICAgICAgIHRbIk51Il0gPSA3MjI7CiAgICAgICAgdFsiT21pY3JvbiJdID0gNzIyOwogICAgICAgIHRbIlBpIl0gPSA3Njg7CiAgICAgICAgdFsiVGhldGEiXSA9IDc0MTsKICAgICAgICB0WyJSaG8iXSA9IDU1NjsKICAgICAgICB0WyJTaWdtYSJdID0gNTkyOwogICAgICAgIHRbIlRhdSJdID0gNjExOwogICAgICAgIHRbIlVwc2lsb24iXSA9IDY5MDsKICAgICAgICB0WyJzaWdtYTEiXSA9IDQzOTsKICAgICAgICB0WyJPbWVnYSJdID0gNzY4OwogICAgICAgIHRbIlhpIl0gPSA2NDU7CiAgICAgICAgdFsiUHNpIl0gPSA3OTU7CiAgICAgICAgdFsiWmV0YSJdID0gNjExOwogICAgICAgIHRbImJyYWNrZXRsZWZ0Il0gPSAzMzM7CiAgICAgICAgdFsidGhlcmVmb3JlIl0gPSA4NjM7CiAgICAgICAgdFsiYnJhY2tldHJpZ2h0Il0gPSAzMzM7CiAgICAgICAgdFsicGVycGVuZGljdWxhciJdID0gNjU4OwogICAgICAgIHRbInVuZGVyc2NvcmUiXSA9IDUwMDsKICAgICAgICB0WyJyYWRpY2FsZXgiXSA9IDUwMDsKICAgICAgICB0WyJhbHBoYSJdID0gNjMxOwogICAgICAgIHRbImJldGEiXSA9IDU0OTsKICAgICAgICB0WyJjaGkiXSA9IDU0OTsKICAgICAgICB0WyJkZWx0YSJdID0gNDk0OwogICAgICAgIHRbImVwc2lsb24iXSA9IDQzOTsKICAgICAgICB0WyJwaGkiXSA9IDUyMTsKICAgICAgICB0WyJnYW1tYSJdID0gNDExOwogICAgICAgIHRbImV0YSJdID0gNjAzOwogICAgICAgIHRbImlvdGEiXSA9IDMyOTsKICAgICAgICB0WyJwaGkxIl0gPSA2MDM7CiAgICAgICAgdFsia2FwcGEiXSA9IDU0OTsKICAgICAgICB0WyJsYW1iZGEiXSA9IDU0OTsKICAgICAgICB0WyJtdSJdID0gNTc2OwogICAgICAgIHRbIm51Il0gPSA1MjE7CiAgICAgICAgdFsib21pY3JvbiJdID0gNTQ5OwogICAgICAgIHRbInBpIl0gPSA1NDk7CiAgICAgICAgdFsidGhldGEiXSA9IDUyMTsKICAgICAgICB0WyJyaG8iXSA9IDU0OTsKICAgICAgICB0WyJzaWdtYSJdID0gNjAzOwogICAgICAgIHRbInRhdSJdID0gNDM5OwogICAgICAgIHRbInVwc2lsb24iXSA9IDU3NjsKICAgICAgICB0WyJvbWVnYTEiXSA9IDcxMzsKICAgICAgICB0WyJvbWVnYSJdID0gNjg2OwogICAgICAgIHRbInhpIl0gPSA0OTM7CiAgICAgICAgdFsicHNpIl0gPSA2ODY7CiAgICAgICAgdFsiemV0YSJdID0gNDk0OwogICAgICAgIHRbImJyYWNlbGVmdCJdID0gNDgwOwogICAgICAgIHRbImJhciJdID0gMjAwOwogICAgICAgIHRbImJyYWNlcmlnaHQiXSA9IDQ4MDsKICAgICAgICB0WyJzaW1pbGFyIl0gPSA1NDk7CiAgICAgICAgdFsiRXVybyJdID0gNzUwOwogICAgICAgIHRbIlVwc2lsb24xIl0gPSA2MjA7CiAgICAgICAgdFsibWludXRlIl0gPSAyNDc7CiAgICAgICAgdFsibGVzc2VxdWFsIl0gPSA1NDk7CiAgICAgICAgdFsiZnJhY3Rpb24iXSA9IDE2NzsKICAgICAgICB0WyJpbmZpbml0eSJdID0gNzEzOwogICAgICAgIHRbImZsb3JpbiJdID0gNTAwOwogICAgICAgIHRbImNsdWIiXSA9IDc1MzsKICAgICAgICB0WyJkaWFtb25kIl0gPSA3NTM7CiAgICAgICAgdFsiaGVhcnQiXSA9IDc1MzsKICAgICAgICB0WyJzcGFkZSJdID0gNzUzOwogICAgICAgIHRbImFycm93Ym90aCJdID0gMTA0MjsKICAgICAgICB0WyJhcnJvd2xlZnQiXSA9IDk4NzsKICAgICAgICB0WyJhcnJvd3VwIl0gPSA2MDM7CiAgICAgICAgdFsiYXJyb3dyaWdodCJdID0gOTg3OwogICAgICAgIHRbImFycm93ZG93biJdID0gNjAzOwogICAgICAgIHRbImRlZ3JlZSJdID0gNDAwOwogICAgICAgIHRbInBsdXNtaW51cyJdID0gNTQ5OwogICAgICAgIHRbInNlY29uZCJdID0gNDExOwogICAgICAgIHRbImdyZWF0ZXJlcXVhbCJdID0gNTQ5OwogICAgICAgIHRbIm11bHRpcGx5Il0gPSA1NDk7CiAgICAgICAgdFsicHJvcG9ydGlvbmFsIl0gPSA3MTM7CiAgICAgICAgdFsicGFydGlhbGRpZmYiXSA9IDQ5NDsKICAgICAgICB0WyJidWxsZXQiXSA9IDQ2MDsKICAgICAgICB0WyJkaXZpZGUiXSA9IDU0OTsKICAgICAgICB0WyJub3RlcXVhbCJdID0gNTQ5OwogICAgICAgIHRbImVxdWl2YWxlbmNlIl0gPSA1NDk7CiAgICAgICAgdFsiYXBwcm94ZXF1YWwiXSA9IDU0OTsKICAgICAgICB0WyJlbGxpcHNpcyJdID0gMTAwMDsKICAgICAgICB0WyJhcnJvd3ZlcnRleCJdID0gNjAzOwogICAgICAgIHRbImFycm93aG9yaXpleCJdID0gMTAwMDsKICAgICAgICB0WyJjYXJyaWFnZXJldHVybiJdID0gNjU4OwogICAgICAgIHRbImFsZXBoIl0gPSA4MjM7CiAgICAgICAgdFsiSWZyYWt0dXIiXSA9IDY4NjsKICAgICAgICB0WyJSZnJha3R1ciJdID0gNzk1OwogICAgICAgIHRbIndlaWVyc3RyYXNzIl0gPSA5ODc7CiAgICAgICAgdFsiY2lyY2xlbXVsdGlwbHkiXSA9IDc2ODsKICAgICAgICB0WyJjaXJjbGVwbHVzIl0gPSA3Njg7CiAgICAgICAgdFsiZW1wdHlzZXQiXSA9IDgyMzsKICAgICAgICB0WyJpbnRlcnNlY3Rpb24iXSA9IDc2ODsKICAgICAgICB0WyJ1bmlvbiJdID0gNzY4OwogICAgICAgIHRbInByb3BlcnN1cGVyc2V0Il0gPSA3MTM7CiAgICAgICAgdFsicmVmbGV4c3VwZXJzZXQiXSA9IDcxMzsKICAgICAgICB0WyJub3RzdWJzZXQiXSA9IDcxMzsKICAgICAgICB0WyJwcm9wZXJzdWJzZXQiXSA9IDcxMzsKICAgICAgICB0WyJyZWZsZXhzdWJzZXQiXSA9IDcxMzsKICAgICAgICB0WyJlbGVtZW50Il0gPSA3MTM7CiAgICAgICAgdFsibm90ZWxlbWVudCJdID0gNzEzOwogICAgICAgIHRbImFuZ2xlIl0gPSA3Njg7CiAgICAgICAgdFsiZ3JhZGllbnQiXSA9IDcxMzsKICAgICAgICB0WyJyZWdpc3RlcnNlcmlmIl0gPSA3OTA7CiAgICAgICAgdFsiY29weXJpZ2h0c2VyaWYiXSA9IDc5MDsKICAgICAgICB0WyJ0cmFkZW1hcmtzZXJpZiJdID0gODkwOwogICAgICAgIHRbInByb2R1Y3QiXSA9IDgyMzsKICAgICAgICB0WyJyYWRpY2FsIl0gPSA1NDk7CiAgICAgICAgdFsiZG90bWF0aCJdID0gMjUwOwogICAgICAgIHRbImxvZ2ljYWxub3QiXSA9IDcxMzsKICAgICAgICB0WyJsb2dpY2FsYW5kIl0gPSA2MDM7CiAgICAgICAgdFsibG9naWNhbG9yIl0gPSA2MDM7CiAgICAgICAgdFsiYXJyb3dkYmxib3RoIl0gPSAxMDQyOwogICAgICAgIHRbImFycm93ZGJsbGVmdCJdID0gOTg3OwogICAgICAgIHRbImFycm93ZGJsdXAiXSA9IDYwMzsKICAgICAgICB0WyJhcnJvd2RibHJpZ2h0Il0gPSA5ODc7CiAgICAgICAgdFsiYXJyb3dkYmxkb3duIl0gPSA2MDM7CiAgICAgICAgdFsibG96ZW5nZSJdID0gNDk0OwogICAgICAgIHRbImFuZ2xlbGVmdCJdID0gMzI5OwogICAgICAgIHRbInJlZ2lzdGVyc2FucyJdID0gNzkwOwogICAgICAgIHRbImNvcHlyaWdodHNhbnMiXSA9IDc5MDsKICAgICAgICB0WyJ0cmFkZW1hcmtzYW5zIl0gPSA3ODY7CiAgICAgICAgdFsic3VtbWF0aW9uIl0gPSA3MTM7CiAgICAgICAgdFsicGFyZW5sZWZ0dHAiXSA9IDM4NDsKICAgICAgICB0WyJwYXJlbmxlZnRleCJdID0gMzg0OwogICAgICAgIHRbInBhcmVubGVmdGJ0Il0gPSAzODQ7CiAgICAgICAgdFsiYnJhY2tldGxlZnR0cCJdID0gMzg0OwogICAgICAgIHRbImJyYWNrZXRsZWZ0ZXgiXSA9IDM4NDsKICAgICAgICB0WyJicmFja2V0bGVmdGJ0Il0gPSAzODQ7CiAgICAgICAgdFsiYnJhY2VsZWZ0dHAiXSA9IDQ5NDsKICAgICAgICB0WyJicmFjZWxlZnRtaWQiXSA9IDQ5NDsKICAgICAgICB0WyJicmFjZWxlZnRidCJdID0gNDk0OwogICAgICAgIHRbImJyYWNlZXgiXSA9IDQ5NDsKICAgICAgICB0WyJhbmdsZXJpZ2h0Il0gPSAzMjk7CiAgICAgICAgdFsiaW50ZWdyYWwiXSA9IDI3NDsKICAgICAgICB0WyJpbnRlZ3JhbHRwIl0gPSA2ODY7CiAgICAgICAgdFsiaW50ZWdyYWxleCJdID0gNjg2OwogICAgICAgIHRbImludGVncmFsYnQiXSA9IDY4NjsKICAgICAgICB0WyJwYXJlbnJpZ2h0dHAiXSA9IDM4NDsKICAgICAgICB0WyJwYXJlbnJpZ2h0ZXgiXSA9IDM4NDsKICAgICAgICB0WyJwYXJlbnJpZ2h0YnQiXSA9IDM4NDsKICAgICAgICB0WyJicmFja2V0cmlnaHR0cCJdID0gMzg0OwogICAgICAgIHRbImJyYWNrZXRyaWdodGV4Il0gPSAzODQ7CiAgICAgICAgdFsiYnJhY2tldHJpZ2h0YnQiXSA9IDM4NDsKICAgICAgICB0WyJicmFjZXJpZ2h0dHAiXSA9IDQ5NDsKICAgICAgICB0WyJicmFjZXJpZ2h0bWlkIl0gPSA0OTQ7CiAgICAgICAgdFsiYnJhY2VyaWdodGJ0Il0gPSA0OTQ7CiAgICAgICAgdFsiYXBwbGUiXSA9IDc5MDsKICAgICAgfSk7CiAgICAgIHRbIlRpbWVzLVJvbWFuIl0gPSAoMCwgX2NvcmVfdXRpbHMuZ2V0TG9va3VwVGFibGVGYWN0b3J5KShmdW5jdGlvbiAodCkgewogICAgICAgIHRbInNwYWNlIl0gPSAyNTA7CiAgICAgICAgdFsiZXhjbGFtIl0gPSAzMzM7CiAgICAgICAgdFsicXVvdGVkYmwiXSA9IDQwODsKICAgICAgICB0WyJudW1iZXJzaWduIl0gPSA1MDA7CiAgICAgICAgdFsiZG9sbGFyIl0gPSA1MDA7CiAgICAgICAgdFsicGVyY2VudCJdID0gODMzOwogICAgICAgIHRbImFtcGVyc2FuZCJdID0gNzc4OwogICAgICAgIHRbInF1b3RlcmlnaHQiXSA9IDMzMzsKICAgICAgICB0WyJwYXJlbmxlZnQiXSA9IDMzMzsKICAgICAgICB0WyJwYXJlbnJpZ2h0Il0gPSAzMzM7CiAgICAgICAgdFsiYXN0ZXJpc2siXSA9IDUwMDsKICAgICAgICB0WyJwbHVzIl0gPSA1NjQ7CiAgICAgICAgdFsiY29tbWEiXSA9IDI1MDsKICAgICAgICB0WyJoeXBoZW4iXSA9IDMzMzsKICAgICAgICB0WyJwZXJpb2QiXSA9IDI1MDsKICAgICAgICB0WyJzbGFzaCJdID0gMjc4OwogICAgICAgIHRbInplcm8iXSA9IDUwMDsKICAgICAgICB0WyJvbmUiXSA9IDUwMDsKICAgICAgICB0WyJ0d28iXSA9IDUwMDsKICAgICAgICB0WyJ0aHJlZSJdID0gNTAwOwogICAgICAgIHRbImZvdXIiXSA9IDUwMDsKICAgICAgICB0WyJmaXZlIl0gPSA1MDA7CiAgICAgICAgdFsic2l4Il0gPSA1MDA7CiAgICAgICAgdFsic2V2ZW4iXSA9IDUwMDsKICAgICAgICB0WyJlaWdodCJdID0gNTAwOwogICAgICAgIHRbIm5pbmUiXSA9IDUwMDsKICAgICAgICB0WyJjb2xvbiJdID0gMjc4OwogICAgICAgIHRbInNlbWljb2xvbiJdID0gMjc4OwogICAgICAgIHRbImxlc3MiXSA9IDU2NDsKICAgICAgICB0WyJlcXVhbCJdID0gNTY0OwogICAgICAgIHRbImdyZWF0ZXIiXSA9IDU2NDsKICAgICAgICB0WyJxdWVzdGlvbiJdID0gNDQ0OwogICAgICAgIHRbImF0Il0gPSA5MjE7CiAgICAgICAgdFsiQSJdID0gNzIyOwogICAgICAgIHRbIkIiXSA9IDY2NzsKICAgICAgICB0WyJDIl0gPSA2Njc7CiAgICAgICAgdFsiRCJdID0gNzIyOwogICAgICAgIHRbIkUiXSA9IDYxMTsKICAgICAgICB0WyJGIl0gPSA1NTY7CiAgICAgICAgdFsiRyJdID0gNzIyOwogICAgICAgIHRbIkgiXSA9IDcyMjsKICAgICAgICB0WyJJIl0gPSAzMzM7CiAgICAgICAgdFsiSiJdID0gMzg5OwogICAgICAgIHRbIksiXSA9IDcyMjsKICAgICAgICB0WyJMIl0gPSA2MTE7CiAgICAgICAgdFsiTSJdID0gODg5OwogICAgICAgIHRbIk4iXSA9IDcyMjsKICAgICAgICB0WyJPIl0gPSA3MjI7CiAgICAgICAgdFsiUCJdID0gNTU2OwogICAgICAgIHRbIlEiXSA9IDcyMjsKICAgICAgICB0WyJSIl0gPSA2Njc7CiAgICAgICAgdFsiUyJdID0gNTU2OwogICAgICAgIHRbIlQiXSA9IDYxMTsKICAgICAgICB0WyJVIl0gPSA3MjI7CiAgICAgICAgdFsiViJdID0gNzIyOwogICAgICAgIHRbIlciXSA9IDk0NDsKICAgICAgICB0WyJYIl0gPSA3MjI7CiAgICAgICAgdFsiWSJdID0gNzIyOwogICAgICAgIHRbIloiXSA9IDYxMTsKICAgICAgICB0WyJicmFja2V0bGVmdCJdID0gMzMzOwogICAgICAgIHRbImJhY2tzbGFzaCJdID0gMjc4OwogICAgICAgIHRbImJyYWNrZXRyaWdodCJdID0gMzMzOwogICAgICAgIHRbImFzY2lpY2lyY3VtIl0gPSA0Njk7CiAgICAgICAgdFsidW5kZXJzY29yZSJdID0gNTAwOwogICAgICAgIHRbInF1b3RlbGVmdCJdID0gMzMzOwogICAgICAgIHRbImEiXSA9IDQ0NDsKICAgICAgICB0WyJiIl0gPSA1MDA7CiAgICAgICAgdFsiYyJdID0gNDQ0OwogICAgICAgIHRbImQiXSA9IDUwMDsKICAgICAgICB0WyJlIl0gPSA0NDQ7CiAgICAgICAgdFsiZiJdID0gMzMzOwogICAgICAgIHRbImciXSA9IDUwMDsKICAgICAgICB0WyJoIl0gPSA1MDA7CiAgICAgICAgdFsiaSJdID0gMjc4OwogICAgICAgIHRbImoiXSA9IDI3ODsKICAgICAgICB0WyJrIl0gPSA1MDA7CiAgICAgICAgdFsibCJdID0gMjc4OwogICAgICAgIHRbIm0iXSA9IDc3ODsKICAgICAgICB0WyJuIl0gPSA1MDA7CiAgICAgICAgdFsibyJdID0gNTAwOwogICAgICAgIHRbInAiXSA9IDUwMDsKICAgICAgICB0WyJxIl0gPSA1MDA7CiAgICAgICAgdFsiciJdID0gMzMzOwogICAgICAgIHRbInMiXSA9IDM4OTsKICAgICAgICB0WyJ0Il0gPSAyNzg7CiAgICAgICAgdFsidSJdID0gNTAwOwogICAgICAgIHRbInYiXSA9IDUwMDsKICAgICAgICB0WyJ3Il0gPSA3MjI7CiAgICAgICAgdFsieCJdID0gNTAwOwogICAgICAgIHRbInkiXSA9IDUwMDsKICAgICAgICB0WyJ6Il0gPSA0NDQ7CiAgICAgICAgdFsiYnJhY2VsZWZ0Il0gPSA0ODA7CiAgICAgICAgdFsiYmFyIl0gPSAyMDA7CiAgICAgICAgdFsiYnJhY2VyaWdodCJdID0gNDgwOwogICAgICAgIHRbImFzY2lpdGlsZGUiXSA9IDU0MTsKICAgICAgICB0WyJleGNsYW1kb3duIl0gPSAzMzM7CiAgICAgICAgdFsiY2VudCJdID0gNTAwOwogICAgICAgIHRbInN0ZXJsaW5nIl0gPSA1MDA7CiAgICAgICAgdFsiZnJhY3Rpb24iXSA9IDE2NzsKICAgICAgICB0WyJ5ZW4iXSA9IDUwMDsKICAgICAgICB0WyJmbG9yaW4iXSA9IDUwMDsKICAgICAgICB0WyJzZWN0aW9uIl0gPSA1MDA7CiAgICAgICAgdFsiY3VycmVuY3kiXSA9IDUwMDsKICAgICAgICB0WyJxdW90ZXNpbmdsZSJdID0gMTgwOwogICAgICAgIHRbInF1b3RlZGJsbGVmdCJdID0gNDQ0OwogICAgICAgIHRbImd1aWxsZW1vdGxlZnQiXSA9IDUwMDsKICAgICAgICB0WyJndWlsc2luZ2xsZWZ0Il0gPSAzMzM7CiAgICAgICAgdFsiZ3VpbHNpbmdscmlnaHQiXSA9IDMzMzsKICAgICAgICB0WyJmaSJdID0gNTU2OwogICAgICAgIHRbImZsIl0gPSA1NTY7CiAgICAgICAgdFsiZW5kYXNoIl0gPSA1MDA7CiAgICAgICAgdFsiZGFnZ2VyIl0gPSA1MDA7CiAgICAgICAgdFsiZGFnZ2VyZGJsIl0gPSA1MDA7CiAgICAgICAgdFsicGVyaW9kY2VudGVyZWQiXSA9IDI1MDsKICAgICAgICB0WyJwYXJhZ3JhcGgiXSA9IDQ1MzsKICAgICAgICB0WyJidWxsZXQiXSA9IDM1MDsKICAgICAgICB0WyJxdW90ZXNpbmdsYmFzZSJdID0gMzMzOwogICAgICAgIHRbInF1b3RlZGJsYmFzZSJdID0gNDQ0OwogICAgICAgIHRbInF1b3RlZGJscmlnaHQiXSA9IDQ0NDsKICAgICAgICB0WyJndWlsbGVtb3RyaWdodCJdID0gNTAwOwogICAgICAgIHRbImVsbGlwc2lzIl0gPSAxMDAwOwogICAgICAgIHRbInBlcnRob3VzYW5kIl0gPSAxMDAwOwogICAgICAgIHRbInF1ZXN0aW9uZG93biJdID0gNDQ0OwogICAgICAgIHRbImdyYXZlIl0gPSAzMzM7CiAgICAgICAgdFsiYWN1dGUiXSA9IDMzMzsKICAgICAgICB0WyJjaXJjdW1mbGV4Il0gPSAzMzM7CiAgICAgICAgdFsidGlsZGUiXSA9IDMzMzsKICAgICAgICB0WyJtYWNyb24iXSA9IDMzMzsKICAgICAgICB0WyJicmV2ZSJdID0gMzMzOwogICAgICAgIHRbImRvdGFjY2VudCJdID0gMzMzOwogICAgICAgIHRbImRpZXJlc2lzIl0gPSAzMzM7CiAgICAgICAgdFsicmluZyJdID0gMzMzOwogICAgICAgIHRbImNlZGlsbGEiXSA9IDMzMzsKICAgICAgICB0WyJodW5nYXJ1bWxhdXQiXSA9IDMzMzsKICAgICAgICB0WyJvZ29uZWsiXSA9IDMzMzsKICAgICAgICB0WyJjYXJvbiJdID0gMzMzOwogICAgICAgIHRbImVtZGFzaCJdID0gMTAwMDsKICAgICAgICB0WyJBRSJdID0gODg5OwogICAgICAgIHRbIm9yZGZlbWluaW5lIl0gPSAyNzY7CiAgICAgICAgdFsiTHNsYXNoIl0gPSA2MTE7CiAgICAgICAgdFsiT3NsYXNoIl0gPSA3MjI7CiAgICAgICAgdFsiT0UiXSA9IDg4OTsKICAgICAgICB0WyJvcmRtYXNjdWxpbmUiXSA9IDMxMDsKICAgICAgICB0WyJhZSJdID0gNjY3OwogICAgICAgIHRbImRvdGxlc3NpIl0gPSAyNzg7CiAgICAgICAgdFsibHNsYXNoIl0gPSAyNzg7CiAgICAgICAgdFsib3NsYXNoIl0gPSA1MDA7CiAgICAgICAgdFsib2UiXSA9IDcyMjsKICAgICAgICB0WyJnZXJtYW5kYmxzIl0gPSA1MDA7CiAgICAgICAgdFsiSWRpZXJlc2lzIl0gPSAzMzM7CiAgICAgICAgdFsiZWFjdXRlIl0gPSA0NDQ7CiAgICAgICAgdFsiYWJyZXZlIl0gPSA0NDQ7CiAgICAgICAgdFsidWh1bmdhcnVtbGF1dCJdID0gNTAwOwogICAgICAgIHRbImVjYXJvbiJdID0gNDQ0OwogICAgICAgIHRbIllkaWVyZXNpcyJdID0gNzIyOwogICAgICAgIHRbImRpdmlkZSJdID0gNTY0OwogICAgICAgIHRbIllhY3V0ZSJdID0gNzIyOwogICAgICAgIHRbIkFjaXJjdW1mbGV4Il0gPSA3MjI7CiAgICAgICAgdFsiYWFjdXRlIl0gPSA0NDQ7CiAgICAgICAgdFsiVWNpcmN1bWZsZXgiXSA9IDcyMjsKICAgICAgICB0WyJ5YWN1dGUiXSA9IDUwMDsKICAgICAgICB0WyJzY29tbWFhY2NlbnQiXSA9IDM4OTsKICAgICAgICB0WyJlY2lyY3VtZmxleCJdID0gNDQ0OwogICAgICAgIHRbIlVyaW5nIl0gPSA3MjI7CiAgICAgICAgdFsiVWRpZXJlc2lzIl0gPSA3MjI7CiAgICAgICAgdFsiYW9nb25layJdID0gNDQ0OwogICAgICAgIHRbIlVhY3V0ZSJdID0gNzIyOwogICAgICAgIHRbInVvZ29uZWsiXSA9IDUwMDsKICAgICAgICB0WyJFZGllcmVzaXMiXSA9IDYxMTsKICAgICAgICB0WyJEY3JvYXQiXSA9IDcyMjsKICAgICAgICB0WyJjb21tYWFjY2VudCJdID0gMjUwOwogICAgICAgIHRbImNvcHlyaWdodCJdID0gNzYwOwogICAgICAgIHRbIkVtYWNyb24iXSA9IDYxMTsKICAgICAgICB0WyJjY2Fyb24iXSA9IDQ0NDsKICAgICAgICB0WyJhcmluZyJdID0gNDQ0OwogICAgICAgIHRbIk5jb21tYWFjY2VudCJdID0gNzIyOwogICAgICAgIHRbImxhY3V0ZSJdID0gMjc4OwogICAgICAgIHRbImFncmF2ZSJdID0gNDQ0OwogICAgICAgIHRbIlRjb21tYWFjY2VudCJdID0gNjExOwogICAgICAgIHRbIkNhY3V0ZSJdID0gNjY3OwogICAgICAgIHRbImF0aWxkZSJdID0gNDQ0OwogICAgICAgIHRbIkVkb3RhY2NlbnQiXSA9IDYxMTsKICAgICAgICB0WyJzY2Fyb24iXSA9IDM4OTsKICAgICAgICB0WyJzY2VkaWxsYSJdID0gMzg5OwogICAgICAgIHRbImlhY3V0ZSJdID0gMjc4OwogICAgICAgIHRbImxvemVuZ2UiXSA9IDQ3MTsKICAgICAgICB0WyJSY2Fyb24iXSA9IDY2NzsKICAgICAgICB0WyJHY29tbWFhY2NlbnQiXSA9IDcyMjsKICAgICAgICB0WyJ1Y2lyY3VtZmxleCJdID0gNTAwOwogICAgICAgIHRbImFjaXJjdW1mbGV4Il0gPSA0NDQ7CiAgICAgICAgdFsiQW1hY3JvbiJdID0gNzIyOwogICAgICAgIHRbInJjYXJvbiJdID0gMzMzOwogICAgICAgIHRbImNjZWRpbGxhIl0gPSA0NDQ7CiAgICAgICAgdFsiWmRvdGFjY2VudCJdID0gNjExOwogICAgICAgIHRbIlRob3JuIl0gPSA1NTY7CiAgICAgICAgdFsiT21hY3JvbiJdID0gNzIyOwogICAgICAgIHRbIlJhY3V0ZSJdID0gNjY3OwogICAgICAgIHRbIlNhY3V0ZSJdID0gNTU2OwogICAgICAgIHRbImRjYXJvbiJdID0gNTg4OwogICAgICAgIHRbIlVtYWNyb24iXSA9IDcyMjsKICAgICAgICB0WyJ1cmluZyJdID0gNTAwOwogICAgICAgIHRbInRocmVlc3VwZXJpb3IiXSA9IDMwMDsKICAgICAgICB0WyJPZ3JhdmUiXSA9IDcyMjsKICAgICAgICB0WyJBZ3JhdmUiXSA9IDcyMjsKICAgICAgICB0WyJBYnJldmUiXSA9IDcyMjsKICAgICAgICB0WyJtdWx0aXBseSJdID0gNTY0OwogICAgICAgIHRbInVhY3V0ZSJdID0gNTAwOwogICAgICAgIHRbIlRjYXJvbiJdID0gNjExOwogICAgICAgIHRbInBhcnRpYWxkaWZmIl0gPSA0NzY7CiAgICAgICAgdFsieWRpZXJlc2lzIl0gPSA1MDA7CiAgICAgICAgdFsiTmFjdXRlIl0gPSA3MjI7CiAgICAgICAgdFsiaWNpcmN1bWZsZXgiXSA9IDI3ODsKICAgICAgICB0WyJFY2lyY3VtZmxleCJdID0gNjExOwogICAgICAgIHRbImFkaWVyZXNpcyJdID0gNDQ0OwogICAgICAgIHRbImVkaWVyZXNpcyJdID0gNDQ0OwogICAgICAgIHRbImNhY3V0ZSJdID0gNDQ0OwogICAgICAgIHRbIm5hY3V0ZSJdID0gNTAwOwogICAgICAgIHRbInVtYWNyb24iXSA9IDUwMDsKICAgICAgICB0WyJOY2Fyb24iXSA9IDcyMjsKICAgICAgICB0WyJJYWN1dGUiXSA9IDMzMzsKICAgICAgICB0WyJwbHVzbWludXMiXSA9IDU2NDsKICAgICAgICB0WyJicm9rZW5iYXIiXSA9IDIwMDsKICAgICAgICB0WyJyZWdpc3RlcmVkIl0gPSA3NjA7CiAgICAgICAgdFsiR2JyZXZlIl0gPSA3MjI7CiAgICAgICAgdFsiSWRvdGFjY2VudCJdID0gMzMzOwogICAgICAgIHRbInN1bW1hdGlvbiJdID0gNjAwOwogICAgICAgIHRbIkVncmF2ZSJdID0gNjExOwogICAgICAgIHRbInJhY3V0ZSJdID0gMzMzOwogICAgICAgIHRbIm9tYWNyb24iXSA9IDUwMDsKICAgICAgICB0WyJaYWN1dGUiXSA9IDYxMTsKICAgICAgICB0WyJaY2Fyb24iXSA9IDYxMTsKICAgICAgICB0WyJncmVhdGVyZXF1YWwiXSA9IDU0OTsKICAgICAgICB0WyJFdGgiXSA9IDcyMjsKICAgICAgICB0WyJDY2VkaWxsYSJdID0gNjY3OwogICAgICAgIHRbImxjb21tYWFjY2VudCJdID0gMjc4OwogICAgICAgIHRbInRjYXJvbiJdID0gMzI2OwogICAgICAgIHRbImVvZ29uZWsiXSA9IDQ0NDsKICAgICAgICB0WyJVb2dvbmVrIl0gPSA3MjI7CiAgICAgICAgdFsiQWFjdXRlIl0gPSA3MjI7CiAgICAgICAgdFsiQWRpZXJlc2lzIl0gPSA3MjI7CiAgICAgICAgdFsiZWdyYXZlIl0gPSA0NDQ7CiAgICAgICAgdFsiemFjdXRlIl0gPSA0NDQ7CiAgICAgICAgdFsiaW9nb25layJdID0gMjc4OwogICAgICAgIHRbIk9hY3V0ZSJdID0gNzIyOwogICAgICAgIHRbIm9hY3V0ZSJdID0gNTAwOwogICAgICAgIHRbImFtYWNyb24iXSA9IDQ0NDsKICAgICAgICB0WyJzYWN1dGUiXSA9IDM4OTsKICAgICAgICB0WyJpZGllcmVzaXMiXSA9IDI3ODsKICAgICAgICB0WyJPY2lyY3VtZmxleCJdID0gNzIyOwogICAgICAgIHRbIlVncmF2ZSJdID0gNzIyOwogICAgICAgIHRbIkRlbHRhIl0gPSA2MTI7CiAgICAgICAgdFsidGhvcm4iXSA9IDUwMDsKICAgICAgICB0WyJ0d29zdXBlcmlvciJdID0gMzAwOwogICAgICAgIHRbIk9kaWVyZXNpcyJdID0gNzIyOwogICAgICAgIHRbIm11Il0gPSA1MDA7CiAgICAgICAgdFsiaWdyYXZlIl0gPSAyNzg7CiAgICAgICAgdFsib2h1bmdhcnVtbGF1dCJdID0gNTAwOwogICAgICAgIHRbIkVvZ29uZWsiXSA9IDYxMTsKICAgICAgICB0WyJkY3JvYXQiXSA9IDUwMDsKICAgICAgICB0WyJ0aHJlZXF1YXJ0ZXJzIl0gPSA3NTA7CiAgICAgICAgdFsiU2NlZGlsbGEiXSA9IDU1NjsKICAgICAgICB0WyJsY2Fyb24iXSA9IDM0NDsKICAgICAgICB0WyJLY29tbWFhY2NlbnQiXSA9IDcyMjsKICAgICAgICB0WyJMYWN1dGUiXSA9IDYxMTsKICAgICAgICB0WyJ0cmFkZW1hcmsiXSA9IDk4MDsKICAgICAgICB0WyJlZG90YWNjZW50Il0gPSA0NDQ7CiAgICAgICAgdFsiSWdyYXZlIl0gPSAzMzM7CiAgICAgICAgdFsiSW1hY3JvbiJdID0gMzMzOwogICAgICAgIHRbIkxjYXJvbiJdID0gNjExOwogICAgICAgIHRbIm9uZWhhbGYiXSA9IDc1MDsKICAgICAgICB0WyJsZXNzZXF1YWwiXSA9IDU0OTsKICAgICAgICB0WyJvY2lyY3VtZmxleCJdID0gNTAwOwogICAgICAgIHRbIm50aWxkZSJdID0gNTAwOwogICAgICAgIHRbIlVodW5nYXJ1bWxhdXQiXSA9IDcyMjsKICAgICAgICB0WyJFYWN1dGUiXSA9IDYxMTsKICAgICAgICB0WyJlbWFjcm9uIl0gPSA0NDQ7CiAgICAgICAgdFsiZ2JyZXZlIl0gPSA1MDA7CiAgICAgICAgdFsib25lcXVhcnRlciJdID0gNzUwOwogICAgICAgIHRbIlNjYXJvbiJdID0gNTU2OwogICAgICAgIHRbIlNjb21tYWFjY2VudCJdID0gNTU2OwogICAgICAgIHRbIk9odW5nYXJ1bWxhdXQiXSA9IDcyMjsKICAgICAgICB0WyJkZWdyZWUiXSA9IDQwMDsKICAgICAgICB0WyJvZ3JhdmUiXSA9IDUwMDsKICAgICAgICB0WyJDY2Fyb24iXSA9IDY2NzsKICAgICAgICB0WyJ1Z3JhdmUiXSA9IDUwMDsKICAgICAgICB0WyJyYWRpY2FsIl0gPSA0NTM7CiAgICAgICAgdFsiRGNhcm9uIl0gPSA3MjI7CiAgICAgICAgdFsicmNvbW1hYWNjZW50Il0gPSAzMzM7CiAgICAgICAgdFsiTnRpbGRlIl0gPSA3MjI7CiAgICAgICAgdFsib3RpbGRlIl0gPSA1MDA7CiAgICAgICAgdFsiUmNvbW1hYWNjZW50Il0gPSA2Njc7CiAgICAgICAgdFsiTGNvbW1hYWNjZW50Il0gPSA2MTE7CiAgICAgICAgdFsiQXRpbGRlIl0gPSA3MjI7CiAgICAgICAgdFsiQW9nb25layJdID0gNzIyOwogICAgICAgIHRbIkFyaW5nIl0gPSA3MjI7CiAgICAgICAgdFsiT3RpbGRlIl0gPSA3MjI7CiAgICAgICAgdFsiemRvdGFjY2VudCJdID0gNDQ0OwogICAgICAgIHRbIkVjYXJvbiJdID0gNjExOwogICAgICAgIHRbIklvZ29uZWsiXSA9IDMzMzsKICAgICAgICB0WyJrY29tbWFhY2NlbnQiXSA9IDUwMDsKICAgICAgICB0WyJtaW51cyJdID0gNTY0OwogICAgICAgIHRbIkljaXJjdW1mbGV4Il0gPSAzMzM7CiAgICAgICAgdFsibmNhcm9uIl0gPSA1MDA7CiAgICAgICAgdFsidGNvbW1hYWNjZW50Il0gPSAyNzg7CiAgICAgICAgdFsibG9naWNhbG5vdCJdID0gNTY0OwogICAgICAgIHRbIm9kaWVyZXNpcyJdID0gNTAwOwogICAgICAgIHRbInVkaWVyZXNpcyJdID0gNTAwOwogICAgICAgIHRbIm5vdGVxdWFsIl0gPSA1NDk7CiAgICAgICAgdFsiZ2NvbW1hYWNjZW50Il0gPSA1MDA7CiAgICAgICAgdFsiZXRoIl0gPSA1MDA7CiAgICAgICAgdFsiemNhcm9uIl0gPSA0NDQ7CiAgICAgICAgdFsibmNvbW1hYWNjZW50Il0gPSA1MDA7CiAgICAgICAgdFsib25lc3VwZXJpb3IiXSA9IDMwMDsKICAgICAgICB0WyJpbWFjcm9uIl0gPSAyNzg7CiAgICAgICAgdFsiRXVybyJdID0gNTAwOwogICAgICB9KTsKICAgICAgdFsiVGltZXMtQm9sZCJdID0gKDAsIF9jb3JlX3V0aWxzLmdldExvb2t1cFRhYmxlRmFjdG9yeSkoZnVuY3Rpb24gKHQpIHsKICAgICAgICB0WyJzcGFjZSJdID0gMjUwOwogICAgICAgIHRbImV4Y2xhbSJdID0gMzMzOwogICAgICAgIHRbInF1b3RlZGJsIl0gPSA1NTU7CiAgICAgICAgdFsibnVtYmVyc2lnbiJdID0gNTAwOwogICAgICAgIHRbImRvbGxhciJdID0gNTAwOwogICAgICAgIHRbInBlcmNlbnQiXSA9IDEwMDA7CiAgICAgICAgdFsiYW1wZXJzYW5kIl0gPSA4MzM7CiAgICAgICAgdFsicXVvdGVyaWdodCJdID0gMzMzOwogICAgICAgIHRbInBhcmVubGVmdCJdID0gMzMzOwogICAgICAgIHRbInBhcmVucmlnaHQiXSA9IDMzMzsKICAgICAgICB0WyJhc3RlcmlzayJdID0gNTAwOwogICAgICAgIHRbInBsdXMiXSA9IDU3MDsKICAgICAgICB0WyJjb21tYSJdID0gMjUwOwogICAgICAgIHRbImh5cGhlbiJdID0gMzMzOwogICAgICAgIHRbInBlcmlvZCJdID0gMjUwOwogICAgICAgIHRbInNsYXNoIl0gPSAyNzg7CiAgICAgICAgdFsiemVybyJdID0gNTAwOwogICAgICAgIHRbIm9uZSJdID0gNTAwOwogICAgICAgIHRbInR3byJdID0gNTAwOwogICAgICAgIHRbInRocmVlIl0gPSA1MDA7CiAgICAgICAgdFsiZm91ciJdID0gNTAwOwogICAgICAgIHRbImZpdmUiXSA9IDUwMDsKICAgICAgICB0WyJzaXgiXSA9IDUwMDsKICAgICAgICB0WyJzZXZlbiJdID0gNTAwOwogICAgICAgIHRbImVpZ2h0Il0gPSA1MDA7CiAgICAgICAgdFsibmluZSJdID0gNTAwOwogICAgICAgIHRbImNvbG9uIl0gPSAzMzM7CiAgICAgICAgdFsic2VtaWNvbG9uIl0gPSAzMzM7CiAgICAgICAgdFsibGVzcyJdID0gNTcwOwogICAgICAgIHRbImVxdWFsIl0gPSA1NzA7CiAgICAgICAgdFsiZ3JlYXRlciJdID0gNTcwOwogICAgICAgIHRbInF1ZXN0aW9uIl0gPSA1MDA7CiAgICAgICAgdFsiYXQiXSA9IDkzMDsKICAgICAgICB0WyJBIl0gPSA3MjI7CiAgICAgICAgdFsiQiJdID0gNjY3OwogICAgICAgIHRbIkMiXSA9IDcyMjsKICAgICAgICB0WyJEIl0gPSA3MjI7CiAgICAgICAgdFsiRSJdID0gNjY3OwogICAgICAgIHRbIkYiXSA9IDYxMTsKICAgICAgICB0WyJHIl0gPSA3Nzg7CiAgICAgICAgdFsiSCJdID0gNzc4OwogICAgICAgIHRbIkkiXSA9IDM4OTsKICAgICAgICB0WyJKIl0gPSA1MDA7CiAgICAgICAgdFsiSyJdID0gNzc4OwogICAgICAgIHRbIkwiXSA9IDY2NzsKICAgICAgICB0WyJNIl0gPSA5NDQ7CiAgICAgICAgdFsiTiJdID0gNzIyOwogICAgICAgIHRbIk8iXSA9IDc3ODsKICAgICAgICB0WyJQIl0gPSA2MTE7CiAgICAgICAgdFsiUSJdID0gNzc4OwogICAgICAgIHRbIlIiXSA9IDcyMjsKICAgICAgICB0WyJTIl0gPSA1NTY7CiAgICAgICAgdFsiVCJdID0gNjY3OwogICAgICAgIHRbIlUiXSA9IDcyMjsKICAgICAgICB0WyJWIl0gPSA3MjI7CiAgICAgICAgdFsiVyJdID0gMTAwMDsKICAgICAgICB0WyJYIl0gPSA3MjI7CiAgICAgICAgdFsiWSJdID0gNzIyOwogICAgICAgIHRbIloiXSA9IDY2NzsKICAgICAgICB0WyJicmFja2V0bGVmdCJdID0gMzMzOwogICAgICAgIHRbImJhY2tzbGFzaCJdID0gMjc4OwogICAgICAgIHRbImJyYWNrZXRyaWdodCJdID0gMzMzOwogICAgICAgIHRbImFzY2lpY2lyY3VtIl0gPSA1ODE7CiAgICAgICAgdFsidW5kZXJzY29yZSJdID0gNTAwOwogICAgICAgIHRbInF1b3RlbGVmdCJdID0gMzMzOwogICAgICAgIHRbImEiXSA9IDUwMDsKICAgICAgICB0WyJiIl0gPSA1NTY7CiAgICAgICAgdFsiYyJdID0gNDQ0OwogICAgICAgIHRbImQiXSA9IDU1NjsKICAgICAgICB0WyJlIl0gPSA0NDQ7CiAgICAgICAgdFsiZiJdID0gMzMzOwogICAgICAgIHRbImciXSA9IDUwMDsKICAgICAgICB0WyJoIl0gPSA1NTY7CiAgICAgICAgdFsiaSJdID0gMjc4OwogICAgICAgIHRbImoiXSA9IDMzMzsKICAgICAgICB0WyJrIl0gPSA1NTY7CiAgICAgICAgdFsibCJdID0gMjc4OwogICAgICAgIHRbIm0iXSA9IDgzMzsKICAgICAgICB0WyJuIl0gPSA1NTY7CiAgICAgICAgdFsibyJdID0gNTAwOwogICAgICAgIHRbInAiXSA9IDU1NjsKICAgICAgICB0WyJxIl0gPSA1NTY7CiAgICAgICAgdFsiciJdID0gNDQ0OwogICAgICAgIHRbInMiXSA9IDM4OTsKICAgICAgICB0WyJ0Il0gPSAzMzM7CiAgICAgICAgdFsidSJdID0gNTU2OwogICAgICAgIHRbInYiXSA9IDUwMDsKICAgICAgICB0WyJ3Il0gPSA3MjI7CiAgICAgICAgdFsieCJdID0gNTAwOwogICAgICAgIHRbInkiXSA9IDUwMDsKICAgICAgICB0WyJ6Il0gPSA0NDQ7CiAgICAgICAgdFsiYnJhY2VsZWZ0Il0gPSAzOTQ7CiAgICAgICAgdFsiYmFyIl0gPSAyMjA7CiAgICAgICAgdFsiYnJhY2VyaWdodCJdID0gMzk0OwogICAgICAgIHRbImFzY2lpdGlsZGUiXSA9IDUyMDsKICAgICAgICB0WyJleGNsYW1kb3duIl0gPSAzMzM7CiAgICAgICAgdFsiY2VudCJdID0gNTAwOwogICAgICAgIHRbInN0ZXJsaW5nIl0gPSA1MDA7CiAgICAgICAgdFsiZnJhY3Rpb24iXSA9IDE2NzsKICAgICAgICB0WyJ5ZW4iXSA9IDUwMDsKICAgICAgICB0WyJmbG9yaW4iXSA9IDUwMDsKICAgICAgICB0WyJzZWN0aW9uIl0gPSA1MDA7CiAgICAgICAgdFsiY3VycmVuY3kiXSA9IDUwMDsKICAgICAgICB0WyJxdW90ZXNpbmdsZSJdID0gMjc4OwogICAgICAgIHRbInF1b3RlZGJsbGVmdCJdID0gNTAwOwogICAgICAgIHRbImd1aWxsZW1vdGxlZnQiXSA9IDUwMDsKICAgICAgICB0WyJndWlsc2luZ2xsZWZ0Il0gPSAzMzM7CiAgICAgICAgdFsiZ3VpbHNpbmdscmlnaHQiXSA9IDMzMzsKICAgICAgICB0WyJmaSJdID0gNTU2OwogICAgICAgIHRbImZsIl0gPSA1NTY7CiAgICAgICAgdFsiZW5kYXNoIl0gPSA1MDA7CiAgICAgICAgdFsiZGFnZ2VyIl0gPSA1MDA7CiAgICAgICAgdFsiZGFnZ2VyZGJsIl0gPSA1MDA7CiAgICAgICAgdFsicGVyaW9kY2VudGVyZWQiXSA9IDI1MDsKICAgICAgICB0WyJwYXJhZ3JhcGgiXSA9IDU0MDsKICAgICAgICB0WyJidWxsZXQiXSA9IDM1MDsKICAgICAgICB0WyJxdW90ZXNpbmdsYmFzZSJdID0gMzMzOwogICAgICAgIHRbInF1b3RlZGJsYmFzZSJdID0gNTAwOwogICAgICAgIHRbInF1b3RlZGJscmlnaHQiXSA9IDUwMDsKICAgICAgICB0WyJndWlsbGVtb3RyaWdodCJdID0gNTAwOwogICAgICAgIHRbImVsbGlwc2lzIl0gPSAxMDAwOwogICAgICAgIHRbInBlcnRob3VzYW5kIl0gPSAxMDAwOwogICAgICAgIHRbInF1ZXN0aW9uZG93biJdID0gNTAwOwogICAgICAgIHRbImdyYXZlIl0gPSAzMzM7CiAgICAgICAgdFsiYWN1dGUiXSA9IDMzMzsKICAgICAgICB0WyJjaXJjdW1mbGV4Il0gPSAzMzM7CiAgICAgICAgdFsidGlsZGUiXSA9IDMzMzsKICAgICAgICB0WyJtYWNyb24iXSA9IDMzMzsKICAgICAgICB0WyJicmV2ZSJdID0gMzMzOwogICAgICAgIHRbImRvdGFjY2VudCJdID0gMzMzOwogICAgICAgIHRbImRpZXJlc2lzIl0gPSAzMzM7CiAgICAgICAgdFsicmluZyJdID0gMzMzOwogICAgICAgIHRbImNlZGlsbGEiXSA9IDMzMzsKICAgICAgICB0WyJodW5nYXJ1bWxhdXQiXSA9IDMzMzsKICAgICAgICB0WyJvZ29uZWsiXSA9IDMzMzsKICAgICAgICB0WyJjYXJvbiJdID0gMzMzOwogICAgICAgIHRbImVtZGFzaCJdID0gMTAwMDsKICAgICAgICB0WyJBRSJdID0gMTAwMDsKICAgICAgICB0WyJvcmRmZW1pbmluZSJdID0gMzAwOwogICAgICAgIHRbIkxzbGFzaCJdID0gNjY3OwogICAgICAgIHRbIk9zbGFzaCJdID0gNzc4OwogICAgICAgIHRbIk9FIl0gPSAxMDAwOwogICAgICAgIHRbIm9yZG1hc2N1bGluZSJdID0gMzMwOwogICAgICAgIHRbImFlIl0gPSA3MjI7CiAgICAgICAgdFsiZG90bGVzc2kiXSA9IDI3ODsKICAgICAgICB0WyJsc2xhc2giXSA9IDI3ODsKICAgICAgICB0WyJvc2xhc2giXSA9IDUwMDsKICAgICAgICB0WyJvZSJdID0gNzIyOwogICAgICAgIHRbImdlcm1hbmRibHMiXSA9IDU1NjsKICAgICAgICB0WyJJZGllcmVzaXMiXSA9IDM4OTsKICAgICAgICB0WyJlYWN1dGUiXSA9IDQ0NDsKICAgICAgICB0WyJhYnJldmUiXSA9IDUwMDsKICAgICAgICB0WyJ1aHVuZ2FydW1sYXV0Il0gPSA1NTY7CiAgICAgICAgdFsiZWNhcm9uIl0gPSA0NDQ7CiAgICAgICAgdFsiWWRpZXJlc2lzIl0gPSA3MjI7CiAgICAgICAgdFsiZGl2aWRlIl0gPSA1NzA7CiAgICAgICAgdFsiWWFjdXRlIl0gPSA3MjI7CiAgICAgICAgdFsiQWNpcmN1bWZsZXgiXSA9IDcyMjsKICAgICAgICB0WyJhYWN1dGUiXSA9IDUwMDsKICAgICAgICB0WyJVY2lyY3VtZmxleCJdID0gNzIyOwogICAgICAgIHRbInlhY3V0ZSJdID0gNTAwOwogICAgICAgIHRbInNjb21tYWFjY2VudCJdID0gMzg5OwogICAgICAgIHRbImVjaXJjdW1mbGV4Il0gPSA0NDQ7CiAgICAgICAgdFsiVXJpbmciXSA9IDcyMjsKICAgICAgICB0WyJVZGllcmVzaXMiXSA9IDcyMjsKICAgICAgICB0WyJhb2dvbmVrIl0gPSA1MDA7CiAgICAgICAgdFsiVWFjdXRlIl0gPSA3MjI7CiAgICAgICAgdFsidW9nb25layJdID0gNTU2OwogICAgICAgIHRbIkVkaWVyZXNpcyJdID0gNjY3OwogICAgICAgIHRbIkRjcm9hdCJdID0gNzIyOwogICAgICAgIHRbImNvbW1hYWNjZW50Il0gPSAyNTA7CiAgICAgICAgdFsiY29weXJpZ2h0Il0gPSA3NDc7CiAgICAgICAgdFsiRW1hY3JvbiJdID0gNjY3OwogICAgICAgIHRbImNjYXJvbiJdID0gNDQ0OwogICAgICAgIHRbImFyaW5nIl0gPSA1MDA7CiAgICAgICAgdFsiTmNvbW1hYWNjZW50Il0gPSA3MjI7CiAgICAgICAgdFsibGFjdXRlIl0gPSAyNzg7CiAgICAgICAgdFsiYWdyYXZlIl0gPSA1MDA7CiAgICAgICAgdFsiVGNvbW1hYWNjZW50Il0gPSA2Njc7CiAgICAgICAgdFsiQ2FjdXRlIl0gPSA3MjI7CiAgICAgICAgdFsiYXRpbGRlIl0gPSA1MDA7CiAgICAgICAgdFsiRWRvdGFjY2VudCJdID0gNjY3OwogICAgICAgIHRbInNjYXJvbiJdID0gMzg5OwogICAgICAgIHRbInNjZWRpbGxhIl0gPSAzODk7CiAgICAgICAgdFsiaWFjdXRlIl0gPSAyNzg7CiAgICAgICAgdFsibG96ZW5nZSJdID0gNDk0OwogICAgICAgIHRbIlJjYXJvbiJdID0gNzIyOwogICAgICAgIHRbIkdjb21tYWFjY2VudCJdID0gNzc4OwogICAgICAgIHRbInVjaXJjdW1mbGV4Il0gPSA1NTY7CiAgICAgICAgdFsiYWNpcmN1bWZsZXgiXSA9IDUwMDsKICAgICAgICB0WyJBbWFjcm9uIl0gPSA3MjI7CiAgICAgICAgdFsicmNhcm9uIl0gPSA0NDQ7CiAgICAgICAgdFsiY2NlZGlsbGEiXSA9IDQ0NDsKICAgICAgICB0WyJaZG90YWNjZW50Il0gPSA2Njc7CiAgICAgICAgdFsiVGhvcm4iXSA9IDYxMTsKICAgICAgICB0WyJPbWFjcm9uIl0gPSA3Nzg7CiAgICAgICAgdFsiUmFjdXRlIl0gPSA3MjI7CiAgICAgICAgdFsiU2FjdXRlIl0gPSA1NTY7CiAgICAgICAgdFsiZGNhcm9uIl0gPSA2NzI7CiAgICAgICAgdFsiVW1hY3JvbiJdID0gNzIyOwogICAgICAgIHRbInVyaW5nIl0gPSA1NTY7CiAgICAgICAgdFsidGhyZWVzdXBlcmlvciJdID0gMzAwOwogICAgICAgIHRbIk9ncmF2ZSJdID0gNzc4OwogICAgICAgIHRbIkFncmF2ZSJdID0gNzIyOwogICAgICAgIHRbIkFicmV2ZSJdID0gNzIyOwogICAgICAgIHRbIm11bHRpcGx5Il0gPSA1NzA7CiAgICAgICAgdFsidWFjdXRlIl0gPSA1NTY7CiAgICAgICAgdFsiVGNhcm9uIl0gPSA2Njc7CiAgICAgICAgdFsicGFydGlhbGRpZmYiXSA9IDQ5NDsKICAgICAgICB0WyJ5ZGllcmVzaXMiXSA9IDUwMDsKICAgICAgICB0WyJOYWN1dGUiXSA9IDcyMjsKICAgICAgICB0WyJpY2lyY3VtZmxleCJdID0gMjc4OwogICAgICAgIHRbIkVjaXJjdW1mbGV4Il0gPSA2Njc7CiAgICAgICAgdFsiYWRpZXJlc2lzIl0gPSA1MDA7CiAgICAgICAgdFsiZWRpZXJlc2lzIl0gPSA0NDQ7CiAgICAgICAgdFsiY2FjdXRlIl0gPSA0NDQ7CiAgICAgICAgdFsibmFjdXRlIl0gPSA1NTY7CiAgICAgICAgdFsidW1hY3JvbiJdID0gNTU2OwogICAgICAgIHRbIk5jYXJvbiJdID0gNzIyOwogICAgICAgIHRbIklhY3V0ZSJdID0gMzg5OwogICAgICAgIHRbInBsdXNtaW51cyJdID0gNTcwOwogICAgICAgIHRbImJyb2tlbmJhciJdID0gMjIwOwogICAgICAgIHRbInJlZ2lzdGVyZWQiXSA9IDc0NzsKICAgICAgICB0WyJHYnJldmUiXSA9IDc3ODsKICAgICAgICB0WyJJZG90YWNjZW50Il0gPSAzODk7CiAgICAgICAgdFsic3VtbWF0aW9uIl0gPSA2MDA7CiAgICAgICAgdFsiRWdyYXZlIl0gPSA2Njc7CiAgICAgICAgdFsicmFjdXRlIl0gPSA0NDQ7CiAgICAgICAgdFsib21hY3JvbiJdID0gNTAwOwogICAgICAgIHRbIlphY3V0ZSJdID0gNjY3OwogICAgICAgIHRbIlpjYXJvbiJdID0gNjY3OwogICAgICAgIHRbImdyZWF0ZXJlcXVhbCJdID0gNTQ5OwogICAgICAgIHRbIkV0aCJdID0gNzIyOwogICAgICAgIHRbIkNjZWRpbGxhIl0gPSA3MjI7CiAgICAgICAgdFsibGNvbW1hYWNjZW50Il0gPSAyNzg7CiAgICAgICAgdFsidGNhcm9uIl0gPSA0MTY7CiAgICAgICAgdFsiZW9nb25layJdID0gNDQ0OwogICAgICAgIHRbIlVvZ29uZWsiXSA9IDcyMjsKICAgICAgICB0WyJBYWN1dGUiXSA9IDcyMjsKICAgICAgICB0WyJBZGllcmVzaXMiXSA9IDcyMjsKICAgICAgICB0WyJlZ3JhdmUiXSA9IDQ0NDsKICAgICAgICB0WyJ6YWN1dGUiXSA9IDQ0NDsKICAgICAgICB0WyJpb2dvbmVrIl0gPSAyNzg7CiAgICAgICAgdFsiT2FjdXRlIl0gPSA3Nzg7CiAgICAgICAgdFsib2FjdXRlIl0gPSA1MDA7CiAgICAgICAgdFsiYW1hY3JvbiJdID0gNTAwOwogICAgICAgIHRbInNhY3V0ZSJdID0gMzg5OwogICAgICAgIHRbImlkaWVyZXNpcyJdID0gMjc4OwogICAgICAgIHRbIk9jaXJjdW1mbGV4Il0gPSA3Nzg7CiAgICAgICAgdFsiVWdyYXZlIl0gPSA3MjI7CiAgICAgICAgdFsiRGVsdGEiXSA9IDYxMjsKICAgICAgICB0WyJ0aG9ybiJdID0gNTU2OwogICAgICAgIHRbInR3b3N1cGVyaW9yIl0gPSAzMDA7CiAgICAgICAgdFsiT2RpZXJlc2lzIl0gPSA3Nzg7CiAgICAgICAgdFsibXUiXSA9IDU1NjsKICAgICAgICB0WyJpZ3JhdmUiXSA9IDI3ODsKICAgICAgICB0WyJvaHVuZ2FydW1sYXV0Il0gPSA1MDA7CiAgICAgICAgdFsiRW9nb25layJdID0gNjY3OwogICAgICAgIHRbImRjcm9hdCJdID0gNTU2OwogICAgICAgIHRbInRocmVlcXVhcnRlcnMiXSA9IDc1MDsKICAgICAgICB0WyJTY2VkaWxsYSJdID0gNTU2OwogICAgICAgIHRbImxjYXJvbiJdID0gMzk0OwogICAgICAgIHRbIktjb21tYWFjY2VudCJdID0gNzc4OwogICAgICAgIHRbIkxhY3V0ZSJdID0gNjY3OwogICAgICAgIHRbInRyYWRlbWFyayJdID0gMTAwMDsKICAgICAgICB0WyJlZG90YWNjZW50Il0gPSA0NDQ7CiAgICAgICAgdFsiSWdyYXZlIl0gPSAzODk7CiAgICAgICAgdFsiSW1hY3JvbiJdID0gMzg5OwogICAgICAgIHRbIkxjYXJvbiJdID0gNjY3OwogICAgICAgIHRbIm9uZWhhbGYiXSA9IDc1MDsKICAgICAgICB0WyJsZXNzZXF1YWwiXSA9IDU0OTsKICAgICAgICB0WyJvY2lyY3VtZmxleCJdID0gNTAwOwogICAgICAgIHRbIm50aWxkZSJdID0gNTU2OwogICAgICAgIHRbIlVodW5nYXJ1bWxhdXQiXSA9IDcyMjsKICAgICAgICB0WyJFYWN1dGUiXSA9IDY2NzsKICAgICAgICB0WyJlbWFjcm9uIl0gPSA0NDQ7CiAgICAgICAgdFsiZ2JyZXZlIl0gPSA1MDA7CiAgICAgICAgdFsib25lcXVhcnRlciJdID0gNzUwOwogICAgICAgIHRbIlNjYXJvbiJdID0gNTU2OwogICAgICAgIHRbIlNjb21tYWFjY2VudCJdID0gNTU2OwogICAgICAgIHRbIk9odW5nYXJ1bWxhdXQiXSA9IDc3ODsKICAgICAgICB0WyJkZWdyZWUiXSA9IDQwMDsKICAgICAgICB0WyJvZ3JhdmUiXSA9IDUwMDsKICAgICAgICB0WyJDY2Fyb24iXSA9IDcyMjsKICAgICAgICB0WyJ1Z3JhdmUiXSA9IDU1NjsKICAgICAgICB0WyJyYWRpY2FsIl0gPSA1NDk7CiAgICAgICAgdFsiRGNhcm9uIl0gPSA3MjI7CiAgICAgICAgdFsicmNvbW1hYWNjZW50Il0gPSA0NDQ7CiAgICAgICAgdFsiTnRpbGRlIl0gPSA3MjI7CiAgICAgICAgdFsib3RpbGRlIl0gPSA1MDA7CiAgICAgICAgdFsiUmNvbW1hYWNjZW50Il0gPSA3MjI7CiAgICAgICAgdFsiTGNvbW1hYWNjZW50Il0gPSA2Njc7CiAgICAgICAgdFsiQXRpbGRlIl0gPSA3MjI7CiAgICAgICAgdFsiQW9nb25layJdID0gNzIyOwogICAgICAgIHRbIkFyaW5nIl0gPSA3MjI7CiAgICAgICAgdFsiT3RpbGRlIl0gPSA3Nzg7CiAgICAgICAgdFsiemRvdGFjY2VudCJdID0gNDQ0OwogICAgICAgIHRbIkVjYXJvbiJdID0gNjY3OwogICAgICAgIHRbIklvZ29uZWsiXSA9IDM4OTsKICAgICAgICB0WyJrY29tbWFhY2NlbnQiXSA9IDU1NjsKICAgICAgICB0WyJtaW51cyJdID0gNTcwOwogICAgICAgIHRbIkljaXJjdW1mbGV4Il0gPSAzODk7CiAgICAgICAgdFsibmNhcm9uIl0gPSA1NTY7CiAgICAgICAgdFsidGNvbW1hYWNjZW50Il0gPSAzMzM7CiAgICAgICAgdFsibG9naWNhbG5vdCJdID0gNTcwOwogICAgICAgIHRbIm9kaWVyZXNpcyJdID0gNTAwOwogICAgICAgIHRbInVkaWVyZXNpcyJdID0gNTU2OwogICAgICAgIHRbIm5vdGVxdWFsIl0gPSA1NDk7CiAgICAgICAgdFsiZ2NvbW1hYWNjZW50Il0gPSA1MDA7CiAgICAgICAgdFsiZXRoIl0gPSA1MDA7CiAgICAgICAgdFsiemNhcm9uIl0gPSA0NDQ7CiAgICAgICAgdFsibmNvbW1hYWNjZW50Il0gPSA1NTY7CiAgICAgICAgdFsib25lc3VwZXJpb3IiXSA9IDMwMDsKICAgICAgICB0WyJpbWFjcm9uIl0gPSAyNzg7CiAgICAgICAgdFsiRXVybyJdID0gNTAwOwogICAgICB9KTsKICAgICAgdFsiVGltZXMtQm9sZEl0YWxpYyJdID0gKDAsIF9jb3JlX3V0aWxzLmdldExvb2t1cFRhYmxlRmFjdG9yeSkoZnVuY3Rpb24gKHQpIHsKICAgICAgICB0WyJzcGFjZSJdID0gMjUwOwogICAgICAgIHRbImV4Y2xhbSJdID0gMzg5OwogICAgICAgIHRbInF1b3RlZGJsIl0gPSA1NTU7CiAgICAgICAgdFsibnVtYmVyc2lnbiJdID0gNTAwOwogICAgICAgIHRbImRvbGxhciJdID0gNTAwOwogICAgICAgIHRbInBlcmNlbnQiXSA9IDgzMzsKICAgICAgICB0WyJhbXBlcnNhbmQiXSA9IDc3ODsKICAgICAgICB0WyJxdW90ZXJpZ2h0Il0gPSAzMzM7CiAgICAgICAgdFsicGFyZW5sZWZ0Il0gPSAzMzM7CiAgICAgICAgdFsicGFyZW5yaWdodCJdID0gMzMzOwogICAgICAgIHRbImFzdGVyaXNrIl0gPSA1MDA7CiAgICAgICAgdFsicGx1cyJdID0gNTcwOwogICAgICAgIHRbImNvbW1hIl0gPSAyNTA7CiAgICAgICAgdFsiaHlwaGVuIl0gPSAzMzM7CiAgICAgICAgdFsicGVyaW9kIl0gPSAyNTA7CiAgICAgICAgdFsic2xhc2giXSA9IDI3ODsKICAgICAgICB0WyJ6ZXJvIl0gPSA1MDA7CiAgICAgICAgdFsib25lIl0gPSA1MDA7CiAgICAgICAgdFsidHdvIl0gPSA1MDA7CiAgICAgICAgdFsidGhyZWUiXSA9IDUwMDsKICAgICAgICB0WyJmb3VyIl0gPSA1MDA7CiAgICAgICAgdFsiZml2ZSJdID0gNTAwOwogICAgICAgIHRbInNpeCJdID0gNTAwOwogICAgICAgIHRbInNldmVuIl0gPSA1MDA7CiAgICAgICAgdFsiZWlnaHQiXSA9IDUwMDsKICAgICAgICB0WyJuaW5lIl0gPSA1MDA7CiAgICAgICAgdFsiY29sb24iXSA9IDMzMzsKICAgICAgICB0WyJzZW1pY29sb24iXSA9IDMzMzsKICAgICAgICB0WyJsZXNzIl0gPSA1NzA7CiAgICAgICAgdFsiZXF1YWwiXSA9IDU3MDsKICAgICAgICB0WyJncmVhdGVyIl0gPSA1NzA7CiAgICAgICAgdFsicXVlc3Rpb24iXSA9IDUwMDsKICAgICAgICB0WyJhdCJdID0gODMyOwogICAgICAgIHRbIkEiXSA9IDY2NzsKICAgICAgICB0WyJCIl0gPSA2Njc7CiAgICAgICAgdFsiQyJdID0gNjY3OwogICAgICAgIHRbIkQiXSA9IDcyMjsKICAgICAgICB0WyJFIl0gPSA2Njc7CiAgICAgICAgdFsiRiJdID0gNjY3OwogICAgICAgIHRbIkciXSA9IDcyMjsKICAgICAgICB0WyJIIl0gPSA3Nzg7CiAgICAgICAgdFsiSSJdID0gMzg5OwogICAgICAgIHRbIkoiXSA9IDUwMDsKICAgICAgICB0WyJLIl0gPSA2Njc7CiAgICAgICAgdFsiTCJdID0gNjExOwogICAgICAgIHRbIk0iXSA9IDg4OTsKICAgICAgICB0WyJOIl0gPSA3MjI7CiAgICAgICAgdFsiTyJdID0gNzIyOwogICAgICAgIHRbIlAiXSA9IDYxMTsKICAgICAgICB0WyJRIl0gPSA3MjI7CiAgICAgICAgdFsiUiJdID0gNjY3OwogICAgICAgIHRbIlMiXSA9IDU1NjsKICAgICAgICB0WyJUIl0gPSA2MTE7CiAgICAgICAgdFsiVSJdID0gNzIyOwogICAgICAgIHRbIlYiXSA9IDY2NzsKICAgICAgICB0WyJXIl0gPSA4ODk7CiAgICAgICAgdFsiWCJdID0gNjY3OwogICAgICAgIHRbIlkiXSA9IDYxMTsKICAgICAgICB0WyJaIl0gPSA2MTE7CiAgICAgICAgdFsiYnJhY2tldGxlZnQiXSA9IDMzMzsKICAgICAgICB0WyJiYWNrc2xhc2giXSA9IDI3ODsKICAgICAgICB0WyJicmFja2V0cmlnaHQiXSA9IDMzMzsKICAgICAgICB0WyJhc2NpaWNpcmN1bSJdID0gNTcwOwogICAgICAgIHRbInVuZGVyc2NvcmUiXSA9IDUwMDsKICAgICAgICB0WyJxdW90ZWxlZnQiXSA9IDMzMzsKICAgICAgICB0WyJhIl0gPSA1MDA7CiAgICAgICAgdFsiYiJdID0gNTAwOwogICAgICAgIHRbImMiXSA9IDQ0NDsKICAgICAgICB0WyJkIl0gPSA1MDA7CiAgICAgICAgdFsiZSJdID0gNDQ0OwogICAgICAgIHRbImYiXSA9IDMzMzsKICAgICAgICB0WyJnIl0gPSA1MDA7CiAgICAgICAgdFsiaCJdID0gNTU2OwogICAgICAgIHRbImkiXSA9IDI3ODsKICAgICAgICB0WyJqIl0gPSAyNzg7CiAgICAgICAgdFsiayJdID0gNTAwOwogICAgICAgIHRbImwiXSA9IDI3ODsKICAgICAgICB0WyJtIl0gPSA3Nzg7CiAgICAgICAgdFsibiJdID0gNTU2OwogICAgICAgIHRbIm8iXSA9IDUwMDsKICAgICAgICB0WyJwIl0gPSA1MDA7CiAgICAgICAgdFsicSJdID0gNTAwOwogICAgICAgIHRbInIiXSA9IDM4OTsKICAgICAgICB0WyJzIl0gPSAzODk7CiAgICAgICAgdFsidCJdID0gMjc4OwogICAgICAgIHRbInUiXSA9IDU1NjsKICAgICAgICB0WyJ2Il0gPSA0NDQ7CiAgICAgICAgdFsidyJdID0gNjY3OwogICAgICAgIHRbIngiXSA9IDUwMDsKICAgICAgICB0WyJ5Il0gPSA0NDQ7CiAgICAgICAgdFsieiJdID0gMzg5OwogICAgICAgIHRbImJyYWNlbGVmdCJdID0gMzQ4OwogICAgICAgIHRbImJhciJdID0gMjIwOwogICAgICAgIHRbImJyYWNlcmlnaHQiXSA9IDM0ODsKICAgICAgICB0WyJhc2NpaXRpbGRlIl0gPSA1NzA7CiAgICAgICAgdFsiZXhjbGFtZG93biJdID0gMzg5OwogICAgICAgIHRbImNlbnQiXSA9IDUwMDsKICAgICAgICB0WyJzdGVybGluZyJdID0gNTAwOwogICAgICAgIHRbImZyYWN0aW9uIl0gPSAxNjc7CiAgICAgICAgdFsieWVuIl0gPSA1MDA7CiAgICAgICAgdFsiZmxvcmluIl0gPSA1MDA7CiAgICAgICAgdFsic2VjdGlvbiJdID0gNTAwOwogICAgICAgIHRbImN1cnJlbmN5Il0gPSA1MDA7CiAgICAgICAgdFsicXVvdGVzaW5nbGUiXSA9IDI3ODsKICAgICAgICB0WyJxdW90ZWRibGxlZnQiXSA9IDUwMDsKICAgICAgICB0WyJndWlsbGVtb3RsZWZ0Il0gPSA1MDA7CiAgICAgICAgdFsiZ3VpbHNpbmdsbGVmdCJdID0gMzMzOwogICAgICAgIHRbImd1aWxzaW5nbHJpZ2h0Il0gPSAzMzM7CiAgICAgICAgdFsiZmkiXSA9IDU1NjsKICAgICAgICB0WyJmbCJdID0gNTU2OwogICAgICAgIHRbImVuZGFzaCJdID0gNTAwOwogICAgICAgIHRbImRhZ2dlciJdID0gNTAwOwogICAgICAgIHRbImRhZ2dlcmRibCJdID0gNTAwOwogICAgICAgIHRbInBlcmlvZGNlbnRlcmVkIl0gPSAyNTA7CiAgICAgICAgdFsicGFyYWdyYXBoIl0gPSA1MDA7CiAgICAgICAgdFsiYnVsbGV0Il0gPSAzNTA7CiAgICAgICAgdFsicXVvdGVzaW5nbGJhc2UiXSA9IDMzMzsKICAgICAgICB0WyJxdW90ZWRibGJhc2UiXSA9IDUwMDsKICAgICAgICB0WyJxdW90ZWRibHJpZ2h0Il0gPSA1MDA7CiAgICAgICAgdFsiZ3VpbGxlbW90cmlnaHQiXSA9IDUwMDsKICAgICAgICB0WyJlbGxpcHNpcyJdID0gMTAwMDsKICAgICAgICB0WyJwZXJ0aG91c2FuZCJdID0gMTAwMDsKICAgICAgICB0WyJxdWVzdGlvbmRvd24iXSA9IDUwMDsKICAgICAgICB0WyJncmF2ZSJdID0gMzMzOwogICAgICAgIHRbImFjdXRlIl0gPSAzMzM7CiAgICAgICAgdFsiY2lyY3VtZmxleCJdID0gMzMzOwogICAgICAgIHRbInRpbGRlIl0gPSAzMzM7CiAgICAgICAgdFsibWFjcm9uIl0gPSAzMzM7CiAgICAgICAgdFsiYnJldmUiXSA9IDMzMzsKICAgICAgICB0WyJkb3RhY2NlbnQiXSA9IDMzMzsKICAgICAgICB0WyJkaWVyZXNpcyJdID0gMzMzOwogICAgICAgIHRbInJpbmciXSA9IDMzMzsKICAgICAgICB0WyJjZWRpbGxhIl0gPSAzMzM7CiAgICAgICAgdFsiaHVuZ2FydW1sYXV0Il0gPSAzMzM7CiAgICAgICAgdFsib2dvbmVrIl0gPSAzMzM7CiAgICAgICAgdFsiY2Fyb24iXSA9IDMzMzsKICAgICAgICB0WyJlbWRhc2giXSA9IDEwMDA7CiAgICAgICAgdFsiQUUiXSA9IDk0NDsKICAgICAgICB0WyJvcmRmZW1pbmluZSJdID0gMjY2OwogICAgICAgIHRbIkxzbGFzaCJdID0gNjExOwogICAgICAgIHRbIk9zbGFzaCJdID0gNzIyOwogICAgICAgIHRbIk9FIl0gPSA5NDQ7CiAgICAgICAgdFsib3JkbWFzY3VsaW5lIl0gPSAzMDA7CiAgICAgICAgdFsiYWUiXSA9IDcyMjsKICAgICAgICB0WyJkb3RsZXNzaSJdID0gMjc4OwogICAgICAgIHRbImxzbGFzaCJdID0gMjc4OwogICAgICAgIHRbIm9zbGFzaCJdID0gNTAwOwogICAgICAgIHRbIm9lIl0gPSA3MjI7CiAgICAgICAgdFsiZ2VybWFuZGJscyJdID0gNTAwOwogICAgICAgIHRbIklkaWVyZXNpcyJdID0gMzg5OwogICAgICAgIHRbImVhY3V0ZSJdID0gNDQ0OwogICAgICAgIHRbImFicmV2ZSJdID0gNTAwOwogICAgICAgIHRbInVodW5nYXJ1bWxhdXQiXSA9IDU1NjsKICAgICAgICB0WyJlY2Fyb24iXSA9IDQ0NDsKICAgICAgICB0WyJZZGllcmVzaXMiXSA9IDYxMTsKICAgICAgICB0WyJkaXZpZGUiXSA9IDU3MDsKICAgICAgICB0WyJZYWN1dGUiXSA9IDYxMTsKICAgICAgICB0WyJBY2lyY3VtZmxleCJdID0gNjY3OwogICAgICAgIHRbImFhY3V0ZSJdID0gNTAwOwogICAgICAgIHRbIlVjaXJjdW1mbGV4Il0gPSA3MjI7CiAgICAgICAgdFsieWFjdXRlIl0gPSA0NDQ7CiAgICAgICAgdFsic2NvbW1hYWNjZW50Il0gPSAzODk7CiAgICAgICAgdFsiZWNpcmN1bWZsZXgiXSA9IDQ0NDsKICAgICAgICB0WyJVcmluZyJdID0gNzIyOwogICAgICAgIHRbIlVkaWVyZXNpcyJdID0gNzIyOwogICAgICAgIHRbImFvZ29uZWsiXSA9IDUwMDsKICAgICAgICB0WyJVYWN1dGUiXSA9IDcyMjsKICAgICAgICB0WyJ1b2dvbmVrIl0gPSA1NTY7CiAgICAgICAgdFsiRWRpZXJlc2lzIl0gPSA2Njc7CiAgICAgICAgdFsiRGNyb2F0Il0gPSA3MjI7CiAgICAgICAgdFsiY29tbWFhY2NlbnQiXSA9IDI1MDsKICAgICAgICB0WyJjb3B5cmlnaHQiXSA9IDc0NzsKICAgICAgICB0WyJFbWFjcm9uIl0gPSA2Njc7CiAgICAgICAgdFsiY2Nhcm9uIl0gPSA0NDQ7CiAgICAgICAgdFsiYXJpbmciXSA9IDUwMDsKICAgICAgICB0WyJOY29tbWFhY2NlbnQiXSA9IDcyMjsKICAgICAgICB0WyJsYWN1dGUiXSA9IDI3ODsKICAgICAgICB0WyJhZ3JhdmUiXSA9IDUwMDsKICAgICAgICB0WyJUY29tbWFhY2NlbnQiXSA9IDYxMTsKICAgICAgICB0WyJDYWN1dGUiXSA9IDY2NzsKICAgICAgICB0WyJhdGlsZGUiXSA9IDUwMDsKICAgICAgICB0WyJFZG90YWNjZW50Il0gPSA2Njc7CiAgICAgICAgdFsic2Nhcm9uIl0gPSAzODk7CiAgICAgICAgdFsic2NlZGlsbGEiXSA9IDM4OTsKICAgICAgICB0WyJpYWN1dGUiXSA9IDI3ODsKICAgICAgICB0WyJsb3plbmdlIl0gPSA0OTQ7CiAgICAgICAgdFsiUmNhcm9uIl0gPSA2Njc7CiAgICAgICAgdFsiR2NvbW1hYWNjZW50Il0gPSA3MjI7CiAgICAgICAgdFsidWNpcmN1bWZsZXgiXSA9IDU1NjsKICAgICAgICB0WyJhY2lyY3VtZmxleCJdID0gNTAwOwogICAgICAgIHRbIkFtYWNyb24iXSA9IDY2NzsKICAgICAgICB0WyJyY2Fyb24iXSA9IDM4OTsKICAgICAgICB0WyJjY2VkaWxsYSJdID0gNDQ0OwogICAgICAgIHRbIlpkb3RhY2NlbnQiXSA9IDYxMTsKICAgICAgICB0WyJUaG9ybiJdID0gNjExOwogICAgICAgIHRbIk9tYWNyb24iXSA9IDcyMjsKICAgICAgICB0WyJSYWN1dGUiXSA9IDY2NzsKICAgICAgICB0WyJTYWN1dGUiXSA9IDU1NjsKICAgICAgICB0WyJkY2Fyb24iXSA9IDYwODsKICAgICAgICB0WyJVbWFjcm9uIl0gPSA3MjI7CiAgICAgICAgdFsidXJpbmciXSA9IDU1NjsKICAgICAgICB0WyJ0aHJlZXN1cGVyaW9yIl0gPSAzMDA7CiAgICAgICAgdFsiT2dyYXZlIl0gPSA3MjI7CiAgICAgICAgdFsiQWdyYXZlIl0gPSA2Njc7CiAgICAgICAgdFsiQWJyZXZlIl0gPSA2Njc7CiAgICAgICAgdFsibXVsdGlwbHkiXSA9IDU3MDsKICAgICAgICB0WyJ1YWN1dGUiXSA9IDU1NjsKICAgICAgICB0WyJUY2Fyb24iXSA9IDYxMTsKICAgICAgICB0WyJwYXJ0aWFsZGlmZiJdID0gNDk0OwogICAgICAgIHRbInlkaWVyZXNpcyJdID0gNDQ0OwogICAgICAgIHRbIk5hY3V0ZSJdID0gNzIyOwogICAgICAgIHRbImljaXJjdW1mbGV4Il0gPSAyNzg7CiAgICAgICAgdFsiRWNpcmN1bWZsZXgiXSA9IDY2NzsKICAgICAgICB0WyJhZGllcmVzaXMiXSA9IDUwMDsKICAgICAgICB0WyJlZGllcmVzaXMiXSA9IDQ0NDsKICAgICAgICB0WyJjYWN1dGUiXSA9IDQ0NDsKICAgICAgICB0WyJuYWN1dGUiXSA9IDU1NjsKICAgICAgICB0WyJ1bWFjcm9uIl0gPSA1NTY7CiAgICAgICAgdFsiTmNhcm9uIl0gPSA3MjI7CiAgICAgICAgdFsiSWFjdXRlIl0gPSAzODk7CiAgICAgICAgdFsicGx1c21pbnVzIl0gPSA1NzA7CiAgICAgICAgdFsiYnJva2VuYmFyIl0gPSAyMjA7CiAgICAgICAgdFsicmVnaXN0ZXJlZCJdID0gNzQ3OwogICAgICAgIHRbIkdicmV2ZSJdID0gNzIyOwogICAgICAgIHRbIklkb3RhY2NlbnQiXSA9IDM4OTsKICAgICAgICB0WyJzdW1tYXRpb24iXSA9IDYwMDsKICAgICAgICB0WyJFZ3JhdmUiXSA9IDY2NzsKICAgICAgICB0WyJyYWN1dGUiXSA9IDM4OTsKICAgICAgICB0WyJvbWFjcm9uIl0gPSA1MDA7CiAgICAgICAgdFsiWmFjdXRlIl0gPSA2MTE7CiAgICAgICAgdFsiWmNhcm9uIl0gPSA2MTE7CiAgICAgICAgdFsiZ3JlYXRlcmVxdWFsIl0gPSA1NDk7CiAgICAgICAgdFsiRXRoIl0gPSA3MjI7CiAgICAgICAgdFsiQ2NlZGlsbGEiXSA9IDY2NzsKICAgICAgICB0WyJsY29tbWFhY2NlbnQiXSA9IDI3ODsKICAgICAgICB0WyJ0Y2Fyb24iXSA9IDM2NjsKICAgICAgICB0WyJlb2dvbmVrIl0gPSA0NDQ7CiAgICAgICAgdFsiVW9nb25layJdID0gNzIyOwogICAgICAgIHRbIkFhY3V0ZSJdID0gNjY3OwogICAgICAgIHRbIkFkaWVyZXNpcyJdID0gNjY3OwogICAgICAgIHRbImVncmF2ZSJdID0gNDQ0OwogICAgICAgIHRbInphY3V0ZSJdID0gMzg5OwogICAgICAgIHRbImlvZ29uZWsiXSA9IDI3ODsKICAgICAgICB0WyJPYWN1dGUiXSA9IDcyMjsKICAgICAgICB0WyJvYWN1dGUiXSA9IDUwMDsKICAgICAgICB0WyJhbWFjcm9uIl0gPSA1MDA7CiAgICAgICAgdFsic2FjdXRlIl0gPSAzODk7CiAgICAgICAgdFsiaWRpZXJlc2lzIl0gPSAyNzg7CiAgICAgICAgdFsiT2NpcmN1bWZsZXgiXSA9IDcyMjsKICAgICAgICB0WyJVZ3JhdmUiXSA9IDcyMjsKICAgICAgICB0WyJEZWx0YSJdID0gNjEyOwogICAgICAgIHRbInRob3JuIl0gPSA1MDA7CiAgICAgICAgdFsidHdvc3VwZXJpb3IiXSA9IDMwMDsKICAgICAgICB0WyJPZGllcmVzaXMiXSA9IDcyMjsKICAgICAgICB0WyJtdSJdID0gNTc2OwogICAgICAgIHRbImlncmF2ZSJdID0gMjc4OwogICAgICAgIHRbIm9odW5nYXJ1bWxhdXQiXSA9IDUwMDsKICAgICAgICB0WyJFb2dvbmVrIl0gPSA2Njc7CiAgICAgICAgdFsiZGNyb2F0Il0gPSA1MDA7CiAgICAgICAgdFsidGhyZWVxdWFydGVycyJdID0gNzUwOwogICAgICAgIHRbIlNjZWRpbGxhIl0gPSA1NTY7CiAgICAgICAgdFsibGNhcm9uIl0gPSAzODI7CiAgICAgICAgdFsiS2NvbW1hYWNjZW50Il0gPSA2Njc7CiAgICAgICAgdFsiTGFjdXRlIl0gPSA2MTE7CiAgICAgICAgdFsidHJhZGVtYXJrIl0gPSAxMDAwOwogICAgICAgIHRbImVkb3RhY2NlbnQiXSA9IDQ0NDsKICAgICAgICB0WyJJZ3JhdmUiXSA9IDM4OTsKICAgICAgICB0WyJJbWFjcm9uIl0gPSAzODk7CiAgICAgICAgdFsiTGNhcm9uIl0gPSA2MTE7CiAgICAgICAgdFsib25laGFsZiJdID0gNzUwOwogICAgICAgIHRbImxlc3NlcXVhbCJdID0gNTQ5OwogICAgICAgIHRbIm9jaXJjdW1mbGV4Il0gPSA1MDA7CiAgICAgICAgdFsibnRpbGRlIl0gPSA1NTY7CiAgICAgICAgdFsiVWh1bmdhcnVtbGF1dCJdID0gNzIyOwogICAgICAgIHRbIkVhY3V0ZSJdID0gNjY3OwogICAgICAgIHRbImVtYWNyb24iXSA9IDQ0NDsKICAgICAgICB0WyJnYnJldmUiXSA9IDUwMDsKICAgICAgICB0WyJvbmVxdWFydGVyIl0gPSA3NTA7CiAgICAgICAgdFsiU2Nhcm9uIl0gPSA1NTY7CiAgICAgICAgdFsiU2NvbW1hYWNjZW50Il0gPSA1NTY7CiAgICAgICAgdFsiT2h1bmdhcnVtbGF1dCJdID0gNzIyOwogICAgICAgIHRbImRlZ3JlZSJdID0gNDAwOwogICAgICAgIHRbIm9ncmF2ZSJdID0gNTAwOwogICAgICAgIHRbIkNjYXJvbiJdID0gNjY3OwogICAgICAgIHRbInVncmF2ZSJdID0gNTU2OwogICAgICAgIHRbInJhZGljYWwiXSA9IDU0OTsKICAgICAgICB0WyJEY2Fyb24iXSA9IDcyMjsKICAgICAgICB0WyJyY29tbWFhY2NlbnQiXSA9IDM4OTsKICAgICAgICB0WyJOdGlsZGUiXSA9IDcyMjsKICAgICAgICB0WyJvdGlsZGUiXSA9IDUwMDsKICAgICAgICB0WyJSY29tbWFhY2NlbnQiXSA9IDY2NzsKICAgICAgICB0WyJMY29tbWFhY2NlbnQiXSA9IDYxMTsKICAgICAgICB0WyJBdGlsZGUiXSA9IDY2NzsKICAgICAgICB0WyJBb2dvbmVrIl0gPSA2Njc7CiAgICAgICAgdFsiQXJpbmciXSA9IDY2NzsKICAgICAgICB0WyJPdGlsZGUiXSA9IDcyMjsKICAgICAgICB0WyJ6ZG90YWNjZW50Il0gPSAzODk7CiAgICAgICAgdFsiRWNhcm9uIl0gPSA2Njc7CiAgICAgICAgdFsiSW9nb25layJdID0gMzg5OwogICAgICAgIHRbImtjb21tYWFjY2VudCJdID0gNTAwOwogICAgICAgIHRbIm1pbnVzIl0gPSA2MDY7CiAgICAgICAgdFsiSWNpcmN1bWZsZXgiXSA9IDM4OTsKICAgICAgICB0WyJuY2Fyb24iXSA9IDU1NjsKICAgICAgICB0WyJ0Y29tbWFhY2NlbnQiXSA9IDI3ODsKICAgICAgICB0WyJsb2dpY2Fsbm90Il0gPSA2MDY7CiAgICAgICAgdFsib2RpZXJlc2lzIl0gPSA1MDA7CiAgICAgICAgdFsidWRpZXJlc2lzIl0gPSA1NTY7CiAgICAgICAgdFsibm90ZXF1YWwiXSA9IDU0OTsKICAgICAgICB0WyJnY29tbWFhY2NlbnQiXSA9IDUwMDsKICAgICAgICB0WyJldGgiXSA9IDUwMDsKICAgICAgICB0WyJ6Y2Fyb24iXSA9IDM4OTsKICAgICAgICB0WyJuY29tbWFhY2NlbnQiXSA9IDU1NjsKICAgICAgICB0WyJvbmVzdXBlcmlvciJdID0gMzAwOwogICAgICAgIHRbImltYWNyb24iXSA9IDI3ODsKICAgICAgICB0WyJFdXJvIl0gPSA1MDA7CiAgICAgIH0pOwogICAgICB0WyJUaW1lcy1JdGFsaWMiXSA9ICgwLCBfY29yZV91dGlscy5nZXRMb29rdXBUYWJsZUZhY3RvcnkpKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdFsic3BhY2UiXSA9IDI1MDsKICAgICAgICB0WyJleGNsYW0iXSA9IDMzMzsKICAgICAgICB0WyJxdW90ZWRibCJdID0gNDIwOwogICAgICAgIHRbIm51bWJlcnNpZ24iXSA9IDUwMDsKICAgICAgICB0WyJkb2xsYXIiXSA9IDUwMDsKICAgICAgICB0WyJwZXJjZW50Il0gPSA4MzM7CiAgICAgICAgdFsiYW1wZXJzYW5kIl0gPSA3Nzg7CiAgICAgICAgdFsicXVvdGVyaWdodCJdID0gMzMzOwogICAgICAgIHRbInBhcmVubGVmdCJdID0gMzMzOwogICAgICAgIHRbInBhcmVucmlnaHQiXSA9IDMzMzsKICAgICAgICB0WyJhc3RlcmlzayJdID0gNTAwOwogICAgICAgIHRbInBsdXMiXSA9IDY3NTsKICAgICAgICB0WyJjb21tYSJdID0gMjUwOwogICAgICAgIHRbImh5cGhlbiJdID0gMzMzOwogICAgICAgIHRbInBlcmlvZCJdID0gMjUwOwogICAgICAgIHRbInNsYXNoIl0gPSAyNzg7CiAgICAgICAgdFsiemVybyJdID0gNTAwOwogICAgICAgIHRbIm9uZSJdID0gNTAwOwogICAgICAgIHRbInR3byJdID0gNTAwOwogICAgICAgIHRbInRocmVlIl0gPSA1MDA7CiAgICAgICAgdFsiZm91ciJdID0gNTAwOwogICAgICAgIHRbImZpdmUiXSA9IDUwMDsKICAgICAgICB0WyJzaXgiXSA9IDUwMDsKICAgICAgICB0WyJzZXZlbiJdID0gNTAwOwogICAgICAgIHRbImVpZ2h0Il0gPSA1MDA7CiAgICAgICAgdFsibmluZSJdID0gNTAwOwogICAgICAgIHRbImNvbG9uIl0gPSAzMzM7CiAgICAgICAgdFsic2VtaWNvbG9uIl0gPSAzMzM7CiAgICAgICAgdFsibGVzcyJdID0gNjc1OwogICAgICAgIHRbImVxdWFsIl0gPSA2NzU7CiAgICAgICAgdFsiZ3JlYXRlciJdID0gNjc1OwogICAgICAgIHRbInF1ZXN0aW9uIl0gPSA1MDA7CiAgICAgICAgdFsiYXQiXSA9IDkyMDsKICAgICAgICB0WyJBIl0gPSA2MTE7CiAgICAgICAgdFsiQiJdID0gNjExOwogICAgICAgIHRbIkMiXSA9IDY2NzsKICAgICAgICB0WyJEIl0gPSA3MjI7CiAgICAgICAgdFsiRSJdID0gNjExOwogICAgICAgIHRbIkYiXSA9IDYxMTsKICAgICAgICB0WyJHIl0gPSA3MjI7CiAgICAgICAgdFsiSCJdID0gNzIyOwogICAgICAgIHRbIkkiXSA9IDMzMzsKICAgICAgICB0WyJKIl0gPSA0NDQ7CiAgICAgICAgdFsiSyJdID0gNjY3OwogICAgICAgIHRbIkwiXSA9IDU1NjsKICAgICAgICB0WyJNIl0gPSA4MzM7CiAgICAgICAgdFsiTiJdID0gNjY3OwogICAgICAgIHRbIk8iXSA9IDcyMjsKICAgICAgICB0WyJQIl0gPSA2MTE7CiAgICAgICAgdFsiUSJdID0gNzIyOwogICAgICAgIHRbIlIiXSA9IDYxMTsKICAgICAgICB0WyJTIl0gPSA1MDA7CiAgICAgICAgdFsiVCJdID0gNTU2OwogICAgICAgIHRbIlUiXSA9IDcyMjsKICAgICAgICB0WyJWIl0gPSA2MTE7CiAgICAgICAgdFsiVyJdID0gODMzOwogICAgICAgIHRbIlgiXSA9IDYxMTsKICAgICAgICB0WyJZIl0gPSA1NTY7CiAgICAgICAgdFsiWiJdID0gNTU2OwogICAgICAgIHRbImJyYWNrZXRsZWZ0Il0gPSAzODk7CiAgICAgICAgdFsiYmFja3NsYXNoIl0gPSAyNzg7CiAgICAgICAgdFsiYnJhY2tldHJpZ2h0Il0gPSAzODk7CiAgICAgICAgdFsiYXNjaWljaXJjdW0iXSA9IDQyMjsKICAgICAgICB0WyJ1bmRlcnNjb3JlIl0gPSA1MDA7CiAgICAgICAgdFsicXVvdGVsZWZ0Il0gPSAzMzM7CiAgICAgICAgdFsiYSJdID0gNTAwOwogICAgICAgIHRbImIiXSA9IDUwMDsKICAgICAgICB0WyJjIl0gPSA0NDQ7CiAgICAgICAgdFsiZCJdID0gNTAwOwogICAgICAgIHRbImUiXSA9IDQ0NDsKICAgICAgICB0WyJmIl0gPSAyNzg7CiAgICAgICAgdFsiZyJdID0gNTAwOwogICAgICAgIHRbImgiXSA9IDUwMDsKICAgICAgICB0WyJpIl0gPSAyNzg7CiAgICAgICAgdFsiaiJdID0gMjc4OwogICAgICAgIHRbImsiXSA9IDQ0NDsKICAgICAgICB0WyJsIl0gPSAyNzg7CiAgICAgICAgdFsibSJdID0gNzIyOwogICAgICAgIHRbIm4iXSA9IDUwMDsKICAgICAgICB0WyJvIl0gPSA1MDA7CiAgICAgICAgdFsicCJdID0gNTAwOwogICAgICAgIHRbInEiXSA9IDUwMDsKICAgICAgICB0WyJyIl0gPSAzODk7CiAgICAgICAgdFsicyJdID0gMzg5OwogICAgICAgIHRbInQiXSA9IDI3ODsKICAgICAgICB0WyJ1Il0gPSA1MDA7CiAgICAgICAgdFsidiJdID0gNDQ0OwogICAgICAgIHRbInciXSA9IDY2NzsKICAgICAgICB0WyJ4Il0gPSA0NDQ7CiAgICAgICAgdFsieSJdID0gNDQ0OwogICAgICAgIHRbInoiXSA9IDM4OTsKICAgICAgICB0WyJicmFjZWxlZnQiXSA9IDQwMDsKICAgICAgICB0WyJiYXIiXSA9IDI3NTsKICAgICAgICB0WyJicmFjZXJpZ2h0Il0gPSA0MDA7CiAgICAgICAgdFsiYXNjaWl0aWxkZSJdID0gNTQxOwogICAgICAgIHRbImV4Y2xhbWRvd24iXSA9IDM4OTsKICAgICAgICB0WyJjZW50Il0gPSA1MDA7CiAgICAgICAgdFsic3RlcmxpbmciXSA9IDUwMDsKICAgICAgICB0WyJmcmFjdGlvbiJdID0gMTY3OwogICAgICAgIHRbInllbiJdID0gNTAwOwogICAgICAgIHRbImZsb3JpbiJdID0gNTAwOwogICAgICAgIHRbInNlY3Rpb24iXSA9IDUwMDsKICAgICAgICB0WyJjdXJyZW5jeSJdID0gNTAwOwogICAgICAgIHRbInF1b3Rlc2luZ2xlIl0gPSAyMTQ7CiAgICAgICAgdFsicXVvdGVkYmxsZWZ0Il0gPSA1NTY7CiAgICAgICAgdFsiZ3VpbGxlbW90bGVmdCJdID0gNTAwOwogICAgICAgIHRbImd1aWxzaW5nbGxlZnQiXSA9IDMzMzsKICAgICAgICB0WyJndWlsc2luZ2xyaWdodCJdID0gMzMzOwogICAgICAgIHRbImZpIl0gPSA1MDA7CiAgICAgICAgdFsiZmwiXSA9IDUwMDsKICAgICAgICB0WyJlbmRhc2giXSA9IDUwMDsKICAgICAgICB0WyJkYWdnZXIiXSA9IDUwMDsKICAgICAgICB0WyJkYWdnZXJkYmwiXSA9IDUwMDsKICAgICAgICB0WyJwZXJpb2RjZW50ZXJlZCJdID0gMjUwOwogICAgICAgIHRbInBhcmFncmFwaCJdID0gNTIzOwogICAgICAgIHRbImJ1bGxldCJdID0gMzUwOwogICAgICAgIHRbInF1b3Rlc2luZ2xiYXNlIl0gPSAzMzM7CiAgICAgICAgdFsicXVvdGVkYmxiYXNlIl0gPSA1NTY7CiAgICAgICAgdFsicXVvdGVkYmxyaWdodCJdID0gNTU2OwogICAgICAgIHRbImd1aWxsZW1vdHJpZ2h0Il0gPSA1MDA7CiAgICAgICAgdFsiZWxsaXBzaXMiXSA9IDg4OTsKICAgICAgICB0WyJwZXJ0aG91c2FuZCJdID0gMTAwMDsKICAgICAgICB0WyJxdWVzdGlvbmRvd24iXSA9IDUwMDsKICAgICAgICB0WyJncmF2ZSJdID0gMzMzOwogICAgICAgIHRbImFjdXRlIl0gPSAzMzM7CiAgICAgICAgdFsiY2lyY3VtZmxleCJdID0gMzMzOwogICAgICAgIHRbInRpbGRlIl0gPSAzMzM7CiAgICAgICAgdFsibWFjcm9uIl0gPSAzMzM7CiAgICAgICAgdFsiYnJldmUiXSA9IDMzMzsKICAgICAgICB0WyJkb3RhY2NlbnQiXSA9IDMzMzsKICAgICAgICB0WyJkaWVyZXNpcyJdID0gMzMzOwogICAgICAgIHRbInJpbmciXSA9IDMzMzsKICAgICAgICB0WyJjZWRpbGxhIl0gPSAzMzM7CiAgICAgICAgdFsiaHVuZ2FydW1sYXV0Il0gPSAzMzM7CiAgICAgICAgdFsib2dvbmVrIl0gPSAzMzM7CiAgICAgICAgdFsiY2Fyb24iXSA9IDMzMzsKICAgICAgICB0WyJlbWRhc2giXSA9IDg4OTsKICAgICAgICB0WyJBRSJdID0gODg5OwogICAgICAgIHRbIm9yZGZlbWluaW5lIl0gPSAyNzY7CiAgICAgICAgdFsiTHNsYXNoIl0gPSA1NTY7CiAgICAgICAgdFsiT3NsYXNoIl0gPSA3MjI7CiAgICAgICAgdFsiT0UiXSA9IDk0NDsKICAgICAgICB0WyJvcmRtYXNjdWxpbmUiXSA9IDMxMDsKICAgICAgICB0WyJhZSJdID0gNjY3OwogICAgICAgIHRbImRvdGxlc3NpIl0gPSAyNzg7CiAgICAgICAgdFsibHNsYXNoIl0gPSAyNzg7CiAgICAgICAgdFsib3NsYXNoIl0gPSA1MDA7CiAgICAgICAgdFsib2UiXSA9IDY2NzsKICAgICAgICB0WyJnZXJtYW5kYmxzIl0gPSA1MDA7CiAgICAgICAgdFsiSWRpZXJlc2lzIl0gPSAzMzM7CiAgICAgICAgdFsiZWFjdXRlIl0gPSA0NDQ7CiAgICAgICAgdFsiYWJyZXZlIl0gPSA1MDA7CiAgICAgICAgdFsidWh1bmdhcnVtbGF1dCJdID0gNTAwOwogICAgICAgIHRbImVjYXJvbiJdID0gNDQ0OwogICAgICAgIHRbIllkaWVyZXNpcyJdID0gNTU2OwogICAgICAgIHRbImRpdmlkZSJdID0gNjc1OwogICAgICAgIHRbIllhY3V0ZSJdID0gNTU2OwogICAgICAgIHRbIkFjaXJjdW1mbGV4Il0gPSA2MTE7CiAgICAgICAgdFsiYWFjdXRlIl0gPSA1MDA7CiAgICAgICAgdFsiVWNpcmN1bWZsZXgiXSA9IDcyMjsKICAgICAgICB0WyJ5YWN1dGUiXSA9IDQ0NDsKICAgICAgICB0WyJzY29tbWFhY2NlbnQiXSA9IDM4OTsKICAgICAgICB0WyJlY2lyY3VtZmxleCJdID0gNDQ0OwogICAgICAgIHRbIlVyaW5nIl0gPSA3MjI7CiAgICAgICAgdFsiVWRpZXJlc2lzIl0gPSA3MjI7CiAgICAgICAgdFsiYW9nb25layJdID0gNTAwOwogICAgICAgIHRbIlVhY3V0ZSJdID0gNzIyOwogICAgICAgIHRbInVvZ29uZWsiXSA9IDUwMDsKICAgICAgICB0WyJFZGllcmVzaXMiXSA9IDYxMTsKICAgICAgICB0WyJEY3JvYXQiXSA9IDcyMjsKICAgICAgICB0WyJjb21tYWFjY2VudCJdID0gMjUwOwogICAgICAgIHRbImNvcHlyaWdodCJdID0gNzYwOwogICAgICAgIHRbIkVtYWNyb24iXSA9IDYxMTsKICAgICAgICB0WyJjY2Fyb24iXSA9IDQ0NDsKICAgICAgICB0WyJhcmluZyJdID0gNTAwOwogICAgICAgIHRbIk5jb21tYWFjY2VudCJdID0gNjY3OwogICAgICAgIHRbImxhY3V0ZSJdID0gMjc4OwogICAgICAgIHRbImFncmF2ZSJdID0gNTAwOwogICAgICAgIHRbIlRjb21tYWFjY2VudCJdID0gNTU2OwogICAgICAgIHRbIkNhY3V0ZSJdID0gNjY3OwogICAgICAgIHRbImF0aWxkZSJdID0gNTAwOwogICAgICAgIHRbIkVkb3RhY2NlbnQiXSA9IDYxMTsKICAgICAgICB0WyJzY2Fyb24iXSA9IDM4OTsKICAgICAgICB0WyJzY2VkaWxsYSJdID0gMzg5OwogICAgICAgIHRbImlhY3V0ZSJdID0gMjc4OwogICAgICAgIHRbImxvemVuZ2UiXSA9IDQ3MTsKICAgICAgICB0WyJSY2Fyb24iXSA9IDYxMTsKICAgICAgICB0WyJHY29tbWFhY2NlbnQiXSA9IDcyMjsKICAgICAgICB0WyJ1Y2lyY3VtZmxleCJdID0gNTAwOwogICAgICAgIHRbImFjaXJjdW1mbGV4Il0gPSA1MDA7CiAgICAgICAgdFsiQW1hY3JvbiJdID0gNjExOwogICAgICAgIHRbInJjYXJvbiJdID0gMzg5OwogICAgICAgIHRbImNjZWRpbGxhIl0gPSA0NDQ7CiAgICAgICAgdFsiWmRvdGFjY2VudCJdID0gNTU2OwogICAgICAgIHRbIlRob3JuIl0gPSA2MTE7CiAgICAgICAgdFsiT21hY3JvbiJdID0gNzIyOwogICAgICAgIHRbIlJhY3V0ZSJdID0gNjExOwogICAgICAgIHRbIlNhY3V0ZSJdID0gNTAwOwogICAgICAgIHRbImRjYXJvbiJdID0gNTQ0OwogICAgICAgIHRbIlVtYWNyb24iXSA9IDcyMjsKICAgICAgICB0WyJ1cmluZyJdID0gNTAwOwogICAgICAgIHRbInRocmVlc3VwZXJpb3IiXSA9IDMwMDsKICAgICAgICB0WyJPZ3JhdmUiXSA9IDcyMjsKICAgICAgICB0WyJBZ3JhdmUiXSA9IDYxMTsKICAgICAgICB0WyJBYnJldmUiXSA9IDYxMTsKICAgICAgICB0WyJtdWx0aXBseSJdID0gNjc1OwogICAgICAgIHRbInVhY3V0ZSJdID0gNTAwOwogICAgICAgIHRbIlRjYXJvbiJdID0gNTU2OwogICAgICAgIHRbInBhcnRpYWxkaWZmIl0gPSA0NzY7CiAgICAgICAgdFsieWRpZXJlc2lzIl0gPSA0NDQ7CiAgICAgICAgdFsiTmFjdXRlIl0gPSA2Njc7CiAgICAgICAgdFsiaWNpcmN1bWZsZXgiXSA9IDI3ODsKICAgICAgICB0WyJFY2lyY3VtZmxleCJdID0gNjExOwogICAgICAgIHRbImFkaWVyZXNpcyJdID0gNTAwOwogICAgICAgIHRbImVkaWVyZXNpcyJdID0gNDQ0OwogICAgICAgIHRbImNhY3V0ZSJdID0gNDQ0OwogICAgICAgIHRbIm5hY3V0ZSJdID0gNTAwOwogICAgICAgIHRbInVtYWNyb24iXSA9IDUwMDsKICAgICAgICB0WyJOY2Fyb24iXSA9IDY2NzsKICAgICAgICB0WyJJYWN1dGUiXSA9IDMzMzsKICAgICAgICB0WyJwbHVzbWludXMiXSA9IDY3NTsKICAgICAgICB0WyJicm9rZW5iYXIiXSA9IDI3NTsKICAgICAgICB0WyJyZWdpc3RlcmVkIl0gPSA3NjA7CiAgICAgICAgdFsiR2JyZXZlIl0gPSA3MjI7CiAgICAgICAgdFsiSWRvdGFjY2VudCJdID0gMzMzOwogICAgICAgIHRbInN1bW1hdGlvbiJdID0gNjAwOwogICAgICAgIHRbIkVncmF2ZSJdID0gNjExOwogICAgICAgIHRbInJhY3V0ZSJdID0gMzg5OwogICAgICAgIHRbIm9tYWNyb24iXSA9IDUwMDsKICAgICAgICB0WyJaYWN1dGUiXSA9IDU1NjsKICAgICAgICB0WyJaY2Fyb24iXSA9IDU1NjsKICAgICAgICB0WyJncmVhdGVyZXF1YWwiXSA9IDU0OTsKICAgICAgICB0WyJFdGgiXSA9IDcyMjsKICAgICAgICB0WyJDY2VkaWxsYSJdID0gNjY3OwogICAgICAgIHRbImxjb21tYWFjY2VudCJdID0gMjc4OwogICAgICAgIHRbInRjYXJvbiJdID0gMzAwOwogICAgICAgIHRbImVvZ29uZWsiXSA9IDQ0NDsKICAgICAgICB0WyJVb2dvbmVrIl0gPSA3MjI7CiAgICAgICAgdFsiQWFjdXRlIl0gPSA2MTE7CiAgICAgICAgdFsiQWRpZXJlc2lzIl0gPSA2MTE7CiAgICAgICAgdFsiZWdyYXZlIl0gPSA0NDQ7CiAgICAgICAgdFsiemFjdXRlIl0gPSAzODk7CiAgICAgICAgdFsiaW9nb25layJdID0gMjc4OwogICAgICAgIHRbIk9hY3V0ZSJdID0gNzIyOwogICAgICAgIHRbIm9hY3V0ZSJdID0gNTAwOwogICAgICAgIHRbImFtYWNyb24iXSA9IDUwMDsKICAgICAgICB0WyJzYWN1dGUiXSA9IDM4OTsKICAgICAgICB0WyJpZGllcmVzaXMiXSA9IDI3ODsKICAgICAgICB0WyJPY2lyY3VtZmxleCJdID0gNzIyOwogICAgICAgIHRbIlVncmF2ZSJdID0gNzIyOwogICAgICAgIHRbIkRlbHRhIl0gPSA2MTI7CiAgICAgICAgdFsidGhvcm4iXSA9IDUwMDsKICAgICAgICB0WyJ0d29zdXBlcmlvciJdID0gMzAwOwogICAgICAgIHRbIk9kaWVyZXNpcyJdID0gNzIyOwogICAgICAgIHRbIm11Il0gPSA1MDA7CiAgICAgICAgdFsiaWdyYXZlIl0gPSAyNzg7CiAgICAgICAgdFsib2h1bmdhcnVtbGF1dCJdID0gNTAwOwogICAgICAgIHRbIkVvZ29uZWsiXSA9IDYxMTsKICAgICAgICB0WyJkY3JvYXQiXSA9IDUwMDsKICAgICAgICB0WyJ0aHJlZXF1YXJ0ZXJzIl0gPSA3NTA7CiAgICAgICAgdFsiU2NlZGlsbGEiXSA9IDUwMDsKICAgICAgICB0WyJsY2Fyb24iXSA9IDMwMDsKICAgICAgICB0WyJLY29tbWFhY2NlbnQiXSA9IDY2NzsKICAgICAgICB0WyJMYWN1dGUiXSA9IDU1NjsKICAgICAgICB0WyJ0cmFkZW1hcmsiXSA9IDk4MDsKICAgICAgICB0WyJlZG90YWNjZW50Il0gPSA0NDQ7CiAgICAgICAgdFsiSWdyYXZlIl0gPSAzMzM7CiAgICAgICAgdFsiSW1hY3JvbiJdID0gMzMzOwogICAgICAgIHRbIkxjYXJvbiJdID0gNjExOwogICAgICAgIHRbIm9uZWhhbGYiXSA9IDc1MDsKICAgICAgICB0WyJsZXNzZXF1YWwiXSA9IDU0OTsKICAgICAgICB0WyJvY2lyY3VtZmxleCJdID0gNTAwOwogICAgICAgIHRbIm50aWxkZSJdID0gNTAwOwogICAgICAgIHRbIlVodW5nYXJ1bWxhdXQiXSA9IDcyMjsKICAgICAgICB0WyJFYWN1dGUiXSA9IDYxMTsKICAgICAgICB0WyJlbWFjcm9uIl0gPSA0NDQ7CiAgICAgICAgdFsiZ2JyZXZlIl0gPSA1MDA7CiAgICAgICAgdFsib25lcXVhcnRlciJdID0gNzUwOwogICAgICAgIHRbIlNjYXJvbiJdID0gNTAwOwogICAgICAgIHRbIlNjb21tYWFjY2VudCJdID0gNTAwOwogICAgICAgIHRbIk9odW5nYXJ1bWxhdXQiXSA9IDcyMjsKICAgICAgICB0WyJkZWdyZWUiXSA9IDQwMDsKICAgICAgICB0WyJvZ3JhdmUiXSA9IDUwMDsKICAgICAgICB0WyJDY2Fyb24iXSA9IDY2NzsKICAgICAgICB0WyJ1Z3JhdmUiXSA9IDUwMDsKICAgICAgICB0WyJyYWRpY2FsIl0gPSA0NTM7CiAgICAgICAgdFsiRGNhcm9uIl0gPSA3MjI7CiAgICAgICAgdFsicmNvbW1hYWNjZW50Il0gPSAzODk7CiAgICAgICAgdFsiTnRpbGRlIl0gPSA2Njc7CiAgICAgICAgdFsib3RpbGRlIl0gPSA1MDA7CiAgICAgICAgdFsiUmNvbW1hYWNjZW50Il0gPSA2MTE7CiAgICAgICAgdFsiTGNvbW1hYWNjZW50Il0gPSA1NTY7CiAgICAgICAgdFsiQXRpbGRlIl0gPSA2MTE7CiAgICAgICAgdFsiQW9nb25layJdID0gNjExOwogICAgICAgIHRbIkFyaW5nIl0gPSA2MTE7CiAgICAgICAgdFsiT3RpbGRlIl0gPSA3MjI7CiAgICAgICAgdFsiemRvdGFjY2VudCJdID0gMzg5OwogICAgICAgIHRbIkVjYXJvbiJdID0gNjExOwogICAgICAgIHRbIklvZ29uZWsiXSA9IDMzMzsKICAgICAgICB0WyJrY29tbWFhY2NlbnQiXSA9IDQ0NDsKICAgICAgICB0WyJtaW51cyJdID0gNjc1OwogICAgICAgIHRbIkljaXJjdW1mbGV4Il0gPSAzMzM7CiAgICAgICAgdFsibmNhcm9uIl0gPSA1MDA7CiAgICAgICAgdFsidGNvbW1hYWNjZW50Il0gPSAyNzg7CiAgICAgICAgdFsibG9naWNhbG5vdCJdID0gNjc1OwogICAgICAgIHRbIm9kaWVyZXNpcyJdID0gNTAwOwogICAgICAgIHRbInVkaWVyZXNpcyJdID0gNTAwOwogICAgICAgIHRbIm5vdGVxdWFsIl0gPSA1NDk7CiAgICAgICAgdFsiZ2NvbW1hYWNjZW50Il0gPSA1MDA7CiAgICAgICAgdFsiZXRoIl0gPSA1MDA7CiAgICAgICAgdFsiemNhcm9uIl0gPSAzODk7CiAgICAgICAgdFsibmNvbW1hYWNjZW50Il0gPSA1MDA7CiAgICAgICAgdFsib25lc3VwZXJpb3IiXSA9IDMwMDsKICAgICAgICB0WyJpbWFjcm9uIl0gPSAyNzg7CiAgICAgICAgdFsiRXVybyJdID0gNTAwOwogICAgICB9KTsKICAgICAgdFsiWmFwZkRpbmdiYXRzIl0gPSAoMCwgX2NvcmVfdXRpbHMuZ2V0TG9va3VwVGFibGVGYWN0b3J5KShmdW5jdGlvbiAodCkgewogICAgICAgIHRbInNwYWNlIl0gPSAyNzg7CiAgICAgICAgdFsiYTEiXSA9IDk3NDsKICAgICAgICB0WyJhMiJdID0gOTYxOwogICAgICAgIHRbImEyMDIiXSA9IDk3NDsKICAgICAgICB0WyJhMyJdID0gOTgwOwogICAgICAgIHRbImE0Il0gPSA3MTk7CiAgICAgICAgdFsiYTUiXSA9IDc4OTsKICAgICAgICB0WyJhMTE5Il0gPSA3OTA7CiAgICAgICAgdFsiYTExOCJdID0gNzkxOwogICAgICAgIHRbImExMTciXSA9IDY5MDsKICAgICAgICB0WyJhMTEiXSA9IDk2MDsKICAgICAgICB0WyJhMTIiXSA9IDkzOTsKICAgICAgICB0WyJhMTMiXSA9IDU0OTsKICAgICAgICB0WyJhMTQiXSA9IDg1NTsKICAgICAgICB0WyJhMTUiXSA9IDkxMTsKICAgICAgICB0WyJhMTYiXSA9IDkzMzsKICAgICAgICB0WyJhMTA1Il0gPSA5MTE7CiAgICAgICAgdFsiYTE3Il0gPSA5NDU7CiAgICAgICAgdFsiYTE4Il0gPSA5NzQ7CiAgICAgICAgdFsiYTE5Il0gPSA3NTU7CiAgICAgICAgdFsiYTIwIl0gPSA4NDY7CiAgICAgICAgdFsiYTIxIl0gPSA3NjI7CiAgICAgICAgdFsiYTIyIl0gPSA3NjE7CiAgICAgICAgdFsiYTIzIl0gPSA1NzE7CiAgICAgICAgdFsiYTI0Il0gPSA2Nzc7CiAgICAgICAgdFsiYTI1Il0gPSA3NjM7CiAgICAgICAgdFsiYTI2Il0gPSA3NjA7CiAgICAgICAgdFsiYTI3Il0gPSA3NTk7CiAgICAgICAgdFsiYTI4Il0gPSA3NTQ7CiAgICAgICAgdFsiYTYiXSA9IDQ5NDsKICAgICAgICB0WyJhNyJdID0gNTUyOwogICAgICAgIHRbImE4Il0gPSA1Mzc7CiAgICAgICAgdFsiYTkiXSA9IDU3NzsKICAgICAgICB0WyJhMTAiXSA9IDY5MjsKICAgICAgICB0WyJhMjkiXSA9IDc4NjsKICAgICAgICB0WyJhMzAiXSA9IDc4ODsKICAgICAgICB0WyJhMzEiXSA9IDc4ODsKICAgICAgICB0WyJhMzIiXSA9IDc5MDsKICAgICAgICB0WyJhMzMiXSA9IDc5MzsKICAgICAgICB0WyJhMzQiXSA9IDc5NDsKICAgICAgICB0WyJhMzUiXSA9IDgxNjsKICAgICAgICB0WyJhMzYiXSA9IDgyMzsKICAgICAgICB0WyJhMzciXSA9IDc4OTsKICAgICAgICB0WyJhMzgiXSA9IDg0MTsKICAgICAgICB0WyJhMzkiXSA9IDgyMzsKICAgICAgICB0WyJhNDAiXSA9IDgzMzsKICAgICAgICB0WyJhNDEiXSA9IDgxNjsKICAgICAgICB0WyJhNDIiXSA9IDgzMTsKICAgICAgICB0WyJhNDMiXSA9IDkyMzsKICAgICAgICB0WyJhNDQiXSA9IDc0NDsKICAgICAgICB0WyJhNDUiXSA9IDcyMzsKICAgICAgICB0WyJhNDYiXSA9IDc0OTsKICAgICAgICB0WyJhNDciXSA9IDc5MDsKICAgICAgICB0WyJhNDgiXSA9IDc5MjsKICAgICAgICB0WyJhNDkiXSA9IDY5NTsKICAgICAgICB0WyJhNTAiXSA9IDc3NjsKICAgICAgICB0WyJhNTEiXSA9IDc2ODsKICAgICAgICB0WyJhNTIiXSA9IDc5MjsKICAgICAgICB0WyJhNTMiXSA9IDc1OTsKICAgICAgICB0WyJhNTQiXSA9IDcwNzsKICAgICAgICB0WyJhNTUiXSA9IDcwODsKICAgICAgICB0WyJhNTYiXSA9IDY4MjsKICAgICAgICB0WyJhNTciXSA9IDcwMTsKICAgICAgICB0WyJhNTgiXSA9IDgyNjsKICAgICAgICB0WyJhNTkiXSA9IDgxNTsKICAgICAgICB0WyJhNjAiXSA9IDc4OTsKICAgICAgICB0WyJhNjEiXSA9IDc4OTsKICAgICAgICB0WyJhNjIiXSA9IDcwNzsKICAgICAgICB0WyJhNjMiXSA9IDY4NzsKICAgICAgICB0WyJhNjQiXSA9IDY5NjsKICAgICAgICB0WyJhNjUiXSA9IDY4OTsKICAgICAgICB0WyJhNjYiXSA9IDc4NjsKICAgICAgICB0WyJhNjciXSA9IDc4NzsKICAgICAgICB0WyJhNjgiXSA9IDcxMzsKICAgICAgICB0WyJhNjkiXSA9IDc5MTsKICAgICAgICB0WyJhNzAiXSA9IDc4NTsKICAgICAgICB0WyJhNzEiXSA9IDc5MTsKICAgICAgICB0WyJhNzIiXSA9IDg3MzsKICAgICAgICB0WyJhNzMiXSA9IDc2MTsKICAgICAgICB0WyJhNzQiXSA9IDc2MjsKICAgICAgICB0WyJhMjAzIl0gPSA3NjI7CiAgICAgICAgdFsiYTc1Il0gPSA3NTk7CiAgICAgICAgdFsiYTIwNCJdID0gNzU5OwogICAgICAgIHRbImE3NiJdID0gODkyOwogICAgICAgIHRbImE3NyJdID0gODkyOwogICAgICAgIHRbImE3OCJdID0gNzg4OwogICAgICAgIHRbImE3OSJdID0gNzg0OwogICAgICAgIHRbImE4MSJdID0gNDM4OwogICAgICAgIHRbImE4MiJdID0gMTM4OwogICAgICAgIHRbImE4MyJdID0gMjc3OwogICAgICAgIHRbImE4NCJdID0gNDE1OwogICAgICAgIHRbImE5NyJdID0gMzkyOwogICAgICAgIHRbImE5OCJdID0gMzkyOwogICAgICAgIHRbImE5OSJdID0gNjY4OwogICAgICAgIHRbImExMDAiXSA9IDY2ODsKICAgICAgICB0WyJhODkiXSA9IDM5MDsKICAgICAgICB0WyJhOTAiXSA9IDM5MDsKICAgICAgICB0WyJhOTMiXSA9IDMxNzsKICAgICAgICB0WyJhOTQiXSA9IDMxNzsKICAgICAgICB0WyJhOTEiXSA9IDI3NjsKICAgICAgICB0WyJhOTIiXSA9IDI3NjsKICAgICAgICB0WyJhMjA1Il0gPSA1MDk7CiAgICAgICAgdFsiYTg1Il0gPSA1MDk7CiAgICAgICAgdFsiYTIwNiJdID0gNDEwOwogICAgICAgIHRbImE4NiJdID0gNDEwOwogICAgICAgIHRbImE4NyJdID0gMjM0OwogICAgICAgIHRbImE4OCJdID0gMjM0OwogICAgICAgIHRbImE5NSJdID0gMzM0OwogICAgICAgIHRbImE5NiJdID0gMzM0OwogICAgICAgIHRbImExMDEiXSA9IDczMjsKICAgICAgICB0WyJhMTAyIl0gPSA1NDQ7CiAgICAgICAgdFsiYTEwMyJdID0gNTQ0OwogICAgICAgIHRbImExMDQiXSA9IDkxMDsKICAgICAgICB0WyJhMTA2Il0gPSA2Njc7CiAgICAgICAgdFsiYTEwNyJdID0gNzYwOwogICAgICAgIHRbImExMDgiXSA9IDc2MDsKICAgICAgICB0WyJhMTEyIl0gPSA3NzY7CiAgICAgICAgdFsiYTExMSJdID0gNTk1OwogICAgICAgIHRbImExMTAiXSA9IDY5NDsKICAgICAgICB0WyJhMTA5Il0gPSA2MjY7CiAgICAgICAgdFsiYTEyMCJdID0gNzg4OwogICAgICAgIHRbImExMjEiXSA9IDc4ODsKICAgICAgICB0WyJhMTIyIl0gPSA3ODg7CiAgICAgICAgdFsiYTEyMyJdID0gNzg4OwogICAgICAgIHRbImExMjQiXSA9IDc4ODsKICAgICAgICB0WyJhMTI1Il0gPSA3ODg7CiAgICAgICAgdFsiYTEyNiJdID0gNzg4OwogICAgICAgIHRbImExMjciXSA9IDc4ODsKICAgICAgICB0WyJhMTI4Il0gPSA3ODg7CiAgICAgICAgdFsiYTEyOSJdID0gNzg4OwogICAgICAgIHRbImExMzAiXSA9IDc4ODsKICAgICAgICB0WyJhMTMxIl0gPSA3ODg7CiAgICAgICAgdFsiYTEzMiJdID0gNzg4OwogICAgICAgIHRbImExMzMiXSA9IDc4ODsKICAgICAgICB0WyJhMTM0Il0gPSA3ODg7CiAgICAgICAgdFsiYTEzNSJdID0gNzg4OwogICAgICAgIHRbImExMzYiXSA9IDc4ODsKICAgICAgICB0WyJhMTM3Il0gPSA3ODg7CiAgICAgICAgdFsiYTEzOCJdID0gNzg4OwogICAgICAgIHRbImExMzkiXSA9IDc4ODsKICAgICAgICB0WyJhMTQwIl0gPSA3ODg7CiAgICAgICAgdFsiYTE0MSJdID0gNzg4OwogICAgICAgIHRbImExNDIiXSA9IDc4ODsKICAgICAgICB0WyJhMTQzIl0gPSA3ODg7CiAgICAgICAgdFsiYTE0NCJdID0gNzg4OwogICAgICAgIHRbImExNDUiXSA9IDc4ODsKICAgICAgICB0WyJhMTQ2Il0gPSA3ODg7CiAgICAgICAgdFsiYTE0NyJdID0gNzg4OwogICAgICAgIHRbImExNDgiXSA9IDc4ODsKICAgICAgICB0WyJhMTQ5Il0gPSA3ODg7CiAgICAgICAgdFsiYTE1MCJdID0gNzg4OwogICAgICAgIHRbImExNTEiXSA9IDc4ODsKICAgICAgICB0WyJhMTUyIl0gPSA3ODg7CiAgICAgICAgdFsiYTE1MyJdID0gNzg4OwogICAgICAgIHRbImExNTQiXSA9IDc4ODsKICAgICAgICB0WyJhMTU1Il0gPSA3ODg7CiAgICAgICAgdFsiYTE1NiJdID0gNzg4OwogICAgICAgIHRbImExNTciXSA9IDc4ODsKICAgICAgICB0WyJhMTU4Il0gPSA3ODg7CiAgICAgICAgdFsiYTE1OSJdID0gNzg4OwogICAgICAgIHRbImExNjAiXSA9IDg5NDsKICAgICAgICB0WyJhMTYxIl0gPSA4Mzg7CiAgICAgICAgdFsiYTE2MyJdID0gMTAxNjsKICAgICAgICB0WyJhMTY0Il0gPSA0NTg7CiAgICAgICAgdFsiYTE5NiJdID0gNzQ4OwogICAgICAgIHRbImExNjUiXSA9IDkyNDsKICAgICAgICB0WyJhMTkyIl0gPSA3NDg7CiAgICAgICAgdFsiYTE2NiJdID0gOTE4OwogICAgICAgIHRbImExNjciXSA9IDkyNzsKICAgICAgICB0WyJhMTY4Il0gPSA5Mjg7CiAgICAgICAgdFsiYTE2OSJdID0gOTI4OwogICAgICAgIHRbImExNzAiXSA9IDgzNDsKICAgICAgICB0WyJhMTcxIl0gPSA4NzM7CiAgICAgICAgdFsiYTE3MiJdID0gODI4OwogICAgICAgIHRbImExNzMiXSA9IDkyNDsKICAgICAgICB0WyJhMTYyIl0gPSA5MjQ7CiAgICAgICAgdFsiYTE3NCJdID0gOTE3OwogICAgICAgIHRbImExNzUiXSA9IDkzMDsKICAgICAgICB0WyJhMTc2Il0gPSA5MzE7CiAgICAgICAgdFsiYTE3NyJdID0gNDYzOwogICAgICAgIHRbImExNzgiXSA9IDg4MzsKICAgICAgICB0WyJhMTc5Il0gPSA4MzY7CiAgICAgICAgdFsiYTE5MyJdID0gODM2OwogICAgICAgIHRbImExODAiXSA9IDg2NzsKICAgICAgICB0WyJhMTk5Il0gPSA4Njc7CiAgICAgICAgdFsiYTE4MSJdID0gNjk2OwogICAgICAgIHRbImEyMDAiXSA9IDY5NjsKICAgICAgICB0WyJhMTgyIl0gPSA4NzQ7CiAgICAgICAgdFsiYTIwMSJdID0gODc0OwogICAgICAgIHRbImExODMiXSA9IDc2MDsKICAgICAgICB0WyJhMTg0Il0gPSA5NDY7CiAgICAgICAgdFsiYTE5NyJdID0gNzcxOwogICAgICAgIHRbImExODUiXSA9IDg2NTsKICAgICAgICB0WyJhMTk0Il0gPSA3NzE7CiAgICAgICAgdFsiYTE5OCJdID0gODg4OwogICAgICAgIHRbImExODYiXSA9IDk2NzsKICAgICAgICB0WyJhMTk1Il0gPSA4ODg7CiAgICAgICAgdFsiYTE4NyJdID0gODMxOwogICAgICAgIHRbImExODgiXSA9IDg3MzsKICAgICAgICB0WyJhMTg5Il0gPSA5Mjc7CiAgICAgICAgdFsiYTE5MCJdID0gOTcwOwogICAgICAgIHRbImExOTEiXSA9IDkxODsKICAgICAgfSk7CiAgICB9KTsKICAgIGV4cG9ydHMuZ2V0TWV0cmljcyA9IGdldE1ldHJpY3M7CgogICAgLyoqKi99KSwgKAogIC8qIDIyOSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCgogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICB2YWx1ZTogdHJ1ZQogICAgfSk7CiAgICBleHBvcnRzLmlzUERGRnVuY3Rpb24gPSBpc1BERkZ1bmN0aW9uOwogICAgZXhwb3J0cy5Qb3N0U2NyaXB0Q29tcGlsZXIgPSBleHBvcnRzLlBvc3RTY3JpcHRFdmFsdWF0b3IgPSBleHBvcnRzLlBERkZ1bmN0aW9uRmFjdG9yeSA9IHZvaWQgMDsKCiAgICB2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUpOwoKICAgIHZhciBfcHJpbWl0aXZlcyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTk0KTsKCiAgICB2YXIgX3BzX3BhcnNlciA9IF9fd19wZGZqc19yZXF1aXJlX18oMjMwKTsKCiAgICBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyJAYmFiZWwvaGVscGVycyAtIHR5cGVvZiI7aWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIpIHtfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHtyZXR1cm4gdHlwZW9mIG9iajt9O30gZWxzZSB7X3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7cmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajt9O31yZXR1cm4gX3R5cGVvZihvYmopO30KCiAgICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7aWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTt9fQoKICAgIGZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHtmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7dmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTtkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7ZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlO2lmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlO09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTt9fQoKICAgIGZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHtpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTtpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7cmV0dXJuIENvbnN0cnVjdG9yO30KCiAgICB2YXIgUERGRnVuY3Rpb25GYWN0b3J5ID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gUERGRnVuY3Rpb25GYWN0b3J5KF9yZWYpIHsKICAgICAgICB2YXIgeHJlZiA9IF9yZWYueHJlZiwKICAgICAgICAgIF9yZWYkaXNFdmFsU3VwcG9ydGVkID0gX3JlZi5pc0V2YWxTdXBwb3J0ZWQsCiAgICAgICAgICBpc0V2YWxTdXBwb3J0ZWQgPSBfcmVmJGlzRXZhbFN1cHBvcnRlZCA9PT0gdm9pZCAwID8gdHJ1ZSA6IF9yZWYkaXNFdmFsU3VwcG9ydGVkOwoKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUERGRnVuY3Rpb25GYWN0b3J5KTsKCiAgICAgICAgdGhpcy54cmVmID0geHJlZjsKICAgICAgICB0aGlzLmlzRXZhbFN1cHBvcnRlZCA9IGlzRXZhbFN1cHBvcnRlZCAhPT0gZmFsc2U7CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhQREZGdW5jdGlvbkZhY3RvcnksIFt7CiAgICAgICAga2V5OiAiY3JlYXRlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlKGZuKSB7CiAgICAgICAgICByZXR1cm4gUERGRnVuY3Rpb24ucGFyc2UoewogICAgICAgICAgICB4cmVmOiB0aGlzLnhyZWYsCiAgICAgICAgICAgIGlzRXZhbFN1cHBvcnRlZDogdGhpcy5pc0V2YWxTdXBwb3J0ZWQsCiAgICAgICAgICAgIGZuOiBmbgogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiY3JlYXRlRnJvbUFycmF5IiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlRnJvbUFycmF5KGZuT2JqKSB7CiAgICAgICAgICByZXR1cm4gUERGRnVuY3Rpb24ucGFyc2VBcnJheSh7CiAgICAgICAgICAgIHhyZWY6IHRoaXMueHJlZiwKICAgICAgICAgICAgaXNFdmFsU3VwcG9ydGVkOiB0aGlzLmlzRXZhbFN1cHBvcnRlZCwKICAgICAgICAgICAgZm5PYmo6IGZuT2JqCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBQREZGdW5jdGlvbkZhY3Rvcnk7CiAgICB9KCk7CgogICAgZXhwb3J0cy5QREZGdW5jdGlvbkZhY3RvcnkgPSBQREZGdW5jdGlvbkZhY3Rvcnk7CgogICAgZnVuY3Rpb24gdG9OdW1iZXJBcnJheShhcnIpIHsKICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGFycikpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgdmFyIGxlbmd0aCA9IGFyci5sZW5ndGg7CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHR5cGVvZiBhcnJbaV0gIT09ICJudW1iZXIiKSB7CiAgICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IEFycmF5KGxlbmd0aCk7CgogICAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGxlbmd0aDsgX2krKykgewogICAgICAgICAgICByZXN1bHRbX2ldID0gK2FycltfaV07CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBhcnI7CiAgICB9CgogICAgdmFyIFBERkZ1bmN0aW9uID0gZnVuY3Rpb24gUERGRnVuY3Rpb25DbG9zdXJlKCkgewogICAgICB2YXIgQ09OU1RSVUNUX1NBTVBMRUQgPSAwOwogICAgICB2YXIgQ09OU1RSVUNUX0lOVEVSUE9MQVRFRCA9IDI7CiAgICAgIHZhciBDT05TVFJVQ1RfU1RJQ0hFRCA9IDM7CiAgICAgIHZhciBDT05TVFJVQ1RfUE9TVFNDUklQVCA9IDQ7CiAgICAgIHJldHVybiB7CiAgICAgICAgZ2V0U2FtcGxlQXJyYXk6IGZ1bmN0aW9uIGdldFNhbXBsZUFycmF5KHNpemUsIG91dHB1dFNpemUsIGJwcywgc3RyZWFtKSB7CiAgICAgICAgICB2YXIgaSwgaWk7CiAgICAgICAgICB2YXIgbGVuZ3RoID0gMTsKCiAgICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IHNpemUubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICBsZW5ndGggKj0gc2l6ZVtpXTsKICAgICAgICAgIH0KCiAgICAgICAgICBsZW5ndGggKj0gb3V0cHV0U2l6ZTsKICAgICAgICAgIHZhciBhcnJheSA9IG5ldyBBcnJheShsZW5ndGgpOwogICAgICAgICAgdmFyIGNvZGVTaXplID0gMDsKICAgICAgICAgIHZhciBjb2RlQnVmID0gMDsKICAgICAgICAgIHZhciBzYW1wbGVNdWwgPSAxLjAgLyAoTWF0aC5wb3coMi4wLCBicHMpIC0gMSk7CiAgICAgICAgICB2YXIgc3RyQnl0ZXMgPSBzdHJlYW0uZ2V0Qnl0ZXMoKGxlbmd0aCAqIGJwcyArIDcpIC8gOCk7CiAgICAgICAgICB2YXIgc3RySWR4ID0gMDsKCiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgd2hpbGUgKGNvZGVTaXplIDwgYnBzKSB7CiAgICAgICAgICAgICAgY29kZUJ1ZiA8PD0gODsKICAgICAgICAgICAgICBjb2RlQnVmIHw9IHN0ckJ5dGVzW3N0cklkeCsrXTsKICAgICAgICAgICAgICBjb2RlU2l6ZSArPSA4OwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb2RlU2l6ZSAtPSBicHM7CiAgICAgICAgICAgIGFycmF5W2ldID0gKGNvZGVCdWYgPj4gY29kZVNpemUpICogc2FtcGxlTXVsOwogICAgICAgICAgICBjb2RlQnVmICY9ICgxIDw8IGNvZGVTaXplKSAtIDE7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGFycmF5OwogICAgICAgIH0sCiAgICAgICAgZ2V0SVI6IGZ1bmN0aW9uIGdldElSKF9yZWYyKSB7CiAgICAgICAgICB2YXIgeHJlZiA9IF9yZWYyLnhyZWYsCiAgICAgICAgICAgIGlzRXZhbFN1cHBvcnRlZCA9IF9yZWYyLmlzRXZhbFN1cHBvcnRlZCwKICAgICAgICAgICAgZm4gPSBfcmVmMi5mbjsKICAgICAgICAgIHZhciBkaWN0ID0gZm4uZGljdDsKCiAgICAgICAgICBpZiAoIWRpY3QpIHsKICAgICAgICAgICAgZGljdCA9IGZuOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciB0eXBlcyA9IFt0aGlzLmNvbnN0cnVjdFNhbXBsZWQsIG51bGwsIHRoaXMuY29uc3RydWN0SW50ZXJwb2xhdGVkLCB0aGlzLmNvbnN0cnVjdFN0aWNoZWQsIHRoaXMuY29uc3RydWN0UG9zdFNjcmlwdF07CiAgICAgICAgICB2YXIgdHlwZU51bSA9IGRpY3QuZ2V0KCJGdW5jdGlvblR5cGUiKTsKICAgICAgICAgIHZhciB0eXBlRm4gPSB0eXBlc1t0eXBlTnVtXTsKCiAgICAgICAgICBpZiAoIXR5cGVGbikgewogICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIlVua25vd24gdHlwZSBvZiBmdW5jdGlvbiIpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB0eXBlRm4uY2FsbCh0aGlzLCB7CiAgICAgICAgICAgIHhyZWY6IHhyZWYsCiAgICAgICAgICAgIGlzRXZhbFN1cHBvcnRlZDogaXNFdmFsU3VwcG9ydGVkLAogICAgICAgICAgICBmbjogZm4sCiAgICAgICAgICAgIGRpY3Q6IGRpY3QKICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgZnJvbUlSOiBmdW5jdGlvbiBmcm9tSVIoX3JlZjMpIHsKICAgICAgICAgIHZhciB4cmVmID0gX3JlZjMueHJlZiwKICAgICAgICAgICAgaXNFdmFsU3VwcG9ydGVkID0gX3JlZjMuaXNFdmFsU3VwcG9ydGVkLAogICAgICAgICAgICBJUiA9IF9yZWYzLklSOwogICAgICAgICAgdmFyIHR5cGUgPSBJUlswXTsKCiAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgICAgY2FzZSBDT05TVFJVQ1RfU0FNUExFRDoKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3RTYW1wbGVkRnJvbUlSKHsKICAgICAgICAgICAgICAgIHhyZWY6IHhyZWYsCiAgICAgICAgICAgICAgICBpc0V2YWxTdXBwb3J0ZWQ6IGlzRXZhbFN1cHBvcnRlZCwKICAgICAgICAgICAgICAgIElSOiBJUgogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY2FzZSBDT05TVFJVQ1RfSU5URVJQT0xBVEVEOgogICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnN0cnVjdEludGVycG9sYXRlZEZyb21JUih7CiAgICAgICAgICAgICAgICB4cmVmOiB4cmVmLAogICAgICAgICAgICAgICAgaXNFdmFsU3VwcG9ydGVkOiBpc0V2YWxTdXBwb3J0ZWQsCiAgICAgICAgICAgICAgICBJUjogSVIKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNhc2UgQ09OU1RSVUNUX1NUSUNIRUQ6CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RydWN0U3RpY2hlZEZyb21JUih7CiAgICAgICAgICAgICAgICB4cmVmOiB4cmVmLAogICAgICAgICAgICAgICAgaXNFdmFsU3VwcG9ydGVkOiBpc0V2YWxTdXBwb3J0ZWQsCiAgICAgICAgICAgICAgICBJUjogSVIKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RydWN0UG9zdFNjcmlwdEZyb21JUih7CiAgICAgICAgICAgICAgICB4cmVmOiB4cmVmLAogICAgICAgICAgICAgICAgaXNFdmFsU3VwcG9ydGVkOiBpc0V2YWxTdXBwb3J0ZWQsCiAgICAgICAgICAgICAgICBJUjogSVIKICAgICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHBhcnNlOiBmdW5jdGlvbiBwYXJzZShfcmVmNCkgewogICAgICAgICAgdmFyIHhyZWYgPSBfcmVmNC54cmVmLAogICAgICAgICAgICBpc0V2YWxTdXBwb3J0ZWQgPSBfcmVmNC5pc0V2YWxTdXBwb3J0ZWQsCiAgICAgICAgICAgIGZuID0gX3JlZjQuZm47CiAgICAgICAgICB2YXIgSVIgPSB0aGlzLmdldElSKHsKICAgICAgICAgICAgeHJlZjogeHJlZiwKICAgICAgICAgICAgaXNFdmFsU3VwcG9ydGVkOiBpc0V2YWxTdXBwb3J0ZWQsCiAgICAgICAgICAgIGZuOiBmbgogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4gdGhpcy5mcm9tSVIoewogICAgICAgICAgICB4cmVmOiB4cmVmLAogICAgICAgICAgICBpc0V2YWxTdXBwb3J0ZWQ6IGlzRXZhbFN1cHBvcnRlZCwKICAgICAgICAgICAgSVI6IElSCiAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIHBhcnNlQXJyYXk6IGZ1bmN0aW9uIHBhcnNlQXJyYXkoX3JlZjUpIHsKICAgICAgICAgIHZhciB4cmVmID0gX3JlZjUueHJlZiwKICAgICAgICAgICAgaXNFdmFsU3VwcG9ydGVkID0gX3JlZjUuaXNFdmFsU3VwcG9ydGVkLAogICAgICAgICAgICBmbk9iaiA9IF9yZWY1LmZuT2JqOwoKICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShmbk9iaikpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2UoewogICAgICAgICAgICAgIHhyZWY6IHhyZWYsCiAgICAgICAgICAgICAgaXNFdmFsU3VwcG9ydGVkOiBpc0V2YWxTdXBwb3J0ZWQsCiAgICAgICAgICAgICAgZm46IGZuT2JqCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBmbkFycmF5ID0gW107CgogICAgICAgICAgZm9yICh2YXIgaiA9IDAsIGpqID0gZm5PYmoubGVuZ3RoOyBqIDwgamo7IGorKykgewogICAgICAgICAgICBmbkFycmF5LnB1c2godGhpcy5wYXJzZSh7CiAgICAgICAgICAgICAgeHJlZjogeHJlZiwKICAgICAgICAgICAgICBpc0V2YWxTdXBwb3J0ZWQ6IGlzRXZhbFN1cHBvcnRlZCwKICAgICAgICAgICAgICBmbjogeHJlZi5mZXRjaElmUmVmKGZuT2JqW2pdKQogICAgICAgICAgICB9KSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBmbkFycmF5Lmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgICBmbkFycmF5W2ldKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0ICsgaSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgfSwKICAgICAgICBjb25zdHJ1Y3RTYW1wbGVkOiBmdW5jdGlvbiBjb25zdHJ1Y3RTYW1wbGVkKF9yZWY2KSB7CiAgICAgICAgICB2YXIgeHJlZiA9IF9yZWY2LnhyZWYsCiAgICAgICAgICAgIGlzRXZhbFN1cHBvcnRlZCA9IF9yZWY2LmlzRXZhbFN1cHBvcnRlZCwKICAgICAgICAgICAgZm4gPSBfcmVmNi5mbiwKICAgICAgICAgICAgZGljdCA9IF9yZWY2LmRpY3Q7CgogICAgICAgICAgZnVuY3Rpb24gdG9NdWx0aUFycmF5KGFycikgewogICAgICAgICAgICB2YXIgaW5wdXRMZW5ndGggPSBhcnIubGVuZ3RoOwogICAgICAgICAgICB2YXIgb3V0ID0gW107CiAgICAgICAgICAgIHZhciBpbmRleCA9IDA7CgogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGlucHV0TGVuZ3RoOyBpICs9IDIpIHsKICAgICAgICAgICAgICBvdXRbaW5kZXhdID0gW2FycltpXSwgYXJyW2kgKyAxXV07CiAgICAgICAgICAgICAgKytpbmRleDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIG91dDsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZG9tYWluID0gdG9OdW1iZXJBcnJheShkaWN0LmdldEFycmF5KCJEb21haW4iKSk7CiAgICAgICAgICB2YXIgcmFuZ2UgPSB0b051bWJlckFycmF5KGRpY3QuZ2V0QXJyYXkoIlJhbmdlIikpOwoKICAgICAgICAgIGlmICghZG9tYWluIHx8ICFyYW5nZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIk5vIGRvbWFpbiBvciByYW5nZSIpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBpbnB1dFNpemUgPSBkb21haW4ubGVuZ3RoIC8gMjsKICAgICAgICAgIHZhciBvdXRwdXRTaXplID0gcmFuZ2UubGVuZ3RoIC8gMjsKICAgICAgICAgIGRvbWFpbiA9IHRvTXVsdGlBcnJheShkb21haW4pOwogICAgICAgICAgcmFuZ2UgPSB0b011bHRpQXJyYXkocmFuZ2UpOwogICAgICAgICAgdmFyIHNpemUgPSB0b051bWJlckFycmF5KGRpY3QuZ2V0QXJyYXkoIlNpemUiKSk7CiAgICAgICAgICB2YXIgYnBzID0gZGljdC5nZXQoIkJpdHNQZXJTYW1wbGUiKTsKICAgICAgICAgIHZhciBvcmRlciA9IGRpY3QuZ2V0KCJPcmRlciIpIHx8IDE7CgogICAgICAgICAgaWYgKG9yZGVyICE9PSAxKSB7CiAgICAgICAgICAgICgwLCBfdXRpbC5pbmZvKSgiTm8gc3VwcG9ydCBmb3IgY3ViaWMgc3BsaW5lIGludGVycG9sYXRpb246ICIgKyBvcmRlcik7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGVuY29kZSA9IHRvTnVtYmVyQXJyYXkoZGljdC5nZXRBcnJheSgiRW5jb2RlIikpOwoKICAgICAgICAgIGlmICghZW5jb2RlKSB7CiAgICAgICAgICAgIGVuY29kZSA9IFtdOwoKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbnB1dFNpemU7ICsraSkgewogICAgICAgICAgICAgIGVuY29kZS5wdXNoKFswLCBzaXplW2ldIC0gMV0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBlbmNvZGUgPSB0b011bHRpQXJyYXkoZW5jb2RlKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZGVjb2RlID0gdG9OdW1iZXJBcnJheShkaWN0LmdldEFycmF5KCJEZWNvZGUiKSk7CgogICAgICAgICAgaWYgKCFkZWNvZGUpIHsKICAgICAgICAgICAgZGVjb2RlID0gcmFuZ2U7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBkZWNvZGUgPSB0b011bHRpQXJyYXkoZGVjb2RlKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgc2FtcGxlcyA9IHRoaXMuZ2V0U2FtcGxlQXJyYXkoc2l6ZSwgb3V0cHV0U2l6ZSwgYnBzLCBmbik7CiAgICAgICAgICByZXR1cm4gW0NPTlNUUlVDVF9TQU1QTEVELCBpbnB1dFNpemUsIGRvbWFpbiwgZW5jb2RlLCBkZWNvZGUsIHNhbXBsZXMsIHNpemUsIG91dHB1dFNpemUsIE1hdGgucG93KDIsIGJwcykgLSAxLCByYW5nZV07CiAgICAgICAgfSwKICAgICAgICBjb25zdHJ1Y3RTYW1wbGVkRnJvbUlSOiBmdW5jdGlvbiBjb25zdHJ1Y3RTYW1wbGVkRnJvbUlSKF9yZWY3KSB7CiAgICAgICAgICB2YXIgeHJlZiA9IF9yZWY3LnhyZWYsCiAgICAgICAgICAgIGlzRXZhbFN1cHBvcnRlZCA9IF9yZWY3LmlzRXZhbFN1cHBvcnRlZCwKICAgICAgICAgICAgSVIgPSBfcmVmNy5JUjsKCiAgICAgICAgICBmdW5jdGlvbiBpbnRlcnBvbGF0ZSh4LCB4bWluLCB4bWF4LCB5bWluLCB5bWF4KSB7CiAgICAgICAgICAgIHJldHVybiB5bWluICsgKHggLSB4bWluKSAqICgoeW1heCAtIHltaW4pIC8gKHhtYXggLSB4bWluKSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGNvbnN0cnVjdFNhbXBsZWRGcm9tSVJSZXN1bHQoc3JjLCBzcmNPZmZzZXQsIGRlc3QsIGRlc3RPZmZzZXQpIHsKICAgICAgICAgICAgdmFyIG0gPSBJUlsxXTsKICAgICAgICAgICAgdmFyIGRvbWFpbiA9IElSWzJdOwogICAgICAgICAgICB2YXIgZW5jb2RlID0gSVJbM107CiAgICAgICAgICAgIHZhciBkZWNvZGUgPSBJUls0XTsKICAgICAgICAgICAgdmFyIHNhbXBsZXMgPSBJUls1XTsKICAgICAgICAgICAgdmFyIHNpemUgPSBJUls2XTsKICAgICAgICAgICAgdmFyIG4gPSBJUls3XTsKICAgICAgICAgICAgdmFyIHJhbmdlID0gSVJbOV07CiAgICAgICAgICAgIHZhciBjdWJlVmVydGljZXMgPSAxIDw8IG07CiAgICAgICAgICAgIHZhciBjdWJlTiA9IG5ldyBGbG9hdDY0QXJyYXkoY3ViZVZlcnRpY2VzKTsKICAgICAgICAgICAgdmFyIGN1YmVWZXJ0ZXggPSBuZXcgVWludDMyQXJyYXkoY3ViZVZlcnRpY2VzKTsKICAgICAgICAgICAgdmFyIGksIGo7CgogICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgY3ViZVZlcnRpY2VzOyBqKyspIHsKICAgICAgICAgICAgICBjdWJlTltqXSA9IDE7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBrID0gbiwKICAgICAgICAgICAgICBwb3MgPSAxOwoKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IG07ICsraSkgewogICAgICAgICAgICAgIHZhciBkb21haW5fMmkgPSBkb21haW5baV1bMF07CiAgICAgICAgICAgICAgdmFyIGRvbWFpbl8yaV8xID0gZG9tYWluW2ldWzFdOwogICAgICAgICAgICAgIHZhciB4aSA9IE1hdGgubWluKE1hdGgubWF4KHNyY1tzcmNPZmZzZXQgKyBpXSwgZG9tYWluXzJpKSwgZG9tYWluXzJpXzEpOwogICAgICAgICAgICAgIHZhciBlID0gaW50ZXJwb2xhdGUoeGksIGRvbWFpbl8yaSwgZG9tYWluXzJpXzEsIGVuY29kZVtpXVswXSwgZW5jb2RlW2ldWzFdKTsKICAgICAgICAgICAgICB2YXIgc2l6ZV9pID0gc2l6ZVtpXTsKICAgICAgICAgICAgICBlID0gTWF0aC5taW4oTWF0aC5tYXgoZSwgMCksIHNpemVfaSAtIDEpOwogICAgICAgICAgICAgIHZhciBlMCA9IGUgPCBzaXplX2kgLSAxID8gTWF0aC5mbG9vcihlKSA6IGUgLSAxOwogICAgICAgICAgICAgIHZhciBuMCA9IGUwICsgMSAtIGU7CiAgICAgICAgICAgICAgdmFyIG4xID0gZSAtIGUwOwogICAgICAgICAgICAgIHZhciBvZmZzZXQwID0gZTAgKiBrOwogICAgICAgICAgICAgIHZhciBvZmZzZXQxID0gb2Zmc2V0MCArIGs7CgogICAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBjdWJlVmVydGljZXM7IGorKykgewogICAgICAgICAgICAgICAgaWYgKGogJiBwb3MpIHsKICAgICAgICAgICAgICAgICAgY3ViZU5bal0gKj0gbjE7CiAgICAgICAgICAgICAgICAgIGN1YmVWZXJ0ZXhbal0gKz0gb2Zmc2V0MTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIGN1YmVOW2pdICo9IG4wOwogICAgICAgICAgICAgICAgICBjdWJlVmVydGV4W2pdICs9IG9mZnNldDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBrICo9IHNpemVfaTsKICAgICAgICAgICAgICBwb3MgPDw9IDE7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBuOyArK2opIHsKICAgICAgICAgICAgICB2YXIgcmogPSAwOwoKICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY3ViZVZlcnRpY2VzOyBpKyspIHsKICAgICAgICAgICAgICAgIHJqICs9IHNhbXBsZXNbY3ViZVZlcnRleFtpXSArIGpdICogY3ViZU5baV07CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByaiA9IGludGVycG9sYXRlKHJqLCAwLCAxLCBkZWNvZGVbal1bMF0sIGRlY29kZVtqXVsxXSk7CiAgICAgICAgICAgICAgZGVzdFtkZXN0T2Zmc2V0ICsgal0gPSBNYXRoLm1pbihNYXRoLm1heChyaiwgcmFuZ2Vbal1bMF0pLCByYW5nZVtqXVsxXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgfSwKICAgICAgICBjb25zdHJ1Y3RJbnRlcnBvbGF0ZWQ6IGZ1bmN0aW9uIGNvbnN0cnVjdEludGVycG9sYXRlZChfcmVmOCkgewogICAgICAgICAgdmFyIHhyZWYgPSBfcmVmOC54cmVmLAogICAgICAgICAgICBpc0V2YWxTdXBwb3J0ZWQgPSBfcmVmOC5pc0V2YWxTdXBwb3J0ZWQsCiAgICAgICAgICAgIGZuID0gX3JlZjguZm4sCiAgICAgICAgICAgIGRpY3QgPSBfcmVmOC5kaWN0OwogICAgICAgICAgdmFyIGMwID0gdG9OdW1iZXJBcnJheShkaWN0LmdldEFycmF5KCJDMCIpKSB8fCBbMF07CiAgICAgICAgICB2YXIgYzEgPSB0b051bWJlckFycmF5KGRpY3QuZ2V0QXJyYXkoIkMxIikpIHx8IFsxXTsKICAgICAgICAgIHZhciBuID0gZGljdC5nZXQoIk4iKTsKICAgICAgICAgIHZhciBsZW5ndGggPSBjMC5sZW5ndGg7CiAgICAgICAgICB2YXIgZGlmZiA9IFtdOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgZGlmZi5wdXNoKGMxW2ldIC0gYzBbaV0pOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBbQ09OU1RSVUNUX0lOVEVSUE9MQVRFRCwgYzAsIGRpZmYsIG5dOwogICAgICAgIH0sCiAgICAgICAgY29uc3RydWN0SW50ZXJwb2xhdGVkRnJvbUlSOiBmdW5jdGlvbiBjb25zdHJ1Y3RJbnRlcnBvbGF0ZWRGcm9tSVIoX3JlZjkpIHsKICAgICAgICAgIHZhciB4cmVmID0gX3JlZjkueHJlZiwKICAgICAgICAgICAgaXNFdmFsU3VwcG9ydGVkID0gX3JlZjkuaXNFdmFsU3VwcG9ydGVkLAogICAgICAgICAgICBJUiA9IF9yZWY5LklSOwogICAgICAgICAgdmFyIGMwID0gSVJbMV07CiAgICAgICAgICB2YXIgZGlmZiA9IElSWzJdOwogICAgICAgICAgdmFyIG4gPSBJUlszXTsKICAgICAgICAgIHZhciBsZW5ndGggPSBkaWZmLmxlbmd0aDsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbiBjb25zdHJ1Y3RJbnRlcnBvbGF0ZWRGcm9tSVJSZXN1bHQoc3JjLCBzcmNPZmZzZXQsIGRlc3QsIGRlc3RPZmZzZXQpIHsKICAgICAgICAgICAgdmFyIHggPSBuID09PSAxID8gc3JjW3NyY09mZnNldF0gOiBNYXRoLnBvdyhzcmNbc3JjT2Zmc2V0XSwgbik7CgogICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGxlbmd0aDsgKytqKSB7CiAgICAgICAgICAgICAgZGVzdFtkZXN0T2Zmc2V0ICsgal0gPSBjMFtqXSArIHggKiBkaWZmW2pdOwogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgIH0sCiAgICAgICAgY29uc3RydWN0U3RpY2hlZDogZnVuY3Rpb24gY29uc3RydWN0U3RpY2hlZChfcmVmMTApIHsKICAgICAgICAgIHZhciB4cmVmID0gX3JlZjEwLnhyZWYsCiAgICAgICAgICAgIGlzRXZhbFN1cHBvcnRlZCA9IF9yZWYxMC5pc0V2YWxTdXBwb3J0ZWQsCiAgICAgICAgICAgIGZuID0gX3JlZjEwLmZuLAogICAgICAgICAgICBkaWN0ID0gX3JlZjEwLmRpY3Q7CiAgICAgICAgICB2YXIgZG9tYWluID0gdG9OdW1iZXJBcnJheShkaWN0LmdldEFycmF5KCJEb21haW4iKSk7CgogICAgICAgICAgaWYgKCFkb21haW4pIHsKICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJObyBkb21haW4iKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgaW5wdXRTaXplID0gZG9tYWluLmxlbmd0aCAvIDI7CgogICAgICAgICAgaWYgKGlucHV0U2l6ZSAhPT0gMSkgewogICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkJhZCBkb21haW4gZm9yIHN0aWNoZWQgZnVuY3Rpb24iKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZm5SZWZzID0gZGljdC5nZXQoIkZ1bmN0aW9ucyIpOwogICAgICAgICAgdmFyIGZucyA9IFtdOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGZuUmVmcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7CiAgICAgICAgICAgIGZucy5wdXNoKHRoaXMucGFyc2UoewogICAgICAgICAgICAgIHhyZWY6IHhyZWYsCiAgICAgICAgICAgICAgaXNFdmFsU3VwcG9ydGVkOiBpc0V2YWxTdXBwb3J0ZWQsCiAgICAgICAgICAgICAgZm46IHhyZWYuZmV0Y2hJZlJlZihmblJlZnNbaV0pCiAgICAgICAgICAgIH0pKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgYm91bmRzID0gdG9OdW1iZXJBcnJheShkaWN0LmdldEFycmF5KCJCb3VuZHMiKSk7CiAgICAgICAgICB2YXIgZW5jb2RlID0gdG9OdW1iZXJBcnJheShkaWN0LmdldEFycmF5KCJFbmNvZGUiKSk7CiAgICAgICAgICByZXR1cm4gW0NPTlNUUlVDVF9TVElDSEVELCBkb21haW4sIGJvdW5kcywgZW5jb2RlLCBmbnNdOwogICAgICAgIH0sCiAgICAgICAgY29uc3RydWN0U3RpY2hlZEZyb21JUjogZnVuY3Rpb24gY29uc3RydWN0U3RpY2hlZEZyb21JUihfcmVmMTEpIHsKICAgICAgICAgIHZhciB4cmVmID0gX3JlZjExLnhyZWYsCiAgICAgICAgICAgIGlzRXZhbFN1cHBvcnRlZCA9IF9yZWYxMS5pc0V2YWxTdXBwb3J0ZWQsCiAgICAgICAgICAgIElSID0gX3JlZjExLklSOwogICAgICAgICAgdmFyIGRvbWFpbiA9IElSWzFdOwogICAgICAgICAgdmFyIGJvdW5kcyA9IElSWzJdOwogICAgICAgICAgdmFyIGVuY29kZSA9IElSWzNdOwogICAgICAgICAgdmFyIGZucyA9IElSWzRdOwogICAgICAgICAgdmFyIHRtcEJ1ZiA9IG5ldyBGbG9hdDMyQXJyYXkoMSk7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gY29uc3RydWN0U3RpY2hlZEZyb21JUlJlc3VsdChzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgICAgICAgICB2YXIgY2xpcCA9IGZ1bmN0aW9uIGNvbnN0cnVjdFN0aWNoZWRGcm9tSVJDbGlwKHYsIG1pbiwgbWF4KSB7CiAgICAgICAgICAgICAgaWYgKHYgPiBtYXgpIHsKICAgICAgICAgICAgICAgIHYgPSBtYXg7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh2IDwgbWluKSB7CiAgICAgICAgICAgICAgICB2ID0gbWluOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIHY7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICB2YXIgdiA9IGNsaXAoc3JjW3NyY09mZnNldF0sIGRvbWFpblswXSwgZG9tYWluWzFdKTsKCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGJvdW5kcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7CiAgICAgICAgICAgICAgaWYgKHYgPCBib3VuZHNbaV0pIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGRtaW4gPSBkb21haW5bMF07CgogICAgICAgICAgICBpZiAoaSA+IDApIHsKICAgICAgICAgICAgICBkbWluID0gYm91bmRzW2kgLSAxXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGRtYXggPSBkb21haW5bMV07CgogICAgICAgICAgICBpZiAoaSA8IGJvdW5kcy5sZW5ndGgpIHsKICAgICAgICAgICAgICBkbWF4ID0gYm91bmRzW2ldOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcm1pbiA9IGVuY29kZVsyICogaV07CiAgICAgICAgICAgIHZhciBybWF4ID0gZW5jb2RlWzIgKiBpICsgMV07CiAgICAgICAgICAgIHRtcEJ1ZlswXSA9IGRtaW4gPT09IGRtYXggPyBybWluIDogcm1pbiArICh2IC0gZG1pbikgKiAocm1heCAtIHJtaW4pIC8gKGRtYXggLSBkbWluKTsKICAgICAgICAgICAgZm5zW2ldKHRtcEJ1ZiwgMCwgZGVzdCwgZGVzdE9mZnNldCk7CiAgICAgICAgICB9OwogICAgICAgIH0sCiAgICAgICAgY29uc3RydWN0UG9zdFNjcmlwdDogZnVuY3Rpb24gY29uc3RydWN0UG9zdFNjcmlwdChfcmVmMTIpIHsKICAgICAgICAgIHZhciB4cmVmID0gX3JlZjEyLnhyZWYsCiAgICAgICAgICAgIGlzRXZhbFN1cHBvcnRlZCA9IF9yZWYxMi5pc0V2YWxTdXBwb3J0ZWQsCiAgICAgICAgICAgIGZuID0gX3JlZjEyLmZuLAogICAgICAgICAgICBkaWN0ID0gX3JlZjEyLmRpY3Q7CiAgICAgICAgICB2YXIgZG9tYWluID0gdG9OdW1iZXJBcnJheShkaWN0LmdldEFycmF5KCJEb21haW4iKSk7CiAgICAgICAgICB2YXIgcmFuZ2UgPSB0b051bWJlckFycmF5KGRpY3QuZ2V0QXJyYXkoIlJhbmdlIikpOwoKICAgICAgICAgIGlmICghZG9tYWluKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiTm8gZG9tYWluLiIpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghcmFuZ2UpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJObyByYW5nZS4iKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgbGV4ZXIgPSBuZXcgX3BzX3BhcnNlci5Qb3N0U2NyaXB0TGV4ZXIoZm4pOwogICAgICAgICAgdmFyIHBhcnNlciA9IG5ldyBfcHNfcGFyc2VyLlBvc3RTY3JpcHRQYXJzZXIobGV4ZXIpOwogICAgICAgICAgdmFyIGNvZGUgPSBwYXJzZXIucGFyc2UoKTsKICAgICAgICAgIHJldHVybiBbQ09OU1RSVUNUX1BPU1RTQ1JJUFQsIGRvbWFpbiwgcmFuZ2UsIGNvZGVdOwogICAgICAgIH0sCiAgICAgICAgY29uc3RydWN0UG9zdFNjcmlwdEZyb21JUjogZnVuY3Rpb24gY29uc3RydWN0UG9zdFNjcmlwdEZyb21JUihfcmVmMTMpIHsKICAgICAgICAgIHZhciB4cmVmID0gX3JlZjEzLnhyZWYsCiAgICAgICAgICAgIGlzRXZhbFN1cHBvcnRlZCA9IF9yZWYxMy5pc0V2YWxTdXBwb3J0ZWQsCiAgICAgICAgICAgIElSID0gX3JlZjEzLklSOwogICAgICAgICAgdmFyIGRvbWFpbiA9IElSWzFdOwogICAgICAgICAgdmFyIHJhbmdlID0gSVJbMl07CiAgICAgICAgICB2YXIgY29kZSA9IElSWzNdOwoKICAgICAgICAgIGlmIChpc0V2YWxTdXBwb3J0ZWQgJiYgX3V0aWwuSXNFdmFsU3VwcG9ydGVkQ2FjaGVkLnZhbHVlKSB7CiAgICAgICAgICAgIHZhciBjb21waWxlZCA9IG5ldyBQb3N0U2NyaXB0Q29tcGlsZXIoKS5jb21waWxlKGNvZGUsIGRvbWFpbiwgcmFuZ2UpOwoKICAgICAgICAgICAgaWYgKGNvbXBpbGVkKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBGdW5jdGlvbigic3JjIiwgInNyY09mZnNldCIsICJkZXN0IiwgImRlc3RPZmZzZXQiLCBjb21waWxlZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICAoMCwgX3V0aWwuaW5mbykoIlVuYWJsZSB0byBjb21waWxlIFBTIGZ1bmN0aW9uIik7CiAgICAgICAgICB2YXIgbnVtT3V0cHV0cyA9IHJhbmdlLmxlbmd0aCA+PiAxOwogICAgICAgICAgdmFyIG51bUlucHV0cyA9IGRvbWFpbi5sZW5ndGggPj4gMTsKICAgICAgICAgIHZhciBldmFsdWF0b3IgPSBuZXcgUG9zdFNjcmlwdEV2YWx1YXRvcihjb2RlKTsKICAgICAgICAgIHZhciBjYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgICB2YXIgTUFYX0NBQ0hFX1NJWkUgPSAyMDQ4ICogNDsKICAgICAgICAgIHZhciBjYWNoZV9hdmFpbGFibGUgPSBNQVhfQ0FDSEVfU0laRTsKICAgICAgICAgIHZhciB0bXBCdWYgPSBuZXcgRmxvYXQzMkFycmF5KG51bUlucHV0cyk7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gY29uc3RydWN0UG9zdFNjcmlwdEZyb21JUlJlc3VsdChzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgICAgICAgICB2YXIgaSwgdmFsdWU7CiAgICAgICAgICAgIHZhciBrZXkgPSAiIjsKICAgICAgICAgICAgdmFyIGlucHV0ID0gdG1wQnVmOwoKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IG51bUlucHV0czsgaSsrKSB7CiAgICAgICAgICAgICAgdmFsdWUgPSBzcmNbc3JjT2Zmc2V0ICsgaV07CiAgICAgICAgICAgICAgaW5wdXRbaV0gPSB2YWx1ZTsKICAgICAgICAgICAgICBrZXkgKz0gdmFsdWUgKyAiXyI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBjYWNoZWRWYWx1ZSA9IGNhY2hlW2tleV07CgogICAgICAgICAgICBpZiAoY2FjaGVkVmFsdWUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIGRlc3Quc2V0KGNhY2hlZFZhbHVlLCBkZXN0T2Zmc2V0KTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBvdXRwdXQgPSBuZXcgRmxvYXQzMkFycmF5KG51bU91dHB1dHMpOwogICAgICAgICAgICB2YXIgc3RhY2sgPSBldmFsdWF0b3IuZXhlY3V0ZShpbnB1dCk7CiAgICAgICAgICAgIHZhciBzdGFja0luZGV4ID0gc3RhY2subGVuZ3RoIC0gbnVtT3V0cHV0czsKCiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBudW1PdXRwdXRzOyBpKyspIHsKICAgICAgICAgICAgICB2YWx1ZSA9IHN0YWNrW3N0YWNrSW5kZXggKyBpXTsKICAgICAgICAgICAgICB2YXIgYm91bmQgPSByYW5nZVtpICogMl07CgogICAgICAgICAgICAgIGlmICh2YWx1ZSA8IGJvdW5kKSB7CiAgICAgICAgICAgICAgICB2YWx1ZSA9IGJvdW5kOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBib3VuZCA9IHJhbmdlW2kgKiAyICsgMV07CgogICAgICAgICAgICAgICAgaWYgKHZhbHVlID4gYm91bmQpIHsKICAgICAgICAgICAgICAgICAgdmFsdWUgPSBib3VuZDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIG91dHB1dFtpXSA9IHZhbHVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoY2FjaGVfYXZhaWxhYmxlID4gMCkgewogICAgICAgICAgICAgIGNhY2hlX2F2YWlsYWJsZS0tOwogICAgICAgICAgICAgIGNhY2hlW2tleV0gPSBvdXRwdXQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGRlc3Quc2V0KG91dHB1dCwgZGVzdE9mZnNldCk7CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfTsKICAgIH0oKTsKCiAgICBmdW5jdGlvbiBpc1BERkZ1bmN0aW9uKHYpIHsKICAgICAgdmFyIGZuRGljdDsKCiAgICAgIGlmIChfdHlwZW9mKHYpICE9PSAib2JqZWN0IikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSBlbHNlIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNEaWN0KSh2KSkgewogICAgICAgIGZuRGljdCA9IHY7CiAgICAgIH0gZWxzZSBpZiAoKDAsIF9wcmltaXRpdmVzLmlzU3RyZWFtKSh2KSkgewogICAgICAgIGZuRGljdCA9IHYuZGljdDsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiBmbkRpY3QuaGFzKCJGdW5jdGlvblR5cGUiKTsKICAgIH0KCiAgICB2YXIgUG9zdFNjcmlwdFN0YWNrID0gZnVuY3Rpb24gUG9zdFNjcmlwdFN0YWNrQ2xvc3VyZSgpIHsKICAgICAgdmFyIE1BWF9TVEFDS19TSVpFID0gMTAwOwoKICAgICAgZnVuY3Rpb24gUG9zdFNjcmlwdFN0YWNrKGluaXRpYWxTdGFjaykgewogICAgICAgIHRoaXMuc3RhY2sgPSAhaW5pdGlhbFN0YWNrID8gW10gOiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChpbml0aWFsU3RhY2ssIDApOwogICAgICB9CgogICAgICBQb3N0U2NyaXB0U3RhY2sucHJvdG90eXBlID0gewogICAgICAgIHB1c2g6IGZ1bmN0aW9uIFBvc3RTY3JpcHRTdGFja19wdXNoKHZhbHVlKSB7CiAgICAgICAgICBpZiAodGhpcy5zdGFjay5sZW5ndGggPj0gTUFYX1NUQUNLX1NJWkUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJQb3N0U2NyaXB0IGZ1bmN0aW9uIHN0YWNrIG92ZXJmbG93LiIpOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuc3RhY2sucHVzaCh2YWx1ZSk7CiAgICAgICAgfSwKICAgICAgICBwb3A6IGZ1bmN0aW9uIFBvc3RTY3JpcHRTdGFja19wb3AoKSB7CiAgICAgICAgICBpZiAodGhpcy5zdGFjay5sZW5ndGggPD0gMCkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlBvc3RTY3JpcHQgZnVuY3Rpb24gc3RhY2sgdW5kZXJmbG93LiIpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB0aGlzLnN0YWNrLnBvcCgpOwogICAgICAgIH0sCiAgICAgICAgY29weTogZnVuY3Rpb24gUG9zdFNjcmlwdFN0YWNrX2NvcHkobikgewogICAgICAgICAgaWYgKHRoaXMuc3RhY2subGVuZ3RoICsgbiA+PSBNQVhfU1RBQ0tfU0laRSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlBvc3RTY3JpcHQgZnVuY3Rpb24gc3RhY2sgb3ZlcmZsb3cuIik7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHN0YWNrID0gdGhpcy5zdGFjazsKCiAgICAgICAgICBmb3IgKHZhciBpID0gc3RhY2subGVuZ3RoIC0gbiwgaiA9IG4gLSAxOyBqID49IDA7IGotLSwgaSsrKSB7CiAgICAgICAgICAgIHN0YWNrLnB1c2goc3RhY2tbaV0pOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgaW5kZXg6IGZ1bmN0aW9uIFBvc3RTY3JpcHRTdGFja19pbmRleChuKSB7CiAgICAgICAgICB0aGlzLnB1c2godGhpcy5zdGFja1t0aGlzLnN0YWNrLmxlbmd0aCAtIG4gLSAxXSk7CiAgICAgICAgfSwKICAgICAgICByb2xsOiBmdW5jdGlvbiBQb3N0U2NyaXB0U3RhY2tfcm9sbChuLCBwKSB7CiAgICAgICAgICB2YXIgc3RhY2sgPSB0aGlzLnN0YWNrOwogICAgICAgICAgdmFyIGwgPSBzdGFjay5sZW5ndGggLSBuOwogICAgICAgICAgdmFyIHIgPSBzdGFjay5sZW5ndGggLSAxLAogICAgICAgICAgICBjID0gbCArIChwIC0gTWF0aC5mbG9vcihwIC8gbikgKiBuKSwKICAgICAgICAgICAgaSwKICAgICAgICAgICAgaiwKICAgICAgICAgICAgdDsKCiAgICAgICAgICBmb3IgKGkgPSBsLCBqID0gcjsgaSA8IGo7IGkrKywgai0tKSB7CiAgICAgICAgICAgIHQgPSBzdGFja1tpXTsKICAgICAgICAgICAgc3RhY2tbaV0gPSBzdGFja1tqXTsKICAgICAgICAgICAgc3RhY2tbal0gPSB0OwogICAgICAgICAgfQoKICAgICAgICAgIGZvciAoaSA9IGwsIGogPSBjIC0gMTsgaSA8IGo7IGkrKywgai0tKSB7CiAgICAgICAgICAgIHQgPSBzdGFja1tpXTsKICAgICAgICAgICAgc3RhY2tbaV0gPSBzdGFja1tqXTsKICAgICAgICAgICAgc3RhY2tbal0gPSB0OwogICAgICAgICAgfQoKICAgICAgICAgIGZvciAoaSA9IGMsIGogPSByOyBpIDwgajsgaSsrLCBqLS0pIHsKICAgICAgICAgICAgdCA9IHN0YWNrW2ldOwogICAgICAgICAgICBzdGFja1tpXSA9IHN0YWNrW2pdOwogICAgICAgICAgICBzdGFja1tqXSA9IHQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OwogICAgICByZXR1cm4gUG9zdFNjcmlwdFN0YWNrOwogICAgfSgpOwoKICAgIHZhciBQb3N0U2NyaXB0RXZhbHVhdG9yID0gZnVuY3Rpb24gUG9zdFNjcmlwdEV2YWx1YXRvckNsb3N1cmUoKSB7CiAgICAgIGZ1bmN0aW9uIFBvc3RTY3JpcHRFdmFsdWF0b3Iob3BlcmF0b3JzKSB7CiAgICAgICAgdGhpcy5vcGVyYXRvcnMgPSBvcGVyYXRvcnM7CiAgICAgIH0KCiAgICAgIFBvc3RTY3JpcHRFdmFsdWF0b3IucHJvdG90eXBlID0gewogICAgICAgIGV4ZWN1dGU6IGZ1bmN0aW9uIFBvc3RTY3JpcHRFdmFsdWF0b3JfZXhlY3V0ZShpbml0aWFsU3RhY2spIHsKICAgICAgICAgIHZhciBzdGFjayA9IG5ldyBQb3N0U2NyaXB0U3RhY2soaW5pdGlhbFN0YWNrKTsKICAgICAgICAgIHZhciBjb3VudGVyID0gMDsKICAgICAgICAgIHZhciBvcGVyYXRvcnMgPSB0aGlzLm9wZXJhdG9yczsKICAgICAgICAgIHZhciBsZW5ndGggPSBvcGVyYXRvcnMubGVuZ3RoOwogICAgICAgICAgdmFyIG9wZXJhdG9yLCBhLCBiOwoKICAgICAgICAgIHdoaWxlIChjb3VudGVyIDwgbGVuZ3RoKSB7CiAgICAgICAgICAgIG9wZXJhdG9yID0gb3BlcmF0b3JzW2NvdW50ZXIrK107CgogICAgICAgICAgICBpZiAodHlwZW9mIG9wZXJhdG9yID09PSAibnVtYmVyIikgewogICAgICAgICAgICAgIHN0YWNrLnB1c2gob3BlcmF0b3IpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzd2l0Y2ggKG9wZXJhdG9yKSB7CiAgICAgICAgICAgICAgY2FzZSAianoiOgogICAgICAgICAgICAgICAgYiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwoKICAgICAgICAgICAgICAgIGlmICghYSkgewogICAgICAgICAgICAgICAgICBjb3VudGVyID0gYjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAiaiI6CiAgICAgICAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICBjb3VudGVyID0gYTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICJhYnMiOgogICAgICAgICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgc3RhY2sucHVzaChNYXRoLmFicyhhKSk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAiYWRkIjoKICAgICAgICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goYSArIGIpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgImFuZCI6CiAgICAgICAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CgogICAgICAgICAgICAgICAgaWYgKCgwLCBfdXRpbC5pc0Jvb2wpKGEpICYmICgwLCBfdXRpbC5pc0Jvb2wpKGIpKSB7CiAgICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goYSAmJiBiKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goYSAmIGIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICJhdGFuIjoKICAgICAgICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goTWF0aC5hdGFuKGEpKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICJiaXRzaGlmdCI6CiAgICAgICAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CgogICAgICAgICAgICAgICAgaWYgKGEgPiAwKSB7CiAgICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goYSA8PCBiKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goYSA+PiBiKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAiY2VpbGluZyI6CiAgICAgICAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICBzdGFjay5wdXNoKE1hdGguY2VpbChhKSk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAiY29weSI6CiAgICAgICAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICBzdGFjay5jb3B5KGEpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgImNvcyI6CiAgICAgICAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICBzdGFjay5wdXNoKE1hdGguY29zKGEpKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICJjdmkiOgogICAgICAgICAgICAgICAgYSA9IHN0YWNrLnBvcCgpIHwgMDsKICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goYSk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAiY3ZyIjoKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICJkaXYiOgogICAgICAgICAgICAgICAgYiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgc3RhY2sucHVzaChhIC8gYik7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAiZHVwIjoKICAgICAgICAgICAgICAgIHN0YWNrLmNvcHkoMSk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAiZXEiOgogICAgICAgICAgICAgICAgYiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgc3RhY2sucHVzaChhID09PSBiKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICJleGNoIjoKICAgICAgICAgICAgICAgIHN0YWNrLnJvbGwoMiwgMSk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAiZXhwIjoKICAgICAgICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goTWF0aC5wb3coYSwgYikpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgImZhbHNlIjoKICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goZmFsc2UpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgImZsb29yIjoKICAgICAgICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goTWF0aC5mbG9vcihhKSk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAiZ2UiOgogICAgICAgICAgICAgICAgYiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgc3RhY2sucHVzaChhID49IGIpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgImd0IjoKICAgICAgICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goYSA+IGIpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgImlkaXYiOgogICAgICAgICAgICAgICAgYiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgc3RhY2sucHVzaChhIC8gYiB8IDApOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgImluZGV4IjoKICAgICAgICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgIHN0YWNrLmluZGV4KGEpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgImxlIjoKICAgICAgICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goYSA8PSBiKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICJsbiI6CiAgICAgICAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICBzdGFjay5wdXNoKE1hdGgubG9nKGEpKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICJsb2ciOgogICAgICAgICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgc3RhY2sucHVzaChNYXRoLmxvZyhhKSAvIE1hdGguTE4xMCk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAibHQiOgogICAgICAgICAgICAgICAgYiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgc3RhY2sucHVzaChhIDwgYik7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAibW9kIjoKICAgICAgICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goYSAlIGIpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgIm11bCI6CiAgICAgICAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICBzdGFjay5wdXNoKGEgKiBiKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICJuZSI6CiAgICAgICAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICBzdGFjay5wdXNoKGEgIT09IGIpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgIm5lZyI6CiAgICAgICAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICBzdGFjay5wdXNoKC1hKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICJub3QiOgogICAgICAgICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwoKICAgICAgICAgICAgICAgIGlmICgoMCwgX3V0aWwuaXNCb29sKShhKSkgewogICAgICAgICAgICAgICAgICBzdGFjay5wdXNoKCFhKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHN0YWNrLnB1c2gofmEpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICJvciI6CiAgICAgICAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CgogICAgICAgICAgICAgICAgaWYgKCgwLCBfdXRpbC5pc0Jvb2wpKGEpICYmICgwLCBfdXRpbC5pc0Jvb2wpKGIpKSB7CiAgICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goYSB8fCBiKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goYSB8IGIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICJwb3AiOgogICAgICAgICAgICAgICAgc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAicm9sbCI6CiAgICAgICAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICBzdGFjay5yb2xsKGEsIGIpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgInJvdW5kIjoKICAgICAgICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goTWF0aC5yb3VuZChhKSk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAic2luIjoKICAgICAgICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goTWF0aC5zaW4oYSkpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgInNxcnQiOgogICAgICAgICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgc3RhY2sucHVzaChNYXRoLnNxcnQoYSkpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgInN1YiI6CiAgICAgICAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICBzdGFjay5wdXNoKGEgLSBiKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICJ0cnVlIjoKICAgICAgICAgICAgICAgIHN0YWNrLnB1c2godHJ1ZSk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAidHJ1bmNhdGUiOgogICAgICAgICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgYSA9IGEgPCAwID8gTWF0aC5jZWlsKGEpIDogTWF0aC5mbG9vcihhKTsKICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goYSk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAieG9yIjoKICAgICAgICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKCiAgICAgICAgICAgICAgICBpZiAoKDAsIF91dGlsLmlzQm9vbCkoYSkgJiYgKDAsIF91dGlsLmlzQm9vbCkoYikpIHsKICAgICAgICAgICAgICAgICAgc3RhY2sucHVzaChhICE9PSBiKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goYSBeIGIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJVbmtub3duIG9wZXJhdG9yICIuY29uY2F0KG9wZXJhdG9yKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gc3RhY2suc3RhY2s7CiAgICAgICAgfQogICAgICB9OwogICAgICByZXR1cm4gUG9zdFNjcmlwdEV2YWx1YXRvcjsKICAgIH0oKTsKCiAgICBleHBvcnRzLlBvc3RTY3JpcHRFdmFsdWF0b3IgPSBQb3N0U2NyaXB0RXZhbHVhdG9yOwoKICAgIHZhciBQb3N0U2NyaXB0Q29tcGlsZXIgPSBmdW5jdGlvbiBQb3N0U2NyaXB0Q29tcGlsZXJDbG9zdXJlKCkgewogICAgICBmdW5jdGlvbiBBc3ROb2RlKHR5cGUpIHsKICAgICAgICB0aGlzLnR5cGUgPSB0eXBlOwogICAgICB9CgogICAgICBBc3ROb2RlLnByb3RvdHlwZS52aXNpdCA9IGZ1bmN0aW9uICh2aXNpdG9yKSB7CiAgICAgICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgiYWJzdHJhY3QgbWV0aG9kIik7CiAgICAgIH07CgogICAgICBmdW5jdGlvbiBBc3RBcmd1bWVudChpbmRleCwgbWluLCBtYXgpIHsKICAgICAgICBBc3ROb2RlLmNhbGwodGhpcywgImFyZ3MiKTsKICAgICAgICB0aGlzLmluZGV4ID0gaW5kZXg7CiAgICAgICAgdGhpcy5taW4gPSBtaW47CiAgICAgICAgdGhpcy5tYXggPSBtYXg7CiAgICAgIH0KCiAgICAgIEFzdEFyZ3VtZW50LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoQXN0Tm9kZS5wcm90b3R5cGUpOwoKICAgICAgQXN0QXJndW1lbnQucHJvdG90eXBlLnZpc2l0ID0gZnVuY3Rpb24gKHZpc2l0b3IpIHsKICAgICAgICB2aXNpdG9yLnZpc2l0QXJndW1lbnQodGhpcyk7CiAgICAgIH07CgogICAgICBmdW5jdGlvbiBBc3RMaXRlcmFsKG51bWJlcikgewogICAgICAgIEFzdE5vZGUuY2FsbCh0aGlzLCAibGl0ZXJhbCIpOwogICAgICAgIHRoaXMubnVtYmVyID0gbnVtYmVyOwogICAgICAgIHRoaXMubWluID0gbnVtYmVyOwogICAgICAgIHRoaXMubWF4ID0gbnVtYmVyOwogICAgICB9CgogICAgICBBc3RMaXRlcmFsLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoQXN0Tm9kZS5wcm90b3R5cGUpOwoKICAgICAgQXN0TGl0ZXJhbC5wcm90b3R5cGUudmlzaXQgPSBmdW5jdGlvbiAodmlzaXRvcikgewogICAgICAgIHZpc2l0b3IudmlzaXRMaXRlcmFsKHRoaXMpOwogICAgICB9OwoKICAgICAgZnVuY3Rpb24gQXN0QmluYXJ5T3BlcmF0aW9uKG9wLCBhcmcxLCBhcmcyLCBtaW4sIG1heCkgewogICAgICAgIEFzdE5vZGUuY2FsbCh0aGlzLCAiYmluYXJ5Iik7CiAgICAgICAgdGhpcy5vcCA9IG9wOwogICAgICAgIHRoaXMuYXJnMSA9IGFyZzE7CiAgICAgICAgdGhpcy5hcmcyID0gYXJnMjsKICAgICAgICB0aGlzLm1pbiA9IG1pbjsKICAgICAgICB0aGlzLm1heCA9IG1heDsKICAgICAgfQoKICAgICAgQXN0QmluYXJ5T3BlcmF0aW9uLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoQXN0Tm9kZS5wcm90b3R5cGUpOwoKICAgICAgQXN0QmluYXJ5T3BlcmF0aW9uLnByb3RvdHlwZS52aXNpdCA9IGZ1bmN0aW9uICh2aXNpdG9yKSB7CiAgICAgICAgdmlzaXRvci52aXNpdEJpbmFyeU9wZXJhdGlvbih0aGlzKTsKICAgICAgfTsKCiAgICAgIGZ1bmN0aW9uIEFzdE1pbihhcmcsIG1heCkgewogICAgICAgIEFzdE5vZGUuY2FsbCh0aGlzLCAibWF4Iik7CiAgICAgICAgdGhpcy5hcmcgPSBhcmc7CiAgICAgICAgdGhpcy5taW4gPSBhcmcubWluOwogICAgICAgIHRoaXMubWF4ID0gbWF4OwogICAgICB9CgogICAgICBBc3RNaW4ucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShBc3ROb2RlLnByb3RvdHlwZSk7CgogICAgICBBc3RNaW4ucHJvdG90eXBlLnZpc2l0ID0gZnVuY3Rpb24gKHZpc2l0b3IpIHsKICAgICAgICB2aXNpdG9yLnZpc2l0TWluKHRoaXMpOwogICAgICB9OwoKICAgICAgZnVuY3Rpb24gQXN0VmFyaWFibGUoaW5kZXgsIG1pbiwgbWF4KSB7CiAgICAgICAgQXN0Tm9kZS5jYWxsKHRoaXMsICJ2YXIiKTsKICAgICAgICB0aGlzLmluZGV4ID0gaW5kZXg7CiAgICAgICAgdGhpcy5taW4gPSBtaW47CiAgICAgICAgdGhpcy5tYXggPSBtYXg7CiAgICAgIH0KCiAgICAgIEFzdFZhcmlhYmxlLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoQXN0Tm9kZS5wcm90b3R5cGUpOwoKICAgICAgQXN0VmFyaWFibGUucHJvdG90eXBlLnZpc2l0ID0gZnVuY3Rpb24gKHZpc2l0b3IpIHsKICAgICAgICB2aXNpdG9yLnZpc2l0VmFyaWFibGUodGhpcyk7CiAgICAgIH07CgogICAgICBmdW5jdGlvbiBBc3RWYXJpYWJsZURlZmluaXRpb24odmFyaWFibGUsIGFyZykgewogICAgICAgIEFzdE5vZGUuY2FsbCh0aGlzLCAiZGVmaW5pdGlvbiIpOwogICAgICAgIHRoaXMudmFyaWFibGUgPSB2YXJpYWJsZTsKICAgICAgICB0aGlzLmFyZyA9IGFyZzsKICAgICAgfQoKICAgICAgQXN0VmFyaWFibGVEZWZpbml0aW9uLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoQXN0Tm9kZS5wcm90b3R5cGUpOwoKICAgICAgQXN0VmFyaWFibGVEZWZpbml0aW9uLnByb3RvdHlwZS52aXNpdCA9IGZ1bmN0aW9uICh2aXNpdG9yKSB7CiAgICAgICAgdmlzaXRvci52aXNpdFZhcmlhYmxlRGVmaW5pdGlvbih0aGlzKTsKICAgICAgfTsKCiAgICAgIGZ1bmN0aW9uIEV4cHJlc3Npb25CdWlsZGVyVmlzaXRvcigpIHsKICAgICAgICB0aGlzLnBhcnRzID0gW107CiAgICAgIH0KCiAgICAgIEV4cHJlc3Npb25CdWlsZGVyVmlzaXRvci5wcm90b3R5cGUgPSB7CiAgICAgICAgdmlzaXRBcmd1bWVudDogZnVuY3Rpb24gdmlzaXRBcmd1bWVudChhcmcpIHsKICAgICAgICAgIHRoaXMucGFydHMucHVzaCgiTWF0aC5tYXgoIiwgYXJnLm1pbiwgIiwgTWF0aC5taW4oIiwgYXJnLm1heCwgIiwgc3JjW3NyY09mZnNldCArICIsIGFyZy5pbmRleCwgIl0pKSIpOwogICAgICAgIH0sCiAgICAgICAgdmlzaXRWYXJpYWJsZTogZnVuY3Rpb24gdmlzaXRWYXJpYWJsZSh2YXJpYWJsZSkgewogICAgICAgICAgdGhpcy5wYXJ0cy5wdXNoKCJ2IiwgdmFyaWFibGUuaW5kZXgpOwogICAgICAgIH0sCiAgICAgICAgdmlzaXRMaXRlcmFsOiBmdW5jdGlvbiB2aXNpdExpdGVyYWwobGl0ZXJhbCkgewogICAgICAgICAgdGhpcy5wYXJ0cy5wdXNoKGxpdGVyYWwubnVtYmVyKTsKICAgICAgICB9LAogICAgICAgIHZpc2l0QmluYXJ5T3BlcmF0aW9uOiBmdW5jdGlvbiB2aXNpdEJpbmFyeU9wZXJhdGlvbihvcGVyYXRpb24pIHsKICAgICAgICAgIHRoaXMucGFydHMucHVzaCgiKCIpOwogICAgICAgICAgb3BlcmF0aW9uLmFyZzEudmlzaXQodGhpcyk7CiAgICAgICAgICB0aGlzLnBhcnRzLnB1c2goIiAiLCBvcGVyYXRpb24ub3AsICIgIik7CiAgICAgICAgICBvcGVyYXRpb24uYXJnMi52aXNpdCh0aGlzKTsKICAgICAgICAgIHRoaXMucGFydHMucHVzaCgiKSIpOwogICAgICAgIH0sCiAgICAgICAgdmlzaXRWYXJpYWJsZURlZmluaXRpb246IGZ1bmN0aW9uIHZpc2l0VmFyaWFibGVEZWZpbml0aW9uKGRlZmluaXRpb24pIHsKICAgICAgICAgIHRoaXMucGFydHMucHVzaCgidmFyICIpOwogICAgICAgICAgZGVmaW5pdGlvbi52YXJpYWJsZS52aXNpdCh0aGlzKTsKICAgICAgICAgIHRoaXMucGFydHMucHVzaCgiID0gIik7CiAgICAgICAgICBkZWZpbml0aW9uLmFyZy52aXNpdCh0aGlzKTsKICAgICAgICAgIHRoaXMucGFydHMucHVzaCgiOyIpOwogICAgICAgIH0sCiAgICAgICAgdmlzaXRNaW46IGZ1bmN0aW9uIHZpc2l0TWluKG1heCkgewogICAgICAgICAgdGhpcy5wYXJ0cy5wdXNoKCJNYXRoLm1pbigiKTsKICAgICAgICAgIG1heC5hcmcudmlzaXQodGhpcyk7CiAgICAgICAgICB0aGlzLnBhcnRzLnB1c2goIiwgIiwgbWF4Lm1heCwgIikiKTsKICAgICAgICB9LAogICAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbiB0b1N0cmluZygpIHsKICAgICAgICAgIHJldHVybiB0aGlzLnBhcnRzLmpvaW4oIiIpOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIGZ1bmN0aW9uIGJ1aWxkQWRkT3BlcmF0aW9uKG51bTEsIG51bTIpIHsKICAgICAgICBpZiAobnVtMi50eXBlID09PSAibGl0ZXJhbCIgJiYgbnVtMi5udW1iZXIgPT09IDApIHsKICAgICAgICAgIHJldHVybiBudW0xOwogICAgICAgIH0KCiAgICAgICAgaWYgKG51bTEudHlwZSA9PT0gImxpdGVyYWwiICYmIG51bTEubnVtYmVyID09PSAwKSB7CiAgICAgICAgICByZXR1cm4gbnVtMjsKICAgICAgICB9CgogICAgICAgIGlmIChudW0yLnR5cGUgPT09ICJsaXRlcmFsIiAmJiBudW0xLnR5cGUgPT09ICJsaXRlcmFsIikgewogICAgICAgICAgcmV0dXJuIG5ldyBBc3RMaXRlcmFsKG51bTEubnVtYmVyICsgbnVtMi5udW1iZXIpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG5ldyBBc3RCaW5hcnlPcGVyYXRpb24oIisiLCBudW0xLCBudW0yLCBudW0xLm1pbiArIG51bTIubWluLCBudW0xLm1heCArIG51bTIubWF4KTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gYnVpbGRNdWxPcGVyYXRpb24obnVtMSwgbnVtMikgewogICAgICAgIGlmIChudW0yLnR5cGUgPT09ICJsaXRlcmFsIikgewogICAgICAgICAgaWYgKG51bTIubnVtYmVyID09PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgQXN0TGl0ZXJhbCgwKTsKICAgICAgICAgIH0gZWxzZSBpZiAobnVtMi5udW1iZXIgPT09IDEpIHsKICAgICAgICAgICAgcmV0dXJuIG51bTE7CiAgICAgICAgICB9IGVsc2UgaWYgKG51bTEudHlwZSA9PT0gImxpdGVyYWwiKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgQXN0TGl0ZXJhbChudW0xLm51bWJlciAqIG51bTIubnVtYmVyKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChudW0xLnR5cGUgPT09ICJsaXRlcmFsIikgewogICAgICAgICAgaWYgKG51bTEubnVtYmVyID09PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgQXN0TGl0ZXJhbCgwKTsKICAgICAgICAgIH0gZWxzZSBpZiAobnVtMS5udW1iZXIgPT09IDEpIHsKICAgICAgICAgICAgcmV0dXJuIG51bTI7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YXIgbWluID0gTWF0aC5taW4obnVtMS5taW4gKiBudW0yLm1pbiwgbnVtMS5taW4gKiBudW0yLm1heCwgbnVtMS5tYXggKiBudW0yLm1pbiwgbnVtMS5tYXggKiBudW0yLm1heCk7CiAgICAgICAgdmFyIG1heCA9IE1hdGgubWF4KG51bTEubWluICogbnVtMi5taW4sIG51bTEubWluICogbnVtMi5tYXgsIG51bTEubWF4ICogbnVtMi5taW4sIG51bTEubWF4ICogbnVtMi5tYXgpOwogICAgICAgIHJldHVybiBuZXcgQXN0QmluYXJ5T3BlcmF0aW9uKCIqIiwgbnVtMSwgbnVtMiwgbWluLCBtYXgpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBidWlsZFN1Yk9wZXJhdGlvbihudW0xLCBudW0yKSB7CiAgICAgICAgaWYgKG51bTIudHlwZSA9PT0gImxpdGVyYWwiKSB7CiAgICAgICAgICBpZiAobnVtMi5udW1iZXIgPT09IDApIHsKICAgICAgICAgICAgcmV0dXJuIG51bTE7CiAgICAgICAgICB9IGVsc2UgaWYgKG51bTEudHlwZSA9PT0gImxpdGVyYWwiKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgQXN0TGl0ZXJhbChudW0xLm51bWJlciAtIG51bTIubnVtYmVyKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChudW0yLnR5cGUgPT09ICJiaW5hcnkiICYmIG51bTIub3AgPT09ICItIiAmJiBudW0xLnR5cGUgPT09ICJsaXRlcmFsIiAmJiBudW0xLm51bWJlciA9PT0gMSAmJiBudW0yLmFyZzEudHlwZSA9PT0gImxpdGVyYWwiICYmIG51bTIuYXJnMS5udW1iZXIgPT09IDEpIHsKICAgICAgICAgIHJldHVybiBudW0yLmFyZzI7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbmV3IEFzdEJpbmFyeU9wZXJhdGlvbigiLSIsIG51bTEsIG51bTIsIG51bTEubWluIC0gbnVtMi5tYXgsIG51bTEubWF4IC0gbnVtMi5taW4pOwogICAgICB9CgogICAgICBmdW5jdGlvbiBidWlsZE1pbk9wZXJhdGlvbihudW0xLCBtYXgpIHsKICAgICAgICBpZiAobnVtMS5taW4gPj0gbWF4KSB7CiAgICAgICAgICByZXR1cm4gbmV3IEFzdExpdGVyYWwobWF4KTsKICAgICAgICB9IGVsc2UgaWYgKG51bTEubWF4IDw9IG1heCkgewogICAgICAgICAgcmV0dXJuIG51bTE7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbmV3IEFzdE1pbihudW0xLCBtYXgpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBQb3N0U2NyaXB0Q29tcGlsZXIoKSB7fQoKICAgICAgUG9zdFNjcmlwdENvbXBpbGVyLnByb3RvdHlwZSA9IHsKICAgICAgICBjb21waWxlOiBmdW5jdGlvbiBQb3N0U2NyaXB0Q29tcGlsZXJfY29tcGlsZShjb2RlLCBkb21haW4sIHJhbmdlKSB7CiAgICAgICAgICB2YXIgc3RhY2sgPSBbXTsKICAgICAgICAgIHZhciBpLCBpaTsKICAgICAgICAgIHZhciBpbnN0cnVjdGlvbnMgPSBbXTsKICAgICAgICAgIHZhciBpbnB1dFNpemUgPSBkb21haW4ubGVuZ3RoID4+IDEsCiAgICAgICAgICAgIG91dHB1dFNpemUgPSByYW5nZS5sZW5ndGggPj4gMTsKICAgICAgICAgIHZhciBsYXN0UmVnaXN0ZXIgPSAwOwogICAgICAgICAgdmFyIG4sIGo7CiAgICAgICAgICB2YXIgbnVtMSwgbnVtMiwgYXN0MSwgYXN0MiwgdG1wVmFyLCBpdGVtOwoKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBpbnB1dFNpemU7IGkrKykgewogICAgICAgICAgICBzdGFjay5wdXNoKG5ldyBBc3RBcmd1bWVudChpLCBkb21haW5baSAqIDJdLCBkb21haW5baSAqIDIgKyAxXSkpOwogICAgICAgICAgfQoKICAgICAgICAgIGZvciAoaSA9IDAsIGlpID0gY29kZS5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgIGl0ZW0gPSBjb2RlW2ldOwoKICAgICAgICAgICAgaWYgKHR5cGVvZiBpdGVtID09PSAibnVtYmVyIikgewogICAgICAgICAgICAgIHN0YWNrLnB1c2gobmV3IEFzdExpdGVyYWwoaXRlbSkpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzd2l0Y2ggKGl0ZW0pIHsKICAgICAgICAgICAgICBjYXNlICJhZGQiOgogICAgICAgICAgICAgICAgaWYgKHN0YWNrLmxlbmd0aCA8IDIpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbnVtMiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgbnVtMSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgc3RhY2sucHVzaChidWlsZEFkZE9wZXJhdGlvbihudW0xLCBudW0yKSk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAiY3ZyIjoKICAgICAgICAgICAgICAgIGlmIChzdGFjay5sZW5ndGggPCAxKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICJtdWwiOgogICAgICAgICAgICAgICAgaWYgKHN0YWNrLmxlbmd0aCA8IDIpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbnVtMiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgbnVtMSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgc3RhY2sucHVzaChidWlsZE11bE9wZXJhdGlvbihudW0xLCBudW0yKSk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAic3ViIjoKICAgICAgICAgICAgICAgIGlmIChzdGFjay5sZW5ndGggPCAyKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG51bTIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgIG51bTEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goYnVpbGRTdWJPcGVyYXRpb24obnVtMSwgbnVtMikpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgImV4Y2giOgogICAgICAgICAgICAgICAgaWYgKHN0YWNrLmxlbmd0aCA8IDIpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYXN0MSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgYXN0MiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgc3RhY2sucHVzaChhc3QxLCBhc3QyKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICJwb3AiOgogICAgICAgICAgICAgICAgaWYgKHN0YWNrLmxlbmd0aCA8IDEpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAiaW5kZXgiOgogICAgICAgICAgICAgICAgaWYgKHN0YWNrLmxlbmd0aCA8IDEpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbnVtMSA9IHN0YWNrLnBvcCgpOwoKICAgICAgICAgICAgICAgIGlmIChudW0xLnR5cGUgIT09ICJsaXRlcmFsIikgewogICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBuID0gbnVtMS5udW1iZXI7CgogICAgICAgICAgICAgICAgaWYgKG4gPCAwIHx8ICFOdW1iZXIuaXNJbnRlZ2VyKG4pIHx8IHN0YWNrLmxlbmd0aCA8IG4pIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYXN0MSA9IHN0YWNrW3N0YWNrLmxlbmd0aCAtIG4gLSAxXTsKCiAgICAgICAgICAgICAgICBpZiAoYXN0MS50eXBlID09PSAibGl0ZXJhbCIgfHwgYXN0MS50eXBlID09PSAidmFyIikgewogICAgICAgICAgICAgICAgICBzdGFjay5wdXNoKGFzdDEpOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0bXBWYXIgPSBuZXcgQXN0VmFyaWFibGUobGFzdFJlZ2lzdGVyKyssIGFzdDEubWluLCBhc3QxLm1heCk7CiAgICAgICAgICAgICAgICBzdGFja1tzdGFjay5sZW5ndGggLSBuIC0gMV0gPSB0bXBWYXI7CiAgICAgICAgICAgICAgICBzdGFjay5wdXNoKHRtcFZhcik7CiAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbnMucHVzaChuZXcgQXN0VmFyaWFibGVEZWZpbml0aW9uKHRtcFZhciwgYXN0MSkpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgImR1cCI6CiAgICAgICAgICAgICAgICBpZiAoc3RhY2subGVuZ3RoIDwgMSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGNvZGVbaSArIDFdID09PSAibnVtYmVyIiAmJiBjb2RlW2kgKyAyXSA9PT0gImd0IiAmJiBjb2RlW2kgKyAzXSA9PT0gaSArIDcgJiYgY29kZVtpICsgNF0gPT09ICJqeiIgJiYgY29kZVtpICsgNV0gPT09ICJwb3AiICYmIGNvZGVbaSArIDZdID09PSBjb2RlW2kgKyAxXSkgewogICAgICAgICAgICAgICAgICBudW0xID0gc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goYnVpbGRNaW5PcGVyYXRpb24obnVtMSwgY29kZVtpICsgMV0pKTsKICAgICAgICAgICAgICAgICAgaSArPSA2OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBhc3QxID0gc3RhY2tbc3RhY2subGVuZ3RoIC0gMV07CgogICAgICAgICAgICAgICAgaWYgKGFzdDEudHlwZSA9PT0gImxpdGVyYWwiIHx8IGFzdDEudHlwZSA9PT0gInZhciIpIHsKICAgICAgICAgICAgICAgICAgc3RhY2sucHVzaChhc3QxKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdG1wVmFyID0gbmV3IEFzdFZhcmlhYmxlKGxhc3RSZWdpc3RlcisrLCBhc3QxLm1pbiwgYXN0MS5tYXgpOwogICAgICAgICAgICAgICAgc3RhY2tbc3RhY2subGVuZ3RoIC0gMV0gPSB0bXBWYXI7CiAgICAgICAgICAgICAgICBzdGFjay5wdXNoKHRtcFZhcik7CiAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbnMucHVzaChuZXcgQXN0VmFyaWFibGVEZWZpbml0aW9uKHRtcFZhciwgYXN0MSkpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgInJvbGwiOgogICAgICAgICAgICAgICAgaWYgKHN0YWNrLmxlbmd0aCA8IDIpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbnVtMiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgbnVtMSA9IHN0YWNrLnBvcCgpOwoKICAgICAgICAgICAgICAgIGlmIChudW0yLnR5cGUgIT09ICJsaXRlcmFsIiB8fCBudW0xLnR5cGUgIT09ICJsaXRlcmFsIikgewogICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBqID0gbnVtMi5udW1iZXI7CiAgICAgICAgICAgICAgICBuID0gbnVtMS5udW1iZXI7CgogICAgICAgICAgICAgICAgaWYgKG4gPD0gMCB8fCAhTnVtYmVyLmlzSW50ZWdlcihuKSB8fCAhTnVtYmVyLmlzSW50ZWdlcihqKSB8fCBzdGFjay5sZW5ndGggPCBuKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGogPSAoaiAlIG4gKyBuKSAlIG47CgogICAgICAgICAgICAgICAgaWYgKGogPT09IDApIHsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkoc3RhY2ssIHN0YWNrLnNwbGljZShzdGFjay5sZW5ndGggLSBuLCBuIC0gaikpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmIChzdGFjay5sZW5ndGggIT09IG91dHB1dFNpemUpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHJlc3VsdCA9IFtdOwogICAgICAgICAgaW5zdHJ1Y3Rpb25zLmZvckVhY2goZnVuY3Rpb24gKGluc3RydWN0aW9uKSB7CiAgICAgICAgICAgIHZhciBzdGF0ZW1lbnRCdWlsZGVyID0gbmV3IEV4cHJlc3Npb25CdWlsZGVyVmlzaXRvcigpOwogICAgICAgICAgICBpbnN0cnVjdGlvbi52aXNpdChzdGF0ZW1lbnRCdWlsZGVyKTsKICAgICAgICAgICAgcmVzdWx0LnB1c2goc3RhdGVtZW50QnVpbGRlci50b1N0cmluZygpKTsKICAgICAgICAgIH0pOwogICAgICAgICAgc3RhY2suZm9yRWFjaChmdW5jdGlvbiAoZXhwciwgaSkgewogICAgICAgICAgICB2YXIgc3RhdGVtZW50QnVpbGRlciA9IG5ldyBFeHByZXNzaW9uQnVpbGRlclZpc2l0b3IoKTsKICAgICAgICAgICAgZXhwci52aXNpdChzdGF0ZW1lbnRCdWlsZGVyKTsKICAgICAgICAgICAgdmFyIG1pbiA9IHJhbmdlW2kgKiAyXSwKICAgICAgICAgICAgICBtYXggPSByYW5nZVtpICogMiArIDFdOwogICAgICAgICAgICB2YXIgb3V0ID0gW3N0YXRlbWVudEJ1aWxkZXIudG9TdHJpbmcoKV07CgogICAgICAgICAgICBpZiAobWluID4gZXhwci5taW4pIHsKICAgICAgICAgICAgICBvdXQudW5zaGlmdCgiTWF0aC5tYXgoIiwgbWluLCAiLCAiKTsKICAgICAgICAgICAgICBvdXQucHVzaCgiKSIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobWF4IDwgZXhwci5tYXgpIHsKICAgICAgICAgICAgICBvdXQudW5zaGlmdCgiTWF0aC5taW4oIiwgbWF4LCAiLCAiKTsKICAgICAgICAgICAgICBvdXQucHVzaCgiKSIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBvdXQudW5zaGlmdCgiZGVzdFtkZXN0T2Zmc2V0ICsgIiwgaSwgIl0gPSAiKTsKICAgICAgICAgICAgb3V0LnB1c2goIjsiKTsKICAgICAgICAgICAgcmVzdWx0LnB1c2gob3V0LmpvaW4oIiIpKTsKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIHJlc3VsdC5qb2luKCJcbiIpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgcmV0dXJuIFBvc3RTY3JpcHRDb21waWxlcjsKICAgIH0oKTsKCiAgICBleHBvcnRzLlBvc3RTY3JpcHRDb21waWxlciA9IFBvc3RTY3JpcHRDb21waWxlcjsKCiAgICAvKioqL30pLCAoCiAgLyogMjMwICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgIHZhbHVlOiB0cnVlCiAgICB9KTsKICAgIGV4cG9ydHMuUG9zdFNjcmlwdFBhcnNlciA9IGV4cG9ydHMuUG9zdFNjcmlwdExleGVyID0gdm9pZCAwOwoKICAgIHZhciBfdXRpbCA9IF9fd19wZGZqc19yZXF1aXJlX18oNSk7CgogICAgdmFyIF9wcmltaXRpdmVzID0gX193X3BkZmpzX3JlcXVpcmVfXygxOTQpOwoKICAgIHZhciBfY29yZV91dGlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTk3KTsKCiAgICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7aWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTt9fQoKICAgIGZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHtmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7dmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTtkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7ZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlO2lmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlO09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTt9fQoKICAgIGZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHtpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTtpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7cmV0dXJuIENvbnN0cnVjdG9yO30KCiAgICB2YXIgUG9zdFNjcmlwdFBhcnNlciA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgIGZ1bmN0aW9uIFBvc3RTY3JpcHRQYXJzZXIobGV4ZXIpIHsKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUG9zdFNjcmlwdFBhcnNlcik7CgogICAgICAgIHRoaXMubGV4ZXIgPSBsZXhlcjsKICAgICAgICB0aGlzLm9wZXJhdG9ycyA9IFtdOwogICAgICAgIHRoaXMudG9rZW4gPSBudWxsOwogICAgICAgIHRoaXMucHJldiA9IG51bGw7CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhQb3N0U2NyaXB0UGFyc2VyLCBbewogICAgICAgIGtleTogIm5leHRUb2tlbiIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIG5leHRUb2tlbigpIHsKICAgICAgICAgIHRoaXMucHJldiA9IHRoaXMudG9rZW47CiAgICAgICAgICB0aGlzLnRva2VuID0gdGhpcy5sZXhlci5nZXRUb2tlbigpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImFjY2VwdCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGFjY2VwdCh0eXBlKSB7CiAgICAgICAgICBpZiAodGhpcy50b2tlbi50eXBlID09PSB0eXBlKSB7CiAgICAgICAgICAgIHRoaXMubmV4dFRva2VuKCk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJleHBlY3QiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBleHBlY3QodHlwZSkgewogICAgICAgICAgaWYgKHRoaXMuYWNjZXB0KHR5cGUpKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiVW5leHBlY3RlZCBzeW1ib2w6IGZvdW5kICIuY29uY2F0KHRoaXMudG9rZW4udHlwZSwgIiBleHBlY3RlZCAiKS5jb25jYXQodHlwZSwgIi4iKSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAicGFyc2UiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBwYXJzZSgpIHsKICAgICAgICAgIHRoaXMubmV4dFRva2VuKCk7CiAgICAgICAgICB0aGlzLmV4cGVjdChQb3N0U2NyaXB0VG9rZW5UeXBlcy5MQlJBQ0UpOwogICAgICAgICAgdGhpcy5wYXJzZUJsb2NrKCk7CiAgICAgICAgICB0aGlzLmV4cGVjdChQb3N0U2NyaXB0VG9rZW5UeXBlcy5SQlJBQ0UpOwogICAgICAgICAgcmV0dXJuIHRoaXMub3BlcmF0b3JzOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInBhcnNlQmxvY2siLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBwYXJzZUJsb2NrKCkgewogICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgaWYgKHRoaXMuYWNjZXB0KFBvc3RTY3JpcHRUb2tlblR5cGVzLk5VTUJFUikpIHsKICAgICAgICAgICAgICB0aGlzLm9wZXJhdG9ycy5wdXNoKHRoaXMucHJldi52YWx1ZSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5hY2NlcHQoUG9zdFNjcmlwdFRva2VuVHlwZXMuT1BFUkFUT1IpKSB7CiAgICAgICAgICAgICAgdGhpcy5vcGVyYXRvcnMucHVzaCh0aGlzLnByZXYudmFsdWUpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYWNjZXB0KFBvc3RTY3JpcHRUb2tlblR5cGVzLkxCUkFDRSkpIHsKICAgICAgICAgICAgICB0aGlzLnBhcnNlQ29uZGl0aW9uKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAicGFyc2VDb25kaXRpb24iLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBwYXJzZUNvbmRpdGlvbigpIHsKICAgICAgICAgIHZhciBjb25kaXRpb25Mb2NhdGlvbiA9IHRoaXMub3BlcmF0b3JzLmxlbmd0aDsKICAgICAgICAgIHRoaXMub3BlcmF0b3JzLnB1c2gobnVsbCwgbnVsbCk7CiAgICAgICAgICB0aGlzLnBhcnNlQmxvY2soKTsKICAgICAgICAgIHRoaXMuZXhwZWN0KFBvc3RTY3JpcHRUb2tlblR5cGVzLlJCUkFDRSk7CgogICAgICAgICAgaWYgKHRoaXMuYWNjZXB0KFBvc3RTY3JpcHRUb2tlblR5cGVzLklGKSkgewogICAgICAgICAgICB0aGlzLm9wZXJhdG9yc1tjb25kaXRpb25Mb2NhdGlvbl0gPSB0aGlzLm9wZXJhdG9ycy5sZW5ndGg7CiAgICAgICAgICAgIHRoaXMub3BlcmF0b3JzW2NvbmRpdGlvbkxvY2F0aW9uICsgMV0gPSAianoiOwogICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmFjY2VwdChQb3N0U2NyaXB0VG9rZW5UeXBlcy5MQlJBQ0UpKSB7CiAgICAgICAgICAgIHZhciBqdW1wTG9jYXRpb24gPSB0aGlzLm9wZXJhdG9ycy5sZW5ndGg7CiAgICAgICAgICAgIHRoaXMub3BlcmF0b3JzLnB1c2gobnVsbCwgbnVsbCk7CiAgICAgICAgICAgIHZhciBlbmRPZlRydWUgPSB0aGlzLm9wZXJhdG9ycy5sZW5ndGg7CiAgICAgICAgICAgIHRoaXMucGFyc2VCbG9jaygpOwogICAgICAgICAgICB0aGlzLmV4cGVjdChQb3N0U2NyaXB0VG9rZW5UeXBlcy5SQlJBQ0UpOwogICAgICAgICAgICB0aGlzLmV4cGVjdChQb3N0U2NyaXB0VG9rZW5UeXBlcy5JRkVMU0UpOwogICAgICAgICAgICB0aGlzLm9wZXJhdG9yc1tqdW1wTG9jYXRpb25dID0gdGhpcy5vcGVyYXRvcnMubGVuZ3RoOwogICAgICAgICAgICB0aGlzLm9wZXJhdG9yc1tqdW1wTG9jYXRpb24gKyAxXSA9ICJqIjsKICAgICAgICAgICAgdGhpcy5vcGVyYXRvcnNbY29uZGl0aW9uTG9jYXRpb25dID0gZW5kT2ZUcnVlOwogICAgICAgICAgICB0aGlzLm9wZXJhdG9yc1tjb25kaXRpb25Mb2NhdGlvbiArIDFdID0gImp6IjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiUFMgRnVuY3Rpb246IGVycm9yIHBhcnNpbmcgY29uZGl0aW9uYWwuIik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9XSk7CgogICAgICByZXR1cm4gUG9zdFNjcmlwdFBhcnNlcjsKICAgIH0oKTsKCiAgICBleHBvcnRzLlBvc3RTY3JpcHRQYXJzZXIgPSBQb3N0U2NyaXB0UGFyc2VyOwogICAgdmFyIFBvc3RTY3JpcHRUb2tlblR5cGVzID0gewogICAgICBMQlJBQ0U6IDAsCiAgICAgIFJCUkFDRTogMSwKICAgICAgTlVNQkVSOiAyLAogICAgICBPUEVSQVRPUjogMywKICAgICAgSUY6IDQsCiAgICAgIElGRUxTRTogNQogICAgfTsKCiAgICB2YXIgUG9zdFNjcmlwdFRva2VuID0gZnVuY3Rpb24gUG9zdFNjcmlwdFRva2VuQ2xvc3VyZSgpIHsKICAgICAgdmFyIG9wQ2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwoKICAgICAgdmFyIFBvc3RTY3JpcHRUb2tlbiA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gUG9zdFNjcmlwdFRva2VuKHR5cGUsIHZhbHVlKSB7CiAgICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUG9zdFNjcmlwdFRva2VuKTsKCiAgICAgICAgICB0aGlzLnR5cGUgPSB0eXBlOwogICAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlOwogICAgICAgIH0KCiAgICAgICAgX2NyZWF0ZUNsYXNzKFBvc3RTY3JpcHRUb2tlbiwgbnVsbCwgW3sKICAgICAgICAgIGtleTogImdldE9wZXJhdG9yIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRPcGVyYXRvcihvcCkgewogICAgICAgICAgICB2YXIgb3BWYWx1ZSA9IG9wQ2FjaGVbb3BdOwoKICAgICAgICAgICAgaWYgKG9wVmFsdWUpIHsKICAgICAgICAgICAgICByZXR1cm4gb3BWYWx1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIG9wQ2FjaGVbb3BdID0gbmV3IFBvc3RTY3JpcHRUb2tlbihQb3N0U2NyaXB0VG9rZW5UeXBlcy5PUEVSQVRPUiwgb3ApOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogIkxCUkFDRSIsCiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJMQlJBQ0UiLCBuZXcgUG9zdFNjcmlwdFRva2VuKFBvc3RTY3JpcHRUb2tlblR5cGVzLkxCUkFDRSwgInsiKSk7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAiUkJSQUNFIiwKICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgIlJCUkFDRSIsIG5ldyBQb3N0U2NyaXB0VG9rZW4oUG9zdFNjcmlwdFRva2VuVHlwZXMuUkJSQUNFLCAifSIpKTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJJRiIsCiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJJRiIsIG5ldyBQb3N0U2NyaXB0VG9rZW4oUG9zdFNjcmlwdFRva2VuVHlwZXMuSUYsICJJRiIpKTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJJRkVMU0UiLAogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAiSUZFTFNFIiwgbmV3IFBvc3RTY3JpcHRUb2tlbihQb3N0U2NyaXB0VG9rZW5UeXBlcy5JRkVMU0UsICJJRkVMU0UiKSk7CiAgICAgICAgICB9CiAgICAgICAgfV0pOwoKICAgICAgICByZXR1cm4gUG9zdFNjcmlwdFRva2VuOwogICAgICB9KCk7CgogICAgICByZXR1cm4gUG9zdFNjcmlwdFRva2VuOwogICAgfSgpOwoKICAgIHZhciBQb3N0U2NyaXB0TGV4ZXIgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBQb3N0U2NyaXB0TGV4ZXIoc3RyZWFtKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFBvc3RTY3JpcHRMZXhlcik7CgogICAgICAgIHRoaXMuc3RyZWFtID0gc3RyZWFtOwogICAgICAgIHRoaXMubmV4dENoYXIoKTsKICAgICAgICB0aGlzLnN0ckJ1ZiA9IFtdOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoUG9zdFNjcmlwdExleGVyLCBbewogICAgICAgIGtleTogIm5leHRDaGFyIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gbmV4dENoYXIoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50Q2hhciA9IHRoaXMuc3RyZWFtLmdldEJ5dGUoKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJnZXRUb2tlbiIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldFRva2VuKCkgewogICAgICAgICAgdmFyIGNvbW1lbnQgPSBmYWxzZTsKICAgICAgICAgIHZhciBjaCA9IHRoaXMuY3VycmVudENoYXI7CgogICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgaWYgKGNoIDwgMCkgewogICAgICAgICAgICAgIHJldHVybiBfcHJpbWl0aXZlcy5FT0Y7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChjb21tZW50KSB7CiAgICAgICAgICAgICAgaWYgKGNoID09PSAweDBhIHx8IGNoID09PSAweDBkKSB7CiAgICAgICAgICAgICAgICBjb21tZW50ID0gZmFsc2U7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKGNoID09PSAweDI1KSB7CiAgICAgICAgICAgICAgY29tbWVudCA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoISgwLCBfY29yZV91dGlscy5pc1doaXRlU3BhY2UpKGNoKSkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBzd2l0Y2ggKGNoIHwgMCkgewogICAgICAgICAgICBjYXNlIDB4MzA6CiAgICAgICAgICAgIGNhc2UgMHgzMToKICAgICAgICAgICAgY2FzZSAweDMyOgogICAgICAgICAgICBjYXNlIDB4MzM6CiAgICAgICAgICAgIGNhc2UgMHgzNDoKICAgICAgICAgICAgY2FzZSAweDM1OgogICAgICAgICAgICBjYXNlIDB4MzY6CiAgICAgICAgICAgIGNhc2UgMHgzNzoKICAgICAgICAgICAgY2FzZSAweDM4OgogICAgICAgICAgICBjYXNlIDB4Mzk6CiAgICAgICAgICAgIGNhc2UgMHgyYjoKICAgICAgICAgICAgY2FzZSAweDJkOgogICAgICAgICAgICBjYXNlIDB4MmU6CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQb3N0U2NyaXB0VG9rZW4oUG9zdFNjcmlwdFRva2VuVHlwZXMuTlVNQkVSLCB0aGlzLmdldE51bWJlcigpKTsKCiAgICAgICAgICAgIGNhc2UgMHg3YjoKICAgICAgICAgICAgICB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgICAgICAgcmV0dXJuIFBvc3RTY3JpcHRUb2tlbi5MQlJBQ0U7CgogICAgICAgICAgICBjYXNlIDB4N2Q6CiAgICAgICAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgICAgIHJldHVybiBQb3N0U2NyaXB0VG9rZW4uUkJSQUNFOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBzdHJCdWYgPSB0aGlzLnN0ckJ1ZjsKICAgICAgICAgIHN0ckJ1Zi5sZW5ndGggPSAwOwogICAgICAgICAgc3RyQnVmWzBdID0gU3RyaW5nLmZyb21DaGFyQ29kZShjaCk7CgogICAgICAgICAgd2hpbGUgKChjaCA9IHRoaXMubmV4dENoYXIoKSkgPj0gMCAmJiAoY2ggPj0gMHg0MSAmJiBjaCA8PSAweDVhIHx8IGNoID49IDB4NjEgJiYgY2ggPD0gMHg3YSkpIHsKICAgICAgICAgICAgc3RyQnVmLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZShjaCkpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBzdHIgPSBzdHJCdWYuam9pbigiIik7CgogICAgICAgICAgc3dpdGNoIChzdHIudG9Mb3dlckNhc2UoKSkgewogICAgICAgICAgICBjYXNlICJpZiI6CiAgICAgICAgICAgICAgcmV0dXJuIFBvc3RTY3JpcHRUb2tlbi5JRjsKCiAgICAgICAgICAgIGNhc2UgImlmZWxzZSI6CiAgICAgICAgICAgICAgcmV0dXJuIFBvc3RTY3JpcHRUb2tlbi5JRkVMU0U7CgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIHJldHVybiBQb3N0U2NyaXB0VG9rZW4uZ2V0T3BlcmF0b3Ioc3RyKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJnZXROdW1iZXIiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXROdW1iZXIoKSB7CiAgICAgICAgICB2YXIgY2ggPSB0aGlzLmN1cnJlbnRDaGFyOwogICAgICAgICAgdmFyIHN0ckJ1ZiA9IHRoaXMuc3RyQnVmOwogICAgICAgICAgc3RyQnVmLmxlbmd0aCA9IDA7CiAgICAgICAgICBzdHJCdWZbMF0gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNoKTsKCiAgICAgICAgICB3aGlsZSAoKGNoID0gdGhpcy5uZXh0Q2hhcigpKSA+PSAwKSB7CiAgICAgICAgICAgIGlmIChjaCA+PSAweDMwICYmIGNoIDw9IDB4MzkgfHwgY2ggPT09IDB4MmQgfHwgY2ggPT09IDB4MmUpIHsKICAgICAgICAgICAgICBzdHJCdWYucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKGNoKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgdmFsdWUgPSBwYXJzZUZsb2F0KHN0ckJ1Zi5qb2luKCIiKSk7CgogICAgICAgICAgaWYgKGlzTmFOKHZhbHVlKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkludmFsaWQgZmxvYXRpbmcgcG9pbnQgbnVtYmVyOiAiLmNvbmNhdCh2YWx1ZSkpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBQb3N0U2NyaXB0TGV4ZXI7CiAgICB9KCk7CgogICAgZXhwb3J0cy5Qb3N0U2NyaXB0TGV4ZXIgPSBQb3N0U2NyaXB0TGV4ZXI7CgogICAgLyoqKi99KSwgKAogIC8qIDIzMSAqLwogIC8qKiovZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgewoKICAgICJ1c2Ugc3RyaWN0IjsKCgogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICB2YWx1ZTogdHJ1ZQogICAgfSk7CiAgICBleHBvcnRzLk11cm11ckhhc2gzXzY0ID0gdm9pZCAwOwoKICAgIHZhciBfdXRpbCA9IF9fd19wZGZqc19yZXF1aXJlX18oNSk7CgogICAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3Rvcikge2lmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7fX0KCiAgICBmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7Zm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykge3ZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07ZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlO2Rlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTtpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTtPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7fX0KCiAgICBmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7aWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7aWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpO3JldHVybiBDb25zdHJ1Y3Rvcjt9CgogICAgdmFyIFNFRUQgPSAweGMzZDJlMWYwOwogICAgdmFyIE1BU0tfSElHSCA9IDB4ZmZmZjAwMDA7CiAgICB2YXIgTUFTS19MT1cgPSAweGZmZmY7CgogICAgdmFyIE11cm11ckhhc2gzXzY0ID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gTXVybXVySGFzaDNfNjQoc2VlZCkgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBNdXJtdXJIYXNoM182NCk7CgogICAgICAgIHRoaXMuaDEgPSBzZWVkID8gc2VlZCAmIDB4ZmZmZmZmZmYgOiBTRUVEOwogICAgICAgIHRoaXMuaDIgPSBzZWVkID8gc2VlZCAmIDB4ZmZmZmZmZmYgOiBTRUVEOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoTXVybXVySGFzaDNfNjQsIFt7CiAgICAgICAga2V5OiAidXBkYXRlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gdXBkYXRlKGlucHV0KSB7CiAgICAgICAgICB2YXIgZGF0YSwgbGVuZ3RoOwoKICAgICAgICAgIGlmICgoMCwgX3V0aWwuaXNTdHJpbmcpKGlucHV0KSkgewogICAgICAgICAgICBkYXRhID0gbmV3IFVpbnQ4QXJyYXkoaW5wdXQubGVuZ3RoICogMik7CiAgICAgICAgICAgIGxlbmd0aCA9IDA7CgogICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBpbnB1dC5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgICAgdmFyIGNvZGUgPSBpbnB1dC5jaGFyQ29kZUF0KGkpOwoKICAgICAgICAgICAgICBpZiAoY29kZSA8PSAweGZmKSB7CiAgICAgICAgICAgICAgICBkYXRhW2xlbmd0aCsrXSA9IGNvZGU7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGRhdGFbbGVuZ3RoKytdID0gY29kZSA+Pj4gODsKICAgICAgICAgICAgICAgIGRhdGFbbGVuZ3RoKytdID0gY29kZSAmIDB4ZmY7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKCgwLCBfdXRpbC5pc0FycmF5QnVmZmVyKShpbnB1dCkpIHsKICAgICAgICAgICAgZGF0YSA9IGlucHV0OwogICAgICAgICAgICBsZW5ndGggPSBkYXRhLmJ5dGVMZW5ndGg7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIldyb25nIGRhdGEgZm9ybWF0IGluIE11cm11ckhhc2gzXzY0X3VwZGF0ZS4gIiArICJJbnB1dCBtdXN0IGJlIGEgc3RyaW5nIG9yIGFycmF5LiIpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBibG9ja0NvdW50cyA9IGxlbmd0aCA+PiAyOwogICAgICAgICAgdmFyIHRhaWxMZW5ndGggPSBsZW5ndGggLSBibG9ja0NvdW50cyAqIDQ7CiAgICAgICAgICB2YXIgZGF0YVVpbnQzMiA9IG5ldyBVaW50MzJBcnJheShkYXRhLmJ1ZmZlciwgMCwgYmxvY2tDb3VudHMpOwogICAgICAgICAgdmFyIGsxID0gMCwKICAgICAgICAgICAgazIgPSAwOwogICAgICAgICAgdmFyIGgxID0gdGhpcy5oMSwKICAgICAgICAgICAgaDIgPSB0aGlzLmgyOwogICAgICAgICAgdmFyIEMxID0gMHhjYzllMmQ1MSwKICAgICAgICAgICAgQzIgPSAweDFiODczNTkzOwogICAgICAgICAgdmFyIEMxX0xPVyA9IEMxICYgTUFTS19MT1csCiAgICAgICAgICAgIEMyX0xPVyA9IEMyICYgTUFTS19MT1c7CgogICAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGJsb2NrQ291bnRzOyBfaSsrKSB7CiAgICAgICAgICAgIGlmIChfaSAmIDEpIHsKICAgICAgICAgICAgICBrMSA9IGRhdGFVaW50MzJbX2ldOwogICAgICAgICAgICAgIGsxID0gazEgKiBDMSAmIE1BU0tfSElHSCB8IGsxICogQzFfTE9XICYgTUFTS19MT1c7CiAgICAgICAgICAgICAgazEgPSBrMSA8PCAxNSB8IGsxID4+PiAxNzsKICAgICAgICAgICAgICBrMSA9IGsxICogQzIgJiBNQVNLX0hJR0ggfCBrMSAqIEMyX0xPVyAmIE1BU0tfTE9XOwogICAgICAgICAgICAgIGgxIF49IGsxOwogICAgICAgICAgICAgIGgxID0gaDEgPDwgMTMgfCBoMSA+Pj4gMTk7CiAgICAgICAgICAgICAgaDEgPSBoMSAqIDUgKyAweGU2NTQ2YjY0OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGsyID0gZGF0YVVpbnQzMltfaV07CiAgICAgICAgICAgICAgazIgPSBrMiAqIEMxICYgTUFTS19ISUdIIHwgazIgKiBDMV9MT1cgJiBNQVNLX0xPVzsKICAgICAgICAgICAgICBrMiA9IGsyIDw8IDE1IHwgazIgPj4+IDE3OwogICAgICAgICAgICAgIGsyID0gazIgKiBDMiAmIE1BU0tfSElHSCB8IGsyICogQzJfTE9XICYgTUFTS19MT1c7CiAgICAgICAgICAgICAgaDIgXj0gazI7CiAgICAgICAgICAgICAgaDIgPSBoMiA8PCAxMyB8IGgyID4+PiAxOTsKICAgICAgICAgICAgICBoMiA9IGgyICogNSArIDB4ZTY1NDZiNjQ7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBrMSA9IDA7CgogICAgICAgICAgc3dpdGNoICh0YWlsTGVuZ3RoKSB7CiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICBrMSBePSBkYXRhW2Jsb2NrQ291bnRzICogNCArIDJdIDw8IDE2OwoKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIGsxIF49IGRhdGFbYmxvY2tDb3VudHMgKiA0ICsgMV0gPDwgODsKCiAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICBrMSBePSBkYXRhW2Jsb2NrQ291bnRzICogNF07CiAgICAgICAgICAgICAgazEgPSBrMSAqIEMxICYgTUFTS19ISUdIIHwgazEgKiBDMV9MT1cgJiBNQVNLX0xPVzsKICAgICAgICAgICAgICBrMSA9IGsxIDw8IDE1IHwgazEgPj4+IDE3OwogICAgICAgICAgICAgIGsxID0gazEgKiBDMiAmIE1BU0tfSElHSCB8IGsxICogQzJfTE9XICYgTUFTS19MT1c7CgogICAgICAgICAgICAgIGlmIChibG9ja0NvdW50cyAmIDEpIHsKICAgICAgICAgICAgICAgIGgxIF49IGsxOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBoMiBePSBrMTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuaDEgPSBoMTsKICAgICAgICAgIHRoaXMuaDIgPSBoMjsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJoZXhkaWdlc3QiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBoZXhkaWdlc3QoKSB7CiAgICAgICAgICB2YXIgaDEgPSB0aGlzLmgxLAogICAgICAgICAgICBoMiA9IHRoaXMuaDI7CiAgICAgICAgICBoMSBePSBoMiA+Pj4gMTsKICAgICAgICAgIGgxID0gaDEgKiAweGVkNTU4Y2NkICYgTUFTS19ISUdIIHwgaDEgKiAweDhjY2QgJiBNQVNLX0xPVzsKICAgICAgICAgIGgyID0gaDIgKiAweGZmNTFhZmQ3ICYgTUFTS19ISUdIIHwgKChoMiA8PCAxNiB8IGgxID4+PiAxNikgKiAweGFmZDdlZDU1ICYgTUFTS19ISUdIKSA+Pj4gMTY7CiAgICAgICAgICBoMSBePSBoMiA+Pj4gMTsKICAgICAgICAgIGgxID0gaDEgKiAweDFhODVlYzUzICYgTUFTS19ISUdIIHwgaDEgKiAweGVjNTMgJiBNQVNLX0xPVzsKICAgICAgICAgIGgyID0gaDIgKiAweGM0Y2ViOWZlICYgTUFTS19ISUdIIHwgKChoMiA8PCAxNiB8IGgxID4+PiAxNikgKiAweGI5ZmUxYTg1ICYgTUFTS19ISUdIKSA+Pj4gMTY7CiAgICAgICAgICBoMSBePSBoMiA+Pj4gMTsKICAgICAgICAgIHZhciBoZXgxID0gKGgxID4+PiAwKS50b1N0cmluZygxNiksCiAgICAgICAgICAgIGhleDIgPSAoaDIgPj4+IDApLnRvU3RyaW5nKDE2KTsKICAgICAgICAgIHJldHVybiBoZXgxLnBhZFN0YXJ0KDgsICIwIikgKyBoZXgyLnBhZFN0YXJ0KDgsICIwIik7CiAgICAgICAgfQogICAgICB9XSk7CgogICAgICByZXR1cm4gTXVybXVySGFzaDNfNjQ7CiAgICB9KCk7CgogICAgZXhwb3J0cy5NdXJtdXJIYXNoM182NCA9IE11cm11ckhhc2gzXzY0OwoKICAgIC8qKiovfSksICgKICAvKiAyMzIgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgoKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgICAgdmFsdWU6IHRydWUKICAgIH0pOwogICAgZXhwb3J0cy5OYXRpdmVJbWFnZURlY29kZXIgPSB2b2lkIDA7CgogICAgdmFyIF9jb2xvcnNwYWNlID0gX193X3BkZmpzX3JlcXVpcmVfXygyMTIpOwoKICAgIHZhciBfanBlZ19zdHJlYW0gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIwNyk7CgogICAgdmFyIF9zdHJlYW0gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIwMSk7CgogICAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3Rvcikge2lmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7fX0KCiAgICBmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7Zm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykge3ZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07ZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlO2Rlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTtpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTtPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7fX0KCiAgICBmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7aWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7aWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpO3JldHVybiBDb25zdHJ1Y3Rvcjt9CgogICAgdmFyIE5hdGl2ZUltYWdlRGVjb2RlciA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgIGZ1bmN0aW9uIE5hdGl2ZUltYWdlRGVjb2RlcihfcmVmKSB7CiAgICAgICAgdmFyIHhyZWYgPSBfcmVmLnhyZWYsCiAgICAgICAgICByZXNvdXJjZXMgPSBfcmVmLnJlc291cmNlcywKICAgICAgICAgIGhhbmRsZXIgPSBfcmVmLmhhbmRsZXIsCiAgICAgICAgICBfcmVmJGZvcmNlRGF0YVNjaGVtYSA9IF9yZWYuZm9yY2VEYXRhU2NoZW1hLAogICAgICAgICAgZm9yY2VEYXRhU2NoZW1hID0gX3JlZiRmb3JjZURhdGFTY2hlbWEgPT09IHZvaWQgMCA/IGZhbHNlIDogX3JlZiRmb3JjZURhdGFTY2hlbWEsCiAgICAgICAgICBwZGZGdW5jdGlvbkZhY3RvcnkgPSBfcmVmLnBkZkZ1bmN0aW9uRmFjdG9yeTsKCiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIE5hdGl2ZUltYWdlRGVjb2Rlcik7CgogICAgICAgIHRoaXMueHJlZiA9IHhyZWY7CiAgICAgICAgdGhpcy5yZXNvdXJjZXMgPSByZXNvdXJjZXM7CiAgICAgICAgdGhpcy5oYW5kbGVyID0gaGFuZGxlcjsKICAgICAgICB0aGlzLmZvcmNlRGF0YVNjaGVtYSA9IGZvcmNlRGF0YVNjaGVtYTsKICAgICAgICB0aGlzLnBkZkZ1bmN0aW9uRmFjdG9yeSA9IHBkZkZ1bmN0aW9uRmFjdG9yeTsKICAgICAgfQoKICAgICAgX2NyZWF0ZUNsYXNzKE5hdGl2ZUltYWdlRGVjb2RlciwgW3sKICAgICAgICBrZXk6ICJjYW5EZWNvZGUiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjYW5EZWNvZGUoaW1hZ2UpIHsKICAgICAgICAgIHJldHVybiBpbWFnZSBpbnN0YW5jZW9mIF9qcGVnX3N0cmVhbS5KcGVnU3RyZWFtICYmIE5hdGl2ZUltYWdlRGVjb2Rlci5pc0RlY29kYWJsZShpbWFnZSwgdGhpcy54cmVmLCB0aGlzLnJlc291cmNlcywgdGhpcy5wZGZGdW5jdGlvbkZhY3RvcnkpICYmIGltYWdlLm1heWJlVmFsaWREaW1lbnNpb25zOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImRlY29kZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGRlY29kZShpbWFnZSkgewogICAgICAgICAgdmFyIGRpY3QgPSBpbWFnZS5kaWN0OwogICAgICAgICAgdmFyIGNvbG9yU3BhY2UgPSBkaWN0LmdldCgiQ29sb3JTcGFjZSIsICJDUyIpOwogICAgICAgICAgY29sb3JTcGFjZSA9IF9jb2xvcnNwYWNlLkNvbG9yU3BhY2UucGFyc2UoY29sb3JTcGFjZSwgdGhpcy54cmVmLCB0aGlzLnJlc291cmNlcywgdGhpcy5wZGZGdW5jdGlvbkZhY3RvcnkpOwogICAgICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlci5zZW5kV2l0aFByb21pc2UoIkpwZWdEZWNvZGUiLCBbaW1hZ2UuZ2V0SVIodGhpcy5mb3JjZURhdGFTY2hlbWEpLCBjb2xvclNwYWNlLm51bUNvbXBzXSkudGhlbihmdW5jdGlvbiAoX3JlZjIpIHsKICAgICAgICAgICAgdmFyIGRhdGEgPSBfcmVmMi5kYXRhLAogICAgICAgICAgICAgIHdpZHRoID0gX3JlZjIud2lkdGgsCiAgICAgICAgICAgICAgaGVpZ2h0ID0gX3JlZjIuaGVpZ2h0OwogICAgICAgICAgICByZXR1cm4gbmV3IF9zdHJlYW0uU3RyZWFtKGRhdGEsIDAsIGRhdGEubGVuZ3RoLCBkaWN0KTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfV0sIFt7CiAgICAgICAga2V5OiAiaXNTdXBwb3J0ZWQiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBpc1N1cHBvcnRlZChpbWFnZSwgeHJlZiwgcmVzLCBwZGZGdW5jdGlvbkZhY3RvcnkpIHsKICAgICAgICAgIHZhciBkaWN0ID0gaW1hZ2UuZGljdDsKCiAgICAgICAgICBpZiAoZGljdC5oYXMoIkRlY29kZVBhcm1zIikgfHwgZGljdC5oYXMoIkRQIikpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBjcyA9IF9jb2xvcnNwYWNlLkNvbG9yU3BhY2UucGFyc2UoZGljdC5nZXQoIkNvbG9yU3BhY2UiLCAiQ1MiKSwgeHJlZiwgcmVzLCBwZGZGdW5jdGlvbkZhY3RvcnkpOwoKICAgICAgICAgIHJldHVybiAoY3MubmFtZSA9PT0gIkRldmljZUdyYXkiIHx8IGNzLm5hbWUgPT09ICJEZXZpY2VSR0IiKSAmJiBjcy5pc0RlZmF1bHREZWNvZGUoZGljdC5nZXRBcnJheSgiRGVjb2RlIiwgIkQiKSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiaXNEZWNvZGFibGUiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBpc0RlY29kYWJsZShpbWFnZSwgeHJlZiwgcmVzLCBwZGZGdW5jdGlvbkZhY3RvcnkpIHsKICAgICAgICAgIHZhciBkaWN0ID0gaW1hZ2UuZGljdDsKCiAgICAgICAgICBpZiAoZGljdC5oYXMoIkRlY29kZVBhcm1zIikgfHwgZGljdC5oYXMoIkRQIikpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBjcyA9IF9jb2xvcnNwYWNlLkNvbG9yU3BhY2UucGFyc2UoZGljdC5nZXQoIkNvbG9yU3BhY2UiLCAiQ1MiKSwgeHJlZiwgcmVzLCBwZGZGdW5jdGlvbkZhY3RvcnkpOwoKICAgICAgICAgIHZhciBicGMgPSBkaWN0LmdldCgiQml0c1BlckNvbXBvbmVudCIsICJCUEMiKSB8fCAxOwogICAgICAgICAgcmV0dXJuIChjcy5udW1Db21wcyA9PT0gMSB8fCBjcy5udW1Db21wcyA9PT0gMykgJiYgY3MuaXNEZWZhdWx0RGVjb2RlKGRpY3QuZ2V0QXJyYXkoIkRlY29kZSIsICJEIiksIGJwYyk7CiAgICAgICAgfQogICAgICB9XSk7CgogICAgICByZXR1cm4gTmF0aXZlSW1hZ2VEZWNvZGVyOwogICAgfSgpOwoKICAgIGV4cG9ydHMuTmF0aXZlSW1hZ2VEZWNvZGVyID0gTmF0aXZlSW1hZ2VEZWNvZGVyOwoKICAgIC8qKiovfSksICgKICAvKiAyMzMgKi8KICAvKioqL2Z1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pIHsKCiAgICAidXNlIHN0cmljdCI7CgoKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgICAgdmFsdWU6IHRydWUKICAgIH0pOwogICAgZXhwb3J0cy5QREZJbWFnZSA9IHZvaWQgMDsKCiAgICB2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUpOwoKICAgIHZhciBfcHJpbWl0aXZlcyA9IF9fd19wZGZqc19yZXF1aXJlX18oMTk0KTsKCiAgICB2YXIgX2NvbG9yc3BhY2UgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIxMik7CgogICAgdmFyIF9zdHJlYW0gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIwMSk7CgogICAgdmFyIF9qcGVnX3N0cmVhbSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjA3KTsKCiAgICB2YXIgX2pweCA9IF9fd19wZGZqc19yZXF1aXJlX18oMjEwKTsKCiAgICBmdW5jdGlvbiBfc2xpY2VkVG9BcnJheShhcnIsIGkpIHtyZXR1cm4gX2FycmF5V2l0aEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgfHwgX25vbkl0ZXJhYmxlUmVzdCgpO30KCiAgICBmdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0KCkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UiKTt9CgogICAgZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkge2lmICghKFN5bWJvbC5pdGVyYXRvciBpbiBPYmplY3QoYXJyKSB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYXJyKSA9PT0gIltvYmplY3QgQXJndW1lbnRzXSIpKSB7cmV0dXJuO312YXIgX2FyciA9IFtdO3ZhciBfbiA9IHRydWU7dmFyIF9kID0gZmFsc2U7dmFyIF9lID0gdW5kZWZpbmVkO3RyeSB7Zm9yICh2YXIgX2kgPSBhcnJbU3ltYm9sLml0ZXJhdG9yXSgpLCBfczsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkge19hcnIucHVzaChfcy52YWx1ZSk7aWYgKGkgJiYgX2Fyci5sZW5ndGggPT09IGkpIGJyZWFrO319IGNhdGNoIChlcnIpIHtfZCA9IHRydWU7X2UgPSBlcnI7fSBmaW5hbGx5IHt0cnkge2lmICghX24gJiYgX2lbInJldHVybiJdICE9IG51bGwpIF9pWyJyZXR1cm4iXSgpO30gZmluYWxseSB7aWYgKF9kKSB0aHJvdyBfZTt9fXJldHVybiBfYXJyO30KCiAgICBmdW5jdGlvbiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB7aWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjt9CgogICAgdmFyIFBERkltYWdlID0gZnVuY3Rpb24gUERGSW1hZ2VDbG9zdXJlKCkgewogICAgICBmdW5jdGlvbiBoYW5kbGVJbWFnZURhdGEoaW1hZ2UsIG5hdGl2ZURlY29kZXIpIHsKICAgICAgICBpZiAobmF0aXZlRGVjb2RlciAmJiBuYXRpdmVEZWNvZGVyLmNhbkRlY29kZShpbWFnZSkpIHsKICAgICAgICAgIHJldHVybiBuYXRpdmVEZWNvZGVyLmRlY29kZShpbWFnZSlbImNhdGNoIl0oZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIk5hdGl2ZSBpbWFnZSBkZWNvZGluZyBmYWlsZWQgLS0gdHJ5aW5nIHRvIHJlY292ZXI6ICIgKyAocmVhc29uICYmIHJlYXNvbi5tZXNzYWdlKSk7CiAgICAgICAgICAgIHJldHVybiBpbWFnZTsKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShpbWFnZSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGRlY29kZUFuZENsYW1wKHZhbHVlLCBhZGRlbmQsIGNvZWZmaWNpZW50LCBtYXgpIHsKICAgICAgICB2YWx1ZSA9IGFkZGVuZCArIHZhbHVlICogY29lZmZpY2llbnQ7CgogICAgICAgIGlmICh2YWx1ZSA8IDApIHsKICAgICAgICAgIHZhbHVlID0gMDsKICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID4gbWF4KSB7CiAgICAgICAgICB2YWx1ZSA9IG1heDsKICAgICAgICB9CgogICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gcmVzaXplSW1hZ2VNYXNrKHNyYywgYnBjLCB3MSwgaDEsIHcyLCBoMikgewogICAgICAgIHZhciBsZW5ndGggPSB3MiAqIGgyOwogICAgICAgIHZhciBkZXN0OwoKICAgICAgICBpZiAoYnBjIDw9IDgpIHsKICAgICAgICAgIGRlc3QgPSBuZXcgVWludDhBcnJheShsZW5ndGgpOwogICAgICAgIH0gZWxzZSBpZiAoYnBjIDw9IDE2KSB7CiAgICAgICAgICBkZXN0ID0gbmV3IFVpbnQxNkFycmF5KGxlbmd0aCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRlc3QgPSBuZXcgVWludDMyQXJyYXkobGVuZ3RoKTsKICAgICAgICB9CgogICAgICAgIHZhciB4UmF0aW8gPSB3MSAvIHcyOwogICAgICAgIHZhciB5UmF0aW8gPSBoMSAvIGgyOwogICAgICAgIHZhciBpLAogICAgICAgICAgaiwKICAgICAgICAgIHB5LAogICAgICAgICAgbmV3SW5kZXggPSAwLAogICAgICAgICAgb2xkSW5kZXg7CiAgICAgICAgdmFyIHhTY2FsZWQgPSBuZXcgVWludDE2QXJyYXkodzIpOwogICAgICAgIHZhciB3MVNjYW5saW5lID0gdzE7CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCB3MjsgaSsrKSB7CiAgICAgICAgICB4U2NhbGVkW2ldID0gTWF0aC5mbG9vcihpICogeFJhdGlvKTsKICAgICAgICB9CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBoMjsgaSsrKSB7CiAgICAgICAgICBweSA9IE1hdGguZmxvb3IoaSAqIHlSYXRpbykgKiB3MVNjYW5saW5lOwoKICAgICAgICAgIGZvciAoaiA9IDA7IGogPCB3MjsgaisrKSB7CiAgICAgICAgICAgIG9sZEluZGV4ID0gcHkgKyB4U2NhbGVkW2pdOwogICAgICAgICAgICBkZXN0W25ld0luZGV4KytdID0gc3JjW29sZEluZGV4XTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBkZXN0OwogICAgICB9CgogICAgICBmdW5jdGlvbiBQREZJbWFnZShfcmVmKSB7CiAgICAgICAgdmFyIHhyZWYgPSBfcmVmLnhyZWYsCiAgICAgICAgICByZXMgPSBfcmVmLnJlcywKICAgICAgICAgIGltYWdlID0gX3JlZi5pbWFnZSwKICAgICAgICAgIF9yZWYkaXNJbmxpbmUgPSBfcmVmLmlzSW5saW5lLAogICAgICAgICAgaXNJbmxpbmUgPSBfcmVmJGlzSW5saW5lID09PSB2b2lkIDAgPyBmYWxzZSA6IF9yZWYkaXNJbmxpbmUsCiAgICAgICAgICBfcmVmJHNtYXNrID0gX3JlZi5zbWFzaywKICAgICAgICAgIHNtYXNrID0gX3JlZiRzbWFzayA9PT0gdm9pZCAwID8gbnVsbCA6IF9yZWYkc21hc2ssCiAgICAgICAgICBfcmVmJG1hc2sgPSBfcmVmLm1hc2ssCiAgICAgICAgICBtYXNrID0gX3JlZiRtYXNrID09PSB2b2lkIDAgPyBudWxsIDogX3JlZiRtYXNrLAogICAgICAgICAgX3JlZiRpc01hc2sgPSBfcmVmLmlzTWFzaywKICAgICAgICAgIGlzTWFzayA9IF9yZWYkaXNNYXNrID09PSB2b2lkIDAgPyBmYWxzZSA6IF9yZWYkaXNNYXNrLAogICAgICAgICAgcGRmRnVuY3Rpb25GYWN0b3J5ID0gX3JlZi5wZGZGdW5jdGlvbkZhY3Rvcnk7CiAgICAgICAgdGhpcy5pbWFnZSA9IGltYWdlOwogICAgICAgIHZhciBkaWN0ID0gaW1hZ2UuZGljdDsKICAgICAgICB2YXIgZmlsdGVyID0gZGljdC5nZXQoIkZpbHRlciIpOwoKICAgICAgICBpZiAoKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkoZmlsdGVyKSkgewogICAgICAgICAgc3dpdGNoIChmaWx0ZXIubmFtZSkgewogICAgICAgICAgICBjYXNlICJKUFhEZWNvZGUiOgogICAgICAgICAgICAgIHZhciBqcHhJbWFnZSA9IG5ldyBfanB4LkpweEltYWdlKCk7CiAgICAgICAgICAgICAganB4SW1hZ2UucGFyc2VJbWFnZVByb3BlcnRpZXMoaW1hZ2Uuc3RyZWFtKTsKICAgICAgICAgICAgICBpbWFnZS5zdHJlYW0ucmVzZXQoKTsKICAgICAgICAgICAgICBpbWFnZS53aWR0aCA9IGpweEltYWdlLndpZHRoOwogICAgICAgICAgICAgIGltYWdlLmhlaWdodCA9IGpweEltYWdlLmhlaWdodDsKICAgICAgICAgICAgICBpbWFnZS5iaXRzUGVyQ29tcG9uZW50ID0ganB4SW1hZ2UuYml0c1BlckNvbXBvbmVudDsKICAgICAgICAgICAgICBpbWFnZS5udW1Db21wcyA9IGpweEltYWdlLmNvbXBvbmVudHNDb3VudDsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgIkpCSUcyRGVjb2RlIjoKICAgICAgICAgICAgICBpbWFnZS5iaXRzUGVyQ29tcG9uZW50ID0gMTsKICAgICAgICAgICAgICBpbWFnZS5udW1Db21wcyA9IDE7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YXIgd2lkdGggPSBkaWN0LmdldCgiV2lkdGgiLCAiVyIpOwogICAgICAgIHZhciBoZWlnaHQgPSBkaWN0LmdldCgiSGVpZ2h0IiwgIkgiKTsKCiAgICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIoaW1hZ2Uud2lkdGgpICYmIGltYWdlLndpZHRoID4gMCAmJiBOdW1iZXIuaXNJbnRlZ2VyKGltYWdlLmhlaWdodCkgJiYgaW1hZ2UuaGVpZ2h0ID4gMCAmJiAoaW1hZ2Uud2lkdGggIT09IHdpZHRoIHx8IGltYWdlLmhlaWdodCAhPT0gaGVpZ2h0KSkgewogICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJQREZJbWFnZSAtIHVzaW5nIHRoZSBXaWR0aC9IZWlnaHQgb2YgdGhlIGltYWdlIGRhdGEsICIgKyAicmF0aGVyIHRoYW4gdGhlIGltYWdlIGRpY3Rpb25hcnkuIik7CiAgICAgICAgICB3aWR0aCA9IGltYWdlLndpZHRoOwogICAgICAgICAgaGVpZ2h0ID0gaW1hZ2UuaGVpZ2h0OwogICAgICAgIH0KCiAgICAgICAgaWYgKHdpZHRoIDwgMSB8fCBoZWlnaHQgPCAxKSB7CiAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkludmFsaWQgaW1hZ2Ugd2lkdGg6ICIuY29uY2F0KHdpZHRoLCAiIG9yIGhlaWdodDogIikuY29uY2F0KGhlaWdodCkpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy53aWR0aCA9IHdpZHRoOwogICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwogICAgICAgIHRoaXMuaW50ZXJwb2xhdGUgPSBkaWN0LmdldCgiSW50ZXJwb2xhdGUiLCAiSSIpIHx8IGZhbHNlOwogICAgICAgIHRoaXMuaW1hZ2VNYXNrID0gZGljdC5nZXQoIkltYWdlTWFzayIsICJJTSIpIHx8IGZhbHNlOwogICAgICAgIHRoaXMubWF0dGUgPSBkaWN0LmdldCgiTWF0dGUiKSB8fCBmYWxzZTsKICAgICAgICB2YXIgYml0c1BlckNvbXBvbmVudCA9IGltYWdlLmJpdHNQZXJDb21wb25lbnQ7CgogICAgICAgIGlmICghYml0c1BlckNvbXBvbmVudCkgewogICAgICAgICAgYml0c1BlckNvbXBvbmVudCA9IGRpY3QuZ2V0KCJCaXRzUGVyQ29tcG9uZW50IiwgIkJQQyIpOwoKICAgICAgICAgIGlmICghYml0c1BlckNvbXBvbmVudCkgewogICAgICAgICAgICBpZiAodGhpcy5pbWFnZU1hc2spIHsKICAgICAgICAgICAgICBiaXRzUGVyQ29tcG9uZW50ID0gMTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkJpdHMgcGVyIGNvbXBvbmVudCBtaXNzaW5nIGluIGltYWdlOiAiLmNvbmNhdCh0aGlzLmltYWdlTWFzaykpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0aGlzLmJwYyA9IGJpdHNQZXJDb21wb25lbnQ7CgogICAgICAgIGlmICghdGhpcy5pbWFnZU1hc2spIHsKICAgICAgICAgIHZhciBjb2xvclNwYWNlID0gZGljdC5nZXQoIkNvbG9yU3BhY2UiLCAiQ1MiKTsKCiAgICAgICAgICBpZiAoIWNvbG9yU3BhY2UpIHsKICAgICAgICAgICAgKDAsIF91dGlsLmluZm8pKCJKUFggaW1hZ2VzICh3aGljaCBkbyBub3QgcmVxdWlyZSBjb2xvciBzcGFjZXMpIik7CgogICAgICAgICAgICBzd2l0Y2ggKGltYWdlLm51bUNvbXBzKSB7CiAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgY29sb3JTcGFjZSA9IF9wcmltaXRpdmVzLk5hbWUuZ2V0KCJEZXZpY2VHcmF5Iik7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgY29sb3JTcGFjZSA9IF9wcmltaXRpdmVzLk5hbWUuZ2V0KCJEZXZpY2VSR0IiKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICBjb2xvclNwYWNlID0gX3ByaW1pdGl2ZXMuTmFtZS5nZXQoIkRldmljZUNNWUsiKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJKUFggaW1hZ2VzIHdpdGggIi5jb25jYXQoaW1hZ2UubnVtQ29tcHMsICIgIikgKyAiY29sb3IgY29tcG9uZW50cyBub3Qgc3VwcG9ydGVkLiIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHJlc291cmNlcyA9IGlzSW5saW5lID8gcmVzIDogbnVsbDsKICAgICAgICAgIHRoaXMuY29sb3JTcGFjZSA9IF9jb2xvcnNwYWNlLkNvbG9yU3BhY2UucGFyc2UoY29sb3JTcGFjZSwgeHJlZiwgcmVzb3VyY2VzLCBwZGZGdW5jdGlvbkZhY3RvcnkpOwogICAgICAgICAgdGhpcy5udW1Db21wcyA9IHRoaXMuY29sb3JTcGFjZS5udW1Db21wczsKICAgICAgICB9CgogICAgICAgIHRoaXMuZGVjb2RlID0gZGljdC5nZXRBcnJheSgiRGVjb2RlIiwgIkQiKTsKICAgICAgICB0aGlzLm5lZWRzRGVjb2RlID0gZmFsc2U7CgogICAgICAgIGlmICh0aGlzLmRlY29kZSAmJiAodGhpcy5jb2xvclNwYWNlICYmICF0aGlzLmNvbG9yU3BhY2UuaXNEZWZhdWx0RGVjb2RlKHRoaXMuZGVjb2RlLCBiaXRzUGVyQ29tcG9uZW50KSB8fCBpc01hc2sgJiYgIV9jb2xvcnNwYWNlLkNvbG9yU3BhY2UuaXNEZWZhdWx0RGVjb2RlKHRoaXMuZGVjb2RlLCAxKSkpIHsKICAgICAgICAgIHRoaXMubmVlZHNEZWNvZGUgPSB0cnVlOwogICAgICAgICAgdmFyIG1heCA9ICgxIDw8IGJpdHNQZXJDb21wb25lbnQpIC0gMTsKICAgICAgICAgIHRoaXMuZGVjb2RlQ29lZmZpY2llbnRzID0gW107CiAgICAgICAgICB0aGlzLmRlY29kZUFkZGVuZHMgPSBbXTsKICAgICAgICAgIHZhciBpc0luZGV4ZWQgPSB0aGlzLmNvbG9yU3BhY2UgJiYgdGhpcy5jb2xvclNwYWNlLm5hbWUgPT09ICJJbmRleGVkIjsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaiA9IDA7IGkgPCB0aGlzLmRlY29kZS5sZW5ndGg7IGkgKz0gMiwgKytqKSB7CiAgICAgICAgICAgIHZhciBkbWluID0gdGhpcy5kZWNvZGVbaV07CiAgICAgICAgICAgIHZhciBkbWF4ID0gdGhpcy5kZWNvZGVbaSArIDFdOwogICAgICAgICAgICB0aGlzLmRlY29kZUNvZWZmaWNpZW50c1tqXSA9IGlzSW5kZXhlZCA/IChkbWF4IC0gZG1pbikgLyBtYXggOiBkbWF4IC0gZG1pbjsKICAgICAgICAgICAgdGhpcy5kZWNvZGVBZGRlbmRzW2pdID0gaXNJbmRleGVkID8gZG1pbiA6IG1heCAqIGRtaW47CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoc21hc2spIHsKICAgICAgICAgIHRoaXMuc21hc2sgPSBuZXcgUERGSW1hZ2UoewogICAgICAgICAgICB4cmVmOiB4cmVmLAogICAgICAgICAgICByZXM6IHJlcywKICAgICAgICAgICAgaW1hZ2U6IHNtYXNrLAogICAgICAgICAgICBpc0lubGluZTogaXNJbmxpbmUsCiAgICAgICAgICAgIHBkZkZ1bmN0aW9uRmFjdG9yeTogcGRmRnVuY3Rpb25GYWN0b3J5CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgaWYgKG1hc2spIHsKICAgICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNTdHJlYW0pKG1hc2spKSB7CiAgICAgICAgICAgIHZhciBtYXNrRGljdCA9IG1hc2suZGljdCwKICAgICAgICAgICAgICBpbWFnZU1hc2sgPSBtYXNrRGljdC5nZXQoIkltYWdlTWFzayIsICJJTSIpOwoKICAgICAgICAgICAgaWYgKCFpbWFnZU1hc2spIHsKICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIklnbm9yaW5nIC9NYXNrIGluIGltYWdlIHdpdGhvdXQgL0ltYWdlTWFzay4iKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLm1hc2sgPSBuZXcgUERGSW1hZ2UoewogICAgICAgICAgICAgICAgeHJlZjogeHJlZiwKICAgICAgICAgICAgICAgIHJlczogcmVzLAogICAgICAgICAgICAgICAgaW1hZ2U6IG1hc2ssCiAgICAgICAgICAgICAgICBpc0lubGluZTogaXNJbmxpbmUsCiAgICAgICAgICAgICAgICBpc01hc2s6IHRydWUsCiAgICAgICAgICAgICAgICBwZGZGdW5jdGlvbkZhY3Rvcnk6IHBkZkZ1bmN0aW9uRmFjdG9yeQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLm1hc2sgPSBtYXNrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgUERGSW1hZ2UuYnVpbGRJbWFnZSA9IGZ1bmN0aW9uIChfcmVmMikgewogICAgICAgIHZhciBoYW5kbGVyID0gX3JlZjIuaGFuZGxlciwKICAgICAgICAgIHhyZWYgPSBfcmVmMi54cmVmLAogICAgICAgICAgcmVzID0gX3JlZjIucmVzLAogICAgICAgICAgaW1hZ2UgPSBfcmVmMi5pbWFnZSwKICAgICAgICAgIF9yZWYyJGlzSW5saW5lID0gX3JlZjIuaXNJbmxpbmUsCiAgICAgICAgICBpc0lubGluZSA9IF9yZWYyJGlzSW5saW5lID09PSB2b2lkIDAgPyBmYWxzZSA6IF9yZWYyJGlzSW5saW5lLAogICAgICAgICAgX3JlZjIkbmF0aXZlRGVjb2RlciA9IF9yZWYyLm5hdGl2ZURlY29kZXIsCiAgICAgICAgICBuYXRpdmVEZWNvZGVyID0gX3JlZjIkbmF0aXZlRGVjb2RlciA9PT0gdm9pZCAwID8gbnVsbCA6IF9yZWYyJG5hdGl2ZURlY29kZXIsCiAgICAgICAgICBwZGZGdW5jdGlvbkZhY3RvcnkgPSBfcmVmMi5wZGZGdW5jdGlvbkZhY3Rvcnk7CiAgICAgICAgdmFyIGltYWdlUHJvbWlzZSA9IGhhbmRsZUltYWdlRGF0YShpbWFnZSwgbmF0aXZlRGVjb2Rlcik7CiAgICAgICAgdmFyIHNtYXNrUHJvbWlzZTsKICAgICAgICB2YXIgbWFza1Byb21pc2U7CiAgICAgICAgdmFyIHNtYXNrID0gaW1hZ2UuZGljdC5nZXQoIlNNYXNrIik7CiAgICAgICAgdmFyIG1hc2sgPSBpbWFnZS5kaWN0LmdldCgiTWFzayIpOwoKICAgICAgICBpZiAoc21hc2spIHsKICAgICAgICAgIHNtYXNrUHJvbWlzZSA9IGhhbmRsZUltYWdlRGF0YShzbWFzaywgbmF0aXZlRGVjb2Rlcik7CiAgICAgICAgICBtYXNrUHJvbWlzZSA9IFByb21pc2UucmVzb2x2ZShudWxsKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc21hc2tQcm9taXNlID0gUHJvbWlzZS5yZXNvbHZlKG51bGwpOwoKICAgICAgICAgIGlmIChtYXNrKSB7CiAgICAgICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNTdHJlYW0pKG1hc2spKSB7CiAgICAgICAgICAgICAgbWFza1Byb21pc2UgPSBoYW5kbGVJbWFnZURhdGEobWFzaywgbmF0aXZlRGVjb2Rlcik7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShtYXNrKSkgewogICAgICAgICAgICAgIG1hc2tQcm9taXNlID0gUHJvbWlzZS5yZXNvbHZlKG1hc2spOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiVW5zdXBwb3J0ZWQgbWFzayBmb3JtYXQuIik7CiAgICAgICAgICAgICAgbWFza1Byb21pc2UgPSBQcm9taXNlLnJlc29sdmUobnVsbCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1hc2tQcm9taXNlID0gUHJvbWlzZS5yZXNvbHZlKG51bGwpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKFtpbWFnZVByb21pc2UsIHNtYXNrUHJvbWlzZSwgbWFza1Byb21pc2VdKS50aGVuKGZ1bmN0aW9uIChfcmVmMykgewogICAgICAgICAgdmFyIF9yZWY0ID0gX3NsaWNlZFRvQXJyYXkoX3JlZjMsIDMpLAogICAgICAgICAgICBpbWFnZURhdGEgPSBfcmVmNFswXSwKICAgICAgICAgICAgc21hc2tEYXRhID0gX3JlZjRbMV0sCiAgICAgICAgICAgIG1hc2tEYXRhID0gX3JlZjRbMl07CgogICAgICAgICAgcmV0dXJuIG5ldyBQREZJbWFnZSh7CiAgICAgICAgICAgIHhyZWY6IHhyZWYsCiAgICAgICAgICAgIHJlczogcmVzLAogICAgICAgICAgICBpbWFnZTogaW1hZ2VEYXRhLAogICAgICAgICAgICBpc0lubGluZTogaXNJbmxpbmUsCiAgICAgICAgICAgIHNtYXNrOiBzbWFza0RhdGEsCiAgICAgICAgICAgIG1hc2s6IG1hc2tEYXRhLAogICAgICAgICAgICBwZGZGdW5jdGlvbkZhY3Rvcnk6IHBkZkZ1bmN0aW9uRmFjdG9yeQogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH07CgogICAgICBQREZJbWFnZS5jcmVhdGVNYXNrID0gZnVuY3Rpb24gKF9yZWY1KSB7CiAgICAgICAgdmFyIGltZ0FycmF5ID0gX3JlZjUuaW1nQXJyYXksCiAgICAgICAgICB3aWR0aCA9IF9yZWY1LndpZHRoLAogICAgICAgICAgaGVpZ2h0ID0gX3JlZjUuaGVpZ2h0LAogICAgICAgICAgaW1hZ2VJc0Zyb21EZWNvZGVTdHJlYW0gPSBfcmVmNS5pbWFnZUlzRnJvbURlY29kZVN0cmVhbSwKICAgICAgICAgIGludmVyc2VEZWNvZGUgPSBfcmVmNS5pbnZlcnNlRGVjb2RlOwogICAgICAgIHZhciBjb21wdXRlZExlbmd0aCA9ICh3aWR0aCArIDcgPj4gMykgKiBoZWlnaHQ7CiAgICAgICAgdmFyIGFjdHVhbExlbmd0aCA9IGltZ0FycmF5LmJ5dGVMZW5ndGg7CiAgICAgICAgdmFyIGhhdmVGdWxsRGF0YSA9IGNvbXB1dGVkTGVuZ3RoID09PSBhY3R1YWxMZW5ndGg7CiAgICAgICAgdmFyIGRhdGEsIGk7CgogICAgICAgIGlmIChpbWFnZUlzRnJvbURlY29kZVN0cmVhbSAmJiAoIWludmVyc2VEZWNvZGUgfHwgaGF2ZUZ1bGxEYXRhKSkgewogICAgICAgICAgZGF0YSA9IGltZ0FycmF5OwogICAgICAgIH0gZWxzZSBpZiAoIWludmVyc2VEZWNvZGUpIHsKICAgICAgICAgIGRhdGEgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkoYWN0dWFsTGVuZ3RoKTsKICAgICAgICAgIGRhdGEuc2V0KGltZ0FycmF5KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGF0YSA9IG5ldyBVaW50OENsYW1wZWRBcnJheShjb21wdXRlZExlbmd0aCk7CiAgICAgICAgICBkYXRhLnNldChpbWdBcnJheSk7CgogICAgICAgICAgZm9yIChpID0gYWN0dWFsTGVuZ3RoOyBpIDwgY29tcHV0ZWRMZW5ndGg7IGkrKykgewogICAgICAgICAgICBkYXRhW2ldID0gMHhmZjsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChpbnZlcnNlRGVjb2RlKSB7CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYWN0dWFsTGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgZGF0YVtpXSBePSAweGZmOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgICB3aWR0aDogd2lkdGgsCiAgICAgICAgICBoZWlnaHQ6IGhlaWdodAogICAgICAgIH07CiAgICAgIH07CgogICAgICBQREZJbWFnZS5wcm90b3R5cGUgPSB7CiAgICAgICAgZ2V0IGRyYXdXaWR0aCgpIHsKICAgICAgICAgIHJldHVybiBNYXRoLm1heCh0aGlzLndpZHRoLCB0aGlzLnNtYXNrICYmIHRoaXMuc21hc2sud2lkdGggfHwgMCwgdGhpcy5tYXNrICYmIHRoaXMubWFzay53aWR0aCB8fCAwKTsKICAgICAgICB9LAoKICAgICAgICBnZXQgZHJhd0hlaWdodCgpIHsKICAgICAgICAgIHJldHVybiBNYXRoLm1heCh0aGlzLmhlaWdodCwgdGhpcy5zbWFzayAmJiB0aGlzLnNtYXNrLmhlaWdodCB8fCAwLCB0aGlzLm1hc2sgJiYgdGhpcy5tYXNrLmhlaWdodCB8fCAwKTsKICAgICAgICB9LAoKICAgICAgICBkZWNvZGVCdWZmZXI6IGZ1bmN0aW9uIGRlY29kZUJ1ZmZlcihidWZmZXIpIHsKICAgICAgICAgIHZhciBicGMgPSB0aGlzLmJwYzsKICAgICAgICAgIHZhciBudW1Db21wcyA9IHRoaXMubnVtQ29tcHM7CiAgICAgICAgICB2YXIgZGVjb2RlQWRkZW5kcyA9IHRoaXMuZGVjb2RlQWRkZW5kczsKICAgICAgICAgIHZhciBkZWNvZGVDb2VmZmljaWVudHMgPSB0aGlzLmRlY29kZUNvZWZmaWNpZW50czsKICAgICAgICAgIHZhciBtYXggPSAoMSA8PCBicGMpIC0gMTsKICAgICAgICAgIHZhciBpLCBpaTsKCiAgICAgICAgICBpZiAoYnBjID09PSAxKSB7CiAgICAgICAgICAgIGZvciAoaSA9IDAsIGlpID0gYnVmZmVyLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgICBidWZmZXJbaV0gPSArIWJ1ZmZlcltpXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBpbmRleCA9IDA7CgogICAgICAgICAgZm9yIChpID0gMCwgaWkgPSB0aGlzLndpZHRoICogdGhpcy5oZWlnaHQ7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbnVtQ29tcHM7IGorKykgewogICAgICAgICAgICAgIGJ1ZmZlcltpbmRleF0gPSBkZWNvZGVBbmRDbGFtcChidWZmZXJbaW5kZXhdLCBkZWNvZGVBZGRlbmRzW2pdLCBkZWNvZGVDb2VmZmljaWVudHNbal0sIG1heCk7CiAgICAgICAgICAgICAgaW5kZXgrKzsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgZ2V0Q29tcG9uZW50czogZnVuY3Rpb24gZ2V0Q29tcG9uZW50cyhidWZmZXIpIHsKICAgICAgICAgIHZhciBicGMgPSB0aGlzLmJwYzsKCiAgICAgICAgICBpZiAoYnBjID09PSA4KSB7CiAgICAgICAgICAgIHJldHVybiBidWZmZXI7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHdpZHRoID0gdGhpcy53aWR0aDsKICAgICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLmhlaWdodDsKICAgICAgICAgIHZhciBudW1Db21wcyA9IHRoaXMubnVtQ29tcHM7CiAgICAgICAgICB2YXIgbGVuZ3RoID0gd2lkdGggKiBoZWlnaHQgKiBudW1Db21wczsKICAgICAgICAgIHZhciBidWZmZXJQb3MgPSAwOwogICAgICAgICAgdmFyIG91dHB1dDsKCiAgICAgICAgICBpZiAoYnBjIDw9IDgpIHsKICAgICAgICAgICAgb3V0cHV0ID0gbmV3IFVpbnQ4QXJyYXkobGVuZ3RoKTsKICAgICAgICAgIH0gZWxzZSBpZiAoYnBjIDw9IDE2KSB7CiAgICAgICAgICAgIG91dHB1dCA9IG5ldyBVaW50MTZBcnJheShsZW5ndGgpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgb3V0cHV0ID0gbmV3IFVpbnQzMkFycmF5KGxlbmd0aCk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHJvd0NvbXBzID0gd2lkdGggKiBudW1Db21wczsKICAgICAgICAgIHZhciBtYXggPSAoMSA8PCBicGMpIC0gMTsKICAgICAgICAgIHZhciBpID0gMCwKICAgICAgICAgICAgaWksCiAgICAgICAgICAgIGJ1ZjsKCiAgICAgICAgICBpZiAoYnBjID09PSAxKSB7CiAgICAgICAgICAgIHZhciBtYXNrLCBsb29wMUVuZCwgbG9vcDJFbmQ7CgogICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGhlaWdodDsgaisrKSB7CiAgICAgICAgICAgICAgbG9vcDFFbmQgPSBpICsgKHJvd0NvbXBzICYgfjcpOwogICAgICAgICAgICAgIGxvb3AyRW5kID0gaSArIHJvd0NvbXBzOwoKICAgICAgICAgICAgICB3aGlsZSAoaSA8IGxvb3AxRW5kKSB7CiAgICAgICAgICAgICAgICBidWYgPSBidWZmZXJbYnVmZmVyUG9zKytdOwogICAgICAgICAgICAgICAgb3V0cHV0W2ldID0gYnVmID4+IDcgJiAxOwogICAgICAgICAgICAgICAgb3V0cHV0W2kgKyAxXSA9IGJ1ZiA+PiA2ICYgMTsKICAgICAgICAgICAgICAgIG91dHB1dFtpICsgMl0gPSBidWYgPj4gNSAmIDE7CiAgICAgICAgICAgICAgICBvdXRwdXRbaSArIDNdID0gYnVmID4+IDQgJiAxOwogICAgICAgICAgICAgICAgb3V0cHV0W2kgKyA0XSA9IGJ1ZiA+PiAzICYgMTsKICAgICAgICAgICAgICAgIG91dHB1dFtpICsgNV0gPSBidWYgPj4gMiAmIDE7CiAgICAgICAgICAgICAgICBvdXRwdXRbaSArIDZdID0gYnVmID4+IDEgJiAxOwogICAgICAgICAgICAgICAgb3V0cHV0W2kgKyA3XSA9IGJ1ZiAmIDE7CiAgICAgICAgICAgICAgICBpICs9IDg7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoaSA8IGxvb3AyRW5kKSB7CiAgICAgICAgICAgICAgICBidWYgPSBidWZmZXJbYnVmZmVyUG9zKytdOwogICAgICAgICAgICAgICAgbWFzayA9IDEyODsKCiAgICAgICAgICAgICAgICB3aGlsZSAoaSA8IGxvb3AyRW5kKSB7CiAgICAgICAgICAgICAgICAgIG91dHB1dFtpKytdID0gKyEhKGJ1ZiAmIG1hc2spOwogICAgICAgICAgICAgICAgICBtYXNrID4+PSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIGJpdHMgPSAwOwogICAgICAgICAgICBidWYgPSAwOwoKICAgICAgICAgICAgZm9yIChpID0gMCwgaWkgPSBsZW5ndGg7IGkgPCBpaTsgKytpKSB7CiAgICAgICAgICAgICAgaWYgKGkgJSByb3dDb21wcyA9PT0gMCkgewogICAgICAgICAgICAgICAgYnVmID0gMDsKICAgICAgICAgICAgICAgIGJpdHMgPSAwOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCBicGMpIHsKICAgICAgICAgICAgICAgIGJ1ZiA9IGJ1ZiA8PCA4IHwgYnVmZmVyW2J1ZmZlclBvcysrXTsKICAgICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciByZW1haW5pbmdCaXRzID0gYml0cyAtIGJwYzsKICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBidWYgPj4gcmVtYWluaW5nQml0czsKCiAgICAgICAgICAgICAgaWYgKHZhbHVlIDwgMCkgewogICAgICAgICAgICAgICAgdmFsdWUgPSAwOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPiBtYXgpIHsKICAgICAgICAgICAgICAgIHZhbHVlID0gbWF4OwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgb3V0cHV0W2ldID0gdmFsdWU7CiAgICAgICAgICAgICAgYnVmID0gYnVmICYgKDEgPDwgcmVtYWluaW5nQml0cykgLSAxOwogICAgICAgICAgICAgIGJpdHMgPSByZW1haW5pbmdCaXRzOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIG91dHB1dDsKICAgICAgICB9LAogICAgICAgIGZpbGxPcGFjaXR5OiBmdW5jdGlvbiBmaWxsT3BhY2l0eShyZ2JhQnVmLCB3aWR0aCwgaGVpZ2h0LCBhY3R1YWxIZWlnaHQsIGltYWdlKSB7CiAgICAgICAgICB2YXIgc21hc2sgPSB0aGlzLnNtYXNrOwogICAgICAgICAgdmFyIG1hc2sgPSB0aGlzLm1hc2s7CiAgICAgICAgICB2YXIgYWxwaGFCdWYsIHN3LCBzaCwgaSwgaWksIGo7CgogICAgICAgICAgaWYgKHNtYXNrKSB7CiAgICAgICAgICAgIHN3ID0gc21hc2sud2lkdGg7CiAgICAgICAgICAgIHNoID0gc21hc2suaGVpZ2h0OwogICAgICAgICAgICBhbHBoYUJ1ZiA9IG5ldyBVaW50OENsYW1wZWRBcnJheShzdyAqIHNoKTsKICAgICAgICAgICAgc21hc2suZmlsbEdyYXlCdWZmZXIoYWxwaGFCdWYpOwoKICAgICAgICAgICAgaWYgKHN3ICE9PSB3aWR0aCB8fCBzaCAhPT0gaGVpZ2h0KSB7CiAgICAgICAgICAgICAgYWxwaGFCdWYgPSByZXNpemVJbWFnZU1hc2soYWxwaGFCdWYsIHNtYXNrLmJwYywgc3csIHNoLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIGlmIChtYXNrKSB7CiAgICAgICAgICAgIGlmIChtYXNrIGluc3RhbmNlb2YgUERGSW1hZ2UpIHsKICAgICAgICAgICAgICBzdyA9IG1hc2sud2lkdGg7CiAgICAgICAgICAgICAgc2ggPSBtYXNrLmhlaWdodDsKICAgICAgICAgICAgICBhbHBoYUJ1ZiA9IG5ldyBVaW50OENsYW1wZWRBcnJheShzdyAqIHNoKTsKICAgICAgICAgICAgICBtYXNrLm51bUNvbXBzID0gMTsKICAgICAgICAgICAgICBtYXNrLmZpbGxHcmF5QnVmZmVyKGFscGhhQnVmKTsKCiAgICAgICAgICAgICAgZm9yIChpID0gMCwgaWkgPSBzdyAqIHNoOyBpIDwgaWk7ICsraSkgewogICAgICAgICAgICAgICAgYWxwaGFCdWZbaV0gPSAyNTUgLSBhbHBoYUJ1ZltpXTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChzdyAhPT0gd2lkdGggfHwgc2ggIT09IGhlaWdodCkgewogICAgICAgICAgICAgICAgYWxwaGFCdWYgPSByZXNpemVJbWFnZU1hc2soYWxwaGFCdWYsIG1hc2suYnBjLCBzdywgc2gsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG1hc2spKSB7CiAgICAgICAgICAgICAgYWxwaGFCdWYgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkod2lkdGggKiBoZWlnaHQpOwogICAgICAgICAgICAgIHZhciBudW1Db21wcyA9IHRoaXMubnVtQ29tcHM7CgogICAgICAgICAgICAgIGZvciAoaSA9IDAsIGlpID0gd2lkdGggKiBoZWlnaHQ7IGkgPCBpaTsgKytpKSB7CiAgICAgICAgICAgICAgICB2YXIgb3BhY2l0eSA9IDA7CiAgICAgICAgICAgICAgICB2YXIgaW1hZ2VPZmZzZXQgPSBpICogbnVtQ29tcHM7CgogICAgICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IG51bUNvbXBzOyArK2opIHsKICAgICAgICAgICAgICAgICAgdmFyIGNvbG9yID0gaW1hZ2VbaW1hZ2VPZmZzZXQgKyBqXTsKICAgICAgICAgICAgICAgICAgdmFyIG1hc2tPZmZzZXQgPSBqICogMjsKCiAgICAgICAgICAgICAgICAgIGlmIChjb2xvciA8IG1hc2tbbWFza09mZnNldF0gfHwgY29sb3IgPiBtYXNrW21hc2tPZmZzZXQgKyAxXSkgewogICAgICAgICAgICAgICAgICAgIG9wYWNpdHkgPSAyNTU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBhbHBoYUJ1ZltpXSA9IG9wYWNpdHk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiVW5rbm93biBtYXNrIGZvcm1hdC4iKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmIChhbHBoYUJ1ZikgewogICAgICAgICAgICBmb3IgKGkgPSAwLCBqID0gMywgaWkgPSB3aWR0aCAqIGFjdHVhbEhlaWdodDsgaSA8IGlpOyArK2ksIGogKz0gNCkgewogICAgICAgICAgICAgIHJnYmFCdWZbal0gPSBhbHBoYUJ1ZltpXTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZm9yIChpID0gMCwgaiA9IDMsIGlpID0gd2lkdGggKiBhY3R1YWxIZWlnaHQ7IGkgPCBpaTsgKytpLCBqICs9IDQpIHsKICAgICAgICAgICAgICByZ2JhQnVmW2pdID0gMjU1OwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICB1bmRvUHJlYmxlbmQ6IGZ1bmN0aW9uIHVuZG9QcmVibGVuZChidWZmZXIsIHdpZHRoLCBoZWlnaHQpIHsKICAgICAgICAgIHZhciBtYXR0ZSA9IHRoaXMuc21hc2sgJiYgdGhpcy5zbWFzay5tYXR0ZTsKCiAgICAgICAgICBpZiAoIW1hdHRlKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgbWF0dGVSZ2IgPSB0aGlzLmNvbG9yU3BhY2UuZ2V0UmdiKG1hdHRlLCAwKTsKICAgICAgICAgIHZhciBtYXR0ZVIgPSBtYXR0ZVJnYlswXTsKICAgICAgICAgIHZhciBtYXR0ZUcgPSBtYXR0ZVJnYlsxXTsKICAgICAgICAgIHZhciBtYXR0ZUIgPSBtYXR0ZVJnYlsyXTsKICAgICAgICAgIHZhciBsZW5ndGggPSB3aWR0aCAqIGhlaWdodCAqIDQ7CgogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkgKz0gNCkgewogICAgICAgICAgICB2YXIgYWxwaGEgPSBidWZmZXJbaSArIDNdOwoKICAgICAgICAgICAgaWYgKGFscGhhID09PSAwKSB7CiAgICAgICAgICAgICAgYnVmZmVyW2ldID0gMjU1OwogICAgICAgICAgICAgIGJ1ZmZlcltpICsgMV0gPSAyNTU7CiAgICAgICAgICAgICAgYnVmZmVyW2kgKyAyXSA9IDI1NTsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGsgPSAyNTUgLyBhbHBoYTsKICAgICAgICAgICAgYnVmZmVyW2ldID0gKGJ1ZmZlcltpXSAtIG1hdHRlUikgKiBrICsgbWF0dGVSOwogICAgICAgICAgICBidWZmZXJbaSArIDFdID0gKGJ1ZmZlcltpICsgMV0gLSBtYXR0ZUcpICogayArIG1hdHRlRzsKICAgICAgICAgICAgYnVmZmVyW2kgKyAyXSA9IChidWZmZXJbaSArIDJdIC0gbWF0dGVCKSAqIGsgKyBtYXR0ZUI7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBjcmVhdGVJbWFnZURhdGE6IGZ1bmN0aW9uIGNyZWF0ZUltYWdlRGF0YSgpIHsKICAgICAgICAgIHZhciBmb3JjZVJHQkEgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IGZhbHNlOwogICAgICAgICAgdmFyIGRyYXdXaWR0aCA9IHRoaXMuZHJhd1dpZHRoOwogICAgICAgICAgdmFyIGRyYXdIZWlnaHQgPSB0aGlzLmRyYXdIZWlnaHQ7CiAgICAgICAgICB2YXIgaW1nRGF0YSA9IHsKICAgICAgICAgICAgd2lkdGg6IGRyYXdXaWR0aCwKICAgICAgICAgICAgaGVpZ2h0OiBkcmF3SGVpZ2h0LAogICAgICAgICAgICBraW5kOiAwLAogICAgICAgICAgICBkYXRhOiBudWxsCiAgICAgICAgICB9OwogICAgICAgICAgdmFyIG51bUNvbXBzID0gdGhpcy5udW1Db21wczsKICAgICAgICAgIHZhciBvcmlnaW5hbFdpZHRoID0gdGhpcy53aWR0aDsKICAgICAgICAgIHZhciBvcmlnaW5hbEhlaWdodCA9IHRoaXMuaGVpZ2h0OwogICAgICAgICAgdmFyIGJwYyA9IHRoaXMuYnBjOwogICAgICAgICAgdmFyIHJvd0J5dGVzID0gb3JpZ2luYWxXaWR0aCAqIG51bUNvbXBzICogYnBjICsgNyA+PiAzOwogICAgICAgICAgdmFyIGltZ0FycmF5OwoKICAgICAgICAgIGlmICghZm9yY2VSR0JBKSB7CiAgICAgICAgICAgIHZhciBraW5kOwoKICAgICAgICAgICAgaWYgKHRoaXMuY29sb3JTcGFjZS5uYW1lID09PSAiRGV2aWNlR3JheSIgJiYgYnBjID09PSAxKSB7CiAgICAgICAgICAgICAga2luZCA9IF91dGlsLkltYWdlS2luZC5HUkFZU0NBTEVfMUJQUDsKICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmNvbG9yU3BhY2UubmFtZSA9PT0gIkRldmljZVJHQiIgJiYgYnBjID09PSA4ICYmICF0aGlzLm5lZWRzRGVjb2RlKSB7CiAgICAgICAgICAgICAga2luZCA9IF91dGlsLkltYWdlS2luZC5SR0JfMjRCUFA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChraW5kICYmICF0aGlzLnNtYXNrICYmICF0aGlzLm1hc2sgJiYgZHJhd1dpZHRoID09PSBvcmlnaW5hbFdpZHRoICYmIGRyYXdIZWlnaHQgPT09IG9yaWdpbmFsSGVpZ2h0KSB7CiAgICAgICAgICAgICAgaW1nRGF0YS5raW5kID0ga2luZDsKICAgICAgICAgICAgICBpbWdBcnJheSA9IHRoaXMuZ2V0SW1hZ2VCeXRlcyhvcmlnaW5hbEhlaWdodCAqIHJvd0J5dGVzKTsKCiAgICAgICAgICAgICAgaWYgKHRoaXMuaW1hZ2UgaW5zdGFuY2VvZiBfc3RyZWFtLkRlY29kZVN0cmVhbSkgewogICAgICAgICAgICAgICAgaW1nRGF0YS5kYXRhID0gaW1nQXJyYXk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHZhciBuZXdBcnJheSA9IG5ldyBVaW50OENsYW1wZWRBcnJheShpbWdBcnJheS5sZW5ndGgpOwogICAgICAgICAgICAgICAgbmV3QXJyYXkuc2V0KGltZ0FycmF5KTsKICAgICAgICAgICAgICAgIGltZ0RhdGEuZGF0YSA9IG5ld0FycmF5OwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHRoaXMubmVlZHNEZWNvZGUpIHsKICAgICAgICAgICAgICAgICgwLCBfdXRpbC5hc3NlcnQpKGtpbmQgPT09IF91dGlsLkltYWdlS2luZC5HUkFZU0NBTEVfMUJQUCwgIlBERkltYWdlLmNyZWF0ZUltYWdlRGF0YTogVGhlIGltYWdlIG11c3QgYmUgZ3JheXNjYWxlLiIpOwogICAgICAgICAgICAgICAgdmFyIGJ1ZmZlciA9IGltZ0RhdGEuZGF0YTsKCiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBidWZmZXIubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICAgICAgICBidWZmZXJbaV0gXj0gMHhmZjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBpbWdEYXRhOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpcy5pbWFnZSBpbnN0YW5jZW9mIF9qcGVnX3N0cmVhbS5KcGVnU3RyZWFtICYmICF0aGlzLnNtYXNrICYmICF0aGlzLm1hc2spIHsKICAgICAgICAgICAgICB2YXIgaW1hZ2VMZW5ndGggPSBvcmlnaW5hbEhlaWdodCAqIHJvd0J5dGVzOwoKICAgICAgICAgICAgICBzd2l0Y2ggKHRoaXMuY29sb3JTcGFjZS5uYW1lKSB7CiAgICAgICAgICAgICAgICBjYXNlICJEZXZpY2VHcmF5IjoKICAgICAgICAgICAgICAgICAgaW1hZ2VMZW5ndGggKj0gMzsKCiAgICAgICAgICAgICAgICBjYXNlICJEZXZpY2VSR0IiOgogICAgICAgICAgICAgICAgY2FzZSAiRGV2aWNlQ01ZSyI6CiAgICAgICAgICAgICAgICAgIGltZ0RhdGEua2luZCA9IF91dGlsLkltYWdlS2luZC5SR0JfMjRCUFA7CiAgICAgICAgICAgICAgICAgIGltZ0RhdGEuZGF0YSA9IHRoaXMuZ2V0SW1hZ2VCeXRlcyhpbWFnZUxlbmd0aCwgZHJhd1dpZHRoLCBkcmF3SGVpZ2h0LCB0cnVlKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGltZ0RhdGE7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaW1nQXJyYXkgPSB0aGlzLmdldEltYWdlQnl0ZXMob3JpZ2luYWxIZWlnaHQgKiByb3dCeXRlcyk7CiAgICAgICAgICB2YXIgYWN0dWFsSGVpZ2h0ID0gMCB8IGltZ0FycmF5Lmxlbmd0aCAvIHJvd0J5dGVzICogZHJhd0hlaWdodCAvIG9yaWdpbmFsSGVpZ2h0OwogICAgICAgICAgdmFyIGNvbXBzID0gdGhpcy5nZXRDb21wb25lbnRzKGltZ0FycmF5KTsKICAgICAgICAgIHZhciBhbHBoYTAxLCBtYXliZVVuZG9QcmVibGVuZDsKCiAgICAgICAgICBpZiAoIWZvcmNlUkdCQSAmJiAhdGhpcy5zbWFzayAmJiAhdGhpcy5tYXNrKSB7CiAgICAgICAgICAgIGltZ0RhdGEua2luZCA9IF91dGlsLkltYWdlS2luZC5SR0JfMjRCUFA7CiAgICAgICAgICAgIGltZ0RhdGEuZGF0YSA9IG5ldyBVaW50OENsYW1wZWRBcnJheShkcmF3V2lkdGggKiBkcmF3SGVpZ2h0ICogMyk7CiAgICAgICAgICAgIGFscGhhMDEgPSAwOwogICAgICAgICAgICBtYXliZVVuZG9QcmVibGVuZCA9IGZhbHNlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaW1nRGF0YS5raW5kID0gX3V0aWwuSW1hZ2VLaW5kLlJHQkFfMzJCUFA7CiAgICAgICAgICAgIGltZ0RhdGEuZGF0YSA9IG5ldyBVaW50OENsYW1wZWRBcnJheShkcmF3V2lkdGggKiBkcmF3SGVpZ2h0ICogNCk7CiAgICAgICAgICAgIGFscGhhMDEgPSAxOwogICAgICAgICAgICBtYXliZVVuZG9QcmVibGVuZCA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuZmlsbE9wYWNpdHkoaW1nRGF0YS5kYXRhLCBkcmF3V2lkdGgsIGRyYXdIZWlnaHQsIGFjdHVhbEhlaWdodCwgY29tcHMpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0aGlzLm5lZWRzRGVjb2RlKSB7CiAgICAgICAgICAgIHRoaXMuZGVjb2RlQnVmZmVyKGNvbXBzKTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLmNvbG9yU3BhY2UuZmlsbFJnYihpbWdEYXRhLmRhdGEsIG9yaWdpbmFsV2lkdGgsIG9yaWdpbmFsSGVpZ2h0LCBkcmF3V2lkdGgsIGRyYXdIZWlnaHQsIGFjdHVhbEhlaWdodCwgYnBjLCBjb21wcywgYWxwaGEwMSk7CgogICAgICAgICAgaWYgKG1heWJlVW5kb1ByZWJsZW5kKSB7CiAgICAgICAgICAgIHRoaXMudW5kb1ByZWJsZW5kKGltZ0RhdGEuZGF0YSwgZHJhd1dpZHRoLCBhY3R1YWxIZWlnaHQpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBpbWdEYXRhOwogICAgICAgIH0sCiAgICAgICAgZmlsbEdyYXlCdWZmZXI6IGZ1bmN0aW9uIGZpbGxHcmF5QnVmZmVyKGJ1ZmZlcikgewogICAgICAgICAgdmFyIG51bUNvbXBzID0gdGhpcy5udW1Db21wczsKCiAgICAgICAgICBpZiAobnVtQ29tcHMgIT09IDEpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJSZWFkaW5nIGdyYXkgc2NhbGUgZnJvbSBhIGNvbG9yIGltYWdlOiAiLmNvbmNhdChudW1Db21wcykpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciB3aWR0aCA9IHRoaXMud2lkdGg7CiAgICAgICAgICB2YXIgaGVpZ2h0ID0gdGhpcy5oZWlnaHQ7CiAgICAgICAgICB2YXIgYnBjID0gdGhpcy5icGM7CiAgICAgICAgICB2YXIgcm93Qnl0ZXMgPSB3aWR0aCAqIG51bUNvbXBzICogYnBjICsgNyA+PiAzOwogICAgICAgICAgdmFyIGltZ0FycmF5ID0gdGhpcy5nZXRJbWFnZUJ5dGVzKGhlaWdodCAqIHJvd0J5dGVzKTsKICAgICAgICAgIHZhciBjb21wcyA9IHRoaXMuZ2V0Q29tcG9uZW50cyhpbWdBcnJheSk7CiAgICAgICAgICB2YXIgaSwgbGVuZ3RoOwoKICAgICAgICAgIGlmIChicGMgPT09IDEpIHsKICAgICAgICAgICAgbGVuZ3RoID0gd2lkdGggKiBoZWlnaHQ7CgogICAgICAgICAgICBpZiAodGhpcy5uZWVkc0RlY29kZSkgewogICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkgewogICAgICAgICAgICAgICAgYnVmZmVyW2ldID0gY29tcHNbaV0gLSAxICYgMjU1OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgICAgIGJ1ZmZlcltpXSA9IC1jb21wc1tpXSAmIDI1NTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodGhpcy5uZWVkc0RlY29kZSkgewogICAgICAgICAgICB0aGlzLmRlY29kZUJ1ZmZlcihjb21wcyk7CiAgICAgICAgICB9CgogICAgICAgICAgbGVuZ3RoID0gd2lkdGggKiBoZWlnaHQ7CiAgICAgICAgICB2YXIgc2NhbGUgPSAyNTUgLyAoKDEgPDwgYnBjKSAtIDEpOwoKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkgewogICAgICAgICAgICBidWZmZXJbaV0gPSBzY2FsZSAqIGNvbXBzW2ldOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgZ2V0SW1hZ2VCeXRlczogZnVuY3Rpb24gZ2V0SW1hZ2VCeXRlcyhsZW5ndGgsIGRyYXdXaWR0aCwgZHJhd0hlaWdodCkgewogICAgICAgICAgdmFyIGZvcmNlUkdCID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgJiYgYXJndW1lbnRzWzNdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbM10gOiBmYWxzZTsKICAgICAgICAgIHRoaXMuaW1hZ2UucmVzZXQoKTsKICAgICAgICAgIHRoaXMuaW1hZ2UuZHJhd1dpZHRoID0gZHJhd1dpZHRoIHx8IHRoaXMud2lkdGg7CiAgICAgICAgICB0aGlzLmltYWdlLmRyYXdIZWlnaHQgPSBkcmF3SGVpZ2h0IHx8IHRoaXMuaGVpZ2h0OwogICAgICAgICAgdGhpcy5pbWFnZS5mb3JjZVJHQiA9ICEhZm9yY2VSR0I7CiAgICAgICAgICByZXR1cm4gdGhpcy5pbWFnZS5nZXRCeXRlcyhsZW5ndGgsIHRydWUpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgcmV0dXJuIFBERkltYWdlOwogICAgfSgpOwoKICAgIGV4cG9ydHMuUERGSW1hZ2UgPSBQREZJbWFnZTsKCiAgICAvKioqL30pLCAoCiAgLyogMjM0ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgIHZhbHVlOiB0cnVlCiAgICB9KTsKICAgIGV4cG9ydHMuTWVzc2FnZUhhbmRsZXIgPSB2b2lkIDA7CgogICAgdmFyIF9yZWdlbmVyYXRvciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX193X3BkZmpzX3JlcXVpcmVfXygyKSk7CgogICAgdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXyg1KTsKCiAgICBmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikge3JldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICJkZWZhdWx0Ijogb2JqIH07fQoKICAgIGZ1bmN0aW9uIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywga2V5LCBhcmcpIHt0cnkge3ZhciBpbmZvID0gZ2VuW2tleV0oYXJnKTt2YXIgdmFsdWUgPSBpbmZvLnZhbHVlO30gY2F0Y2ggKGVycm9yKSB7cmVqZWN0KGVycm9yKTtyZXR1cm47fWlmIChpbmZvLmRvbmUpIHtyZXNvbHZlKHZhbHVlKTt9IGVsc2Uge1Byb21pc2UucmVzb2x2ZSh2YWx1ZSkudGhlbihfbmV4dCwgX3Rocm93KTt9fQoKICAgIGZ1bmN0aW9uIF9hc3luY1RvR2VuZXJhdG9yKGZuKSB7cmV0dXJuIGZ1bmN0aW9uICgpIHt2YXIgc2VsZiA9IHRoaXMsYXJncyA9IGFyZ3VtZW50cztyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge3ZhciBnZW4gPSBmbi5hcHBseShzZWxmLCBhcmdzKTtmdW5jdGlvbiBfbmV4dCh2YWx1ZSkge2FzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgIm5leHQiLCB2YWx1ZSk7fWZ1bmN0aW9uIF90aHJvdyhlcnIpIHthc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJ0aHJvdyIsIGVycik7fV9uZXh0KHVuZGVmaW5lZCk7fSk7fTt9CgogICAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3Rvcikge2lmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7fX0KCiAgICBmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7Zm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykge3ZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07ZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlO2Rlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTtpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTtPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7fX0KCiAgICBmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7aWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7aWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpO3JldHVybiBDb25zdHJ1Y3Rvcjt9CgogICAgZnVuY3Rpb24gX3R5cGVvZihvYmopIHsiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2YiO2lmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7X3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7cmV0dXJuIHR5cGVvZiBvYmo7fTt9IGVsc2Uge190eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikge3JldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmo7fTt9cmV0dXJuIF90eXBlb2Yob2JqKTt9CgogICAgdmFyIENhbGxiYWNrS2luZCA9IHsKICAgICAgVU5LTk9XTjogMCwKICAgICAgREFUQTogMSwKICAgICAgRVJST1I6IDIKICAgIH07CiAgICB2YXIgU3RyZWFtS2luZCA9IHsKICAgICAgVU5LTk9XTjogMCwKICAgICAgQ0FOQ0VMOiAxLAogICAgICBDQU5DRUxfQ09NUExFVEU6IDIsCiAgICAgIENMT1NFOiAzLAogICAgICBFTlFVRVVFOiA0LAogICAgICBFUlJPUjogNSwKICAgICAgUFVMTDogNiwKICAgICAgUFVMTF9DT01QTEVURTogNywKICAgICAgU1RBUlRfQ09NUExFVEU6IDgKICAgIH07CgogICAgZnVuY3Rpb24gd3JhcFJlYXNvbihyZWFzb24pIHsKICAgICAgaWYgKF90eXBlb2YocmVhc29uKSAhPT0gIm9iamVjdCIgfHwgcmVhc29uID09PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIHJlYXNvbjsKICAgICAgfQoKICAgICAgc3dpdGNoIChyZWFzb24ubmFtZSkgewogICAgICAgIGNhc2UgIkFib3J0RXhjZXB0aW9uIjoKICAgICAgICAgIHJldHVybiBuZXcgX3V0aWwuQWJvcnRFeGNlcHRpb24ocmVhc29uLm1lc3NhZ2UpOwoKICAgICAgICBjYXNlICJNaXNzaW5nUERGRXhjZXB0aW9uIjoKICAgICAgICAgIHJldHVybiBuZXcgX3V0aWwuTWlzc2luZ1BERkV4Y2VwdGlvbihyZWFzb24ubWVzc2FnZSk7CgogICAgICAgIGNhc2UgIlVuZXhwZWN0ZWRSZXNwb25zZUV4Y2VwdGlvbiI6CiAgICAgICAgICByZXR1cm4gbmV3IF91dGlsLlVuZXhwZWN0ZWRSZXNwb25zZUV4Y2VwdGlvbihyZWFzb24ubWVzc2FnZSwgcmVhc29uLnN0YXR1cyk7CgogICAgICAgIGNhc2UgIlVua25vd25FcnJvckV4Y2VwdGlvbiI6CiAgICAgICAgICByZXR1cm4gbmV3IF91dGlsLlVua25vd25FcnJvckV4Y2VwdGlvbihyZWFzb24ubWVzc2FnZSwgcmVhc29uLmRldGFpbHMpOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgcmV0dXJuIG5ldyBfdXRpbC5Vbmtub3duRXJyb3JFeGNlcHRpb24ocmVhc29uLm1lc3NhZ2UsIHJlYXNvbi50b1N0cmluZygpKTsKICAgICAgfQogICAgfQoKICAgIHZhciBNZXNzYWdlSGFuZGxlciA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgIGZ1bmN0aW9uIE1lc3NhZ2VIYW5kbGVyKHNvdXJjZU5hbWUsIHRhcmdldE5hbWUsIGNvbU9iaikgewogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBNZXNzYWdlSGFuZGxlcik7CgogICAgICAgIHRoaXMuc291cmNlTmFtZSA9IHNvdXJjZU5hbWU7CiAgICAgICAgdGhpcy50YXJnZXROYW1lID0gdGFyZ2V0TmFtZTsKICAgICAgICB0aGlzLmNvbU9iaiA9IGNvbU9iajsKICAgICAgICB0aGlzLmNhbGxiYWNrSWQgPSAxOwogICAgICAgIHRoaXMuc3RyZWFtSWQgPSAxOwogICAgICAgIHRoaXMucG9zdE1lc3NhZ2VUcmFuc2ZlcnMgPSB0cnVlOwogICAgICAgIHRoaXMuc3RyZWFtU2lua3MgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgIHRoaXMuc3RyZWFtQ29udHJvbGxlcnMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgIHRoaXMuY2FsbGJhY2tDYXBhYmlsaXRpZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgIHRoaXMuYWN0aW9uSGFuZGxlciA9IE9iamVjdC5jcmVhdGUobnVsbCk7CgogICAgICAgIHRoaXMuX29uQ29tT2JqT25NZXNzYWdlID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICB2YXIgZGF0YSA9IGV2ZW50LmRhdGE7CgogICAgICAgICAgaWYgKGRhdGEudGFyZ2V0TmFtZSAhPT0gX3RoaXMuc291cmNlTmFtZSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGRhdGEuc3RyZWFtKSB7CiAgICAgICAgICAgIF90aGlzLl9wcm9jZXNzU3RyZWFtTWVzc2FnZShkYXRhKTsKCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZGF0YS5jYWxsYmFjaykgewogICAgICAgICAgICB2YXIgY2FsbGJhY2tJZCA9IGRhdGEuY2FsbGJhY2tJZDsKICAgICAgICAgICAgdmFyIGNhcGFiaWxpdHkgPSBfdGhpcy5jYWxsYmFja0NhcGFiaWxpdGllc1tjYWxsYmFja0lkXTsKCiAgICAgICAgICAgIGlmICghY2FwYWJpbGl0eSkgewogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ2Fubm90IHJlc29sdmUgY2FsbGJhY2sgIi5jb25jYXQoY2FsbGJhY2tJZCkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBkZWxldGUgX3RoaXMuY2FsbGJhY2tDYXBhYmlsaXRpZXNbY2FsbGJhY2tJZF07CgogICAgICAgICAgICBpZiAoZGF0YS5jYWxsYmFjayA9PT0gQ2FsbGJhY2tLaW5kLkRBVEEpIHsKICAgICAgICAgICAgICBjYXBhYmlsaXR5LnJlc29sdmUoZGF0YS5kYXRhKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChkYXRhLmNhbGxiYWNrID09PSBDYWxsYmFja0tpbmQuRVJST1IpIHsKICAgICAgICAgICAgICBjYXBhYmlsaXR5LnJlamVjdCh3cmFwUmVhc29uKGRhdGEucmVhc29uKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmV4cGVjdGVkIGNhbGxiYWNrIGNhc2UiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBhY3Rpb24gPSBfdGhpcy5hY3Rpb25IYW5kbGVyW2RhdGEuYWN0aW9uXTsKCiAgICAgICAgICBpZiAoIWFjdGlvbikgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gYWN0aW9uIGZyb20gd29ya2VyOiAiLmNvbmNhdChkYXRhLmFjdGlvbikpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChkYXRhLmNhbGxiYWNrSWQpIHsKICAgICAgICAgICAgdmFyIF9zb3VyY2VOYW1lID0gX3RoaXMuc291cmNlTmFtZTsKICAgICAgICAgICAgdmFyIF90YXJnZXROYW1lID0gZGF0YS5zb3VyY2VOYW1lOwogICAgICAgICAgICBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgICAgICAgIHJlc29sdmUoYWN0aW9uKGRhdGEuZGF0YSkpOwogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgICAgc291cmNlTmFtZTogX3NvdXJjZU5hbWUsCiAgICAgICAgICAgICAgICB0YXJnZXROYW1lOiBfdGFyZ2V0TmFtZSwKICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBDYWxsYmFja0tpbmQuREFUQSwKICAgICAgICAgICAgICAgIGNhbGxiYWNrSWQ6IGRhdGEuY2FsbGJhY2tJZCwKICAgICAgICAgICAgICAgIGRhdGE6IHJlc3VsdAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICAgICAgY29tT2JqLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICAgIHNvdXJjZU5hbWU6IF9zb3VyY2VOYW1lLAogICAgICAgICAgICAgICAgdGFyZ2V0TmFtZTogX3RhcmdldE5hbWUsCiAgICAgICAgICAgICAgICBjYWxsYmFjazogQ2FsbGJhY2tLaW5kLkVSUk9SLAogICAgICAgICAgICAgICAgY2FsbGJhY2tJZDogZGF0YS5jYWxsYmFja0lkLAogICAgICAgICAgICAgICAgcmVhc29uOiB3cmFwUmVhc29uKHJlYXNvbikKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZGF0YS5zdHJlYW1JZCkgewogICAgICAgICAgICBfdGhpcy5fY3JlYXRlU3RyZWFtU2luayhkYXRhKTsKCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBhY3Rpb24oZGF0YS5kYXRhKTsKICAgICAgICB9OwoKICAgICAgICBjb21PYmouYWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsIHRoaXMuX29uQ29tT2JqT25NZXNzYWdlKTsKICAgICAgfQoKICAgICAgX2NyZWF0ZUNsYXNzKE1lc3NhZ2VIYW5kbGVyLCBbewogICAgICAgIGtleTogIm9uIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gb24oYWN0aW9uTmFtZSwgaGFuZGxlcikgewogICAgICAgICAgdmFyIGFoID0gdGhpcy5hY3Rpb25IYW5kbGVyOwoKICAgICAgICAgIGlmIChhaFthY3Rpb25OYW1lXSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlRoZXJlIGlzIGFscmVhZHkgYW4gYWN0aW9uTmFtZSBjYWxsZWQgXCIiLmNvbmNhdChhY3Rpb25OYW1lLCAiXCIiKSk7CiAgICAgICAgICB9CgogICAgICAgICAgYWhbYWN0aW9uTmFtZV0gPSBoYW5kbGVyOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInNlbmQiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZW5kKGFjdGlvbk5hbWUsIGRhdGEsIHRyYW5zZmVycykgewogICAgICAgICAgdGhpcy5fcG9zdE1lc3NhZ2UoewogICAgICAgICAgICBzb3VyY2VOYW1lOiB0aGlzLnNvdXJjZU5hbWUsCiAgICAgICAgICAgIHRhcmdldE5hbWU6IHRoaXMudGFyZ2V0TmFtZSwKICAgICAgICAgICAgYWN0aW9uOiBhY3Rpb25OYW1lLAogICAgICAgICAgICBkYXRhOiBkYXRhCiAgICAgICAgICB9LCB0cmFuc2ZlcnMpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInNlbmRXaXRoUHJvbWlzZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNlbmRXaXRoUHJvbWlzZShhY3Rpb25OYW1lLCBkYXRhLCB0cmFuc2ZlcnMpIHsKICAgICAgICAgIHZhciBjYWxsYmFja0lkID0gdGhpcy5jYWxsYmFja0lkKys7CiAgICAgICAgICB2YXIgY2FwYWJpbGl0eSA9ICgwLCBfdXRpbC5jcmVhdGVQcm9taXNlQ2FwYWJpbGl0eSkoKTsKICAgICAgICAgIHRoaXMuY2FsbGJhY2tDYXBhYmlsaXRpZXNbY2FsbGJhY2tJZF0gPSBjYXBhYmlsaXR5OwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHRoaXMuX3Bvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICBzb3VyY2VOYW1lOiB0aGlzLnNvdXJjZU5hbWUsCiAgICAgICAgICAgICAgdGFyZ2V0TmFtZTogdGhpcy50YXJnZXROYW1lLAogICAgICAgICAgICAgIGFjdGlvbjogYWN0aW9uTmFtZSwKICAgICAgICAgICAgICBjYWxsYmFja0lkOiBjYWxsYmFja0lkLAogICAgICAgICAgICAgIGRhdGE6IGRhdGEKICAgICAgICAgICAgfSwgdHJhbnNmZXJzKTsKICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgICAgIGNhcGFiaWxpdHkucmVqZWN0KGV4KTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gY2FwYWJpbGl0eS5wcm9taXNlOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInNlbmRXaXRoU3RyZWFtIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gc2VuZFdpdGhTdHJlYW0oYWN0aW9uTmFtZSwgZGF0YSwgcXVldWVpbmdTdHJhdGVneSwgdHJhbnNmZXJzKSB7CiAgICAgICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgICAgICB2YXIgc3RyZWFtSWQgPSB0aGlzLnN0cmVhbUlkKys7CiAgICAgICAgICB2YXIgc291cmNlTmFtZSA9IHRoaXMuc291cmNlTmFtZTsKICAgICAgICAgIHZhciB0YXJnZXROYW1lID0gdGhpcy50YXJnZXROYW1lOwogICAgICAgICAgdmFyIGNvbU9iaiA9IHRoaXMuY29tT2JqOwogICAgICAgICAgcmV0dXJuIG5ldyBSZWFkYWJsZVN0cmVhbSh7CiAgICAgICAgICAgIHN0YXJ0OiBmdW5jdGlvbiBzdGFydChjb250cm9sbGVyKSB7CiAgICAgICAgICAgICAgdmFyIHN0YXJ0Q2FwYWJpbGl0eSA9ICgwLCBfdXRpbC5jcmVhdGVQcm9taXNlQ2FwYWJpbGl0eSkoKTsKICAgICAgICAgICAgICBfdGhpczIuc3RyZWFtQ29udHJvbGxlcnNbc3RyZWFtSWRdID0gewogICAgICAgICAgICAgICAgY29udHJvbGxlcjogY29udHJvbGxlciwKICAgICAgICAgICAgICAgIHN0YXJ0Q2FsbDogc3RhcnRDYXBhYmlsaXR5LAogICAgICAgICAgICAgICAgcHVsbENhbGw6IG51bGwsCiAgICAgICAgICAgICAgICBjYW5jZWxDYWxsOiBudWxsLAogICAgICAgICAgICAgICAgaXNDbG9zZWQ6IGZhbHNlCiAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgX3RoaXMyLl9wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgICBzb3VyY2VOYW1lOiBzb3VyY2VOYW1lLAogICAgICAgICAgICAgICAgdGFyZ2V0TmFtZTogdGFyZ2V0TmFtZSwKICAgICAgICAgICAgICAgIGFjdGlvbjogYWN0aW9uTmFtZSwKICAgICAgICAgICAgICAgIHN0cmVhbUlkOiBzdHJlYW1JZCwKICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgICAgICAgICBkZXNpcmVkU2l6ZTogY29udHJvbGxlci5kZXNpcmVkU2l6ZQogICAgICAgICAgICAgIH0sIHRyYW5zZmVycyk7CgogICAgICAgICAgICAgIHJldHVybiBzdGFydENhcGFiaWxpdHkucHJvbWlzZTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcHVsbDogZnVuY3Rpb24gcHVsbChjb250cm9sbGVyKSB7CiAgICAgICAgICAgICAgdmFyIHB1bGxDYXBhYmlsaXR5ID0gKDAsIF91dGlsLmNyZWF0ZVByb21pc2VDYXBhYmlsaXR5KSgpOwogICAgICAgICAgICAgIF90aGlzMi5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF0ucHVsbENhbGwgPSBwdWxsQ2FwYWJpbGl0eTsKICAgICAgICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgICAgc291cmNlTmFtZTogc291cmNlTmFtZSwKICAgICAgICAgICAgICAgIHRhcmdldE5hbWU6IHRhcmdldE5hbWUsCiAgICAgICAgICAgICAgICBzdHJlYW06IFN0cmVhbUtpbmQuUFVMTCwKICAgICAgICAgICAgICAgIHN0cmVhbUlkOiBzdHJlYW1JZCwKICAgICAgICAgICAgICAgIGRlc2lyZWRTaXplOiBjb250cm9sbGVyLmRlc2lyZWRTaXplCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgcmV0dXJuIHB1bGxDYXBhYmlsaXR5LnByb21pc2U7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNhbmNlbDogZnVuY3Rpb24gY2FuY2VsKHJlYXNvbikgewogICAgICAgICAgICAgICgwLCBfdXRpbC5hc3NlcnQpKHJlYXNvbiBpbnN0YW5jZW9mIEVycm9yLCAiY2FuY2VsIG11c3QgaGF2ZSBhIHZhbGlkIHJlYXNvbiIpOwogICAgICAgICAgICAgIHZhciBjYW5jZWxDYXBhYmlsaXR5ID0gKDAsIF91dGlsLmNyZWF0ZVByb21pc2VDYXBhYmlsaXR5KSgpOwogICAgICAgICAgICAgIF90aGlzMi5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF0uY2FuY2VsQ2FsbCA9IGNhbmNlbENhcGFiaWxpdHk7CiAgICAgICAgICAgICAgX3RoaXMyLnN0cmVhbUNvbnRyb2xsZXJzW3N0cmVhbUlkXS5pc0Nsb3NlZCA9IHRydWU7CiAgICAgICAgICAgICAgY29tT2JqLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICAgIHNvdXJjZU5hbWU6IHNvdXJjZU5hbWUsCiAgICAgICAgICAgICAgICB0YXJnZXROYW1lOiB0YXJnZXROYW1lLAogICAgICAgICAgICAgICAgc3RyZWFtOiBTdHJlYW1LaW5kLkNBTkNFTCwKICAgICAgICAgICAgICAgIHN0cmVhbUlkOiBzdHJlYW1JZCwKICAgICAgICAgICAgICAgIHJlYXNvbjogd3JhcFJlYXNvbihyZWFzb24pCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgcmV0dXJuIGNhbmNlbENhcGFiaWxpdHkucHJvbWlzZTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwgcXVldWVpbmdTdHJhdGVneSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiX2NyZWF0ZVN0cmVhbVNpbmsiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfY3JlYXRlU3RyZWFtU2luayhkYXRhKSB7CiAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICB2YXIgYWN0aW9uID0gdGhpcy5hY3Rpb25IYW5kbGVyW2RhdGEuYWN0aW9uXTsKICAgICAgICAgIHZhciBzdHJlYW1JZCA9IGRhdGEuc3RyZWFtSWQ7CiAgICAgICAgICB2YXIgc291cmNlTmFtZSA9IHRoaXMuc291cmNlTmFtZTsKICAgICAgICAgIHZhciB0YXJnZXROYW1lID0gZGF0YS5zb3VyY2VOYW1lOwogICAgICAgICAgdmFyIGNvbU9iaiA9IHRoaXMuY29tT2JqOwogICAgICAgICAgdmFyIHN0cmVhbVNpbmsgPSB7CiAgICAgICAgICAgIGVucXVldWU6IGZ1bmN0aW9uIGVucXVldWUoY2h1bmspIHsKICAgICAgICAgICAgICB2YXIgc2l6ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogMTsKICAgICAgICAgICAgICB2YXIgdHJhbnNmZXJzID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgPyBhcmd1bWVudHNbMl0gOiB1bmRlZmluZWQ7CgogICAgICAgICAgICAgIGlmICh0aGlzLmlzQ2FuY2VsbGVkKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgbGFzdERlc2lyZWRTaXplID0gdGhpcy5kZXNpcmVkU2l6ZTsKICAgICAgICAgICAgICB0aGlzLmRlc2lyZWRTaXplIC09IHNpemU7CgogICAgICAgICAgICAgIGlmIChsYXN0RGVzaXJlZFNpemUgPiAwICYmIHRoaXMuZGVzaXJlZFNpemUgPD0gMCkgewogICAgICAgICAgICAgICAgdGhpcy5zaW5rQ2FwYWJpbGl0eSA9ICgwLCBfdXRpbC5jcmVhdGVQcm9taXNlQ2FwYWJpbGl0eSkoKTsKICAgICAgICAgICAgICAgIHRoaXMucmVhZHkgPSB0aGlzLnNpbmtDYXBhYmlsaXR5LnByb21pc2U7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzZWxmLl9wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgICBzb3VyY2VOYW1lOiBzb3VyY2VOYW1lLAogICAgICAgICAgICAgICAgdGFyZ2V0TmFtZTogdGFyZ2V0TmFtZSwKICAgICAgICAgICAgICAgIHN0cmVhbTogU3RyZWFtS2luZC5FTlFVRVVFLAogICAgICAgICAgICAgICAgc3RyZWFtSWQ6IHN0cmVhbUlkLAogICAgICAgICAgICAgICAgY2h1bms6IGNodW5rCiAgICAgICAgICAgICAgfSwgdHJhbnNmZXJzKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2xvc2U6IGZ1bmN0aW9uIGNsb3NlKCkgewogICAgICAgICAgICAgIGlmICh0aGlzLmlzQ2FuY2VsbGVkKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB0aGlzLmlzQ2FuY2VsbGVkID0gdHJ1ZTsKICAgICAgICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgICAgc291cmNlTmFtZTogc291cmNlTmFtZSwKICAgICAgICAgICAgICAgIHRhcmdldE5hbWU6IHRhcmdldE5hbWUsCiAgICAgICAgICAgICAgICBzdHJlYW06IFN0cmVhbUtpbmQuQ0xPU0UsCiAgICAgICAgICAgICAgICBzdHJlYW1JZDogc3RyZWFtSWQKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBkZWxldGUgc2VsZi5zdHJlYW1TaW5rc1tzdHJlYW1JZF07CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiBlcnJvcihyZWFzb24pIHsKICAgICAgICAgICAgICAoMCwgX3V0aWwuYXNzZXJ0KShyZWFzb24gaW5zdGFuY2VvZiBFcnJvciwgImVycm9yIG11c3QgaGF2ZSBhIHZhbGlkIHJlYXNvbiIpOwoKICAgICAgICAgICAgICBpZiAodGhpcy5pc0NhbmNlbGxlZCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdGhpcy5pc0NhbmNlbGxlZCA9IHRydWU7CiAgICAgICAgICAgICAgY29tT2JqLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICAgIHNvdXJjZU5hbWU6IHNvdXJjZU5hbWUsCiAgICAgICAgICAgICAgICB0YXJnZXROYW1lOiB0YXJnZXROYW1lLAogICAgICAgICAgICAgICAgc3RyZWFtOiBTdHJlYW1LaW5kLkVSUk9SLAogICAgICAgICAgICAgICAgc3RyZWFtSWQ6IHN0cmVhbUlkLAogICAgICAgICAgICAgICAgcmVhc29uOiB3cmFwUmVhc29uKHJlYXNvbikKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2lua0NhcGFiaWxpdHk6ICgwLCBfdXRpbC5jcmVhdGVQcm9taXNlQ2FwYWJpbGl0eSkoKSwKICAgICAgICAgICAgb25QdWxsOiBudWxsLAogICAgICAgICAgICBvbkNhbmNlbDogbnVsbCwKICAgICAgICAgICAgaXNDYW5jZWxsZWQ6IGZhbHNlLAogICAgICAgICAgICBkZXNpcmVkU2l6ZTogZGF0YS5kZXNpcmVkU2l6ZSwKICAgICAgICAgICAgcmVhZHk6IG51bGwKICAgICAgICAgIH07CiAgICAgICAgICBzdHJlYW1TaW5rLnNpbmtDYXBhYmlsaXR5LnJlc29sdmUoKTsKICAgICAgICAgIHN0cmVhbVNpbmsucmVhZHkgPSBzdHJlYW1TaW5rLnNpbmtDYXBhYmlsaXR5LnByb21pc2U7CiAgICAgICAgICB0aGlzLnN0cmVhbVNpbmtzW3N0cmVhbUlkXSA9IHN0cmVhbVNpbms7CiAgICAgICAgICBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgICAgICByZXNvbHZlKGFjdGlvbihkYXRhLmRhdGEsIHN0cmVhbVNpbmspKTsKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgIHNvdXJjZU5hbWU6IHNvdXJjZU5hbWUsCiAgICAgICAgICAgICAgdGFyZ2V0TmFtZTogdGFyZ2V0TmFtZSwKICAgICAgICAgICAgICBzdHJlYW06IFN0cmVhbUtpbmQuU1RBUlRfQ09NUExFVEUsCiAgICAgICAgICAgICAgc3RyZWFtSWQ6IHN0cmVhbUlkLAogICAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgc291cmNlTmFtZTogc291cmNlTmFtZSwKICAgICAgICAgICAgICB0YXJnZXROYW1lOiB0YXJnZXROYW1lLAogICAgICAgICAgICAgIHN0cmVhbTogU3RyZWFtS2luZC5TVEFSVF9DT01QTEVURSwKICAgICAgICAgICAgICBzdHJlYW1JZDogc3RyZWFtSWQsCiAgICAgICAgICAgICAgcmVhc29uOiB3cmFwUmVhc29uKHJlYXNvbikKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJfcHJvY2Vzc1N0cmVhbU1lc3NhZ2UiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfcHJvY2Vzc1N0cmVhbU1lc3NhZ2UoZGF0YSkgewogICAgICAgICAgdmFyIHN0cmVhbUlkID0gZGF0YS5zdHJlYW1JZDsKICAgICAgICAgIHZhciBzb3VyY2VOYW1lID0gdGhpcy5zb3VyY2VOYW1lOwogICAgICAgICAgdmFyIHRhcmdldE5hbWUgPSBkYXRhLnNvdXJjZU5hbWU7CiAgICAgICAgICB2YXIgY29tT2JqID0gdGhpcy5jb21PYmo7CgogICAgICAgICAgc3dpdGNoIChkYXRhLnN0cmVhbSkgewogICAgICAgICAgICBjYXNlIFN0cmVhbUtpbmQuU1RBUlRfQ09NUExFVEU6CiAgICAgICAgICAgICAgaWYgKGRhdGEuc3VjY2VzcykgewogICAgICAgICAgICAgICAgdGhpcy5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF0uc3RhcnRDYWxsLnJlc29sdmUoKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF0uc3RhcnRDYWxsLnJlamVjdCh3cmFwUmVhc29uKGRhdGEucmVhc29uKSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgU3RyZWFtS2luZC5QVUxMX0NPTVBMRVRFOgogICAgICAgICAgICAgIGlmIChkYXRhLnN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgIHRoaXMuc3RyZWFtQ29udHJvbGxlcnNbc3RyZWFtSWRdLnB1bGxDYWxsLnJlc29sdmUoKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF0ucHVsbENhbGwucmVqZWN0KHdyYXBSZWFzb24oZGF0YS5yZWFzb24pKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSBTdHJlYW1LaW5kLlBVTEw6CiAgICAgICAgICAgICAgaWYgKCF0aGlzLnN0cmVhbVNpbmtzW3N0cmVhbUlkXSkgewogICAgICAgICAgICAgICAgY29tT2JqLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICAgICAgc291cmNlTmFtZTogc291cmNlTmFtZSwKICAgICAgICAgICAgICAgICAgdGFyZ2V0TmFtZTogdGFyZ2V0TmFtZSwKICAgICAgICAgICAgICAgICAgc3RyZWFtOiBTdHJlYW1LaW5kLlBVTExfQ09NUExFVEUsCiAgICAgICAgICAgICAgICAgIHN0cmVhbUlkOiBzdHJlYW1JZCwKICAgICAgICAgICAgICAgICAgc3VjY2VzczogdHJ1ZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICh0aGlzLnN0cmVhbVNpbmtzW3N0cmVhbUlkXS5kZXNpcmVkU2l6ZSA8PSAwICYmIGRhdGEuZGVzaXJlZFNpemUgPiAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLnN0cmVhbVNpbmtzW3N0cmVhbUlkXS5zaW5rQ2FwYWJpbGl0eS5yZXNvbHZlKCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB0aGlzLnN0cmVhbVNpbmtzW3N0cmVhbUlkXS5kZXNpcmVkU2l6ZSA9IGRhdGEuZGVzaXJlZFNpemU7CiAgICAgICAgICAgICAgdmFyIG9uUHVsbCA9IHRoaXMuc3RyZWFtU2lua3NbZGF0YS5zdHJlYW1JZF0ub25QdWxsOwogICAgICAgICAgICAgIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgICAgICAgICByZXNvbHZlKG9uUHVsbCAmJiBvblB1bGwoKSk7CiAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgICAgICBzb3VyY2VOYW1lOiBzb3VyY2VOYW1lLAogICAgICAgICAgICAgICAgICB0YXJnZXROYW1lOiB0YXJnZXROYW1lLAogICAgICAgICAgICAgICAgICBzdHJlYW06IFN0cmVhbUtpbmQuUFVMTF9DT01QTEVURSwKICAgICAgICAgICAgICAgICAgc3RyZWFtSWQ6IHN0cmVhbUlkLAogICAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgICAgICBzb3VyY2VOYW1lOiBzb3VyY2VOYW1lLAogICAgICAgICAgICAgICAgICB0YXJnZXROYW1lOiB0YXJnZXROYW1lLAogICAgICAgICAgICAgICAgICBzdHJlYW06IFN0cmVhbUtpbmQuUFVMTF9DT01QTEVURSwKICAgICAgICAgICAgICAgICAgc3RyZWFtSWQ6IHN0cmVhbUlkLAogICAgICAgICAgICAgICAgICByZWFzb246IHdyYXBSZWFzb24ocmVhc29uKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIFN0cmVhbUtpbmQuRU5RVUVVRToKICAgICAgICAgICAgICAoMCwgX3V0aWwuYXNzZXJ0KSh0aGlzLnN0cmVhbUNvbnRyb2xsZXJzW3N0cmVhbUlkXSwgImVucXVldWUgc2hvdWxkIGhhdmUgc3RyZWFtIGNvbnRyb2xsZXIiKTsKCiAgICAgICAgICAgICAgaWYgKHRoaXMuc3RyZWFtQ29udHJvbGxlcnNbc3RyZWFtSWRdLmlzQ2xvc2VkKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHRoaXMuc3RyZWFtQ29udHJvbGxlcnNbc3RyZWFtSWRdLmNvbnRyb2xsZXIuZW5xdWV1ZShkYXRhLmNodW5rKTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgU3RyZWFtS2luZC5DTE9TRToKICAgICAgICAgICAgICAoMCwgX3V0aWwuYXNzZXJ0KSh0aGlzLnN0cmVhbUNvbnRyb2xsZXJzW3N0cmVhbUlkXSwgImNsb3NlIHNob3VsZCBoYXZlIHN0cmVhbSBjb250cm9sbGVyIik7CgogICAgICAgICAgICAgIGlmICh0aGlzLnN0cmVhbUNvbnRyb2xsZXJzW3N0cmVhbUlkXS5pc0Nsb3NlZCkgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB0aGlzLnN0cmVhbUNvbnRyb2xsZXJzW3N0cmVhbUlkXS5pc0Nsb3NlZCA9IHRydWU7CiAgICAgICAgICAgICAgdGhpcy5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF0uY29udHJvbGxlci5jbG9zZSgpOwoKICAgICAgICAgICAgICB0aGlzLl9kZWxldGVTdHJlYW1Db250cm9sbGVyKHN0cmVhbUlkKTsKCiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIFN0cmVhbUtpbmQuRVJST1I6CiAgICAgICAgICAgICAgKDAsIF91dGlsLmFzc2VydCkodGhpcy5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF0sICJlcnJvciBzaG91bGQgaGF2ZSBzdHJlYW0gY29udHJvbGxlciIpOwogICAgICAgICAgICAgIHRoaXMuc3RyZWFtQ29udHJvbGxlcnNbc3RyZWFtSWRdLmNvbnRyb2xsZXIuZXJyb3Iod3JhcFJlYXNvbihkYXRhLnJlYXNvbikpOwoKICAgICAgICAgICAgICB0aGlzLl9kZWxldGVTdHJlYW1Db250cm9sbGVyKHN0cmVhbUlkKTsKCiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIFN0cmVhbUtpbmQuQ0FOQ0VMX0NPTVBMRVRFOgogICAgICAgICAgICAgIGlmIChkYXRhLnN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgIHRoaXMuc3RyZWFtQ29udHJvbGxlcnNbc3RyZWFtSWRdLmNhbmNlbENhbGwucmVzb2x2ZSgpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLnN0cmVhbUNvbnRyb2xsZXJzW3N0cmVhbUlkXS5jYW5jZWxDYWxsLnJlamVjdCh3cmFwUmVhc29uKGRhdGEucmVhc29uKSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB0aGlzLl9kZWxldGVTdHJlYW1Db250cm9sbGVyKHN0cmVhbUlkKTsKCiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIFN0cmVhbUtpbmQuQ0FOQ0VMOgogICAgICAgICAgICAgIGlmICghdGhpcy5zdHJlYW1TaW5rc1tzdHJlYW1JZF0pIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIG9uQ2FuY2VsID0gdGhpcy5zdHJlYW1TaW5rc1tkYXRhLnN0cmVhbUlkXS5vbkNhbmNlbDsKICAgICAgICAgICAgICBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgICAgICAgICAgcmVzb2x2ZShvbkNhbmNlbCAmJiBvbkNhbmNlbCh3cmFwUmVhc29uKGRhdGEucmVhc29uKSkpOwogICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgY29tT2JqLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICAgICAgc291cmNlTmFtZTogc291cmNlTmFtZSwKICAgICAgICAgICAgICAgICAgdGFyZ2V0TmFtZTogdGFyZ2V0TmFtZSwKICAgICAgICAgICAgICAgICAgc3RyZWFtOiBTdHJlYW1LaW5kLkNBTkNFTF9DT01QTEVURSwKICAgICAgICAgICAgICAgICAgc3RyZWFtSWQ6IHN0cmVhbUlkLAogICAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgICAgICBzb3VyY2VOYW1lOiBzb3VyY2VOYW1lLAogICAgICAgICAgICAgICAgICB0YXJnZXROYW1lOiB0YXJnZXROYW1lLAogICAgICAgICAgICAgICAgICBzdHJlYW06IFN0cmVhbUtpbmQuQ0FOQ0VMX0NPTVBMRVRFLAogICAgICAgICAgICAgICAgICBzdHJlYW1JZDogc3RyZWFtSWQsCiAgICAgICAgICAgICAgICAgIHJlYXNvbjogd3JhcFJlYXNvbihyZWFzb24pCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB0aGlzLnN0cmVhbVNpbmtzW3N0cmVhbUlkXS5zaW5rQ2FwYWJpbGl0eS5yZWplY3Qod3JhcFJlYXNvbihkYXRhLnJlYXNvbikpOwogICAgICAgICAgICAgIHRoaXMuc3RyZWFtU2lua3Nbc3RyZWFtSWRdLmlzQ2FuY2VsbGVkID0gdHJ1ZTsKICAgICAgICAgICAgICBkZWxldGUgdGhpcy5zdHJlYW1TaW5rc1tzdHJlYW1JZF07CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5leHBlY3RlZCBzdHJlYW0gY2FzZSIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIl9kZWxldGVTdHJlYW1Db250cm9sbGVyIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIF9kZWxldGVTdHJlYW1Db250cm9sbGVyMiA9IF9hc3luY1RvR2VuZXJhdG9yKC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JbImRlZmF1bHQiXS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoc3RyZWFtSWQpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclsiZGVmYXVsdCJdLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsU2V0dGxlZChbdGhpcy5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF0uc3RhcnRDYWxsLCB0aGlzLnN0cmVhbUNvbnRyb2xsZXJzW3N0cmVhbUlkXS5wdWxsQ2FsbCwgdGhpcy5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF0uY2FuY2VsQ2FsbF0ubWFwKGZ1bmN0aW9uIChjYXBhYmlsaXR5KSB7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FwYWJpbGl0eSAmJiBjYXBhYmlsaXR5LnByb21pc2U7CiAgICAgICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnN0cmVhbUNvbnRyb2xsZXJzW3N0cmVhbUlkXTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgX2NhbGxlZSwgdGhpcyk7CiAgICAgICAgICB9KSk7CgogICAgICAgICAgZnVuY3Rpb24gX2RlbGV0ZVN0cmVhbUNvbnRyb2xsZXIoX3gpIHsKICAgICAgICAgICAgcmV0dXJuIF9kZWxldGVTdHJlYW1Db250cm9sbGVyMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBfZGVsZXRlU3RyZWFtQ29udHJvbGxlcjsKICAgICAgICB9KCkKICAgICAgfSwgewogICAgICAgIGtleTogIl9wb3N0TWVzc2FnZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9wb3N0TWVzc2FnZShtZXNzYWdlLCB0cmFuc2ZlcnMpIHsKICAgICAgICAgIGlmICh0cmFuc2ZlcnMgJiYgdGhpcy5wb3N0TWVzc2FnZVRyYW5zZmVycykgewogICAgICAgICAgICB0aGlzLmNvbU9iai5wb3N0TWVzc2FnZShtZXNzYWdlLCB0cmFuc2ZlcnMpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5jb21PYmoucG9zdE1lc3NhZ2UobWVzc2FnZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZGVzdHJveSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7CiAgICAgICAgICB0aGlzLmNvbU9iai5yZW1vdmVFdmVudExpc3RlbmVyKCJtZXNzYWdlIiwgdGhpcy5fb25Db21PYmpPbk1lc3NhZ2UpOwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIE1lc3NhZ2VIYW5kbGVyOwogICAgfSgpOwoKICAgIGV4cG9ydHMuTWVzc2FnZUhhbmRsZXIgPSBNZXNzYWdlSGFuZGxlcjsKCiAgICAvKioqL30pLCAoCiAgLyogMjM1ICovCiAgLyoqKi9mdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSB7CgogICAgInVzZSBzdHJpY3QiOwoKCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgIHZhbHVlOiB0cnVlCiAgICB9KTsKICAgIGV4cG9ydHMuUERGV29ya2VyU3RyZWFtID0gdm9pZCAwOwoKICAgIHZhciBfcmVnZW5lcmF0b3IgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9fd19wZGZqc19yZXF1aXJlX18oMikpOwoKICAgIHZhciBfdXRpbCA9IF9fd19wZGZqc19yZXF1aXJlX18oNSk7CgogICAgZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHtyZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTt9CgogICAgZnVuY3Rpb24gYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBrZXksIGFyZykge3RyeSB7dmFyIGluZm8gPSBnZW5ba2V5XShhcmcpO3ZhciB2YWx1ZSA9IGluZm8udmFsdWU7fSBjYXRjaCAoZXJyb3IpIHtyZWplY3QoZXJyb3IpO3JldHVybjt9aWYgKGluZm8uZG9uZSkge3Jlc29sdmUodmFsdWUpO30gZWxzZSB7UHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKF9uZXh0LCBfdGhyb3cpO319CgogICAgZnVuY3Rpb24gX2FzeW5jVG9HZW5lcmF0b3IoZm4pIHtyZXR1cm4gZnVuY3Rpb24gKCkge3ZhciBzZWxmID0gdGhpcyxhcmdzID0gYXJndW1lbnRzO3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7dmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpO2Z1bmN0aW9uIF9uZXh0KHZhbHVlKSB7YXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAibmV4dCIsIHZhbHVlKTt9ZnVuY3Rpb24gX3Rocm93KGVycikge2FzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyKTt9X25leHQodW5kZWZpbmVkKTt9KTt9O30KCiAgICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7aWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTt9fQoKICAgIGZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHtmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7dmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTtkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7ZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlO2lmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlO09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTt9fQoKICAgIGZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHtpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTtpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7cmV0dXJuIENvbnN0cnVjdG9yO30KCiAgICB2YXIgUERGV29ya2VyU3RyZWFtID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gUERGV29ya2VyU3RyZWFtKG1zZ0hhbmRsZXIpIHsKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUERGV29ya2VyU3RyZWFtKTsKCiAgICAgICAgdGhpcy5fbXNnSGFuZGxlciA9IG1zZ0hhbmRsZXI7CiAgICAgICAgdGhpcy5fY29udGVudExlbmd0aCA9IG51bGw7CiAgICAgICAgdGhpcy5fZnVsbFJlcXVlc3RSZWFkZXIgPSBudWxsOwogICAgICAgIHRoaXMuX3JhbmdlUmVxdWVzdFJlYWRlcnMgPSBbXTsKICAgICAgfQoKICAgICAgX2NyZWF0ZUNsYXNzKFBERldvcmtlclN0cmVhbSwgW3sKICAgICAgICBrZXk6ICJnZXRGdWxsUmVhZGVyIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0RnVsbFJlYWRlcigpIHsKICAgICAgICAgICgwLCBfdXRpbC5hc3NlcnQpKCF0aGlzLl9mdWxsUmVxdWVzdFJlYWRlcik7CiAgICAgICAgICB0aGlzLl9mdWxsUmVxdWVzdFJlYWRlciA9IG5ldyBQREZXb3JrZXJTdHJlYW1SZWFkZXIodGhpcy5fbXNnSGFuZGxlcik7CiAgICAgICAgICByZXR1cm4gdGhpcy5fZnVsbFJlcXVlc3RSZWFkZXI7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0UmFuZ2VSZWFkZXIiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRSYW5nZVJlYWRlcihiZWdpbiwgZW5kKSB7CiAgICAgICAgICB2YXIgcmVhZGVyID0gbmV3IFBERldvcmtlclN0cmVhbVJhbmdlUmVhZGVyKGJlZ2luLCBlbmQsIHRoaXMuX21zZ0hhbmRsZXIpOwoKICAgICAgICAgIHRoaXMuX3JhbmdlUmVxdWVzdFJlYWRlcnMucHVzaChyZWFkZXIpOwoKICAgICAgICAgIHJldHVybiByZWFkZXI7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiY2FuY2VsQWxsUmVxdWVzdHMiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjYW5jZWxBbGxSZXF1ZXN0cyhyZWFzb24pIHsKICAgICAgICAgIGlmICh0aGlzLl9mdWxsUmVxdWVzdFJlYWRlcikgewogICAgICAgICAgICB0aGlzLl9mdWxsUmVxdWVzdFJlYWRlci5jYW5jZWwocmVhc29uKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcmVhZGVycyA9IHRoaXMuX3JhbmdlUmVxdWVzdFJlYWRlcnMuc2xpY2UoMCk7CgogICAgICAgICAgcmVhZGVycy5mb3JFYWNoKGZ1bmN0aW9uIChyZWFkZXIpIHsKICAgICAgICAgICAgcmVhZGVyLmNhbmNlbChyZWFzb24pOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9XSk7CgogICAgICByZXR1cm4gUERGV29ya2VyU3RyZWFtOwogICAgfSgpOwoKICAgIGV4cG9ydHMuUERGV29ya2VyU3RyZWFtID0gUERGV29ya2VyU3RyZWFtOwoKICAgIHZhciBQREZXb3JrZXJTdHJlYW1SZWFkZXIgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBQREZXb3JrZXJTdHJlYW1SZWFkZXIobXNnSGFuZGxlcikgewogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBQREZXb3JrZXJTdHJlYW1SZWFkZXIpOwoKICAgICAgICB0aGlzLl9tc2dIYW5kbGVyID0gbXNnSGFuZGxlcjsKICAgICAgICB0aGlzLm9uUHJvZ3Jlc3MgPSBudWxsOwogICAgICAgIHRoaXMuX2NvbnRlbnRMZW5ndGggPSBudWxsOwogICAgICAgIHRoaXMuX2lzUmFuZ2VTdXBwb3J0ZWQgPSBmYWxzZTsKICAgICAgICB0aGlzLl9pc1N0cmVhbWluZ1N1cHBvcnRlZCA9IGZhbHNlOwoKICAgICAgICB2YXIgcmVhZGFibGVTdHJlYW0gPSB0aGlzLl9tc2dIYW5kbGVyLnNlbmRXaXRoU3RyZWFtKCJHZXRSZWFkZXIiKTsKCiAgICAgICAgdGhpcy5fcmVhZGVyID0gcmVhZGFibGVTdHJlYW0uZ2V0UmVhZGVyKCk7CiAgICAgICAgdGhpcy5faGVhZGVyc1JlYWR5ID0gdGhpcy5fbXNnSGFuZGxlci5zZW5kV2l0aFByb21pc2UoIlJlYWRlckhlYWRlcnNSZWFkeSIpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgIF90aGlzLl9pc1N0cmVhbWluZ1N1cHBvcnRlZCA9IGRhdGEuaXNTdHJlYW1pbmdTdXBwb3J0ZWQ7CiAgICAgICAgICBfdGhpcy5faXNSYW5nZVN1cHBvcnRlZCA9IGRhdGEuaXNSYW5nZVN1cHBvcnRlZDsKICAgICAgICAgIF90aGlzLl9jb250ZW50TGVuZ3RoID0gZGF0YS5jb250ZW50TGVuZ3RoOwogICAgICAgIH0pOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoUERGV29ya2VyU3RyZWFtUmVhZGVyLCBbewogICAgICAgIGtleTogInJlYWQiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgX3JlYWQgPSBfYXN5bmNUb0dlbmVyYXRvcigvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yWyJkZWZhdWx0Il0ubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICAgICAgICB2YXIgX3JlZiwgdmFsdWUsIGRvbmU7CgogICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yWyJkZWZhdWx0Il0ud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVhZGVyLnJlYWQoKTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICBfcmVmID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IF9yZWYudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgZG9uZSA9IF9yZWYuZG9uZTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCFkb25lKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNzsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICAgIGRvbmU6IHRydWUKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUuYnVmZmVyLAogICAgICAgICAgICAgICAgICAgICAgZG9uZTogZmFsc2UKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgX2NhbGxlZSwgdGhpcyk7CiAgICAgICAgICB9KSk7CgogICAgICAgICAgZnVuY3Rpb24gcmVhZCgpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZWFkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHJlYWQ7CiAgICAgICAgfSgpCiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJjYW5jZWwiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjYW5jZWwocmVhc29uKSB7CiAgICAgICAgICB0aGlzLl9yZWFkZXIuY2FuY2VsKHJlYXNvbik7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiaGVhZGVyc1JlYWR5IiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9oZWFkZXJzUmVhZHk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiY29udGVudExlbmd0aCIsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fY29udGVudExlbmd0aDsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJpc1N0cmVhbWluZ1N1cHBvcnRlZCIsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5faXNTdHJlYW1pbmdTdXBwb3J0ZWQ7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiaXNSYW5nZVN1cHBvcnRlZCIsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5faXNSYW5nZVN1cHBvcnRlZDsKICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBQREZXb3JrZXJTdHJlYW1SZWFkZXI7CiAgICB9KCk7CgogICAgdmFyIFBERldvcmtlclN0cmVhbVJhbmdlUmVhZGVyID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gUERGV29ya2VyU3RyZWFtUmFuZ2VSZWFkZXIoYmVnaW4sIGVuZCwgbXNnSGFuZGxlcikgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBQREZXb3JrZXJTdHJlYW1SYW5nZVJlYWRlcik7CgogICAgICAgIHRoaXMuX21zZ0hhbmRsZXIgPSBtc2dIYW5kbGVyOwogICAgICAgIHRoaXMub25Qcm9ncmVzcyA9IG51bGw7CgogICAgICAgIHZhciByZWFkYWJsZVN0cmVhbSA9IHRoaXMuX21zZ0hhbmRsZXIuc2VuZFdpdGhTdHJlYW0oIkdldFJhbmdlUmVhZGVyIiwgewogICAgICAgICAgYmVnaW46IGJlZ2luLAogICAgICAgICAgZW5kOiBlbmQKICAgICAgICB9KTsKCiAgICAgICAgdGhpcy5fcmVhZGVyID0gcmVhZGFibGVTdHJlYW0uZ2V0UmVhZGVyKCk7CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhQREZXb3JrZXJTdHJlYW1SYW5nZVJlYWRlciwgW3sKICAgICAgICBrZXk6ICJyZWFkIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIF9yZWFkMiA9IF9hc3luY1RvR2VuZXJhdG9yKC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JbImRlZmF1bHQiXS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgICAgICAgICB2YXIgX3JlZjIsIHZhbHVlLCBkb25lOwoKICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclsiZGVmYXVsdCJdLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVhZGVyLnJlYWQoKTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICBfcmVmMiA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gX3JlZjIudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgZG9uZSA9IF9yZWYyLmRvbmU7CgogICAgICAgICAgICAgICAgICAgIGlmICghZG9uZSkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA3OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICAgIGRvbmU6IHRydWUKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLmJ1ZmZlciwKICAgICAgICAgICAgICAgICAgICAgIGRvbmU6IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBfY2FsbGVlMiwgdGhpcyk7CiAgICAgICAgICB9KSk7CgogICAgICAgICAgZnVuY3Rpb24gcmVhZCgpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZWFkMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiByZWFkOwogICAgICAgIH0oKQogICAgICB9LCB7CiAgICAgICAga2V5OiAiY2FuY2VsIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY2FuY2VsKHJlYXNvbikgewogICAgICAgICAgdGhpcy5fcmVhZGVyLmNhbmNlbChyZWFzb24pOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImlzU3RyZWFtaW5nU3VwcG9ydGVkIiwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH1dKTsKCiAgICAgIHJldHVybiBQREZXb3JrZXJTdHJlYW1SYW5nZVJlYWRlcjsKICAgIH0oKTsKCiAgICAvKioqL30KICAvKioqKioqLyldKTsKfSk7"
          })

          function generateJPG() {
            if (!pdfData) {
              return
            }

            generateBtn.disabled = true
            generateBtn.textContent = t("converting")

            // load the pdf document
            var loadingTask = pdfjsLib.getDocument({ data: new Uint8Array(pdfData) })
            loadingTask.promise
              .then(function (pdf) {
                var numPages = pdf.numPages
                var jpgImages = []

                // process each page recursively
                function processPage(pageNum) {
                  if (pageNum > numPages) {
                    // all pages processed, now download
                    if (numPages === 1) {
                      // single page: download as jpg
                      var link = document.createElement("a")
                      link.href = jpgImages[0].dataUrl
                      link.download = pdfFileName + ".jpg"
                      link.click()
                    } else {
                      // multiple pages: create zip with no compression
                      var zip = new JSZip()

                      for (var i = 0; i < jpgImages.length; i++) {
                        var base64Data = jpgImages[i].dataUrl.split(",")[1]
                        zip.file(jpgImages[i].filename, base64Data, { base64: true })
                      }

                      zip
                        .generateAsync({ type: "blob", compression: "STORE" })
                        .then(function (blob) {
                          var linkFile = document.createElement("a")
                          linkFile.href = URL.createObjectURL(blob)
                          linkFile.download = pdfFileName + ".zip"
                          linkFile.click()
                        })
                    }
                    generateBtn.textContent = t("generate")
                    generateBtn.disabled = false
                    return
                  }

                  generateBtn.textContent = t("page_of")
                    .replace("{0}", pageNum)
                    .replace("{1}", numPages)

                  pdf.getPage(pageNum).then(function (page) {
                    // set scale for good quality (3x for higher resolution)
                    var scale = 3
                    var viewport = page.getViewport({ scale: scale })

                    // create canvas for rendering
                    var canvas = document.createElement("canvas")
                    var context = canvas.getContext("2d")
                    canvas.height = viewport.height
                    canvas.width = viewport.width

                    // render the page to canvas
                    var renderContext = {
                      canvasContext: context,
                      viewport: viewport,
                    }

                    page.render(renderContext).promise.then(function () {
                      // convert canvas to jpg and store
                      var jpgDataUrl = canvas.toDataURL("image/jpeg", 0.95)
                      jpgImages.push({
                        filename:
                          pdfFileName +
                          "_" +
                          String(pageNum).padStart(6, "0") +
                          ".jpg",
                        dataUrl: jpgDataUrl,
                      })

                      // process next page
                      processPage(pageNum + 1)
                    })
                  })
                }

                processPage(1)
              })
              .catch(function (_error) {
                //
              })
          }

          uploader.addEventListener("change", function (e) {
            var file = e.target.files[0]
            var extension = file
              ? file.name.toLowerCase().substr(file.name.lastIndexOf("."))
              : ""

            if (file && extension === ".pdf") {
              var reader = new FileReader()
              reader.addEventListener("load", function (event) {
                pdfData = new Uint8Array(event.target.result)
                pdfFileName = file.name.replace(/\.pdf$/i, "")
                generateBtn.disabled = false

                // show pdf preview
                pdfPreview.src = URL.createObjectURL(file)
                pdfPreview.style.display = "block"
              })
              reader.readAsArrayBuffer(file)
            }
          })

          generateBtn.addEventListener("click", function () {
            generateJPG()
          })
        }
      })
    </script>
  </body>
</html>
